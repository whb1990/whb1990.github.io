<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[Java-NIO]]></title>
    <url>%2Fposts%2F66138958.html</url>
    <content type="text"><![CDATA[åŸºçŸ³--Path Path æ—¢å¯ä»¥è¡¨ç¤ºä¸€ä¸ªç›®å½•ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åƒ File é‚£æ ·â€”â€”å½“ç„¶äº†ï¼ŒPath å°±æ˜¯ç”¨æ¥å–ä»£ File çš„ã€‚ 1ï¼‰å¯ä»¥é€šè¿‡ Paths.get() åˆ›å»ºä¸€ä¸ª Path å¯¹è±¡ï¼Œæ­¤æ—¶ Path å¹¶æ²¡æœ‰çœŸæ­£åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºï¼›å‚æ•°æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•åï¼›ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„å‡å¯ã€‚2ï¼‰å¯ä»¥é€šè¿‡ Files.notExists() ç¡®è®¤ Pathï¼ˆç›®å½•æˆ–è€…æ–‡ä»¶ï¼‰ æ˜¯å¦å·²ç»å­˜åœ¨ã€‚3ï¼‰å¯ä»¥é€šè¿‡ Files.createDirectory() åˆ›å»ºç›®å½•ï¼Œæ­¤æ—¶ç›®å½•å·²ç»åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºæˆåŠŸï¼Œå¯é€šè¿‡èµ„æºç®¡ç†å™¨æŸ¥çœ‹åˆ°ã€‚4ï¼‰å¯ä»¥é€šè¿‡ Files.createFile() åˆ›å»ºæ–‡ä»¶ï¼Œæ­¤æ—¶æ–‡ä»¶å·²ç»åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºæˆåŠŸï¼Œå¯é€šè¿‡èµ„æºç®¡ç†å™¨æŸ¥çœ‹åˆ°ã€‚5ï¼‰å¯ä»¥é€šè¿‡ toAbsolutePath() æŸ¥çœ‹ Path çš„ç»å¯¹è·¯å¾„ã€‚6ï¼‰å¯ä»¥é€šè¿‡ resolve() å°† Path è¿žæŽ¥èµ·æ¥ï¼Œå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ–°çš„ Path å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.nio;import java.io.IOException;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;/** * @author: whb * @description: NIOåŸºçŸ³Pathæµ‹è¯•ç±» */public class PathTest &#123; public static void main(String[] args) &#123; // ç›¸å¯¹è·¯å¾„ Path dir = Paths.get("nioTest"); // è¾“å‡º dir çš„ç»å¯¹è·¯å¾„ System.out.println(dir.toAbsolutePath()); if (Files.notExists(dir)) &#123; try &#123; // å¦‚æžœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½• Files.createDirectory(dir); &#125; catch (IOException e1) &#123; e1.printStackTrace(); &#125; &#125; // è¿™æ—¶å€™ nioTest.txt æ–‡ä»¶å¹¶æœªåˆ›å»º // é€šè¿‡ resolve æ–¹æ³•æŠŠ dir å’Œ nioTest.txt é“¾æŽ¥èµ·æ¥ Path file = dir.resolve("nioTest.txt"); // è¾“å‡º file çš„ç»å¯¹è·¯å¾„ System.out.println(file.toAbsolutePath()); if (Files.notExists(file)) &#123; try &#123; // å¦‚æžœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ Files.createFile(file); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125; å¦‚æžœè¦å°† File è½¬æ¢ä¸º Pathï¼Œå¯ä»¥é€šè¿‡ File ç±»çš„ toPath() æ–¹æ³•å®Œæˆã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12File file = new File("nioTest.txt");Path path = file.toPath(); å¦‚æžœè¦å°† Path è½¬æ¢ä¸º Fileï¼Œå¯ä»¥é€šè¿‡ Path ç±»çš„ toFile() æ–¹æ³•å®Œæˆã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12Path path = Paths.get("nioTest.txt");File file = path.toFile(); å¤„ç†ç›®å½• NIO 2.0 æ–°å¢žçš„ java.nio.file.DirectoryStream&lt;T&gt; æŽ¥å£å¯ä»¥éžå¸¸æ–¹ä¾¿åœ°æŸ¥æ‰¾ç›®å½•ä¸­çš„ï¼ˆç¬¦åˆæŸç§è§„åˆ™çš„ï¼‰æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦æŸ¥æ‰¾ nioTest ç›®å½•ä¸‹çš„ txt åŽç¼€çš„æ–‡ä»¶ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910// ç›¸å¯¹è·¯å¾„Path parentDir = Paths.get("nioTest");try (DirectoryStream&lt;Path&gt; stream = Files.newDirectoryStream(parentDir, "*.txt")) &#123; for (Path entry : stream) &#123; System.out.println(entry.getFileName()); &#125;&#125; catch (IOException e) &#123; e.printStackTrace();&#125; 1ï¼‰Files.newDirectoryStream(Path dir, String glob) ä¼šè¿”å›žä¸€ä¸ªè¿‡æ»¤åŽçš„ DirectoryStreamï¼ˆ ç›®å½•æµï¼‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®å½•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º glob è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ *.txt è¡¨ç¤ºæ‰€æœ‰ txt åŽç¼€çš„æ–‡ä»¶ã€‚2ï¼‰ç”±äºŽ DirectoryStream ç»§æ‰¿äº† Closeable æŽ¥å£ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é…åˆ try-with-resources è¯­æ³•å†™å‡ºæ›´å®‰å…¨çš„ä»£ç ï¼Œç›®å½•æµä¼šè‡ªåŠ¨è°ƒç”¨ close æ–¹æ³•å…³é—­æµï¼Œé‡Šæ”¾ä¸Žæµç›¸å…³çš„èµ„æºï¼Œä¸éœ€è¦å†é€šè¿‡ finally è¿›è¡Œä¸»åŠ¨å…³é—­ã€‚3ï¼‰DirectoryStream è¢«ç§°ä¸ºç›®å½•æµï¼Œå…è®¸æ–¹ä¾¿åœ°ä½¿ç”¨ for-each ç»“æž„æ¥éåŽ†ç›®å½•ã€‚ å¤„ç†ç›®å½•æ ‘ ç›®å½•æ ‘æ„å‘³ç€ä¸€ä¸ªç›®å½•é‡Œæ—¢æœ‰æ–‡ä»¶ä¹Ÿæœ‰å­ç›®å½•ï¼Œä¹Ÿå¯èƒ½éƒ½æ²¡æœ‰ï¼Œä¹Ÿå¯èƒ½æœ‰å…¶ä¸€ã€‚NIO 2.0 å¯ä»¥å¾ˆæ–¹ä¾¿åœ°éåŽ†ä¸€é¢—ç›®å½•æ ‘ï¼Œå¹¶æ“ä½œç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼›è¿™å…¶ä¸­å…³é”®çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ Files ç±»çš„ walkFileTreeï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 12345678public static Path walkFileTree(Path start, FileVisitor&lt;? super Path&gt; visitor) throws IOException&#123; return walkFileTree(start, EnumSet.noneOf(FileVisitOption.class), Integer.MAX_VALUE, visitor);&#125; ç¬¬äºŒä¸ªå‚æ•° FileVisitor è¢«ç§°ä¸ºæ–‡ä»¶è®¿é—®å™¨æŽ¥å£ï¼Œå®ƒå®žçŽ°èµ·æ¥éžå¸¸å¤æ‚ï¼Œè¦å®žçŽ° 5 ä¸ªæ–¹æ³•ï¼Œä½†å¹¸å¥½ JDK çš„è®¾è®¡è€…æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å®žçŽ°ç±» SimpleFileVisitorï¼Œå¦‚æžœæˆ‘ä»¬åªæƒ³ä»Žç›®å½•æ ‘ä¸­æ‰¾åˆ° txt åŽç¼€çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·åšï¼š 123456789101112131415// ç›¸å¯¹è·¯å¾„dir = Paths.get("nioTest");try &#123; Files.walkFileTree(dir, new SimpleFileVisitor&lt;Path&gt;() &#123; @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) &#123; if (file.toString().endsWith(".txt")) &#123; System.out.println(file.getFileName()); &#125; return FileVisitResult.CONTINUE; &#125; &#125;);&#125; catch (IOException e) &#123; e.printStackTrace();&#125; é€šè¿‡åˆ›å»ºåŒ¿åå†…éƒ¨ç±»æ¥é‡å†™ SimpleFileVisitor çš„ visitFile æ–¹æ³•ï¼Œå¦‚æžœåŽç¼€åä¸º txt å°±æ‰“å°å‡ºæ¥ã€‚ æ–‡ä»¶çš„åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ åˆ é™¤æ–‡ä»¶ åˆ é™¤ä¸€ä¸ªæ–‡ä»¶éžå¸¸ç®€å•ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12Files.delete(file);Files.deleteIfExists(file); ä½¿ç”¨ Files.delete() åˆ é™¤æ–‡ä»¶ä¹‹å‰æœ€å¥½ä½¿ç”¨ Files.exists() åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º NoSuchFileExceptionï¼›Files.deleteIfExists() åˆ™ä¸ç”¨ã€‚ å¤åˆ¶æ–‡ä»¶ å¤åˆ¶æ–‡ä»¶ä¹Ÿä¸å¤æ‚ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123Path source = Paths.get("nioTest.txt");Path target = Paths.get("nioTest1.txt");Files.copy(source, target); ç§»åŠ¨æ–‡ä»¶ ç§»åŠ¨æ–‡ä»¶å’Œå¤åˆ¶æ–‡ä»¶éžå¸¸ç›¸ä¼¼ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123Path source = Paths.get("nioTest.txt");Path target = Paths.get("nioTest2.txt");Files.move(source, target); å¿«é€Ÿè¯»å†™æ–‡ä»¶ NIO 2.0 æä¾›äº†å¸¦æœ‰ç¼“å†²åŒºçš„è¯»å†™è¾…åŠ©æ–¹æ³•ï¼Œé€šè¿‡ Files.newBufferedWriter() èŽ·å–ä¸€ä¸ªæ–‡ä»¶ç¼“å†²è¾“å…¥æµï¼Œå¹¶é€šè¿‡ write() æ–¹æ³•å†™å…¥æ•°æ®ï¼›ç„¶åŽé€šè¿‡ Files.newBufferedReader() èŽ·å–ä¸€ä¸ªæ–‡ä»¶ç¼“å†²è¾“å‡ºæµï¼Œé€šè¿‡ readLine() æ–¹æ³•è¯»å‡ºæ•°æ®ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚ 1234567891011121314151617Path file = Paths.get("nioPathTest.txt");try (BufferedWriter writer = Files.newBufferedWriter(file, StandardCharsets.UTF_8)) &#123; writer.write("å­¦ä¹ NIOï¼Œå®žçŽ°æ–‡ä»¶çš„å¿«é€Ÿè¯»å†™");&#125; catch (Exception e) &#123; e.printStackTrace();&#125;try (BufferedReader reader = Files.newBufferedReader(file, StandardCharsets.UTF_8)) &#123; String line; while ((line = reader.readLine()) != null) &#123; System.out.println(line); &#125;&#125; catch (Exception e) &#123; e.printStackTrace();&#125; å¼‚æ­¥I/Oæ“ä½œ å¼‚æ­¥ I/O æ“ä½œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„ç‰¹ç‚¹ï¼Œä¸éœ€è¦å†åƒä»¥å‰é‚£æ ·å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹ I/O è¿›è¡Œå¤„ç†ï¼Œå…å¾—é˜»å¡žäº†ä¸»çº¿ç¨‹çš„å…¶ä»–æ“ä½œã€‚ å¼‚æ­¥ I/O æ“ä½œçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å‘èµ·éžé˜»å¡žæ–¹å¼çš„ I/O æ“ä½œï¼Œå½“ I/O æ“ä½œå®Œæˆæ—¶é€šçŸ¥ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼šFuture å’Œ Callbackã€‚ å¦‚æžœå¸Œæœ›ä¸»çº¿ç¨‹å‘èµ· I/O æ“ä½œå¹¶è½®å¾ªç­‰å¾…ç»“æžœæ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨ Future çš„å½¢å¼ï¼›è€Œ Callback çš„åŸºæœ¬æ€æƒ³æ˜¯ä¸»çº¿ç¨‹æ´¾å‡ºä¸€ä¸ªä¾¦æŸ¥å‘˜ï¼ˆCompletionHandlerï¼‰åˆ°ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œ I/O æ“ä½œï¼Œæ“ä½œå®ŒæˆåŽï¼Œä¼šè§¦å‘ä¾¦æŸ¥å‘˜çš„ completed æˆ–è€… failed æ–¹æ³•ã€‚ Future ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011public static void main(String[] args) throws IOException, InterruptedException, ExecutionException &#123; Path file = Paths.get("nio.txt"); AsynchronousFileChannel channel = AsynchronousFileChannel.open(file); Future&lt;Integer&gt; result = channel.read(ByteBuffer.allocate(100_000), 0); while (!result.isDone()) &#123; System.out.println("ä¸»çº¿ç¨‹ç»§ç»­åšäº‹æƒ…"); &#125; Integer bytesRead = result.get(); System.out.println(bytesRead);&#125; 1ï¼‰é€šè¿‡ AsynchronousFileChannel.open() æ‰“å¼€ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ channelã€‚2ï¼‰ç”¨ Future æ¥ä¿å­˜ä»Žé€šé“ä¸­è¯»å–çš„ç»“æžœã€‚3ï¼‰é€šè¿‡ isDone() è½®å¾ªåˆ¤æ–­å¼‚æ­¥ I/O æ“ä½œæ˜¯å¦å®Œæˆï¼Œå¦‚æžœæ²¡æœ‰å®Œæˆçš„è¯ï¼Œä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ã€‚ Callback ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415public static void main(String[] args) throws IOException, InterruptedException, ExecutionException &#123; Path file = Paths.get("nio2.txt"); AsynchronousFileChannel channel = AsynchronousFileChannel.open(file); channel.read(ByteBuffer.allocate(100_000), 0, null, new CompletionHandler&lt;Integer, ByteBuffer&gt;() &#123; public void completed(Integer result, ByteBuffer attachment) &#123; System.out.println(result); &#125; public void failed(Throwable exc, ByteBuffer attachment) &#123; System.out.println(exc.getMessage()); &#125; &#125;); System.out.println("ä¸»çº¿ç¨‹ç»§ç»­åšäº‹æƒ…");&#125; 1ï¼‰é€šè¿‡ AsynchronousFileChannel.open() æ‰“å¼€ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ channelã€‚2ï¼‰åœ¨ read æ–¹æ³•ä¸­ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å½¢å¼å¯ç”¨ CompletionHandlerï¼Œç„¶åŽå®žçŽ° CompletionHandler çš„ä¸¤ä¸ªç›‘å¬æ–¹æ³•ï¼Œcompleted çš„æ—¶å€™æ‰“å°ç»“æžœï¼Œfailed çš„æ—¶å€™æ‰“å°å¼‚å¸¸ä¿¡æ¯ã€‚ ä¸ç®¡æ˜¯ Future å½¢å¼è¿˜æ˜¯ Callback å½¢å¼ï¼Œæ€»ä¹‹å¼‚æ­¥ I/O æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå¯ä»¥ä¿è¯åœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶æ€§èƒ½ä¸å—åˆ°æ˜¾è‘—çš„å½±å“ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mybatis-0å€¼é—®é¢˜]]></title>
    <url>%2Fposts%2F9dd16667.html</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ä½¿ç”¨Mybatisçš„æ—¶å€™ï¼Œæ›¾é‡åˆ°è¿‡ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œå½“ä½¿ç”¨&lt;if test=&quot;status != null and status != ''&quot;&gt;åˆ¤ç©ºæ“ä½œæ—¶ï¼Œå¦‚æžœstatusä¸º0çš„æ—¶å€™ï¼Œè¯¥åˆ¤æ–­æ¡ä»¶çš„å€¼ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯è¯´Mybatisæ­¤æ—¶æŠŠ0ä½œä¸ºnullæ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚ é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œç¿»çœ‹Mybatisçš„æºç ï¼Œå‘çŽ°å…¶åœ¨ExpressionEvaluator.javaç±»çš„evaluateBooleanæ–¹æ³•å¤„è¿”å›žäº†falseã€‚ åœºæ™¯åˆ†æž æ•°æ®åº“å­—æ®µ 1`pay_status` int(11) NOT NULL DEFAULT '0' COMMENT 'æ”¯ä»˜çŠ¶æ€ 0-æœªæ”¯ä»˜ 1-å·²æ”¯ä»˜', æŒ‰ç…§ä¸€èˆ¬çš„é€»è¾‘æ¥çœ‹ï¼ŒæŸ¥è¯¢è¯­å¥éœ€è¦å†™æˆè¿™æ ·çš„å½¢å¼ï¼š 1234select * from order_pay pay WHERE pay.deal_id = 1&lt;if test="payStatus != null and payStatus != ''"&gt; and pay.pay_status = #&#123;payStatus&#125;&lt;/if&gt; å½“æŸ¥è¯¢å‚æ•°ä¸ä¼ é€’æœªæ”¯ä»˜æˆ–è€…å·²æ”¯ä»˜æ¡ä»¶æ—¶ï¼Œå°±éœ€è¦æŸ¥è¯¢payStatusä¸º0å’Œ1çš„å…¨éƒ¨ç»“æžœï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æ¡ä»¶and pay.pay_status = #{payStatus}ï¼Œä½†äº‹å®žå°±çº ç»“äº†ï¼Œå½“payStatusä¼ é€’çš„å‚æ•°ä¸º1æ—¶ï¼Œifæ¡ä»¶çš„ç»“æžœä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´sqlè¯­å¥å˜æˆäº†select * from order_pay pay WHERE pay.deal_id = 1 and pay.pay_status=1ï¼ŒæŸ¥è¯¢ç»“æžœæ­£å¸¸ï¼Œä½†å¦‚æžœpayStatusä¸º0æ­¤æ—¶ï¼Œsqlè¯­å¥å˜æˆäº†select * from order_pay pay WHERE pay.deal_id = 1ï¼Œä¸Žé¢„æœŸç»“æžœselect * from order_pay pay WHERE pay.deal_id = 1 and pay.pay_status=0æ˜¾ç„¶æ˜¯ä¸ç¬¦çš„ï¼ Mybatisè‡ªä½œä¸»å¼ çš„æŠŠpayStatusä¸º0çš„æ¡ä»¶å½“åšäº†ifçš„falseç»“æžœï¼ è§£å†³åŠžæ³• æ–¹æ³•ä¸€ payStatusæ˜¯Integerç±»åž‹çš„ï¼ŒæŠŠpayStatus != '' åŽ»æŽ‰å°±å¯ä»¥äº†ã€‚ é‚£ä¹ˆçŽ°åœ¨é‡æ–°æ¥çœ‹ï¼Œå…ˆå‰çš„åšæ³•æœ¬æ¥å°±æœ‰é—®é¢˜ï¼Œintegerç±»åž‹çš„ï¼Œå¹²å˜›è¦ç”¨payStatus!=''æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼Œä»ŽåŽŸåˆ™ä¸Šæ¥è®²ï¼Œ&lt;if test=&quot;payStatus != null and payStatus != ''&quot;&gt;è¯¥åˆ¤æ–­æ¡ä»¶åªèƒ½æ¥åˆ¤æ–­payStatusä¸ºstringç±»åž‹çš„ï¼Œä¸èƒ½ç”¨æ¥åˆ¤æ–­integerç±»åž‹ã€‚ ä½†ç”±æ­¤å¼•å‘ä¸€ä¸ªç–‘é—®ï¼š&lt;if test=&quot;payStatus != null and payStatus != ''&quot;&gt;åˆ¤æ–­ä¸æ˜¯ä¸ºç©ºï¼Œå¯¹äºŽIntegerç±»åž‹å°±æ˜¯åœ¨åˆ¤æ–­ä¸ä¸º0ä¹ˆï¼Ÿ æ–¹æ³•äºŒ å¯¹ä¼ é€’å‚æ•°æ‹¦æˆª 12345678910public static int parseStringToInt(Object parameter, int defualtValue) &#123; try &#123; if ((parameter == null) || (parameter.equals(""))) &#123; return defualtValue; &#125; return Integer.parseInt(parameter.toString()); &#125; catch (Exception ex) &#123; &#125; return 0;&#125; 1vo.addParams("status", StrUtil.parseStringToInt(vo.getParams("status"), -1)); ä¹Ÿå°±æ˜¯è¯´åœ¨æŸ¥è¯¢æ‰€æœ‰æ”¯ä»˜çŠ¶æ€çš„è®¢å•æ—¶ï¼ŒæŠŠpayStatusçš„å€¼è½¬æ¢ä¸º-1ã€‚ é‡æž„Mybatisçš„æŸ¥è¯¢è¯­å¥ 1234select * from order_pay pay WHERE pay.deal_id = 1&lt;if test="payStatus != -1"&gt; and pay.pay_status = #&#123;payStatus&#125;&lt;/if&gt;]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ä¸Šé—®é¢˜æŽ’æŸ¥æ€»ç»“ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F4a0297a6.html</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨çº¿ä¸Šï¼Œæˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šç¢°åˆ°ç¨‹åºå¡æ­»æˆ–è€…æ‰§è¡Œå¾ˆæ…¢ç­‰æƒ…å†µï¼Œè¿™æ—¶æˆ‘ä»¬è¿«åˆ‡å¸Œæœ›çŸ¥é“æ˜¯ä»£ç å“ªé‡Œçš„é—®é¢˜ï¼Œä»£ç è¿è¡Œåˆ°äº†å“ªé‡Œï¼Œæ˜¯å“ªä¸€æ­¥å¾ˆæ…¢ï¼Œæ˜¯å¦è¿›å…¥äº†æ­»å¾ªçŽ¯ï¼Œæ˜¯å¦æœ‰ä»£ç å‡ºçŽ°äº†çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œæ˜¯å¦æœ‰æŸäº›è¿žæŽ¥æ•°æˆ–è€…æ‰“å¼€çš„æ–‡ä»¶æ•°å¤ªå¤šç­‰ç­‰é—®é¢˜ã€‚æ­¤æ—¶å°±éœ€è¦é€šè¿‡åˆ†æžæ¡ˆå‘æ—¶çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚ è¦æƒ³å¿«é€Ÿåˆ†æžã€å®šä½é—®é¢˜ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ç‚¹å…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚ï¼šjstatã€jstackã€jmapã€jhatã€jconsoleã€jprofileç­‰ç­‰ã€‚ è€Œå®šä½é—®é¢˜çš„æ­¥éª¤æ— å¤–ä¹Žå‡ æ­¥ï¼š ps -ef | gre java èŽ·å–javaè¿›ç¨‹pidtop pid æŸ¥çœ‹cpuè€—CPUè¿›ç¨‹top -Hp pid æˆ–è€… ps -mp pid -o THREAD,tid,time æŸ¥çœ‹è¯¥è¿›ç¨‹æ‰€æœ‰çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼Œæ‰¾åˆ°å ç”¨ CPU è¿‡é«˜çš„çº¿ç¨‹ pidprintf &quot;%x\n&quot; pid æ‰“å°å‡º pid çš„ 16 è¿›åˆ¶å€¼ï¼ˆjstack å‘½ä»¤ç»“æžœä¸­çš„çº¿ç¨‹ ID ä¸º nidï¼Œä¸”ç”¨ 16 è¿›åˆ¶è¡¨ç¤ºï¼‰jstack -l pid | grep nid å‘½ä»¤æŸ¥çœ‹çº¿ç¨‹å¿«ç…§ï¼Œæ ¹æ®ä¸Šä¸€æ­¥å¾—åˆ°çš„ 16 è¿›åˆ¶å€¼æ‰¾åˆ°å…·ä½“çš„çº¿ç¨‹ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œä»€ä¹ˆä»£ç äº† ä¸Šé¢å‡ æ­¥æ˜¯å¸¸ç”¨å®šä½é—®é¢˜çš„æ­¥éª¤ï¼Œæœ‰çš„å…¬å¸ï¼ˆæ¯”å¦‚æˆ‘ä»¬å…¬å¸ï¼‰è‡ªå·±å†™äº†ç›‘æŽ§è„šæœ¬ï¼Œåœ¨å‡ºçŽ°é—®é¢˜çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨dumpçº¿ç¨‹å †æ ˆã€å†…å­˜ä½¿ç”¨æƒ…å†µã€cpuè´Ÿè½½æƒ…å†µã€åžƒåœ¾å›žæ”¶æƒ…å†µç­‰ã€‚ä¸‹é¢å°±ä»¥æˆ‘é‡åˆ°çš„ä¸€ä¸ªçº¿ä¸Šé—®é¢˜ä¸¾ä¾‹è®²è§£ï¼š ä¸Šé¢çš„æˆªå›¾å°±æ˜¯å½“æ—¶å‡ºé—®é¢˜æ—¶è„šæœ¬è‡ªåŠ¨è¾“å‡ºçš„æ—¥å¿—ï¼Œå…¶ä¸­30669_*æ—¶ä»¥å½“æ—¶çš„çº¿ç¨‹IDä¸ºå‰ç¼€ï¼Œä¸‹é¢å°±é’ˆå¯¹å„ä¸ªæ—¥å¿—ï¼ˆä»Žä¸‹åˆ°ä¸Šï¼‰å†…å®¹å±•å¼€å­¦ä¹ ã€‚ loadavg.log é¦–å…ˆçœ‹ä¸€ä¸‹loadavg.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š loadavgæ˜¯ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼Œå³åœ¨ç‰¹å®šæ—¶é—´é—´éš”å†…è¿è¡Œé˜Ÿåˆ—ä¸­çš„å¹³å‡è¿›ç¨‹æ•°ã€‚ å‰ä¸‰ä¸ªæ˜¯1ã€5ã€15åˆ†é’Ÿå†…çš„å¹³å‡è¿›ç¨‹æ•°ã€‚ç¬¬å››ä¸ªçš„åˆ†å­æ˜¯æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°ï¼Œåˆ†æ¯æ˜¯è¿›ç¨‹æ€»æ•°ã€‚æœ€åŽä¸€ä¸ªæ˜¯æœ€è¿‘è¿è¡Œçš„è¿›ç¨‹IDå·ã€‚ ä¸€èˆ¬æ¥è¯´æ¯ä¸ªCPUçš„å½“å‰æ´»åŠ¨è¿›ç¨‹æ•°ä¸å¤§äºŽ3é‚£ä¹ˆç³»ç»Ÿçš„æ€§èƒ½å°±æ˜¯è‰¯å¥½çš„ã€‚å¦‚æžœæ¯ä¸ªCPUçš„ä»»åŠ¡æ•°å¤§äºŽ5ï¼Œé‚£ä¹ˆå°±è¡¨æ˜Žæœºå™¨çš„æ€§èƒ½æœ‰ä¸¥é‡é—®é¢˜ã€‚ ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå‡è®¾ç³»ç»Ÿæœ‰8ä¸ªCPUï¼Œåˆ™æ¯ä¸ªCPUåœ¨1åˆ†é’Ÿå†…çš„è¿›ç¨‹æ•°ä¸ºï¼š1.16/8=0.145 å¦‚æžœæˆ‘ä»¬æƒ³æŸ¥çœ‹ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š cat /proc/loadavg uptime tload top.log ä¸‹é¢çœ‹ä¸‹30669_top.logå’Œ30669_top10_thread.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š 30669_top.logèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹æƒ…å†µã€‚ 30669_top10_thread.logæ˜¯èµ„æºå ç”¨å‰10çš„è¿›ç¨‹æƒ…å†µã€‚ å†…å®¹è§£è¯» 123456789top - 15:48:34 up 60 days, 18:06, 1 user, load average: 1.45, 0.47, 0.20Tasks: 1 total, 0 running, 1 sleeping, 0 stopped, 0 zombie%Cpu(s): 96.7 us, 0.0 sy, 0.0 ni, 3.3 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 stKiB Mem : 4046212 total, 127012 free, 1575164 used, 2344036 buff/cacheKiB Swap: 4194300 total, 4171260 free, 23040 used. 1984224 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND30669 www 20 0 3769288 1.4g 14732 S 193.3 37.0 9:55.30 java180.0 146.7 200.0 ç¬¬ä¸€è¡Œtopæ˜¯ç³»ç»Ÿè¿è¡Œæ—¶é—´å’Œå¹³å‡è´Ÿè½½ï¼ŒåŒuptimeå‘½ä»¤çš„æ‰§è¡Œç»“æžœ15:48:34 ðŸ‘‰ å½“å‰æ—¶é—´up 60 days, 18:06 ðŸ‘‰ ç³»ç»Ÿè¿è¡Œæ—¶é—´1 user ðŸ‘‰ å½“å‰ç™»å½•ç”¨æˆ·æ•°load average: 1.45, 0.47, 0.20 ðŸ‘‰ ç³»ç»Ÿè´Ÿè½½ï¼Œä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå‰åˆ°çŽ°åœ¨çš„å¹³å‡å€¼ã€‚ç¬¬äºŒè¡ŒTasksæ˜¯ä»»åŠ¡ä¿¡æ¯1 total ðŸ‘‰ è¿›ç¨‹æ€»æ•°0 running ðŸ‘‰ æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°1 sleeping ðŸ‘‰ ç¡çœ çš„è¿›ç¨‹æ•°0 stopped ðŸ‘‰ åœæ­¢çš„è¿›ç¨‹æ•°0 zombie ðŸ‘‰ åƒµå°¸è¿›ç¨‹æ•°ç¬¬ä¸‰è¡Œ%Cpu(s)æ˜¯CPUä¿¡æ¯96.7 us ðŸ‘‰ ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0 sy ðŸ‘‰ å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0 ni ðŸ‘‰ ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”3.3 id ðŸ‘‰ ç©ºé—²CPUç™¾åˆ†æ¯”0.0 wa ðŸ‘‰ ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”0.0 hi ðŸ‘‰ ç¡¬ä»¶CPUä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0 si ðŸ‘‰ è½¯ä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0 st ðŸ‘‰ è™šæ‹Ÿæœºï¼ˆè™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰å ç”¨ç™¾åˆ†æ¯”ç¬¬å››è¡ŒKiB Memæ˜¯ç‰©ç†å†…å­˜ä¿¡æ¯4046212 total ðŸ‘‰ ç‰©ç†å†…å­˜æ€»é‡127012 free ðŸ‘‰ ç©ºé—²ç‰©ç†å†…å­˜æ€»é‡1575164 used ðŸ‘‰ å·²ä½¿ç”¨ç‰©ç†å†…å­˜æ€»é‡2344036 buff/cache ðŸ‘‰ ç”¨æˆ·å†…æ ¸ç¼“å­˜çš„å†…å­˜æ€»é‡ç¬¬äº”è¡ŒKiB Swapæ˜¯äº¤æ¢åŒºå†…å­˜ä¿¡æ¯4194300 total ðŸ‘‰ äº¤æ¢åŒºæ€»é‡4171260 free ðŸ‘‰ ç©ºé—²äº¤æ¢åŒºæ€»é‡23040 used ðŸ‘‰ å·²ä½¿ç”¨äº¤æ¢åŒºæ€»é‡1984224 avail Mem ðŸ‘‰ ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡,å†…å­˜ä¸­çš„å†…å®¹è¢«æ¢å‡ºåˆ°äº¤æ¢åŒºï¼Œè€ŒåŽåˆè¢«æ¢å…¥åˆ°å†…å­˜ï¼Œä½†ä½¿ç”¨è¿‡çš„äº¤æ¢åŒºå°šæœªè¢«è¦†ç›–ï¼Œè¯¥æ•°å€¼å³ä¸ºè¿™äº›å†…å®¹å·²å­˜åœ¨äºŽå†…å­˜ä¸­çš„äº¤æ¢åŒºçš„å¤§å°,ç›¸åº”çš„å†…å­˜å†æ¬¡è¢«æ¢å‡ºæ—¶å¯ä¸å¿…å†å¯¹äº¤æ¢åŒºå†™å…¥ã€‚ç¬¬å…­è¡Œæ˜¯ç©ºè¡Œç¬¬ä¸ƒè¡Œä»¥åŽçš„å†…å®¹æ˜¯å„è¿›ç¨‹ï¼ˆä»»åŠ¡ï¼‰çš„çŠ¶æ€ä¿¡æ¯PID ðŸ‘‰ è¿›ç¨‹IDï¼Œè¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦USER ðŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„å®žé™…ç”¨æˆ·åPR ðŸ‘‰ è¿›ç¨‹çš„è°ƒåº¦ä¼˜å…ˆçº§ã€‚è¿™ä¸ªå­—æ®µçš„ä¸€äº›å€¼æ˜¯rtï¼Œæ„å‘³ç€è¿›ç¨‹åœ¨å®žæ—¶è¿è¡Œä¸­ã€‚NI ðŸ‘‰ è¿›ç¨‹çš„niceå€¼ï¼ˆä¼˜å…ˆçº§ï¼‰ã€‚è¶Šå°çš„å€¼æ„å‘³ç€è¶Šé«˜çš„ä¼˜å…ˆçº§ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½Žä¼˜å…ˆçº§ã€‚VIRT ðŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ã€‚è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT = SWAP + RESRES ðŸ‘‰ é©»ç•™å†…å­˜å¤§å°ã€‚é©»ç•™å†…å­˜æ˜¯ä»»åŠ¡ä½¿ç”¨çš„éžäº¤æ¢ç‰©ç†å†…å­˜å¤§å°ã€‚è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES = CODE + DATASHR ðŸ‘‰ SHR æ˜¯è¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kbS ðŸ‘‰ æ˜¯è¿›ç¨‹çš„çŠ¶æ€ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ï¼šD ðŸ‘‰ ä¸å¯ä¸­æ–­çš„ç¡çœ æ€ã€‚R ðŸ‘‰ è¿è¡Œæ€S ðŸ‘‰ ç¡çœ æ€T ðŸ‘‰ è¢«è·Ÿè¸ªæˆ–å·²åœæ­¢Z ðŸ‘‰ åƒµå°¸æ€%CPU ðŸ‘‰ è‡ªä»Žä¸Šä¸€æ¬¡æ›´æ–°æ—¶åˆ°çŽ°åœ¨ä»»åŠ¡æ‰€ä½¿ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚%MEM ðŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„å¯ç”¨ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”ã€‚TIME+ ðŸ‘‰ ä»»åŠ¡å¯åŠ¨åŽåˆ°çŽ°åœ¨æ‰€ä½¿ç”¨çš„å…¨éƒ¨CPUæ—¶é—´ï¼Œç²¾ç¡®åˆ°ç™¾åˆ†ä¹‹ä¸€ç§’ã€‚COMMAND ðŸ‘‰ è¿è¡Œè¿›ç¨‹æ‰€ä½¿ç”¨çš„å‘½ä»¤ã€‚è¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å/å‘½ä»¤è¡Œï¼‰å…¶ä»–éžé‡è¦åˆ—PPID ðŸ‘‰ çˆ¶è¿›ç¨‹IDRUSER ðŸ‘‰ çœŸå®žç”¨æˆ·åUID ðŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·IDGROUP ðŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„ç»„åTTY ðŸ‘‰ å¯åŠ¨è¿›ç¨‹çš„ç»ˆç«¯åã€‚ä¸æ˜¯ä»Žç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹åˆ™æ˜¾ç¤ºä¸º?P ðŸ‘‰ æœ€åŽä½¿ç”¨çš„CPUï¼Œä»…åœ¨å¤šCPUçŽ¯å¢ƒä¸‹æœ‰æ„ä¹‰TIME ðŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½ç§’SWAP ðŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¢«æ¢å‡ºçš„å¤§å°ï¼Œå•ä½kbCODE ðŸ‘‰ å¯æ‰§è¡Œä»£ç å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbDATA ðŸ‘‰ å¯æ‰§è¡Œä»£ç ä»¥å¤–çš„éƒ¨åˆ†ï¼ˆæ•°æ®æ®µ+æ ˆï¼‰å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbnFLT ðŸ‘‰ é¡µé¢é”™è¯¯æ¬¡æ•°nDRT ðŸ‘‰ æœ€åŽä¸€æ¬¡å†™å…¥åˆ°çŽ°åœ¨ï¼Œè¢«ä¿®æ”¹è¿‡çš„é¡µé¢æ•°WCHAN ðŸ‘‰ è‹¥è¯¥è¿›ç¨‹åœ¨ç¡çœ ï¼Œåˆ™æ˜¾ç¤ºç¡çœ ä¸­çš„ç³»ç»Ÿå‡½æ•°åFlags ðŸ‘‰ ä»»åŠ¡æ ‡å¿— topå­¦ä¹  topå‘½ä»¤æ˜¯ç”¨æ¥ç›‘æŽ§Linuxç³»ç»ŸçŠ¶å†µï¼Œæ¯”å¦‚cpuã€å†…å­˜çš„ä½¿ç”¨ã€‚ è¯­æ³• 1top [-] [d] [p] [q] [c] [C] [S] [s] [n] å‚æ•°è§£æž d ðŸ‘‰ æŒ‡å®šæ¯ä¸¤æ¬¡å±å¹•ä¿¡æ¯åˆ·æ–°ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚å½“ç„¶ç”¨æˆ·å¯ä»¥ä½¿ç”¨säº¤äº’å‘½ä»¤æ¥æ”¹å˜ã€‚p ðŸ‘‰ é€šè¿‡æŒ‡å®šç›‘æŽ§è¿›ç¨‹IDæ¥ä»…ä»…ç›‘æŽ§æŸä¸ªè¿›ç¨‹çš„çŠ¶æ€ã€‚q ðŸ‘‰ è¯¥é€‰é¡¹å°†ä½¿topæ²¡æœ‰ä»»ä½•å»¶è¿Ÿçš„è¿›è¡Œåˆ·æ–°ã€‚å¦‚æžœè°ƒç”¨ç¨‹åºæœ‰è¶…çº§ç”¨æˆ·æƒé™ï¼Œé‚£ä¹ˆtopå°†ä»¥å°½å¯èƒ½é«˜çš„ä¼˜å…ˆçº§è¿è¡Œã€‚S ðŸ‘‰ æŒ‡å®šç´¯è®¡æ¨¡å¼ã€‚s ðŸ‘‰ ä½¿topå‘½ä»¤åœ¨å®‰å…¨æ¨¡å¼ä¸­è¿è¡Œã€‚è¿™å°†åŽ»é™¤äº¤äº’å‘½ä»¤æ‰€å¸¦æ¥çš„æ½œåœ¨å±é™©ã€‚i ðŸ‘‰ ä½¿topä¸æ˜¾ç¤ºä»»ä½•é—²ç½®æˆ–è€…åƒµæ­»è¿›ç¨‹ã€‚c ðŸ‘‰ æ˜¾ç¤ºæ•´ä¸ªå‘½ä»¤è¡Œè€Œä¸åªæ˜¯æ˜¾ç¤ºå‘½ä»¤åã€‚ å¸¸ç”¨äº¤äº’å‘½ä»¤ Ctrl+L ðŸ‘‰ æ“¦é™¤å¹¶ä¸”é‡å†™å±å¹•ã€‚hæˆ–è€…? ðŸ‘‰ æ˜¾ç¤ºå¸®åŠ©ç”»é¢ï¼Œç»™å‡ºä¸€äº›ç®€çŸ­çš„å‘½ä»¤æ€»ç»“è¯´æ˜Žã€‚k ðŸ‘‰ ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ã€‚ç³»ç»Ÿå°†æç¤ºç”¨æˆ·è¾“å…¥éœ€è¦ç»ˆæ­¢çš„è¿›ç¨‹PIDï¼Œä»¥åŠéœ€è¦å‘é€ç»™è¯¥è¿›ç¨‹ä»€ä¹ˆæ ·çš„ä¿¡å·ã€‚ä¸€èˆ¬çš„ç»ˆæ­¢è¿›ç¨‹å¯ä»¥ä½¿ç”¨15ä¿¡å·ï¼›å¦‚æžœä¸èƒ½æ­£å¸¸ç»“æŸé‚£å°±ä½¿ç”¨ä¿¡å·9å¼ºåˆ¶ç»“æŸè¯¥è¿›ç¨‹ã€‚é»˜è®¤å€¼æ˜¯ä¿¡å·15ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸­æ­¤å‘½ä»¤è¢«å±è”½ã€‚i ðŸ‘‰ å¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€å…³å¼å‘½ä»¤ã€‚q ðŸ‘‰ é€€å‡ºç¨‹åºã€‚r ðŸ‘‰ é‡æ–°å®‰æŽ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«ã€‚ç³»ç»Ÿæç¤ºç”¨æˆ·è¾“å…¥éœ€è¦æ”¹å˜çš„è¿›ç¨‹PIDä»¥åŠéœ€è¦è®¾ç½®çš„è¿›ç¨‹ä¼˜å…ˆçº§å€¼ã€‚è¾“å…¥ä¸€ä¸ªæ­£å€¼å°†ä½¿ä¼˜å…ˆçº§é™ä½Žï¼Œåä¹‹åˆ™å¯ä»¥ä½¿è¯¥è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆæƒã€‚é»˜è®¤å€¼æ˜¯10ã€‚s ðŸ‘‰ æ”¹å˜ä¸¤æ¬¡åˆ·æ–°ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ã€‚ç³»ç»Ÿå°†æç¤ºç”¨æˆ·è¾“å…¥æ–°çš„æ—¶é—´ï¼Œå•ä½ä¸ºsã€‚å¦‚æžœæœ‰å°æ•°ï¼Œå°±æ¢ç®—æˆm sã€‚è¾“å…¥0å€¼åˆ™ç³»ç»Ÿå°†ä¸æ–­åˆ·æ–°ï¼Œé»˜è®¤å€¼æ˜¯5 sã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æžœè®¾ç½®å¤ªå°çš„æ—¶é—´ï¼Œå¾ˆå¯èƒ½ä¼šå¼•èµ·ä¸æ–­åˆ·æ–°ï¼Œä»Žè€Œæ ¹æœ¬æ¥ä¸åŠçœ‹æ¸…æ˜¾ç¤ºçš„æƒ…å†µï¼Œè€Œä¸”ç³»ç»Ÿè´Ÿè½½ä¹Ÿä¼šå¤§å¤§å¢žåŠ ã€‚fæˆ–è€…F ðŸ‘‰ ä»Žå½“å‰æ˜¾ç¤ºä¸­æ·»åŠ æˆ–è€…åˆ é™¤é¡¹ç›®ã€‚oæˆ–è€…O ðŸ‘‰ æ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåºã€‚l ðŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå¹³å‡è´Ÿè½½å’Œå¯åŠ¨æ—¶é—´ä¿¡æ¯ã€‚m ðŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ã€‚t ðŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ã€‚c ðŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œã€‚M ðŸ‘‰ æ ¹æ®é©»ç•™å†…å­˜å¤§å°è¿›è¡ŒæŽ’åºã€‚P ðŸ‘‰ æ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡ŒæŽ’åºã€‚T ðŸ‘‰ æ ¹æ®æ—¶é—´/ç´¯è®¡æ—¶é—´è¿›è¡ŒæŽ’åºã€‚W ðŸ‘‰ å°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ä¸­ã€‚è¿™æ˜¯å†™topé…ç½®æ–‡ä»¶çš„æŽ¨èæ–¹æ³•ã€‚Shift+M ðŸ‘‰ å¯æŒ‰å†…å­˜å ç”¨æƒ…å†µè¿›è¡ŒæŽ’åºã€‚Enter/space ðŸ‘‰ åˆ·æ–°è§†å›¾A ðŸ‘‰ åœ¨å…¨å±æ¨¡å¼å’Œå¤šçª—å£é€‰æ‹©æ¨¡å¼ä¹‹é—´åˆ‡æ¢d ðŸ‘‰ è®¾ç½®åˆ·æ–°çš„æ—¶é—´é—´éš”E ðŸ‘‰ åˆ‡æ¢å†…å­˜å’Œäº¤æ¢åŒºå•ä½H ðŸ‘‰ å¼€å¯/å…³é—­çº¿ç¨‹æ¨¡å¼ï¼Œä»¥çº¿ç¨‹çš„æ–¹å¼å±•ç¤ºZ ðŸ‘‰ æ”¹å˜é¢œè‰²é…ç½® ä½¿ç”¨ç¤ºä¾‹ 1234567top //æ¯éš”5ç§’æ˜¾å¼æ‰€æœ‰è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -d 2 //æ¯éš”2ç§’æ˜¾å¼æ‰€æœ‰è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -c //æ¯éš”5ç§’æ˜¾å¼è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µï¼Œå¹¶æ˜¾ç¤ºè¿›ç¨‹çš„å‘½ä»¤è¡Œå‚æ•°(é»˜è®¤åªæœ‰è¿›ç¨‹å)top -p 12345 -p 6789 //æ¯éš”5ç§’æ˜¾ç¤ºpidæ˜¯12345å’Œpidæ˜¯6789çš„ä¸¤ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -d 2 -c -p 123456 //æ¯éš”2ç§’æ˜¾ç¤ºpidæ˜¯12345çš„è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶æ˜¾å¼è¯¥è¿›ç¨‹å¯åŠ¨çš„å‘½ä»¤è¡Œå‚æ•°ps -eLf | grep java | wc -l //ç›‘æŽ§javaçº¿ç¨‹æ•°netstat -n | grep tcp | grep ä¾¦å¬ç«¯å£ | wc -l //ç›‘æŽ§ç½‘ç»œå®¢æˆ·è¿žæŽ¥æ•° threadcount.log æŽ¥ç€çœ‹ä¸‹30669_threadcount.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—çš„å†…å®¹æ˜¯30669è¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ•°é‡ã€‚ ç»Ÿè®¡ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•° ä¸‹é¢å­¦ä¹ ä¸‹å¦‚ä½•ç»Ÿè®¡ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°ã€‚ proc ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒé©»ç•™åœ¨ /proc ç›®å½•ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•æ¥æŸ¥çœ‹ä»»ä½•æ´»åŠ¨è¿›ç¨‹çš„çº¿ç¨‹æ•°ã€‚ /proc ç›®å½•ä»¥å¯è¯»æ–‡æœ¬æ–‡ä»¶å½¢å¼è¾“å‡ºï¼Œæä¾›çŽ°æœ‰è¿›ç¨‹å’Œç³»ç»Ÿç¡¬ä»¶ç›¸å…³çš„ä¿¡æ¯å¦‚ CPUã€ä¸­æ–­ã€å†…å­˜ã€ç£ç›˜ç­‰ç­‰ã€‚ 12345cat/proc/&lt;pid&gt;/statusæˆ–è€… ls /proc/&lt;pid&gt;/task|wc ä¸Šé¢çš„å‘½ä»¤å°†æ˜¾ç¤ºè¿›ç¨‹ &lt;pid&gt; çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿‡ç¨‹çŠ¶æ€ï¼ˆä¾‹å¦‚, sleeping, running)ï¼Œçˆ¶è¿›ç¨‹ PIDï¼ŒUIDï¼ŒGIDï¼Œä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼Œä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ•°é‡ã€‚è¾“å‡ºä¹ŸåŒ…æ‹¬è¿›ç¨‹åˆ›å»ºçš„æ€»çº¿ç¨‹æ•°ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼› é¦–å…ˆä½¿ç”¨topå‘½ä»¤æŸ¥ä¸€ä¸‹å½“å‰å ç”¨èµ„æºæœ€å¤šçš„è¿›ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä»Žå›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“å‰13985æ˜¯å ç”¨èµ„æºæœ€å¤šï¼ŒæŽ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹13985è¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ•°ï¼Œå¦‚ä¸‹å›¾ï¼š tcp.log æŽ¥ç€å†çœ‹ä¸‹30669_tcp.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—å†…å®¹æ˜¯ç»Ÿè®¡æ¡ˆå‘æ—¶TCPçš„è¿žæŽ¥æ•°ï¼Œä¸‹é¢å­¦ä¹ ä¸‹å¦‚ä½•èŽ·å–TCPè¿žæŽ¥æ•°ã€‚ æ–¹æ³•ä¸€ 1ss -ant | awk &apos;NR&gt;1 &#123;a[$1]++&#125; END &#123;for (b in a) print b,a[b]&#125;&apos; æ–¹æ³•äºŒ 1netstat -an | awk &apos;/^tcp/ &#123;a[$NF]++&#125; END &#123;for (b in a) print b,a[b]&#125;&apos; æ–¹æ³•ä¸‰ 1netstat -nat|awk &apos;&#123;print $6&#125;&apos;|sort|uniq -c|sort -rn æ–¹æ³•å›› 1cat /proc/net/snmp è¾“å‡ºå†…å®¹ä¸­çš„å„é¡¹å‚æ•°çš„æ„ä¹‰ï¼Œè¯·å‚è€ƒ http://perthcharles.github.io/2015/11/10/wiki-netstat-proc/ lsof.log æŽ¥ç€å†çœ‹ä¸‹30669_lsof.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œå…¶å®žæˆ‘ä¹Ÿä¸çŸ¥é“ðŸ˜‚ï¼ŒæŽ¨æµ‹å¯èƒ½æ˜¯ç»Ÿè®¡çš„æ‰“å¼€çš„æ–‡ä»¶æ•°æˆ–è€…æ‰“å¼€çš„æ–‡ä»¶å¤§å°ã€‚ lsof å‘½ä»¤è¯¦è§£ ç®€ä»‹ lsof(list open files)æ˜¯ä¸€ä¸ªåˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶çš„å·¥å…·ã€‚ åœ¨linuxçŽ¯å¢ƒä¸‹ï¼Œä»»ä½•äº‹ç‰©éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿žæŽ¥å’Œç¡¬ä»¶ã€‚æ‰€ä»¥å¦‚ä¼ è¾“æŽ§åˆ¶åè®® (TCP) å’Œç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) å¥—æŽ¥å­—ç­‰ï¼Œç³»ç»Ÿåœ¨åŽå°éƒ½ä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ— è®ºè¿™ä¸ªæ–‡ä»¶çš„æœ¬è´¨å¦‚ä½•ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¸ºåº”ç”¨ç¨‹åºä¸ŽåŸºç¡€æ“ä½œç³»ç»Ÿä¹‹é—´çš„äº¤äº’æä¾›äº†é€šç”¨æŽ¥å£ã€‚å› ä¸ºåº”ç”¨ç¨‹åºæ‰“å¼€æ–‡ä»¶çš„æè¿°ç¬¦åˆ—è¡¨æä¾›äº†å¤§é‡å…³äºŽè¿™ä¸ªåº”ç”¨ç¨‹åºæœ¬èº«çš„ä¿¡æ¯ï¼Œå› æ­¤é€šè¿‡lsofå·¥å…·èƒ½å¤ŸæŸ¥çœ‹è¿™ä¸ªåˆ—è¡¨å¯¹ç³»ç»Ÿç›‘æµ‹ä»¥åŠæŽ’é”™å°†æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ è¾“å‡ºä¿¡æ¯è§£æž åœ¨ç»ˆç«¯ä¸‹è¾“å…¥lsofå³å¯æ˜¾ç¤ºç³»ç»Ÿæ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸º lsof éœ€è¦è®¿é—®æ ¸å¿ƒå†…å­˜å’Œå„ç§æ–‡ä»¶ï¼Œæ‰€ä»¥å¿…é¡»ä»¥ root ç”¨æˆ·çš„èº«ä»½è¿è¡Œå®ƒæ‰èƒ½å¤Ÿå……åˆ†åœ°å‘æŒ¥å…¶åŠŸèƒ½ã€‚ æ¯è¡Œæ˜¾ç¤ºä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œè‹¥ä¸æŒ‡å®šæ¡ä»¶é»˜è®¤å°†æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ã€‚lsofè¾“å‡ºå„åˆ—ä¿¡æ¯çš„æ„ä¹‰å¦‚ä¸‹ï¼š COMMANDï¼šè¿›ç¨‹çš„åç§°PIDï¼šè¿›ç¨‹æ ‡è¯†ç¬¦USERï¼šè¿›ç¨‹æ‰€æœ‰è€…FDï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«è¯¥æ–‡ä»¶ã€‚å¦‚cwdã€txtç­‰ TYPEï¼šæ–‡ä»¶ç±»åž‹ï¼Œå¦‚DIRã€REGç­‰DEVICEï¼šæŒ‡å®šç£ç›˜çš„åç§°SIZEï¼šæ–‡ä»¶çš„å¤§å°NODEï¼šç´¢å¼•èŠ‚ç‚¹ï¼ˆæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ ‡è¯†ï¼‰NAMEï¼šæ‰“å¼€æ–‡ä»¶çš„ç¡®åˆ‡åç§°FD åˆ—ä¸­çš„æ–‡ä»¶æè¿°ç¬¦cwd å€¼è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ï¼Œè¿™æ˜¯è¯¥åº”ç”¨ç¨‹åºå¯åŠ¨çš„ç›®å½•ï¼Œé™¤éžå®ƒæœ¬èº«å¯¹è¿™ä¸ªç›®å½•è¿›è¡Œæ›´æ”¹,txt ç±»åž‹çš„æ–‡ä»¶æ˜¯ç¨‹åºä»£ç ï¼Œå¦‚åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«æˆ–å…±äº«åº“ï¼Œå¦‚ä¸Šåˆ—è¡¨ä¸­æ˜¾ç¤ºçš„ /sbin/init ç¨‹åºã€‚å…¶æ¬¡æ•°å€¼è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™æ˜¯æ‰“å¼€è¯¥æ–‡ä»¶æ—¶è¿”å›žçš„ä¸€ä¸ªæ•´æ•°ã€‚å¦‚ä¸Šçš„æœ€åŽä¸€è¡Œæ–‡ä»¶/dev/initctlï¼Œå…¶æ–‡ä»¶æè¿°ç¬¦ä¸º 10ã€‚u è¡¨ç¤ºè¯¥æ–‡ä»¶è¢«æ‰“å¼€å¹¶å¤„äºŽè¯»å–/å†™å…¥æ¨¡å¼ï¼Œè€Œä¸æ˜¯åªè¯» Â® æˆ–åªå†™ (w) æ¨¡å¼ã€‚åŒæ—¶è¿˜æœ‰å¤§å†™ çš„W è¡¨ç¤ºè¯¥åº”ç”¨ç¨‹åºå…·æœ‰å¯¹æ•´ä¸ªæ–‡ä»¶çš„å†™é”ã€‚è¯¥æ–‡ä»¶æè¿°ç¬¦ç”¨äºŽç¡®ä¿æ¯æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªåº”ç”¨ç¨‹åºå®žä¾‹ã€‚åˆå§‹æ‰“å¼€æ¯ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œéƒ½å…·æœ‰ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä»Ž 0 åˆ° 2ï¼Œåˆ†åˆ«è¡¨ç¤ºæ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµã€‚æ‰€ä»¥å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ‰€æ‰“å¼€çš„æ–‡ä»¶çš„ FD éƒ½æ˜¯ä»Ž 3 å¼€å§‹ã€‚ä¸Ž FD åˆ—ç›¸æ¯”ï¼ŒType åˆ—åˆ™æ¯”è¾ƒç›´è§‚ã€‚æ–‡ä»¶å’Œç›®å½•åˆ†åˆ«ç§°ä¸º REG å’Œ DIRã€‚è€ŒCHR å’Œ BLKï¼Œåˆ†åˆ«è¡¨ç¤ºå­—ç¬¦å’Œå—è®¾å¤‡ï¼›æˆ–è€… UNIXã€FIFO å’Œ IPv4ï¼Œåˆ†åˆ«è¡¨ç¤º UNIX åŸŸå¥—æŽ¥å­—ã€å…ˆè¿›å…ˆå‡º (FIFO) é˜Ÿåˆ—å’Œç½‘é™…åè®® (IP) å¥—æŽ¥å­—ã€‚ è¯­æ³•æ ¼å¼ 1lsof ï¼»optionsï¼½ filename histolive.log æŽ¥ç€å†æ¥çœ‹30669_histolive.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—è®°å½•äº†æ¡ˆå‘æ—¶heapä¸­çš„æ‰€æœ‰å¯¹è±¡æƒ…å†µï¼ŒåŒ…æ‹¬å¯¹è±¡çš„æ•°é‡ã€æ‰€å ç©ºé—´å¤§å°ã€ç±»åã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š 1jmap -histo[:live] pid è¾“å‡ºè¯´æ˜Žï¼š instancesåˆ—ï¼šè¡¨ç¤ºå½“å‰ç±»æœ‰å¤šå°‘ä¸ªå®žä¾‹ã€‚bytesåˆ—ï¼šè¯´æ˜Žå½“å‰ç±»çš„å®žä¾‹æ€»å…±å ç”¨äº†å¤šå°‘ä¸ªå­—èŠ‚class nameåˆ—ï¼šè¡¨ç¤ºçš„å°±æ˜¯å½“å‰ç±»çš„åç§°ï¼Œclass name è§£è¯»ï¼šBä»£è¡¨byteCä»£è¡¨charDä»£è¡¨doubleFä»£è¡¨floatIä»£è¡¨intJä»£è¡¨longZä»£è¡¨booleanå‰è¾¹æœ‰[ä»£è¡¨æ•°ç»„ï¼Œ[I å°±ç›¸å½“äºŽint[]å¯¹è±¡ç”¨[L+ç±»åè¡¨ç¤º heap.log æŽ¥ç€å†æ¥çœ‹30669_heap.logçš„å†…å®¹ï¼Œå› å†…å®¹è¿‡é•¿ï¼Œæˆªå–ä¸»è¦å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šé¢çš„å†…å®¹ä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨å‘½ä»¤jmap -heap pid æ‰“å°jvmå†…å­˜æ•´ä½“ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥è§‚å¯Ÿåˆ°New Generationï¼ˆEden Spaceï¼ŒFrom Spaceï¼ŒTo Spaceï¼‰,tenured generation,Perm Generationçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä»Žå›¾ä¸­å†…å®¹å¯ä»¥çœ‹å‡ºæ–°ç”ŸåŒºå’Œè€å¹´åŒºçš„å†…å­˜ä½¿ç”¨çŽ‡å‡ ä¹Žè¾¾åˆ°äº†100%ï¼Œç”±æ­¤å¯ä»¥æŽ¨æ–­é€ æˆè¿™æ¬¡äº‹æ•…çš„åŽŸå› æ˜¯åˆ›å»ºçš„å¯¹è±¡è¿‡å¤šï¼Œå†ç»“åˆä¸Šé¢äº†è§£è¿‡çš„30669_histolive.logï¼Œå°±èƒ½æ‰¾åˆ°æ˜¯å“ªäº›å¯¹è±¡åˆ›å»ºè¿‡å¤šã€‚å†ç»“åˆåŽé¢è¦è®²çš„çº¿ç¨‹å †æ ˆä¿¡æ¯å®šä½åˆ°å…·ä½“è°ƒç”¨çš„ä»£ç æ®µã€‚ gc.logã€gccapacity.log æŽ¥ç€å†æ¥çœ‹30669_gc.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šå›¾å†…å®¹æ˜¯æ˜¾ç¤ºå †å†…å­˜çš„å„ä¸ªå æ¯”ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š 1jstat -gcutil &lt;pid&gt; çŽ°åœ¨è§£é‡Šä¸‹è¾“å‡ºå†…å®¹æ¯ä¸ªé¡¹çš„å«ä¹‰ï¼š S0 ðŸ‘‰ å¹¸å­˜1åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹S1 ðŸ‘‰ å¹¸å­˜2åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹E ðŸ‘‰ ä¼Šç”¸å›­åŒºä½¿ç”¨æ¯”ä¾‹O ðŸ‘‰ è€å¹´ä»£ä½¿ç”¨æ¯”ä¾‹M ðŸ‘‰ å…ƒæ•°æ®åŒºä½¿ç”¨æ¯”ä¾‹CCS ðŸ‘‰ åŽ‹ç¼©ä½¿ç”¨æ¯”ä¾‹YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGC ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGCT ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´GCT ðŸ‘‰ åžƒåœ¾å›žæ”¶æ¶ˆè€—æ€»æ—¶é—´ 30669_gccapacity.logçš„å†…å®¹å¦‚ä¸‹å›¾ï¼š è¾“å‡ºå„é¡¹å«ä¹‰å¦‚ä¸‹ï¼š NGCMN ðŸ‘‰ æ–°ç”Ÿä»£æœ€å°å®¹é‡NGCMX ðŸ‘‰ æ–°ç”Ÿä»£æœ€å¤§å®¹é‡NGC ðŸ‘‰ å½“å‰æ–°ç”Ÿä»£å®¹é‡S0C ðŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°S1C ðŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°EC ðŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°OGCMN ðŸ‘‰ è€å¹´ä»£æœ€å°å®¹é‡OGCMX ðŸ‘‰ è€å¹´ä»£æœ€å¤§å®¹é‡OGC ðŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°OC ðŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°MCMN ðŸ‘‰ æœ€å°å…ƒæ•°æ®å®¹é‡MCMX ðŸ‘‰ æœ€å¤§å…ƒæ•°æ®å®¹é‡MC ðŸ‘‰ å½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°CCSMN ðŸ‘‰ æœ€å°åŽ‹ç¼©ç±»ç©ºé—´å¤§å°CCSMX ðŸ‘‰ æœ€å¤§åŽ‹ç¼©ç±»ç©ºé—´å¤§å°CCSC ðŸ‘‰ å½“å‰åŽ‹ç¼©ç±»ç©ºé—´å¤§å°YGC ðŸ‘‰ å¹´è½»ä»£gcæ¬¡æ•°FGC ðŸ‘‰ è€å¹´ä»£GCæ¬¡æ•° jstat jstatæ˜¯JDKè‡ªå¸¦çš„ä¸€ä¸ªè½»é‡çº§å°å·¥å…·ã€‚å…¨ç§° Java Virtual Machine statistics monitoring toolï¼Œå®ƒä½äºŽjavaçš„binç›®å½•ä¸‹ï¼Œä¸»è¦åˆ©ç”¨JVMå†…å»ºçš„æŒ‡ä»¤å¯¹Javaåº”ç”¨ç¨‹åºçš„èµ„æºå’Œæ€§èƒ½è¿›è¡Œå®žæ—¶çš„å‘½ä»¤è¡Œçš„ç›‘æŽ§ï¼ŒåŒ…æ‹¬äº†å¯¹Heap sizeå’Œåžƒåœ¾å›žæ”¶çŠ¶å†µçš„ç›‘æŽ§ã€‚ è¯­æ³•æ ¼å¼ 1jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]] è¯­æ³•æ ¼å¼ä¸­çš„optionæ˜¯ã€Œå‘½ä»¤é€‰é¡¹ã€ï¼Œintervalæ˜¯ã€Œé—´éš”æ—¶é—´/æ¯«ç§’ã€ï¼Œcount æ˜¯ã€ŒæŸ¥è¯¢æ¬¡æ•°ã€ã€‚ jstatæ”¯æŒçš„optioné€šè¿‡jstat -optionè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢ä»¥jdk1.8ä¸ºä¾‹äº†è§£ä¸‹jstatå‘½ä»¤æŸ¥çœ‹jvmçš„GCæƒ…å†µã€‚ ç±»åŠ è½½ç»Ÿè®¡ Loaded ðŸ‘‰ åŠ è½½classçš„æ•°é‡Bytes ðŸ‘‰ æ‰€å ç”¨ç©ºé—´å¤§å°Unloaded ðŸ‘‰ æœªåŠ è½½æ•°é‡Bytes ðŸ‘‰ æœªåŠ è½½å ç”¨ç©ºé—´Time ðŸ‘‰ æ—¶é—´ ç¼–è¯‘ç»Ÿè®¡ Compiled ðŸ‘‰ ç¼–è¯‘æ•°é‡ã€‚Failed ðŸ‘‰ å¤±è´¥æ•°é‡Invalid ðŸ‘‰ ä¸å¯ç”¨æ•°é‡Time ðŸ‘‰ æ—¶é—´FailedType ðŸ‘‰ å¤±è´¥ç±»åž‹FailedMethod ðŸ‘‰ å¤±è´¥çš„æ–¹æ³• åžƒåœ¾å›žæ”¶ç»Ÿè®¡ S0C ðŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„å¤§å°S1C ðŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°S0U ðŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°S1U ðŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°EC ðŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°EU ðŸ‘‰ ä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°OC ðŸ‘‰ è€å¹´ä»£å¤§å°OU ðŸ‘‰ è€å¹´ä»£ä½¿ç”¨å¤§å°MC ðŸ‘‰ æ–¹æ³•åŒºå¤§å°MU ðŸ‘‰ æ–¹æ³•åŒºä½¿ç”¨å¤§å°CCSC ðŸ‘‰ åŽ‹ç¼©ç±»ç©ºé—´å¤§å°CCSU ðŸ‘‰ åŽ‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°YGCT ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´FGC ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGCT ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´GCT ðŸ‘‰ åžƒåœ¾å›žæ”¶æ¶ˆè€—æ€»æ—¶é—´ å †å†…å­˜ç»Ÿè®¡ è¾“å‡ºå„é¡¹æ„ä¹‰å‚è€ƒ30669_gccapacity.logã€‚ æ–°ç”Ÿä»£åžƒåœ¾å›žæ”¶ç»Ÿè®¡ S0C ðŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°S1C ðŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°S0U ðŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°S1U ðŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°TT ðŸ‘‰ å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°MTT ðŸ‘‰ å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°DSS ðŸ‘‰ æœŸæœ›çš„å¹¸å­˜åŒºå¤§å°EC ðŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°EU ðŸ‘‰ ä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°YGCT ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´ æ–°ç”Ÿä»£å†…å­˜ç»Ÿè®¡ NGCMN ðŸ‘‰ æ–°ç”Ÿä»£æœ€å°å®¹é‡NGCMX ðŸ‘‰ æ–°ç”Ÿä»£æœ€å¤§å®¹é‡NGC ðŸ‘‰ å½“å‰æ–°ç”Ÿä»£å®¹é‡S0CMX ðŸ‘‰ æœ€å¤§å¹¸å­˜1åŒºå¤§å°S0C ðŸ‘‰ å½“å‰å¹¸å­˜1åŒºå¤§å°S1CMX ðŸ‘‰ æœ€å¤§å¹¸å­˜2åŒºå¤§å°S1C ðŸ‘‰ å½“å‰å¹¸å­˜2åŒºå¤§å°ECMX ðŸ‘‰ æœ€å¤§ä¼Šç”¸å›­åŒºå¤§å°EC ðŸ‘‰ å½“å‰ä¼Šç”¸å›­åŒºå¤§å°YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGC ðŸ‘‰ è€å¹´ä»£å›žæ”¶æ¬¡æ•° è€å¹´ä»£åžƒåœ¾å›žæ”¶ç»Ÿè®¡ MC ðŸ‘‰ æ–¹æ³•åŒºå¤§å°MU ðŸ‘‰ æ–¹æ³•åŒºä½¿ç”¨å¤§å°CCSC ðŸ‘‰ åŽ‹ç¼©ç±»ç©ºé—´å¤§å°CCSU ðŸ‘‰ åŽ‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°OC ðŸ‘‰ è€å¹´ä»£å¤§å°OU ðŸ‘‰ è€å¹´ä»£ä½¿ç”¨å¤§å°YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGC ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGCT ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´GCT ðŸ‘‰ åžƒåœ¾å›žæ”¶æ¶ˆè€—æ€»æ—¶é—´ è€å¹´ä»£å†…å­˜ç»Ÿè®¡ OGCMN ðŸ‘‰ è€å¹´ä»£æœ€å°å®¹é‡OGCMX ðŸ‘‰ è€å¹´ä»£æœ€å¤§å®¹é‡OGC ðŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°OC ðŸ‘‰ è€å¹´ä»£å¤§å°YGC ðŸ‘‰ å¹´è½»ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGC ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¬¡æ•°FGCT ðŸ‘‰ è€å¹´ä»£åžƒåœ¾å›žæ”¶æ¶ˆè€—æ—¶é—´GCT ðŸ‘‰ åžƒåœ¾å›žæ”¶æ¶ˆè€—æ€»æ—¶é—´ å †å†…å­˜å æ¯” å‚è€ƒ30669_gc.logå†…å®¹åŠè§£æžã€‚ jvmç¼–è¯‘æ–¹æ³•ç»Ÿè®¡ Compiled ðŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„æ•°é‡Size ðŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„å­—èŠ‚ç æ•°é‡Type ðŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„ç¼–è¯‘ç±»åž‹ã€‚Method ðŸ‘‰ æ–¹æ³•åæ ‡è¯†ã€‚ stack.log æœ€åŽæ¥çœ‹ä¸‹30669_1_stack.logã€30669_2_stack.logå’Œ30669_3_stack.logçš„æ–‡ä»¶å†…å®¹ï¼Œå› å†…å®¹è¿‡é•¿ï¼Œæš‚å…ˆæˆªå–éƒ¨åˆ†å†…å®¹å±•ç¤ºï¼Œå¦‚ä¸‹å›¾ï¼š Thread Dump ç®€ä»‹ Thread Dumpæ˜¯éžå¸¸æœ‰ç”¨çš„è¯Šæ–­Javaåº”ç”¨é—®é¢˜çš„å·¥å…·ã€‚æ¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºéƒ½æœ‰åŠæ—¶ç”Ÿæˆæ‰€æœ‰çº¿ç¨‹åœ¨æŸä¸€ç‚¹çŠ¶æ€çš„thread-dumpçš„èƒ½åŠ›ï¼Œè™½ç„¶å„ä¸ª Javaè™šæ‹Ÿæœºæ‰“å°çš„thread dumpç•¥æœ‰ä¸åŒï¼Œä½†æ˜¯å¤§å¤šéƒ½æä¾›äº†å½“å‰æ´»åŠ¨çº¿ç¨‹çš„å¿«ç…§ï¼ŒåŠJVMä¸­æ‰€æœ‰Javaçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œå †æ ˆä¿¡æ¯ä¸€èˆ¬åŒ…å«å®Œæ•´çš„ç±»ååŠæ‰€æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¦‚æžœå¯èƒ½çš„è¯è¿˜æœ‰æºä»£ç çš„è¡Œæ•°ã€‚ åœ¨å®žé™…è¿è¡Œä¸­ï¼Œå¾€å¾€ä¸€æ¬¡ dumpçš„ä¿¡æ¯ï¼Œè¿˜ä¸è¶³ä»¥ç¡®è®¤é—®é¢˜ã€‚å»ºè®®äº§ç”Ÿä¸‰æ¬¡ dumpä¿¡æ¯ï¼ˆæ‰€ä»¥å°±åƒè¿™æ¬¡çš„æ¡ˆä¾‹ä¼šdumpä¸‰æ¬¡stack,æ¯æ¬¡é—´éš”3ç§’ï¼‰ï¼Œå¦‚æžœæ¯æ¬¡ dumpéƒ½æŒ‡å‘åŒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ‰ç¡®å®šé—®é¢˜çš„å…¸åž‹æ€§ã€‚ä¹Ÿå°±æ˜¯å¤šè¿›è¡Œå‡ æ¬¡çº¿ç¨‹å¿«ç…§ï¼Œè§‚å¯Ÿå˜åŒ–ï¼ŒæŸ¥çœ‹é—®é¢˜æ‰€åœ¨ã€‚ ç‰¹ç‚¹ èƒ½åœ¨å„ç§æ“ä½œç³»ç»Ÿä¸‹ä½¿ç”¨ èƒ½åœ¨å„ç§Javaåº”ç”¨æœåŠ¡å™¨ä¸‹ä½¿ç”¨ å¯ä»¥åœ¨ç”Ÿäº§çŽ¯å¢ƒä¸‹ä½¿ç”¨è€Œä¸å½±å“ç³»ç»Ÿçš„æ€§èƒ½ å¯ä»¥å°†é—®é¢˜ç›´æŽ¥å®šä½åˆ°åº”ç”¨ç¨‹åºçš„ä»£ç è¡Œä¸Š èƒ½è¯Šæ–­çš„é—®é¢˜ æŸ¥æ‰¾å†…å­˜æ³„éœ²ï¼Œå¸¸è§çš„æ˜¯ç¨‹åºé‡Œloadå¤§é‡çš„æ•°æ®åˆ°ç¼“å­˜ï¼› å‘çŽ°æ­»é”çº¿ç¨‹ï¼› å¦‚ä½•æŠ“å–Thread Dump JDKè‡ªå¸¦å‘½ä»¤è¡Œå·¥å…·èŽ·å–PIDï¼Œå†èŽ·å–ThreadDump: jps æˆ– ps â€“ef|grepjava (èŽ·å–PID) 2. jstack [-l ]&lt;pid&gt; | tee -a jstack.log (èŽ·å–ThreadDump) Thread Dumpç»“æž„ ä¸€ä¸ªå…¸åž‹çš„thread dumpæ–‡ä»¶ä¸»è¦ç”±ä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š ä¸Šå›¾å°†JVMä¸Šçš„çº¿ç¨‹å †æ ˆä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åšäº†è¯¦ç»†çš„æ‹†è§£ã€‚ ç¬¬ä¸€éƒ¨åˆ†ï¼šFull thread dump identifier è¿™ä¸€éƒ¨åˆ†æ˜¯å†…å®¹æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå±•ç¤ºäº†å¿«ç…§æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´å’ŒJVMçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ 122019-09-28 15:48:28Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.131-b11 mixed mode): ç¬¬äºŒéƒ¨åˆ†ï¼šJava EE middleware, third party &amp; custom application Threads è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé‡Œé¢å±•ç¤ºäº†JavaEEå®¹å™¨ï¼ˆå¦‚tomcatã€resinç­‰ï¼‰ã€è‡ªå·±çš„ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚è¿™ä¸€éƒ¨åˆ†è¯¦ç»†çš„å«ä¹‰åŽé¢å†ä»‹ç»ã€‚ 12345678&quot;Thread-3&quot; #26 daemon prio=9 os_prio=0 tid=0x00007f1ff40ae000 nid=0x77f5 waiting on condition [0x00007f1ff1bfa000] java.lang.Thread.State: WAITING (parking) at sun.misc.Unsafe.park(Native Method) - parking to wait for &lt;0x00000000c14fed38&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject) at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175) at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039) at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442) at org.LatencyUtils.PauseDetector$PauseDetectorThread.run(PauseDetector.java:85) Thread-3 çº¿ç¨‹åç§°ï¼Œå½“ä½¿ç”¨java.lang.Threadç±»ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå°†è¢«å‘½åä¸ºThre-(Number)ï¼Œè‹¥java.util.concurrent.ThreadFactoryç±»ï¼Œå°†ä¼šè¢«å‘½åä¸ºpool-(Number)-thread-(Number)daemon çº¿ç¨‹ç±»åž‹ï¼Œçº¿ç¨‹åˆ†ä¸ºå®ˆæŠ¤çº¿ç¨‹ (daemon) å’Œéžå®ˆæŠ¤çº¿ç¨‹ (non-daemon) ä¸¤ç§ï¼Œé€šå¸¸éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼›prio=9 çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¸º5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›os_prio=0 æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¼˜å…ˆçº§tid=0x00007f1ff40ae000 JVMçº¿ç¨‹çš„idï¼ŒJVMå†…éƒ¨çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ java.lang.Thread.getId()èŽ·å–ï¼Œé€šå¸¸ç”¨è‡ªå¢žçš„æ–¹å¼å®žçŽ°ï¼›nid=0x77f5 ç³»ç»Ÿçº¿ç¨‹idï¼Œå¯¹åº”çš„ç³»ç»Ÿçº¿ç¨‹idï¼ˆNative Thread ID)ï¼Œå¯ä»¥é€šè¿‡ top å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼Œæ˜¯åå…­è¿›åˆ¶çš„å½¢å¼ï¼›waiting on condition ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ç³»ç»Ÿçš„çº¿ç¨‹çŠ¶æ€ï¼Œå…·ä½“çš„å«ä¹‰è§ä¸‹é¢ ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ éƒ¨åˆ†ï¼›0x00007f1ff1bfa000 èµ·å§‹æ ˆåœ°å€ï¼Œçº¿ç¨‹å †æ ˆè°ƒç”¨çš„å…¶å®žå†…å­˜åœ°å€ï¼›java.lang.Thread.State: WAITING (parking) JVMçº¿ç¨‹çŠ¶æ€ï¼Œè¿™é‡Œæ ‡æ˜Žäº†çº¿ç¨‹åœ¨ä»£ç çº§åˆ«çš„çŠ¶æ€ï¼Œè¯¦ç»†çš„å†…å®¹è§ä¸‹é¢çš„ JVMçº¿ç¨‹è¿è¡ŒçŠ¶æ€ éƒ¨åˆ†ã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šHotSpot VM Thread è¿™ä¸€éƒ¨åˆ†å±•ç¤ºäº†JVMå†…éƒ¨çº¿ç¨‹çš„ä¿¡æ¯ï¼Œç”¨äºŽæ‰§è¡Œå†…éƒ¨çš„åŽŸç”Ÿæ“ä½œã€‚ä¸‹é¢å¸¸è§çš„å‡ ç§å†…ç½®çº¿ç¨‹ï¼š Attach Listener è¯¥çº¿ç¨‹è´Ÿè´£æŽ¥æ”¶å¤–éƒ¨å‘½ä»¤ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤å¹¶æŠŠç»“æžœè¿”å›žç»™è°ƒç”¨è€…ï¼Œæ­¤ç§ç±»åž‹çš„çº¿ç¨‹é€šå¸¸åœ¨æ¡Œé¢ç¨‹åºä¸­å‡ºçŽ°ã€‚ 12&quot;Attach Listener&quot; #62 daemon prio=9 os_prio=0 tid=0x00007f2014008800 nid=0x7868 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE DestroyJavaVM æ‰§è¡Œmain()çš„çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä¹‹åŽè°ƒç”¨JNIä¸­çš„ jni_DestroyJavaVM() æ–¹æ³•ä¼šå”¤èµ·DestroyJavaVM çº¿ç¨‹ã€‚åœ¨JBosså¯åŠ¨ä¹‹åŽï¼Œä¹Ÿä¼šå”¤èµ·DestroyJavaVMçº¿ç¨‹ï¼Œå¤„äºŽç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjavaçº¿ç¨‹å’Œnativeçº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½JVMã€‚ 12&quot;DestroyJavaVM&quot; #83 prio=5 os_prio=0 tid=0x00007f203c009000 nid=0x77cf waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE Service Thread ç”¨äºŽå¯åŠ¨æœåŠ¡çš„çº¿ç¨‹ã€‚ 123456789101112&quot;Service Thread&quot; #7 daemon prio=9 os_prio=0 tid=0x00007f203c152800 nid=0x77d9 runnable [0x00007f2025ffd000] java.lang.Thread.State: RUNNABLE at java.lang.Class.getDeclaredFields0(Native Method) at java.lang.Class.privateGetDeclaredFields(Class.java:2583) at java.lang.Class.getDeclaredField(Class.java:2068) at sun.management.GarbageCollectionNotifInfoCompositeData$1.run(GarbageCollectionNotifInfoCompositeData.java:69) at sun.management.GarbageCollectionNotifInfoCompositeData$1.run(GarbageCollectionNotifInfoCompositeData.java:65) at java.security.AccessController.doPrivileged(Native Method) at sun.management.GarbageCollectionNotifInfoCompositeData.getCompositeTypeByBuilder(GarbageCollectionNotifInfoCompositeData.java:65) at sun.management.GarbageCollectionNotifInfoCompositeData.getCompositeData(GarbageCollectionNotifInfoCompositeData.java:116) at sun.management.GarbageCollectionNotifInfoCompositeData.toCompositeData(GarbageCollectionNotifInfoCompositeData.java:61) at sun.management.GarbageCollectorImpl.createGCNotification(GarbageCollectorImpl.java:141) CompilerThread ç”¨æ¥è°ƒç”¨JITingï¼Œå®žæ—¶ç¼–è¯‘è£…å¸CLASSã€‚é€šå¸¸JVMä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åŽé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œæ¯”å¦‚CompilerThread1ã€‚ 12345&quot;C1 CompilerThread1&quot; #6 daemon prio=9 os_prio=0 tid=0x00007f203c13d800 nid=0x77d8 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE&quot;C2 CompilerThread0&quot; #5 daemon prio=9 os_prio=0 tid=0x00007f203c13a800 nid=0x77d7 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE Signal Dispatcher Attach Listenerçº¿ç¨‹çš„èŒè´£æ˜¯æŽ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤ï¼Œå½“å‘½ä»¤æŽ¥æ”¶æˆåŠŸåŽï¼Œä¼šäº¤ç»™signal dispather çº¿ç¨‹åŽ»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›žå¤„ç†ç»“æžœã€‚ signal dispatherçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æŽ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚ 12&quot;Signal Dispatcher&quot; #4 daemon prio=9 os_prio=0 tid=0x00007f203c139000 nid=0x77d6 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE Finalizer è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨mainçº¿ç¨‹ä¹‹åŽåˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º10ï¼Œä¸»è¦ç”¨äºŽåœ¨åžƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼›å…³äºŽFinalizerçº¿ç¨‹çš„å‡ ç‚¹ï¼š ï¼ˆ1ï¼‰åªæœ‰å½“å¼€å§‹ä¸€è½®åžƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼› ï¼ˆ2ï¼‰è¯¥çº¿ç¨‹ä¹Ÿæ˜¯daemonçº¿ç¨‹ï¼Œå› æ­¤å¦‚æžœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–éždaemonçº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œfinalize()æ–¹æ³•ï¼ŒJVMä¹Ÿä¼šé€€å‡ºï¼› ï¼ˆ3ï¼‰JVMåœ¨åžƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±åŽ»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆFinalizerå¯¹è±¡ï¼ˆReferenceçš„å®žçŽ°ï¼‰ï¼Œå¹¶æ”¾å…¥ReferenceQueueï¼Œç”±Finalizerçº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åŽå°†è¯¥Finalizerå¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullï¼Œç”±åžƒåœ¾æ”¶é›†å™¨æ¥å›žæ”¶ï¼› ï¼ˆ4ï¼‰JVMä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œfinalize()æ–¹æ³•å‘¢ï¼Ÿ å¦‚æžœJVMçš„åžƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºŽåœ¨finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´GCçº¿ç¨‹åœæ­¢æˆ–ä¸å¯æŽ§ï¼Œè¿™å¯¹GCçº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ã€‚ 1234567&quot;Finalizer&quot; #3 daemon prio=8 os_prio=0 tid=0x00007f203c106000 nid=0x77d5 in Object.wait() [0x00007f202c41b000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143) - locked &lt;0x00000000c022a288&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164) at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209) Reference Handler JVMåœ¨åˆ›å»ºmainçº¿ç¨‹åŽå°±åˆ›å»ºReference Handlerçº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º10ï¼Œå®ƒä¸»è¦ç”¨äºŽå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åžƒåœ¾å›žæ”¶é—®é¢˜ ã€‚ 1234567&quot;Reference Handler&quot; #2 daemon prio=10 os_prio=0 tid=0x00007f203c101800 nid=0x77d4 in Object.wait() [0x00007f202c51c000] java.lang.Thread.State: BLOCKED (on object monitor) at java.lang.Object.wait(Native Method) at java.lang.Object.wait(Object.java:502) at java.lang.ref.Reference.tryHandlePending(Reference.java:191) - locked &lt;0x00000000c00e5800&gt; (a java.lang.ref.Reference$Lock) at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153) VM Thread JVMä¸­çº¿ç¨‹çš„æ¯ä½“ï¼Œæ ¹æ®HotSpotæºç ä¸­å…³äºŽvmThread.hppé‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŽŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¾‹çš„VMçº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº›VMæ“ä½œï¼ˆå¦‚æ¸…æ‰«åžƒåœ¾ç­‰ï¼‰ã€‚ åœ¨ VM Thread çš„ç»“æž„ä½“é‡Œæœ‰ä¸€ä¸ªVMOperationQueueåˆ—é˜Ÿï¼Œæ‰€æœ‰çš„VMçº¿ç¨‹æ“ä½œ(vm_operation)éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThread æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„loopå‡½æ•°(å…·ä½“å¯ä»¥å‚è€ƒï¼šVMThread.cppé‡Œé¢çš„void VMThread::loop()) ï¼Œè¯¥loopå‡½æ•°ä»ŽVMOperationQueueåˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡(VM_Operation)ï¼Œå¹¶ä¸”è°ƒç”¨VM_Operation-&gt;evaluateå‡½æ•°åŽ»æ‰§è¡Œè¯¥æ“ä½œç±»åž‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚ VMæ“ä½œç±»åž‹è¢«å®šä¹‰åœ¨vm_operations.hppæ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€ThreadDumpã€PrintThreadsã€GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦.. æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è‡ªå·±åŽ»æŸ¥çœ‹æºæ–‡ä»¶ã€‚ 1&quot;VM Thread&quot; os_prio=0 tid=0x00007f203c0fa000 nid=0x77d3 runnable ç¬¬å››éƒ¨åˆ†ï¼šHotSpot GC Thread VMä¸­ç”¨äºŽè¿›è¡Œèµ„æºå›žæ”¶çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»åž‹çš„çº¿ç¨‹ï¼š VM Periodic Task Thread è¯¥çº¿ç¨‹æ˜¯JVMå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”±WatcherThreadåˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¯¥çº¿ç¨‹åœ¨JVMå†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æŽ§ã€JVMè¿è¡ŒçŠ¶å†µç›‘æŽ§ã€‚ 1&quot;VM Periodic Task Thread&quot; os_prio=0 tid=0x00007f203c155800 nid=0x77da waiting on condition å¯ä»¥ä½¿ç”¨jstat å‘½ä»¤æŸ¥çœ‹GCçš„æƒ…å†µï¼Œæ¯”å¦‚æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ jstat -gcutil &lt;pid&gt; 250 7 å‚æ•°ä¸­pidæ˜¯è¿›ç¨‹idï¼ŒåŽé¢çš„250å’Œ7è¡¨ç¤ºæ¯250æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œæ€»å…±æ‰“å°7æ¬¡ã€‚ è¿™å¯¹äºŽé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æŽ¥ä½¿ç”¨nativeåº“æˆ–è€…ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æŽ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éžå¸¸å¤§çš„å¸®åŠ©ã€‚ GC task thread#0 (ParallelGC) åžƒåœ¾å›žæ”¶çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šè´Ÿè´£è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚é€šå¸¸JVMä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªå·¥ä½œï¼Œçº¿ç¨‹åç§°ä¸­#åŽé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ã€‚ 123&quot;GC task thread#0 (ParallelGC)&quot; os_prio=0 tid=0x00007f203c01e000 nid=0x77d1 runnable &quot;GC task thread#1 (ParallelGC)&quot; os_prio=0 tid=0x00007f203c020000 nid=0x77d2 runnable Gang worker#0 (Parallel GC Threads) å¦‚æžœåœ¨JVMä¸­å¢žåŠ äº† -XX:+UseConcMarkSweepGC å‚æ•°å°†ä¼šå¯ç”¨CMS ï¼ˆConcurrent Mark-Sweepï¼‰GC Threadæ–¹å¼ï¼ŒåŽŸæ¥åžƒåœ¾å›žæ”¶çº¿ç¨‹GC task thread#0 (ParallelGC) è¢«æ›¿æ¢ä¸º Gang worker#0 (Parallel GC Threads)ã€‚Gang worker æ˜¯JVMç”¨äºŽå¹´è½»ä»£åžƒåœ¾å›žæ”¶(minor gc)çš„çº¿ç¨‹ã€‚ 123&quot;Gang worker#0 (Parallel GC Threads)&quot; prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable &quot;Gang worker#1 (Parallel GC Threads)&quot; prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable Concurrent Mark-Sweep GC Thread å¹¶å‘æ ‡è®°æ¸…é™¤åžƒåœ¾å›žæ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„CMS GCï¼‰çº¿ç¨‹ï¼Œ è¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºŽå¹´è€ä»£åžƒåœ¾å›žæ”¶ã€‚ 1&quot;Concurrent Mark-Sweep GC Thread&quot; prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable Surrogate Locker Thread (Concurrent GC) æ­¤çº¿ç¨‹ä¸»è¦é…åˆCMSåžƒåœ¾å›žæ”¶å™¨æ¥ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å¤„ç†GCè¿‡ç¨‹ä¸­Javaå±‚çš„Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸Žjvm å†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚ 12&quot;Surrogate Locker Thread (Concurrent GC)&quot; daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE è¿™é‡Œä»¥ WeakHashMap ä¸ºä¾‹è¿›è¡Œè¯´æ˜Žï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼š WeakHashMapå’ŒHashMapä¸€æ ·ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªEntry[]æ•°ç»„; WeakHashMapçš„Entryæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æž„ä¸ºEntry-&gt;WeakReference-&gt;Reference; Reference é‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºpending_lockï¼Œæ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ï¼› Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingï¼› Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandlerçš„çº¿ç¨‹ï¼Œå®ƒåœ¨staticå—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®ŒæˆåŽå¤„äºŽwaitçŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ªLockåŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ï¼› WeakHashMapé‡Œé¢è¿˜å®žä¾‹åŒ–äº†ä¸€ä¸ªReferenceQueueé˜Ÿåˆ—ï¼› å‡è®¾ï¼ŒWeakHashMapå¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ï¼ŒJVM åœ¨è¿›è¡ŒCMS GCçš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªConcurrentMarkSweepThreadï¼ˆç®€ç§°CMSTï¼‰çº¿ç¨‹åŽ»è¿›è¡ŒGCã€‚ConcurrentMarkSweepThreadçº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªSurrogateLockerThreadï¼ˆç®€ç§°SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLTå¯åŠ¨ä¹‹åŽï¼Œå¤„äºŽç­‰å¾…é˜¶æ®µã€‚ CMSTå¼€å§‹GCæ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™SLTè®©å®ƒåŽ»èŽ·å–Javaå±‚Referenceå¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ç›´åˆ°CMS GCå®Œæ¯•ä¹‹åŽï¼ŒJVM ä¼šå°†WeakHashMapä¸­æ‰€æœ‰è¢«å›žæ”¶çš„å¯¹è±¡æ‰€å±žçš„WeakReferenceå®¹å™¨å¯¹è±¡æ”¾å…¥åˆ°Reference çš„pendingå±žæ€§å½“ä¸­ï¼ˆæ¯æ¬¡GCå®Œæ¯•ä¹‹åŽï¼Œpendingå±žæ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸ºnulläº†ï¼‰ï¼Œç„¶åŽé€šçŸ¥SLTé‡Šæ”¾å¹¶ä¸”notifyå…¨å±€é”:Lockã€‚æ­¤æ—¶æ¿€æ´»äº†ReferenceHandlerçº¿ç¨‹çš„runæ–¹æ³•ï¼Œä½¿å…¶è„±ç¦»waitçŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚ ReferenceHandlerè¿™ä¸ªçº¿ç¨‹ä¼šå°†pendingä¸­çš„æ‰€æœ‰WeakReferenceå¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ªWeakReferenceå±žäºŽæŸä¸ªWeakHashMapå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ReferenceQueueåˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æž„ï¼‰ã€‚ å½“æˆ‘ä»¬ä¸‹æ¬¡ä»ŽWeakHashMapå¯¹è±¡é‡Œé¢getã€putæ•°æ®æˆ–è€…è°ƒç”¨sizeæ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMapå°±ä¼šå°†ReferenceQueueåˆ—é˜Ÿä¸­çš„WeakReferenceä¾ä¾pollå‡ºæ¥åŽ»å’ŒEntry[]æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æžœå‘çŽ°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜Žè¿™ä¸ªEntryæ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢«GCæŽ‰äº†ï¼Œé‚£ä¹ˆå°†Entry[]å†…çš„Entryå¯¹è±¡å‰”é™¤æŽ‰ã€‚ ç¬¬äº”éƒ¨åˆ†ï¼šJNI global references count è¿™ä¸€éƒ¨åˆ†ä¸»è¦å›žæ”¶é‚£äº›åœ¨nativeä»£ç ä¸Šè¢«å¼•ç”¨ï¼Œä½†åœ¨javaä»£ç ä¸­å´æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨ï¼Œå¯¹äºŽé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æŽ¥ä½¿ç”¨nativeåº“æˆ–ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æŽ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éžå¸¸å¤§çš„å¸®åŠ©ã€‚ 1JNI global references: 1652 ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ &lt;span id=&quot;jumpOne&quot;&gt;&lt;/span&gt; ç³»ç»Ÿçº¿ç¨‹æœ‰å¦‚ä¸‹çŠ¶æ€ï¼š deadlock(é‡ç‚¹å…³æ³¨) æ­»é”çº¿ç¨‹ï¼Œä¸€èˆ¬æŒ‡å¤šä¸ªçº¿ç¨‹è°ƒç”¨æœŸé—´è¿›å…¥äº†ç›¸äº’èµ„æºå ç”¨ï¼Œå¯¼è‡´ä¸€ç›´ç­‰å¾…æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚ runnable ä¸€èˆ¬æŒ‡è¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒçŠ¶æ€ä¸­ï¼Œè¯¥çº¿ç¨‹å ç”¨äº†èµ„æºï¼Œæ­£åœ¨å¤„ç†æŸä¸ªæ“ä½œï¼Œå¦‚é€šè¿‡SQLè¯­å¥æŸ¥è¯¢æ•°æ®åº“ã€å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥ç­‰ã€‚ blocked(é‡ç‚¹å…³æ³¨) çº¿ç¨‹æ­£å¤„äºŽé˜»å¡žçŠ¶æ€ï¼ŒæŒ‡å½“å‰çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€éœ€è¦çš„èµ„æºé•¿æ—¶é—´ç­‰å¾…å´ä¸€ç›´æœªèƒ½èŽ·å–åˆ°ï¼Œè¢«å®¹å™¨çš„çº¿ç¨‹ç®¡ç†å™¨æ ‡è¯†ä¸ºé˜»å¡žçŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºç­‰å¾…èµ„æºè¶…æ—¶çš„çº¿ç¨‹ã€‚ waiting on condition(é‡ç‚¹å…³æ³¨) çº¿ç¨‹æ­£å¤„äºŽç­‰å¾…èµ„æºæˆ–ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œå…·ä½“çš„åŽŸå› éœ€è¦ç»“åˆå †æ ˆä¿¡æ¯è¿›è¡Œåˆ†æžã€‚ å¦‚æžœå †æ ˆä¿¡æ¯æ˜Žç¡®æ˜¯åº”ç”¨ä»£ç ï¼Œåˆ™è¯æ˜Žè¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…èµ„æºï¼Œä¸€èˆ¬æ˜¯å¤§é‡è¯»å–æŸç§èµ„æºä¸”è¯¥èµ„æºé‡‡ç”¨äº†èµ„æºé”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…èµ„æºçš„è¯»å–ï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç­‰ã€‚ å¦‚æžœå‘çŽ°æœ‰å¤§é‡çš„çº¿ç¨‹éƒ½æ­£å¤„äºŽè¿™ç§çŠ¶æ€ï¼Œå¹¶ä¸”å †æ ˆä¿¡æ¯ä¸­å¾—çŸ¥æ­£ç­‰å¾…ç½‘ç»œè¯»å†™ï¼Œè¿™æ˜¯å› ä¸ºç½‘ç»œé˜»å¡žå¯¼è‡´çº¿ç¨‹æ— æ³•æ‰§è¡Œï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç“¶é¢ˆçš„å¾å…†ï¼š ç½‘ç»œéžå¸¸ç¹å¿™ï¼Œå‡ ä¹Žæ¶ˆè€—äº†æ‰€æœ‰çš„å¸¦å®½ï¼Œä»ç„¶æœ‰å¤§é‡æ•°æ®ç­‰å¾…ç½‘ç»œè¯»å†™ï¼› ç½‘ç»œå¯èƒ½æ˜¯ç©ºé—²çš„ï¼Œä½†ç”±äºŽè·¯ç”±æˆ–é˜²ç«å¢™ç­‰åŽŸå› ï¼Œå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸åˆ°è¾¾ï¼› æ‰€ä»¥ä¸€å®šè¦ç»“åˆç³»ç»Ÿçš„ä¸€äº›æ€§èƒ½è§‚å¯Ÿå·¥å…·è¿›è¡Œç»¼åˆåˆ†æžï¼Œæ¯”å¦‚netstatç»Ÿè®¡å•ä½æ—¶é—´çš„å‘é€åŒ…çš„æ•°é‡ï¼Œçœ‹æ˜¯å¦å¾ˆæ˜Žæ˜¾è¶…è¿‡äº†æ‰€åœ¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶ï¼›è§‚å¯ŸCPUçš„åˆ©ç”¨çŽ‡ï¼Œçœ‹ç³»ç»Ÿæ€çš„CPUæ—¶é—´æ˜¯å¦æ˜Žæ˜¾å¤§äºŽç”¨æˆ·æ€çš„CPUæ—¶é—´ã€‚è¿™äº›éƒ½æŒ‡å‘ç”±äºŽç½‘ç»œå¸¦å®½æ‰€é™å¯¼è‡´çš„ç½‘ç»œç“¶é¢ˆã€‚ è¿˜æœ‰ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯è¯¥çº¿ç¨‹åœ¨ sleepï¼Œç­‰å¾… sleep çš„æ—¶é—´åˆ°äº†ï¼Œå°†è¢«å”¤é†’ã€‚ waiting for monitor entry æˆ– in Object.wait() Monitor æ˜¯Javaä¸­ç”¨ä»¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸Žåä½œçš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯å¯¹è±¡æˆ–è€…classçš„é”ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ï¼Œä¹Ÿä»…æœ‰ä¸€ä¸ª Monitorã€‚ è°ƒç”¨ä¿®é¥°ï¼š locked &lt;åœ°å€&gt; ç›®æ ‡ï¼šæ³¨æ„ä¸´ç•ŒåŒºå¯¹è±¡é”å¯é‡å…¥ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºRUNNABLE; waitting to lock &lt;åœ°å€&gt; ç›®æ ‡ï¼šè¿˜æ²¡æœ‰èŽ·å¾—é”ï¼Œè¿›å…¥åŒºç­‰å¾…ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºBLOCKED; waitting on &lt;åœ°å€&gt; ç›®æ ‡ï¼šèŽ·å¾—é”äº†ï¼Œç­‰å¾…åŒºç­‰å¾…ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºWAITTING,TIMED_WAITTING; parking to wait for &lt;åœ°å€&gt; ç›®æ ‡ï¼šçº¿ç¨‹åŽŸè¯­ï¼ŒéšcurrentåŒ…å‡ºçŽ°ï¼Œä¸Žsynchronizedä½“ç³»ä¸åŒ; ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªMonitoråœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ Active Threadï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯ Waiting Threadï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªé˜Ÿåˆ— Entry Setå’ŒWait Seté‡Œé¢ç­‰å¾…ã€‚ å…¶ä¸­åœ¨ Entry Set ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ waiting for monitor entryï¼Œåœ¨ Wait Set ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ in Object.wait()ã€‚ Entry Seté‡Œé¢çš„çº¿ç¨‹ã€‚ æŠŠè¢« synchronized ä¿æŠ¤èµ·æ¥çš„ä»£ç æ®µä¸ºä¸´ç•ŒåŒºï¼Œä»£ç å¦‚ä¸‹ï¼š 123synchronized(obj) &#123;&#125; å½“ä¸€ä¸ªçº¿ç¨‹ç”³è¯·è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒå°±è¿›å…¥äº† Entry Set é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š è¯¥Monitorä¸è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼ŒEntry Seté‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹ã€‚æœ¬çº¿ç¨‹å³æˆä¸ºç›¸åº”ç±»æˆ–è€…å¯¹è±¡çš„Monitorçš„Ownerï¼Œæ‰§è¡Œä¸´ç•ŒåŒºé‡Œé¢çš„ä»£ç ï¼›æ­¤æ—¶åœ¨Thread Dumpä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äºŽ Runnable çŠ¶æ€ã€‚ è¯¥Monitorè¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæœ¬çº¿ç¨‹åœ¨ Entry Set é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚æ­¤æ—¶åœ¨Thread Dumpä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äºŽ waiting for monity entry çŠ¶æ€ã€‚ ä¸´ç•ŒåŒºçš„è®¾ç½®æ˜¯ä¸ºäº†ä¿è¯å…¶å†…éƒ¨çš„ä»£ç æ‰§è¡Œçš„åŽŸå­æ€§å’Œå®Œæ•´æ€§ï¼Œä½†å› ä¸ºä¸´ç•ŒåŒºåœ¨ä»»ä½•æ—¶é—´åªå…è®¸çº¿ç¨‹ä¸²è¡Œé€šè¿‡ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹çš„åˆè¡·æ˜¯ç›¸åçš„ã€‚å¦‚æžœåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¤§é‡ä½¿ç”¨synchronizedï¼Œæˆ–è€…ä¸é€‚å½“çš„ä½¿ç”¨å®ƒï¼Œä¼šé€ æˆå¤§é‡çº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„å…¥å£ç­‰å¾…ï¼Œé€ æˆç³»ç»Ÿçš„æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å¦‚æžœåœ¨Thread Dumpä¸­å‘çŽ°è¿™ä¸ªæƒ…å†µï¼Œåº”è¯¥å®¡è§†æºç å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚ Wait Seté‡Œé¢çš„çº¿ç¨‹ å½“çº¿ç¨‹èŽ·å¾—äº†Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åŽï¼Œå¦‚æžœå‘çŽ°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯è¢«synchronizedçš„å¯¹è±¡ï¼‰çš„wait()æ–¹æ³•ï¼Œæ”¾å¼ƒMonitorï¼Œè¿›å…¥ Wait Seté˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify()æˆ–è€…notifyAll()æ–¹æ³•ï¼ŒWait Seté˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šåŽ»ç«žäº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—å¯¹è±¡çš„Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚Wait Setä¸­çš„çº¿ç¨‹åœ¨Thread Dumpä¸­æ˜¾ç¤ºçš„çŠ¶æ€ä¸º in Object.wait()ã€‚ æ€»ç»“ é€šå¸¸æ¥è¯´ï¼Œå½“CPUå¾ˆå¿™çš„æ—¶å€™å…³æ³¨ Runnable çŠ¶æ€çš„çº¿ç¨‹ï¼Œåä¹‹åˆ™å…³æ³¨ waiting for monitor entry çŠ¶æ€çš„çº¿ç¨‹ã€‚ JVMçº¿ç¨‹è¿è¡ŒçŠ¶æ€ &lt;span id=&quot;jumpTwo&quot;&gt;&lt;/span&gt; çº¿ç¨‹åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼ŒçŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ã€‚çº¿ç¨‹ä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š æ–°å»ºçŠ¶æ€(New)ï¼šçº¿ç¨‹åˆšåˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•ï¼Œjstackå‘½ä»¤ä¸ä¼šåˆ—å‡ºå¤„äºŽæ­¤çŠ¶æ€çš„çº¿ç¨‹ä¿¡æ¯ã€‚ å°±ç»ªçŠ¶æ€(Runnable)ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåŽï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºŽâ€œå¯è¿è¡Œçº¿ç¨‹æ± â€ä¸­ï¼Œå˜å¾—å¯è¿è¡Œï¼Œåªç­‰å¾…èŽ·å–CPUçš„ä½¿ç”¨æƒã€‚å³åœ¨å°±ç»ªçŠ¶æ€çš„è¿›ç¨‹é™¤CPUä¹‹å¤–ï¼Œå…¶å®ƒçš„è¿è¡Œæ‰€éœ€èµ„æºéƒ½å·²å…¨éƒ¨èŽ·å¾—ã€‚ è¿è¡ŒçŠ¶æ€(Running)ï¼šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹èŽ·å–äº†CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚ é˜»å¡žçŠ¶æ€(Blocked)ï¼šé˜»å¡žçŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŽŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚ WAITING (on object monitor) ç­‰å¾…é˜»å¡žï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾å ç”¨çš„æ‰€æœ‰èµ„æºï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œç­‰å¾…æ± â€ä¸­ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åŽï¼Œæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„ï¼Œå¿…é¡»ä¾é å…¶ä»–çº¿ç¨‹è°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ï¼Œ BLOCKED (on object monitor) åŒæ­¥é˜»å¡žï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨èŽ·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œé”æ± â€ä¸­ã€‚ TIMED_WAITING(sleeping) å…¶ä»–é˜»å¡žï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œsleep()æˆ–join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡žçŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ æ­»äº¡çŠ¶æ€(Dead)ï¼šçº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚ å®žé™…ä¸Šjvmçº¿ç¨‹æ ˆä¸­ï¼Œå‡ ä¹Žæ˜¯ä¸ä¼šå‡ºçŽ°NEW,RUNNING,DEAD è¿™äº›çŠ¶æ€ï¼Œå…¶ä¸­Runnableå°±ç®—æ˜¯æ­£åœ¨è¿è¡Œäº†ã€‚ å¤„äºŽWAITING, BLOCKED, TIMED_WAITINGçš„æ˜¯ä¸æ¶ˆè€—CPUçš„ã€‚ å¤„äºŽRunnableçŠ¶æ€çš„çº¿ç¨‹ï¼Œæ˜¯å¦æ¶ˆè€—cpuè¦çœ‹å…·ä½“çš„ä¸Šä¸‹æ–‡æƒ…å†µï¼š å¦‚æžœæ˜¯çº¯Javaè¿ç®—ä»£ç ï¼Œ åˆ™æ¶ˆè€—CPUï¼› å¦‚æžœæ˜¯ç½‘ç»œIO,å¾ˆå°‘æ¶ˆè€—CPU,è¿™ç‚¹åœ¨åˆ†å¸ƒå¼ç¨‹åºä¸­ç»å¸¸ç¢°åˆ° ï¼› å¦‚æžœæ˜¯æœ¬åœ°ä»£ç ï¼Œç»“åˆæœ¬åœ°ä»£ç çš„æ€§è´¨åˆ¤æ–­(å¯ä»¥é€šè¿‡pstack/gstackèŽ·å–æœ¬åœ°çº¿ç¨‹å †æ ˆ) å¦‚æžœæ˜¯çº¯è¿ç®—ä»£ç ï¼Œåˆ™æ¶ˆè€—CPUï¼› å¦‚æžœè¢«æŒ‚èµ·ï¼Œåˆ™ä¸æ¶ˆè€—CPUï¼› å¦‚æžœæ˜¯IO,åˆ™ä¸æ€Žä¹ˆæ¶ˆè€—CPUï¼›]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ZookeeperçŸ¥è¯†ç‚¹]]></title>
    <url>%2Fposts%2Ff9f2d4de.html</url>
    <content type="text"><![CDATA[ç®€ä»‹ ZooKeeperæ˜¯ä¸€ä¸ªå…¸åž‹çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäºŽå®ƒå®žçŽ°è¯¸å¦‚ æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚ZooKeeperå¯ä»¥ä¿è¯å¦‚ä¸‹åˆ†å¸ƒå¼ä¸€è‡´æ€§ç‰¹æ€§ï¼š é¡ºåºä¸€è‡´æ€§ï¼šä»ŽåŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼æŒ‰ç…§å…¶å‘èµ·é¡ºåºè¢«åº”ç”¨åˆ°ZooKeeperä¸­ã€‚ åŽŸå­æ€§ï¼šæ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„ç»“æžœåœ¨é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆæ•´ä¸ªé›†ç¾¤éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ï¼Œä¸€å®šä¸ä¼šå‡ºçŽ°é›†ç¾¤ä¸­éƒ¨åˆ†æœºå™¨åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†æ²¡æœ‰åº”ç”¨çš„æƒ…å†µã€‚ å•ä¸€è§†å›¾ï¼šæ— è®ºå®¢æˆ·ç«¯è¿žæŽ¥çš„æ˜¯å“ªä¸ªZooKeeperæœåŠ¡å™¨ï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡åž‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ å¯é æ€§ï¼šä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåœ°åº”ç”¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡æ‰€å¼•èµ·çš„æœåŠ¡ç«¯çŠ¶æ€å˜æ›´å°†ä¼šè¢«ä¸€ç›´ä¿ç•™ä¸‹æ¥ï¼Œé™¤éžæœ‰å¦ä¸€ä¸ªäº‹åŠ¡åˆå¯¹å…¶è¿›è¡Œäº†å˜æ›´ã€‚ å®žæ—¶æ€§ï¼šé€šå¸¸äººä»¬çœ‹åˆ°å®žæ—¶æ€§çš„ç¬¬ä¸€ååº”æ˜¯ï¼Œä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸåº”ç”¨ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯èƒ½å¤Ÿç«‹å³ä»ŽæœåŠ¡ç«¯ä¸Šè¯»å–åˆ°è¿™ä¸ªäº‹åŠ¡å˜æ›´åŽçš„æœ€æ–°æ•°æ®çŠ¶æ€ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒZooKeeperä»…ä»…ä¿è¯åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå®¢æˆ·ç«¯æœ€ç»ˆä¸€å®šèƒ½å¤Ÿä»ŽæœåŠ¡ç«¯ä¸Šè¯»å–åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ Zookeeperè§’è‰² åœ¨ZooKeeperä¸­ï¼Œæœ‰ä¸‰ç§è§’è‰²ï¼š Leader Follower Observer ä¸€ä¸ªZooKeeperé›†ç¾¤åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªLeaderï¼Œå…¶ä»–éƒ½æ˜¯Followeræˆ–Observerã€‚ ZooKeeperé…ç½®å¾ˆç®€å•ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶(zoo.cfg)éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰myidæ–‡ä»¶ä¸ä¸€æ ·ã€‚myidçš„å€¼å¿…é¡»æ˜¯zoo.cfgä¸­server.{æ•°å€¼}çš„{æ•°å€¼}éƒ¨åˆ†ã€‚ zoo.cfgæ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š 12345678910111213141516171819202122maxClientCnxns=0# The number of milliseconds of each ticktickTime=2000# The number of ticks that the initial# synchronization phase can takeinitLimit=10# The number of ticks that can pass between# sending a request and getting an acknowledgementsyncLimit=5# the directory where the snapshot is stored.dataDir=/var/lib/zookeeper/data# the port at which the clients will connectclientPort=2181# the directory where the transaction logs are stored.dataLogDir=/var/lib/zookeeper/logsserver.1=192.168.20.101:2888:3888server.2=192.168.20.102:2888:3888server.3=192.168.20.103:2888:3888server.4=192.168.20.104:2888:3888server.5=192.168.20.105:2888:3888minSessionTimeout=4000maxSessionTimeout=100000 åœ¨è£…æœ‰ZooKeeperçš„æœºå™¨çš„ç»ˆç«¯æ‰§è¡Œ zookeeper-server status å¯ä»¥çœ‹å½“å‰èŠ‚ç‚¹çš„ZooKeeperæ˜¯ä»€ä¹ˆè§’è‰²ï¼ˆLeader or Followerï¼‰ã€‚ 12345678[root@node-20-103 ~]# zookeeper-server statusJMX enabled by defaultUsing config: /etc/zookeeper/conf/zoo.cfgMode: follower[root@node-20-104 ~]# zookeeper-server statusJMX enabled by defaultUsing config: /etc/zookeeper/conf/zoo.cfgMode: leader å¦‚ä¸Šï¼Œnode-20-104æ˜¯Leaderï¼Œnode-20-103æ˜¯followerã€‚ ZooKeeperé»˜è®¤åªæœ‰Leaderå’ŒFollowerä¸¤ç§è§’è‰²ï¼Œæ²¡æœ‰Observerè§’è‰²ã€‚ ä¸ºäº†ä½¿ç”¨Observeræ¨¡å¼ï¼Œåœ¨ä»»ä½•æƒ³å˜æˆObserverçš„èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼špeerType=observer å¹¶åœ¨æ‰€æœ‰serverçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æˆobserveræ¨¡å¼çš„serverçš„é‚£è¡Œé…ç½®è¿½åŠ :observerï¼Œä¾‹å¦‚ï¼š 1server.1:localhost:2888:3888:observer ZooKeeperé›†ç¾¤çš„æ‰€æœ‰æœºå™¨é€šè¿‡ä¸€ä¸ªLeaderé€‰ä¸¾è¿‡ç¨‹æ¥é€‰å®šä¸€å°è¢«ç§°ä¸ºã€ŽLeaderã€çš„æœºå™¨ï¼ŒLeaderæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å’Œå†™æœåŠ¡ã€‚ Followerå’ŒObserveréƒ½èƒ½æä¾›è¯»æœåŠ¡ï¼Œä¸èƒ½æä¾›å†™æœåŠ¡ã€‚ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºŽï¼ŒObserveræœºå™¨ä¸å‚ä¸ŽLeaderé€‰ä¸¾è¿‡ç¨‹ï¼Œä¹Ÿä¸å‚ä¸Žå†™æ“ä½œçš„ã€Žè¿‡åŠå†™æˆåŠŸã€ç­–ç•¥ï¼Œå› æ­¤Observerå¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚ ä¼šè¯Session åœ¨ZooKeeperä¸­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¿žæŽ¥æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„TCPé•¿è¿žæŽ¥ã€‚ZooKeeperå¯¹å¤–çš„æœåŠ¡ç«¯å£é»˜è®¤æ˜¯2181ï¼Œå®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šä¸ŽæœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿žæŽ¥ï¼Œä»Žç¬¬ä¸€æ¬¡è¿žæŽ¥å»ºç«‹å¼€å§‹ï¼Œå®¢æˆ·ç«¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå¼€å§‹äº†ï¼Œé€šè¿‡è¿™ä¸ªè¿žæŽ¥ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å¿ƒè·³æ£€æµ‹å’ŒæœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ZooKeeperæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æŽ¥å—å“åº”ï¼ŒåŒæ—¶è¿˜èƒ½é€šè¿‡è¯¥è¿žæŽ¥æŽ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„Watchäº‹ä»¶é€šçŸ¥ã€‚Sessionçš„SessionTimeoutå€¼ç”¨æ¥è®¾ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å½“ç”±äºŽæœåŠ¡å™¨åŽ‹åŠ›å¤ªå¤§ã€ç½‘ç»œæ•…éšœæˆ–æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿žæŽ¥ç­‰å„ç§åŽŸå› å¯¼è‡´å®¢æˆ·ç«¯è¿žæŽ¥æ–­å¼€æ—¶ï¼Œåªè¦åœ¨SessionTimeoutè§„å®šçš„æ—¶é—´å†…èƒ½å¤Ÿé‡æ–°è¿žæŽ¥ä¸Šé›†ç¾¤ä¸­ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ç„¶æœ‰æ•ˆã€‚]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>Zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLé—®é¢˜æŽ’æŸ¥SQL]]></title>
    <url>%2Fposts%2F81d4f14b.html</url>
    <content type="text"><![CDATA[æŸ¥çœ‹å½“å‰åº”ç”¨è¿žæŽ¥ï¼Œè¿žæŽ¥æ•°çªå¢žæŽ’æŸ¥ 1select user,SUBSTRING_INDEX(host,':',1) as ip , count(*) as count,db from information_schema.processlist where host not in ('localhost') and user not in ('replicater') group by ip order by count; æŸ¥çœ‹è¡¨æ‰€å±žåŠå¤§æ¦‚è¡Œæ•°ï¼Œä¸€èˆ¬åŠ å­—æ®µç´¢å¼•æ—¶åšå‚è€ƒ 1select TABLE_SCHEMA,TABLE_NAME,TABLE_ROWS from information_schema.tables where TABLE_NAME='è¡¨å'; æŸ¥çœ‹è¡¨ç¢Žç‰‡ï¼Œæ˜¯å¦éœ€è¦æ•´ç†è¡¨é‡Šæ”¾ç‰©ç†ç©ºé—´ 1select table_name,table_rows,concat(round(DATA_LENGTH/1024/1024, 2), 'MB') as size,DATA_FREE/1024/1024 AS data_free_MB from information_schema.TABLES where table_schema='åº“å' order by DATA_LENGTH desc; å½“å‰æœ‰æ²¡æœ‰é” 1select * from information_schema.innodb_locks; å½“å‰é”å µå¡žæƒ…å†µ 1select * from information_schema.innodb_lock_waits; å½“å‰é”ç­‰å¾…è¯¦ç»†ä¿¡æ¯ 1select it.trx_mysql_thread_id, il.lock_id, il.lock_table, il.lock_mode, il.lock_type, it.trx_state, pl.USER||'@'||pl.HOST as user_host, pl.db, pl.command, pl.info, it.trx_started, it.trx_wait_started, now()-trx_wait_started as wait_seconds, il.lock_index, it.trx_weight, it.trx_rows_locked, it.trx_rows_modified from information_schema.INNODB_TRX it,information_schema.innodb_locks il,information_schema.processlist pl where it.trx_id = il.lock_trx_id and it.trx_mysql_thread_id = pl.id\G æœ€è¿‘ä¸€æ¬¡æ­»é”ã€æœªæäº¤äº‹ç‰©ã€CHECKPIONTã€BUFFER POOLç­‰ 1show engine innodb status\G è¿‡æ»¤æ— ç”¨çº¿ç¨‹ä¿¡æ¯å¯ç”¨pager 1pager grep -v Sleep;show processlist; æŸ¥çœ‹å½“å‰è¿è¡Œçš„è¯¦ç»†SQL 1SELECT * FROM INFORMATION_SCHEMA.PROCESSLIST WHERE info is not null\G æŸ¥çœ‹æŸæ¡sqlå„é˜¶æ®µæ‰§è¡Œæ—¶é—´ï¼Œå¯å¼€å¯profilingåŠŸèƒ½ 1set global profiling=on; æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ 1select user,host,authentication_string from mysql.user group by user; æŸ¥çœ‹å“ªäº›sqlæ‰§è¡Œæœ€å¤šæ¬¡ 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_ROWS_EXAMINED,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY COUNT_STAR desc LIMIT 1; å“ªä¸ªSQLæ‰«æçš„è¡Œæ•°æœ€å¤š(IOæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,AVG_TIMER_WAIT,SUM_ROWS_SENT,SUM_ROWS_EXAMINED,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_ROWS_EXAMINED desc LIMIT 1\G å“ªä¸ªSQLä½¿ç”¨çš„ä¸´æ—¶è¡¨æœ€å¤š 1SELECT SCHEMA_NAME,DIGEST_TEXT,SUM_CREATED_TMP_DISK_TABLES,SUM_CREATED_TMP_TABLES,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_CREATED_TMP_DISK_TABLES desc LIMIT 1\G å“ªä¸ªSQLè¿”å›žçš„ç»“æžœé›†æœ€å¤š(netæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_ROWS_SENT,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_ROWS_SENT desc LIMIT 1\G å“ªä¸ªSQLæŽ’åºæ•°æœ€å¤š(CPUæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_SORT_ROWS,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_SORT_ROWS desc LIMIT 1\G]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DevOpsåˆè¯†]]></title>
    <url>%2Fposts%2F230bf701.html</url>
    <content type="text"><![CDATA[èƒŒæ™¯ DevOpsçš„å‡ºçŽ°æœ‰å…¶å¿…ç„¶æ€§ã€‚åœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œé‡åˆ°äº†ä¸¤æ¬¡ç“¶é¢ˆã€‚ ç¬¬ä¸€æ¬¡ç“¶é¢ˆæ˜¯åœ¨éœ€æ±‚é˜¶æ®µå’Œå¼€å‘é˜¶æ®µä¹‹é—´ï¼Œé’ˆå¯¹ä¸æ–­å˜åŒ–çš„éœ€æ±‚ï¼Œå¯¹è½¯ä»¶å¼€å‘è€…æå‡ºäº†é«˜è¦æ±‚ï¼ŒåŽæ¥å‡ºçŽ°äº†æ•æ·æ–¹æ³•è®ºï¼Œå¼ºè°ƒé€‚åº”éœ€æ±‚ã€å¿«é€Ÿè¿­ä»£ã€æŒç»­äº¤ä»˜ã€‚ ç¬¬äºŒä¸ªç“¶é¢ˆæ˜¯åœ¨å¼€å‘é˜¶æ®µå’Œæž„å»ºéƒ¨ç½²é˜¶æ®µä¹‹é—´ï¼Œå¤§é‡å®Œæˆçš„å¼€å‘ä»»åŠ¡å¯èƒ½é˜»å¡žåœ¨éƒ¨ç½²é˜¶æ®µï¼Œå½±å“äº¤ä»˜ï¼ŒäºŽæ˜¯æœ‰äº†DevOpsã€‚ æ¦‚å¿µ DevOpsä¸€è¯çš„æ¥è‡ªäºŽDevelopmentå’ŒOperationsçš„ç»„åˆï¼Œçªå‡ºé‡è§†è½¯ä»¶å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜çš„æ²Ÿé€šåˆä½œï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æµç¨‹æ¥ä½¿å¾—è½¯ä»¶æž„å»ºã€æµ‹è¯•ã€å‘å¸ƒæ›´åŠ å¿«æ·ã€é¢‘ç¹å’Œå¯é ã€‚ DevOpsæ˜¯ä¸ºäº†å¡«è¡¥å¼€å‘ç«¯å’Œè¿ç»´ç«¯ä¹‹é—´çš„ä¿¡æ¯é¸¿æ²Ÿï¼Œæ”¹å–„å›¢é˜Ÿä¹‹é—´çš„åä½œå…³ç³»ã€‚ä¸è¿‡éœ€è¦æ¾„æ¸…çš„ä¸€ç‚¹æ˜¯ï¼Œä»Žå¼€å‘åˆ°è¿ç»´ï¼Œä¸­é—´è¿˜æœ‰æµ‹è¯•çŽ¯èŠ‚ã€‚DevOpså…¶å®žåŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šå¼€å‘ã€æµ‹è¯•å’Œè¿ç»´ã€‚ æ¢å¥è¯è¯´ï¼ŒDevOpså¸Œæœ›åšåˆ°çš„æ˜¯è½¯ä»¶äº§å“äº¤ä»˜è¿‡ç¨‹ä¸­ITå·¥å…·é“¾çš„æ‰“é€šï¼Œä½¿å¾—å„ä¸ªå›¢é˜Ÿå‡å°‘æ—¶é—´æŸè€—ï¼Œæ›´åŠ é«˜æ•ˆåœ°ååŒå·¥ä½œã€‚ä¸“å®¶ä»¬æ€»ç»“å‡ºäº†ä¸‹é¢è¿™ä¸ªDevOpsèƒ½åŠ›å›¾ï¼Œè‰¯å¥½çš„é—­çŽ¯å¯ä»¥å¤§å¤§å¢žåŠ æ•´ä½“çš„äº§å‡ºã€‚ æŒç»­é›†æˆ æŒç»­é›†æˆå¼ºè°ƒå¼€å‘äººå‘˜æäº¤äº†æ–°ä»£ç ä¹‹åŽï¼Œç«‹åˆ»è¿›è¡Œæž„å»ºã€ï¼ˆå•å…ƒï¼‰æµ‹è¯•ã€‚æ ¹æ®æµ‹è¯•ç»“æžœï¼Œå¯ä»¥ç¡®å®šæ–°ä»£ç å’ŒåŽŸæœ‰ä»£ç èƒ½å¦æ­£ç¡®åœ°é›†æˆåœ¨ä¸€èµ·ã€‚ æŒç»­äº¤ä»˜ æŒç»­äº¤ä»˜åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåŽçš„ä»£ç éƒ¨ç½²åˆ°æ›´è´´è¿‘çœŸå®žè¿è¡ŒçŽ¯å¢ƒçš„ã€Œç±»ç”Ÿäº§çŽ¯å¢ƒã€ï¼ˆproduction-like environmentsï¼‰ä¸­ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å®Œæˆå•å…ƒæµ‹è¯•åŽï¼Œå¯ä»¥æŠŠä»£ç éƒ¨ç½²åˆ°è¿žæŽ¥æ•°æ®åº“çš„ Staging çŽ¯å¢ƒä¸­æ›´å¤šçš„æµ‹è¯•ã€‚å¦‚æžœä»£ç æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒä¸­ã€‚ æŒç»­éƒ¨ç½² æŒç»­éƒ¨ç½²åˆ™æ˜¯åœ¨æŒç»­äº¤ä»˜çš„åŸºç¡€ä¸Šï¼ŒæŠŠéƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒçš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚ å‡ ä¸ªå…³é”®é—®é¢˜ å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ DevOpsçš„ä¸€ä¸ªå·¨å¤§å¥½å¤„å°±æ˜¯å¯ä»¥é«˜æ•ˆäº¤ä»˜ï¼Œè¿™ä¹Ÿæ­£å¥½æ˜¯å®ƒçš„åˆè¡·ã€‚ Puppetå’ŒDevOps Research and Assessment (DORA) ä¸»åŠžäº†2016å¹´DevOpsè°ƒæŸ¥æŠ¥å‘Šï¼Œæ ¹æ®å…¨çƒ4600ä½å„ITå…¬å¸çš„æŠ€æœ¯å·¥ä½œè€…çš„æäº¤æ•°æ®ç»Ÿè®¡ï¼Œå¾—å‡ºé«˜æ•ˆå…¬å¸å¹³å‡æ¯å¹´å¯ä»¥å®Œæˆ1460æ¬¡éƒ¨ç½²ã€‚ ä¸Žä½Žæ•ˆç»„ç»‡ç›¸æ¯”ï¼Œé«˜æ•ˆç»„ç»‡çš„éƒ¨ç½²é¢‘ç¹200å€ï¼Œäº§å“æŠ•å…¥ä½¿ç”¨é€Ÿåº¦å¿«2555å€ï¼ŒæœåŠ¡æ¢å¤é€Ÿåº¦å¿«24å€ã€‚åœ¨å·¥ä½œå†…å®¹çš„æ—¶é—´åˆ†é…ä¸Šï¼Œä½Žæ•ˆè€…è¦å¤šèŠ±22%çš„æ—¶é—´ç”¨åœ¨ä¸ºè§„åˆ’å¥½æˆ–è€…é‡å¤å·¥ä½œä¸Šï¼Œè€Œé«˜æ•ˆè€…å´å¯ä»¥å¤šèŠ±29%çš„æ—¶é—´ç”¨åœ¨æ–°çš„å·¥ä½œä¸Šã€‚æ‰€ä»¥è¿™é‡Œçš„é«˜æ•ˆä¸ä»…ä»…æŒ‡å…¬å¸äº§å‡ºçš„æ•ˆçŽ‡æé«˜ï¼Œè¿˜æŒ‡å‘˜å·¥çš„å·¥ä½œè´¨é‡å¾—åˆ°æå‡ã€‚ å¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯ä¼šæ”¹å–„å…¬å¸ç»„ç»‡æ–‡åŒ–ã€æé«˜å‘˜å·¥çš„å‚ä¸Žæ„Ÿã€‚ å‘˜å·¥ä»¬å˜å¾—æ›´é«˜æ•ˆï¼Œä¹Ÿæ›´æœ‰æ»¡è¶³å’Œæˆå°±æ„Ÿï¼›è°ƒæŸ¥æ˜¾ç¤ºé«˜æ•ˆå‘˜å·¥çš„é›‡å‘˜å‡€æŽ¨èå€¼ï¼ˆeNPS:employee Net Promoter Scoreï¼‰æ›´é«˜ï¼Œå³å¯¹å…¬å¸æ›´åŠ è®¤åŒã€‚ å¿«é€Ÿéƒ¨ç½²åŒæ—¶æé«˜ITç¨³å®šæ€§ï¼Œè¿™ä¸çŸ›ç›¾å—ï¼Ÿ å¿«é€Ÿçš„éƒ¨ç½²å…¶å®žå¯ä»¥å¸®åŠ©æ›´å¿«åœ°å‘çŽ°é—®é¢˜ï¼Œäº§å“è¢«æ›´å¿«åœ°äº¤ä»˜åˆ°ç”¨æˆ·æ‰‹ä¸­ï¼Œå›¢é˜Ÿå¯ä»¥æ›´å¿«åœ°å¾—åˆ°ç”¨æˆ·çš„åé¦ˆï¼Œä»Žè€Œè¿›è¡Œæ›´å¿«åœ°å“åº”ã€‚è€Œä¸”ï¼ŒDevOpså°æ­¥å¿«è·‘çš„å½¢å¼å¸¦æ¥çš„å˜åŒ–æ˜¯æ¯”è¾ƒå°çš„ï¼Œå‡ºçŽ°é—®é¢˜çš„åå·®æ¯æ¬¡éƒ½ä¸ä¼šå¤ªå¤§ï¼Œä¿®å¤èµ·æ¥ä¹Ÿä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ã€‚ ä¸‰åŽŸåˆ™ åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Codeï¼‰ DeveOpsçš„åŸºç¡€æ˜¯å°†é‡å¤çš„äº‹æƒ…ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æˆ–è½¯ä»¶æ¥å®žçŽ°ï¼Œä¾‹å¦‚Dockerï¼ˆå®¹å™¨åŒ–ï¼‰ã€Jenkinsï¼ˆæŒç»­é›†æˆï¼‰ã€Puppetï¼ˆåŸºç¡€æž¶æž„æž„å»ºï¼‰ã€Vagrantï¼ˆè™šæ‹ŸåŒ–å¹³å°ï¼‰ç­‰ã€‚ æŒç»­äº¤ä»˜ï¼ˆContinuous Deliveryï¼‰ æŒç»­äº¤ä»˜æ˜¯åœ¨ç”Ÿäº§çŽ¯å¢ƒå‘å¸ƒå¯é çš„è½¯ä»¶å¹¶äº¤ä»˜ç»™ç”¨æˆ·ä½¿ç”¨ã€‚è€ŒæŒç»­éƒ¨ç½²åˆ™ä¸ä¸€å®šäº¤ä»˜ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ æ¶‰åŠåˆ°2ä¸ªæ—¶é—´ï¼ŒTTRï¼ˆTime to Repairï¼‰ä¿®å¤æ—¶é—´ï¼ŒTTMï¼ˆTime To Marketingï¼‰äº§å“ä¸Šçº¿æ—¶é—´ã€‚è¦åšåˆ°é«˜æ•ˆäº¤ä»˜å¯é çš„è½¯ä»¶ï¼Œéœ€è¦å°½å¯èƒ½çš„å‡å°‘è¿™2ä¸ªæ—¶é—´ã€‚ éƒ¨ç½²å¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²ç­‰ã€‚ ååŒå·¥ä½œï¼ˆCulture of Collaborationï¼‰ å¼€å‘è€…å’Œè¿ç»´äººå‘˜å¿…é¡»å®šæœŸè¿›è¡Œå¯†åˆ‡çš„åˆä½œã€‚å¼€å‘åº”è¯¥æŠŠè¿ç»´è§’è‰²ç†è§£æˆè½¯ä»¶çš„å¦ä¸€ä¸ªç”¨æˆ·ç¾¤ä½“ã€‚åä½œæœ‰å‡ ä¸ªçš„å»ºè®®ï¼š è‡ªåŠ¨åŒ–ï¼ˆå‡å°‘ä¸å¿…è¦çš„åä½œï¼‰ï¼› å°èŒƒå›´ï¼ˆæ¯æ¬¡ä¿®æ”¹çš„å†…å®¹ä¸å®œè¿‡å¤šï¼Œå‡å°‘å‘å¸ƒçš„é£Žé™©ï¼‰ï¼› ç»Ÿä¸€ä¿¡æ¯é›†æ•£åœ°ï¼ˆå¦‚wikiï¼Œè®©åŒæ–¹èƒ½å¤Ÿå…±äº«ä¿¡æ¯ï¼‰ï¼› æ ‡å‡†åŒ–åä½œå·¥å…·ï¼ˆæ¯”å¦‚jenkinsï¼‰ã€‚ æ€Žä¹ˆå®žçŽ°DevOps ç¡¬æ€§è¦æ±‚ï¼šå·¥å…·ä¸Šçš„å‡†å¤‡ ä»£ç ç®¡ç†ï¼ˆSCMï¼‰ï¼šGitHubã€GitLabã€BitBucketã€SubVersionæž„å»ºå·¥å…·ï¼šAntã€Gradleã€mavenè‡ªåŠ¨éƒ¨ç½²ï¼šCapistranoã€CodeDeployæŒç»­é›†æˆï¼ˆCIï¼‰ï¼šBambooã€Hudsonã€Jenkinsé…ç½®ç®¡ç†ï¼šAnsibleã€Chefã€Puppetã€SaltStackã€ScriptRock GuardRailå®¹å™¨ï¼šDockerã€LXCã€ç¬¬ä¸‰æ–¹åŽ‚å•†å¦‚AWSç¼–æŽ’ï¼šKubernetesã€Coreã€Apache Mesosã€DC/OSæœåŠ¡æ³¨å†Œä¸Žå‘çŽ°ï¼šZookeeperã€etcdã€Consulè„šæœ¬è¯­è¨€ï¼špythonã€rubyã€shellæ—¥å¿—ç®¡ç†ï¼šELKã€Logentriesç³»ç»Ÿç›‘æŽ§ï¼šDatadogã€Graphiteã€Icingaã€Nagiosã€zabbixæ€§èƒ½ç›‘æŽ§ï¼šAppDynamicsã€New Relicã€SplunkåŽ‹åŠ›æµ‹è¯•ï¼šJMeterã€Blaze Meterã€loader.ioé¢„è­¦ï¼šPagerDutyã€pingdomã€åŽ‚å•†è‡ªå¸¦å¦‚AWS SNSHTTPåŠ é€Ÿå™¨ï¼šVarnishæ¶ˆæ¯æ€»çº¿ï¼šActiveMQã€SQSåº”ç”¨æœåŠ¡å™¨ï¼šTomcatã€JBossWebæœåŠ¡å™¨ï¼šApacheã€Nginxã€IISæ•°æ®åº“ï¼šMySQLã€Oracleã€PostgreSQLç­‰å…³ç³»åž‹æ•°æ®åº“ï¼›cassandraã€mongoDBã€redisç­‰NoSQLæ•°æ®åº“é¡¹ç›®ç®¡ç†ï¼ˆPMï¼‰ï¼šJiraã€Asanaã€Taigaã€Trelloã€Basecampã€Pivotal Tracker åœ¨å·¥å…·çš„é€‰æ‹©ä¸Šï¼Œéœ€è¦ç»“åˆå…¬å¸ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯å›¢é˜Ÿæƒ…å†µè€Œå®šã€‚ è½¯æ€§éœ€æ±‚ï¼šæ–‡åŒ–å’Œäºº DevOpsæˆåŠŸä¸Žå¦ï¼Œå…¬å¸ç»„ç»‡æ˜¯å¦åˆ©äºŽåä½œæ˜¯å…³é”®ã€‚å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜å¯ä»¥è‰¯å¥½æ²Ÿé€šäº’ç›¸å­¦ä¹ ï¼Œä»Žè€Œæ‹¥æœ‰é«˜ç”Ÿäº§åŠ›ã€‚å¹¶ä¸”åä½œä¹Ÿå­˜åœ¨äºŽä¸šåŠ¡äººå‘˜ä¸Žå¼€å‘äººå‘˜ä¹‹é—´ã€‚ å‡ºå¸­äº†2016å¹´ä¼¦æ•¦ä¼ä¸šçº§DevOpså³°ä¼šçš„ITVå…¬å¸åœ¨2012å¹´å°±å¼€å§‹è½åœ°DevOpsï¼Œå…¶é€šç”¨å¹³å°ä¸»ç®¡Clarkåœ¨æŽ¥å—äº†InfoQçš„é‡‡è®¿ï¼Œåœ¨è°ˆåŠæˆåŠŸæ—¶è¡¨ç¤ºï¼Œä¸šåŠ¡äººå‘˜éžå¸¸æ¸…æ¥šä»–ä»¬å¸Œæœ›åœ¨æœ€å°åŒ–å¯è¡Œäº§å“ä¸­å®žçŽ°ä»€ä¹ˆï¼Œå·¥ç¨‹å¸ˆä»¬å°±æŒ‰éœ€äº¤ä»˜ï¼Œä¸åšå¤šä½™å·¥ä½œã€‚ è¿™æ ·ï¼Œå·¥ç¨‹å¸ˆä»¬ä½¿ç”¨é€šç”¨çš„å¹³å°ï¼ˆå³æ‰“é€šçš„å·¥å…·é“¾ï¼‰å¾—åˆ°æ›´å¥½çš„ä¸€è‡´æ€§å’Œæ›´é«˜çš„è´¨é‡ã€‚æ­¤å¤–ï¼ŒDevOpså¯¹å·¥ç¨‹å¸ˆä¸ªäººçš„è¦æ±‚ä¹Ÿæé«˜äº†ï¼Œå¾ˆå¤šä¸“å®¶ä¹Ÿè®¤ä¸ºæ‹›å‹Ÿåˆ°ä¼˜ç§€çš„äººæ‰ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -åˆ†å¸ƒå¼äº‹åŠ¡]]></title>
    <url>%2Fposts%2F464cb56d.html</url>
    <content type="text"><![CDATA[äº‹åŠ¡å®šä¹‰ äº‹åŠ¡æä¾›ä¸€ç§æœºåˆ¶å°†ä¸€ä¸ªæ´»åŠ¨æ¶‰åŠçš„æ‰€æœ‰æ“ä½œçº³å…¥åˆ°ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ‰§è¡Œå•å…ƒï¼Œç»„æˆäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œåªæœ‰åœ¨æ‰€æœ‰æ“ä½œå‡èƒ½æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹æ–¹èƒ½æäº¤ï¼Œåªè¦å…¶ä¸­ä»»ä¸€æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œéƒ½å°†å¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å›žæ»šã€‚ç®€å•åœ°è¯´ï¼Œäº‹åŠ¡æä¾›ä¸€ç§â€œè¦ä¹ˆä»€ä¹ˆéƒ½ä¸åšï¼Œè¦ä¹ˆåšå…¨å¥—ï¼ˆAll or Nothingï¼‰â€æœºåˆ¶ã€‚ æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰ A:åŽŸå­æ€§(Atomicity) ä¸€ä¸ªäº‹åŠ¡(transaction)ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªçŽ¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›žæ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»Žæ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ ä¾‹å¦‚ï¼šé“¶è¡Œè½¬è´¦ï¼Œä»ŽAè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š ï¼ˆ1ï¼‰ä»ŽAè´¦æˆ·å–100å…ƒ ï¼ˆ2ï¼‰å­˜å…¥100å…ƒè‡³Bè´¦æˆ·ã€‚ è¿™ä¸¤æ­¥è¦ä¹ˆä¸€èµ·å®Œæˆï¼Œè¦ä¹ˆä¸€èµ·ä¸å®Œæˆï¼Œå¦‚æžœåªå®Œæˆç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼Œé’±ä¼šèŽ«åå…¶å¦™å°‘äº†100å…ƒã€‚ C:ä¸€è‡´æ€§(Consistency) äº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åŽæ•°æ®åº“éƒ½å¿…é¡»å¤„äºŽä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æžœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºŽæœ‰æ•ˆçŠ¶æ€ã€‚å¦‚æžœåœ¨äº‹åŠ¡ä¸­å‡ºçŽ°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›žæ»šï¼Œç³»ç»Ÿè¿”å›žåˆ°åŽŸå§‹çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼šçŽ°æœ‰å®Œæ•´æ€§çº¦æŸA+B=100ï¼Œå¦‚æžœä¸€ä¸ªäº‹åŠ¡æ”¹å˜äº†Aï¼Œé‚£ä¹ˆå¿…é¡»å¾—æ”¹å˜Bï¼Œä½¿å¾—äº‹åŠ¡ç»“æŸåŽä¾ç„¶æ»¡è¶³A+B=100ï¼Œå¦åˆ™äº‹åŠ¡å¤±è´¥ã€‚ I:éš”ç¦»æ€§(Isolation) æŒ‡çš„æ˜¯åœ¨å¹¶å‘çŽ¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸Žä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åŽçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼šçŽ°æœ‰æœ‰ä¸ªäº¤æ˜“æ˜¯ä»ŽAè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåœ¨è¿™ä¸ªäº¤æ˜“äº‹åŠ¡è¿˜æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼Œå¦‚æžœæ­¤æ—¶BæŸ¥è¯¢è‡ªå·±çš„è´¦æˆ·ï¼Œæ˜¯çœ‹ä¸åˆ°æ–°å¢žåŠ çš„100å…ƒçš„ã€‚ D:æŒä¹…æ€§(Durability) äº‹åŠ¡å¤„ç†ç»“æŸåŽï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»ŸåŽï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ä¹°ä¸œè¥¿çš„æ—¶å€™éœ€è¦è®°å½•åœ¨è´¦æœ¬ä¸Šï¼Œå³ä½¿è€æ¿å¿˜è®°äº†é‚£ä¹Ÿæœ‰æ®å¯æŸ¥ã€‚ æ•°æ®åº“äº‹åŠ¡å®žçŽ°åŽŸç† ä»¥MySQLçš„InnoDBä¸ºä¾‹ï¼Œäº‹åŠ¡çš„ACIDæ˜¯é€šè¿‡InnoDBæ—¥å¿—å’Œé”æ¥ä¿è¯ã€‚ äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯é€šè¿‡æ•°æ®åº“é”çš„æœºåˆ¶å®žçŽ°çš„ï¼ŒæŒä¹…æ€§é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥å®žçŽ°ï¼ŒåŽŸå­æ€§å’Œä¸€è‡´æ€§é€šè¿‡Undo logæ¥å®žçŽ°ã€‚ UndoLogçš„åŽŸç†å¾ˆç®€å•ï¼Œä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŽŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆè¿™ä¸ªå­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°æ–¹ç§°ä¸ºUndoLogï¼‰ã€‚ç„¶åŽè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æžœå‡ºçŽ°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo Logä¸­çš„å¤‡ä»½å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ å’ŒUndo Logç›¸åï¼ŒRedoLogè®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†RedoLogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯RedoLogå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®RedoLogçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ ç®€å•è€Œè¨€ï¼Œå°±æ˜¯ä¸šåŠ¡ä¸Šæœ‰ä¸€ç»„æ•°æ®æ“ä½œï¼Œéœ€è¦å¦‚æžœå…¶ä¸­æœ‰ä»»ä½•ä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œæ•´ç»„æ“ä½œå…¨éƒ¨ä¸æ‰§è¡Œå¹¶æ¢å¤åˆ°æœªæ‰§è¡ŒçŠ¶æ€ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ åœ¨ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ—¶éœ€è¦æ³¨æ„ï¼Œå°½å¯èƒ½çŸ­çš„ä¿æŒäº‹åŠ¡ï¼Œä¿®æ”¹å¤šä¸ªä¸åŒè¡¨çš„æ•°æ®çš„å†—é•¿äº‹åŠ¡ä¼šä¸¥é‡å¦¨ç¢ç³»ç»Ÿä¸­çš„æ‰€æœ‰å…¶ä»–ç”¨æˆ·ï¼Œè¿™å¾ˆæœ‰å¯èƒ½å¯¼è‡´ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚ åˆ†å¸ƒå¼ç†è®º CAPç†è®º ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šåˆ†å¸ƒå¼æ•°æ®åº“çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚ åˆ†åŒºå®¹é”™æ€§ï¼ˆç½‘ç»œåˆ†åŒºï¼‰Partition toleranceï¼šä¸€ä¸ªæ•°æ®åº“æ‰€åœ¨çš„æœºå™¨åäº†ï¼Œå¦‚ç¡¬ç›˜åäº†ï¼Œæ•°æ®ä¸¢å¤±äº†ï¼Œå¯ä»¥æ–°å¢žä¸€å°æœºå™¨ï¼Œç„¶åŽä»Žå…¶ä»–æ­£å¸¸çš„æœºå™¨æŠŠå¤‡ä»½çš„æ•°æ®åŒæ­¥è¿‡æ¥ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰3 ä¸ªè¦ç´ æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ªï¼Œä¸å¯å…¼å¾—ã€‚å…¶ä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§åˆæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ CA(æ”¾å¼ƒP)ï¼šå°†æ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€‚æ¯”å¦‚ä¼ ç»Ÿçš„å…³ç³»åž‹æ•°æ®åº“ã€‚ AP(æ”¾å¼ƒC)ï¼šæ”¾å¼ƒå¼ºä¸€è‡´æ€§ï¼Œç”¨æœ€ç»ˆä¸€è‡´æ€§æ¥ä¿è¯ã€‚æ¯”å¦‚Zookeeperã€‚ CP(æ”¾å¼ƒA)ï¼šä¸€æ—¦ç³»ç»Ÿé‡åˆ°æ•…éšœï¼Œå—åˆ°å½±å“çš„æœåŠ¡å™¨éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ¢å¤æœŸé—´æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚æ¯”å¦‚Redisç­‰ã€‚ CAPç†è®ºä¸¾ä¾‹ï¼š æœ‰3å°æœºå™¨åˆ†åˆ«æœ‰3ä¸ªæ•°æ®åº“åˆ†åˆ«æœ‰ä¸¤å¼ è¡¨,æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ Machine1-db1-tbl_personã€tbl_order Machine2-db2-tbl_personã€tbl_order Machine3-db3-tbl_personã€tbl_order 1ï¼‰å½“å‘machine1çš„db1çš„è¡¨tbl_personã€tbl_orderæ’å…¥æ•°æ•°æ®æ—¶ï¼ŒåŒæ—¶è¦æŠŠæ’å…¥çš„æ•°æ®åŒæ­¥åˆ°machine2ã€machine3ï¼Œè¿™å°±æ˜¯ä¸€è‡´æ€§ã€‚ 2ï¼‰å½“å…¶ä¸­çš„ä¸€å°æœºå™¨å®•æœºäº†ï¼Œå¯ä»¥ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ï¼ŒæŠŠå®•æœºçš„æœºå™¨é‡æ–°å¯åŠ¨èµ·æ¥å¯ä»¥ç»§ç»­æœåŠ¡ï¼Œè¿™å°±æ˜¯å¯ç”¨æ€§ã€‚ 3ï¼‰å½“machine1çš„æœºå™¨åäº†ï¼Œæ•°æ®å…¨éƒ¨ä¸¢å¤±äº†ï¼Œä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºmachine2å’Œmachine3ä¸Šè¿˜æœ‰æ•°æ®ï¼Œé‡æ–°åŠ ä¸€å°æœºå™¨machine4ï¼ŒæŠŠmachine2å’Œmachine3å…¶ä¸­ä¸€å°æœºå™¨çš„å¤‡ä»½æ•°æ®åŒæ­¥è¿‡æ¥å°±å¯ä»¥äº†ï¼Œè¿™å°±æ˜¯åˆ†åŒºå®¹é”™æ€§ã€‚ ä¸ºä»€ä¹ˆä¸‰ä¸ªä¸èƒ½åŒæ—¶æ»¡è¶³? è™½ç„¶ CAP ç†è®ºå®šä¹‰æ˜¯ä¸‰ä¸ªè¦ç´ ä¸­åªèƒ½å–ä¸¤ä¸ªï¼Œä½†æ”¾åˆ°åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹æ¥æ€è€ƒï¼Œä¼šå‘çŽ°å¿…é¡»é€‰æ‹© Pï¼ˆåˆ†åŒºå®¹å¿ï¼‰è¦ç´ ï¼Œå› ä¸ºç½‘ç»œæœ¬èº«æ— æ³•åšåˆ° 100% å¯é ï¼Œæœ‰å¯èƒ½å‡ºæ•…éšœï¼Œæ‰€ä»¥åˆ†åŒºæ˜¯ä¸€ä¸ªå¿…ç„¶çš„çŽ°è±¡ã€‚ å¦‚æžœé€‰æ‹©äº† CAï¼ˆä¸€è‡´æ€§ + å¯ç”¨æ€§ï¼‰ è€Œæ”¾å¼ƒäº† Pï¼ˆåˆ†åŒºå®¹å¿æ€§ï¼‰ï¼Œé‚£ä¹ˆå½“å‘ç”Ÿåˆ†åŒºçŽ°è±¡æ—¶ï¼Œä¸ºäº†ä¿è¯ Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œç³»ç»Ÿéœ€è¦ç¦æ­¢å†™å…¥ï¼Œå½“æœ‰å†™å…¥è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿè¿”å›ž errorï¼ˆä¾‹å¦‚ï¼Œå½“å‰ç³»ç»Ÿä¸å…è®¸å†™å…¥ï¼‰ï¼Œè¿™åˆå’Œ A(å¯ç”¨æ€§) å†²çªäº†ï¼Œå› ä¸º Aï¼ˆå¯ç”¨æ€§ï¼‰è¦æ±‚è¿”å›ž no error å’Œ no timeoutã€‚ å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA ï¼ˆä¸€è‡´æ€§ + å¯ç”¨æ€§ï¼‰æž¶æž„ï¼Œåªèƒ½é€‰æ‹© CPï¼ˆä¸€è‡´æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰ æˆ–è€… AP ï¼ˆå¯ç”¨æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰æž¶æž„ï¼Œåœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§åšæŠ˜ä¸­é€‰æ‹©ã€‚ ä¸»è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„æ¡ä»¶ä¸‹ï¼Œå¯ç”¨æ€§ä¸Žä¸€è‡´æ€§ä¸èƒ½åŒæ—¶æ»¡è¶³ã€‚ ä¸€è‡´æ€§è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹æ•°æ®éƒ½ä¸€è‡´æ—¶å†å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé‚£ä¹ˆä¸€æ—¦å‘ç”ŸèŠ‚ç‚¹å®•æœºæˆ–è€…ç½‘ç»œéš”ç¦»ï¼Œå°±éœ€è¦ç­‰å¾…èŠ‚ç‚¹æ¢å¤æˆ–è€…ç½‘ç»œæ¢å¤æˆ–è€…é›†ç¾¤é‡æ–°è°ƒæ•´èŠ‚ç‚¹æ•°ç›®ç­‰ç­‰ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ï¼›åœ¨è¿™æ®µæ—¶é—´ï¼ŒæœåŠ¡æ˜¯ä¸å¯ç”¨çš„ã€‚ç›¸åå¦‚æžœæƒ³è¦åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒæœåŠ¡ç»§ç»­å¯ç”¨ï¼Œä¾¿éœ€è¦ç‰ºç‰²ä¸€è‡´æ€§ã€‚ é¡ºä¾¿ä¸€æï¼ŒCAPç†è®ºä¸­æ˜¯å¿½ç•¥ç½‘ç»œå»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯å½“äº‹åŠ¡æäº¤æ—¶ï¼Œä»ŽèŠ‚ç‚¹Aå¤åˆ¶åˆ°èŠ‚ç‚¹Bï¼Œä½†æ˜¯åœ¨çŽ°å®žä¸­è¿™ä¸ªæ˜¯æ˜Žæ˜¾ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥æ€»ä¼šæœ‰ä¸€å®šçš„æ—¶é—´æ˜¯ä¸ä¸€è‡´ã€‚åŒæ—¶CAPä¸­é€‰æ‹©ä¸¤ä¸ªï¼Œæ¯”å¦‚ä½ é€‰æ‹©äº†CPï¼Œå¹¶ä¸æ˜¯å«ä½ æ”¾å¼ƒAã€‚å› ä¸ºPå‡ºçŽ°çš„æ¦‚çŽ‡å®žåœ¨æ˜¯å¤ªå°äº†ï¼Œå¤§éƒ¨åˆ†çš„æ—¶é—´ä½ ä»ç„¶éœ€è¦ä¿è¯CAã€‚å°±ç®—åˆ†åŒºå‡ºçŽ°äº†ä½ ä¹Ÿè¦ä¸ºåŽæ¥çš„Aåšå‡†å¤‡ï¼Œæ¯”å¦‚é€šè¿‡ä¸€äº›æ—¥å¿—çš„æ‰‹æ®µï¼Œæ˜¯å…¶ä»–æœºå™¨å›žå¤è‡³å¯ç”¨ã€‚ CAPç†è®ºå‘Šè¯‰æˆ‘ä»¬åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½é€‰æ‹©APæˆ–è€…CPï¼Œä½†å®žé™…ä¸Šå¹¶ä¸æ˜¯è¯´æ•´ä¸ªç³»ç»Ÿåªèƒ½é€‰æ‹©APæˆ–è€…CPï¼Œåœ¨ CAP ç†è®ºè½åœ°å®žè·µæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ç³»ç»Ÿå†…çš„æ•°æ®æŒ‰ç…§ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œè¦æ±‚è¿›è¡Œåˆ†ç±»ï¼Œæ¯ç±»æ•°æ®é€‰æ‹©ä¸åŒçš„ç­–ç•¥ï¼ˆCP è¿˜æ˜¯ APï¼‰ï¼Œè€Œä¸æ˜¯ç›´æŽ¥é™å®šæ•´ä¸ªç³»ç»Ÿæ‰€æœ‰æ•°æ®éƒ½æ˜¯åŒä¸€ç­–ç•¥ã€‚ å¦å¤–ï¼Œåªèƒ½é€‰æ‹©CPæˆ–è€…APæ˜¯æŒ‡ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºçŽ°è±¡æ—¶æ— æ³•åŒæ—¶ä¿è¯Cï¼ˆä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œä½†ä¸æ˜¯æ„å‘³ç€ä»€ä¹ˆéƒ½ä¸åšï¼Œå½“åˆ†åŒºæ•…éšœè§£å†³åŽï¼Œç³»ç»Ÿè¿˜æ˜¯è¦ä¿æŒä¿è¯CAã€‚ BASEç†è®º BASE æ˜¯ Basically Available(åŸºæœ¬å¯ç”¨)ã€Soft state(è½¯çŠ¶æ€)å’Œ Eventually consistent (æœ€ç»ˆä¸€è‡´æ€§)ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚æ˜¯å¯¹CAPä¸­APçš„ä¸€ä¸ªæ‰©å±• åŸºæœ¬å¯ç”¨:åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºçŽ°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨åŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚æ¯”å¦‚æœåŠ¡é™çº§ã€é¡µé¢é™çº§ã€‚ è½¯çŠ¶æ€:å…è®¸ç³»ç»Ÿä¸­å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸å½±å“ç³»ç»Ÿå¯ç”¨æ€§ã€‚ è¿™é‡Œçš„ä¸­é—´çŠ¶æ€æ˜¯æŒ‡ä¸åŒçš„data replicationä¹‹é—´çš„æ•°æ®æ›´æ–°å¯ä»¥å‡ºçŽ°å»¶æ—¶çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚ å¦‚CAPç†è®ºé‡Œé¢çš„ç¤ºä¾‹ï¼Œå½“å‘machine1çš„db1çš„è¡¨tbl_personã€tbl_orderæ’å…¥æ•°æ•°æ®æ—¶ï¼ŒåŒæ—¶è¦æŠŠæ’å…¥çš„æ•°æ®åŒæ­¥åˆ°machine2ã€machine3ï¼Œå½“machine3çš„ç½‘ç»œæœ‰é—®é¢˜æ—¶ï¼ŒåŒæ­¥å¤±è´¥ï¼Œä½†æ˜¯è¿‡ä¸€ä¼šç½‘ç»œæ¢å¤äº†å°±åŒæ­¥æˆåŠŸäº†ï¼Œè¿™ä¸ªåŒæ­¥å¤±è´¥çš„çŠ¶æ€å°±ç§°ä¸ºè½¯çŠ¶æ€ï¼Œå› ä¸ºæœ€ç»ˆè¿˜æ˜¯åŒæ­¥æˆåŠŸäº†ã€‚ æœ€ç»ˆä¸€è‡´:æœ€ç»ˆä¸€è‡´æ˜¯æŒ‡ç»è¿‡ä¸€æ®µæ—¶é—´åŽï¼Œæ‰€æœ‰èŠ‚ç‚¹æ•°æ®éƒ½å°†ä¼šè¾¾åˆ°ä¸€è‡´ã€‚ BASEè§£å†³äº†CAPä¸­ç†è®ºæ²¡æœ‰ç½‘ç»œå»¶è¿Ÿï¼Œåœ¨BASEä¸­ç”¨è½¯çŠ¶æ€å’Œæœ€ç»ˆä¸€è‡´ï¼Œä¿è¯äº†å»¶è¿ŸåŽçš„ä¸€è‡´æ€§ã€‚BASEå’Œ ACID æ˜¯ç›¸åçš„ï¼Œå®ƒå®Œå…¨ä¸åŒäºŽACIDçš„å¼ºä¸€è‡´æ€§æ¨¡åž‹ï¼Œè€Œæ˜¯é€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥èŽ·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚ æ•°æ®ä¸€è‡´æ€§æ¨¡åž‹ æ•°æ®çš„ä¸€è‡´æ€§æ¨¡åž‹å¯ä»¥åˆ†æˆä»¥ä¸‹ 3 ç±»ï¼š å¼ºä¸€è‡´æ€§ï¼šæ•°æ®æ›´æ–°æˆåŠŸåŽï¼Œä»»æ„æ—¶åˆ»æ‰€æœ‰å‰¯æœ¬ä¸­çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸€èˆ¬é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å®žçŽ°ã€‚ å¼±ä¸€è‡´æ€§ï¼šæ•°æ®æ›´æ–°æˆåŠŸåŽï¼Œç³»ç»Ÿä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¯»åˆ°æœ€æ–°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸æ‰¿è¯ºå…·ä½“å¤šä¹…ä¹‹åŽå¯ä»¥è¯»åˆ°ã€‚ æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼±ä¸€è‡´æ€§çš„ä¸€ç§å½¢å¼ï¼Œæ•°æ®æ›´æ–°æˆåŠŸåŽï¼Œç³»ç»Ÿä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¿”å›žæœ€æ–°å†™å…¥çš„å€¼ï¼Œä½†æ˜¯ä¿è¯æœ€ç»ˆä¼šè¿”å›žä¸Šä¸€æ¬¡æ›´æ–°æ“ä½œçš„å€¼ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯æŒ‡äº‹åŠ¡çš„å‚ä¸Žè€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºŽä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡å¤§çš„æ“ä½œç”±ä¸åŒçš„å°æ“ä½œç»„æˆï¼Œè¿™äº›å°çš„æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸”å±žäºŽä¸åŒçš„åº”ç”¨ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›å°æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†ä¿è¯ä¸åŒæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚ ä¸¾ä¸ªäº’è”ç½‘å¸¸ç”¨çš„äº¤æ˜“ä¸šåŠ¡ä¸ºä¾‹ï¼š ä¸Šå›¾ä¸­åŒ…å«äº†åº“å­˜å’Œè®¢å•ä¸¤ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡ç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®åº“ã€‚åœ¨äº¤æ˜“ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œä¸€ä¸ªå•†å“åœ¨ä¸‹å•ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨åº“å­˜æœåŠ¡ï¼Œè¿›è¡Œæ‰£é™¤åº“å­˜ï¼Œå†è°ƒç”¨è®¢å•æœåŠ¡ï¼Œåˆ›å»ºè®¢å•è®°å½•ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æžœå¤šä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ›´æ–°æ²¡æœ‰ä¿è¯äº‹åŠ¡ï¼Œå°†ä¼šå¯¼è‡´å‡ºçŽ°å­ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ï¼Œä¸šåŠ¡å‡ºçŽ°é—®é¢˜ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ 2PC 2PC = Two Phase commit äºŒé˜¶æ®µæäº¤ï¼ˆRDBMSï¼ˆå…³ç³»åž‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰ç»å¸¸å°±æ˜¯è¿™ç§æœºåˆ¶ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ï¼‰ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹è™½ç„¶å¯ä»¥çŸ¥æ™“è‡ªå·±çš„æ“ä½œæ—¶æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå´æ— æ³•çŸ¥é“å…¶ä»–èŠ‚ç‚¹çš„æ“ä½œçš„æˆåŠŸæˆ–å¤±è´¥ã€‚å½“ä¸€ä¸ªäº‹åŠ¡è·¨è¶Šå¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¸ºäº†ä¿æŒäº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªä½œä¸ºåè°ƒè€…çš„ç»„ä»¶æ¥ç»Ÿä¸€æŽŒæŽ§æ‰€æœ‰èŠ‚ç‚¹ï¼ˆç§°ä½œå‚ä¸Žè€…ï¼‰çš„æ“ä½œç»“æžœå¹¶æœ€ç»ˆæŒ‡ç¤ºè¿™äº›èŠ‚ç‚¹æ˜¯å¦è¦æŠŠæ“ä½œç»“æžœè¿›è¡ŒçœŸæ­£çš„æäº¤ã€‚ ç®—æ³•æ€è·¯ å‚ä¸Žè€…å°†æ“ä½œæˆè´¥é€šçŸ¥åè°ƒè€…ï¼Œå†ç”±åè°ƒè€…æ ¹æ®æ‰€æœ‰å‚ä¸Žè€…çš„åé¦ˆæƒ…æŠ¥å†³å®šå„å‚ä¸Žè€…æ˜¯å¦è¦æäº¤æ“ä½œè¿˜æ˜¯ä¸­æ­¢æ“ä½œã€‚ æ ¸å¿ƒæ€æƒ³ å¯¹æ¯ä¸€ä¸ªäº‹åŠ¡éƒ½é‡‡ç”¨å…ˆå°è¯•åŽæäº¤çš„å¤„ç†æ–¹å¼ï¼Œå¤„ç†åŽæ‰€æœ‰çš„è¯»æ“ä½œéƒ½è¦èƒ½èŽ·å¾—æœ€æ–°çš„æ•°æ®ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°†äºŒé˜¶æ®µæäº¤çœ‹ä½œæ˜¯ä¸€ä¸ªå¼ºä¸€è‡´æ€§ç®—æ³•ã€‚ å¤„ç†æµç¨‹ &lt;font color=&quot;green&quot;&gt;é˜¶æ®µ1ï¼šæäº¤äº‹åŠ¡è¯·æ±‚ï¼ˆæŠ•ç¥¨é˜¶æ®µï¼‰è¯¢é—®æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡&lt;/font&gt; è¿›ä¸€æ­¥å°†å‡†å¤‡é˜¶æ®µåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œæäº¤æ“ä½œ(vote)ï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸Žè€…èŠ‚ç‚¹çš„å“åº”ã€‚ 2ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹æ‰§è¡Œè¯¢é—®å‘èµ·ä¸ºæ­¢çš„æ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoä¿¡æ¯å’ŒRedoä¿¡æ¯å†™å…¥æ—¥å¿—ã€‚ï¼ˆæ³¨æ„ï¼šè‹¥æˆåŠŸè¿™é‡Œå…¶å®žæ¯ä¸ªå‚ä¸Žè€…å·²ç»æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼‰ 3ï¼‰å„å‚ä¸Žè€…èŠ‚ç‚¹å“åº”åè°ƒè€…èŠ‚ç‚¹å‘èµ·çš„è¯¢é—®ã€‚å¦‚æžœå‚ä¸Žè€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®žé™…æ‰§è¡ŒæˆåŠŸï¼Œåˆ™å®ƒè¿”å›žä¸€ä¸ª&quot;åŒæ„&quot;æ¶ˆæ¯ï¼›å¦‚æžœå‚ä¸Žè€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®žé™…æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å®ƒè¿”å›žä¸€ä¸ª&quot;ä¸­æ­¢&quot;æ¶ˆæ¯ã€‚ &lt;font color=&quot;green&quot;&gt;é˜¶æ®µ2ï¼šæ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆcommitã€rollbackï¼‰ çœŸæ­£çš„æäº¤äº‹åŠ¡&lt;/font&gt; å¦‚æžœåè°ƒè€…æ”¶åˆ°äº†å‚ä¸Žè€…çš„å¤±è´¥æ¶ˆæ¯æˆ–è€…è¶…æ—¶ï¼Œç›´æŽ¥ç»™æ¯ä¸ªå‚ä¸Žè€…å‘é€å›žæ»š(Rollback)æ¶ˆæ¯ï¼› å¦åˆ™ï¼Œå‘é€æäº¤(Commit)æ¶ˆæ¯ï¼›å‚ä¸Žè€…æ ¹æ®åè°ƒè€…çš„æŒ‡ä»¤æ‰§è¡Œæäº¤æˆ–è€…å›žæ»šæ“ä½œï¼Œé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚(æ³¨æ„:å¿…é¡»åœ¨æœ€åŽé˜¶æ®µé‡Šæ”¾é”èµ„æº)ã€‚ &lt;font color=&quot;blue&quot;&gt;å½“åè°ƒè€…èŠ‚ç‚¹ä»Žæ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹èŽ·å¾—çš„å“åº”æ¶ˆæ¯éƒ½ä¸º&quot;åŒæ„&quot;æ—¶:&lt;/font&gt; 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹å‘å‡º&quot;æ­£å¼æäº¤(commit)&quot;çš„è¯·æ±‚ã€‚ 2ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹æ­£å¼å®Œæˆæ“ä½œï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚ 3ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹åé¦ˆack(åº”ç­”)&quot;å®Œæˆ&quot;æ¶ˆæ¯ã€‚ 4ï¼‰åè°ƒè€…èŠ‚ç‚¹æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹åé¦ˆçš„ackåº”ç­”&quot;å®Œæˆ&quot;æ¶ˆæ¯åŽï¼Œå®Œæˆäº‹åŠ¡ã€‚ &lt;font color=&quot;blue&quot;&gt;å¦‚æžœä»»ä¸€å‚ä¸Žè€…èŠ‚ç‚¹åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›žçš„å“åº”æ¶ˆæ¯ä¸º&quot;ä¸­æ­¢&quot;ï¼Œæˆ–è€… åè°ƒè€…èŠ‚ç‚¹åœ¨ç¬¬ä¸€é˜¶æ®µçš„è¯¢é—®è¶…æ—¶ä¹‹å‰æ— æ³•èŽ·å–æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹çš„å“åº”æ¶ˆæ¯æ—¶ï¼š&lt;/font&gt; 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹å‘å‡º&quot;å›žæ»šæ“ä½œ(rollback)&quot;çš„è¯·æ±‚ã€‚ 2ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹åˆ©ç”¨ä¹‹å‰å†™å…¥çš„Undoä¿¡æ¯æ‰§è¡Œå›žæ»šï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚ 3ï¼‰å‚ä¸Žè€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹å‘é€&quot;å›žæ»šå®Œæˆ&quot;æ¶ˆæ¯ã€‚ 4ï¼‰åè°ƒè€…èŠ‚ç‚¹æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…èŠ‚ç‚¹åé¦ˆçš„&quot;å›žæ»šå®Œæˆ&quot;æ¶ˆæ¯åŽï¼Œå–æ¶ˆäº‹åŠ¡ã€‚ &lt;font color=&quot;red&quot;&gt;ä¸ç®¡æœ€åŽç»“æžœå¦‚ä½•ï¼Œç¬¬äºŒé˜¶æ®µéƒ½ä¼šç»“æŸå½“å‰äº‹åŠ¡ã€‚&lt;/font&gt; å­˜åœ¨çš„é—®é¢˜ 1ã€åŒæ­¥é˜»å¡žé—®é¢˜ã€‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å‚ä¸ŽèŠ‚ç‚¹éƒ½æ˜¯äº‹åŠ¡é˜»å¡žåž‹çš„ã€‚å½“å‚ä¸Žè€…å æœ‰å…¬å…±èµ„æºæ—¶ï¼Œå…¶ä»–ç¬¬ä¸‰æ–¹èŠ‚ç‚¹è®¿é—®å…¬å…±èµ„æºä¸å¾—ä¸å¤„äºŽé˜»å¡žçŠ¶æ€ã€‚ 2ã€å•ç‚¹æ•…éšœã€‚ç”±äºŽåè°ƒè€…çš„é‡è¦æ€§ï¼Œä¸€æ—¦åè°ƒè€…å‘ç”Ÿæ•…éšœã€‚å‚ä¸Žè€…ä¼šä¸€ç›´é˜»å¡žä¸‹åŽ»ã€‚å°¤å…¶åœ¨ç¬¬äºŒé˜¶æ®µï¼Œåè°ƒè€…å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å‚ä¸Žè€…è¿˜éƒ½å¤„äºŽé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œè€Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚ï¼ˆå¦‚æžœæ˜¯åè°ƒè€…æŒ‚æŽ‰ï¼Œå¯ä»¥é‡æ–°é€‰ä¸¾ä¸€ä¸ªåè°ƒè€…ï¼Œä½†æ˜¯æ— æ³•è§£å†³å› ä¸ºåè°ƒè€…å®•æœºå¯¼è‡´çš„å‚ä¸Žè€…å¤„äºŽé˜»å¡žçŠ¶æ€çš„é—®é¢˜ï¼‰ 3ã€æ•°æ®ä¸ä¸€è‡´ã€‚åœ¨äºŒé˜¶æ®µæäº¤çš„é˜¶æ®µäºŒä¸­ï¼Œå½“åè°ƒè€…å‘å‚ä¸Žè€…å‘é€commitè¯·æ±‚ä¹‹åŽï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–è€…åœ¨å‘é€commitè¯·æ±‚è¿‡ç¨‹ä¸­åè°ƒè€…å‘ç”Ÿäº†æ•…éšœï¼Œè¿™ä¼šå¯¼è‡´åªæœ‰ä¸€éƒ¨åˆ†å‚ä¸Žè€…æŽ¥å—åˆ°äº†commitè¯·æ±‚ã€‚è€Œåœ¨è¿™éƒ¨åˆ†å‚ä¸Žè€…æŽ¥åˆ°commitè¯·æ±‚ä¹‹åŽå°±ä¼šæ‰§è¡Œcommitæ“ä½œã€‚ä½†æ˜¯å…¶ä»–æœªæŽ¥åˆ°commitè¯·æ±‚çš„æœºå™¨åˆ™æ— æ³•æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚äºŽæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿å‡ºçŽ°äº†æ•°æ®ä¸ä¸€è‡´æ€§çš„çŽ°è±¡ã€‚ 4ã€äºŒé˜¶æ®µæ— æ³•è§£å†³çš„é—®é¢˜ï¼šåè°ƒè€…å†å‘å‡ºcommitæ¶ˆæ¯ä¹‹åŽå®•æœºï¼Œè€Œå”¯ä¸€æŽ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸Žè€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚ &lt;font color=&quot;red&quot;&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨å…¨å±€äº‹åŠ¡å†³å®šå›žæ»šæ—¶ï¼Œç›´æŽ¥é€ä¸ªå‘é€rollbackè¯·æ±‚å³å¯ï¼Œä¸å¿…åˆ†é˜¶æ®µã€‚&lt;/font&gt; 2PCæœºåˆ¶éœ€è¦RMæä¾›åº•å±‚æ”¯æŒï¼ˆä¸€èˆ¬æ˜¯å…¼å®¹XAï¼‰ã€‚å¦‚æžœä½¿ç”¨Javaï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¼€æºè½¯ä»¶ atomikos æˆ–è€…JOTMæ¥å¿«é€Ÿå®žçŽ°ï¼Œä¸¤è€…éƒ½æ”¯æŒspringäº‹åŠ¡æ•´åˆã€‚ 3PC 3PC = Three Phase commit ä¸‰é˜¶æ®µæäº¤ ç”±äºŽäºŒé˜¶æ®µæäº¤å­˜åœ¨ç€è¯¸å¦‚åŒæ­¥é˜»å¡žã€å•ç‚¹é—®é¢˜ã€è„‘è£‚ç­‰ç¼ºé™·ï¼Œæ‰€ä»¥ï¼Œåœ¨äºŒé˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œæå‡ºäº†ä¸‰é˜¶æ®µæäº¤ã€‚ ä¸Žä¸¤é˜¶æ®µæäº¤ä¸åŒçš„æ˜¯ï¼Œä¸‰é˜¶æ®µæäº¤æœ‰ä¸¤ä¸ªæ”¹åŠ¨ç‚¹ï¼š 1ã€å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸Žè€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚ 2ã€å°†äºŒé˜¶æ®µçš„å‡†å¤‡é˜¶æ®µæ‹†åˆ†ä¸º2ä¸ªé˜¶æ®µï¼Œæ’å…¥äº†ä¸€ä¸ªpreCommité˜¶æ®µï¼Œä½¿å¾—åŽŸå…ˆåœ¨äºŒé˜¶æ®µæäº¤ä¸­ï¼Œå‚ä¸Žè€…åœ¨å‡†å¤‡ä¹‹åŽï¼Œç”±äºŽåè°ƒè€…å‘ç”Ÿå´©æºƒæˆ–é”™è¯¯ï¼Œè€Œå¯¼è‡´å‚ä¸Žè€…å¤„äºŽæ— æ³•çŸ¥æ™“æ˜¯å¦æäº¤æˆ–è€…ä¸­æ­¢çš„â€œä¸ç¡®å®šçŠ¶æ€â€æ‰€äº§ç”Ÿçš„å¯èƒ½ç›¸å½“é•¿çš„å»¶æ—¶çš„é—®é¢˜å¾—ä»¥è§£å†³ã€‚ä¿è¯äº†åœ¨æœ€åŽæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸ŽèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚ å¤„ç†æµç¨‹ &lt;font color=&quot;green&quot;&gt;é˜¶æ®µ1ï¼šCanCommité˜¶æ®µï¼Œæ˜¯å¦æäº¤-è¯¢é—®æ˜¯å¦å¯ä»¥åšäº‹åŠ¡æäº¤&lt;/font&gt; äº‹åŠ¡è¯¢é—®ï¼šåè°ƒè€…å‘å‚ä¸Žè€…å‘é€CanCommitè¯·æ±‚ã€‚è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œã€‚ç„¶åŽå¼€å§‹ç­‰å¾…å‚ä¸Žè€…çš„å“åº”ã€‚ å“åº”åé¦ˆï¼šå‚ä¸Žè€…æŽ¥åˆ°CanCommitè¯·æ±‚ä¹‹åŽï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æžœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›žYeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ã€‚å¦åˆ™åé¦ˆNoã€‚ &lt;font color=&quot;green&quot;&gt;é˜¶æ®µ2ï¼šPreCommité˜¶æ®µï¼Œé¢„å…ˆæäº¤-é¢„å…ˆæäº¤äº‹åŠ¡&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;å‡å¦‚åè°ƒè€…ä»Žæ‰€æœ‰çš„å‚ä¸Žè€…èŽ·å¾—çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡çš„é¢„æ‰§è¡Œã€‚&lt;/font&gt; å‘é€é¢„æäº¤è¯·æ±‚ï¼šåè°ƒè€…å‘å‚ä¸Žè€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µã€‚ äº‹åŠ¡é¢„æäº¤ï¼šå‚ä¸Žè€…æŽ¥æ”¶åˆ°PreCommitè¯·æ±‚åŽï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚ å“åº”åé¦ˆï¼šå¦‚æžœå‚ä¸Žè€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›žACKå“åº”ï¼ŒåŒæ—¶å¼€å§‹ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ã€‚ &lt;font color=&quot;blue&quot;&gt;å‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸Žè€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æŽ¥åˆ°å‚ä¸Žè€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚&lt;/font&gt; 1.å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€abortè¯·æ±‚ã€‚ 2.ä¸­æ–­äº‹åŠ¡ï¼šå‚ä¸Žè€…æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ä¹‹åŽï¼ˆæˆ–è¶…æ—¶ä¹‹åŽï¼Œä»æœªæ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼‰ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚ &lt;font color=&quot;green&quot;&gt;é˜¶æ®µ3ï¼šdoCommité˜¶æ®µï¼Œæ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆcommitã€rollbackï¼‰çœŸæ­£çš„æäº¤äº‹åŠ¡æ‰§è¡Œæäº¤&lt;/font&gt; å‘é€æäº¤è¯·æ±‚ï¼šåè°ƒè€…æŽ¥æ”¶åˆ°å‚ä¸Žè€…å‘é€çš„ACKå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»Žé¢„æäº¤çŠ¶æ€è¿›å…¥åˆ°æäº¤çŠ¶æ€ã€‚å¹¶å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€doCommitè¯·æ±‚ã€‚ äº‹åŠ¡æäº¤ï¼šå‚ä¸Žè€…æŽ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åŽï¼Œæ‰§è¡Œæ­£å¼çš„äº‹åŠ¡æäº¤ã€‚å¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åŽé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºã€‚ å“åº”åé¦ˆï¼šäº‹åŠ¡æäº¤å®Œä¹‹åŽï¼Œå‘åè°ƒè€…å‘é€Ackå“åº”ã€‚ å®Œæˆäº‹åŠ¡ï¼šåè°ƒè€…æŽ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„ackå“åº”ä¹‹åŽï¼Œå®Œæˆäº‹åŠ¡ã€‚ &lt;font color=&quot;blue&quot;&gt;ä¸­æ–­äº‹åŠ¡ åè°ƒè€…æ²¡æœ‰æŽ¥æ”¶åˆ°å‚ä¸Žè€…å‘é€çš„ACKå“åº”ï¼ˆå¯èƒ½æ˜¯æŽ¥å—è€…å‘é€çš„ä¸æ˜¯ACKå“åº”ï¼Œä¹Ÿå¯èƒ½å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ã€‚&lt;/font&gt; å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸Žè€…å‘é€abortè¯·æ±‚ã€‚ äº‹åŠ¡å›žæ»šï¼šå‚ä¸Žè€…æŽ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åŽï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›žæ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›žæ»šä¹‹åŽé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºã€‚ åé¦ˆç»“æžœï¼šå‚ä¸Žè€…å®Œæˆäº‹åŠ¡å›žæ»šä¹‹åŽï¼Œå‘åè°ƒè€…å‘é€ACKæ¶ˆæ¯ã€‚ ä¸­æ–­äº‹åŠ¡ï¼šåè°ƒè€…æŽ¥æ”¶åˆ°å‚ä¸Žè€…åé¦ˆçš„ACKæ¶ˆæ¯ä¹‹åŽï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt;åœ¨doCommité˜¶æ®µï¼Œå¦‚æžœå‚ä¸Žè€…æ— æ³•åŠæ—¶æŽ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…rebortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚ï¼ˆå…¶å®žè¿™ä¸ªåº”è¯¥æ˜¯åŸºäºŽæ¦‚çŽ‡æ¥å†³å®šçš„ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œè¯´æ˜Žå‚ä¸Žè€…åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»æ”¶åˆ°äº†PreCommitè¯·æ±‚ï¼Œé‚£ä¹ˆåè°ƒè€…äº§ç”ŸPreCommitè¯·æ±‚çš„å‰ææ¡ä»¶æ˜¯ä»–åœ¨ç¬¬äºŒé˜¶æ®µå¼€å§‹ä¹‹å‰ï¼Œæ”¶åˆ°æ‰€æœ‰å‚ä¸Žè€…çš„CanCommitå“åº”éƒ½æ˜¯Yesã€‚ï¼ˆä¸€æ—¦å‚ä¸Žè€…æ”¶åˆ°äº†PreCommitï¼Œæ„å‘³ä»–çŸ¥é“å¤§å®¶å…¶å®žéƒ½åŒæ„ä¿®æ”¹äº†ï¼‰æ‰€ä»¥ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œç”±äºŽç½‘ç»œè¶…æ—¶ç­‰åŽŸå› ï¼Œè™½ç„¶å‚ä¸Žè€…æ²¡æœ‰æ”¶åˆ°commitæˆ–è€…abortå“åº”ï¼Œä½†æ˜¯ä»–æœ‰ç†ç”±ç›¸ä¿¡ï¼šæˆåŠŸæäº¤çš„å‡ çŽ‡å¾ˆå¤§ã€‚ï¼‰&lt;/p&gt; 2PCä¸Ž3PCçš„åŒºåˆ« ç›¸å¯¹äºŽ2PCï¼Œ3PCä¸»è¦è§£å†³çš„å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå¹¶å‡å°‘é˜»å¡žï¼Œå› ä¸ºä¸€æ—¦å‚ä¸Žè€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åŽï¼Œä»–ä¼šé»˜è®¤æ‰§è¡Œcommitã€‚è€Œä¸ä¼šä¸€ç›´æŒæœ‰äº‹åŠ¡èµ„æºå¹¶å¤„äºŽé˜»å¡žçŠ¶æ€ã€‚ä½†æ˜¯è¿™ç§æœºåˆ¶ä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå› ä¸ºï¼Œç”±äºŽç½‘ç»œåŽŸå› ï¼Œåè°ƒè€…å‘é€çš„abortå“åº”æ²¡æœ‰åŠæ—¶è¢«å‚ä¸Žè€…æŽ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆå‚ä¸Žè€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åŽæ‰§è¡Œäº†commitæ“ä½œã€‚è¿™æ ·å°±å’Œå…¶ä»–æŽ¥åˆ°abortå‘½ä»¤å¹¶æ‰§è¡Œå›žæ»šçš„å‚ä¸Žè€…ä¹‹é—´å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ç›®å‰ä¸¤é˜¶æ®µæäº¤ã€ä¸‰é˜¶æ®µæäº¤å­˜åœ¨å¦‚ä¸‹çš„å±€é™æ€§ï¼Œå¹¶ä¸é€‚åˆåœ¨å¾®æœåŠ¡æž¶æž„ä½“ç³»ä¸‹ä½¿ç”¨ï¼š æ‰€æœ‰çš„æ“ä½œå¿…é¡»æ˜¯äº‹åŠ¡æ€§èµ„æºï¼ˆæ¯”å¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€EJBç»„ä»¶ç­‰ï¼‰ï¼Œå­˜åœ¨ä½¿ç”¨å±€é™æ€§ï¼ˆå¾®æœåŠ¡æž¶æž„ä¸‹å¤šæ•°ä½¿ç”¨HTTPåè®®ï¼‰ï¼Œæ¯”è¾ƒé€‚åˆä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼› ç”±äºŽæ˜¯å¼ºä¸€è‡´æ€§ï¼Œèµ„æºéœ€è¦åœ¨äº‹åŠ¡å†…éƒ¨ç­‰å¾…ï¼Œæ€§èƒ½å½±å“è¾ƒå¤§ï¼ŒåžåçŽ‡ä¸é«˜ï¼Œä¸é€‚åˆé«˜å¹¶å‘ä¸Žé«˜æ€§èƒ½çš„ä¸šåŠ¡åœºæ™¯ï¼› TCCäº‹åŠ¡ TCCäº‹åŠ¡æœºåˆ¶ç›¸å¯¹äºŽä¼ ç»Ÿäº‹åŠ¡æœºåˆ¶ï¼ˆX/Open XAï¼‰ï¼Œå…¶ç‰¹å¾åœ¨äºŽå®ƒä¸ä¾èµ–èµ„æºç®¡ç†å™¨(RM)å¯¹XAçš„æ”¯æŒï¼Œè€Œæ˜¯é€šè¿‡å¯¹ï¼ˆç”±ä¸šåŠ¡ç³»ç»Ÿæä¾›çš„ï¼‰ä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦æ¥å®žçŽ°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ è§£å†³äº†XAçš„å‡ ä¸ªç¼ºç‚¹: è§£å†³äº†åè°ƒè€…å•ç‚¹ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶å®Œæˆè¿™ä¸ªä¸šåŠ¡æ´»åŠ¨ã€‚ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ä¹Ÿå˜æˆå¤šç‚¹ï¼Œå¼•å…¥é›†ç¾¤ã€‚ åŒæ­¥é˜»å¡ž:å¼•å…¥è¶…æ—¶ï¼Œè¶…æ—¶åŽè¿›è¡Œè¡¥å¿ï¼Œå¹¶ä¸”ä¸ä¼šé”å®šæ•´ä¸ªèµ„æºï¼Œå°†èµ„æºè½¬æ¢ä¸ºä¸šåŠ¡é€»è¾‘å½¢å¼ï¼Œç²’åº¦å˜å°ã€‚ æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰äº†è¡¥å¿æœºåˆ¶ä¹‹åŽï¼Œç”±ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨æŽ§åˆ¶ä¸€è‡´æ€§ ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt;ä¸€ä¸ªå®Œæ•´çš„TCCä¸šåŠ¡ç”±ä¸€ä¸ªä¸»ä¸šåŠ¡æœåŠ¡å’Œè‹¥å¹²ä¸ªä»Žä¸šåŠ¡æœåŠ¡ç»„æˆï¼Œä¸»ä¸šåŠ¡æœåŠ¡å‘èµ·å¹¶å®Œæˆæ•´ä¸ªä¸šåŠ¡æ´»åŠ¨ï¼ŒTCCæ¨¡å¼è¦æ±‚ä»ŽæœåŠ¡æä¾›ä¸‰ä¸ªæŽ¥å£ï¼šTryã€Confirmã€Cancelã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt;Tryï¼šå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼Œé¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt;Confirmï¼šçœŸæ­£æ‰§è¡Œä¸šåŠ¡ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼›åªä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼›Confirmæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt;Cancelï¼šé‡Šæ”¾Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼›Cancelæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚&lt;/p&gt; æ•´ä¸ªTCCä¸šåŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µå®Œæˆï¼š &lt;span id=&quot;inline-blue&quot;&gt;ç¬¬ä¸€é˜¶æ®µï¼š&lt;/span&gt; ä¸»ä¸šåŠ¡æœåŠ¡åˆ†åˆ«è°ƒç”¨æ‰€æœ‰ä»Žä¸šåŠ¡çš„tryæ“ä½œï¼Œå¹¶åœ¨æ´»åŠ¨ç®¡ç†å™¨ä¸­ç™»è®°æ‰€æœ‰ä»Žä¸šåŠ¡æœåŠ¡ã€‚å½“æ‰€æœ‰ä»Žä¸šåŠ¡æœåŠ¡çš„tryæ“ä½œéƒ½è°ƒç”¨æˆåŠŸæˆ–è€…æŸä¸ªä»Žä¸šåŠ¡æœåŠ¡çš„tryæ“ä½œå¤±è´¥ï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚ &lt;span id=&quot;inline-blue&quot;&gt;ç¬¬äºŒé˜¶æ®µï¼š&lt;/span&gt; æ´»åŠ¨ç®¡ç†å™¨æ ¹æ®ç¬¬ä¸€é˜¶æ®µçš„æ‰§è¡Œç»“æžœæ¥æ‰§è¡Œconfirmæˆ–cancelæ“ä½œã€‚å¦‚æžœç¬¬ä¸€é˜¶æ®µæ‰€æœ‰tryæ“ä½œéƒ½æˆåŠŸï¼Œåˆ™æ´»åŠ¨ç®¡ç†å™¨è°ƒç”¨æ‰€æœ‰ä»Žä¸šåŠ¡æ´»åŠ¨çš„confirmæ“ä½œã€‚å¦åˆ™è°ƒç”¨æ‰€æœ‰ä»Žä¸šåŠ¡æœåŠ¡çš„cancelæ“ä½œã€‚ &lt;span id=&quot;inline-purple&quot;&gt;ä¸Ž2PCæ¯”è¾ƒï¼š&lt;/span&gt; ä½äºŽä¸šåŠ¡æœåŠ¡å±‚è€Œéžèµ„æºå±‚ã€‚ æ²¡æœ‰å•ç‹¬çš„å‡†å¤‡ï¼ˆprepareï¼‰é˜¶æ®µï¼ŒTryæ“ä½œå…¼å¤‡èµ„æºæ“ä½œä¸Žå‡†å¤‡èƒ½åŠ›ã€‚ Tryæ“ä½œå¯ä»¥çµæ´»é€‰æ‹©ä¸šåŠ¡èµ„æºçš„é”å®šç²’åº¦ã€‚ å¼€å‘æˆæœ¬è¾ƒé«˜ã€‚ &lt;span id=&quot;inline-green&quot;&gt;ç¼ºç‚¹ï¼š&lt;/span&gt; Canfirmå’ŒCancelçš„å¹‚ç­‰æ€§å¾ˆéš¾ä¿è¯ã€‚ è¿™ç§æ–¹å¼ç¼ºç‚¹æ¯”è¾ƒå¤šï¼Œé€šå¸¸åœ¨å¤æ‚åœºæ™¯ä¸‹æ˜¯ä¸æŽ¨èä½¿ç”¨çš„ï¼Œé™¤éžæ˜¯éžå¸¸ç®€å•çš„åœºæ™¯ï¼Œéžå¸¸å®¹æ˜“æä¾›å›žæ»šCancelï¼Œè€Œä¸”ä¾èµ–çš„æœåŠ¡ä¹Ÿéžå¸¸å°‘çš„æƒ…å†µã€‚ è¿™ç§å®žçŽ°æ–¹å¼ä¼šé€ æˆä»£ç é‡åºžå¤§ï¼Œè€¦åˆæ€§é«˜ã€‚è€Œä¸”éžå¸¸æœ‰å±€é™æ€§ï¼Œå› ä¸ºæœ‰å¾ˆå¤šçš„ä¸šåŠ¡æ˜¯æ— æ³•å¾ˆç®€å•çš„å®žçŽ°å›žæ»šçš„ï¼Œå¦‚æžœä¸²è¡Œçš„æœåŠ¡å¾ˆå¤šï¼Œå›žæ»šçš„æˆæœ¬å®žåœ¨å¤ªé«˜ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ï¼‰ æœ¬åœ°æ¶ˆæ¯è¡¨çš„æ–¹æ¡ˆæœ€åˆæ˜¯ç”±ebayæå‡ºï¼Œæ ¸å¿ƒæ€è·¯æ˜¯å°†åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆæœ¬åœ°äº‹åŠ¡è¿›è¡Œå¤„ç†ã€‚é€šè¿‡åœ¨äº‹åŠ¡ä¸»åŠ¨å‘èµ·æ–¹é¢å¤–æ–°å»ºäº‹åŠ¡æ¶ˆæ¯è¡¨ï¼Œäº‹åŠ¡å‘èµ·æ–¹å¤„ç†ä¸šåŠ¡å’Œè®°å½•äº‹åŠ¡æ¶ˆæ¯åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆï¼Œè½®è¯¢äº‹åŠ¡æ¶ˆæ¯è¡¨çš„æ•°æ®å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºŽæ¶ˆæ¯ä¸­é—´ä»¶æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯è¡¨ä¸­çš„äº‹åŠ¡ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ï¼šæœ¬åœ°æ¶ˆæ¯è¡¨ä¸Žä¸šåŠ¡æ•°æ®è¡¨å¤„äºŽåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ å¤„ç†æµç¨‹ æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æœ€å…ˆå¼€å§‹å¤„ç†çš„äº‹åŠ¡æ–¹æˆä¸ºäº‹åŠ¡ä¸»åŠ¨æ–¹ï¼Œåœ¨äº‹åŠ¡ä¸»åŠ¨æ–¹ä¹‹åŽå¤„ç†çš„ä¸šåŠ¡å†…çš„å…¶ä»–äº‹åŠ¡æˆä¸ºäº‹åŠ¡è¢«åŠ¨æ–¹ã€‚æµç¨‹å¦‚ä¸‹å›¾ï¼š äº‹åŠ¡ä¸»åŠ¨æ–¹å¤„ç†æœ¬åœ°äº‹åŠ¡ã€‚ äº‹åŠ¡ä¸»åŠ¨å‘åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å¤„ç†ä¸šåŠ¡æ›´æ–°æ“ä½œå’Œå†™æ¶ˆæ¯è¡¨æ“ä½œã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­æ“ä½œ1ã€2ï¼‰ äº‹åŠ¡ä¸»åŠ¨æ–¹é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å¤„ç†äº‹åŠ¡é€šçŸ¥äº‹åŠ¡å¾…æ¶ˆæ¯ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥åŸºäºŽKafkaã€RocketMQæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹æ³•ä¸»åŠ¨å†™æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡æ¶ˆè´¹æ–¹æ¶ˆè´¹å¹¶å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­æ“ä½œ3ã€4ã€5ï¼‰ äº‹åŠ¡è¢«åŠ¨æ–¹é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€šçŸ¥äº‹åŠ¡ä¸»åŠ¨æ–¹äº‹åŠ¡å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­6ã€7ã€8ï¼‰ ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“å¤„ç†é”™è¯¯éœ€è¦é‡è¯•ï¼Œäº‹åŠ¡å‘é€æ–¹å’Œäº‹åŠ¡æŽ¥æ”¶æ–¹ç›¸å…³ä¸šåŠ¡å¤„ç†éœ€è¦æ”¯æŒå¹‚ç­‰ã€‚å…·ä½“ä¿å­˜ä¸€è‡´æ€§çš„å®¹é”™å¤„ç†å¦‚ä¸‹ï¼š 1ã€å½“æ­¥éª¤1å¤„ç†å‡ºé”™ï¼Œäº‹åŠ¡å›žæ»šï¼Œç›¸å½“äºŽä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚ 2ã€å½“æ­¥éª¤2ã€æ­¥éª¤3å¤„ç†å‡ºé”™ï¼Œç”±äºŽæœªå¤„ç†çš„äº‹åŠ¡æ¶ˆæ¯è¿˜æ˜¯ä¿å­˜åœ¨äº‹åŠ¡å‘é€æ–¹ï¼Œäº‹åŠ¡å‘é€æ–¹å¯ä»¥å®šæ—¶è½®è¯¢ä¸ºè¶…æ—¶æ¶ˆæ¯æ•°æ®ï¼Œå†æ¬¡å‘é€çš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œå¤„ç†ã€‚äº‹åŠ¡è¢«åŠ¨æ–¹æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯é‡è¯•å¤„ç†ã€‚ 3ã€å¦‚æžœæ˜¯ä¸šåŠ¡ä¸Šçš„å¤±è´¥ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹å¯ä»¥å‘æ¶ˆæ¯ç»™äº‹åŠ¡ä¸»åŠ¨æ–¹è¿›è¡Œå›žæ»šã€‚ 4ã€å¦‚æžœå¤šä¸ªäº‹åŠ¡è¢«åŠ¨æ–¹å·²ç»æ¶ˆè´¹æ¶ˆæ¯ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹éœ€è¦å›žæ»šäº‹åŠ¡æ—¶éœ€è¦é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å›žæ»šã€‚ ä¼˜ç‚¹ ä»Žåº”ç”¨è®¾è®¡å¼€å‘çš„è§’åº¦å®žçŽ°äº†æ¶ˆæ¯æ•°æ®çš„å¯é æ€§ï¼Œæ¶ˆæ¯æ•°æ®çš„å¯é æ€§ä¸ä¾èµ–äºŽæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¼±åŒ–äº†å¯¹MQä¸­é—´ä»¶ç‰¹æ€§çš„ä¾èµ–ã€‚ æ–¹æ¡ˆè½»é‡ï¼Œå®¹æ˜“å®žçŽ°ã€‚ ç¼ºç‚¹ ä¸Žå…·ä½“çš„ä¸šåŠ¡åœºæ™¯ç»‘å®šï¼Œè€¦åˆæ€§å¼ºï¼Œä¸å¯å…¬ç”¨ã€‚ æ¶ˆæ¯æ•°æ®ä¸Žä¸šåŠ¡æ•°æ®åŒåº“ï¼Œå ç”¨ä¸šåŠ¡ç³»ç»Ÿèµ„æºã€‚ ä¸šåŠ¡ç³»ç»Ÿåœ¨ä½¿ç”¨å…³ç³»åž‹æ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æœåŠ¡æ€§èƒ½ä¼šå—åˆ°å…³ç³»åž‹æ•°æ®åº“å¹¶å‘æ€§èƒ½çš„å±€é™ã€‚ ç»“åˆMQå®žçŽ°çš„å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ åŸºäºŽMQçš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå…¶å®žæ˜¯å¯¹æœ¬åœ°æ¶ˆæ¯è¡¨çš„å°è£…ï¼Œå°†æœ¬åœ°æ¶ˆæ¯è¡¨åŸºäºŽMQ å†…éƒ¨ï¼Œå…¶ä»–æ–¹é¢çš„åè®®åŸºæœ¬ä¸Žæœ¬åœ°æ¶ˆæ¯è¡¨ä¸€è‡´ã€‚ å¤„ç†æµç¨‹ ä»¥é˜¿é‡Œçš„ RocketMQ ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œåœ¨æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆä¸­ï¼Œä¿è¯äº‹åŠ¡ä¸»åŠ¨æ–¹å‘å†™ä¸šåŠ¡è¡¨æ•°æ®å’Œå†™æ¶ˆæ¯è¡¨æ•°æ®çš„ä¸€è‡´æ€§æ˜¯åŸºäºŽæ•°æ®åº“äº‹åŠ¡ï¼ŒRocketMQçš„äº‹åŠ¡æ¶ˆæ¯ç›¸å¯¹äºŽæ™®é€šMQï¼Œç›¸å¯¹äºŽæä¾›äº†2PCçš„æäº¤æŽ¥å£ï¼Œæ–¹æ¡ˆå¦‚ä¸‹ï¼š &lt;span id=&quot;inline-blue&quot;&gt;æ­£å¸¸æƒ…å†µâ€”â€”äº‹åŠ¡ä¸»åŠ¨æ–¹å‘æ¶ˆæ¯&lt;/span&gt; è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹æœåŠ¡æ­£å¸¸ï¼Œæ²¡æœ‰å‘ç”Ÿæ•…éšœï¼Œå‘æ¶ˆæ¯æµç¨‹å¦‚ä¸‹ï¼š 1ã€å‘é€æ–¹å‘ MQæœåŠ¡ç«¯(MQ Server)å‘é€halfæ¶ˆæ¯ã€‚ 2ã€MQ Server å°†æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸä¹‹åŽï¼Œå‘å‘é€æ–¹ ACK ç¡®è®¤æ¶ˆæ¯å·²ç»å‘é€æˆåŠŸã€‚ 3ã€å‘é€æ–¹å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘ã€‚ 4ã€å‘é€æ–¹æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æžœå‘ MQ Server æäº¤äºŒæ¬¡ç¡®è®¤ï¼ˆcommit æˆ–æ˜¯ rollbackï¼‰ã€‚ 5ã€MQ Server æ”¶åˆ° commit çŠ¶æ€åˆ™å°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æŠ•é€’ï¼Œè®¢é˜…æ–¹æœ€ç»ˆå°†æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼›MQ Server æ”¶åˆ° rollback çŠ¶æ€åˆ™åˆ é™¤åŠæ¶ˆæ¯ï¼Œè®¢é˜…æ–¹å°†ä¸ä¼šæŽ¥å—è¯¥æ¶ˆæ¯ã€‚ &lt;span id=&quot;inline-blue&quot;&gt;å¼‚å¸¸æƒ…å†µâ€”â€”äº‹åŠ¡ä¸»åŠ¨æ–¹æ¶ˆæ¯æ¢å¤&lt;/span&gt; åœ¨æ–­ç½‘æˆ–è€…åº”ç”¨é‡å¯ç­‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå‘é€æ–¹æäº¤çš„äºŒæ¬¡ç¡®è®¤è¶…æ—¶æœªåˆ°è¾¾ MQ Serverï¼Œæ­¤æ—¶å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š 5ã€MQ Server å¯¹è¯¥æ¶ˆæ¯å‘èµ·æ¶ˆæ¯å›žæŸ¥ã€‚ 6ã€å‘é€æ–¹æ”¶åˆ°æ¶ˆæ¯å›žæŸ¥åŽï¼Œéœ€è¦æ£€æŸ¥å¯¹åº”æ¶ˆæ¯çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡Œçš„æœ€ç»ˆç»“æžœã€‚ 7ã€å‘é€æ–¹æ ¹æ®æ£€æŸ¥å¾—åˆ°çš„æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€å†æ¬¡æäº¤äºŒæ¬¡ç¡®è®¤ã€‚ 8ã€MQ ServeråŸºäºŽcommit / rollback å¯¹æ¶ˆæ¯è¿›è¡ŒæŠ•é€’æˆ–è€…åˆ é™¤ã€‚ MQåˆ†å¸ƒå¼äº‹åŠ¡ äº‹åŠ¡ä¸»åŠ¨æ–¹åŸºäºŽMQé€šä¿¡é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å¤„ç†äº‹åŠ¡ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºŽMQè¿”å›žå¤„ç†ç»“æžœã€‚ å¦‚æžœäº‹åŠ¡è¢«åŠ¨æ–¹æ¶ˆè´¹æ¶ˆæ¯å¼‚å¸¸ï¼Œéœ€è¦ä¸æ–­é‡è¯•ï¼Œä¸šåŠ¡å¤„ç†é€»è¾‘éœ€è¦ä¿è¯å¹‚ç­‰ã€‚ å¦‚æžœæ˜¯äº‹åŠ¡è¢«åŠ¨æ–¹ä¸šåŠ¡ä¸Šçš„å¤„ç†å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡MQé€šçŸ¥äº‹åŠ¡ä¸»åŠ¨æ–¹è¿›è¡Œè¡¥å¿æˆ–è€…äº‹åŠ¡å›žæ»šã€‚ ä¼˜ç‚¹ æ¶ˆæ¯æ•°æ®ç‹¬ç«‹å­˜å‚¨ ï¼Œé™ä½Žä¸šåŠ¡ç³»ç»Ÿä¸Žæ¶ˆæ¯ç³»ç»Ÿä¹‹é—´çš„è€¦åˆã€‚ åžåé‡ç”±äºŽä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆã€‚ ç¼ºç‚¹ ä¸€æ¬¡æ¶ˆæ¯å‘é€éœ€è¦ä¸¤æ¬¡ç½‘ç»œè¯·æ±‚(halfæ¶ˆæ¯ã€commit/rollbackæ¶ˆæ¯)ã€‚ ä¸šåŠ¡å¤„ç†æœåŠ¡éœ€è¦å®žçŽ°æ¶ˆæ¯çŠ¶æ€å›žæŸ¥æŽ¥å£ã€‚ å°½æœ€å¤§åŠªåŠ›é€šçŸ¥ è¿™ç§æ–¹æ¡ˆä¸»è¦ç”¨åœ¨ä¸Žç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè®¯æ—¶ï¼Œæ¯”å¦‚ï¼šè°ƒç”¨å¾®ä¿¡æˆ–æ”¯ä»˜å®æ”¯ä»˜åŽçš„æ”¯ä»˜ç»“æžœé€šçŸ¥ã€‚è¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆMQè¿›è¡Œå®žçŽ°ï¼Œä¾‹å¦‚ï¼šé€šè¿‡MQå‘é€httpè¯·æ±‚ï¼Œè®¾ç½®æœ€å¤§é€šçŸ¥æ¬¡æ•°ã€‚è¾¾åˆ°é€šçŸ¥æ¬¡æ•°åŽå³ä¸å†é€šçŸ¥ã€‚ å¤„ç†æµç¨‹ ä¸šåŠ¡æ´»åŠ¨çš„ä¸»åŠ¨æ–¹ï¼Œåœ¨å®Œæˆä¸šåŠ¡å¤„ç†ä¹‹åŽï¼Œå‘ä¸šåŠ¡æ´»åŠ¨çš„è¢«åŠ¨æ–¹å‘é€æ¶ˆæ¯ï¼Œå…è®¸æ¶ˆæ¯ä¸¢å¤±ã€‚ ä¸»åŠ¨æ–¹å¯ä»¥è®¾ç½®æ—¶é—´é˜¶æ¢¯åž‹é€šçŸ¥è§„åˆ™ï¼Œåœ¨é€šçŸ¥å¤±è´¥åŽæŒ‰è§„åˆ™é‡å¤é€šçŸ¥ï¼Œç›´åˆ°é€šçŸ¥Næ¬¡åŽä¸å†é€šçŸ¥ã€‚ ä¸»åŠ¨æ–¹æä¾›æ ¡å¯¹æŸ¥è¯¢æŽ¥å£ç»™è¢«åŠ¨æ–¹æŒ‰éœ€æ ¡å¯¹æŸ¥è¯¢ï¼Œç”¨äºŽæ¢å¤ä¸¢å¤±çš„ä¸šåŠ¡æ¶ˆæ¯ã€‚ ä¸šåŠ¡æ´»åŠ¨çš„è¢«åŠ¨æ–¹å¦‚æžœæ­£å¸¸æŽ¥æ”¶äº†æ•°æ®ï¼Œå°±æ­£å¸¸è¿”å›žå“åº”ï¼Œå¹¶ç»“æŸäº‹åŠ¡ã€‚ å¦‚æžœè¢«åŠ¨æ–¹æ²¡æœ‰æ­£å¸¸æŽ¥æ”¶ï¼Œæ ¹æ®å®šæ—¶ç­–ç•¥ï¼Œå‘ä¸šåŠ¡æ´»åŠ¨ä¸»åŠ¨æ–¹æŸ¥è¯¢ï¼Œæ¢å¤ä¸¢å¤±çš„ä¸šåŠ¡æ¶ˆæ¯ æ–¹æ¡ˆç‰¹ç‚¹ ç”¨åˆ°çš„æœåŠ¡æ¨¡å¼ï¼šå¯æŸ¥è¯¢æ“ä½œã€å¹‚ç­‰æ“ä½œã€‚ è¢«åŠ¨æ–¹çš„å¤„ç†ç»“æžœä¸å½±å“ä¸»åŠ¨æ–¹çš„å¤„ç†ç»“æžœï¼› é€‚ç”¨äºŽå¯¹ä¸šåŠ¡æœ€ç»ˆä¸€è‡´æ€§çš„æ—¶é—´æ•æ„Ÿåº¦ä½Žçš„ç³»ç»Ÿï¼› é€‚åˆè·¨ä¼ä¸šçš„ç³»ç»Ÿé—´çš„æ“ä½œï¼Œæˆ–è€…ä¼ä¸šå†…éƒ¨æ¯”è¾ƒç‹¬ç«‹çš„ç³»ç»Ÿé—´çš„æ“ä½œï¼Œæ¯”å¦‚é“¶è¡Œé€šçŸ¥ã€å•†æˆ·é€šçŸ¥ç­‰ï¼› Sagaäº‹åŠ¡â€”â€”æœ€ç»ˆä¸€è‡´æ€§ ç®€ä»‹ Sagaäº‹åŠ¡æºäºŽ1987å¹´æ™®æž—æ–¯é¡¿å¤§å­¦çš„Hectoå’ŒKennethå‘è¡¨çš„å¦‚ä½•å¤„ç†long lived transactionï¼ˆé•¿æ´»äº‹åŠ¡ï¼‰è®ºæ–‡ï¼ŒSagaäº‹åŠ¡æ ¸å¿ƒæ€æƒ³æ˜¯å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œç”±Sagaäº‹åŠ¡åè°ƒå™¨åè°ƒï¼Œå¦‚æžœæ­£å¸¸ç»“æŸé‚£å°±æ­£å¸¸å®Œæˆï¼Œå¦‚æžœæŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™æ ¹æ®ç›¸åé¡ºåºä¸€æ¬¡è°ƒç”¨è¡¥å¿æ“ä½œã€‚ Sagaäº‹åŠ¡åŸºæœ¬åè®® æ¯ä¸ªSagaäº‹åŠ¡ç”±ä¸€ç³»åˆ—å¹‚ç­‰çš„æœ‰åºå­äº‹åŠ¡(sub-transaction) Ti ç»„æˆã€‚ æ¯ä¸ªTi éƒ½æœ‰å¯¹åº”çš„å¹‚ç­‰è¡¥å¿åŠ¨ä½œCiï¼Œè¡¥å¿åŠ¨ä½œç”¨äºŽæ’¤é”€Tié€ æˆçš„ç»“æžœã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå’ŒTCCç›¸æ¯”ï¼ŒSagaæ²¡æœ‰â€œé¢„ç•™â€åŠ¨ä½œï¼Œå®ƒçš„Tiå°±æ˜¯ç›´æŽ¥æäº¤åˆ°åº“ã€‚ Sagaäº‹åŠ¡æ‰§è¡Œé¡ºåº ä¸‹é¢ä»¥ä¸‹å•æµç¨‹ä¸ºä¾‹ï¼Œæ•´ä¸ªæ“ä½œåŒ…æ‹¬ï¼šåˆ›å»ºè®¢å•ã€æ‰£å‡åº“å­˜ã€æ”¯ä»˜ã€å¢žåŠ ç§¯åˆ† Sagaçš„æ‰§è¡Œé¡ºåºæœ‰ä¸¤ç§ï¼š &lt;span id=&quot;inline-blue&quot;&gt;äº‹åŠ¡æ­£å¸¸æ‰§è¡Œå®Œæˆ&lt;/span&gt; &lt;p id=&quot;div-border-left-red&quot;&gt;T1, T2, T3, ..., Tnï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜(T1)ï¼Œåˆ›å»ºè®¢å•(T2)ï¼Œæ”¯ä»˜(T3)ï¼Œä¾æ¬¡æœ‰åºå®Œæˆæ•´ä¸ªäº‹åŠ¡ã€‚&lt;/p&gt; &lt;span id=&quot;inline-blue&quot;&gt;äº‹åŠ¡å›žæ»š&lt;/span&gt; &lt;p id=&quot;div-border-left-red&quot;&gt;T1, T2, ..., Tj, Cj,..., C2, C1ï¼Œå…¶ä¸­0 &lt; j &lt; nï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜(T1)ï¼Œåˆ›å»ºè®¢å•(T2)ï¼Œæ”¯ä»˜(T3ï¼Œæ”¯ä»˜å¤±è´¥)ï¼Œæ”¯ä»˜å›žæ»š(C3)ï¼Œè®¢å•å›žæ»š(C2)ï¼Œæ¢å¤åº“å­˜(C1)ã€‚&lt;/p&gt; Sagaæ¢å¤ç­–ç•¥ï¼š å‘å‰æ¢å¤(forward recovery) å¯¹åº”äºŽä¸Šé¢ç¬¬ä¸€ç§æ‰§è¡Œé¡ºåºï¼Œé€‚ç”¨äºŽå¿…é¡»è¦æˆåŠŸçš„åœºæ™¯ï¼Œå‘ç”Ÿå¤±è´¥è¿›è¡Œé‡è¯•ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ç±»ä¼¼äºŽè¿™æ ·çš„ï¼šT1, T2, ..., Tj(å¤±è´¥), Tj(é‡è¯•),..., Tnï¼Œå…¶ä¸­jæ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡(sub-transaction)ã€‚è¯¥æƒ…å†µä¸‹ä¸éœ€è¦Ciã€‚ å‘åŽæ¢å¤(backward recovery) å¯¹åº”äºŽä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æ‰§è¡Œé¡ºåºï¼Œå…¶ä¸­jæ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡(sub-transaction)ï¼Œè¿™ç§åšæ³•çš„æ•ˆæžœæ˜¯æ’¤é”€æŽ‰ä¹‹å‰æ‰€æœ‰æˆåŠŸçš„å­äº‹åŠ¡ï¼Œä½¿å¾—æ•´ä¸ªSagaçš„æ‰§è¡Œç»“æžœæ’¤é”€ã€‚ Sagaäº‹åŠ¡å®žçŽ°æ–¹å¼ 1ã€å‘½ä»¤åè°ƒ(Order Orchestrator)ï¼šä¸­å¤®åè°ƒå™¨è´Ÿè´£é›†ä¸­å¤„ç†äº‹ä»¶çš„å†³ç­–å’Œä¸šåŠ¡é€»è¾‘æŽ’åºã€‚ ä¸­å¤®åè°ƒå™¨ï¼ˆOrchestratorï¼Œç®€ç§°OSOï¼‰ä»¥å‘½ä»¤/å›žå¤çš„æ–¹å¼ä¸Žæ¯é¡¹æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå…¨æƒè´Ÿè´£å‘Šè¯‰æ¯ä¸ªå‚ä¸Žè€…è¯¥åšä»€ä¹ˆä»¥åŠä»€ä¹ˆæ—¶å€™è¯¥åšä»€ä¹ˆã€‚ ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š 1ã€äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘è¯·æ±‚OSOæœåŠ¡å¼€å¯è®¢å•äº‹åŠ¡ã€‚ 2ã€OSOå‘åº“å­˜æœåŠ¡è¯·æ±‚æ‰£å‡åº“å­˜ï¼Œåº“å­˜æœåŠ¡å›žå¤å¤„ç†ç»“æžœã€‚ 3ã€OSOå‘è®¢å•æœåŠ¡è¯·æ±‚åˆ›å»ºè®¢å•ï¼Œè®¢å•æœåŠ¡å›žå¤åˆ›å»ºç»“æžœã€‚ 4ã€OSOå‘æ”¯ä»˜æœåŠ¡è¯·æ±‚æ”¯ä»˜ï¼Œæ”¯ä»˜æœåŠ¡å›žå¤å¤„ç†ç»“æžœã€‚ 5ã€ä¸»ä¸šåŠ¡é€»è¾‘æŽ¥æ”¶å¹¶å¤„ç†OSOäº‹åŠ¡å¤„ç†ç»“æžœå›žå¤ã€‚ ä¸­å¤®åè°ƒå™¨å¿…é¡»äº‹å…ˆçŸ¥é“æ‰§è¡Œæ•´ä¸ªè®¢å•äº‹åŠ¡æ‰€éœ€çš„æµç¨‹(ä¾‹å¦‚é€šè¿‡è¯»å–é…ç½®)ã€‚å¦‚æžœæœ‰ä»»ä½•å¤±è´¥ï¼Œå®ƒè¿˜è´Ÿè´£é€šè¿‡å‘æ¯ä¸ªå‚ä¸Žè€…å‘é€å‘½ä»¤æ¥æ’¤é”€ä¹‹å‰çš„æ“ä½œæ¥åè°ƒåˆ†å¸ƒå¼çš„å›žæ»šã€‚åŸºäºŽä¸­å¤®åè°ƒå™¨åè°ƒä¸€åˆ‡æ—¶ï¼Œå›žæ»šè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºåè°ƒå™¨é»˜è®¤æ˜¯æ‰§è¡Œæ­£å‘æµç¨‹ï¼Œå›žæ»šæ—¶åªè¦æ‰§è¡Œåå‘æµç¨‹å³å¯ã€‚ 2ã€äº‹ä»¶ç¼–æŽ’ (Event Choreography0ï¼šæ²¡æœ‰ä¸­å¤®åè°ƒå™¨ï¼ˆæ²¡æœ‰å•ç‚¹é£Žé™©ï¼‰æ—¶ï¼Œæ¯ä¸ªæœåŠ¡äº§ç”Ÿå¹¶è§‚å¯Ÿå…¶ä»–æœåŠ¡çš„äº‹ä»¶ï¼Œå¹¶å†³å®šæ˜¯å¦åº”é‡‡å–è¡ŒåŠ¨ã€‚ åœ¨äº‹ä»¶ç¼–æŽ’æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªæœåŠ¡æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åŽå‘å¸ƒä¸€ä¸ªäº‹ä»¶ã€‚è¯¥äº‹ä»¶è¢«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡è¿›è¡Œç›‘å¬ï¼Œè¿™äº›æœåŠ¡å†æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶å‘å¸ƒï¼ˆæˆ–ä¸å‘å¸ƒï¼‰æ–°çš„äº‹ä»¶ã€‚ å½“æœ€åŽä¸€ä¸ªæœåŠ¡æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶ä¸”ä¸å‘å¸ƒä»»ä½•äº‹ä»¶æ—¶ï¼Œæ„å‘³ç€åˆ†å¸ƒå¼äº‹åŠ¡ç»“æŸï¼Œæˆ–è€…å®ƒå‘å¸ƒçš„äº‹ä»¶æ²¡æœ‰è¢«ä»»ä½•Sagaå‚ä¸Žè€…å¬åˆ°éƒ½æ„å‘³ç€äº‹åŠ¡ç»“æŸã€‚ ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š 1ã€äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘å‘å¸ƒå¼€å§‹è®¢å•äº‹ä»¶ã€‚ 2ã€åº“å­˜æœåŠ¡ç›‘å¬å¼€å§‹è®¢å•äº‹ä»¶ï¼Œæ‰£å‡åº“å­˜ï¼Œå¹¶å‘å¸ƒåº“å­˜å·²æ‰£å‡äº‹ä»¶ã€‚ 3ã€è®¢å•æœåŠ¡ç›‘å¬åº“å­˜å·²æ‰£å‡äº‹ä»¶ï¼Œåˆ›å»ºè®¢å•ï¼Œå¹¶å‘å¸ƒè®¢å•å·²åˆ›å»ºäº‹ä»¶ã€‚ 4ã€æ”¯ä»˜æœåŠ¡ç›‘å¬è®¢å•å·²åˆ›å»ºäº‹ä»¶ï¼Œè¿›è¡Œæ”¯ä»˜ï¼Œå¹¶å‘å¸ƒè®¢å•å·²æ”¯ä»˜äº‹ä»¶ã€‚ 5ã€ä¸»ä¸šåŠ¡é€»è¾‘ç›‘å¬è®¢å•å·²æ”¯ä»˜äº‹ä»¶å¹¶å¤„ç†ã€‚ äº‹ä»¶/ç¼–æŽ’æ˜¯å®žçŽ°Sagaæ¨¡å¼çš„è‡ªç„¶æ–¹å¼ï¼Œå®ƒå¾ˆç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å¤ªå¤šçš„ä»£ç æ¥æž„å»ºã€‚å¦‚æžœäº‹åŠ¡æ¶‰åŠ2è‡³4ä¸ªæ­¥éª¤ï¼Œåˆ™å¯èƒ½æ˜¯éžå¸¸åˆé€‚çš„ã€‚ å‘½ä»¤åè°ƒè®¾è®¡çš„ä¼˜ç‚¹ 1ã€æœåŠ¡ä¹‹é—´å…³ç³»ç®€å•ï¼Œé¿å…æœåŠ¡ä¹‹é—´çš„å¾ªçŽ¯ä¾èµ–å…³ç³»ï¼Œå› ä¸ºSagaåè°ƒå™¨ä¼šè°ƒç”¨Sagaå‚ä¸Žè€…ï¼Œä½†å‚ä¸Žè€…ä¸ä¼šè°ƒç”¨åè°ƒå™¨ 2ã€ç¨‹åºå¼€å‘ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œå‘½ä»¤/å›žå¤(å…¶å®žå›žå¤æ¶ˆæ¯ä¹Ÿæ˜¯ä¸€ç§äº‹ä»¶æ¶ˆæ¯)ï¼Œé™ä½Žå‚ä¸Žè€…çš„å¤æ‚æ€§ã€‚ 3ã€æ˜“ç»´æŠ¤æ‰©å±•ï¼Œåœ¨æ·»åŠ æ–°æ­¥éª¤æ—¶ï¼Œäº‹åŠ¡å¤æ‚æ€§ä¿æŒçº¿æ€§ï¼Œå›žæ»šæ›´å®¹æ˜“ç®¡ç†ï¼Œæ›´å®¹æ˜“å®žæ–½å’Œæµ‹è¯• å‘½ä»¤åè°ƒè®¾è®¡çš„ç¼ºç‚¹ 1ã€ä¸­å¤®åè°ƒå™¨å®¹æ˜“å¤„ç†é€»è¾‘å®¹æ˜“è¿‡äºŽå¤æ‚ï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚ 2ã€å­˜åœ¨åè°ƒå™¨å•ç‚¹æ•…éšœé£Žé™©ã€‚ äº‹ä»¶/ç¼–æŽ’è®¾è®¡çš„ä¼˜ç‚¹ 1ã€é¿å…ä¸­å¤®åè°ƒå™¨å•ç‚¹æ•…éšœé£Žé™©ã€‚ 2ã€å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå°‘æœåŠ¡å¼€å‘ç®€å•ï¼Œå®¹æ˜“å®žçŽ°ã€‚ äº‹ä»¶/ç¼–æŽ’è®¾è®¡çš„ç¼ºç‚¹ 1ã€æœåŠ¡ä¹‹é—´å­˜åœ¨å¾ªçŽ¯ä¾èµ–çš„é£Žé™©ã€‚ 2ã€å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå¤šï¼ŒæœåŠ¡é—´å…³ç³»æ··ä¹±ï¼Œéš¾ä»¥è¿½è¸ªè°ƒæµ‹ã€‚ å€¼å¾—è¡¥å……çš„æ˜¯ï¼Œç”±äºŽSagaæ¨¡åž‹ä¸­æ²¡æœ‰Prepareé˜¶æ®µï¼Œå› æ­¤äº‹åŠ¡é—´ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œå½“å¤šä¸ªSagaäº‹åŠ¡æ“ä½œåŒä¸€èµ„æºæ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ›´æ–°ä¸¢å¤±ã€è„æ•°æ®è¯»å–ç­‰é—®é¢˜ï¼Œè¿™æ—¶éœ€è¦åœ¨ä¸šåŠ¡å±‚æŽ§åˆ¶å¹¶å‘ï¼Œä¾‹å¦‚ï¼šåœ¨åº”ç”¨å±‚é¢åŠ é”ï¼Œæˆ–è€…åº”ç”¨å±‚é¢é¢„å…ˆå†»ç»“èµ„æºã€‚ åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ¯”è¾ƒ 2PC/3PC ä¾èµ–äºŽæ•°æ®åº“ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„æä¾›å¼ºä¸€è‡´æ€§å’Œå¼ºäº‹åŠ¡æ€§ï¼Œä½†ç›¸å¯¹æ¥è¯´å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œæ¯”è¾ƒé€‚åˆä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼Œåœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­å­˜åœ¨è·¨åº“æ“ä½œçš„æƒ…å†µï¼Œä¸é€‚åˆé«˜å¹¶å‘å’Œé«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ã€‚ TCC é€‚ç”¨äºŽæ‰§è¡Œæ—¶é—´ç¡®å®šä¸”è¾ƒçŸ­ï¼Œå®žæ—¶æ€§è¦æ±‚é«˜ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œæ¯”å¦‚äº’è”ç½‘é‡‘èžä¼ä¸šæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæœåŠ¡ï¼šäº¤æ˜“ã€æ”¯ä»˜ã€è´¦åŠ¡ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨/MQäº‹åŠ¡ éƒ½é€‚ç”¨äºŽäº‹åŠ¡ä¸­å‚ä¸Žæ–¹æ”¯æŒæ“ä½œå¹‚ç­‰ï¼Œå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œä¸šåŠ¡ä¸Šèƒ½å®¹å¿æ•°æ®ä¸ä¸€è‡´åˆ°ä¸€ä¸ªäººå·¥æ£€æŸ¥å‘¨æœŸï¼Œäº‹åŠ¡æ¶‰åŠçš„å‚ä¸Žæ–¹ã€å‚ä¸ŽçŽ¯èŠ‚è¾ƒå°‘ï¼Œä¸šåŠ¡ä¸Šæœ‰å¯¹è´¦/æ ¡éªŒç³»ç»Ÿå…œåº•ã€‚ Sagaäº‹åŠ¡ ç”±äºŽSagaäº‹åŠ¡ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œéœ€è¦åœ¨ä¸šåŠ¡å±‚æŽ§åˆ¶å¹¶å‘ï¼Œé€‚åˆäºŽä¸šåŠ¡åœºæ™¯äº‹åŠ¡å¹¶å‘æ“ä½œåŒä¸€èµ„æºè¾ƒå°‘çš„æƒ…å†µã€‚ Sagaç›¸æ¯”ç¼ºå°‘é¢„æäº¤åŠ¨ä½œï¼Œå¯¼è‡´è¡¥å¿åŠ¨ä½œçš„å®žçŽ°æ¯”è¾ƒéº»çƒ¦ï¼Œä¾‹å¦‚ä¸šåŠ¡æ˜¯å‘é€çŸ­ä¿¡ï¼Œè¡¥å¿åŠ¨ä½œåˆ™å¾—å†å‘é€ä¸€æ¬¡çŸ­ä¿¡è¯´æ˜Žæ’¤é”€ï¼Œç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ã€‚Sagaäº‹åŠ¡è¾ƒé€‚ç”¨äºŽè¡¥å¿åŠ¨ä½œå®¹æ˜“å¤„ç†çš„åœºæ™¯ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -é™æµç®—æ³•]]></title>
    <url>%2Fposts%2F6e0ef647.html</url>
    <content type="text"><![CDATA[é™æµçš„ä½œç”¨ ç”±äºŽAPIæŽ¥å£æ— æ³•æŽ§åˆ¶è°ƒç”¨æ–¹çš„è¡Œä¸ºï¼Œå› æ­¤å½“é‡åˆ°çž¬æ—¶è¯·æ±‚é‡æ¿€å¢žæ—¶ï¼Œä¼šå¯¼è‡´æŽ¥å£å ç”¨è¿‡å¤šæœåŠ¡å™¨èµ„æºï¼Œä½¿å¾—å…¶ä»–è¯·æ±‚å“åº”é€Ÿåº¦é™ä½Žæˆ–æ˜¯è¶…æ—¶ï¼Œæ›´æœ‰ç”šè€…å¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®•æœºã€‚ é™æµ(Rate limiting)æŒ‡å¯¹åº”ç”¨æœåŠ¡çš„è¯·æ±‚è¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚æŸä¸€æŽ¥å£çš„è¯·æ±‚é™åˆ¶ä¸º100ä¸ªæ¯ç§’,å¯¹è¶…è¿‡é™åˆ¶çš„è¯·æ±‚åˆ™è¿›è¡Œå¿«é€Ÿå¤±è´¥æˆ–ä¸¢å¼ƒã€‚ é™æµå¯ä»¥åº”å¯¹ï¼š çƒ­ç‚¹ä¸šåŠ¡å¸¦æ¥çš„çªå‘è¯·æ±‚ï¼› è°ƒç”¨æ–¹bugå¯¼è‡´çš„çªå‘è¯·æ±‚ï¼› æ¶æ„æ”»å‡»è¯·æ±‚ã€‚ å› æ­¤ï¼Œå¯¹äºŽå…¬å¼€çš„æŽ¥å£æœ€å¥½é‡‡å–é™æµæŽªæ–½ã€‚ ä¸ºä»€ä¹ˆè¦åˆ†å¸ƒå¼é™æµ ä½†çº¿ä¸Šä¸šåŠ¡å‡ºäºŽå„ç§åŽŸå› è€ƒè™‘ï¼Œå¤šæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå•èŠ‚ç‚¹çš„é™æµä»…èƒ½ä¿æŠ¤è‡ªèº«èŠ‚ç‚¹ï¼Œä½†æ— æ³•ä¿æŠ¤åº”ç”¨ä¾èµ–çš„å„ç§æœåŠ¡ï¼Œå¹¶ä¸”åœ¨è¿›è¡ŒèŠ‚ç‚¹æ‰©å®¹ã€ç¼©å®¹æ—¶ä¹Ÿæ— æ³•å‡†ç¡®æŽ§åˆ¶æ•´ä¸ªæœåŠ¡çš„è¯·æ±‚é™åˆ¶ã€‚ è€Œå¦‚æžœå®žçŽ°äº†åˆ†å¸ƒå¼é™æµï¼Œé‚£ä¹ˆå°±å¯ä»¥æ–¹ä¾¿åœ°æŽ§åˆ¶æ•´ä¸ªæœåŠ¡é›†ç¾¤çš„è¯·æ±‚é™åˆ¶ï¼Œä¸”ç”±äºŽæ•´ä¸ªé›†ç¾¤çš„è¯·æ±‚æ•°é‡å¾—åˆ°äº†é™åˆ¶ï¼Œå› æ­¤æœåŠ¡ä¾èµ–çš„å„ç§èµ„æºä¹Ÿå¾—åˆ°äº†é™æµçš„ä¿æŠ¤ã€‚ é™æµç®—æ³•åˆ†ç±» 1ã€è®¡æ•°å™¨ç®—æ³•ï¼ˆå›ºå®šæ—¶é—´çª—å£ï¼‰ï¼› 2ã€æ»‘åŠ¨æ—¶é—´çª—å£ï¼› 3ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼› 4ã€æ¼æ¡¶ç®—æ³•ï¼› è®¡æ•°å™¨ç®—æ³• ç®—æ³•è§£è¯» è®¡æ•°å™¨ç®—æ³•æ˜¯é™æµç®—æ³•é‡Œæœ€ç®€å•ä¹Ÿæ˜¯æœ€å®¹æ˜“å®žçŽ°çš„ä¸€ç§ç®—æ³•ã€‚è®¡æ•°å™¨å°±æ˜¯ç»Ÿè®¡è®°å½•å•ä½æ—¶é—´å†…è¿›å…¥ç³»ç»Ÿæˆ–è€…æŸä¸€æŽ¥å£çš„è¯·æ±‚æ¬¡æ•°ï¼Œåœ¨é™å®šçš„æ¬¡æ•°å†…çš„è¯·æ±‚åˆ™æ­£å¸¸æŽ¥æ”¶å¤„ç†ï¼Œè¶…è¿‡æ¬¡æ•°çš„è¯·æ±‚åˆ™æ‹’ç»æŽ‰ï¼Œæˆ–è€…æ”¹ä¸ºå¼‚æ­¥å¤„ç†ã€‚ æ¯”å¦‚è§„å®šï¼Œå¯¹äºŽAæŽ¥å£1åˆ†é’Ÿçš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡100ä¸ªã€‚é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆåšï¼šåœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨counterï¼Œæ¯å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œcounterå°±åŠ 1ï¼Œå¦‚æžœcounterçš„å€¼å¤§äºŽ100å¹¶ä¸”è¯¥è¯·æ±‚ä¸Žç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´è¿˜åœ¨1åˆ†é’Ÿä¹‹å†…ï¼Œé‚£ä¹ˆè¯´æ˜Žè¯·æ±‚æ•°è¿‡å¤šï¼›å¦‚æžœè¯¥è¯·æ±‚ä¸Žç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´å¤§äºŽ1åˆ†é’Ÿï¼Œä¸”counterçš„å€¼è¿˜åœ¨é™æµèŒƒå›´å†…ï¼Œé‚£ä¹ˆå°±é‡ç½® counterï¼Œå…·ä½“ç®—æ³•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç®—æ³•ç¤ºä¾‹ ä½¿ç”¨ AomicInteger æ¥è¿›è¡Œç»Ÿè®¡å½“å‰æ­£åœ¨å¹¶å‘æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¦‚æžœè¶…è¿‡åŸŸå€¼å°±ç›´æŽ¥æ‹’ç»è¯·æ±‚ï¼Œæç¤ºç³»ç»Ÿç¹å¿™... 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;import java.util.concurrent.atomic.AtomicInteger;/** * @author: whb * @description: è®¡æ•°å™¨é™æµç®—æ³• * ä½¿ç”¨ AomicInteger æ¥è¿›è¡Œç»Ÿè®¡å½“å‰æ­£åœ¨å¹¶å‘æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¦‚æžœè¶…è¿‡åŸŸå€¼å°±ç›´æŽ¥æ‹’ç»è¯·æ±‚ï¼Œæç¤ºç³»ç»Ÿç¹å¿™ */public class CounterLimiter &#123; /** * è®¡æ•°å™¨é™æµç®—æ³•ï¼ˆæ¯”è¾ƒæš´åŠ›/è¶…å‡ºç›´æŽ¥æ‹’ç»ï¼‰ * Atomicï¼Œé™åˆ¶æ€»æ•° */ private static final AtomicInteger atomic = new AtomicInteger(0); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµ */ private void atomicLimiter() &#123; // æœ€å¤§æ”¯æŒ 3 å€‹ if (atomic.get() &gt;= 3) &#123; System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - " + "æ‹’çµ•..."); &#125; else &#123; try &#123; atomic.incrementAndGet(); //å¤„ç†æ ¸å¿ƒé€»è¾‘ System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - " + "é€šè¿‡..."); TimeUnit.SECONDS.sleep(1); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; atomic.decrementAndGet(); &#125; &#125; &#125; /** * æµ‹è¯•é™æµ * * @throws InterruptedException */ public void testAtomicLimiter() throws InterruptedException &#123; for (int i = 0; i &lt; 5; i++) &#123; threadPoolExecutor.execute(this::atomicLimiter); &#125; TimeUnit.SECONDS.sleep(5); &#125; /** * mainæ–¹æ³•è°ƒç”¨ */ public static void main(String[] args) throws InterruptedException &#123; CounterLimiter counterLimiter = new CounterLimiter(); counterLimiter.testAtomicLimiter(); &#125;&#125; è¿è¡Œç»“æžœ è®¡æ•°å™¨ç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ¯”è¾ƒç²—æ”¾ï¼Œå­˜åœ¨ä¸€ä¸ªååˆ†è‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸´ç•Œé—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ¶æ„ç”¨æˆ·ï¼Œä»–åœ¨0:59æ—¶ï¼Œçž¬é—´å‘é€äº†100ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”1:00åˆçž¬é—´å‘é€äº†100ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå…¶å®žè¿™ä¸ªç”¨æˆ·åœ¨ 1ç§’é‡Œé¢ï¼Œçž¬é—´å‘é€äº†200ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åˆšæ‰è§„å®šçš„æ˜¯1åˆ†é’Ÿæœ€å¤š100ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿæœ€å¤š1.7ä¸ªè¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡åœ¨æ—¶é—´çª—å£çš„é‡ç½®èŠ‚ç‚¹å¤„çªå‘è¯·æ±‚ï¼Œå¯ä»¥çž¬é—´è¶…è¿‡æˆ‘ä»¬çš„é€ŸçŽ‡é™åˆ¶ã€‚ç”¨æˆ·æœ‰å¯èƒ½é€šè¿‡ç®—æ³•çš„è¿™ä¸ªæ¼æ´žï¼Œçž¬é—´åŽ‹åž®æˆ‘ä»¬çš„åº”ç”¨ã€‚ å…¶å®žè¿™ä¸ªé—®é¢˜çš„æœ¬è´¨å°±æ˜¯ç»Ÿè®¡çš„ç²¾åº¦å¤ªä½Žï¼Œé‚£å¦‚ä½•é™ä½Žä¸´ç•Œé—®é¢˜çš„å½±å“ï¼Ÿçœ‹ä¸‹é¢çš„æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ã€‚ æ»‘åŠ¨æ—¶é—´çª—å£ ç®—æ³•è§£è¯» æ»‘åŠ¨çª—å£ï¼Œåˆç§°rolling windowï¼Œè·ŸTCPä¸­çš„æ»‘åŠ¨çª—å£åç§°ä¸€è‡´ï¼Œä½†è¦åŒºåˆ†å¼€æ¥ã€‚å…ˆç”¨ä¸€å¼ å›¾è§£é‡Šä¸‹æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼š å¦‚ä¸Šå›¾ï¼Œæ•´ä¸ªçº¢è‰²çš„çŸ©å½¢æ¡†è¡¨ç¤ºä¸€ä¸ªæ—¶é—´çª—å£ï¼Œåœ¨è®¡æ•°å™¨ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬è§„å®šä¸€ä¸ªæ—¶é—´çª—å£å°±æ˜¯ä¸€åˆ†é’Ÿã€‚åœ¨æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ä¸­æˆ‘ä»¬å°†æ»‘åŠ¨çª—å£ åˆ’æˆäº†6æ ¼ï¼Œæ‰€ä»¥æ¯æ ¼ä»£è¡¨çš„æ˜¯10ç§’é’Ÿã€‚æ¯è¿‡10ç§’é’Ÿï¼Œæ—¶é—´çª—å£å°±ä¼šå¾€å³æ»‘åŠ¨ä¸€æ ¼ã€‚æ¯ä¸€ä¸ªæ ¼å­éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è®¡æ•°å™¨counterï¼Œæ¯”å¦‚å½“ä¸€ä¸ªè¯·æ±‚ åœ¨0:35ç§’çš„æ—¶å€™åˆ°è¾¾ï¼Œé‚£ä¹ˆ0:30~0:39å¯¹åº”çš„counterå°±ä¼šåŠ 1ã€‚ é‚£ä¹ˆæ»‘åŠ¨çª—å£æ€Žä¹ˆè§£å†³åˆšæ‰çš„ä¸´ç•Œé—®é¢˜çš„å‘¢ï¼Ÿçœ‹ä¸Šå›¾ï¼Œ0:59åˆ°è¾¾çš„100ä¸ªè¯·æ±‚ä¼šè½åœ¨ç°è‰²çš„æ ¼å­ä¸­ï¼Œè€Œ1:00åˆ°è¾¾çš„è¯·æ±‚ä¼šè½åœ¨çº¢è‰²çš„æ ¼å­ä¸­ã€‚å½“æ—¶é—´åˆ°è¾¾1:00æ—¶ï¼Œçª—å£ä¼šå¾€å³ç§»åŠ¨ä¸€æ ¼ï¼Œé‚£ä¹ˆæ­¤æ—¶æ—¶é—´çª—å£å†…çš„æ€»è¯·æ±‚æ•°é‡ä¸€å…±æ˜¯200ä¸ªï¼Œè¶…è¿‡äº†é™å®šçš„100ä¸ªï¼Œæ‰€ä»¥æ­¤æ—¶èƒ½å¤Ÿæ£€æµ‹å‡ºæ¥è§¦å‘äº†é™æµã€‚ å†å›žé¡¾ä¸€ä¸‹åˆšæ‰çš„è®¡æ•°å™¨ç®—æ³•ï¼Œå¯ä»¥å‘çŽ°ï¼Œè®¡æ•°å™¨ç®—æ³•å…¶å®žå°±æ˜¯æ»‘åŠ¨çª—å£ç®—æ³•ã€‚åªæ˜¯å®ƒæ²¡æœ‰å¯¹æ—¶é—´çª—å£åšè¿›ä¸€æ­¥åœ°åˆ’åˆ†ï¼Œæ‰€ä»¥åªæœ‰1æ ¼ã€‚ ç”±æ­¤å¯è§ï¼Œå½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚ ç®—æ³•ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141package com.springboot.whb.study.currentLimiting;/** * @author: whb * @description: æ»‘åŠ¨æ—¶é—´çª—å£é™æµç®—æ³• */import java.util.Iterator;import java.util.Random;import java.util.concurrent.ConcurrentLinkedQueue;import java.util.stream.IntStream;public class TimeWindowLimited &#123; /** * ç¼“å­˜è¯·æ±‚çš„é˜Ÿåˆ— */ private ConcurrentLinkedQueue&lt;Long&gt; queue = new ConcurrentLinkedQueue&lt;&gt;(); /** * æ»‘åŠ¨æ—¶é—´çª—å£å¤§å° */ private int seconds; /** * æœ€å¤§å¯æŽ¥å—è¯·æ±‚ */ private int max; public TimeWindowLimited(int max, int timeWindowOfSeconds) &#123; this.seconds = timeWindowOfSeconds; this.max = max; new Thread(() -&gt; &#123; for (; ; ) &#123; clean(); try &#123; Thread.sleep(10); &#125; catch (InterruptedException e) &#123; Thread.currentThread().interrupt(); &#125; &#125; &#125;).start(); &#125; /** * èŽ·å–ä»¤ç‰Œï¼Œå¹¶ä¸”æ·»åŠ æ—¶é—´ */ public void take() &#123; long start = System.currentTimeMillis(); try &#123; int size = sizeOfValid(); if (size &gt; max - 1) &#123; System.err.println(" é˜Ÿåˆ—å·²æ»¡ï¼Œé˜Ÿåˆ—å®¹é‡:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); throw new IllegalStateException("full"); &#125; synchronized (queue) &#123; if (sizeOfValid() &gt; max - 1) &#123; System.err.println(" é˜Ÿåˆ—å·²æ»¡: in synchronized,size:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); throw new IllegalStateException("full"); &#125; this.queue.offer(System.currentTimeMillis()); &#125; System.out.println(" queue: d,size:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); &#125; finally &#123; System.out.println("è€—æ—¶:" + (System.currentTimeMillis() - start) + " ms"); &#125; &#125; /** * æ‰“å°é˜Ÿåˆ—å†…å®¹ * * @return */ private String printQueue() &#123; Iterator&lt;Long&gt; it = queue.iterator(); StringBuilder sb = new StringBuilder(); while (it.hasNext()) &#123; Long t = it.next(); sb.append(" ").append(t); &#125; return sb.toString(); &#125; /** * æœ‰æ•ˆè¯·æ±‚ * * @return */ public int sizeOfValid() &#123; Iterator&lt;Long&gt; it = queue.iterator(); Long ms = System.currentTimeMillis() - seconds * 1000; int count = 0; while (it.hasNext()) &#123; long t = it.next(); if (t &gt; ms) &#123; count++; &#125; &#125; return count; &#125; /** * æ¸…ç† */ public void clean() &#123; Long c = System.currentTimeMillis() - seconds * 1000; Long tl = null; System.out.println("peek: " + queue.peek() + "c:" + c); while ((tl = queue.peek()) != null &amp;&amp; tl &lt; c) &#123; System.out.println("peek: t:" + tl); queue.poll(); &#125; &#125; public static void main(String[] args) &#123; final TimeWindowLimited timeWindow = new TimeWindowLimited(200, 2); IntStream.range(0, 100).forEach((i) -&gt; &#123; new Thread(() -&gt; &#123; for (; ; ) &#123; System.out.println("before take i:" + i); try &#123; Thread.sleep(new Random().nextInt(20) * 100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; try &#123; timeWindow.take(); System.out.println("some option, i:" + i); &#125; catch (Exception e) &#123; System.err.println(" take i:" + i + ", encounter error:" + e.getMessage()); try &#123; Thread.sleep(10L); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; continue; &#125; System.out.println("after take i:" + i); &#125; &#125;).start(); &#125;); &#125;&#125; è¿è¡Œç»“æžœ æ¼æ¡¶ç®—æ³• ç®—æ³•è§£è¯» æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰ï¼šä¸»è¦ç›®çš„æ˜¯æŽ§åˆ¶æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œçš„é€ŸçŽ‡ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘æµé‡ï¼Œæ•°æ®å¯ä»¥ä»¥ä»»æ„é€Ÿåº¦æµå…¥åˆ°æ¼æ¡¶ä¸­ã€‚æ¼æ¡¶ç®—æ³•æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡å®ƒï¼Œçªå‘æµé‡å¯ä»¥è¢«æ•´å½¢ä»¥ä¾¿ä¸ºç½‘ç»œæä¾›ä¸€ä¸ªç¨³å®šçš„æµé‡ã€‚ æ¼æ¡¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¸¦æœ‰å¸¸é‡æœåŠ¡æ—¶é—´çš„å•æœåŠ¡å™¨é˜Ÿåˆ—ï¼Œå¦‚æžœæ¼æ¡¶ä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦æµå‡ºæ°´æ»´ï¼Œå¦‚æžœæ¼æ¡¶ï¼ˆåŒ…ç¼“å­˜ï¼‰æº¢å‡ºï¼Œé‚£ä¹ˆæ°´æ»´ä¼šè¢«æº¢å‡ºä¸¢å¼ƒã€‚ ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æè¿°å°±æ˜¯æ³¨æ°´æ¼æ°´è¿‡ç¨‹ï¼Œå¾€æ¡¶ä¸­ä»¥ä¸€å®šé€ŸçŽ‡æµå‡ºæ°´ï¼Œä»¥ä»»æ„é€ŸçŽ‡æµå…¥æ°´ï¼Œå½“æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€ŸçŽ‡ã€‚ ç®—æ³•ç¤ºä¾‹ æ¼æ¡¶ç®—æ³•å¯ä»¥é€šè¿‡ ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ çš„æ–¹å¼å®žçŽ°ï¼Œå¾ˆå¥½çš„è¾¾åˆ°å‰Šå³°çš„ç›®çš„ï¼Œå¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼Œé˜Ÿåˆ—ä¸­ä»»åŠ¡å­˜æ´»ä¸ªæ•°å°±å¦‚åŒæ˜¯æ°´æ¡¶æœ€å¤šèƒ½ç››è£…çš„æ°´é‡ï¼Œå½“è¶…å‡ºè¿™ä¸ªé˜€å€¼å°±ä¼šä¸¢å¼ƒä»»åŠ¡.... 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.Semaphore;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æ¼æ¡¶é™æµç®—æ³• */public class LeakyBucket &#123; /** * ä¿¡å·é‡ï¼Œç”¨æ¥è¾¾åˆ°å‰Šå³°çš„ç›®çš„ï¼Œå¹³æ»‘æµé‡ */ private static final Semaphore semaphore = new Semaphore(3); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµç®—æ³• */ private void semaphoreLimiter() &#123; // é˜Ÿåˆ—ä¸­å…è®¸å­˜æ´»çš„ä»»åŠ¡ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 5 ä¸ª if (semaphore.getQueueLength() &gt; 5) &#123; System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - æ‹’çµ•..."); &#125; else &#123; try &#123; semaphore.acquire(); System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - é€šè¿‡..."); //å¤„ç†æ ¸å¿ƒé€»è¾‘ TimeUnit.SECONDS.sleep(2); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; finally &#123; semaphore.release(); &#125; &#125; &#125; /** * æµ‹è¯•é™æµç®—æ³• * * @throws InterruptedException */ public void testSemaphore() throws InterruptedException &#123; for (int i = 0; i &lt; 10; i++) &#123; threadPoolExecutor.execute(this::semaphoreLimiter); &#125; TimeUnit.SECONDS.sleep(5); &#125; /** * mainæ–¹æ³•ä¸­æ‰§è¡Œæµ‹è¯•æ–¹æ³• * * @param args * @throws InterruptedException */ public static void main(String[] args) throws InterruptedException &#123; LeakyBucket leakyBucket = new LeakyBucket(); leakyBucket.testSemaphore(); &#125;&#125; è¿è¡Œç»“æžœ ä¸€å…± 10 ä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚ï¼Œåˆå§‹ä¿¡å·é‡ä¸º3ï¼Œè¡¨ç¤ºæœ€å¤šå¯ä»¥åŒæ—¶å¤„ç† 3 ä¸ªä»»åŠ¡ï¼Œè¶…å‡ºè¿›å…¥ç¼“å†²åŒºæŽ’é˜Ÿç­‰å¾…ï¼Œå½“ç¼“å†²åŒºæ»¡äº†åŽåˆ™æ‹’ç»æŽ¥æ”¶æ–°çš„è¯·æ±‚... ä»¤ç‰Œæ¡¶ç®—æ³• ç®—æ³•è§£è¯» ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯æ¯”è¾ƒå¸¸è§çš„é™æµç®—æ³•ä¹‹ä¸€ï¼Œå¤§æ¦‚æè¿°å¦‚ä¸‹ï¼š æ‰€æœ‰çš„è¯·æ±‚åœ¨å¤„ç†ä¹‹å‰éƒ½éœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¯ç”¨çš„ä»¤ç‰Œæ‰ä¼šè¢«å¤„ç†ï¼› æ ¹æ®é™æµå¤§å°ï¼Œè®¾ç½®æŒ‰ç…§ä¸€å®šçš„é€ŸçŽ‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼› æ¡¶è®¾ç½®æœ€å¤§çš„æ”¾ç½®ä»¤ç‰Œé™åˆ¶ï¼Œå½“æ¡¶æ»¡æ—¶ã€æ–°æ·»åŠ çš„ä»¤ç‰Œå°±è¢«ä¸¢å¼ƒæˆ–è€…æ‹’ç»ï¼› è¯·æ±‚è¾¾åˆ°åŽé¦–å…ˆè¦èŽ·å–ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œï¼Œæ‹¿ç€ä»¤ç‰Œæ‰å¯ä»¥è¿›è¡Œå…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œä¸šåŠ¡é€»è¾‘ä¹‹åŽï¼Œå°†ä»¤ç‰Œç›´æŽ¥åˆ é™¤ï¼› ä»¤ç‰Œæ¡¶æœ‰æœ€ä½Žé™é¢ï¼Œå½“æ¡¶ä¸­çš„ä»¤ç‰Œè¾¾åˆ°æœ€ä½Žé™é¢çš„æ—¶å€™ï¼Œè¯·æ±‚å¤„ç†å®Œä¹‹åŽå°†ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä»¥æ­¤ä¿è¯è¶³å¤Ÿçš„é™æµï¼› ç®—æ³•ç¤ºä¾‹ åœ¨Google Guavaä¸­æä¾›äº†ä¸€ä¸ªRateLimiter å·¥å…·ç±»ï¼Œå°±æ˜¯åŸºäºŽä»¤ç‰Œæ¡¶ç®—æ³•å®žçŽ°å¹³æ»‘çªå‘çš„é™æµç­–ç•¥. ä»¤ç‰Œæ¡¶çš„å¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿çš„æ”¹å˜é€Ÿåº¦ï¼Œä¸€æ—¦éœ€è¦æé«˜é€ŸçŽ‡ï¼Œåˆ™æŒ‰éœ€æé«˜æ”¾å…¥æ¡¶ä¸­çš„ä»¤ç‰Œçš„é€ŸçŽ‡ã€‚ä¸€èˆ¬ä¼šå®šæ—¶(æ¯”å¦‚1000æ¯«ç§’)å¾€æ¡¶ä¸­å¢žåŠ ä¸€å®šæ•°é‡çš„ä»¤ç‰Œ, æœ‰äº›å˜ç§ç®—æ³•åˆ™å¯ä»¥å®žæ—¶çš„è®¡ç®—åº”è¯¥å¢žåŠ çš„ä»¤ç‰Œçš„æ•°é‡ã€‚ åœ¨ç¤ºä¾‹ä»£ç ä¸­ä¸ºæ¯ç§’ä¸­äº§ç”Ÿ 2 ä¸ªä»¤ç‰Œï¼Œæ„å‘³ç€æ¯500æ¯«ç§’ä¼šäº§ç”Ÿä¸€ä¸ªä»¤ç‰Œã€‚ limiter.acquire(num) è¡¨ç¤ºæ¶ˆè´¹å¤šå°‘ä¸ªä»¤ç‰Œã€‚å½“æ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œæ—¶ï¼Œåˆ™ç›´æŽ¥è¿”å›ž0ï¼Œå¦åˆ™é˜»å¡žï¼Œç›´åˆ°æœ‰å¯ç”¨çš„ä»¤ç‰Œæ•°æ‰è¿”å›žï¼Œè¿”å›žçš„å€¼ä¸ºé˜»å¡žçš„æ—¶é—´ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import com.google.common.util.concurrent.RateLimiter;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.*;/** * @author: whb * @description: è°·æ­Œä»¤ç‰Œæ¡¶ç®—æ³•æµ‹è¯• */public class TokenBucket &#123; /** * æ¯ç§’ç”Ÿæˆ2ä¸ªä»¤ç‰Œ */ private static final RateLimiter limiter = RateLimiter.create(2); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµ */ private void rateLimiter() &#123; // é»˜è®¤å°±æ˜¯ 1 final double acquire = limiter.acquire(1); System.out.println("å½“å‰æ—¶é—´ - " + LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - é˜»å¡ž - " + acquire + " é€šè¿‡..."); &#125; /** * é™æµç®—æ³•æµ‹è¯•æŽ¥å£ * * @throws InterruptedException */ public void testRateLimiter() throws InterruptedException &#123; for (int i = 0; i &lt; 5; i++) &#123; threadPoolExecutor.execute(this::rateLimiter); &#125; TimeUnit.SECONDS.sleep(5); &#125; /** * mainæ–¹æ³•ä¸­è°ƒç”¨ * * @param args * @throws InterruptedException */ public static void main(String[] args) throws InterruptedException &#123; TokenBucket rateLimiterTest = new TokenBucket(); rateLimiterTest.testRateLimiter(); &#125;&#125; è¿è¡Œç»“æžœ é€šè¿‡æŽ§åˆ¶å°çš„è¾“å‡ºå¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºæ¯ä¸ªä»¤ç‰Œäº§ç”Ÿæ—¶é—´é—´éš”å¤§çº¦åœ¨ 500 æ¯«ç§’å·¦å³ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ID]]></title>
    <url>%2Fposts%2Fa8c8e58f.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€ID åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹å¤§é‡çš„æ•°æ®å’Œæ¶ˆæ¯è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚ å¦‚åœ¨é‡‘èžã€ç”µå•†ã€æ”¯ä»˜ã€ç­‰äº§å“çš„ç³»ç»Ÿä¸­ï¼Œæ•°æ®æ—¥æ¸å¢žé•¿ï¼Œå¯¹æ•°æ®åˆ†åº“åˆ†è¡¨åŽéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€IDæ¥æ ‡è¯†ä¸€æ¡æ•°æ®æˆ–æ¶ˆæ¯ï¼Œæ•°æ®åº“çš„è‡ªå¢žIDæ˜¾ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ­¤æ—¶ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„ç³»ç»Ÿæ˜¯éžå¸¸å¿…è¦çš„ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€IDçš„ç‰¹ç‚¹ å…¨å±€å”¯ä¸€æ€§ï¼šä¸èƒ½å‡ºçŽ°é‡å¤çš„IDå·ï¼Œæ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚ è¶‹åŠ¿é€’å¢žï¼šåœ¨MySQL InnoDBå¼•æ“Žä¸­ä½¿ç”¨çš„æ˜¯èšé›†ç´¢å¼•ï¼Œç”±äºŽå¤šæ•°RDBMSä½¿ç”¨B-treeçš„æ•°æ®ç»“æž„æ¥å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œåœ¨ä¸»é”®çš„é€‰æ‹©ä¸Šé¢æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æœ‰åºçš„ä¸»é”®ä¿è¯å†™å…¥æ€§èƒ½ã€‚ å•è°ƒé€’å¢žï¼šä¿è¯ä¸‹ä¸€ä¸ªIDä¸€å®šå¤§äºŽä¸Šä¸€ä¸ªIDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IMå¢žé‡æ¶ˆæ¯ã€æŽ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚ ä¿¡æ¯å®‰å…¨ï¼šå¦‚æžœIDæ˜¯è¿žç»­çš„ï¼Œæ¶æ„ç”¨æˆ·çš„æ‰’å–å·¥ä½œå°±éžå¸¸å®¹æ˜“åšäº†ï¼Œç›´æŽ¥æŒ‰ç…§é¡ºåºä¸‹è½½æŒ‡å®šURLå³å¯ï¼›å¦‚æžœæ˜¯è®¢å•å·å°±æ›´å±é™©äº†ã€‚æ‰€ä»¥åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦IDæ— è§„åˆ™ã€ä¸è§„åˆ™ã€‚ åŒæ—¶é™¤äº†å¯¹IDå·ç è‡ªèº«çš„è¦æ±‚ï¼Œä¸šåŠ¡è¿˜å¯¹IDå·ç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚æžé«˜ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æžœIDç”Ÿæˆç³»ç»Ÿç˜«ç—ªï¼Œè¿™å°±ä¼šå¸¦æ¥ä¸€åœºç¾éš¾ã€‚ ç”±æ­¤æ€»ç»“ä¸‹ä¸€ä¸ªIDç”Ÿæˆç³»ç»Ÿåº”è¯¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š å¹³å‡å»¶è¿Ÿå’ŒTP999å»¶è¿Ÿéƒ½è¦å°½å¯èƒ½ä½Žï¼› å¯ç”¨æ€§5ä¸ª9ï¼› é«˜QPSã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€IDå®žçŽ°æ–¹æ¡ˆ UUID UUIDæ˜¯æŒ‡åœ¨ä¸€å°æœºå™¨åœ¨åŒä¸€æ—¶é—´ä¸­ç”Ÿæˆçš„æ•°å­—åœ¨æ‰€æœ‰æœºå™¨ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚æŒ‰ç…§å¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)åˆ¶å®šçš„æ ‡å‡†è®¡ç®—ï¼Œç”¨åˆ°äº†ä»¥å¤ªç½‘å¡åœ°å€ã€çº³ç§’çº§æ—¶é—´ã€èŠ¯ç‰‡IDç å’Œè®¸å¤šå¯èƒ½çš„æ•°å­— UUIDç”±ä»¥ä¸‹å‡ éƒ¨åˆ†çš„ç»„åˆï¼š ï¼ˆ1ï¼‰å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚ ï¼ˆ2ï¼‰æ—¶é’Ÿåºåˆ—ã€‚ ï¼ˆ3ï¼‰å…¨å±€å”¯ä¸€çš„IEEEæœºå™¨è¯†åˆ«å·ï¼Œå¦‚æžœæœ‰ç½‘å¡ï¼Œä»Žç½‘å¡MACåœ°å€èŽ·å¾—ï¼Œæ²¡æœ‰ç½‘å¡ä»¥å…¶ä»–æ–¹å¼èŽ·å¾—ã€‚ æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12)ï¼Œä»¥è¿žå­—å·åˆ†ä¸ºäº”æ®µå½¢å¼çš„36ä¸ªå­—ç¬¦ï¼Œç¤ºä¾‹ï¼š550e8400-e29b-41d4-a716-446655440000 Javaæ ‡å‡†ç±»åº“ä¸­å·²ç»æä¾›äº†UUIDçš„APIã€‚ 1UUID.randomUUID(); ä¼˜ç‚¹ æ€§èƒ½éžå¸¸é«˜ï¼šæœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€—ã€‚ ç¼ºç‚¹ ä¸æ˜“å­˜å‚¨ï¼šUUIDå¤ªé•¿ï¼Œ16å­—èŠ‚128ä½ï¼Œé€šå¸¸ä»¥36é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚ ä¿¡æ¯ä¸å®‰å…¨ï¼šåŸºäºŽMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´žæ›¾è¢«ç”¨äºŽå¯»æ‰¾æ¢…ä¸½èŽŽç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚ IDä½œä¸ºä¸»é”®æ—¶åœ¨ç‰¹å®šçš„çŽ¯å¢ƒä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åšDBä¸»é”®çš„åœºæ™¯ä¸‹ï¼ŒUUIDå°±éžå¸¸ä¸é€‚ç”¨ã€‚ Twitterçš„snowflake snowflake æ˜¯ Twitter å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œæ˜¯ä¸€ç§åˆ’åˆ†å‘½åç©ºé—´æ¥ç”ŸæˆIDçš„ä¸€ç§ç®—æ³•ï¼Œç»“æžœæ˜¯ä¸€ä¸ªlongåž‹çš„IDã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæŠŠ64-bitåˆ†åˆ«åˆ’åˆ†æˆå¤šæ®µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ä½æ ‡è¯†ç¬¦ï¼šå§‹ç»ˆæ˜¯0ï¼Œç”±äºŽlongåŸºæœ¬ç±»åž‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0ã€‚ 41ä½æ—¶é—´æˆ³ï¼š41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª )å¾—åˆ°çš„å€¼ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ã€‚ 10ä½æœºå™¨æ ‡è¯†ç ï¼šå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æžœæœºå™¨åˆ†æœºæˆ¿ï¼ˆIDCï¼‰éƒ¨ç½²ï¼Œè¿™10ä½å¯ä»¥ç”± 5ä½æœºæˆ¿ID + 5ä½æœºå™¨ID ç»„æˆã€‚ 12ä½åºåˆ—ï¼šæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå· ä¼˜ç‚¹ æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢žåºåˆ—åœ¨ä½Žä½ï¼Œæ•´ä¸ªIDéƒ½æ˜¯è¶‹åŠ¿é€’å¢žçš„ã€‚ ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”ŸæˆIDçš„æ€§èƒ½ä¹Ÿæ˜¯éžå¸¸é«˜çš„ã€‚ å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é…bitä½ï¼Œéžå¸¸çµæ´»ã€‚ ç¼ºç‚¹ å¼ºä¾èµ–æœºå™¨çš„æ—¶é’Ÿï¼Œå¦‚æžœæœåŠ¡å™¨æ—¶é’Ÿå›žæ‹¨ï¼Œä¼šå¯¼è‡´é‡å¤IDç”Ÿæˆã€‚ åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ—¶ä¼šå‡ºçŽ°ä¸æ˜¯å…¨å±€é€’å¢žçš„æƒ…å†µã€‚ snowflake Javaå®žçŽ° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146/** * Twitter_Snowflake&lt;br&gt; * SnowFlakeçš„ç»“æž„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):&lt;br&gt; * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt; * 1ä½æ ‡è¯†ï¼Œç”±äºŽlongåŸºæœ¬ç±»åž‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0&lt;br&gt; * 41ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª) * å¾—åˆ°çš„å€¼ï¼‰ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±žæ€§ï¼‰ã€‚ * 41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´ï¼Œå¹´T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt; * 10ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬5ä½datacenterIdå’Œ5ä½workerId&lt;br&gt; * 12ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå·&lt;br&gt; * åŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongåž‹ã€‚&lt;br&gt; * SnowFlakeçš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢žæŽ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’ž(ç”±æ•°æ®ä¸­å¿ƒIDå’Œæœºå™¨IDä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆçŽ‡è¾ƒé«˜ï¼Œ * ç»æµ‹è¯•ï¼ŒSnowFlakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ã€‚ */public class SnowflakeIdWorker &#123; // ==============================Fields=========================================== /** å¼€å§‹æ—¶é—´æˆª (2015-01-01) */ private final long twepoch = 1420041600000L; /** æœºå™¨idæ‰€å çš„ä½æ•° */ private final long workerIdBits = 5L; /** æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */ private final long datacenterIdBits = 5L; /** æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æžœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */ private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); /** æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æžœæ˜¯31 */ private final long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits); /** åºåˆ—åœ¨idä¸­å çš„ä½æ•° */ private final long sequenceBits = 12L; /** æœºå™¨IDå‘å·¦ç§»12ä½ */ private final long workerIdShift = sequenceBits; /** æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */ private final long datacenterIdShift = sequenceBits + workerIdBits; /** æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; /** ç”Ÿæˆåºåˆ—çš„æŽ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); /** å·¥ä½œæœºå™¨ID(0~31) */ private long workerId; /** æ•°æ®ä¸­å¿ƒID(0~31) */ private long datacenterId; /** æ¯«ç§’å†…åºåˆ—(0~4095) */ private long sequence = 0L; /** ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */ private long lastTimestamp = -1L; //==============================Constructors===================================== /** * æž„é€ å‡½æ•° * @param workerId å·¥ä½œID (0~31) * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31) */ public SnowflakeIdWorker(long workerId, long datacenterId) &#123; if (workerId &gt; maxWorkerId || workerId &lt; 0) &#123; throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", maxWorkerId)); &#125; if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) &#123; throw new IllegalArgumentException(String.format("datacenter Id can't be greater than %d or less than 0", maxDatacenterId)); &#125; this.workerId = workerId; this.datacenterId = datacenterId; &#125; // ==============================Methods========================================== /** * èŽ·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„) * @return SnowflakeId */ public synchronized long nextId() &#123; long timestamp = timeGen(); //å¦‚æžœå½“å‰æ—¶é—´å°äºŽä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜Žç³»ç»Ÿæ—¶é’Ÿå›žé€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸ if (timestamp &lt; lastTimestamp) &#123; throw new RuntimeException( String.format("Clock moved backwards. Refusing to generate id for %d milliseconds", lastTimestamp - timestamp)); &#125; //å¦‚æžœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) &#123; sequence = (sequence + 1) &amp; sequenceMask; //æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == 0) &#123; //é˜»å¡žåˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,èŽ·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); &#125; &#125; //æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® else &#123; sequence = 0L; &#125; //ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª lastTimestamp = timestamp; //ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) // | (datacenterId &lt;&lt; datacenterIdShift) // | (workerId &lt;&lt; workerIdShift) // | sequence; &#125; /** * é˜»å¡žåˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°èŽ·å¾—æ–°çš„æ—¶é—´æˆ³ * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª * @return å½“å‰æ—¶é—´æˆ³ */ protected long tilNextMillis(long lastTimestamp) &#123; long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) &#123; timestamp = timeGen(); &#125; return timestamp; &#125; /** * è¿”å›žä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ * @return å½“å‰æ—¶é—´(æ¯«ç§’) */ protected long timeGen() &#123; return System.currentTimeMillis(); &#125; //==============================Test============================================= /** æµ‹è¯• */ public static void main(String[] args) &#123; SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0); for (int i = 0; i &lt; 1000; i++) &#123; long id = idWorker.nextId(); System.out.println(Long.toBinaryString(id)); System.out.println(id); &#125; &#125;&#125; æ•°æ®åº“è‡ªå¢žIDï¼ˆFlickerï¼‰ ä¸»è¦æ€è·¯æ˜¯é‡‡ç”¨æ•°æ®åº“è‡ªå¢žID + replace_intoå®žçŽ°å”¯ä¸€IDçš„èŽ·å–ã€‚ 123456create table t_global_id( id bigint(20) unsigned not null auto_increment, stub char(1) not null default '', primary key (id), unique key stub (stub)) engine=MyISAM; 123# æ¯æ¬¡ä¸šåŠ¡å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLè¯»å†™MySQLå¾—åˆ°IDå·replace into t_golbal_id(stub) values('a');select last_insert_id(); replace intoè·ŸinsertåŠŸèƒ½ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºŽï¼šreplace intoé¦–å…ˆå°è¯•æ’å…¥æ•°æ®åˆ—è¡¨ä¸­ï¼Œå¦‚æžœå‘çŽ°è¡¨ä¸­å·²ç»æœ‰æ­¤è¡Œæ•°æ®ï¼ˆæ ¹æ®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ¤æ–­ï¼‰åˆ™å…ˆåˆ é™¤ï¼Œå†æ’å…¥ã€‚å¦åˆ™ç›´æŽ¥æ’å…¥æ–°æ•°æ®ã€‚ å½“ç„¶ä¸ºäº†é¿å…æ•°æ®åº“çš„å•ç‚¹æ•…éšœï¼Œæœ€å°‘éœ€è¦ä¸¤ä¸ªæ•°æ®åº“å®žä¾‹ï¼Œé€šè¿‡åŒºåˆ†auto_incrementçš„èµ·å§‹å€¼å’Œæ­¥é•¿æ¥ç”Ÿæˆå¥‡å¶æ•°çš„IDã€‚ æ¯”å¦‚æœ‰ä¸¤å°æœºå™¨ã€‚è®¾ç½®æ­¥é•¿stepä¸º2ï¼ŒServer1çš„åˆå§‹å€¼ä¸º1ï¼ˆ1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11â€¦ï¼‰ã€Server2çš„åˆå§‹å€¼ä¸º2ï¼ˆ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºäº†å®žçŽ°ä¸Šè¿°æ–¹æ¡ˆåˆ†åˆ«è®¾ç½®ä¸¤å°æœºå™¨å¯¹åº”çš„å‚æ•°ï¼ŒServer1ä»Ž1å¼€å§‹å‘å·ï¼ŒServer2ä»Ž2å¼€å§‹å‘å·ï¼Œä¸¤å°æœºå™¨æ¯æ¬¡å‘å·ä¹‹åŽéƒ½é€’å¢ž2ã€‚å¦‚ä¸‹ï¼š 1234567Server1ï¼šauto-increment-increment = 2auto-increment-offset = 1Server2ï¼šauto-increment-increment = 2auto-increment-offset = 2 ä¼˜ç‚¹ ç®€å•ã€‚å……åˆ†å€ŸåŠ©æ•°æ®åº“çš„è‡ªå¢žIDæœºåˆ¶ï¼Œå¯é æ€§é«˜ï¼Œç”Ÿæˆæœ‰åºçš„IDã€‚ ç¼ºç‚¹ IDç”Ÿæˆä¾èµ–æ•°æ®åº“å•æœºçš„è¯»å†™æ€§èƒ½ã€‚ ä¾èµ–æ•°æ®åº“ï¼Œå½“æ•°æ®åº“å¼‚å¸¸æ—¶æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚ å¯¹äºŽMySQLçš„æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ¡ˆè§£å†³ï¼š åœ¨åˆ†å¸ƒå¼çŽ¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²Nå°æ•°æ®åº“å®žä¾‹ï¼Œæ¯å°è®¾ç½®æˆä¸åŒçš„åˆå§‹å€¼ï¼Œè‡ªå¢žæ­¥é•¿ä¸ºæœºå™¨çš„å°æ•°ã€‚æ¯å°çš„åˆå§‹å€¼åˆ†åˆ«ä¸º1,2,3...Nï¼Œæ­¥é•¿ä¸ºNã€‚ è¿™ç§æ–¹æ¡ˆè™½ç„¶è§£å†³äº†æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„å±€é™æ€§ï¼š ç³»ç»Ÿæ°´å¹³æ‰©å®¹å›°éš¾ï¼šç³»ç»Ÿå®šä¹‰å¥½æ­¥é•¿ä¹‹åŽï¼Œå¢žåŠ æœºå™¨ä¹‹åŽè°ƒæ•´æ­¥é•¿å›°éš¾ã€‚å¦‚æžœè¦æ·»åŠ æœºå™¨æ€Žä¹ˆåŠžï¼Ÿå‡è®¾çŽ°åœ¨åªæœ‰ä¸€å°æœºå™¨å‘å·æ˜¯1,2,3,4,5ï¼ˆæ­¥é•¿æ˜¯1ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰©å®¹æœºå™¨ä¸€å°ã€‚å¯ä»¥è¿™æ ·åšï¼šæŠŠç¬¬äºŒå°æœºå™¨çš„åˆå§‹å€¼è®¾ç½®å¾—æ¯”ç¬¬ä¸€å°è¶…è¿‡å¾ˆå¤šï¼Œæ¯”å¦‚14ï¼ˆå‡è®¾åœ¨æ‰©å®¹æ—¶é—´ä¹‹å†…ç¬¬ä¸€å°ä¸å¯èƒ½å‘åˆ°14ï¼‰ï¼ŒåŒæ—¶è®¾ç½®æ­¥é•¿ä¸º2ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨ä¸‹å‘çš„å·ç éƒ½æ˜¯14ä»¥åŽçš„å¶æ•°ã€‚ç„¶åŽæ‘˜æŽ‰ç¬¬ä¸€å°ï¼ŒæŠŠIDå€¼ä¿ç•™ä¸ºå¥‡æ•°ï¼Œæ¯”å¦‚7ï¼Œç„¶åŽä¿®æ”¹ç¬¬ä¸€å°çš„æ­¥é•¿ä¸º2ã€‚è®©å®ƒç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„å·æ®µæ ‡å‡†ï¼Œå¯¹äºŽè¿™ä¸ªä¾‹å­æ¥è¯´å°±æ˜¯è®©ç¬¬ä¸€å°ä»¥åŽåªèƒ½äº§ç”Ÿå¥‡æ•°ã€‚æ‰©å®¹æ–¹æ¡ˆçœ‹èµ·æ¥å¤æ‚å—ï¼Ÿè²Œä¼¼è¿˜å¥½ï¼ŒçŽ°åœ¨æƒ³è±¡ä¸€ä¸‹å¦‚æžœæˆ‘ä»¬çº¿ä¸Šæœ‰100å°æœºå™¨ï¼Œè¿™ä¸ªæ—¶å€™è¦æ‰©å®¹è¯¥æ€Žä¹ˆåšï¼Ÿç®€ç›´æ˜¯å™©æ¢¦ã€‚ æ•°æ®åº“åŽ‹åŠ›å¤§ï¼šæ¯æ¬¡èŽ·å–ä¸€ä¸ªIDéƒ½å¿…é¡»è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚å½“ç„¶å¯¹äºŽè¿™ç§é—®é¢˜ï¼Œä¹Ÿæœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯æ¯æ¬¡èŽ·å–IDæ—¶éƒ½æ‰¹é‡èŽ·å–ä¸€ä¸ªåŒºé—´çš„å·æ®µåˆ°å†…å­˜ä¸­ï¼Œç”¨å®Œä¹‹åŽå†æ¥èŽ·å–ã€‚æ•°æ®åº“çš„æ€§èƒ½æé«˜äº†å‡ ä¸ªé‡çº§ã€‚ ç¾Žå›¢çš„Leaf-segment Leaf-segment åœ¨ä½¿ç”¨æ•°æ®åº“çš„æ–¹æ¡ˆä¸Šåšäº†ä¼˜åŒ–ï¼Œåˆ©ç”¨proxy serveræ‰¹é‡èŽ·å–ï¼Œæ¯æ¬¡èŽ·å–ä¸€æ®µIDs(stepå†³å®šå¤§å°)ï¼Œç„¶åŽæŠŠè¿™æ®µIDsä½œä¸ºidæ± ç¼“å­˜èµ·æ¥ä½¿ç”¨ã€‚ç”¨å®Œä¹‹åŽå†åŽ»æ•°æ®åº“èŽ·å–æ–°çš„å·æ®µï¼Œä»Žè€Œå¤§å¤§çš„å‡è½»æ•°æ®åº“çš„åŽ‹åŠ›ã€‚è§£å†³äº†åŽŸæ–¹æ¡ˆæ¯æ¬¡èŽ·å–IDéƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“åŽ‹åŠ›å¤§çš„é—®é¢˜ã€‚Leaf-segmentçš„æ€»ä½“æž¶æž„å¦‚ä¸‹ï¼š ä¼˜ç‚¹ LeafæœåŠ¡å¯ä»¥å¾ˆæ–¹ä¾¿çš„çº¿æ€§æ‰©å±•ï¼Œæ€§èƒ½å®Œå…¨èƒ½å¤Ÿæ”¯æ’‘å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚ IDå·ç æ˜¯è¶‹åŠ¿é€’å¢žçš„8byteçš„64ä½æ•°å­—ï¼Œæ»¡è¶³ä¸Šè¿°æ•°æ®åº“å­˜å‚¨çš„ä¸»é”®è¦æ±‚ã€‚ å®¹ç¾æ€§é«˜ï¼šLeafæœåŠ¡å†…éƒ¨æœ‰å·æ®µç¼“å­˜ï¼Œå³ä½¿DBå®•æœºï¼ŒçŸ­æ—¶é—´å†…Leafä»èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚ å¯ä»¥è‡ªå®šä¹‰max_idçš„å¤§å°ï¼Œéžå¸¸æ–¹ä¾¿ä¸šåŠ¡ä»ŽåŽŸæœ‰çš„IDæ–¹å¼ä¸Šè¿ç§»è¿‡æ¥ã€‚ ç¼ºç‚¹ IDå·ç ä¸å¤Ÿéšæœºï¼Œèƒ½å¤Ÿæ³„éœ²å‘å·æ•°é‡çš„ä¿¡æ¯ï¼Œä¸å¤ªå®‰å…¨ã€‚ TP999æ•°æ®æ³¢åŠ¨å¤§ï¼Œå½“å·æ®µä½¿ç”¨å®Œä¹‹åŽè¿˜æ˜¯ä¼šhangåœ¨æ›´æ–°æ•°æ®åº“çš„I/Oä¸Šï¼Œtg999æ•°æ®ä¼šå‡ºçŽ°å¶å°”çš„å°–åˆºã€‚ DBå®•æœºä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚ Leaf-segment åŽ2ç‚¹ç¼ºç‚¹ï¼ŒLeaf-segmentåšäº†åŒbufferä¼˜åŒ–ï¼Œä»¥åŠâ€œä¸€ä¸»ä¸¤ä»Žâ€çš„é«˜å¯ç”¨å®¹ç¾ã€‚ ç¾Žå›¢çš„Leaf-snowflake Leaf-snowflake æ–¹æ¡ˆå®Œå…¨æ²¿ç”¨snowflakeæ–¹æ¡ˆçš„bitä½è®¾è®¡ï¼Œå³æ˜¯1+41+10+12çš„æ–¹å¼ç»„è£…IDå·ã€‚ç›¸æ¯” snowflakeï¼ŒLeaf-snowflakeåšäº†ä»¥ä¸‹2ç‚¹ä¼˜åŒ–ï¼š ä½¿ç”¨ZookeeperæŒä¹…é¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§è‡ªåŠ¨å¯¹snowflakeèŠ‚ç‚¹é…ç½®wokerIDï¼Œä¸€å®šç¨‹åº¦çš„æé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§å’Œå®¹é”™æ€§ã€‚ è§£å†³æ—¶é’Ÿå›žæ‹¨ä¼šå¯èƒ½å¯¼è‡´ç”Ÿæˆé‡å¤çš„IDå·çš„é—®é¢˜ã€‚ Leaf-snowflakeæ˜¯æŒ‰ç…§ä¸‹é¢å‡ ä¸ªæ­¥éª¤å¯åŠ¨çš„ï¼š å¯åŠ¨Leaf-snowflakeæœåŠ¡ï¼Œè¿žæŽ¥Zookeeperï¼Œåœ¨leaf_foreverçˆ¶èŠ‚ç‚¹ä¸‹æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»æ³¨å†Œè¿‡ï¼ˆæ˜¯å¦æœ‰è¯¥é¡ºåºå­èŠ‚ç‚¹ï¼‰ã€‚ å¦‚æžœæœ‰æ³¨å†Œè¿‡ç›´æŽ¥å–å›žè‡ªå·±çš„workerIDï¼ˆzké¡ºåºèŠ‚ç‚¹ç”Ÿæˆçš„intç±»åž‹IDå·ï¼‰ï¼Œå¯åŠ¨æœåŠ¡ã€‚ å¦‚æžœæ²¡æœ‰æ³¨å†Œè¿‡ï¼Œå°±åœ¨è¯¥çˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸåŽå–å›žé¡ºåºå·å½“åšè‡ªå·±çš„workerIDå·ï¼Œå¯åŠ¨æœåŠ¡ã€‚ å¾®ä¿¡çš„åºåˆ—å·ç”Ÿæˆå™¨seqsvr seqsvr æ˜¯å¾®ä¿¡çš„ä¸€ä¸ªé«˜å¯ç”¨ã€é«˜å¯é çš„åºåˆ—å·ç”Ÿæˆå™¨ï¼Œåˆ©ç”¨ç”Ÿæˆçš„åºåˆ—å·ï¼Œå®žçŽ°ç»ˆç«¯ä¸ŽåŽå°çš„æ•°æ®å¢žé‡åŒæ­¥æœºåˆ¶ã€‚è¿™å¥—åŒæ­¥æœºåˆ¶ä»ç„¶åœ¨æ¶ˆæ¯æ”¶å‘ã€æœ‹å‹åœˆé€šçŸ¥ã€å¥½å‹æ•°æ®æ›´æ–°ç­‰éœ€è¦æ•°æ®åŒæ­¥çš„åœ°æ–¹å‘æŒ¥ç€æ ¸å¿ƒçš„ä½œç”¨ã€‚seqsvrçš„æž¶æž„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼Œå³StoreSvrå’ŒAllocSvrï¼ˆå­˜å‚¨å±‚å’Œç¼“å­˜ä¸­é—´å±‚ï¼‰ã€‚æž¶æž„å¦‚ä¸‹å›¾ï¼š ä»Žåž‚ç›´æ–¹å‘çœ‹ï¼ŒAllocSvrè´Ÿè´£ç›´æŽ¥ä¸ºå®¢æˆ·ç«¯åˆ†é…sequenceï¼Œè€ŒStoreSvråˆ™è´Ÿè´£å½“å‰æœ€å¤§sequence numçš„å¯é å­˜å‚¨ï¼ˆé€šè¿‡NRWå®žçŽ°ï¼‰ã€‚è¿™ä¸ªè§’åº¦çœ‹æ¥ï¼Œå’Œç¾Žå›¢ç‚¹è¯„çš„Leaf-segmentæ˜¯éžå¸¸ç›¸ä¼¼çš„ã€‚ä¸»è¦åŒºåˆ«åœ¨äºŽä¸¤ç‚¹ï¼Œç¬¬ä¸€æ˜¯seqsvräº§ç”Ÿçš„sequenceæ˜¯åœ¨UIDï¼ˆç”¨æˆ·IDï¼‰ä¹‹ä¸‹çš„idï¼Œæ¢è¨€ä¹‹â€”â€”UID + sequence = å…¨å±€IDï¼›ç¬¬äºŒç‚¹æ˜¯seqsvrä½¿ç”¨äº†NRWå®žçŽ°äº†æ•°æ®å­˜å‚¨çš„å¼ºä¸€è‡´æ€§ã€‚ ä»Žæ°´å¹³æ–¹å‘çœ‹ï¼Œseqsvrä½¿ç”¨UIDè¿›è¡Œäº†æ°´å¹³åˆ‡åˆ†ï¼Œå®žçŽ°äº†è´Ÿè½½å‡è¡¡ã€‚å¯¹å•ä¸€çš„ä¸€ä¸ªsetåˆ†æžå¯çŸ¥ï¼ŒAllocSvrå¯ä»¥å®Œå…¨ä»¥è¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œè€Œä¸ç”¨å®žçŽ°æŒä¹…åŒ–ã€‚å› ä¸ºæœ€æ¶åŠ£çš„æƒ…å†µå°±æ˜¯ï¼ŒAllocSvrä¸­ä¸€éƒ¨åˆ†idè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹çš„æƒ…å†µä¸‹å®•æœºäº†ï¼Œé‡å¯ä¹‹åŽåˆé‡æ–°ç”³è¯·äº†ä¸€æ®µidï¼Œæ‰€ä»¥æœ‰ä¸€éƒ¨åˆ†idè¢«è·³è¿‡äº†ã€‚ç„¶è€Œï¼Œå¾®ä¿¡çš„sequence numæœ‰64ä½ï¼Œè€Œä¸”æ˜¯ä½äºŽUIDä¹‹ä¸‹çš„ï¼Œæ‰€ä»¥è·³è¿‡ä¸€æ®µidå®Œå…¨å¯ä»¥æŽ¥å—ã€‚ æ‰€ä»¥ï¼Œseqsvrçš„ä¸»è¦åŽ‹åŠ›è¿˜æ˜¯åœ¨StoreSvrï¼Œå³ä½¿è¿›è¡Œäº†Setåˆ‡åˆ†ï¼ŒNRWå­˜å‚¨æ¨¡å¼ä¾ç„¶è¿˜æ˜¯è¦åœ¨åžåé‡ä¸Šä»˜å‡ºä»£ä»·ã€‚å¤§æ¦‚æ˜¯ç»è¿‡äº†è¿›ä¸€æ­¥çš„å®žéªŒï¼Œseqsvrè¿›è¡Œäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–â€”â€”åˆ†æ®µå·å…±äº«å­˜å‚¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œmax_seqå°±æ˜¯å½“å‰çš„æœ€å¤§åºåˆ—å·ã€‚ä¸€ç»„ç”¨æˆ·å…±äº«ä¸€ä¸ªmax_seqï¼Œåˆ†ç»„çš„æ–¹å¼ä¾ç„¶æ˜¯ä½¿ç”¨UIDè¿›è¡Œåˆ‡åˆ†ã€‚è¿™æ ·ä¸€æ¥ï¼Œseqsvrä¸­StoreSvrçš„åŽ‹åŠ›å˜å¾—æ›´å°äº†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æžœå¤§å®¶çš„æ“ä½œé¢‘çŽ‡æ˜¯å‡ç­‰çš„ï¼Œé‚£ä¹ˆStoreSvrçš„å†™å…¥åŽ‹åŠ›é™ä¸ºåˆ‡åˆ†ä¹‹å‰çš„1 / Nï¼ˆNä¸ºåˆ†ç»„å†…éƒ¨ç”¨æˆ·çš„æ•°ç›®ï¼‰ã€‚è€Œä¸”StoreSvrå¯¹æ•°æ®çš„è½½å…¥åŽ‹åŠ›ä¹Ÿé™ä½Žä¸º1 / Nã€‚ Redisç”Ÿæˆå”¯ä¸€ID Rediså®žçŽ°äº†ä¸€ä¸ªåŽŸå­æ“ä½œINCRå’ŒINCRBYå®žçŽ°é€’å¢žçš„æ“ä½œã€‚å½“ä½¿ç”¨æ•°æ®åº“æ€§èƒ½ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥é‡‡ç”¨Redisæ¥ä»£æ›¿ï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤æ¥æé«˜åžåé‡ã€‚ å¯ä»¥åˆå§‹åŒ–æ¯å°Redisçš„åˆå§‹å€¼ä¸º1,2,3,4,5ï¼Œç„¶åŽæ­¥é•¿ä¸º5ã€‚å„ä¸ªRedisç”Ÿæˆçš„IDä¸ºï¼š 12345Aï¼š1ï¼Œ6ï¼Œ11ï¼Œ16ï¼Œ21Bï¼š2ï¼Œ7ï¼Œ12ï¼Œ17ï¼Œ22Cï¼š3ï¼Œ8ï¼Œ13ï¼Œ18ï¼Œ23Dï¼š4ï¼Œ9ï¼Œ14ï¼Œ19ï¼Œ24Eï¼š5ï¼Œ10ï¼Œ15ï¼Œ20ï¼Œ25 ä¼˜ç‚¹ ä¸ä¾èµ–äºŽæ•°æ®åº“ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸”æ€§èƒ½ä¼˜äºŽæ•°æ®åº“ã€‚ æ•°å­—IDå¤©ç„¶æŽ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æŽ’åºçš„ç»“æžœå¾ˆæœ‰å¸®åŠ©ã€‚ ç¼ºç‚¹ å¦‚æžœç³»ç»Ÿä¸­æ²¡æœ‰Redisï¼Œè¿˜éœ€è¦å¼•å…¥æ–°çš„ç»„ä»¶ï¼Œå¢žåŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚ éœ€è¦ç¼–ç å’Œé…ç½®çš„å·¥ä½œé‡æ¯”è¾ƒå¤§ã€‚è¿™ä¸ªéƒ½ä¸æ˜¯æœ€å¤§çš„é—®é¢˜ã€‚ Zookeeperç”Ÿæˆå”¯ä¸€ID zookeeperä¸»è¦é€šè¿‡å…¶znodeæ•°æ®ç‰ˆæœ¬æ¥ç”Ÿæˆåºåˆ—å·ï¼Œå¯ä»¥ç”Ÿæˆ32ä½å’Œ64ä½çš„æ•°æ®ç‰ˆæœ¬å·ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬å·æ¥ä½œä¸ºå”¯ä¸€çš„åºåˆ—å·ã€‚ å¾ˆå°‘ä¼šä½¿ç”¨zookeeperæ¥ç”Ÿæˆå”¯ä¸€IDã€‚ä¸»è¦æ˜¯ç”±äºŽéœ€è¦ä¾èµ–zookeeperï¼Œå¹¶ä¸”æ˜¯å¤šæ­¥è°ƒç”¨APIï¼Œå¦‚æžœåœ¨ç«žäº‰è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚å› æ­¤ï¼Œæ€§èƒ½åœ¨é«˜å¹¶å‘çš„åˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ï¼Œä¹Ÿä¸ç”šç†æƒ³ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ¬åœ°ä»£ç ä¸Šä¼ åˆ°GitHub]]></title>
    <url>%2Fposts%2Fceff156c.html</url>
    <content type="text"><![CDATA[é¦–å…ˆä½ éœ€è¦ä¸€ä¸ªgithubè´¦å·ï¼Œæ‰€æœ‰è¿˜æ²¡æœ‰çš„è¯å…ˆåŽ»æ³¨å†Œå§ï¼ https://github.com/ æˆ‘ä»¬ä½¿ç”¨gitéœ€è¦å…ˆå®‰è£…gitå·¥å…·ï¼Œè¿™é‡Œç»™å‡ºä¸‹è½½åœ°å€ï¼Œä¸‹è½½åŽä¸€è·¯ç›´æŽ¥å®‰è£…å³å¯ï¼š https://git-for-windows.github.io/ è¿›å…¥Githubé¦–é¡µï¼Œç‚¹å‡»New repositoryæ–°å»ºä¸€ä¸ªé¡¹ç›® å¡«å†™ç›¸åº”ä¿¡æ¯åŽç‚¹å‡»createå³å¯ Repository name: ä»“åº“åç§° Description(å¯é€‰): ä»“åº“æè¿°ä»‹ç» Public, Private : ä»“åº“æƒé™ï¼ˆå…¬å¼€å…±äº«ï¼Œç§æœ‰æˆ–æŒ‡å®šåˆä½œè€…ï¼‰ Initialize this repository with a README: æ·»åŠ ä¸€ä¸ªREADME.md gitignore: ä¸éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„ä»“åº“ç±»åž‹ï¼Œå¯¹åº”ç”Ÿæˆæ–‡ä»¶.gitignore license: è¯ä¹¦ç±»åž‹ï¼Œå¯¹åº”ç”Ÿæˆæ–‡ä»¶LICENSE ç‚¹å‡»Clone or dowloadä¼šå‡ºçŽ°ä¸€ä¸ªåœ°å€ï¼Œcopyè¿™ä¸ªåœ°å€å¤‡ç”¨ã€‚ æŽ¥ä¸‹æ¥å°±åˆ°æœ¬åœ°æ“ä½œäº†ï¼Œé¦–å…ˆé¼ æ ‡å³é”®ï¼Œå¦‚æžœä½ ä¹‹å‰å®‰è£…gitæˆåŠŸçš„è¯ï¼Œå³é”®ä¼šå‡ºçŽ°ä¸¤ä¸ªæ–°é€‰é¡¹ï¼Œåˆ†åˆ«ä¸ºGit Gui Here,Git Bash Here,è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Git Bash Hereï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼š æŽ¥ä¸‹æ¥è¾“å…¥å¦‚ä¸‹ä»£ç ï¼ˆå…³é”®æ­¥éª¤ï¼‰ï¼ŒæŠŠgithubä¸Šé¢çš„ä»“åº“å…‹éš†åˆ°æœ¬åœ° 1git clone https://github.com/whb1990/blogSourceCode.git åœ°å€æ¢æˆä½ è‡ªå·±çš„ã€‚ è¿™ä¸ªæ­¥éª¤ä»¥åŽä½ çš„æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹é¢å°±ä¼šå¤šå‡ºä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹åå³ä¸ºä½ githubä¸Šé¢çš„é¡¹ç›®åï¼Œå¦‚å›¾æˆ‘å¤šå‡ºäº†ä¸ªblogSourceCodeæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æŠŠæœ¬åœ°éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶éƒ½å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼š æŽ¥ç€ç»§ç»­è¾“å…¥å‘½ä»¤ cd blogSourceCodeï¼Œè¿›å…¥ blogSourceCode æ–‡ä»¶å¤¹ æŽ¥ä¸‹æ¥ä¾æ¬¡è¾“å…¥ä»¥ä¸‹ä»£ç å³å¯å®Œæˆå…¶ä»–å‰©ä½™æ“ä½œï¼š git add . ï¼ˆæ³¨ï¼šåˆ«å¿˜è®°åŽé¢çš„.ï¼Œæ­¤æ“ä½œæ˜¯æŠŠblogSourceCodeæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶éƒ½æ·»åŠ è¿›æ¥ï¼‰ æ‰§è¡Œå®Œè¯¥å‘½ä»¤å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹æç¤ºä¿¡æ¯ï¼š è¿™ä¸ªæç¤ºçš„å¤§è‡´æ„æ€å°±æ˜¯ï¼š 1234567æ‚¨å·²ç»åœ¨å½“å‰å­˜å‚¨åº“ä¸­æ·»åŠ äº†å¦ä¸€ä¸ªGitå­˜å‚¨åº“ã€‚å¤–éƒ¨å­˜å‚¨åº“çš„å…‹éš†å°†ä¸åŒ…å«åµŒå…¥å­˜å‚¨åº“çš„å†…å®¹ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•èŽ·å–å®ƒã€‚å¦‚æžœè¦æ·»åŠ å­æ¨¡å—ï¼Œè¯·ä½¿ç”¨ï¼š git submodule add &lt;url&gt; themes/nextå¦‚æžœé”™è¯¯åœ°æ·»åŠ äº†æ­¤è·¯å¾„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ git rm --cached themes/next å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘ç”¨Hexoæ­å»ºçš„ä¸ªäººåšå®¢ï¼Œç”¨åˆ°äº†Nextä¸»é¢˜(å¦ä¸€ä¸ªGitå­˜å‚¨åº“)ï¼Œä¸Šé¢çš„æç¤ºä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬è¯¥æ€Žä¹ˆåšï¼Œå…¶å®žé™¤äº†ä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯ç›´æŽ¥åˆ é™¤ä½ è¦åŒ…å«çš„å­åº“ç›®å½•ä¸‹çš„.gitæ–‡ä»¶å¤¹å³å¯ã€‚ git commit -m &quot;æäº¤ä¿¡æ¯&quot; ï¼ˆæ³¨ï¼šâ€œæäº¤ä¿¡æ¯â€é‡Œé¢æ¢æˆä½ éœ€è¦ï¼Œå¦‚â€œfirst commitâ€ï¼‰ git push -u origin master ï¼ˆæ³¨ï¼šæ­¤æ“ä½œç›®çš„æ˜¯æŠŠæœ¬åœ°ä»“åº“pushåˆ°githubä¸Šé¢ï¼Œæ­¤æ­¥éª¤éœ€è¦ä½ è¾“å…¥å¸å·å’Œå¯†ç ï¼‰ åŽ»GitHubä¸Šçœ‹ä¸‹ä¸Šä¼ åŽçš„ä»£ç  é—®é¢˜è§£å†³ï¼š åœ¨ä¸Šä¼ ä»£ç åˆ°GitHubçš„æ—¶å€™ï¼Œæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š åŽŸå› æ˜¯æŽ¨é€çš„æ–‡ä»¶å¤ªå¤§ã€‚æˆ‘è¿™æ¬¡æŽ¨é€çš„å†…å®¹è¶…è¿‡çš„1Gï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚ æ–¹æ³•ä¸€ï¼š ä¿®æ”¹æäº¤ç¼“å­˜å¤§å°ä¸º5000Mï¼Œæˆ–è€…æ›´å¤§çš„æ•°å­— 1git config --global http.postBuffer 5242880000 --globalé…ç½®å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¦‚æžœéœ€è¦å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œåˆ™ç”¨--system æˆ–è€…åœ¨å…‹éš†/åˆ›å»ºç‰ˆæœ¬åº“ç”Ÿæˆçš„ .gitç›®å½•ä¸‹é¢ä¿®æ”¹ç”Ÿæˆçš„configæ–‡ä»¶å¢žåŠ å¦‚ä¸‹ï¼š 12[http] postBuffer = 524288000 æ–¹æ³•äºŒï¼š é…ç½®gitçš„æœ€ä½Žé€Ÿåº¦å’Œæœ€ä½Žé€Ÿåº¦æ—¶é—´ï¼š 12git config --global http.lowSpeedLimit 0git config --global http.lowSpeedTime 999999 å•ä½ ç§’ --globalé…ç½®å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¦‚æžœéœ€è¦å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œåˆ™ç”¨--system æˆ‘æ˜¯é€‰æ‹©çš„æ–¹æ³•ä¸€ï¼Œè§£å†³æ•ˆæžœå¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>Git</category>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo live2dæ’ä»¶æ•ˆæžœé¢„è§ˆ]]></title>
    <url>%2Fposts%2Ffcf4ee5f.html</url>
    <content type="text"><![CDATA[Epsilon2.1 Gantzert_Felixander haru miku ni-j nico nietzche nipsilon nito shizuku tsumiki wanko z16 hibiki koharu haruto Unitychan tororo hijiki]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -Sessionä¸¢å¤±åŠè§£å†³]]></title>
    <url>%2Fposts%2F223e2ff2.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯Sessionä¸¢å¤± Sessionæ˜¯ä¸ºäº†å°†åŒä¸€ä¸ªç”¨æˆ·çš„å¤šæ¬¡è®¿é—®åœ¨ç³»ç»Ÿä¸­è¢«è¯†åˆ«ä¸ºâ€œåŒä¸€ä¸ªç”¨æˆ·â€è€Œäº§ç”Ÿçš„æ¦‚å¿µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åŸºäºŽå®ƒæ¥å‡å°‘é‡å¤å¾€DBæˆ–è€…è¿œç¨‹æœåŠ¡å¤„èŽ·å–ä¸Žè¯¥ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œä»¥èµ·åˆ°æå‡æ€§èƒ½çš„ä½œç”¨ã€‚ åœ¨åšäº†è´Ÿè½½å‡è¡¡çš„åœºæ™¯ä¸­ï¼Œå¦‚æžœé€‰æ‹©çš„è´Ÿè½½ç­–ç•¥æ˜¯hashç­–ç•¥ï¼Œé‚£ä¹ˆä¼šä½¿å¾—Sessionäº§ç”Ÿä¸€ä¸ªå‰¯ä½œç”¨ï¼šç”¨æˆ·ä¸€æ—¦ç”±äºŽæŸç§åŽŸå› ä»ŽåŽŸå…ˆè®¿é—®æœåŠ¡å™¨Aå˜æˆè®¿é—®æœåŠ¡å™¨Bï¼Œå°±ä¼šå‡ºçŽ°â€œç™»é™†çŠ¶æ€ä¸¢å¤±â€ã€â€œç¼“å­˜ç©¿é€â€ç­‰é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆhashç­–ç•¥ä¼šå‡ºçŽ°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿé¦–å…ˆæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹hashæ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚hashç­–ç•¥å°±æ˜¯ä¸‹å›¾è¿™æ ·çš„ä¸€ä¸ªæ•£åˆ—å‡½æ•°ã€‚åœ¨å‡½æ•°ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒAæ°¸è¿œå¯¹åº”01ï¼ŒBå¯¹åº”04ï¼ŒCå¯¹åº”08ã€‚ ä»¥nginxä¸­çš„ip_hashç­–ç•¥æ¥ä¸¾ä¸ªä¾‹å­ã€‚æ­£å¸¸æƒ…å†µä¸‹ç”¨æˆ·çš„ipä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å½“ä½¿ç”¨ip_hashç­–ç•¥è¿›è¡Œè´Ÿè½½å‡è¡¡æ—¶ï¼Œæ„å‘³ç€æœŸæœ›åŒä¸€ä¸ªç”¨æˆ·èƒ½å¤Ÿä¸€ç›´è®¿é—®åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå°±åƒä¸‹å›¾è¿™æ ·ã€‚ å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸€å°æœåŠ¡å™¨ä¸Šå°†è¿™ä¸ªç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ç¼“å­˜åœ¨è¿›ç¨‹å†…ï¼Œè¿™æ—¶ï¼Œå®¢æˆ·ç«¯ä¸ŽæœåŠ¡ç«¯ä¹‹é—´çš„ç›¸å½“äºŽå»ºç«‹äº†ä¸€ä¸ªä¿¡ä»»ï¼Œç›¸äº’è®¤è¯†ã€‚è¿™ä¸ªä¿¡ä»»å°±æ˜¯ã€ŒSessionã€ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åŠ äº†ä¸€å°æœåŠ¡å™¨ä¹‹åŽï¼Œäº‹æƒ…å°±å‘ç”Ÿå˜åŒ–äº†ã€‚ è¿™ä¸ªæ—¶å€™åŽŸå…ˆçš„é¢„æœŸå°±è¢«ç ´åäº†ã€‚å› ä¸ºç”¨æˆ·ä¸Žåºå·0èŠ‚ç‚¹çš„é“¾æŽ¥å˜æˆäº†ä¸Žåºå·3çš„é“¾æŽ¥ï¼Œæ‰€ä»¥äº§ç”Ÿäº†Sessionä¸¢å¤±é—®é¢˜ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œåœ¨åºå·0èŠ‚ç‚¹ä¸Šåšçš„è¿›ç¨‹å†…ç¼“å­˜éƒ½æ— æ•ˆäº†ï¼Œè€Œåœ¨åºå·3èŠ‚ç‚¹ä¸Šåˆæ²¡æœ‰ç”¨æˆ·ç›¸å…³çš„ä»»ä½•ç¼“å­˜ï¼Œå¯¼è‡´å¤§é‡æ•°æ®éœ€è¦ä»Žä¸‹æ¸¸çš„DBæˆ–è€…è¿œç¨‹æœåŠ¡å¤„èŽ·å–ã€‚è¦çŸ¥é“ï¼Œä¸€æ—¦æ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡ï¼Œæ€§èƒ½å¿…ç„¶æ˜Žæ˜¾ä¸‹é™ï¼ŒI/Oã€åºåˆ—åŒ–éƒ½æ˜¯è€—æ—¶çš„å·¥ä½œã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä¸€æ—¦åŒæ—¶æœ‰å¤§é‡ç”¨æˆ·äº§ç”Ÿè¿™ä¸ªæƒ…å†µï¼Œç”±äºŽåŽç«¯çš„DBå’Œè¿œç¨‹æœåŠ¡çž¬æ—¶æ— æ³•æ‰¿è½½æ¿€å¢žçš„é«˜å¯†åº¦è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®ƒæŒ‚èµ·ã€‚è¿™è¿˜æ²¡å®Œï¼Œå¦‚æžœå½“å‰ç¨‹åºæ²¡æœ‰ä¸€äº›æ•…éšœéš”ç¦»æˆ–è€…é™çº§ç­–ç•¥ï¼Œè¿˜ä¼šè¿›ä¸€æ­¥äº§ç”Ÿè´è¶æ•ˆåº”ï¼Œå¯¼è‡´æ•´ä¸ªå¤§ç³»ç»Ÿå“åº”ç¼“æ…¢ã€‚ nginxæ˜¯å¦‚ä½•è§£å†³çš„ é€šè¿‡åœ¨nginxä¸­å¼•å…¥nginx-sticky-moduleæ¨¡å—å¯ä»¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è§£å†³çš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå½“clientç¬¬ä¸€æ¬¡è¿›å…¥åˆ°nginxåŒ¹é…èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåœ¨ç»™å®ƒåˆ†é…ä¸€ä¸ªèŠ‚ç‚¹çš„åŒæ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†è¿›è¡Œmd5åŽå†™å…¥åˆ°cookieä¸­ä¸€å¹¶è¿”å›žï¼Œå¦‚æžœä¸‹æ¬¡å†å‘èµ·è¯·æ±‚çš„æ—¶å€™å‘çŽ°å¸¦æœ‰è¿™ä¸ªcookieå€¼ï¼Œå°±ç›´æŽ¥è½¬å‘åˆ°è¯¥å€¼æ‰€å¯¹åº”çš„èŠ‚ç‚¹ä¸ŠåŽ»ã€‚è¿™ä¸ªæœºåˆ¶è¢«ä¸“ä¸šçš„ç§°ä¹‹ä¸ºã€ŒSessionä¿æŒã€ã€‚ è™½ç„¶å¯ä»¥åˆ©ç”¨cookieæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯cookieä¹Ÿæœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œå¦‚æžœå®¢æˆ·ç«¯æœªå¼€å¯cookieåŠŸèƒ½ï¼Œè¿™ä¸ªæœºåˆ¶å°±å¤±æ•ˆäº†ã€‚ä¸è¿‡å¥½åœ¨ç›®å‰ä¸»æµæµè§ˆå™¨éƒ½æ˜¯é»˜è®¤æ‰“å¼€cookieçš„ã€‚ å…¶ä»–è§£å†³æ–¹æ¡ˆ Sessionå¤åˆ¶ è¿™æ˜¯æœ€ç®€å•ç²—æš´çš„æ–¹å¼ã€‚æ ¹æ®ä¸Šé¢çš„æ¡ˆä¾‹æ¥çœ‹ï¼Œå¯¼è‡´é—®é¢˜çš„åŽŸå› æ˜¯èŠ‚ç‚¹3æ²¡æœ‰ç”¨æˆ·çš„Sessionã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œåœ¨èŠ‚ç‚¹3è¿è¡Œä¹‹å‰æŠŠSessionç›¸å…³çš„Cacheæ•°æ®å¤åˆ¶è¿‡åŽ»ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´æŒç»­ä¿è¯æ•°æ®çš„åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€å°èŠ‚ç‚¹ä¸Šéƒ½å­˜åœ¨æ¯ä¸ªç”¨æˆ·çš„Sessionæ•°æ®ã€‚ å®žçŽ°çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯ä¸åŒçš„å®¿ä¸»ç¨‹åºéƒ½æˆ–å¤šæˆ–å°‘æä¾›äº†ä¸€äº›åˆ‡å…¥ç‚¹ï¼Œç”šè‡³æ˜¯æ‹¿æ¥å³ç”¨çš„æ–¹æ¡ˆï¼Œå¦‚Tomcatçš„Delta Managerå’ŒBackup Managerã€Tomcatå’ŒIISçš„Filteræœºåˆ¶ç­‰ç­‰ã€‚æ­¤ç±»æ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ ä¼˜ç‚¹ï¼šå¤©ç„¶é«˜å¯ç”¨ï¼Œä¸€éƒ¨åˆ†èŠ‚ç‚¹å®•æœºæ²¡äº‹ã€‚å› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå­˜æ”¾ç€æ‰€æœ‰å·²è¿žæŽ¥ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚ ç¼ºç‚¹ï¼šå› ä¸ºæ¯å°è®¡ç®—æœºçš„å†…å­˜æ˜¯æœ‰ä¸Šé™çš„ï¼Œä»…é€‚ç”¨äºŽä¼šè¯ç›¸å…³çš„æ•°æ®å¤§å°è¾ƒå°çš„åœºæ™¯ã€‚å¹¶ä¸”ï¼Œç”±äºŽå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒæ­¥æ•°æ®ï¼Œéœ€è¦é¢å¤–è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œéšç€èŠ‚ç‚¹è¶Šå¤šï¼ŒæŸè€—è¶Šå¤§ï¼ˆå»¶è¿Ÿã€å¸¦å®½ç­‰ï¼‰ï¼Œæœ‰å¹¿æ’­é£Žæš´é£Žé™©ã€‚ Sessionå…±äº« é€šè¿‡å°†sessionä¿¡æ¯å­˜æ”¾åˆ°å…¨å±€å…±äº«çš„å­˜å‚¨ä»‹è´¨ä¸­æ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæžœï¼Œå¦‚æ•°æ®åº“ã€è¿œç¨‹ç¼“å­˜ç­‰ï¼Œè¿™æ˜¯ä¸€ç§ä¸­å¿ƒåŒ–æ€æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚ æ­¤ç±»æ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ï¼š ä¼˜ç‚¹ï¼šä¸ç®¡èŠ‚ç‚¹æ€Žä¹ˆå¢žåŠ å’Œå‡å°‘ï¼Œ100%ä¸ä¼šäº§ç”Ÿä¼šè¯ä¸¢å¤±ã€‚ ç¼ºç‚¹ï¼šæ¯æ¬¡è¯»å†™è¯·æ±‚éƒ½éœ€è¦å¢žåŠ é¢å¤–å…±äº«å‚¨å­˜è°ƒç”¨ï¼Œå¢žåŠ äº†ç½‘ç»œI/Oã€åºåˆ—åŒ–ç­‰æ“ä½œï¼Œæ€§èƒ½æ˜Žæ˜¾ä¸‹é™ã€‚å¦å¤–ï¼Œç”¨ä½œå…±äº«çš„å­˜å‚¨ä»‹è´¨é™¤äº†å¢žåŠ äº†é¢å¤–çš„ç»´æŠ¤æˆæœ¬å¤–ï¼Œè¿˜éœ€è¦è§£å†³å•ç‚¹é—®é¢˜ï¼Œä»¥å…äº§ç”Ÿç³»ç»Ÿæ€§é£Žé™©ã€‚ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯” åˆ†åˆ«ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä¸€ä¸‹è¿™3ä¸ªæ–¹æ¡ˆï¼š Session ä¿æŒï¼šåŽŸæ¥åœ¨å“ªè¿˜æ˜¯åŽ»å“ªã€‚ Session å¤åˆ¶ï¼šä¸ç®¡åœ¨å“ªéƒ½æœ‰ä¸€æ ·çš„æ•°æ®ã€‚ Session å…±äº«ï¼šæ‰€æœ‰èŠ‚ç‚¹å…±ç”¨ä¸€ä»½æ•°æ®ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -è´Ÿè½½å‡è¡¡]]></title>
    <url>%2Fposts%2F95c2b1da.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…³é”®æ˜¯åšå†—ä½™ï¼Œè®©è¿™äº›å†—ä½™èƒ½å‘æŒ¥é«˜å¯ç”¨ä½œç”¨çš„å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡çš„ä½œç”¨æ˜¯ä¸€ä¸ªâ€œè¿žæŽ¥è€…â€ï¼Œè®©ä¸Šä¸‹æ¸¸ä¹‹é—´ä»¥æœŸæœ›çš„æ–¹å¼â€œè¿žæŽ¥â€èµ·æ¥ã€‚æ‰€ä»¥ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹è¿™äº›ä¸Šä¸‹æ¸¸çš„å…¨è²Œï¼Œå¹¶ä¸”ä»Žä¸­æ‰¾åˆ°åšè´Ÿè½½å‡è¡¡çš„åœ°æ–¹ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å„å¼å„æ ·çš„æž¶æž„æ–¹å¼ï¼Œä¸è¿‡æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸Šå›¾è¿™æ ·çš„ä¸€ä¸ªåˆ†å±‚æž¶æž„ã€‚å›¾ä¸­çº¢ç‚¹æ ‡è®°å‡ºçš„åœ°æ–¹å°±æ˜¯éœ€è¦åšè´Ÿè½½å‡è¡¡çš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯æ¯ä¸¤å±‚ä¹‹é—´çš„è¿žæŽ¥å¤„ã€‚è¿™äº›è¿žæŽ¥å¤„åœ¨å®žé™…åšè´Ÿè½½å‡è¡¡çš„æ—¶å€™ï¼Œéœ€è¦ç»“åˆæ‰€å¤„çš„ç½‘ç»œå±‚æ¬¡ã€‚å› ä¸ºåœ¨ä¸åŒçš„ç½‘ç»œå±‚æ¬¡æœ‰ä¸åŒçš„åšæ³•ã€‚å¦‚ä¸‹å›¾ã€‚ ä¸€èˆ¬ä¸»æµçš„å››å±‚è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå‰è€…æŒ‡çš„å°±æ˜¯ä¼ è¾“å±‚ï¼Œä¸»è¦æ¶‰åŠçš„åè®®æ˜¯TCPã€UDPç­‰ï¼ŒåŽè€…æŒ‡çš„åº”ç”¨å±‚ï¼Œä¸»è¦æ¶‰åŠçš„åè®®æ˜¯Httpã€Httpså’ŒFTPç­‰ã€‚ ç”¨æ¥å®žçŽ°è´Ÿè½½å‡è¡¡çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œåˆ†ä¸ºåŸºäºŽç¡¬ä»¶æˆ–è€…åŸºäºŽè½¯ä»¶çš„ï¼Œæ¯”è¾ƒæˆç†Ÿçš„è¯¸å¦‚ï¼šF5ï¼ˆæ”¯æŒå››å±‚ã€ä¸ƒå±‚ï¼‰ã€LVSï¼ˆæ”¯æŒå››å±‚ï¼‰ã€Nginxï¼ˆæ”¯æŒä¸ƒå±‚ï¼‰ç­‰ç­‰ã€‚ å¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ è½®è¯¢ è¿™æ˜¯æœ€å¸¸ç”¨ä¹Ÿæœ€ç®€å•ç­–ç•¥ï¼Œå¹³å‡åˆ†é…ï¼Œäººäººéƒ½æœ‰ã€ä¸€äººä¸€æ¬¡ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234567891011int globalIndex = 0; try&#123; return servers[globalIndex];&#125;finally&#123; globalIndex++; if (globalIndex == 3) globalIndex = 0;&#125; åŠ æƒè½®è¯¢ åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œå¢žåŠ äº†ä¸€ä¸ªæƒé‡çš„æ¦‚å¿µã€‚æƒé‡æ˜¯ä¸€ä¸ªæ³›åŒ–åŽçš„æ¦‚å¿µï¼Œå¯ä»¥ç”¨ä»»æ„æ–¹å¼æ¥ä½“çŽ°ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèƒ½è€…å¤šåŠ³æ€æƒ³ã€‚æ¯”å¦‚ï¼Œå¯ä»¥æ ¹æ®å®¿ä¸»çš„æ€§èƒ½å·®å¼‚é…ç½®ä¸åŒçš„æƒé‡ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234567891011121314151617int matchedIndex = -1;int total = 0;for (int i = 0; i &lt; servers.Length; i++)&#123; //æ¯æ¬¡å¾ªçŽ¯çš„æ—¶å€™åšè‡ªå¢žï¼ˆæ­¥é•¿=æƒé‡å€¼ï¼‰ servers[i].cur_weight += servers[i].weight; //å°†æ¯ä¸ªèŠ‚ç‚¹çš„æƒé‡å€¼ç´¯åŠ åˆ°æ±‡æ€»å€¼ä¸­ total += servers[i].weight; //å¦‚æžœ å½“å‰èŠ‚ç‚¹çš„è‡ªå¢žæ•° &gt; å½“å‰å¾…è¿”å›žèŠ‚ç‚¹çš„è‡ªå¢žæ•°ï¼Œåˆ™è¦†ç›–ã€‚ if (matchedIndex == -1 || servers[matchedIndex].cur_weight &lt; servers[i].cur_weight) &#123; matchedIndex = i; &#125;&#125;servers[matchedIndex].cur_weight -= total;//â‘£è¢«é€‰å–çš„èŠ‚ç‚¹å‡åŽ»â‘¡çš„æ±‡æ€»å€¼ï¼Œä»¥é™ä½Žä¸‹ä¸€æ¬¡è¢«é€‰ä¸¾æ—¶çš„åˆå§‹æƒé‡å€¼ã€‚return servers[matchedIndex]; è¿™æ®µä»£ç çš„è¿‡ç¨‹å¦‚ä¸‹å›¾çš„è¡¨æ ¼ã€‚&quot;()&quot;ä¸­çš„æ•°å­—å°±æ˜¯è‡ªå¢žæ•°ï¼Œä»£ç ä¸­çš„cur_weightã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŠ æƒè½®è¯¢æœ¬èº«è¿˜æœ‰ä¸åŒçš„å®žçŽ°æ–¹å¼ï¼Œè™½è¯´æœ€ç»ˆçš„æ¯”ä¾‹éƒ½æ˜¯2ï¼š1ï¼š2ã€‚ä½†æ˜¯åœ¨è¯·æ±‚é€è¾¾çš„å…ˆåŽé¡ºåºä¸Šå¯ä»¥æ‰€æœ‰ä¸åŒã€‚æ¯”å¦‚ã€Œ5-4ï¼Œ3ï¼Œ2-1ã€å’Œä¸Šé¢çš„æ¡ˆä¾‹ç›¸æ¯”ï¼Œæœ€ç»ˆæ¯”ä¾‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ•ˆæžœä¸åŒã€‚ã€Œ5-4ï¼Œ3ï¼Œ2-1ã€æ›´å®¹æ˜“äº§ç”Ÿå¹¶å‘é—®é¢˜ï¼Œå¯¼è‡´æœåŠ¡ç«¯æ‹¥å¡žï¼Œä¸”è¿™ä¸ªé—®é¢˜éšç€æƒé‡æ•°å­—è¶Šå¤§è¶Šä¸¥é‡ã€‚ä¾‹å­ï¼š10ï¼š5ï¼š3çš„ç»“æžœæ˜¯ã€Œ18-17-16-15-14-13-12-11-10-9ï¼Œ8-7-6-5-4ï¼Œ3-2-1ã€ æœ€å°‘è¿žæŽ¥æ•° è¿™æ˜¯ä¸€ç§æ ¹æ®å®žæ—¶çš„è´Ÿè½½æƒ…å†µï¼Œè¿›è¡ŒåŠ¨æ€è´Ÿè½½å‡è¡¡çš„æ–¹å¼ã€‚ç»´æŠ¤å¥½æ´»åŠ¨ä¸­çš„è¿žæŽ¥æ•°é‡ï¼Œç„¶åŽå–æœ€å°çš„è¿”å›žå³å¯ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234var matchedServer = servers.orderBy(e =&gt; e.active_conns).first();matchedServer.active_conns += 1;return matchedServer;//åœ¨è¿žæŽ¥å…³é—­æ—¶è¿˜éœ€å¯¹active_connsåšå‡1çš„åŠ¨ä½œã€‚ æœ€å¿«å“åº” è¿™ä¹Ÿæ˜¯ä¸€ç§åŠ¨æ€è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒçš„æœ¬è´¨æ˜¯æ ¹æ®æ¯ä¸ªèŠ‚ç‚¹å¯¹è¿‡åŽ»ä¸€æ®µæ—¶é—´å†…çš„å“åº”æƒ…å†µæ¥åˆ†é…ï¼Œå“åº”è¶Šå¿«åˆ†é…çš„è¶Šå¤šã€‚å…·ä½“çš„è¿ä½œæ–¹å¼ä¹Ÿæœ‰å¾ˆå¤šï¼Œä¸Šå›¾çš„è¿™ç§å¯ä»¥ç†è§£ä¸ºï¼Œå°†æœ€è¿‘ä¸€æ®µæ—¶é—´çš„è¯·æ±‚è€—æ—¶çš„å¹³å‡å€¼è®°å½•ä¸‹æ¥ï¼Œç»“åˆå‰é¢çš„ã€ŒåŠ æƒè½®è¯¢ã€æ¥å¤„ç†ï¼Œæ‰€ä»¥ç­‰ä»·äºŽ2ï¼š1ï¼š3çš„åŠ æƒè½®è¯¢ã€‚ Hashæ³• hashæ³•çš„è´Ÿè½½å‡è¡¡ä¸Žä¹‹å‰çš„å‡ ç§ä¸åŒåœ¨äºŽï¼Œå®ƒçš„ç»“æžœæ˜¯ç”±å®¢æˆ·ç«¯å†³å®šçš„ã€‚é€šè¿‡å®¢æˆ·ç«¯å¸¦æ¥çš„æŸä¸ªæ ‡è¯†ç»è¿‡ä¸€ä¸ªæ ‡å‡†åŒ–çš„æ•£åˆ—å‡½æ•°è¿›è¡Œæ‰“æ•£åˆ†æ‘Šã€‚ å¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ å¥åº·æŽ¢æµ‹ä¿éšœé«˜å¯ç”¨ ä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„ç­–ç•¥ï¼Œéš¾å…ä¼šé‡åˆ°æœºå™¨æ•…éšœæˆ–è€…ç¨‹åºæ•…éšœçš„æƒ…å†µã€‚æ‰€ä»¥è¦ç¡®ä¿è´Ÿè½½å‡è¡¡èƒ½æ›´å¥½çš„èµ·åˆ°æ•ˆæžœï¼Œè¿˜éœ€è¦ç»“åˆä¸€äº›ã€Œå¥åº·æŽ¢æµ‹ã€æœºåˆ¶ã€‚å®šæ—¶çš„åŽ»æŽ¢æµ‹æœåŠ¡ç«¯æ˜¯ä¸æ˜¯è¿˜èƒ½è¿žä¸Šï¼Œå“åº”æ˜¯ä¸æ˜¯è¶…å‡ºé¢„æœŸçš„æ…¢ã€‚å¦‚æžœèŠ‚ç‚¹å±žäºŽâ€œä¸å¯ç”¨â€çš„çŠ¶æ€çš„è¯ï¼Œéœ€è¦å°†è¿™ä¸ªèŠ‚ç‚¹ä¸´æ—¶ä»Žå¾…é€‰å–åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä»¥æé«˜å¯ç”¨æ€§ã€‚ä¸€èˆ¬å¸¸ç”¨çš„ã€Œå¥åº·æŽ¢æµ‹ã€æ–¹å¼æœ‰3ç§ã€‚ HTTPæŽ¢æµ‹ ä½¿ç”¨Get/Postçš„æ–¹å¼è¯·æ±‚æœåŠ¡ç«¯çš„æŸä¸ªå›ºå®šçš„URLï¼Œåˆ¤æ–­è¿”å›žçš„å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä¸€èˆ¬ä½¿ç”¨HttpçŠ¶æ€ç ã€responseä¸­çš„å†…å®¹æ¥åˆ¤æ–­ã€‚ TCPæŽ¢æµ‹ åŸºäºŽTcpçš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶æ¥æŽ¢æµ‹æŒ‡å®šçš„IP + ç«¯å£ã€‚æœ€ä½³å®žè·µå¯ä»¥å€Ÿé‰´é˜¿é‡Œäº‘çš„SLBæœºåˆ¶ï¼Œå¦‚ä¸‹å›¾ã€‚ UDPæŽ¢æµ‹ å¯èƒ½æœ‰éƒ¨åˆ†åº”ç”¨ä½¿ç”¨çš„UDPåè®®ã€‚åœ¨æ­¤åè®®ä¸‹å¯ä»¥é€šè¿‡æŠ¥æ–‡æ¥è¿›è¡ŒæŽ¢æµ‹æŒ‡å®šçš„IP + ç«¯å£ã€‚æœ€ä½³å®žè·µåŒæ ·å¯ä»¥å€Ÿé‰´é˜¿é‡Œäº‘çš„SLBæœºåˆ¶ï¼Œå¦‚ä¸‹å›¾ã€‚ ç»“æžœçš„åˆ¤å®šæ–¹å¼æ˜¯ï¼šåœ¨æœåŠ¡ç«¯æ²¡æœ‰è¿”å›žä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ã€‚å¦åˆ™ä¼šè¿”å›žä¸€ä¸ªICMPçš„æŠ¥é”™ä¿¡æ¯ã€‚ å®žæ–½è´Ÿè½½å‡è¡¡ ç¡¬ä»¶è´Ÿè½½å‡è¡¡ ç¡¬ä»¶è¿™å—åæ°”æœ€å¤§çš„è¿˜å±žF5ã€‚æ­¤ç±»ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„ç‰¹ç‚¹æ˜¯â€œå£•â€ï¼Œæ¯•ç«Ÿæ˜¯çº¯å•†ä¸šåŒ–çš„ä¸œè¥¿ï¼ŒæŠ•å…¥çš„èµ„æºå’Œç²¾åŠ›è‡ªç„¶æ˜¯ä¼—å¤šå¼€æºè½¯ä»¶è´Ÿè½½å‡è¡¡æ‰€æ— æ³•æ¯”æ‹Ÿçš„ï¼Œæ‰€ä»¥åŠŸèƒ½éžå¸¸å¼ºå¤§ã€‚åŒ…å«è®¿é—®åŠ é€Ÿã€åŽ‹ç¼©ã€å®‰å…¨ç­‰ç­‰è´Ÿè½½å‡è¡¡ä¹‹å¤–çš„è®¸å¤šé™„åŠ åŠŸèƒ½ã€‚ å¦‚æžœç”¨F5ç»„ç½‘çš„è¯ï¼Œæœ‰ä¸¤ç§ç»“æž„ï¼Œä¸²è¡Œç»“æž„å’Œå¹¶è¡Œç»“æž„ï¼Œä¹Ÿç§°ä¸ºç›´è¿žæ¨¡å¼å’Œæ—è·¯æ¨¡å¼ã€‚å‰è€…çš„ä¼˜åŠ¿åœ¨å¯¹ç¡¬ä»¶äº§ç”ŸåŽ‹åŠ›è¾ƒå°ã€ä¸”å¤©ç„¶å®‰å…¨æ€§é«˜ï¼Œè€ŒåŽè€…å¯¹åŽŸç½‘ç»œæž¶æž„çš„æ”¹åŠ¨è¾ƒå°ã€ä¸”æ‰©å±•æ€§è¾ƒå¥½ã€‚å¤§å®¶åœ¨å®žé™…çš„ä½¿ç”¨ä¸­ç»“åˆè‡ªèº«æƒ…å†µæ¥éƒ¨ç½²ã€‚ è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼ˆL7ï¼‰ é’ˆå¯¹Webåº”ç”¨çš„L7è´Ÿè½½å‡è¡¡ï¼Œæ¯”è¾ƒä¸»æµçš„äº§å“æ˜¯2ä¸ªNginxã€HAProxyã€‚åœ¨L7åšè´Ÿè½½å‡è¡¡ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯çµæ´»ï¼Œè¯·æ±‚çš„URLã€Headeréƒ½æ˜¯å¯ä»¥åŽ»æŽŒæŽ§çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„ä»»ä½•ä¿¡æ¯ä¸ºè´Ÿè½½å‡è¡¡ç­–ç•¥æ‰€ç”¨ã€‚å®žé™…æ“ä½œä¸­ä¸»è¦åš2æ­¥ï¼š åœ¨å…¬ç½‘çš„åŸŸåè§£æžä¸­ï¼Œé…ç½®è§£æžåˆ°ã€Œåå‘ä»£ç†ã€ã€‚è®°å½•ç±»åž‹æ˜¯ã€ŒAã€ï¼Œè®°å½•å€¼æ˜¯ã€Œåå‘ä»£ç†ã€çš„IPã€‚ é…ç½®çœŸå®žæä¾›æœåŠ¡çš„Webåº”ç”¨IPå’Œç«¯å£ï¼Œå’Œè´Ÿè½½å‡è¡¡å‡è¡¡ç­–ç•¥ã€‚ä¸Šå›¾ä¸­çš„é…ç½®æ˜¯Nginxä¸­çš„ç¤ºä¾‹ï¼Œè´Ÿè½½å‡è¡¡ç­–ç•¥çš„ç¼ºçœå€¼æ˜¯è½®è¯¢ã€‚ è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼ˆL4ï¼‰ å½“Webåº”ç”¨æ‰€ä¾èµ–çš„TCPåè®®çš„æœåŠ¡éœ€è¦æ¨ªå‘æ‰©å±•ï¼Œæˆ–è€…éœ€è¦åšæ•°æ®åº“ã€åˆ†å¸ƒå¼ç¼“å­˜çš„å¤šä¸»ã€ä¸»ä»Žé›†ç¾¤æ—¶ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªæ”¯æŒL4çš„è´Ÿè½½å‡è¡¡è½¯ä»¶ã€‚è¿™é‡Œæœ€çŸ¥åçš„å°±å±žLVSäº†ï¼Œå®ƒæ˜¯å†…æ ¸æ€çš„ç¨‹åºï¼Œæ‰€ä»¥ç›¸æ¯”ç”¨Nginxã€HAProxyæ¥åšL4çš„è´Ÿè½½å‡è¡¡ï¼Œåœ¨æ€§èƒ½ã€èµ„æºçš„æ¶ˆè€—ä¸Šä¼šæ›´ä¼˜ä¸€äº›ã€‚å®žé™…è¿ç”¨ä¸­çš„æ“ä½œæ­¥éª¤ä¸»è¦ä¹Ÿæ˜¯2æ­¥ï¼š åœ¨LVSä¸­æ·»åŠ ä¸€ä¸ªIPè™šæ‹ŸæœåŠ¡ï¼ˆIPVSï¼‰ï¼Œå¹¶æŒ‡å®šå®ƒçš„IPã€ç«¯å£å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ å°†IPè™šæ‹ŸæœåŠ¡å…³è”åˆ°çœŸå®žçš„æœåŠ¡ä¸Šï¼Œå¹¶æŒ‡å®šæ¨¡å¼å’Œæƒé‡çš„ä¿¡æ¯ã€‚ï¼ˆåšL4çš„è´Ÿè½½å‡è¡¡å¯ä»¥ä½¿ç”¨NATæˆ–è€…FULLNATæ¨¡å¼ï¼‰ LVSçš„æ¨¡å¼ä¸€å…±æœ‰å››ç§ï¼Œé™¤äº†NATå’ŒFULLNATï¼ˆNATçš„å¢žå¼ºç‰ˆï¼‰æ¨¡å¼å¤–ï¼Œå®ƒçš„TUNæ¨¡å¼å¯ä»¥åœ¨L3åšè´Ÿè½½å‡è¡¡ï¼ŒDRæ¨¡å¼å¯ä»¥åœ¨L2åšè´Ÿè½½å‡è¡¡ï¼Œåˆ°è¿™ä¸ªå±‚é¢å…¶å®žå°±å’Œåšç¡¬ä»¶åŒå¤„äºŽä¸€ä¸ªå±‚æ¬¡äº†ã€‚å¹¶ä¸”ï¼Œéšç€å±‚æ¬¡çš„æ·±å…¥ï¼Œè™½ç„¶å¯¹åŠŸèƒ½æ€§ä¸Šæœ‰æ‰€å¼±åŒ–ï¼Œä½†æ˜¯å¦‚æžœä¸è€ƒè™‘ç«¯å£çš„è¯ï¼Œå•ä»ŽIPå±‚é¢çš„è´Ÿè½½å‡è¡¡æ¥è¯´ï¼Œç”¨DRæ¨¡å¼åšï¼Œåˆ™å¯¹æ•°æ®åŒ…çš„åŠ å·¥ä»‹å…¥åº¦ä¼šé™åˆ°æœ€ä½Žï¼Œå› æ­¤ä¹Ÿæ˜¯é€šè¿‡è½¯ä»¶åšè´Ÿè½½å‡è¡¡èƒ½å¤Ÿè¾¾åˆ°çš„æ€§èƒ½æžè‡´ã€‚ å¦å¤–ï¼ŒLVSä¸­è¿ç”¨çš„è™šæ‹ŸIPæ¦‚å¿µï¼Œæœ¬è´¨ä¸Šå’ŒNginxä¸­çš„â€œserverâ€æ¦‚å¿µä¸€æ ·ï¼Œå®šä¹‰äº†ä¸€ä¸ªç»Ÿä¸€å…¥å£ï¼Œä½œç”¨ä¸Šå¹¶æ²¡æœ‰å·®åˆ«ã€‚å°†Nginxä¸­çš„upstreamå…³è”åˆ°serverï¼Œå°±å¦‚LVSæ“ä½œæ­¥éª¤ç¬¬2ç‚¹ä¸­çš„å…³è”ä¸€èˆ¬ã€‚ ä¼˜ç¼ºç‚¹ ä¸åŒçš„è§£å†³æ–¹æ¡ˆæœ‰ä¸åŒçš„ä¾§é‡ç‚¹ã€‚å› æ­¤åœ¨å•ä¸ªè§£å†³æ–¹æ¡ˆå·²ç»æ— æ³•æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå„å°½æ‰€é•¿ã€‚ æŽ¨èæ–¹æ¡ˆ è´Ÿè½½å‡è¡¡è¿™ä¸ªé¢†åŸŸè¿˜æ˜¯ä»¥é«˜å¯ç”¨å’Œæ€§èƒ½ä¸º2ä¸ªæœ€é‡è¦å› ç´ ï¼Œä¸‹é¢æ˜¯æŽ¨èçš„ä¸€ç§ç»„åˆæ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨ç³»ç»Ÿé‡çº§è¾¾åˆ°æ¯å°æ—¶ä¸Šäº¿PVä¹‹åŽæœ€è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§ã€‚ç†è®ºä¸Šï¼Œåˆ©ç”¨ç¬¬ä¸€æ­¥DNSçš„åŸŸåè§£æžæ‰€å¸¦çš„è´Ÿè½½å‡è¡¡æ•ˆæžœï¼Œåªè¦å¤åˆ¶å¤šå¥—LVSä¸»å¤‡å‡ºæ¥ï¼Œç»‘ä¸Šå¤šä¸ªä¸åŒçš„è™šIPï¼Œå¯ä»¥åšåˆ°æ— é™æ¨ªå‘æ‰©å±•ï¼Œä»¥æ”¯æ’‘ä¸æ–­å¢žé•¿çš„æµé‡ã€‚ ç”¨åˆ°çš„3ä¸ªè½¯ä»¶ç›®å‰éƒ½æ˜¯å¼€æºäº§å“ï¼ŒLVS+Keepalivedè´Ÿè´£åšNginxçš„è´Ÿè½½å‡è¡¡ï¼Œè€ŒNginxè´Ÿè´£åˆ†å‘åˆ°å®žé™…çš„è¯·æ±‚åˆ°Httpå’ŒTcpåè®®çš„åº”ç”¨ä¸Šã€‚ å…³äºŽLVSçš„æ¨¡å¼é€‰æ‹©ï¼Œå¦‚æžœåœ¨åŒç½‘æ®µå†…çš„è¯ä¼˜å…ˆä½¿ç”¨DRæ¨¡å¼è¿›è¡ŒL2è½¬å‘ï¼Œæ€§èƒ½æœ€å¥½ã€‚å¦åˆ™ä½¿ç”¨TUNæ¨¡å¼è¿›è¡ŒL3åˆ†å‘ã€‚ä¸Žæ­¤åŒæ—¶ï¼Œåœ¨L4ã€L7çš„åˆ†å‘ä¸Šä½¿ç”¨Nginxæ¥åšï¼Œå¯ä»¥å‘æŒ¥å…¶çµæ´»æ˜“æ‰©å±•çš„ç‰¹ç‚¹ä»¥åŠå…¶å®ƒçš„ä¸€äº›é¢å¤–ç‰¹æ€§å¦‚ç¼“å­˜ç­‰ã€‚]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>é«˜å¯ç”¨</tag>
        <tag>è´Ÿè½½å‡è¡¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC-å‡çº§ç‰ˆ]]></title>
    <url>%2Fposts%2Fa6a74f01.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° æ‰‹å†™RPC-ç®€æ˜“ç‰ˆ ï¼Œå®žçŽ°äº†ä¸€ä¸ªå¾ˆç®€å•çš„RPCè°ƒç”¨ç¤ºä¾‹ï¼Œå…¶ä¸­è¿˜å­˜åœ¨å¾ˆå¤šé—®é¢˜åŠå¯ä¼˜åŒ–çš„ç‚¹ï¼Œ è¿™æ¬¡åšä¸ªå‡çº§ï¼Œå®Œå…¨é‡å†™ä¹‹å‰çš„ä»£ç ï¼Œä½¿å¾—ä»£ç é€»è¾‘æ›´åŠ è§„èŒƒï¼ŒåŒæ—¶å¼•å…¥Zookeeperè¾…åŠ©å®ŒæˆæœåŠ¡æ²»ç†ã€‚åœ¨ä»£ç å±•ç¤ºå‰ï¼Œå…ˆä»‹ç»ä¸‹Zookeeperã€æœåŠ¡æ²»ç†ç­‰æ¦‚å¿µã€‚ Zookeeper ZooKeeperï¼ˆç®€ç§°zkï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¼€æºçš„åº”ç”¨åè°ƒæœåŠ¡ï¼Œåˆ©ç”¨å’ŒPaxosç±»ä¼¼çš„ZABé€‰ä¸¾ç®—æ³•å®žçŽ°åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡ã€‚æœ‰ç±»ä¼¼äºŽUnixæ–‡ä»¶ç›®å½•çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒæ—¶å¯ä»¥é’ˆå¯¹èŠ‚ç‚¹çš„å˜æ›´æ·»åŠ watcherç›‘å¬ä»¥èƒ½å¤ŸåŠæ—¶æ„ŸçŸ¥åˆ°èŠ‚ç‚¹ä¿¡æ¯å˜æ›´ã€‚å¯æä¾›çš„åŠŸèƒ½ä¾‹å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾å°±æ˜¯DUBBOå­˜å‚¨åœ¨ZooKeeperçš„èŠ‚ç‚¹æ•°æ®æƒ…å†µï¼š åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡åŽé€šè¿‡zkå®¢æˆ·ç«¯è¿žæŽ¥åŽä¹Ÿå¯é€šè¿‡å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ZooKeeperåŒ…å«äº†4ç§ä¸åŒå«ä¹‰çš„åŠŸèƒ½èŠ‚ç‚¹ï¼Œåœ¨æ¯æ¬¡åˆ›å»ºèŠ‚ç‚¹ä¹‹å‰éƒ½éœ€è¦æ˜Žç¡®å£°æ˜ŽèŠ‚ç‚¹ç±»åž‹: ç±»åž‹ å®šä¹‰ æè¿° PERSISTENT æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Žzookeeperæ–­å¼€è¿žæŽ¥åŽï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ PERSISTENT_SEQUENTIAL æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Žzookeeperæ–­å¼€è¿žæŽ¥åŽï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· EPHEMERAL ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Žzookeeperæ–­å¼€è¿žæŽ¥åŽï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ EPHEMERAL_SEQUENTIAL ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸Žzookeeperæ–­å¼€è¿žæŽ¥åŽï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· ZooKeeperä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆè¿›è¡Œå®‰è£…ï¼ŒåŽå¼€å¯æœåŠ¡ç«¯çš„æœåŠ¡ï¼Œ æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºå®¢æˆ·ç«¯è¿žæŽ¥ZooKeeperä»¥ä¾¿äºŽåŽç»­çš„æ“ä½œã€‚å…·ä½“å¯å‚è€ƒå®˜ç½‘æ–‡æ¡£Zookeeper3.5.5 å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨å®žé™…çš„javaé¡¹ç›®å¼€å‘ä¸­ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡mavenå¼•å…¥ZkClientæˆ–è€…Curatorå¼€æºçš„å®¢æˆ·ç«¯ï¼Œåœ¨æœ¬æ–‡å­¦ä¹ ç¬”è®°ä¸­æ˜¯ä½¿ç”¨çš„Curatorï¼Œå› ä¸ºå…¶å·²ç»å°è£…äº†åŽŸå§‹çš„èŠ‚ç‚¹æ³¨å†Œã€æ•°æ®èŽ·å–ã€æ·»åŠ watcherç­‰åŠŸèƒ½ã€‚å…·ä½“mavenå¼•å…¥çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-framework&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt;&lt;/dependency&gt; æœåŠ¡æ²»ç† æœåŠ¡æ²»ç†ä¹Ÿå°±æ˜¯é’ˆå¯¹æœåŠ¡è¿›è¡Œç®¡ç†çš„æŽªæ–½ï¼Œä¾‹å¦‚ æœåŠ¡å‘çŽ°ã€ æœåŠ¡æš´éœ²ã€ è´Ÿè½½å‡è¡¡ã€ å¿«é€Ÿä¸Šä¸‹çº¿ç­‰éƒ½æ˜¯æœåŠ¡æ²»ç†çš„å…·ä½“ä½“çŽ°ã€‚ æœåŠ¡å‘çŽ°ï¼šä»ŽæœåŠ¡ç®¡ç†ä¸­å¿ƒèŽ·å–åˆ°éœ€è¦çš„æœåŠ¡ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚å¯ä»¥ä»Žzkä¸­èŽ·å–ç›¸å…³æœåŠ¡çš„æœºå™¨ä¿¡æ¯ï¼Œç„¶åŽå°±å¯ä»¥å’Œå…·ä½“æœºå™¨ç›´è¿žå®Œæˆç›¸å…³åŠŸèƒ½ã€‚ æœåŠ¡æš´éœ²ï¼šæœåŠ¡æä¾›æ–¹å¯ä»¥æä¾›ä»€ä¹ˆæ ·å­çš„åŠŸèƒ½ï¼Œç»è¿‡æœåŠ¡æš´éœ²æš´éœ²å‡ºåŽ»ï¼Œå…¶ä»–ä½¿ç”¨æ–¹å°±å¯ä»¥é€šè¿‡æœåŠ¡å‘çŽ°å‘çŽ°å…·ä½“çš„æœåŠ¡æä¾›æ–¹ä¿¡æ¯ã€‚ è´Ÿè½½å‡è¡¡ï¼šä¸€èˆ¬é’ˆå¯¹çš„æ˜¯æœåŠ¡æä¾›æ–¹ï¼Œé¿å…å¤§é‡è¯·æ±‚åŒæ—¶æ‰“åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œé‡‡ç”¨éšæœºã€è½®è¯¢ç­‰æŽªæ–½è®©è¯·æ±‚å‡åˆ†åˆ°å„ä¸ªæœºå™¨ä¸Šï¼Œæä¾›æœåŠ¡æ•ˆçŽ‡ï¼Œ é™æµï¼Œ ç°åº¦ç­‰ä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„æ“ä½œï¼Œé€šè¿‡åŠ¨æ€è·¯ç”±ã€è½¯è´Ÿè½½çš„å½¢å¼å¤„ç†åˆ†å‘è¯·æ±‚ã€‚ å¿«é€Ÿä¸Šçº¿ä¸‹ï¼šä»¥å¾€éœ€è¦ä¸Šä¸‹çº¿å¯èƒ½éœ€è¦æ€æŽ‰æœºå™¨ä¸Šçš„è¿›ç¨‹ï¼ŒçŽ°åœ¨åªéœ€è¦è®©è¯¥æœåŠ¡åœæ­¢æš´éœ²å³å¯ï¼Œå®žçŽ°æœåŠ¡çš„çµæ´»ä¸Šä¸‹çº¿ã€‚ æ•°æ®å¤„ç†æµç¨‹ æœåŠ¡ç«¯ï¼šæœåŠ¡çš„æä¾›æ–¹ï¼ŒæŽ¥å—ç½‘ç»œä¼ è¾“çš„è¯·æ±‚æ•°æ®ã€é€šè¿‡ç½‘ç»œæŠŠåº”ç­”æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯; å®¢æˆ·ç«¯ï¼šæœåŠ¡çš„è°ƒç”¨æ–¹ï¼Œä½¿ç”¨æœ¬åœ°ä»£ç†ï¼Œé€šè¿‡ç½‘ç»œæŠŠè¯·æ±‚æ•°æ®å‘é€å‡ºåŽ»ï¼ŒæŽ¥å—æœåŠ¡ç«¯è¿”å›žçš„åº”ç­”æ•°æ®. æ‰€æœ‰çš„æ•°æ®ä¼ è¾“éƒ½æ˜¯æŒ‰ç…§ä¸Šé¢å›¾ç‰‡è¯´çš„æµç¨‹æ¥çš„ï¼Œå¦‚æžœéœ€è¦æ·»åŠ è‡ªå®šä¹‰çš„åºåˆ—åŒ–å·¥å…·ï¼Œåˆ™éœ€è¦åœ¨æŠŠæ•°æ®æäº¤åˆ°socketçš„è¾“å‡ºæµç¼“å†²åŒºä¹‹å‰æŒ‰ç…§åºåˆ—åŒ–å·¥å…·å®Œæˆåºåˆ—åŒ–æ“ä½œï¼Œååºåˆ—åŒ–åˆ™è¿›è¡Œåå‘æ“ä½œå³å¯ã€‚ RPC V2ç‰ˆæœ¬ æ–‡ä»¶å¤¹ç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š balanceæ–‡ä»¶å¤¹ï¼šè´Ÿè½½å‡è¡¡æœ‰å…³ï¼› configæ–‡ä»¶å¤¹ï¼šç½‘ç»œå¥—æŽ¥å­—ä¼ è¾“çš„æ•°æ®æ¨¡åž‹ä»¥åŠæœåŠ¡æš´éœ²ã€æœåŠ¡å‘çŽ°çš„æ•°æ®æ¨¡åž‹ï¼› coreæ–‡ä»¶å¤¹ï¼šæ ¸å¿ƒæ–‡ä»¶å¤¹ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¯·æ±‚å¤„ç†ã€ä»£ç†ç”Ÿæˆç­‰ï¼› demoæ–‡ä»¶å¤¹ï¼šæµ‹è¯•ä½¿ç”¨ï¼› domainæ–‡ä»¶å¤¹ï¼šæ¨¡åž‹ã€æžšä¸¾å¸¸é‡ï¼› io.protocolæ–‡ä»¶å¤¹ï¼šç›®å‰æ˜¯åªæœ‰å…·ä½“çš„è¯·æ±‚å¯¹è±¡å’Œç½‘ç»œioçš„å°è£…ï¼› registeræ–‡ä»¶å¤¹ï¼šæœåŠ¡æ³¨å†Œä½¿ç”¨ï¼Œå®žçŽ°äº†ä½¿ç”¨zkè¿›è¡ŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘çŽ°çš„æ“ä½œï¼› serializeæ–‡ä»¶å¤¹ï¼šåºåˆ—åŒ–ã€ååºåˆ—åŒ–ï¼Œå®žçŽ°äº†Javaå’ŒHessianä¸¤ç§ã€‚ æœåŠ¡æ³¨å†Œ&amp;æœåŠ¡å‘çŽ° ServiceRegisterï¼š 123456789101112131415161718192021222324252627282930package com.springboot.whb.study.rpc.rpc_v2.register;import com.springboot.whb.study.rpc.rpc_v2.config.BasicConfig;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import java.net.InetSocketAddress;/** * @author: whb * @description: æœåŠ¡æ³¨å†Œ */public interface ServiceRegister &#123; /** * æœåŠ¡æ³¨å†Œ * * @param config */ void register(BasicConfig config); /** * æœåŠ¡å‘çŽ°ï¼Œä»Žæ³¨å†Œä¸­å¿ƒèŽ·å–å¯ç”¨çš„æœåŠ¡æä¾›æ–¹ä¿¡æ¯ * * @param request * @param nodeType * @return */ InetSocketAddress discovery(RpcRequest request, ServiceType nodeType);&#125; ZkServiceRegister é»˜è®¤ä½¿ç”¨äº†CuratorFrameworkå®¢æˆ·ç«¯å®Œæˆzkæ•°æ®çš„æ“ä½œ. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149package com.springboot.whb.study.rpc.rpc_v2.register;import com.springboot.whb.study.rpc.rpc_v2.balance.DefaultLoadBalance;import com.springboot.whb.study.rpc.rpc_v2.balance.LoadBalance;import com.springboot.whb.study.rpc.rpc_v2.config.BasicConfig;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.extern.slf4j.Slf4j;import org.apache.curator.RetryPolicy;import org.apache.curator.framework.CuratorFramework;import org.apache.curator.framework.CuratorFrameworkFactory;import org.apache.curator.retry.ExponentialBackoffRetry;import org.apache.zookeeper.CreateMode;import java.net.InetSocketAddress;import java.util.List;/** * @author: whb * @description: ZookeeperæœåŠ¡æ³¨å†Œå®žçŽ°ç±» */@Slf4jpublic class ZkServiceRegister implements ServiceRegister &#123; private CuratorFramework client; private static final String ROOT_PATH = "whb/demo-rpc"; private LoadBalance loadBalance = new DefaultLoadBalance(); public ZkServiceRegister() &#123; //é‡è¯•ç­–ç•¥ RetryPolicy policy = new ExponentialBackoffRetry(1000, 3); this.client = CuratorFrameworkFactory .builder() .connectString("127.0.0.1:2181") .sessionTimeoutMs(50000) .retryPolicy(policy) .namespace(ROOT_PATH) .build(); // ä¸šåŠ¡çš„æ ¹è·¯å¾„æ˜¯ /whb/demo-rpc ,å…¶ä»–çš„éƒ½ä¼šé»˜è®¤æŒ‚è½½åœ¨è¿™é‡Œ this.client.start(); System.out.println("zkå¯åŠ¨æ­£å¸¸"); &#125; /** * æœåŠ¡æ³¨å†Œ * * @param config */ @Override public void register(BasicConfig config) &#123; String interfacePath = "/" + config.getInterfaceName(); try &#123; if (this.client.checkExists().forPath(interfacePath) == null) &#123; // åˆ›å»º æœåŠ¡çš„æ°¸ä¹…èŠ‚ç‚¹ this.client.create() .creatingParentsIfNeeded() .withMode(CreateMode.PERSISTENT) .forPath(interfacePath); &#125; config.getMethods().forEach(method -&gt; &#123; String methodPath = null; try &#123; ServiceType serviceType = config.getType(); if (serviceType == ServiceType.PROVIDER) &#123; // æœåŠ¡æä¾›æ–¹ï¼Œéœ€è¦æš´éœ²è‡ªèº«çš„ipã€portä¿¡æ¯ï¼Œè€Œæ¶ˆè´¹ç«¯åˆ™ä¸éœ€è¦ String address = getServiceAddress(config); methodPath = String.format("%s/%s/%s/%s", interfacePath, serviceType.getType(), method.getMethodName(), address); &#125; else &#123; methodPath = String.format("%s/%s/%s", interfacePath, serviceType.getType(), method.getMethodName()); &#125; log.info("zk path: [" + ROOT_PATH + methodPath + "]"); // åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åŒ…å«äº†æœåŠ¡æä¾›æ®µçš„ä¿¡æ¯ this.client.create() .creatingParentsIfNeeded() .withMode(CreateMode.EPHEMERAL) .forPath(methodPath, "0".getBytes()); &#125; catch (Exception e) &#123; log.error("åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹[" + methodPath + "]å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125;); &#125; catch (Exception e) &#123; log.error("åˆ›å»ºæœåŠ¡èŠ‚ç‚¹å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; /** * æœåŠ¡å‘çŽ° * * @param request * @param nodeType * @return */ @Override public InetSocketAddress discovery(RpcRequest request, ServiceType nodeType) &#123; String path = String.format("/%s/%s/%s", request.getClassName(), nodeType.getType(), request.getMethodName()); try &#123; List&lt;String&gt; addressList = this.client.getChildren().forPath(path); // é‡‡ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼èŽ·å–æœåŠ¡æä¾›æ–¹ä¿¡æ¯,ä¸è¿‡å¹¶æ²¡æœ‰æ·»åŠ watcherç›‘å¬æ¨¡å¼ String address = loadBalance.balance(addressList); if (address == null) &#123; return null; &#125; return parseAddress(address); &#125; catch (Exception e) &#123; log.error("æœåŠ¡å‘çŽ°æŽ¥å£å¼‚å¸¸ï¼Œerror:&#123;&#125;", e); &#125; return null; &#125; /** * èŽ·å–æœåŠ¡åœ°å€ * * @param config * @return */ private String getServiceAddress(BasicConfig config) &#123; String hostInfo = new StringBuilder() .append(config.getHost()) .append(":") .append(config.getPort()) .toString(); return hostInfo; &#125; /** * å°è£…ç«¯å£ * * @param address * @return */ private InetSocketAddress parseAddress(String address) &#123; String[] result = address.split(":"); return new InetSocketAddress(result[0], Integer.valueOf(result[1])); &#125; /** * è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ * * @param loadBalance */ public void setLoadBalance(LoadBalance loadBalance) &#123; this.loadBalance = loadBalance; &#125;&#125; è´Ÿè½½å‡è¡¡ LoadBalance 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;/** * @author: whb * @description: è´Ÿè½½å‡è¡¡æŽ¥å£å®šä¹‰ */public interface LoadBalance &#123; /** * è´Ÿè½½å‡è¡¡ * * @param addressList * @return */ String balance(List&lt;String&gt; addressList);&#125; AbstractLoadBalance 1234567891011121314151617181920212223242526272829package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;/** * @author: whb * @description: æŠ½è±¡è´Ÿè½½å‡è¡¡ */public abstract class AbstractLoadBalance implements LoadBalance &#123; @Override public String balance(List&lt;String&gt; addressList) &#123; if (addressList == null || addressList.isEmpty()) &#123; return null; &#125; if (addressList.size() == 1) &#123; return addressList.get(0); &#125; return doLoad(addressList); &#125; /** * æŠ½è±¡æŽ¥å£ï¼Œè®©å­ç±»åŽ»å®žçŽ° * * @param addressList * @return */ abstract String doLoad(List&lt;String&gt; addressList);&#125; DefaultLoadBalance 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;import java.util.Random;/** * @author: whb * @description: é»˜è®¤è´Ÿè½½å‡è¡¡--éšæœºè´Ÿè½½å‡è¡¡ */public class DefaultLoadBalance extends AbstractLoadBalance &#123; @Override String doLoad(List&lt;String&gt; addressList) &#123; //éšæœº Random random = new Random(); return addressList.get(random.nextInt(addressList.size())); &#125;&#125; æ¶ˆæ¯åè®® MessageProtocol 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.springboot.whb.study.rpc.rpc_v2.io.protocol;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.core.RpcResponse;import java.io.InputStream;import java.io.OutputStream;/** * @author: whb * @description: è¯·æ±‚ã€åº”ç­” è§£æžå’Œåè§£æžï¼ŒåŒ…å«äº†åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–æ“ä½œ */public interface MessageProtocol &#123; /** * æœåŠ¡ç«¯è§£æžä»Žç½‘ç»œä¼ è¾“çš„æ•°æ®ï¼Œè½¬å˜æˆrequestå¯¹è±¡ * * @param inputStream * @return */ RpcRequest serviceToRequest(InputStream inputStream); /** * æœåŠ¡ç«¯æŠŠè®¡ç®—çš„ç»“æžœåŒ…è£…å¥½ï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›žç»™å®¢æˆ·ç«¯ * * @param response * @param outputStream * @param &lt;T&gt; */ &lt;T&gt; void serviceGetResponse(RpcResponse&lt;T&gt; response, OutputStream outputStream); /** * å®¢æˆ·ç«¯æŠŠè¯·æ±‚æ‹¼æŽ¥å¥½ï¼Œé€šè¿‡è¾“å‡ºæµå‘é€åˆ°æœåŠ¡ç«¯ * * @param request * @param outputStream */ void clientToRequest(RpcRequest request, OutputStream outputStream); /** * å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ç»“æžœï¼Œè½¬å˜æˆresponseå¯¹è±¡ * * @param inputStream */ &lt;T&gt; RpcResponse&lt;T&gt; clientGetResponse(InputStream inputStream);&#125; DefaultMessageProtocol 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188package com.springboot.whb.study.rpc.rpc_v2.io.protocol;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.core.RpcResponse;import com.springboot.whb.study.rpc.rpc_v2.serialize.HessianSerialize;import com.springboot.whb.study.rpc.rpc_v2.serialize.SerializeProtocol;import lombok.extern.slf4j.Slf4j;import java.io.ByteArrayOutputStream;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.util.Arrays;/** * @author: whb * @description: å¥—æŽ¥å­—çš„ioæµå’ŒæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„æ•°æ®ä¼ è¾“ */@Slf4jpublic class DefaultMessageProtocol implements MessageProtocol &#123; /** * åºåˆ—åŒ–åè®® */ private SerializeProtocol serializeProtocol; public DefaultMessageProtocol() &#123; this.serializeProtocol = new HessianSerialize(); //this.serializeProtocol = new JavaInnerSerialize(); &#125; public void setSerializeProtocol(SerializeProtocol serializeProtocol) &#123; // å¯æ›¿æ¢åºåˆ—åŒ–åè®® this.serializeProtocol = serializeProtocol; &#125; /** * æœåŠ¡ç«¯è§£æžä»Žç½‘ç»œä¼ è¾“çš„æ•°æ®ï¼Œè½¬å˜æˆrequestå¯¹è±¡ * * @param inputStream * @return */ @Override public RpcRequest serviceToRequest(InputStream inputStream) &#123; try &#123; // 2ã€bytes -&gt; request ååºåˆ—åŒ– byte[] bytes = readBytes(inputStream); System.out.println("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–å‡ºobj:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–å‡ºobj length:" + bytes.length); RpcRequest request = serializeProtocol.deserialize(RpcRequest.class, bytes); return request; &#125; catch (Exception e) &#123; log.error("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–ä»Žç½‘ç»œä¼ è¾“çš„æ•°æ®è½¬å˜æˆrequestå¯¹è±¡å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; return null; &#125; /** * æœåŠ¡ç«¯æŠŠè®¡ç®—çš„ç»“æžœåŒ…è£…å¥½ï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›žç»™å®¢æˆ·ç«¯ * * @param response * @param outputStream * @param &lt;T&gt; */ @Override public &lt;T&gt; void serviceGetResponse(RpcResponse&lt;T&gt; response, OutputStream outputStream) &#123; try &#123; // 3ã€æŠŠresponse åºåˆ—åŒ–æˆbytes ä¼ ç»™å®¢æˆ·ç«¯ byte[] bytes = serializeProtocol.serialize(RpcResponse.class, response); System.out.println("[3]æœåŠ¡ç«¯åºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[3]æœåŠ¡ç«¯åºåˆ—åŒ–å‡ºbytes length:" + bytes.length); outputStream.write(bytes); &#125; catch (Exception e) &#123; log.error("[3]æœåŠ¡ç«¯åºåˆ—åŒ–è®¡ç®—çš„ç»“æžœå‡ºè¾“ç»™å®¢æˆ·ç«¯å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; /** * å®¢æˆ·ç«¯æŠŠè¯·æ±‚æ‹¼æŽ¥å¥½ï¼Œé€šè¿‡è¾“å‡ºæµå‘é€åˆ°æœåŠ¡ç«¯ * * @param request * @param outputStream */ @Override public void clientToRequest(RpcRequest request, OutputStream outputStream) &#123; try &#123; // 1ã€å…ˆæŠŠè¿™ä¸ªrequest -&gt; bytes åºåˆ—åŒ–æŽ‰ byte[] bytes = serializeProtocol.serialize(RpcRequest.class, request); System.out.println("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–å‡ºbytes length:" + bytes.length); outputStream.write(bytes); &#125; catch (IOException e) &#123; log.error("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–è¯·æ±‚å‚æ•°å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; /** * å®¢æˆ·ç«¯æŽ¥æ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ç»“æžœï¼Œè½¬å˜æˆresponseå¯¹è±¡ * * @param inputStream */ @Override public &lt;T&gt; RpcResponse&lt;T&gt; clientGetResponse(InputStream inputStream) &#123; try &#123; // 4ã€bytes ååºåˆ—åŒ–æˆresponse byte[] bytes = readBytes(inputStream); System.out.println("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–å‡ºbytes length:" + bytes.length); RpcResponse response = serializeProtocol.deserialize(RpcResponse.class, bytes); return response; &#125; catch (Exception e) &#123; log.error("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–è®¡ç®—ç»“æžœå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; return null; &#125; /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„ * * @param inputStream * @return * @throws IOException */ private byte[] readBytes(InputStream inputStream) throws IOException &#123; if (inputStream == null) &#123; throw new RuntimeException("è¾“å…¥æµä¸ºç©º"); &#125; return inputStreamToByteArr2(inputStream); &#125; /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•1 * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr1(InputStream inputStream) throws IOException &#123; // æœ‰ä¸ªå‰ææ˜¯æ•°æ®æœ€å¤§æ˜¯1024ï¼Œå¹¶æ²¡æœ‰è¿­ä»£è¯»å–æ•°æ® byte[] bytes = new byte[1024]; int count = inputStream.read(bytes, 0, 1024); return Arrays.copyOf(bytes, count); &#125; /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•2 * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr2(InputStream inputStream) throws IOException &#123; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); int bufesize = 1024; while (true) &#123; byte[] data = new byte[bufesize]; int count = inputStream.read(data, 0, bufesize); byteArrayOutputStream.write(data, 0, count); if (count &lt; bufesize) &#123; break; &#125; &#125; return byteArrayOutputStream.toByteArray(); &#125; /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•3ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¹‹åŽä¼šé˜»å¡žåœ¨readï¼Œå¯é€šè¿‡jstackæŸ¥çœ‹ç›¸å…³ä¿¡æ¯ * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr3(InputStream inputStream) throws IOException &#123; ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); int bufesize = 1024; byte[] buff = new byte[bufesize]; int rc = 0; while ((rc = inputStream.read(buff, 0, bufesize)) &gt; 0) &#123; byteArrayOutputStream.write(buff, 0, rc); buff = new byte[bufesize]; &#125; byte[] bytes = byteArrayOutputStream.toByteArray(); return bytes; &#125;&#125; æ•°æ®ä¼ è¾“æ¨¡åž‹ ArgumentConfig 12345678910111213141516171819202122232425package com.springboot.whb.study.rpc.rpc_v2.config;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: å‚æ•°é…ç½® */@Datapublic class ArgumentConfig implements Serializable &#123; private static final long serialVersionUID = 1L; /** * ç¬¬å‡ ä¸ªå‚æ•° */ private int index; /** * å‚æ•°ç±»åž‹ */ private String type;&#125; BasicConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.springboot.whb.study.rpc.rpc_v2.config;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import java.util.List;/** * @author: whb * @description: åŸºç¡€é…ç½® */@Datapublic class BasicConfig &#123; /** * åœ°å€ */ private String host; /** * ç«¯å£å· */ private int port; /** * æœåŠ¡æä¾›æ–¹è¿˜æ˜¯æœåŠ¡æ¶ˆè´¹æ–¹ */ private ServiceType type; /** * æŽ¥å£å */ private String interfaceName; /** * æŽ¥å£ç±» */ private Class&lt;?&gt; interfaceClass; /** * æ–¹æ³•é›†åˆ */ private List&lt;MethodConfig&gt; methods; /** * åˆ†ç»„ */ private String group; /** * é»˜è®¤ç‰ˆæœ¬å·æ˜¯default */ private String version = "default";&#125; ClientConfig 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.springboot.whb.study.rpc.rpc_v2.config;import com.springboot.whb.study.rpc.rpc_v2.core.ProxyInstance;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import java.io.Serializable;import java.lang.reflect.Proxy;/** * @author: whb * @description: å®¢æˆ·ç«¯é…ç½® */@Datapublic class ClientConfig&lt;T&gt; extends BasicConfig implements Serializable &#123; private static final long serialVersionUID = 1L; private T proxy; /** * åå°„åŒ…è£…æˆå®¢æˆ·ç«¯å‚æ•°é…ç½®å¯¹è±¡ * * @param interfaceClass * @param invocationHandler * @param &lt;T&gt; * @return */ public static &lt;T&gt; ClientConfig&lt;T&gt; convert(Class&lt;T&gt; interfaceClass, ProxyInstance invocationHandler) &#123; ClientConfig&lt;T&gt; config = new ClientConfig&lt;&gt;(); config.setVersion("default"); config.setInterfaceClass(interfaceClass); config.setInterfaceName(interfaceClass.getName()); config.setMethods(MethodConfig.convert(interfaceClass.getMethods())); config.setType(ServiceType.CONSUMER); Object proxy = Proxy.newProxyInstance(ClientConfig.class.getClassLoader(), new Class&lt;?&gt;[]&#123;interfaceClass&#125;, invocationHandler); config.setProxy((T) proxy); return config; &#125;&#125; MethodConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.springboot.whb.study.rpc.rpc_v2.config;import lombok.Data;import java.io.Serializable;import java.lang.reflect.Method;import java.lang.reflect.Parameter;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: æ–¹æ³•é…ç½® */@Datapublic class MethodConfig implements Serializable &#123; private static final long serialVersionUID = 1L; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private List&lt;ArgumentConfig&gt; argumentConfigs; /** * æ˜¯å¦éœ€è¦è¿”å›ž */ private Boolean isReturn; /** * è¿”å›žå€¼ç±»åž‹ */ private Class&lt;?&gt; returnType; /** * æ–¹æ³•æ•°ç»„è½¬æ–¹æ³•é…ç½®é›†åˆ * * @param methods * @return */ public static List&lt;MethodConfig&gt; convert(Method[] methods) &#123; List&lt;MethodConfig&gt; methodConfigList = new ArrayList&lt;&gt;(methods.length); MethodConfig methodConfig = null; for (Method method : methods) &#123; methodConfig = new MethodConfig(); methodConfig.setMethodName(method.getName()); Class&lt;?&gt; returnType = method.getReturnType(); String returnName = returnType.getName(); if ("void".equals(returnName)) &#123; methodConfig.setIsReturn(false); &#125; else &#123; methodConfig.setIsReturn(true); &#125; methodConfig.setReturnType(returnType); methodConfig.setArgumentConfigs(convert(method.getParameters())); methodConfigList.add(methodConfig); &#125; return methodConfigList; &#125; /** * å‚æ•°æ•°ç»„è½¬å‚æ•°é…ç½®é›†åˆ * * @param parameters * @return */ private static List&lt;ArgumentConfig&gt; convert(Parameter[] parameters) &#123; List&lt;ArgumentConfig&gt; argumentConfigs = new ArrayList&lt;&gt;(parameters.length); int start = 0; ArgumentConfig argumentConfig = null; for (Parameter parameter : parameters) &#123; argumentConfig = new ArgumentConfig(); argumentConfig.setIndex(start); argumentConfig.setType(parameter.getType().getName()); argumentConfigs.add(argumentConfig); start += 1; &#125; return argumentConfigs; &#125;&#125; ServiceConfig 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.springboot.whb.study.rpc.rpc_v2.config;import com.alibaba.fastjson.JSON;import com.springboot.whb.study.rpc.rpc_v2.core.RpcService;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.Serializable;import java.net.InetAddress;import java.net.UnknownHostException;/** * @author: whb * @description: æœåŠ¡æ–¹é…ç½® */@Data@Slf4jpublic class ServiceConfig&lt;T&gt; extends BasicConfig implements Serializable &#123; private static final long serialVersionUID = 1L; private T ref; /** * ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ä½¿ç”¨ */ private int count; @Override public String toString() &#123; return JSON.toJSONString(this); &#125; public static &lt;T&gt; ServiceConfig&lt;T&gt; convert(String interfaceName, Class&lt;T&gt; interfaceClass, T ref, RpcService rpcService) &#123; ServiceConfig&lt;T&gt; serviceConfig = new ServiceConfig&lt;&gt;(); serviceConfig.setRef(ref); serviceConfig.setInterfaceName(interfaceName); serviceConfig.setInterfaceClass(interfaceClass); serviceConfig.setCount(0); serviceConfig.setMethods(MethodConfig.convert(interfaceClass.getMethods())); serviceConfig.setPort(rpcService.getPort()); serviceConfig.setType(ServiceType.PROVIDER); try &#123; InetAddress addr = InetAddress.getLocalHost(); serviceConfig.setHost(addr.getHostAddress()); &#125; catch (UnknownHostException e) &#123; log.error("æœåŠ¡æ–¹èŽ·å–æœ¬æœºåœ°å€å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; return serviceConfig; &#125;&#125; æžšä¸¾å¸¸é‡ ServiceType 123456789101112131415161718192021222324252627package com.springboot.whb.study.rpc.rpc_v2.domain;/** * @author: whb * @description: æœåŠ¡ç±»åž‹æžšä¸¾å¸¸é‡ */public enum ServiceType &#123; /** * æœåŠ¡æä¾›è€… */ PROVIDER("provider"), /** * æœåŠ¡æ¶ˆè´¹è€… */ CONSUMER("consumer"); private String type; ServiceType(String type) &#123; this.type = type; &#125; public String getType() &#123; return type; &#125;&#125; åºåˆ—åŒ–ã€ååºåˆ—åŒ– SerializeProtocol 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.serialize;/** * @author: whb * @description: åºåˆ—åŒ–åè®®æŽ¥å£ */public interface SerializeProtocol &#123; /** * åºåˆ—åŒ– */ &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t); /** * ååºåˆ—åŒ– */ &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes);&#125; JavaInnerSerialize 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package com.springboot.whb.study.rpc.rpc_v2.serialize;import lombok.extern.slf4j.Slf4j;import java.io.*;/** * @author: whb * @description: Javaåºåˆ—åŒ– */@Slf4jpublic class JavaInnerSerialize implements SerializeProtocol &#123; /** * åºåˆ—åŒ– * * @param clazz * @param t * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = null; try &#123; objectOutputStream = new ObjectOutputStream(outputStream); objectOutputStream.writeObject(t); objectOutputStream.flush(); byte[] bytes = outputStream.toByteArray(); return bytes; &#125; catch (Exception e) &#123; log.error("Java åºåˆ—åŒ–å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; finally &#123; if (outputStream != null) &#123; try &#123; outputStream.close(); &#125; catch (IOException e) &#123; log.error("Java åºåˆ—åŒ–å…³é—­äºŒè¿›åˆ¶è¾“å‡ºæµå¤±è´¥,error:&#123;&#125;", e); &#125; &#125; if (objectOutputStream != null) &#123; try &#123; objectOutputStream.close(); &#125; catch (IOException e) &#123; log.error("Java åºåˆ—åŒ–å…³é—­å¯¹è±¡æµå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; return null; &#125; /** * ååºåˆ—åŒ– * * @param clazz * @param bytes * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes) &#123; ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = null; try &#123; objectInputStream = new ObjectInputStream(inputStream); T obj = (T) objectInputStream.readObject(); return obj; &#125; catch (Exception e) &#123; log.error("Java ååºåˆ—åŒ–å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; finally &#123; if (inputStream != null) &#123; try &#123; inputStream.close(); &#125; catch (IOException e) &#123; log.error("Java ååºåˆ—åŒ–å…³é—­äºŒè¿›åˆ¶è¾“å…¥æµå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; if (objectInputStream != null) &#123; try &#123; objectInputStream.close(); &#125; catch (IOException e) &#123; log.error("Java ååºåˆ—åŒ–å…³é—­å¯¹è±¡è¾“å…¥æµå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; return null; &#125;&#125; HessianSerialize 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.springboot.whb.study.rpc.rpc_v2.serialize;import com.alibaba.com.caucho.hessian.io.Hessian2Input;import com.alibaba.com.caucho.hessian.io.Hessian2Output;import lombok.extern.slf4j.Slf4j;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.IOException;/** * @author: whb * @description: HessianäºŒè¿›åˆ¶åºåˆ—åŒ– */@Slf4jpublic class HessianSerialize implements SerializeProtocol &#123; /** * åºåˆ—åŒ– * * @param clazz * @param t * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t) &#123; ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(outputStream); try &#123; //éªŒè¯è¿‡ï¼Œä¸€å®šéœ€è¦åœ¨flushä¹‹å‰å…³é—­æŽ‰hessian2Outputï¼Œå¦åˆ™èŽ·å–çš„byteså­—æ®µä¿¡æ¯ä¸ºç©º hessian2Output.writeObject(t); &#125; catch (IOException e) &#123; throw new RuntimeException(e.getMessage()); &#125; finally &#123; try &#123; hessian2Output.close(); &#125; catch (IOException e) &#123; log.error("Hessian äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå…³é—­æµå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; try &#123; outputStream.flush(); byte[] bytes = outputStream.toByteArray(); return bytes; &#125; catch (IOException e) &#123; throw new RuntimeException(e.getMessage()); &#125; finally &#123; try &#123; outputStream.close(); &#125; catch (IOException e) &#123; log.error("Hessian äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå…³é—­è¾“å‡ºæµå¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; /** * ååºåˆ—åŒ– * * @param clazz * @param bytes * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes) &#123; ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes); Hessian2Input hessian2Input = new Hessian2Input(inputStream); try &#123; T t = (T) hessian2Input.readObject(); return t; &#125; catch (IOException e) &#123; throw new RuntimeException(e.getMessage()); &#125; finally &#123; try &#123; hessian2Input.close(); &#125; catch (IOException e) &#123; log.error("Hessian ååºåˆ—åŒ–ï¼Œæµå…³é—­å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; try &#123; inputStream.close(); &#125; catch (IOException e) &#123; log.error("Hessian ååºåˆ—åŒ–ï¼Œè¾“å…¥æµå…³é—­å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125;&#125; è¯·æ±‚ã€å“åº”å¯¹è±¡ RpcRequest 1234567891011121314151617181920212223242526272829303132333435363738394041package com.springboot.whb.study.rpc.rpc_v2.core;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: RPCè¯·æ±‚å¯¹è±¡ */@Datapublic class RpcRequest implements Serializable &#123; private static final long serialVersionUID = 1L; /** * ç±»å */ private String className; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private Object[] arguments; /** * å‚æ•°ç±»åž‹ */ private Class&lt;?&gt;[] parameterTypes; @Override public String toString() &#123; return JSON.toJSONString(this); &#125;&#125; RpcResponse 123456789101112131415161718192021222324252627282930313233343536package com.springboot.whb.study.rpc.rpc_v2.core;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: RPCå“åº”å¯¹è±¡ */@Datapublic class RpcResponse&lt;T&gt; implements Serializable &#123; private static final long serialVersionUID = 1L; /** * å“åº”ç»“æžœ */ private T result; /** * æ˜¯å¦å‡ºé”™ */ private Boolean isError; /** * é”™è¯¯ä¿¡æ¯ */ private String errorMsg; @Override public String toString() &#123; return JSON.toJSONString(this); &#125;&#125; æœåŠ¡ç«¯å¤„ç† ServiceConnection 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package com.springboot.whb.study.rpc.rpc_v2.core;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.net.ServerSocket;import java.net.Socket;/** * @author: whb * @description: æœåŠ¡è¿žæŽ¥ */@Slf4j@Datapublic class ServiceConnection implements Runnable &#123; /** * ç«¯å£å· */ private int port; /** * æœåŠ¡å…³é—­æ ‡è®°ä½ */ private volatile boolean flag = true; /** * æœåŠ¡ç«¯å¥—æŽ¥å­— */ private ServerSocket serverSocket; /** * æœåŠ¡å¤„ç†å™¨ */ private ServiceHandler serviceHandler; /** * åˆå§‹åŒ– * * @param port * @param serviceHandler */ public void init(int port, ServiceHandler serviceHandler) &#123; try &#123; this.port = port; this.serverSocket = new ServerSocket(this.port); &#125; catch (IOException e) &#123; throw new RuntimeException("å¯åŠ¨å¤±è´¥ï¼š" + e.getMessage()); &#125; this.serviceHandler = serviceHandler; log.info("æœåŠ¡å¯åŠ¨äº†..."); &#125; @Override public void run() &#123; while (flag) &#123; try &#123; Socket socket = serverSocket.accept(); serviceHandler.handler(socket); &#125; catch (IOException e) &#123; try &#123; Thread.sleep(100); &#125; catch (InterruptedException e1) &#123; log.error("æœåŠ¡å¤„ç†å¼‚å¸¸ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; &#125; /** * å…³é—­è¿žæŽ¥ */ public void destory() &#123; log.info("æœåŠ¡ç«¯å¥—æŽ¥å­—å…³é—­..."); this.flag = false; &#125;&#125; ServiceHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.springboot.whb.study.rpc.rpc_v2.core;import com.google.common.util.concurrent.ThreadFactoryBuilder;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.Socket;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadFactory;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æœåŠ¡ç«¯å¤„ç†å™¨ */@Slf4j@Datapublic class ServiceHandler &#123; /** * çº¿ç¨‹æ±  */ private ThreadPoolExecutor executor = null; /** * æœåŠ¡æŽ¥å£ */ private RpcService rpcService; /** * æ¶ˆæ¯åè®® */ private MessageProtocol messageProtocol; public ServiceHandler(RpcService rpcService) &#123; this.rpcService = rpcService; //åˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹å·¥åŽ‚ ThreadFactory commonThreadName = new ThreadFactoryBuilder() .setNameFormat("Parse-Task-%d") .build(); //æž„é€ çº¿ç¨‹æ±  this.executor = new ThreadPoolExecutor( 10, 10, 2, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(200), commonThreadName, (Runnable r, ThreadPoolExecutor executor) -&gt; &#123; SocketTask socketTask = (SocketTask) r; Socket socket = socketTask.getSocket(); if (socket != null) &#123; try &#123; //æ— æ³•åŠæ—¶å¤„ç†å’Œå“åº”å°±å¿«é€Ÿæ‹’ç»æŽ‰ socket.close(); log.info("reject socket:" + socketTask + ", and closed."); &#125; catch (IOException e) &#123; log.error("socketå…³é—­å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; ); &#125; /** * æœåŠ¡å¤„ç†ï¼šæŽ¥æ”¶åˆ°æ–°çš„å¥—æŽ¥å­—ï¼ŒåŒ…è£…æˆä¸ºä¸€ä¸ªrunnableæäº¤ç»™çº¿ç¨‹åŽ»æ‰§è¡Œ * * @param socket */ public void handler(Socket socket) &#123; this.executor.execute(new SocketTask(socket)); &#125; class SocketTask implements Runnable &#123; private Socket socket; public SocketTask(Socket socket) &#123; this.socket = socket; &#125; public Socket getSocket() &#123; return socket; &#125; @Override public void run() &#123; try &#123; InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); // èŽ·å–å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®ï¼Œç»Ÿä¸€åŒ…è£…æˆRpcRequest RpcRequest request = messageProtocol.serviceToRequest(inputStream); RpcResponse response = rpcService.invoke(request); log.info("request:[" + request + "],response:[" + response + "]"); // åå°„è°ƒç”¨ï¼Œå¾—åˆ°å…·ä½“çš„è¿”å›žå€¼ messageProtocol.serviceGetResponse(response, outputStream); &#125; catch (Exception e) &#123; log.error("æœåŠ¡ç«¯å¤„ç†å‡ºçŽ°å¼‚å¸¸ï¼Œerror:&#123;&#125;", e); &#125; finally &#123; if (socket != null) &#123; try &#123; socket.close(); &#125; catch (IOException e) &#123; log.error("socketå…³é—­å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; &#125; &#125;&#125; RpcService 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158package com.springboot.whb.study.rpc.rpc_v2.core;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v2.config.ServiceConfig;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.DefaultMessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.register.ServiceRegister;import com.springboot.whb.study.rpc.rpc_v2.register.ZkServiceRegister;import lombok.Data;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: RPCæœåŠ¡ */@Slf4j@Datapublic class RpcService &#123; /** * k æ˜¯æŽ¥å£å…¨åç§° * v æ˜¯å¯¹åº”çš„å¯¹è±¡åŒ…å«çš„è¯¦ç»†ä¿¡æ¯ */ private Map&lt;String, ServiceConfig&gt; serviceConfigMap = new HashMap&lt;&gt;(); /** * ç«¯å£å· */ private int port; /** * æœåŠ¡æ³¨å†Œ */ private ServiceRegister serviceRegister; /** * è¿žæŽ¥å™¨è¿˜æœªæŠ½è±¡å¤„ç†ï¼Œä½¿ç”¨çš„è¿˜æ˜¯BIOæ¨¡åž‹ */ private ServiceConnection serviceConnection; /** * æœåŠ¡å¤„ç†å™¨ */ private ServiceHandler serviceHandler; /** * çº¿ç¨‹æ±  */ ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("service-thread-pool-", "%s")).build()); public RpcService(int port) &#123; this.port = port; this.serviceHandler = new ServiceHandler(this); this.serviceHandler.setMessageProtocol(new DefaultMessageProtocol()); this.serviceRegister = new ZkServiceRegister(); &#125; /** * è®¾ç½®æ¶ˆæ¯åè®® * * @param messageProtocol */ public void setMessageProtocol(MessageProtocol messageProtocol) &#123; if (this.serviceHandler == null) &#123; throw new RuntimeException("å¥—æŽ¥å­—å¤„ç†å™¨æ— æ•ˆ"); &#125; this.serviceHandler.setMessageProtocol(messageProtocol); &#125; /** * æ·»åŠ æœåŠ¡æŽ¥å£ * * @param interfaceClass * @param ref * @param &lt;T&gt; */ public &lt;T&gt; void addService(Class&lt;T&gt; interfaceClass, T ref) &#123; String interfaceName = interfaceClass.getName(); ServiceConfig&lt;T&gt; serviceConfig = ServiceConfig.convert(interfaceName, interfaceClass, ref, this); serviceConfigMap.put(interfaceName, serviceConfig); &#125; /** * æ³¨å†ŒæœåŠ¡ */ private void register() &#123; //æœåŠ¡æ³¨å†Œï¼Œåœ¨ç½‘ç»œç›‘å¬å¯åŠ¨ä¹‹å‰å°±éœ€è¦å®Œæˆ serviceConfigMap.values().forEach(serviceRegister::register); &#125; /** * æœåŠ¡å¯åŠ¨ */ public void start() &#123; this.register(); log.info("æœåŠ¡æ³¨å†Œå®Œæˆ"); this.serviceConnection = new ServiceConnection(); this.serviceConnection.init(port, serviceHandler); threadPoolExecutor.execute(serviceConnection); //ä¼˜é›…å…³é—­ Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123; RpcService.this.destroy(); &#125;)); &#125; /** * é€šè¿‡åå°„æ‰§è¡Œï¼Œæ‰§è¡Œç»“æžœå°è£…RpcResponse * * @param request * @param &lt;K&gt; * @param &lt;V&gt; * @return */ public &lt;K, V&gt; RpcResponse invoke(RpcRequest request) &#123; if (request == null) &#123; RpcResponse&lt;V&gt; response = new RpcResponse&lt;&gt;(); response.setResult(null); response.setIsError(true); response.setErrorMsg("æœªçŸ¥å¼‚å¸¸"); return response; &#125; String className = request.getClassName(); //æš‚æ—¶ä¸è€ƒè™‘æ²¡æœ‰å¯¹åº”çš„serviceConfigçš„æƒ…å†µ ServiceConfig&lt;K&gt; serviceConfig = serviceConfigMap.get(className); K ref = serviceConfig.getRef(); try &#123; Method method = ref.getClass().getMethod(request.getMethodName(), request.getParameterTypes()); V result = (V) method.invoke(ref, request.getArguments()); RpcResponse&lt;V&gt; response = new RpcResponse&lt;&gt;(); response.setResult(result); response.setIsError(false); response.setErrorMsg(""); return response; &#125; catch (Exception e) &#123; &#125; return null; &#125; /** * å…³é—­æœåŠ¡ */ public void destroy() &#123; this.serviceConnection.destory(); log.info("æœåŠ¡ç«¯å…³é—­äº†"); &#125;&#125; å®¢æˆ·ç«¯å¤„ç† ä»£ç†å¯¹è±¡ProxyInstance 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.springboot.whb.study.rpc.rpc_v2.core;import lombok.extern.slf4j.Slf4j;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.net.InetSocketAddress;/** * @author: whb * @description: å®¢æˆ·ç«¯ä»£ç†å¯¹è±¡ */@Slf4jpublic class ProxyInstance implements InvocationHandler &#123; /** * RPCè°ƒç”¨æ–¹ */ private RpcClient rpcClient; private Class clazz; public ProxyInstance(RpcClient client, Class clazz) &#123; this.rpcClient = client; this.clazz = clazz; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; RpcRequest request = new RpcRequest(); request.setClassName(clazz.getName()); request.setMethodName(method.getName()); request.setArguments(args); request.setParameterTypes(method.getParameterTypes()); //èŽ·å–æœåŠ¡æä¾›æ–¹ä¿¡æ¯ InetSocketAddress address = rpcClient.discovery(request); log.info("[" + Thread.currentThread().getName() + "] discovery service: " + address); //å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¾—åˆ°è¯·æ±‚æ•°æ® RpcResponse response = rpcClient.invoke(request, address); return response.getResult(); &#125;&#125; ClientHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package com.springboot.whb.study.rpc.rpc_v2.core;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.InetSocketAddress;import java.net.Socket;/** * @author: whb * @description: å®¢æˆ·ç«¯å¤„ç†å™¨ */@Slf4jpublic class ClientHandler &#123; private RpcClient rpcClient; private MessageProtocol messageProtocol; public ClientHandler(RpcClient rpcClient) &#123; this.rpcClient = rpcClient; &#125; public void setMessageProtocol(MessageProtocol messageProtocol) &#123; this.messageProtocol = messageProtocol; &#125; public &lt;T&gt; RpcResponse&lt;T&gt; invoke(RpcRequest request, InetSocketAddress address) &#123; RpcResponse&lt;T&gt; response = new RpcResponse&lt;&gt;(); Socket socket = getSocketInstance(address); if (socket == null) &#123; // å¥—æŽ¥å­—é“¾æŽ¥å¤±è´¥ response.setIsError(true); response.setErrorMsg("å¥—æŽ¥å­—é“¾æŽ¥å¤±è´¥"); return response; &#125; try &#123; InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); messageProtocol.clientToRequest(request, outputStream); response = messageProtocol.clientGetResponse(inputStream); &#125; catch (IOException e) &#123; log.error("å®¢æˆ·ç«¯å¤„ç†å¼‚å¸¸ï¼Œerror:&#123;&#125;", e); &#125; finally &#123; if (socket != null) &#123; try &#123; socket.close(); &#125; catch (IOException e) &#123; log.error("å®¢æˆ·ç«¯å…³é—­å¥—æŽ¥å­—å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; &#125; &#125; return response; &#125; /** * èŽ·å–å¯¹è±¡å®žä¾‹ * * @param address * @return */ private Socket getSocketInstance(InetSocketAddress address) &#123; try &#123; return new Socket(address.getHostString(), address.getPort()); &#125; catch (IOException e) &#123; log.error("å®¢æˆ·ç«¯èŽ·å–å¥—æŽ¥å­—å¤±è´¥ï¼Œerror:&#123;&#125;", e); &#125; return null; &#125;&#125; RpcClient 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101package com.springboot.whb.study.rpc.rpc_v2.core;import com.springboot.whb.study.rpc.rpc_v2.config.ClientConfig;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.DefaultMessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.register.ServiceRegister;import com.springboot.whb.study.rpc.rpc_v2.register.ZkServiceRegister;import java.net.InetSocketAddress;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: RPCå®¢æˆ·ç«¯ */public class RpcClient &#123; /** * k æ˜¯æŽ¥å£çš„å…¨åç§° * v æ˜¯å¯¹åº”çš„å¯¹è±¡åŒ…å«çš„è¯¦ç»†ä¿¡æ¯ */ private Map&lt;String, ClientConfig&gt; clientConfigMap = new HashMap&lt;&gt;(); /** * æœåŠ¡æ³¨å†Œ */ private ServiceRegister serviceRegister; /** * å®¢æˆ·ç«¯å¤„ç†å™¨ */ private ClientHandler clientHandler; public RpcClient() &#123; this.serviceRegister = new ZkServiceRegister(); this.clientHandler = new ClientHandler(this); // è®¾ç½®é»˜è®¤çš„æ¶ˆæ¯å¤„ç†åè®® this.clientHandler.setMessageProtocol(new DefaultMessageProtocol()); &#125; /** * è®¢é˜…æœåŠ¡ * * @param clazz * @param &lt;T&gt; */ public &lt;T&gt; void subscribe(Class&lt;T&gt; clazz) &#123; String interfaceName = clazz.getName(); ProxyInstance invocationHandler = new ProxyInstance(this, clazz); ClientConfig&lt;T&gt; clientConfig = ClientConfig.convert(clazz, invocationHandler); clientConfigMap.put(interfaceName, clientConfig); &#125; /** * æœåŠ¡æ³¨å†Œ */ private void register() &#123; // æœåŠ¡æ³¨å†Œï¼Œåœ¨ç½‘ç»œç›‘å¬å¯åŠ¨ä¹‹å‰å°±éœ€è¦å®Œæˆ clientConfigMap.values().forEach(serviceRegister::register); &#125; /** * æœåŠ¡å¯åŠ¨ */ public void start() &#123; this.register(); &#125; /** * æœåŠ¡å‘çŽ° * * @param request * @return */ public InetSocketAddress discovery(RpcRequest request) &#123; return serviceRegister.discovery(request, ServiceType.PROVIDER); &#125; /** * åå°„è°ƒç”¨ * * @param request * @param address * @return */ public RpcResponse invoke(RpcRequest request, InetSocketAddress address) &#123; return this.clientHandler.invoke(request, address); &#125; /** * èŽ·å–å¯¹è±¡å®žä¾‹ * * @param clazz * @param &lt;T&gt; * @return */ public &lt;T&gt; T getInstance(Class&lt;T&gt; clazz) &#123; return (T) (clientConfigMap.get(clazz.getName()).getProxy()); &#125;&#125; æµ‹è¯• æµ‹è¯•æŽ¥å£å®šä¹‰Calculate 1234567891011121314151617181920212223242526package com.springboot.whb.study.rpc.rpc_v2.demo;/** * @author: whb * @description: æµ‹è¯•æŽ¥å£å®šä¹‰ */public interface Calculate&lt;T&gt; &#123; /** * æ±‚å’Œ * * @param a * @param b * @return */ T add(T a, T b); /** * æ±‚å·® * * @param a * @param b * @return */ T sub(T a, T b);&#125; æµ‹è¯•æŽ¥å£å®žçŽ°ç±»SimpleCalculate 12345678910111213141516171819202122232425262728package com.springboot.whb.study.rpc.rpc_v2.demo;import java.util.Random;/** * @author: whb * @description: æµ‹è¯•æŽ¥å£å®žçŽ°ç±» */public class SimpleCalculate implements Calculate&lt;Integer&gt; &#123; @Override public Integer add(Integer a, Integer b) &#123; long start = System.currentTimeMillis(); try &#123; Thread.sleep(new Random().nextInt(1000)); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; int c = a + b; System.out.println(Thread.currentThread().getName() + " è€—æ—¶:" + (System.currentTimeMillis() - start)); return c; &#125; @Override public Integer sub(Integer a, Integer b) &#123; return a - b; &#125;&#125; æµ‹è¯•-æœåŠ¡ç«¯Service 12345678910111213141516package com.springboot.whb.study.rpc.rpc_v2.demo;import com.springboot.whb.study.rpc.rpc_v2.core.RpcService;/** * @author: whb * @description: æµ‹è¯•æœåŠ¡ç«¯ */public class Service &#123; public static void main(String[] args) &#123; RpcService rpcService = new RpcService(10001); rpcService.addService(Calculate.class, new SimpleCalculate()); rpcService.start(); &#125;&#125; æµ‹è¯•-å®¢æˆ·ç«¯Client 1234567891011121314151617181920212223242526272829303132333435363738package com.springboot.whb.study.rpc.rpc_v2.demo;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v2.core.RpcClient;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.util.Random;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æµ‹è¯•å®¢æˆ·ç«¯ */public class Client &#123; public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); public static void main(String[] args) &#123; RpcClient rpcClient = new RpcClient(); rpcClient.subscribe(Calculate.class); rpcClient.start(); Calculate&lt;Integer&gt; calculateProxy = rpcClient.getInstance(Calculate.class); for (int i = 0; i &lt; 200; i++) &#123; threadPoolExecutor.execute(() -&gt; &#123; long start = System.currentTimeMillis(); int s1 = new Random().nextInt(100); int s2 = new Random().nextInt(100); int s3 = calculateProxy.add(s1, s2); System.out.println("[" + Thread.currentThread().getName() + "]a: " + s1 + ", b:" + s2 + ", c=" + s3 + ", è€—æ—¶:" + (System.currentTimeMillis() - start)); &#125;); &#125; &#125;&#125; æµ‹è¯•ç»“æžœ zookeeper æœåŠ¡ç«¯ å®¢æˆ·ç«¯ æ€»ç»“ v2ç‰ˆæœ¬ç›¸æ¯”v1ç‰ˆæœ¬ä¿®æ”¹äº†æ•´ä¸ªä»£ç ç»“æž„ï¼Œä½¿å¾—ç»“æž„èƒ½å¤Ÿæ›´åŠ æ˜Žç¡®ï¼Œå¼•å…¥zookeeperä½œä¸ºæœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œå¤§è‡´ä»‹ç»äº†zookeeperçš„ç‰¹ç‚¹ä»¥åŠåŠŸèƒ½ï¼Œç»™æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘çŽ°ã€åºåˆ—åŒ–åè®®ç­‰å‡ç•™ä¸‹äº†å£å­ï¼Œä»¥ä¾¿å®žçŽ°è‡ªå®šä¹‰çš„åè®®ï¼Œv1çš„ioæ¨¡åž‹æ˜¯BIOï¼Œv2å¹¶æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯ç”±å•çº¿ç¨‹æ”¹é€ æˆå¤šçº¿ç¨‹ã€‚ æ•´ä½“è€Œè¨€ç¬¦åˆä¸€ä¸ªç®€å•çš„rpcæ¡†æž¶ï¼Œä¾æ—§è¿˜æ˜¯æœ‰å¾ˆå¤šç‚¹å¯ä»¥å®Œå–„ã€ä¼˜åŒ–çš„ç‚¹ï¼Œå¦‚ï¼š ioæ¨¡åž‹è¿˜æ˜¯æ²¡æœ‰æ›¿æ¢ï¼ŒåŽé¢è€ƒè™‘ç›´æŽ¥æ•´ä½“æŽ¥å…¥nettyï¼› ä¸åº”è¯¥æ¯æ¬¡å®žæ—¶ä»ŽzkèŽ·å–èŠ‚ç‚¹ä¿¡æ¯ï¼Œåº”è¯¥å…ˆè®¾ç½®ä¸€ä¸ªæœ¬åœ°ç¼“å­˜ï¼Œå†åˆ©ç”¨zookeeperçš„watcheråŠŸèƒ½ï¼Œå¼€å¯ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹åŽ»ç›‘å¬æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œé™ä½Žå’Œzkäº¤äº’å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼› æ²¡æœ‰å¿«é€Ÿå¤±è´¥ã€é‡è¯•çš„åŠŸèƒ½ï¼Œå®¢è§‚æƒ…å†µä¸‹å­˜åœ¨ç½‘ç»œæŠ–åŠ¨çš„é—®é¢˜ï¼Œé‡è¯•å°±å¯ä»¥äº†ã€‚ æ•´ä½“çš„å„ç§åè®®çº¦å®šå¹¶æ²¡æœ‰æ˜Žç¡®è§„èŒƒï¼Œæ¯”è¾ƒæ··ä¹±ã€‚]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ·»åŠ éŸ³ä¹æ’­æ”¾å™¨]]></title>
    <url>%2Fposts%2Fdb828ee7.html</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ ä¸ºåšå®¢æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ’ä»¶å¯ä»¥ç”¨ï¼Œæ¯”å¦‚aplayerã€dplayerç­‰ç­‰ã€‚éƒ¨ç½²æ–¹å¼æ—¢å¯ä»¥ä½¿ç”¨hexoæ’ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æå–distæ–‡ä»¶çš„æ–¹å¼ã€‚ æœ¬äººä¸ºè‡ªå·±çš„æ’­æ”¾é€‰æ‹©çš„aplayeræ’­æ”¾å™¨ï¼Œä¸€å¼€å§‹æ˜¯ä½¿ç”¨hexoæ’ä»¶çš„æ–¹å¼ï¼Œä½†æ˜¯éƒ¨ç½²çš„æ—¶å€™ä¸€ç›´æŠ¥æ ‡ç­¾è§£æžçš„é”™è¯¯ï¼ŒæŸ¥äº†å¥½ä¹…ä¹Ÿæ²¡æŸ¥åˆ°åŽŸå› ï¼Œæ— å¥ˆï¼Œæ”¾å¼ƒä½¿ç”¨æ’ä»¶çš„æ–¹å¼ï¼Œæ”¹ä¸ºä½¿ç”¨æå–aplayerçš„distæ–‡ä»¶çš„æ–¹å¼ã€‚ ä¸‹è½½aplayer è®¿é—®aplayeræºç ï¼šGitHub Aplayer ï¼Œå°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£åŽ‹åŽå°†distæ–‡ä»¶å¤¹å¤åˆ¶åˆ° /themes/next/source æ–‡ä»¶å¤¹ä¸‹ã€‚ åˆ›å»ºæ ·å¼ æ–°å»ºmusic.js åœ¨/themes/next/source/distæ–‡ä»¶å¤¹ä¸­æ–°å»ºmusic.jsæ–‡ä»¶ï¼Œå°†ä¸‹é¢ä»£ç æ·»åŠ è¿›åŽ»ï¼š 12345678910111213141516171819202122const ap = new APlayer(&#123; container: document.getElementById('aplayer'), autoplay: false, loop: 'all', volume: 0.7, listFolded: true, listMaxHeight: 60, audio: [ &#123; name: 'name1', artist: 'artist1', url: 'url1.mp3', cover: 'cover1.jpg', &#125;, &#123; name: 'name2', artist: 'artist2', url: 'url2.mp3', cover: 'cover2.jpg', &#125; ]&#125;); å‚æ•°ä¿®æ”¹ ä¸Šé¢ä»£ç ä¸ºä½ åœ¨hexoä¸Šç”Ÿæˆaplayeræ’­æ”¾å™¨çš„æ ·å¼ï¼Œå‚æ•°ä¿®æ”¹å‚è€ƒ å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ ã€‚ ä¿®æ”¹aplayeræ ·å¼ &lt;span id=&quot;inline-blue&quot;&gt; æ™®é€šæ¨¡å¼ï¼š&lt;/span&gt; 123456789const ap = new APlayer(&#123; container: document.getElementById('aplayer'), audio: [&#123; name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg' &#125;]&#125;); &lt;span id=&quot;inline-green&quot;&gt; æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id=&quot;inline-blue&quot;&gt; æ’­æ”¾åˆ—è¡¨æ¨¡å¼ï¼š&lt;/span&gt; 123456789101112131415161718192021222324const ap = new APlayer(&#123; container: document.getElementById('player'), listFolded: false,//åˆ—è¡¨é»˜è®¤æŠ˜å  listMaxHeight: 90,//åˆ—è¡¨æœ€å¤§é«˜åº¦ lrcType: 3, //æ­¤ä¸ºæ­Œè¯æ ¼å¼ï¼Œæ²¡æœ‰æ­Œè¯å¯ä»¥ç›´æŽ¥åˆ æŽ‰è¿™ä¸€è¡Œ audio: [ &#123; name: 'name1', artist: 'artist1', url: 'url1.mp3', cover: 'cover1.jpg', lrc: 'lrc1.lrc', theme: '#ebd0c2' &#125;, &#123; name: 'name2', artist: 'artist2', url: 'url2.mp3', cover: 'cover2.jpg', lrc: 'lrc2.lrc', theme: '#46718b' &#125; ]&#125;); &lt;span id=&quot;inline-green&quot;&gt; æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id=&quot;inline-blue&quot;&gt; å¸åº•æ¨¡å¼ï¼š&lt;/span&gt; 12345678910const ap = new APlayer(&#123; container: document.getElementById('player'), fixed: true, audio: [&#123; name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg', &#125;]&#125;); &lt;span id=&quot;inline-green&quot;&gt; æ•ˆæžœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id=&quot;inline-blue&quot;&gt; è¿·ä½ åº•æ¨¡å¼ï¼š&lt;/span&gt; 12345678910const ap = new APlayer(&#123; container: document.getElementById('player'), mini: true, audio: [&#123; name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg', &#125;]&#125;); &lt;span id=&quot;inline-purple&quot;&gt; é™„ä¸Šæˆ‘çš„å‚æ•°ï¼š&lt;/span&gt; 1234567891011121314151617181920212223242526272829303132const ap = new APlayer(&#123; container: document.getElementById('aplayer'), //æ’­æ”¾å™¨å®¹å™¨å…ƒç´  listFolded: false, //åˆ—è¡¨é»˜è®¤æŠ˜å  listMaxHeight: 90, //åˆ—è¡¨æœ€å¤§é«˜åº¦ //lrcType: 3, //æ­¤ä¸ºæ­Œè¯æ ¼å¼ï¼Œæ²¡æœ‰æ­Œè¯å¯ä»¥ç›´æŽ¥åˆ æŽ‰è¿™ä¸€è¡Œ mini: false, //è¿·ä½ æ¨¡å¼ autoplay: true, //è‡ªåŠ¨æ’­æ”¾ theme: '#FADFA3', //ä¸»é¢˜è‰² loop: 'all', //éŸ³é¢‘å¾ªçŽ¯æ’­æ”¾, å¯é€‰å€¼: 'all'å…¨éƒ¨å¾ªçŽ¯, 'one'å•æ›²å¾ªçŽ¯, 'none'ä¸å¾ªçŽ¯ order: 'list', //éŸ³é¢‘å¾ªçŽ¯é¡ºåº, å¯é€‰å€¼: 'list'åˆ—è¡¨å¾ªçŽ¯, 'random'éšæœºå¾ªçŽ¯ preload: 'auto', //é¢„åŠ è½½ï¼Œå¯é€‰å€¼: 'none', 'metadata', 'auto' volume: 0.7, //é»˜è®¤éŸ³é‡ï¼Œè¯·æ³¨æ„æ’­æ”¾å™¨ä¼šè®°å¿†ç”¨æˆ·è®¾ç½®ï¼Œç”¨æˆ·æ‰‹åŠ¨è®¾ç½®éŸ³é‡åŽé»˜è®¤éŸ³é‡å³å¤±æ•ˆ mutex: false, //äº’æ–¥ï¼Œé˜»æ­¢å¤šä¸ªæ’­æ”¾å™¨åŒæ—¶æ’­æ”¾ï¼Œå½“å‰æ’­æ”¾å™¨æ’­æ”¾æ—¶æš‚åœå…¶ä»–æ’­æ”¾å™¨ audio: [ //éŸ³é¢‘ä¿¡æ¯ &#123; name: 'å¤§é±¼', //éŸ³é¢‘åç§° artist: 'å‘¨æ·±ã€éƒ­æ²', //éŸ³é¢‘è‰ºæœ¯å®¶ url: '"http://lc-tguve1gk.cn-n1.lcfile.com/47b5548df9c80bba84f4/%E5%91%A8%E6%B7%B1%E3%80%81%E9%83%AD%E6%B2%81%20-%20%E5%A4%A7%E9%B1%BC%20%282017%E4%B8%AD%E5%9B%BD%E6%96%B0%E6%AD%8C%E5%A3%B0%E7%AC%AC%E4%BA%8C%E5%AD%A3%E7%AC%AC%E5%8D%81%E6%9C%9F%E7%8E%B0%E5%9C%BA%E4%BC%B4%E5%A5%8F%29.mp3', //éŸ³é¢‘é“¾æŽ¥ cover: 'http://lc-tguve1gk.cn-n1.lcfile.com/a9fff99abbddc8757d4b/%E5%A4%A7%E9%B1%BC.jpg', //éŸ³é¢‘å°é¢ //lrc: 'lrc1.lrc', //æ­Œè¯ theme: '#ebd0c2' //åˆ‡æ¢åˆ°æ­¤éŸ³é¢‘æ—¶çš„ä¸»é¢˜è‰²ï¼Œæ¯”ä¸Šé¢çš„ theme ä¼˜å…ˆçº§é«˜ &#125;, &#123; name: 'Something just like this', artist: 'Alex Goot _ Madilyn Bailey', url: 'http://lc-tguve1gk.cn-n1.lcfile.com/f3bee3260fa207648d34/Alex%20Goot%20_%20Madilyn%20Bailey%20-%20Something%20Just%20Like%20This.mp3', cover: 'http://lc-tguve1gk.cn-n1.lcfile.com/d21b8e3392433807b1e2/Something%20just%20like%20this.jpg', //lrc: 'lrc2.lrc', theme: '#46718b' &#125; ]&#125;); éƒ¨ç½² aplayerçš„æ ·å¼è®¾ç½®å¥½ä¹‹åŽå°±å¯ä»¥æŠŠaplayeræ”¾åœ¨è‡ªå·±æƒ³è¦æ”¾ç½®çš„ä½ç½®ä¸Šï¼Œæ”¾ç½®ä»£ç å¦‚ä¸‹ï¼š 1234&lt;link rel="stylesheet" href="/dist/APlayer.min.css"&gt;&lt;div id="aplayer"&gt;&lt;/div&gt;&lt;script type="text/javascript" src="/dist/APlayer.min.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="/dist/music.js"&gt;&lt;/script&gt; å°†æ”¾ç½®ä»£ç æ”¾åœ¨ä¸åŒçš„/themes/next/layout/xxx.swigæ–‡ä»¶å†…ä¼šæœ‰ä¸åŒçš„æ•ˆæžœã€‚ æ¯ä¸ªäººä½¿ç”¨çš„ä¸»é¢˜ä¸ä¸€æ ·ï¼Œè¦æ ¹æ®è‡ªå·±çš„ä¸»é¢˜åŽ»è°ƒè¯•ã€‚ä¾‹å¦‚æˆ‘ç”¨çš„æ˜¯next-mistä¸»é¢˜ï¼Œä¸”å–œæ¬¢æ”¾ç½®åœ¨ä¾§è¾¹æ ã€‚é‚£ä¹ˆåœ¨/themes/next/layout/_marcoæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°sidebar.swigæ–‡ä»¶ã€‚ å¦‚æžœè¦æ”¾ç½®åœ¨ä¾§è¾¹æ çš„å‹é“¾ä¸‹é¢,é‚£ä¹ˆåœ¨sidebar.swigä¸­æ‰¾åˆ°if theme.linksï¼Œå°†æ”¾ç½®ä»£ç æ·»åŠ åˆ°endifä¹‹åŽã€‚å¦‚ä¸‹å›¾ï¼š å¦‚è¦æ”¾ç½®åˆ°RSSä¸‹å°±åœ¨sidebar.swigä¸­æœç´¢if theme.rssï¼Œä¹Ÿæ˜¯æ·»åŠ åˆ°endifä¹‹åŽã€‚ æˆ‘æ˜¯é€‰æ‹©æ”¾åœ¨äº†å‹é“¾ä¸‹æ–¹ï¼Œå¦‚ä¸‹å›¾ï¼š æœ€ç»ˆæ•ˆæžœå¦‚ä¸‹å›¾ï¼š åˆ¶ä½œéŸ³ä¹/å›¾ç‰‡å¤–é“¾ æ­£å¦‚ä¹‹å‰ä¸ºåšå®¢æ·»åŠ è¯„è®ºåŠç»Ÿè®¡åŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†LeanCloudï¼Œåˆ¶ä½œéŸ³ä¹/å›¾ç‰‡çš„å¤–é“¾åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚ æ³¨å†Œã€ç™»é™†çš„æ­¥éª¤åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œå·²ç»æç»˜è¿‡äº†ï¼Œè¿™é‡Œä¸å†è¯¦è¿°ï¼Œæˆ‘ä»¬ç›´æŽ¥æ­¥å…¥æ­£é¢˜ã€‚ åˆ°ä½ åˆ›å»ºçš„åº”ç”¨é‡Œé¢åŽ»ï¼Œç‚¹å‡»å­˜å‚¨ï¼Œå¦‚ä¸‹å›¾ã€‚ç‚¹å‡»_Fileï¼Œç‚¹å‡»ä¸Šä¼ ï¼Œæ‰¾åˆ°ä½ ä¸‹è½½å¥½çš„éŸ³ä¹æ–‡ä»¶å’ŒéŸ³ä¹å›¾ç‰‡ä¸Šä¼ ä¸ŠåŽ»å°±è¡Œäº†ã€‚ ä¸Šä¼ ä¹‹åŽåˆ·æ–°é¡µé¢ï¼Œå°†åˆ—è¡¨å‘åŽæ‹‰ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„éŸ³ä¹å’Œå›¾ç‰‡çš„urlè¿žæŽ¥äº†ã€‚]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -ä¸€è‡´æ€§Hashç®—æ³•]]></title>
    <url>%2Fposts%2F302399c9.html</url>
    <content type="text"><![CDATA[ç¤ºä¾‹å¼•å…¥ æ¯”å¦‚çŽ°åœ¨æœ‰ N ä¸ª Redis æœåŠ¡å™¨ï¼Œä¸è€ƒè™‘ä½¿ç”¨Redis Clusterçš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸€ä¸ªå¯¹è±¡ object æ˜ å°„åˆ° N ä¸ª Redis ä¸Šå‘¢ï¼Ÿ ä½ å¾ˆå¯èƒ½ä¼šé‡‡ç”¨ç±»ä¼¼ä¸‹é¢çš„é€šç”¨æ–¹æ³•è®¡ç®— object çš„ hash å€¼ï¼Œç„¶åŽå‡åŒ€çš„æ˜ å°„åˆ°åˆ° N ä¸ª cacheï¼š æ±‚ä½™ç®—æ³•: hash(object) % N è¿™ç§é€šç”¨çš„è®¡ç®—æ–¹æ³•æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ ä¸€ä¸ª redis æœåŠ¡å™¨ x å®• æŽ‰äº†ï¼Œè¿™æ ·æ‰€æœ‰æ˜ å°„åˆ° redis x çš„å¯¹è±¡éƒ½ä¼šå¤±æ•ˆã€‚æ€Žä¹ˆåŠžï¼Ÿéœ€è¦æŠŠ redis x ä»Ž redisé›†ç¾¤ä¸­ç§»é™¤ï¼Œè¿™æ—¶å€™ redisæœåŠ¡å™¨ æ˜¯ N-1 å°ï¼Œé‚£ä¹ˆå¯¹åº”æ˜ å°„å…¬å¼å˜æˆäº† hash(object)%(N-1) ï¼› è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç”±äºŽè®¿é—®é‡å¢žå¤šï¼Œéœ€è¦æ·»åŠ  redis ï¼Œè¿™æ—¶å€™ redis æ˜¯ N+1 å°ï¼Œæ˜ å°„å…¬å¼å˜æˆäº† hash(object)%(N+1) ï¼› 1 å’Œ 2 æ„å‘³ç€çªç„¶ä¹‹é—´å‡ ä¹Žæ‰€æœ‰çš„ redisç¼“å­˜éƒ½å¤±æ•ˆäº†ã€‚å¯¹äºŽæœåŠ¡å™¨è€Œè¨€ï¼Œè¿™æ˜¯ä¸€åœºç¾éš¾ï¼Œæ‰€æœ‰çš„è®¿é—®éƒ½ä¼šç›´æŽ¥å†²å‘åŽç«¯æœåŠ¡å™¨ï¼Œå¯¹åŽç«¯æœåŠ¡å™¨é€ æˆåŽ‹åŠ›ï¼Œç”šè‡³æ˜¯åŽç«¯æœåŠ¡å™¨ç˜«ç—ªã€‚ å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢ï¼Ÿä¸€è‡´æ€§hashç®—æ³•å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ ä¸€è‡´æ€§Hashç®—æ³• ä¸€è‡´æ€§Hashç”¨äºŽåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼Œå°†Keyå€¼æ˜ å°„åˆ°å…·ä½“æœºå™¨Ipä¸Šï¼Œå¹¶ä¸”å¢žåŠ å’Œåˆ é™¤1å°æœºå™¨çš„æ•°æ®ç§»åŠ¨é‡è¾ƒå°ã€‚ ä¸€è‡´æ€§Hashç®—æ³•ä¹Ÿæ˜¯ä½¿ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œåªæ˜¯ï¼Œåˆšæ‰æè¿°çš„å–æ¨¡æ³•æ˜¯å¯¹æœåŠ¡å™¨çš„æ•°é‡è¿›è¡Œå–æ¨¡ï¼Œè€Œä¸€è‡´æ€§Hashç®—æ³•æ˜¯å¯¹2^32å–æ¨¡ã€‚ ç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†çŽ¯ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-2^32-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸ŒçŽ¯å¦‚ä¸‹ï¼š æ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œåœ†çŽ¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æŽ¨ï¼Œ2ã€3ã€4ã€5ã€6â€¦â€¦ç›´åˆ°2^32-1ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨2^32-1ï¼Œ 0å’Œ2^32-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆï¼ŒæŠŠè¿™ä¸ªç”±2^32ä¸ªç‚¹ç»„æˆçš„åœ†çŽ¯ç§°ä¸ºHashçŽ¯ã€‚ ä»¥ä¸Šé¢çš„åœºæ™¯ä¸ºä¾‹ï¼Œå‡è®¾æœ‰4å°ç¼“å­˜æœåŠ¡å™¨ï¼Œnode1ã€node2ã€node3ï¼Œnode4ï¼Œé‚£ä¹ˆï¼Œåœ¨ç”Ÿäº§çŽ¯å¢ƒä¸­ï¼Œè¿™4å°æœåŠ¡å™¨è‚¯å®šæœ‰è‡ªå·±çš„IPåœ°å€æˆ–ä¸»æœºåï¼Œç”¨å®ƒä»¬å„è‡ªçš„IPåœ°å€æˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œä½¿ç”¨å“ˆå¸ŒåŽçš„ç»“æžœå¯¹2^32å–æ¨¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼ï¼š hashï¼ˆnode1çš„IPåœ°å€ï¼‰ % 2^32 é€šè¿‡ä¸Šé¢å…¬å¼ç®—å‡ºçš„ç»“æžœä¸€å®šèƒ½å¾—åˆ°ä¸€ä¸ª0åˆ°2^32-1ä¹‹é—´çš„æ•´æ•°ï¼Œå°±ç”¨å¾—å‡ºçš„æ•´æ•°ï¼Œä»£è¡¨æœåŠ¡å™¨node1ï¼Œæ—¢ç„¶è¿™ä¸ªæ•´æ•°è‚¯å®šå¤„äºŽ0åˆ°2^32-1ä¹‹é—´ï¼Œé‚£ä¹ˆï¼Œä¸Šå›¾ä¸­çš„hashçŽ¯ä¸Šå¿…å®šæœ‰ä¸€ä¸ªç‚¹ä¸Žè¿™ä¸ªæ•´æ•°å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨node1ï¼Œé‚£ä¹ˆï¼ŒæœåŠ¡å™¨node1å°±å¯ä»¥æ˜ å°„åˆ°è¿™ä¸ªçŽ¯ä¸Šäº†ï¼Œå…¶ä»–æœåŠ¡å™¨ä¾æ¬¡ç±»æŽ¨å³å¯å¾—åˆ°ç›¸åº”çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š æŽ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼š å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨çŽ¯ä¸Šçš„ä½ç½®ï¼Œä»Žæ­¤ä½ç½®æ²¿çŽ¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œé‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨å°±æ˜¯è¯¥æ•°æ®åº”è¯¥æ˜ å°„åˆ°çš„æœåŠ¡å™¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬æœ‰Object Aã€Object Bã€Object Cã€Object Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åŽï¼Œåœ¨çŽ¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼š æ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Šã€‚ ä¸€è‡´æ€§hashç®—æ³•çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§ çŽ°åœ¨å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æžœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶çŽ¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢è€ƒè™‘å¦å¤–ä¸€ç§æƒ…å†µï¼Œå¦‚æžœåœ¨ç³»ç»Ÿä¸­å¢žåŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æžœå¢žåŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶çŽ¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯¹äºŽèŠ‚ç‚¹çš„å¢žå‡éƒ½åªéœ€é‡å®šä½çŽ¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚ HashçŽ¯çš„æ•°æ®å€¾æ–œé—®é¢˜ ä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜ï¼Œä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶çŽ¯åˆ†å¸ƒå¦‚ä¸‹ï¼š æ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æžå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šã€‚ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§Hashç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æžœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨IPæˆ–ä¸»æœºåçš„åŽé¢å¢žåŠ ç¼–å·æ¥å®žçŽ°ã€‚ ä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼ŒäºŽæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼ŒäºŽæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š åŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®žé™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚åœ¨å®žé™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚ ä¸€è‡´æ€§Hashç®—æ³•çš„Javaå®žçŽ° HashUtilså·¥å…·ç±» 1234567891011121314151617181920212223242526272829303132package com.springboot.whb.study.consistentHashing;/** * @author: whb * @description: Hashå·¥å…·ç±» */public class HashUtils &#123; /** * ä½¿ç”¨FNV1_32_HASHç®—æ³•è®¡ç®—æœåŠ¡å™¨çš„Hashå€¼ * * @param str * @return */ public static int getHash(String str) &#123; final int p = 16777619; int hash = (int) 2166136261L; for (int i = 0; i &lt; str.length(); i++) &#123; hash = (hash ^ str.charAt(i)) * p; &#125; hash += hash &lt;&lt; 13; hash ^= hash &gt;&gt; 7; hash += hash &lt;&lt; 3; hash ^= hash &gt;&gt; 17; hash += hash &lt;&lt; 5; // å¦‚æžœç®—å‡ºæ¥çš„å€¼ä¸ºè´Ÿæ•°åˆ™å–å…¶ç»å¯¹å€¼ if (hash &lt; 0) &#123; hash = Math.abs(hash); &#125; return hash; &#125;&#125; ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹ å…·ä½“ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package com.springboot.whb.study.consistentHashing;import java.util.SortedMap;import java.util.TreeMap;/** * @author: whb * @description: ä¸€è‡´æ€§Hashç®—æ³•--ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„å®žçŽ° */public class ConsistentHashingWithoutVirtualNode &#123; /** * å¾…æ·»åŠ åˆ°HashçŽ¯çš„æœåŠ¡å™¨ */ private static String[] servers = &#123;"127.0.0.1:7000", "127.0.0.1:7001", "127.0.0.1:7002", "127.0.0.1:7003", "127.0.0.1:7004"&#125;; /** * keyè¡¨ç¤ºæœåŠ¡å™¨çš„Hashå€¼ï¼Œvalueè¡¨ç¤ºæœåŠ¡å™¨ */ private static SortedMap&lt;Integer, String&gt; sortedMap = new TreeMap&lt;&gt;(); /** * åˆå§‹åŒ–ï¼Œå°†æ‰€æœ‰æœåŠ¡å™¨æ”¾å…¥sortedMap */ static &#123; for (int i = 0; i &lt; servers.length; i++) &#123; int hash = HashUtils.getHash(servers[i]); System.out.println("[" + servers[i] + "]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸ºï¼š" + hash); sortedMap.put(hash, servers[i]); &#125; System.out.println(); &#125; /** * å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹ * * @param key * @return */ private static String getServer(String key) &#123; //å¾—åˆ°è¯¥keyçš„hashå€¼ int hash = HashUtils.getHash(key); //å¾—åˆ°å¤§äºŽè¯¥Hashå€¼çš„æ‰€æœ‰Map SortedMap&lt;Integer, String&gt; subMap = sortedMap.tailMap(hash); if (subMap.isEmpty()) &#123; //å¦‚æžœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»Žç¬¬ä¸€ä¸ªnodeå¼€å§‹ Integer i = sortedMap.firstKey(); //è¿”å›žå¯¹åº”çš„æœåŠ¡å™¨ return sortedMap.get(i); &#125; else &#123; //ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡åŽ»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹ Integer i = subMap.firstKey(); //è¿”å›žå¯¹åº”çš„æœåŠ¡å™¨ return subMap.get(i); &#125; &#125; public static void main(String[] args) &#123; String[] keys = &#123;"æ–—å¸", "æ–—åœ£", "æ–—å°Š", "æ–—å®—", "æ–—çš‡", "æ–—çŽ‹", "æ–—çµ", "å¤§æ–—å¸ˆ", "æ–—å¸ˆ", "æ–—è€…"&#125;; for (String key : keys) &#123; System.out.println("[" + key + "]çš„hashå€¼ä¸ºï¼š" + HashUtils.getHash(key) + ", è¢«è·¯ç”±åˆ°ç»“ç‚¹[" + getServer(key) + "]"); &#125; &#125;&#125; æµ‹è¯•ç»“æžœ å¸¦è™šæ‹ŸèŠ‚ç‚¹ å…·ä½“ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.springboot.whb.study.consistentHashing;import com.springboot.whb.study.common.util.StringUtils;import java.util.LinkedList;import java.util.List;import java.util.SortedMap;import java.util.TreeMap;/** * @author: whb * @description: ä¸€è‡´æ€§Hashç®—æ³•--å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„å®žçŽ° */public class ConsistentHashingWithVirtualNode &#123; /** * å¾…æ·»åŠ åˆ°HashçŽ¯çš„æœåŠ¡å™¨ */ private static String[] servers = &#123;"127.0.0.1:7000", "127.0.0.1:7001", "127.0.0.1:7002", "127.0.0.1:7003", "127.0.0.1:7004"&#125;; /** * çœŸå®žèŠ‚ç‚¹åˆ—è¡¨ï¼Œè€ƒè™‘åˆ°æœåŠ¡å™¨çš„ä¸Šçº¿ã€ä¸‹çº¿ï¼Œå³æ·»åŠ ã€åˆ é™¤çš„åœºæ™¯ä¼šæ¯”è¾ƒé¢‘ç¹ */ private static List&lt;String&gt; realNodes = new LinkedList&lt;&gt;(); /** * è™šæ‹ŸèŠ‚ç‚¹ï¼ŒKeyè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„Hashå€¼ï¼Œvalueè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„åç§° */ private static SortedMap&lt;Integer, String&gt; virtualNodes = new TreeMap&lt;&gt;(); /** * è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›® */ private static final int VIRTUAL_NODES = 5; /** * åˆå§‹åŒ–ï¼ŒåŠ å…¥çœŸå®žèŠ‚ç‚¹åŠè™šæ‹ŸèŠ‚ç‚¹ */ static &#123; //å…ˆå°†åŽŸå§‹çš„æœåŠ¡å™¨æ·»åŠ åˆ°çœŸå®žèŠ‚ç‚¹åˆ—è¡¨ for (int i = 0; i &lt; servers.length; i++) &#123; realNodes.add(servers[i]); &#125; //æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ï¼ŒéåŽ†çœŸå®žèŠ‚ç‚¹åˆ—è¡¨ for (String str : realNodes) &#123; for (int i = 0; i &lt; VIRTUAL_NODES; i++) &#123; String virtualNodeName = str + "&amp;&amp;VN" + String.valueOf(i); setServer(virtualNodeName); &#125; &#125; System.out.println(); &#125; /** * æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ * * @param virtualNodeName */ private static void setServer(String virtualNodeName) &#123; setServer(virtualNodeName, null); &#125; /** * æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ * * @param virtualNodeName * @param hash */ private static void setServer(String virtualNodeName, Integer hash) &#123; hash = hash != null ? HashUtils.getHash(hash.toString()) : HashUtils.getHash(virtualNodeName); if (StringUtils.isBlank(virtualNodes.get(hash))) &#123; virtualNodes.put(hash, virtualNodeName); System.out.println("è™šæ‹ŸèŠ‚ç‚¹[" + virtualNodeName + "]è¢«æ·»åŠ , hashå€¼ä¸ºï¼š" + hash); &#125; else &#123; //è§£å†³Hashç¢°æ’ž setServer(virtualNodeName, hash); &#125; &#125; /** * å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹ * * @param key * @return */ private static String getServer(String key) &#123; //å¾—åˆ°è¯¥keyçš„hashå€¼ int hash = HashUtils.getHash(key); // å¾—åˆ°å¤§äºŽè¯¥Hashå€¼çš„æ‰€æœ‰Map SortedMap&lt;Integer, String&gt; subMap = virtualNodes.tailMap(hash); String virtualNode; if (subMap.isEmpty()) &#123; //å¦‚æžœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»Žç¬¬ä¸€ä¸ªnodeå¼€å§‹ Integer i = virtualNodes.firstKey(); //è¿”å›žå¯¹åº”çš„æœåŠ¡å™¨ virtualNode = virtualNodes.get(i); &#125; else &#123; //ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡åŽ»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹ Integer i = subMap.firstKey(); //è¿”å›žå¯¹åº”çš„æœåŠ¡å™¨ virtualNode = subMap.get(i); &#125; return virtualNode; &#125; public static void main(String[] args) &#123; String[] keys = &#123;"æ–—å¸", "æ–—åœ£", "æ–—å°Š", "æ–—å®—", "æ–—çš‡", "æ–—çŽ‹", "æ–—çµ", "å¤§æ–—å¸ˆ", "æ–—å¸ˆ", "æ–—è€…"&#125;; for (String key : keys) &#123; String server = getServer(key); String realServer = server.split("&amp;&amp;VN")[0]; System.out.println("[" + key + "]çš„hashå€¼ä¸º" + HashUtils.getHash(key) + ", è¢«è·¯ç”±åˆ°è™šæ‹Ÿç»“ç‚¹[" + server + "]ï¼Œè¢«è·¯ç”±åˆ°çœŸå®žèŠ‚ç‚¹[" + realServer + "]"); &#125; &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC-NIOå­¦ä¹ ]]></title>
    <url>%2Fposts%2Fe4966bd.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° NIOæ˜¯Java1.4æŽ¨å‡ºçš„ä¸€ç§å…¨æ–°çš„IOæ¨¡åž‹ï¼Œå…¨ç§°æ˜¯java non-blocking IOï¼Œæä¾›ByteBufferç­‰ç¼“å­˜çš„å®¹å™¨ï¼Œè¾¾åˆ°éžé˜»å¡žå¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œã€‚ IOæ¨¡åž‹ IOæ¨¡åž‹æ˜¯æœºå™¨è¿›è¡ŒIOå…·ä½“æ“ä½œæ–¹æ³•çš„ä¸€ç§æŠ½è±¡ï¼Œæ¯ç§IOæ¨¡åž‹éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦å®Œæˆå„æ¨¡åž‹çš„å®žé™…å¼€å‘éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œåœ¨æ²¡æœ‰pollã€epollå‡ºæ¥ä¹‹å‰ï¼Œjavaè¿›è¡Œéžé˜»å¡žå¼çš„è¯»å†™æ“ä½œå¾ˆå¤æ‚ï¼Œè€Œå½“ä¸Šè¿°åŠŸèƒ½å‡ºçŽ°ä¹‹åŽï¼Œjavaæ‰åœ¨åŸºäºŽè¯¥åŠŸèƒ½ä¸Šæ·»åŠ äº†nioæ¨¡å—ï¼ŒåŒ…åæ˜¯java.nioï¼ŒçŽ°åœ¨åœ¨ç±»Linuxæ˜¯åŸºäºŽepollå®žçŽ°çš„ï¼Œç±»Unixï¼ˆåŒ…å«Macï¼‰æ˜¯åŸºäºŽkqueue å®žçŽ°çš„ã€‚ Buffer æ˜¯ä¸€ç§ç¼“å†²æ•°æ®çš„å®¹å™¨ï¼Œå¯ä»¥å­˜å‚¨å„ç§åŸºæœ¬ç±»åž‹çš„æ•°æ®ã€‚çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®ç»“æž„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç±»ä¼¼äºŽä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­capacityä¸ºç¼“å†²æ•°ç»„çš„é•¿åº¦ï¼Œä¸ºå›ºå®šçš„å€¼ï¼› postionè¡¨ç¤ºä¸‹ä¸€ä¸ªéœ€è¦æ“ä½œçš„ä½ç½®ï¼› limitä¸ºä¸‹ä¸€ä¸ªä¸å¯æ“ä½œçš„ä½ç½®ï¼› å„ç§æ•°æ®çš„å¤§å°å…³ç³»æ˜¯0&lt;=position&lt;=limit&lt;=capacity put å†™å…¥æ•°æ®ï¼Œæ¯æ¬¡å†™å…¥æ•°æ®çš„åœ°æ–¹éƒ½æ˜¯postionï¼Œå°±ä¼šä½¿å¾—postionçš„å€¼å˜å¤§ï¼Œå½“ç›´åˆ°å¡«å……çš„æ•°æ®é•¿åº¦è¶…è¿‡äº†æ•°ç»„çš„é•¿åº¦ï¼Œä¼šæŠ›å‡ºBufferOverflowExceptionå¼‚å¸¸ï¼› get è¯»å–æ•°æ® æ¯æ¬¡ä¹Ÿä¼šè¿›è¡Œpostion+1æ“ä½œ,è¿™é‡Œéœ€è¦æ³¨æ„åˆ°æ¯æ¬¡è¯»å–æ•°æ®ä¹‹å‰å¿…é¡»è¿›è¡Œclearæ“ä½œè¦ä¸ç„¶ä¼šå‡ºçŽ°æ•°æ®é”™è¯¯çš„é—®é¢˜ï¼Œå¦‚ä¸‹ä½¿ç”¨ä¾‹å­ï¼š é”™è¯¯ç¤ºä¾‹ æ­£ç¡®ç¤ºä¾‹ clear() æ¸…ç©ºç¼“å†²åŒºçš„æ•°æ®ï¼Œå®žé™…ä¸Šæ˜¯å‡æ¸…é™¤ï¼Œåªæ˜¯å°†postionç½®ä½0ï¼Œlimitç½®ä½capacityï¼› æºç å¦‚ä¸‹ï¼š 123456public final Buffer clear() &#123; position = 0; limit = capacity; mark = -1; return this;&#125; allocate(int n) ç”³è¯·ç¼“å†²åŒºï¼Œå¤§å°ç”±å‚æ•°å†³å®š; wrap(byte[] byets) åŒæ ·æ˜¯ç”³è¯·ç¼“å†²åŒºï¼Œä¼ å…¥çš„å‚æ•°å´æ˜¯byte[],ç›¸å½“äºŽè®¾ç½®çš„ç¼“å†²åŒºå¤§å°æ˜¯byteæ•°ç»„çš„é•¿åº¦ï¼Œç„¶åŽåˆå§‹åŒ–è®¾ç½®äº†è¯¥ç¼“å†²å®¹å™¨çš„å€¼; flip() åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œä¿®æ”¹limitä¸ºpostionï¼Œpositionä¸º0; hasRemaining() æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰æ•°æ®å¯è¯» return position &lt; limit; ä¸€èˆ¬çš„ä½¿ç”¨å¥—è·¯éƒ½æ˜¯: 12345678ByteBuffer byteBuffer = ByteBuffer.allocate(10);byteBuffer.clear(); // æ¸…ç©ºbyteBuffer.put("hello".getBytes()); // å†™å…¥æ•°æ®byteBuffer.flip(); // è¯»æ•°æ®ä¹‹å‰çš„å¿…å¤‡æ“ä½œwhile (byteBuffer.hasRemaining())&#123; // æ•°æ®æ˜¯å¦è¯»å–å®Œæ¯• System.out.print(byteBuffer.get() + "\t" ); // è¯»å–æ•°æ®&#125;System.out.println(); Channel Channelé€šé“ï¼Œå’Œpipelineä¸€ä¸ªæ„æ€ï¼Œç±»ä¼¼äºŽIOçš„Streamï¼Œåªæ˜¯streamæ˜¯å•å‘ï¼Œè¦ä¹ˆæ˜¯Inputè¦ä¹ˆæ˜¯Outputï¼Œè€ŒChannelæ˜¯åŒå‘çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥é€šè¿‡ä¸€ä¸ªchannelè¿›è¡Œè¯»å†™æ“ä½œäº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„å¯ä»¥è¯»å†™æ“ä½œå’Œèƒ½ä¸èƒ½è¯»å†™æ“ä½œè¿™æ˜¯ä¸¤å›žäº‹ã€‚ Nioçš„channelå…·ä½“å®žçŽ°ä¸»è¦ä¸ºFileChannelã€DatagramChannelã€SocketChannelã€ServerSocketChannelå››ç§ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯æ–‡ä»¶ã€UDPå’ŒTCPçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚é‡ç‚¹ä»‹ç»SocketChannleå’ŒServerSocketChannelã€‚ SocketChannel Socketchannel æ˜¯å®¢æˆ·ç«¯ï¼Œè¿žæŽ¥ä¸€ä¸ªåˆ›å»ºå¥½çš„TCPç½‘ç»œå¥—æŽ¥å­—çš„é€šé“ï¼Œå¯æœ‰ä¸¤ç§åˆ›å»ºæ–¹å¼ æ–°å»ºä¸€ä¸ªsocketchannelï¼Œå¹¶è¿žæŽ¥åˆ°æœåŠ¡å™¨ä¸Š; 123SocketChannel socketChannel = SocketChannel.open();// è¿žæŽ¥åˆ°æœ¬åœ°çš„8081ç«¯å£çš„æœåŠ¡å™¨ä¸ŠsocketChannel.connect(new InetSocketAddress(8081)); æœåŠ¡å™¨æŽ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æŽ¥æ”¶åˆ°çš„ 12345// æœåŠ¡ç«¯æŽ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯ï¼Œé€šè¿‡accpetå³å¯èŽ·å–å¯¹åº”çš„socketChannelSocketChannel socketChannel = serverSocketChannel.accept();// å…³é—­socketChannelï¼Œç”±äºŽå…¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨finallyé‡Œé¢ï¼Œå¹¶ä¸”åšå¥½ç©ºåˆ¤æ–­ä»¥åŠå¼‚å¸¸æ•èŽ·socketChannel.close(); ç”±ä¸Šå›¾æ‰€ç¤ºï¼Œéœ€è¦ä»Žchannelè¯»æ•°æ®ï¼Œä»¥åŠå‘å¤–å‘é€æ•°æ®éƒ½éœ€è¦ä½¿ç”¨bufferä½œä¸ºç¼“å†²å®¹å™¨ 12345678910111213141516171819// è¯»æ•°æ®ByteBuffer byteBuffer = ByteBuffer.allocate(1024);// read æ–¹æ³•ä¼šè¿”å›žè¯»å–äº†å¤šå°‘æ•°æ®åˆ°bufferä¸­ï¼Œè¿”å›ž-1è¡¨ç¤ºæ•°æ®ä»¥åŠè¯»å–å®Œæ¯•ï¼Œå¯ä»¥å…³é—­é€šé“äº†int count = socketChannel.read(byteBuffer);// å†™æ•°æ®String message = "Hello World!";// ç›´æŽ¥è°ƒç”¨writeæ–¹æ³•å†™å…¥ç›¸å…³çš„bytebufferæ•°ç»„socketChannel.write(message.getBytes());// å†™æ•°æ®æ–¹æ³•2String message = "Hello World!";ByteBuffer byteBuffer = ByteBuffer.allocate(1024);byteBuffer.clear();byetBuffer.put(message.getBytes());byetBuffer.flip();while(byteBuffer.hasRemaing())&#123; socketChannel.write(byetBuffer);&#125; ç”±äºŽå…¶ä¸ºå¼‚æ­¥æ¨¡å¼ï¼Œåœ¨å…¶è°ƒç”¨connect()æ–¹æ³•çš„æ—¶å€™æ˜¯ç«‹å³è¿”å›žç»“æžœï¼Œè¿žæŽ¥æˆåŠŸè¿”å›žtrueï¼Œè¿žæŽ¥ä¸æˆåŠŸè¿”å›žfalseï¼Œå¹¶ç»§ç»­è¿›è¡Œè¿žæŽ¥ï¼ˆæœåŠ¡è‡ªä¸»æ“ä½œï¼‰ï¼Œå­˜åœ¨è¿˜æœªå»ºç«‹è¿žæŽ¥å°±è¿”å›žäº†ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ•°æ®çš„æ—¶å€™å†è°ƒç”¨finishConnect()ç¡®ä¿é“¾æŽ¥çš„å»ºç«‹: 12345678SocketChannel socketChannel = SocketChannel.open();socketChannel.configureBlocking (false); // ä¸€å®šè¦è®¾ç½®è¯¥å†…å®¹socketChannel.connect(new InetSocketAddress(8081)); while(!socketChannel.finishConnect())&#123; ..... // æ—¥å¿—æ‰“å°ç­‰æ“ä½œï¼Œç›´åˆ°è¿žæŽ¥æˆåŠŸ&#125;// è¿™æ˜¯é˜»å¡žæ¨¡å¼çš„// è¿žæŽ¥æˆåŠŸï¼Œå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œäº† å¯ä»¥é€šè¿‡æ–¹æ³•isConnectionPending()çš„è¿”å›žå€¼ç¡®è®¤æ˜¯å¦å¤„äºŽè¿žæŽ¥ä¸­ã€‚ ServerSocketChannel ServerSocketChannel æ˜¯åº”ç”¨åœ¨æœåŠ¡ç«¯çš„ï¼Œå’ŒSocketchannelç›¸å¯¹åº”ï¼Œä¸»è¦æ˜¯ç”¨æ¥ç›‘å¬æ–°æ¥çš„TCPè¯·æ±‚çš„ä¸€ä¸ªé€šé“ã€‚ç»‘å®šçš„æœ¬åœ°ç«¯å£ï¼ŒIPæ˜¯æœ¬æœºIPã€‚åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();serverSocketChannel.socket().bind(new InetSocketAddress(8081));// é€šè¿‡å¯¹è¯¥channelæŒæœ‰çš„socketè¿›è¡Œç»‘å®šç«¯å£æ“ä½œ// ä¹‹å‰å¾ˆå¥‡æ€ªä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªç›´æŽ¥è°ƒç”¨socket().bindä¸ä¼šæœ‰ç©ºæŒ‡é’ˆä¹ˆï¼Ÿè‚¯å®šä¸ä¼šæœ‰è¿™ä¸ªé”™è¯¯çš„// åœ¨è°ƒç”¨socket()ï¼Œå¦‚æžœå‘çŽ°å…¶å†…ç½®çš„socketä¸ºnullï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªsocketçš„é€‚é…å‚æ•°æ›¿æ¢nullclass ServerSocketChannelImpl extends ServerSocketChannel implements SelChImpl &#123; private static NativeDispatcher nd; private final FileDescriptor fd; private int fdVal; private volatile long thread = 0L; private final Object lock = new Object(); private final Object stateLock = new Object(); private static final int ST_UNINITIALIZED = -1; private static final int ST_INUSE = 0; private static final int ST_KILLED = 1; private int state = -1; private InetSocketAddress localAddress; private boolean isReuseAddress; ServerSocket socket; // è¿™ä¸ªå°±æ˜¯è°ƒç”¨socketå–å¾—çš„æ•°æ® public ServerSocket socket() &#123; Object var1 = this.stateLock; synchronized (this.stateLock) &#123; if (this.socket == null) &#123; this.socket = ServerSocketAdaptor.create(this); &#125; return this.socket; &#125; &#125;&#125;public class ServerSocketAdaptor extends ServerSocket &#123; private final ServerSocketChannelImpl ssc; private volatile int timeout = 0; public static ServerSocket create(ServerSocketChannelImpl var0) &#123; try &#123; return new ServerSocketAdaptor(var0); &#125; catch (IOException var2) &#123; throw new Error(var2); &#125; &#125;&#125; Selector selector æ˜¯nioä¸­èƒ½å¤Ÿç®¡ç†å¤šä¸ªchannelé€šé“å¹¶æ„ŸçŸ¥å„ä¸ªé€šé“çš„è¯»å†™çŠ¶æ€çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å•çº¿ç¨‹ç®¡ç†å¤šä¸ªchannelçš„ä»Žè€ŒåŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¯·æ±‚ã€‚selectorå’Œchannelæ˜¯é€šè¿‡selectorkeyç»‘å®šçš„ 12345678// åˆ›å»ºä¸€ä¸ªselectorSelector selector = Selector.open();// åˆ›å»ºserversocketChannelå¹¶ç»‘å®šç«¯å£ServerSocketChannel serverSocketChannel ..... // è®¾ç½®ä¸ºéžé˜»å¡žæ¨¡å¼ServerSocketChannel.configureBlocking(false); // registerç»‘å®šselectorå’Œchannelåˆ°ä¸€ä¸ªå¯¹è±¡SelectionKeyä¸­SelectionKey key = channel.register(selector,Selectionkey.OP_READ); æ³¨æ„register()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œinteresté›†åˆâ€ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹ä»€ä¹ˆäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯ä»¥ç›‘å¬å››ç§ä¸åŒç±»åž‹çš„äº‹ä»¶ï¼š Selectionkey.Connect å¯ä»¥è¿žæŽ¥ ï¼ˆå®¢æˆ·ç«¯æŽ¥æ”¶åˆ°å¯è¿žæŽ¥åˆ°è¯·æ±‚ï¼‰; Selectionkey.Accept å¯ä»¥æŽ¥å— ï¼ˆæœåŠ¡ç«¯æŽ¥åˆ°å®¢æˆ·ç«¯è¿žæŽ¥çš„è¯·æ±‚ï¼‰; Selectionkey.Read å¯ä»¥è¯»å–æ•°æ®; Selectionkey.Write å¯ä»¥å†™å…¥æ•°æ®; SelectionKey ç»‘å®šchannelå’Œselectorçš„å¯¹è±¡ï¼Œè¿˜åŒ…å«æœ‰readé›†åˆå’Œinteresté›†åˆ(æ„Ÿå…´è¶£ï¼Œåœ¨registerè®¾ç½®çš„å€¼),è¿˜å¯ä»¥é€šè¿‡attachment()æ–¹æ³•ç»‘å®šä¸€äº›å…¶ä»–æ•°æ®ã€‚é…å¥—çš„è¿˜æœ‰åˆ¤æ–­å…¶çŠ¶æ€çš„æ–¹æ³• 123456public class SelectionKeyImpl extends AbstractSelectionKey &#123; final SelChImpl channel; public final SelectorImpl selector; private int index; private volatile int interestOps; private int readyOps; é€‰æ‹©é€šé“ selectorä»Žå·²ç»æ³¨å†Œå¥½çš„channelä¸­èŽ·å–å·²ç»å‡†å¤‡å°±ç»ªçš„é€šé“è¿›è¡Œæ“ä½œï¼Œä»¥ä¸‹ä¸‰ç§æ˜¯èŽ·å–é€šé“çš„æ–¹æ³•: int select() // é˜»å¡žæ¨¡å¼ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå‡†å¤‡å°±ç»ªçš„é€šé“æ‰è¿”å›ž int select(long timeout) // åŠ å…¥è¶…æ—¶è®¾ç½® int selectNow() // ä¼šç«‹å³è¿”å›žï¼Œè¿”å›žå½“å‰å°±ç»ªçš„é€šé“ä¸ªæ•° selectedKeys()èŽ·å–å½“å‰å°±ç»ªçš„é€šé“é›†åˆ close() å…³é—­å½“å‰çš„selectorï¼Œä½¿å¾—ç»‘å®šçš„keyå…¨éƒ¨ä¸å¯ç”¨ï¼Œä½†æ˜¯é€šé“æœ¬èº«è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ 12345678910111213141516171819int count = selector.select();Iterator it = selector.selectedKeys().iterator();while (it.hasNext())&#123; SelectionKey selectionKey = (SelectionKey)it.next(); it.remove(); // å¤„ç†å®Œæˆä¸€ä¸ªkeyå°±ç§»é™¤æŽ‰ï¼Œæ— éœ€å†æ¬¡å¤„ç† if(selectionKey.isAcceptable())&#123; ServerSocketChannel serverSocketChannel = (ServerSocketChannel) selectionKey.channel(); SocketChannel socketChannel = serverSocketChannel.accept(); socketChannel.configureBlocking(false); socketChannel.register(selector, SelectionKey.OP_READ); &#125; if(selectionKey.isReadable())&#123; SocketChannel socketChannel = (SocketChannel) selectionKey.channel(); createProcessor(socketChannel); socketChannel.register(selector, SelectionKey.OP_WRITE); selectionKey.cancel(); // å½“å‰keyå–æ¶ˆæŽ‰äº†ï¼Œä½†æ˜¯é€šé“ä¾æ—§å¯ç”¨ &#125;&#125; DatagramChannel æ”¶å‘UTPåŒ…çš„é€šé“ï¼Œé€‚ç”¨äºŽUTPåè®®ï¼Œå‘é€å’Œè¯»å–çš„æ˜¯ç”¨æˆ·æ•°æ®æŠ¥ 123456DatagramChannel channel = DatagramChannel.open();channel.socket().bind(new InetSocketAddress(10002));// å»ºç«‹äº†ä¸€ä¸ªæœ¬åœ°10002ç«¯å£çš„UTPæœåŠ¡ç«¯channel.connect(new InetSocketAddress(10002));// è¿žæŽ¥ä¸€ä¸ªIPé»˜è®¤ä¸ºæœ¬æœºï¼Œç«¯å£ä¸º10002æœåŠ¡// è¯»å†™å’Œä¼ ç»Ÿçš„readã€writeç±»ä¼¼]]></content>
      <categories>
        <category>RPC</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>NIO</tag>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisçŸ¥è¯†ç‚¹å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fb1cc4593.html</url>
    <content type="text"><![CDATA[redis ç®€ä»‹ Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªKey-Valueç±»åž‹çš„å†…å­˜æ•°æ®åº“ï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚ å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éžå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¯ç”¨äºŽç¼“å­˜ã€äº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ã€é«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚ è¯¥æ•°æ®åº“ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é˜Ÿåˆ—ã€é›†åˆç»“æž„ç›´æŽ¥å­˜å–ï¼ŒåŸºäºŽå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚ redisçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº› 1ã€ä¼šè¯ç¼“å­˜ï¼ˆæœ€å¸¸ç”¨ï¼‰2ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ”¯ä»˜3ã€æ´»åŠ¨æŽ’è¡Œæ¦œæˆ–è®¡æ•°4ã€å‘å¸ƒã€è®¢é˜…æ¶ˆæ¯ï¼ˆæ¶ˆæ¯é€šçŸ¥ï¼‰5ã€å•†å“åˆ—è¡¨ã€è¯„è®ºåˆ—è¡¨ç­‰ ä¸ºä»€ä¹ˆè¦ç”¨ redis è€Œä¸ç”¨ map/guava åšç¼“å­˜ ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚ ä»¥javaä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„mapæˆ–è€…guavaå®žçŽ°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®žä¾‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®žä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚ ä½¿ç”¨ redis æˆ– memcached ä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®žä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®žä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¿æŒ redis æˆ– memcachedæœåŠ¡çš„é«˜å¯ç”¨ï¼Œæ•´ä¸ªç¨‹åºæž¶æž„ä¸Šè¾ƒä¸ºå¤æ‚ã€‚ redis å’Œ memcached çš„åŒºåˆ« redisæ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»åž‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰ï¼šRedisä¸ä»…ä»…æ”¯æŒç®€å•çš„k/vç±»åž‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æž„çš„å­˜å‚¨ã€‚memcachedæ”¯æŒç®€å•çš„æ•°æ®ç±»åž‹ï¼ŒStringã€‚Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€ŒMemecachedæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚é›†ç¾¤æ¨¡å¼ï¼šmemcachedæ²¡æœ‰åŽŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®žçŽ°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯redisç›®å‰æ˜¯åŽŸç”Ÿæ”¯æŒclusteræ¨¡å¼çš„ï¼Œrediså®˜æ–¹å°±æ˜¯æ”¯æŒredis clusteré›†ç¾¤æ¨¡å¼çš„ï¼Œæ¯”memcachedæ¥è¯´è¦æ›´å¥½ã€‚Memcachedæ˜¯å¤šçº¿ç¨‹ï¼Œéžé˜»å¡žIOå¤ç”¨çš„ç½‘ç»œæ¨¡åž‹ï¼›Redisä½¿ç”¨å•çº¿ç¨‹çš„(é¿å…äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢)å¤šè·¯ IO å¤ç”¨æ¨¡åž‹ã€‚ redis åˆ é™¤è¿‡æœŸæ•°æ® å®šæœŸåˆ é™¤ï¼šredisé»˜è®¤æ˜¯æ¯éš” 100ms å°±éšæœºæŠ½å–ä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æžœè¿‡æœŸå°±åˆ é™¤ã€‚æ³¨æ„è¿™é‡Œæ˜¯éšæœºæŠ½å–çš„ã€‚ä¸ºä»€ä¹ˆè¦éšæœºå‘¢ï¼Ÿä½ æƒ³ä¸€æƒ³å‡å¦‚ redis å­˜äº†å‡ åä¸‡ä¸ª key ï¼Œæ¯éš”100mså°±éåŽ†æ‰€æœ‰çš„è®¾ç½®è¿‡æœŸæ—¶é—´çš„ key çš„è¯ï¼Œå°±ä¼šç»™ CPU å¸¦æ¥å¾ˆå¤§çš„è´Ÿè½½ï¼ æƒ°æ€§åˆ é™¤ï¼šå®šæœŸåˆ é™¤å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šè¿‡æœŸ key åˆ°äº†æ—¶é—´å¹¶æ²¡æœ‰è¢«åˆ é™¤æŽ‰ã€‚æ‰€ä»¥å°±æœ‰äº†æƒ°æ€§åˆ é™¤ã€‚å‡å¦‚ä½ çš„è¿‡æœŸ keyï¼Œé å®šæœŸåˆ é™¤æ²¡æœ‰è¢«åˆ é™¤æŽ‰ï¼Œè¿˜åœç•™åœ¨å†…å­˜é‡Œï¼Œé™¤éžä½ çš„ç³»ç»ŸåŽ»æŸ¥ä¸€ä¸‹é‚£ä¸ª keyï¼Œæ‰ä¼šè¢«redisç»™åˆ é™¤æŽ‰ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æƒ°æ€§åˆ é™¤ï¼Œä¹Ÿæ˜¯å¤Ÿæ‡’çš„å“ˆï¼ redis å†…å­˜æ·˜æ±°æœºåˆ¶ Redis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š volatile-lruï¼šä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚volatile-ttlï¼šä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚volatile-randomï¼šä»Žå·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key(è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„)ã€‚allkeys-randomï¼šä»Žæ•°æ®é›†(server.db[i].dict)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚no-envictionï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªåº”è¯¥æ²¡äººä½¿ç”¨å§! redisæ·˜æ±°æ•°æ®æ—¶è¿˜ä¼šåŒæ­¥åˆ°aofã€‚ redis æŒä¹…åŒ–æœºåˆ¶ Redis çš„ä¸€ç§æŒä¹…åŒ–æ–¹å¼å«å¿«ç…§(snapshottingï¼ŒRDB)ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯åªè¿½åŠ æ–‡ä»¶(append-only fileï¼ŒAOF)ã€‚ å¿«ç…§(snapshotting)æŒä¹…åŒ–(RDB) Redis å¯ä»¥é€šè¿‡åˆ›å»ºå¿«ç…§æ¥èŽ·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚ Redis åˆ›å»ºå¿«ç…§ä¹‹åŽï¼Œå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»Žè€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬(Redis ä¸»ä»Žç»“æž„ï¼Œä¸»è¦ç”¨æ¥æé«˜ Redis æ€§èƒ½)ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŽŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚ Redisä¼šå•ç‹¬åˆ›å»ºfork()ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†å½“å‰çˆ¶è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œç„¶åŽç”±å­è¿›ç¨‹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ŒæŒä¹…åŒ–çš„è¿‡ç¨‹ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡çš„å¿«ç…§æ–‡ä»¶ï¼Œç„¶åŽå­è¿›ç¨‹é€€å‡ºï¼Œå†…å­˜é‡Šæ”¾ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡å¿«ç…§æŒä¹…åŒ–éƒ½ä¼šå°†ä¸»è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶ä¸€éï¼Œå¯¼è‡´å†…å­˜å¼€é”€åŠ å€ï¼Œè‹¥æ­¤æ—¶å†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šé˜»å¡žæœåŠ¡å™¨è¿è¡Œï¼Œç›´åˆ°å¤åˆ¶ç»“æŸé‡Šæ”¾å†…å­˜ï¼›éƒ½ä¼šå°†å†…å­˜æ•°æ®å®Œæ•´å†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æžœæ•°æ®é‡å¤§çš„è¯ï¼Œè€Œä¸”å†™æ“ä½œé¢‘ç¹ï¼Œå¿…ç„¶ä¼šå¼•èµ·å¤§é‡çš„ç£ç›˜I/Oæ“ä½œï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”æœ€åŽä¸€æ¬¡æŒä¹…åŒ–åŽçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼› å¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š 12345save 900 1 #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åŽï¼Œå¦‚æžœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 300 10 #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åŽï¼Œå¦‚æžœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 60 10000 #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åŽï¼Œå¦‚æžœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ ä¼˜ç‚¹ï¼š åªæœ‰ä¸€ä¸ªæ–‡ä»¶dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚æ€§èƒ½æœ€å¤§åŒ–ï¼Œforkå­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯IOæœ€å¤§åŒ–ã€‚ç›¸å¯¹äºŽæ•°æ®é›†å¤§æ—¶ï¼Œæ¯”AOFçš„å¯åŠ¨æ•ˆçŽ‡æ›´é«˜ã€‚ ç¼ºç‚¹ï¼š æ•°æ®å®‰å…¨æ€§ä½Žï¼Œé€šè¿‡é…ç½®saveå‚æ•°æ¥è¾¾åˆ°å®šæ—¶çš„å†™å¿«ç…§ï¼Œæ¯”å¦‚ æ¯900 ç§’æœ‰1ä¸ªé”®è¢«ä¿®æ”¹å°±è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œæ¯300ç§’è‡³å°‘æœ‰10ä¸ªé”®è¢«ä¿®æ”¹è¿›è¡Œå¿«ç…§ï¼Œæ¯60ç§’æœ‰è‡³å°‘10000ä¸ªé”®è¢«ä¿®æ”¹è¿›è¡Œè®°å½•ã€‚æ‰€ä»¥å¦‚æžœå½“æœåŠ¡å™¨è¿˜åœ¨ç­‰å¾…å†™å¿«ç…§æ—¶å‡ºçŽ°äº†å®•æœºï¼Œé‚£ä¹ˆå°†ä¼šä¸¢å¤±æ•°æ®ã€‚forkå­è¿›ç¨‹æ—¶å¯èƒ½å¯¼è‡´æœåŠ¡å™¨åœæœº1ç§’ï¼Œæ•°æ®é›†å¤ªå¤§ã€‚ AOF(append-only file)æŒä¹…åŒ– ä¸Žå¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®žæ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚ ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆè¯»æ“ä½œä¸è®°å½•ï¼‰ï¼Œåªéœ€è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨æ—¶ä¼šæ ¹æ®æ—¥å¿—ä»Žå¤´åˆ°å°¾å…¨éƒ¨æ‰§è¡Œä¸€éä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚åŒ…æ‹¬flushDBä¹Ÿä¼šæ‰§è¡Œã€‚ é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOF(append only file)æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š 1appendonly yes å¼€å¯ AOF æŒä¹…åŒ–åŽæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚ AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ appendonly.aofã€‚ åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š 123appendfsync always #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½ŽRedisçš„é€Ÿåº¦ appendfsync everysec #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ appendfsync no #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥ ä¸ºäº†å…¼é¡¾æ•°æ®å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ appendfsync everysec é€‰é¡¹ ï¼Œè®© Redis æ¯ç§’åŒæ­¥ä¸€æ¬¡ AOF æ–‡ä»¶ï¼ŒRedis æ€§èƒ½å‡ ä¹Žæ²¡å—åˆ°ä»»ä½•å½±å“ã€‚ è€Œä¸”è¿™æ ·å³ä½¿å‡ºçŽ°ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç¡¬ç›˜å¿™äºŽæ‰§è¡Œå†™å…¥æ“ä½œçš„æ—¶å€™ï¼ŒRedis è¿˜ä¼šä¼˜é›…çš„æ”¾æ…¢è‡ªå·±çš„é€Ÿåº¦ä»¥ä¾¿é€‚åº”ç¡¬ç›˜çš„æœ€å¤§å†™å…¥é€Ÿåº¦ã€‚ ä¼˜ç‚¹ï¼š æ•°æ®å®‰å…¨ï¼ŒaofæŒä¹…åŒ–å¯ä»¥é…ç½®appendfsyncå±žæ€§ï¼Œæœ‰alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ°aofæ–‡ä»¶ä¸­ä¸€æ¬¡ï¼›everySecï¼Œå°±æ˜¯æ¯ç§’å†…è¿›è¡Œä¸€æ¬¡æ–‡ä»¶çš„å†™æ“ä½œï¼›noå°±æ˜¯ä¸è¿›è¡Œaofæ–‡ä»¶çš„å†™æ“ä½œã€‚é€šè¿‡appendæ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡redis-check-aofå·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚AOFæœºåˆ¶çš„rewriteæ¨¡å¼ï¼Œç”¨æ¥å°†è¿‡å¤§çš„aofæ–‡ä»¶ç¼©å°ï¼Œå®žçŽ°åŽŸç†æ˜¯å°†æ‰€æœ‰çš„set é€šè¿‡ä¸€å¥set å‘½ä»¤æ€»ç»“ï¼Œæ‰€æœ‰çš„SADDå‘½ä»¤ç”¨æ€»ç»“ä¸ºä¸€å¥ï¼Œè¿™æ ·æ¯ç§å‘½ä»¤éƒ½æ¦‚æ‹¬ä¸ºä¸€å¥æ¥æ‰§è¡Œï¼Œå°±å¯ä»¥å‡å°‘aofæ–‡ä»¶çš„å¤§å°äº†ã€‚ï¼ˆæ³¨æ„ï¼Œåœ¨é‡å†™çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯åˆ›å»ºå­è¿›ç¨‹æ¥å®Œæˆé‡å†™æ“ä½œï¼Œä¸»è¿›ç¨‹æ¯ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨AOFç¼“å†²åŒºå’ŒAOFé‡å†™ç¼“å†²åŒºè¿›è¡Œä¿å­˜ï¼Œè¿™æ ·æ—§ç‰ˆaofæ–‡ä»¶å¯ä»¥å®žçŽ°æ•°æ®æœ€æ–°ï¼Œå½“æ›´æ–°å®ŒåŽå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥æ–°çš„aofæ–‡ä»¶ä¸­ç„¶åŽå°±å¯ä»¥å°†æ–°çš„æ–‡ä»¶æ›¿æ¢æŽ‰æ—§ç‰ˆçš„æ–‡ä»¶ã€‚é»˜è®¤è§¦å‘æ˜¯å½“aofæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡é‡å†™åŽå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äºŽ64Mæ—¶è§¦å‘ã€‚) ç¼ºç‚¹ï¼š æ–‡ä»¶ä¼šæ¯”RDBå½¢å¼çš„æ–‡ä»¶å¤§ã€‚æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯”rdbå¯åŠ¨æ•ˆçŽ‡ä½Žã€‚ æ€»ç»“ å½“ä¸¤ç§æ–¹å¼åŒæ—¶å¼€å¯æ—¶ï¼Œæ•°æ®æ¢å¤redisä¼šä¼˜å…ˆé€‰æ‹©AOFæ¢å¤ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ä½¿ç”¨é»˜è®¤å¼€å¯çš„RDBå³å¯ï¼Œå› ä¸ºç›¸å¯¹äºŽAOFï¼ŒRDBä¾¿äºŽè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œå¹¶ä¸”æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦å¿«å¾ˆå¤šã€‚ å¼€å¯æŒä¹…åŒ–ç¼“å­˜æœºåˆ¶ï¼Œå¯¹æ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“ï¼Œç‰¹åˆ«æ˜¯å½“è®¾ç½®çš„å†…å­˜æ»¡äº†çš„æ—¶å€™ï¼Œæ›´æ˜¯ä¸‹é™åˆ°å‡ ç™¾reqs/sã€‚æ‰€ä»¥å¦‚æžœåªæ˜¯ç”¨æ¥åšç¼“å­˜çš„è¯ï¼Œå¯ä»¥å…³æŽ‰æŒä¹…åŒ–ã€‚ Redis 4.0 å¯¹äºŽæŒä¹…åŒ–æœºåˆ¶çš„ä¼˜åŒ– Redis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–(é»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ aof-use-rdb-preamble å¼€å¯)ã€‚ å¦‚æžœæŠŠæ··åˆæŒä¹…åŒ–æ‰“å¼€ï¼ŒAOF é‡å†™çš„æ—¶å€™å°±ç›´æŽ¥æŠŠ RDB çš„å†…å®¹å†™åˆ° AOF æ–‡ä»¶å¼€å¤´ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, å¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ã€‚ å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼ŒAOF é‡Œé¢çš„ RDB éƒ¨åˆ†æ˜¯åŽ‹ç¼©æ ¼å¼ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚ Sentinel ï¼ˆå“¨å…µï¼‰åŽŸç† å“¨å…µçš„åŠŸèƒ½ ç›‘æŽ§ï¼ˆMonitoringï¼‰ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»ŽèŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»ŽèŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»ŽèŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚ é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿žæŽ¥å“¨å…µæ¥èŽ·å¾—å½“å‰ Redis æœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚ é€šçŸ¥ï¼ˆNotificationï¼‰ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æžœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å“¨å…µç³»ç»Ÿä¸­çš„ä¸»ä»ŽèŠ‚ç‚¹ï¼Œä¸Žæ™®é€šçš„ä¸»ä»ŽèŠ‚ç‚¹å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ•…éšœå‘çŽ°å’Œè½¬ç§»æ˜¯ç”±å“¨å…µæ¥æŽ§åˆ¶å’Œå®Œæˆçš„ã€‚ å“¨å…µèŠ‚ç‚¹æœ¬è´¨ä¸Šæ˜¯ Redis èŠ‚ç‚¹ã€‚ æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œåªéœ€è¦é…ç½®ç›‘æŽ§ä¸»èŠ‚ç‚¹ï¼Œä¾¿å¯ä»¥è‡ªåŠ¨å‘çŽ°å…¶ä»–çš„å“¨å…µèŠ‚ç‚¹å’Œä»ŽèŠ‚ç‚¹ã€‚ åœ¨å“¨å…µèŠ‚ç‚¹å¯åŠ¨å’Œæ•…éšœè½¬ç§»é˜¶æ®µï¼Œå„ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¼šè¢«é‡å†™(config rewrite)ã€‚ å“¨å…µçš„åŽŸç† å®šæ—¶ä»»åŠ¡ æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ç»´æŠ¤äº† 3 ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡çš„åŠŸèƒ½åˆ†åˆ«å¦‚ä¸‹ï¼š é€šè¿‡å‘ä¸»ä»ŽèŠ‚ç‚¹å‘é€ info å‘½ä»¤èŽ·å–æœ€æ–°çš„ä¸»ä»Žç»“æž„ã€‚é€šè¿‡å‘å¸ƒè®¢é˜…åŠŸèƒ½èŽ·å–å…¶ä»–å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚é€šè¿‡å‘å…¶ä»–èŠ‚ç‚¹å‘é€ ping å‘½ä»¤è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸‹çº¿ã€‚ ä¸»è§‚ä¸‹çº¿ åœ¨å¿ƒè·³æ£€æµ‹çš„å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå¦‚æžœå…¶ä»–èŠ‚ç‚¹è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å›žå¤ï¼Œå“¨å…µèŠ‚ç‚¹å°±ä¼šå°†å…¶è¿›è¡Œä¸»è§‚ä¸‹çº¿ã€‚ é¡¾åæ€ä¹‰ï¼Œä¸»è§‚ä¸‹çº¿çš„æ„æ€æ˜¯ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹â€œä¸»è§‚åœ°â€åˆ¤æ–­ä¸‹çº¿ï¼›ä¸Žä¸»è§‚ä¸‹çº¿ç›¸å¯¹åº”çš„æ˜¯å®¢è§‚ä¸‹çº¿ã€‚ å®¢è§‚ä¸‹çº¿ å“¨å…µèŠ‚ç‚¹åœ¨å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œä¸»è§‚ä¸‹çº¿åŽï¼Œä¼šé€šè¿‡ sentinelis-master-down-by-addr å‘½ä»¤è¯¢é—®å…¶ä»–å“¨å…µèŠ‚ç‚¹è¯¥ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ å¦‚æžœåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„å“¨å…µæ•°é‡è¾¾åˆ°ä¸€å®šæ•°å€¼ï¼Œåˆ™å¯¹è¯¥ä¸»èŠ‚ç‚¹è¿›è¡Œå®¢è§‚ä¸‹çº¿ã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå®¢è§‚ä¸‹çº¿æ˜¯ä¸»èŠ‚ç‚¹æ‰æœ‰çš„æ¦‚å¿µï¼›å¦‚æžœä»ŽèŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œè¢«å“¨å…µä¸»è§‚ä¸‹çº¿åŽï¼Œä¸ä¼šå†æœ‰åŽç»­çš„å®¢è§‚ä¸‹çº¿å’Œæ•…éšœè½¬ç§»æ“ä½œã€‚ é€‰ä¸¾é¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ å½“ä¸»èŠ‚ç‚¹è¢«åˆ¤æ–­å®¢è§‚ä¸‹çº¿ä»¥åŽï¼Œå„ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šè¿›è¡Œåå•†ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªé¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ï¼Œå¹¶ç”±è¯¥é¢†å¯¼è€…èŠ‚ç‚¹å¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚ ç›‘è§†è¯¥ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å“¨å…µéƒ½æœ‰å¯èƒ½è¢«é€‰ä¸ºé¢†å¯¼è€…ï¼Œé€‰ä¸¾ä½¿ç”¨çš„ç®—æ³•æ˜¯ Raft ç®—æ³•ã€‚ Raft ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯å…ˆåˆ°å…ˆå¾—ï¼šå³åœ¨ä¸€è½®é€‰ä¸¾ä¸­ï¼Œå“¨å…µ A å‘ B å‘é€æˆä¸ºé¢†å¯¼è€…çš„ç”³è¯·ï¼Œå¦‚æžœ B æ²¡æœ‰åŒæ„è¿‡å…¶ä»–å“¨å…µï¼Œåˆ™ä¼šåŒæ„ A æˆä¸ºé¢†å¯¼è€…ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè°å…ˆå®Œæˆå®¢è§‚ä¸‹çº¿ï¼Œä¸€èˆ¬å°±èƒ½æˆä¸ºé¢†å¯¼è€…ã€‚ æ•…éšœè½¬ç§» é€‰ä¸¾å‡ºçš„é¢†å¯¼è€…å“¨å…µï¼Œå¼€å§‹è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œè¯¥æ“ä½œå¤§ä½“å¯ä»¥åˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼š åœ¨ä»ŽèŠ‚ç‚¹ä¸­é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ï¼š é€‰æ‹©çš„åŽŸåˆ™æ˜¯ï¼Œé¦–å…ˆè¿‡æ»¤æŽ‰ä¸å¥åº·çš„ä»ŽèŠ‚ç‚¹ï¼Œç„¶åŽé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ä»ŽèŠ‚ç‚¹(ç”± slave-priority æŒ‡å®š)ã€‚ å¦‚æžœä¼˜å…ˆçº§æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»ŽèŠ‚ç‚¹ï¼›å¦‚æžœä»æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹© runid æœ€å°çš„ä»ŽèŠ‚ç‚¹ã€‚ æ›´æ–°ä¸»ä»ŽçŠ¶æ€: é€šè¿‡ slaveof no one å‘½ä»¤ï¼Œè®©é€‰å‡ºæ¥çš„ä»ŽèŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ï¼›å¹¶é€šè¿‡ slaveof å‘½ä»¤è®©å…¶ä»–èŠ‚ç‚¹æˆä¸ºå…¶ä»ŽèŠ‚ç‚¹ã€‚ Sentinel è¢«æŽˆæƒåŽï¼Œå®ƒå°†ä¼šèŽ·å¾—å®•æŽ‰çš„ master çš„ä¸€ä»½æœ€æ–°é…ç½®ç‰ˆæœ¬å· (config-epoch)ï¼Œå½“ failover æ‰§è¡Œç»“æŸä»¥åŽï¼Œè¿™ä¸ªç‰ˆæœ¬å·å°†ä¼šè¢«ç”¨äºŽæœ€æ–°çš„é…ç½®ï¼Œé€šè¿‡å¹¿æ’­å½¢å¼é€šçŸ¥å…¶å®ƒ Sentinelï¼Œå…¶å®ƒçš„ Sentinel åˆ™æ›´æ–°å¯¹åº” master çš„é…ç½®ã€‚ redisçš„å¹¶å‘ç«žäº‰keyé—®é¢˜ é—®é¢˜æè¿° åŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»ŸåŽ»setä¸€ä¸ªkeyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿ ç™¾åº¦ä¸€ä¸‹åŸºæœ¬éƒ½æ˜¯æŽ¨èç”¨ Redis äº‹åŠ¡æœºåˆ¶ã€‚ä½†æ˜¯å¹¶ä¸æŽ¨èä½¿ç”¨ Redis çš„äº‹åŠ¡æœºåˆ¶ã€‚å› ä¸ºç”Ÿäº§çŽ¯å¢ƒï¼ŒåŸºæœ¬éƒ½æ˜¯ Redis é›†ç¾¤çŽ¯å¢ƒï¼Œåšäº†æ•°æ®åˆ†ç‰‡æ“ä½œã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­æœ‰æ¶‰åŠåˆ°å¤šä¸ª Key æ“ä½œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ª Key ä¸ä¸€å®šéƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª redis-server ä¸Šã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æœºåˆ¶ï¼Œååˆ†é¸¡è‚‹ã€‚ è§£å†³æ–¹æ¡ˆ å¦‚æžœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå¤§å®¶åŽ»æŠ¢é”ï¼ŒæŠ¢åˆ°é”å°±åšsetæ“ä½œå³å¯ï¼Œæ¯”è¾ƒç®€å•ã€‚ å¦‚æžœå¯¹è¿™ä¸ªkeyæ“ä½œï¼Œè¦æ±‚é¡ºåº å‡è®¾æœ‰ä¸€ä¸ªkey1,ç³»ç»ŸAéœ€è¦å°†key1è®¾ç½®ä¸ºvalueA,ç³»ç»ŸBéœ€è¦å°†key1è®¾ç½®ä¸ºvalueB,ç³»ç»ŸCéœ€è¦å°†key1è®¾ç½®ä¸ºvalueC. æœŸæœ›æŒ‰ç…§key1çš„valueå€¼æŒ‰ç…§ valueAâ€“&gt;valueBâ€“&gt;valueCçš„é¡ºåºå˜åŒ–ã€‚è¿™æ—¶åœ¨æ•°æ®å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š 12345ç³»ç»ŸA key 1 &#123;valueA 3:00&#125;ç³»ç»ŸB key 1 &#123;valueB 3:05&#125;ç³»ç»ŸC key 1 &#123;valueC 3:10&#125; é‚£ä¹ˆï¼Œå‡è®¾è¿™ä¼šç³»ç»ŸBå…ˆæŠ¢åˆ°é”ï¼Œå°†key1è®¾ç½®ä¸º{valueB 3:05}ã€‚æŽ¥ä¸‹æ¥ç³»ç»ŸAæŠ¢åˆ°é”ï¼Œå‘çŽ°è‡ªå·±çš„valueAçš„æ—¶é—´æˆ³æ—©äºŽç¼“å­˜ä¸­çš„æ—¶é—´æˆ³ï¼Œé‚£å°±ä¸åšsetæ“ä½œäº†ã€‚ä»¥æ­¤ç±»æŽ¨ã€‚ å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚åˆ©ç”¨é˜Ÿåˆ—ï¼Œå°†setæ–¹æ³•å˜æˆä¸²è¡Œè®¿é—®ä¹Ÿå¯ä»¥ã€‚ ç¼“å­˜é›ªå´© ç®€ä»‹ ç¼“å­˜åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œæ‰€ä»¥ï¼ŒåŽé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æŽ‰ã€‚ é€šä¿—æ¥è¯´å°±æ˜¯ï¼šç”±äºŽåŽŸæœ‰ç¼“å­˜å¤±æ•ˆï¼ˆæˆ–è€…æ•°æ®æœªåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼‰ï¼Œæ–°ç¼“å­˜æœªåˆ°æœŸé—´ï¼ˆç¼“å­˜æ­£å¸¸ä»ŽRedisä¸­èŽ·å–ï¼‰æ‰€æœ‰åŽŸæœ¬åº”è¯¥è®¿é—®ç¼“å­˜çš„è¯·æ±‚éƒ½åŽ»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè€Œå¯¹æ•°æ®åº“CPUå’Œå†…å­˜é€ æˆå·¨å¤§åŽ‹åŠ›ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œé€ æˆç³»ç»Ÿçš„å´©æºƒã€‚ æ­£å¸¸è®¿é—®å¦‚ä¸‹ï¼š ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™å¦‚ä¸‹å›¾ï¼š è§£å†³åŠžæ³• äº‹å‰ï¼šå°½é‡ä¿è¯æ•´ä¸ª Redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œå‘çŽ°æœºå™¨å®•æœºå°½å¿«è¡¥ä¸Šã€‚é€‰æ‹©åˆé€‚çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚äº‹ä¸­ï¼šæœ¬åœ° Ehcache ç¼“å­˜ + Hystrix é™æµ&amp;é™çº§ï¼Œé¿å… æ•°æ®åº“ å´©æŽ‰ã€‚äº‹åŽï¼šåˆ©ç”¨ Redis æŒä¹…åŒ–æœºåˆ¶ä¿å­˜çš„æ•°æ®å°½å¿«æ¢å¤ç¼“å­˜ã€‚åŠ é”è®¡æ•°ï¼ˆå³é™åˆ¶å¹¶å‘çš„æ•°é‡ï¼Œå¯ä»¥ç”¨semphoreï¼‰æˆ–è€…èµ·ä¸€å®šæ•°é‡çš„é˜Ÿåˆ—æ¥é¿å…ç¼“å­˜å¤±æ•ˆæ—¶å¤§é‡è¯·æ±‚å¹¶å‘åˆ°æ•°æ®åº“ã€‚ä½†è¿™ç§æ–¹å¼ä¼šé™ä½Žåžåé‡ã€‚åˆ†æžç”¨æˆ·è¡Œä¸ºï¼Œç„¶åŽå¤±æ•ˆæ—¶é—´å‡åŒ€åˆ†å¸ƒã€‚æˆ–è€…åœ¨å¤±æ•ˆæ—¶é—´çš„åŸºç¡€ä¸Šå†åŠ 1~5åˆ†é’Ÿçš„éšæœºæ•°ã€‚å¦‚æžœæ˜¯æŸå°ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼Œåˆ™è€ƒè™‘åšä¸»å¤‡ã€‚ ç¼“å­˜ç©¿é€ ç®€ä»‹ ä¸€èˆ¬æ˜¯é»‘å®¢æ•…æ„åŽ»è¯·æ±‚ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æŽ‰ã€‚ è§£å†³åŠžæ³• æœ€å¸¸è§çš„åˆ™æ˜¯é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ã€‚ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæŽ‰ï¼Œä»Žè€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢åŽ‹åŠ›ã€‚ä¹Ÿæœ‰ä¸€ä¸ªæ›´ä¸ºç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œå¦‚æžœä¸€ä¸ªæŸ¥è¯¢è¿”å›žçš„æ•°æ®ä¸ºç©º(ä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœ)ï¼Œä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æžœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚ ç¼“å­˜å¹¶å‘ ç®€ä»‹ å¦‚æžœç½‘ç«™å¹¶å‘è®¿é—®é«˜ï¼Œä¸€ä¸ªç¼“å­˜å¦‚æžœå¤±æ•ˆï¼Œå¯èƒ½å‡ºçŽ°å¤šä¸ªè¿›ç¨‹åŒæ—¶æŸ¥è¯¢DBï¼ŒåŒæ—¶è®¾ç½®ç¼“å­˜çš„æƒ…å†µï¼Œå¦‚æžœå¹¶å‘ç¡®å®žå¾ˆå¤§ï¼Œè¿™ä¹Ÿå¯èƒ½é€ æˆDBåŽ‹åŠ›è¿‡å¤§ï¼Œè¿˜æœ‰ç¼“å­˜é¢‘ç¹æ›´æ–°çš„é—®é¢˜ã€‚ è§£å†³åŠžæ³• å¯¹ç¼“å­˜æŸ¥è¯¢åŠ é”ï¼Œå¦‚æžœKEYä¸å­˜åœ¨ï¼Œå°±åŠ é”ï¼Œç„¶åŽæŸ¥DBå…¥ç¼“å­˜ï¼Œç„¶åŽè§£é”ï¼›å…¶ä»–è¿›ç¨‹å¦‚æžœå‘çŽ°æœ‰é”å°±ç­‰å¾…ï¼Œç„¶åŽç­‰è§£é”åŽè¿”å›žæ•°æ®æˆ–è€…è¿›å…¥DBæŸ¥è¯¢ã€‚ ç¼“å­˜é¢„çƒ­ ç®€ä»‹ ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åŽï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æŽ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åŽå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æŽ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ è§£å†³åŠžæ³• ç›´æŽ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ï¼›æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼›å®šæ—¶åˆ·æ–°ç¼“å­˜ï¼› Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚RDBå†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ å¦‚æžœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ ä¸ºäº†ä¸»ä»Žå¤åˆ¶çš„é€Ÿåº¦å’Œè¿žæŽ¥çš„ç¨³å®šæ€§ï¼ŒMasterå’ŒSlaveæœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†… å°½é‡é¿å…åœ¨åŽ‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢žåŠ ä»Žåº“ ä¸»ä»Žå¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æž„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æž„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3... è¿™æ ·çš„ç»“æž„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®žçŽ°Slaveå¯¹Masterçš„æ›¿æ¢ã€‚å¦‚æžœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚ Redis ä¸»ä»Žå¤åˆ¶ åŽŸç† ä»ŽæœåŠ¡å™¨è¿žæŽ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€SYNCï¼ˆåŒæ­¥ï¼‰å‘½ä»¤ï¼›ä¸»æœåŠ¡å™¨æŽ¥æ”¶åˆ°SYNCå‘½ååŽï¼Œå¼€å§‹æ‰§è¡ŒBGSAVEå‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åŽæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼›ä¸»æœåŠ¡å™¨BGSAVEæ‰§è¡Œå®ŒåŽï¼Œå‘æ‰€æœ‰ä»ŽæœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›ä»ŽæœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åŽä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åŽå¼€å§‹å‘ä»ŽæœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›ä»ŽæœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æŽ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼›ï¼ˆä»ŽæœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆï¼‰ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»ŽæœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œä»ŽæœåŠ¡å™¨æŽ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ï¼ˆä»ŽæœåŠ¡å™¨åˆå§‹åŒ–å®ŒæˆåŽçš„æ“ä½œï¼‰ã€‚ ä¼˜ç‚¹ æ”¯æŒä¸»ä»Žå¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»Žæœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼›ä¸ºäº†åˆ†è½½Masterçš„è¯»æ“ä½œåŽ‹åŠ›ï¼ŒSlaveæœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”±Masteræ¥å®Œæˆï¼›SlaveåŒæ ·å¯ä»¥æŽ¥å—å…¶å®ƒSlavesçš„è¿žæŽ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†è½½Masterçš„åŒæ­¥åŽ‹åŠ›ï¼›Master Serveræ˜¯ä»¥éžé˜»å¡žçš„æ–¹å¼ä¸ºSlavesæä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨Master-SlaveåŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚ï¼›Slave ServeråŒæ ·æ˜¯ä»¥éžé˜»å¡žçš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æžœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedisåˆ™è¿”å›žåŒæ­¥ä¹‹å‰çš„æ•°æ®ã€‚ ç¼ºç‚¹ Redisä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»Žæœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»Žæœºï¼Œåˆ‡æ¢IPåŽè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½Žäº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ Redis å“¨å…µæ¨¡å¼ å·¥ä½œæ–¹å¼ æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘çŽ‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„Masterä¸»æœåŠ¡å™¨ï¼ŒSlaveä»ŽæœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚å¦‚æžœä¸€ä¸ªå®žä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åŽä¸€æ¬¡æœ‰æ•ˆå›žå¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®žä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰å¦‚æžœä¸€ä¸ªMasterä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘çŽ‡ç¡®è®¤Masterä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºŽç­‰äºŽé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™Masterä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘çŽ‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰Masterä¸»æœåŠ¡å™¨ã€Slaveä»ŽæœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚å½“Masterä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Masterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slaveä»ŽæœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘çŽ‡ä¼šä»Ž 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Masterä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Masterä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›žæœ‰æ•ˆå›žå¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚ ä¼˜ç‚¹ å“¨å…µæ¨¡å¼æ˜¯åŸºäºŽä¸»ä»Žæ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»Žçš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼éƒ½å…·æœ‰ã€‚ä¸»ä»Žå¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚ ç¼ºç‚¹ Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ Redis Clusteré›†ç¾¤æ¨¡å¼ redis3ä»¥åŽï¼ŒèŠ‚ç‚¹ä¹‹é—´æä¾›äº†å®Œæ•´çš„shardingï¼ˆåˆ†ç‰‡ï¼‰ã€replicationï¼ˆä¸»å¤‡æ„ŸçŸ¥èƒ½åŠ›ï¼‰ã€failoverï¼ˆæ•…éšœè½¬ç§»ï¼‰çš„ç‰¹æ€§ã€‚ é…ç½®ä¸€è‡´æ€§ æ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å†…éƒ¨éƒ½ä¿å­˜äº†é›†ç¾¤çš„é…ç½®ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨clusterStateä¸­ï¼Œé€šè¿‡å¼•å…¥è‡ªå¢žçš„epochå˜é‡æ¥ä½¿å¾—é›†ç¾¤é…ç½®åœ¨å„ä¸ªèŠ‚ç‚¹é—´ä¿æŒä¸€è‡´ã€‚ shardingæ•°æ®åˆ†ç‰‡ å°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º16384ä¸ªåˆ†ç‰‡ï¼ˆslotï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šå¯¹åº”ä¸€éƒ¨åˆ†slotï¼Œæ¯ä¸ªkeyéƒ½ä¼šæ ¹æ®åˆ†å¸ƒç®—æ³•æ˜ å°„åˆ°16384ä¸ªslotä¸­çš„ä¸€ä¸ªï¼Œåˆ†å¸ƒç®—æ³•ä¸ºslotId=crc16(key)%16384 å½“ä¸€ä¸ªclientè®¿é—®çš„keyä¸åœ¨å¯¹åº”èŠ‚ç‚¹çš„slotsä¸­ï¼Œredisä¼šè¿”å›žç»™clientä¸€ä¸ªmovedå‘½ä»¤ï¼Œå‘ŠçŸ¥å…¶æ­£ç¡®çš„è·¯ç”±ä¿¡æ¯ä»Žè€Œé‡æ–°å‘èµ·è¯·æ±‚ã€‚clientä¼šæ ¹æ®æ¯æ¬¡è¯·æ±‚æ¥ç¼“å­˜æœ¬åœ°çš„è·¯ç”±ç¼“å­˜ä¿¡æ¯ï¼Œä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚ç›´æŽ¥èƒ½å¤Ÿè·¯ç”±åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ã€‚ åˆ†ç‰‡è¿ç§» åˆ†ç‰‡è¿ç§»çš„è§¦å‘å’Œè¿‡ç¨‹æŽ§åˆ¶ç”±å¤–éƒ¨ç³»ç»Ÿå®Œæˆï¼Œredisåªæä¾›è¿ç§»è¿‡ç¨‹ä¸­éœ€è¦çš„åŽŸè¯­æ”¯æŒã€‚ ä¸»è¦åŒ…å«ä¸¤ç§ï¼šä¸€ç§æ˜¯èŠ‚ç‚¹è¿ç§»çŠ¶æ€è®¾ç½®ï¼Œå³è¿ç§»å‰æ ‡è®°æºã€ç›®æ ‡èŠ‚ç‚¹ï¼›å¦ä¸€ç§æ˜¯keyè¿ç§»çš„åŽŸå­åŒ–å‘½ä»¤ã€‚ failoveræ•…éšœè½¬ç§» æ•…éšœå‘çŽ° èŠ‚ç‚¹é—´ä¸¤ä¸¤é€šè¿‡TCPä¿æŒè¿žæŽ¥ï¼Œå‘¨æœŸæ€§è¿›è¡ŒPINGã€PONGäº¤äº’ï¼Œè‹¥å¯¹æ–¹çš„PONGç›¸åº”è¶…æ—¶æœªæ”¶åˆ°ï¼Œåˆ™å°†å…¶ç½®ä¸ºPFAILçŠ¶æ€ï¼Œå¹¶ä¼ æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚ æ•…éšœç¡®è®¤ å½“é›†ç¾¤ä¸­æœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å¯¹æŸä¸€ä¸ªPFAILçŠ¶æ€è¿›è¡Œäº†ç¡®è®¤ï¼Œåˆ™å°†èµ·æ”¹ä¸ºFAILçŠ¶æ€ï¼Œç¡®è®¤å…¶æ•…éšœã€‚ slaveé€‰ä¸¾ å½“æœ‰ä¸€ä¸ªmasteræŒ‚æŽ‰äº†ï¼Œåˆ™å…¶slaveé‡æ–°ç«žé€‰å‡ºä¸€ä¸ªæ–°çš„masterã€‚ä¸»è¦æ ¹æ®å„ä¸ªslaveæœ€åŽä¸€æ¬¡åŒæ­¥masterä¿¡æ¯çš„æ—¶é—´ï¼Œè¶Šæ–°è¡¨ç¤ºslaveçš„æ•°æ®è¶Šæ–°ï¼Œç«žé€‰çš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±æ›´æœ‰å¯èƒ½é€‰ä¸­ã€‚ç«žé€‰æˆåŠŸä¹‹åŽå°†æ¶ˆæ¯ä¼ æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚ é›†ç¾¤ä¸å¯ç”¨çš„æƒ…å†µ é›†ç¾¤ä¸­ä»»æ„masteræŒ‚æŽ‰ï¼Œä¸”å½“å‰masteræ²¡æœ‰slaveã€‚ é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°ä»¥ä¸ŠmasteræŒ‚æŽ‰ã€‚ Redis-Clusteré‡‡ç”¨æ— ä¸­å¿ƒç»“æž„çš„ç‰¹ç‚¹ æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚ èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚ å®¢æˆ·ç«¯ä¸ŽredisèŠ‚ç‚¹ç›´è¿ž,ä¸éœ€è¦ä¸­é—´ä»£ç†å±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿žæŽ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿žæŽ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚ Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipeline å¯ä»¥å°†å¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯pipelineæ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æžœç›¸å…³æ€§ã€‚ ä½¿ç”¨redis-benchmarkè¿›è¡ŒåŽ‹æµ‹çš„æ—¶å€™å¯ä»¥å‘çŽ°å½±å“redisçš„QPSå³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯pipelineæ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚ å¦‚æžœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸéœ€è¦æ³¨æ„ä»€ä¹ˆ å¦‚æžœå¤§é‡çš„keyè¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºŽé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œrediså¯èƒ½ä¼šå‡ºçŽ°çŸ­æš‚çš„å¡é¡¿çŽ°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚ Rediså¼‚æ­¥é˜Ÿåˆ— åŽŸç† ä¸€èˆ¬ä½¿ç”¨listç»“æž„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ã€‚å½“lpopæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ã€‚ å¯ä¸å¯ä»¥ä¸ç”¨sleep listæœ‰ä¸ªæŒ‡ä»¤å«blpopï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šé˜»å¡žä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡ ä½¿ç”¨pub/subä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®žçŽ°1:Nçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ pub/subæœ‰ä»€ä¹ˆç¼ºç‚¹ åœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚rabbitmqç­‰ã€‚ rediså¦‚ä½•å®žçŽ°å»¶æ—¶é˜Ÿåˆ— ä½¿ç”¨sortedsetï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸ºscoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºkeyè°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨zrangebyscoreæŒ‡ä»¤èŽ·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æžœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚ å¦‚æžœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ redisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡žä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡žçš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚çŽ‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡åŽ»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æŽ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC--ç®€æ˜“ç‰ˆ]]></title>
    <url>%2Fposts%2Fabff3a44.html</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹å¾ˆå¤šå…¬å¸åœ¨é¢è¯•çš„æ—¶å€™éƒ½ä¼šé—®åˆ°Dubboç­‰ä¸€äº›RPCæ¡†æž¶ï¼Œæ›´æœ‰ç”šè€…ç›´æŽ¥è¦æ±‚é¢è¯•è€…æ‰‹å†™PRCï¼Œä»Šå¤©å°±æ¥æ’©ä¸‹RPCã€‚ ä»€ä¹ˆæ˜¯RPC RPCï¼ˆRemote Procedure Callï¼‰ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ„æ€æ˜¯å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šè°ƒç”¨è¿œç¨‹çš„æœåŠ¡ã€‚åœ¨éžåˆ†å¸ƒå¼çŽ¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºè°ƒç”¨æœåŠ¡éƒ½æ˜¯æœ¬åœ°è°ƒç”¨ï¼Œä½†æ˜¯éšç€åˆ†å¸ƒå¼ç»“æž„çš„æ™®éï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨éœ€è¦è§£è€¦ï¼Œå°†ä¸åŒçš„ç‹¬ç«‹åŠŸèƒ½éƒ¨ç½²å‘å¸ƒæˆä¸åŒçš„æœåŠ¡ä¾›å®¢æˆ·ç«¯è°ƒç”¨ï¼ŒRPCå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚RPCæ˜¯ä¸€ç§è§„èŒƒï¼Œå’ŒTCPã€UDPéƒ½æ²¡æœ‰å…³ç³»ï¼ŒRPCå¯ä»¥é‡‡ç”¨TCPåè®®å®Œæˆæ•°æ®ä¼ è¾“ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨HTTPåº”ç”¨åè®®ã€‚RPCæ˜¯Cç«¯æ¨¡å¼ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯ï¼ˆæœåŠ¡æä¾›æ–¹ï¼‰ã€å®¢æˆ·ç«¯ï¼ˆæœåŠ¡ä½¿ç”¨æ–¹ï¼‰ï¼Œé‡‡ç”¨ç‰¹å®šçš„ç½‘ç»œä¼ è¾“åè®®ï¼ŒæŠŠæ•°æ®æŒ‰ç…§ç‰¹å®šçš„åè®®åŒ…è£…åŽè¿›è¡Œä¼ è¾“æ“ä½œç­‰æ“ä½œã€‚ RPCåŽŸç† é¦–å…ˆï¼Œæˆ‘ä»¬å¿ƒé‡Œå¸¦ç€è¿™æ ·çš„é—®é¢˜ï¼šè¦æ€Žä¹ˆæ ·åŽ»è°ƒç”¨è¿œç¨‹çš„æœåŠ¡å‘¢ï¼Ÿ â‘ è‚¯å®šè¦çŸ¥é“IPå’Œç«¯å£å§ï¼ˆç¡®å®šå”¯ä¸€ä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼› â‘¡è‚¯å®šè¦çŸ¥é“è°ƒç”¨ä»€ä¹ˆæœåŠ¡å§ï¼ˆæ–¹æ³•åå’Œå‚æ•°ï¼‰ï¼› â‘¢è°ƒç”¨æœåŠ¡åŽå¯èƒ½éœ€è¦ç»“æžœå§ã€‚ è¿™ä¸‰ç‚¹åˆæ€Žä¹ˆå®žçŽ°å‘¢ï¼Ÿ RPCçš„è®¾è®¡ç”±Clientï¼ŒClient stubï¼ŒNetworkï¼ŒServer stubï¼ŒServeræž„æˆã€‚ å…¶ä¸­Clientå°±æ˜¯ç”¨æ¥è°ƒç”¨æœåŠ¡çš„ï¼ŒCient stubæ˜¯ç”¨æ¥æŠŠè°ƒç”¨çš„æ–¹æ³•å’Œå‚æ•°åºåˆ—åŒ–çš„ï¼ˆå› ä¸ºè¦åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»è¦æŠŠå¯¹è±¡è½¬å˜æˆå­—èŠ‚ï¼‰ï¼Œç½‘ç»œç”¨æ¥ä¼ è¾“è¿™äº›ä¿¡æ¯åˆ°æœåŠ¡å™¨å­˜æ ¹ï¼ŒæœåŠ¡å™¨å­˜æ ¹ç”¨æ¥æŠŠè¿™äº›ä¿¡æ¯ååºåˆ—åŒ–çš„ï¼ŒæœåŠ¡å™¨å°±æ˜¯æœåŠ¡çš„æä¾›è€…ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯æœåŠ¡å™¨æä¾›çš„æ–¹æ³•ã€‚ RPCçš„ç»“æž„å¦‚ä¸‹å›¾ï¼š å›¾ä¸­1-10åºå·çš„å«ä¹‰å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¼¼çš„è°ƒç”¨è¿œç¨‹æœåŠ¡; å®¢æˆ·ç«¯stubæŽ¥æ”¶åˆ°è°ƒç”¨åŽï¼Œå°†ç±»åï¼Œæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨åºåˆ—åŒ–; å®¢æˆ·ç«¯é€šè¿‡æ’åº§å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯; Server stubæ”¶åˆ°æ¶ˆæ¯åŽè¿›è¡Œè§£ç ï¼ˆå°†æ¶ˆæ¯å¯¹è±¡ååºåˆ—åŒ–ï¼‰; æœåŠ¡å™¨å­˜æ ¹æ ¹æ®è§£ç ç»“æžœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡; æœ¬åœ°æœåŠ¡æ‰§è¡Œï¼ˆå¯¹äºŽæœåŠ¡ç«¯æ¥è¯´æ˜¯æœ¬åœ°æ‰§è¡Œï¼‰å¹¶å°†ç»“æžœè¿”å›žç»™æœåŠ¡å™¨å­˜æ ¹; æœåŠ¡å™¨å­˜æ ¹å°†è¿”å›žç»“æžœæ‰“åŒ…æˆæ¶ˆæ¯ï¼ˆå°†ç»“æžœæ¶ˆæ¯å¯¹è±¡åºåˆ—åŒ–ï¼‰; æœåŠ¡ç«¯é€šè¿‡æ’åº§å°†æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯; å®¢æˆ·ç«¯stubæŽ¥æ”¶åˆ°ç»“æžœæ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼ˆå°†ç»“æžœæ¶ˆæ¯å‘åºåˆ—åŒ–ï¼‰; å®¢æˆ·ç«¯å¾—åˆ°æœ€ç»ˆç»“æžœã€‚ è¿™å°±æ˜¯ä¸€ä¸ªå®ŒæˆPRCè°ƒç”¨è¿‡ç¨‹ï¼Œå¯¹ä½¿ç”¨æ–¹è€Œè¨€å°±åªæš´éœ²äº†æœ¬åœ°ä»£ç†å¯¹è±¡ï¼Œå‰©ä¸‹çš„æ•°æ®è§£æžã€è¿è¾“ç­‰éƒ½è¢«åŒ…è£…äº†ï¼Œä»ŽæœåŠ¡æä¾›æ–¹çš„è§’åº¦çœ‹è¿˜æœ‰æœåŠ¡æš´éœ²ï¼Œå¦‚ä¸‹æ˜¯Dubboçš„æž¶æž„å›¾ï¼š ç®€æ˜“RPCå®žçŽ° é¡¹ç›®ç›®å½• MethodParameterå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.springboot.whb.study.rpc.rpc_v1;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.InputStream;import java.io.ObjectInputStream;/** * @author: whb * @description: è¯·æ±‚å¯¹è±¡ */@Datapublic class MethodParameter &#123; /** * ç±»å */ private String className; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private Object[] arguments; /** * å‚æ•°ç±»åž‹ */ private Class&lt;?&gt;[] parameterTypes; @Override public String toString() &#123; return JSON.toJSONString(this); &#125; /** * ä»Žè¾“å…¥æµä¸­è¯»å–å‡ºç±»åã€æ–¹æ³•åã€å‚æ•°ç­‰æ•°æ®ç»„è£…æˆä¸€ä¸ªMethodParameter * * @param inputStream * @return */ public static MethodParameter convert(InputStream inputStream) &#123; try &#123; ObjectInputStream input = new ObjectInputStream(inputStream); String className = input.readUTF(); String methodName = input.readUTF(); Class&lt;?&gt;[] parameterTypes = (Class&lt;?&gt;[]) input.readObject(); Object[] arguments = (Object[]) input.readObject(); MethodParameter methodParameter = new MethodParameter(); methodParameter.setClassName(className); methodParameter.setMethodName(methodName); methodParameter.setArguments(arguments); methodParameter.setParameterTypes(parameterTypes); return methodParameter; &#125; catch (Exception e) &#123; throw new RuntimeException("è§£æžè¯·æ±‚é”™è¯¯ï¼š&#123;&#125;", e); &#125; &#125;&#125; æœåŠ¡ç«¯-æœåŠ¡æš´éœ² 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.springboot.whb.study.rpc.rpc_v1;import com.springboot.whb.study.rpc.rpc_v1.MethodParameter;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: æœåŠ¡ç«¯æš´éœ² * æœåŠ¡æš´éœ²å­˜å‚¨åœ¨objectMapå¯¹è±¡ä¸­ï¼Œæ‰€æœ‰å¯å¯¹æä¾›çš„æœåŠ¡éƒ½å¿…é¡»æ·»åŠ åˆ°è¯¥å®¹å™¨ä¸­ï¼Œä»¥ä¾¿äºŽæ”¶åˆ°ç½‘ç»œæ•°æ®åŽèƒ½æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œç„¶åŽé‡‡ç”¨åå°„invokeè°ƒç”¨ï¼Œè¿”å›žå¾—åˆ°çš„ç»“æžœã€‚ */public class RpcExploreService &#123; private Map&lt;String, Object&gt; objectMap = new HashMap&lt;&gt;(); /** * å¯å¯¹å¤–æä¾›çš„æœåŠ¡ * * @param className * @param object */ public void explore(String className, Object object) &#123; objectMap.put(className, object); &#125; /** * é‡‡ç”¨åå°„è¿›è¡Œè°ƒç”¨ * * @param methodParameter * @return */ public Object invoke(MethodParameter methodParameter) &#123; Object object = objectMap.get(methodParameter.getClassName()); if (object == null) &#123; throw new RuntimeException("æ— å¯¹åº”çš„æ‰§è¡Œç±»ï¼šã€" + methodParameter.getClassName() + "ã€‘"); &#125; Method method = null; try &#123; method = object.getClass().getMethod(methodParameter.getMethodName(), methodParameter.getParameterTypes()); &#125; catch (NoSuchMethodException e) &#123; throw new RuntimeException("æ‰§è¡Œç±»ï¼šã€" + methodParameter.getClassName() + "ã€‘æ— å¯¹åº”çš„æ‰§è¡Œæ–¹æ³•ï¼šã€" + methodParameter.getMethodName() + "ã€‘"); &#125; try &#123; Object result = method.invoke(object, methodParameter.getArguments()); System.out.println(methodParameter); return result; &#125; catch (Exception e) &#123; throw new RuntimeException("invokeæ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼š" + e.getMessage()); &#125; &#125;&#125; æœåŠ¡ç«¯-ç½‘ç»œæ•°æ®å¤„ç† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394package com.springboot.whb.study.rpc.rpc_v1;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.io.IOException;import java.io.InputStream;import java.io.ObjectOutputStream;import java.io.OutputStream;import java.net.ServerSocket;import java.net.Socket;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æœåŠ¡ç«¯-ç½‘ç»œæ•°æ®å¤„ç† * ç®€å•çš„BIOæ¨¡åž‹ï¼Œå¼€å¯äº†ä¸€ä¸ªServerSocketåŽï¼ŒæŽ¥æ”¶åˆ°æ•°æ®åŽå°±å°†å¥—æŽ¥å­—ä¸¢ç»™ä¸€ä¸ªæ–°çš„çº¿ç¨‹å¤„ç†ï¼ŒServerSocketRunnableæŽ¥æ”¶ä¸€ä¸ªsocketä¹‹åŽï¼Œ * è§£æžå‡ºMethodParameterè¯·æ±‚å¯¹è±¡ï¼Œç„¶åŽè°ƒç”¨æœåŠ¡æš´éœ²çš„Invokeæ–¹æ³•ï¼Œå†å†™å›žsocketä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚ */public class IOService implements Runnable &#123; private int port; private ServerSocket serverSocket; private RpcExploreService rpcExploreService; ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("thread-pool-", "%s")).build()); private volatile boolean flag; public IOService(RpcExploreService rpcExploreService, int port) throws IOException &#123; this.rpcExploreService = rpcExploreService; this.port = port; this.serverSocket = new ServerSocket(port); this.flag = true; System.out.println("******æœåŠ¡ç«¯å¯åŠ¨äº†********"); //ä¼˜é›…å…³é—­ Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; &#123; flag = false; System.out.println("+++++æœåŠ¡ç«¯å…³é—­äº†+++++"); &#125;)); &#125; @Override public void run() &#123; while (true) &#123; Socket socket = null; try &#123; socket = serverSocket.accept(); &#125; catch (IOException e) &#123; &#125; if (socket == null) &#123; continue; &#125; threadPoolExecutor.execute(new ServerSocketRunnable(socket)); &#125; &#125; class ServerSocketRunnable implements Runnable &#123; private Socket socket; public ServerSocketRunnable(Socket socket) &#123; this.socket = socket; &#125; @Override public void run() &#123; try &#123; InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); MethodParameter methodParameter = MethodParameter.convert(inputStream); Object result = rpcExploreService.invoke(methodParameter); ObjectOutputStream output = new ObjectOutputStream(outputStream); output.writeObject(result); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; if (socket != null) &#123; try &#123; socket.close(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯-æœåŠ¡è®¢é˜… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.springboot.whb.study.rpc.rpc_v1;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: å®¢æˆ·ç«¯-æœåŠ¡è®¢é˜… * æœåŠ¡ä½¿ç”¨æ–¹éœ€è¦ä½¿ç”¨registerè¿›è¡ŒæœåŠ¡çš„æ³¨å†Œï¼Œä¼šç”Ÿæˆå¯¹åº”çš„æœ¬åœ°ä»£ç†å¯¹è±¡ï¼ŒåŽç»­åªéœ€è¦é€šè¿‡æœ¬åœ°ä»£ç†å¯¹è±¡ã€‚ */public class RpcUsedService &#123; private Map&lt;String, Object&gt; proxyObejctMap = new HashMap&lt;&gt;(); private Map&lt;String, Class&gt; classMap = new HashMap&lt;&gt;(); private IOClient ioClient; public void setIoClient(IOClient ioClient) &#123; this.ioClient = ioClient; &#125; /** * æœåŠ¡æ³¨å†Œ * * @param clazz */ public void register(Class clazz) &#123; String className = clazz.getName(); classMap.put(className, clazz); if (!clazz.isInterface()) &#123; throw new RuntimeException("æš‚æ—¶åªæ”¯æŒæŽ¥å£ç±»åž‹çš„"); &#125; try &#123; RpcInvocationHandler handler = new RpcInvocationHandler(); handler.setClazz(clazz); Object proxyInstance = Proxy.newProxyInstance(clazz.getClassLoader(), new Class&lt;?&gt;[]&#123;clazz&#125;, handler); proxyObejctMap.put(className, proxyInstance); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; public &lt;T&gt; T get(Class&lt;T&gt; clazz) &#123; String className = clazz.getName(); return (T) proxyObejctMap.get(className); &#125; class RpcInvocationHandler implements InvocationHandler &#123; private Class clazz; public void setClazz(Class clazz) &#123; this.clazz = clazz; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; MethodParameter methodParameter = new MethodParameter(); methodParameter.setClassName(clazz.getName()); methodParameter.setMethodName(method.getName()); methodParameter.setArguments(args); methodParameter.setParameterTypes(method.getParameterTypes()); return ioClient.invoke(methodParameter); &#125; &#125;&#125; å®¢æˆ·ç«¯-ç½‘ç»œå¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.springboot.whb.study.rpc.rpc_v1;import java.io.*;import java.net.Socket;/** * @author: whb * @description: å®¢æˆ·ç«¯-ç½‘ç»œå¤„ç† * ä»£ç†å¯¹è±¡è¢«è°ƒç”¨åŽç”Ÿæˆä¸€ä¸ªMethodParameterå¯¹è±¡ï¼Œé€šè¿‡æ­¤IOClientæŠŠæ•°æ®ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œå¹¶ä¸”è¿”å›žå¯¹åº”çš„æ•°æ®ã€‚ */public class IOClient &#123; private String ip; private int port; public IOClient(String ip, int port) &#123; this.ip = ip; this.port = port; &#125; public Object invoke(MethodParameter methodParameter) &#123; Socket socket = null; try &#123; socket = new Socket(ip, port); OutputStream outputStream = socket.getOutputStream(); ObjectOutputStream output = new ObjectOutputStream(outputStream); output.writeUTF(methodParameter.getClassName()); output.writeUTF(methodParameter.getMethodName()); output.writeObject(methodParameter.getParameterTypes()); output.writeObject(methodParameter.getArguments()); InputStream inputStream = socket.getInputStream(); ObjectInputStream input = new ObjectInputStream(inputStream); return input.readObject(); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; finally &#123; if (socket != null) &#123; try &#123; socket.close(); &#125; catch (IOException e) &#123; throw new RuntimeException("socketå…³é—­å¤±è´¥"); &#125; &#125; &#125; return null; &#125;&#125; å®žè·µ-æœåŠ¡ç«¯ 1234567891011121314151617181920212223package com.springboot.whb.study.rpc.rpc_v1;import com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorldImpl;/** * @author: whb * @description: æœåŠ¡ç«¯ */public class Service &#123; public static void main(String[] args) &#123; RpcExploreService rpcExploreService = new RpcExploreService(); //ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯æŽ¥å£çš„å…¨åç§° rpcExploreService.explore("com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorld", new HelloWorldImpl()); try &#123; //å¼€å¯11111ç«¯å£ç›‘å¬æœåŠ¡ Runnable ioService = new IOService(rpcExploreService, 11111); new Thread(ioService).start(); &#125; catch (Exception e) &#123; &#125; &#125;&#125; å®žè·µ-å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.springboot.whb.study.rpc.rpc_v1;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorld;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.util.Random;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: å®¢æˆ·ç«¯ */public class Client &#123; public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); public static void main(String[] args) &#123; RpcUsedService rpcUsedService = new RpcUsedService(); rpcUsedService.register(HelloWorld.class); try &#123; IOClient ioClient = new IOClient("127.0.0.1", 11111); //ç½‘ç»œå¥—æŽ¥å­—è¿žæŽ¥ åŒä¸Šæ˜¯10001ç«¯å£ rpcUsedService.setIoClient(ioClient); HelloWorld helloWorld = rpcUsedService.get(HelloWorld.class); //ç”Ÿæˆçš„æœ¬åœ°ä»£ç†å¯¹è±¡ proxy for (int i = 0; i &lt; 100; i++) &#123; threadPoolExecutor.execute(() -&gt; &#123; long start = System.currentTimeMillis(); int a = new Random().nextInt(100); int b = new Random().nextInt(100); int c = helloWorld.add(a, b); // .add æ“ä½œå°±æ˜¯å±è”½äº†æ‰€æœ‰çš„ç»†èŠ‚ï¼Œæä¾›ç»™å®¢æˆ·ç«¯ä½¿ç”¨çš„æ–¹æ³• System.out.println("a: " + a + ", b:" + b + ", c=" + c + ", è€—æ—¶:" + (System.currentTimeMillis() - start)); &#125;); &#125; &#125; catch (Exception e) &#123; throw new RuntimeException("å®¢æˆ·ç«¯æ‰§è¡Œå‡ºé”™:&#123;&#125;", e); &#125; finally &#123; threadPoolExecutor.shutdown(); &#125; &#125;&#125; æœåŠ¡æŽ¥å£ 12345678910package com.springboot.whb.study.rpc.rpc_v1.expore;/** * @author: whb * @description: æŽ¥å£å®šä¹‰ */public interface HelloWorld &#123; int add(int a, int b);&#125; æœåŠ¡æŽ¥å£å®žçŽ° 123456789101112131415161718192021222324package com.springboot.whb.study.rpc.rpc_v1.expore;import java.util.Random;/** * @author: whb * @description: æŽ¥å£å®žçŽ°ç±» */public class HelloWorldImpl implements HelloWorld &#123; @Override public int add(int a, int b) &#123; long start = System.currentTimeMillis(); try &#123; Thread.sleep(new Random().nextInt(10000)); // æ•…æ„æ·»åŠ äº†è€—æ—¶æ“ä½œï¼Œä»¥ä¾¿äºŽæ¨¡æ‹ŸçœŸå®žçš„è°ƒç”¨æ“ä½œ &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; int c = a + b; System.out.println(Thread.currentThread().getName() + " è€—æ—¶:" + (System.currentTimeMillis() - start)); return c; &#125;&#125; è¿è¡Œæ•ˆæžœ æ€»ç»“ è¿™åªæ˜¯ä¸€ä¸ªéžå¸¸ç®€å•çš„RPCå®žè·µï¼ŒåŒ…å«äº†æœåŠ¡æš´éœ²ã€æœåŠ¡æ³¨å†Œï¼ˆProxyç”Ÿæˆï¼‰ã€BIOæ¨¡åž‹è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œjavaé»˜è®¤çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œå¯¹RPCæœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†å’Œäº†è§£ï¼ŒçŸ¥é“RPCå¿…é¡»åŒ…å«çš„æ¨¡å—ã€‚ ä¸è¿‡è¿˜æ˜¯æœ‰å¾ˆå¤šéœ€è¦ä¼˜åŒ–çš„ç‚¹ä»¥æ”¹è¿›ï¼š IOæ¨¡åž‹ï¼šä½¿ç”¨çš„æ˜¯BIOæ¨¡åž‹ï¼Œå¯ä»¥æ”¹è¿›æ¢æˆNIOæ¨¡åž‹ï¼Œå¼•å…¥netty; æ± åŒ–ï¼šä¸è¦éšæ„æ–°å»ºçº¿ç¨‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åº”æœ‰çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†; æœåŠ¡å‘çŽ°ï¼šæœ¬åœ°æ¨¡æ‹Ÿçš„å°demoï¼Œå¹¶æ²¡æœ‰æœåŠ¡å‘çŽ°ï¼Œå¯ä»¥é‡‡ç”¨zkç®¡ç†; åºåˆ—åŒ–ï¼šjavaæœ¬èº«è‡ªå¸¦çš„åºåˆ—åŒ–æ•ˆçŽ‡å¾ˆä½Žï¼Œå¯ä»¥æ¢æˆHessianï¼ˆDUBBOé»˜è®¤é‡‡ç”¨å…¶ä½œä¸ºåºåˆ—åŒ–å·¥å…·ï¼‰ã€Protobufï¼ˆProtobufæ˜¯ç”±Googleæå‡ºçš„ä¸€ç§æ”¯æŒå¤šè¯­è¨€çš„è·¨å¹³å°çš„åºåˆ—åŒ–æ¡†æž¶ï¼‰ç­‰; è¿˜æœ‰ä¾‹å¦‚æœåŠ¡ç»Ÿè®¡ã€ä¼˜é›…ä¸‹çº¿ã€è´Ÿè½½å‡è¡¡ç­‰ä¹Ÿéƒ½æ˜¯ä¸€ä¸ªæˆç†Ÿçš„RPCæ¡†æž¶å¿…é¡»è¦è€ƒè™‘åˆ°çš„ç‚¹ã€‚]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ­å»ºåšå®¢å¸¸è§é—®é¢˜]]></title>
    <url>%2Fposts%2F5b526bb.html</url>
    <content type="text"><![CDATA[No Layout:index.html é—®é¢˜æè¿° æœ€è¿‘å¯¹Hexoä»¥åŠNextä¸»é¢˜åšäº†å‡çº§ï¼Œå‡çº§ä¹‹åŽåœ¨æ‰§è¡Œhexo gç¼–è¯‘æ—¶å‡ºçŽ°äº†No layout:index.htmlçš„é”™è¯¯ï¼Œå¦‚ä¸‹å›¾ï¼š è§£å†³æ€è·¯ æŸ¥çœ‹hexoæ’ä»¶å®‰è£…æƒ…å†µï¼Œå› å†…å®¹è¾ƒå¤šï¼Œåªéƒ¨åˆ†æˆªå›¾ï¼š 1npm ls --depth 0 hexoçš„ä¸€äº›æ’ä»¶æœªå®‰è£… 12npm ERR! peer dep missing: eslint@&gt;= 4.12.1, required by babel-eslint@10.0.3npm ERR! peer dep missing: eslint@&gt;= 4.12.1, required by babel-eslint@10.0.3 é€ä¸€å®‰è£…ç¼ºå¤±çš„æ’ä»¶ 1npm install eslint --save æ‰§è¡Œnpm installåŽï¼Œæ‰§è¡Œnpm audit fix è®¿é—®Hexoåšå®¢å‡ºçŽ°â€œCannot GET/xxxâ€é”™è¯¯ é—®é¢˜æè¿° åœ¨Hexoåšå®¢ä¸­ï¼Œå‡ºçŽ°Cannot GET/xxxé”™è¯¯ä¾¿æ„å‘³ç€xxxæ–‡ä»¶æœªè¢«æ‰¾åˆ°ã€‚ Cannot GET/xxxé”™è¯¯æœ¬è´¨æ˜¯hexo serverè¿”å›žçš„ä¸€ä¸ª404é”™è¯¯ã€‚ è§£å†³æ€è·¯ åˆ¤æ–­publicç›®å½•ä¸‹xxxæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ å¦‚æžœè¯´xxx.htmlä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‰§è¡Œhexo cï¼Œhexo gé‡æ–°ç”Ÿæˆä¸€æ¬¡ï¼Œå›žåˆ°æ­¥éª¤1ã€‚ æ­¥éª¤2æ‰§è¡Œå®ŒåŽxxx.htmlä»ä¸å­˜åœ¨ï¼Œæ‰§è¡Œnpm audit fixï¼ŒæŸ¥çœ‹æ˜¯å¦å°‘äº†ä»€ä¹ˆç»„ä»¶ï¼Œé€šè¿‡npm install hexo-xxx-xxx å®‰è£…å³å¯ã€‚ æ­¥éª¤3å®Œæˆä¹‹åŽï¼Œæ‰§è¡Œhexo cï¼Œhexo gé‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚ ä»ç„¶æœ‰é—®é¢˜ï¼Œè¯·å†å‚è€ƒæ­¤æ–‡ï¼šhttps://www.cnblogs.com/Sroot/p/6305938.html]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ã€ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜]]></title>
    <url>%2Fposts%2Fe755a8c.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åªè¦ç”¨ç¼“å­˜ï¼Œå°±å¯èƒ½ä¼šæ¶‰åŠåˆ°ç¼“å­˜ä¸Žæ•°æ®åº“åŒå­˜å‚¨åŒå†™ï¼Œåªè¦æ˜¯åŒå†™ï¼Œå°±ä¸€å®šä¼šæœ‰æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå¦‚ä½•ä¿è¯ç¼“å­˜ä¸Žæ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§ï¼Ÿ è¯»å†™ä¸²è¡ŒåŒ– ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æžœå…è®¸ç¼“å­˜å¯ä»¥ç¨å¾®è·Ÿæ•°æ®åº“å¶å°”æœ‰ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿä¸æ˜¯ä¸¥æ ¼è¦æ±‚ç¼“å­˜+æ•°æ®åº“å¿…é¡»ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨è¯»å†™è¯·æ±‚ä¸²è¡ŒåŒ–ï¼š å³è¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²åˆ°ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡ŒåŽ»ï¼Œä»Žè€Œè¾¾åˆ°é˜²æ­¢å¹¶å‘è¯·æ±‚å¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸²è¡ŒåŒ–å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºçŽ°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿçš„åžåé‡å¤§å¹…åº¦é™ä½Žã€‚ ä»£ç å®žçŽ°å¤§è‡´å¦‚ä¸‹ï¼ˆç½‘ä¸Šæ‰¾çš„ï¼‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * è¯·æ±‚å¼‚æ­¥å¤„ç†çš„serviceå®žçŽ° * @author Administrator * */@Service("requestAsyncProcessService") public class RequestAsyncProcessServiceImpl implements RequestAsyncProcessService &#123; @Override public void process(Request request) &#123; try &#123; // å…ˆåšè¯»è¯·æ±‚çš„åŽ»é‡ RequestQueue requestQueue = RequestQueue.getInstance(); Map&lt;Integer, Boolean&gt; flagMap = requestQueue.getFlagMap(); if(request instanceof ProductInventoryDBUpdateRequest) &#123; // å¦‚æžœæ˜¯ä¸€ä¸ªæ›´æ–°æ•°æ®åº“çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å°†é‚£ä¸ªproductIdå¯¹åº”çš„æ ‡è¯†è®¾ç½®ä¸ºtrue flagMap.put(request.getProductId(), true); &#125; else if(request instanceof ProductInventoryCacheRefreshRequest) &#123; Boolean flag = flagMap.get(request.getProductId()); // å¦‚æžœflagæ˜¯null if(flag == null) &#123; flagMap.put(request.getProductId(), false); &#125; // å¦‚æžœæ˜¯ç¼“å­˜åˆ·æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±åˆ¤æ–­ï¼Œå¦‚æžœæ ‡è¯†ä¸ä¸ºç©ºï¼Œè€Œä¸”æ˜¯trueï¼Œå°±è¯´æ˜Žä¹‹å‰æœ‰ä¸€ä¸ªè¿™ä¸ªå•†å“çš„æ•°æ®åº“æ›´æ–°è¯·æ±‚ if(flag != null &amp;&amp; flag) &#123; flagMap.put(request.getProductId(), false); &#125; // å¦‚æžœæ˜¯ç¼“å­˜åˆ·æ–°çš„è¯·æ±‚ï¼Œè€Œä¸”å‘çŽ°æ ‡è¯†ä¸ä¸ºç©ºï¼Œä½†æ˜¯æ ‡è¯†æ˜¯false // è¯´æ˜Žå‰é¢å·²ç»æœ‰ä¸€ä¸ªæ•°æ®åº“æ›´æ–°è¯·æ±‚+ä¸€ä¸ªç¼“å­˜åˆ·æ–°è¯·æ±‚äº†ï¼Œå¤§å®¶æƒ³ä¸€æƒ³ if(flag != null &amp;&amp; !flag) &#123; // å¯¹äºŽè¿™ç§è¯»è¯·æ±‚ï¼Œç›´æŽ¥å°±è¿‡æ»¤æŽ‰ï¼Œä¸è¦æ”¾åˆ°åŽé¢çš„å†…å­˜é˜Ÿåˆ—é‡Œé¢åŽ»äº† return; &#125; &#125; // åšè¯·æ±‚çš„è·¯ç”±ï¼Œæ ¹æ®æ¯ä¸ªè¯·æ±‚çš„å•†å“idï¼Œè·¯ç”±åˆ°å¯¹åº”çš„å†…å­˜é˜Ÿåˆ—ä¸­åŽ» ArrayBlockingQueue&lt;Request&gt; queue = getRoutingQueue(request.getProductId()); // å°†è¯·æ±‚æ”¾å…¥å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼Œå®Œæˆè·¯ç”±æ“ä½œ queue.put(request); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125; /** * èŽ·å–è·¯ç”±åˆ°çš„å†…å­˜é˜Ÿåˆ— * @param productId å•†å“id * @return å†…å­˜é˜Ÿåˆ— */ private ArrayBlockingQueue&lt;Request&gt; getRoutingQueue(Integer productId) &#123; RequestQueue requestQueue = RequestQueue.getInstance(); // å…ˆèŽ·å–productIdçš„hashå€¼ String key = String.valueOf(productId); int h; int hash = (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); // å¯¹hashå€¼å–æ¨¡ï¼Œå°†hashå€¼è·¯ç”±åˆ°æŒ‡å®šçš„å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œæ¯”å¦‚å†…å­˜é˜Ÿåˆ—å¤§å°8 // ç”¨å†…å­˜é˜Ÿåˆ—çš„æ•°é‡å¯¹hashå€¼å–æ¨¡ä¹‹åŽï¼Œç»“æžœä¸€å®šæ˜¯åœ¨0~7ä¹‹é—´ // æ‰€ä»¥ä»»ä½•ä¸€ä¸ªå•†å“idéƒ½ä¼šè¢«å›ºå®šè·¯ç”±åˆ°åŒæ ·çš„ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­åŽ»çš„ int index = (requestQueue.queueSize() - 1) &amp; hash; System.out.println("===========æ—¥å¿—===========: è·¯ç”±å†…å­˜é˜Ÿåˆ—ï¼Œå•†å“id=" + productId + ", é˜Ÿåˆ—ç´¢å¼•=" + index); return requestQueue.getQueue(index); &#125;&#125; Cache Aside Pattern Cache Aside Pattenï¼šç»å…¸çš„ç¼“å­˜+æ•°æ®åº“è¯»å†™æ¨¡å¼ã€‚ è¯»çš„æ—¶å€™ï¼Œå…ˆè¯»ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰çš„è¯ï¼Œå°±è¯»æ•°æ®åº“ï¼Œç„¶åŽå–å‡ºæ•°æ®åŽæ”¾å…¥ç¼“å­˜ï¼ŒåŒæ—¶è¿”å›žå“åº”ã€‚æ›´æ–°çš„æ—¶å€™ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åŽå†æ›´æ–°æ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ ä¹‹æ‰€ä»¥æ›´æ–°çš„æ—¶å€™åªæ˜¯åˆ é™¤ç¼“å­˜ï¼Œå› ä¸ºå¯¹äºŽä¸€äº›å¤æ‚æœ‰é€»è¾‘çš„ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡æ•°æ®å˜æ›´éƒ½æ›´æ–°ä¸€æ¬¡ç¼“å­˜ä¼šé€ æˆé¢å¤–çš„è´Ÿæ‹…ï¼Œåªæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè®©è¯¥æ•°æ®ä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™å†åŽ»æ‰§è¡Œè¯»çš„æ“ä½œæ¥é‡æ–°ç¼“å­˜ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½çš„ç­–ç•¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç¼“å­˜æ¶‰åŠçš„è¡¨çš„å­—æ®µï¼Œåœ¨1åˆ†é’Ÿå†…å°±ä¿®æ”¹äº†20æ¬¡ï¼Œæˆ–è€…æ˜¯100æ¬¡ï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–°20æ¬¡ï¼Œ100æ¬¡;ä½†æ˜¯è¿™ä¸ªç¼“å­˜åœ¨1åˆ†é’Ÿå†…å°±è¢«è¯»å–äº†1æ¬¡ï¼Œå› æ­¤æ¯æ¬¡æ›´æ–°ç¼“å­˜å°±ä¼šæœ‰å¤§é‡çš„å†·æ•°æ®ï¼Œå¯¹äºŽç¼“å­˜ç¬¦åˆ28é»„é‡‘æ³•åˆ™ï¼Œ20%çš„æ•°æ®ï¼Œå ç”¨äº†80%çš„è®¿é—®é‡ã€‚ æœ€åˆçº§çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ é—®é¢˜ï¼š å…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚å¦‚æžœåˆ é™¤ç¼“å­˜å¤±è´¥äº†ï¼Œé‚£ä¹ˆå¯¼è‡´æ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®å°±ä¼šå‡ºçŽ°ä¸ä¸€è‡´æ€§ã€‚ è§£å†³æ€è·¯ï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“ã€‚å¦‚æžœæ•°æ®åº“ä¿®æ”¹å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­æ˜¯æ—§æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸ä¼šä¸ä¸€è‡´ã€‚ å› ä¸ºè¯»çš„æ—¶å€™ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™è¯»æ•°æ®åº“ä¸­çš„æ—§æ•°æ®ï¼Œç„¶åŽå†æ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚ æ¯”è¾ƒå¤æ‚çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ é—®é¢˜ï¼š æ•°æ®å‘ç”Ÿäº†å˜æ›´ï¼Œå…ˆåˆ é™¤äº†ç¼“å­˜ï¼Œç„¶åŽè¦åŽ»ä¿®æ”¹æ•°æ®åº“ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼ŒåŽ»è¯»ç¼“å­˜ï¼Œå‘çŽ°ç¼“å­˜æ˜¯ç©ºçš„ï¼ŒåŽ»æŸ¥è¯¢æ•°æ®åº“ï¼ŒæŸ¥åˆ°äº†ä¿®æ”¹å‰çš„æ—§æ•°æ®ï¼Œæ”¾åˆ°äº†ç¼“å­˜ä¸­ï¼Œ éšåŽæ•°æ®å˜æ›´çš„ç¨‹åºå®Œæˆäº†æ•°æ®åº“çš„ä¿®æ”¹ï¼Œè¿™æ ·å°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚ è§£å†³æ€è·¯ï¼š æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®æ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œå°†æ“ä½œè·¯ç”±åˆ°ä¸€ä¸ªJVMçš„å†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æžœå‘çŽ°æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå°†é‡æ–°è¯»å–æ•°æ®+æ›´æ–°ç¼“å­˜çš„æ“ä½œï¼Œæ ¹æ®å”¯ä¸€æ ‡è¯†è·¯ç”±ä¹‹åŽï¼Œä¹Ÿå‘é€åŒä¸€ä¸ªJVMå†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚ ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹ä¸²è¡Œæ‹¿åˆ°å¯¹åº”çš„æ“ä½œï¼Œç„¶åŽä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œã€‚è¿™æ ·ï¼Œä¸€ä¸ªæ•°æ®å˜æ›´çš„æ“ä½œï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†åŽ»æ›´æ–°æ•°æ®åº“ï¼Œä½†æ˜¯è¿˜æ²¡å®Œæˆæ›´æ–°ï¼Œæ­¤æ—¶ä¸€ä¸ª è¯»è¯·æ±‚è¿‡æ¥ï¼Œè¯»åˆ°äº†ç©ºçš„ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå°†ç¼“å­˜æ›´æ–°çš„è¯·æ±‚å‘é€çš„é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶ä¼šåœ¨é˜Ÿåˆ—ä¸­ç§¯åŽ‹ï¼Œç„¶åŽåŒæ­¥ç­‰å¾…ç¼“å­˜æ›´æ–°å®Œæˆã€‚ è¿™æ ·æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šä¸€ä¸ªé˜Ÿåˆ—ä¸­å¤šä¸ªæ›´æ–°ç¼“å­˜çš„è¯·æ±‚ä¸²åœ¨ä¸€èµ·æ˜¯æ²¡æ„ä¹‰çš„ï¼Œå› æ­¤å¯ä»¥åšè¿‡æ»¤ã€‚å¦‚æžœå‘çŽ°é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä¸€ä¸ªæ›´æ–°ç¼“å­˜çš„è¯·æ±‚ï¼Œé‚£ä¹ˆä¸å†æ”¾æ›´æ–°ç¼“å­˜çš„è¯·æ±‚æ“ä½œè¿›åŽ»ï¼Œç›´æŽ¥ç­‰å¾…å‰é¢çš„æ›´æ–°æ“ä½œå®Œæˆå³å¯ã€‚ å¾…é‚£ä¸ªé˜Ÿåˆ—å¯¹åº”çš„å·¥ä½œçº¿ç¨‹å®Œæˆäº†ä¸Šä¸€ä¸ªæ“ä½œçš„æ•°æ®åº“çš„ä¿®æ”¹ä¹‹åŽï¼Œæ‰ä¼šåŽ»æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ›´æ–°çš„æ“ä½œï¼Œæ­¤æ—¶ä¼šä»Žæ•°æ®åº“ä¸­è¯»å–æœ€æ–°çš„å€¼ï¼Œç„¶åŽå†™å…¥ç¼“å­˜ä¸­ã€‚ å¦‚æžœè¯·æ±‚è¿˜åœ¨ç­‰å¾…æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ–­è½®è¯¢å‘çŽ°å¯ä»¥å–åˆ°å€¼äº†ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥è¿”å›žï¼›å¦‚æžœè¯·æ±‚ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ä¸€å®šæ—¶é•¿ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ç›´æŽ¥ä»Žæ•°æ®åº“ä¸­è¯»å–å½“å‰çš„æ—§å€¼ã€‚ é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¯¥æ–¹æ¡ˆè¦æ³¨æ„å¦‚ä¸‹çš„é—®é¢˜ï¼š è¯»è¯·æ±‚é•¿æ—¶é˜»å¡ž ç”±äºŽè¯»è¯·æ±‚è¿›è¡Œäº†éžå¸¸è½»åº¦çš„å¼‚æ­¥åŒ–ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„è¯»è¶…æ—¶çš„é—®é¢˜ï¼Œæ¯ä¸ªè¯»è¯·æ±‚å¿…é¡»åœ¨è¶…æ—¶æ—¶é—´èŒƒå›´å†…è¿”å›žã€‚ è¯¥æ–¹æ¡ˆæœ€å¤§çš„é£Žé™©ç‚¹åœ¨äºŽï¼Œå¯èƒ½æ•°æ®æ›´æ–°å¾ˆé¢‘ç¹ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­ç§¯åŽ‹äº†å¤§é‡æ›´æ–°æ“ä½œåœ¨é‡Œé¢ï¼Œç„¶åŽè¯»è¯·æ±‚ä¼šå‘ç”Ÿå¤§é‡çš„è¶…æ—¶ï¼Œæœ€åŽå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æŽ¥èµ°æ•°æ®åº“ã€‚ æ‰€ä»¥åŠ¡å¿…é€šè¿‡ä¸€äº›æ¨¡æ‹ŸçœŸå®žçš„æµ‹è¯•ï¼Œçœ‹çœ‹æ›´æ–°æ•°æ®çš„é¢‘çŽ‡æ˜¯æ€Žæ ·çš„ã€‚ å¦å¤–ä¸€ç‚¹ï¼Œå› ä¸ºä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¯èƒ½ä¼šç§¯åŽ‹é’ˆå¯¹å¤šä¸ªæ•°æ®é¡¹çš„æ›´æ–°æ“ä½œï¼Œå› æ­¤éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µè¿›è¡Œæµ‹è¯•ï¼Œå¯èƒ½éœ€è¦éƒ¨ç½²å¤šä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åˆ†æ‘Šä¸€äº›æ•°æ®çš„æ›´æ–°æ“ä½œã€‚ å¦‚æžœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œç§¯åŽ‹ 100 ä¸ªå•†å“çš„åº“å­˜ä¿®æ”¹æ“ä½œï¼Œæ¯ä¸ªåº“å­˜ä¿®æ”¹æ“ä½œè¦è€—è´¹ 10ms åŽ»å®Œæˆã€‚é‚£ä¹ˆæœ€åŽä¸€ä¸ªå•†å“çš„è¯»è¯·æ±‚ï¼Œå¯èƒ½ç­‰å¾… 10*100=1000ms=1s åŽï¼Œæ‰èƒ½å¾—åˆ°æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯¼è‡´è¯»è¯·æ±‚çš„é•¿æ—¶é˜»å¡žã€‚ å› æ­¤ï¼Œä¸€å®šè¦æ ¹æ®å®žé™…ä¸šåŠ¡ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼ŒåŽ»è¿›è¡Œä¸€äº›åŽ‹åŠ›æµ‹è¯•å’Œæ¨¡æ‹Ÿçº¿ä¸ŠçŽ¯å¢ƒï¼Œçœ‹é«˜å³°æœŸï¼Œå†…å­˜é˜Ÿåˆ—å¯èƒ½ä¼šç§¯åŽ‹å¤šå°‘æ›´æ–°æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ€åŽä¸€ä¸ªæ›´æ–°æ“ä½œå¯¹åº”çš„è¯»è¯·æ±‚ï¼Œä¼š Hang å¤šå°‘æ—¶é—´ã€‚ å¦‚æžœè¯»è¯·æ±‚åœ¨ 200ms è¿”å›žï¼Œå“ªæ€•æ˜¯æœ€ç¹å¿™çš„æ—¶å€™ï¼Œç§¯åŽ‹ 10 ä¸ªæ›´æ–°æ“ä½œï¼Œæœ€å¤šç­‰å¾… 200msï¼Œé‚£è¿˜å¯ä»¥çš„ã€‚ å¦‚æžœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­å¯èƒ½ç§¯åŽ‹çš„æ›´æ–°æ“ä½œç‰¹åˆ«å¤šï¼Œé‚£å°±è¦åŠ æœºå™¨ï¼Œè®©æ¯ä¸ªæœºå™¨ä¸Šéƒ¨ç½²çš„æœåŠ¡å®žä¾‹å¤„ç†æ›´å°‘çš„æ•°æ®ï¼Œé‚£ä¹ˆæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ç§¯åŽ‹çš„æ›´æ–°æ“ä½œå°±ä¼šè¶Šå°‘ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®çš„å†™é¢‘çŽ‡æ˜¯å¾ˆä½Žçš„ï¼Œå› æ­¤å®žé™…ä¸Šæ­£å¸¸æ¥è¯´ï¼Œåœ¨é˜Ÿåˆ—ä¸­ç§¯åŽ‹çš„æ›´æ–°æ“ä½œåº”è¯¥æ˜¯å¾ˆå°‘çš„ã€‚åƒè¿™ç§é’ˆå¯¹è¯»é«˜å¹¶å‘ã€è¯»ç¼“å­˜æž¶æž„çš„é¡¹ç›®ï¼Œä¸€èˆ¬æ¥è¯´å†™è¯·æ±‚æ˜¯éžå¸¸å°‘çš„ï¼Œæ¯ç§’çš„ QPS èƒ½åˆ°å‡ ç™¾å°±ä¸é”™äº†ã€‚ å®žé™…ç²—ç•¥æµ‹ç®—ä¸€ä¸‹ï¼Œå¦‚æžœä¸€ç§’æœ‰ 500 çš„å†™æ“ä½œï¼Œåˆ†æˆ 5 ä¸ªæ—¶é—´ç‰‡ï¼Œæ¯ 200ms å°± 100 ä¸ªå†™æ“ä½œï¼Œæ”¾åˆ° 20 ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ï¼Œå¯èƒ½å°±ç§¯åŽ‹ 5 ä¸ªå†™æ“ä½œã€‚ æ¯ä¸ªå†™æ“ä½œæ€§èƒ½æµ‹è¯•åŽï¼Œä¸€èˆ¬æ˜¯åœ¨ 20ms å·¦å³å°±å®Œæˆï¼Œé‚£ä¹ˆé’ˆå¯¹æ¯ä¸ªå†…å­˜é˜Ÿåˆ—çš„æ•°æ®çš„è¯»è¯·æ±‚ï¼Œä¹Ÿå°±æœ€å¤š Hang ä¸€ä¼šå„¿ï¼Œ200ms ä»¥å†…è‚¯å®šèƒ½è¿”å›žäº†ã€‚ ç»è¿‡ç®€å•çš„æµ‹ç®—ï¼Œå•æœºæ”¯æ’‘çš„å†™ QPS åœ¨å‡ ç™¾æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¦‚æžœå†™ QPS æ‰©å¤§äº† 10 å€ï¼Œé‚£ä¹ˆå°±æ‰©å®¹æœºå™¨ï¼Œæ‰©å®¹ 10 å€çš„æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ 20 ä¸ªé˜Ÿåˆ—ã€‚ è¯»è¯·æ±‚å¹¶å‘é‡è¿‡é«˜ è¿™é‡Œè¿˜å¿…é¡»åšå¥½åŽ‹åŠ›æµ‹è¯•ï¼Œç¡®ä¿æ°å·§ç¢°ä¸Šä¸Šè¿°æƒ…å†µæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé£Žé™©ï¼Œå°±æ˜¯çªç„¶é—´å¤§é‡è¯»è¯·æ±‚ä¼šåœ¨å‡ åæ¯«ç§’çš„å»¶æ—¶ Hang åœ¨æœåŠ¡ä¸Šï¼Œçœ‹æœåŠ¡èƒ½ä¸èƒ½æ‰›çš„ä½ï¼Œéœ€è¦å¤šå°‘æœºå™¨æ‰èƒ½æ‰›ä½æœ€å¤§çš„æžé™æƒ…å†µçš„å³°å€¼ã€‚ ä½†æ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨åŒä¸€æ—¶é—´æ›´æ–°ï¼Œç¼“å­˜ä¹Ÿä¸ä¼šåŒä¸€æ—¶é—´å¤±æ•ˆï¼Œæ‰€ä»¥æ¯æ¬¡å¯èƒ½ä¹Ÿå°±æ˜¯å°‘æ•°æ•°æ®çš„ç¼“å­˜å¤±æ•ˆäº†ï¼Œç„¶åŽé‚£äº›æ•°æ®å¯¹åº”çš„è¯»è¯·æ±‚è¿‡æ¥ï¼Œå¹¶å‘é‡åº”è¯¥ä¹Ÿä¸ä¼šç‰¹åˆ«å¤§ã€‚ å¤šæœåŠ¡å®žä¾‹éƒ¨ç½²çš„è¯·æ±‚è·¯ç”± å¯èƒ½è¿™ä¸ªæœåŠ¡éƒ¨ç½²äº†å¤šä¸ªå®žä¾‹ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œï¼Œä»¥åŠæ‰§è¡Œç¼“å­˜æ›´æ–°æ“ä½œçš„è¯·æ±‚ï¼Œéƒ½é€šè¿‡ Nginx æœåŠ¡å™¨è·¯ç”±åˆ°ç›¸åŒçš„æœåŠ¡å®žä¾‹ä¸Šã€‚ æ¯”å¦‚å¯¹åŒä¸€ä¸ªå•†å“çš„è¯»å†™è¯·æ±‚ï¼Œå…¨éƒ¨è·¯ç”±åˆ°åŒä¸€å°æœºå™¨ä¸Šã€‚å¯ä»¥è‡ªå·±åŽ»åšæœåŠ¡é—´çš„æŒ‰ç…§æŸä¸ªè¯·æ±‚å‚æ•°çš„ Hash è·¯ç”±ï¼Œä¹Ÿå¯ä»¥ç”¨ Nginx çš„ Hash è·¯ç”±åŠŸèƒ½ç­‰ç­‰ã€‚]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>ç¼“å­˜</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“å¸¸ç”¨æž¶æž„æ–¹æ¡ˆ]]></title>
    <url>%2Fposts%2F4c1379b8.html</url>
    <content type="text"><![CDATA[æ•°æ®åº“æž¶æž„åŽŸåˆ™ é«˜å¯ç”¨ é«˜æ€§èƒ½ ä¸€è‡´æ€§ æ‰©å±•æ€§ å¸¸è§çš„æž¶æž„æ–¹æ¡ˆ ä¸»å¤‡æž¶æž„ è¯¥æ–¹æ¡ˆåªæœ‰ä¸»åº“æä¾›è¯»å†™æœåŠ¡ï¼Œå¤‡åº“å†—ä½™ä½œæ•…éšœè½¬ç§»ã€‚ æ•°æ®åº“é“¾æŽ¥å­—ç¬¦ä¸²ï¼šjdbc:mysql://vip:3306/xxdb é«˜å¯ç”¨åˆ†æžï¼šé«˜å¯ç”¨ï¼Œä¸»åº“æŒ‚äº†ï¼Œkeepaliveï¼ˆä¸€ç§å·¥å…·ï¼‰ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡åº“ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡å±‚æ˜¯é€æ˜Žçš„ï¼Œæ— éœ€ä¿®æ”¹ä»£ç æˆ–é…ç½®ã€‚ é«˜æ€§èƒ½åˆ†æžï¼šè¯»å†™éƒ½æ“ä½œä¸»åº“ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿç“¶é¢ˆã€‚å¤§éƒ¨åˆ†äº’è”ç½‘åº”ç”¨è¯»å¤šå†™å°‘ï¼Œè¯»ä¼šå…ˆæˆä¸ºç“¶é¢ˆï¼Œè¿›è€Œå½±å“å†™æ€§èƒ½ã€‚å¦å¤–ï¼Œå¤‡åº“åªæ˜¯å•çº¯çš„å¤‡ä»½ï¼Œèµ„æºåˆ©ç”¨çŽ‡åªæœ‰50%ã€‚ ä¸€è‡´æ€§åˆ†æžï¼šè¯»å†™éƒ½æ“ä½œä¸»åº“ï¼Œä¸å­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æžï¼šæ— æ³•é€šè¿‡åŠ ä»Žåº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ å¯è½åœ°åˆ†æžï¼šä¸¤ç‚¹å½±å“è½åœ°ï¼šç¬¬ä¸€ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡å»ºç«‹é«˜æ•ˆçš„ç´¢å¼•å’Œå¼•å…¥ç¼“å­˜æ¥å¢žåŠ è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ€§èƒ½ã€‚è¿™ä¹Ÿæ˜¯é€šç”¨çš„æ–¹æ¡ˆã€‚ç¬¬äºŒï¼Œæ‰©å±•æ€§å·®ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡åˆ†åº“åˆ†è¡¨æ¥æ‰©å±•ã€‚ åŒä¸»æž¶æž„ è¯¥æ–¹æ¡ˆï¼Œä¸¤ä¸ªä¸»åº“åŒæ—¶æä¾›æœåŠ¡ï¼Œè´Ÿè½½å‡è¡¡ã€‚ æ•°æ®åº“é“¾æŽ¥å­—ç¬¦ä¸²ï¼šjdbc:mysql://vip:3306/xxdb é«˜å¯ç”¨åˆ†æžï¼šé«˜å¯ç”¨ï¼Œä¸€ä¸ªä¸»åº“æŒ‚äº†ï¼Œä¸å½±å“å¦ä¸€å°ä¸»åº“æä¾›æœåŠ¡ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡å±‚æ˜¯é€æ˜Žçš„ï¼Œæ— éœ€ä¿®æ”¹ä»£ç æˆ–é…ç½®ã€‚ é«˜æ€§èƒ½åˆ†æžï¼šè¯»å†™æ€§èƒ½ç›¸æ¯”äºŽæ–¹æ¡ˆä¸€éƒ½å¾—åˆ°æå‡ï¼Œæå‡ä¸€å€ã€‚ ä¸€è‡´æ€§åˆ†æžï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æžï¼šå½“ç„¶å¯ä»¥æ‰©å±•æˆä¸‰ä¸»å¾ªçŽ¯ï¼Œä½†ä¸å»ºè®®ï¼ˆä¼šå¤šä¸€å±‚æ•°æ®åŒæ­¥ï¼Œè¿™æ ·åŒæ­¥çš„æ—¶é—´ä¼šæ›´é•¿ï¼‰ã€‚å¦‚æžœéžå¾—åœ¨æ•°æ®åº“æž¶æž„å±‚é¢æ‰©å±•çš„è¯ï¼Œæ‰©å±•ä¸ºæ–¹æ¡ˆå››ã€‚ å¯è½åœ°åˆ†æžï¼šä¸¤ç‚¹å½±å“è½åœ°:ç¬¬ä¸€ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¯è§£å†³é—®é¢˜ã€‚ç¬¬äºŒï¼Œä¸»é”®å†²çªé—®é¢˜ï¼ŒIDç»Ÿä¸€åœ°ç”±åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡æ¥ç”Ÿæˆå¯è§£å†³é—®é¢˜ã€‚ ä¸€ä¸»å¤šä»Ž è¯¥æ–¹æ¡ˆé‡‡ç”¨ä¸»ä»Žæž¶æž„ï¼Œä¸€ä¸»å¤šä»Žï¼Œè¯»å†™åˆ†ç¦»ã€‚ æ•°æ®åº“é“¾æŽ¥å­—ç¬¦ä¸²ï¼š 12345jdbc:mysql://master-ip:3306/xxdb jdbc:mysql://slave1-ip:3306/xxdb jdbc:mysql://slave2-ip:3306/xxdb é«˜å¯ç”¨åˆ†æžï¼šä¸»åº“å•ç‚¹ï¼Œä»Žåº“é«˜å¯ç”¨ã€‚ä¸€æ—¦ä¸»åº“æŒ‚äº†ï¼Œå†™æœåŠ¡ä¹Ÿå°±æ— æ³•æä¾›ã€‚ é«˜æ€§èƒ½åˆ†æžï¼šå¤§éƒ¨åˆ†äº’è”ç½‘åº”ç”¨è¯»å¤šå†™å°‘ï¼Œè¯»ä¼šå…ˆæˆä¸ºç“¶é¢ˆï¼Œè¿›è€Œå½±å“æ•´ä½“æ€§èƒ½ã€‚è¯»çš„æ€§èƒ½æé«˜äº†ï¼Œæ•´ä½“æ€§èƒ½ä¹Ÿæé«˜äº†ã€‚å¦å¤–ï¼Œä¸»åº“å¯ä»¥ä¸ç”¨ç´¢å¼•ï¼Œçº¿ä¸Šä»Žåº“å’Œçº¿ä¸‹ä»Žåº“ä¹Ÿå¯ä»¥å»ºç«‹ä¸åŒçš„ç´¢å¼•ï¼ˆçº¿ä¸Šä»Žåº“å¦‚æžœæœ‰å¤šä¸ªè¿˜æ˜¯è¦å»ºç«‹ç›¸åŒçš„ç´¢å¼•ï¼Œä¸ç„¶å¾—ä¸å¿å¤±ï¼›çº¿ä¸‹ä»Žåº“æ˜¯å¹³æ—¶å¼€å‘äººå‘˜æŽ’æŸ¥çº¿ä¸Šé—®é¢˜æ—¶æŸ¥çš„åº“ï¼Œå¯ä»¥å»ºæ›´å¤šçš„ç´¢å¼•ï¼‰ã€‚ ä¸€è‡´æ€§åˆ†æžï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æžï¼šå¯ä»¥é€šè¿‡åŠ ä»Žåº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ï¼ˆå¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œä»Žåº“è¶Šå¤šéœ€è¦ä»Žä¸»åº“æ‹‰å–binlogæ—¥å¿—çš„ç«¯å°±è¶Šå¤šï¼Œè¿›è€Œå½±å“ä¸»åº“çš„æ€§èƒ½ï¼Œå¹¶ä¸”æ•°æ®åŒæ­¥å®Œæˆçš„æ—¶é—´ä¹Ÿä¼šæ›´é•¿ï¼‰ å¯è½åœ°åˆ†æžï¼šä¸¤ç‚¹å½±å“è½åœ°:ç¬¬ä¸€ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¯è§£å†³é—®é¢˜ã€‚ç¬¬äºŒï¼Œä¸»åº“å•ç‚¹é—®é¢˜ï¼Œæš‚æ—¶æ²¡æƒ³åˆ°å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ åŒä¸»+ä¸»ä»Ž æ•°æ®åº“é“¾æŽ¥å­—ç¬¦ä¸²ï¼š 12345jdbc:mysql://vip:3306/xxdbjdbc:mysql://slave1-ip:3306/xxdbjdbc:mysql://slave2-ip:3306/xxdb é«˜å¯ç”¨åˆ†æžï¼šé«˜å¯ç”¨ã€‚ é«˜æ€§èƒ½åˆ†æžï¼šé«˜æ€§èƒ½ã€‚ ä¸€è‡´æ€§åˆ†æžï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æžï¼šå¯ä»¥é€šè¿‡åŠ ä»Žåº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ï¼ˆå¸¦æ¥çš„é—®é¢˜åŒæ–¹æ¡ˆäºŒï¼‰ å¯è½åœ°åˆ†æžï¼šåŒæ–¹æ¡ˆäºŒï¼Œä½†æ•°æ®åŒæ­¥åˆå¤šäº†ä¸€å±‚ï¼Œæ•°æ®å»¶è¿Ÿæ›´ä¸¥é‡ã€‚ æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ ä¸»åº“å’Œä»Žåº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ æ³¨ï¼šå›¾ä¸­åœˆå‡ºçš„æ˜¯æ•°æ®åŒæ­¥çš„åœ°æ–¹ï¼Œæ•°æ®åŒæ­¥ï¼ˆä»Žåº“ä»Žä¸»åº“æ‹‰å–binlogæ—¥å¿—ï¼Œå†æ‰§è¡Œä¸€éï¼‰æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªåŒæ­¥æ—¶é—´å†…ä¸»åº“å’Œä»Žåº“çš„æ•°æ®ä¼šå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¦‚æžœåŒæ­¥è¿‡ç¨‹ä¸­æœ‰è¯»è¯·æ±‚ï¼Œé‚£ä¹ˆè¯»åˆ°çš„å°±æ˜¯ä»Žåº“ä¸­çš„è€æ•°æ®ã€‚å¦‚ä¸‹å›¾ã€‚ æ—¢ç„¶çŸ¥é“äº†æ•°æ®ä¸ä¸€è‡´æ€§äº§ç”Ÿçš„åŽŸå› ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªè§£å†³æ–¹æ¡ˆä¾›å‚è€ƒï¼š ç›´æŽ¥å¿½ç•¥ï¼Œå¦‚æžœä¸šåŠ¡å…è®¸å»¶æ—¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸åŽ»ç®¡å®ƒã€‚ å¼ºåˆ¶è¯»ä¸»ï¼Œé‡‡ç”¨ä¸»å¤‡æž¶æž„æ–¹æ¡ˆï¼Œè¯»å†™éƒ½èµ°ä¸»åº“ã€‚ç”¨ç¼“å­˜æ¥æ‰©å±•æ•°æ®åº“è¯»æ€§èƒ½ ã€‚å¦‚æžœç¼“å­˜æŒ‚äº†ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé›ªå´©çŽ°è±¡ï¼Œä¸è¿‡ä¸€èˆ¬åˆ†å¸ƒå¼ç¼“å­˜éƒ½æ˜¯é«˜å¯ç”¨çš„ã€‚ é€‰æ‹©è¯»ä¸»ï¼Œå†™æ“ä½œæ—¶æ ¹æ®åº“+è¡¨+ä¸šåŠ¡ç‰¹å¾ç”Ÿæˆä¸€ä¸ªkeyæ”¾åˆ°Cacheé‡Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå¤§äºŽç­‰äºŽä¸»ä»Žæ•°æ®åŒæ­¥æ—¶é—´ï¼‰ã€‚è¯»è¯·æ±‚æ—¶ï¼ŒåŒæ ·çš„æ–¹å¼ç”Ÿæˆkeyå…ˆåŽ»æŸ¥Cacheï¼Œå†åˆ¤æ–­æ˜¯å¦å‘½ä¸­ã€‚è‹¥å‘½ä¸­ï¼Œåˆ™è¯»ä¸»åº“ï¼Œå¦åˆ™è¯»ä»Žåº“ã€‚ä»£ä»·æ˜¯å¤šäº†ä¸€æ¬¡ç¼“å­˜è¯»å†™ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ã€‚ åŠåŒæ­¥å¤åˆ¶ï¼Œç­‰ä¸»ä»ŽåŒæ­¥å®Œæˆï¼Œå†™è¯·æ±‚æ‰è¿”å›žã€‚å°±æ˜¯å¤§å®¶å¸¸è¯´çš„â€œåŠåŒæ­¥å¤åˆ¶â€semi-syncã€‚è¿™å¯ä»¥åˆ©ç”¨æ•°æ®åº“åŽŸç”ŸåŠŸèƒ½ï¼Œå®žçŽ°æ¯”è¾ƒç®€å•ã€‚ä»£ä»·æ˜¯å†™è¯·æ±‚æ—¶å»¶å¢žé•¿ï¼Œåžåé‡é™ä½Žã€‚ æ•°æ®åº“ä¸­é—´ä»¶ï¼Œå¼•å…¥å¼€æºï¼ˆmycatç­‰ï¼‰æˆ–è‡ªç ”çš„æ•°æ®åº“ä¸­é—´å±‚ã€‚æ€è·¯åŒé€‰æ‹©è¯»ä¸»ã€‚æ•°æ®åº“ä¸­é—´ä»¶çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”è¿˜å¤šå¼•å…¥äº†ä¸€å±‚ã€‚ DBå’Œç¼“å­˜ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ å…ˆæ¥çœ‹ä¸€ä¸‹å¸¸ç”¨çš„ç¼“å­˜ä½¿ç”¨æ–¹å¼ï¼š ç¬¬ä¸€æ­¥ï¼šæ·˜æ±°ç¼“å­˜ï¼› ç¬¬äºŒæ­¥ï¼šå†™å…¥æ•°æ®åº“ï¼› ç¬¬ä¸‰æ­¥ï¼šè¯»å–ç¼“å­˜ï¼Ÿè¿”å›žï¼šè¯»å–æ•°æ®åº“ï¼› ç¬¬å››æ­¥ï¼šè¯»å–æ•°æ®åº“åŽå†™å…¥ç¼“å­˜ã€‚ æ³¨ï¼šå¦‚æžœæŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œå›¾ä¸€ï¼Œä¸ä¼šäº§ç”ŸDBå’Œç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ï¼›å›¾äºŒï¼Œä¼šäº§ç”ŸDBå’Œç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ï¼Œå³r2.readå…ˆäºŽw3.syncæ‰§è¡Œã€‚å¦‚æžœä¸åšå¤„ç†ï¼Œç¼“å­˜é‡Œçš„æ•°æ®å¯èƒ½ä¸€ç›´æ˜¯è„æ•°æ®ã€‚è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š &lt;font color=&quot;red&quot;&gt;æ³¨ï¼šè®¾ç½®ç¼“å­˜æ—¶ï¼Œä¸€å®šè¦åŠ ä¸Šå¤±æ•ˆæ—¶é—´ï¼Œä»¥é˜²å»¶æ—¶æ·˜æ±°ç¼“å­˜å¤±è´¥çš„æƒ…å†µï¼&lt;/font&gt; MySQLå¤åˆ¶ MySQLä¸»ä»Žå¤åˆ¶ ç›®çš„ å®žçŽ°æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œå†™æ“ä½œè®¿é—®ä¸»æ•°æ®åº“ï¼Œè¯»æ“ä½œè®¿é—®ä»Žæ•°æ®åº“ï¼Œä»Žè€Œä½¿æ•°æ®åº“å…·æœ‰æ›´å¼ºå¤§çš„è®¿é—®è´Ÿè½½èƒ½åŠ›ï¼Œæ”¯æ’‘æ›´å¤šçš„ç”¨æˆ·è®¿é—®ã€‚ åŽŸç† å½“åº”ç”¨ç¨‹åºå®¢æˆ·ç«¯å‘é€ä¸€æ¡æ›´æ–°å‘½ä»¤åˆ°æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šæŠŠè¿™æ¡æ›´æ–°å‘½ä»¤åŒæ­¥è®°å½•åˆ°Binlogä¸­ï¼Œç„¶åŽç”±å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä»ŽBinlogä¸­è¯»å–è¿™æ¡æ—¥å¿—ï¼Œç„¶åŽé€šè¿‡è¿œç¨‹é€šè®¯çš„æ–¹å¼å°†å®ƒå¤åˆ¶åˆ°ä»ŽæœåŠ¡å™¨ä¸Šé¢åŽ»ï¼Œä»ŽæœåŠ¡å™¨èŽ·å¾—è¿™æ¡æ›´æ–°æ—¥å¿—åŽï¼Œå°†å…¶åŠ å…¥åˆ°è‡ªå·±çš„Relay logä¸­ï¼Œç„¶åŽç”±å¦å¤–ä¸€ä¸ªSQLæ‰§è¡Œçº¿ç¨‹ä»ŽRelay logä¸­è¯»å–è¿™æ¡æ–°çš„æ—¥å¿—ï¼Œå¹¶æŠŠå®ƒåœ¨æœ¬åœ°çš„æ•°æ®åº“ä¸­é‡æ–°æ‰§è¡Œä¸€éã€‚ è¿™æ ·å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªupdateå‘½ä»¤çš„æ—¶å€™ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä¸»æ•°æ®åº“å’Œä»Žæ•°æ®åº“ä¸ŠåŒæ­¥æ‰§è¡Œï¼Œä»Žè€Œå®žçŽ°äº†ä¸»æ•°æ®åº“å‘ä»Žæ•°æ®åº“çš„å¤åˆ¶ï¼Œè®©ä»Žæ•°æ®åº“å’Œä¸»æ•°æ®åº“ä¿æŒä¸€æ ·çš„æ•°æ®ã€‚ MySQLä¸€ä¸»å¤šä»Žå¤åˆ¶ ç›®çš„ MySQLçš„ä¸»ä»Žå¤åˆ¶æ˜¯ä¸€ç§æ•°æ®åŒæ­¥æœºåˆ¶ï¼Œé™¤äº†å¯ä»¥å°†ä¸€ä¸ªä¸»æ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥å¤åˆ¶åˆ°ä¸€ä¸ªä»Žæ•°æ®åº“ä¸Šï¼Œè¿˜å¯ä»¥å°†ä¸€ä¸ªä¸»æ•°æ®åº“ä¸Šçš„æ•°æ®åŒæ­¥å¤åˆ¶åˆ°å¤šä¸ªä»Žæ•°æ®åº“ä¸Šï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„MySQLçš„ä¸€ä¸»å¤šä»Žå¤åˆ¶ã€‚ åŽŸç† å¤šä¸ªä»Žæ•°æ®åº“å…³è”åˆ°ä¸»æ•°æ®åº“åŽï¼Œå°†ä¸»æ•°æ®åº“ä¸Šçš„Binlogæ—¥å¿—åŒæ­¥åœ°å¤åˆ¶åˆ°äº†å¤šä¸ªä»Žæ•°æ®åº“ä¸Šã€‚é€šè¿‡æ‰§è¡Œæ—¥å¿—ï¼Œè®©æ¯ä¸ªä»Žæ•°æ®åº“çš„æ•°æ®éƒ½å’Œä¸»æ•°æ®åº“ä¸Šçš„æ•°æ®ä¿æŒäº†ä¸€è‡´ã€‚è¿™é‡Œé¢çš„æ•°æ®æ›´æ–°æ“ä½œè¡¨ç¤ºçš„æ˜¯æ‰€æœ‰æ•°æ®åº“çš„æ›´æ–°æ“ä½œï¼Œé™¤äº†ä¸åŒ…æ‹¬SELECTä¹‹ç±»çš„æŸ¥è¯¢è¯»æ“ä½œï¼Œå…¶ä»–çš„INSERTã€DELETEã€UPDATEè¿™æ ·çš„DMLå†™æ“ä½œï¼Œä»¥åŠCREATE TABLEã€DROPT ABLEã€ALTER TABLEç­‰DDLæ“ä½œä¹Ÿéƒ½å¯ä»¥åŒæ­¥å¤åˆ¶åˆ°ä»Žæ•°æ®åº“ä¸ŠåŽ»ã€‚ ä¼˜ç‚¹ ä¸€ä¸»å¤šä»Žå¤åˆ¶æœ‰å››å¤§ä¼˜ç‚¹ï¼Œåˆ†åˆ«æ˜¯åˆ†æ‘Šè´Ÿè½½ã€ä¸“æœºä¸“ç”¨ã€ä¾¿äºŽå†·å¤‡å’Œé«˜å¯ç”¨ã€‚ åˆ†æ‘Šè´Ÿè½½ï¼šå°†åªè¯»æ“ä½œåˆ†å¸ƒåœ¨å¤šä¸ªä»Žæ•°æ®åº“ä¸Šï¼Œä»Žè€Œå°†è´Ÿè½½åˆ†æ‘Šåˆ°å¤šå°æœåŠ¡å™¨ä¸Šã€‚ ä¸“æœºä¸“ç”¨ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒç±»åž‹çš„æŸ¥è¯¢ï¼Œä½¿ç”¨ä¸åŒçš„ä»ŽæœåŠ¡å™¨ã€‚ ä¾¿äºŽå†·å¤‡ï¼šå³ä½¿æ•°æ®åº“è¿›è¡Œäº†ä¸€ä¸»å¤šä»Žçš„å¤åˆ¶ï¼Œåœ¨ä¸€äº›æžç«¯çš„æƒ…å†µä¸‹ã€‚ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®ä¸­å¿ƒçš„æ•°æ®éƒ½ä¸¢å¤±ã€‚æ‰€ä»¥é€šå¸¸éœ€è¦å¯¹æ•°æ®åšå†·å¤‡ï¼Œä½†å†·å¤‡æœ‰ä¸€ä¸ªå›°éš¾ç‚¹åœ¨äºŽï¼Œæ•°æ®åº“å¦‚æžœæ­£åœ¨è¿›è¡Œå†™æ“ä½œï¼Œå†·å¤‡çš„æ•°æ®å°±å¯èƒ½ä¸å®Œæ•´ï¼Œæ•°æ®æ–‡ä»¶å¯èƒ½å¤„äºŽæŸåçŠ¶æ€ã€‚ä½¿ç”¨ä¸€ä¸»å¤šä»Žçš„å¤åˆ¶å°±å°±å¯ä»¥å®žçŽ°é›¶åœæœºçš„å¤‡ä»½ã€‚åªéœ€è¦å…³é—­æ•°æ®åº“çš„æ•°æ®å¤åˆ¶è¿›ç¨‹ï¼Œæ–‡ä»¶å°±å¤„äºŽå…³é—­çŠ¶æ€äº†ï¼Œç„¶åŽè¿›è¡Œæ•°æ®æ–‡ä»¶æ‹·è´ï¼Œæ‹·è´å®ŒæˆåŽå†é‡æ–°æ‰“å¼€æ•°æ®å¤åˆ¶å°±å¯ä»¥äº†ã€‚ é«˜å¯ç”¨ï¼šå¦‚æžœä¸€å°æœåŠ¡å™¨å®•æœºäº†ï¼Œåªè¦ä¸å‘è¯·æ±‚ç»™è¿™å°æœåŠ¡å™¨å°±ä¸ä¼šå‡ºé—®é¢˜ã€‚å½“è¿™å°æœåŠ¡å™¨æ¢å¤çš„æ—¶å€™ï¼Œé‡æ–°å‘è¯·æ±‚åˆ°è¿™å°æœåŠ¡å™¨ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸»å¤šä»Žçš„æƒ…å†µä¸‹ï¼ŒæŸä¸€å°ä»ŽæœåŠ¡å™¨å®•æœºä¸å¯ç”¨ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“æ˜¯éžå¸¸å°çš„ã€‚ MySQLä¸»ä¸»å¤åˆ¶ ç›®çš„ ä¸€ä¸»å¤šä»Žåªèƒ½å¤Ÿå®žçŽ°ä»ŽæœåŠ¡å™¨ä¸Šçš„è¿™äº›ä¼˜ç‚¹ï¼Œå½“ä¸»æ•°æ®åº“å®•æœºä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ•°æ®ä¾ç„¶æ˜¯ä¸èƒ½å¤Ÿå†™å…¥çš„ï¼Œå› ä¸ºæ•°æ®ä¸èƒ½å¤Ÿå†™å…¥åˆ°ä»ŽæœåŠ¡å™¨ä¸Šé¢åŽ»ï¼Œä»ŽæœåŠ¡å™¨æ˜¯åªè¯»çš„ã€‚ä¸ºäº†è§£å†³ä¸»æœåŠ¡å™¨çš„å¯ç”¨æ€§é—®é¢˜ï¼Œé‡‡ç”¨MySQLçš„ä¸»ä¸»å¤åˆ¶æ–¹æ¡ˆã€‚ åŽŸç† å½“å®¢æˆ·ç«¯ç¨‹åºå¯¹ä¸»æœåŠ¡å™¨Aè¿›è¡Œæ•°æ®æ›´æ–°æ“ä½œçš„æ—¶å€™ï¼Œä¸»æœåŠ¡å™¨Aä¼šæŠŠæ›´æ–°æ“ä½œå†™å…¥åˆ°Binlogæ—¥å¿—ä¸­ã€‚ç„¶åŽBinlogä¼šå°†æ•°æ®æ—¥å¿—åŒæ­¥åˆ°ä¸»æœåŠ¡å™¨Bï¼Œå†™å…¥åˆ°ä¸»æœåŠ¡å™¨çš„Relay logä¸­ï¼Œç„¶åŽæ‰§Relay logï¼ŒèŽ·å¾—Relay logä¸­çš„æ›´æ–°æ—¥å¿—ï¼Œæ‰§è¡ŒSQLæ“ä½œå†™å…¥åˆ°æ•°æ®åº“æœåŠ¡å™¨Bçš„æœ¬åœ°æ•°æ®åº“ä¸­ã€‚BæœåŠ¡å™¨ä¸Šçš„æ›´æ–°ä¹ŸåŒæ ·é€šè¿‡Binlogå¤åˆ¶åˆ°äº†æœåŠ¡å™¨Açš„Relay logä¸­ï¼Œç„¶åŽé€šè¿‡Relay logå°†æ•°æ®æ›´æ–°åˆ°æœåŠ¡å™¨Aä¸­ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡å™¨Aæˆ–è€…Bä»»ä½•ä¸€å°æœåŠ¡å™¨æ”¶åˆ°äº†æ•°æ®çš„å†™çš„æ“ä½œéƒ½ä¼šåŒæ­¥æ›´æ–°åˆ°å¦ä¸€å°æœåŠ¡å™¨ï¼Œå®žçŽ°äº†æ•°æ®åº“ä¸»ä¸»å¤åˆ¶ã€‚ä¸»ä¸»å¤åˆ¶å¯ä»¥æé«˜ç³»ç»Ÿçš„å†™å¯ç”¨ï¼Œå®žçŽ°å†™æ“ä½œçš„é«˜å¯ç”¨ã€‚ MySQLä¸»ä¸»å¤åˆ¶å¤±æ•ˆæ¢å¤ æ­£å¸¸æƒ…å†µä¸‹ç”¨æˆ·ä¼šå†™å…¥åˆ°ä¸»æœåŠ¡å™¨Aä¸­ï¼Œç„¶åŽæ•°æ®ä»ŽAå¤åˆ¶åˆ°ä¸»æœåŠ¡å™¨Bä¸Šã€‚å½“ä¸»æœåŠ¡å™¨Aå¤±æ•ˆçš„æ—¶å€™ï¼Œå†™æ“ä½œä¼šè¢«å‘é€åˆ°ä¸»æœåŠ¡å™¨Bä¸­åŽ»ï¼Œæ•°æ®ä»ŽBæœåŠ¡å™¨å¤åˆ¶åˆ°AæœåŠ¡å™¨ã€‚ ä¸»ä¸»å¤±æ•ˆç»´æŠ¤è¿‡ç¨‹ï¼š æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä¸»æœåŠ¡å™¨éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œå½“ä¸»æœåŠ¡å™¨Aå¤±æ•ˆçš„æ—¶å€™ï¼Œè¿›å…¥æ•…éšœçŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨Aå¤±æ•ˆï¼Œæ£€æµ‹åˆ°è¿™ä¸ªå¤±æ•ˆå¯èƒ½éœ€è¦å‡ ç§’é’Ÿæˆ–è€…å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œç„¶åŽåº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œå¤±æ•ˆè½¬ç§»ï¼Œå°†å†™æ“ä½œå‘é€åˆ°å¤‡ä»½ä¸»æœåŠ¡å™¨Bä¸Šé¢åŽ»ï¼Œå°†è¯»æ“ä½œå‘é€åˆ°BæœåŠ¡å™¨å¯¹åº”çš„ä»ŽæœåŠ¡å™¨ä¸Šé¢åŽ»ã€‚ ä¸€æ®µæ—¶é—´åŽæ•…éšœç»“æŸï¼ŒAæœåŠ¡å™¨éœ€è¦é‡å»ºå¤±æ•ˆæœŸé—´ä¸¢å¤±çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æŠŠè‡ªå·±å½“ä½œä»ŽæœåŠ¡å™¨ä»ŽBæœåŠ¡å™¨ä¸Šé¢åŽ»åŒæ­¥æ•°æ®ã€‚åŒæ­¥å®ŒæˆåŽç³»ç»Ÿæ‰èƒ½æ¢å¤æ­£å¸¸ã€‚è¿™ä¸ªæ—¶å€™BæœåŠ¡å™¨æ˜¯ç”¨æˆ·çš„ä¸»è¦è®¿é—®æœåŠ¡å™¨ï¼ŒAæœåŠ¡å™¨å½“ä½œå¤‡ä»½æœåŠ¡å™¨ã€‚ MySQLå¤åˆ¶æ³¨æ„äº‹é¡¹ ä¸è¦å¯¹ä¸¤ä¸ªæ•°æ®åº“åŒæ—¶è¿›è¡Œæ•°æ®å†™æ“ä½œï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¼šå¯¼è‡´æ•°æ®å†²çªã€‚ å¤åˆ¶åªæ˜¯å¢žåŠ äº†æ•°æ®çš„è¯»å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œå¹¶æ²¡æœ‰å¢žåŠ å†™å¹¶å‘çš„èƒ½åŠ›å’Œç³»ç»Ÿå­˜å‚¨èƒ½åŠ›ã€‚ æ›´æ–°æ•°æ®è¡¨çš„ç»“æž„ä¼šå¯¼è‡´å·¨å¤§çš„åŒæ­¥å»¶è¿Ÿã€‚ éœ€è¦æ›´æ–°è¡¨ç»“æž„çš„æ“ä½œï¼Œä¸è¦å†™å…¥åˆ°åˆ°Binlogä¸­ï¼Œè¦å…³é—­æ›´æ–°è¡¨ç»“æž„çš„Binlogã€‚å¦‚æžœè¦å¯¹è¡¨ç»“æž„è¿›è¡Œæ›´æ–°ï¼Œåº”è¯¥ç”±è¿ç»´å·¥ç¨‹å¸ˆDBAå¯¹æ‰€æœ‰ä¸»ä»Žæ•°æ®åº“åˆ†åˆ«æ‰‹å·¥è¿›è¡Œæ•°æ®è¡¨ç»“æž„çš„æ›´æ–°æ“ä½œã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ­å»ºGitHubåšå®¢(æŒç»­æ›´æ–°)]]></title>
    <url>%2Fposts%2Fd5766023.html</url>
    <content type="text"><![CDATA[å…¥é—¨Hexo ç”±äºŽå¹³æ—¶è‡ªå·±å–œæ¬¢çœ‹ä¸€äº›æŠ€æœ¯ç±»æ–‡ç« æ•´ç†æˆWordç¬”è®°ï¼Œæ€»æ„Ÿè§‰è¿™ç§æ–¹å¼å¤ªlowï¼Œæƒ³è‡ªå·±æ­å»ºå±žäºŽè‡ªå·±çš„åšå®¢ï¼Œåœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ä¸€ä¸‹ï¼Œå‘çŽ°Hexoåœ¨GitHubæˆ–è€…æ˜¯ç äº‘ä¸Šæ­å»ºåšå®¢éžå¸¸ç»™åŠ›ã€‚ ç„¶åŽè‡ªå·±ä¹Ÿæ­å»ºäº†åšå®¢ï¼Œè¿™ç¯‡æ–‡ç« å°±è®°å½•äº†æ­å»ºçš„è¿‡ç¨‹åŠä¸€äº›ä¼˜åŒ–ã€‚ ä»€ä¹ˆæ˜¯Hexo Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æž¶ã€‚Hexo ä½¿ç”¨ Markdown ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“Žï¼‰è§£æžæ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚å¤§å®¶è¿›å…¥ Hexoå®˜ç½‘ è¿›è¡ŒæŸ¥çœ‹ã€‚ å®‰è£…Hexo å®‰è£… Hexo ç›¸å½“ç®€å•ã€‚ç„¶è€Œåœ¨å®‰è£…å‰ï¼Œæ‚¨å¿…é¡»æ£€æŸ¥ç”µè„‘ä¸­æ˜¯å¦å·²å®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºï¼š Node.js Git cnpm å¦‚æžœnpmè¿è¡Œå‡ºé”™å°±å®‰è£…cnpmå›½å†…é•œåƒ æ‰€æœ‰å¿…å¤‡çš„åº”ç”¨ç¨‹åºå®‰è£…å®ŒæˆåŽï¼Œå³å¯ä½¿ç”¨ npmæˆ–è€…cnpm å®‰è£… Hexoã€‚ æ‰“å¼€Git Bash hereï¼Œè¾“å…¥ï¼š 123$ npm install -g hexo-cli æˆ–è€… $ cnpm install -g hexo-cli æ£€æŸ¥æ˜¯å¦å®‰è£…Hexoå®Œæˆ,æŸ¥è¯¢æ˜¯å¦æˆåŠŸï¼Œæ˜¾ç¤ºhexo-cli ç‰ˆæœ¬å°±è¯´æ˜ŽæˆåŠŸäº† 1$ hexo -V å»ºç«™ å®‰è£…ä¸€åˆ‡æ‰€éœ€çš„ç¨‹åºåŽï¼Œå°±å¯ä»¥å¼€å§‹å»ºç«™äº†ï¼Œå°±æ˜¯åˆ›å»ºæˆ‘ä»¬çš„åšå®¢,å¤§å®¶ä¹Ÿå¯ä»¥è¿›å…¥ å»ºç«™å®˜ç½‘ æŸ¥çœ‹ã€‚ æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¥ç®¡ç†æˆ‘ä»¬çš„åšå®¢é¡¹ç›®ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ–°å»ºæ‰€éœ€è¦çš„æ–‡ä»¶ã€‚ è¿è¡Œå‘½ä»¤ 123$ hexo init &lt;folder&gt;$ cd &lt;folder&gt;$ cnpm install æ³¨ï¼š&lt;folder&gt;æ˜¯è¡¨ç¤ºå»ºç«™çš„åšå®¢é¡¹ç›®å æ‰“å¼€Git Bash hereï¼Œè¾“å…¥ï¼š 1$ hexo init githubBlog è¿›å…¥åˆ›å»ºçš„åšå®¢é¡¹ç›®ä¸‹ï¼Œå®‰è£… 12$ cd githubBlog$ cnpm install å®‰è£…ä¹‹åŽï¼Œæ•´ä¸ªåšå®¢é¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š è®¿é—®URL 123$ hexo server æˆ–è€…$ hexo s è®¿é—®URLï¼šhttp://localhost:4000ï¼Œæ•ˆæžœå¦‚ä¸‹å›¾ï¼š åˆ°è¿™é‡Œå·²ç»é€šè¿‡Hexoåˆæ­¥åˆ›å»ºåšå®¢äº†ï¼Œä¸‹é¢å†æ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å°†æˆ‘ä»¬çš„åšå®¢æ‰˜ç®¡åˆ°GitHubæœåŠ¡å™¨ä¸Šã€‚ æ‰˜ç®¡åˆ°GitHub GitHubåˆ›å»ºrepositories è¿›å…¥GitHubå®˜ç½‘ä¸­æµè§ˆå™¨è¾“å…¥ https://github.com/ ,å¦‚æžœè¿˜æ²¡æœ‰è´¦å·å°±åˆ›å»ºä¸€ä¸ªè´¦å·å°±å¥½äº†ã€‚ç™»å½•è‡ªå·±çš„è´¦å·ã€‚ç›´æŽ¥new repositories æˆ–è€…è¿›å…¥You repositories åœ¨new repositoriesã€‚ è¿›å…¥åˆ°åˆ›å»º repositories é¡µé¢åŽ,ä¸€å®šè¦æ³¨æ„ï¼Œå°†æ–°å»ºçš„repositoryçš„åå­—ä¸º: You account name.github.ioã€‚å…¶ä»–é»˜è®¤å°±å¥½äº†ã€‚ é…ç½® GitHubçš„Repositoryåˆ›å»ºå¥½åŽï¼Œåœ¨å›žåˆ°æœ¬åœ°çš„Hexoçš„githubBlogé¡¹ç›®ä¸­ï¼Œæ‰¾åˆ°åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹_config.ymlæ‰¾åˆ° deployæ ‡ç­¾ åœ¨è¯¥æ–‡ä»¶ä¸‹é¢æ·»åŠ  æ³¨ï¼šrepository: https://github.com/whb1990/whb1990.github.io æ˜¯è‡ªå·±åˆšåˆšåˆ›å»ºYou account name.github.io çš„repositoryï¼Œåœ¨Clone with HTTPSé‡Œé¢ï¼Œå¤åˆ¶ç²˜è´´å°±å¥½äº†ï¼Œå†’å·åŽé¢è®°å¾—ç©ºæ ¼ã€‚branch åŽé¢æ˜¯masterå°±å¥½äº†ã€‚ 1234deploy: #éƒ¨ç½² type: git repository: https://github.com/whb1990/whb1990.github.io.git branch: master åœ¨_config.ymlæ‰¾åˆ°urlè¿›è¡Œä¿®æ”¹ä¸ºï¼š 1url: http://whb1990.github.io #åšå®¢ç½‘å€ éƒ¨ç½² åˆ°è¿™é‡Œå°±å·®ä¸åˆ°äº†ï¼ŒæŽ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œå°†åšå®¢éƒ¨ç½²åˆ°GitHubä¸ŠåŽ»ã€‚ æ‰“å¼€Git Bash Hereè¿›å…¥githubBlog æ ¹ç›®å½•ä¸‹ï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸‹ hexo-deployer-git ä¸ç„¶å¯èƒ½å‡ºçŽ°é”™è¯¯æ— æ³•éƒ¨ç½²æˆåŠŸã€‚ 1$ cnpm install hexo-deployer-git --save ç„¶åŽåœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 123$ hexo clean$ hexo generate$ hexo deploy æˆ–è€…ç®€å†™ 123$ hexo clean$ hexo g$ hexo d éƒ¨ç½²æˆåŠŸå¦‚ä¸‹æ˜¾ç¤º: æµ‹è¯• æˆ‘ä»¬è¿›è¡Œè®¿é—® https://whb1990.github.io/ å’Œ http://localhost:4000/ ä¸€æ ·çš„é¡µé¢è¯´æ˜Žæ˜¯å·²ç»æˆåŠŸã€‚ ç«™ç‚¹æ–‡ä»¶é…ç½® åœ¨æ ¹githubBlogç›®å½•ä¸‹_config.ymlæ–‡ä»¶ï¼Œæˆ‘ä»¬æš‚ä¸”ç§°ä¸ºç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸ŽåŽé¢è®²åˆ°çš„ä¸»é¢˜é…ç½®æ–‡ä»¶(Nextä¸»é¢˜ä¸‹çš„_config.ymlæ–‡ä»¶)è¿›è¡ŒåŒºåˆ†ã€‚ ç½‘ç«™ å‚æ•° æè¿° title ç½‘ç«™æ ‡é¢˜ subtitle ç½‘ç«™å‰¯æ ‡é¢˜ description ç½‘ç«™æè¿° author æ‚¨çš„åå­— language ç½‘ç«™ä½¿ç”¨çš„è¯­è¨€ timezone ç½‘ç«™æ—¶åŒºã€‚Hexo é»˜è®¤ä½¿ç”¨æ‚¨ç”µè„‘çš„æ—¶åŒºã€‚æ—¶åŒºåˆ—è¡¨ã€‚æ¯”å¦‚è¯´ï¼šAmerica/New_York, Japan, å’Œ UTC ã€‚ ç›®å½• å‚æ•° æè¿° source_dir èµ„æºæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾å†…å®¹ã€‚ public_dir å…¬å…±æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨äºŽå­˜æ”¾ç”Ÿæˆçš„ç«™ç‚¹æ–‡ä»¶ã€‚ tag_dir æ ‡ç­¾æ–‡ä»¶å¤¹ archive_dir å½’æ¡£æ–‡ä»¶å¤¹ category_dir åˆ†ç±»æ–‡ä»¶å¤¹ code_dir Include code æ–‡ä»¶å¤¹ i18n_dir å›½é™…åŒ–ï¼ˆi18nï¼‰æ–‡ä»¶å¤¹ skip_render è·³è¿‡æŒ‡å®šæ–‡ä»¶çš„æ¸²æŸ“ï¼Œæ‚¨å¯ä½¿ç”¨ glob æ¥é…ç½®è·¯å¾„ æ–‡ç«  å‚æ•° æè¿° é»˜è®¤å€¼ new_post_name æ–°æ–‡ç« çš„æ–‡ä»¶åç§° :title.md default_layout é¢„è®¾å¸ƒå±€ post auto_spacing åœ¨ä¸­æ–‡å’Œè‹±æ–‡ä¹‹é—´åŠ å…¥ç©ºæ ¼ false titlecase æŠŠæ ‡é¢˜è½¬æ¢ä¸º title case false external_link åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€é“¾æŽ¥ true filename_case æŠŠæ–‡ä»¶åç§°è½¬æ¢ä¸º (1) å°å†™æˆ– (2) å¤§å†™ 0 render_drafts æ˜¾ç¤ºè‰ç¨¿ false post_asset_folder å¯åŠ¨ Asset æ–‡ä»¶å¤¹ false relative_link æŠŠé“¾æŽ¥æ”¹ä¸ºä¸Žæ ¹ç›®å½•çš„ç›¸å¯¹ä½å€ false future æ˜¾ç¤ºæœªæ¥çš„æ–‡ç«  true highlight ä»£ç å—çš„è®¾ç½® åˆ†ç±»&amp;æ ‡ç­¾ å‚æ•° æè¿° é»˜è®¤å€¼ default_category é»˜è®¤åˆ†ç±» uncategorized category_map åˆ†ç±»åˆ«å tag_map æ ‡ç­¾åˆ«å åˆ†é¡µ å‚æ•° æè¿° é»˜è®¤å€¼ per_page æ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« é‡ (0 = å…³é—­åˆ†é¡µåŠŸèƒ½) 10 pagination_dir åˆ†é¡µç›®å½• page å†™ä½œ åˆ›å»ºæ–‡ç«  1$ hexo new [layout] &lt;title&gt; å¦‚ï¼šåˆ›å»ºhello-world 1$ hexo new hello-world å¦‚æžœä¸æ·»åŠ titleï¼Œé»˜è®¤å°±æ˜¯æ ‡é¢˜title: hello-worldã€‚ è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æžœåˆ›å»ºå¸¦æœ‰ä¸­æ–‡çš„è·¯å¾„åç§°æ—¶ï¼Œç”Ÿæˆé™æ€é¡µé¢hexo gå¯èƒ½ä¼šæŠ¥é”™ã€‚ 12warning: LF will be replaced by CRLF in xxxxThe file will have its original line endings in your working directory. è¿™æ˜¯ç”±äºŽåŽŸå› æ˜¯è·¯å¾„ä¸­å­˜åœ¨ / çš„ç¬¦å·è½¬ä¹‰é—®é¢˜ å¦‚ï¼šåˆ›å»ºæ–‡ç« æ—¶å‘½åä¸ºä¸­æ–‡ï¼Œä¸€èˆ¬éƒ½å‡ºçŽ°è¿™ä¸ªå°é—®é¢˜ã€‚ è§£å†³ åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥: 1$ git config --global core.autocrlf false ç„¶åŽé‡æ–°ç”Ÿæˆæ–‡ä»¶éƒ¨ç½²å°±å¥½äº†ã€‚ ç¼–è¾‘æ–‡ç«  åˆ›å»ºçš„æ–‡ç« åœ¨source/_postsç›®å½•ä¸‹ï¼Œæ‰“å¼€æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå®Œå…¨æ”¯æŒMarkdownè¯­æ³•ã€‚ Nextä¸»é¢˜ åœ¨ Hexoä¸»é¢˜å®˜ç½‘ ä¸­æœ‰è®¸å¤šä¸»é¢˜ï¼Œå¤§å®¶å–œæ¬¢ä»€ä¹ˆå°±è¿›è¡Œéƒ¨ç½²å’Œç¼–è¾‘å°±å¥½äº†ï¼Œå¤§è‡´çš„æ€è·¯éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚ æˆ‘é€‰æ‹©çš„ Nextä¸»é¢˜ ï¼Œç½‘ä¸Šå¾ˆå¤šä¹Ÿæ˜¯ç”¨çš„è¿™ä¸ªä¸»é¢˜ã€‚ å®‰è£… åœ¨githubBlogæ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1$ git clone https://github.com/theme-next/hexo-theme-next themes/next ä¸Šé¢çš„å‘½ä»¤æ˜¯cloneæœ€æ–°ç‰ˆæœ¬çš„ä¸»é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤cloneæŒ‡å®šç‰ˆæœ¬çš„ä¸»é¢˜ 1$ git clone --branch v7.1.1 https://github.com/theme-next/hexo-theme-next themes/next å®‰è£…å®Œæˆä¹‹åŽï¼Œåœ¨themesä¸‹å°±ä¼šæœ‰nextç›®å½• åˆ‡æ¢ä¸»é¢˜ åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€_config.ymlæ–‡ä»¶å°†themeè®¾ç½®ä¸ºnextå³å¯ï¼š éƒ¨ç½²ä¹‹åŽæŸ¥çœ‹æ•ˆæžœå¦‚ä¸‹ï¼Œæœ‰ç‚¹ä¸‘ï¼š ä¸»é¢˜é…ç½® ä¸€èˆ¬é…ç½®éƒ½åœ¨theme/next/-config.ymlæ–‡ä»¶ä¸‹é…ç½®ã€‚ ä¿®æ”¹æ•´ä½“å¸ƒå±€ åœ¨theme/next/-config.ymlæ‰¾åˆ°menuçœ‹çœ‹è‡ªå·±åšå®¢æ‰€éœ€çš„åˆ†ç±» 123456789menu: home: / || home #é¦–é¡µ about: /about/ || user #å…³äºŽ tags: /tags/ || tags #æ ‡ç­¾ categories: /categories/ || th #ç›®å½• archives: /archives/ || archive #å½’æ¡£ #schedule: /schedule/ || calendar #æ—¥ç¨‹ sitemap: /sitemap.xml || sitemap #ç«™ç‚¹åœ°å›¾ commonweal: /404/ || heartbeat #å…¬ç›Š404 åœ¨menu_settingså¦‚æžœè®¾ç½®icon: falseåˆ™æ— å›¾æ ‡ï¼Œbadges: trueåˆ™æ ‡ç­¾éƒ½ä¼šæ˜¾ç¤ºæ•°å­— 123menu_settings: icons: true badges: false &lt;font color=&quot;red&quot;&gt;æ³¨:&lt;/font&gt;è¿™é‡Œéœ€è¦åˆ›å»ºabouté¡µé¢ï¼Œå¾ˆç®€å•ï¼ŒåŒç†åˆ›å»ºæ ‡ç­¾tagsã€å½’æ¡£archivesé¡µé¢ä¸€æ ·çš„æ–¹å¼ï¼Œæ‰€éœ€è¦åˆ›å»ºçš„åç§°è¦ä¸Žmenuç›¸å¯¹åº”ï¼Œä¸¾ä¾‹è¯´æ˜Žå¦‚ä¸‹ã€‚ 12$ hexo new page about #çœ‹çœ‹menuä¸Šè¿˜æœ‰ä»€ä¹ˆæ ‡ç­¾æ²¡åˆ›å»ºå°±è¡Œåˆ›å»º$ hexo new page tags #åˆ›å»ºæ ‡ç­¾ç­‰ åˆ›å»ºå®Œæˆä¹‹åŽåœ¨è‡ªå·±é¡¹ç›®æŸ¥æ‰¾ï¼Œå¦‚æˆ‘çš„æ˜¯githubBlog/source/ç›®å½•ä¸‹æŸ¥çœ‹æ–°åˆ›å»ºå¥½çš„ç›¸å…³æ ‡ç­¾é¡µé¢ï¼Œé‡Œé¢åŒ…å«å„è‡ªçš„index.mdæ–‡ä»¶ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç¼–è¾‘äº†ã€‚ Schemesæ–¹æ¡ˆè®¾ç½® 12345# Schemes#scheme: Muse #è¿™æ˜¯ Nexé»˜è®¤ç‰ˆæœ¬ï¼Œé»‘ç™½ä¸»è°ƒï¼Œå¤§é‡ç•™ç™½ #scheme: Mist #Muse çš„ç´§å‡‘ç‰ˆæœ¬ï¼Œæ•´æ´æœ‰åºçš„å•æ å¤–è§‚#scheme: Pisces #åŒæ  Schemeï¼Œå°å®¶ç¢§çŽ‰ä¼¼çš„æ¸…æ–°scheme: Gemini #åŒå­åº§ï¼Œä¹Ÿæ˜¯åŒæ å½¢å¼ï¼Œå’ŒPiscesç±»ä¼¼ è‡ªå·±å–œæ¬¢ä»€ä¹ˆé£Žæ ¼è‡ªè¡Œé€‰æ‹©ã€‚ socialè®¾ç½® ä½¿ç”¨æ–¹å¼: Key: permalink || icon Keyè¡¨ç¤ºæ ‡ç­¾æ˜¾ç¤ºï¼Œpermalinkè¡¨ç¤ºURIè¿žæŽ¥ï¼Œiconè¡¨ç¤ºå›¾æ ‡ï¼Œè‡ªå·±æ·»åŠ æ‰€è¦æ˜¾ç¤ºçš„ï¼Œ 12345678910111213141516171819social: GitHub: https://github.com/whb1990 || github E-Mail: mailto:whbsurpass@163.com || envelope QQ: 270028806 || qq å¾®ä¿¡: yan521bo ||weixin #Weibo: https://weibo.com/yourname || weibo #Google: https://plus.google.com/yourname || google #Twitter: https://twitter.com/yourname || twitter #FB Page: https://www.facebook.com/yourname || facebook #VK Group: https://vk.com/yourname || vk #StackOverflow: https://stackoverflow.com/yourname || stack-overflow #YouTube: https://youtube.com/yourname || youtube #Instagram: https://instagram.com/yourname || instagram #Skype: skype:yourname?call|chat || skypesocial_icons: #è®¾ç½®å›¾æ ‡æ˜¯å¦æ˜¾ç¤ºè¿™é‡Œ enable: true #è¡¨ç¤ºå¼€å¯ icons_only: false #åªæ˜¾ç¤ºå›¾ç‰‡ transition: false &lt;font color=&quot;red&quot;&gt;æ³¨ï¼š&lt;/font&gt;å›¾æ ‡åº“æ¥æº [https://fontawesome.com/icons?from=io] ï¼Œåœ¨scheme: Piscesè¯¥æ•ˆæžœä¸æ˜¾ç¤ºã€‚ avatarå¤´åƒè®¾ç½® 12345678910111213avatar: # In theme directory (source/images): /images/avatar.gif # In site directory (source/uploads): /uploads/avatar.gif # You can also use other linking images. url: /images/avatar.jpg # If true, the avatar would be dispalyed in circle. #åœ†å½¢æ¡† rounded: true # The value of opacity should be choose from 0 to 1 to set the opacity of the avatar. opacity: 1 # If true, the avatar would be rotated with the cursor. #å¤´åƒæ˜¯å¦æ—‹è½¬ rotated: true tocè¾¹æ ä¸­çš„ç›®å½•è®¾ç½® 12345678910toc: #è¾¹æ è®¾ç½® enable: true #æ˜¯å¦å¯ç”¨è¾¹æ  # Automatically add list number to toc. number: true #è‡ªåŠ¨å°†åˆ—è¡¨ç¼–å·æ·»åŠ åˆ°toc # If true, all words will placed on next lines if header width longer then sidebar width. wrap: false #trueæ—¶æ˜¯å½“æ ‡é¢˜å®½åº¦å¾ˆé•¿æ—¶ï¼Œè‡ªåŠ¨æ¢åˆ°ä¸‹ä¸€è¡Œ # If true, all level of TOC in a post will be displayed, rather than the activated part of it. expand_all: false #æŠ˜å  # Maximum heading depth of generated toc. You can set it in one post through `toc_max_depth` in Front-matter. max_depth: 6 #æœ€å¤§æ·±åº¦ Creative Commons 4.0å›½é™…è®¸å¯è®¾ç½® 12# Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zerocreative_commons: by-nc-sa sidebarä¾§è¾¹æ é…ç½®è¿™é‡Œé€‰æ‹©é»˜è®¤å§ 1234567891011121314151617181920212223sidebar: # Sidebar Position, available values: left | right (only for Pisces | Gemini). position: left #position: right # Manual define the sidebar width. If commented, will be default for: # Muse | Mist: 320 # Pisces | Gemini: 240 width: 240 # Sidebar Display, available values (only for Muse | Mist): # - post expand on posts automatically. Default. # - always expand for all pages automatically. # - hide expand only when click on the sidebar toggle icon. # - remove totally remove sidebar including sidebar toggle. display: post # Sidebar offset from top menubar in pixels (only for Pisces | Gemini). offset: 12 # Enable sidebar on narrow view (only for Muse | Mist). onmobile: true # Click any blank part of the page to close sidebar (only for Muse | Mist). dimmer: false save_scrollé…ç½® 12# Automatically saving scroll position on each post / page in cookies.save_scroll: false #æ˜¯å¦åœ¨Cookieä¸­è‡ªåŠ¨ä¿å­˜æ¯ä¸ªå¸–å­/é¡µé¢ä¸Šçš„æ»šåŠ¨ä½ç½®ã€‚ excerpt_description 12# Automatically excerpt description in homepage as preamble text.excerpt_description: false #æ˜¯å¦è‡ªåŠ¨æ‘˜å½•ä¸»é¡µä¸­çš„æè¿°ä½œä¸ºå‰å¯¼æ–‡æœ¬ã€‚ auto_excerpté…ç½® 123auto_excerpt: enable: true #æ˜¯å¦è‡ªåŠ¨æ‘˜å½•ã€‚ä¸æŽ¨è length: 150 #è¿™é‡Œæ˜¯è¯´æ–‡ç« å¼€å¤´ç¬¬ä¸€ä¸ªå­—åˆ°ç¬¬150ä¸ªå­—å°±æ˜¾ç¤º"é˜…è¯»å…¨æ–‡" codeblockä»£ç å—é…ç½® 1234567891011121314codeblock: # Code Highlight theme # Available values: normal | night | night eighties | night blue | night bright # See: https://github.com/chriskempson/tomorrow-theme highlight_theme: normal #ä»£ç çªå‡ºæ˜¾ç¤ºä¸»é¢˜ # Manual define the border radius in codeblock, leave it blank for the default value: 1 border_radius: 1 # Add copy button on codeblock copy_button: enable: true # Show text copy result. show_result: true # Available values: default | flat | mac style: flat wechat_subscriberå¾®ä¿¡é…ç½® 1234wechat_subscriber: enabled: true #æ˜¯å¦å¯åŠ¨å¾®ä¿¡è®¢é˜… qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg description: ex. subscribe to my blog by scanning my public wechat account footer åº•éƒ¨è®¾ç½® 12345678910111213141516171819202122232425262728footer: # Specify the date when the site was setup. If not defined, current year will be used. since: 2019 #å»ºç«™å¼€å§‹æ—¶é—´ # Icon between year and copyright info. icon: # Icon name in Font Awesome. See: https://fontawesome.com/v4.7.0/icons/ # `heart` is recommended with animation in red (#ff0000). name: heart #è®¾ç½®å›¾æ ‡ï¼Œæƒ³ä¿®æ”¹å›¾æ ‡ä»Žhttps://fontawesome.com/v4.7.0/iconsèŽ·å– # If you want to animate the icon, set it to true. animated: true # Change the color of icon, using Hex Code. color: "#ff0000" # If not defined, `author` from Hexo `_config.yml` will be used. copyright: Â©2019 by çŽ‹æ´ªåš #ç‰ˆæƒ powered: # Hexo link (Powered by Hexo). enable: true ##æ˜¯å¦æ˜¾ç¤ºHexo link # Version info of Hexo after Hexo link (vX.X.X). version: true #æ˜¯å¦æ˜¾ç¤ºHexoç‰ˆæœ¬ theme: # Theme &amp; scheme info link (Theme - NexT.scheme). enable: true #æ˜¯å¦æ˜¾ç¤ºNexTä¸»é¢˜ # Version info of NexT after scheme info (vX.X.X). version: true #æ˜¯å¦æ˜¾ç¤ºNexTç‰ˆæœ¬ faviconæ ‡ç­¾é¡µå›¾æ ‡ 12345favicon: small: /images/favicon-16x16-next.png #å°å›¾æ ‡ é»˜è®¤çš„NexT medium: /images/favicon-32x32-next.png #ä¸­å›¾æ ‡ é»˜è®¤NexT apple_touch_icon: /images/apple-touch-icon-next.png #è‹¹æžœè§¦æ‘¸å›¾æ ‡ safari_pinned_tab: /images/logo.svg #safariå›ºå®šæ ‡ç­¾ Math Equations Render Support æ•°å­¦æ–¹ç¨‹å¼æ¸²æŸ“æ”¯æŒ 12345678math: enable: true #é»˜è®¤ä¸ºfalse per_page: true engine: mathjax #ä¸¤ç§æ–¹å¼ mathjax / katex mathjax: cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML #é»˜è®¤ è¿™é‡Œå¤§å®¶æ ¹æ®è‡ªå·±éœ€æ±‚ katex: cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css #é»˜è®¤ 16 .Han Support æ”¯æŒæ±‰å­— è®¾ç½®æ±‰å­—æ”¯æŒï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š æ‰“å¼€Git Bash Here,è¿›å…¥theme/nextç›®å½•ä¸‹ 1$ cd themes/next èŽ·å–è¯¥æ±‰å­—æ”¯æŒGit module,æ‰§è¡Œå‘½ä»¤ä»¥ä¸‹å‘½ä»¤èŽ·å¾— 1$ git clone https://github.com/theme-next/theme-next-han source/lib/Han è®¾ç½®æ±‰å­—æ”¯æŒ 1han: true æ›´æ–°update 12$ cd themes/next/source/lib/Han$ git pull fontå­—ä½“è®¾ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647font: # Use custom fonts families or not. # Depended options: `external` and `family`. enable: true #é»˜è®¤false å¦‚æžœè¦è¿›è¡Œå­—ä½“ä¿®æ”¹é‚£ä¹ˆè®¾ç½®ä¸ºtrue # Uri of fonts host, e.g. //fonts.googleapis.com (Default). host: //fonts.lug.ustc.edu.cn # Font options: # `external: true` will load this font family from `host` above. # `family: Times New Roman`. Without any quotes. # `size: x.x`. Use `em` as unit. Default: 1 (16px) # Global font settings used for all elements inside &lt;body&gt;. global: external: true family: Lato size: # Font settings for site title (.site-title). title: external: true family: size: # Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;). headings: external: true family: Roboto Slab size: # Font settings for posts (.post-body). posts: external: true family: # Font settings for &lt;code&gt; and code blocks. codes: external: true family: Roboto Mono # Font settings for Logo. # Fallback to `global` font settings. logo: external: true family: size: æ·»åŠ å›¾æ ‡é“¾æŽ¥åˆ°GitHub ä¸€èˆ¬åœ¨å³ä¸Šè§’æˆ–è€…å·¦ä¸Šè§’ï¼Œå¦‚é…ç½®å³ä¸Šè§’Fork_me_on_GitHub,æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œ æ‰“å¼€ Fork_me_on_GitHub é“¾æŽ¥ï¼Œé‡Œé¢æœ‰è®¸å¤šæ ·å¼ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ ·å¼ï¼Œå°†å…¶å¤åˆ¶ä¸‹æ¥ã€‚ æ‰“å¼€è‡ªå·±åšå®¢é¡¹ç›®ä¸­çš„themes/next/layout/_layout.swigæ–‡ä»¶ï¼Œæœç´¢&lt;div class=&quot;headband&quot;&gt;&lt;/div&gt; å°†å¤åˆ¶çš„å†…å®¹ç²˜è´´åˆ°&lt;div class=&quot;headband&quot;&gt;&lt;/div&gt;ä¸‹é¢ï¼Œå¦‚ä¸‹ï¼š é…ç½®å³ä¸Šè§’çš„Fork_me_on_GitHub: ä¿®æ”¹æ–‡ç« åº•éƒ¨æ ‡ç­¾ åœ¨åšå®¢é¡¹ç›®ä¸­æ‰¾åˆ°/themes/next/layout/_macro/post.swigï¼Œæœç´¢ rel=&quot;tag&quot;ï¼Œå°† #å· æ¢æˆ&lt;i class=&quot;fa fa-tag&quot;&gt;&lt;/i&gt; åŽŸå…ˆ#å·çš„æ ·å¼ ä¿®æ”¹ä¸ºå›¾æ ‡çš„æ ·å¼ è®¾ç½®èƒŒæ™¯åŠ¨ç”»æ ·å¼ NexTé‡Œé¢æœ‰å‡ ç§åŠ¨ç”»èƒŒæ™¯æ ·å¼canvas_nestã€three_wavesã€canvas_linesã€canvas_sphereç­‰ canvas_nestå¦‚ä¸‹å›¾æ‰€ç¤º: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆ æ‰“å¼€Git Bash Hereè¿›å…¥è‡ªå·±æ–‡ä»¶å¤¹ä¸‹/themes/nextæ–‡ä»¶å¤¹ä¸‹ 1$ cd /themes/next ä¸‹è½½å®‰è£… canvas_nest module æ‰§è¡Œ 1$ git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest åœ¨ /themes/next/source/libæŸ¥çœ‹ä¼šçœ‹åˆ°canvas_nestæ–‡ä»¶å¤¹ åœ¨/themes/next/_config.ymlè®¾ç½® 1canvas_nest: true three_waveså¦‚å›¾æ‰€ç¤º three_waves è®¾ç½®æ­¥éª¤ï¼Œå’Œ canvas_nest æ­¥éª¤æ˜¯ä¸€æ ·çš„ã€‚ ä¸‹è½½å®ŒæˆåŽï¼Œåœ¨/themes/next/_config.ymlè®¾ç½® 12345three_waves: true#ORcanvas_lines: true#ORcanvas_sphere: true canvas_ribbon canvas_ribbonåªé€‚åˆ scheme Pisces è¿™é‡Œä¸æµ‹è¯•äº†ï¼Œå¤§å®¶å¯ä»¥è¿›å…¥ canvas_ribbon å®‰è£…ã€‚ åœ¨ç½‘ç«™åº•éƒ¨æ·»åŠ è®¿é—®é‡ è¿›å…¥ \themes\next\layout\_partials\footer.swig æ–‡ä»¶é¡¶éƒ¨ç¬¬ä¸€è¡Œæ·»åŠ  1&lt;script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"&gt;&lt;/script&gt; æœç´¢ 1&#123;% if theme.footer.powered.enable %&#125; åœ¨è¿™ä¸ªä½ç½®ä¸Šæ·»åŠ ä»¥ä¸‹ä»£ç : 12345&lt;div class="powered-by"&gt;&lt;i class="fa fa-user-md"&gt;&lt;/i&gt;&lt;span id="busuanzi_container_site_uv"&gt; æœ¬ç«™è®¿å®¢æ•°:&lt;span id="busuanzi_value_site_uv"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt; æ³¨ï¼šè¿™é‡Œçš„idå€¼å¯ä»¥é€‰æ‹©ä¸¤ç§ 12busuanzi_value_site_uv #è¡¨ç¤ºç”¨æˆ·è¿žç»­ç‚¹å‡»nç¯‡æ–‡ç« ï¼Œåªè®°å½•1æ¬¡è®¿å®¢æ•°busuanzi_value_site_pv #è¡¨ç¤ºç”¨æˆ·è¿žç»­ç‚¹å‡»nç¯‡æ–‡ç« ï¼Œè®°å½•+næ¬¡è®¿é—®é‡ è¿™é‡Œå¯¹åº”çš„æ˜¯2ä¸Šçš„idå€¼ ç»™æ¯ç¯‡æ–‡ç« æ·»åŠ ç±»åˆ«å’Œæ ‡ç­¾ åœ¨åˆ›å»ºçš„æ–‡ç« éƒ½åœ¨source/_postç›®å½•ä¸‹æ‰¾åˆ°ï¼Œæ¯ç¯‡æ–‡ç« æ·»åŠ tagsã€categories æ·»åŠ è¿›åº¦æ¡ æ·»åŠ è¿›åº¦æ¡çš„è¯åœ¨æ‰‹æœºæµè§ˆçš„æ—¶å€™ä¸€èˆ¬æƒ…å†µéƒ½æœ‰è‡ªå¸¦çš„è¿›åº¦æ¡äº†ï¼Œä¾‹å¦‚å¾®ä¿¡æµè§ˆã€æµè§ˆå™¨æµè§ˆç­‰ç­‰ï¼Œè¿™æ ·å°±å‡ºçŽ°é‡å¤çš„è¿›åº¦æ¡äº†ï¼Œè¿™é‡Œçœ‹ä¸ªäººæ˜¯å¦æ·»åŠ ã€‚ä½†æ˜¯åœ¨ç”µè„‘æµè§ˆå™¨æµè§ˆå´æ˜¯ä¸é”™çš„ã€‚ æœ¬ä¾‹è®¾ç½®çš„å¦‚ä¸‹pace-theme-center-circleæ˜¾ç¤º æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæˆ–è€…è¿›å…¥è¿™é‡Œ Progressé…ç½® æŸ¥çœ‹å¦‚ä½•é…ç½® æ‰“å¼€Git Bash Hereè¿›å…¥è‡ªå·±æ–‡ä»¶å¤¹ä¸‹/themes/nextæ–‡ä»¶å¤¹ä¸‹ 1$ cd /themes/next ä¸‹è½½å®‰è£… Progress module æ‰§è¡Œ 1$ git clone https://github.com/theme-next/theme-next-pace source/lib/pace åœ¨ /themes/next/source/libæŸ¥çœ‹ä¼šçœ‹åˆ°paceæ–‡ä»¶å¤¹ åœ¨/themes/next/_config.ymlè®¾ç½® 123456pace: enable: true # Themes list: # big-counter | bounce | barber-shop | center-atom | center-circle | center-radar | center-simple # corner-indicator | fill-left | flat-top | flash | loading-bar | mac-osx | material | minimal theme: minimal #ä»»é€‰ä¸€ç§ æ·»åŠ ç«™å†…æœç´¢ ç”±äºŽå¯èƒ½éœ€è¦å¿«é€ŸæŸ¥æ‰¾ç›¸å…³æ–‡ç« ï¼Œé‚£ä¹ˆå°±éœ€è¦æ·»åŠ ç«™å†…æœç´¢ã€‚ æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæˆ–è€…è¿›å…¥ NexTé…ç½®ç«™å†…æœç´¢ æ–‡æ¡£æŸ¥çœ‹å¦‚ä½•é…ç½® å®‰è£…ç«™å†…æœç´¢æ’ä»¶ 123$ npm install hexo-generator-searchdb --saveæˆ–è€…$ cnpm install hexo-generator-searchdb --save åœ¨æ ¹ç›®å½•ä¸‹çš„_config.ymlæ·»åŠ  123456#è¡¨ç¤ºç«™å†…æœç´¢search: path: search.xml field: post format: html limit: 10000 åœ¨themes/next/_config.ymlæ–‡ä»¶ä¸­æœç´¢local_search,è¿›è¡Œè®¾ç½® 12345local_search: enable: true #è®¾ç½®ä¸ºtrue trigger: auto # auto / manualï¼Œauto è‡ªåŠ¨æœç´¢ã€manualï¼šæŒ‰å›žè½¦[enter ]é”®æ‰‹åŠ¨æœç´¢ top_n_per_article: 1 unescape: true æ·»åŠ æ‰“èµ NexTä¸»è¦æä¾›ä¸‰ç§æ‰“èµæ–¹å¼åˆ†åˆ«æ˜¯å¾®ä¿¡ã€æ”¯ä»˜å®ã€æ¯”ç‰¹å¸ åœ¨themes/nextæœç´¢Rewardï¼š 123456reward_settings: # If true, reward would be displayed in every article by default. # You can show or hide reward in a specific article throuth `reward: true | false` in Front-matter. enable: true #å¯ç”¨æ‰“èµ animation: true #å¯ç”¨åŠ¨ç”»æ•ˆæžœ comment: æèµ ä½œè€…è¯·ç‚¹å‡»ä¸‹æ–¹çš„â€œæ‰“èµâ€æŒ‰é’® #å†…å®¹ å‹æƒ…é“¾æŽ¥ 12345678# Blog rolls #å‹æƒ…é“¾æŽ¥links_icon: linklinks_title: å‹æƒ…é“¾æŽ¥links_layout: block#links_layout: inlinelinks: Eirunye: http://eirunye.github.io/ #æ‰€éœ€æ·»åŠ çš„å‹æƒ…é“¾æŽ¥ Titleæ˜¯è¡¨ç¤ºå‹æƒ…é“¾æŽ¥çš„åšå®¢åç§°æˆ–è€…éšæ„ä½ å–ï¼ŒåŽé¢æ˜¯é“¾æŽ¥ï¼Œå†’å·åŽé¢è®°å¾—ç©ºæ ¼ ç¨‹æ™“æ˜Ž: https://www.infoq.cn/profile/1278512 æ·»åŠ é˜…è¯»ç»Ÿè®¡ ç»™æ¯ç¯‡æ–‡ç« è¿›è¡Œæ·»åŠ é˜…è¯»ç»Ÿè®¡ï¼Œæ•ˆæžœå¦‚ä¸‹å›¾: è¿›å…¥ leancloud åˆ›å»ºåº”ç”¨ è¿›å…¥è®¾ç½®é¡µé¢èŽ·å–åº”ç”¨Key å°†App IDã€App Key é…ç½®åˆ°next/_config.ymlä¸­leancloud_visitors 1234567leancloud_visitors: enable: true è®¾ç½®ä¸ºtrue é»˜è®¤ä¸ºfalse app_id: #ä½ çš„App IDï¼Œæ³¨æ„å†’å·åŽé¢ç©ºæ ¼ app_key: #ä½ çš„App Keyï¼Œæ³¨æ„å†’å·åŽé¢ç©ºæ ¼ Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security #è®¾ç½®ä¾èµ– security: true #å¦‚æžœæ‚¨ä¸å…³å¿ƒlcè®¡æ•°å™¨ä¸­çš„å®‰å…¨æ€§å¹¶ä¸”åªæƒ³ç›´æŽ¥ä½¿ç”¨å®ƒï¼ˆæ²¡æœ‰hexo-leancloud-counter-securityæ’ä»¶ï¼‰ï¼Œè¯·å°†`security`è®¾ç½®ä¸º`false`ã€‚ betterPerformance: true#æ›´å¥½çš„æ€§èƒ½ åœ¨leancloudå­˜å‚¨çš„ä½ç½®åˆ›å»ºClass,å¿…é¡»å‘½åä¸ºCounter æŸ¥çœ‹åŽå°ç»Ÿè®¡æ•°æ® æ·»åŠ è¯„è®º æˆ‘çš„åšå®¢é€‰æ‹©çš„æ˜¯Valineã€‚ åœ¨next/_config.ymlæœç´¢Valine,è¿›å…¥ Valine å®˜ç½‘ï¼Œä¹Ÿæ˜¯ leancloud å®˜ç½‘ï¼Œè¿›å…¥leancloud æŽ§åˆ¶å°,æ²¡æœ‰è´¦å·å¯†ç å°±è¿›è¡Œè®¾ç½®ã€‚ åˆ›å»ºåº”ç”¨ å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„åˆ›å»ºåº”ç”¨ã€‚ è¿›å…¥è®¾ç½®é¡µé¢èŽ·å–åº”ç”¨key å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„è¿›å…¥è®¾ç½®é¡µé¢èŽ·å–åº”ç”¨keyã€‚ åœ¨next/_config.ymlè¿›è¡Œé…ç½®ã€‚ 1234567891011valine: enable: true # è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºfalse appid: # å°†åº”ç”¨keyçš„App IDè®¾ç½®åœ¨è¿™é‡Œ appkey: # å°†åº”ç”¨keyçš„App Keyè®¾ç½®åœ¨è¿™é‡Œ notify: true# é‚®ç®±é€šçŸ¥ , https://github.com/xCss/Valine/wikiï¼Œé»˜è®¤ä¸ºfalse verify: true# éªŒè¯ç  é»˜è®¤ä¸ºfalse placeholder: Just go go ^_^ # åˆå§‹åŒ–è¯„è®ºæ˜¾ç¤ºï¼Œæ ¹æ®è‡ªå·±ä¿®æ”¹ï¼Œè¿™é‡Œé»˜è®¤ï¼Œ avatar: wavatar # å¤´åƒé£Žæ ¼ï¼Œé»˜è®¤ä¸ºmmï¼Œå¯è¿›å…¥ç½‘å€ï¼šhttps://valine.js.org/visitor.htmlæŸ¥çœ‹å¤´åƒè®¾ç½®ï¼Œè¿™é‡Œæœ‰è®¸å¤šå¤´åƒé£Žæ ¼ï¼Œè¿›è¡Œè®¾ç½® guest_info: nick,mail,link # è‡ªå®šä¹‰è¯„è®ºæ ‡é¢˜ pageSize: 10 # åˆ†é¡µå¤§å°ï¼Œ10é¡µå°±è‡ªåŠ¨åˆ†é¡µ visitor: true # æ˜¯å¦å…è®¸æ¸¸å®¢è¯„è®º ï¼Œè¿›å…¥å®˜ç½‘æŸ¥çœ‹è®¾ç½®ï¼šhttps://valine.js.org/visitor.html æ˜¾ç¤ºç»“æžœ è¿™æ ·å°±å®Œæˆäº†valineè¯„è®ºçš„é…ç½®äº†ï¼ŒæŽ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œè¯„è®ºäº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨åŽå°æŸ¥çœ‹è¯„è®ºä¿¡æ¯ã€‚ åœ¨åŽå°æŸ¥çœ‹è¯„è®ºæ•°æ® åœ¨valineåŽå°ï¼Œå­˜å‚¨ä½ç½®ä¸­çš„æ•°æ®é‡Œé¢åˆ›å»ºClassï¼Œåç§°å¿…é¡»ä¸ºå‘½åä¸ºComment å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„åˆ›å»ºClassã€‚ &lt;font color=&quot;red&quot;&gt;æ³¨ï¼š&lt;/font&gt;é€‰æ‹©valineè¯„è®ºç³»ç»Ÿæ˜¯å› ä¸ºæ”¯æŒå›½å†…ç½‘ç»œï¼Œä¸éœ€è¦è¿žæŽ¥å¤–ç½‘ï¼ˆç¿»å¢™ï¼‰å°±å¯ä»¥è¿›è¡Œæ˜¾ç¤ºè¯„è®ºç³»ç»Ÿï¼Œè€Œä¸”å¾ˆå¥½ç®¡ç†ï¼Œé¡µé¢ç®€å•ã€‚ æ·»åŠ RSS æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³•ï¼š åˆ‡æ¢åˆ°ä½ çš„blogæ ¹ç›®å½•ä¸‹ï¼Œç„¶åŽå®‰è£… Hexo æ’ä»¶ï¼š(è¿™ä¸ªæ’ä»¶ä¼šæ”¾åœ¨node_modulesè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œ) 1$ cnpm install --save hexo-generator-feed ç„¶åŽåœ¨æ ¹ç›®å½•çš„ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlä¸‹è¿›è¡Œé…ç½® 12## Plugins: http://hexo.io/plugins/plugins: hexo-generate-feed # RSSè®¢é˜… ç„¶åŽæ‰“å¼€nextä¸»é¢˜æ–‡ä»¶å¤¹é‡Œé¢çš„_config.yml,åœ¨é‡Œé¢é…ç½®ä¸ºå¦‚ä¸‹ï¼š 1234# Set rss to false to disable feed link.# Leave rss as empty to use site's feed link.# Set rss to specific value if you have burned your feed already.rss: /atom.xml ç‚¹å‡»å‡ºçŽ°æ¡ƒå¿ƒæ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ï¼š http://7u2ss1.com1.z0.glb.clouddn.com/love.js ç„¶åŽå°†é‡Œé¢çš„ä»£ç copyä¸€ä¸‹ï¼Œæ–°å»ºlove.jsæ–‡ä»¶å¹¶ä¸”å°†ä»£ç å¤åˆ¶è¿›åŽ»ï¼Œç„¶åŽä¿å­˜ã€‚ å°†love.jsæ–‡ä»¶æ”¾åˆ°è·¯å¾„/themes/next/source/js/srcé‡Œé¢ï¼Œç„¶åŽæ‰“å¼€\themes\next\layout\_layout.swigæ–‡ä»¶,åœ¨æœ«å°¾ï¼ˆåœ¨å‰é¢å¼•ç”¨ä¼šå‡ºçŽ°æ‰¾ä¸åˆ°çš„bugï¼‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 12&lt;!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ --&gt;&lt;script type="text/javascript" src="/js/src/love.js"&gt;&lt;/script&gt; ä¿®æ”¹æ–‡ç« å†…é“¾æŽ¥æ–‡æœ¬æ ·å¼ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• ä¿®æ”¹æ–‡ä»¶ themes\next\source\css\_common\components\post\post.stylï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹cssæ ·å¼ï¼š 1234567891011// æ–‡ç« å†…é“¾æŽ¥æ–‡æœ¬æ ·å¼.post-body p a&#123; color: #0593d3; border-bottom: none; border-bottom: 1px solid #0593d3; &amp;:hover &#123; color: #fc6423; border-bottom: none; border-bottom: 1px solid #fc6423; &#125;&#125; å…¶ä¸­é€‰æ‹©.post-body æ˜¯ä¸ºäº†ä¸å½±å“æ ‡é¢˜ï¼Œé€‰æ‹© p æ˜¯ä¸ºäº†ä¸å½±å“é¦–é¡µâ€œé˜…è¯»å…¨æ–‡â€çš„æ˜¾ç¤ºæ ·å¼,é¢œè‰²å¯ä»¥è‡ªå·±å®šä¹‰ã€‚ åœ¨æ¯ç¯‡æ–‡ç« æœ«å°¾ç»Ÿä¸€æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®° æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨è·¯å¾„ \themes\next\layout\_macro ä¸­æ–°å»º passage-end-tag.swig æ–‡ä»¶,å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 12345&lt;div&gt; &#123;% if not is_index %&#125; &lt;div style="text-align:center;color: #ccc;font-size:14px;"&gt;-------------æœ¬æ–‡ç»“æŸ&lt;i class="fa fa-paw"&gt;&lt;/i&gt;æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------&lt;/div&gt; &#123;% endif %&#125;&lt;/div&gt; æŽ¥ç€æ‰“å¼€\themes\next\layout\_macro\post.swigæ–‡ä»¶ï¼Œåœ¨post-body ä¹‹åŽï¼Œ post-footer ä¹‹å‰æ·»åŠ å¦‚ä¸‹ç”»çº¢è‰²éƒ¨åˆ†ä»£ç ï¼ˆpost-footerä¹‹å‰ä¸¤ä¸ªDIVï¼‰ï¼š 12345&lt;div&gt; &#123;% if not is_index %&#125; &#123;% include 'passage-end-tag.swig' %&#125; &#123;% endif %&#125;&lt;/div&gt; ç„¶åŽæ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆ_config.yml),åœ¨æœ«å°¾æ·»åŠ ï¼š 123# æ–‡ç« æœ«å°¾æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°passage_end_tag: enabled: true ä¿®æ”¹``ä»£ç å—è‡ªå®šä¹‰æ ·å¼ æ•ˆæžœå¦‚ä¸‹ï¼š å®žçŽ°æ–¹æ³• æ‰“å¼€\themes\next\source\css\_custom\custom.styl,å‘é‡Œé¢åŠ å…¥ï¼š(é¢œè‰²å¯ä»¥è‡ªå·±å®šä¹‰) 123456789101112131415// Custom styles.code &#123; color: #ff7600; background: #fbf7f8; margin: 2px;&#125;// å¤§ä»£ç å—çš„è‡ªå®šä¹‰æ ·å¼.highlight, pre &#123; margin: 5px 0; padding: 5px; border-radius: 3px;&#125;.highlight, code, pre &#123; border: 1px solid #d6d6d6;&#125; ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• æ‰“å¼€\themes\next\source\css\_custom\custom.styl,å‘é‡Œé¢åŠ å…¥ï¼š 12345678// ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæžœ .post &#123; margin-top: 60px; margin-bottom: 60px; padding: 25px; -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5); -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5); &#125; æ·»åŠ çƒ­åº¦ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• nextä¸»é¢˜é›†æˆleanCloudï¼Œæ‰“å¼€/themes/next/layout/_macro/post.swig,åœ¨ç”»çº¢çº¿çš„åŒºåŸŸæ·»åŠ â„ƒï¼š ç„¶åŽæ‰“å¼€ï¼Œ/themes/next/languages/zh-Hans.yml,å°†ç”»çº¢æ¡†çš„æ”¹ä¸ºçƒ­åº¦å°±å¯ä»¥äº†: ç½‘ç«™åº•éƒ¨å­—æ•°ç»Ÿè®¡ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åˆ‡æ¢åˆ°æ ¹ç›®å½•ä¸‹ï¼Œç„¶åŽè¿è¡Œå¦‚ä¸‹ä»£ç  1$ cnpm install hexo-wordcount --save ç„¶åŽåœ¨/themes/next/layout/_partials/footer.swigæ–‡ä»¶å°¾éƒ¨åŠ ä¸Šï¼š 1234&lt;div class="theme-info"&gt; &lt;div class="powered-by"&gt;&lt;/div&gt; &lt;span class="post-count"&gt;ç«™ç‚¹æ€»å­—æ•°&#123;&#123; totalcount(site) &#125;&#125;å­—&lt;/span&gt;&lt;/div&gt; æ·»åŠ  README.md æ–‡ä»¶ æ¯ä¸ªé¡¹ç›®ä¸‹ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ hexo éƒ¨ç½²åˆ°ä»“åº“åŽï¼Œé¡¹ç›®ä¸‹æ˜¯æ²¡æœ‰ README.md æ–‡ä»¶çš„ã€‚ åœ¨ Hexo ç›®å½•ä¸‹çš„ source æ ¹ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.ymlï¼Œå°† skip_render å‚æ•°çš„å€¼è®¾ç½®ä¸º 1skip_render: README.md ä¿å­˜é€€å‡ºå³å¯ã€‚å†æ¬¡ä½¿ç”¨ hexo d å‘½ä»¤éƒ¨ç½²åšå®¢çš„æ—¶å€™å°±ä¸ä¼šåœ¨æ¸²æŸ“ README.md è¿™ä¸ªæ–‡ä»¶äº†ã€‚ å®žçŽ°ç»Ÿè®¡åŠŸèƒ½ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨æ ¹ç›®å½•ä¸‹å®‰è£… hexo-wordcount,è¿è¡Œï¼š 1$ cnpm install hexo-wordcount --save ç„¶åŽåœ¨ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678# Post wordcount display settings# Dependencies: https://github.com/willin/hexo-wordcountpost_wordcount: item_text: true wordcount: true #å­—æ•°ç»Ÿè®¡ min2read: true #é˜…è¯»æ—¶é•¿é¢„è®¡ totalcount: true #æ€»å­—æ•°ç»Ÿè®¡ separated_meta: true æ·»åŠ é¡¶éƒ¨åŠ è½½æ¡ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• æ‰“å¼€/themes/next/layout/_partials/head.swigæ–‡ä»¶ï¼Œæ·»åŠ çº¢æ¡†ä¸Šçš„ä»£ç  12&lt;script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"&gt;&lt;/script&gt;&lt;link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"&gt; ä½†æ˜¯ï¼Œé»˜è®¤çš„æ˜¯ç²‰è‰²çš„ï¼Œè¦æ”¹å˜é¢œè‰²å¯ä»¥åœ¨/themes/next/layout/_partials/head.swigæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆæŽ¥åœ¨åˆšæ‰linkçš„åŽé¢ï¼‰ 12345678910111213&lt;style&gt; .pace .pace-progress &#123; background: #1E92FB; /*è¿›åº¦æ¡é¢œè‰²*/ height: 3px; &#125; .pace .pace-progress-inner &#123; box-shadow: 0 0 10px #1E92FB, 0 0 5px #1E92FB; /*é˜´å½±é¢œè‰²*/ &#125; .pace .pace-activity &#123; border-top-color: #1E92FB; /*ä¸Šè¾¹æ¡†é¢œè‰²*/ border-left-color: #1E92FB; /*å·¦è¾¹æ¡†é¢œè‰²*/ &#125;&lt;/style&gt; åœ¨æ–‡ç« åº•éƒ¨å¢žåŠ ç‰ˆæƒä¿¡æ¯ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ç›®å½• next/layout/_macro/ä¸‹æ·»åŠ  my-copyright.swigï¼š 1234567891011121314151617181920212223242526272829303132&#123;% if page.copyright %&#125;&lt;div class="my_post_copyright"&gt; &lt;script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"&gt;&lt;/script&gt; &lt;!-- JSåº“ sweetalert å¯ä¿®æ”¹è·¯å¾„ --&gt; &lt;script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt; &lt;script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"&gt;&lt;/script&gt; &lt;p&gt;&lt;span&gt;æœ¬æ–‡æ ‡é¢˜:&lt;/span&gt;&lt;a href="&#123;&#123; url_for(page.path) &#125;&#125;"&gt;&#123;&#123; page.title &#125;&#125;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;æ–‡ç« ä½œè€…:&lt;/span&gt;&lt;a href="/" title="è®¿é—® &#123;&#123; theme.author &#125;&#125; çš„ä¸ªäººåšå®¢"&gt;&#123;&#123; theme.author &#125;&#125;&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;å‘å¸ƒæ—¶é—´:&lt;/span&gt;&#123;&#123; page.date.format("YYYYå¹´MMæœˆDDæ—¥ - HH:MM") &#125;&#125;&lt;/p&gt; &lt;p&gt;&lt;span&gt;æœ€åŽæ›´æ–°:&lt;/span&gt;&#123;&#123; page.updated.format("YYYYå¹´MMæœˆDDæ—¥ - HH:MM") &#125;&#125;&lt;/p&gt; &lt;p&gt;&lt;span&gt;åŽŸå§‹é“¾æŽ¥:&lt;/span&gt;&lt;a href="&#123;&#123; url_for(page.path) &#125;&#125;" title="&#123;&#123; page.title &#125;&#125;"&gt;&#123;&#123; page.permalink &#125;&#125;&lt;/a&gt; &lt;span class="copy-path" title="ç‚¹å‡»å¤åˆ¶æ–‡ç« é“¾æŽ¥"&gt;&lt;i class="fa fa-clipboard" data-clipboard-text="&#123;&#123; page.permalink &#125;&#125;" aria-label="å¤åˆ¶æˆåŠŸï¼"&gt;&lt;/i&gt;&lt;/span&gt; &lt;/p&gt; &lt;!-- &lt;p&gt;&lt;span&gt;è®¸å¯åè®®:&lt;/span&gt;&lt;i class="fa fa-creative-commons"&gt;&lt;/i&gt; &lt;a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)"&gt;ç½²å-éžå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç»Ž 4.0 å›½é™…&lt;/a&gt; è½¬è½½è¯·ä¿ç•™åŽŸæ–‡é“¾æŽ¥åŠä½œè€…ã€‚&lt;/p&gt; --&gt; &lt;/div&gt;&lt;script&gt; var clipboard = new Clipboard('.fa-clipboard'); $(".fa-clipboard").click(function()&#123; clipboard.on('success', function()&#123; swal(&#123; title: "", text: 'å¤åˆ¶æˆåŠŸ', icon: "success", showConfirmButton: true &#125;); &#125;); &#125;); &lt;/script&gt;&#123;% endif %&#125; åœ¨ç›®å½•next/source/css/_common/components/post/ä¸‹æ·»åŠ my-post-copyright.stylï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445.my_post_copyright &#123; width: 85%; max-width: 45em; margin: 2.8em auto 0; padding: 0.5em 1.0em; border: 1px solid #d3d3d3; font-size: 0.93rem; line-height: 1.6em; word-break: break-all; background: rgba(255,255,255,0.4);&#125;.my_post_copyright p&#123;margin:0;&#125;.my_post_copyright span &#123; display: inline-block; width: 5.2em; color: #b5b5b5; font-weight: bold;&#125;.my_post_copyright .raw &#123; margin-left: 1em; width: 5em;&#125;.my_post_copyright a &#123; color: #808080; border-bottom:0;&#125;.my_post_copyright a:hover &#123; color: #a3d2a3; text-decoration: underline;&#125;.my_post_copyright:hover .fa-clipboard &#123; color: #000;&#125;.my_post_copyright .post-url:hover &#123; font-weight: normal;&#125;.my_post_copyright .copy-path &#123; margin-left: 1em; width: 1em; +mobile()&#123;display:none;&#125;&#125;.my_post_copyright .copy-path:hover &#123; color: #808080; cursor: pointer;&#125; ä¿®æ”¹next/layout/_macro/post.swigï¼Œåœ¨ä»£ç  12345&lt;div&gt; &#123;% if not is_index %&#125; &#123;% include 'wechat-subscriber.swig' %&#125; &#123;% endif %&#125;&lt;/div&gt; ä¹‹å‰æ·»åŠ å¢žåŠ å¦‚ä¸‹ä»£ç ï¼š 12345&lt;div&gt; &#123;% if not is_index %&#125; &#123;% include 'my-copyright.swig' %&#125; &#123;% endif %&#125;&lt;/div&gt; å¦‚ä¸‹å›¾ï¼š ä¿®æ”¹next/source/css/_common/components/post/post.stylæ–‡ä»¶ï¼Œåœ¨æœ€åŽä¸€è¡Œå¢žåŠ ä»£ç ï¼š 1@import "my-post-copyright" ä¿å­˜é‡æ–°ç”Ÿæˆå³å¯ã€‚å¦‚æžœè¦åœ¨è¯¥åšæ–‡ä¸‹é¢å¢žåŠ ç‰ˆæƒä¿¡æ¯çš„æ˜¾ç¤ºï¼Œéœ€è¦åœ¨ Markdown ä¸­å¢žåŠ copyright: trueçš„è®¾ç½®ï¼Œç±»ä¼¼ï¼š 123456789101112---title: Javaå¹¶å‘-ReentrantLockcopyright: truedate: 2019-08-26 14:59:12updated:tags: - Java - J.U.Ccategories: - Java - J.U.C--- å¦‚æžœä½ è§‰å¾—æ¯æ¬¡éƒ½è¦è¾“å…¥copyright: trueå¾ˆéº»çƒ¦çš„è¯,é‚£ä¹ˆåœ¨/scaffolds/post.mdæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1copyright: true è¿™æ ·æ¯æ¬¡hexo new &quot;ä½ çš„å†…å®¹&quot;ä¹‹åŽï¼Œç”Ÿæˆçš„mdæ–‡ä»¶ä¼šè‡ªåŠ¨æŠŠcopyright:trueåŠ åˆ°é‡Œé¢åŽ»ã€‚ éšè—ç½‘é¡µåº•éƒ¨powered By Hexo / å¼ºåŠ›é©±åŠ¨ æ‰“å¼€themes/next/layout/_partials/footer.swig,éšè—æˆ–åˆ é™¤å¦‚ä¸‹ä»£ç ï¼Œå¦‚ä¸‹å›¾ï¼š ä¿®æ”¹æ‰“èµå­—ä½“ä¸é—ªåŠ¨ ä¿®æ”¹æ–‡ä»¶next/source/css/_common/components/post/post-reward.stylï¼Œç„¶åŽæ³¨é‡Šå…¶ä¸­çš„å‡½æ•°wechat:hoverå’Œalipay:hoverï¼Œå¦‚ä¸‹ï¼š 123456789101112/* æ³¨é‡Šæ–‡å­—é—ªåŠ¨å‡½æ•° #wechat:hover p&#123; animation: roll 0.1s infinite linear; -webkit-animation: roll 0.1s infinite linear; -moz-animation: roll 0.1s infinite linear;&#125; #alipay:hover p&#123; animation: roll 0.1s infinite linear; -webkit-animation: roll 0.1s infinite linear; -moz-animation: roll 0.1s infinite linear;&#125;*/ æ–‡ç« åŠ å¯†è®¿é—® æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• æ‰“å¼€themes/next/layout/_partials/head/head.swigæ–‡ä»¶,åœ¨ä»¥ä¸‹ä½ç½®æ’å…¥è¿™æ ·ä¸€æ®µä»£ç ï¼š 12345678910&lt;script&gt; (function()&#123; if('&#123;&#123; page.password &#125;&#125;')&#123; if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ') !== '&#123;&#123; page.password &#125;&#125;')&#123; alert('å¯†ç é”™è¯¯ï¼'); history.back(); &#125; &#125; &#125;)();&lt;/script&gt; ç„¶åŽåœ¨æ–‡ç« ä¸Šå†™æˆç±»ä¼¼è¿™æ ·ï¼š æ·»åŠ é¼ æ ‡ç‚¹å‡»æ˜¾ç¤ºå­—ä½“æ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ /themes/next/source/js ä¸‹æ–°å»ºæ–‡ä»¶ click_show_text.jsï¼Œåœ¨ click_show_text.js æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233var a_idx = 0;jQuery(document).ready(function($) &#123; $("body").click(function(e) &#123; var a = new Array ("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜Ž", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„"); var $i = $("&lt;span/&gt;").text(a[a_idx]); a_idx = (a_idx + 1) % a.length; var x = e.pageX, y = e.pageY; $i.css(&#123; "z-index": 5, "top": y - 20, "left": x, "position": "absolute", "font-weight": "bold", "color": "#FF0000" &#125;); $("body").append($i); $i.animate(&#123; "top": y - 180, "opacity": 0 &#125;, 3000, function() &#123; $i.remove(); &#125;); &#125;); setTimeout('delay()', 2000);&#125;);function delay() &#123; $(".buryit").removeAttr("onclick");&#125; å…¶ä¸­çš„ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚å¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„åˆ›æ„æ›¿æ¢ä¸ºå…¶ä»–æ–‡å­—ï¼Œç„¶åŽåœ¨ \themes\next\layout\_layout.swing æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 12&lt;!--å•å‡»æ˜¾ç¤ºæ–‡å­—--&gt;&lt;script type="text/javascript" src="/js/click_show_text.js"&gt;&lt;/script&gt; æ·»åŠ é¼ æ ‡ç‚¹å‡»çƒŸèŠ±çˆ†ç‚¸æ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª fireworks.js çš„æ–‡ä»¶ï¼Œé‡Œé¢å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 1"use strict";function updateCoords(e)&#123;pointerX=(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top&#125;function setParticuleDirection(e)&#123;var t=anime.random(0,360)*Math.PI/180,a=anime.random(50,180),n=[-1,1][anime.random(0,1)]*a;return&#123;x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)&#125;&#125;function createParticule(e,t)&#123;var a=&#123;&#125;;return a.x=e,a.y=t,a.color=colors[anime.random(0,colors.length-1)],a.radius=anime.random(16,32),a.endPos=setParticuleDirection(a),a.draw=function()&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle=a.color,ctx.fill()&#125;,a&#125;function createCircle(e,t)&#123;var a=&#123;&#125;;return a.x=e,a.y=t,a.color="#F00",a.radius=0.1,a.alpha=0.5,a.lineWidth=6,a.draw=function()&#123;ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=1&#125;,a&#125;function renderParticule(e)&#123;for(var t=0;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;function animateParticules(e,t)&#123;for(var a=createCircle(e,t),n=[],i=0;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;targets:n,x:function(e)&#123;return e.endPos.x&#125;,y:function(e)&#123;return e.endPos.y&#125;,radius:0.1,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule&#125;).add(&#123;targets:a,radius:anime.random(80,160),lineWidth:0,alpha:&#123;value:0,easing:"linear",duration:anime.random(600,800)&#125;,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule,offset:0&#125;)&#125;function debounce(e,t)&#123;var a;return function()&#123;var n=this,i=arguments;clearTimeout(a),a=setTimeout(function()&#123;e.apply(n,i)&#125;,t)&#125;&#125;var canvasEl=document.querySelector(".fireworks");if(canvasEl)&#123;var ctx=canvasEl.getContext("2d"),numberOfParticules=30,pointerX=0,pointerY=0,tap="mousedown",colors=["#FF1461","#18FF92","#5A87FF","#FBF38C"],setCanvasSize=debounce(function()&#123;canvasEl.width=2*window.innerWidth,canvasEl.height=2*window.innerHeight,canvasEl.style.width=window.innerWidth+"px",canvasEl.style.height=window.innerHeight+"px",canvasEl.getContext("2d").scale(2,2)&#125;,500),render=anime(&#123;duration:1/0,update:function()&#123;ctx.clearRect(0,0,canvasEl.width,canvasEl.height)&#125;&#125;);document.addEventListener(tap,function(e)&#123;"sidebar"!==e.target.id&amp;&amp;"toggle-sidebar"!==e.target.id&amp;&amp;"A"!==e.target.nodeName&amp;&amp;"IMG"!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!1),setCanvasSize(),window.addEventListener("resize",setCanvasSize,!1)&#125;"use strict";function updateCoords(e)&#123;pointerX=(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top&#125;function setParticuleDirection(e)&#123;var t=anime.random(0,360)*Math.PI/180,a=anime.random(50,180),n=[-1,1][anime.random(0,1)]*a;return&#123;x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)&#125;&#125;function createParticule(e,t)&#123;var a=&#123;&#125;;return a.x=e,a.y=t,a.color=colors[anime.random(0,colors.length-1)],a.radius=anime.random(16,32),a.endPos=setParticuleDirection(a),a.draw=function()&#123;ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle=a.color,ctx.fill()&#125;,a&#125;function createCircle(e,t)&#123;var a=&#123;&#125;;return a.x=e,a.y=t,a.color="#F00",a.radius=0.1,a.alpha=0.5,a.lineWidth=6,a.draw=function()&#123;ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=1&#125;,a&#125;function renderParticule(e)&#123;for(var t=0;t&lt;e.animatables.length;t++)&#123;e.animatables[t].target.draw()&#125;&#125;function animateParticules(e,t)&#123;for(var a=createCircle(e,t),n=[],i=0;i&lt;numberOfParticules;i++)&#123;n.push(createParticule(e,t))&#125;anime.timeline().add(&#123;targets:n,x:function(e)&#123;return e.endPos.x&#125;,y:function(e)&#123;return e.endPos.y&#125;,radius:0.1,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule&#125;).add(&#123;targets:a,radius:anime.random(80,160),lineWidth:0,alpha:&#123;value:0,easing:"linear",duration:anime.random(600,800)&#125;,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule,offset:0&#125;)&#125;function debounce(e,t)&#123;var a;return function()&#123;var n=this,i=arguments;clearTimeout(a),a=setTimeout(function()&#123;e.apply(n,i)&#125;,t)&#125;&#125;var canvasEl=document.querySelector(".fireworks");if(canvasEl)&#123;var ctx=canvasEl.getContext("2d"),numberOfParticules=30,pointerX=0,pointerY=0,tap="mousedown",colors=["#FF1461","#18FF92","#5A87FF","#FBF38C"],setCanvasSize=debounce(function()&#123;canvasEl.width=2*window.innerWidth,canvasEl.height=2*window.innerHeight,canvasEl.style.width=window.innerWidth+"px",canvasEl.style.height=window.innerHeight+"px",canvasEl.getContext("2d").scale(2,2)&#125;,500),render=anime(&#123;duration:1/0,update:function()&#123;ctx.clearRect(0,0,canvasEl.width,canvasEl.height)&#125;&#125;);document.addEventListener(tap,function(e)&#123;"sidebar"!==e.target.id&amp;&amp;"toggle-sidebar"!==e.target.id&amp;&amp;"A"!==e.target.nodeName&amp;&amp;"IMG"!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))&#125;,!1),setCanvasSize(),window.addEventListener("resize",setCanvasSize,!1)&#125;; ç„¶åŽåœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123&lt;canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" &gt;&lt;/canvas&gt; &lt;script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="/js/fireworks.js"&gt;&lt;/script&gt; è‡ªå®šä¹‰é¼ æ ‡æŒ‡é’ˆæ ·å¼ åœ¨ \themes\next\source\css\_custom\custom.styl æ–‡ä»¶ body æ ·å¼é‡Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š 12345/*è‡ªå®šä¹‰é¼ æ ‡æ ·å¼*/body &#123; cursor: url("/images/mouse.cur"),auto; background-color: @theme_background;&#125; é¼ æ ‡æŒ‡é’ˆå¯ä»¥ç”¨ Axialis CursorWorkshop è¿™ä¸ªè½¯ä»¶è‡ªå·±åˆ¶ä½œï¼Œä¸åŒä¸»é¢˜å…·ä½“æ”¾çš„æ–‡ä»¶æœ‰æ‰€ä¸åŒï¼Œç¡®ä¿åœ¨åšå®¢ä¸»ä½“ body çš„ CSS æ–‡ä»¶ä¸­å³å¯ï¼Œå…¶ä¸­çš„é¼ æ ‡æŒ‡é’ˆé“¾æŽ¥å¯æ›¿æ¢æˆè‡ªå·±çš„ï¼Œé¦–å…ˆå°è¯•åŠ è½½mouse.cur ï¼Œå¦‚æžœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–ç”±äºŽå…¶ä»–åŽŸå› æ— æ•ˆï¼Œé‚£ä¹ˆ auto ä¼šè¢«ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨é»˜è®¤æ•ˆæžœï¼Œå›¾ç‰‡æ ¼å¼ä¸º.icoã€.aniã€.curï¼Œå»ºè®®ä½¿ç”¨.curï¼Œå¦‚æžœä½¿ç”¨.aniæˆ–è€…å…¶ä»–æ ¼å¼æ— æ•ˆï¼ŒåŽŸå› æ˜¯æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€‚ æ·»åŠ å½©è‰²æ»šåŠ¨å˜æ¢å­—ä½“ åœ¨ä½ æƒ³è¦æ·»åŠ å½©è‰²æ»šåŠ¨å˜æ¢å­—ä½“çš„åœ°æ–¹å†™å…¥ä»¥ä¸‹ä»£ç å³å¯ï¼Œå…¶ä¸­æ–‡å­—å¯è‡ªè¡Œæ›´æ”¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;div id="binft"&gt;&lt;/div&gt; &lt;script&gt; var binft = function (r) &#123; function t() &#123; return b[Math.floor(Math.random() * b.length)] &#125; function e() &#123; return String.fromCharCode(94 * Math.random() + 33) &#125; function n(r) &#123; for (var n = document.createDocumentFragment(), i = 0; r &gt; i; i++) &#123; var l = document.createElement("span"); l.textContent = e(), l.style.color = t(), n.appendChild(l) &#125; return n &#125; function i() &#123; var t = o[c.skillI]; c.step ? c.step-- : (c.step = g, c.prefixP &lt; l.length ? (c.prefixP &gt;= 0 &amp;&amp; (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP &lt; t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP &gt; 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP &lt; l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d) &#125; var l = "", o = ["é’é’é™µä¸ŠæŸï¼Œç£Šç£Šæ¶§ä¸­çŸ³ã€‚", "äººç”Ÿå¤©åœ°é—´ï¼Œå¿½å¦‚è¿œè¡Œå®¢ã€‚","æ–—é…’ç›¸å¨±ä¹ï¼ŒèŠåŽšä¸ä¸ºè–„ã€‚", "é©±è½¦ç­–é©½é©¬ï¼Œæ¸¸æˆå®›ä¸Žæ´›ã€‚","æ´›ä¸­ä½•éƒéƒï¼Œå† å¸¦è‡ªç›¸ç´¢ã€‚","é•¿è¡¢ç½—å¤¹å··ï¼ŒçŽ‹ä¾¯å¤šç¬¬å®…ã€‚","ä¸¤å®«é¥ç›¸æœ›ï¼ŒåŒé˜™ç™¾ä½™å°ºã€‚","æžå®´å¨±å¿ƒæ„ï¼Œæˆšæˆšä½•æ‰€è¿«ï¼Ÿ"].map(function (r) &#123; return r + "" &#125;), a = 2, g = 1, s = 5, d = 75, b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"], c = &#123; text: "", prefixP: -s, skillI: 0, skillP: 0, direction: "forward", delay: a, step: g &#125;; i() &#125;; binft(document.getElementById('binft')); &lt;/script&gt; æˆ‘æ˜¯æ”¾åœ¨äº†ä¾§è¾¹æ å¤´åƒçš„ä¸‹è¾¹ï¼Œæè¿°çš„ä½ç½®\themes\next\layout\_macro\sidebar.swingï¼š æµè§ˆå™¨ç½‘é¡µæ ‡é¢˜æ¶æž æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ç›®å½• \themes\next\source\js ä¸‹æ–°å»ºä¸€ä¸ª FunnyTitle.js æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å¡«å†™å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314151617&lt;!--æµè§ˆå™¨æžç¬‘æ ‡é¢˜--&gt; var OriginTitle = document.title; var titleTime; document.addEventListener('visibilitychange', function () &#123; if (document.hidden) &#123; $('[rel="icon"]').attr('href', "/img/trhx2.png"); document.title = 'ãƒ½(â—-`Ð”Â´-)ãƒŽä½ ä¸‘ä½ å°±èµ°ï¼'; clearTimeout(titleTime); &#125; else &#123; $('[rel="icon"]').attr('href', "/img/trhx2.png"); document.title = 'ãƒ¾(Åâˆ€Å3)ãƒŽä½ å¸…å°±å›žæ¥ï¼' + OriginTitle; titleTime = setTimeout(function () &#123; document.title = OriginTitle; &#125;, 2000); &#125; &#125;); ç„¶åŽåœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12&lt;!--æµè§ˆå™¨æžç¬‘æ ‡é¢˜--&gt;&lt;script type="text/javascript" src="\js\FunnyTitle.js"&gt;&lt;/script&gt; å†æ¬¡éƒ¨ç½²åšå®¢åŽå°±å¯ä»¥çœ‹è§æ ‡é¢˜æžç¬‘çš„æ•ˆæžœäº†ã€‚ æ·»åŠ ç½‘ç«™é›ªèŠ±é£˜è½æ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª snow.js æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142/*æ ·å¼ä¸€*/(function($)&#123; $.fn.snow = function(options)&#123; var $flake = $('&lt;div id="snowbox" /&gt;').css(&#123;'position': 'absolute','z-index':'9999', 'top': '-50px'&#125;).html('&amp;#10052;'), documentHeight = $(document).height(), documentWidth = $(document).width(), defaults = &#123; minSize : 10, maxSize : 20, newOn : 1000, flakeColor : "#AFDAEF" /* æ­¤å¤„å¯ä»¥å®šä¹‰é›ªèŠ±é¢œè‰²ï¼Œè‹¥è¦ç™½è‰²å¯ä»¥æ”¹ä¸º#FFFFFF */ &#125;, options = $.extend(&#123;&#125;, defaults, options); var interval= setInterval( function()&#123; var startPositionLeft = Math.random() * documentWidth - 100, startOpacity = 0.5 + Math.random(), sizeFlake = options.minSize + Math.random() * options.maxSize, endPositionTop = documentHeight - 200, endPositionLeft = startPositionLeft - 500 + Math.random() * 500, durationFall = documentHeight * 10 + Math.random() * 5000; $flake.clone().appendTo('body').css(&#123; left: startPositionLeft, opacity: startOpacity, 'font-size': sizeFlake, color: options.flakeColor &#125;).animate(&#123; top: endPositionTop, left: endPositionLeft, opacity: 0.2 &#125;,durationFall,'linear',function()&#123; $(this).remove() &#125;); &#125;, options.newOn); &#125;;&#125;)(jQuery);$(function()&#123; $.fn.snow(&#123; minSize: 5, /* å®šä¹‰é›ªèŠ±æœ€å°å°ºå¯¸ */ maxSize: 50,/* å®šä¹‰é›ªèŠ±æœ€å¤§å°ºå¯¸ */ newOn: 300 /* å®šä¹‰å¯†é›†ç¨‹åº¦ï¼Œæ•°å­—è¶Šå°è¶Šå¯†é›† */ &#125;);&#125;); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128/*æ ·å¼äºŒ*//* æŽ§åˆ¶ä¸‹é›ª */function snowFall(snow) &#123; /* å¯é…ç½®å±žæ€§ */ snow = snow || &#123;&#125;; this.maxFlake = snow.maxFlake || 200; /* æœ€å¤šç‰‡æ•° */ this.flakeSize = snow.flakeSize || 10; /* é›ªèŠ±å½¢çŠ¶ */ this.fallSpeed = snow.fallSpeed || 1; /* å è½é€Ÿåº¦ */&#125;/* å…¼å®¹å†™æ³• */requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function(callback) &#123; setTimeout(callback, 1000 / 60); &#125;;cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame || window.msCancelAnimationFrame || window.oCancelAnimationFrame;/* å¼€å§‹ä¸‹é›ª */snowFall.prototype.start = function()&#123; /* åˆ›å»ºç”»å¸ƒ */ snowCanvas.apply(this); /* åˆ›å»ºé›ªèŠ±å½¢çŠ¶ */ createFlakes.apply(this); /* ç”»é›ª */ drawSnow.apply(this)&#125;/* åˆ›å»ºç”»å¸ƒ */function snowCanvas() &#123; /* æ·»åŠ Domç»“ç‚¹ */ var snowcanvas = document.createElement("canvas"); snowcanvas.id = "snowfall"; snowcanvas.width = window.innerWidth; snowcanvas.height = document.body.clientHeight; snowcanvas.setAttribute("style", "position:absolute; top: 0; left: 0; z-index: 1; pointer-events: none;"); document.getElementsByTagName("body")[0].appendChild(snowcanvas); this.canvas = snowcanvas; this.ctx = snowcanvas.getContext("2d"); /* çª—å£å¤§å°æ”¹å˜çš„å¤„ç† */ window.onresize = function() &#123; snowcanvas.width = window.innerWidth; /* snowcanvas.height = window.innerHeight */ &#125;&#125;/* é›ªè¿åŠ¨å¯¹è±¡ */function flakeMove(canvasWidth, canvasHeight, flakeSize, fallSpeed) &#123; this.x = Math.floor(Math.random() * canvasWidth); /* xåæ ‡ */ this.y = Math.floor(Math.random() * canvasHeight); /* yåæ ‡ */ this.size = Math.random() * flakeSize + 2; /* å½¢çŠ¶ */ this.maxSize = flakeSize; /* æœ€å¤§å½¢çŠ¶ */ this.speed = Math.random() * 1 + fallSpeed; /* å è½é€Ÿåº¦ */ this.fallSpeed = fallSpeed; /* å è½é€Ÿåº¦ */ this.velY = this.speed; /* Yæ–¹å‘é€Ÿåº¦ */ this.velX = 0; /* Xæ–¹å‘é€Ÿåº¦ */ this.stepSize = Math.random() / 30; /* æ­¥é•¿ */ this.step = 0 /* æ­¥æ•° */&#125;flakeMove.prototype.update = function() &#123; var x = this.x, y = this.y; /* å·¦å³æ‘†åŠ¨(ä½™å¼¦) */ this.velX *= 0.98; if (this.velY &lt;= this.speed) &#123; this.velY = this.speed &#125; this.velX += Math.cos(this.step += .05) * this.stepSize; this.y += this.velY; this.x += this.velX; /* é£žå‡ºè¾¹ç•Œçš„å¤„ç† */ if (this.x &gt;= canvas.width || this.x &lt;= 0 || this.y &gt;= canvas.height || this.y &lt;= 0) &#123; this.reset(canvas.width, canvas.height) &#125;&#125;;/* é£žå‡ºè¾¹ç•Œ-æ”¾ç½®æœ€é¡¶ç«¯ç»§ç»­å è½ */flakeMove.prototype.reset = function(width, height) &#123; this.x = Math.floor(Math.random() * width); this.y = 0; this.size = Math.random() * this.maxSize + 2; this.speed = Math.random() * 1 + this.fallSpeed; this.velY = this.speed; this.velX = 0;&#125;;// æ¸²æŸ“é›ªèŠ±-éšæœºå½¢çŠ¶ï¼ˆæ­¤å¤„å¯ä¿®æ”¹é›ªèŠ±é¢œè‰²ï¼ï¼ï¼ï¼‰flakeMove.prototype.render = function(ctx) &#123; var snowFlake = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size); snowFlake.addColorStop(0, "rgba(255, 255, 255, 0.9)"); /* æ­¤å¤„æ˜¯é›ªèŠ±é¢œè‰²ï¼Œé»˜è®¤æ˜¯ç™½è‰² */ snowFlake.addColorStop(.5, "rgba(255, 255, 255, 0.5)"); /* è‹¥è¦æ”¹ä¸ºå…¶ä»–é¢œè‰²ï¼Œè¯·è‡ªè¡ŒæŸ¥ */ snowFlake.addColorStop(1, "rgba(255, 255, 255, 0)"); /* æ‰¾16è¿›åˆ¶çš„RGB é¢œè‰²ä»£ç ã€‚ */ ctx.save(); ctx.fillStyle = snowFlake; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); ctx.restore();&#125;;/* åˆ›å»ºé›ªèŠ±-å®šä¹‰å½¢çŠ¶ */function createFlakes() &#123; var maxFlake = this.maxFlake, flakes = this.flakes = [], canvas = this.canvas; for (var i = 0; i &lt; maxFlake; i++) &#123; flakes.push(new flakeMove(canvas.width, canvas.height, this.flakeSize, this.fallSpeed)) &#125;&#125;/* ç”»é›ª */function drawSnow() &#123; var maxFlake = this.maxFlake, flakes = this.flakes; ctx = this.ctx, canvas = this.canvas, that = this; /* æ¸…ç©ºé›ªèŠ± */ ctx.clearRect(0, 0, canvas.width, canvas.height); for (var e = 0; e &lt; maxFlake; e++) &#123; flakes[e].update(); flakes[e].render(ctx); &#125; /* ä¸€å¸§ä¸€å¸§çš„ç”» */ this.loop = requestAnimationFrame(function() &#123; drawSnow.apply(that); &#125;);&#125;/* è°ƒç”¨åŠæŽ§åˆ¶æ–¹æ³• */var snow = new snowFall(&#123;maxFlake:60&#125;);snow.start(); ç„¶åŽåœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12&lt;!-- é›ªèŠ±ç‰¹æ•ˆ --&gt;&lt;script type="text/javascript" src="\js\snow.js"&gt;&lt;/script&gt; å¦‚æžœæ²¡æ•ˆæžœï¼Œè¯·ç¡®è®¤ç½‘é¡µæ˜¯å¦å·²è½½å…¥JQureyï¼Œå¦‚æžœæ²¡æœ‰è¯·åœ¨ä¸‹é›ªä»£ç ä¹‹å‰å¼•å…¥JQå³å¯ï¼š 12&lt;script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"&gt;&lt;/script&gt; æ·»åŠ èƒŒæ™¯åŠ¨æ€å½©å¸¦æ•ˆæžœ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12345&lt;!-- æ ·å¼ä¸€ï¼ˆé¼ æ ‡ç‚¹å‡»æ›´æ¢æ ·å¼ï¼‰ --&gt;&lt;script src="https://g.joyinshare.com/hc/ribbon.min.js" type="text/javascript"&gt;&lt;/script&gt;&lt;!-- æ ·å¼äºŒï¼ˆé£˜åŠ¨çš„å½©å¸¦ï¼‰ --&gt;&lt;script src="https://g.joyinshare.com/hc/piao.js" type="text/javascript"&gt;&lt;/script&gt; æ·»åŠ èƒŒæ™¯ä»£ç é›¨ç‰¹æ•ˆ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª DigitalRain.js æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657window.onload = function()&#123; //èŽ·å–ç”»å¸ƒå¯¹è±¡ var canvas = document.getElementById("canvas"); //èŽ·å–ç”»å¸ƒçš„ä¸Šä¸‹æ–‡ var context =canvas.getContext("2d"); var s = window.screen; var W = canvas.width = s.width; var H = canvas.height; //èŽ·å–æµè§ˆå™¨å±å¹•çš„å®½åº¦å’Œé«˜åº¦ //var W = window.innerWidth; //var H = window.innerHeight; //è®¾ç½®canvasçš„å®½åº¦å’Œé«˜åº¦ canvas.width = W; canvas.height = H; //æ¯ä¸ªæ–‡å­—çš„å­—ä½“å¤§å° var fontSize = 12; //è®¡ç®—åˆ— var colunms = Math.floor(W /fontSize); //è®°å½•æ¯åˆ—æ–‡å­—çš„yè½´åæ ‡ var drops = []; //ç»™æ¯ä¸€ä¸ªæ–‡å­—åˆå§‹åŒ–ä¸€ä¸ªèµ·å§‹ç‚¹çš„ä½ç½® for(var i=0;i&lt;colunms;i++)&#123; drops.push(0); &#125; //è¿åŠ¨çš„æ–‡å­— var str ="WELCOME TO WWW.ITRHX.COM"; //4:fillText(str,x,y);åŽŸç†å°±æ˜¯åŽ»æ›´æ”¹yçš„åæ ‡ä½ç½® //ç»˜ç”»çš„å‡½æ•° function draw()&#123; context.fillStyle = "rgba(238,238,238,.08)";//é®ç›–å±‚ context.fillRect(0,0,W,H); //ç»™å­—ä½“è®¾ç½®æ ·å¼ context.font = "600 "+fontSize+"px Georgia"; //ç»™å­—ä½“æ·»åŠ é¢œè‰² context.fillStyle = ["#33B5E5", "#0099CC", "#AA66CC", "#9933CC", "#99CC00", "#669900", "#FFBB33", "#FF8800", "#FF4444", "#CC0000"][parseInt(Math.random() * 10)];//randColor();å¯ä»¥rgb,hsl, æ ‡å‡†è‰²ï¼Œåå…­è¿›åˆ¶é¢œè‰² //å†™å…¥ç”»å¸ƒä¸­ for(var i=0;i&lt;colunms;i++)&#123; var index = Math.floor(Math.random() * str.length); var x = i*fontSize; var y = drops[i] *fontSize; context.fillText(str[index],x,y); //å¦‚æžœè¦æ”¹å˜æ—¶é—´ï¼Œè‚¯å®šå°±æ˜¯æ”¹å˜æ¯æ¬¡ä»–çš„èµ·ç‚¹ if(y &gt;= canvas.height &amp;&amp; Math.random() &gt; 0.99)&#123; drops[i] = 0; &#125; drops[i]++; &#125; &#125;; function randColor()&#123;//éšæœºé¢œè‰² var r = Math.floor(Math.random() * 256); var g = Math.floor(Math.random() * 256); var b = Math.floor(Math.random() * 256); return "rgb("+r+","+g+","+b+")"; &#125; draw(); setInterval(draw,35);&#125;; ç„¶åŽåœ¨ \themes\next\source\css\_custom\custom.styl ä¸­å†™å…¥æ ·å¼ï¼š 12345678910canvas &#123; position: fixed; right: 0px; bottom: 0px; min-width: 100%; min-height: 100%; height: auto; width: auto; z-index: -1;&#125; åœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123&lt;!-- ä»£ç é›¨ --&gt; &lt;canvas id="canvas" width="1440" height="900" &gt;&lt;/canvas&gt; &lt;script type="text/javascript" src="/js/DigitalRain.js"&gt;&lt;/script&gt; ä»£ç å—å¤åˆ¶åŠŸèƒ½ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• ä¸‹è½½ clipboard.js clipboard.js clipboard.min.js æŽ¨è ä¿å­˜æ–‡ä»¶clipboard.js / clipboard.min.js åˆ°è·¯å¾„\themes\next\source\js\srcä¸‹ã€‚ ä½¿ç”¨clipboard.js ä¹Ÿæ˜¯åœ¨ \themes\next\source\js\src ç›®å½•ä¸‹ï¼Œåˆ›å»ºclipboard-use.jsï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516/*é¡µé¢è½½å…¥å®ŒæˆåŽï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/!function (e, t, a) &#123; /* code */ var initCopyCode = function()&#123; var copyHtml = ''; copyHtml += '&lt;button class="btn-copy" data-clipboard-snippet=""&gt;'; copyHtml += ' &lt;i class="fa fa-globe"&gt;&lt;/i&gt;&lt;span&gt;copy&lt;/span&gt;'; copyHtml += '&lt;/button&gt;'; $(".highlight .code pre").before(copyHtml); new ClipboardJS('.btn-copy', &#123; target: function(trigger) &#123; return trigger.nextElementSibling; &#125; &#125;); &#125; initCopyCode(); åœ¨\themes\next\source\css\_custom\custom.stylæ ·å¼æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536//ä»£ç å—å¤åˆ¶æŒ‰é’®.highlight&#123; //æ–¹ä¾¿copyä»£ç æŒ‰é’®ï¼ˆbtn-copyï¼‰çš„å®šä½ position: relative;&#125;.btn-copy &#123; display: inline-block; cursor: pointer; background-color: #eee; background-image: linear-gradient(#fcfcfc,#eee); border: 1px solid #d5d5d5; border-radius: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-appearance: none; font-size: 13px; font-weight: 700; line-height: 20px; color: #333; -webkit-transition: opacity .3s ease-in-out; -o-transition: opacity .3s ease-in-out; transition: opacity .3s ease-in-out; padding: 2px 6px; position: absolute; right: 5px; top: 5px; opacity: 0;&#125;.btn-copy span &#123; margin-left: 5px;&#125;.highlight:hover .btn-copy&#123; opacity: 1;&#125; å¼•ç”¨ åœ¨\themes\next\layout\_layout.swigæ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¼•ç”¨ï¼ˆæ³¨ï¼šåœ¨ swig æœ«å°¾æˆ– body ç»“æŸæ ‡ç­¾ï¼ˆ&lt;/body&gt;ï¼‰ä¹‹å‰æ·»åŠ ï¼‰ï¼š 123&lt;!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ --&gt; &lt;script type="text/javascript" src="/js/src/clipboard.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="/js/src/clipboard-use.js"&gt;&lt;/script&gt; Hexoæ–‡ç« ä¸­å›¾ç‰‡ç‚¹å‡»å®žçŽ°å…¨å±æŸ¥çœ‹ ä½¿ç”¨å›¾ç‰‡æµè§ˆæ”¾å¤§åŠŸèƒ½fancyboxæ’ä»¶ã€‚ åˆ‡æ¢åˆ°libç›®å½• 1$ cd next/source/lib ä¸‹è½½æ’ä»¶ 1$ git clone https://github.com/theme-next/theme-next-fancybox3 fancybox æ›´æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ 1fancybox: true 3DåŠ¨æ€æ ‡ç­¾äº‘ å®‰è£…æ ‡ç­¾äº‘hexo-tag-cloudæ’ä»¶ 1$ cnpm install hexo-tag-cloud@^2.* --save é…ç½®sidebar.swigæ–‡ä»¶ æ‰“å¼€next/layout/_macro/sidebar.swigï¼Œè¾“å…¥ï¼š 1234567891011&#123;% if site.tags.length &gt; 1 %&#125;&lt;script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"&gt;&lt;/script&gt;&lt;div class="widget-wrap"&gt; &lt;div id="myCanvasContainer" class="widget tagcloud"&gt; &lt;canvas width="250" height="250" id="resCanvas" style="width=100%"&gt; &#123;&#123; list_tags() &#125;&#125; &lt;/canvas&gt; &lt;/div&gt;&lt;/div&gt;&#123;% endif %&#125; æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¾åœ¨åˆé€‚çš„ä½ç½®ã€‚é‡æ–°hexo sä¸€ä¸‹ï¼Œå°±å¯ä»¥å‡ºçŽ°åˆšåˆšé‚£ä¸ª3dæ ‡ç­¾äº‘äº†! æ·»åŠ å¡é€šäººç‰© æ•ˆæžœå¦‚ä¸‹å›¾ï¼š å®žçŽ°æ–¹æ³• ä¸‹è½½ live2d 1$ cnpm install --save hexo-helper-live2d ä¸‹è½½æ¨¡åž‹ 1$ cnpm install live2d-widget-model-z16 æ›´å¤šæ¨¡åž‹é€‰æ‹©è¯· ç‚¹å‡»æ­¤å¤„ï¼Œ å„ä¸ªæ¨¡åž‹çš„é¢„è§ˆè¯· ç‚¹å‡»æ­¤å¤„ ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334#æ·»åŠ èŒå® ï¼Œä»¥ä¸‹ä»»é€‰ä¸€ä¸ª#live2d-widget-model-chitose#live2d-widget-model-epsilon2_1#live2d-widget-model-gf#live2d-widget-model-haru/01 (use npm install --save live2d-widget-model-haru)#live2d-widget-model-haru/02 (use npm install --save live2d-widget-model-haru)#live2d-widget-model-haruto#live2d-widget-model-hibiki#live2d-widget-model-hijiki#live2d-widget-model-izumi#live2d-widget-model-koharu#live2d-widget-model-miku#live2d-widget-model-ni-j#live2d-widget-model-nico#live2d-widget-model-nietzsche#live2d-widget-model-nipsilon#live2d-widget-model-nito#live2d-widget-model-shizuku#live2d-widget-model-tororo#live2d-widget-model-tsumiki#live2d-widget-model-unitychan#live2d-widget-model-wanko#live2d-widget-model-z16live2d: enable: true scriptFrom: local model: use: live2d-widget-model-z16 display: position: right #æ¨¡åž‹ä½ç½® width: 140 #æ¨¡åž‹å®½åº¦ height: 260 #æ¨¡åž‹é«˜åº¦ mobile: show: false #æ˜¯å¦åœ¨æ‰‹æœºç«¯æ˜¾ç¤º å¡é€šäººç‰©å‡çº§ç‰ˆ æ•ˆæžœå¦‚ä¸‹å›¾ï¼š èƒ½è¯´è¯ã€èƒ½æ¢è£…ã€èƒ½çŽ©æ¸¸æˆã€èƒ½æ‹ç…§ã€è¿˜èƒ½è‡ªå®šä¹‰ã€‚ å®žçŽ°æ–¹æ³• ä¸‹è½½ å¼ ä¹¦æ¨µ å¤§ç¥žçš„é¡¹ç›®ï¼Œè§£åŽ‹åˆ°æœ¬åœ°åšå®¢ç›®å½•çš„themes/next/sourceä¸‹ï¼Œä¿®æ”¹autoload.jsæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š å°† 1234const live2d_path = "https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/";æ”¹ä¸ºconst live2d_path = "/live2d-widget/"; åœ¨/themes/next/layout/_layout.swingä¸­,æ–°å¢žå¦‚ä¸‹å†…å®¹ï¼š 1&lt;script src="/live2d-widget/autoload.js"&gt;&lt;/script&gt; åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ ä¸­,æ–°å¢žå¦‚ä¸‹å†…å®¹ï¼š 12live2d: enable: true æƒ³ä¿®æ”¹çœ‹æ¿å¨˜å¤§å°ã€ä½ç½®ã€æ ¼å¼ã€æ–‡æœ¬å†…å®¹ç­‰ï¼Œå¯æŸ¥çœ‹å¹¶ä¿®æ”¹ waifu-tips.js ã€ waifu-tips.json å’Œ waifu.cssã€‚ æ‰©å±•çœ‹æ¿å¨˜æ¨¡åž‹ ç”±äºŽå®˜æ–¹çš„çœ‹æ¿å¨˜æ¨¡åž‹æ¯”è¾ƒå°‘ï¼Œå¯æ‰‹åŠ¨æ·»åŠ æ¨¡åž‹ã€‚ æŠŠ githubæ¨¡åž‹ ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£åŽ‹åŽå°†assetsç›®å½•æ‹·è´åˆ°åšå®¢æ ¹ç›®å½•ä¸­çš„live2d_modelsï¼ˆè‡ªå·±æ–°å»ºï¼Œæ–‡ä»¶åä¸å¯æ”¹ï¼‰é‡Œï¼Œå†ä¿®æ”¹_config.yml é‡Œçš„ live2dä¸­model.useå³å¯ï¼ˆæ”¹ä¸ºlive2d_modelsä¸­çš„æ¨¡åž‹åå­—å°±è¡Œï¼‰ã€‚ åŽ»æŽ‰é¡¶éƒ¨é»‘çº¿ æ‰“å¼€themes\next\source\css\_custom\custom.stylæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 1.headband &#123;display:none;&#125; ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’ æ–¹æ³•ä¸€ åœ¨/themes/next/source/css/_variables/custom.stylæ–‡ä»¶ç§æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆä»¥Geminié£Žæ ¼ä¸ºä¾‹ï¼‰ï¼š 123456789101112131415// ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’// Variables of Gemini scheme// =================================================@import "Pisces.styl";// Settings for some of the most global styles.// --------------------------------------------------$body-bg-color = #eee// Borders.// --------------------------------------------------$box-shadow-inner = 0 2px 2px 0 rgba(0,0,0,.12), 0 3px 1px -2px rgba(0,0,0,.06), 0 1px 5px 0 rgba(0,0,0,.12)$box-shadow = 0 2px 2px 0 rgba(0,0,0,.12), 0 3px 1px -2px rgba(0,0,0,.06), 0 1px 5px 0 rgba(0,0,0,.12), 0 -1px .5px 0 rgba(0,0,0,.09)$border-radius-inner = initial$border-radius = initial$border-radius-inner = 15px 15px 15px 15px;$border-radius = 15px; æ–¹æ³•äºŒ åœ¨\themes\next\source\css\_variables\Gemini.stylæ–‡ä»¶ä¸­ç›´æŽ¥æ·»åŠ ï¼š 123// ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’$border-radius-inner = 15px 15px 15px 15px;$border-radius = 15px; æ•ˆæžœå¦‚ä¸‹å›¾ï¼š è‡ªé€‚åº”èƒŒæ™¯å›¾ç‰‡ åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶å¤¹/themes/next/source/images/æ”¾å…¥ä½ çš„èƒŒæ™¯å›¾ç‰‡; ç„¶åŽä¿®æ”¹ä¸»é¢˜æ–‡ä»¶å¤¹themes/source/css/_custom/custom.stylï¼Œåœ¨custom.stylå¼€å¤´åŠ å…¥å¦‚ä¸‹çš„ä»£ç : 12345678910111213141516body &#123; background: url(/images/background.jpg); background-repeat: no-repeat; background-attachment: fixed; background-position: 50% 50%; background-size: cover; -webkit-background-size: cover; -o-background-size: cover; -moz-background-size: cover; -ms-background-size: cover; /*è¿™æ˜¯è®¾ç½®åº•éƒ¨æ–‡å­—, çœ‹ä¸ªäººéœ€è¦ä¿®æ”¹*/ #footer &gt; div &gt; div &#123; color: #eee; &#125;&#125; é˜²æ­¢æ¯æ¬¡heox clean åŽCNAMEæ–‡ä»¶è¢«åˆ é™¤ å…ˆæŠŠgithubä¸­çš„CNAMEæ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°æœ¬åœ°public å†å®‰è£…æ’ä»¶ 1cnpm install hexo-generator-cname --save æ ¹ç›®å½•_config.ymlä¸­æ·»åŠ  12Plugins:- hexo-generator-cname å¹¶ä¿®æ”¹ 1url: yoursite.com åŽ»é™¤valineçš„Powered By ä¿®æ”¹\themes\next\layout\_third-party\comments\valine.swigæ–‡ä»¶ 123456789101112new Valine(&#123;...pageSize:'&#123;&#123; theme.valine.pageSize &#125;&#125;' || 10,&#125;);//æ–°å¢žä»¥ä¸‹ä»£ç å³å¯ï¼Œå¯ä»¥ç§»é™¤.infoä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ã€‚var infoEle = document.querySelector('#comments .info');if (infoEle &amp;&amp; infoEle.childNodes &amp;&amp; infoEle.childNodes.length &gt; 0)&#123; infoEle.childNodes.forEach(function(item) &#123; item.parentNode.removeChild(item); &#125;);&#125; å¢žåŠ è¯äº‘ å¢žåŠ ä¹‹å‰çš„æ•ˆæžœå¦‚ä¸‹å›¾ï¼š æ–¹æ³•æ¯”è¾ƒç®€å•ï¼ŒåŠ ä¸ªjsè„šæœ¬å°±å¥½äº†ï¼Œå°±åŠ åœ¨æ ‡ç­¾çš„é‚£ä¸ªé¡µé¢å¥½äº†ã€‚ æ‰“å¼€themes\next\layout\page.swig æ‰¾åˆ° 1&#123;% if page.type === "tags" %&#125; å°†ä¸‹é¢è¿™æ®µä»£ç : 123456789101112131415161718&lt;div class="tag-cloud"&gt; &lt;div class="tag-cloud-title"&gt; &#123;% set visibleTags = 0 %&#125; &#123;% for tag in site.tags %&#125; &#123;% if tag.length %&#125; &#123;% set visibleTags += 1 %&#125; &#123;% endif %&#125; &#123;% endfor %&#125; &#123;&#123; _p('counter.tag_cloud', visibleTags) &#125;&#125; &lt;/div&gt; &lt;div class="tag-cloud-tags"&gt; &#123;% if not theme.tagcloud %&#125; &#123;&#123; tagcloud(&#123;min_font: 12, max_font: 30, amount: 200, color: true, start_color: '#ccc', end_color: '#111'&#125;) &#125;&#125; &#123;% else %&#125; &#123;&#123; tagcloud(&#123;min_font: 13, max_font: 31, amount: 1000, color: true, start_color: '#9733EE', end_color: '#FF512F'&#125;) &#125;&#125; &#123;% endif %&#125; &lt;/div&gt;&lt;/div&gt; æ¢æˆä¸‹é¢è¿™æ®µä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;div class="tag-cloud"&gt; &lt;!-- &lt;div class="tag-cloud-title"&gt; &#123;&#123; _p('counter.tag_cloud', site.tags.length) &#125;&#125; &lt;/div&gt; --&gt; &lt;div class="tag-cloud-tags" id="tags"&gt; &#123;&#123; tagcloud(&#123;min_font: 16, max_font: 16, amount: 300, color: true, start_color: '#fff', end_color: '#fff'&#125;) &#125;&#125; &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;script type="text/javascript"&gt; var alltags=document.getElementById('tags'); var tags=alltags.getElementsByTagName('a'); for (var i = tags.length - 1; i &gt;= 0; i--) &#123; var r=Math.floor(Math.random()*75+130); var g=Math.floor(Math.random()*75+100); var b=Math.floor(Math.random()*75+80); tags[i].style.background = "rgb("+r+","+g+","+b+")"; &#125;&lt;/script&gt;&lt;style type="text/css"&gt; div#posts.posts-expand .tag-cloud a&#123; background-color: #f5f7f1; border-radius: 6px; padding-left: 10px; padding-right: 10px; margin-top: 18px; &#125; .tag-cloud a&#123; background-color: #f5f7f1; border-radius: 4px; padding-right: 5px; padding-left: 5px; margin-right: 5px; margin-left: 0px; margin-top: 8px; margin-bottom: 0px; &#125; .tag-cloud a:before&#123; content: "ðŸ“œ"; &#125; .tag-cloud-tags&#123; text-align: left; counter-reset: tags; &#125;&lt;/style&gt; æ•ˆæžœå¦‚ä¸‹å›¾ï¼š ä»£ç å—Mac Panelç‰¹æ•ˆ å…ˆä¸Šæ•ˆæžœå›¾ï¼š èƒ½è®¾ç½®é˜´å½±æ•ˆæžœå’Œå®žçŽ°æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ï¼Œä¸è¿‡æ–‡æœ¬åªå­˜åœ¨æµè§ˆå™¨é¡µé¢ä¸Šï¼Œä¸ä¼šçœŸæ­£ä¿å­˜ã€‚ å®žçŽ°æ­¥éª¤ å¼•å…¥JS è¿™é‡Œéœ€è¦æ–°å»ºä¸¤ä¸ªjsæ–‡ä»¶events.jså’Œcodeblock.jsï¼Œè·¯å¾„ä½äºŽ/themes/next/scripts/åŒ…ä¸‹ã€‚ events.jsä»£ç ï¼š 1234567// mac Panelæ•ˆæžœä»£ç å—ç›¸å…³var exec = require('child_process').exec;// new åŽè‡ªåŠ¨æ‰“å¼€ç¼–è¾‘å™¨hexo.on('new', function(data)&#123; exec('open -a MacDown ' + data.path);&#125;); codeblock.jsä»£ç ï¼š 12345678910111213141516171819202122// mac Panelæ•ˆæžœä»£ç å—ç›¸å…³var attributes = [ 'autocomplete="off"', 'autocorrect="off"', 'autocapitalize="off"', 'spellcheck="false"', 'contenteditable="true"']var attributesStr = attributes.join(' ')hexo.extend.filter.register('after_post_render', function (data) &#123; while (/&lt;figure class="highlight ([a-zA-Z]+)"&gt;.*?&lt;\/figure&gt;/.test(data.content)) &#123; data.content = data.content.replace(/&lt;figure class="highlight ([a-zA-Z]+)"&gt;.*?&lt;\/figure&gt;/, function () &#123; var language = RegExp.$1 || 'plain' var lastMatch = RegExp.lastMatch lastMatch = lastMatch.replace(/&lt;figure class="highlight /, '&lt;figure class="iseeu highlight /') return '&lt;div class="highlight-wrap"' + attributesStr + 'data-rel="' + language.toUpperCase() + '"&gt;' + lastMatch + '&lt;/div&gt;' &#125;) &#125; return data&#125;) å¼•å…¥CSS åœ¨/themes/next/source/css/_common/components/highlight/ç›®å½•ä¸‹æ–°å»ºmacPanel.stylæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// mac Panelæ•ˆæžœä»£ç å—ç›¸å…³.highlight-wrap[data-rel] &#123; position: relative; overflow: hidden; border-radius: 5px; //box-shadow: 0 10px 30px 0px rgba(0, 0, 0, 0.4); box-shadow:18px 18px 15px 0px rgba(0,0,0,.4) margin: 35px 0; ::-webkit-scrollbar &#123; height: 10px; &#125; ::-webkit-scrollbar-track &#123; -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3); border-radius: 10px; &#125; ::-webkit-scrollbar-thumb &#123; border-radius: 10px; -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5); &#125; &amp;::before &#123; color: white; content: attr(data-rel); height: 38px; line-height: 38px; //background: #21252b; background: #108414de; color: #fff; font-size: 16px; //position: absolute; top: 0; left: 0; width: 100%; //font-family: 'Source Sans Pro', sans-serif; font-weight: bold; padding: 0px 80px; text-indent: 15px; float: left; &#125; &amp;::after &#123; content: ' '; position: absolute; -webkit-border-radius: 50%; border-radius: 50%; background: #fc625d; width: 12px; height: 12px; top: 0; left: 20px; margin-top: 13px; -webkit-box-shadow: 20px 0px #fdbc40, 40px 0px #35cd4b; box-shadow: 20px 0px #fdbc40, 40px 0px #35cd4b; z-index: 3; &#125;&#125; æ­¤cssæ˜¯æ ¹æ®æˆ‘æœ¬åœ°çš„æ ·å¼åšè¿‡è°ƒæ•´ï¼Œæ³¨é‡Šçš„ä»£ç ä¸ºåŽŸæœ‰çš„ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´æ ·å¼å³å¯ã€‚ é…ç½®å¼•ç”¨ åœ¨/themes/next/source/css/_common/components/highlight/highlight.stylæ–‡ä»¶ä¸­å¼•å…¥åˆšæ‰æ–°å»ºçš„macPanel.stylï¼š 1@require "macPanel" é…ç½®åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä½ç½®å³å¯ã€‚ åˆ°æ­¤Mac Panelå·²é…ç½®å®Œæˆï¼Œæ ¹æ®éœ€è¦å¯è°ƒæ•´ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„highlight_themeé€‰é¡¹ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ ·å¼ã€‚ å¯èƒ½é‡åˆ°çš„é—®é¢˜ å¦‚æžœåœ¨é…ç½®å®Œæ¯•åŽï¼Œhexoå¯åŠ¨æŠ¥é”™ï¼Œå¯å°†ç«™ç‚¹é…ç½®æ–‡ä»¶é‡Œçš„highlightå±žæ€§auto_detectæ”¹æˆfalseï¼š 123456highlight: enable: true line_number: true- auto_detect: true+ auto_detect: false tab_replace: å¦‚æžœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯ä»”ç»†æ£€æŸ¥ä¸€ä¸‹åˆšæ‰æ–°å»ºçš„æ–‡ä»¶ã€ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰ä»€ä¹ˆåœ°æ–¹é…ç½®é”™äº†ï¼Œæˆ–è€…æ˜¯è¯­æ³•ä¸Šçš„é”™è¯¯,ä¿®æ”¹åŽé‡æ–°å¯åŠ¨å³å¯çœ‹åˆ°æ•ˆæžœã€‚ ä¸ºæ–‡ç« ç”Ÿæˆæ°¸ä¹…é“¾æŽ¥ hexoé»˜è®¤çš„æ–‡ç« é“¾æŽ¥å½¢å¼ä¸ºyear/:month/:day/:titleï¼Œæ˜¯æŒ‰ç…§å¹´ã€æœˆã€æ—¥ã€æ ‡é¢˜æ¥ç”Ÿæˆçš„ã€‚å½“æŠŠæ–‡ç« æºæ–‡ä»¶åæ”¹æŽ‰ä¹‹åŽï¼Œé“¾æŽ¥ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™å¾ˆä¸å‹å¥½ã€‚å¹¶ä¸”å¦‚æžœæ–‡ç« æ ‡é¢˜æ˜¯ä¸­æ–‡çš„ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„å°±ä¼šå‡ºçŽ°ä¸­æ–‡å­—ç¬¦ã€‚åœ¨è·¯å¾„ä¸­å‡ºçŽ°äº†ä¸­æ–‡å­—ç¬¦å¾ˆå®¹æ˜“å¼•å‘å„ç§é—®é¢˜ï¼Œè€Œä¸”ä¹Ÿä¸åˆ©äºŽseoï¼Œå› ä¸ºè·¯å¾„åŒ…å«äº†å¹´æœˆæ—¥ä¸‰ä¸ªå±‚çº§ï¼Œå±‚çº§å¤ªæ·±ä¸åˆ©äºŽç™¾åº¦èœ˜è››æŠ“å–ã€‚ è§£å†³åŠžæ³•å°±æ˜¯åˆ©ç”¨å…¶å®ƒçš„æ’ä»¶æ¥ç”Ÿæˆå”¯ä¸€çš„è·¯å¾„ï¼Œè¿™æ ·å°±ç®—æ–‡ä»¶æ ‡é¢˜éšæ„ä¿®æ”¹ï¼Œè€Œä¸ä¼šå¯¼è‡´åŽŸæœ¬çš„é“¾æŽ¥å¤±æ•ˆè€Œé€ æˆç«™ç‚¹ä¸‹å­˜åœ¨å¤§é‡çš„æ­»é“¾ã€‚ å®‰è£…æ’ä»¶ 1cnpm install hexo-abbrlink --save &lt;font color=&quot;red&quot;&gt;æ³¨æ„ï¼šæ‰§è¡Œæ­¤å‘½ä»¤å¯èƒ½ä¼šä¸æˆåŠŸï¼Œæç¤ºä½ ç¼ºå°‘ç›¸åº”çš„ä¾èµ–ï¼Œæ¯”å¦‚babel-eslintã€mini-css-extract-pluginã€webpack-cliâ€¦ä½¿ç”¨npmå‘½ä»¤å®‰è£…å³å¯ã€‚&lt;/font&gt;æ¯”å¦‚ï¼š 1npm install eslint@4.x babel-eslint@8 --save-dev é…ç½® ä¿®æ”¹æ ¹ç›®å½•ç«™ç‚¹é…ç½®æ–‡ä»¶config.ymlï¼Œæ”¹ä¸ºï¼š 1234permalink: posts/:abbrlink.html # æ­¤å¤„å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æŽ¥ä½¿ç”¨ /:abbrlinkabbrlink: alg: crc32 #ç®—æ³•ï¼š crc16(default) and crc32 rep: hex #è¿›åˆ¶ï¼š dec(default) and hex è¿™é‡Œå°†é¡µé¢éƒ½æ·»åŠ äº† .html çš„åŽç¼€ï¼Œç”¨æ¥ä¼ªè£…æˆé™æ€é¡µé¢(è™½è¯´Hexoçš„é¡µé¢æœ¬èº«å°±æ˜¯é™æ€é¡µé¢)ï¼Œè¿™æ ·å¯ä»¥ç›´æŽ¥ä»Žè·¯å¾„å°±çŸ¥é“è¿™æ˜¯ä¸ªé™æ€é¡µé¢ï¼Œæ–¹ä¾¿seoã€‚ ç”Ÿæˆçš„é“¾æŽ¥å°†ä¼šæ˜¯è¿™æ ·çš„(å®˜æ–¹æ ·ä¾‹)ï¼š 12345678910crc16 &amp; hexhttps://post.zz173.com/posts/66c8.htmlcrc16 &amp; dechttps://post.zz173.com/posts/65535.htmlcrc32 &amp; hexhttps://post.zz173.com/posts/8ddf18fb.htmlcrc32 &amp; dechttps://post.zz173.com/posts/1690090958.html ç”Ÿæˆå®ŒåŽï¼ŒåŽŸmdæ–‡ä»¶çš„Front-matter å†…ä¼šå¢žåŠ abbrlink å­—æ®µï¼Œå€¼ä¸ºç”Ÿæˆçš„ID ã€‚è¿™ä¸ªå­—æ®µç¡®ä¿äº†åœ¨æˆ‘ä»¬ä¿®æ”¹äº†Front-matter å†…çš„åšå®¢æ ‡é¢˜titleæˆ–åˆ›å»ºæ—¥æœŸdateå­—æ®µä¹‹åŽè€Œä¸ä¼šæ”¹å˜é“¾æŽ¥åœ°å€ã€‚]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ThreadLocal]]></title>
    <url>%2Fposts%2F94ca0535.html</url>
    <content type="text"><![CDATA[ç®€ä»‹ ThreadLocalå¹¶éžæ˜¯ä¸€ä¸ªçº¿ç¨‹çš„æœ¬åœ°å®žçŽ°ç‰ˆæœ¬ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯threadlocalvariable(çº¿ç¨‹å±€éƒ¨å˜é‡)ã€‚ çº¿ç¨‹å±€éƒ¨å˜é‡(ThreadLocal)çš„åŠŸç”¨å°±æ˜¯ä¸ºæ¯ä¸€ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä¸ªå˜é‡å€¼çš„å‰¯æœ¬ï¼Œæ˜¯Javaä¸­ä¸€ç§è¾ƒä¸ºç‰¹æ®Šçš„çº¿ç¨‹ç»‘å®šæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå’Œå…¶å®ƒçº¿ç¨‹çš„å‰¯æœ¬å†²çªã€‚ ä»Žçº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¿æŒä¸€ä¸ªå¯¹å…¶çº¿ç¨‹å±€éƒ¨å˜é‡å‰¯æœ¬çš„éšå¼å¼•ç”¨ï¼Œåªè¦çº¿ç¨‹æ˜¯æ´»åŠ¨çš„å¹¶ä¸” ThreadLocal å®žä¾‹æ˜¯å¯è®¿é—®çš„ï¼›åœ¨çº¿ç¨‹æ¶ˆå¤±ä¹‹åŽï¼Œå…¶çº¿ç¨‹å±€éƒ¨å®žä¾‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ä¼šè¢«åžƒåœ¾å›žæ”¶ï¼ˆé™¤éžå­˜åœ¨å¯¹è¿™äº›å‰¯æœ¬çš„å…¶ä»–å¼•ç”¨ï¼‰ã€‚ é€šè¿‡ThreadLocalå­˜å–çš„æ•°æ®ï¼Œæ€»æ˜¯ä¸Žå½“å‰çº¿ç¨‹ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒJVM ä¸ºæ¯ä¸ªè¿è¡Œçš„çº¿ç¨‹ï¼Œç»‘å®šäº†ç§æœ‰çš„æœ¬åœ°å®žä¾‹å­˜å–ç©ºé—´ï¼Œä»Žè€Œä¸ºå¤šçº¿ç¨‹çŽ¯å¢ƒå¸¸å‡ºçŽ°çš„å¹¶å‘è®¿é—®é—®é¢˜æä¾›äº†ä¸€ç§éš”ç¦»æœºåˆ¶ã€‚ ThreadLocalæ˜¯å¦‚ä½•åšåˆ°ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤å˜é‡çš„å‰¯æœ¬çš„å‘¢ï¼Ÿ å®žçŽ°æ€è·¯å¾ˆç®€å•ï¼Œåœ¨ThreadLocalç±»ä¸­æœ‰ä¸€ä¸ªMapï¼Œç”¨äºŽå­˜å‚¨æ¯ä¸€ä¸ªçº¿ç¨‹çš„å˜é‡çš„å‰¯æœ¬ã€‚ æ¦‚æ‹¬èµ·æ¥è¯´ï¼Œå¯¹äºŽå¤šçº¿ç¨‹èµ„æºå…±äº«çš„é—®é¢˜ï¼ŒåŒæ­¥æœºåˆ¶é‡‡ç”¨äº†â€œä»¥æ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œè€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ã€‚å‰è€…ä»…æä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æŽ’é˜Ÿè®¿é—®ï¼Œè€ŒåŽè€…ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚ å†…éƒ¨ç»“æž„ å®žçŽ°åŽŸç† ä»Žä¸Šé¢ThreadLocalç±»å›¾ç»“æž„å¯çŸ¥ï¼ŒThreadç±»ä¸­æœ‰ä¸¤ä¸ªå˜é‡threadLocalså’ŒinheritableThreadLocalsï¼ŒäºŒè€…éƒ½æ˜¯ThreadLocalå†…éƒ¨ç±»ThreadLocalMapç±»åž‹çš„å˜é‡ã€‚ é€šè¿‡æŸ¥çœ‹å†…éƒ¨ç±»ThreadLocalMapå¯ä»¥å‘çŽ°å®žé™…ä¸Šå®ƒç±»ä¼¼äºŽä¸€ä¸ªHashMapã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„è¿™ä¸¤ä¸ªå˜é‡éƒ½ä¸ºnullï¼Œåªæœ‰å½“çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocalçš„setæˆ–è€…getæ–¹æ³•çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä»–ä»¬ã€‚ æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸æ˜¯å­˜æ”¾åœ¨ThreadLocalå®žä¾‹ä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨è°ƒç”¨çº¿ç¨‹çš„ThreadLocalså˜é‡é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒThreadLocalç±»åž‹çš„æœ¬åœ°å˜é‡æ˜¯å­˜æ”¾åœ¨å…·ä½“çš„çº¿ç¨‹ç©ºé—´ä¸Šï¼Œå…¶æœ¬èº«ç›¸å½“äºŽä¸€ä¸ªè£…è½½æœ¬åœ°å˜é‡çš„å·¥å…·å£³ï¼Œé€šè¿‡setæ–¹æ³•å°†valueæ·»åŠ åˆ°è°ƒç”¨çº¿ç¨‹çš„threadLocalsä¸­ï¼Œå½“è°ƒç”¨çº¿ç¨‹è°ƒç”¨getæ–¹æ³•æ—¶å€™èƒ½å¤Ÿä»Žå®ƒçš„threadLocalsä¸­å–å‡ºå˜é‡ã€‚å¦‚æžœè°ƒç”¨çº¿ç¨‹ä¸€ç›´ä¸ç»ˆæ­¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæœ¬åœ°å˜é‡å°†ä¼šä¸€ç›´å­˜æ”¾åœ¨ä»–çš„threadLocalsä¸­ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨æœ¬åœ°å˜é‡çš„æ—¶å€™éœ€è¦è°ƒç”¨removeæ–¹æ³•å°†threadLocalsä¸­åˆ é™¤ä¸ç”¨çš„æœ¬åœ°å˜é‡ã€‚ æ ¸å¿ƒAPI ThreadLocalç±»æä¾›å¦‚ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š 123public T get()public void set(T value)public void remove() setæ–¹æ³• 12345678910111213141516171819public void set(T value) &#123; //èŽ·å–å½“å‰çº¿ç¨‹ï¼ˆè°ƒç”¨è€…çº¿ç¨‹ï¼‰ Thread t = Thread.currentThread(); //ä»¥å½“å‰çº¿ç¨‹ä½œä¸ºkeyå€¼ï¼ŒåŽ»æŸ¥æ‰¾å¯¹åº”çš„çº¿ç¨‹å˜é‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„map ThreadLocalMap map = getMap(t); //å¦‚æžœmapä¸ä¸ºnullï¼Œå°±ç›´æŽ¥æ·»åŠ æœ¬åœ°å˜é‡ï¼Œkeyä¸ºå½“å‰çº¿ç¨‹ï¼Œå€¼ä¸ºæ·»åŠ çš„æœ¬åœ°å˜é‡å€¼ if (map != null) map.set(this, value); //å¦‚æžœmapä¸ºnullï¼Œè¯´æ˜Žé¦–æ¬¡æ·»åŠ ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºå‡ºå¯¹åº”çš„map else createMap(t, value);&#125;/** *èŽ·å–çº¿ç¨‹è‡ªå·±çš„å˜é‡threadLocalsï¼Œå¹¶ç»‘å®šåˆ°å½“å‰è°ƒç”¨çº¿ç¨‹çš„æˆå‘˜å˜é‡threadLocalsä¸Š */ThreadLocalMap getMap(Thread t) &#123; return t.threadLocals;&#125; å¦‚æžœè°ƒç”¨getMapæ–¹æ³•è¿”å›žå€¼ä¸ä¸ºnullï¼Œå°±ç›´æŽ¥å°†valueå€¼è®¾ç½®åˆ°threadLocalsä¸­ï¼ˆkeyä¸ºå½“å‰çº¿ç¨‹å¼•ç”¨ï¼Œå€¼ä¸ºæœ¬åœ°å˜é‡ï¼‰ï¼› å¦‚æžœgetMapæ–¹æ³•è¿”å›žnullè¯´æ˜Žæ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•ï¼ˆå‰é¢è¯´åˆ°è¿‡ï¼ŒthreadLocalsé»˜è®¤å€¼ä¸ºnullï¼Œåªæœ‰è°ƒç”¨setæ–¹æ³•çš„æ—¶å€™æ‰ä¼šåˆ›å»ºmapï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è°ƒç”¨createMapæ–¹æ³•åˆ›å»ºthreadLocals; 123void createMap(Thread t, T firstValue) &#123; t.threadLocals = new ThreadLocalMap(this, firstValue);&#125; createMapæ–¹æ³•ä¸ä»…åˆ›å»ºäº†threadLocalsï¼ŒåŒæ—¶ä¹Ÿå°†è¦æ·»åŠ çš„æœ¬åœ°å˜é‡å€¼æ·»åŠ åˆ°äº†threadLocalsä¸­ã€‚ getæ–¹æ³• 123456789101112131415161718192021222324252627282930313233public T get() &#123; //èŽ·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); //èŽ·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡ ThreadLocalMap map = getMap(t); //å¦‚æžœthreadLocalså˜é‡ä¸ä¸ºnullï¼Œå°±å¯ä»¥åœ¨mapä¸­æŸ¥æ‰¾åˆ°æœ¬åœ°å˜é‡çš„å€¼ if (map != null) &#123; ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) &#123; @SuppressWarnings("unchecked") T result = (T)e.value; return result; &#125; &#125; //æ‰§è¡Œåˆ°æ­¤å¤„ï¼ŒthreadLocalsä¸ºnullï¼Œè°ƒç”¨è¯¥æ›´æ”¹åˆå§‹åŒ–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡ return setInitialValue();&#125;private T setInitialValue() &#123; //protected T initialValue() &#123;return null;&#125; T value = initialValue(); //èŽ·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); //ä»¥å½“å‰çº¿ç¨‹ä½œä¸ºkeyå€¼ï¼ŒåŽ»æŸ¥æ‰¾å¯¹åº”çš„çº¿ç¨‹å˜é‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„map ThreadLocalMap map = getMap(t); //å¦‚æžœmapä¸ä¸ºnullï¼Œå°±ç›´æŽ¥æ·»åŠ æœ¬åœ°å˜é‡ï¼Œkeyä¸ºå½“å‰çº¿ç¨‹ï¼Œå€¼ä¸ºæ·»åŠ çš„æœ¬åœ°å˜é‡å€¼ if (map != null) map.set(this, value); //å¦‚æžœmapä¸ºnullï¼Œè¯´æ˜Žé¦–æ¬¡æ·»åŠ ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºå‡ºå¯¹åº”çš„map else createMap(t, value); return value;&#125; åœ¨getæ–¹æ³•çš„å®žçŽ°ä¸­ï¼Œé¦–å…ˆèŽ·å–å½“å‰è°ƒç”¨è€…çº¿ç¨‹ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹çš„threadLocalsä¸ä¸ºnullï¼Œå°±ç›´æŽ¥è¿”å›žå½“å‰çº¿ç¨‹ç»‘å®šçš„æœ¬åœ°å˜é‡å€¼ï¼Œå¦åˆ™æ‰§è¡ŒsetInitialValueæ–¹æ³•åˆå§‹åŒ–threadLocalså˜é‡ã€‚ åœ¨setInitialValueæ–¹æ³•ä¸­ï¼Œç±»ä¼¼äºŽsetæ–¹æ³•çš„å®žçŽ°ï¼Œéƒ½æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡æ˜¯å¦ä¸ºnullï¼Œæ˜¯åˆ™æ·»åŠ æœ¬åœ°å˜é‡ï¼ˆè¿™ä¸ªæ—¶å€™ç”±äºŽæ˜¯åˆå§‹åŒ–ï¼Œæ‰€ä»¥æ·»åŠ çš„å€¼ä¸ºnullï¼‰ï¼Œå¦åˆ™åˆ›å»ºthreadLocalså˜é‡ï¼ŒåŒæ ·æ·»åŠ çš„å€¼ä¸ºnullã€‚ removeæ–¹æ³• 1234567public void remove() &#123; //èŽ·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„threadLocals ThreadLocalMap m = getMap(Thread.currentThread()); //å¦‚æžœmapä¸ä¸ºnullï¼Œå°±ç§»é™¤å½“å‰çº¿ç¨‹ä¸­æŒ‡å®šThreadLocalå®žä¾‹çš„æœ¬åœ°å˜é‡ if (m != null) m.remove(this); &#125; removeæ–¹æ³•åˆ¤æ–­è¯¥å½“å‰çº¿ç¨‹å¯¹åº”çš„threadLocalså˜é‡æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±ç›´æŽ¥åˆ é™¤å½“å‰çº¿ç¨‹ä¸­æŒ‡å®šçš„threadLocalså˜é‡ã€‚ ThreadLocalMap ThreadLocalMapæ˜¯ThreadLocalçš„å†…éƒ¨ç±»ï¼Œæ²¡æœ‰å®žçŽ°MapæŽ¥å£ï¼Œç”¨ç‹¬ç«‹çš„æ–¹å¼å®žçŽ°äº†Mapçš„åŠŸèƒ½ï¼Œå…¶å†…éƒ¨çš„Entryä¹Ÿç‹¬ç«‹å®žçŽ°ã€‚ 123456789101112131415161718192021222324252627282930/** * æ˜¯ç»§æ‰¿è‡ªWeakReferenceçš„ä¸€ä¸ªç±»ï¼Œè¯¥ç±»ä¸­å®žé™…å­˜æ”¾çš„keyæ˜¯ * æŒ‡å‘ThreadLocalçš„å¼±å¼•ç”¨å’Œä¸Žä¹‹å¯¹åº”çš„valueå€¼(è¯¥valueå€¼ * å°±æ˜¯é€šè¿‡ThreadLocalçš„setæ–¹æ³•ä¼ é€’è¿‡æ¥çš„å€¼) * ç”±äºŽæ˜¯å¼±å¼•ç”¨ï¼Œå½“getæ–¹æ³•è¿”å›žnullçš„æ—¶å€™æ„å‘³ç€å‘èƒ½å¼•ç”¨ */static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; &#123; /** valueå°±æ˜¯å’ŒThreadLocalç»‘å®šçš„ */ Object value; //kï¼šThreadLocalçš„å¼•ç”¨ï¼Œè¢«ä¼ é€’ç»™WeakReferenceçš„æž„é€ æ–¹æ³• Entry(ThreadLocal&lt;?&gt; k, Object v) &#123; super(k); value = v; &#125;&#125;//WeakReferenceæž„é€ æ–¹æ³•(public class WeakReference&lt;T&gt; extends Reference&lt;T&gt; )public WeakReference(T referent) &#123; super(referent); //referentï¼šThreadLocalçš„å¼•ç”¨&#125;//Referenceæž„é€ æ–¹æ³• Reference(T referent) &#123; this(referent, null);//referentï¼šThreadLocalçš„å¼•ç”¨&#125;Reference(T referent, ReferenceQueue&lt;? super T&gt; queue) &#123; this.referent = referent; this.queue = (queue == null) ? ReferenceQueue.NULL : queue;&#125; ä»Žä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“å‰ThreadLocalçš„å¼•ç”¨kè¢«ä¼ é€’ç»™WeakReferenceçš„æž„é€ å‡½æ•°ï¼Œæ‰€ä»¥ThreadLocalMapä¸­çš„keyä¸ºThreadLocalçš„å¼±å¼•ç”¨ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ThreadLocalçš„setæ–¹æ³•è®¾ç½®å˜é‡çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹çš„ThreadLocalMapå°±ä¼šå­˜æ”¾ä¸€ä¸ªè®°å½•ï¼Œè¿™ä¸ªè®°å½•çš„keyå€¼ä¸ºThreadLocalçš„å¼±å¼•ç”¨ï¼Œvalueå°±æ˜¯é€šè¿‡setè®¾ç½®çš„å€¼ã€‚å¦‚æžœå½“å‰çº¿ç¨‹ä¸€ç›´å­˜åœ¨ä¸”æ²¡æœ‰è°ƒç”¨è¯¥ThreadLocalçš„removeæ–¹æ³•ï¼Œå¦‚æžœè¿™ä¸ªæ—¶å€™åˆ«çš„åœ°æ–¹è¿˜æœ‰å¯¹ThreadLocalçš„å¼•ç”¨ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹ä¸­çš„ThreadLocalMapä¸­ä¼šå­˜åœ¨å¯¹ThreadLocalå˜é‡çš„å¼•ç”¨å’Œvalueå¯¹è±¡çš„å¼•ç”¨ï¼Œæ˜¯ä¸ä¼šé‡Šæ”¾çš„ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ è€ƒè™‘è¿™ä¸ªThreadLocalå˜é‡æ²¡æœ‰å…¶ä»–å¼ºä¾èµ–ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹è¿˜å­˜åœ¨ï¼Œç”±äºŽçº¿ç¨‹çš„ThreadLocalMapé‡Œé¢çš„keyæ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹çš„ThreadLocalMapé‡Œé¢çš„ThreadLocalå˜é‡çš„å¼±å¼•ç”¨åœ¨gcçš„æ—¶å€™å°±è¢«å›žæ”¶ï¼Œä½†æ˜¯å¯¹åº”çš„valueè¿˜æ˜¯å­˜åœ¨çš„è¿™å°±å¯èƒ½é€ æˆå†…å­˜æ³„æ¼(å› ä¸ºè¿™ä¸ªæ—¶å€™ThreadLocalMapä¼šå­˜åœ¨keyä¸ºnullä½†æ˜¯valueä¸ä¸ºnullçš„entryé¡¹)ã€‚ æ€»ç»“ï¼šTHreadLocalMapä¸­çš„Entryçš„keyä½¿ç”¨çš„æ˜¯ThreadLocalå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œåœ¨æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯¹ThreadLocaä¾èµ–ï¼ŒThreadLocalMapä¸­çš„ThreadLocalå¯¹è±¡å°±ä¼šè¢«å›žæ”¶æŽ‰ï¼Œä½†æ˜¯å¯¹åº”çš„ä¸ä¼šè¢«å›žæ”¶ï¼Œè¿™ä¸ªæ—¶å€™Mapä¸­å°±å¯èƒ½å­˜åœ¨keyä¸ºnullä½†æ˜¯valueä¸ä¸ºnullçš„é¡¹ï¼Œè¿™éœ€è¦å®žé™…çš„æ—¶å€™ä½¿ç”¨å®Œæ¯•åŠæ—¶è°ƒç”¨removeæ–¹æ³•é¿å…å†…å­˜æ³„æ¼ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«]]></title>
    <url>%2Fposts%2F8b544b71.html</url>
    <content type="text"><![CDATA[å‰è¨€ Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºŽé”®å€¼å¯¹(Key-Value)ç±»åž‹çš„å†…å­˜æ•°æ®åº“ï¼ŒRedisçš„Valueå¯ä»¥ç”±Stringï¼Œhashï¼Œlistï¼Œsetï¼Œzsetï¼ŒBitmapsï¼ŒHyperLogLogç­‰å¤šç§æ•°æ®ç»“æž„å’Œç®—æ³•ç»„æˆã€‚æ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éžå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¯ç”¨äºŽç¼“å­˜ã€äº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ã€é«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚è¯¥æ•°æ®åº“ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é˜Ÿåˆ—ã€é›†åˆç»“æž„ç›´æŽ¥å­˜å–ï¼ŒåŸºäºŽå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨ åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚ å®˜æ–¹ç»™å‡ºçš„æ€§èƒ½å¯ä»¥è¾¾åˆ°10W+qpsï¼Œé‚£ä¹ˆRedisåˆ°åº•å¿«åœ¨å“ªå‘¢ï¼Ÿ å¼€å‘è¯­è¨€ çŽ°åœ¨æˆ‘ä»¬éƒ½ç”¨é«˜çº§è¯­è¨€æ¥ç¼–ç¨‹ï¼Œæ¯”å¦‚Javaã€pythonç­‰ã€‚ä¹Ÿè®¸ä½ ä¼šè§‰å¾—Cè¯­è¨€å¾ˆå¤è€ï¼Œä½†æ˜¯å®ƒçœŸçš„å¾ˆæœ‰ç”¨ï¼Œæ¯•ç«Ÿunixç³»ç»Ÿå°±æ˜¯ç”¨Cå®žçŽ°çš„ï¼Œæ‰€ä»¥Cè¯­è¨€æ˜¯éžå¸¸è´´è¿‘æ“ä½œç³»ç»Ÿçš„è¯­è¨€ã€‚Rediså°±æ˜¯ç”¨Cè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥æ‰§è¡Œä¼šæ¯”è¾ƒå¿«ã€‚ çº¯å†…å­˜è®¿é—® Rediså°†æ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œéžæ•°æ®åŒæ­¥æ­£å¸¸å·¥ä½œä¸­ï¼Œæ˜¯ä¸éœ€è¦ä»Žç£ç›˜è¯»å–æ•°æ®çš„ï¼Œ0æ¬¡IOã€‚å†…å­˜å“åº”æ—¶é—´å¤§çº¦ä¸º100çº³ç§’ï¼Œè¿™æ˜¯Redisé€Ÿåº¦å¿«çš„é‡è¦åŸºç¡€ã€‚ å•çº¿ç¨‹ ç¬¬ä¸€ï¼Œå•çº¿ç¨‹ç®€åŒ–ç®—æ³•çš„å®žçŽ°ï¼Œå¹¶å‘çš„æ•°æ®ç»“æž„å®žçŽ°ä¸ä½†å›°éš¾ä¸”æµ‹è¯•ä¹Ÿéº»çƒ¦ã€‚ ç¬¬äºŒï¼Œå•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢ä»¥åŠåŠ é”é‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—ï¼Œå¯¹äºŽæœåŠ¡ç«¯å¼€å‘æ¥è¯´ï¼Œé”å’Œçº¿ç¨‹åˆ‡æ¢é€šå¸¸æ˜¯æ€§èƒ½æ€æ‰‹ã€‚ å½“ç„¶äº†ï¼Œå•çº¿ç¨‹ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œä¹Ÿæ˜¯Redisçš„å™©æ¢¦ï¼šé˜»å¡žã€‚å¦‚æžœæ‰§è¡Œä¸€ä¸ªå‘½ä»¤è¿‡é•¿ï¼Œé‚£ä¹ˆä¼šé€ æˆå…¶ä»–å‘½ä»¤çš„é˜»å¡žï¼Œå¯¹äºŽRedisæ˜¯ååˆ†è‡´å‘½çš„ï¼Œæ‰€ä»¥Redisæ˜¯é¢å‘å¿«é€Ÿæ‰§è¡Œåœºæ™¯çš„æ•°æ®åº“ã€‚ é™¤äº†Redisä¹‹å¤–ï¼ŒNode.jsä¹Ÿæ˜¯å•çº¿ç¨‹ï¼ŒNginxä¹Ÿæ˜¯å•çº¿ç¨‹ï¼Œä½†ä»–ä»¬éƒ½æ˜¯æœåŠ¡å™¨é«˜æ€§èƒ½çš„å…¸èŒƒã€‚ éžé˜»å¡žå¤šè·¯I/Oå¤ç”¨æœºåˆ¶ å…ˆè¯´ä¸€ä¸‹ä¼ ç»Ÿçš„é˜»å¡žI/Oæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š å½“ä½¿ç”¨readæˆ–è€…writeå¯¹æŸä¸€æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptor FDï¼‰è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œå¦‚æžœæ•°æ®æ²¡æœ‰æ”¶åˆ°ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®ã€‚é˜»å¡žæ¨¡åž‹è™½ç„¶æ˜“äºŽç†è§£ï¼Œä½†æ˜¯åœ¨éœ€è¦å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸ä¼šä½¿ç”¨é˜»å¡žæ¨¡åž‹ã€‚ I/Oå¤šè·¯å¤ç”¨å®žé™…ä¸Šæ˜¯æŒ‡å¤šä¸ªè¿žæŽ¥çš„**ç®¡ç†å¯ä»¥åœ¨åŒä¸€è¿›ç¨‹ã€‚**å¤šè·¯æ˜¯æŒ‡ç½‘ç»œè¿žæŽ¥ï¼Œå¤ç”¨åªæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚åœ¨ç½‘ç»œæœåŠ¡ä¸­ï¼ŒI/Oå¤šè·¯å¤ç”¨èµ·çš„ä½œç”¨æ˜¯ä¸€æ¬¡æ€§æŠŠå¤šä¸ªè¿žæŽ¥çš„äº‹ä»¶é€šçŸ¥ä¸šåŠ¡ä»£ç å¤„ç†ï¼Œå¤„ç†çš„æ–¹å¼ç”±ä¸šåŠ¡ä»£ç æ¥å†³å®šã€‚åœ¨I/Oå¤šè·¯å¤ç”¨æ¨¡åž‹ä¸­ï¼Œæœ€é‡è¦çš„å‡½æ•°è°ƒç”¨å°±æ˜¯I/O å¤šè·¯å¤ç”¨å‡½æ•°ï¼Œè¯¥æ–¹æ³•èƒ½åŒæ—¶ç›‘æŽ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰çš„è¯»å†™æƒ…å†µï¼Œå½“å…¶ä¸­çš„æŸäº›fdå¯è¯»/å†™æ—¶ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¿”å›žå¯è¯»/å†™çš„fdä¸ªæ•°ã€‚ Redisä½¿ç”¨epollä½œä¸ºI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„å®žçŽ°ï¼Œå†åŠ ä¸ŠRedisè‡ªèº«çš„äº‹ä»¶å¤„ç†æ¨¡åž‹å°†epollçš„readã€writeã€closeç­‰éƒ½è½¬æ¢æˆäº‹ä»¶ï¼Œä¸åœ¨ç½‘ç»œI/Oä¸Šæµªè´¹è¿‡å¤šçš„æ—¶é—´ã€‚å®žçŽ°å¯¹å¤šä¸ªFDè¯»å†™çš„ç›‘æŽ§ï¼Œæé«˜æ€§èƒ½ã€‚ ä¸¾ä¸ªä¾‹å­:æ¯”å¦‚ä¸€ä¸ªtcpæœåŠ¡å™¨å¤„ç†20ä¸ªå®¢æˆ·ç«¯socketã€‚ Aæ–¹æ¡ˆï¼šé¡ºåºå¤„ç†ï¼Œå¦‚æžœç¬¬ä¸€ä¸ªsocketå› ä¸ºç½‘å¡è¯»æ•°æ®å¤„ç†æ…¢äº†ï¼Œä¸€é˜»å¡žï¼ŒåŽé¢éƒ½çŽ©è›‹åŽ»ã€‚ Bæ–¹æ¡ˆï¼šæ¯ä¸ªsocketè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªåˆ†èº«å­è¿›ç¨‹æ¥å¤„ç†ï¼Œä¸è¯´æ¯ä¸ªè¿›ç¨‹æ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå…‰æ˜¯è¿›ç¨‹åˆ‡æ¢å°±å¤Ÿæ“ä½œç³»ç»Ÿç´¯çš„äº†ã€‚ Cæ–¹æ¡ˆ**ï¼ˆI/Oå¤ç”¨æ¨¡åž‹ï¼Œepollï¼‰ï¼šå°†ç”¨æˆ·socketå¯¹åº”çš„fdæ³¨å†Œè¿›epollï¼ˆå®žé™…ä¸ŠæœåŠ¡å™¨å’Œæ“ä½œç³»ç»Ÿä¹‹é—´ä¼ é€’çš„ä¸æ˜¯socketçš„fdè€Œæ˜¯fd_setçš„æ•°æ®ç»“æž„ï¼‰ï¼Œç„¶åŽepollåªå‘Šè¯‰å“ªäº›éœ€è¦è¯»/å†™çš„socketï¼Œåªéœ€è¦å¤„ç†é‚£äº›æ´»è·ƒçš„ã€æœ‰å˜åŒ–çš„socket fdçš„å°±å¥½äº†ã€‚è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨epollçš„æ—¶å€™æ‰ä¼šé˜»å¡žï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡žçš„ã€‚**]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis - å¸¸ç”¨æ•°æ®ç±»åž‹åŠå‘½ä»¤]]></title>
    <url>%2Fposts%2F2853eeb9.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Redisä¸­å­˜å‚¨æ•°æ®æ˜¯é€šè¿‡key-valueæ ¼å¼å­˜å‚¨æ•°æ®çš„ï¼Œå…¶ä¸­valueå¯ä»¥å®šä¹‰äº”ç§æ•°æ®ç±»åž‹ï¼š Stringï¼ˆå­—ç¬¦ç±»åž‹ï¼‰ Hashï¼ˆæ•£åˆ—ç±»åž‹ï¼‰ Listï¼ˆåˆ—è¡¨ç±»åž‹ï¼‰ Setï¼ˆé›†åˆç±»åž‹ï¼‰ SortedSetï¼ˆæœ‰åºé›†åˆç±»åž‹ï¼Œç®€ç§°zsetï¼‰ æ³¨æ„ï¼šåœ¨redisä¸­çš„å‘½ä»¤è¯­å¥ä¸­ï¼Œå‘½ä»¤æ˜¯å¿½ç•¥å¤§å°å†™çš„ï¼Œè€Œkeyæ˜¯ä¸å¿½ç•¥å¤§å°å†™çš„ã€‚ Stringç±»åž‹ èµ‹å€¼ è¯­æ³•ï¼šset key value 12127.0.0.1:6379&gt; set k1 v1OK å–å€¼ è¯­æ³•ï¼šget key 12127.0.0.1:6379&gt; get k1&quot;v1&quot; å–å€¼å¹¶èµ‹å€¼ è¯­æ³•ï¼šgetset key value 1234127.0.0.1:6379&gt; getset k1 v2&quot;v1&quot;127.0.0.1:6379&gt; get k1&quot;v2&quot; é€’å¢žæ•°å­— è¯­æ³•ï¼šINCR key 123456127.0.0.1:6379&gt; incr num(integer) 1127.0.0.1:6379&gt; incr num(integer) 2127.0.0.1:6379&gt; incr num(integer) 3 å¢žåŠ æŒ‡å®šçš„æ•´æ•° è¯­æ³•ï¼šINCRBY key increment 123456127.0.0.1:6379&gt; incrby num 2(integer) 5127.0.0.1:6379&gt; incrby num 2(integer) 7127.0.0.1:6379&gt; incrby num 2(integer) 9 é€’å‡æ•°å€¼ è¯­æ³•ï¼šDECR key 1234 127.0.0.1:6379&gt; decr num(integer) 9127.0.0.1:6379&gt; decr num(integer) 8 å‡å°‘æŒ‡å®šçš„æ•´æ•° è¯­æ³•ï¼šDECRBY key decrement 12345678127.0.0.1:6379&gt; decr num(integer) 6127.0.0.1:6379&gt; decr num(integer) 5127.0.0.1:6379&gt; decrby num 3(integer) 2127.0.0.1:6379&gt; decrby num 3(integer) -1 ä»…å½“ä¸å­˜åœ¨æ—¶èµ‹å€¼ è¯­æ³•ï¼šsetnx key value 12345678redis&gt; EXISTS k1 # k1 ä¸å­˜åœ¨(integer) 0redis&gt; SETNX k1 &quot;v1&quot; # k1è®¾ç½®æˆåŠŸ(integer) 1redis&gt; SETNX k1 &quot;v2&quot; # å°è¯•è¦†ç›– k1ï¼Œå¤±è´¥(integer) 0redis&gt; GET k1 # æ²¡æœ‰è¢«è¦†ç›–&quot;v1&quot; å‘å°¾éƒ¨è¿½åŠ å€¼ APPENDå‘½ä»¤ï¼Œå‘é”®å€¼çš„æœ«å°¾è¿½åŠ valueã€‚å¦‚æžœé”®ä¸å­˜åœ¨åˆ™å°†è¯¥é”®çš„å€¼è®¾ç½®ä¸ºvalueï¼Œå³ç›¸å½“äºŽ SET key valueã€‚è¿”å›žå€¼æ˜¯è¿½åŠ åŽå­—ç¬¦ä¸²çš„æ€»é•¿åº¦ã€‚ è¯­æ³•ï¼šAPPEND key value 123456127.0.0.1:6379&gt; set str helloOK127.0.0.1:6379&gt; append str &quot; world!&quot;(integer) 12127.0.0.1:6379&gt; get str &quot;hello world!&quot; èŽ·å–å­—ç¬¦ä¸²é•¿åº¦ STRLENå‘½ä»¤ï¼Œè¿”å›žé”®å€¼çš„é•¿åº¦ï¼Œå¦‚æžœé”®ä¸å­˜åœ¨åˆ™è¿”å›ž0ã€‚ è¯­æ³•ï¼šSTRLEN key 123456127.0.0.1:6379&gt; strlen str (integer) 0127.0.0.1:6379&gt; set str helloOK127.0.0.1:6379&gt; strlen str (integer) 5 åŒæ—¶è®¾ç½®/èŽ·å–å¤šä¸ªé”®å€¼ è¯­æ³•ï¼š MSET key value [key value â€¦] MGET key [key â€¦] 1234567127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3OK127.0.0.1:6379&gt; get k1&quot;v1&quot;127.0.0.1:6379&gt; mget k1 k31) &quot;v1&quot;2) &quot;v3&quot; Hashç±»åž‹ hashå«æ•£åˆ—ç±»åž‹ï¼Œå®ƒæä¾›äº†å­—æ®µå’Œå­—æ®µå€¼çš„æ˜ å°„ã€‚å­—æ®µå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ç±»åž‹ï¼Œä¸æ”¯æŒæ•£åˆ—ç±»åž‹ã€é›†åˆç±»åž‹ç­‰å…¶å®ƒç±»åž‹ã€‚å¦‚ä¸‹ï¼š èµ‹å€¼ HSETå‘½ä»¤ä¸åŒºåˆ†æ’å…¥å’Œæ›´æ–°æ“ä½œï¼Œå½“æ‰§è¡Œæ’å…¥æ“ä½œæ—¶HSETå‘½ä»¤è¿”å›ž1ï¼Œå½“æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶0ã€‚ ä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHSET key field value 12127.0.0.1:6379&gt; hset user username zhangsan (integer) 1 ä¸€æ¬¡å¯ä»¥è®¾ç½®å¤šä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHMSET key field value [field value ...] 12127.0.0.1:6379&gt; hmset user age 20 username lisi OK å½“å€¼ä¸å­˜åœ¨æ‰èµ‹å€¼ å½“å­—æ®µä¸å­˜åœ¨æ—¶èµ‹å€¼ï¼Œç±»ä¼¼HSETï¼ŒåŒºåˆ«åœ¨äºŽå¦‚æžœå­—æ®µå­˜åœ¨ï¼Œè¯¥å‘½ä»¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œ è¯­æ³•ï¼šHSETNX key field value 12127.0.0.1:6379&gt; hsetnx user age 30 (integer) 0 å¦‚æžœuserä¸­æ²¡æœ‰ageå­—æ®µåˆ™è®¾ç½®ageå€¼ä¸º30ï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œ å–å€¼ ä¸€æ¬¡åªèƒ½èŽ·å–ä¸€ä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHGET key field 12127.0.0.1:6379&gt; hget user username&quot;lisiâ€œ ä¸€æ¬¡å¯ä»¥èŽ·å–å¤šä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHMGET key field [field ...] 123127.0.0.1:6379&gt; hmget user age username1) &quot;20&quot;2) &quot;lisi&quot; èŽ·å–æ‰€æœ‰å­—æ®µå€¼ è¯­æ³•ï¼šHGETALL key 12345127.0.0.1:6379&gt; hgetall user1) &quot;age&quot;2) &quot;20&quot;3) &quot;username&quot;4) &quot;lisi&quot; åˆ é™¤å­—æ®µ å¯ä»¥åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µï¼Œè¿”å›žå€¼æ˜¯è¢«åˆ é™¤çš„å­—æ®µä¸ªæ•° è¯­æ³•ï¼šHDEL key field [field ...] 123456127.0.0.1:6379&gt; hdel user age(integer) 1127.0.0.1:6379&gt; hdel user age name(integer) 0127.0.0.1:6379&gt; hdel user age username(integer) 1 å¢žåŠ æ•°å­— è¯­æ³•ï¼šHINCRBY key field increment 123456#å°†ç”¨æˆ·çš„å¹´é¾„åŠ 2127.0.0.1:6379&gt; hincrby user age 2 (integer) 22#èŽ·å–ç”¨æˆ·çš„å¹´é¾„127.0.0.1:6379&gt; hget user age &quot;22&quot; åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨ è¯­æ³•ï¼šHEXISTS key field 123456#æŸ¥çœ‹userä¸­æ˜¯å¦æœ‰ageå­—æ®µ127.0.0.1:6379&gt; hexists user age (integer) 1#æŸ¥çœ‹userä¸­æ˜¯å¦æœ‰nameå­—æ®µ127.0.0.1:6379&gt; hexists user name (integer) 0 åªèŽ·å–å­—æ®µåæˆ–å­—æ®µå€¼ è¯­æ³•ï¼š 12HKEYS keyHVALS key 12345678127.0.0.1:6379&gt; hmset user age 20 name lisi OK127.0.0.1:6379&gt; hkeys user1) &quot;age&quot;2) &quot;name&quot;127.0.0.1:6379&gt; hvals user1) &quot;20&quot;2) &quot;lisi&quot; èŽ·å–å­—æ®µæ•°é‡ è¯­æ³•ï¼šHLEN key 12127.0.0.1:6379&gt; hlen user(integer) 2 èŽ·å–æ‰€æœ‰å­—æ®µ ä½œç”¨ï¼šèŽ·å¾—hashçš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬keyå’Œvalue è¯­æ³•ï¼šhgetall key Listç±»åž‹ Redisçš„åˆ—è¡¨ç±»åž‹ï¼ˆlistï¼‰å¯ä»¥å­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¸¸ç”¨çš„æ“ä½œæ˜¯å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ ï¼Œæˆ–è€…èŽ·å¾—åˆ—è¡¨çš„æŸä¸€ä¸ªç‰‡æ®µã€‚ åˆ—è¡¨ç±»åž‹å†…éƒ¨æ˜¯ä½¿ç”¨**åŒå‘é“¾è¡¨ï¼ˆdouble linked listï¼‰**å®žçŽ°çš„ï¼Œæ‰€ä»¥å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼ŒèŽ·å–è¶ŠæŽ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ é€Ÿåº¦å°±è¶Šå¿«ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯ä¸€ä¸ªæœ‰å‡ åƒä¸‡ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼ŒèŽ·å–å¤´éƒ¨æˆ–å°¾éƒ¨çš„10æ¡è®°å½•ä¹Ÿæ˜¯æžå¿«çš„ã€‚ å‘åˆ—è¡¨å·¦è¾¹å¢žåŠ å…ƒç´  è¯­æ³•ï¼šLPUSH key value [value ...] 12127.0.0.1:6379&gt; lpush list:1 1 2 3(integer) 3 å‘åˆ—è¡¨å³è¾¹å¢žåŠ å…ƒç´  è¯­æ³•ï¼šRPUSH key value [value ...] 12127.0.0.1:6379&gt; rpush list:1 4 5 6(integer) 6 æŸ¥çœ‹åˆ—è¡¨ è¯­æ³•ï¼šLRANGE key start stop LRANGEå‘½ä»¤æ˜¯åˆ—è¡¨ç±»åž‹æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼ŒèŽ·å–åˆ—è¡¨ä¸­çš„æŸä¸€ç‰‡æ®µï¼Œå°†è¿”å›žstartã€stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ï¼Œç´¢å¼•ä»Ž0å¼€å§‹ã€‚ç´¢å¼•å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå¦‚ï¼šâ€œ-1â€ä»£è¡¨æœ€åŽè¾¹çš„ä¸€ä¸ªå…ƒç´ ã€‚ 1234127.0.0.1:6379&gt; lrange list:1 0 21) &quot;3&quot;2) &quot;2&quot;3) &quot;1&quot; ä»Žåˆ—è¡¨ä¸¤ç«¯å¼¹å‡ºå…ƒç´  LPOPå‘½ä»¤ä»Žåˆ—è¡¨å·¦è¾¹å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä¼šåˆ†ä¸¤æ­¥å®Œæˆï¼š ç¬¬ä¸€æ­¥æ˜¯å°†åˆ—è¡¨å·¦è¾¹çš„å…ƒç´ ä»Žåˆ—è¡¨ä¸­ç§»é™¤ ç¬¬äºŒæ­¥æ˜¯è¿”å›žè¢«ç§»é™¤çš„å…ƒç´ å€¼ã€‚ è¯­æ³•ï¼š 123LPOP keyRPOP key 1234127.0.0.1:6379&gt; lpop list:1&quot;3&quot;127.0.0.1:6379&gt; rpop list:1&quot;6&quot; èŽ·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•° è¯­æ³•ï¼šLLEN key 12127.0.0.1:6379&gt; llen list:1(integer) 4 åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šä¸ªæ•°çš„å€¼ LREMå‘½ä»¤ä¼šåˆ é™¤åˆ—è¡¨ä¸­å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ ï¼Œè¿”å›žå®žé™…åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚æ ¹æ®countå€¼çš„ä¸åŒï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œæ–¹å¼ä¼šæœ‰æ‰€ä¸åŒï¼š å½“count&gt;0æ—¶ï¼Œ LREMä¼šä»Žåˆ—è¡¨å·¦è¾¹å¼€å§‹åˆ é™¤ã€‚ å½“count&lt;0æ—¶ï¼Œ LREMä¼šä»Žåˆ—è¡¨åŽè¾¹å¼€å§‹åˆ é™¤ã€‚ å½“count=0æ—¶ï¼Œ LREMåˆ é™¤æ‰€æœ‰å€¼ä¸ºvalueçš„å…ƒç´ ã€‚ è¯­æ³•ï¼šLREM key count value èŽ·å¾—æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ è¯­æ³•ï¼šLINDEX key index 12127.0.0.1:6379&gt; lindex list:1 2&quot;4&quot; è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ è¯­æ³•ï¼šLSET key index value 1234567127.0.0.1:6379&gt; lset list:1 2 2OK127.0.0.1:6379&gt; lrange list:1 0 -11) &quot;2&quot;2) &quot;1&quot;3) &quot;2&quot;4) &quot;5&quot; åªä¿ç•™åˆ—è¡¨æŒ‡å®šç‰‡æ®µ, æŒ‡å®šèŒƒå›´å’ŒLRANGEä¸€è‡´ è¯­æ³•ï¼šLTRIM key start stop 1234567891011127.0.0.1:6379&gt; lrange list:1 0 -11) &quot;2&quot;2) &quot;1&quot;3) &quot;2&quot;4) &quot;5&quot;127.0.0.1:6379&gt; ltrim list:1 0 2OK127.0.0.1:6379&gt; lrange list:1 0 -11) &quot;2&quot;2) &quot;1&quot;3) &quot;2&quot; å‘åˆ—è¡¨ä¸­æ’å…¥å…ƒç´  è¯¥å‘½ä»¤é¦–å…ˆä¼šåœ¨åˆ—è¡¨ä¸­ä»Žå·¦åˆ°å³æŸ¥æ‰¾å€¼ä¸ºpivotçš„å…ƒç´ ï¼Œç„¶åŽæ ¹æ®ç¬¬äºŒä¸ªå‚æ•°æ˜¯BEFOREè¿˜æ˜¯AFTERæ¥å†³å®šå°†valueæ’å…¥åˆ°è¯¥å…ƒç´ çš„å‰é¢è¿˜æ˜¯åŽé¢ã€‚ è¯­æ³•ï¼šLINSERT key BEFORE|AFTER pivot value 1234567891011127.0.0.1:6379&gt; lrange list 0 -11) &quot;3&quot;2) &quot;2&quot;3) &quot;1&quot;127.0.0.1:6379&gt; linsert list after 3 4(integer) 4127.0.0.1:6379&gt; lrange list 0 -11) &quot;3&quot;2) &quot;4&quot;3) &quot;2&quot;4) &quot;1&quot; å°†å…ƒç´ ä»Žä¸€ä¸ªåˆ—è¡¨è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ä¸­ è¯­æ³•ï¼šRPOPLPUSH source destination 12345678127.0.0.1:6379&gt; rpoplpush list newlist &quot;1&quot;127.0.0.1:6379&gt; lrange newlist 0 -11) &quot;1&quot;127.0.0.1:6379&gt; lrange list 0 -11) &quot;3&quot;2) &quot;4&quot;3) &quot;2&quot; Setç±»åž‹ setç±»åž‹å³é›†åˆç±»åž‹ï¼Œå…¶ä¸­çš„æ•°æ®æ˜¯ä¸é‡å¤ä¸”æ²¡æœ‰é¡ºåºã€‚ é›†åˆç±»åž‹å’Œåˆ—è¡¨ç±»åž‹çš„å¯¹æ¯”ï¼š é›†åˆç±»åž‹çš„å¸¸ç”¨æ“ä½œæ˜¯å‘é›†åˆä¸­åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ã€åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰ï¼Œç”±äºŽé›†åˆç±»åž‹çš„Rediså†…éƒ¨æ˜¯ä½¿ç”¨å€¼ä¸ºç©ºçš„æ•£åˆ—è¡¨å®žçŽ°ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º0(1)ã€‚Redisè¿˜æä¾›äº†å¤šä¸ªé›†åˆä¹‹é—´çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„è¿ç®—ã€‚ å¢žåŠ /åˆ é™¤å…ƒç´  è¯­æ³•ï¼šSADD key member [member ...] 1234127.0.0.1:6379&gt; sadd set a b c(integer) 3127.0.0.1:6379&gt; sadd set a(integer) 0 è¯­æ³•ï¼šSREM key member [member ...] 12127.0.0.1:6379&gt; srem set c d(integer) 1 èŽ·å¾—é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  è¯­æ³•ï¼šSMEMBERS key 123127.0.0.1:6379&gt; smembers set1) &quot;b&quot;2) &quot;aâ€ åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ è¯­æ³•ï¼šSISMEMBER key member 1234127.0.0.1:6379&gt; sismember set a(integer) 1127.0.0.1:6379&gt; sismember set h(integer) 0 é›†åˆè¿ç®—å‘½ä»¤ é›†åˆçš„å·®é›†è¿ç®— A-B : å±žäºŽAå¹¶ä¸”ä¸å±žäºŽBçš„å…ƒç´ æž„æˆçš„é›†åˆã€‚ è¯­æ³•ï¼šSDIFF key [key ...] 12345678127.0.0.1:6379&gt; sadd setA 1 2 3(integer) 3127.0.0.1:6379&gt; sadd setB 2 3 4(integer) 3127.0.0.1:6379&gt; sdiff setA setB 1) &quot;1&quot;127.0.0.1:6379&gt; sdiff setB setA 1) &quot;4&quot; é›†åˆçš„äº¤é›†è¿ç®— A âˆ© B : å±žäºŽAä¸”å±žäºŽBçš„å…ƒç´ æž„æˆçš„é›†åˆã€‚ è¯­æ³•ï¼šSINTER key [key ...] 123127.0.0.1:6379&gt; sinter setA setB 1) &quot;2&quot;2) &quot;3&quot; é›†åˆçš„å¹¶é›†è¿ç®— A âˆª B : å±žäºŽAæˆ–è€…å±žäºŽBçš„å…ƒç´ æž„æˆçš„é›†åˆ è¯­æ³•ï¼šSUNION key [key ...] 12345127.0.0.1:6379&gt; sunion setA setB1) &quot;1&quot;2) &quot;2&quot;3) &quot;3&quot;4) &quot;4&quot; èŽ·å¾—é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•° è¯­æ³•ï¼šSCARD key 123456127.0.0.1:6379&gt; smembers setA 1) &quot;1&quot;2) &quot;2&quot;3) &quot;3&quot;127.0.0.1:6379&gt; scard setA (integer) 3 ä»Žé›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´  æ³¨æ„ï¼šç”±äºŽé›†åˆæ˜¯æ— åºçš„ï¼Œæ‰€æœ‰SPOPå‘½ä»¤ä¼šä»Žé›†åˆä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ å¼¹å‡º è¯­æ³•ï¼šSPOP key 12127.0.0.1:6379&gt; spop setA &quot;1&quot; ZSetç±»åž‹ åœ¨é›†åˆç±»åž‹çš„åŸºç¡€ä¸Šï¼Œæœ‰åºé›†åˆç±»åž‹ä¸ºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å…³è”ä¸€ä¸ªåˆ†æ•°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ä¸ä»…å¯ä»¥å®Œæˆæ’å…¥ã€åˆ é™¤å’Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨åœ¨é›†åˆä¸­ï¼Œè¿˜èƒ½å¤ŸèŽ·å¾—åˆ†æ•°æœ€é«˜æˆ–æœ€ä½Žçš„å‰Nä¸ªå…ƒç´ ã€èŽ·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ç­‰ä¸Žåˆ†æ•°æœ‰å…³çš„æ“ä½œã€‚ åœ¨æŸäº›æ–¹é¢æœ‰åºé›†åˆå’Œåˆ—è¡¨ç±»åž‹æœ‰äº›ç›¸ä¼¼ï¼š äºŒè€…éƒ½æ˜¯æœ‰åºçš„ã€‚ äºŒè€…éƒ½å¯ä»¥èŽ·å¾—æŸä¸€èŒƒå›´çš„å…ƒç´ ã€‚ ä½†æ˜¯ï¼ŒäºŒè€…æœ‰ç€å¾ˆå¤§åŒºåˆ«ï¼š åˆ—è¡¨ç±»åž‹æ˜¯é€šè¿‡é“¾è¡¨å®žçŽ°çš„ï¼ŒèŽ·å–é è¿‘ä¸¤ç«¯çš„æ•°æ®é€Ÿåº¦æžå¿«ï¼Œè€Œå½“å…ƒç´ å¢žå¤šåŽï¼Œè®¿é—®ä¸­é—´æ•°æ®çš„é€Ÿåº¦ä¼šå˜æ…¢ã€‚ æœ‰åºé›†åˆç±»åž‹ä½¿ç”¨æ•£åˆ—è¡¨å®žçŽ°ï¼Œæ‰€ä»¥å³ä½¿è¯»å–ä½äºŽä¸­é—´éƒ¨åˆ†çš„æ•°æ®ä¹Ÿå¾ˆå¿«ã€‚ åˆ—è¡¨ä¸­ä¸èƒ½ç®€å•çš„è°ƒæ•´æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½†æ˜¯æœ‰åºé›†åˆå¯ä»¥ï¼ˆé€šè¿‡æ›´æ”¹åˆ†æ•°å®žçŽ°ï¼‰ æœ‰åºé›†åˆè¦æ¯”åˆ—è¡¨ç±»åž‹æ›´è€—å†…å­˜ã€‚ å¢žåŠ å…ƒç´  å‘æœ‰åºé›†åˆä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ å’Œè¯¥å…ƒç´ çš„åˆ†æ•°ï¼Œå¦‚æžœè¯¥å…ƒç´ å·²ç»å­˜åœ¨åˆ™ä¼šç”¨æ–°çš„åˆ†æ•°æ›¿æ¢åŽŸæœ‰çš„åˆ†æ•°ã€‚è¿”å›žå€¼æ˜¯æ–°åŠ å…¥åˆ°é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸åŒ…å«ä¹‹å‰å·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚ è¯­æ³•ï¼šZADD key score member [score member ...] 1234127.0.0.1:6379&gt; zadd scoreboard 80 zhangsan 89 lisi 94 wangwu (integer) 3127.0.0.1:6379&gt; zadd scoreboard 97 lisi (integer) 0 èŽ·å¾—æŽ’ååœ¨æŸä¸ªèŒƒå›´çš„å…ƒç´ åˆ—è¡¨ æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»Žå°åˆ°å¤§çš„é¡ºåºè¿”å›žç´¢å¼•ä»Žstartåˆ°stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ è¯­æ³•ï¼šZRANGE key start stop [WITHSCORES] 1234127.0.0.1:6379&gt; zrange scoreboard 0 21) &quot;zhangsan&quot;2) &quot;wangwu&quot;3) &quot;lisiâ€œ æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»Žå¤§åˆ°å°çš„é¡ºåºè¿”å›žç´¢å¼•ä»Žstartåˆ°stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ è¯­æ³•ï¼šZREVRANGE key start stop [WITHSCORES] 1234127.0.0.1:6379&gt; zrevrange scoreboard 0 21) &quot;lisi&quot;2) &quot;wangwu&quot;3) &quot;zhangsan&quot; å¦‚æžœéœ€è¦èŽ·å¾—å…ƒç´ çš„åˆ†æ•°çš„å¯ä»¥åœ¨å‘½ä»¤å°¾éƒ¨åŠ ä¸ŠWITHSCORESå‚æ•° 12345127.0.0.1:6379&gt; zrange scoreboard 0 1 WITHSCORES1) &quot;zhangsan&quot;2) &quot;80&quot;3) &quot;wangwu&quot;4) &quot;94&quot; èŽ·å–å…ƒç´ çš„åˆ†æ•° è¯­æ³•ï¼šZSCORE key member 12127.0.0.1:6379&gt; zscore scoreboard lisi &quot;97&quot; åˆ é™¤å…ƒç´  ç§»é™¤æœ‰åºé›†keyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œä¸å­˜åœ¨çš„æˆå‘˜å°†è¢«å¿½ç•¥ã€‚å½“keyå­˜åœ¨ä½†ä¸æ˜¯æœ‰åºé›†ç±»åž‹æ—¶ï¼Œè¿”å›žä¸€ä¸ªé”™è¯¯ã€‚ è¯­æ³•ï¼šZREM key member [member ...] 12127.0.0.1:6379&gt; zrem scoreboard lisi(integer) 1 èŽ·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´  è¯­æ³•ï¼šZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count] 12345127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 90 97 WITHSCORES1) &quot;wangwu&quot;2) &quot;94&quot;127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 70 100 limit 1 21) &quot;wangwu&quot; å¢žåŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•° è¿”å›žå€¼æ˜¯æ›´æ”¹åŽçš„åˆ†æ•° è¯­æ³•ï¼šZINCRBY key increment member 12127.0.0.1:6379&gt; ZINCRBY scoreboard 4 lisi &quot;101&quot; èŽ·å¾—é›†åˆä¸­å…ƒç´ çš„æ•°é‡ è¯­æ³•ï¼šZCARD key 12127.0.0.1:6379&gt; ZCARD scoreboard(integer) 3 èŽ·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•° è¯­æ³•ï¼šZCOUNT key min max 12127.0.0.1:6379&gt; ZCOUNT scoreboard 80 90(integer) 1 æŒ‰ç…§æŽ’åèŒƒå›´åˆ é™¤å…ƒç´  è¯­æ³•ï¼šZREMRANGEBYRANK key start stop 1234127.0.0.1:6379&gt; ZREMRANGEBYRANK scoreboard 0 1(integer) 2 127.0.0.1:6379&gt; ZRANGE scoreboard 0 -11) &quot;lisi&quot; æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´  è¯­æ³•ï¼šZREMRANGEBYSCORE key min max 1234127.0.0.1:6379&gt; zadd scoreboard 84 zhangsan (integer) 1127.0.0.1:6379&gt; ZREMRANGEBYSCORE scoreboard 80 100(integer) 1 èŽ·å–å…ƒç´ çš„æŽ’å ä»Žå°åˆ°å¤§ è¯­æ³•ï¼šZRANK key member 12127.0.0.1:6379&gt; ZRANK scoreboard lisi (integer) 0 ä»Žå¤§åˆ°å° è¯­æ³•ï¼šZREVRANK key member 12127.0.0.1:6379&gt; ZREVRANK scoreboard zhangsan (nil) é€šç”¨å‘½ä»¤ keys ä½œç”¨ï¼šè¿”å›žæ»¡è¶³ç»™å®špattern çš„æ‰€æœ‰key è¯­æ³•ï¼škeys pattern 123456127.0.0.1:6379&gt; keys mylist*1) &quot;mylist&quot;2) &quot;mylist5&quot;3) &quot;mylist6&quot;4) &quot;mylist7&quot;5) &quot;mylist8&quot; del ä½œç”¨ï¼šåˆ é™¤æŒ‡å®šçš„key è¯­æ³•ï¼šDEL key 12127.0.0.1:6379&gt; del test(integer) 1 exists ä½œç”¨ï¼šç¡®è®¤ä¸€ä¸ªkey æ˜¯å¦å­˜åœ¨ è¯­æ³•ï¼šexists key ç¤ºä¾‹ï¼šä»Žç»“æžœæ¥çœ‹ï¼Œæ•°æ®åº“ä¸­ä¸å­˜åœ¨HongWan è¿™ä¸ªkeyï¼Œä½†æ˜¯age è¿™ä¸ªkey æ˜¯å­˜åœ¨çš„ 1234127.0.0.1:6379&gt; exists HongWan(integer) 0127.0.0.1:6379&gt; exists age(integer) 1 expire ä½œç”¨ï¼šè®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼Œåˆ°æœŸåŽæ•°æ®é”€æ¯ã€‚ EXPIRE key seconds è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰keyåœ¨å¤šå°‘ç§’åŽä¼šè‡ªåŠ¨åˆ é™¤ TTL key æŸ¥çœ‹keyç”ŸäºŽçš„ç”Ÿå­˜æ—¶é—´ PERSIST key æ¸…é™¤ç”Ÿå­˜æ—¶é—´ PEXPIRE key milliseconds ç”Ÿå­˜æ—¶é—´è®¾ç½®å•ä½ä¸ºï¼šæ¯«ç§’ 123456789101112127.0.0.1:6379&gt; set test 1 è®¾ç½®testçš„å€¼ä¸º1OK127.0.0.1:6379&gt; get test èŽ·å–testçš„å€¼&quot;1&quot;127.0.0.1:6379&gt; EXPIRE test 5 è®¾ç½®testçš„ç”Ÿå­˜æ—¶é—´ä¸º5ç§’(integer) 1127.0.0.1:6379&gt; TTL test æŸ¥çœ‹testçš„ç”ŸäºŽç”Ÿæˆæ—¶é—´è¿˜æœ‰1ç§’åˆ é™¤(integer) 1127.0.0.1:6379&gt; TTL test(integer) -2127.0.0.1:6379&gt; get test èŽ·å–testçš„å€¼ï¼Œå·²ç»åˆ é™¤(nil) rename ä½œç”¨ï¼šé‡å‘½åkey è¯­æ³•ï¼šrename oldkey newkey 123456127.0.0.1:6379&gt; keys *1) &quot;age&quot;127.0.0.1:6379&gt; rename age age_newOK127.0.0.1:6379&gt; keys *1) &quot;age_new&quot; type ä½œç”¨ï¼šæ˜¾ç¤ºæŒ‡å®škeyçš„æ•°æ®ç±»åž‹ è¯­æ³•ï¼štype key 123456127.0.0.1:6379&gt; type addrstring127.0.0.1:6379&gt; type myzset2zset127.0.0.1:6379&gt; type mylistlist]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œå·´å·´è¿žæŽ¥æ± DruidDataSourceçš„ä¸€ä¸ªbug]]></title>
    <url>%2Fposts%2Fd2af9ee0.html</url>
    <content type="text"><![CDATA[é—®é¢˜ ä½¿ç”¨é˜¿é‡Œå·´å·´çš„æ•°æ®åº“è¿žæŽ¥æ± Druidï¼Œå½“åº”ç”¨ç¨‹åºè¿žæŽ¥æ•°æ®åº“ï¼Œè€æ˜¯æŠ¥é”™ï¼šcaused by wait mills 5000,active 0,maxactive 20 è¿žæŽ¥æ•°æ®åº“è¶…æ—¶ï¼Œä½†æ˜¯ä½¿ç”¨å•ç‹¬çš„jdbcè¿žæŽ¥å´æ˜¯å¯ä»¥è¿žæŽ¥çš„ã€‚ è§£å†³ ç»è¿‡åå¤æµ‹è¯•ï¼Œå‘çŽ°é—®é¢˜æ‰€åœ¨ï¼ŒåŽŸæ¥æ˜¯è¿žæŽ¥æ± å‚æ•°&lt;property name=&quot;validationQuery&quot; value=&quot;select 1&quot;&gt;é…ç½®é”™è¯¯ã€‚è™½ç„¶æ˜¯é…ç½®é”™è¯¯ï¼Œä½†æ˜¯è¿žæŽ¥æ± ç‰ˆæœ¬æ˜¯1.0.10ï¼Œå¤ªæ—§ï¼Œ å¯¼è‡´æ²¡æœ‰æŠŠçœŸæ­£çš„æŠ¥é”™æç¤ºå‡ºæ¥ora-00923 æœªæ‰¾åˆ°è¦æ±‚çš„å…³é”®å­—fromï¼Œè€Œæ˜¯æŠ¥è¿™ä¸ªé”™ï¼šcaused by wait mills 5000,active 0,maxactive 20ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥æ˜¯å› ä¸ºé…ç½®é”™è¯¯å¯¼è‡´çš„ï¼Œ ä½†æ˜¯å› ä¸ºé˜¿é‡Œå·´å·´è¿žæŽ¥æ± DruidDataSourceçš„bugï¼ŒæŠŠè¿™ä¸ªé”™è¯¯éšè—èµ·æ¥äº†ï¼Œä¸€ç›´æ²¡æœ‰æŠŠçœŸæ­£çš„é”™è¯¯æŠ¥å‡ºæ¥ã€‚ æ€»ç»“ å°†Druidç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼ŒDruidDataSourceé…ç½®æˆå¦‚ä¸‹ï¼š 123456789&lt;property name="minIdle" value="1" /&gt;&lt;property name="validationQuery" value="SELECT 1 FROM DUAL" /&gt;&lt;property name="testOnBorrow" value="true" /&gt;&lt;property name="poolPreparedStatements" value="true" /&gt;&lt;property name="initialSize" value=1 /&gt; å‚æ•°è¯´æ˜Ž validationQuery SQLæŸ¥è¯¢,ç”¨æ¥éªŒè¯ä»Žè¿žæŽ¥æ± å–å‡ºçš„è¿žæŽ¥,åœ¨å°†è¿žæŽ¥è¿”å›žç»™è°ƒç”¨è€…ä¹‹å‰.å¦‚æžœæŒ‡å®š, åˆ™æŸ¥è¯¢å¿…é¡»æ˜¯ä¸€ä¸ªSQL SELECTå¹¶ä¸”å¿…é¡»è¿”å›žè‡³å°‘ä¸€è¡Œè®°å½•ã€‚ testOnBorrow true--æŒ‡æ˜Žæ˜¯å¦åœ¨ä»Žæ± ä¸­å–å‡ºè¿žæŽ¥å‰è¿›è¡Œæ£€éªŒ,å¦‚æžœæ£€éªŒå¤±è´¥, åˆ™ä»Žæ± ä¸­åŽ»é™¤è¿žæŽ¥å¹¶å°è¯•å–å‡ºå¦ä¸€ä¸ªã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåŽå¦‚æžœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéžç©ºå­—ç¬¦ä¸² ã€‚ testOnReturn false--æŒ‡æ˜Žæ˜¯å¦åœ¨å½’è¿˜åˆ°æ± ä¸­å‰è¿›è¡Œæ£€éªŒã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåŽå¦‚æžœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéžç©ºå­—ç¬¦ä¸² ã€‚ testWhileIdle false--æŒ‡æ˜Žè¿žæŽ¥æ˜¯å¦è¢«ç©ºé—²è¿žæŽ¥å›žæ”¶å™¨(å¦‚æžœæœ‰)è¿›è¡Œæ£€éªŒ.å¦‚æžœæ£€æµ‹å¤±è´¥, åˆ™è¿žæŽ¥å°†è¢«ä»Žæ± ä¸­åŽ»é™¤ã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåŽå¦‚æžœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéžç©ºå­—ç¬¦ä¸² timeBetweenEvictionRunsMillis -1--åœ¨ç©ºé—²è¿žæŽ¥å›žæ”¶å™¨çº¿ç¨‹è¿è¡ŒæœŸé—´ä¼‘çœ çš„æ—¶é—´å€¼,ä»¥æ¯«ç§’ä¸ºå•ä½. å¦‚æžœè®¾ç½®ä¸ºéžæ­£æ•°,åˆ™ä¸è¿è¡Œç©ºé—²è¿žæŽ¥å›žæ”¶å™¨çº¿ç¨‹ã€‚ numTestsPerEvictionRun 3--åœ¨æ¯æ¬¡ç©ºé—²è¿žæŽ¥å›žæ”¶å™¨çº¿ç¨‹(å¦‚æžœæœ‰)è¿è¡Œæ—¶æ£€æŸ¥çš„è¿žæŽ¥æ•°é‡ ã€‚ minEvictableIdleTimeMillis 1000 * 60 * 30--è¿žæŽ¥åœ¨æ± ä¸­ä¿æŒç©ºé—²è€Œä¸è¢«ç©ºé—²è¿žæŽ¥å›žæ”¶å™¨çº¿ç¨‹(å¦‚æžœæœ‰)å›žæ”¶çš„æœ€å°æ—¶é—´å€¼ï¼Œå•ä½æ¯«ç§’ã€‚]]></content>
      <categories>
        <category>druid</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>druid</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mybatiså¼‚å¸¸There is no getter for property named 'XXX' in class]]></title>
    <url>%2Fposts%2F53121faf.html</url>
    <content type="text"><![CDATA[åœ¨é›†æˆMybatisçš„é¡¹ç›®ä¸­å®šä¹‰æŽ¥å£å¹¶å®žçŽ°æ˜ å°„SQLæ—¶ï¼Œé‡åˆ°è¿‡ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š å®šä¹‰æŽ¥å£ï¼š 1UserCouponBo getUserCouponInfoById(Long userCouponId); ç„¶åŽå¯¹åº”çš„sqlçš„xmlå¦‚ä¸‹ï¼š 12345678&lt;select id="selectUserCouponInfoById" parameterType="java.lang.Long" resultMap="baseResultMap"&gt; select amount,receive_time from user_coupon &lt;where&gt; &lt;if test="userCouponId != null"&gt; id = #&#123;userCouponId,jdbcType=BIGINT&#125; &lt;/if&gt; &lt;/where&gt;&lt;/select&gt; ä¸Šé¢çš„æŽ¥å£å°±æ˜¯é€šè¿‡idæŸ¥è¯¢æŒ‡å®šçš„ä¼˜æƒ åˆ¸ä¿¡æ¯ï¼Œä¸ªäººæ„Ÿè§‰è¯¥sqlå†™çš„ä¸å¤Ÿä¼˜é›…ã€‚å°±æ˜¯è¿™ä¸ªæŽ¥å£ï¼ŒæŠ¥é”™ï¼šThere is no gettery for property...!!! è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åŽŸå› æ˜¯åœ¨ifé‡Œé¢ç”¨äº†Mybatisçš„å†…ç½®å¯¹è±¡ï¼Œ&lt;if test=&quot;id != null&quot;&gt;ï¼ŒMybatisé»˜è®¤é‡‡ç”¨OGNLè§£æžå‚æ•°ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨é‡‡ç”¨å¯¹è±¡æ ‘çš„å½¢å¼å–long.xxxå€¼ï¼Œå¦‚æžœæ²¡åœ¨æ–¹æ³•ä¸­å®šä¹‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ è§£å†³æ–¹æ¡ˆä¸€ï¼šæŠŠ#{xxx}ä¿®æ”¹ä¸º#{_parameter}å³å¯ 12345678&lt;select id="selectUserCouponInfoById" parameterType="java.lang.Long" resultMap="baseResultMap"&gt; select amount,receive_time from user_coupon &lt;where&gt; &lt;if test="_parameter != null"&gt; id = #&#123;_parameter&#125; &lt;/if&gt; &lt;/where&gt;&lt;/select&gt; è§£å†³è§£å†³æ–¹æ¡ˆäºŒï¼šåœ¨æ–¹æ³•ä¸­æå‰å®šä¹‰ã€‚ 1UserCouponBo getUserCouponInfoById(@Param("userCouponId") Long userCouponId); ç»™userCouponIdåŠ @Paramæ³¨è§£ï¼Œå®šä¹‰ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ReentrantReadWriteLock]]></title>
    <url>%2Fposts%2Fb29432a8.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ReadWriteLockï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯è¯»å†™é”ã€‚å®ƒç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é” â€” â€” â€œè¯»å–é”â€å’Œâ€œå†™å…¥é”â€ï¼Œä¸€ä¸ªç”¨äºŽè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºŽå†™å…¥æ“ä½œã€‚ â€œè¯»å–é”â€ç”¨äºŽåªè¯»æ“ä½œï¼Œå®ƒæ˜¯â€œå…±äº«é”â€ï¼Œèƒ½åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹èŽ·å–ã€‚ â€œå†™å…¥é”â€ç”¨äºŽå†™å…¥æ“ä½œï¼Œå®ƒæ˜¯â€œç‹¬å é”â€ï¼Œå†™å…¥é”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”èŽ·å–ã€‚ &lt;font color=&quot;red&quot;&gt;æ³¨æ„ï¼šä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å–é”å’Œå†™å…¥é”ï¼&lt;/font&gt; ReadWriteLockæ˜¯ä¸€ä¸ªæŽ¥å£ã€‚ReentrantReadWriteLockæ˜¯å®ƒçš„å®žçŽ°ç±»ï¼ŒReentrantReadWriteLockåŒ…æ‹¬å­ç±»ReadLockå’ŒWriteLockã€‚ è¯»å†™é”åº•å±‚ä¹Ÿæ˜¯é€šè¿‡AQSæ¡†æž¶å®žçŽ°çš„ï¼Œé€šè¿‡ä¹‹å‰çš„æ–‡ç« å¯çŸ¥ï¼Œå¦‚æžœä½¿ç”¨AQSæ¡†æž¶ï¼Œåœ¨è¿™ä¸ªç±»å†…éƒ¨å¿…å®šæœ‰ä¸€ä¸ªAQSæ¡†æž¶çš„å­ç±»ï¼ŒAQSå­ç±»æ— éžå°±æ˜¯å®žçŽ°å¦‚ä¸‹å‡ ç‚¹ï¼š ç¬¬ä¸€ç‚¹ï¼šå¯¹å…±äº«èµ„æºstateè¿›è¡Œæ“ä½œ ç¬¬äºŒç‚¹ï¼šå¦‚æžœæ˜¯ç‹¬å æ¨¡å¼ä¸‹å¯¹èµ„æºçš„èŽ·å–å’Œé‡Šæ”¾ï¼Œé‚£ä¹ˆå¿…é¡»å®žçŽ°tryAcquire()æ–¹æ³•å’ŒtryRelease()æ–¹æ³•ã€‚ ç¬¬ä¸‰ç‚¹ï¼šå¦‚æžœæ˜¯å…±äº«æ¨¡å¼ä¸‹å¯¹èµ„æºçš„èŽ·å–å’Œé‡Šæ”¾ï¼Œé‚£ä¹ˆå¿…é¡»å®žçŽ°tryAcquireShared()æ–¹æ³•å’ŒtryReleaseShared()æ–¹æ³•ã€‚ è€Œè¯»å†™é”ReentrantReadWriteLockå³åŒ…å«ç‹¬å æ¨¡å¼ä¸‹èµ„æºçš„èŽ·å–å’Œé‡Šæ”¾(å†™é”)ï¼Œä¹ŸåŒ…å«å…±äº«æ¨¡å¼ä¸‹èµ„æºçš„èŽ·å–å’Œé‡Šæ”¾(è¯»é”)ï¼Œæ‰€ä»¥éœ€è¦ä¸Šé¢çš„å››ä¸ªæ–¹æ³•éƒ½éœ€è¦å®žçŽ°ã€‚ ç”¨stateä¸€ä¸ªæ•´å½¢å˜é‡æ€Žæ ·åŽ»ç»´æŠ¤è¯»å’Œå†™ä¸¤ç§çŠ¶æ€ å…±äº«èµ„æºstateæ˜¯ä¸€ä¸ªæ•´å½¢å˜é‡ï¼Œåœ¨è¯»å†™é”ä¸­åˆå¿…é¡»ç»´æŠ¤è¯»å’Œå†™ä¸¤ç§çŠ¶æ€ï¼Œæ‰€ä»¥åªèƒ½æŒ‰ä½æŠŠstateåˆ†å‰²æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ•´å½¢æœ‰32ä½ï¼Œé«˜16ä½ä»£è¡¨è¯»ï¼Œä½Ž16ä½ä»£è¡¨å†™ã€‚å¦‚å›¾æ‰€ç¤ºï¼š ![img][link1] 123456789101112//è¯»çŠ¶æ€å ç”¨ä½æ•°static final int SHARED_SHIFT = 16;//æ¯ä¸€æ¬¡å¢žåŠ çš„è¯»çŠ¶æ€ï¼š(1&lt;&lt;16),å› ä¸ºè¯»çŠ¶æ€æ˜¯stateçš„é«˜16ä½static final int SHARED_UNIT = (1 &lt;&lt; SHARED_SHIFT);//è¯»çŠ¶æ€æˆ–å†™çŠ¶æ€æœ€å¤§çš„æ•°é‡static final int MAX_COUNT = (1 &lt;&lt; SHARED_SHIFT) - 1;//ç”¨æ¥è®¡ç®—å†™çš„åŒæ­¥çŠ¶æ€static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;//è®¡ç®—è¯»é”çš„æ•°é‡static int sharedCount(int c) &#123; return c &gt;&gt;&gt; SHARED_SHIFT; &#125;//è®¡ç®—å†™é”çš„æ•°é‡static int exclusiveCount(int c) &#123; return c &amp; EXCLUSIVE_MASK; &#125; è¯»æ“ä½œï¼Œå› ä¸ºé«˜16ä½ä¸ºè¯»æ“ä½œï¼Œè¦æƒ³èŽ·å–è¯»çš„æ•°é‡ï¼Œåªéœ€å°†stateæ— ç¬¦å·å³ç§»16ä½å³å¯ï¼šstate&gt;&gt;&gt;16ã€‚è¯»æœ€å¤§çš„æ•°é‡ï¼š65535(äºŒè¿›åˆ¶è¡¨ç¤ºï¼š11111111110000000000000000) å†™æ“ä½œï¼Œå› ä¸ºä½Ž16ä½ä¸ºå†™æ“ä½œï¼Œè¦å‘èŽ·å–å†™æ•°é‡ï¼Œåªéœ€è¦æŠŠstateçš„é«˜16ä½æŠ¹åŽ»å°±å¯ä»¥äº†ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°â€œæŒ‰ä½ä¸Žâ€æ“ä½œï¼šstate&amp;1111111111111111ã€‚å†™æœ€å¤§çš„æ•°é‡ï¼š65535(äºŒè¿›åˆ¶è¡¨ç¤ºï¼š00000000000000001111111111111111) å…±äº«é” 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public static class ReadLock implements Lock, java.io.Serializable &#123; private static final long serialVersionUID = -5992448646407690164L; // ReentrantReadWriteLockçš„AQSå¯¹è±¡ private final Sync sync; protected ReadLock(ReentrantReadWriteLock lock) &#123; sync = lock.sync; &#125; // èŽ·å–â€œå…±äº«é”â€ public void lock() &#123; sync.acquireShared(1); &#125; // å¦‚æžœçº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œåˆ™æŠ›å‡ºä¸€åœºï¼Œå¦åˆ™å°è¯•èŽ·å–å…±äº«é”ã€‚ public void lockInterruptibly() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1); &#125; // å°è¯•èŽ·å–â€œå…±äº«é”â€ public boolean tryLock() &#123; return sync.tryReadLock(); &#125; // åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå°è¯•èŽ·å–â€œå…±äº«é”â€ public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireSharedNanos(1, unit.toNanos(timeout)); &#125; // é‡Šæ”¾â€œå…±äº«é”â€ public void unlock() &#123; sync.releaseShared(1); &#125; // æ–°å»ºæ¡ä»¶ public Condition newCondition() &#123; throw new UnsupportedOperationException(); &#125; public String toString() &#123; int r = sync.getReadLockCount(); return super.toString() + "[Read locks = " + r + "]"; &#125;&#125; ReadLockä¸­çš„syncæ˜¯ä¸€ä¸ªSyncå¯¹è±¡ï¼ŒSyncç»§æ‰¿äºŽAQSç±»ï¼Œå³Syncå°±æ˜¯ä¸€ä¸ªé”ã€‚ReentrantReadWriteLockä¸­ä¹Ÿæœ‰ä¸€ä¸ªSyncå¯¹è±¡ï¼Œè€Œä¸”ReadLockä¸­çš„syncå’ŒReentrantReadWriteLockä¸­çš„syncæ˜¯å¯¹åº”å…³ç³»ã€‚å³ReentrantReadWriteLockå’ŒReadLockå…±äº«åŒä¸€ä¸ªAQSå¯¹è±¡ï¼Œå…±äº«åŒä¸€æŠŠé”ã€‚ èŽ·å–å…±äº«é” èŽ·å–å…±äº«é”çš„æ€æƒ³(å³lockå‡½æ•°çš„æ­¥éª¤)ï¼Œæ˜¯å…ˆé€šè¿‡tryAcquireShared()å°è¯•èŽ·å–å…±äº«é”ã€‚å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™ç›´æŽ¥è¿”å›žï¼›å°è¯•å¤±è´¥çš„è¯ï¼Œåˆ™é€šè¿‡doAcquireShared()ä¸æ–­çš„å¾ªçŽ¯å¹¶å°è¯•èŽ·å–é”ï¼Œè‹¥æœ‰éœ€è¦ï¼Œåˆ™é˜»å¡žç­‰å¾…ã€‚doAcquireShared()åœ¨å¾ªçŽ¯ä¸­æ¯æ¬¡å°è¯•èŽ·å–é”æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡tryAcquireShared()æ¥è¿›è¡Œå°è¯•çš„ã€‚ä¸‹é¢çœ‹çœ‹â€œèŽ·å–å…±äº«é”â€çš„è¯¦ç»†æµç¨‹ã€‚ lock() 123public void lock() &#123; sync.acquireShared(1);&#125; acquireShared() Syncç»§æ‰¿äºŽAQSï¼ŒacquireShared()å®šä¹‰åœ¨AQSä¸­ã€‚æºç å¦‚ä¸‹ï¼š 1234public final void acquireShared(int arg) &#123; if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg);&#125; acquireShared()é¦–å…ˆä¼šé€šè¿‡tryAcquireShared()æ¥å°è¯•èŽ·å–é”ã€‚ å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™ä¸å†åšä»»ä½•åŠ¨ä½œ(å› ä¸ºå·²ç»æˆåŠŸèŽ·å–åˆ°é”äº†)ã€‚ å°è¯•å¤±è´¥çš„è¯ï¼Œåˆ™é€šè¿‡doAcquireShared()æ¥èŽ·å–é”ã€‚doAcquireShared()ä¼šèŽ·å–åˆ°é”äº†æ‰è¿”å›žã€‚ tryAcquireShared() 123456789101112131415161718192021222324252627282930313233343536protected final int tryAcquireShared(int unused) &#123; Thread current = Thread.currentThread(); // èŽ·å–â€œé”â€çš„çŠ¶æ€ int c = getState(); // å¦‚æžœâ€œé”â€æ˜¯â€œäº’æ–¥é”â€ï¼Œå¹¶ä¸”èŽ·å–é”çš„çº¿ç¨‹ä¸æ˜¯currentçº¿ç¨‹ï¼›åˆ™è¿”å›ž-1ã€‚ if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; // èŽ·å–â€œè¯»å–é”â€çš„å…±äº«è®¡æ•° int r = sharedCount(c); // å¦‚æžœâ€œä¸éœ€è¦é˜»å¡žç­‰å¾…â€ï¼Œå¹¶ä¸”â€œè¯»å–é”â€çš„å…±äº«è®¡æ•°å°äºŽMAX_COUNTï¼› // åˆ™é€šè¿‡CASå‡½æ•°æ›´æ–°â€œé”çš„çŠ¶æ€â€ï¼Œå°†â€œè¯»å–é”â€çš„å…±äº«è®¡æ•°+1ã€‚ if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; compareAndSetState(c, c + SHARED_UNIT)) &#123; // ç¬¬1æ¬¡èŽ·å–â€œè¯»å–é”â€ã€‚ if (r == 0) &#123; firstReader = current; firstReaderHoldCount = 1; // å¦‚æžœæƒ³è¦èŽ·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªèŽ·å–é”(firstReader)çš„çº¿ç¨‹ &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; // HoldCounteræ˜¯ç”¨æ¥ç»Ÿè®¡è¯¥çº¿ç¨‹èŽ·å–â€œè¯»å–é”â€çš„æ¬¡æ•°ã€‚ HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); // å°†è¯¥çº¿ç¨‹èŽ·å–â€œè¯»å–é”â€çš„æ¬¡æ•°+1ã€‚ rh.count++; &#125; return 1; &#125; return fullTryAcquireShared(current);&#125; tryAcquireShared()çš„ä½œç”¨æ˜¯å°è¯•èŽ·å–â€œå…±äº«é”â€ã€‚ å¦‚æžœåœ¨å°è¯•èŽ·å–é”æ—¶ï¼Œâ€œä¸éœ€è¦é˜»å¡žç­‰å¾…â€å¹¶ä¸”â€œè¯»å–é”çš„å…±äº«è®¡æ•°å°äºŽMAX_COUNTâ€ï¼Œåˆ™ç›´æŽ¥é€šè¿‡CASå‡½æ•°æ›´æ–°â€œè¯»å–é”çš„å…±äº«è®¡æ•°â€ï¼Œä»¥åŠå°†â€œå½“å‰çº¿ç¨‹èŽ·å–è¯»å–é”çš„æ¬¡æ•°+1â€ã€‚ å¦åˆ™ï¼Œé€šè¿‡fullTryAcquireShared()èŽ·å–è¯»å–é”ã€‚ fullTryAcquireShared() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758final int fullTryAcquireShared(Thread current) &#123; HoldCounter rh = null; for (;;) &#123; // èŽ·å–â€œé”â€çš„çŠ¶æ€ int c = getState(); // å¦‚æžœâ€œé”â€æ˜¯â€œäº’æ–¥é”â€ï¼Œå¹¶ä¸”èŽ·å–é”çš„çº¿ç¨‹ä¸æ˜¯currentçº¿ç¨‹ï¼›åˆ™è¿”å›ž-1ã€‚ if (exclusiveCount(c) != 0) &#123; if (getExclusiveOwnerThread() != current) return -1; // å¦‚æžœâ€œéœ€è¦é˜»å¡žç­‰å¾…â€ã€‚ // (01) å½“â€œéœ€è¦é˜»å¡žç­‰å¾…â€çš„çº¿ç¨‹æ˜¯ç¬¬1ä¸ªèŽ·å–é”çš„çº¿ç¨‹çš„è¯ï¼Œåˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ // (02) å½“â€œéœ€è¦é˜»å¡žç­‰å¾…â€çš„çº¿ç¨‹èŽ·å–é”çš„æ¬¡æ•°=0æ—¶ï¼Œåˆ™è¿”å›ž-1ã€‚ &#125; else if (readerShouldBlock()) &#123; // å¦‚æžœæƒ³è¦èŽ·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªèŽ·å–é”(firstReader)çš„çº¿ç¨‹ if (firstReader == current) &#123; &#125; else &#123; if (rh == null) &#123; rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) &#123; rh = readHolds.get(); if (rh.count == 0) readHolds.remove(); &#125; &#125; // å¦‚æžœå½“å‰çº¿ç¨‹èŽ·å–é”çš„è®¡æ•°=0,åˆ™è¿”å›ž-1ã€‚ if (rh.count == 0) return -1; &#125; &#125; // å¦‚æžœâ€œä¸éœ€è¦é˜»å¡žç­‰å¾…â€ï¼Œåˆ™èŽ·å–â€œè¯»å–é”â€çš„å…±äº«ç»Ÿè®¡æ•°ï¼› // å¦‚æžœå…±äº«ç»Ÿè®¡æ•°è¶…è¿‡MAX_COUNTï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ if (sharedCount(c) == MAX_COUNT) throw new Error("Maximum lock count exceeded"); // å°†çº¿ç¨‹èŽ·å–â€œè¯»å–é”â€çš„æ¬¡æ•°+1ã€‚ if (compareAndSetState(c, c + SHARED_UNIT)) &#123; // å¦‚æžœæ˜¯ç¬¬1æ¬¡èŽ·å–â€œè¯»å–é”â€ï¼Œåˆ™æ›´æ–°firstReaderå’ŒfirstReaderHoldCountã€‚ if (sharedCount(c) == 0) &#123; firstReader = current; firstReaderHoldCount = 1; // å¦‚æžœæƒ³è¦èŽ·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªèŽ·å–é”(firstReader)çš„çº¿ç¨‹ï¼Œ // åˆ™å°†firstReaderHoldCount+1ã€‚ &#125; else if (firstReader == current) &#123; firstReaderHoldCount++; &#125; else &#123; if (rh == null) rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); // æ›´æ–°çº¿ç¨‹çš„èŽ·å–â€œè¯»å–é”â€çš„å…±äº«è®¡æ•° rh.count++; cachedHoldCounter = rh; // cache for release &#125; return 1; &#125; &#125;&#125; fullTryAcquireShared()ä¼šæ ¹æ®â€œæ˜¯å¦éœ€è¦é˜»å¡žç­‰å¾…â€ï¼Œâ€œè¯»å–é”çš„å…±äº«è®¡æ•°æ˜¯å¦è¶…è¿‡é™åˆ¶â€ç­‰ç­‰è¿›è¡Œå¤„ç†ã€‚å¦‚æžœä¸éœ€è¦é˜»å¡žç­‰å¾…ï¼Œå¹¶ä¸”é”çš„å…±äº«è®¡æ•°æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œåˆ™é€šè¿‡CASå°è¯•èŽ·å–é”ï¼Œå¹¶è¿”å›ž1ã€‚ doAcquireShared() 1234567891011121314151617181920212223242526272829303132private void doAcquireShared(int arg) &#123; // addWaiter(Node.SHARED)çš„ä½œç”¨æ˜¯ï¼Œåˆ›å»ºâ€œå½“å‰çº¿ç¨‹â€å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†è¯¥çº¿ç¨‹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; boolean interrupted = false; for (;;) &#123; // èŽ·å–â€œnodeâ€çš„å‰ä¸€ç»“ç‚¹ final Node p = node.predecessor(); // å¦‚æžœâ€œå½“å‰çº¿ç¨‹â€æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™å°è¯•èŽ·å–å…±äº«é”ã€‚ if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; &#125; &#125; // å¦‚æžœâ€œå½“å‰çº¿ç¨‹â€ä¸æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™é€šè¿‡shouldParkAfterFailedAcquire()åˆ¤æ–­æ˜¯å¦éœ€è¦ç­‰å¾…ï¼Œ // éœ€è¦çš„è¯ï¼Œåˆ™é€šè¿‡parkAndCheckInterrupt()è¿›è¡Œé˜»å¡žç­‰å¾…ã€‚è‹¥é˜»å¡žç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è®¾ç½®interruptedä¸ºtrueã€‚ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; &#125; &#125; finally &#123; if (failed) cancelAcquire(node); &#125;&#125; doAcquireShared()çš„ä½œç”¨æ˜¯èŽ·å–å…±äº«é”ã€‚ å®ƒä¼šé¦–å…ˆåˆ›å»ºçº¿ç¨‹å¯¹åº”çš„åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹ï¼Œç„¶åŽå°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚åŒæ­¥é˜Ÿåˆ—æ˜¯ç®¡ç†èŽ·å–é”çš„ç­‰å¾…çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚ å¦‚æžœâ€œå½“å‰çº¿ç¨‹â€æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™å°è¯•èŽ·å–å…±äº«é”ï¼›å¦åˆ™ï¼Œåˆ™éœ€è¦é€šè¿‡shouldParkAfterFailedAcquire()åˆ¤æ–­æ˜¯å¦é˜»å¡žç­‰å¾…ï¼Œéœ€è¦çš„è¯ï¼Œåˆ™é€šè¿‡parkAndCheckInterrupt()è¿›è¡Œé˜»å¡žç­‰å¾…ã€‚ doAcquireShared()ä¼šé€šè¿‡forå¾ªçŽ¯ï¼Œä¸æ–­çš„è¿›è¡Œä¸Šé¢çš„æ“ä½œï¼›ç›®çš„å°±æ˜¯èŽ·å–å…±äº«é”ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šdoAcquireShared()åœ¨æ¯ä¸€æ¬¡å°è¯•èŽ·å–é”æ—¶ï¼Œæ˜¯é€šè¿‡tryAcquireShared()æ¥æ‰§è¡Œçš„ï¼ é‡Šæ”¾å…±äº«é” é‡Šæ”¾å…±äº«é”çš„æ€æƒ³ï¼Œæ˜¯å…ˆé€šè¿‡tryReleaseShared()å°è¯•é‡Šæ”¾å…±äº«é”ã€‚å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™é€šè¿‡doReleaseShared()å”¤é†’â€œå…¶ä»–ç­‰å¾…èŽ·å–å…±äº«é”çš„çº¿ç¨‹â€ï¼Œå¹¶è¿”å›žtrueï¼›å¦åˆ™çš„è¯ï¼Œè¿”å›žflaseã€‚ unlock() 123public void unlock() &#123; sync.releaseShared(1);&#125; è¯¥å‡½æ•°å®žé™…ä¸Šè°ƒç”¨releaseShared(1)é‡Šæ”¾å…±äº«é”ã€‚ releaseShared() 1234567public final boolean releaseShared(int arg) &#123; if (tryReleaseShared(arg)) &#123; doReleaseShared(); return true; &#125; return false;&#125; releaseShared()çš„ç›®çš„æ˜¯è®©å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„å…±äº«é”ã€‚ å®ƒé¦–å…ˆä¼šé€šè¿‡tryReleaseShared()åŽ»å°è¯•é‡Šæ”¾å…±äº«é”ã€‚å°è¯•æˆåŠŸï¼Œåˆ™ç›´æŽ¥è¿”å›žï¼›å°è¯•å¤±è´¥ï¼Œåˆ™é€šè¿‡doReleaseShared()åŽ»é‡Šæ”¾å…±äº«é”ã€‚ tryReleaseShared() 123456789101112131415161718192021222324252627282930313233343536protected final boolean tryReleaseShared(int unused) &#123; // èŽ·å–å½“å‰çº¿ç¨‹ï¼Œå³é‡Šæ”¾å…±äº«é”çš„çº¿ç¨‹ã€‚ Thread current = Thread.currentThread(); // å¦‚æžœæƒ³è¦é‡Šæ”¾é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªèŽ·å–é”(firstReader)çš„çº¿ç¨‹ï¼Œ // å¹¶ä¸”â€œç¬¬1ä¸ªèŽ·å–é”çš„çº¿ç¨‹èŽ·å–é”çš„æ¬¡æ•°â€=1ï¼Œåˆ™è®¾ç½®firstReaderä¸ºnullï¼› // å¦åˆ™ï¼Œå°†â€œç¬¬1ä¸ªèŽ·å–é”çš„çº¿ç¨‹çš„èŽ·å–æ¬¡æ•°â€-1ã€‚ if (firstReader == current) &#123; // assert firstReaderHoldCount &gt; 0; if (firstReaderHoldCount == 1) firstReader = null; else firstReaderHoldCount--; // èŽ·å–rhå¯¹è±¡ï¼Œå¹¶æ›´æ–°â€œå½“å‰çº¿ç¨‹èŽ·å–é”çš„ä¿¡æ¯â€ã€‚ &#125; else &#123; HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) rh = readHolds.get(); int count = rh.count; if (count &lt;= 1) &#123; readHolds.remove(); if (count &lt;= 0) throw unmatchedUnlockException(); &#125; --rh.count; &#125; for (;;) &#123; // èŽ·å–é”çš„çŠ¶æ€ int c = getState(); // å°†é”çš„èŽ·å–æ¬¡æ•°-1ã€‚ int nextc = c - SHARED_UNIT; // é€šè¿‡CASæ›´æ–°é”çš„çŠ¶æ€ã€‚ if (compareAndSetState(c, nextc)) return nextc == 0; &#125;&#125; tryReleaseShared()çš„ä½œç”¨æ˜¯å°è¯•é‡Šæ”¾å…±äº«é”ã€‚ doReleaseShared() 1234567891011121314151617181920212223242526private void doReleaseShared() &#123; for (;;) &#123; // èŽ·å–CLHé˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ Node h = head; // å¦‚æžœå¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹ä¸ç­‰äºŽtailèŠ‚ç‚¹ã€‚ if (h != null &amp;&amp; h != tail) &#123; // èŽ·å–å¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çš„çŠ¶æ€ int ws = h.waitStatus; // å¦‚æžœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯SIGNALçŠ¶æ€ï¼Œåˆ™æ„å‘³ç€â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€éœ€è¦è¢«unparkå”¤é†’ã€‚ if (ws == Node.SIGNAL) &#123; // è®¾ç½®â€œå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çŠ¶æ€â€ä¸ºç©ºçŠ¶æ€ã€‚å¤±è´¥çš„è¯ï¼Œåˆ™ç»§ç»­å¾ªçŽ¯ã€‚ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // å”¤é†’â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€ã€‚ unparkSuccessor(h); &#125; // å¦‚æžœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯ç©ºçŠ¶æ€ï¼Œåˆ™è®¾ç½®â€œæ–‡ä»¶ç‚¹å¯¹åº”çš„çº¿ç¨‹æ‰€æ‹¥æœ‰çš„å…±äº«é”â€ä¸ºå…¶å®ƒçº¿ç¨‹èŽ·å–é”çš„ç©ºçŠ¶æ€ã€‚ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; // å¦‚æžœå¤´èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç»§ç»­å¾ªçŽ¯ã€‚å¦åˆ™ï¼Œé€€å‡ºå¾ªçŽ¯ã€‚ if (h == head) // loop if head changed break; &#125;&#125; doReleaseShared()ä¼šé‡Šæ”¾â€œå…±äº«é”â€ã€‚å®ƒä¼šä»Žå‰å¾€åŽçš„éåŽ†åŒæ­¥é˜Ÿåˆ—ï¼Œä¾æ¬¡â€œå”¤é†’â€ç„¶åŽâ€œæ‰§è¡Œâ€é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ï¼›æœ€ç»ˆçš„ç›®çš„æ˜¯è®©è¿™äº›çº¿ç¨‹é‡Šæ”¾å®ƒä»¬æ‰€æŒæœ‰çš„é”ã€‚ å…¬å¹³/éžå…¬å¹³å…±äº«é” å’Œäº’æ–¥é”ReentrantLockä¸€æ ·ï¼ŒReadLockä¹Ÿåˆ†ä¸ºå…¬å¹³é”å’Œéžå…¬å¹³é”ã€‚ å…¬å¹³é”å’Œéžå…¬å¹³é”çš„åŒºåˆ«ï¼Œä½“çŽ°åœ¨åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡žçš„å‡½æ•°readerShouldBlock()æ˜¯ä¸åŒçš„ã€‚ å…¬å¹³é”çš„readerShouldBlock()çš„æºç å¦‚ä¸‹ï¼š 123final boolean readerShouldBlock() &#123; return hasQueuedPredecessors();&#125; åœ¨å…¬å¹³å…±äº«é”ä¸­ï¼Œå¦‚æžœåœ¨å½“å‰çº¿ç¨‹çš„å‰é¢æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…èŽ·å–å…±äº«é”ï¼Œåˆ™è¿”å›žtrueï¼›å¦åˆ™ï¼Œè¿”å›žfalseã€‚ éžå…¬å¹³é”çš„readerShouldBlock()çš„æºç å¦‚ä¸‹ï¼š 123final boolean readerShouldBlock() &#123; return apparentlyFirstQueuedIsExclusive();&#125; åœ¨éžå…¬å¹³å…±äº«é”ä¸­ï¼Œå®ƒä¼šæ— è§†å½“å‰çº¿ç¨‹çš„å‰é¢æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…èŽ·å–å…±äº«é”ã€‚åªè¦è¯¥éžå…¬å¹³å…±äº«é”å¯¹åº”çš„çº¿ç¨‹ä¸ä¸ºnullï¼Œåˆ™è¿”å›žtrueã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Springä¸­çš„æ³¨è§£]]></title>
    <url>%2Fposts%2Ff989cad5.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Springä¸­çš„æ³¨è§£å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£ï¼Œæˆ–è€…è¯´beanå·¥åŽ‚ç›¸å…³çš„æ³¨è§£ï¼› Springmvcç›¸å…³çš„æ³¨è§£ã€‚ Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£æœ‰ï¼š @Required, @Autowired, @PostConstruct, @PreDestory, è¿˜æœ‰Spring3.0å¼€å§‹æ”¯æŒçš„JSR-330æ ‡å‡†javax.inject.*ä¸­çš„æ³¨è§£ï¼š @Inject, @Named, @Qualifer, @Provider, @Scope, @Singletonã€‚ Springmvcç›¸å…³çš„æ³¨è§£æœ‰ï¼š @Controller, @RequestMapping, @RequestParam, @ResponseBody ç­‰ç­‰ã€‚ è¦ç†è§£Springä¸­çš„æ³¨è§£ï¼Œå…ˆè¦ç†è§£Javaä¸­çš„æ³¨è§£ã€‚ Javaä¸­çš„æ³¨è§£ @Override Jdk1.5å¼€å§‹å¼•å…¥æ³¨è§£ï¼Œæœ€ç†Ÿæ‚‰å¸¸è§çš„åº”è¯¥æ˜¯@Overrideï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516171819/** * Indicates that a method declaration is intended to override a * method declaration in a supertype. If a method is annotated with * this annotation type compilers are required to generate an error * message unless at least one of the following conditions hold: * The method does override or implement a method declared in a * supertype. * The method has a signature that is override-equivalent to that of * any public method declared in Object. * * @author Peter von der Ah&amp;eacute; * @author Joshua Bloch * @jls 9.6.1.4 @Override * @since 1.5 */@Target(ElementType.METHOD)@Retention(RetentionPolicy.SOURCE)public @interface Override &#123;&#125; ä»Žæ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼Œ@Overrideçš„ä½œç”¨æ˜¯ï¼Œæç¤ºç¼–è¯‘å™¨ï¼Œä½¿ç”¨äº†@Overrideæ³¨è§£çš„æ–¹æ³•å¿…é¡»overrideçˆ¶ç±»æˆ–è€…java.lang.Objectä¸­çš„ä¸€ä¸ªåŒåæ–¹æ³•ã€‚æˆ‘ä»¬çœ‹åˆ°@Overrideçš„å®šä¹‰ä¸­ä½¿ç”¨åˆ°äº† @Target, @Retentionï¼Œå®ƒä»¬å°±æ˜¯æ‰€è°“çš„â€œå…ƒæ³¨è§£â€â€”â€”å°±æ˜¯å®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼Œæˆ–è€…è¯´æ³¨è§£æ³¨è§£çš„æ³¨è§£ã€‚ @Retention çœ‹ä¸‹@Retentionæ³¨è§£å®šä¹‰ï¼š 12345678910111213141516/** * Indicates how long annotations with the annotated type are to * be retained. If no Retention annotation is present on * an annotation type declaration, the retention policy defaults to * RetentionPolicy.CLASS. */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Retention &#123; /** * Returns the retention policy. * @return the retention policy */ RetentionPolicy value();&#125; @Retentionç”¨äºŽæç¤ºæ³¨è§£è¢«ä¿ç•™å¤šé•¿æ—¶é—´ï¼Œæœ‰ä¸‰ç§å–å€¼ï¼š 12345678910111213141516171819public enum RetentionPolicy &#123; /** * Annotations are to be discarded by the compiler. */ SOURCE, /** * Annotations are to be recorded in the class file by the compiler * but need not be retained by the VM at run time. This is the default * behavior. */ CLASS, /** * Annotations are to be recorded in the class file by the compiler and * retained by the VM at run time, so they may be read reflectively. * * @see java.lang.reflect.AnnotatedElement */ RUNTIME&#125; RetentionPolicy.SOURCE ä¿ç•™åœ¨æºç çº§åˆ«ï¼Œè¢«ç¼–è¯‘å™¨æŠ›å¼ƒ(@Overrideå°±æ˜¯æ­¤ç±»)ï¼› RetentionPolicy.CLASSè¢«ç¼–è¯‘å™¨ä¿ç•™åœ¨ç¼–è¯‘åŽçš„ç±»æ–‡ä»¶çº§åˆ«ï¼Œä½†æ˜¯è¢«è™šæ‹Ÿæœºä¸¢å¼ƒï¼› RetentionPolicy.RUNTIMEä¿ç•™è‡³è¿è¡Œæ—¶ï¼Œå¯ä»¥è¢«åå°„è¯»å–ã€‚ @Target 1234567891011121314151617181920212223package java.lang.annotation;/** * Indicates the contexts in which an annotation type is applicable. The * declaration contexts and type contexts in which an annotation type may be * applicable are specified in JLS 9.6.4.1, and denoted in source code by enum * constants of java.lang.annotation.ElementType * @since 1.5 * @jls 9.6.4.1 @Target * @jls 9.7.4 Where Annotations May Appear */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Target &#123; /** * Returns an array of the kinds of elements an annotation type * can be applied to. * @return an array of the kinds of elements an annotation type * can be applied to */ ElementType[] value();&#125; @Targetç”¨äºŽæç¤ºè¯¥æ³¨è§£ä½¿ç”¨çš„åœ°æ–¹ï¼Œå–å€¼æœ‰ï¼š 12345678910111213141516171819202122232425262728public enum ElementType &#123; /** Class, interface (including annotation type), or enum declaration */ TYPE, /** Field declaration (includes enum constants) */ FIELD, /** Method declaration */ METHOD, /** Formal parameter declaration */ PARAMETER, /** Constructor declaration */ CONSTRUCTOR, /** Local variable declaration */ LOCAL_VARIABLE, /** Annotation type declaration */ ANNOTATION_TYPE, /** Package declaration */ PACKAGE, /** * Type parameter declaration * @since 1.8 */ TYPE_PARAMETER, /** * Use of a type * @since 1.8 */ TYPE_USE&#125; åˆ†åˆ«è¡¨ç¤ºè¯¥æ³¨è§£å¯ä»¥è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼š ç±»,æŽ¥å£,æ³¨è§£,enum; å±žæ€§åŸŸï¼› 3ï¼‰æ–¹æ³•ï¼› 4ï¼‰å‚æ•°ï¼› 5ï¼‰æž„é€ å‡½æ•°ï¼› 6ï¼‰å±€éƒ¨å˜é‡ï¼› 7ï¼‰æ³¨è§£ç±»åž‹ï¼› 8ï¼‰åŒ…ã€‚ æ‰€ä»¥ï¼š 1234@Target(ElementType.METHOD)@Retention(RetentionPolicy.SOURCE)public @interface Override &#123;&#125; è¡¨ç¤º @Override åªèƒ½ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¿ç•™åœ¨æºç çº§åˆ«ï¼Œè¢«ç¼–è¯‘å™¨å¤„ç†ï¼Œç„¶åŽæŠ›å¼ƒæŽ‰ã€‚ @Documented 12345678910111213/** * Indicates that annotations with a type are to be documented by javadoc * and similar tools by default. This type should be used to annotate the * declarations of types whose annotations affect the use of annotated * elements by their clients. If a type declaration is annotated with * Documented, its annotations become part of the public API * of the annotated elements. */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Documented &#123;&#125; è¡¨ç¤ºæ³¨è§£æ˜¯å¦èƒ½è¢« javadoc å¤„ç†å¹¶ä¿ç•™åœ¨æ–‡æ¡£ä¸­ã€‚ ä½¿ç”¨ å…ƒæ³¨è§£ æ¥è‡ªå®šä¹‰æ³¨è§£ å’Œ å¤„ç†è‡ªå®šä¹‰æ³¨è§£ æœ‰äº†å…ƒæ³¨è§£ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒæ¥è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦çš„æ³¨è§£ã€‚ç»“åˆè‡ªå®šä¹‰æ³¨è§£å’ŒAOPæˆ–è€…è¿‡æ»¤å™¨ï¼Œååˆ†å¼ºå¤§ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®žçŽ°æƒé™çš„ç»†ç²’åº¦çš„æŽ§åˆ¶â€”â€”åœ¨ç±»æˆ–è€…æ–¹æ³•ä¸Šä½¿ç”¨æƒé™æ³¨è§£ï¼Œç„¶åŽåœ¨AOPæˆ–è€…è¿‡æ»¤å™¨ä¸­è¿›è¡Œæ‹¦æˆªå¤„ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºŽç™»å½•çš„æƒé™çš„æ³¨è§£çš„å®žçŽ°ï¼š 12345678/** * ä¸éœ€è¦ç™»å½•æ³¨è§£ */@Target(&#123; ElementType.METHOD, ElementType.TYPE &#125;)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface NoLogin &#123;&#125; è‡ªå®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ @NoLogin, å¯ä»¥è¢«ç”¨äºŽ æ–¹æ³• å’Œ ç±» ä¸Šï¼Œæ³¨è§£ä¸€ç›´ä¿ç•™åˆ°è¿è¡ŒæœŸï¼Œå¯ä»¥è¢«åå°„è¯»å–åˆ°ã€‚è¯¥æ³¨è§£çš„å«ä¹‰æ˜¯ï¼šè¢« @NoLogin æ³¨è§£çš„ç±»æˆ–è€…æ–¹æ³•ï¼Œå³ä½¿ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ã€‚ä¸‹é¢å°±æ˜¯å¯¹æ³¨è§£è¿›è¡Œå¤„ç†äº†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * æ£€æŸ¥ç™»å½•æ‹¦æˆªå™¨ * å¦‚ä¸éœ€è¦æ£€æŸ¥ç™»å½•å¯åœ¨æ–¹æ³•æˆ–è€…controllerä¸ŠåŠ ä¸Š@NoLogin */public class CheckLoginInterceptor implements HandlerInterceptor &#123; private static final Logger logger = Logger.getLogger(CheckLoginInterceptor.class); @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123; if (!(handler instanceof HandlerMethod)) &#123; logger.warn("å½“å‰æ“ä½œhandlerä¸ä¸ºHandlerMethod=" + handler.getClass().getName() + ",req=" + request.getQueryString()); return true; &#125; HandlerMethod handlerMethod = (HandlerMethod) handler; String methodName = handlerMethod.getMethod().getName(); // åˆ¤æ–­æ˜¯å¦éœ€è¦æ£€æŸ¥ç™»å½• NoLogin noLogin = handlerMethod.getMethod().getAnnotation(NoLogin.class); if (null != noLogin) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("å½“å‰æ“ä½œmethodName=" + methodName + "ä¸éœ€è¦æ£€æŸ¥ç™»å½•æƒ…å†µ"); &#125; return true; &#125; noLogin = handlerMethod.getMethod().getDeclaringClass().getAnnotation(NoLogin.class); if (null != noLogin) &#123; if (logger.isDebugEnabled()) &#123; logger.debug("å½“å‰æ“ä½œmethodName=" + methodName + "ä¸éœ€è¦æ£€æŸ¥ç™»å½•æƒ…å†µ"); &#125; return true; &#125; if (null == request.getSession().getAttribute(CommonConstants.SESSION_KEY_USER)) &#123; logger.warn("å½“å‰æ“ä½œ" + methodName + "ç”¨æˆ·æœªç™»å½•,ip=" + request.getRemoteAddr()); response.getWriter().write(JsonConvertor.convertFailResult(ErrorCodeEnum.NOT_LOGIN).toString()); // è¿”å›žé”™è¯¯ä¿¡æ¯ return false; &#125; return true; &#125; @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception &#123; &#125; @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception &#123; &#125;&#125; ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç™»å½•æ‹¦æˆªå™¨ï¼Œé¦–å…ˆä½¿ç”¨åå°„æ¥åˆ¤æ–­æ–¹æ³•ä¸Šæ˜¯å¦è¢« @NoLogin æ³¨è§£ï¼š NoLogin noLogin = handlerMethod.getMethod().getAnnotation(NoLogin.class); ç„¶åŽåˆ¤æ–­ç±»æ˜¯å¦è¢« @NoLoginæ³¨è§£ï¼š noLogin = handlerMethod.getMethod().getDeclaringClass().getAnnotation(NoLogin.class); å¦‚æžœè¢«æ³¨è§£äº†ï¼Œå°±è¿”å›ž trueï¼Œå¦‚æžœæ²¡æœ‰è¢«æ³¨è§£ï¼Œå°±åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•ï¼Œæ²¡æœ‰ç™»å½•åˆ™è¿”å›žé”™è¯¯ä¿¡æ¯ç»™å‰å°å’Œfalse. è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ æ³¨è§£ å’Œ è¿‡æ»¤å™¨ æ¥è¿›è¡Œæƒé™å¤„ç†çš„ä¾‹å­ã€‚æ‰©å±•å¼€æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ³¨è§£ï¼Œæ¥è¡¨ç¤ºæŸæ–¹æ³•æˆ–è€…ç±»ï¼Œåªèƒ½è¢«å…·æœ‰æŸç§è§’è‰²ï¼Œæˆ–è€…å…·æœ‰æŸç§æƒé™çš„ç”¨æˆ·æ‰€è®¿é—®ï¼Œç„¶åŽåœ¨è¿‡æ»¤å™¨ä¸­è¿›è¡Œåˆ¤æ–­å¤„ç†ã€‚ Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£ @Autowired æ˜¯æˆ‘ä»¬ä½¿ç”¨å¾—æœ€å¤šçš„æ³¨è§£ï¼Œå…¶å®žå°±æ˜¯ autowire=byType å°±æ˜¯æ ¹æ®ç±»åž‹çš„è‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼ˆåŸºäºŽæ³¨è§£çš„ä¾èµ–æ³¨å…¥ï¼‰ï¼Œå¯ä»¥è¢«ä½¿ç”¨åœ¨å±žæ€§åŸŸï¼Œæ–¹æ³•ï¼Œæž„é€ å‡½æ•°ä¸Šã€‚ @Qualifier å°±æ˜¯ autowire=byName, @Autowiredæ³¨è§£åˆ¤æ–­å¤šä¸ªbeanç±»åž‹ç›¸åŒæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ @Qualifier(&quot;xxBean&quot;) æ¥æŒ‡å®šä¾èµ–çš„beançš„idï¼š 123456@Controller@RequestMapping("/user")public class HelloController &#123; @Autowired @Qualifier("userService") private UserService userService; @Resource å±žäºŽJSR-250æ ‡å‡†ï¼Œç”¨äºŽå±žæ€§åŸŸå’Œæ–¹æ³•ä¸Šã€‚ä¹Ÿæ˜¯ byName ç±»åž‹çš„ä¾èµ–æ³¨å…¥ã€‚ä½¿ç”¨æ–¹å¼ï¼š@Resource(name=&quot;xxBean&quot;). ä¸å¸¦å‚æ•°çš„ @Resource é»˜è®¤å€¼ç±»åé¦–å­—æ¯å°å†™ã€‚ JSR-330æ ‡å‡†javax.inject.*ä¸­çš„æ³¨è§£(@Inject, @Named, @Qualifier, @Provider, @Scope, @Singleton)ã€‚@Injectå°±ç›¸å½“äºŽ@Autowired, @Named å°±ç›¸å½“äºŽ @Qualifier, å¦å¤– @Named ç”¨åœ¨ç±»ä¸Šè¿˜æœ‰ @Componentçš„åŠŸèƒ½ã€‚ @Component, @Controller, @Service, @Repository, è¿™å‡ ä¸ªæ³¨è§£ä¸åŒäºŽä¸Šé¢çš„æ³¨è§£ï¼Œä¸Šé¢çš„æ³¨è§£éƒ½æ˜¯å°†è¢«ä¾èµ–çš„beanæ³¨å…¥è¿›æ¥ï¼Œè€Œè¿™å‡ ä¸ªæ³¨è§£çš„ä½œç”¨éƒ½æ˜¯ç”Ÿäº§bean, è¿™äº›æ³¨è§£éƒ½æ˜¯æ³¨è§£åœ¨ç±»ä¸Šï¼Œå°†ç±»æ³¨è§£æˆspringçš„beanå·¥åŽ‚ä¸­ä¸€ä¸ªä¸€ä¸ªçš„beanã€‚@Controller, @Service, @RepositoryåŸºæœ¬å°±æ˜¯è¯­ä¹‰æ›´åŠ ç»†åŒ–çš„@Componentã€‚ @PostConstruct å’Œ @PreDestroy ä¸æ˜¯ç”¨äºŽä¾èµ–æ³¨å…¥ï¼Œè€Œæ˜¯bean çš„ç”Ÿå‘½å‘¨æœŸã€‚ç±»ä¼¼äºŽ init-method(InitializeingBean)å’Œdestory-method(DisposableBean)ã€‚ Springä¸­æ³¨è§£çš„å¤„ç† springä¸­æ³¨è§£çš„å¤„ç†åŸºæœ¬éƒ½æ˜¯é€šè¿‡å®žçŽ°æŽ¥å£ BeanPostProcessor æ¥è¿›è¡Œçš„ï¼š 1234public interface BeanPostProcessor &#123; Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;&#125; ç›¸å…³çš„å¤„ç†ç±»æœ‰ï¼š AutowiredAnnotationBeanPostProcessorï¼Œ CommonAnnotationBeanPostProcessorï¼Œ PersistenceAnnotationBeanPostProcessorï¼Œ RequiredAnnotationBeanPostProcessorã€‚ è¿™äº›å¤„ç†ç±»ï¼Œå¯ä»¥é€šè¿‡ &lt;context:annotation-config/&gt; é…ç½® éšå¼çš„é…ç½®è¿›springå®¹å™¨ã€‚è¿™äº›éƒ½æ˜¯ä¾èµ–æ³¨å…¥çš„å¤„ç†ï¼Œè¿˜æœ‰ç”Ÿäº§beançš„æ³¨è§£(@Componentï¼Œ @Controller, @Service, @Repository)çš„å¤„ç†ï¼š &lt;context:component-scan base-package=&quot;net.aazj.service,net.aazj.aop&quot; /&gt; è¿™äº›éƒ½æ˜¯é€šè¿‡æŒ‡å®šæ‰«æçš„åŸºåŒ…è·¯å¾„æ¥è¿›è¡Œçš„ï¼Œå°†ä»–ä»¬æ‰«æè¿›springçš„beanå®¹å™¨ã€‚æ³¨æ„ &lt;context:component-scan/&gt; ä¹Ÿä¼šé»˜è®¤å°† AutowiredAnnotationBeanPostProcessorï¼ŒCommonAnnotationBeanPostProcessor é…ç½®è¿›æ¥ã€‚æ‰€ä»¥&lt;context:annotation-config/&gt;æ˜¯å¯ä»¥çœç•¥çš„ã€‚å¦å¤–&lt;context:component-scan/&gt;ä¹Ÿå¯ä»¥æ‰«æ@Aspecté£Žæ ¼çš„AOPæ³¨è§£ï¼Œä½†æ˜¯éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ &lt;aop:aspectj-autoproxy/&gt;è¿›è¡Œé…åˆã€‚ Springæ³¨è§£å’ŒJSR-330æ ‡å‡†æ³¨è§£çš„åŒºåˆ«]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ReentrantLock]]></title>
    <url>%2Fposts%2Ffd3ef277.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åœ¨Jdk5.0ä¹‹å‰ï¼Œåè°ƒå¯¹å…±äº«å¯¹è±¡çš„è®¿é—®å¯ä»¥ä½¿ç”¨çš„æœºåˆ¶åªæœ‰synchronizedå’Œvolatileã€‚synchronizedå…³é”®å­—å®žçŽ°äº†å†…ç½®é”ï¼Œè€Œvolatileå…³é”®å­—ä¿è¯äº†å¤šçº¿ç¨‹çš„å†…å­˜å¯è§æ€§ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›æœºåˆ¶éƒ½èƒ½å¾ˆå¥½åœ°å®Œæˆå·¥ä½œï¼Œä½†å´æ— æ³•å®žçŽ°ä¸€äº›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œæ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…èŽ·å–é”çš„çº¿ç¨‹ï¼Œæ— æ³•å®žçŽ°é™å®šæ—¶é—´çš„èŽ·å–é”æœºåˆ¶ï¼Œæ— æ³•å®žçŽ°éžé˜»å¡žç»“æž„çš„åŠ é”è§„åˆ™ç­‰ã€‚è€Œè¿™äº›æ›´çµæ´»çš„åŠ é”æœºåˆ¶é€šå¸¸éƒ½èƒ½å¤Ÿæä¾›æ›´å¥½çš„æ´»è·ƒæ€§æˆ–æ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨Jdk5.0ä¸­å¢žåŠ äº†ä¸€ç§æ–°çš„æœºåˆ¶ï¼šReentrantLockã€‚ ReentrantLockç±»å®žçŽ°äº†LockæŽ¥å£ï¼Œå¹¶æä¾›äº†ä¸Žsynchronizedç›¸åŒçš„äº’æ–¥æ€§å’Œå†…å­˜å¯è§æ€§ï¼Œå®ƒçš„åº•å±‚æ˜¯é€šè¿‡AQSæ¥å®žçŽ°å¤šçº¿ç¨‹åŒæ­¥çš„ã€‚ä¸Žå†…ç½®é”ç›¸æ¯”ReentrantLockä¸ä»…æä¾›äº†æ›´ä¸°å¯Œçš„åŠ é”æœºåˆ¶ï¼Œè€Œä¸”åœ¨æ€§èƒ½ä¸Šä¹Ÿä¸é€Šè‰²äºŽå†…ç½®é”(åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ç”šè‡³ä¼˜äºŽå†…ç½®é”)ã€‚ synchronizedå…³é”®å­— Javaæä¾›äº†å†…ç½®é”æ¥æ”¯æŒå¤šçº¿ç¨‹çš„åŒæ­¥ï¼ŒJVMæ ¹æ®synchronizedå…³é”®å­—æ¥æ ‡è¯†åŒæ­¥ä»£ç å—ã€‚ å½“çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨èŽ·å–é”ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚ä¸€ä¸ªçº¿ç¨‹èŽ·å¾—é”åŽå…¶ä»–çº¿ç¨‹å°†ä¼šè¢«é˜»å¡žã€‚ æ¯ä¸ªJavaå¯¹è±¡éƒ½å¯ä»¥ç”¨åšä¸€ä¸ªå®žçŽ°åŒæ­¥çš„é”ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°å¯¹è±¡æ–¹æ³•ï¼Œé™æ€æ–¹æ³•å’Œä»£ç å—ã€‚ å½“ä¿®é¥°å¯¹è±¡æ–¹æ³•å’Œé™æ€æ–¹æ³•æ—¶é”åˆ†åˆ«æ˜¯æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡å’ŒClasså¯¹è±¡ï¼Œå½“ä¿®é¥°ä»£ç å—æ—¶éœ€æä¾›é¢å¤–çš„å¯¹è±¡ä½œä¸ºé”ã€‚ æ¯ä¸ªJavaå¯¹è±¡ä¹‹æ‰€ä»¥å¯ä»¥ä½œä¸ºé”ï¼Œæ˜¯å› ä¸ºåœ¨å¯¹è±¡å¤´ä¸­å…³è”äº†ä¸€ä¸ªmonitorå¯¹è±¡(ç®¡ç¨‹)ã€‚çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨æŒæœ‰monitorå¯¹è±¡ï¼Œé€€å‡ºæ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾monitorå¯¹è±¡ï¼Œå½“monitorå¯¹è±¡è¢«æŒæœ‰æ—¶å…¶ä»–çº¿ç¨‹å°†ä¼šè¢«é˜»å¡žã€‚å½“ç„¶è¿™äº›åŒæ­¥æ“ä½œéƒ½ç”±JVMåº•å±‚å¸®ä½ å®žçŽ°äº†ï¼Œä½†ä»¥synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•å’Œä»£ç å—åœ¨åº•å±‚å®žçŽ°ä¸Šè¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ã€‚ synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æ˜¯éšå¼åŒæ­¥çš„ï¼Œå³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æŽ§åˆ¶çš„ï¼ŒJVMå¯ä»¥æ ¹æ®æ–¹æ³•è¡¨ä¸­çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ¥åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦æ˜¯åŒæ­¥æ–¹æ³•ï¼› è€Œsynchronizedå…³é”®å­—ä¿®é¥°çš„ä»£ç å—æ˜¯æ˜¾å¼åŒæ­¥çš„ï¼Œå®ƒæ˜¯é€šè¿‡monitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤æ¥æŽ§åˆ¶çº¿ç¨‹å¯¹ç®¡ç¨‹çš„æŒæœ‰å’Œé‡Šæ”¾ã€‚ monitorå¯¹è±¡å†…éƒ¨æŒæœ‰_countå­—æ®µï¼Œ_countç­‰äºŽ0è¡¨ç¤ºç®¡ç¨‹æœªè¢«æŒæœ‰ï¼Œ_countå¤§äºŽ0è¡¨ç¤ºç®¡ç¨‹å·²è¢«æŒæœ‰ï¼Œæ¯æ¬¡æŒæœ‰çº¿ç¨‹é‡å…¥æ—¶_countéƒ½ä¼šåŠ 1ï¼Œæ¯æ¬¡æŒæœ‰çº¿ç¨‹é€€å‡ºæ—¶_countéƒ½ä¼šå‡1ï¼Œè¿™å°±æ˜¯å†…ç½®é”é‡å…¥æ€§çš„å®žçŽ°åŽŸç†ã€‚ å¦å¤–ï¼Œmonitorå¯¹è±¡å†…éƒ¨è¿˜æœ‰ä¸¤æ¡é˜Ÿåˆ—_EntryListå’Œ_WaitSetï¼Œå¯¹åº”ç€AQSçš„åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹èŽ·å–é”å¤±è´¥æ—¶ä¼šåˆ°_EntryListä¸­é˜»å¡žï¼Œå½“è°ƒç”¨é”å¯¹è±¡çš„waitæ–¹æ³•æ—¶çº¿ç¨‹å°†ä¼šè¿›å…¥_WaitSetä¸­ç­‰å¾…ï¼Œè¿™æ˜¯å†…ç½®é”çš„çº¿ç¨‹åŒæ­¥å’Œæ¡ä»¶ç­‰å¾…çš„å®žçŽ°åŽŸç†ã€‚ ReentrantLockå’ŒSynchronizedçš„å¯¹æ¯” synchronizedå…³é”®å­—æ˜¯Javaæä¾›çš„å†…ç½®é”æœºåˆ¶ï¼Œå…¶åŒæ­¥æ“ä½œç”±åº•å±‚JVMå®žçŽ°ï¼Œè€ŒReentrantLockæ˜¯java.util.concurrentåŒ…æä¾›çš„æ˜¾å¼é”ï¼Œå…¶åŒæ­¥æ“ä½œç”±AQSåŒæ­¥å™¨æä¾›æ”¯æŒã€‚ ReentrantLockåœ¨åŠ é”å’Œå†…å­˜ä¸Šæä¾›çš„è¯­ä¹‰ä¸Žå†…ç½®é”ç›¸åŒï¼Œæ­¤å¤–å®ƒè¿˜æä¾›äº†ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬å®šæ—¶çš„é”ç­‰å¾…ï¼Œå¯ä¸­æ–­çš„é”ç­‰å¾…ï¼Œå…¬å¹³é”ï¼Œä»¥åŠå®žçŽ°éžå—ç»“æž„çš„åŠ é”ã€‚ åœ¨æ—©æœŸçš„JDKç‰ˆæœ¬ä¸­ReentrantLockåœ¨æ€§èƒ½ä¸Šè¿˜å æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œæ—¢ç„¶ReentrantLockæ‹¥æœ‰è¿™ä¹ˆå¤šä¼˜åŠ¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨synchronizedå…³é”®å­—å‘¢ï¼Ÿäº‹å®žä¸Šç¡®å®žæœ‰è®¸å¤šäººä½¿ç”¨ReentrantLockæ¥æ›¿ä»£synchronizedå…³é”®å­—çš„åŠ é”æ“ä½œã€‚ä½†æ˜¯å†…ç½®é”ä»ç„¶æœ‰å®ƒç‰¹æœ‰çš„ä¼˜åŠ¿ï¼Œå†…ç½®é”ä¸ºè®¸å¤šå¼€å‘äººå‘˜æ‰€ç†Ÿæ‚‰ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ›´åŠ çš„ç®€æ´ç´§å‡‘ï¼Œå› ä¸ºæ˜¾å¼é”å¿…é¡»æ‰‹åŠ¨åœ¨finallyå—ä¸­è°ƒç”¨unlockï¼Œæ‰€ä»¥ä½¿ç”¨å†…ç½®é”ç›¸å¯¹æ¥è¯´ä¼šæ›´åŠ å®‰å…¨äº›ã€‚åŒæ—¶æœªæ¥æ›´åŠ å¯èƒ½ä¼šåŽ»æå‡synchronizedè€Œä¸æ˜¯ReentrantLockçš„æ€§èƒ½ã€‚å› ä¸ºsynchronizedæ˜¯JVMçš„å†…ç½®å±žæ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä¾‹å¦‚å¯¹çº¿ç¨‹å°é—­çš„é”å¯¹è±¡çš„é”æ¶ˆé™¤ä¼˜åŒ–ï¼Œé€šè¿‡å¢žåŠ é”çš„ç²’åº¦æ¥æ¶ˆé™¤å†…ç½®é”çš„åŒæ­¥ï¼Œè€Œå¦‚æžœé€šè¿‡åŸºäºŽç±»åº“çš„é”æ¥å®žçŽ°è¿™äº›åŠŸèƒ½ï¼Œåˆ™å¯èƒ½æ€§ä¸å¤§ã€‚æ‰€ä»¥å½“éœ€è¦ä¸€äº›é«˜çº§åŠŸèƒ½æ—¶æ‰åº”è¯¥ä½¿ç”¨ReentrantLockï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ï¼šå¯å®šæ—¶çš„ï¼Œå¯è½®è¯¢çš„ä¸Žå¯ä¸­æ–­çš„é”èŽ·å–æ“ä½œï¼Œå…¬å¹³é˜Ÿåˆ—ï¼Œä»¥åŠéžå—ç»“æž„çš„é”ã€‚å¦åˆ™ï¼Œè¿˜æ˜¯åº”è¯¥ä¼˜å…ˆä½¿ç”¨synchronizedã€‚ èŽ·å–é”å’Œé‡Šæ”¾é” é¦–å…ˆé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£ä¸‹ReentrantLockçš„ç”¨æ³•ï¼šå¦‚æžœæœ‰ä¸€ä¸ªå…±äº«å˜é‡countï¼Œæœ‰10ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œç´¯åŠ ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ç´¯åŠ 1000æ¬¡ï¼Œè¿™æ®µä»£ç æ€Žæ ·è®¾è®¡å‘¢ï¼Ÿ æœ‰å¾ˆå¤šç§åŠžæ³•ï¼Œå¯ä»¥åˆ©ç”¨synchronizedå…³é”®å­—ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨åŽŸå­ç±»AtomicInteger,é‚£æˆ‘ä»¬åˆ©ç”¨ReentrantLockæ€Žæ ·å¤„ç†çš„ï¼Ÿ 123456789101112131415161718192021222324252627282930package main.java.com.study.lock;/** * @author: whb * @description: ReentrantLockæµ‹è¯•ç±» */public class ReentrantLockTest &#123; private static int count = 0; //é»˜è®¤æ˜¯èŽ·å–ä¸€ä¸ªéžå…¬å¹³é” private static ReentrantLock lock = new ReentrantLock(); public static void main(String[] args) throws InterruptedException &#123; for (int i = 0; i &lt; 10; i++) &#123; new Thread(() -&gt; &#123; try &#123; //æ‰§è¡Œå‰å…ˆåŠ é” lock.lock(); for (int j = 0; j &lt; 1000; j++) &#123; count++; &#125; &#125; finally &#123; //æœ€åŽé‡Šæ”¾é” lock.unlock(); &#125; &#125;).start(); &#125; Thread.sleep(5000); System.out.println("count=" + count); &#125;&#125; ä»¥ä¸‹æ˜¯èŽ·å–é”å’Œé‡Šæ”¾é”è¿™ä¸¤ä¸ªæ“ä½œçš„APIã€‚ 12345678//èŽ·å–é”çš„æ“ä½œpublic void lock() &#123; sync.lock();&#125;//é‡Šæ”¾é”çš„æ“ä½œpublic void unlock() &#123; sync.release(1);&#125; é”çš„èŽ·å–å’Œé‡Šæ”¾çš„æºç å¹¶æ²¡æœ‰æ›´å¤šçš„é€»è¾‘ï¼Œè€Œæ ¸å¿ƒçš„é€»è¾‘åˆ†åˆ«å§”æ‰˜ç»™Syncå¯¹è±¡çš„lockæ–¹æ³•å’Œreleaseæ–¹æ³•ã€‚é‚£ä¹ˆSyncåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨AQSçš„æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œåœ¨å¹¶å‘åŒ…ä¸­é”çš„åº•å±‚å®žçŽ°éƒ½æ˜¯é€šè¿‡AQSæ¡†æž¶å®žçŽ°çš„ã€‚ å¦‚æžœæƒ³å®žçŽ°ç‹¬å é”ï¼Œå­ç±»åªéœ€è¦å®žçŽ°å¦‚ä¸‹æ–¹æ³•ï¼š 1ï¼šèŽ·å–é”ï¼štryAcquire() 2ï¼šé‡Šæ”¾é”ï¼štryRelease() å¦‚æžœæƒ³å®žçŽ°å…±äº«é”ï¼š 1: èŽ·å–é”ï¼štryAcquireShared() 2: é‡Šæ”¾é”ï¼štryReleaseShared() Syncå°±æ˜¯AQSçš„å­ç±»,å¹¶ä¸”æ˜¯ç‹¬å é”æ¨¡å¼ã€‚ åœ¨ReentrantLockä¸­æœ‰ä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯éžå…¬å¹³æ¨¡å¼èŽ·å–é”ï¼Œå¦ä¸€ç§æ˜¯å…¬å¹³æ¨¡å¼èŽ·å–é”ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯éžå…¬å¹³çš„ã€‚ 1234567891011121314151617181920212223242526272829303132public class ReentrantLock implements Lock, java.io.Serializable &#123; private final Sync sync; abstract static class Sync extends AbstractQueuedSynchronizer &#123; abstract void lock(); &#125; //å®žçŽ°éžå…¬å¹³é”çš„åŒæ­¥å™¨ static final class NonfairSync extends Sync &#123; final void lock() &#123; ... &#125; &#125; //å®žçŽ°å…¬å¹³é”çš„åŒæ­¥å™¨ static final class FairSync extends Sync &#123; final void lock() &#123; ... &#125; &#125; //é»˜è®¤æž„é€ å™¨ï¼šéžå…¬å¹³é” public ReentrantLock() &#123; sync = new NonfairSync(); &#125; //å¸¦å‚æž„é€ å™¨ï¼šfair=trueè¡¨ç¤ºæ˜¯å…¬å¹³æ¨¡å¼èŽ·å–é”;fair=falseè¡¨ç¤ºæ˜¯éžå…¬å¹³æ¨¡å¼èŽ·å–é” public ReentrantLock(boolean fair) &#123; sync = fair ? new FairSync() : new NonfairSync(); &#125;&#125; è°ƒç”¨é»˜è®¤æ— å‚æž„é€ å™¨ä¼šå°†NonfairSyncå®žä¾‹èµ‹å€¼ç»™syncï¼Œæ­¤æ—¶é”æ˜¯éžå…¬å¹³é”ã€‚æœ‰å‚æž„é€ å™¨å…è®¸é€šè¿‡å‚æ•°æ¥æŒ‡å®šæ˜¯å°†FairSyncå®žä¾‹è¿˜æ˜¯NonfairSyncå®žä¾‹èµ‹å€¼ç»™syncã€‚NonfairSyncå’ŒFairSyncéƒ½æ˜¯ç»§æ‰¿è‡ªSyncç±»å¹¶é‡å†™äº†lock()æ–¹æ³•ï¼Œæ‰€ä»¥å…¬å¹³é”å’Œéžå…¬å¹³é”åœ¨èŽ·å–é”çš„æ–¹å¼ä¸Šæœ‰äº›åŒºåˆ«ã€‚ å†æ¥çœ‹çœ‹é‡Šæ”¾é”çš„æ“ä½œï¼Œæ¯æ¬¡è°ƒç”¨unlock()æ–¹æ³•éƒ½åªæ˜¯åŽ»æ‰§è¡Œsync.release(1)æ“ä½œï¼Œè¿™æ­¥æ“ä½œä¼šè°ƒç”¨AbstractQueuedSynchronizerç±»çš„release()æ–¹æ³•ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ï¼š 123456789101112131415//é‡Šæ”¾é”çš„æ“ä½œ(ç‹¬å æ¨¡å¼)public final boolean release(int arg) &#123; //å°è¯•é‡Šæ”¾é” if (tryRelease(arg)) &#123; //èŽ·å–headç»“ç‚¹ Node h = head; //å¦‚æžœheadç»“ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”ç­‰å¾…çŠ¶æ€ä¸ç­‰äºŽ0å°±åŽ»å”¤é†’åŽç»§ç»“ç‚¹ if (h != null &amp;&amp; h.waitStatus != 0) &#123; //å”¤é†’åŽç»§ç»“ç‚¹ unparkSuccessor(h); &#125; return true; &#125; return false;&#125; è¿™ä¸ªreleaseæ–¹æ³•æ˜¯AQSæä¾›çš„é‡Šæ”¾é”æ“ä½œçš„APIï¼Œå®ƒé¦–å…ˆä¼šåŽ»è°ƒç”¨tryReleaseæ–¹æ³•åŽ»å°è¯•èŽ·å–é”ï¼ŒtryReleaseæ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„å®žçŽ°é€»è¾‘åœ¨å­ç±»Syncé‡Œé¢ã€‚ 123456789101112131415161718//å°è¯•é‡Šæ”¾é”protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; //å¦‚æžœæŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±æŠ›å‡ºå¼‚å¸¸ if (Thread.currentThread() != getExclusiveOwnerThread()) &#123; throw new IllegalMonitorStateException(); &#125; boolean free = false; //å¦‚æžœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜Žé”è¢«é‡Šæ”¾ if (c == 0) &#123; //è®¾ç½®é”è¢«é‡Šæ”¾çš„æ ‡å¿—ä¸ºçœŸ free = true; //è®¾ç½®å ç”¨çº¿ç¨‹ä¸ºç©º setExclusiveOwnerThread(null); &#125; setState(c); return free;&#125; è¿™ä¸ªtryReleaseæ–¹æ³•é¦–å…ˆä¼šèŽ·å–å½“å‰åŒæ­¥çŠ¶æ€ï¼Œå¹¶å°†å½“å‰åŒæ­¥çŠ¶æ€å‡åŽ»ä¼ å…¥çš„å‚æ•°å€¼å¾—åˆ°æ–°çš„åŒæ­¥çŠ¶æ€ï¼Œç„¶åŽåˆ¤æ–­æ–°çš„åŒæ­¥çŠ¶æ€æ˜¯å¦ç­‰äºŽ0ï¼Œå¦‚æžœç­‰äºŽ0åˆ™è¡¨æ˜Žå½“å‰é”è¢«é‡Šæ”¾ï¼Œç„¶åŽå…ˆå°†é”çš„é‡Šæ”¾çŠ¶æ€ç½®ä¸ºçœŸï¼Œå†å°†å½“å‰å æœ‰é”çš„çº¿ç¨‹æ¸…ç©ºï¼Œæœ€åŽè°ƒç”¨setStateæ–¹æ³•è®¾ç½®æ–°çš„åŒæ­¥çŠ¶æ€å¹¶è¿”å›žé”çš„é‡Šæ”¾çŠ¶æ€ã€‚ å…¬å¹³é”/éžå…¬å¹³é” ReentrantLockæ˜¯å…¬å¹³é”è¿˜æ˜¯éžå…¬å¹³é”æ˜¯åŸºäºŽsyncæŒ‡å‘çš„æ˜¯å“ªä¸ªå…·ä½“å®žä¾‹ã€‚åœ¨æž„é€ æ—¶ä¼šä¸ºæˆå‘˜å˜é‡syncèµ‹å€¼ï¼Œå¦‚æžœèµ‹å€¼ä¸ºNonfairSyncå®žä¾‹åˆ™è¡¨æ˜Žæ˜¯éžå…¬å¹³é”ï¼Œå¦‚æžœèµ‹å€¼ä¸ºFairSyncå®žä¾‹åˆ™è¡¨æ˜Žä¸ºå…¬å¹³é”ã€‚å¦‚æžœæ˜¯å…¬å¹³é”ï¼Œçº¿ç¨‹å°†æŒ‰ç…§å®ƒä»¬å‘å‡ºè¯·æ±‚çš„é¡ºåºæ¥èŽ·å¾—é”ï¼Œä½†åœ¨éžå…¬å¹³é”ä¸Šï¼Œåˆ™å…è®¸æ’é˜Ÿè¡Œä¸ºï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚éžå…¬å¹³çš„é”æ—¶ï¼Œå¦‚æžœåœ¨å‘å‡ºè¯·æ±‚çš„åŒæ—¶è¯¥é”çš„çŠ¶æ€å˜ä¸ºå¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°†è·³è¿‡é˜Ÿåˆ—ä¸­æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç›´æŽ¥èŽ·å¾—è¿™ä¸ªé”ã€‚ éžå…¬å¹³é” 12345678910111213141516171819202122232425//éžå…¬å¹³åŒæ­¥å™¨static final class NonfairSync extends Sync &#123; //å®žçŽ°çˆ¶ç±»çš„æŠ½è±¡èŽ·å–é”çš„æ–¹æ³• final void lock() &#123; //ä½¿ç”¨CASæ–¹å¼è®¾ç½®åŒæ­¥çŠ¶æ€ if (compareAndSetState(0, 1)) &#123; //å¦‚æžœè®¾ç½®æˆåŠŸåˆ™è¡¨æ˜Žé”æ²¡è¢«å ç”¨ setExclusiveOwnerThread(Thread.currentThread()); &#125; else &#123; //å¦åˆ™è¡¨æ˜Žé”å·²ç»è¢«å ç”¨, è°ƒç”¨acquireè®©çº¿ç¨‹åŽ»åŒæ­¥é˜Ÿåˆ—æŽ’é˜ŸèŽ·å– acquire(1); &#125; &#125; //å°è¯•èŽ·å–é”çš„æ–¹æ³• protected final boolean tryAcquire(int acquires) &#123; return nonfairTryAcquire(acquires); &#125;&#125;//ä»¥ä¸å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(ç‹¬å æ¨¡å¼)public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) &#123; selfInterrupt(); &#125;&#125; å¯ä»¥çœ‹åˆ°åœ¨éžå…¬å¹³é”çš„lockæ–¹æ³•ä¸­ï¼Œçº¿ç¨‹ç¬¬ä¸€æ­¥å°±ä¼šä»¥CASæ–¹å¼å°†åŒæ­¥çŠ¶æ€çš„å€¼ä»Ž0æ”¹ä¸º1ã€‚å…¶å®žè¿™æ­¥æ“ä½œå°±ç­‰äºŽåŽ»å°è¯•èŽ·å–é”ï¼Œå¦‚æžœæ›´æ”¹æˆåŠŸåˆ™è¡¨æ˜Žçº¿ç¨‹åˆšæ¥å°±èŽ·å–äº†é”ï¼Œè€Œä¸å¿…å†åŽ»åŒæ­¥é˜Ÿåˆ—é‡Œé¢æŽ’é˜Ÿäº†ã€‚å¦‚æžœæ›´æ”¹å¤±è´¥åˆ™è¡¨æ˜Žçº¿ç¨‹åˆšæ¥æ—¶é”è¿˜æœªè¢«é‡Šæ”¾ï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥å°±è°ƒç”¨acquireæ–¹æ³•ã€‚è¿™ä¸ªacquireæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªAbstractQueuedSynchronizerçš„æ–¹æ³•ï¼šçº¿ç¨‹è¿›å…¥acquireæ–¹æ³•åŽé¦–å…ˆåŽ»è°ƒç”¨tryAcquireæ–¹æ³•å°è¯•åŽ»èŽ·å–é”ï¼Œç”±äºŽNonfairSyncè¦†ç›–äº†tryAcquireæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è°ƒç”¨äº†çˆ¶ç±»Syncçš„nonfairTryAcquireæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨åˆ°nonfairTryAcquireæ–¹æ³•åŽ»å°è¯•èŽ·å–é”ã€‚ä¸‹é¢çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å…·ä½“åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627//éžå…¬å¹³çš„èŽ·å–é”final boolean nonfairTryAcquire(int acquires) &#123; //èŽ·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); //èŽ·å–å½“å‰åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æžœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜Žé”æ²¡æœ‰è¢«å ç”¨ if (c == 0) &#123; //ä½¿ç”¨CASæ›´æ–°åŒæ­¥çŠ¶æ€ if (compareAndSetState(0, acquires)) &#123; //è®¾ç½®ç›®å‰å ç”¨é”çš„çº¿ç¨‹ setExclusiveOwnerThread(current); return true; &#125; //å¦åˆ™çš„è¯å°±åˆ¤æ–­æŒæœ‰é”çš„æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ &#125;else if (current == getExclusiveOwnerThread()) &#123; //å¦‚æžœé”æ˜¯è¢«å½“å‰çº¿ç¨‹æŒæœ‰çš„, å°±ç›´æŽ¥ä¿®æ”¹å½“å‰åŒæ­¥çŠ¶æ€ int nextc = c + acquires; if (nextc &lt; 0) &#123; throw new Error("Maximum lock count exceeded"); &#125; setState(nextc); return true; &#125; //å¦‚æžœæŒæœ‰é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹åˆ™è¿”å›žå¤±è´¥æ ‡å¿— return false;&#125; nonfairTryAcquireæ–¹æ³•æ˜¯Syncçš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°çº¿ç¨‹è¿›å…¥æ­¤æ–¹æ³•åŽé¦–å…ˆåŽ»èŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æžœåŒæ­¥çŠ¶æ€ä¸º0å°±ä½¿ç”¨CASæ“ä½œæ›´æ”¹åŒæ­¥çŠ¶æ€ï¼Œå…¶å®žè¿™åˆæ˜¯èŽ·å–äº†ä¸€éé”ã€‚å¦‚æžœåŒæ­¥çŠ¶æ€ä¸ä¸º0è¡¨æ˜Žé”è¢«å ç”¨ï¼Œæ­¤æ—¶ä¼šå…ˆåŽ»åˆ¤æ–­æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æžœæ˜¯çš„è¯å°±å°†åŒæ­¥çŠ¶æ€åŠ 1ï¼Œå¦åˆ™çš„è¯è¿™æ¬¡å°è¯•èŽ·å–é”çš„æ“ä½œå®£å‘Šå¤±è´¥ã€‚äºŽæ˜¯ä¼šè°ƒç”¨addWaiteræ–¹æ³•å°†çº¿ç¨‹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚ ç»¼ä¸Šæ¥çœ‹ï¼Œåœ¨éžå…¬å¹³é”çš„æ¨¡å¼ä¸‹ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹å‰ä¼šå°è¯•èŽ·å–ä¸¤éé”ï¼Œå¦‚æžœèŽ·å–æˆåŠŸåˆ™ä¸è¿›å…¥åŒæ­¥é˜Ÿåˆ—æŽ’é˜Ÿï¼Œå¦åˆ™æ‰è¿›å…¥åŒæ­¥é˜Ÿåˆ—æŽ’é˜Ÿã€‚ å…¬å¹³é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344//å®žçŽ°å…¬å¹³é”çš„åŒæ­¥å™¨static final class FairSync extends Sync &#123; //å®žçŽ°çˆ¶ç±»çš„æŠ½è±¡èŽ·å–é”çš„æ–¹æ³• final void lock() &#123; //è°ƒç”¨acquireè®©çº¿ç¨‹åŽ»åŒæ­¥é˜Ÿåˆ—æŽ’é˜ŸèŽ·å– acquire(1); &#125; //å°è¯•èŽ·å–é”çš„æ–¹æ³• protected final boolean tryAcquire(int acquires) &#123; //èŽ·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); //èŽ·å–å½“å‰åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æžœåŒæ­¥çŠ¶æ€0åˆ™è¡¨ç¤ºé”æ²¡è¢«å ç”¨ if (c == 0) &#123; //åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰å‰é©±ç»“ç‚¹ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) &#123; //å¦‚æžœæ²¡æœ‰å‰é©±ç»“ç‚¹ä¸”è®¾ç½®åŒæ­¥çŠ¶æ€æˆåŠŸå°±è¡¨ç¤ºèŽ·å–é”æˆåŠŸ setExclusiveOwnerThread(current); return true; &#125; //å¦åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é” &#125;else if (current == getExclusiveOwnerThread()) &#123; //å¦‚æžœæ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”å°±ç›´æŽ¥ä¿®æ”¹åŒæ­¥çŠ¶æ€ int nextc = c + acquires; if (nextc &lt; 0) &#123; throw new Error("Maximum lock count exceeded"); &#125; setState(nextc); return true; &#125; //å¦‚æžœä¸æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”åˆ™èŽ·å–å¤±è´¥ return false; &#125;&#125;//åˆ¤æ–­æ˜¯å¦æœ‰å‰é©±ç»“ç‚¹public final boolean hasQueuedPredecessors() &#123; Node t = tail; Node h = head; Node s; return h != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());&#125; è°ƒç”¨å…¬å¹³é”çš„lockæ–¹æ³•æ—¶ä¼šç›´æŽ¥è°ƒç”¨acquireæ–¹æ³•ã€‚åŒæ ·çš„ï¼Œacquireæ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨FairSyncé‡å†™çš„tryAcquireæ–¹æ³•æ¥å°è¯•èŽ·å–é”ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ä¹Ÿæ˜¯é¦–å…ˆèŽ·å–åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œå¦‚æžœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜Žæ­¤æ—¶é”åˆšå¥½è¢«é‡Šæ”¾ï¼Œè¿™æ—¶å’Œéžå…¬å¹³é”ä¸åŒçš„æ˜¯å®ƒä¼šå…ˆåŽ»è°ƒç”¨hasQueuedPredecessorsæ–¹æ³•æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰äººåœ¨æŽ’é˜Ÿï¼Œå¦‚æžœæ²¡äººåœ¨æŽ’é˜Ÿæ‰ä¼šåŽ»ä¿®æ”¹åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°å…¬å¹³é”åœ¨è¿™é‡Œé‡‡å–ç¤¼è®©çš„æ–¹å¼è€Œä¸æ˜¯è‡ªå·±é©¬ä¸ŠåŽ»èŽ·å–é”ã€‚é™¤äº†è¿™ä¸€æ­¥å’Œéžå…¬å¹³é”ä¸ä¸€æ ·ä¹‹å¤–ï¼Œå…¶ä»–çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥çœ‹åˆ°å…¬å¹³é”åœ¨è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹å‰åªæ£€æŸ¥äº†ä¸€éé”çš„çŠ¶æ€ï¼Œå³ä½¿æ˜¯å‘çŽ°äº†é”æ˜¯å¼€çš„ä¹Ÿä¸ä¼šè‡ªå·±é©¬ä¸ŠåŽ»èŽ·å–ï¼Œè€Œæ˜¯å…ˆè®©åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…ˆèŽ·å–ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åœ¨å…¬å¹³é”ä¸‹æ‰€æœ‰çº¿ç¨‹èŽ·å–é”çš„é¡ºåºéƒ½æ˜¯å…ˆæ¥åŽåˆ°çš„ï¼Œè¿™ä¹Ÿä¿è¯äº†èŽ·å–é”çš„å…¬å¹³æ€§ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸å¸Œæœ›æ‰€æœ‰é”éƒ½æ˜¯å…¬å¹³çš„å‘¢ï¼Ÿæ¯•ç«Ÿå…¬å¹³æ˜¯ä¸€ç§å¥½çš„è¡Œä¸ºï¼Œè€Œä¸å…¬å¹³æ˜¯ä¸€ç§ä¸å¥½çš„è¡Œä¸ºã€‚ç”±äºŽçº¿ç¨‹çš„æŒ‚èµ·å’Œå”¤é†’æ“ä½œå­˜åœ¨è¾ƒå¤§çš„å¼€é”€è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç«žäº‰æ¿€çƒˆçš„æƒ…å†µä¸‹å…¬å¹³é”å°†å¯¼è‡´çº¿ç¨‹é¢‘ç¹çš„æŒ‚èµ·å’Œå”¤é†’æ“ä½œï¼Œè€Œéžå…¬å¹³é”å¯ä»¥å‡å°‘è¿™æ ·çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æ€§èƒ½ä¸Šå°†ä¼šä¼˜äºŽå…¬å¹³é”ã€‚å¦å¤–ï¼Œç”±äºŽå¤§éƒ¨åˆ†çº¿ç¨‹ä½¿ç”¨é”çš„æ—¶é—´éƒ½æ˜¯éžå¸¸çŸ­æš‚çš„ï¼Œè€Œçº¿ç¨‹çš„å”¤é†’æ“ä½œä¼šå­˜åœ¨å»¶æ—¶æƒ…å†µï¼Œæœ‰å¯èƒ½åœ¨Açº¿ç¨‹è¢«å”¤é†’æœŸé—´Bçº¿ç¨‹é©¬ä¸ŠèŽ·å–äº†é”å¹¶ä½¿ç”¨å®Œé‡Šæ”¾äº†é”ï¼Œè¿™å°±å¯¼è‡´äº†åŒèµ¢çš„å±€é¢ï¼ŒAçº¿ç¨‹èŽ·å–é”çš„æ—¶åˆ»å¹¶æ²¡æœ‰æŽ¨è¿Ÿï¼Œä½†Bçº¿ç¨‹æå‰ä½¿ç”¨äº†é”ï¼Œå¹¶ä¸”åžåé‡ä¹ŸèŽ·å¾—äº†æé«˜ã€‚ æ¡ä»¶é˜Ÿåˆ—çš„å®žçŽ°æœºåˆ¶ å†…ç½®æ¡ä»¶é˜Ÿåˆ—å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œæ¯ä¸ªå†…ç½®é”éƒ½åªèƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„æ¡ä»¶é˜Ÿåˆ—ï¼Œè¿™å¯¼è‡´å¤šä¸ªçº¿ç¨‹å¯èƒ½åœ¨åŒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸Šç­‰å¾…ä¸åŒçš„æ¡ä»¶è°“è¯ï¼Œé‚£ä¹ˆæ¯æ¬¡è°ƒç”¨notifyAllæ—¶éƒ½ä¼šå°†æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹å”¤é†’ï¼Œå½“çº¿ç¨‹é†’æ¥åŽå‘çŽ°å¹¶ä¸æ˜¯è‡ªå·±ç­‰å¾…çš„æ¡ä»¶è°“è¯ï¼Œè½¬è€Œåˆä¼šè¢«æŒ‚èµ·ã€‚è¿™å¯¼è‡´åšäº†å¾ˆå¤šæ— ç”¨çš„çº¿ç¨‹å”¤é†’å’ŒæŒ‚èµ·æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œå°†ä¼šå¤§é‡æµªè´¹ç³»ç»Ÿèµ„æºï¼Œé™ä½Žç³»ç»Ÿçš„æ€§èƒ½ã€‚å¦‚æžœæƒ³ç¼–å†™ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªæ¡ä»¶è°“è¯çš„å¹¶å‘å¯¹è±¡ï¼Œæˆ–è€…æƒ³èŽ·å¾—é™¤äº†æ¡ä»¶é˜Ÿåˆ—å¯è§æ€§ä¹‹å¤–çš„æ›´å¤šæŽ§åˆ¶æƒï¼Œå°±éœ€è¦ä½¿ç”¨æ˜¾å¼çš„Lockå’ŒConditionè€Œä¸æ˜¯å†…ç½®é”å’Œæ¡ä»¶é˜Ÿåˆ—ã€‚ä¸€ä¸ªConditionå’Œä¸€ä¸ªLockå…³è”åœ¨ä¸€èµ·ï¼Œå°±åƒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—å’Œä¸€ä¸ªå†…ç½®é”ç›¸å…³è”ä¸€æ ·ã€‚è¦åˆ›å»ºä¸€ä¸ªConditionï¼Œå¯ä»¥åœ¨ç›¸å…³è”çš„Lockä¸Šè°ƒç”¨Lock.newConditionæ–¹æ³•ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä½¿ç”¨Conditionçš„ç¤ºä¾‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package main.java.com.study.producerconsumer.v2;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * @author: whb * @description: ç¼“å†²åŒº */public class ConditionBuffer &#123; private final Lock lock = new ReentrantLock(); /** * ä¸æ»¡ */ final Condition notFull = lock.newCondition(); /** * ä¸ç©º */ final Condition notEmpty = lock.newCondition(); /** * ç¼“å†²åŒº */ final Object[] items = new Object[100]; int putptr, takeptr, count; //ç”Ÿäº§æ–¹æ³• public void put(Object x) throws InterruptedException &#123; lock.lock(); try &#123; while (count == items.length) &#123; //é˜Ÿåˆ—å·²æ»¡, çº¿ç¨‹åœ¨notFullé˜Ÿåˆ—ä¸Šç­‰å¾… notFull.await(); &#125; items[putptr] = x; if (++putptr == items.length) &#123; putptr = 0; &#125; ++count; //ç”Ÿäº§æˆåŠŸ, å”¤é†’notEmptyé˜Ÿåˆ—çš„ç»“ç‚¹ notEmpty.signal(); &#125; finally &#123; lock.unlock(); &#125; &#125; //æ¶ˆè´¹æ–¹æ³• public Object take() throws InterruptedException &#123; lock.lock(); try &#123; while (count == 0) &#123; //é˜Ÿåˆ—ä¸ºç©º, çº¿ç¨‹åœ¨notEmptyé˜Ÿåˆ—ä¸Šç­‰å¾… notEmpty.await(); &#125; Object x = items[takeptr]; if (++takeptr == items.length) &#123; takeptr = 0; &#125; --count; //æ¶ˆè´¹æˆåŠŸ, å”¤é†’notFullé˜Ÿåˆ—çš„ç»“ç‚¹ notFull.signal(); return x; &#125; finally &#123; lock.unlock(); &#125; &#125;&#125; ä¸€ä¸ªlockå¯¹è±¡å¯ä»¥äº§ç”Ÿå¤šä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œè¿™é‡Œäº§ç”Ÿäº†ä¸¤ä¸ªæ¡ä»¶é˜Ÿåˆ—notFullå’ŒnotEmptyã€‚ å½“å®¹å™¨å·²æ»¡æ—¶å†è°ƒç”¨putæ–¹æ³•çš„çº¿ç¨‹éœ€è¦è¿›è¡Œé˜»å¡žï¼Œç­‰å¾…æ¡ä»¶è°“è¯ä¸ºçœŸ(å®¹å™¨ä¸æ»¡)æ‰é†’æ¥ç»§ç»­æ‰§è¡Œï¼› å½“å®¹å™¨ä¸ºç©ºæ—¶å†è°ƒç”¨takeæ–¹æ³•çš„çº¿ç¨‹ä¹Ÿéœ€è¦é˜»å¡žï¼Œç­‰å¾…æ¡ä»¶è°“è¯ä¸ºçœŸ(å®¹å™¨ä¸ç©º)æ‰é†’æ¥ç»§ç»­æ‰§è¡Œã€‚ è¿™ä¸¤ç±»çº¿ç¨‹æ˜¯æ ¹æ®ä¸åŒçš„æ¡ä»¶è°“è¯è¿›è¡Œç­‰å¾…çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¼šè¿›å…¥ä¸¤ä¸ªä¸åŒçš„æ¡ä»¶é˜Ÿåˆ—ä¸­é˜»å¡žï¼Œç­‰åˆ°åˆé€‚æ—¶æœºå†é€šè¿‡è°ƒç”¨Conditionå¯¹è±¡ä¸Šçš„APIè¿›è¡Œå”¤é†’ã€‚ ä¸‹é¢æ˜¯newConditionæ–¹æ³•çš„å®žçŽ°ä»£ç ã€‚ 1234567891011//åˆ›å»ºæ¡ä»¶é˜Ÿåˆ—public Condition newCondition() &#123; return sync.newCondition();&#125;abstract static class Sync extends AbstractQueuedSynchronizer &#123; //æ–°å»ºConditionå¯¹è±¡ final ConditionObject newCondition() &#123; return new ConditionObject(); &#125;&#125; ReentrantLockä¸Šçš„æ¡ä»¶é˜Ÿåˆ—çš„å®žçŽ°éƒ½æ˜¯åŸºäºŽAbstractQueuedSynchronizerçš„ï¼Œåœ¨è°ƒç”¨newConditionæ–¹æ³•æ—¶æ‰€èŽ·å¾—çš„Conditionå¯¹è±¡å°±æ˜¯AQSçš„å†…éƒ¨ç±»ConditionObjectçš„å®žä¾‹ã€‚æ‰€æœ‰å¯¹æ¡ä»¶é˜Ÿåˆ—çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è°ƒç”¨ConditionObjectå¯¹å¤–æä¾›çš„APIæ¥å®Œæˆçš„ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-LockSupport]]></title>
    <url>%2Fposts%2F2c562869.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡žåŽŸè¯­ã€‚ æ–¹æ³•åˆ—è¡¨ 12345678910111213141516// è¿”å›žæä¾›ç»™æœ€è¿‘ä¸€æ¬¡å°šæœªè§£é™¤é˜»å¡žçš„ park æ–¹æ³•è°ƒç”¨çš„ blocker å¯¹è±¡ï¼Œå¦‚æžœè¯¥è°ƒç”¨ä¸å—é˜»å¡žï¼Œåˆ™è¿”å›ž nullã€‚static Object getBlocker(Thread t)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éžè®¸å¯å¯ç”¨ã€‚static void park()// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨è®¸å¯å¯ç”¨ä¹‹å‰ç¦ç”¨å½“å‰çº¿ç¨‹ã€‚static void park(Object blocker)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œæœ€å¤šç­‰å¾…æŒ‡å®šçš„ç­‰å¾…æ—¶é—´ï¼Œé™¤éžè®¸å¯å¯ç”¨ã€‚static void parkNanos(long nanos)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨è®¸å¯å¯ç”¨å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œå¹¶æœ€å¤šç­‰å¾…æŒ‡å®šçš„ç­‰å¾…æ—¶é—´ã€‚static void parkNanos(Object blocker, long nanos)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨æŒ‡å®šçš„æ—¶é™å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éžè®¸å¯å¯ç”¨ã€‚static void parkUntil(long deadline)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨æŒ‡å®šçš„æ—¶é™å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éžè®¸å¯å¯ç”¨ã€‚static void parkUntil(Object blocker, long deadline)// å¦‚æžœç»™å®šçº¿ç¨‹çš„è®¸å¯å°šä¸å¯ç”¨ï¼Œåˆ™ä½¿å…¶å¯ç”¨ã€‚static void unpark(Thread thread) åŽŸç† LockSupportä¸­çš„park() å’Œ unpark() çš„ä½œç”¨åˆ†åˆ«æ˜¯é˜»å¡žçº¿ç¨‹å’Œè§£é™¤é˜»å¡žçº¿ç¨‹ï¼Œè€Œä¸”park()å’Œunpark()ä¸ä¼šé‡åˆ°Thread.suspend å’Œ Thread.resumeæ‰€å¯èƒ½å¼•å‘çš„æ­»é” é—®é¢˜ã€‚ å› ä¸ºpark() å’Œ unpark()æœ‰è®¸å¯çš„å­˜åœ¨ï¼Œunpark()ä¸ºçº¿ç¨‹æä¾›â€œè®¸å¯(permit)â€ï¼Œçº¿ç¨‹è°ƒç”¨park()åˆ™ç­‰å¾…â€œè®¸å¯â€ ï¼›è°ƒç”¨ park() çš„çº¿ç¨‹å’Œå¦ä¸€ä¸ªè¯•å›¾å°†å…¶ unpark() çš„çº¿ç¨‹ä¹‹é—´çš„ç«žäº‰å°†ä¿æŒæ´»æ€§ã€‚ è¿™ä¸ªæœ‰ç‚¹åƒä¿¡å·é‡ï¼Œå¯æ˜¯è¿™ä¸ªâ€œè®¸å¯â€æ˜¯ä¸èƒ½å åŠ çš„ï¼Œâ€œè®¸å¯â€æ˜¯ä¸€æ¬¡æ€§çš„ã€‚ æ¯”å¦‚ï¼šçº¿ç¨‹Bè¿žç»­è°ƒç”¨äº†ä¸‰æ¬¡unparkå‡½æ•°ï¼Œå½“çº¿ç¨‹Aè°ƒç”¨parkå‡½æ•°å°±ä½¿ç”¨æŽ‰è¿™ä¸ªâ€œè®¸å¯â€ï¼Œå‡è®¾çº¿ç¨‹Aå†æ¬¡è°ƒç”¨parkï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ æ³¨æ„ã€‚unparkå‡½æ•°èƒ½å¤Ÿå…ˆäºŽparkè°ƒç”¨ã€‚æ¯”æ–¹çº¿ç¨‹Bè°ƒç”¨unparkå‡½æ•°ï¼Œç»™çº¿ç¨‹Aå‘äº†ä¸€ä¸ªâ€œè®¸å¯â€ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹Aè°ƒç”¨parkæ—¶ã€‚å®ƒå‘çŽ°å·²ç»æœ‰â€œè®¸å¯â€äº†ã€‚é‚£ä¹ˆå®ƒä¼šç«‹å³å†ç»§ç»­æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: LockSupportæµ‹è¯•ç±» */public class LockSupportDemoOne &#123; public static void main(String args[]) &#123; Thread thread = Thread.currentThread(); ThreadParkService service = new ThreadParkService(thread); System.out.println(Thread.currentThread().getName() + " start1"); service.start(); try &#123; Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread().getName() + " center"); LockSupport.park(thread); System.out.println("end"); &#125;&#125;class ThreadParkService extends Thread &#123; private Thread thread; public ThreadParkService(Thread thread) &#123; this.thread = thread; &#125; @Override public void run() &#123; try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread().getName() + " wakup before"); LockSupport.unpark(thread);//è§£é”åŽçº¿ç¨‹2ç«‹é©¬å°±å¯ä»¥æ‰§è¡Œäº†ã€‚ try &#123; System.out.println("è§£é”åŽä¼‘æ¯ä¸‰ç§’å“¦"); Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(Thread.currentThread().getName() + " wakup after"); &#125;&#125; æ‰§è¡Œç»“æžœ1 123456main start1 Thread-0 wakup before è§£é”åŽä¼‘æ¯ä¸‰ç§’å“¦ main center end Thread-0 wakup after ç»“æžœè¯´æ˜Ž1 ä¸»çº¿ç¨‹mainå…ˆæ‰“å°äº†è‡ªå·±çš„ä¸œè¥¿ï¼Œä¸»çº¿ç¨‹åˆ°äº†parkæ—¶è¢«é˜»å¡žäº†ã€‚çº¿ç¨‹1å¼‚æ­¥æ‰§è¡Œæ‰“å°äº† wakup beforemain centeræ‰“å°åœ¨â€œè§£é”åŽä¼‘æ¯3så“¦â€è¯´æ˜Žçº¿ç¨‹1ä¸­çš„unparkå…ˆä¸Žparkæ‰§è¡Œã€‚çº¿ç¨‹1æ‰§è¡Œäº†unparkäº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸»çº¿ç¨‹ä¸­çš„parkç«‹é©¬è¢«å”¤é†’ï¼Œå¼€å§‹æ‰§è¡Œäº†endã€‚ç„¶åŽçº¿ç¨‹1ç­‰å¾…äº†3såŽæ‰§è¡Œäº†wakup afterã€‚ æ€»ç»“1 unparkï¼Œå¯ä»¥åœ¨parkä¹‹å‰æ‰§è¡Œã€‚å®ƒä»¬ä¸€å¯¹ä¸€,ä¸ç®¡ä»€ä¹ˆæ—¶å€™parkåªè¦æœ‰unparkè¿‡ä¸€æ¬¡å°±å¥½äº†ã€‚parkè¢«é˜»å¡žåŽï¼Œunparkæ‰§è¡ŒåŽparkç«‹å³è¢«å”¤é†’ã€‚ä¸Žwaitä¸Žnotifyä¸åŒï¼Œnotifyå”¤é†’waitåŽï¼Œè¿˜å¿…é¡»ç­‰å¾…notifyä»£ç å—ä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•åŽwaitæ‰èƒ½æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹2 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: LockSupportæµ‹è¯•ç¤ºä¾‹ */public class LockSupportDemoTwo &#123; public static void main(String args[]) &#123; Thread thread = Thread.currentThread(); ThreadParkService2 service2 = new ThreadParkService2(thread); System.out.println(Thread.currentThread().getName() + " start2"); service2.start(); System.out.println(" æ¼‚äº®çš„åˆ†å‰²çº¿---"); ThreadParkService service = new ThreadParkService(service2); System.out.println(Thread.currentThread().getName() + " start1"); service.start(); &#125;&#125;class ThreadParkService2 extends Thread &#123; private Thread thread; public ThreadParkService2(Thread thread) &#123; this.thread = thread; &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + "-çº¿ç¨‹2å¼€å§‹park before"); //é˜»å¡žå½“å‰æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸èƒ½é˜»å¡žå…¶ä»–çº¿ç¨‹ï¼Œçœ‹æºç å“¦ã€‚é‡Œé¢é˜»å¡žæ—¶å¹¶ä¸éœ€è¦ä»»ä½•ä¼ å‚ã€‚ LockSupport.park(this); //è¿™é‡Œå¹¶ä¸ä¼šé˜»å¡žthreadçº¿ç¨‹ï¼Œé˜»å¡žçš„è¿˜æ˜¯å½“å‰çº¿ç¨‹ã€‚threadåªæ˜¯åšä¸€ä¸ªæ ‡è®°æ–¹ä¾¿è¢«é”çš„å¯¹è±¡ã€‚ //LockSupport.park(thread); System.out.println(Thread.currentThread().getName() + "-çº¿ç¨‹2park after"); &#125;&#125; æ‰§è¡Œç»“æžœ2 12345678main start2 æ¼‚äº®çš„åˆ†å‰²çº¿â€” Thread-0-çº¿ç¨‹2å¼€å§‹park before main start1 Thread-1 wakup before è§£é”åŽä¼‘æ¯ä¸‰ç§’å“¦ Thread-0-çº¿ç¨‹2park after Thread-1 wakup after ç»“æžœè¯´æ˜Ž2 å…¶å®žçœ‹ç»“æžœå°±æ˜¯çº¿ç¨‹2é˜»å¡žäº†ï¼Œçº¿ç¨‹1å”¤é†’äº†çº¿ç¨‹2.å°±è¿™ä¹ˆç®€å•ã€‚ æ€»ç»“ park()ä¸Žpark(Object obj)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ park()æ˜¯å¯ä»¥ä¸éœ€è¦å‚æ•°çš„å“¦ï¼Œå°±æ˜¯è¯´åŠ é”æ—¶ï¼Œä¸éœ€è¦æŒ‡å®šå¯¹è±¡ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€Žä¹ˆåŠ é”çš„å‘¢ï¼Ÿæºç å¦‚ä¸‹ï¼š 123456public static void park(Object blocker) &#123; Thread t = Thread.currentThread(); setBlocker(t, blocker);//è®°å½•å½“å‰çº¿ç¨‹ç­‰å¾…çš„å¯¹è±¡ï¼ˆé˜»å¡žå¯¹è±¡ï¼‰ï¼› UNSAFE.park(false, 0L);//é˜»å¡žå½“å‰çº¿ç¨‹ï¼› setBlocker(t, null);//å½“å‰çº¿ç¨‹ç­‰å¾…å¯¹è±¡ç½®ä¸ºnullã€‚&#125; å¯ä»¥çœ‹å‡ºæ¥ï¼Œé˜»å¡žçš„æ—¶å€™UNSAFE.park(false, 0L);æ ¹æœ¬ä¸éœ€è¦å¤–é¢çš„å…¥å‚æ•°ã€‚ é‚£ä¹ˆsetBlockeræ˜¯ç”¨æ¥å¹²å—çš„å‘¢ï¼Ÿ å®ƒæ˜¯ç”¨æ¥åšç›‘æŽ§ç”¨çš„ï¼Œå½“å‰è¢«é˜»å¡žçš„å¯¹è±¡æ˜¯é‚£ä¸ªï¼Œå¯ä»¥é€šè¿‡LockSupportä¸­çš„getä¹‹ç±»çš„æ–¹æ³•æ¥èŽ·å–å½“å‰è¢«é˜»å¡žçš„å¯¹è±¡ã€‚ UNSAFE.park(false, 0L);é”ä½çš„æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ã€‚ ä»£ç ç¤ºä¾‹2ä¸­çº¿ç¨‹2æœ‰ä¸€ä¸ªå‚æ•°ï¼ŒæŠŠä¸»çº¿ç¨‹ä¼ è¿‡åŽ»äº†ï¼Œ æƒ³ç”¨çº¿ç¨‹2æ¥é˜»å¡žä¸»çº¿ç¨‹ã€‚ mainä¸­ï¼š 123Thread thread = Thread.currentThread(); ThreadParkService2 service2 = new ThreadParkService2(thread); â€¦ çº¿ç¨‹2ä¸­ï¼š 1LockSupport.park(thread); è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå‰é¢è¯´è¿‡parké˜»å¡žçš„æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå’Œå¤–é¢ä¼ é€’è¿›æ¥çš„å€¼æ— å…³ã€‚æ‰€ä»¥è¿™é‡Œè¢«é˜»å¡žçš„è¿˜æ˜¯çº¿ç¨‹2ã€‚ unparkéœ€è¦å¸¦ä¸Šå‚æ•°ï¼Œè¿™æ ·æ‰çŸ¥é“è§£é”é‚£ä¸ªçº¿ç¨‹ã€‚ LockSupport.park é”ä½çš„æ˜¯Thread.currentThread()å½“å‰çº¿ç¨‹ã€‚ Thread.currentThread()ä¸Žthis ç±»ç»§æ‰¿äº†Threadç±»åŽï¼Œå¯ä»¥ä½¿ç”¨this.getName();èŽ·å–å½“å‰çº¿ç¨‹çš„åç§°ï¼Œä½†æ˜¯Thread.currentThread().getName()ä¹ŸèŽ·å–çº¿ç¨‹åç§°ã€‚é‚£ä¹ˆå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ç»§æ‰¿äº†Threadç±»åŽä½¿ç”¨this.getName()èŽ·å–çš„å½“å‰å¯¹è±¡çš„çº¿ç¨‹åç§°ï¼Œè€ŒThread.currentThread().getName()èŽ·å–çš„æ˜¯å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹çš„åç§°ã€‚ parkå’Œwaitçš„åŒºåˆ« unparkå¯ä»¥å…ˆäºŽparkæ‰§è¡Œï¼Œnotifyä¸èƒ½å…ˆäºŽwaitæ‰§è¡Œï¼Œä¸ç„¶å°±ä¸èƒ½å”¤é†’äº†ã€‚ unparkéœ€è¦æŒ‡å®šå”¤é†’çš„çº¿ç¨‹ï¼Œè€Œnotifyæ˜¯éšæœºå”¤é†’ä¸€ä¸ªwaitã€‚ unparkè§£é”åŽparkç«‹å³å¯ä»¥æ‰§è¡Œï¼Œnotifyè§£é”åŽwaitéœ€è¦ç­‰å¾…notifyæ‰€åœ¨çš„synchronizedä»£ç å—æ‰§è¡Œå®Œæ¯•åŽwaitæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ waitå¿…é¡»åœ¨Synchronizeré‡Œé¢æ‰èƒ½æœ‰æ•ˆï¼Œunparkåˆ™ä¸ç”¨ã€‚ waitæ˜¯å¯¹è±¡é”ï¼Œparkåˆ™æ˜¯çº¿ç¨‹é”ã€‚ åº”ç”¨ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: é˜»å¡žåŽŸè¯­æµ‹è¯• */public class LockSupportTest &#123; /** * ä¸»çº¿ç¨‹ */ private static Thread mainThread; public static void main(String[] args) &#123; ThreadA ta = new ThreadA("ta"); //èŽ·å–ä¸»çº¿ç¨‹ mainThread = Thread.currentThread(); System.out.println(Thread.currentThread().getName() + " start ta"); //å¯åŠ¨çº¿ç¨‹ta ta.start(); System.out.println(Thread.currentThread().getName() + " block"); //ä¸»çº¿ç¨‹é˜»å¡ž LockSupport.park(mainThread); System.out.println(Thread.currentThread().getName() + " continue"); &#125; static class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + " wakeup others."); LockSupport.unpark(mainThread); &#125; &#125;&#125; æ‰§è¡Œç»“æžœï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-CountDownLatch]]></title>
    <url>%2Fposts%2Fbbc8910e.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° CountDownLatch(é—­é”)æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ç±»ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥æ‹¦æˆªä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä½¿å…¶åœ¨æŸä¸ªæ¡ä»¶æˆç†ŸåŽå†æ‰§è¡Œã€‚ å®ƒçš„å†…éƒ¨æä¾›äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåœ¨æž„é€ é—­é”æ—¶å¿…é¡»æŒ‡å®šè®¡æ•°å™¨çš„åˆå§‹å€¼ï¼Œä¸”è®¡æ•°å™¨çš„åˆå§‹å€¼å¿…é¡»å¤§äºŽ0ã€‚ å¦å¤–å®ƒè¿˜æä¾›äº†ä¸€ä¸ªcountDownæ–¹æ³•æ¥æ“ä½œè®¡æ•°å™¨çš„å€¼ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡countDownæ–¹æ³•è®¡æ•°å™¨éƒ½ä¼šå‡1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å‡ä¸º0æ—¶å°±ä»£è¡¨æ¡ä»¶å·²æˆç†Ÿï¼Œæ‰€æœ‰å› è°ƒç”¨awaitæ–¹æ³•è€Œé˜»å¡žçš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ è¿™å°±æ˜¯CountDownLatchçš„å†…éƒ¨æœºåˆ¶ï¼Œçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæ— éžå°±æ˜¯é˜»å¡žä¸€éƒ¨åˆ†çº¿ç¨‹è®©å…¶åœ¨è¾¾åˆ°æŸä¸ªæ¡ä»¶ä¹‹åŽå†æ‰§è¡Œã€‚ä½†æ˜¯CountDownLatchçš„åº”ç”¨åœºæ™¯å´æ¯”è¾ƒå¹¿æ³›ï¼Œåªè¦ä½ è„‘æ´žå¤Ÿå¤§åˆ©ç”¨å®ƒå°±å¯ä»¥çŽ©å‡ºå„ç§èŠ±æ ·ã€‚æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒæŸä¸ªä»»åŠ¡ï¼Œç­‰åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œå†ç»Ÿè®¡æ±‡æ€»ç»“æžœã€‚ä¸‹å›¾åŠ¨æ€æ¼”ç¤ºäº†é—­é”é˜»å¡žçº¿ç¨‹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ ä¸Šå›¾æ¼”ç¤ºäº†æœ‰5ä¸ªçº¿ç¨‹å› è°ƒç”¨awaitæ–¹æ³•è€Œè¢«é˜»å¡žï¼Œå®ƒä»¬éœ€è¦ç­‰å¾…è®¡æ•°å™¨çš„å€¼å‡ä¸º0æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚è®¡æ•°å™¨çš„åˆå§‹å€¼åœ¨æž„é€ é—­é”æ—¶è¢«æŒ‡å®šï¼ŒåŽé¢éšç€æ¯æ¬¡countDownæ–¹æ³•çš„è°ƒç”¨è€Œå‡1ã€‚ æž„é€ å™¨ 12345//æž„é€ å™¨public CountDownLatch(int count) &#123; if (count &lt; 0) throw new IllegalArgumentException("count &lt; 0"); this.sync = new Sync(count);&#125; CountDownLatchåªæœ‰ä¸€ä¸ªå¸¦å‚æž„é€ å™¨ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªå¤§äºŽ0çš„å€¼ä½œä¸ºè®¡æ•°å™¨åˆå§‹å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¯ä»¥çœ‹åˆ°åœ¨æž„é€ æ–¹æ³•ä¸­åªæ˜¯åŽ»newäº†ä¸€ä¸ªSyncå¯¹è±¡å¹¶èµ‹å€¼ç»™æˆå‘˜å˜é‡syncã€‚å’Œå…¶ä»–åŒæ­¥å·¥å…·ç±»ä¸€æ ·ï¼ŒCountDownLatchçš„å®žçŽ°ä¾èµ–äºŽAQSï¼Œå®ƒæ˜¯AQSå…±äº«æ¨¡å¼ä¸‹çš„ä¸€ä¸ªåº”ç”¨ã€‚CountDownLatchå®žçŽ°äº†ä¸€ä¸ªå†…éƒ¨ç±»Syncå¹¶ç”¨å®ƒåŽ»ç»§æ‰¿AQSï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨AQSæä¾›çš„å¤§éƒ¨åˆ†æ–¹æ³•äº†ã€‚ ä¸‹é¢æ¥çœ‹ä¸€ä¸‹Syncå†…éƒ¨ç±»çš„ä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839//åŒæ­¥å™¨private static final class Sync extends AbstractQueuedSynchronizer &#123; //æž„é€ å™¨ Sync(int count) &#123; setState(count); &#125; //èŽ·å–å½“å‰åŒæ­¥çŠ¶æ€ int getCount() &#123; return getState(); &#125; //å°è¯•èŽ·å–é” //è¿”å›žè´Ÿæ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–å¤±è´¥ //è¿”å›žé›¶å€¼ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸ, ä½†æ˜¯åŽç»§çº¿ç¨‹ä¸èƒ½å†èŽ·å–äº† //è¿”å›žæ­£æ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸ, å¹¶ä¸”åŽç»§çº¿ç¨‹åŒæ ·å¯ä»¥èŽ·å–æˆåŠŸ protected int tryAcquireShared(int acquires) &#123; return (getState() == 0) ? 1 : -1; &#125; //å°è¯•é‡Šæ”¾é” protected boolean tryReleaseShared(int releases) &#123; for (;;) &#123; //èŽ·å–åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æžœåŒæ­¥çŠ¶æ€ä¸º0, åˆ™ä¸èƒ½å†é‡Šæ”¾äº† if (c == 0) &#123; return false; &#125; //å¦åˆ™çš„è¯å°±å°†åŒæ­¥çŠ¶æ€å‡1 int nextc = c-1; //ä½¿ç”¨CASæ–¹å¼æ›´æ–°åŒæ­¥çŠ¶æ€ if (compareAndSetState(c, nextc)) &#123; return nextc == 0; &#125; &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°Syncçš„æž„é€ æ–¹æ³•ä¼šå°†åŒæ­¥çŠ¶æ€çš„å€¼è®¾ç½®ä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚ä¹‹åŽæ¯æ¬¡è°ƒç”¨countDownæ–¹æ³•éƒ½ä¼šå°†åŒæ­¥çŠ¶æ€çš„å€¼å‡1ï¼Œè¿™ä¹Ÿå°±æ˜¯è®¡æ•°å™¨çš„å®žçŽ°åŽŸç†ã€‚ åœ¨å¹³æ—¶ä½¿ç”¨CountDownLatchå·¥å…·ç±»æ—¶æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯awaitæ–¹æ³•å’ŒcountDownæ–¹æ³•ã€‚è°ƒç”¨awaitæ–¹æ³•ä¼šé˜»å¡žå½“å‰çº¿ç¨‹ç›´åˆ°è®¡æ•°å™¨ä¸º0ï¼Œè°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨çš„å€¼å‡1ç›´åˆ°å‡ä¸º0ã€‚ é˜»å¡žçº¿ç¨‹await 123456789101112131415161718//å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…, ç›´åˆ°stateå‡å°‘åˆ°0, æˆ–è€…çº¿ç¨‹è¢«æ‰“æ–­public void await() throws InterruptedException &#123; //ä»¥å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼èŽ·å– sync.acquireSharedInterruptibly(1);&#125;//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æžœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //1.å°è¯•åŽ»èŽ·å–é” if (tryAcquireShared(arg) &lt; 0) &#123; //2. å¦‚æžœèŽ·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); &#125;&#125; å½“çº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶å…¶å®žæ˜¯è°ƒç”¨åˆ°äº†AQSçš„acquireSharedInterruptiblyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ä»¥å“åº”çº¿ç¨‹ä¸­æ–­çš„æ–¹å¼æ¥èŽ·å–é”çš„ã€‚åœ¨acquireSharedInterruptiblyæ–¹æ³•é¦–å…ˆä¼šåŽ»è°ƒç”¨tryAcquireSharedæ–¹æ³•å°è¯•èŽ·å–é”ã€‚Syncé‡Œé¢é‡å†™çš„tryAcquireSharedæ–¹æ³•çš„é€»è¾‘ï¼Œæ–¹æ³•çš„å®žçŽ°é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­å½“å‰åŒæ­¥çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œå¦‚æžœä¸º0åˆ™è¿”å›ž1è¡¨æ˜Žå¯ä»¥èŽ·å–é”ï¼Œå¦åˆ™è¿”å›ž-1è¡¨ç¤ºä¸èƒ½èŽ·å–é”ã€‚å¦‚æžœtryAcquireSharedæ–¹æ³•è¿”å›ž1åˆ™çº¿ç¨‹èƒ½å¤Ÿä¸å¿…ç­‰å¾…è€Œç»§ç»­æ‰§è¡Œï¼Œå¦‚æžœè¿”å›ž-1é‚£ä¹ˆåŽç»­å°±ä¼šåŽ»è°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•è®©çº¿ç¨‹è¿›å…¥åˆ°åŒæ­¥é˜Ÿåˆ—é‡Œé¢ç­‰å¾…ã€‚è¿™å°±æ˜¯è°ƒç”¨awaitæ–¹æ³•ä¼šé˜»å¡žå½“å‰çº¿ç¨‹çš„åŽŸç†ã€‚ å”¤é†’çº¿ç¨‹countDown 123456789101112131415//å‡å°‘stateçš„æ–¹æ³•public void countDown() &#123; sync.releaseShared(1);&#125;//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) &#123; //1.å°è¯•åŽ»é‡Šæ”¾é” if (tryReleaseShared(arg)) &#123; //2.å¦‚æžœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; &#125; return false;&#125; countDownæ–¹æ³•é‡Œé¢è°ƒç”¨äº†releaseSharedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ ·æ˜¯AQSé‡Œé¢çš„æ–¹æ³•ã€‚releaseSharedæ–¹æ³•é‡Œé¢é¦–å…ˆæ˜¯è°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼ŒtryReleaseSharedæ–¹æ³•åœ¨AQSé‡Œé¢æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„å…·ä½“å®žçŽ°é€»è¾‘åœ¨å­ç±»Syncç±»é‡Œé¢ï¼Œåœ¨ä¸Šé¢è´´å‡ºçš„Syncç±»ä»£ç é‡Œå¯ä»¥æ‰¾åˆ°è¯¥æ–¹æ³•ã€‚tryReleaseSharedæ–¹æ³•å¦‚æžœè¿”å›žtrueè¡¨ç¤ºé‡Šæ”¾æˆåŠŸï¼Œè¿”å›žfalseè¡¨ç¤ºé‡Šæ”¾å¤±è´¥ï¼Œåªæœ‰å½“å°†åŒæ­¥çŠ¶æ€å‡1åŽè¯¥åŒæ­¥çŠ¶æ€æ°å¥½ä¸º0æ—¶æ‰ä¼šè¿”å›žtrueï¼Œå…¶ä»–æƒ…å†µéƒ½æ˜¯è¿”å›žfalseã€‚é‚£ä¹ˆå½“tryReleaseSharedè¿”å›žtrueä¹‹åŽå°±ä¼šé©¬ä¸Šè°ƒç”¨doReleaseSharedæ–¹æ³•åŽ»å”¤é†’åŒæ­¥é˜Ÿåˆ—çš„æ‰€æœ‰çº¿ç¨‹ã€‚è¿™æ ·å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæœ€åŽä¸€æ¬¡è°ƒç”¨countDownæ–¹æ³•å°†è®¡æ•°å™¨å‡ä¸º0åŽå°±ä¼šå”¤é†’æ‰€æœ‰è¢«é˜»å¡žçš„çº¿ç¨‹ã€‚ æ€»ç»“ CountDownLatchæ˜¯é€šè¿‡â€œå…±äº«é”â€å®žçŽ°çš„ã€‚åœ¨åˆ›å»ºCountDownLatchä¸­æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªintç±»åž‹å‚æ•°countï¼Œè¯¥å‚æ•°æ˜¯â€œé”è®¡æ•°å™¨â€çš„åˆå§‹çŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥â€œå…±äº«é”â€æœ€å¤šèƒ½è¢«countä¸ªçº¿ç¨‹åŒæ—¶èŽ·å–ã€‚å½“æŸçº¿ç¨‹è°ƒç”¨è¯¥CountDownLatchå¯¹è±¡çš„await()æ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šç­‰å¾…â€œå…±äº«é”â€å¯ç”¨æ—¶ï¼Œæ‰èƒ½èŽ·å–â€œå…±äº«é”â€è¿›è€Œç»§ç»­è¿è¡Œã€‚è€Œâ€œå…±äº«é”â€å¯ç”¨çš„æ¡ä»¶ï¼Œå°±æ˜¯â€œé”è®¡æ•°å™¨â€çš„å€¼ä¸º0ï¼è€Œâ€œé”è®¡æ•°å™¨â€çš„åˆå§‹å€¼ä¸ºcountï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥CountDownLatchå¯¹è±¡çš„countDown()æ–¹æ³•æ—¶ï¼Œæ‰å°†â€œé”è®¡æ•°å™¨â€-1ï¼›é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¿…é¡»æœ‰countä¸ªçº¿ç¨‹è°ƒç”¨countDown()ä¹‹åŽï¼Œâ€œé”è®¡æ•°å™¨â€æ‰ä¸º0ï¼Œè€Œå‰é¢æåˆ°çš„ç­‰å¾…çº¿ç¨‹æ‰èƒ½ç»§ç»­è¿è¡Œï¼ åº”ç”¨ç¤ºä¾‹ åœ¨çŽ©æ¬¢ä¹æ–—åœ°ä¸»æ—¶å¿…é¡»ç­‰å¾…ä¸‰ä¸ªçŽ©å®¶éƒ½åˆ°é½æ‰å¯ä»¥è¿›è¡Œå‘ç‰Œã€‚ 123456789101112131415161718192021222324252627public class Player extends Thread &#123; private static int count = 1; private final int id = count++; private CountDownLatch latch; public Player(CountDownLatch latch) &#123; this.latch = latch; &#125; @Override public void run() &#123; System.out.println("ã€çŽ©å®¶" + id + "ã€‘å·²å…¥åœº"); latch.countDown(); &#125; public static void main(String[] args) throws InterruptedException &#123; CountDownLatch latch = new CountDownLatch(3); System.out.println("ç‰Œå±€å¼€å§‹, ç­‰å¾…çŽ©å®¶å…¥åœº..."); new Player(latch).start(); new Player(latch).start(); new Player(latch).start(); latch.await(); System.out.println("çŽ©å®¶å·²åˆ°é½, å¼€å§‹å‘ç‰Œ..."); &#125; &#125; è¿è¡Œç»“æžœæ˜¾ç¤ºå‘ç‰Œæ“ä½œä¸€å®šæ˜¯åœ¨æ‰€æœ‰çŽ©å®¶éƒ½å…¥åœºåŽæ‰è¿›è¡Œã€‚å°†latch.await()æ³¨é‡ŠæŽ‰ï¼Œå¯¹æ¯”ä¸‹çœ‹çœ‹ç»“æžœã€‚ å¯ä»¥çœ‹åˆ°åœ¨æ³¨é‡ŠæŽ‰latch.await()è¿™è¡Œä¹‹åŽï¼Œå°±ä¸èƒ½ä¿è¯åœ¨æ‰€æœ‰çŽ©å®¶å…¥åœºåŽæ‰å¼€å§‹å‘ç‰Œäº†ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-Semaphore]]></title>
    <url>%2Fposts%2F44092bd5.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Semaphore(ä¿¡å·é‡)æ˜¯AQSå…±äº«æ¨¡å¼çš„ä¸€ä¸ªåº”ç”¨ï¼Œå¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ•ˆçš„æŽ§åˆ¶å¹¶å‘æ•°ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å¾ˆå¥½çš„å®žçŽ°æµé‡æŽ§åˆ¶ã€‚ Semaphoreæä¾›äº†ä¸€ä¸ªè®¸å¯è¯çš„æ¦‚å¿µï¼Œå¯ä»¥æŠŠè¿™ä¸ªè®¸å¯è¯çœ‹ä½œè½¦ç¥¨ï¼Œåªæœ‰æˆåŠŸèŽ·å–è½¦ç¥¨çš„äººæ‰èƒ½å¤Ÿä¸Šè½¦ï¼Œå¹¶ä¸”è½¦ç¥¨æ˜¯æœ‰æ•°é‡çš„ï¼Œä¸å¯èƒ½æ¯«æ— é™åˆ¶çš„å‘ä¸‹åŽ»ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´è½¦è¾†è¶…è½½ã€‚æ‰€ä»¥å½“è½¦ç¥¨å‘å®Œçš„æ—¶å€™(è½¦è¾†æ»¡è½½)ï¼Œå…¶ä»–äººå°±åªèƒ½ç­‰ä¸‹ä¸€è¶Ÿè½¦ã€‚å¦‚æžœä¸­é€”æœ‰äººä¸‹è½¦ï¼Œé‚£ä¹ˆä»–çš„ä½ç½®å°†ä¼šç©ºé—²å‡ºæ¥ï¼Œå› æ­¤å¦‚æžœè¿™æ—¶å…¶ä»–äººæƒ³è¦ä¸Šè½¦çš„è¯å°±åˆå¯ä»¥èŽ·å¾—è½¦ç¥¨äº†ã€‚ æž„é€ å™¨ 123456789//æž„é€ å™¨1public Semaphore(int permits) &#123; sync = new NonfairSync(permits);&#125;//æž„é€ å™¨2public Semaphore(int permits, boolean fair) &#123; sync = fair ? new FairSync(permits) : new NonfairSync(permits);&#125; Semaphoreæä¾›äº†ä¸¤ä¸ªå¸¦å‚æž„é€ å™¨ï¼Œæ²¡æœ‰æä¾›æ— å‚æž„é€ å™¨ã€‚è¿™ä¸¤ä¸ªæž„é€ å™¨éƒ½å¿…é¡»ä¼ å…¥ä¸€ä¸ªåˆå§‹çš„è®¸å¯è¯æ•°é‡ï¼Œä½¿ç”¨æž„é€ å™¨1æž„é€ å‡ºæ¥çš„ä¿¡å·é‡åœ¨èŽ·å–è®¸å¯è¯æ—¶ä¼šé‡‡ç”¨éžå…¬å¹³æ–¹å¼èŽ·å–ï¼Œä½¿ç”¨æž„é€ å™¨2å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šèŽ·å–è®¸å¯è¯çš„æ–¹å¼(å…¬å¹³oréžå…¬å¹³)ã€‚Semaphoreä¸»è¦å¯¹å¤–æä¾›äº†ä¸¤ç±»APIï¼ŒèŽ·å–è®¸å¯è¯å’Œé‡Šæ”¾è®¸å¯è¯ï¼Œé»˜è®¤çš„æ˜¯èŽ·å–å’Œé‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°æ¥åŒæ—¶èŽ·å–å’Œé‡Šæ”¾å¤šä¸ªè®¸å¯è¯ã€‚ èŽ·å–è®¸å¯è¯ 12345678910111213141516171819//èŽ·å–ä¸€ä¸ªè®¸å¯è¯(å“åº”ä¸­æ–­)public void acquire() throws InterruptedException &#123; sync.acquireSharedInterruptibly(1);&#125;//èŽ·å–ä¸€ä¸ªè®¸å¯è¯(ä¸å“åº”ä¸­æ–­)public void acquireUninterruptibly() &#123; sync.acquireShared(1);&#125;//å°è¯•èŽ·å–è®¸å¯è¯(éžå…¬å¹³èŽ·å–)public boolean tryAcquire() &#123; return sync.nonfairTryAcquireShared(1) &gt;= 0;&#125;//å°è¯•èŽ·å–è®¸å¯è¯(å®šæ—¶èŽ·å–)public boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException &#123; return sync.tryAcquireSharedNanos(1, unit.toNanos(timeout));&#125; ä¸Šé¢çš„APIæ˜¯Semaphoreæä¾›çš„é»˜è®¤èŽ·å–è®¸å¯è¯æ“ä½œã€‚æ¯æ¬¡åªèŽ·å–ä¸€ä¸ªè®¸å¯è¯ã€‚é™¤äº†ç›´æŽ¥èŽ·å–è¿˜æä¾›äº†å°è¯•èŽ·å–ï¼Œç›´æŽ¥èŽ·å–æ“ä½œåœ¨å¤±è´¥ä¹‹åŽå¯èƒ½ä¼šé˜»å¡žçº¿ç¨‹ï¼Œè€Œå°è¯•èŽ·å–åˆ™ä¸ä¼šã€‚å¦å¤–è¿˜éœ€æ³¨æ„çš„æ˜¯tryAcquireæ–¹æ³•æ˜¯ä½¿ç”¨éžå…¬å¹³æ–¹å¼å°è¯•èŽ·å–çš„ã€‚å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨åˆ°çš„æ˜¯acquireæ–¹æ³•åŽ»èŽ·å–è®¸å¯è¯ã€‚acquireæ–¹æ³•é‡Œé¢ç›´æŽ¥å°±æ˜¯è°ƒç”¨sync.acquireSharedInterruptibly(1)ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯AQSé‡Œé¢çš„æ–¹æ³•ï¼Œä¸‹é¢å†æ¥å›žé¡¾ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚ 123456789101112//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æžœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //1.å°è¯•åŽ»èŽ·å–é”ï¼ŒèŽ·å–æˆåŠŸç›´æŽ¥è¿”å›ž if (tryAcquireShared(arg) &lt; 0) &#123; //2. å¦‚æžœèŽ·å–å¤±è´¥åˆ™è¿›å…¥è¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); &#125;&#125; acquireSharedInterruptiblyæ–¹æ³•é¦–å…ˆå°±æ˜¯åŽ»è°ƒç”¨tryAcquireSharedæ–¹æ³•åŽ»å°è¯•èŽ·å–ï¼ŒtryAcquireSharedåœ¨AQSé‡Œé¢æ˜¯æŠ½è±¡æ–¹æ³•ï¼ŒFairSyncå’ŒNonfairSyncè¿™ä¸¤ä¸ªæ´¾ç”Ÿç±»å®žçŽ°äº†è¯¥æ–¹æ³•çš„é€»è¾‘ã€‚FairSyncå®žçŽ°çš„æ˜¯å…¬å¹³èŽ·å–çš„é€»è¾‘ï¼Œè€ŒNonfairSyncå®žçŽ°çš„éžå…¬å¹³èŽ·å–çš„é€»è¾‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859abstract static class Sync extends AbstractQueuedSynchronizer &#123; //éžå…¬å¹³æ–¹å¼å°è¯•èŽ·å– final int nonfairTryAcquireShared(int acquires) &#123; for (;;) &#123; //èŽ·å–å¯ç”¨è®¸å¯è¯ int available = getState(); //èŽ·å–å‰©ä½™è®¸å¯è¯ int remaining = available - acquires; //1.å¦‚æžœremainingå°äºŽ0åˆ™ç›´æŽ¥è¿”å›žremaining //2.å¦‚æžœremainingå¤§äºŽ0åˆ™å…ˆæ›´æ–°åŒæ­¥çŠ¶æ€å†è¿”å›žremaining if (remaining &lt; 0 || compareAndSetState(available, remaining)) &#123; return remaining; &#125; &#125; &#125;&#125;//éžå…¬å¹³åŒæ­¥å™¨static final class NonfairSync extends Sync &#123; private static final long serialVersionUID = -2694183684443567898L; NonfairSync(int permits) &#123; super(permits); &#125; //å°è¯•èŽ·å–è®¸å¯è¯ protected int tryAcquireShared(int acquires) &#123; return nonfairTryAcquireShared(acquires); &#125;&#125;//å…¬å¹³åŒæ­¥å™¨static final class FairSync extends Sync &#123; private static final long serialVersionUID = 2014338818796000944L; FairSync(int permits) &#123; super(permits); &#125; //å°è¯•èŽ·å–è®¸å¯è¯ protected int tryAcquireShared(int acquires) &#123; for (;;) &#123; //åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—å‰é¢æœ‰æ²¡æœ‰äººæŽ’é˜Ÿ if (hasQueuedPredecessors()) &#123; //å¦‚æžœæœ‰çš„è¯å°±ç›´æŽ¥è¿”å›ž-1ï¼Œè¡¨ç¤ºå°è¯•èŽ·å–å¤±è´¥ return -1; &#125; //èŽ·å–å¯ç”¨è®¸å¯è¯ int available = getState(); //èŽ·å–å‰©ä½™è®¸å¯è¯ int remaining = available - acquires; //1.å¦‚æžœremainingå°äºŽ0åˆ™ç›´æŽ¥è¿”å›žremaining //2.å¦‚æžœremainingå¤§äºŽ0åˆ™å…ˆæ›´æ–°åŒæ­¥çŠ¶æ€å†è¿”å›žremaining if (remaining &lt; 0 || compareAndSetState(available, remaining)) &#123; return remaining; &#125; &#125; &#125;&#125; NonfairSyncçš„tryAcquireSharedæ–¹æ³•ç›´æŽ¥è°ƒç”¨çš„æ˜¯nonfairTryAcquireSharedæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨çˆ¶ç±»Syncé‡Œé¢çš„ã€‚éžå…¬å¹³èŽ·å–é”çš„é€»è¾‘æ˜¯å…ˆå–å‡ºå½“å‰åŒæ­¥çŠ¶æ€(åŒæ­¥çŠ¶æ€è¡¨ç¤ºè®¸å¯è¯ä¸ªæ•°)ï¼Œå°†å½“å‰åŒæ­¥çŠ¶æ€å‡åŽ»ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æžœç»“æžœä¸å°äºŽ0çš„è¯è¯æ˜Žè¿˜æœ‰å¯ç”¨çš„è®¸å¯è¯ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥ä½¿ç”¨CASæ“ä½œæ›´æ–°åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œæœ€åŽä¸ç®¡ç»“æžœæ˜¯å¦å°äºŽ0éƒ½ä¼šè¿”å›žè¯¥ç»“æžœå€¼ã€‚è¿™é‡Œè¦äº†è§£tryAcquireSharedæ–¹æ³•è¿”å›žå€¼çš„å«ä¹‰ï¼Œè¿”å›žè´Ÿæ•°è¡¨ç¤ºèŽ·å–å¤±è´¥ï¼Œé›¶è¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸä½†åŽç»­çº¿ç¨‹ä¸èƒ½å†èŽ·å–ï¼Œæ­£æ•°è¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸå¹¶ä¸”åŽç»­çº¿ç¨‹ä¹Ÿèƒ½å¤ŸèŽ·å–ã€‚å†æ¥çœ‹çœ‹acquireSharedInterruptiblyæ–¹æ³•çš„ä»£ç ã€‚ 123456789101112131415//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æžœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //1.å°è¯•åŽ»èŽ·å–é” //è´Ÿæ•°ï¼šè¡¨ç¤ºèŽ·å–å¤±è´¥ //é›¶å€¼ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸ, ä½†æ˜¯åŽç»§çº¿ç¨‹ä¸èƒ½å†èŽ·å–äº† //æ­£æ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸ, å¹¶ä¸”åŽç»§çº¿ç¨‹åŒæ ·å¯ä»¥èŽ·å–æˆåŠŸ if (tryAcquireShared(arg) &lt; 0) &#123; //2. å¦‚æžœèŽ·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); &#125;&#125; å¦‚æžœè¿”å›žçš„remainingå°äºŽ0çš„è¯å°±ä»£è¡¨èŽ·å–å¤±è´¥ï¼Œå› æ­¤tryAcquireShared(arg) &lt; 0å°±ä¸ºtrueï¼Œæ‰€ä»¥æŽ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯AQSçš„æ–¹æ³•ï¼Œå®ƒä¼šå°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ”¾å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œå¹¶ä¸”æœ‰å¯èƒ½æŒ‚èµ·çº¿ç¨‹ã€‚è¿™ä¹Ÿæ˜¯å½“remainingå°äºŽ0æ—¶çº¿ç¨‹ä¼šæŽ’é˜Ÿé˜»å¡žçš„åŽŸå› ã€‚è€Œå¦‚æžœè¿”å›žçš„remaining&gt;=0çš„è¯å°±ä»£è¡¨å½“å‰çº¿ç¨‹èŽ·å–æˆåŠŸï¼Œå› æ­¤tryAcquireShared(arg) &lt; 0å°±ä¸ºflaseï¼Œæ‰€ä»¥å°±ä¸ä¼šå†åŽ»è°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•é˜»å¡žå½“å‰çº¿ç¨‹äº†ã€‚ä»¥ä¸Šæ˜¯éžå…¬å¹³èŽ·å–çš„æ•´ä¸ªé€»è¾‘ï¼Œè€Œå…¬å¹³èŽ·å–æ—¶ä»…ä»…æ˜¯åœ¨æ­¤ä¹‹å‰å…ˆåŽ»è°ƒç”¨hasQueuedPredecessorsæ–¹æ³•åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰äººåœ¨æŽ’é˜Ÿï¼Œå¦‚æžœæœ‰çš„è¯å°±ç›´æŽ¥return -1è¡¨ç¤ºèŽ·å–å¤±è´¥ï¼Œå¦åˆ™æ‰ç»§ç»­æ‰§è¡Œä¸‹é¢å’Œéžå…¬å¹³èŽ·å–ä¸€æ ·çš„æ­¥éª¤ã€‚ é‡Šæ”¾è®¸å¯ 1234//é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯public void release() &#123; sync.releaseShared(1);&#125; è°ƒç”¨releaseæ–¹æ³•æ˜¯é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ï¼Œå®ƒçš„æ“ä½œå¾ˆç®€å•ï¼Œå°±è°ƒç”¨äº†AQSçš„releaseSharedæ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ã€‚ 12345678910//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) &#123; //1.å°è¯•åŽ»é‡Šæ”¾é” if (tryReleaseShared(arg)) &#123; //2.å¦‚æžœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; &#125; return false;&#125; AQSçš„releaseSharedæ–¹æ³•é¦–å…ˆè°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®žçŽ°é€»è¾‘åœ¨å­ç±»Syncé‡Œé¢ã€‚Semaphoreé‡å†™äº†tryReleaseShared()ï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š 12345678910111213protected final boolean tryReleaseShared(int releases) &#123; for (;;) &#123; // èŽ·å–â€œå¯ä»¥èŽ·å¾—çš„ä¿¡å·é‡çš„è®¸å¯æ•°â€ int current = getState(); // èŽ·å–â€œé‡Šæ”¾releasesä¸ªä¿¡å·é‡è®¸å¯ä¹‹åŽï¼Œå‰©ä½™çš„ä¿¡å·é‡è®¸å¯æ•°â€ int next = current + releases; if (next &lt; current) // overflow throw new Error("Maximum permit count exceeded"); // è®¾ç½®â€œå¯ä»¥èŽ·å¾—çš„ä¿¡å·é‡çš„è®¸å¯æ•°â€ä¸ºnextã€‚ if (compareAndSetState(current, next)) return true; &#125;&#125; tryReleaseSharedæ–¹æ³•é‡Œé¢é‡‡ç”¨forå¾ªçŽ¯è¿›è¡Œè‡ªæ—‹ï¼Œé¦–å…ˆèŽ·å–åŒæ­¥çŠ¶æ€ï¼Œå°†åŒæ­¥çŠ¶æ€åŠ ä¸Šä¼ å…¥çš„å‚æ•°ï¼Œç„¶åŽä»¥CASæ–¹å¼æ›´æ–°åŒæ­¥çŠ¶æ€ï¼Œæ›´æ–°æˆåŠŸå°±è¿”å›žtrueå¹¶è·³å‡ºæ–¹æ³•ï¼Œå¦åˆ™å°±ç»§ç»­å¾ªçŽ¯ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ å¦‚æžœtryReleaseShared()å°è¯•é‡Šæ”¾å…±äº«é”å¤±è´¥ï¼Œåˆ™ä¼šè°ƒç”¨doReleaseShared()åŽ»é‡Šæ”¾å…±äº«é”ã€‚doReleaseShared()çš„æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526private void doReleaseShared() &#123; for (;;) &#123; // èŽ·å–åŒæ­¥é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ Node h = head; // å¦‚æžœå¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹ä¸ç­‰äºŽtailèŠ‚ç‚¹ã€‚ if (h != null &amp;&amp; h != tail) &#123; // èŽ·å–å¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çš„çŠ¶æ€ int ws = h.waitStatus; // å¦‚æžœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯SIGNALçŠ¶æ€ï¼Œåˆ™æ„å‘³ç€â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€éœ€è¦è¢«unparkå”¤é†’ã€‚ if (ws == Node.SIGNAL) &#123; // è®¾ç½®â€œå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çŠ¶æ€â€ä¸ºç©ºçŠ¶æ€ã€‚å¤±è´¥çš„è¯ï¼Œåˆ™ç»§ç»­å¾ªçŽ¯ã€‚ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // å”¤é†’â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€ã€‚ unparkSuccessor(h); &#125; // å¦‚æžœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯ç©ºçŠ¶æ€ï¼Œåˆ™è®¾ç½®â€œæ–‡ä»¶ç‚¹å¯¹åº”çš„çº¿ç¨‹æ‰€æ‹¥æœ‰çš„å…±äº«é”â€ä¸ºå…¶å®ƒçº¿ç¨‹èŽ·å–é”çš„ç©ºçŠ¶æ€ã€‚ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS &#125; // å¦‚æžœå¤´èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç»§ç»­å¾ªçŽ¯ã€‚å¦åˆ™ï¼Œé€€å‡ºå¾ªçŽ¯ã€‚ if (h == head) // loop if head changed break; &#125;&#125; doReleaseShared()ä¼šé‡Šæ”¾â€œå…±äº«é”â€ã€‚å®ƒä¼šä»Žå‰å¾€åŽçš„éåŽ†åŒæ­¥é˜Ÿåˆ—ï¼Œä¾æ¬¡â€œå”¤é†’â€ç„¶åŽâ€œæ‰§è¡Œâ€é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ï¼›æœ€ç»ˆçš„ç›®çš„æ˜¯è®©è¿™äº›çº¿ç¨‹é‡Šæ”¾å®ƒä»¬æ‰€æŒæœ‰çš„ä¿¡å·é‡ã€‚ åº”ç”¨ç¤ºä¾‹ åˆ©ç”¨Semaphoreå®žçŽ°æ•°æ®åº“è¿žæŽ¥æ± ã€‚ è¿žæŽ¥æ± ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118package main.java.com.study.lock.semaphore;import java.util.concurrent.Semaphore;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: è¿žæŽ¥æ±  */public class ConnectPool &#123; /** * è¿žæŽ¥æ± å¤§å° */ private int size; /** * è¿žæŽ¥é›†åˆ */ private Connect[] connects; /** * è¿žæŽ¥çŠ¶æ€æ ‡å¿— */ private boolean[] connectFlag; /** * å‰©ä½™å¯ç”¨è¿žæŽ¥æ•° */ private volatile int available; /** * ä¿¡å·é‡ */ private Semaphore semaphore; public ConnectPool(int size) &#123; this.size = size; this.available = size; semaphore = new Semaphore(size, true); connects = new Connect[size]; connectFlag = new boolean[size]; initConnects(); &#125; /** * åˆå§‹åŒ–è¿žæŽ¥ */ private void initConnects() &#123; //ç”ŸæˆæŒ‡å®šæ•°é‡çš„è¿žæŽ¥ for (int i = 0; i &lt; this.size; i++) &#123; connects[i] = new Connect(); &#125; &#125; /** * èŽ·å–è¿žæŽ¥ */ private synchronized Connect getConnect() &#123; for (int i = 0; i &lt; connectFlag.length; i++) &#123; //éåŽ†é›†åˆæ‰¾åˆ°æœªä½¿ç”¨çš„è¿žæŽ¥ if (!connectFlag[i]) &#123; //å°†è¿žæŽ¥è®¾ç½®ä¸ºä½¿ç”¨ä¸­ connectFlag[i] = true; //å¯ç”¨è¿žæŽ¥æ•°å‡ä¸€ available--; System.out.println("ã€" + Thread.currentThread().getName() + "ã€‘å·²èŽ·å–è¿žæŽ¥ï¼Œå‰©ä½™å¯ç”¨è¿žæŽ¥ï¼š" + available); //è¿”å›žè¿žæŽ¥ return connects[i]; &#125; &#125; return null; &#125; /** * æ‰“å¼€é“¾æŽ¥ * * @return */ public Connect openConnect() throws InterruptedException &#123; //èŽ·å–è®¸å¯ semaphore.acquire(); //èŽ·å–è¿žæŽ¥ return getConnect(); &#125; /** * é‡Šæ”¾è¿žæŽ¥ */ public synchronized void release(Connect connect) &#123; for (int i = 0; i &lt; this.size; i++) &#123; if (connect == connects[i]) &#123; //å°†è¿žæŽ¥è®¾ç½®ä¸ºæœªä½¿ç”¨ connectFlag[i] = false; //å¯ç”¨è¿žæŽ¥åŠ ä¸€ available++; System.out.println("ã€" + Thread.currentThread().getName() + "ã€‘å·²é‡Šæ”¾è¿žæŽ¥ï¼Œå‰©ä½™å¯ç”¨è¿žæŽ¥ï¼š" + available); //é‡Šæ”¾è®¸å¯ semaphore.release(); &#125; &#125; &#125;&#125;class Connect &#123; private static int count = 1; private int id = count++; public Connect() &#123; //æ¨¡æ‹Ÿæ‰“å¼€ä¸€ä¸ªè¿žæŽ¥å¾ˆè€—è´¹èµ„æºï¼Œéœ€è¦ç­‰å¾…1ç§’ try &#123; TimeUnit.MILLISECONDS.sleep(1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println("è¿žæŽ¥#" + id + "#å·²ä¸Žæ•°æ®åº“å»ºç«‹é€šé“ï¼"); &#125; @Override public String toString() &#123; return "ã€" + id + "ã€‘"; &#125;&#125; æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627package main.java.com.study.lock.semaphore;/** * @author: whb * @description: æµ‹è¯•è¿žæŽ¥æ±  */public class TestConnectPool extends Thread &#123; private static ConnectPool pool = new ConnectPool(3); @Override public void run() &#123; try &#123; Connect connect = pool.openConnect(); Thread.sleep(100); pool.release(connect); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; new TestConnectPool().start(); &#125; &#125;&#125; æ‰§è¡Œç»“æžœï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-CyclicBarrier]]></title>
    <url>%2Fposts%2F3a683baa.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° çŽ°å®žç”Ÿæ´»ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…æ™¯ï¼Œåœ¨è¿›è¡ŒæŸä¸ªæ´»åŠ¨å‰éœ€è¦ç­‰å¾…äººå…¨éƒ¨éƒ½é½äº†æ‰å¼€å§‹ã€‚ä¾‹å¦‚åƒé¥­æ—¶è¦ç­‰å…¨å®¶äººéƒ½ä¸Šåº§äº†æ‰åŠ¨ç­·å­ï¼Œæ—…æ¸¸æ—¶è¦ç­‰å…¨éƒ¨äººéƒ½åˆ°é½äº†æ‰å‡ºå‘ï¼Œæ¯”èµ›æ—¶è¦ç­‰è¿åŠ¨å‘˜éƒ½ä¸ŠåœºåŽæ‰å¼€å§‹ã€‚åœ¨J.U.CåŒ…ä¸­æä¾›äº†ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»èƒ½å¤Ÿå¾ˆå¥½çš„æ¨¡æ‹Ÿè¿™ç±»åœºæ™¯ï¼Œå®ƒå°±æ˜¯CyclicBarrierç±»ã€‚åˆ©ç”¨CyclicBarrierç±»å¯ä»¥å®žçŽ°ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå±éšœç‚¹åŽå†è¿›è¡ŒåŽç»­çš„æ“ä½œã€‚ä¸‹å›¾æ¼”ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ã€‚ æˆå‘˜å˜é‡ åœ¨CyclicBarrierç±»çš„å†…éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨åˆ°è¾¾å±éšœç‚¹çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨awaitæ–¹æ³•å°†è‡ªå·±é˜»å¡žï¼Œæ­¤æ—¶è®¡æ•°å™¨ä¼šå‡1ï¼Œå½“è®¡æ•°å™¨å‡ä¸º0çš„æ—¶å€™æ‰€æœ‰å› è°ƒç”¨awaitæ–¹æ³•è€Œè¢«é˜»å¡žçš„çº¿ç¨‹å°†è¢«å”¤é†’ã€‚è¿™å°±æ˜¯å®žçŽ°ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…çš„åŽŸç†ï¼Œä¸‹é¢çœ‹ä¸‹CyclicBarrieræœ‰å“ªäº›æˆå‘˜å˜é‡ã€‚ 1234567891011121314151617//åŒæ­¥æ“ä½œé”private final ReentrantLock lock = new ReentrantLock();//çº¿ç¨‹æ‹¦æˆªå™¨private final Condition trip = lock.newCondition();//æ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•°private final int parties;//æ¢ä»£å‰æ‰§è¡Œçš„ä»»åŠ¡private final Runnable barrierCommand;//è¡¨ç¤ºæ …æ çš„å½“å‰ä»£private Generation generation = new Generation();//è®¡æ•°å™¨private int count;//é™æ€å†…éƒ¨ç±»Generationprivate static class Generation &#123; boolean broken = false;&#125; CyclicBarrierå†…éƒ¨æ˜¯é€šè¿‡æ¡ä»¶é˜Ÿåˆ—tripæ¥å¯¹çº¿ç¨‹è¿›è¡Œé˜»å¡žçš„ï¼Œå¹¶ä¸”å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªintåž‹çš„å˜é‡partieså’Œcountã€‚ partiesè¡¨ç¤ºæ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•°ï¼Œè¯¥å€¼åœ¨æž„é€ æ—¶è¿›è¡Œèµ‹å€¼ã€‚ countæ˜¯å†…éƒ¨è®¡æ•°å™¨ï¼Œå®ƒçš„åˆå§‹å€¼å’Œpartiesç›¸åŒï¼Œä»¥åŽéšç€æ¯æ¬¡awaitæ–¹æ³•çš„è°ƒç”¨è€Œå‡1ï¼Œç›´åˆ°å‡ä¸º0å°±å°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ã€‚ CyclicBarrieræœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Generationï¼Œè¯¥ç±»çš„å¯¹è±¡ä»£è¡¨æ …æ çš„å½“å‰ä»£ï¼Œå°±åƒçŽ©æ¸¸æˆæ—¶ä»£è¡¨çš„æœ¬å±€æ¸¸æˆï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®žçŽ°å¾ªçŽ¯ç­‰å¾…ã€‚ barrierCommandè¡¨ç¤ºæ¢ä»£å‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå½“countå‡ä¸º0æ—¶è¡¨ç¤ºæœ¬å±€æ¸¸æˆç»“æŸï¼Œéœ€è¦è½¬åˆ°ä¸‹ä¸€å±€ã€‚åœ¨è½¬åˆ°ä¸‹ä¸€å±€æ¸¸æˆä¹‹å‰ä¼šå°†æ‰€æœ‰é˜»å¡žçš„çº¿ç¨‹å”¤é†’ï¼Œåœ¨å”¤é†’æ‰€æœ‰çº¿ç¨‹ä¹‹å‰ä½ å¯ä»¥é€šè¿‡æŒ‡å®šbarrierCommandæ¥æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ã€‚ æž„é€ å™¨ 123456789101112131415//æž„é€ å™¨1public CyclicBarrier(int parties, Runnable barrierAction) &#123; if (parties &lt;= 0) throw new IllegalArgumentException(); // partiesè¡¨ç¤ºâ€œå¿…é¡»åŒæ—¶åˆ°è¾¾barrierçš„çº¿ç¨‹ä¸ªæ•°â€ã€‚ this.parties = parties; // countè¡¨ç¤ºâ€œå¤„åœ¨ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¸ªæ•°â€ã€‚ this.count = parties; // barrierCommandè¡¨ç¤ºâ€œpartiesä¸ªçº¿ç¨‹åˆ°è¾¾barrieræ—¶ï¼Œä¼šæ‰§è¡Œçš„åŠ¨ä½œâ€ã€‚ this.barrierCommand = barrierAction;&#125;//æž„é€ å™¨2public CyclicBarrier(int parties) &#123; this(parties, null);&#125; CyclicBarrieræœ‰ä¸¤ä¸ªæž„é€ å™¨ï¼Œå…¶ä¸­æž„é€ å™¨1æ˜¯å®ƒçš„æ ¸å¿ƒæž„é€ å™¨ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŒ‡å®šè¦æ‹¦æˆªçš„çº¿ç¨‹æ•°ä»¥åŠç»“æŸæ—¶è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è®¡æ•°å™¨countçš„åˆå§‹å€¼è¢«è®¾ç½®ä¸ºpartiesã€‚ ç­‰å¾…æ–¹æ³• 12345678910111213//éžå®šæ—¶ç­‰å¾…public int await() throws InterruptedException, BrokenBarrierException &#123; try &#123; return dowait(false, 0L); &#125; catch (TimeoutException toe) &#123; throw new Error(toe); &#125;&#125;//å®šæ—¶ç­‰å¾…public int await(long timeout, TimeUnit unit) throws InterruptedException, BrokenBarrierException, TimeoutException &#123; return dowait(true, unit.toNanos(timeout));&#125; ä¸ç®¡æ˜¯å®šæ—¶ç­‰å¾…è¿˜æ˜¯éžå®šæ—¶ç­‰å¾…ï¼Œå®ƒä»¬éƒ½è°ƒç”¨äº†dowaitæ–¹æ³•ï¼Œåªä¸è¿‡æ˜¯ä¼ å…¥çš„å‚æ•°ä¸åŒè€Œå·²ã€‚ä¸‹é¢çœ‹ä¸‹dowaitæ–¹æ³•éƒ½åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081//æ ¸å¿ƒç­‰å¾…æ–¹æ³•private int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException &#123; final ReentrantLock lock = this.lock; //èŽ·å–ç‹¬å é” lock.lock(); try &#123; //ä¿å­˜å½“å‰çš„generation final Generation g = generation; //æ£€æŸ¥å½“å‰æ …æ æ˜¯å¦è¢«æ‰“ç¿» if (g.broken) &#123; throw new BrokenBarrierException(); &#125; //æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ if (Thread.interrupted()) &#123; //å¦‚æžœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ä¼šåšä»¥ä¸‹ä¸‰ä»¶äº‹ //1.æ‰“ç¿»å½“å‰æ …æ  //2.å”¤é†’æ‹¦æˆªçš„æ‰€æœ‰çº¿ç¨‹ //3.æŠ›å‡ºä¸­æ–­å¼‚å¸¸ breakBarrier(); throw new InterruptedException(); &#125; //æ¯æ¬¡éƒ½å°†è®¡æ•°å™¨çš„å€¼å‡1 int index = --count; //è®¡æ•°å™¨çš„å€¼å‡ä¸º0åˆ™éœ€å”¤é†’æ‰€æœ‰çº¿ç¨‹å¹¶è½¬æ¢åˆ°ä¸‹ä¸€ä»£ if (index == 0) &#123; boolean ranAction = false; try &#123; //å”¤é†’æ‰€æœ‰çº¿ç¨‹å‰å…ˆæ‰§è¡ŒæŒ‡å®šçš„ä»»åŠ¡ final Runnable command = barrierCommand; if (command != null) &#123; command.run(); &#125; ranAction = true; //å”¤é†’æ‰€æœ‰çº¿ç¨‹å¹¶è½¬åˆ°ä¸‹ä¸€ä»£ nextGeneration(); return 0; &#125; finally &#123; //ç¡®ä¿åœ¨ä»»åŠ¡æœªæˆåŠŸæ‰§è¡Œæ—¶èƒ½å°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ if (!ranAction) &#123; breakBarrier(); &#125; &#125; &#125; //å½“å‰çº¿ç¨‹ä¸€ç›´é˜»å¡žï¼Œç›´åˆ°â€œæœ‰partiesä¸ªçº¿ç¨‹åˆ°è¾¾barrierâ€ æˆ– â€œå½“å‰çº¿ç¨‹è¢«ä¸­æ–­â€ æˆ– â€œè¶…æ—¶â€è¿™3è€…ä¹‹ä¸€å‘ç”Ÿï¼Œå½“å‰çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œã€‚ for (;;) &#123; try &#123; //æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥å†³å®šæ˜¯å®šæ—¶ç­‰å¾…è¿˜æ˜¯éžå®šæ—¶ç­‰å¾… if (!timed) &#123; trip.await(); &#125;else if (nanos &gt; 0L) &#123; nanos = trip.awaitNanos(nanos); &#125; &#125; catch (InterruptedException ie) &#123; //è‹¥å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…æœŸé—´è¢«ä¸­æ–­åˆ™æ‰“ç¿»æ …æ å”¤é†’å…¶ä»–çº¿ç¨‹ if (g == generation &amp;&amp; ! g.broken) &#123; breakBarrier(); throw ie; &#125; else &#123; //è‹¥åœ¨æ•èŽ·ä¸­æ–­å¼‚å¸¸å‰å·²ç»å®Œæˆåœ¨æ …æ ä¸Šçš„ç­‰å¾…, åˆ™ç›´æŽ¥è°ƒç”¨ä¸­æ–­æ“ä½œ Thread.currentThread().interrupt(); &#125; &#125; //å¦‚æžœçº¿ç¨‹å› ä¸ºæ‰“ç¿»æ …æ æ“ä½œè€Œè¢«å”¤é†’åˆ™æŠ›å‡ºå¼‚å¸¸ if (g.broken) &#123; throw new BrokenBarrierException(); &#125; //å¦‚æžœçº¿ç¨‹å› ä¸ºæ¢ä»£æ“ä½œè€Œè¢«å”¤é†’åˆ™è¿”å›žè®¡æ•°å™¨çš„å€¼ if (g != generation) &#123; return index; &#125; //å¦‚æžœçº¿ç¨‹å› ä¸ºæ—¶é—´åˆ°äº†è€Œè¢«å”¤é†’åˆ™æ‰“ç¿»æ …æ å¹¶æŠ›å‡ºå¼‚å¸¸ if (timed &amp;&amp; nanos &lt;= 0L) &#123; breakBarrier(); throw new TimeoutException(); &#125; &#125; &#125; finally &#123; lock.unlock(); &#125;&#125; åœ¨dowaitæ–¹æ³•ä¸­æ¯æ¬¡éƒ½å°†countå‡1ï¼Œå‡å®ŒåŽç«‹é©¬è¿›è¡Œåˆ¤æ–­çœ‹çœ‹æ˜¯å¦ç­‰äºŽ0ï¼Œå¦‚æžœç­‰äºŽ0çš„è¯å°±ä¼šå…ˆåŽ»æ‰§è¡Œä¹‹å‰æŒ‡å®šå¥½çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä¹‹åŽå†è°ƒç”¨nextGenerationæ–¹æ³•å°†æ …æ è½¬åˆ°ä¸‹ä¸€ä»£ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šå°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ï¼Œå°†è®¡æ•°å™¨çš„å€¼é‡æ–°è®¾ä¸ºpartiesï¼Œæœ€åŽä¼šé‡æ–°è®¾ç½®æ …æ ä»£æ¬¡ï¼Œåœ¨æ‰§è¡Œå®ŒnextGenerationæ–¹æ³•ä¹‹åŽå°±æ„å‘³ç€æ¸¸æˆè¿›å…¥ä¸‹ä¸€å±€ã€‚å¦‚æžœè®¡æ•°å™¨æ­¤æ—¶è¿˜ä¸ç­‰äºŽ0çš„è¯å°±è¿›å…¥forå¾ªçŽ¯ï¼Œæ ¹æ®å‚æ•°æ¥å†³å®šæ˜¯è°ƒç”¨trip.awaitNanos(nanos)è¿˜æ˜¯trip.await()æ–¹æ³•ï¼Œè¿™ä¸¤æ–¹æ³•å¯¹åº”ç€å®šæ—¶å’Œéžå®šæ—¶ç­‰å¾…ã€‚å¦‚æžœåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å½“å‰çº¿ç¨‹è¢«ä¸­æ–­å°±ä¼šæ‰§è¡ŒbreakBarrieræ–¹æ³•ï¼Œè¯¥æ–¹æ³•å«åšæ‰“ç ´æ …æ ï¼Œæ„å‘³ç€æ¸¸æˆåœ¨ä¸­é€”è¢«æŽæ–­ï¼Œè®¾ç½®generationçš„brokençŠ¶æ€ä¸ºtrueå¹¶å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚åŒæ—¶è¿™ä¹Ÿè¯´æ˜Žåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹è¢«ä¸­æ–­æ•´ç›˜æ¸¸æˆå°±ç»“æŸï¼Œæ‰€æœ‰ä¹‹å‰è¢«é˜»å¡žçš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚çº¿ç¨‹é†’æ¥åŽä¼šæ‰§è¡Œä¸‹é¢ä¸‰ä¸ªåˆ¤æ–­ï¼Œçœ‹çœ‹æ˜¯å¦å› ä¸ºè°ƒç”¨breakBarrieræ–¹æ³•è€Œè¢«å”¤é†’ï¼Œå¦‚æžœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›çœ‹çœ‹æ˜¯å¦æ˜¯æ­£å¸¸çš„æ¢ä»£æ“ä½œè€Œè¢«å”¤é†’ï¼Œå¦‚æžœæ˜¯åˆ™è¿”å›žè®¡æ•°å™¨çš„å€¼ï¼›çœ‹çœ‹æ˜¯å¦å› ä¸ºè¶…æ—¶è€Œè¢«å”¤é†’ï¼Œå¦‚æžœæ˜¯çš„è¯å°±è°ƒç”¨breakBarrieræ‰“ç ´æ …æ å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœå…¶ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹å› ä¸ºç­‰å¾…è¶…æ—¶è€Œé€€å‡ºï¼Œé‚£ä¹ˆæ•´ç›˜æ¸¸æˆä¹Ÿä¼šç»“æŸï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ä¸‹é¢è´´å‡ºnextGenerationæ–¹æ³•å’ŒbreakBarrieræ–¹æ³•çš„å…·ä½“ä»£ç ã€‚ 12345678910111213141516171819//åˆ‡æ¢æ …æ åˆ°ä¸‹ä¸€ä»£private void nextGeneration() &#123; //å”¤é†’æ¡ä»¶é˜Ÿåˆ—æ‰€æœ‰çº¿ç¨‹ trip.signalAll(); //è®¾ç½®è®¡æ•°å™¨çš„å€¼ä¸ºéœ€è¦æ‹¦æˆªçš„çº¿ç¨‹æ•° count = parties; //é‡æ–°è®¾ç½®æ …æ ä»£æ¬¡ generation = new Generation();&#125;//æ‰“ç¿»å½“å‰æ …æ private void breakBarrier() &#123; //å°†å½“å‰æ …æ çŠ¶æ€è®¾ç½®ä¸ºæ‰“ç¿» generation.broken = true; //è®¾ç½®è®¡æ•°å™¨çš„å€¼ä¸ºéœ€è¦æ‹¦æˆªçš„çº¿ç¨‹æ•° count = parties; //å”¤é†’æ‰€æœ‰çº¿ç¨‹ trip.signalAll();&#125; åº”ç”¨ç¤ºä¾‹ èµ›é©¬:é€šè¿‡åœ¨æŽ§åˆ¶å°ä¸åœçš„æ‰“å°å„èµ›é©¬çš„å½“å‰è½¨è¿¹ï¼Œä»¥è¾¾åˆ°åŠ¨æ€æ˜¾ç¤ºçš„æ•ˆæžœã€‚æ•´åœºæ¯”èµ›æœ‰å¤šä¸ªè½®æ¬¡ï¼Œæ¯ä¸€è½®æ¬¡å„ä¸ªèµ›é©¬éƒ½ä¼šéšæœºèµ°ä¸Šå‡ æ­¥ç„¶åŽè°ƒç”¨awaitæ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“æ‰€æœ‰èµ›é©¬èµ°å®Œä¸€è½®çš„æ—¶å€™å°†ä¼šæ‰§è¡Œä»»åŠ¡å°†æ‰€æœ‰èµ›é©¬çš„å½“å‰è½¨è¿¹æ‰“å°åˆ°æŽ§åˆ¶å°ä¸Šã€‚è¿™æ ·æ¯ä¸€è½®ä¸‹æ¥å„èµ›é©¬çš„è½¨è¿¹éƒ½åœ¨ä¸åœçš„å¢žé•¿ï¼Œå½“å…¶ä¸­æŸä¸ªèµ›é©¬çš„è½¨è¿¹æœ€å…ˆå¢žé•¿åˆ°æŒ‡å®šçš„å€¼çš„æ—¶å€™å°†ä¼šç»“æŸæ•´åœºæ¯”èµ›ï¼Œè¯¥èµ›é©¬æˆä¸ºæ•´åœºæ¯”èµ›çš„èƒœåˆ©è€…ï¼ç¨‹åºå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283class Horse implements Runnable &#123; private static int counter = 0; private final int id = counter++; private int strides = 0; private static Random rand = new Random(47); private static CyclicBarrier barrier; public Horse(CyclicBarrier b) &#123; barrier = b; &#125; @Override public void run() &#123; try &#123; while(!Thread.interrupted()) &#123; synchronized(this) &#123; //èµ›é©¬æ¯æ¬¡éšæœºè·‘å‡ æ­¥ strides += rand.nextInt(3); &#125; barrier.await(); &#125; &#125; catch(Exception e) &#123; e.printStackTrace(); &#125; &#125; public String tracks() &#123; StringBuilder s = new StringBuilder(); for(int i = 0; i &lt; getStrides(); i++) &#123; s.append("*"); &#125; s.append(id); return s.toString(); &#125; public synchronized int getStrides() &#123; return strides; &#125; public String toString() &#123; return "Horse " + id + " "; &#125; &#125;public class HorseRace implements Runnable &#123; private static final int FINISH_LINE = 75; private static List&lt;Horse&gt; horses = new ArrayList&lt;Horse&gt;(); private static ExecutorService exec = Executors.newCachedThreadPool(); @Override public void run() &#123; StringBuilder s = new StringBuilder(); //æ‰“å°èµ›é“è¾¹ç•Œ for(int i = 0; i &lt; FINISH_LINE; i++) &#123; s.append("="); &#125; System.out.println(s); //æ‰“å°èµ›é©¬è½¨è¿¹ for(Horse horse : horses) &#123; System.out.println(horse.tracks()); &#125; //åˆ¤æ–­æ˜¯å¦ç»“æŸ for(Horse horse : horses) &#123; if(horse.getStrides() &gt;= FINISH_LINE) &#123; System.out.println(horse + "won!"); exec.shutdownNow(); return; &#125; &#125; //ä¼‘æ¯æŒ‡å®šæ—¶é—´å†åˆ°ä¸‹ä¸€è½® try &#123; TimeUnit.MILLISECONDS.sleep(200); &#125; catch(InterruptedException e) &#123; System.out.println("barrier-action sleep interrupted"); &#125; &#125; public static void main(String[] args) &#123; CyclicBarrier barrier = new CyclicBarrier(7, new HorseRace()); for(int i = 0; i &lt; 7; i++) &#123; Horse horse = new Horse(barrier); horses.add(horse); exec.execute(horse); &#125; &#125; &#125; ç¨‹åºçš„è¿è¡Œç»“æžœå¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2Fposts%2F4a17b156.html</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new "My New Post" More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æžä¹‹æ¡ä»¶é˜Ÿåˆ—]]></title>
    <url>%2Fposts%2F68b8bf54.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° é€šè¿‡ä¹‹å‰çš„åˆ†æžï¼Œæ·±å…¥äº†è§£äº†AbstractQueuedSynchronizerçš„å†…éƒ¨ç»“æž„å’Œä¸€äº›è®¾è®¡ç†å¿µï¼ŒçŸ¥é“äº†AbstractQueuedSynchronizerå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥çŠ¶æ€å’Œä¸¤ä¸ªæŽ’é˜ŸåŒºï¼Œè¿™ä¸¤ä¸ªæŽ’é˜ŸåŒºåˆ†åˆ«æ˜¯åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ã€‚ æ‹¿ATMæœºå–æ¬¾ä¸¾ä¾‹ï¼ŒATMæœºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸»è¦çš„æŽ’é˜ŸåŒºï¼Œå¦‚æžœATMæœºæ²¡å¼€æ”¾ï¼Œæ‰€æœ‰æƒ³è¦è¿›å…¥äººéƒ½å¾—åœ¨è¿™é‡ŒæŽ’é˜Ÿã€‚è€Œæ¡ä»¶é˜Ÿåˆ—ä¸»è¦æ˜¯ä¸ºæ¡ä»¶ç­‰å¾…è®¾ç½®çš„ï¼Œæƒ³è±¡ä¸€ä¸‹å¦‚æžœä¸€ä¸ªäººé€šè¿‡æŽ’é˜Ÿç»ˆäºŽæˆåŠŸèŽ·å–é”è¿›å…¥äº†ATMæœºï¼Œä½†åœ¨å–æ¬¾ä¹‹å‰å‘çŽ°è‡ªå·±æ²¡å¸¦é“¶è¡Œå¡ï¼Œç¢°åˆ°è¿™ç§æƒ…å†µè™½ç„¶å¾ˆæ— å¥ˆï¼Œä½†æ˜¯å®ƒä¹Ÿå¿…é¡»æŽ¥å—è¿™ä¸ªäº‹å®žï¼Œè¿™æ—¶å®ƒåªå¥½ä¹–ä¹–çš„å‡ºåŽ»å…ˆå‡†å¤‡å¥½é“¶è¡Œå¡(è¿›å…¥æ¡ä»¶é˜Ÿåˆ—ç­‰å¾…)ï¼Œå½“ç„¶åœ¨å‡ºåŽ»ä¹‹å‰è¿˜å¾—æŠŠé”ç»™é‡Šæ”¾äº†å¥½è®©å…¶ä»–äººèƒ½å¤Ÿè¿›æ¥ï¼Œåœ¨å‡†å¤‡å¥½äº†é“¶è¡Œå¡(æ¡ä»¶æ»¡è¶³)ä¹‹åŽå®ƒåˆå¾—é‡æ–°å›žåˆ°åŒæ­¥é˜Ÿåˆ—ä¸­åŽ»æŽ’é˜Ÿã€‚å½“ç„¶è¿›å…¥æˆ¿é—´çš„äººå¹¶ä¸éƒ½æ˜¯å› ä¸ºæ²¡å¸¦é“¶è¡Œå¡ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–ä¸€äº›åŽŸå› å¿…é¡»ä¸­æ–­æ“ä½œå…ˆåŽ»æ¡ä»¶é˜Ÿåˆ—ä¸­åŽ»æŽ’é˜Ÿï¼Œæ‰€ä»¥æ¡ä»¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªï¼Œä¾ä¸åŒçš„ç­‰å¾…æ¡ä»¶è€Œè®¾ç½®ä¸åŒçš„æ¡ä»¶é˜Ÿåˆ—ã€‚ åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—çš„åŒºåˆ«ï¼š åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ä¸ºheadï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ä¸ºfirstWaiter; åŒæ­¥é˜Ÿåˆ—çš„å°¾ç»“ç‚¹ä¸ºtailï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„å°¾ç»“ç‚¹ä¸ºlastWaiter; åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹æ²¡æœ‰å’Œä»»ä½•çº¿ç¨‹ç»‘å®šï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„firstWaiterç»‘å®šäº†çº¿ç¨‹ã€‚ åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸€æ¡å•å‘é“¾è¡¨ã€‚ ConditionæŽ¥å£å®šä¹‰äº†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œï¼ŒAbstractQueuedSynchronizerå†…éƒ¨çš„ConditionObjectç±»å®žçŽ°äº†ConditionæŽ¥å£ï¼Œä¸‹é¢çœ‹çœ‹ConditionæŽ¥å£éƒ½å®šä¹‰äº†å“ªäº›æ“ä½œã€‚ 123456789101112131415161718192021222324public interface Condition &#123; //å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… void await() throws InterruptedException; //ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… void awaitUninterruptibly(); //è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(ä¸è¿›è¡Œè‡ªæ—‹) long awaitNanos(long nanosTimeout) throws InterruptedException; //è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(è¿›è¡Œè‡ªæ—‹) boolean await(long time, TimeUnit unit) throws InterruptedException; //è®¾ç½®ç»å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾… boolean awaitUntil(Date deadline) throws InterruptedException; //å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ void signal(); //å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ void signalAll(); &#125; ConditionæŽ¥å£è™½ç„¶å®šä¹‰äº†è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œä½†æ€»å…±å°±åˆ†ä¸ºä¸¤ç±»ï¼Œä»¥awaitå¼€å¤´çš„æ˜¯çº¿ç¨‹è¿›å…¥æ¡ä»¶é˜Ÿåˆ—ç­‰å¾…çš„æ–¹æ³•ï¼Œä»¥signalå¼€å¤´çš„æ˜¯å°†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹â€œå”¤é†’â€çš„æ–¹æ³•ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨signalæ–¹æ³•å¯èƒ½å”¤é†’çº¿ç¨‹ä¹Ÿå¯èƒ½ä¸ä¼šå”¤é†’çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™ä¼šå”¤é†’çº¿ç¨‹è¿™å¾—çœ‹æƒ…å†µï¼Œä½†æ˜¯è°ƒç”¨signalæ–¹æ³•ä¸€å®šä¼šå°†çº¿ç¨‹ä»Žæ¡ä»¶é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚ awaitæ–¹æ³•åˆ†ä¸º5ç§ï¼Œåˆ†åˆ«æ˜¯å“åº”çº¿ç¨‹ä¸­æ–­ç­‰å¾…ï¼Œä¸å“åº”çº¿ç¨‹ä¸­æ–­ç­‰å¾…ï¼Œè®¾ç½®ç›¸å¯¹æ—¶é—´ä¸è‡ªæ—‹ç­‰å¾…ï¼Œè®¾ç½®ç›¸å¯¹æ—¶é—´è‡ªæ—‹ç­‰å¾…ï¼Œè®¾ç½®ç»å¯¹æ—¶é—´ç­‰å¾…ï¼› signalæ–¹æ³•åªæœ‰2ç§ï¼Œåˆ†åˆ«æ˜¯åªå”¤é†’æ¡ä»¶é˜Ÿåˆ—å¤´ç»“ç‚¹å’Œå”¤é†’æ¡ä»¶é˜Ÿåˆ—æ‰€æœ‰ç»“ç‚¹çš„æ“ä½œã€‚åŒä¸€ç±»çš„æ–¹æ³•åŸºæœ¬ä¸Šæ˜¯ç›¸é€šçš„ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… 123456789101112131415161718192021222324252627282930313233343536//å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…public final void await() throws InterruptedException &#123; //å¦‚æžœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //å°†å½“å‰çº¿ç¨‹åŒ…è£…ç§¤ç»“ç‚¹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); int interruptMode = 0; //çº¿ç¨‹ä¸€ç›´åœ¨whileå¾ªçŽ¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹è¢«å”¤é†’æˆ–è€…çº¿ç¨‹è¢«ä¸­æ–­å¹¶ä¸”è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ while (!isOnSyncQueue(node)) &#123; //è¿›è¡Œæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ·, çº¿ç¨‹è¢«å”¤é†’çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š //1.åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆ //2.è®¾ç½®åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ //3.å‰é©±ç»“ç‚¹é‡Šæ”¾é”åŽå”¤é†’å½“å‰ç»“ç‚¹ LockSupport.park(this); //å½“å‰çº¿ç¨‹é†’æ¥åŽç«‹é©¬æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­, å¦‚æžœæ˜¯åˆ™ä»£è¡¨ç»“ç‚¹å–æ¶ˆæ¡ä»¶ç­‰å¾…, æ­¤æ—¶éœ€è¦å°†ç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) &#123; break; &#125; &#125; //çº¿ç¨‹é†’æ¥åŽå°±ä¼šä»¥ç‹¬å æ¨¡å¼èŽ·å–é”ï¼Œå¦‚æžœèŽ·å–æ—¶å‘ç”Ÿäº†ä¸­æ–­ï¼Œå¦‚æžœåœ¨è°ƒç”¨await()æ–¹æ³•æ—¶è¢«ä¸­æ–­ï¼Œåˆ™ä¾ç„¶æ˜¯THROW_IE if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) &#123; interruptMode = REINTERRUPT; &#125; //è¿™æ­¥æ“ä½œä¸»è¦ä¸ºé˜²æ­¢çº¿ç¨‹åœ¨signalä¹‹å‰ä¸­æ–­è€Œå¯¼è‡´æ²¡ä¸Žæ¡ä»¶é˜Ÿåˆ—æ–­ç»è”ç³» if (node.nextWaiter != null) &#123; unlinkCancelledWaiters(); &#125; //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) &#123; reportInterruptAfterWait(interruptMode); &#125;&#125; ä¸Šè¿°ä»£ç æ•´ä¸ªæµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œå¦‚æžœè¢«ä¸­æ–­ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æžœæ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™ç»§ç»­ä¸‹é¢çš„æµç¨‹ã€‚ ç¬¬äºŒæ­¥ï¼šé€šè¿‡è°ƒç”¨addConditionWaiter()å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeèŠ‚ç‚¹å­˜æ”¾åˆ°Conditioné˜Ÿåˆ—çš„å°¾éƒ¨ã€‚ ç¬¬ä¸‰æ­¥ï¼šå› ä¸ºå½“å‰çº¿ç¨‹å·²ç»èŽ·å–äº†é”ï¼Œæ‰€ä»¥è°ƒç”¨awaitéœ€è¦é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥é€šè¿‡è°ƒç”¨fullyRelease()é‡Šæ”¾èµ„æºï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é”ï¼Œå› ä¸ºè¿™ä¸ªé”æ˜¯ç‹¬å é”å¹¶ä¸”å¯ä»¥é‡å…¥ï¼Œæ‰€ä»¥è¦å…¨éƒ¨æŠŠèµ„æºé‡Šæ”¾ï¼Œä»Žfullyå­—é¢ä¸Šä¹Ÿå¯ä»¥ç†è§£ã€‚ ç¬¬å››æ­¥ï¼šé€šè¿‡whileå¾ªçŽ¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œå¦‚æžœæ²¡æœ‰åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œåˆ™éœ€è¦é˜»å¡žå½“å‰çº¿ç¨‹ï¼Œç„¶åŽè°ƒç”¨checkInterruptWaiting()æ–¹æ³•åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¦‚æžœè¢«ä¸­æ–­è¿‡ï¼Œåˆ™è·³å‡ºwhileå¾ªçŽ¯ã€‚ ç¬¬äº”æ­¥ï¼šé€šè¿‡è°ƒç”¨acquireQueued()æ–¹æ³•èŽ·å–èµ„æºï¼Œå¦‚æžœåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶è¢«ä¸­æ–­ï¼Œåˆ™ä¸­æ–­ç±»åž‹å˜æˆREINTERRUPT(ç¨åŽå¤„ç†ä¸­æ–­)ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›žå€¼åªæ˜¯è®°å½•æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¹¶ä¸ä¼šå“åº”ä¸­æ–­ã€‚ ç¬¬å…­æ­¥ï¼šå¦‚æžœæ˜¯å› ä¸ºä¸­æ–­ï¼Œæ­¤æ—¶waitStatus=0,ä½†æ˜¯æ­¤æ—¶å®ƒä»åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä»Žæ¡ä»¶é˜Ÿåˆ—ä¸­æ¸…é™¤ã€‚ ç¬¬ä¸ƒæ­¥ï¼šå¦‚æžœè¢«ä¸­æ–­ï¼Œåˆ™è°ƒç”¨reportInterruptAfterWait()æ–¹æ³•å¤„ç†ä¸åŒçš„ä¸­æ–­ç±»åž‹ã€‚ ç¬¬ä¸€æ­¥ï¼šå°†çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ— 1234567891011121314151617private Node addConditionWaiter() &#123; //èŽ·å–æ¡ä»¶é˜Ÿåˆ—å°¾ç»“ç‚¹ Node t = lastWaiter; // å¦‚æžœå°¾ç»“ç‚¹è¢«å–æ¶ˆï¼Œåˆ™ä»Žæ¡ä»¶é˜Ÿåˆ—ä¸­æ¸…é™¤ if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) &#123; unlinkCancelledWaiters(); t = lastWaiter; &#125; //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeç»“ç‚¹ï¼Œå¹¶ä¸”waitStatusçŠ¶æ€æ˜¯CONDITIONã€‚ Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node;&#125; å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeèŠ‚ç‚¹ï¼Œç„¶åŽåŠ å…¥åˆ°Conditionçš„å°¾éƒ¨ï¼Œåœ¨åŠ å…¥ä¹‹å‰éœ€è¦æ£€æŸ¥ä»¥ä¸‹å°¾éƒ¨èŠ‚ç‚¹tæ˜¯å¦è¿˜åœ¨ç­‰å¾…Conditionæ¡ä»¶ï¼Œå¦‚æžœè¢«signalæˆ–è€…è¢«ä¸­æ–­ï¼Œåˆ™è°ƒç”¨æ¸…é™¤æ–¹æ³•å°†å°¾èŠ‚ç‚¹ä»ŽConditioné˜Ÿåˆ—ä¸­æ¸…é™¤æŽ‰ã€‚ ç¬¬äºŒæ­¥ï¼šå®Œå…¨å°†é”é‡Šæ”¾ 1234567891011121314151617181920212223//å®Œå…¨é‡Šæ”¾é”final int fullyRelease(Node node) &#123; //åˆ¤æ–­èµ„æºæ˜¯å¦é‡Šæ”¾æˆåŠŸ boolean failed = true; try &#123; //èŽ·å–å½“å‰çš„åŒæ­¥çŠ¶æ€ int savedState = getState(); //ä½¿ç”¨å½“å‰çš„åŒæ­¥çŠ¶æ€åŽ»é‡Šæ”¾é” if (release(savedState)) &#123; failed = false; //å¦‚æžœé‡Šæ”¾é”æˆåŠŸå°±è¿”å›žå½“å‰åŒæ­¥çŠ¶æ€ return savedState; &#125; else &#123; //å¦‚æžœé‡Šæ”¾é”å¤±è´¥å°±æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ throw new IllegalMonitorStateException(); &#125; &#125; finally &#123; //ä¿è¯æ²¡æœ‰æˆåŠŸé‡Šæ”¾é”å°±å°†è¯¥ç»“ç‚¹è®¾ç½®ä¸ºå–æ¶ˆçŠ¶æ€ if (failed) &#123; node.waitStatus = Node.CANCELLED; &#125; &#125;&#125; å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨åŽï¼Œç´§æŽ¥ç€å°±è°ƒç”¨fullyReleaseæ–¹æ³•é‡Šæ”¾é”ã€‚æ³¨æ„ï¼Œæ–¹æ³•åä¸ºfullyReleaseä¹Ÿå°±è¿™æ­¥æ“ä½œä¼šå®Œå…¨çš„é‡Šæ”¾é”ï¼Œå› ä¸ºé”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ¡ä»¶ç­‰å¾…å‰éœ€è¦å°†é”å…¨éƒ¨é‡Šæ”¾äº†ï¼Œä¸ç„¶çš„è¯åˆ«äººå°±èŽ·å–ä¸äº†é”äº†ã€‚å¦‚æžœé‡Šæ”¾é”å¤±è´¥çš„è¯å°±ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¦‚æžœæˆåŠŸé‡Šæ”¾äº†é”çš„è¯å°±è¿”å›žä¹‹å‰çš„åŒæ­¥çŠ¶æ€ã€‚ ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œæ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223242526272829303132333435363738//çº¿ç¨‹ä¸€ç›´åœ¨whileå¾ªçŽ¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾…while (!isOnSyncQueue(node)) &#123; //è¿›è¡Œæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ·, çº¿ç¨‹è¢«å”¤é†’çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š //1.åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆ //2.è®¾ç½®åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ //3.å‰é©±ç»“ç‚¹é‡Šæ”¾é”åŽå”¤é†’å½“å‰ç»“ç‚¹ LockSupport.park(this); //å½“å‰çº¿ç¨‹é†’æ¥åŽç«‹é©¬æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­, å¦‚æžœæ˜¯åˆ™ä»£è¡¨ç»“ç‚¹å–æ¶ˆæ¡ä»¶ç­‰å¾…, æ­¤æ—¶éœ€è¦å°†ç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) &#123; break; &#125;&#125;//æ£€æŸ¥æ¡ä»¶ç­‰å¾…æ—¶çš„çº¿ç¨‹ä¸­æ–­æƒ…å†µprivate static final int REINTERRUPT = 1;private static final int THROW_IE = -1;private int checkInterruptWhileWaiting(Node node) &#123; //ä¸­æ–­è¯·æ±‚åœ¨signalæ“ä½œä¹‹å‰ï¼šTHROW_IE //ä¸­æ–­è¯·æ±‚åœ¨signalæ“ä½œä¹‹åŽï¼šREINTERRUPT //æœŸé—´æ²¡æœ‰æ”¶åˆ°ä»»ä½•ä¸­æ–­è¯·æ±‚ï¼š0 return Thread.interrupted() ? (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) : 0;&#125;//å°†å–æ¶ˆæ¡ä»¶ç­‰å¾…çš„ç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­final boolean transferAfterCancelledWait(Node node) &#123; //å¦‚æžœè¿™æ­¥CASæ“ä½œæˆåŠŸçš„è¯å°±è¡¨æ˜Žä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹å‰ if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) &#123; //çŠ¶æ€ä¿®æ”¹æˆåŠŸåŽå°±å°†è¯¥ç»“ç‚¹æ”¾å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ enq(node); return true; &#125; //åˆ°è¿™é‡Œè¡¨æ˜ŽCASæ“ä½œå¤±è´¥, è¯´æ˜Žä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹åŽ while (!isOnSyncQueue(node)) &#123; //å¦‚æžœsinalæ–¹æ³•è¿˜æ²¡æœ‰å°†ç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—, å°±é€šè¿‡è‡ªæ—‹ç­‰å¾…ä¸€ä¸‹ Thread.yield(); &#125; return false;&#125; åœ¨ä»¥ä¸Šä¸¤ä¸ªæ“ä½œå®Œæˆäº†ä¹‹åŽå°±ä¼šè¿›å…¥whileå¾ªçŽ¯ï¼Œå¯ä»¥çœ‹åˆ°whileå¾ªçŽ¯é‡Œé¢é¦–å…ˆè°ƒç”¨LockSupport.park(this)å°†çº¿ç¨‹æŒ‚èµ·äº†ï¼Œæ‰€ä»¥çº¿ç¨‹å°±ä¼šä¸€ç›´åœ¨è¿™é‡Œé˜»å¡žã€‚åœ¨è°ƒç”¨signalæ–¹æ³•åŽä»…ä»…åªæ˜¯å°†ç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­åŽ»ï¼Œè‡³äºŽä¼šä¸ä¼šå”¤é†’çº¿ç¨‹éœ€è¦çœ‹æƒ…å†µã€‚å¦‚æžœè½¬ç§»ç»“ç‚¹æ—¶å‘çŽ°åŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆï¼Œæˆ–è€…æ˜¯æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šç«‹å³å”¤é†’çº¿ç¨‹ï¼Œå¦åˆ™çš„è¯åœ¨signalæ–¹æ³•ç»“æŸæ—¶å°±ä¸ä¼šåŽ»å”¤é†’å·²åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰åˆ°å®ƒçš„å‰é©±ç»“ç‚¹æ¥å”¤é†’ã€‚å½“ç„¶ï¼Œçº¿ç¨‹é˜»å¡žåœ¨è¿™é‡Œé™¤äº†å¯ä»¥è°ƒç”¨signalæ–¹æ³•å”¤é†’ä¹‹å¤–ï¼Œçº¿ç¨‹è¿˜å¯ä»¥å“åº”ä¸­æ–­ï¼Œå¦‚æžœçº¿ç¨‹åœ¨è¿™é‡Œæ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¯ä»¥çœ‹åˆ°çº¿ç¨‹é†’æ¥åŽä¼šé©¬ä¸Šæ£€æŸ¥æ˜¯å¦æ˜¯ç”±äºŽä¸­æ–­å”¤é†’çš„è¿˜æ˜¯é€šè¿‡signalæ–¹æ³•å”¤é†’çš„ï¼Œå¦‚æžœæ˜¯å› ä¸ºä¸­æ–­å”¤é†’çš„åŒæ ·ä¼šå°†è¿™ä¸ªç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­åŽ»ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡è°ƒç”¨transferAfterCancelledWaitæ–¹æ³•æ¥å®žçŽ°çš„ã€‚æœ€åŽæ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åŽå°±ä¼šè¿”å›žä¸­æ–­æƒ…å†µå¹¶è·³å‡ºwhileå¾ªçŽ¯ã€‚ ç¬¬å››æ­¥ï¼šç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— 1234567891011121314151617181920212223//çº¿ç¨‹é†’æ¥åŽå°±ä¼šä»¥ç‹¬å æ¨¡å¼èŽ·å–é”if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) &#123; interruptMode = REINTERRUPT;&#125;//è¿™æ­¥æ“ä½œä¸»è¦ä¸ºé˜²æ­¢çº¿ç¨‹åœ¨signalä¹‹å‰ä¸­æ–­è€Œå¯¼è‡´æ²¡ä¸Žæ¡ä»¶é˜Ÿåˆ—æ–­ç»è”ç³»if (node.nextWaiter != null) &#123; unlinkCancelledWaiters();&#125;//æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç†if (interruptMode != 0) &#123; reportInterruptAfterWait(interruptMode);&#125;//ç»“æŸæ¡ä»¶ç­‰å¾…åŽæ ¹æ®ä¸­æ–­æƒ…å†µåšå‡ºç›¸åº”å¤„ç†private void reportInterruptAfterWait(int interruptMode) throws InterruptedException &#123; //å¦‚æžœä¸­æ–­æ¨¡å¼æ˜¯THROW_IEå°±æŠ›å‡ºå¼‚å¸¸ if (interruptMode == THROW_IE) &#123; throw new InterruptedException(); //å¦‚æžœä¸­æ–­æ¨¡å¼æ˜¯REINTERRUPTå°±è‡ªå·±æŒ‚èµ· &#125; else if (interruptMode == REINTERRUPT) &#123; selfInterrupt(); &#125;&#125; å½“çº¿ç¨‹ç»ˆæ­¢äº†whileå¾ªçŽ¯ä¹Ÿå°±æ˜¯æ¡ä»¶ç­‰å¾…åŽï¼Œå°±ä¼šå›žåˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ä¸ç®¡æ˜¯å› ä¸ºè°ƒç”¨signalæ–¹æ³•å›žåŽ»çš„è¿˜æ˜¯å› ä¸ºçº¿ç¨‹ä¸­æ–­å¯¼è‡´çš„ï¼Œç»“ç‚¹æœ€ç»ˆéƒ½ä¼šåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚è¿™æ—¶å°±ä¼šè°ƒç”¨acquireQueuedæ–¹æ³•æ‰§è¡Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èŽ·å–é”çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—å‡ºæ¥åŽåˆæ˜¯ä¹–ä¹–çš„èµ°ç‹¬å æ¨¡å¼ä¸‹èŽ·å–é”çš„é‚£ä¸€å¥—ï¼Œç­‰è¿™ä¸ªç»“ç‚¹å†æ¬¡èŽ·å¾—é”ä¹‹åŽï¼Œå°±ä¼šè°ƒç”¨reportInterruptAfterWaitæ–¹æ³•æ¥æ ¹æ®è¿™æœŸé—´çš„ä¸­æ–­æƒ…å†µåšå‡ºç›¸åº”çš„å“åº”ã€‚å¦‚æžœä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹å‰ï¼ŒinterruptModeå°±ä¸ºTHROW_IEï¼Œå†æ¬¡èŽ·å¾—é”åŽå°±æŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æžœä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹åŽï¼ŒinterruptModeå°±ä¸ºREINTERRUPTï¼Œå†æ¬¡èŽ·å¾—é”åŽå°±é‡æ–°ä¸­æ–­ã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223//ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…public final void awaitUninterruptibly() &#123; //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //å®Œå…¨é‡Šæ”¾é”å¹¶è¿”å›žå½“å‰åŒæ­¥çŠ¶æ€ int savedState = fullyRelease(node); boolean interrupted = false; //ç»“ç‚¹ä¸€ç›´åœ¨whileå¾ªçŽ¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾… while (!isOnSyncQueue(node)) &#123; //æ¡ä»¶é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ· LockSupport.park(this); //çº¿ç¨‹é†’æ¥å‘çŽ°ä¸­æ–­å¹¶ä¸ä¼šé©¬ä¸ŠåŽ»å“åº” if (Thread.interrupted()) &#123; interrupted = true; &#125; &#125; if (acquireQueued(node, savedState) || interrupted) &#123; //åœ¨è¿™é‡Œå“åº”æ‰€æœ‰ä¸­æ–­è¯·æ±‚, æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€å°±ä¼šå°†è‡ªå·±æŒ‚èµ· //1.çº¿ç¨‹åœ¨æ¡ä»¶ç­‰å¾…æ—¶æ”¶åˆ°ä¸­æ–­è¯·æ±‚ //2.çº¿ç¨‹åœ¨acquireQueuedæ–¹æ³•é‡Œæ”¶åˆ°ä¸­æ–­è¯·æ±‚ selfInterrupt(); &#125;&#125; è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(ä¸è¿›è¡Œè‡ªæ—‹) 123456789101112131415161718192021222324252627282930313233343536373839404142434445//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç›¸å¯¹æ—¶é—´), ä¸è¿›è¡Œè‡ªæ—‹ç­‰å¾…public final long awaitNanos(long nanosTimeout) throws InterruptedException &#123; //å¦‚æžœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); long lastTime = System.nanoTime(); int interruptMode = 0; while (!isOnSyncQueue(node)) &#123; //åˆ¤æ–­è¶…æ—¶æ—¶é—´æ˜¯å¦ç”¨å®Œäº† if (nanosTimeout &lt;= 0L) &#123; //å¦‚æžœå·²è¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ transferAfterCancelledWait(node); break; &#125; //å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, çº¿ç¨‹åœ¨è¿™æœŸé—´å¯èƒ½è¢«å”¤é†’, ä¹Ÿå¯èƒ½è‡ªå·±é†’æ¥ LockSupport.parkNanos(this, nanosTimeout); //çº¿ç¨‹é†’æ¥åŽå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) &#123; break; &#125; long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡åŽ»æ¡ä»¶ç­‰å¾…çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; &#125; //çº¿ç¨‹é†’æ¥åŽå°±ä¼šä»¥ç‹¬å æ¨¡å¼èŽ·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) &#123; interruptMode = REINTERRUPT; &#125; //ç”±äºŽtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) &#123; unlinkCancelledWaiters(); &#125; //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) &#123; reportInterruptAfterWait(interruptMode); &#125; //è¿”å›žå‰©ä½™æ—¶é—´ return nanosTimeout - (System.nanoTime() - lastTime);&#125; è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(è¿›è¡Œè‡ªæ—‹) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç›¸å¯¹æ—¶é—´), è¿›è¡Œè‡ªæ—‹ç­‰å¾…public final boolean await(long time, TimeUnit unit) throws InterruptedException &#123; if (unit == null) &#123; throw new NullPointerException(); &#125; //èŽ·å–è¶…æ—¶æ—¶é—´çš„æ¯«ç§’æ•° long nanosTimeout = unit.toNanos(time); //å¦‚æžœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //å°†å½“å‰çº¿ç¨‹æ·»åŠ æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); //èŽ·å–å½“å‰æ—¶é—´çš„æ¯«ç§’æ•° long lastTime = System.nanoTime(); boolean timedout = false; int interruptMode = 0; while (!isOnSyncQueue(node)) &#123; //å¦‚æžœè¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ if (nanosTimeout &lt;= 0L) &#123; timedout = transferAfterCancelledWait(node); break; &#125; //å¦‚æžœè¶…æ—¶æ—¶é—´å¤§äºŽè‡ªæ—‹æ—¶é—´, å°±å°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ if (nanosTimeout &gt;= spinForTimeoutThreshold) &#123; LockSupport.parkNanos(this, nanosTimeout); &#125; //çº¿ç¨‹é†’æ¥åŽå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) &#123; break; &#125; long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡åŽ»æ¡ä»¶ç­‰å¾…çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; &#125; //çº¿ç¨‹é†’æ¥åŽå°±ä¼šä»¥ç‹¬å æ¨¡å¼èŽ·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) &#123; interruptMode = REINTERRUPT; &#125; //ç”±äºŽtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) &#123; unlinkCancelledWaiters(); &#125; //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) &#123; reportInterruptAfterWait(interruptMode); &#125; //è¿”å›žæ˜¯å¦è¶…æ—¶æ ‡å¿— return !timedout;&#125; è®¾ç½®ç»å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223242526272829303132333435363738394041//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç»å¯¹æ—¶é—´)public final boolean awaitUntil(Date deadline) throws InterruptedException &#123; if (deadline == null) &#123; throw new NullPointerException(); &#125; //èŽ·å–ç»å¯¹æ—¶é—´çš„æ¯«ç§’æ•° long abstime = deadline.getTime(); //å¦‚æžœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); boolean timedout = false; int interruptMode = 0; while (!isOnSyncQueue(node)) &#123; //å¦‚æžœè¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ if (System.currentTimeMillis() &gt; abstime) &#123; timedout = transferAfterCancelledWait(node); break; &#125; //å°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, æœŸé—´çº¿ç¨‹å¯èƒ½è¢«å”¤é†’, ä¹Ÿå¯èƒ½åˆ°äº†ç‚¹è‡ªå·±é†’æ¥ LockSupport.parkUntil(this, abstime); //çº¿ç¨‹é†’æ¥åŽå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) &#123; break; &#125; &#125; //çº¿ç¨‹é†’æ¥åŽå°±ä¼šä»¥ç‹¬å æ¨¡å¼èŽ·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) &#123; interruptMode = REINTERRUPT; &#125; //ç”±äºŽtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) &#123; unlinkCancelledWaiters(); &#125; //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) &#123; reportInterruptAfterWait(interruptMode); &#125; //è¿”å›žæ˜¯å¦è¶…æ—¶æ ‡å¿— return !timedout;&#125; å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748//å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªç»“ç‚¹public final void signal() &#123; //åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ç‹¬å æ¨¡å¼æŒæœ‰é”ï¼Œå¦‚æžœä¸æ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (!isHeldExclusively()) &#123; throw new IllegalMonitorStateException(); &#125; //èŽ·å–æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ Node first = firstWaiter; //å¦‚æžœæ¡ä»¶é˜Ÿåˆ—ä¸­æœ‰æŽ’é˜Ÿè€… if (first != null) &#123; //å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ doSignal(first); &#125;&#125;//å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹private void doSignal(Node first) &#123; do &#123; //1.å°†firstWaiterå¼•ç”¨å‘åŽç§»åŠ¨ä¸€ä½ if ( (firstWaiter = first.nextWaiter) == null) &#123; lastWaiter = null; &#125; //2.å°†å¤´ç»“ç‚¹çš„åŽç»§ç»“ç‚¹å¼•ç”¨ç½®ç©º first.nextWaiter = null; //3.å°†å¤´ç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—, è½¬ç§»å®ŒæˆåŽæœ‰å¯èƒ½å”¤é†’çº¿ç¨‹ //4.å¦‚æžœtransferForSignalæ“ä½œå¤±è´¥å°±åŽ»å”¤é†’ä¸‹ä¸€ä¸ªç»“ç‚¹ &#125; while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null);&#125;//å°†æŒ‡å®šç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­final boolean transferForSignal(Node node) &#123; //å°†ç­‰å¾…çŠ¶æ€ä»ŽCONDITIONè®¾ç½®ä¸º0 if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) &#123; //å¦‚æžœæ›´æ–°çŠ¶æ€çš„æ“ä½œå¤±è´¥å°±ç›´æŽ¥è¿”å›žfalse //å¯èƒ½æ˜¯transferAfterCancelledWaitæ–¹æ³•å…ˆå°†çŠ¶æ€æ”¹å˜äº†, å¯¼è‡´è¿™æ­¥CASæ“ä½œå¤±è´¥ return false; &#125; //å°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œè¿”å›žå‰é©±ç»“ç‚¹ Node p = enq(node); int ws = p.waitStatus; if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) &#123; //å‡ºçŽ°ä»¥ä¸‹æƒ…å†µå°±ä¼šå”¤é†’å½“å‰çº¿ç¨‹ //1.å‰é©±ç»“ç‚¹æ˜¯å–æ¶ˆçŠ¶æ€ //2.æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALæ“ä½œå¤±è´¥ LockSupport.unpark(node.thread); &#125; return true;&#125; å¯ä»¥çœ‹åˆ°signalæ–¹æ³•æœ€ç»ˆçš„æ ¸å¿ƒå°±æ˜¯åŽ»è°ƒç”¨transferForSignalæ–¹æ³•ï¼Œåœ¨transferForSignalæ–¹æ³•ä¸­é¦–å…ˆä¼šç”¨CASæ“ä½œå°†ç»“ç‚¹çš„çŠ¶æ€ä»ŽCONDITIONè®¾ç½®ä¸º0ï¼Œç„¶åŽå†è°ƒç”¨enqæ–¹æ³•å°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚æˆ‘ä»¬å†çœ‹åˆ°æŽ¥ä¸‹æ¥çš„ifåˆ¤æ–­è¯­å¥ï¼Œè¿™ä¸ªåˆ¤æ–­è¯­å¥ä¸»è¦æ˜¯ç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™ä¼šåŽ»å”¤é†’çº¿ç¨‹ï¼Œå‡ºçŽ°è¿™ä¸¤ç§æƒ…å†µå°±ä¼šç«‹å³å”¤é†’çº¿ç¨‹ï¼Œä¸€ç§æ˜¯å½“å‘çŽ°å‰é©±ç»“ç‚¹çš„çŠ¶æ€æ˜¯å–æ¶ˆçŠ¶æ€æ—¶ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€å¤±è´¥æ—¶ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šé©¬ä¸ŠåŽ»å”¤é†’çº¿ç¨‹ï¼Œå¦åˆ™çš„è¯å°±ä»…ä»…åªæ˜¯å°†ç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å°±å®Œäº†ï¼Œè€Œä¸ä¼šç«‹é©¬åŽ»å”¤é†’ç»“ç‚¹ä¸­çš„çº¿ç¨‹ã€‚signalAllæ–¹æ³•ä¹Ÿå¤§è‡´ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒæ˜¯åŽ»å¾ªçŽ¯éåŽ†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ç»“ç‚¹ï¼Œå¹¶å°†å®ƒä»¬è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè½¬ç§»ç»“ç‚¹çš„æ–¹æ³•ä¹Ÿè¿˜æ˜¯è°ƒç”¨transferForSignalæ–¹æ³•ã€‚ å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ 1234567891011121314151617181920212223242526272829//å”¤é†’æ¡ä»¶é˜Ÿåˆ—åŽé¢çš„å…¨éƒ¨ç»“ç‚¹public final void signalAll() &#123; //åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é” if (!isHeldExclusively()) &#123; throw new IllegalMonitorStateException(); &#125; //èŽ·å–æ¡ä»¶é˜Ÿåˆ—å¤´ç»“ç‚¹ Node first = firstWaiter; if (first != null) &#123; //å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ doSignalAll(first); &#125;&#125;//å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹private void doSignalAll(Node first) &#123; //å…ˆæŠŠå¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„å¼•ç”¨ç½®ç©º lastWaiter = firstWaiter = null; do &#123; //å…ˆèŽ·å–åŽç»§ç»“ç‚¹çš„å¼•ç”¨ Node next = first.nextWaiter; //æŠŠå³å°†è½¬ç§»çš„ç»“ç‚¹çš„åŽç»§å¼•ç”¨ç½®ç©º first.nextWaiter = null; //å°†ç»“ç‚¹ä»Žæ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ— transferForSignal(first); //å°†å¼•ç”¨æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ first = next; &#125; while (first != null);&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æžä¹‹ç‹¬å æ¨¡å¼]]></title>
    <url>%2Fposts%2Ff8b27f2e.html</url>
    <content type="text"><![CDATA[AQSä¸ºåœ¨ç‹¬å æ¨¡å¼ä¸‹èŽ·å–é”åˆ†åˆ«æä¾›ä¸‰ç§èŽ·å–æ–¹å¼ï¼š ä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–; å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–; è®¾ç½®è¶…æ—¶æ—¶é—´èŽ·å–ã€‚ è¿™ä¸‰ç§æ–¹å¼æ•´ä½“æ­¥éª¤å¤§è‡´æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†ä¸åŒçš„åœ°æ–¹ï¼š ç¬¬ä¸€ç§åœ¨èŽ·å–æ—¶ä¼šå¿½ç•¥ä¸­æ–­; è€Œç¬¬äºŒç§åˆ™æ˜¯èŽ·å–æ—¶å“åº”ä¸­æ–­; ç¬¬ä¸‰ç§æ˜¯èŽ·å–æ—¶ï¼Œå¦‚æžœè¶…æ—¶åˆ™ç«‹å³è¿”å›žã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é” 123456//ä¸å“åº”ä¸­æ–­æ–¹å¼èŽ·å–(ç‹¬å æ¨¡å¼)public final void acquire(int arg) &#123; if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) &#123; selfInterrupt(); &#125;&#125; acquireæ–¹æ³•æ˜¯èŽ·å–é”çš„åŸºç¡€ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¿½ç•¥ä¸­æ–­ï¼Œæ„æ€æ˜¯è¯´å¦‚æžœèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ä¸­æ–­ï¼Œåˆ™acquire()æ–¹æ³•ä¼šå¿½ç•¥ï¼Œåªæœ‰ä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­è¿”å›žtrueæ‰æœ€ç»ˆè°ƒç”¨selfInterruptæ–¹æ³•å“åº”ä¸­æ–­ã€‚ä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒæŒ‰ç…§é¡ºåºæ‰§è¡Œäº†ä¸‹å›¾æ‰€ç¤ºçš„4ä¸ªæ­¥éª¤ã€‚ ç¬¬ä¸€æ­¥ï¼š!tryAcquire(arg) å°è¯•èŽ·å–èµ„æºstate 1234//å°è¯•èŽ·å–é”ï¼ˆç‹¬å æ¨¡å¼ï¼‰protected boolean tryAcquire(int arg) &#123; throw new UnsupportedOperationException();&#125; è¿™æ—¶å€™æ¥äº†ä¸€ä¸ªäººï¼Œä»–é¦–å…ˆå°è¯•ç€åŽ»æ•²äº†æ•²é—¨ï¼Œå¦‚æžœå‘çŽ°é—¨æ²¡é”(tryAcquire(arg)=true)ï¼Œé‚£å°±ç›´æŽ¥è¿›åŽ»äº†ã€‚å¦‚æžœå‘çŽ°é—¨é”äº†(tryAcquire(arg)=false)ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚è¿™ä¸ªtryAcquireæ–¹æ³•å†³å®šäº†ä»€ä¹ˆæ—¶å€™é”æ˜¯å¼€ç€çš„ï¼Œä»€ä¹ˆæ—¶å€™é”æ˜¯å…³é—­çš„ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»è¦è®©å­ç±»åŽ»è¦†ç›–ï¼Œé‡å†™é‡Œé¢çš„åˆ¤æ–­é€»è¾‘ã€‚ ç¬¬äºŒæ­¥ï¼šaddWaiter(Node.EXCLUSIVE) èŽ·å–èµ„æºå¤±è´¥ï¼Œåˆ™å°è£…æˆNodeç»“ç‚¹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445//å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹å¹¶æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨private Node addWaiter(Node mode) &#123; //æŒ‡å®šæŒæœ‰é”çš„æ¨¡å¼ Node node = new Node(Thread.currentThread(), mode); //èŽ·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node pred = tail; //å¦‚æžœå°¾ç»“ç‚¹ä¸ä¸ºç©º, è¡¨æ˜ŽåŒæ­¥é˜Ÿåˆ—å·²å­˜åœ¨ç»“ç‚¹ if (pred != null) &#123; //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = pred; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ï¼ˆç”±äºŽæ˜¯å¤šçº¿ç¨‹ï¼Œå¯èƒ½å¹¶å‘ä¿®æ”¹å°¾ç»“ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡CASä¿®æ”¹ï¼‰ if (compareAndSetTail(pred, node)) &#123; //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åŽç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ pred.next = node; return node; &#125; &#125; //å¦åˆ™è¡¨æ˜ŽåŒæ­¥é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œè¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ– enq(node); return node;&#125;//ç»“ç‚¹å…¥é˜Ÿæ“ä½œprivate Node enq(final Node node) &#123; for (;;) &#123; //èŽ·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node t = tail; //å¦‚æžœå°¾ç»“ç‚¹ä¸ºç©ºè¯´æ˜ŽåŒæ­¥é˜Ÿåˆ—è¿˜æ²¡æœ‰åˆå§‹åŒ– if (t == null) &#123; //åˆå§‹åŒ–åŒæ­¥é˜Ÿåˆ—ï¼ˆè°ƒç”¨æ— å‚æž„é€ å™¨åˆ›å»ºä¸€ä¸ªç»“ç‚¹ï¼Œç„¶åŽé€šè¿‡CASè®¾ç½®headç»“ç‚¹ï¼Œå¦‚æžœæˆåŠŸåˆ™å°†å¤´ç»“ç‚¹headèµ‹å€¼ç»™tailç»“ç‚¹ï¼‰ if (compareAndSetHead(new Node())) &#123; tail = head; &#125; &#125; else &#123; //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = t; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(t, node)) &#123; //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åŽç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ t.next = node; return t; &#125; &#125; &#125;&#125; æ‰§è¡Œåˆ°è¿™ä¸€æ­¥è¡¨æ˜Žç¬¬ä¸€æ¬¡èŽ·å–é”å¤±è´¥ï¼Œé‚£ä¹ˆè¿™ä¸ªäººå°±ç»™è‡ªå·±é¢†äº†å—å·ç ç‰Œè¿›å…¥æŽ’é˜ŸåŒºåŽ»æŽ’é˜Ÿäº†ï¼Œåœ¨é¢†å·ç ç‰Œçš„æ—¶å€™ä¼šå£°æ˜Žè‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥å ç”¨æˆ¿é—´(ç‹¬å æ¨¡å¼orå…±äº«æ¨¡å¼)ã€‚æ³¨æ„ï¼Œè¿™æ—¶å€™ä»–å¹¶æ²¡æœ‰åä¸‹æ¥ä¼‘æ¯(å°†è‡ªå·±æŒ‚èµ·)ã€‚ ç¬¬ä¸‰æ­¥ï¼šacquireQueued(addWaiter(Node.EXCLUSIVE), arg) åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èŽ·å–èµ„æºã€‚å…¶å®žè¿™ä¸ªæ–¹æ³•éžå¸¸çš„å¥½ç†è§£ï¼Œå‰é¢å·²ç»å°è¯•èŽ·å–èµ„æºï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå¹¶ä¸”åŠ åˆ°äº†åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œåœ¨ç­‰å¾…ä¸­å¯ä»¥åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯ä»¥ä¼‘æ¯ä»¥ä¸‹ï¼Œå¦‚æžœå¯ä»¥ä¼‘æ¯ï¼Œé‚£å°±ç­‰å¾…ç€å…¶ä»–çº¿ç¨‹å”¤é†’è‡ªå·±ï¼Œåœ¨ç»§ç»­èŽ·å–èµ„æºï¼Œç›´åˆ°æˆåŠŸæ‰è¿”å›žã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667//ä»¥ä¸å¯ä¸­æ–­æ–¹å¼èŽ·å–é”(ç‹¬å æ¨¡å¼)final boolean acquireQueued(final Node node, int arg) &#123; boolean failed = true; try &#123; //åˆ¤æ–­æ˜¯å¦ä¸­æ–­çš„æ ‡è®° boolean interrupted = false; //è‡ªæ—‹ for (;;) &#123; //èŽ·å–ç»™å®šç»“ç‚¹çš„å‰é©±ç»“ç‚¹çš„å¼•ç”¨ final Node p = node.predecessor(); //å¦‚æžœå½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹headï¼Œå°±å°è¯•åŽ»èŽ·å–é” if (p == head &amp;&amp; tryAcquire(arg)) &#123; //è¯´æ˜ŽèŽ·å–æˆåŠŸï¼Œå°†ç»™å®šç»“ç‚¹è®¾ç½®ä¸ºheadç»“ç‚¹ setHead(node); //ä¸ºäº†å¸®åŠ©åžƒåœ¾æ”¶é›†, å°†ä¸Šä¸€ä¸ªheadç»“ç‚¹çš„åŽç»§æ¸…ç©º p.next = null; //è®¾ç½®èŽ·å–æˆåŠŸçŠ¶æ€ failed = false; //è¿”å›žä¸­æ–­çš„çŠ¶æ€, æ•´ä¸ªå¾ªçŽ¯æ‰§è¡Œåˆ°è¿™é‡Œæ‰æ˜¯å‡ºå£ return interrupted; &#125; //å¦åˆ™è¯´æ˜Žé”çš„çŠ¶æ€è¿˜æ˜¯ä¸å¯èŽ·å–, è¿™æ—¶åˆ¤æ–­æ˜¯å¦å¯ä»¥æŒ‚èµ·å½“å‰çº¿ç¨‹ //ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼šå¦‚æžœèŽ·å–é”å¤±è´¥ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥ä¼‘æ¯ //ç¬¬äºŒä¸ªæ¡ä»¶ï¼šç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºtrueï¼Œè¯´æ˜Žè‡ªå·±å¯ä»¥ä¼‘æ¯äº†åˆ™è°ƒç”¨parkæ–¹æ³•ä¼‘æ¯ //å¦‚æžœåˆ¤æ–­ç»“æžœä¸ºçœŸåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹, å¦åˆ™ç»§ç»­å¾ªçŽ¯, åœ¨è¿™æœŸé—´çº¿ç¨‹ä¸å“åº”ä¸­æ–­ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) &#123; interrupted = true; &#125; &#125; &#125; finally &#123; //åœ¨æœ€åŽç¡®ä¿å¦‚æžœèŽ·å–å¤±è´¥å°±å–æ¶ˆèŽ·å– if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125;//åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†å½“å‰ç»“ç‚¹æŒ‚èµ·private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) &#123; //èŽ·å–å‰é©±ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = pred.waitStatus; //å¦‚æžœå‰é©±ç»“ç‚¹çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜Žå‰é©±ç»“ç‚¹ä¼šå”¤é†’å½“å‰ç»“ç‚¹, æ‰€ä»¥å½“å‰ç»“ç‚¹å¯ä»¥å®‰å¿ƒçš„æŒ‚èµ·äº† if (ws == Node.SIGNAL) &#123; return true; &#125; //èŠ‚ç‚¹çŠ¶æ€åªæœ‰CANCEL(-1)æ—¶æ‰å¤§äºŽ0ï¼Œè¯´æ˜Žè¿™ä¸ªèŠ‚ç‚¹å–æ¶ˆäº†ã€‚é‚£å°±éœ€è¦æŠŠå–æ¶ˆçš„èŠ‚ç‚¹ä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­ç§»é™¤æŽ‰ if (ws &gt; 0) &#123; //ä¸‹é¢çš„æ“ä½œæ˜¯æ¸…ç†åŒæ­¥é˜Ÿåˆ—ä¸­æ‰€æœ‰å·²å–æ¶ˆçš„å‰é©±ç»“ç‚¹ do &#123; node.prev = pred = pred.prev; &#125; while (pred.waitStatus &gt; 0); pred.next = node; &#125; else &#123; //åˆ°è¿™é‡Œè¡¨ç¤ºå‰é©±ç»“ç‚¹çŠ¶æ€ä¸æ˜¯SIGNALä¹Ÿä¸æ˜¯CANCEL, å¾ˆå¯èƒ½è¿˜æ˜¯ç­‰äºŽ0, è¿™æ ·çš„è¯å‰é©±ç»“ç‚¹å°±ä¸ä¼šåŽ»å”¤é†’å½“å‰ç»“ç‚¹äº† //æ‰€ä»¥å½“å‰ç»“ç‚¹å¿…é¡»è¦ç¡®ä¿å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALæ‰èƒ½å®‰å¿ƒçš„æŒ‚èµ·è‡ªå·± compareAndSetWaitStatus(pred, ws, Node.SIGNAL); &#125; return false;&#125;//æŒ‚èµ·å½“å‰çº¿ç¨‹private final boolean parkAndCheckInterrupt() &#123; //æŒ‚èµ·å½“å‰çº¿ç¨‹ LockSupport.park(this); //è¿”å›žå½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­è¿‡ return Thread.interrupted();&#125; é¢†å®Œå·ç ç‰Œè¿›å…¥æŽ’é˜ŸåŒºåŽå°±ä¼šç«‹é©¬æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªç»“ç‚¹é¦–æ¬¡è¿›å…¥æŽ’é˜ŸåŒºåŽæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å‘çŽ°ä»–å‰é¢çš„é‚£ä¸ªäººå·²ç»ç¦»å¼€åº§ä½è¿›å…¥æˆ¿é—´äº†ï¼Œé‚£ä»–å°±ä¸åä¸‹æ¥ä¼‘æ¯äº†ï¼Œä¼šå†æ¬¡åŽ»æ•²ä¸€æ•²é—¨çœ‹çœ‹é‚£å°å­æœ‰æ²¡æœ‰å®Œäº‹ã€‚å¦‚æžœé‡Œé¢çš„äººåˆšå¥½å®Œäº‹å‡ºæ¥äº†ï¼Œéƒ½ä¸ç”¨ä»–å«è‡ªå·±å°±ç›´æŽ¥å†²è¿›åŽ»äº†ã€‚å¦åˆ™ï¼Œå°±è¦è€ƒè™‘åä¸‹æ¥ä¼‘æ¯ä¸€ä¼šå„¿äº†ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯ä¸æ”¾å¿ƒï¼Œå¦‚æžœä»–åä¸‹æ¥ç¡ç€åŽæ²¡äººæé†’ä»–æ€Žä¹ˆåŠžï¼Ÿä»–å°±åœ¨å‰é¢é‚£äººçš„åº§ä½ä¸Šç•™ä¸€ä¸ªå°çº¸æ¡ï¼Œå¥½è®©ä»Žé‡Œé¢å‡ºæ¥çš„äººçœ‹åˆ°çº¸æ¡åŽèƒ½å¤Ÿå”¤é†’ä»–ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“ä»–è¿›å…¥æŽ’é˜ŸåŒºåŽå‘çŽ°å‰é¢è¿˜æœ‰å¥½å‡ ä¸ªäººåœ¨åº§ä½ä¸ŠæŽ’é˜Ÿå‘¢ï¼Œé‚£ä»–å°±å¯ä»¥å®‰å¿ƒçš„åä¸‹æ¥å’ªä¸€ä¼šå„¿äº†ï¼Œä½†åœ¨æ­¤ä¹‹å‰ä»–è¿˜æ˜¯ä¼šåœ¨å‰é¢é‚£äºº(æ­¤æ—¶å·²ç»ç¡ç€äº†)çš„åº§ä½ä¸Šç•™ä¸€ä¸ªçº¸æ¡ï¼Œå¥½è®©è¿™ä¸ªäººåœ¨èµ°ä¹‹å‰èƒ½å¤ŸåŽ»å”¤é†’è‡ªå·±ã€‚å½“ä¸€åˆ‡äº‹æƒ…åŠžå¦¥äº†ä¹‹åŽï¼Œä»–å°±å®‰å®‰å¿ƒå¿ƒçš„ç¡è§‰äº†ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬çœ‹åˆ°æ•´ä¸ªforå¾ªçŽ¯å°±åªæœ‰ä¸€ä¸ªå‡ºå£ï¼Œé‚£å°±æ˜¯ç­‰çº¿ç¨‹æˆåŠŸçš„èŽ·å–åˆ°é”ä¹‹åŽæ‰èƒ½å‡ºåŽ»ï¼Œåœ¨æ²¡æœ‰èŽ·å–åˆ°é”ä¹‹å‰å°±ä¸€ç›´æ˜¯æŒ‚åœ¨forå¾ªçŽ¯çš„parkAndCheckInterrupt()æ–¹æ³•é‡Œå¤´ã€‚çº¿ç¨‹è¢«å”¤é†’åŽä¹Ÿæ˜¯ä»Žè¿™ä¸ªåœ°æ–¹ç»§ç»­æ‰§è¡Œforå¾ªçŽ¯ã€‚ ç¬¬å››æ­¥ï¼šselfInterrupt() 1234//å½“å‰çº¿ç¨‹å°†è‡ªå·±ä¸­æ–­private static void selfInterrupt() &#123; Thread.currentThread().interrupt();&#125; ç”±äºŽä¸Šé¢æ•´ä¸ªçº¿ç¨‹ä¸€ç›´æ˜¯æŒ‚åœ¨forå¾ªçŽ¯çš„parkAndCheckInterrupt()æ–¹æ³•é‡Œå¤´ï¼Œæ²¡æœ‰æˆåŠŸèŽ·å–åˆ°é”ä¹‹å‰ä¸å“åº”ä»»ä½•å½¢å¼çš„çº¿ç¨‹ä¸­æ–­ï¼Œåªæœ‰å½“çº¿ç¨‹æˆåŠŸèŽ·å–åˆ°é”å¹¶ä»Žforå¾ªçŽ¯å‡ºæ¥åŽï¼Œä»–æ‰ä¼šæŸ¥çœ‹åœ¨è¿™æœŸé—´æ˜¯å¦æœ‰äººè¦æ±‚ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æžœæ˜¯çš„è¯å†åŽ»è°ƒç”¨selfInterrupt()æ–¹æ³•å°†è‡ªå·±æŒ‚èµ·ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é” 123456789 public final void acquireInterruptibly(int arg) throws InterruptedException &#123; //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­è¿‡ï¼Œå¦‚æžœè¢«ä¸­æ–­åˆ™ç›´æŽ¥æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); //å¦‚æžœæ²¡æœ‰è¢«ä¸­æ–­è¿‡ï¼Œåˆ™å°è¯•èŽ·å–èµ„æº if (!tryAcquire(arg)) //è¯´æ˜ŽèŽ·å–èµ„æºå¤±è´¥ï¼Œåˆ™éœ€è¦åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èŽ·å–èµ„æº doAcquireInterruptibly(arg);&#125; 1234567891011121314151617181920212223242526272829//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(ç‹¬å æ¨¡å¼)private void doAcquireInterruptibly(int arg) throws InterruptedException &#123; //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try &#123; for (;;) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æžœpæ˜¯headç»“ç‚¹, é‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å†æ¬¡å°è¯•èŽ·å–é” if (p == head &amp;&amp; tryAcquire(arg)) &#123; setHead(node); p.next = null; // help GC failed = false; //èŽ·å–é”æˆåŠŸåŽè¿”å›ž return; &#125; //å¦‚æžœæ»¡è¶³æ¡ä»¶å°±æŒ‚èµ·å½“å‰çº¿ç¨‹, æ­¤æ—¶å“åº”ä¸­æ–­å¹¶æŠ›å‡ºå¼‚å¸¸ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) &#123; //çº¿ç¨‹è¢«å”¤é†’åŽå¦‚æžœå‘çŽ°ä¸­æ–­è¯·æ±‚å°±æŠ›å‡ºå¼‚å¸¸ throw new InterruptedException(); &#125; &#125; &#125; finally &#123; if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125; å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼å’Œä¸å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼èŽ·å–é”æµç¨‹ä¸Šå¤§è‡´ä¸Šæ˜¯ç›¸åŒçš„ã€‚å”¯ä¸€çš„ä¸€ç‚¹åŒºåˆ«å°±æ˜¯çº¿ç¨‹ä»ŽparkAndCheckInterruptæ–¹æ³•ä¸­é†’æ¥åŽä¼šæ£€æŸ¥çº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œå¦‚æžœæ˜¯çš„è¯å°±æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè€Œä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”æ˜¯åœ¨æ”¶åˆ°ä¸­æ–­è¯·æ±‚åŽåªæ˜¯è®¾ç½®ä¸€ä¸‹ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸ä¼šç«‹é©¬ç»“æŸå½“å‰èŽ·å–é”çš„æ–¹æ³•ï¼Œä¸€ç›´åˆ°ç»“ç‚¹æˆåŠŸèŽ·å–åˆ°é”ä¹‹åŽæ‰ä¼šæ ¹æ®ä¸­æ–­çŠ¶æ€å†³å®šæ˜¯å¦å°†è‡ªå·±æŒ‚èµ·ã€‚ è®¾ç½®è¶…æ—¶æ—¶é—´èŽ·å–é” 12345678public final boolean tryAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; ////åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¦‚æžœä¸­æ–­è¿‡ç›´æŽ¥æŠ›å¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); ////å°è¯•èŽ·å–èµ„æºï¼Œå¦‚æžœå¤±è´¥æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä»ŽåŒæ­¥é˜Ÿåˆ—ä¸­èŽ·å–èµ„æº return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout);&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142434445//ä»¥é™å®šè¶…æ—¶æ—¶é—´èŽ·å–é”(ç‹¬å æ¨¡å¼)private boolean doAcquireNanos(int arg, long nanosTimeout) throws InterruptedException &#123; //èŽ·å–ç³»ç»Ÿå½“å‰æ—¶é—´ long lastTime = System.nanoTime(); //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try &#123; for (;;) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æžœå‰é©±æ˜¯headç»“ç‚¹, é‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å†æ¬¡å°è¯•èŽ·å–é” if (p == head &amp;&amp; tryAcquire(arg)) &#123; //æ›´æ–°headç»“ç‚¹ setHead(node); p.next = null; failed = false; return true; &#125; //è¶…æ—¶æ—¶é—´ç”¨å®Œäº†å°±ç›´æŽ¥é€€å‡ºå¾ªçŽ¯ if (nanosTimeout &lt;= 0) &#123; return false; &#125; //å¦‚æžœè¶…æ—¶æ—¶é—´å¤§äºŽè‡ªæ—‹æ—¶é—´, é‚£ä¹ˆç­‰åˆ¤æ–­å¯ä»¥æŒ‚èµ·çº¿ç¨‹ä¹‹åŽå°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) &#123; //å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, ä¹‹åŽå†è‡ªå·±é†’æ¥ LockSupport.parkNanos(this, nanosTimeout); &#125; //èŽ·å–ç³»ç»Ÿå½“å‰æ—¶é—´ long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡éƒ½å‡åŽ»èŽ·å–é”çš„æ—¶é—´é—´éš” nanosTimeout -= now - lastTime; //å†æ¬¡æ›´æ–°lastTime lastTime = now; //åœ¨èŽ·å–é”çš„æœŸé—´æ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; &#125; &#125; finally &#123; if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125; è®¾ç½®è¶…æ—¶æ—¶é—´èŽ·å–é¦–å…ˆä¼šåŽ»èŽ·å–ä¸€ä¸‹é”ï¼Œç¬¬ä¸€æ¬¡èŽ·å–é”å¤±è´¥åŽä¼šæ ¹æ®æƒ…å†µï¼Œå¦‚æžœä¼ å…¥çš„è¶…æ—¶æ—¶é—´å¤§äºŽè‡ªæ—‹æ—¶é—´é‚£ä¹ˆå°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œå¦åˆ™çš„è¯å°±ä¼šè¿›è¡Œè‡ªæ—‹ï¼Œæ¯æ¬¡èŽ·å–é”ä¹‹åŽéƒ½ä¼šå°†è¶…æ—¶æ—¶é—´å‡åŽ»èŽ·å–ä¸€æ¬¡é”æ‰€ç”¨çš„æ—¶é—´ã€‚ä¸€ç›´åˆ°è¶…æ—¶æ—¶é—´å°äºŽ0ä¹Ÿå°±è¯´æ˜Žè¶…æ—¶æ—¶é—´ç”¨å®Œäº†ï¼Œé‚£ä¹ˆè¿™æ—¶å°±ä¼šç»“æŸèŽ·å–é”çš„æ“ä½œç„¶åŽè¿”å›žèŽ·å–å¤±è´¥æ ‡å¿—ã€‚æ³¨æ„åœ¨ä»¥è¶…æ—¶æ—¶é—´èŽ·å–é”çš„è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥å“åº”çº¿ç¨‹ä¸­æ–­è¯·æ±‚çš„ã€‚ ç‹¬å æ¨¡å¼ä¸‹é‡Šæ”¾é” 1234567891011121314151617181920212223242526272829303132333435363738394041//é‡Šæ”¾é”çš„æ“ä½œ(ç‹¬å æ¨¡å¼)public final boolean release(int arg) &#123; //å°è¯•é‡Šæ”¾ï¼ˆè¯¥æ–¹æ³•éœ€è¦å­ç±»åŽ»å®žçŽ°ï¼‰ if (tryRelease(arg)) &#123; //å°è¯•æˆåŠŸï¼ŒèŽ·å–headç»“ç‚¹ Node h = head; //å¦‚æžœheadç»“ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”ç­‰å¾…çŠ¶æ€ä¸ç­‰äºŽ0å°±åŽ»å”¤é†’åŽç»§ç»“ç‚¹ if (h != null &amp;&amp; h.waitStatus != 0) &#123; //å”¤é†’åŽç»§ç»“ç‚¹ unparkSuccessor(h); &#125; return true; &#125; return false;&#125;//å”¤é†’åŽç»§ç»“ç‚¹private void unparkSuccessor(Node node) &#123; //èŽ·å–ç»™å®šç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = node.waitStatus; //å¦‚æžœçŠ¶æ€å°äºŽ0ï¼Œé€šè¿‡CASå°†çŠ¶æ€æ›´æ–°ä¸º0ï¼Œå› ä¸ºæ­¤æ—¶ç»™å®šçš„ç»“ç‚¹é‡Šæ”¾èµ„æº if (ws &lt; 0) &#123; compareAndSetWaitStatus(node, ws, 0); &#125; //èŽ·å–ç»™å®šç»“ç‚¹çš„åŽç»§ç»“ç‚¹ï¼Œå³ä¸‹ä¸€ä¸ªéœ€è¦è¢«å”¤é†’çš„ç»“ç‚¹ Node s = node.next; //åŽç»§ç»“ç‚¹ä¸ºç©ºæˆ–è€…ç­‰å¾…çŠ¶æ€ä¸ºå–æ¶ˆçŠ¶æ€ if (s == null || s.waitStatus &gt; 0) &#123; s = null; //ä»ŽåŽå‘å‰éåŽ†é˜Ÿåˆ—æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ˜¯å–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) &#123; if (t.waitStatus &lt;= 0) &#123; s = t; &#125; &#125; &#125; //å”¤é†’ç»™å®šç»“ç‚¹åŽé¢é¦–ä¸ªä¸æ˜¯å–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ if (s != null) &#123; LockSupport.unpark(s.thread); &#125;&#125; çº¿ç¨‹æŒæœ‰é”è¿›å…¥æˆ¿é—´åŽå°±ä¼šåŽ»åŠžè‡ªå·±çš„äº‹æƒ…ï¼Œç­‰äº‹æƒ…åŠžå®ŒåŽå®ƒå°±ä¼šé‡Šæ”¾é”å¹¶ç¦»å¼€æˆ¿é—´ã€‚é€šè¿‡tryReleaseæ–¹æ³•å¯ä»¥æ‹¨åŠ¨å¯†ç é”è¿›è¡Œè§£é”ï¼ŒtryReleaseæ–¹æ³•æ˜¯éœ€è¦è®©å­ç±»åŽ»è¦†ç›–çš„ï¼Œä¸åŒçš„å­ç±»å®žçŽ°çš„è§„åˆ™ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„å­ç±»è®¾ç½®çš„å¯†ç ä¸ä¸€æ ·ã€‚ åƒåœ¨ReentrantLockå½“ä¸­ï¼Œæˆ¿é—´é‡Œé¢çš„äººæ¯è°ƒç”¨tryReleaseæ–¹æ³•ä¸€æ¬¡ï¼Œstateå°±å‡1ï¼Œç›´åˆ°stateå‡åˆ°0çš„æ—¶å€™å¯†ç é”å°±å¼€äº†ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒåœ¨ä¸åœçš„è½¬åŠ¨å¯†ç é”çš„è½¬è½®ï¼Œè€Œæ¯æ¬¡è½¬åŠ¨è½¬è½®æ•°å­—åªæ˜¯å‡å°‘1ã€‚ CountDownLatchå’Œè¿™ä¸ªä¹Ÿæœ‰ç‚¹ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒä¸æ˜¯ä¸€ä¸ªäººåœ¨è½¬ï¼Œè€Œæ˜¯å¤šä¸ªäººæ¯äººéƒ½åŽ»è½¬ä¸€ä¸‹ï¼Œé›†ä¸­å¤§å®¶çš„åŠ›é‡æŠŠé”ç»™å¼€äº†ã€‚ çº¿ç¨‹å‡ºäº†æˆ¿é—´åŽå®ƒä¼šæ‰¾åˆ°è‡ªå·±åŽŸå…ˆçš„åº§ä½ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°headç»“ç‚¹ã€‚çœ‹çœ‹åº§ä½ä¸Šæœ‰æ²¡æœ‰äººç»™å®ƒç•™äº†å°çº¸æ¡ï¼Œå¦‚æžœæœ‰çš„è¯å®ƒå°±çŸ¥é“æœ‰äººç¡ç€äº†éœ€è¦è®©å®ƒå¸®å¿™å”¤é†’ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šåŽ»å”¤é†’é‚£ä¸ªçº¿ç¨‹ã€‚å¦‚æžœæ²¡æœ‰çš„è¯å°±è¡¨æ˜ŽåŒæ­¥é˜Ÿåˆ—ä¸­æš‚æ—¶è¿˜æ²¡æœ‰äººåœ¨ç­‰å¾…ï¼Œä¹Ÿæ²¡æœ‰äººéœ€è¦å®ƒå”¤é†’ï¼Œæ‰€ä»¥å®ƒå°±å¯ä»¥å®‰å¿ƒçš„ç¦»åŽ»äº†ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æžä¹‹å…±äº«æ¨¡å¼]]></title>
    <url>%2Fposts%2Fedbda32.html</url>
    <content type="text"><![CDATA[AQSä¸ºåœ¨å…±äº«æ¨¡å¼ä¸‹èŽ·å–é”åˆ†åˆ«æä¾›ä¸‰ç§èŽ·å–æ–¹å¼ï¼š ä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–; å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–; è®¾ç½®è¶…æ—¶æ—¶é—´èŽ·å–ã€‚ è¿™ä¸‰ç§æ–¹å¼æ•´ä½“æ­¥éª¤å¤§è‡´æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†ä¸åŒçš„åœ°æ–¹ï¼š ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹åœ¨èŽ·å–èµ„æºæ—¶è¢«ä¸­æ–­äº†ï¼Œå®ƒä¼šå¿½ç•¥è¿™ä¸ªä¸­æ–­ï¼Œå½“èŽ·å–èµ„æºè¿”å›žåŽæ‰å¯¹ä¸­æ–­è¿›è¡Œå¤„ç†; ç¬¬äºŒç§æ–¹å¼åˆ™ä¸åŒï¼Œå¦‚æžœå½“å‰çº¿ç¨‹èŽ·å–èµ„æºæ—¶è¢«ä¸­æ–­ï¼Œå®ƒä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸; ç¬¬ä¸‰ç§æ–¹å¼åœ¨ä¸­æ–­çš„åŸºç¡€ä¸Šæ·»åŠ äº†è¶…æ—¶è¿”å›žçš„åŠŸèƒ½ã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„èŽ·å– 12345678910111213141516//ä»¥ä¸å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(å…±äº«æ¨¡å¼)public final void acquireShared(int arg) &#123; //1.å°è¯•åŽ»èŽ·å–é”ï¼Œå¦‚æžœèŽ·å–æˆåŠŸï¼Œåˆ™æµç¨‹ç»“æŸ if (tryAcquireShared(arg) &lt; 0) &#123; //2.å¦‚æžœèŽ·å–å¤±è´¥å°±è¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼šå°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeç»“ç‚¹æ”¾å…¥åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨å¹¶æŒ‰ç…§æ¡ä»¶åˆ¤æ–­æ˜¯å¦æŒ‚èµ·ï¼Œç­‰å¾…è¢«å”¤é†’ doAcquireShared(arg); &#125;&#125;//å°è¯•åŽ»èŽ·å–é”(å…±äº«æ¨¡å¼ï¼Œè¯¥æ–¹æ³•éœ€è¦å­ç±»åŽ»å®žçŽ°ï¼Œè¿”å›žå€¼éœ€è¦éµå¾ªä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰)//è´Ÿæ•°ï¼šè¡¨ç¤ºèŽ·å–å¤±è´¥//é›¶å€¼ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹èŽ·å–æˆåŠŸ, ä½†æ˜¯åŽç»§ç»“ç‚¹ä¸èƒ½å†èŽ·å–äº†//æ­£æ•°ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹èŽ·å–æˆåŠŸ, å¹¶ä¸”åŽç»§ç»“ç‚¹åŒæ ·å¯ä»¥èŽ·å–æˆåŠŸprotected int tryAcquireShared(int arg) &#123; throw new UnsupportedOperationException();&#125; è°ƒç”¨acquireSharedæ–¹æ³•æ˜¯ä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”çš„æ–¹å¼ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨tryAcquireSharedåŽ»å°è¯•èŽ·å–é”ï¼ŒtryAcquireSharedæ–¹æ³•è¿”å›žä¸€ä¸ªèŽ·å–é”çš„çŠ¶æ€ï¼Œè¿™é‡ŒAQSè§„å®šäº†è¿”å›žçŠ¶æ€è‹¥æ˜¯è´Ÿæ•°ä»£è¡¨å½“å‰ç»“ç‚¹èŽ·å–é”å¤±è´¥ï¼Œè‹¥æ˜¯0ä»£è¡¨å½“å‰ç»“ç‚¹èŽ·å–é”æˆåŠŸï¼Œä½†åŽç»§ç»“ç‚¹ä¸èƒ½å†èŽ·å–äº†ï¼Œè‹¥æ˜¯æ­£æ•°åˆ™ä»£è¡¨å½“å‰ç»“ç‚¹èŽ·å–é”æˆåŠŸï¼Œå¹¶ä¸”è¿™ä¸ªé”åŽç»­ç»“ç‚¹ä¹ŸåŒæ ·å¯ä»¥èŽ·å–æˆåŠŸã€‚å­ç±»åœ¨å®žçŽ°tryAcquireSharedæ–¹æ³•èŽ·å–é”çš„é€»è¾‘æ—¶ï¼Œè¿”å›žå€¼éœ€è¦éµå®ˆè¿™ä¸ªçº¦å®šã€‚å¦‚æžœè°ƒç”¨tryAcquireSharedçš„è¿”å›žå€¼å°äºŽ0ï¼Œå°±ä»£è¡¨è¿™æ¬¡å°è¯•èŽ·å–é”å¤±è´¥äº†ï¼ŒæŽ¥ä¸‹æ¥å°±è°ƒç”¨doAcquireSharedæ–¹æ³•å°†å½“å‰çº¿ç¨‹æ·»åŠ è¿›åŒæ­¥é˜Ÿåˆ—ã€‚ä¸‹é¢çœ‹ä¸‹doAcquireSharedæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344//åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­èŽ·å–(å…±äº«æ¨¡å¼)private void doAcquireShared(int arg) &#123; //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆSHAREDå…±äº«æ¨¡å¼çš„ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.SHARED); //æ˜¯å¦èŽ·å–å¤±è´¥ boolean failed = true; try &#123; //æ˜¯å¦ä¸­æ–­ boolean interrupted = false; //è‡ªæ—‹ï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿå°è¯•èŽ·å–èµ„æºï¼Œä»€ä¹ˆæ—¶å€™èƒ½å¤ŸæŒ‚èµ· for (;;) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æžœå‰é©±ç»“ç‚¹ä¸ºheadç»“ç‚¹å°±å†æ¬¡å°è¯•åŽ»èŽ·å–é” if (p == head) &#123; //å†æ¬¡å°è¯•åŽ»èŽ·å–é”å¹¶è¿”å›žèŽ·å–çŠ¶æ€ //r &lt; 0, è¡¨ç¤ºèŽ·å–å¤±è´¥ //r = 0, è¡¨ç¤ºå½“å‰ç»“ç‚¹èŽ·å–æˆåŠŸ, ä½†æ˜¯åŽç»§ç»“ç‚¹ä¸èƒ½å†èŽ·å–äº† //r &gt; 0, è¡¨ç¤ºå½“å‰ç»“ç‚¹èŽ·å–æˆåŠŸ, å¹¶ä¸”åŽç»§ç»“ç‚¹åŒæ ·å¯ä»¥èŽ·å–æˆåŠŸ int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; //åˆ°è¿™é‡Œè¯´æ˜Žå½“å‰ç»“ç‚¹å·²ç»èŽ·å–é”æˆåŠŸäº†, æ­¤æ—¶å®ƒä¼šå°†é”çš„çŠ¶æ€ä¿¡æ¯ä¼ æ’­ç»™åŽç»§ç»“ç‚¹ setHeadAndPropagate(node, r); //å¸®åŠ©åžƒåœ¾å›žæ”¶ p.next = null; //å¦‚æžœåœ¨çº¿ç¨‹é˜»å¡žæœŸé—´æ”¶åˆ°ä¸­æ–­è¯·æ±‚, å°±åœ¨è¿™ä¸€æ­¥å“åº”è¯¥è¯·æ±‚ if (interrupted) &#123; selfInterrupt(); &#125; failed = false; return; &#125; &#125; //æ¯æ¬¡èŽ·å–é”å¤±è´¥åŽéƒ½ä¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥å°†çº¿ç¨‹æŒ‚èµ·, å¦‚æžœå¯ä»¥çš„è¯å°±ä¼šåœ¨parkAndCheckInterruptæ–¹æ³•é‡Œå°†çº¿ç¨‹æŒ‚èµ· if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) &#123; interrupted = true; &#125; &#125; &#125; finally &#123; if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125; è¿›å…¥doAcquireSharedæ–¹æ³•é¦–å…ˆæ˜¯è°ƒç”¨addWaiteræ–¹æ³•å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ”¾åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚è¿™ä¸ªæ·»åŠ ç»“ç‚¹çš„è¿‡ç¨‹è·Ÿç‹¬å æ¨¡å¼æ˜¯ä¸€æ ·çš„ã€‚ ç»“ç‚¹è¿›å…¥åŒæ­¥é˜Ÿåˆ—åŽï¼Œå¦‚æžœå®ƒå‘çŽ°åœ¨å®ƒå‰é¢çš„ç»“ç‚¹å°±æ˜¯headç»“ç‚¹ï¼Œå› ä¸ºheadç»“ç‚¹çš„çº¿ç¨‹å·²ç»èŽ·å–é”è¿›å…¥æˆ¿é—´é‡Œé¢äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªèŽ·å–é”çš„ç»“ç‚¹å°±è½®åˆ°è‡ªå·±äº†ï¼Œæ‰€ä»¥å½“å‰ç»“ç‚¹å…ˆä¸ä¼šå°†è‡ªå·±æŒ‚èµ·ï¼Œè€Œæ˜¯å†ä¸€æ¬¡åŽ»å°è¯•èŽ·å–é”ï¼Œå¦‚æžœå‰é¢é‚£äººåˆšå¥½é‡Šæ”¾é”ç¦»å¼€äº†ï¼Œé‚£ä¹ˆå½“å‰ç»“ç‚¹å°±èƒ½æˆåŠŸèŽ·å¾—é”ï¼Œå¦‚æžœå‰é¢é‚£äººè¿˜æ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨shouldParkAfterFailedAcquireæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šå°†headç»“ç‚¹çš„çŠ¶æ€æ”¹ä¸ºSIGNALï¼Œåªæœ‰ä¿è¯å‰é¢ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALï¼Œå½“å‰ç»“ç‚¹æ‰èƒ½æ”¾å¿ƒçš„å°†è‡ªå·±æŒ‚èµ·ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šåœ¨parkAndCheckInterruptæ–¹æ³•é‡Œé¢è¢«æŒ‚èµ·ã€‚å¦‚æžœå½“å‰ç»“ç‚¹æ°å·§æˆåŠŸçš„èŽ·å–äº†é”ï¼Œé‚£ä¹ˆæŽ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨setHeadAndPropagateæ–¹æ³•å°†è‡ªå·±è®¾ç½®ä¸ºheadç»“ç‚¹ï¼Œå¹¶ä¸”å”¤é†’åŽé¢åŒæ ·æ˜¯å…±äº«æ¨¡å¼çš„ç»“ç‚¹ã€‚ä¸‹é¢çœ‹ä¸‹setHeadAndPropagateæ–¹æ³•å…·ä½“çš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//è®¾ç½®headç»“ç‚¹å¹¶ä¼ æ’­é”çš„çŠ¶æ€(å…±äº«æ¨¡å¼)private void setHeadAndPropagate(Node node, int propagate) &#123; //èŽ·å–å½“å‰çš„å¤´ç»“ç‚¹ Node h = head; //å°†ç»™å®šçš„æˆåŠŸèŽ·å–èµ„æºçš„ç»“ç‚¹è®¾ç½®ä¸ºheadç»“ç‚¹ setHead(node); //æœ‰5ä¸ªæ¡ä»¶ï¼š //ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼špropagate&gt;0:è¿™ä¸ªå€¼æ˜¯é€šè¿‡è°ƒç”¨tryAcquireShared()èŽ·å–çš„ï¼Œè¡¨ç¤ºå‰©ä½™çš„èµ„æºï¼Œä¸Šé¢è¯´äº†state&gt;0è¡¨ç¤ºèŽ·å–èµ„æºæˆåŠŸï¼Œä¸”è¿˜æœ‰å‰©ä½™çš„èµ„æºã€‚ //ç¬¬äºŒä¸ªæ¡ä»¶ï¼šh==nullï¼šè¡¨ç¤ºè€çš„å¤´ç»“ç‚¹headçš„å¼•ç”¨ä¸ºnullã€‚ //ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼šh.waitStatus&lt;0ï¼šè€çš„å¤´ç»“ç‚¹headçš„èŠ‚ç‚¹çŠ¶æ€ï¼Œæœ‰ä¸¤ç§å–å€¼å¯èƒ½ï¼šSIGNAL(-1)å’ŒPROPAGATE(-3)ã€‚ //ç¬¬å››ä¸ªæ¡ä»¶ï¼š(h=head)==null //ç¬¬äº”ä¸ªæ¡ä»¶ï¼šh.waitStatus&lt;0ï¼šæ–°è®¾ç½®çš„å¤´ç»“ç‚¹headçš„èŠ‚ç‚¹çŠ¶æ€ï¼Œæœ‰ä¸¤ç§å–å€¼å¯èƒ½ï¼šSIGNAL(-1)å’ŒPROPAGATE(-3)ã€‚ if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) &#123; //èŽ·å–ç»™å®šç»“ç‚¹çš„åŽç»§ç»“ç‚¹ Node s = node.next; //å¦‚æžœç»™å®šç»“ç‚¹çš„åŽç»§ç»“ç‚¹ä¸ºç©º, æˆ–è€…å®ƒçš„çŠ¶æ€æ˜¯å…±äº«çŠ¶æ€ if (s == null || s.isShared()) &#123; //å”¤é†’åŽç»§ç»“ç‚¹ doReleaseShared(); &#125; &#125;&#125;//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)private void doReleaseShared() &#123; for (;;) &#123; //èŽ·å–åŒæ­¥é˜Ÿåˆ—çš„headç»“ç‚¹ Node h = head; if (h != null &amp;&amp; h != tail) &#123; //èŽ·å–headç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = h.waitStatus; //å¦‚æžœheadç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜ŽåŽé¢æœ‰äººåœ¨æŽ’é˜Ÿ if (ws == Node.SIGNAL) &#123; //å…ˆæŠŠheadç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ›´æ–°ä¸º0 if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) &#123; continue; &#125; //å†åŽ»å”¤é†’åŽç»§ç»“ç‚¹ unparkSuccessor(h); //å¦‚æžœheadç»“ç‚¹çš„çŠ¶æ€ä¸º0, è¡¨æ˜Žæ­¤æ—¶åŽé¢æ²¡äººåœ¨æŽ’é˜Ÿ, å°±åªæ˜¯å°†headçŠ¶æ€ä¿®æ”¹ä¸ºPROPAGATE &#125;else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) &#123; continue; &#125; &#125; //åªæœ‰ä¿è¯æœŸé—´headç»“ç‚¹æ²¡è¢«ä¿®æ”¹è¿‡æ‰èƒ½è·³å‡ºå¾ªçŽ¯ if (h == head) &#123; break; &#125; &#125;&#125; è°ƒç”¨setHeadAndPropagateæ–¹æ³•é¦–å…ˆå°†è‡ªå·±è®¾ç½®æˆheadç»“ç‚¹ï¼Œç„¶åŽå†æ ¹æ®ä¼ å…¥çš„tryAcquireSharedæ–¹æ³•çš„è¿”å›žå€¼æ¥å†³å®šæ˜¯å¦è¦åŽ»å”¤é†’åŽç»§ç»“ç‚¹ã€‚å‰é¢å·²ç»è®²åˆ°å½“è¿”å›žå€¼å¤§äºŽ0å°±è¡¨æ˜Žå½“å‰ç»“ç‚¹æˆåŠŸèŽ·å–äº†é”ï¼Œå¹¶ä¸”åŽé¢çš„ç»“ç‚¹ä¹Ÿå¯ä»¥æˆåŠŸèŽ·å–é”ã€‚è¿™æ—¶å½“å‰ç»“ç‚¹å°±éœ€è¦åŽ»å”¤é†’åŽé¢åŒæ ·æ˜¯å…±äº«æ¨¡å¼çš„ç»“ç‚¹ï¼Œæ³¨æ„ï¼Œæ¯æ¬¡å”¤é†’ä»…ä»…åªæ˜¯å”¤é†’åŽä¸€ä¸ªç»“ç‚¹ï¼Œå¦‚æžœåŽä¸€ä¸ªç»“ç‚¹ä¸æ˜¯å…±äº«æ¨¡å¼çš„è¯ï¼Œå½“å‰ç»“ç‚¹å°±ç›´æŽ¥è¿›å…¥æˆ¿é—´è€Œä¸ä¼šå†åŽ»å”¤é†’æ›´åŽé¢çš„ç»“ç‚¹äº†ã€‚å…±äº«æ¨¡å¼ä¸‹å”¤é†’åŽç»§ç»“ç‚¹çš„æ“ä½œæ˜¯åœ¨doReleaseSharedæ–¹æ³•è¿›è¡Œçš„ï¼Œå…±äº«æ¨¡å¼å’Œç‹¬å æ¨¡å¼çš„å”¤é†’æ“ä½œåŸºæœ¬ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯åŽ»æ‰¾åˆ°è‡ªå·±åº§ä½ä¸Šçš„ç‰Œå­(ç­‰å¾…çŠ¶æ€)ï¼Œå¦‚æžœç‰Œå­ä¸Šä¸ºSIGNALè¡¨æ˜ŽåŽé¢æœ‰äººéœ€è¦è®©å®ƒå¸®å¿™å”¤é†’ï¼Œå¦‚æžœç‰Œå­ä¸Šä¸º0åˆ™è¡¨æ˜Žé˜Ÿåˆ—æ­¤æ—¶å¹¶æ²¡æœ‰äººåœ¨æŽ’é˜Ÿã€‚åœ¨ç‹¬å æ¨¡å¼ä¸‹æ˜¯å¦‚æžœå‘çŽ°æ²¡äººåœ¨æŽ’é˜Ÿå°±ç›´æŽ¥ç¦»å¼€é˜Ÿåˆ—äº†ï¼Œè€Œåœ¨å…±äº«æ¨¡å¼ä¸‹å¦‚æžœå‘çŽ°é˜Ÿåˆ—åŽé¢æ²¡äººåœ¨æŽ’é˜Ÿï¼Œå½“å‰ç»“ç‚¹åœ¨ç¦»å¼€å‰ä»ç„¶ä¼šç•™ä¸ªå°çº¸æ¡(å°†ç­‰å¾…çŠ¶æ€è®¾ç½®ä¸ºPROPAGATE)å‘Šè¯‰åŽæ¥çš„äººè¿™ä¸ªé”çš„å¯èŽ·å–çŠ¶æ€ã€‚é‚£ä¹ˆåŽé¢æ¥çš„äººåœ¨å°è¯•èŽ·å–é”çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™ä¸ªçŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦ç›´æŽ¥èŽ·å–é”ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é” 123456789101112131415161718192021222324252627282930313233343536373839404142//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException &#123; //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æžœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //1.å°è¯•åŽ»èŽ·å–é” if (tryAcquireShared(arg) &lt; 0) &#123; //2. å¦‚æžœèŽ·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); &#125;&#125;//ä»¥å¯ä¸­æ–­æ¨¡å¼èŽ·å–(å…±äº«æ¨¡å¼)private void doAcquireSharedInterruptibly(int arg) throws InterruptedException &#123; //å°†å½“å‰ç»“ç‚¹æ’å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; for (;;) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; setHeadAndPropagate(node, r); p.next = null; failed = false; return; &#125; &#125; if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) &#123; //å¦‚æžœçº¿ç¨‹åœ¨é˜»å¡žè¿‡ç¨‹ä¸­æ”¶åˆ°è¿‡ä¸­æ–­è¯·æ±‚, é‚£ä¹ˆå°±ä¼šç«‹é©¬åœ¨è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ throw new InterruptedException(); &#125; &#125; &#125; finally &#123; if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125; å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”çš„æ–¹å¼å’Œä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”çš„æ–¹å¼åœ¨æµç¨‹ä¸ŠåŸºæœ¬æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨å“ªé‡Œå“åº”çº¿ç¨‹çš„ä¸­æ–­è¯·æ±‚ã€‚åœ¨ä¸å“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”æ—¶ï¼Œçº¿ç¨‹ä»ŽparkAndCheckInterruptæ–¹æ³•ä¸­è¢«å”¤é†’ï¼Œå”¤é†’åŽå°±ç«‹é©¬è¿”å›žæ˜¯å¦æ”¶åˆ°ä¸­æ–­è¯·æ±‚ï¼Œå³ä½¿æ˜¯æ”¶åˆ°äº†ä¸­æ–­è¯·æ±‚ä¹Ÿä¼šç»§ç»­è‡ªæ—‹ç›´åˆ°èŽ·å–é”åŽæ‰å“åº”ä¸­æ–­è¯·æ±‚å°†è‡ªå·±ç»™æŒ‚èµ·ã€‚è€Œå“åº”çº¿ç¨‹ä¸­æ–­èŽ·å–é”ä¼šåœ¨çº¿ç¨‹è¢«å”¤é†’åŽç«‹é©¬å“åº”ä¸­æ–­è¯·æ±‚ï¼Œå¦‚æžœåœ¨é˜»å¡žè¿‡ç¨‹ä¸­æ”¶åˆ°äº†çº¿ç¨‹ä¸­æ–­å°±ä¼šç«‹é©¬æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚ è®¾ç½®è¶…æ—¶æ—¶é—´èŽ·å–é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//ä»¥é™å®šè¶…æ—¶æ—¶é—´èŽ·å–é”(å…±äº«æ¨¡å¼)public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout) throws InterruptedException &#123; if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; //1.è°ƒç”¨tryAcquireSharedå°è¯•åŽ»èŽ·å–é” //2.å¦‚æžœèŽ·å–å¤±è´¥å°±è°ƒç”¨doAcquireSharedNanos return tryAcquireShared(arg) &gt;= 0 || doAcquireSharedNanos(arg, nanosTimeout);&#125;//ä»¥é™å®šè¶…æ—¶æ—¶é—´èŽ·å–é”(å…±äº«æ¨¡å¼)private boolean doAcquireSharedNanos(int arg, long nanosTimeout) throws InterruptedException &#123; long lastTime = System.nanoTime(); final Node node = addWaiter(Node.SHARED); boolean failed = true; try &#123; for (;;) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); if (p == head) &#123; int r = tryAcquireShared(arg); if (r &gt;= 0) &#123; setHeadAndPropagate(node, r); p.next = null; failed = false; return true; &#125; &#125; //å¦‚æžœè¶…æ—¶æ—¶é—´ç”¨å®Œäº†å°±ç»“æŸèŽ·å–, å¹¶è¿”å›žå¤±è´¥ä¿¡æ¯ if (nanosTimeout &lt;= 0) &#123; return false; &#125; //1.æ£€æŸ¥æ˜¯å¦æ»¡è¶³å°†çº¿ç¨‹æŒ‚èµ·è¦æ±‚(ä¿è¯å‰é©±ç»“ç‚¹çŠ¶æ€ä¸ºSIGNAL) //2.æ£€æŸ¥è¶…æ—¶æ—¶é—´æ˜¯å¦å¤§äºŽè‡ªæ—‹æ—¶é—´ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) &#123; //è‹¥æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶å°±å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ LockSupport.parkNanos(this, nanosTimeout); &#125; long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡åŽ»èŽ·å–é”çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; //å¦‚æžœåœ¨é˜»å¡žæ—¶æ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) &#123; throw new InterruptedException(); &#125; &#125; &#125; finally &#123; if (failed) &#123; cancelAcquire(node); &#125; &#125;&#125; æµç¨‹åŒå‰é¢ä¸¤ç§èŽ·å–é”çš„æ–¹å¼ï¼Œä¸»è¦æ˜¯ç†è§£è¶…æ—¶çš„æœºåˆ¶æ˜¯æ€Žæ ·çš„ã€‚å¦‚æžœç¬¬ä¸€æ¬¡èŽ·å–é”å¤±è´¥ä¼šè°ƒç”¨doAcquireSharedNanosæ–¹æ³•å¹¶ä¼ å…¥è¶…æ—¶æ—¶é—´ï¼Œè¿›å…¥æ–¹æ³•åŽä¼šæ ¹æ®æƒ…å†µå†æ¬¡åŽ»èŽ·å–é”ï¼Œå¦‚æžœå†æ¬¡èŽ·å–å¤±è´¥å°±è¦è€ƒè™‘å°†çº¿ç¨‹æŒ‚èµ·äº†ã€‚è¿™æ—¶ä¼šåˆ¤æ–­è¶…æ—¶æ—¶é—´æ˜¯å¦å¤§äºŽè‡ªæ—‹æ—¶é—´ï¼Œå¦‚æžœæ˜¯çš„è¯å°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œå¦åˆ™å°±ç»§ç»­å°è¯•èŽ·å–ï¼Œæ¯æ¬¡èŽ·å–é”ä¹‹åŽéƒ½ä¼šå°†è¶…æ—¶æ—¶é—´å‡åŽ»èŽ·å–é”çš„æ—¶é—´ï¼Œä¸€ç›´è¿™æ ·å¾ªçŽ¯ç›´åˆ°è¶…æ—¶æ—¶é—´ç”¨å°½ï¼Œå¦‚æžœè¿˜æ²¡æœ‰èŽ·å–åˆ°é”çš„è¯å°±ä¼šç»“æŸèŽ·å–å¹¶è¿”å›žèŽ·å–å¤±è´¥æ ‡è¯†ã€‚åœ¨æ•´ä¸ªæœŸé—´çº¿ç¨‹æ˜¯å“åº”çº¿ç¨‹ä¸­æ–­çš„ã€‚ å…±äº«æ¨¡å¼ä¸‹é‡Šæ”¾é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) &#123; //1.å°è¯•åŽ»é‡Šæ”¾é” if (tryReleaseShared(arg)) &#123; //2.å¦‚æžœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; &#125; return false;&#125;//å°è¯•åŽ»é‡Šæ”¾é”(å…±äº«æ¨¡å¼)protected boolean tryReleaseShared(int arg) &#123; throw new UnsupportedOperationException();&#125;//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)private void doReleaseShared() &#123; for (;;) &#123; //èŽ·å–åŒæ­¥é˜Ÿåˆ—çš„headç»“ç‚¹ Node h = head; //åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç»“ç‚¹ if (h != null &amp;&amp; h != tail) &#123; //èŽ·å–headç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = h.waitStatus; //å¦‚æžœheadç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜ŽåŽé¢æœ‰äººåœ¨æŽ’é˜Ÿ if (ws == Node.SIGNAL) &#123; //å…ˆæŠŠheadç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ›´æ–°ä¸º0ï¼ˆæœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼‰ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) &#123; continue; &#125; //å†åŽ»å”¤é†’åŽç»§ç»“ç‚¹ unparkSuccessor(h); //å¦‚æžœheadç»“ç‚¹çš„çŠ¶æ€ä¸º0, è¡¨æ˜Žæ­¤æ—¶åŽé¢æ²¡äººåœ¨æŽ’é˜Ÿ, å°±åªæ˜¯å°†headçŠ¶æ€ä¿®æ”¹ä¸ºPROPAGATE &#125;else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) &#123; continue; &#125; &#125; //åªæœ‰ä¿è¯æœŸé—´headç»“ç‚¹æ²¡è¢«ä¿®æ”¹è¿‡æ‰èƒ½è·³å‡ºå¾ªçŽ¯ if (h == head) &#123; break; &#125; &#125;&#125; çº¿ç¨‹åœ¨æˆ¿é—´åŠžå®Œäº‹ä¹‹åŽå°±ä¼šè°ƒç”¨releaseSharedæ–¹æ³•é‡Šæ”¾é”ï¼Œé¦–å…ˆè°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼Œè¯¥æ–¹æ³•çš„åˆ¤æ–­é€»è¾‘ç”±å­ç±»å®žçŽ°ã€‚å¦‚æžœé‡Šæ”¾æˆåŠŸå°±è°ƒç”¨doReleaseSharedæ–¹æ³•åŽ»å”¤é†’åŽç»§ç»“ç‚¹ã€‚èµ°å‡ºæˆ¿é—´åŽå®ƒä¼šæ‰¾åˆ°åŽŸå…ˆçš„åº§ä½(headç»“ç‚¹)ï¼Œçœ‹çœ‹åº§ä½ä¸Šæ˜¯å¦æœ‰äººç•™äº†å°çº¸æ¡(çŠ¶æ€ä¸ºSIGNAL)ï¼Œå¦‚æžœæœ‰å°±åŽ»å”¤é†’åŽç»§ç»“ç‚¹ã€‚å¦‚æžœæ²¡æœ‰(çŠ¶æ€ä¸º0)å°±ä»£è¡¨é˜Ÿåˆ—æ²¡äººåœ¨æŽ’é˜Ÿï¼Œé‚£ä¹ˆåœ¨ç¦»å¼€ä¹‹å‰å®ƒè¿˜è¦åšæœ€åŽä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯åœ¨è‡ªå·±åº§ä½ä¸Šç•™ä¸‹å°çº¸æ¡(çŠ¶æ€è®¾ç½®ä¸ºPROPAGATE)ï¼Œå‘Šè¯‰åŽé¢çš„äººé”çš„èŽ·å–çŠ¶æ€ï¼Œæ•´ä¸ªé‡Šæ”¾é”çš„è¿‡ç¨‹å’Œç‹¬å æ¨¡å¼å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨è¿™æœ€åŽä¸€æ­¥æ“ä½œã€‚ &lt;font color=&quot;red&quot;&gt;PSï¼š&lt;/font&gt;ä¸Šé¢è¯´äº†doReleaseShared()çš„ä»£ç æµç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸¤å¤„åœ°æ–¹è°ƒç”¨ï¼š ç¬¬ä¸€å¤„è°ƒç”¨çš„åœ°æ–¹ï¼šåˆšåˆšé‡Šæ”¾èµ„æºçš„è€çš„headè°ƒç”¨ï¼Œåœ¨ä»£ç ä¸­å°±æ˜¯releaseShared()æ–¹æ³•ä¸­è°ƒç”¨ã€‚ ç¬¬äºŒå¤„è°ƒç”¨çš„åœ°æ–¹ï¼šåˆšåˆšè®¾ç½®æ–°çš„å¤´ç»“ç‚¹headè°ƒç”¨ï¼Œåœ¨ä»£ç ä¸­å°±æ˜¯setHeadAndPropagate()æ–¹æ³•ä¸­è°ƒç”¨ã€‚ ä¸Šé¢çš„æ–¹æ³•çœ‹åˆ°headèŠ‚ç‚¹çš„çŠ¶æ€è¦ä¹ˆæ˜¯SIGNAL(SIGNALâ€”â€”&gt;0),è¦ä¹ˆæ˜¯0(0â€”â€”&gt;PROPAGATE)ï¼Œè¿™äº›çŠ¶æ€æ€Žæ ·æ¥çš„ï¼Ÿ çŠ¶æ€ä¸ºSIGNALçš„ç”±æ¥ï¼šå¤´ç»“ç‚¹çš„åŽç»§èŠ‚ç‚¹è¢«æŒ‚èµ·äº†ï¼ŒæŒ‚èµ·çš„åŒæ—¶ä¼šå°†å®ƒçš„å‰é©±èŠ‚ç‚¹çŠ¶æ€ç½®ä¸ºSIGNALï¼Œä»¥ä¾¿äºŽè¢«å”¤é†’ã€‚ çŠ¶æ€ä¸º0çš„ç”±æ¥ï¼šè¿™ä¸ªçŠ¶æ€æ˜¯é»˜è®¤çŠ¶æ€ï¼ŒåŽç»§èŠ‚ç‚¹æ²¡æœ‰è¢«æŒ‚èµ·å°±å°è¯•èŽ·å–èµ„æºæˆåŠŸäº†ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰è°ƒç”¨åˆ¤æ–­æŒ‚èµ·çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¤´ç»“ç‚¹çš„çŠ¶æ€æ²¡æœ‰å˜åŒ–ã€‚ ç¬¬ä¸€ä¸ªåˆ†æžçš„é‡ç‚¹ï¼šå¦‚æžœåªæœ‰åˆšåˆšé‡Šæ”¾èµ„æºçš„è€çš„headè°ƒç”¨äº†æ­¤æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™æ²¡æœ‰ç«žäº‰ï¼Œå¦‚æžœå¤´ç»“ç‚¹headçš„waitStatusç­‰äºŽSIGNALï¼Œåˆ™é¦–å…ˆå°†SIGNALâ€”â€”&gt;0,å¦‚æžœæˆåŠŸåˆ™è°ƒç”¨unparkSuccessor()æ–¹æ³•å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æžœå¤´ç»“ç‚¹headçš„waitStatusç­‰äºŽ0ï¼Œåˆ™å°†0â€”â€”&gt;PROPAGATE,ä¸æˆåŠŸåˆ™ç»§ç»­å¾ªçŽ¯ã€‚ ç¬¬äºŒä¸ªåˆ†æžçš„é‡ç‚¹ï¼šå¦‚æžœåˆšåˆšé‡Šæ”¾èµ„æºçš„è€headï¼Œå’ŒåˆšèŽ·å–èµ„æºè®¾ç½®æ–°çš„å¤´ç»“ç‚¹çš„headåŒæ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¸¤è€…èŽ·å–çš„headå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå‰è€…è€headèŽ·å–çš„hå¯èƒ½æ˜¯è‡ªå·±ï¼Œä¹Ÿå¯èƒ½æ˜¯æ–°çš„headï¼ŒåŽè€…æ–°headèŽ·å–çš„hä¸€å®šæ˜¯è‡ªå·±ã€‚ä½†æ˜¯ä¸ç®¡headèŽ·å–çš„æ˜¯è€çš„ï¼Œè¿˜æ˜¯æ–°çš„ï¼Œéƒ½èƒ½å¤Ÿé¡ºåˆ©çš„å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªä¸è¿‡å¯èƒ½å¤šå”¤é†’ä¸€æ¬¡è€Œå·²ï¼Œè¿™å¹¶ä¸å½±å“ç»“æžœã€‚ ç¬¬ä¸‰ä¸ªåˆ†æžçš„é‡ç‚¹ï¼šæœ€åŽä¸ºä»€ä¹ˆä¼šåˆ¤æ–­h==headï¼Ÿå¦‚æžœå¤´ç»“ç‚¹headå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å…¶ä»–çº¿ç¨‹èŽ·å–äº†èµ„æºæŠŠheadæ”¹å˜äº†ï¼Œä¸ºäº†ä½¿è‡ªå·±çš„å”¤é†’åŠ¨ä½œä¼ é€’ï¼Œå¿…é¡»é‡è¯•ã€‚ å…¶å®ždoReleaseShared()æ–¹æ³•å°±æ˜¯èƒ½å¤Ÿä¿è¯å”¤é†’ä¸‹é¢çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¼ é€’ä¸‹åŽ»ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æžä¹‹æ¦‚è¦åˆ†æž]]></title>
    <url>%2Fposts%2F115e562c.html</url>
    <content type="text"><![CDATA[AbstractQueuedSynchronizeræ˜¯åšä»€ä¹ˆçš„ java.util.concurrentè¿™ä¸ªåŒ…ä¸‹æœ‰å¾ˆå¤šç±»ï¼Œæ¯”å¦‚ReentrantLockã€CountDownLatchã€CyclicBarrrierã€Semaphoreç­‰ï¼Œå®ƒä»¬çš„å®žçŽ°ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼Œè¿™ä¸ªç±»ç»§æ‰¿äº†AbstractQueuedSynchronizerï¼ˆç®€ç§°AQSï¼‰ï¼Œæ‰€æœ‰çš„é”æœºåˆ¶çš„å®žçŽ°éƒ½ä¾èµ–äºŽSyncå†…éƒ¨ç±»ï¼Œä¹Ÿå¯ä»¥è¯´è¿™äº›ç±»çš„å®žçŽ°å°±æ˜¯ä¾èµ–äºŽAQSã€‚ é‚£ä¹ˆAQSå†…éƒ¨åˆ°åº•å®žçŽ°äº†ä»€ä¹ˆä»¥è‡³äºŽè¿™äº›ç±»éƒ½è¦ä¾èµ–äºŽå®ƒå‘¢ï¼Ÿå¯ä»¥è¿™æ ·è¯´ï¼ŒAQSä¸ºè¿™äº›ç±»æä¾›äº†åŸºç¡€è®¾æ–½ï¼Œä¹Ÿå°±æ˜¯æä¾›äº†ä¸€ä¸ªå¯†ç é”ï¼Œè¿™äº›ç±»æ‹¥æœ‰äº†å¯†ç é”ä¹‹åŽå¯ä»¥è‡ªå·±æ¥è®¾ç½®å¯†ç é”çš„å¯†ç ã€‚æ­¤å¤–ï¼ŒAQSè¿˜æä¾›äº†ä¸€ä¸ªæŽ’é˜ŸåŒºï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªçº¿ç¨‹è®­å¯¼å‘˜ï¼Œæˆ‘ä»¬çŸ¥é“çº¿ç¨‹å°±åƒä¸€ä¸ªåŽŸå§‹çš„é‡Žè›®äººï¼Œå®ƒä¸æ‡‚å¾—è®²ç¤¼è²Œï¼Œå®ƒåªä¼šæ¨ªå†²ç›´æ’žï¼Œæ‰€ä»¥ä½ å¾—ä¸€æ­¥ä¸€æ­¥åŽ»æ•™å®ƒï¼Œå‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™éœ€è¦åŽ»æŽ’é˜Ÿäº†ï¼Œè¦åˆ°å“ªé‡ŒåŽ»æŽ’é˜Ÿï¼ŒæŽ’é˜Ÿå‰è¦åšäº›ä»€ä¹ˆï¼ŒæŽ’é˜ŸåŽè¦åšäº›ä»€ä¹ˆã€‚è¿™äº›æ•™åŒ–å·¥ä½œå…¨éƒ¨éƒ½ç”±AQSå¸®ä½ å®Œæˆäº†ï¼Œä»Žå®ƒè¿™é‡Œæ•™åŒ–å‡ºæ¥çš„çº¿ç¨‹éƒ½å˜çš„éžå¸¸æ–‡æ˜Žæ‡‚ç¤¼è²Œï¼Œä¸å†æ˜¯åŽŸå§‹çš„é‡Žè›®äººï¼Œæ‰€ä»¥ä»¥åŽæˆ‘ä»¬åªéœ€è¦å’Œè¿™äº›æ–‡æ˜Žçš„çº¿ç¨‹æ‰“äº¤é“å°±è¡Œäº†ï¼Œåƒä¸‡ä¸è¦å’ŒåŽŸå§‹çº¿ç¨‹æœ‰è¿‡å¤šçš„æŽ¥è§¦ï¼ ä¸ºä½•è¯´AQSæä¾›äº†ä¸€æŠŠå¯†ç é” 1234567891011121314151617181920212223//åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹private transient volatile Node head; //åŒæ­¥é˜Ÿåˆ—çš„å°¾ç»“ç‚¹private transient volatile Node tail;//åŒæ­¥çŠ¶æ€private volatile int state;//èŽ·å–åŒæ­¥çŠ¶æ€protected final int getState() &#123; return state;&#125;//è®¾ç½®åŒæ­¥çŠ¶æ€protected final void setState(int newState) &#123; state = newState;&#125;//ä»¥CASæ–¹å¼è®¾ç½®åŒæ­¥çŠ¶æ€protected final boolean compareAndSetState(int expect, int update) &#123; return unsafe.compareAndSwapInt(this, stateOffset, expect, update);&#125; ä¸Šé¢çš„ä»£ç åˆ—å‡ºäº†AQSçš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¯ä»¥çœ‹åˆ°AQSçš„æˆå‘˜å˜é‡åªæœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯åŒæ­¥é˜Ÿåˆ—å¤´ç»“ç‚¹å¼•ç”¨ï¼ŒåŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ä»¥åŠåŒæ­¥çŠ¶æ€ã€‚ æ³¨æ„ï¼Œè¿™ä¸‰ä¸ªæˆå‘˜å˜é‡éƒ½ä½¿ç”¨äº†volatileå…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œè¿™å°±ç¡®ä¿äº†å¤šä¸ªçº¿ç¨‹å¯¹å®ƒçš„ä¿®æ”¹éƒ½æ˜¯å†…å­˜å¯è§çš„ã€‚ æ•´ä¸ªç±»çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªåŒæ­¥çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°åŒæ­¥çŠ¶æ€å…¶å®žå°±æ˜¯ä¸€ä¸ªintåž‹çš„å˜é‡ï¼Œå¤§å®¶å¯ä»¥æŠŠè¿™ä¸ªåŒæ­¥çŠ¶æ€çœ‹æˆä¸€ä¸ªå¯†ç é”ï¼Œè€Œä¸”è¿˜æ˜¯ä»Žæˆ¿é—´é‡Œé¢é”èµ·æ¥çš„å¯†ç é”ï¼Œstateå…·ä½“çš„å€¼å°±ç›¸å½“äºŽå¯†ç æŽ§åˆ¶ç€å¯†ç é”çš„å¼€åˆã€‚ å½“ç„¶è¿™ä¸ªé”çš„å¯†ç æ˜¯å¤šå°‘å°±ç”±å„ä¸ªå­ç±»æ¥è§„å®šäº†ï¼Œä¾‹å¦‚åœ¨ReentrantLockä¸­ï¼Œstateç­‰äºŽ0è¡¨ç¤ºé”æ˜¯å¼€çš„ï¼Œstateå¤§äºŽ0è¡¨ç¤ºé”æ˜¯é”ç€çš„ï¼Œè€Œåœ¨Semaphoreä¸­ï¼Œstateå¤§äºŽ0è¡¨ç¤ºé”æ˜¯å¼€çš„ï¼Œstateç­‰äºŽ0è¡¨ç¤ºé”æ˜¯é”ç€çš„ã€‚ AQSçš„æŽ’é˜ŸåŒºæ˜¯æ€Žæ ·å®žçŽ°çš„ AQSå†…éƒ¨å…¶å®žæœ‰ä¸¤ä¸ªæŽ’é˜ŸåŒºï¼Œä¸€ä¸ªæ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯æ¡ä»¶é˜Ÿåˆ—ã€‚ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒåŒæ­¥é˜Ÿåˆ—åªæœ‰ä¸€æ¡ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šæ¡ã€‚åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹åˆ†åˆ«æŒæœ‰å‰åŽç»“ç‚¹çš„å¼•ç”¨ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„ç»“ç‚¹åªæœ‰ä¸€ä¸ªæŒ‡å‘åŽç»§ç»“ç‚¹çš„å¼•ç”¨ã€‚å›¾ä¸­Tè¡¨ç¤ºçº¿ç¨‹ï¼Œæ¯ä¸ªç»“ç‚¹åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹åœ¨èŽ·å–é”å¤±è´¥åŽé¦–å…ˆè¿›å…¥åŒæ­¥é˜Ÿåˆ—æŽ’é˜Ÿï¼Œè€Œæƒ³è¦è¿›å…¥æ¡ä»¶é˜Ÿåˆ—è¯¥çº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰è¡Œã€‚æŽ¥ä¸‹æ¥çœ‹çœ‹é˜Ÿåˆ—ä¸­æ¯ä¸ªç»“ç‚¹çš„ç»“æž„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172//åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹static final class Node &#123; static final Node SHARED = new Node(); //è¡¨ç¤ºå½“å‰çº¿ç¨‹ä»¥å…±äº«æ¨¡å¼æŒæœ‰é” static final Node EXCLUSIVE = null; //è¡¨ç¤ºå½“å‰çº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼æŒæœ‰é” static final int CANCELLED = 1; //è¡¨ç¤ºå½“å‰ç»“ç‚¹å·²ç»å–æ¶ˆèŽ·å–é” static final int SIGNAL = -1; //è¡¨ç¤ºåŽç»§ç»“ç‚¹çš„çº¿ç¨‹éœ€è¦è¿è¡Œ static final int CONDITION = -2; //è¡¨ç¤ºå½“å‰ç»“ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­æŽ’é˜Ÿ static final int PROPAGATE = -3; //è¡¨ç¤ºåŽç»§ç»“ç‚¹å¯ä»¥ç›´æŽ¥èŽ·å–é”(PROPAGATEä¸ºä¸‹ä¸€ä¸ªacquireSharedæ— æ¡ä»¶ä¼ æ’­çš„çŠ¶æ€ï¼Œç”¨äºŽå…±äº«æ¨¡å¼) volatile int waitStatus; //è¡¨ç¤ºå½“å‰ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰ volatile Node prev; //è¡¨ç¤ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±ç»“ç‚¹ volatile Node next; //è¡¨ç¤ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„åŽç»§ç»“ç‚¹ volatile Thread thread; //å½“å‰ç»“ç‚¹æŒæœ‰çš„çº¿ç¨‹å¼•ç”¨ Node nextWaiter; //è¡¨ç¤ºæ¡ä»¶é˜Ÿåˆ—ä¸­çš„åŽç»§ç»“ç‚¹ /** * å½“å‰ç»“ç‚¹çŠ¶æ€æ˜¯å¦æ˜¯å…±äº«æ¨¡å¼ */ final boolean isShared() &#123; return nextWaiter == SHARED; &#125; /** * è¿”å›žå½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ */ final Node predecessor() throws NullPointerException &#123; Node p = prev; if (p == null) &#123; throw new NullPointerException(); &#125; else &#123; return p; &#125; &#125; /** * ç©ºæž„é€ å‡½æ•°ï¼šä¸»è¦ç”¨äºŽåˆå§‹åŒ–å¤´ç»“ç‚¹(head)æˆ–è€…åˆ›å»ºå…±äº«æ¨¡å¼ */ Node() &#123;&#125; /** * é»˜è®¤ç”¨è¿™ä¸ªæž„é€ å™¨ï¼ˆä¸»è¦ç”¨äºŽæŠŠèŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼‰ * * @param thread å½“å‰çº¿ç¨‹ * @param mode ç»“ç‚¹æ¨¡å¼ */ Node(Thread thread, Node mode) &#123; //æ³¨æ„æŒæœ‰æ¨¡å¼æ˜¯èµ‹å€¼ç»™nextWaiter this.nextWaiter = mode; this.thread = thread; &#125; /** * åªåœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç”¨åˆ° * * @param thread å½“å‰çº¿ç¨‹ * @param waitStatus ç»“ç‚¹çŠ¶æ€ */ Node(Thread thread, int waitStatus) &#123; this.waitStatus = waitStatus; this.thread = thread; &#125;&#125; Nodeä»£è¡¨åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå®ƒæ˜¯AQSçš„å†…éƒ¨ç±»ã€‚Nodeæœ‰å¾ˆå¤šå±žæ€§ï¼Œæ¯”å¦‚æŒæœ‰æ¨¡å¼ï¼Œç­‰å¾…çŠ¶æ€ï¼ŒåŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±å’ŒåŽç»§ï¼Œä»¥åŠæ¡ä»¶é˜Ÿåˆ—ä¸­çš„åŽç»§å¼•ç”¨ç­‰ç­‰ã€‚å¯ä»¥æŠŠåŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—çœ‹æˆæ˜¯æŽ’é˜ŸåŒºï¼Œæ¯ä¸ªç»“ç‚¹çœ‹æˆæ˜¯æŽ’é˜ŸåŒºçš„åº§ä½ï¼Œå°†çº¿ç¨‹çœ‹æˆæ˜¯æŽ’é˜Ÿçš„å®¢äººã€‚å®¢äººåˆšæ¥æ—¶ä¼šå…ˆåŽ»æ•²æ•²é—¨ï¼Œçœ‹çœ‹é”æœ‰æ²¡æœ‰å¼€ï¼Œå¦‚æžœé”æ²¡å¼€å®ƒå°±ä¼šåŽ»æŽ’é˜ŸåŒºé¢†å–ä¸€ä¸ªå·ç ç‰Œï¼Œå£°æ˜Žè‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥æŒæœ‰é”ï¼Œæœ€åŽå†åˆ°é˜Ÿåˆ—çš„æœ«å°¾è¿›è¡ŒæŽ’é˜Ÿã€‚ æ€Žæ ·ç†è§£ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ å‰é¢è®²åˆ°æ¯ä¸ªå®¢äººåœ¨æŽ’é˜Ÿå‰ä¼šé¢†å–ä¸€ä¸ªå·ç ç‰Œï¼Œå£°æ˜Žè‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥å æœ‰é”ï¼Œå æœ‰é”çš„æ–¹å¼åˆ†ä¸ºç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼Œé‚£ä¹ˆæ€Žæ ·æ¥ç†è§£ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼å‘¢ï¼Ÿæ‰“ä¸ªæ¯”æ–¹ï¼Œå¤§å®¶è”æƒ³ä¸€ä¸‹åŽ»é£Ÿå ‚åƒé¥­ï¼Œæ­£å¥½æœ‰ä¸€ä¸ªæ¡Œå­ç©ºç€ï¼Œç‹¬å æ¨¡å¼çš„äººæ¯”è¾ƒéœ¸é“ï¼Œè€å­è¦ä¹ˆå°±ä¸åï¼Œåä¸‹æ¥å°±ä¸å…è®¸åˆ«äººåï¼Œè‡ªå·±ä¸€ä¸ªäººç‹¬è‡ªå ç”¨æ•´ä¸ªæ¡Œå­ã€‚å…±äº«æ¨¡å¼çš„äººå°±æ²¡é‚£ä¹ˆè®²ç©¶äº†ï¼Œå½“å®ƒå‘çŽ°è¿™ä¸ªæ¡Œå­å¯ä»¥ç”¨ï¼Œè‡ªå·±åä¸‹è¿˜ä¸ç®—ï¼Œè¿˜å¾—çƒ­å¿ƒçš„é—®ä¸‹åŽé¢çš„äººä»‹ä¸ä»‹æ„ä¸€èµ·ï¼Œå¦‚æžœåŽé¢çš„äººä¸ä»‹æ„ä¸€èµ·é‚£å°±ä¸ç”¨å†æŽ’é˜Ÿäº†ï¼Œ å½“ç„¶å¦‚æžœåŽé¢çš„äººä»‹æ„é‚£å°±åªå¥½ç•™åœ¨é˜Ÿåˆ—é‡Œç»§ç»­æŽ’é˜Ÿäº†ã€‚ æ€Žæ ·ç†è§£ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ æ¯ä¸ªç»“ç‚¹éƒ½æœ‰ä¸€ä¸ªç­‰å¾…çŠ¶æ€ï¼Œè¿™ä¸ªç­‰å¾…çŠ¶æ€åˆ†ä¸ºCANCELLEDï¼ŒSIGNALï¼ŒCONDITIONï¼ŒPROPAGATEå››ç§çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªç­‰å¾…çŠ¶æ€çœ‹ä½œæ˜¯æŒ‚åœ¨åº§ä½æ—è¾¹çš„ç‰Œå­ï¼Œæ ‡è¯†å½“å‰åº§ä½ä¸Šçš„äººçš„ç­‰å¾…çŠ¶æ€ã€‚è¿™ä¸ªç‰Œå­çš„çŠ¶æ€ä¸ä»…è‡ªå·±å¯ä»¥ä¿®æ”¹ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚ä¾‹å¦‚å½“è¿™ä¸ªçº¿ç¨‹åœ¨æŽ’é˜Ÿè¿‡ç¨‹ä¸­å·²ç»æ‰“ç®—æ”¾å¼ƒäº†ï¼Œå®ƒå°±ä¼šå°†è‡ªå·±åº§ä½ä¸Šçš„ç‰Œå­è®¾ç½®ä¸ºCANCELLEDï¼Œè¿™æ ·å…¶ä»–äººçœ‹åˆ°äº†å°±å¯ä»¥å°†å®ƒæ¸…ç†å‡ºé˜Ÿåˆ—ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“çº¿ç¨‹åœ¨åº§ä½ä¸Šè¦ç¡ç€ä¹‹å‰ï¼Œå®ƒæ€•è‡ªå·±ç¡è¿‡äº†å¤´ï¼Œå°±ä¼šå°†å‰é¢ä½ç½®ä¸Šçš„ç‰Œå­æ”¹ä¸ºSIGNALï¼Œå› ä¸ºæ¯ä¸ªäººåœ¨ç¦»å¼€é˜Ÿåˆ—å‰éƒ½ä¼šå›žåˆ°è‡ªå·±åº§ä½ä¸Šçœ‹ä¸€çœ¼ï¼Œå¦‚æžœçœ‹åˆ°ç‰Œå­ä¸ŠçŠ¶æ€ä¸ºSIGNALï¼Œå®ƒå°±ä¼šåŽ»å”¤é†’ä¸‹ä¸€ä¸ªäººã€‚åªæœ‰ä¿è¯å‰é¢ä½ç½®ä¸Šçš„ç‰Œå­ä¸ºSIGNALï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šå®‰å¿ƒçš„ç¡åŽ»ã€‚CONDITIONçŠ¶æ€è¡¨ç¤ºè¯¥çº¿ç¨‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­æŽ’é˜Ÿï¼ŒPROPAGATEçŠ¶æ€æé†’åŽé¢æ¥çš„çº¿ç¨‹å¯ä»¥ç›´æŽ¥èŽ·å–é”ï¼Œè¿™ä¸ªçŠ¶æ€åªåœ¨å…±äº«æ¨¡å¼ç”¨åˆ°ã€‚ ç»“ç‚¹è¿›å…¥åŒæ­¥é˜Ÿåˆ—æ—¶ä¼šè¿›è¡Œå“ªäº›æ“ä½œ 123456789101112131415161718192021222324//ç»“ç‚¹å…¥é˜Ÿæ“ä½œ, è¿”å›žå‰ä¸€ä¸ªç»“ç‚¹private Node enq(final Node node) &#123; for (;;) &#123; //èŽ·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node t = tail; //å¦‚æžœå°¾ç»“ç‚¹ä¸ºç©ºè¯´æ˜ŽåŒæ­¥é˜Ÿåˆ—è¿˜æ²¡æœ‰åˆå§‹åŒ– if (t == null) &#123; //åˆå§‹åŒ–åŒæ­¥é˜Ÿåˆ— if (compareAndSetHead(new Node())) &#123; tail = head; &#125; &#125; else &#123; //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = t; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(t, node)) &#123; //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åŽç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ t.next = node; //forå¾ªçŽ¯å”¯ä¸€çš„å‡ºå£ return t; &#125; &#125; &#125;&#125; æ³¨æ„ï¼Œå…¥é˜Ÿæ“ä½œä½¿ç”¨ä¸€ä¸ªæ­»å¾ªçŽ¯ï¼Œåªæœ‰æˆåŠŸå°†ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨æ‰ä¼šè¿”å›žï¼Œè¿”å›žç»“æžœæ˜¯åŒæ­¥é˜Ÿåˆ—åŽŸå…ˆçš„å°¾ç»“ç‚¹ã€‚ä¸‹å›¾æ¼”ç¤ºäº†æ•´ä¸ªæ“ä½œè¿‡ç¨‹ã€‚ æ·»åŠ å°¾ç»“ç‚¹çš„é¡ºåºï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼šæŒ‡å‘å°¾ç»“ç‚¹ï¼ŒCASæ›´æ”¹å°¾ç»“ç‚¹ï¼Œå°†æ—§å°¾ç»“ç‚¹çš„åŽç»§æŒ‡å‘å½“å‰ç»“ç‚¹ã€‚åœ¨å¹¶å‘çŽ¯å¢ƒä¸­è¿™ä¸‰æ­¥æ“ä½œä¸ä¸€å®šèƒ½ä¿è¯å®Œæˆï¼Œæ‰€ä»¥åœ¨æ¸…ç©ºåŒæ­¥é˜Ÿåˆ—æ‰€æœ‰å·²å–æ¶ˆçš„ç»“ç‚¹è¿™ä¸€æ“ä½œä¸­ï¼Œä¸ºäº†å¯»æ‰¾éžå–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ï¼Œä¸æ˜¯ä»Žå‰å‘åŽéåŽ†è€Œæ˜¯ä»ŽåŽå‘å‰éåŽ†çš„ã€‚è¿˜æœ‰å°±æ˜¯æ¯ä¸ªç»“ç‚¹è¿›å…¥é˜Ÿåˆ—ä¸­æ—¶å®ƒçš„ç­‰å¾…çŠ¶æ€æ˜¯ä¸º0ï¼Œåªæœ‰åŽç»§ç»“ç‚¹çš„çº¿ç¨‹éœ€è¦æŒ‚èµ·æ—¶æ‰ä¼šå°†å‰é¢ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ”¹ä¸ºSIGNALã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”±å‰”é™¤Intellijä¸­Mybatisçš„Mapperè‡ªåŠ¨æ³¨å…¥è­¦å‘Šå¼•å…¥å¯¹æ³¨è§£çš„å­¦ä¹ ]]></title>
    <url>%2Fposts%2F8b9fb30a.html</url>
    <content type="text"><![CDATA[èµ·æº ç›¸ä¿¡ä½¿ç”¨Mybatisçš„å°ä¼™ä»¬ä¸€å®šç»å¸¸ç¼–å†™ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š å¯ä»¥çœ‹åˆ° userMapper ä¸‹æœ‰ä¸ªçº¢è‰²è­¦å‘Šã€‚è™½ç„¶ä»£ç æœ¬èº«å¹¶æ²¡æœ‰é—®é¢˜ï¼Œèƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æœ‰ä¸ªè­¦å‘Šæ€»å½’æœ‰ç‚¹æ¶å¿ƒã€‚å…ˆçœ‹ä¸‹è­¦å‘Šä¿¡æ¯ï¼š Spring team recommends: &quot;Always use constructor based dependency injection in your beans. Always use assertions for mandatory dependencies.&quot; åŽŸå›  ä¼—æ‰€å‘¨çŸ¥ï¼ŒIDEAæ˜¯éžå¸¸æ™ºèƒ½çš„ï¼Œå®ƒå¯ä»¥ç†è§£Springçš„ä¸Šä¸‹æ–‡ã€‚ç„¶è€Œ UserMapper è¿™ä¸ªæŽ¥å£æ˜¯Mybatisçš„ï¼ŒIDEAç†è§£ä¸äº†ã€‚ è€Œ @Autowired æ³¨è§£ï¼Œé»˜è®¤æƒ…å†µä¸‹è¦æ±‚ä¾èµ–å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ userMapper ï¼‰å¿…é¡»å­˜åœ¨ã€‚è€ŒIDEAè®¤ä¸ºè¿™ä¸ªå¯¹è±¡çš„å®žä¾‹/ä»£ç†æ˜¯ä¸ªnullï¼Œæ‰€ä»¥å°±å‹å¥½åœ°ç»™ä¸ªæç¤ºã€‚æŒ‰ç…§æç¤ºä¿®æ”¹å¦‚ä¸‹ï¼š 123456private final UserMapper userMapper;@Autowiredpublic UserServiceImpl(UserMapper userMapper) &#123; this.userMapper = userMapper;&#125; æ­¤æ—¶ä»ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š 1Could not autowire. è‡ªåŠ¨æ³¨å…¥ beanï¼Œ springå¸®åŠ©æˆ‘ä»¬å®Œæˆäº†ï¼Œä½†æ˜¯åŒæ—¶Springæä¾›äº†ä¸€äº›æ³¨è§£æ¥æ˜¾å¼çš„æ³¨æ˜Žbeanä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œå…¶ä¸­æœ€ä¸ºç†ŸçŸ¥çš„è‡ªç„¶æ˜¯@Controller,@Service,@Repository,@Componentç­‰ã€‚ è¿™é‡Œå…¶å®žç»™UserMapperæŽ¥å£åŠ ä¸Š@Repository,@Componentå°±å¯ä»¥è§£å†³ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åŒºåˆ« Springä¸ä½†æ”¯æŒè‡ªå·±å®šä¹‰çš„@Autowiredæ³¨è§£ï¼Œè¿˜æ”¯æŒå‡ ä¸ªç”±JSR-250è§„èŒƒå®šä¹‰çš„æ³¨è§£ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯@Resourceã€@PostConstructä»¥åŠ@PreDestroyã€‚ @Resourceçš„ä½œç”¨ç›¸å½“äºŽ@Autowiredï¼Œåªä¸è¿‡@AutowiredæŒ‰byTypeè‡ªåŠ¨æ³¨å…¥ï¼Œè€Œ@Resourceé»˜è®¤æŒ‰ byNameè‡ªåŠ¨æ³¨å…¥ç½¢äº†ã€‚@Resourceæœ‰ä¸¤ä¸ªå±žæ€§æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œåˆ†æ˜¯nameå’Œtypeï¼ŒSpringå°†@Resourceæ³¨è§£çš„nameå±žæ€§è§£æžä¸ºbeançš„åå­—ï¼Œè€Œtypeå±žæ€§åˆ™è§£æžä¸ºbeançš„ç±»åž‹ã€‚æ‰€ä»¥å¦‚æžœä½¿ç”¨nameå±žæ€§ï¼Œåˆ™ä½¿ç”¨byNameçš„è‡ªåŠ¨æ³¨å…¥ç­–ç•¥ï¼Œè€Œä½¿ç”¨typeå±žæ€§æ—¶åˆ™ä½¿ç”¨byTypeè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚å¦‚æžœæ—¢ä¸æŒ‡å®šnameä¹Ÿä¸æŒ‡å®štypeå±žæ€§ï¼Œè¿™æ—¶å°†é€šè¿‡åå°„æœºåˆ¶ä½¿ç”¨byNameè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚ @Resourceè£…é…é¡ºåº å¦‚æžœåŒæ—¶æŒ‡å®šäº†nameå’Œtypeï¼Œåˆ™ä»ŽSpringä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å”¯ä¸€åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ å¦‚æžœæŒ‡å®šäº†nameï¼Œåˆ™ä»Žä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾åç§°ï¼ˆidï¼‰åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ å¦‚æžœæŒ‡å®šäº†typeï¼Œåˆ™ä»Žä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ç±»åž‹åŒ¹é…çš„å”¯ä¸€beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ å¦‚æžœæ—¢æ²¡æœ‰æŒ‡å®šnameï¼Œåˆæ²¡æœ‰æŒ‡å®štypeï¼Œåˆ™è‡ªåŠ¨æŒ‰ç…§byNameæ–¹å¼è¿›è¡Œè£…é…ï¼›å¦‚æžœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™å›žé€€ä¸ºä¸€ä¸ªåŽŸå§‹ç±»åž‹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æžœåŒ¹é…åˆ™è‡ªåŠ¨è£…é…ï¼› @Autowired ä¸Ž@Resourceçš„åŒºåˆ« 1ã€@Autowiredä¸Ž@Resourceéƒ½å¯ä»¥ç”¨æ¥è£…é…bean. éƒ½å¯ä»¥å†™åœ¨å­—æ®µä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Šã€‚ 2ã€@Autowiredé»˜è®¤æŒ‰ç±»åž‹è£…é…ï¼ˆè¿™ä¸ªæ³¨è§£æ˜¯å±žäºŽspringçš„ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å¿…é¡»è¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æžœè¦å…è®¸nullå€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒçš„requiredå±žæ€§ä¸ºfalseï¼Œå¦‚ï¼š@Autowired(required=false) ï¼Œå¦‚æžœæˆ‘ä»¬æƒ³ä½¿ç”¨åç§°è£…é…å¯ä»¥ç»“åˆ@Qualifieræ³¨è§£è¿›è¡Œä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š 12@Autowired()@Qualifier("baseDao")privateBaseDao baseDao; 3ã€@Resourceï¼ˆè¿™ä¸ªæ³¨è§£å±žäºŽJ2EEçš„ï¼‰ï¼Œé»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œåç§°å¯ä»¥é€šè¿‡nameå±žæ€§è¿›è¡ŒæŒ‡å®šï¼Œå¦‚æžœæ²¡æœ‰æŒ‡å®šnameå±žæ€§ï¼Œå½“æ³¨è§£å†™åœ¨å­—æ®µä¸Šæ—¶ï¼Œé»˜è®¤å–å­—æ®µåè¿›è¡Œè£…é…æŸ¥æ‰¾ï¼Œå¦‚æžœæ³¨è§£å†™åœ¨setteræ–¹æ³•ä¸Šé»˜è®¤å–å±žæ€§åè¿›è¡Œè£…é…ã€‚å½“æ‰¾ä¸åˆ°ä¸Žåç§°åŒ¹é…çš„beanæ—¶æ‰æŒ‰ç…§ç±»åž‹è¿›è¡Œè£…é…ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æžœnameå±žæ€§ä¸€æ—¦æŒ‡å®šï¼Œå°±åªä¼šæŒ‰ç…§åç§°è¿›è¡Œè£…é…ã€‚ 12@Resource(name="baseDao")privateBaseDao baseDao; æŽ¨èä½¿ç”¨ï¼š@Resourceæ³¨è§£åœ¨å­—æ®µä¸Šï¼Œè¿™æ ·å°±ä¸ç”¨å†™setteræ–¹æ³•äº†ï¼Œå¹¶ä¸”è¿™ä¸ªæ³¨è§£æ˜¯å±žäºŽJ2EEçš„ï¼Œå‡å°‘äº†ä¸Žspringçš„è€¦åˆã€‚è¿™æ ·ä»£ç çœ‹èµ·å°±æ¯”è¾ƒä¼˜é›…ã€‚ Spring @Qualifieræ³¨è§£ @Autowiredæ˜¯æ ¹æ®ç±»åž‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ã€‚å¦‚æžœå½“Springä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ä¸æ­¢ä¸€ä¸ªUserDaoç±»åž‹çš„beanæ—¶ï¼Œå°±ä¼šæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸;å¦‚æžœSpringä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨UserDaoç±»åž‹çš„beanï¼Œä¹Ÿä¼šæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Qualifieré…åˆ@Autowiredæ¥è§£å†³è¿™äº›é—®é¢˜ã€‚å¦‚ä¸‹ï¼š å¯èƒ½å­˜åœ¨å¤šä¸ªUserDaoå®žä¾‹ 123@Autowired @Qualifier("userServiceImpl") public IUserService userService; æˆ–è€… 1234@Autowired public void setUserDao(@Qualifier("userDao") UserDao userDao) &#123; this.userDao = userDao; &#125; è¿™æ ·Springä¼šæ‰¾åˆ°idä¸ºuserServiceImplå’ŒuserDaoçš„beanè¿›è¡Œè£…é…ã€‚ å¯èƒ½ä¸å­˜åœ¨UserDaoå®žä¾‹ 12@Autowired(required = false) public IUserService userService æ€»ç»“ @Autowired é»˜è®¤æŒ‰typeæ³¨å…¥ @Qualifier(&quot;baseDao&quot;) ä¸€èˆ¬ä½œä¸º@Autowired()çš„ä¿®é¥°ç”¨ @Resource(name=&quot;baseDao&quot;) é»˜è®¤æŒ‰nameæ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡nameå’Œtypeå±žæ€§è¿›è¡Œé€‰æ‹©æ€§æ³¨å…¥ ä¸€èˆ¬@Autowiredå’Œ@Qualifierä¸€èµ·ç”¨ï¼Œ@Resourceå•ç‹¬ç”¨ã€‚å½“ç„¶æ²¡æœ‰å†²çªçš„è¯@Autowiredä¹Ÿå¯ä»¥å•ç‹¬ç”¨ã€‚ å¸¸ç”¨æ³¨è§£ å£°æ˜ŽBeançš„æ³¨è§£ 1234//å®šä¹‰æŽ§åˆ¶å±‚Bean,å¦‚Action@Controller@Controller("Beançš„åç§°") 1234//å®šä¹‰ä¸šåŠ¡é€»è¾‘å±‚Bean@Service @Service("Beançš„åç§°") 1234//å®šä¹‰DAOå±‚/æ•°æ®è®¿é—®å±‚Bean@Repository @Repository("Beançš„åç§°") 12//å®šä¹‰Bean, ä¸å¥½å½’ç±»æ—¶ä½¿ç”¨.@Component è‡ªåŠ¨è£…é…Bean 12//é»˜è®¤æŒ‰ç±»åž‹åŒ¹é…,è‡ªåŠ¨è£…é…(Srpingæä¾›çš„)ï¼Œå¯ä»¥å†™åœ¨æˆå‘˜å±žæ€§ä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Š@Autowired 12//ä¸€å®šè¦æ‰¾åˆ°åŒ¹é…çš„Beanï¼Œå¦åˆ™æŠ›å¼‚å¸¸ã€‚ é»˜è®¤å€¼å°±æ˜¯true@Autowired(required=true) 123//æŒ‰åç§°è£…é…Bean,ä¸Ž@Autowiredç»„åˆä½¿ç”¨ï¼Œè§£å†³æŒ‰ç±»åž‹åŒ¹é…æ‰¾åˆ°å¤šä¸ªBeané—®é¢˜ã€‚@Autowired@Qualifier("beançš„åå­—") 123456//JSR-250æä¾›çš„,é»˜è®¤æŒ‰åç§°è£…é…,å½“æ‰¾ä¸åˆ°åç§°åŒ¹é…çš„beanå†æŒ‰ç±»åž‹è£…é….å¯ä»¥å†™åœ¨æˆå‘˜å±žæ€§ä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Š@Resource //å¯ä»¥é€šè¿‡@Resource(name="beanName") æŒ‡å®šè¢«æ³¨å…¥çš„beançš„åç§°, è¦æ˜¯æœªæŒ‡å®šnameå±žæ€§, é»˜è®¤ä½¿ç”¨æˆå‘˜å±žæ€§çš„å˜é‡å,ä¸€èˆ¬ä¸ç”¨å†™nameå±žæ€§.@Resource(name="beanName") 12//æ˜¯JSR-330æä¾›çš„,æŒ‰ç±»åž‹è£…é…ï¼ŒåŠŸèƒ½æ¯”@Autowiredå°‘ï¼Œæ²¡æœ‰ä½¿ç”¨çš„å¿…è¦ã€‚@Inject Javaé…ç½®ç±» @Configuration å£°æ˜Žå½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œç›¸å½“äºŽxmlå½¢å¼çš„Springé…ç½®ï¼ˆç±»ä¸Šï¼‰ @Bean æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜Žå½“å‰æ–¹æ³•çš„è¿”å›žå€¼ä¸ºä¸€ä¸ªbeanï¼Œæ›¿ä»£xmlä¸­çš„æ–¹å¼ï¼ˆæ–¹æ³•ä¸Šï¼‰ @Configuration å£°æ˜Žå½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œå…¶ä¸­å†…éƒ¨ç»„åˆäº†@Componentæ³¨è§£ï¼Œè¡¨æ˜Žè¿™ä¸ªç±»æ˜¯ä¸€ä¸ªbeanï¼ˆç±»ä¸Šï¼‰ @ComponentScan ç”¨äºŽå¯¹Componentè¿›è¡Œæ‰«æï¼Œç›¸å½“äºŽxmlä¸­çš„ï¼ˆç±»ä¸Šï¼‰ @WishlyConfiguration ä¸º@Configurationä¸Ž@ComponentScançš„ç»„åˆæ³¨è§£ï¼Œå¯ä»¥æ›¿ä»£è¿™ä¸¤ä¸ªæ³¨è§£ åˆ‡é¢ï¼ˆAOPï¼‰ Springæ”¯æŒAspectJçš„æ³¨è§£å¼åˆ‡é¢ç¼–ç¨‹ã€‚ @Aspect å£°æ˜Žä¸€ä¸ªåˆ‡é¢ï¼ˆç±»ä¸Šï¼‰ ä½¿ç”¨@Afterã€@Beforeã€@Aroundå®šä¹‰å»ºè¨€ï¼ˆadviceï¼‰ï¼Œå¯ç›´æŽ¥å°†æ‹¦æˆªè§„åˆ™ï¼ˆåˆ‡ç‚¹ï¼‰ä½œä¸ºå‚æ•°ã€‚ @After åœ¨æ–¹æ³•æ‰§è¡Œä¹‹åŽæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @Before åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @Around åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰ä¸Žä¹‹åŽæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @PointCut å£°æ˜Žåˆ‡ç‚¹ åœ¨javaé…ç½®ç±»ä¸­ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£å¼€å¯Springå¯¹AspectJä»£ç†çš„æ”¯æŒï¼ˆç±»ä¸Šï¼‰ å®šä¹‰Beançš„ä½œç”¨åŸŸå’Œç”Ÿå‘½è¿‡ç¨‹ 1234567891011121314//è®¾ç½®Springå®¹å™¨å¦‚ä½•æ–°å»ºBeanå®žä¾‹ï¼ˆæ–¹æ³•ä¸Šï¼Œå¾—æœ‰@Beanï¼‰@Scope("prototype")å…¶è®¾ç½®ç±»åž‹åŒ…æ‹¬ï¼šSingleton ï¼ˆå•ä¾‹,ä¸€ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªbeanå®žä¾‹ï¼Œé»˜è®¤æ¨¡å¼ï¼‰,Protetype ï¼ˆæ¯æ¬¡è°ƒç”¨æ–°å»ºä¸€ä¸ªbeanï¼‰,Request ï¼ˆwebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸ªhttp requestæ–°å»ºä¸€ä¸ªbeanï¼‰,Session ï¼ˆwebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸ªhttp sessionæ–°å»ºä¸€ä¸ªbeanï¼‰,GlobalSessionï¼ˆç»™æ¯ä¸€ä¸ª global http sessionæ–°å»ºä¸€ä¸ªBeanå®žä¾‹ï¼‰ 12//ç›¸å½“äºŽinit-method,ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå½“Beanåˆå§‹åŒ–æ—¶æ‰§è¡Œã€‚@PostConstruct 12//ç›¸å½“äºŽdestory-methodï¼Œä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå½“Beané”€æ¯æ—¶æ‰§è¡Œã€‚@PreDestroy å£°æ˜Žå¼äº‹åŠ¡ 1@Transactional @Value @Value ä¸ºå±žæ€§æ³¨å…¥å€¼ï¼ˆå±žæ€§ä¸Šï¼‰æ”¯æŒå¦‚ä¸‹æ–¹å¼çš„æ³¨å…¥ï¼š æ³¨å…¥æ™®é€šå­—ç¬¦ 12@Value("Tom")String name; æ³¨å…¥æ“ä½œç³»ç»Ÿå±žæ€§ 12@Value("#&#123;systemProperties['os.name']&#125;")String osName; æ³¨å…¥è¡¨è¾¾å¼ç»“æžœ 12@Value("#&#123;T(java.lang.Math).random() * 100&#125;")String randomNumber; æ³¨å…¥å…¶ä»–beanå±žæ€§ 12@Value("#&#123;demoClass.name&#125;")String name; æ³¨å…¥æ–‡ä»¶èµ„æº 12@Value("classpath:com/springboot/study/hello/test.txt")String resourceFile; æ³¨å…¥ç½‘ç«™èµ„æº 12@Value("http://www.baiduc.om")Resource url; æ³¨å…¥é…ç½®æ–‡ä»¶ 12@Value("$&#123;book.name&#125;")String bookName; çŽ¯å¢ƒåˆ‡æ¢ @Profile é€šè¿‡è®¾å®šEnvironmentçš„ActiveProfilesæ¥è®¾å®šå½“å‰contextéœ€è¦ä½¿ç”¨çš„é…ç½®çŽ¯å¢ƒã€‚ï¼ˆç±»æˆ–æ–¹æ³•ä¸Šï¼‰ @Conditional Spring4ä¸­å¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£å®šä¹‰æ¡ä»¶åŒ–çš„beanï¼Œé€šè¿‡å®žçŽ°ConditionæŽ¥å£ï¼Œå¹¶é‡å†™matchesæ–¹æ³•ï¼Œä»Žè€Œå†³å®šè¯¥beanæ˜¯å¦è¢«å®žä¾‹åŒ–ã€‚ï¼ˆæ–¹æ³•ä¸Šï¼‰ å¼‚æ­¥ @EnableAsync é…ç½®ç±»ä¸­ï¼Œé€šè¿‡æ­¤æ³¨è§£å¼€å¯å¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒï¼Œå™äº‹æ€§AsyncConfigureræŽ¥å£ï¼ˆç±»ä¸Šï¼‰ @Async åœ¨å®žé™…æ‰§è¡Œçš„beanæ–¹æ³•ä½¿ç”¨è¯¥æ³¨è§£æ¥ç”³æ˜Žå…¶æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼ˆæ–¹æ³•ä¸Šæˆ–ç±»ä¸Šæ‰€æœ‰çš„æ–¹æ³•éƒ½å°†å¼‚æ­¥ï¼Œéœ€è¦@EnableAsyncå¼€å¯å¼‚æ­¥ä»»åŠ¡ï¼‰ å®šæ—¶ä»»åŠ¡ @EnableScheduling åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ï¼Œå¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒï¼ˆç±»ä¸Šï¼‰ @Scheduled æ¥ç”³æ˜Žè¿™æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼ŒåŒ…æ‹¬cron,fixDelay,fixRateç­‰ç±»åž‹ï¼ˆæ–¹æ³•ä¸Šï¼Œéœ€å…ˆå¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒï¼‰ @Enable* è¿™äº›æ³¨è§£ä¸»è¦ç”¨æ¥å¼€å¯å¯¹xxxçš„æ”¯æŒã€‚ @EnableAspectJAutoProxy å¼€å¯å¯¹AspectJè‡ªåŠ¨ä»£ç†çš„æ”¯æŒ @EnableAsync å¼€å¯å¼‚æ­¥æ–¹æ³•çš„æ”¯æŒ @EnableScheduling å¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒ @EnableWebMvc å¼€å¯Web MVCçš„é…ç½®æ”¯æŒ @EnableConfigurationProperties å¼€å¯å¯¹@ConfigurationPropertiesæ³¨è§£é…ç½®Beançš„æ”¯æŒ @EnableJpaRepositories å¼€å¯å¯¹SpringData JPA Repositoryçš„æ”¯æŒ @EnableTransactionManagement å¼€å¯æ³¨è§£å¼äº‹åŠ¡çš„æ”¯æŒ @EnableCaching å¼€å¯æ³¨è§£å¼çš„ç¼“å­˜æ”¯æŒ æµ‹è¯• @RunWith è¿è¡Œå™¨ï¼ŒSpringä¸­é€šå¸¸ç”¨äºŽå¯¹JUnitçš„æ”¯æŒ 1@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration ç”¨æ¥åŠ è½½é…ç½®ApplicationContextï¼Œå…¶ä¸­classeså±žæ€§ç”¨æ¥åŠ è½½é…ç½®ç±» 1@ContextConfiguration(classes=&#123;Test.class&#125;) SpringMVC @EnableWebMvc åœ¨é…ç½®ç±»ä¸­å¼€å¯Web MVCçš„é…ç½®æ”¯æŒï¼Œå¦‚ä¸€äº›ViewResolveræˆ–è€…MessageConverterç­‰ï¼Œè‹¥æ— æ­¤å¥ï¼Œé‡å†™WebMvcConfigurerAdapteræ–¹æ³•ï¼ˆç”¨äºŽå¯¹SpringMVCçš„é…ç½®ï¼‰ã€‚ @Controller å£°æ˜Žè¯¥ç±»ä¸ºSpringMVCä¸­çš„Controller @RequestMapping ç”¨äºŽæ˜ å°„Webè¯·æ±‚ï¼ŒåŒ…æ‹¬è®¿é—®è·¯å¾„å’Œå‚æ•°ï¼ˆç±»æˆ–æ–¹æ³•ä¸Šï¼‰ @ResponseBody æ”¯æŒå°†è¿”å›žå€¼æ”¾åœ¨responseå†…ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œé€šå¸¸ç”¨æˆ·è¿”å›žjsonæ•°æ®ï¼ˆè¿”å›žå€¼æ—æˆ–æ–¹æ³•ä¸Šï¼‰ @RequestBody å…è®¸requestçš„å‚æ•°åœ¨requestä½“ä¸­ï¼Œè€Œä¸æ˜¯ç›´æŽ¥è¿žæŽ¥åœ¨åœ°å€åŽé¢ã€‚ï¼ˆæ”¾åœ¨å‚æ•°å‰ï¼‰ @PathVariable ç”¨äºŽæŽ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚@RequestMapping(â€œ/hello/{name}â€)ç”³æ˜Žçš„è·¯å¾„ï¼Œå°†æ³¨è§£æ”¾åœ¨å‚æ•°å‰ï¼Œå³å¯èŽ·å–è¯¥å€¼ï¼Œé€šå¸¸ä½œä¸ºRestfulçš„æŽ¥å£å®žçŽ°æ–¹æ³•ã€‚ @RestController è¯¥æ³¨è§£ä¸ºä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç›¸å½“äºŽ@Controllerå’Œ@ResponseBodyçš„ç»„åˆï¼Œæ³¨è§£åœ¨ç±»ä¸Šï¼Œæ„å‘³ç€ï¼Œè¯¥Controllerçš„æ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤åŠ ä¸Šäº†@ResponseBodyã€‚ @ControllerAdvice é€šè¿‡è¯¥æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹äºŽæŽ§åˆ¶å™¨çš„å…¨å±€é…ç½®æ”¾ç½®åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œæ³¨è§£äº†@Controllerçš„ç±»çš„æ–¹æ³•å¯ä½¿ç”¨@ExceptionHandlerã€@InitBinderã€@ModelAttributeæ³¨è§£åˆ°æ–¹æ³•ä¸Šï¼Œè¿™å¯¹æ‰€æœ‰æ³¨è§£äº† @RequestMappingçš„æŽ§åˆ¶å™¨å†…çš„æ–¹æ³•æœ‰æ•ˆã€‚ @ExceptionHandler ç”¨äºŽå…¨å±€å¤„ç†æŽ§åˆ¶å™¨é‡Œçš„å¼‚å¸¸ @InitBinder ç”¨æ¥è®¾ç½®WebDataBinderï¼ŒWebDataBinderç”¨æ¥è‡ªåŠ¨ç»‘å®šå‰å°è¯·æ±‚å‚æ•°åˆ°Modelä¸­ã€‚ @ModelAttribute æœ¬æ¥çš„ä½œç”¨æ˜¯ç»‘å®šé”®å€¼å¯¹åˆ°Modelé‡Œï¼Œåœ¨@ControllerAdviceä¸­æ˜¯è®©å…¨å±€çš„@RequestMappingéƒ½èƒ½èŽ·å¾—åœ¨æ­¤å¤„è®¾ç½®çš„é”®å€¼å¯¹ã€‚ ä¸ºä»€ä¹ˆå»ºè®®æž„é€ å™¨æ³¨å…¥ æž„é€ å™¨æ³¨å…¥ä¸ŽåŸŸæ³¨å…¥ çƒ­é—¨æ–‡ç«  Why field injection is evil ç»™å‡ºæ€»ç»“ï¼š Field injection: less code to write; unsafe code; more complicated to test; Constructor injection: safe code; more code to write (see the hint to Lombok); easy to test; Spring çš„åšå®¢ä¸ŠæŒ‡å‡º Setter injection versus constructor injection and the use of @Required è§£å†³æ–¹æ¡ˆ ä¹¦å½’æ­£ä¼ ï¼Œè¯´ä¸‹å¦‚ä½•å‰”é™¤Intellijä¸­Mybatisçš„Mapperè‡ªåŠ¨æ³¨å…¥è­¦å‘Šã€‚ æ–¹æ³•1ï¼šä¸º @Autowired æ³¨è§£è®¾ç½®required = false ä½¿ç”¨ @Autowired æ³¨è§£æ—¶ï¼Œè‹¥å¸Œæœ›å…è®¸nullå€¼ï¼Œå¯è®¾ç½®required = falseï¼Œåƒè¿™æ ·ï¼š 12@Autowired(required = false)private UserMapper userMapper; è¿™æ ·å°±ä¸ä¼šæœ‰è­¦å‘Šäº†ã€‚åŽŸå› å¾ˆå¥½ç†è§£ï¼šIDEAè®¤ä¸ºuserMapperæ˜¯ä¸ªnullï¼Œç»™äº†è­¦å‘Šï¼›åŠ ä¸Šrequired = falseåŽï¼Œä½¿ç”¨ @Autowired æ³¨è§£ä¸å†åŽ»æ ¡éªŒuserMapperæ˜¯å¦å­˜åœ¨äº†ã€‚ä¹Ÿå°±ä¸ä¼šæœ‰è­¦å‘Šäº†ã€‚ æ–¹æ³•2ï¼šç”¨ @Resource æ›¿æ¢ @Autowired 12@Resourceprivate UserMapper userMapper; æ–¹æ³•3ï¼šåœ¨MapperæŽ¥å£ä¸ŠåŠ ä¸Š@Repositoryæ³¨è§£ 123@Repositorypublic interface UserMapper extends Mapper&lt;User&gt; &#123;&#125; è¿™æ ·ä¹Ÿèƒ½è®©ä½ çš„ 12@Autowiredprivate UserMapper userMapper; ä¸å†æŠ¥é”™ã€‚å½“ç„¶ï¼Œå¦‚æžœä½ ç”¨@Componentæ›¿æ¢@Repositoryä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åŽŸç†å¤§è‡´ï¼šIDEAä¸æ˜¯è®¤ä¸º userMapper æ˜¯ä¸ªnullå˜›â€¦åŠ ä¸ª@Repositoryæ³¨è§£éª—ä¸€ä¸‹IDEAå°±OKäº†â€¦â€¦ æ–¹æ³•4ï¼šç”¨Lombok 123456@Service@RequiredArgsConstructor(onConstructor = @__(@Autowired))public class TestService &#123; private final UserMapper userMapper; ...&#125; Lombokç”Ÿæˆçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š 123456789@Servicepublic class TestService &#123; private final UserMapper userMapper; @Autowired public TestService(final UserMapper userMapper) &#123; this.userMapper = userMapper; &#125; ...&#125; ä½†å¦‚æžœè‡ªå·±æ‰‹å†™æˆLombokç”Ÿæˆçš„ä»£ç ï¼ŒIDEAä¾ç„¶ä¼šç»™ä½ æŠ¥è­¦å‘Š ã€‚æˆ‘çŒœï¼Œåº”è¯¥æ˜¯IDEAçš„Lombokæ’ä»¶æŠŠIDEAæžæ‡µé€¼äº†â€¦æ‰€ä»¥ä¸æç¤ºäº†â€¦ æ–¹æ³•5ï¼šæŠŠIDEAçš„è­¦å‘Šå…³é—­æŽ‰ ä¸ªäººæ²¡è¯•è¿‡ã€‚ æ–¹æ³•6ï¼šå®‰è£…mybatis plugin æ®è¯´å®‰è£…mybatis pluginå¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚]]></content>
      <categories>
        <category>Spring</category>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¿®æ”¹GitHubé¡¹ç›®è¯­è¨€æ˜¾ç¤ºé—®é¢˜]]></title>
    <url>%2Fposts%2F559b1d56.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° å½“æˆ‘ä»¬ä¸Šä¼ é¡¹ç›®åˆ°GitHubä¸Šï¼Œæœ‰æ—¶å€™é¡¹ç›®æ˜¾ç¤ºçš„è¯­è¨€å¹¶éžæ˜¯æˆ‘ä»¬è‡ªå·±é¡¹ç›®æ‰€ç¤ºçš„è¯­è¨€ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬åœ¨å¿«é€Ÿæ£€ç´¢ï¼Œ æˆ–è€…å¤–éƒ¨è®¿é—®è€…è®¿é—®æ—¶ä¸èƒ½å¤Ÿæœç´¢åˆ°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶å°±å¾ˆæœ‰å¿…è¦ä¿®æ”¹ä¸‹è¯­è¨€ã€‚ ä¿®æ”¹GitHubè¯­è¨€ 1ã€åœ¨æœ¬åœ°é¡¹ç›®ä¸­æˆ–è€…GitHubé¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ª .gitattributesçš„æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š 12345*.yml linguist-language=Java *.html linguist-language=Java *.js linguist-language=Java *.xml linguist-language=Java*.css linguist-language=Java éœ€è¦è¯´æ˜Žçš„æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰å¾ˆå¤šçš„è¯¸å¦‚.htmlã€.jsç­‰æ–‡ä»¶ï¼Œåœ¨GitHubä¸Šä¼šæ˜¾ç¤ºä¸ºHTMLã€JavaScriptï¼Œ æ‰€ä»¥.gitattributesæ–‡ä»¶å†…å®¹çš„æ„æ€å°±æ˜¯å°†å¿½ç•¥.xxä»€ä¹ˆä»€ä¹ˆæ–‡ä»¶ï¼Œç„¶åŽå°†å…¶è¯­è¨€æ›´æ”¹ä¸ºJavaï¼Œå¦‚æžœä½ çš„é¡¹ç›® æ˜¯å…¶ä»–è¯­è¨€ï¼Œè¯¸å¦‚C++ç­‰å°±å°†Javaä¿®æ”¹ä¸ºC++ç­‰ã€‚ å½“ç„¶äº†ï¼Œè¿™æ ·ä¿®æ”¹ä¹Ÿè®¸è¿˜ä¸èƒ½å°†ä½ çš„é¡¹ç›®è¯­è¨€ä¿®æ”¹æˆåŠŸï¼Œæ‰€ä»¥ä½ éœ€è¦åŽ»æŸ¥è¯¢ä½ é¡¹ç›®ä¸­æ‰€æœ‰å°½å¯èƒ½çš„åŽç¼€åæ–‡ä»¶ å½±å“è¯­è¨€çš„æƒ…å†µè€ƒè™‘ï¼Œè¦æ ¹æ®GitHubç»™ä½ å½“å‰é¡¹ç›®è®¾å®šçš„æ˜¯ä»€ä¹ˆè¯­è¨€ï¼Œå°±ä»Žä»€ä¹ˆè¯­è¨€åŽ»è€ƒè™‘å°±å¥½äº†ã€‚ æ‰€ä»¥åœ¨.gitattributesæ–‡ä»¶ä¸­æ·»åŠ å¤šä¸€äº›å±žæ€§å°±è§£å†³äº†ã€‚å¦‚ä¸‹ï¼š 123456789*.md linguist-language=Java *.yml linguist-language=Java *.html linguist-language=Java *.js linguist-language=Java *.xml linguist-language=Java*.css linguist-language=Java *.sql linguist-language=Java*.uml linguist-language=Java *.cmd linguist-language=Java]]></content>
      <categories>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-æœåŠ¡å™¨çŠ¶æ€ã€æ€§èƒ½ç›¸å…³å‘½ä»¤]]></title>
    <url>%2Fposts%2Fc91a35ad.html</url>
    <content type="text"><![CDATA[æœåŠ¡å™¨çŠ¶æ€åˆ†æž æŸ¥çœ‹CPUçš„ä¿¡æ¯ æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•° æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUçš„æ ¸æ•° é€»è¾‘CPUçš„ä¸ªæ•° é€»è¾‘CPU = ç‰©ç†CPUä¸ªæ•°*æ ¸æ•° æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ totalï¼šå†…å­˜æ€»æ•° userï¼šå·²ä½¿ç”¨å†…å­˜æ•° freeï¼šç©ºé—²å†…å­˜æ•° sharedï¼šå¤šè¿›ç¨‹å…±äº«å†…å­˜æ•° buffersï¼šç¼“å†²å†…å­˜æ•° cachedï¼šç¼“å­˜å†…å­˜æ•° å¯ç”¨å†…å­˜ = free+buffers+cached å·²ç”¨å†…å­˜ = used-buffers-cached swap äº¤æ¢å†…å­˜æ•°ï¼Œæ­¤é¡¹å¯åˆ¤æ–­å†…å­˜æ˜¯å¦å¤Ÿç”¨çš„æ ‡å‡† æŸ¥çœ‹ç¡¬ç›˜åŠåˆ†åŒºä¿¡æ¯ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µ æœåŠ¡å™¨æ€§èƒ½åˆ†æž æŸ¥çœ‹ç¡¬ç›˜I/Oæ€§èƒ½ æŸ¥çœ‹æœåŠ¡å™¨çš„å¹³å‡è´Ÿè½½ ç›‘æŽ§æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½ proces r:ç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•° b:éžä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•° w:è¢«äº¤æ¢å‡ºåŽ»çš„å¯è¿è¡Œè¿›ç¨‹æ•° memory swpd:è™šæ‹Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ fres:ç©ºé—²çš„å†…å­˜ buff:ç”¨ä½œç¼“å­˜çš„å†…å­˜æ•°ï¼ˆå•ä½:KBï¼‰ swap si:ä»Žç£ç›˜äº¤æ¢åˆ°å†…å­˜çš„äº¤æ¢é¡µæ•°é‡ so:ä»Žå†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„äº¤æ¢é¡µæ•°é‡ï¼ˆå•ä½:kb/ç§’ï¼‰ io bi:å‘é€åˆ°å—è®¾å¤‡çš„å—æ•° bo:ä»Žå—è®¾å¤‡æŽ¥æ”¶åˆ°çš„å—æ•°ï¼ˆå•ä½:å—/ç§’ï¼‰ system in:æ¯ç§’çš„ä¸­æ–­æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­ cs:æ¯ç§’çš„çŽ¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰åˆ‡æ¢æ•° cpu us:CPUä½¿ç”¨æ—¶é—´ sy:CPUç³»ç»Ÿä½¿ç”¨æ—¶é—´ id:é—²ç½®æ—¶é—´ï¼ˆå•ä½:ç™¾åˆ†æ¯”ï¼‰ æ ‡å‡†æƒ…å†µä¸‹:rå°äºŽ5,bçº¦ä¸º0 å¦‚æžœuser + sys å°äºŽ70 è¡¨ç¤ºç³»ç»Ÿæ€§èƒ½è¾ƒå¥½ï¼›å¦‚æžœå¤§äºŽç­‰äºŽ85ä»¥ä¸Šï¼Œè¡¨ç¤ºæ€§èƒ½æ¯”è¾ƒç³Ÿç³• æŸ¥çœ‹LinuxæœåŠ¡å™¨çš„å…¶ä»–å‚æ•° æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸çš„ç‰ˆæœ¬å·]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLè§„èŒƒ]]></title>
    <url>%2Fposts%2F33a2a570.html</url>
    <content type="text"><![CDATA[æ•°æ®åº“å‘½åè§„èŒƒ æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚ æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨ MySQL ä¿ç•™å…³é”®å­—ï¼ˆå¦‚æžœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰ã€‚ æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€åŽä¸è¦è¶…è¿‡32 ä¸ªå­—ç¬¦ã€‚ ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥ tmp_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåŽç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥ bak_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ ( æ—¶é—´æˆ³ ) ä¸ºåŽç¼€ã€‚ æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»åž‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æžœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»åž‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»åž‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆçŽ‡é™ä½Žï¼‰ã€‚ æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ InnoDB æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“Žï¼ˆMySQL5.5 ä¹‹å‰é»˜è®¤ä½¿ç”¨ Myisamï¼Œ5.6 ä»¥åŽé»˜è®¤çš„ä¸º InnoDBï¼‰InnoDB æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒè¡Œçº§é”ï¼Œæ›´å¥½çš„æ¢å¤æ€§ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ã€‚ æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8ï¼Œå…¼å®¹æ€§æ›´å¥½ã€‚ç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºŽå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆã€‚ æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Šï¼Œä½¿ç”¨ comment ä»Žå¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ ä»Žä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤ã€‚ å°½é‡æŽ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æŽ§åˆ¶åœ¨500ä¸‡ä»¥å†…ï¼Œ500ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æž„ã€å¤‡ä»½ã€æ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨åŽ†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºŽæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºŽä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æŽ§åˆ¶æ•°æ®é‡å¤§å°ã€‚ è°¨æ…Žä½¿ç”¨ MySQL åˆ†åŒºè¡¨ã€‚åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨çŽ°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨çŽ°ä¸ºä¸€ä¸ªè¡¨ã€‚è°¨æ…Žé€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆçŽ‡å¯èƒ½æ›´ä½Žï¼Œå»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ®ã€‚ å°½é‡åšåˆ°å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œå‡å°è¡¨çš„å®½åº¦ã€‚MySQL é™åˆ¶æ¯ä¸ªè¡¨æœ€å¤šå­˜å‚¨ 4096 åˆ—ï¼Œå¹¶ä¸”æ¯ä¸€è¡Œæ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡ 65535 å­—èŠ‚ã€‚å‡å°‘ç£ç›˜ IOï¼Œä¿è¯çƒ­æ•°æ®çš„å†…å­˜ç¼“å­˜å‘½ä¸­çŽ‡ï¼ˆè¡¨è¶Šå®½ï¼ŒæŠŠè¡¨è£…è½½è¿›å†…å­˜ç¼“å†²æ± æ—¶æ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§,ä¹Ÿä¼šæ¶ˆè€—æ›´å¤šçš„ IOï¼‰ æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç¼“å­˜ï¼Œé¿å…è¯»å…¥æ— ç”¨çš„å†·æ•°æ®ï¼›ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼ˆé¿å…æ›´å¤šçš„å…³è”æ“ä½œï¼‰ ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ®ã€‚é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼Œä¼šçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢žé•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éšæœº IO æ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIO æ“ä½œå¾ˆè€—æ—¶ã€‚é€šå¸¸å­˜å‚¨äºŽæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚ ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“åŽ‹åŠ›æµ‹è¯•ã€‚ ç¦æ­¢ä»Žå¼€å‘çŽ¯å¢ƒï¼Œæµ‹è¯•çŽ¯å¢ƒç›´æŽ¥è¿žæŽ¥ç”Ÿäº§çŽ¯å¢ƒæ•°æ®åº“ã€‚ æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»åž‹ åˆ—çš„å­—æ®µè¶Šå¤§ï¼Œå»ºç«‹ç´¢å¼•æ—¶æ‰€éœ€è¦çš„ç©ºé—´ä¹Ÿå°±è¶Šå¤§ï¼Œè¿™æ ·ä¸€é¡µä¸­æ‰€èƒ½å­˜å‚¨çš„ç´¢å¼•èŠ‚ç‚¹çš„æ•°é‡ä¹Ÿå°±è¶Šå°‘ï¼Œåœ¨éåŽ†æ—¶æ‰€éœ€è¦çš„IOæ¬¡æ•°ä¹Ÿå°±è¶Šå¤šï¼Œç´¢å¼•çš„æ€§èƒ½ä¹Ÿå°±è¶Šå·®ã€‚ å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ç±»åž‹å­˜å‚¨ï¼Œå¦‚ï¼šå°†IPåœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ®ã€‚ MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† IP åœ°å€ inet_aton æŠŠipè½¬ä¸ºæ— ç¬¦å·æ•´åž‹(4-8ä½) inet_ntoa æŠŠæ•´åž‹çš„ipè½¬ä¸ºåœ°å€ æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ inet_aton æŠŠ IP åœ°å€è½¬ä¸ºæ•´åž‹ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ã€‚æ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ inet_ntoa æŠŠæ•´åž‹çš„ IP åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚ å¯¹äºŽéžè´Ÿåž‹çš„æ•°æ®ï¼ˆå¦‚è‡ªå¢ž IDã€æ•´åž‹ IPï¼‰æ¥è¯´ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´åž‹æ¥å­˜å‚¨,å› ä¸ºæ— ç¬¦å·ç›¸å¯¹äºŽæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´ã€‚ SIGNED INT -2147483648~2147483647 UNSIGNED INT 0~4294967295 VARCHAR(N) ä¸­çš„ N ä»£è¡¨çš„æ˜¯å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚ä½¿ç”¨ UTF8 å­˜å‚¨ 255 ä¸ªæ±‰å­— Varchar(255)=765 ä¸ªå­—èŠ‚ã€‚è¿‡å¤§çš„é•¿åº¦ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚ é¿å…ä½¿ç”¨ TEXTã€BLOB æ•°æ®ç±»åž‹ æœ€å¸¸è§çš„TEXTç±»åž‹å¯ä»¥å­˜å‚¨64kçš„æ•°æ®ï¼Œå»ºè®®æŠŠ BLOB æˆ–æ˜¯TEXTåˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ã€‚ MySQL å†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒ TEXTã€BLOB è¿™æ ·çš„å¤§æ•°æ®ç±»åž‹ï¼Œå¦‚æžœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æŽ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨è¿›è¡Œã€‚ è€Œä¸”å¯¹äºŽè¿™ç§æ•°æ®ï¼ŒMySQL è¿˜æ˜¯è¦è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œä¼šä½¿ SQL æ€§èƒ½å˜å¾—å¾ˆå·®ï¼Œä½†æ˜¯ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç±»åž‹ã€‚ å¦‚æžœä¸€å®šè¦ä½¿ç”¨ï¼Œå»ºè®®æŠŠ BLOB æˆ–æ˜¯ TEXT åˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šä¸è¦ä½¿ç”¨ select * è€Œåªéœ€è¦å–å‡ºå¿…è¦çš„åˆ—ï¼Œä¸éœ€è¦ TEXT åˆ—çš„æ•°æ®æ—¶ä¸è¦å¯¹è¯¥åˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚ TEXT æˆ– BLOB ç±»åž‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•,å› ä¸º MySQL å¯¹ç´¢å¼•å­—æ®µé•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥ TEXT ç±»åž‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹¶ä¸” TEXT åˆ—ä¸Šæ˜¯ä¸èƒ½æœ‰é»˜è®¤å€¼çš„ã€‚ é¿å…ä½¿ç”¨ ENUM ç±»åž‹ ä¿®æ”¹ ENUM å€¼éœ€è¦ä½¿ç”¨ ALTER è¯­å¥ ENUM ç±»åž‹çš„ ORDER BY æ“ä½œæ•ˆçŽ‡ä½Žï¼Œéœ€è¦é¢å¤–æ“ä½œ ç¦æ­¢ä½¿ç”¨æ•°å€¼ä½œä¸º ENUM çš„æžšä¸¾å€¼ å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL ç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†ã€‚ ä½¿ç”¨ TIMESTAMPï¼ˆ4 ä¸ªå­—èŠ‚ï¼‰æˆ– DATETIME ç±»åž‹ï¼ˆ8 ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æ—¶é—´ TIMESTAMP å­˜å‚¨çš„æ—¶é—´èŒƒå›´ 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07ã€‚ TIMESTAMP å ç”¨ 4 å­—èŠ‚å’Œ INT ç›¸åŒï¼Œä½†æ¯” INT å¯è¯»æ€§é«˜ï¼Œè¶…å‡º TIMESTAMP å–å€¼èŒƒå›´çš„ä½¿ç”¨ DATETIME ç±»åž‹å­˜å‚¨ã€‚ ç»å¸¸ä¼šæœ‰äººç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸåž‹çš„æ•°æ®ï¼ˆä¸æ­£ç¡®çš„åšæ³•ï¼‰ï¼š ç¼ºç‚¹ 1ï¼šæ— æ³•ç”¨æ—¥æœŸå‡½æ•°è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒã€‚ ç¼ºç‚¹ 2ï¼šç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸè¦å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚ åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»åž‹ éžç²¾å‡†æµ®ç‚¹ï¼šfloatï¼Œdouble ç²¾å‡†æµ®ç‚¹ï¼šdecimal Decimal ç±»åž‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯ 4 ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨ 9 ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¯ç”¨äºŽå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´åž‹æ•°æ®ã€‚ ç´¢å¼•è®¾è®¡è§„èŒƒ é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆçŽ‡åŒæ ·ä¹Ÿå¯ä»¥é™ä½Žæ•ˆçŽ‡ï¼›ç´¢å¼•å¯ä»¥å¢žåŠ æŸ¥è¯¢æ•ˆçŽ‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½Žæ’å…¥å’Œæ›´æ–°çš„æ•ˆçŽ‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½ŽæŸ¥è¯¢æ•ˆçŽ‡ã€‚å› ä¸º MySQL ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æžœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºŽæŸ¥è¯¢ï¼Œå°±ä¼šå¢žåŠ  MySQL ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½ŽæŸ¥è¯¢æ€§èƒ½ã€‚ ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼• 5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6 ä»¥åŽï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½ æ¯ä¸ª InnoDB è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”® InnoDB æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ InnoDBæ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„ã€‚ ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸é€‚ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºŽè”åˆç´¢å¼•ï¼‰ ä¸è¦ä½¿ç”¨ UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢žé•¿ï¼‰ã€‚ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ž ID å€¼ã€‚ å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº å»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯å¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœº IOï¼Œå¢žåŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»Žç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚ åŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦ = åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡ / åˆ—çš„æ€»è¡Œæ•°ï¼‰ã€‚ å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIO æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰ã€‚ ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰ã€‚ é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼• å› ä¸ºè¿™æ ·ä¼šå¢žåŠ æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ã€‚ é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id) å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a) ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼• å¯¹äºŽé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚ è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ(where,select,ordery by,group byåŒ…å«çš„å­—æ®µ)çš„ç´¢å¼• è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š é¿å… InnoDB è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚InnoDB æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äºŽ InnoDB æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æžœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åŽï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½èŽ·å–æˆ‘ä»¬çœŸå®žæ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥èŽ·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆçŽ‡ã€‚ å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆçŽ‡ã€‚ç”±äºŽè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äºŽ IO å¯†é›†åž‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»Žç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® IO è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ IO è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº IOã€‚ æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘ SQL ç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€ SQL æ‰€å¸¦æ¥çš„ SQL æ³¨å…¥çš„é—®é¢˜ï¼Œ åªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’ SQL è¯­å¥æ›´é«˜æ•ˆ ç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æžï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆçŽ‡ã€‚ é¿å…æ•°æ®ç±»åž‹çš„éšå¼è½¬æ¢ éšå¼è½¬æ¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼šselect name,phone from customer where id = '111'; å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼• é¿å…ä½¿ç”¨åŒ % å·çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦‚a like '%123%'ï¼Œï¼ˆå¦‚æžœæ— å‰ç½® %ï¼Œåªæœ‰åŽç½® %ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰ ä½¿ç”¨ left join æˆ– not exists æ¥ä¼˜åŒ– not in æ“ä½œ,å› ä¸º not in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚ æ•°æ®åº“è®¾è®¡æ—¶ï¼Œåº”è¯¥è¦å¯¹ä»¥åŽæ‰©å±•è¿›è¡Œè€ƒè™‘ ç¨‹åºè¿žæŽ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œè¿›åˆ¶è·¨åº“æŸ¥è¯¢ ç¦æ­¢ä½¿ç”¨ SELECT * å¿…é¡»ä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ æ¶ˆè€—æ›´å¤šçš„ CPU å’Œ IO ä»¥ç½‘ç»œå¸¦å®½èµ„æº æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼• å¯å‡å°‘è¡¨ç»“æž„å˜æ›´å¸¦æ¥çš„å½±å“ ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„ INSERT è¯­å¥ å¦‚ï¼šinsert into values ('a','b','c'); åº”ä½¿ç”¨ï¼šinsert into t(c1,c2,c3) values ('a','b','c'); é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º JOIN æ“ä½œ é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL ( ä¸åŒ…å« unionã€group byã€order byã€limit ä»Žå¥ ) æ—¶ï¼Œæ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŽŸå› ï¼š å­æŸ¥è¯¢çš„ç»“æžœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æžœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ ç‰¹åˆ«æ˜¯å¯¹äºŽè¿”å›žç»“æžœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ ç”±äºŽå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚ é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ å¯¹äºŽ MySQL æ¥è¯´ï¼Œæ˜¯å­˜åœ¨å…³è”ç¼“å­˜çš„ï¼Œç¼“å­˜çš„å¤§å°å¯ä»¥ç”± join_buffer_size å‚æ•°è¿›è¡Œè®¾ç½®ã€‚ åœ¨ MySQL ä¸­ï¼Œå¯¹äºŽåŒä¸€ä¸ª SQL å¤šå…³è”ï¼ˆjoinï¼‰ä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå¤šåˆ†é…ä¸€ä¸ªå…³è”ç¼“å­˜ï¼Œå¦‚æžœåœ¨ä¸€ä¸ª SQL ä¸­å…³è”çš„è¡¨è¶Šå¤šï¼Œæ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ã€‚ å¦‚æžœç¨‹åºä¸­å¤§é‡çš„ä½¿ç”¨äº†å¤šè¡¨å…³è”çš„æ“ä½œï¼ŒåŒæ—¶ join_buffer_size è®¾ç½®çš„ä¹Ÿä¸åˆç†çš„æƒ…å†µä¸‹ï¼Œå°±å®¹æ˜“é€ æˆæœåŠ¡å™¨å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå°±ä¼šå½±å“åˆ°æœåŠ¡å™¨æ•°æ®åº“æ€§èƒ½çš„ç¨³å®šæ€§ã€‚ åŒæ—¶å¯¹äºŽå…³è”æ“ä½œæ¥è¯´ï¼Œä¼šäº§ç”Ÿä¸´æ—¶è¡¨æ“ä½œï¼Œå½±å“æŸ¥è¯¢æ•ˆçŽ‡ MySQL æœ€å¤šå…è®¸å…³è” 61 ä¸ªè¡¨ï¼Œå»ºè®®ä¸è¶…è¿‡ 5 ä¸ªã€‚ å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•° æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œ åˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆçŽ‡ å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ or åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨ in ä»£æ›¿ or In çš„å€¼ä¸è¦è¶…è¿‡ 500 ä¸ªï¼Œ in æ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œor å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚ ç¦æ­¢ä½¿ç”¨ order by rand() è¿›è¡ŒéšæœºæŽ’åº ä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶åŽåœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡ŒæŽ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æžœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éžå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU å’Œ IO åŠå†…å­˜èµ„æºã€‚ æŽ¨èåœ¨ç¨‹åºä¸­èŽ·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åŽä»Žæ•°æ®åº“ä¸­èŽ·å–æ•°æ®çš„æ–¹å¼ã€‚ WHEREä»Žå¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®— å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ åœ¨æ˜Žæ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION UNION ä¼šæŠŠä¸¤ä¸ªç»“æžœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åŽå†è¿›è¡ŒåŽ»é‡æ“ä½œã€‚ UNION ALL ä¸ä¼šå†å¯¹ç»“æžœé›†è¿›è¡ŒåŽ»é‡æ“ä½œã€‚ æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL å¤§ SQLï¼šé€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„SQL ã€‚ MySQLï¼šä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®—ã€‚ SQL æ‹†åˆ†åŽå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆçŽ‡ã€‚]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OOMå¸¸è§åŽŸå› åŠè§£å†³]]></title>
    <url>%2Fposts%2Fa5594ffa.html</url>
    <content type="text"><![CDATA[Java heap space å½“å †å†…å­˜ï¼ˆHeap Spaceï¼‰æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼Œå°±ä¼šæŠ›å‡º java.lang.OutOfMemoryError:Javaheap space é”™è¯¯ï¼ˆæ ¹æ®å®žé™…ç”Ÿäº§ç»éªŒï¼Œå¯ä»¥å¯¹ç¨‹åºæ—¥å¿—ä¸­çš„ OutOfMemoryError é…ç½®å…³é”®å­—å‘Šè­¦ï¼Œä¸€ç»å‘çŽ°ï¼Œç«‹å³å¤„ç†ï¼‰ã€‚ åŽŸå› åˆ†æž Javaheap space é”™è¯¯äº§ç”Ÿçš„å¸¸è§åŽŸå› å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š 1ã€è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤§æ•°ç»„ã€‚ 2ã€è¶…å‡ºé¢„æœŸçš„è®¿é—®é‡/æ•°æ®é‡ï¼Œé€šå¸¸æ˜¯ä¸Šæ¸¸ç³»ç»Ÿè¯·æ±‚æµé‡é£™å‡ï¼Œå¸¸è§äºŽå„ç±»ä¿ƒé”€/ç§’æ€æ´»åŠ¨ï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡æµé‡æŒ‡æ ‡æŽ’æŸ¥æ˜¯å¦æœ‰å°–çŠ¶å³°å€¼ã€‚ 3ã€è¿‡åº¦ä½¿ç”¨ç»ˆç»“å™¨ï¼ˆFinalizerï¼‰ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ç«‹å³è¢« GCã€‚ 4ã€å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼Œå¤§é‡å¯¹è±¡å¼•ç”¨æ²¡æœ‰é‡Šæ”¾ï¼ŒJVM æ— æ³•å¯¹å…¶è‡ªåŠ¨å›žæ”¶ï¼Œå¸¸è§äºŽä½¿ç”¨äº† File ç­‰èµ„æºæ²¡æœ‰å›žæ”¶ã€‚ è§£å†³æ–¹æ¡ˆ é’ˆå¯¹å¤§éƒ¨åˆ†æƒ…å†µï¼Œé€šå¸¸åªéœ€è¦é€šè¿‡ -Xmx å‚æ•°è°ƒé«˜ JVM å †å†…å­˜ç©ºé—´å³å¯ã€‚å¦‚æžœä»ç„¶æ²¡æœ‰è§£å†³ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æƒ…å†µåšè¿›ä¸€æ­¥å¤„ç†ï¼š 1ã€å¦‚æžœæ˜¯è¶…å¤§å¯¹è±¡ï¼Œå¯ä»¥æ£€æŸ¥å…¶åˆç†æ€§ï¼Œæ¯”å¦‚æ˜¯å¦ä¸€æ¬¡æ€§æŸ¥è¯¢äº†æ•°æ®åº“å…¨éƒ¨ç»“æžœï¼Œè€Œæ²¡æœ‰åšç»“æžœæ•°é™åˆ¶ã€‚ 2ã€å¦‚æžœæ˜¯ä¸šåŠ¡å³°å€¼åŽ‹åŠ›ï¼Œå¯ä»¥è€ƒè™‘å¢žåŠ æœºå™¨èµ„æºï¼Œæˆ–è€…åšé™æµé™çº§ã€‚ 3ã€å¦‚æžœæ˜¯å†…å­˜æ³„æ¼ï¼Œéœ€è¦æ‰¾åˆ°æŒæœ‰çš„å¯¹è±¡ï¼Œä¿®æ”¹ä»£ç è®¾è®¡ï¼Œæ¯”å¦‚å…³é—­æ²¡æœ‰é‡Šæ”¾çš„è¿žæŽ¥ã€‚ GC overhead limit exceeded å½“ Java è¿›ç¨‹èŠ±è´¹ 98% ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡Œ GCï¼Œä½†åªæ¢å¤äº†ä¸åˆ° 2% çš„å†…å­˜ï¼Œä¸”è¯¥åŠ¨ä½œè¿žç»­é‡å¤äº† 5 æ¬¡ï¼Œå°±ä¼šæŠ›å‡º java.lang.OutOfMemoryError:GC overhead limit exceededé”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åº”ç”¨ç¨‹åºå·²ç»åŸºæœ¬è€—å°½äº†æ‰€æœ‰å¯ç”¨å†…å­˜ï¼Œ GC ä¹Ÿæ— æ³•å›žæ”¶ã€‚ æ­¤ç±»é—®é¢˜çš„åŽŸå› ä¸Žè§£å†³æ–¹æ¡ˆè·Ÿ Javaheap space éžå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒã€‚ Permgen space è¯¥é”™è¯¯è¡¨ç¤ºæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰å·²ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚ åŽŸå› åˆ†æž æ°¸ä¹…ä»£å­˜å‚¨å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€åŠ è½½/ç¼“å­˜åˆ°å†…å­˜ä¸­çš„ class å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ï¼Œå­—æ®µï¼Œæ–¹æ³•å’Œå­—èŠ‚ç ï¼› 2ã€å¸¸é‡æ± ï¼› 3ã€å¯¹è±¡æ•°ç»„/ç±»åž‹æ•°ç»„æ‰€å…³è”çš„ classï¼› 4ã€JIT ç¼–è¯‘å™¨ä¼˜åŒ–åŽçš„ class ä¿¡æ¯ã€‚ PermGen çš„ä½¿ç”¨é‡ä¸ŽåŠ è½½åˆ°å†…å­˜çš„ class çš„æ•°é‡/å¤§å°æ­£ç›¸å…³ã€‚ è§£å†³æ–¹æ¡ˆ æ ¹æ® Permgen space æŠ¥é”™çš„æ—¶æœºï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š 1ã€ç¨‹åºå¯åŠ¨æŠ¥é”™ï¼Œä¿®æ”¹ -XX:MaxPermSize å¯åŠ¨å‚æ•°ï¼Œè°ƒå¤§æ°¸ä¹…ä»£ç©ºé—´ã€‚ 2ã€åº”ç”¨é‡æ–°éƒ¨ç½²æ—¶æŠ¥é”™ï¼Œå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰åº”ç”¨æ²¡æœ‰é‡å¯ï¼Œå¯¼è‡´åŠ è½½äº†å¤šä»½ class ä¿¡æ¯ï¼Œåªéœ€é‡å¯ JVM å³å¯è§£å†³ã€‚ 3ã€è¿è¡Œæ—¶æŠ¥é”™ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåŠ¨æ€åˆ›å»ºå¤§é‡ classï¼Œè€Œè¿™äº› class çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­æš‚ï¼Œä½†æ˜¯ JVM é»˜è®¤ä¸ä¼šå¸è½½ classï¼Œå¯ä»¥è®¾ç½® -XX:+CMSClassUnloadingEnabled å’Œ -XX:+UseConcMarkSweepGCè¿™ä¸¤ä¸ªå‚æ•°å…è®¸ JVM å¸è½½ classã€‚ å¦‚æžœä¸Šè¿°æ–¹æ³•æ— æ³•è§£å†³ï¼Œå¯ä»¥é€šè¿‡ jmap å‘½ä»¤ dump å†…å­˜å¯¹è±¡ jmap-dump:format=b,file=dump.hprof&lt;process-id&gt;ï¼Œç„¶åŽåˆ©ç”¨ Eclipse MAT https://www.eclipse.org/mat åŠŸèƒ½é€ä¸€åˆ†æžå¼€é”€æœ€å¤§çš„ classloader å’Œé‡å¤ classã€‚ Metaspace JDK 1.8 ä½¿ç”¨ Metaspace æ›¿æ¢äº†æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ï¼Œè¯¥é”™è¯¯è¡¨ç¤º Metaspace å·²è¢«ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚ æ­¤ç±»é—®é¢˜çš„åŽŸå› ä¸Žè§£å†³æ–¹æ³•è·Ÿ Permgenspace éžå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è°ƒæ•´ Metaspace ç©ºé—´å¤§å°çš„å¯åŠ¨å‚æ•°ä¸º -XX:MaxMetaspaceSizeã€‚ Unable to create new native thread æ¯ä¸ª Java çº¿ç¨‹éƒ½éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œå½“ JVM å‘åº•å±‚æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹æ—¶ï¼Œå¦‚æžœæ²¡æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…å°±ä¼šæŠ¥æ­¤ç±»é”™è¯¯ã€‚ åŽŸå› åˆ†æž JVM å‘ OS è¯·æ±‚åˆ›å»º native çº¿ç¨‹å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡º Unableto create new native threadï¼Œå¸¸è§çš„åŽŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€çº¿ç¨‹æ•°è¶…è¿‡æ“ä½œç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•° ulimit é™åˆ¶ï¼› 2ã€çº¿ç¨‹æ•°è¶…è¿‡ kernel.pid_maxï¼ˆåªèƒ½é‡å¯ï¼‰ï¼› 3ã€native å†…å­˜ä¸è¶³ï¼› è¯¥é—®é¢˜å‘ç”Ÿçš„å¸¸è§è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š 1ã€JVM å†…éƒ¨çš„åº”ç”¨ç¨‹åºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ Java çº¿ç¨‹ï¼› 2ã€JVM native æ–¹æ³•ä»£ç†äº†è¯¥æ¬¡è¯·æ±‚ï¼Œå¹¶å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ª native çº¿ç¨‹ï¼› 3ã€æ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹ï¼Œå¹¶ä¸ºå…¶åˆ†é…å†…å­˜ï¼› 4ã€å¦‚æžœæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å·²è€—å°½ï¼Œæˆ–æ˜¯å—åˆ° 32 ä½è¿›ç¨‹çš„åœ°å€ç©ºé—´é™åˆ¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ‹’ç»æœ¬æ¬¡ native å†…å­˜åˆ†é…ï¼› 5ã€JVM å°†æŠ›å‡º java.lang.OutOfMemoryError:Unable to create new native thread é”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§é…ç½®ï¼Œä¸ºæœºå™¨æä¾›æ›´å¤šçš„å†…å­˜ï¼› 2ã€é™ä½Ž Java Heap Space å¤§å°ï¼› 3ã€ä¿®å¤åº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ³„æ¼é—®é¢˜ï¼› 4ã€é™åˆ¶çº¿ç¨‹æ± å¤§å°ï¼› 5ã€ä½¿ç”¨ -Xss å‚æ•°å‡å°‘çº¿ç¨‹æ ˆçš„å¤§å°ï¼› 6ã€è°ƒé«˜ OS å±‚é¢çš„çº¿ç¨‹æœ€å¤§æ•°ï¼šæ‰§è¡Œ ulimia-a æŸ¥çœ‹æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼Œä½¿ç”¨ ulimit-u xxx è°ƒæ•´æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ã€‚ ulimit -a .... çœç•¥éƒ¨åˆ†å†…å®¹ ..... max user processes (-u) 16384 Out of swap space? è¯¥é”™è¯¯è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„è™šæ‹Ÿå†…å­˜å·²è¢«è€—å°½ã€‚è™šæ‹Ÿå†…å­˜ï¼ˆVirtual Memoryï¼‰ç”±ç‰©ç†å†…å­˜ï¼ˆPhysical Memoryï¼‰å’Œäº¤æ¢ç©ºé—´ï¼ˆSwap Spaceï¼‰ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“è¿è¡Œæ—¶ç¨‹åºè¯·æ±‚çš„è™šæ‹Ÿå†…å­˜æº¢å‡ºæ—¶å°±ä¼šæŠ¥ Outof swap space?é”™è¯¯ã€‚ åŽŸå› åˆ†æž è¯¥é”™è¯¯å‡ºçŽ°çš„å¸¸è§åŽŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€åœ°å€ç©ºé—´ä¸è¶³ï¼› 2ã€ç‰©ç†å†…å­˜å·²è€—å…‰ï¼› 3ã€åº”ç”¨ç¨‹åºçš„æœ¬åœ°å†…å­˜æ³„æ¼ï¼ˆnative leakï¼‰ï¼Œä¾‹å¦‚ä¸æ–­ç”³è¯·æœ¬åœ°å†…å­˜ï¼Œå´ä¸é‡Šæ”¾ã€‚ 4ã€æ‰§è¡Œ jmap-histo:live&lt;pid&gt; å‘½ä»¤ï¼Œå¼ºåˆ¶æ‰§è¡Œ Full GCï¼›å¦‚æžœå‡ æ¬¡æ‰§è¡ŒåŽå†…å­˜æ˜Žæ˜¾ä¸‹é™ï¼Œåˆ™åŸºæœ¬ç¡®è®¤ä¸º Direct ByteBuffer é—®é¢˜ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§åœ°å€ç©ºé—´ä¸º 64 bitï¼› 2ã€ä½¿ç”¨ Arthas æ£€æŸ¥æ˜¯å¦ä¸º Inflater/Deflater è§£åŽ‹ç¼©é—®é¢˜ï¼Œå¦‚æžœæ˜¯ï¼Œåˆ™æ˜¾å¼è°ƒç”¨ end æ–¹æ³•ã€‚ 3ã€Direct ByteBuffer é—®é¢˜å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•° -XX:MaxDirectMemorySize è°ƒä½Žé˜ˆå€¼ã€‚ 4ã€å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚ Kill process or sacrifice child æœ‰ä¸€ç§å†…æ ¸ä½œä¸šï¼ˆKernel Jobï¼‰åä¸º Out of Memory Killerï¼Œå®ƒä¼šåœ¨å¯ç”¨å†…å­˜æžä½Žçš„æƒ…å†µä¸‹â€œæ€æ­»â€ï¼ˆkillï¼‰æŸäº›è¿›ç¨‹ã€‚OOM Killer ä¼šå¯¹æ‰€æœ‰è¿›ç¨‹è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åŽå°†è¯„åˆ†è¾ƒä½Žçš„è¿›ç¨‹â€œæ€æ­»â€ï¼Œå…·ä½“çš„è¯„åˆ†è§„åˆ™å¯ä»¥å‚è€ƒ Surviving the Linux OOM Killerã€‚ ä¸åŒäºŽå…¶ä»–çš„ OOM é”™è¯¯ï¼Œ Killprocessorsacrifice child é”™è¯¯ä¸æ˜¯ç”± JVM å±‚é¢è§¦å‘çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå±‚é¢è§¦å‘çš„ã€‚ åŽŸå› åˆ†æž é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux å†…æ ¸å…è®¸è¿›ç¨‹ç”³è¯·çš„å†…å­˜æ€»é‡å¤§äºŽç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œé€šè¿‡è¿™ç§â€œé”™å³°å¤ç”¨â€çš„æ–¹å¼å¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ— å¯é¿å…åœ°å¸¦æ¥ä¸€å®šçš„â€œè¶…å–â€é£Žé™©ã€‚ä¾‹å¦‚æŸäº›è¿›ç¨‹æŒç»­å ç”¨ç³»ç»Ÿå†…å­˜ï¼Œç„¶åŽå¯¼è‡´å…¶ä»–è¿›ç¨‹æ²¡æœ‰å¯ç”¨å†…å­˜ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¿€æ´» OOM Killerï¼Œå¯»æ‰¾è¯„åˆ†ä½Žçš„è¿›ç¨‹ï¼Œå¹¶å°†å…¶â€œæ€æ­»â€ï¼Œé‡Šæ”¾å†…å­˜èµ„æºã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚ 2ã€OOM Killer è°ƒä¼˜ã€‚ Requested array size exceeds VM limit JVM é™åˆ¶äº†æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼Œè¯¥é”™è¯¯è¡¨ç¤ºç¨‹åºè¯·æ±‚åˆ›å»ºçš„æ•°ç»„è¶…è¿‡æœ€å¤§é•¿åº¦é™åˆ¶ã€‚ JVM åœ¨ä¸ºæ•°ç»„åˆ†é…å†…å­˜å‰ï¼Œä¼šæ£€æŸ¥è¦åˆ†é…çš„æ•°æ®ç»“æž„åœ¨ç³»ç»Ÿä¸­æ˜¯å¦å¯å¯»å€ï¼Œé€šå¸¸ä¸º Integer.MAX_VALUE-2ã€‚ æ­¤ç±»é—®é¢˜æ¯”è¾ƒç½•è§ï¼Œé€šå¸¸éœ€è¦æ£€æŸ¥ä»£ç ï¼Œç¡®è®¤ä¸šåŠ¡æ˜¯å¦éœ€è¦åˆ›å»ºå¦‚æ­¤å¤§çš„æ•°ç»„ï¼Œæ˜¯å¦å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå—ï¼Œåˆ†æ‰¹æ‰§è¡Œã€‚ Direct buffer memory Java å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡ Direct ByteBuffer ç›´æŽ¥è®¿é—®å †å¤–å†…å­˜ï¼Œè®¸å¤šé«˜æ€§èƒ½ç¨‹åºé€šè¿‡ Direct ByteBuffer ç»“åˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMemory Mapped Fileï¼‰å®žçŽ°é«˜é€Ÿ IOã€‚ åŽŸå› åˆ†æž Direct ByteBuffer çš„é»˜è®¤å¤§å°ä¸º 64 MBï¼Œä¸€æ—¦ä½¿ç”¨è¶…å‡ºé™åˆ¶ï¼Œå°±ä¼šæŠ›å‡º Directbuffer memory é”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€Java åªèƒ½é€šè¿‡ ByteBuffer.allocateDirect æ–¹æ³•ä½¿ç”¨ Direct ByteBufferï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡ Arthas ç­‰åœ¨çº¿è¯Šæ–­å·¥å…·æ‹¦æˆªè¯¥æ–¹æ³•è¿›è¡ŒæŽ’æŸ¥ã€‚ 2ã€æ£€æŸ¥æ˜¯å¦ç›´æŽ¥æˆ–é—´æŽ¥ä½¿ç”¨äº† NIOï¼Œå¦‚ nettyï¼Œjetty ç­‰ã€‚ 3ã€é€šè¿‡å¯åŠ¨å‚æ•° -XX:MaxDirectMemorySize è°ƒæ•´ Direct ByteBuffer çš„ä¸Šé™å€¼ã€‚ 4ã€æ£€æŸ¥ JVM å‚æ•°æ˜¯å¦æœ‰ -XX:+DisableExplicitGC é€‰é¡¹ï¼Œå¦‚æžœæœ‰å°±åŽ»æŽ‰ï¼Œå› ä¸ºè¯¥å‚æ•°ä¼šä½¿ System.gc() å¤±æ•ˆã€‚ 5ã€æ£€æŸ¥å †å¤–å†…å­˜ä½¿ç”¨ä»£ç ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼›æˆ–è€…é€šè¿‡åå°„è°ƒç”¨ sun.misc.Cleaner çš„ clean() æ–¹æ³•æ¥ä¸»åŠ¨é‡Šæ”¾è¢« Direct ByteBuffer æŒæœ‰çš„å†…å­˜ç©ºé—´ã€‚ 6ã€å†…å­˜å®¹é‡ç¡®å®žä¸è¶³ï¼Œå‡çº§é…ç½®ã€‚ Tomcatä¸­java.lang.OutOfMemoryError: Java heap spaceå¼‚å¸¸å¤„ç† åŽŸå› åˆ†æž Heap sizeï¼šJVMå †çš„è®¾ç½®æ˜¯æŒ‡javaç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­JVMå¯ä»¥è°ƒé…ä½¿ç”¨çš„å†…å­˜ç©ºé—´çš„è®¾ç½®ã€‚JVMåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è®¾ç½®Heap sizeçš„å€¼ï¼Œ å…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚ å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹è¿›è¡Œè®¾ç½®ã€‚Heap size çš„å¤§å°æ˜¯Young Generation å’ŒTenured Generaionä¹‹å’Œã€‚ æç¤ºï¼šåœ¨JVMä¸­å¦‚æžœ98ï¼…çš„æ—¶é—´æ˜¯ç”¨äºŽGCä¸”å¯ç”¨çš„Heap size ä¸è¶³2ï¼…çš„æ—¶å€™å°†æŠ›å‡ºæ­¤å¼‚å¸¸ä¿¡æ¯ã€‚ Heap Size æœ€å¤§ä¸è¦è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜çš„80ï¼…ï¼Œä¸€èˆ¬çš„è¦å°†-Xmså’Œ-Xmxé€‰é¡¹è®¾ç½®ä¸ºç›¸åŒï¼Œè€Œ-Xmnä¸º1/4çš„-Xmxå€¼ã€‚ è§£å†³æ–¹æ¡ˆ æ‰‹åŠ¨è®¾ç½®Heap sizeï¼Œä¿®æ”¹TOMCAT_HOME/bin/catalina.sh åœ¨ 1â€œecho &quot;Using CATALINA_BASE: $CATALINA_BASE&quot;â€ ä¸Šé¢åŠ å…¥ä»¥ä¸‹è¡Œï¼š 1JAVA_OPTS=&quot;-server -Xms800m -Xmx800m -XX:MaxNewSize=256m&quot; Tomcatä¸­java.lang.OutOfMemoryError: PermGen spaceå¼‚å¸¸å¤„ç† åŽŸå› åˆ†æž PermGen spaceçš„å…¨ç§°æ˜¯Permanent Generation space,æ˜¯æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸ, è¿™å—å†…å­˜ä¸»è¦æ˜¯è¢«JVMå­˜æ”¾Classå’ŒMetaä¿¡æ¯çš„,Classåœ¨è¢«Loaderæ—¶å°±ä¼šè¢«æ”¾åˆ°PermGen spaceä¸­, å®ƒå’Œå­˜æ”¾ç±»å®žä¾‹(Instance)çš„HeapåŒºåŸŸä¸åŒ,GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹ PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æžœä½ çš„åº”ç”¨ä¸­æœ‰å¾ˆå¤šCLASSçš„è¯,å°±å¾ˆå¯èƒ½å‡ºçŽ°PermGen spaceé”™è¯¯, è¿™ç§é”™è¯¯å¸¸è§åœ¨webæœåŠ¡å™¨å¯¹JSPè¿›è¡Œpre compileçš„æ—¶å€™ã€‚å¦‚æžœä½ çš„WEB APPä¸‹éƒ½ç”¨äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹jar, å…¶å¤§å° è¶…è¿‡äº†jvmé»˜è®¤çš„å¤§å°(4M)é‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ­¤é”™è¯¯ä¿¡æ¯äº†ã€‚ è§£å†³æ–¹æ¡ˆ æ‰‹åŠ¨è®¾ç½®MaxPermSizeå¤§å° ä¿®æ”¹TOMCAT_HOME/bin/catalina.sh,åœ¨ 1â€œecho &quot;Using CATALINA_BASE: $CATALINA_BASE&quot;â€ ä¸Šé¢åŠ å…¥ä»¥ä¸‹è¡Œï¼š 1JAVA_OPTS=&quot;-server -XX:PermSize=64M -XX:MaxPermSize=128m å»ºè®®ï¼šå°†ç›¸åŒçš„ç¬¬ä¸‰æ–¹jaræ–‡ä»¶ç§»ç½®åˆ°tomcat/shared/libç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°å‡å°‘jar æ–‡æ¡£é‡å¤å ç”¨å†…å­˜çš„ç›®çš„ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - é¢è¯•é¢˜æ€»ç»“]]></title>
    <url>%2Fposts%2F382a766.html</url>
    <content type="text"><![CDATA[Javaé‡Œé¢æ‰€æœ‰çš„ä¸å˜çš„å±žæ€§éœ€è¦ç”¨finalä¿®é¥°å— ç­”ï¼šæ²¡å¿…è¦ã€‚ä½ å¯ä»¥å®žçŽ°ç›¸åŒçš„åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æ“ä½œï¼š è®¾ä¸ºéžfinalçš„private å˜é‡ï¼Œä¸”åªæœ‰åœ¨æž„é€ å‡½æ•°ä¸­æ‰èƒ½ä¿®æ”¹ã€‚ä¸è®¾setæ–¹æ³•ï¼Œå¦‚æžœæ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œä¸è¦æ³„éœ²ä»»ä½•æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ è®¾ç½®ä¸€ä¸ªå¼•ç”¨å˜é‡ä¸ºfinal åªèƒ½ç¡®ä¿è¿™ä¸ªå˜é‡ä¸ä¼šè¢«èµ‹äºˆä¸€ä¸ªä¸åŒçš„å¼•ç”¨ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥æ”¹å˜å¼•ç”¨å˜é‡çš„å±žæ€§å€¼ã€‚ Stringçš„subString()å®žçŽ°åŽŸç† ç­”ï¼šsubstringå–åŽŸæ¥stringçš„ä¸€éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦æƒ³é—®substringå¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„éœ²é£Žé™©ã€‚ ç›´åˆ°Java1.7ï¼Œ substring æ‹¥æœ‰åŽŸæ¥çš„å­—ç¬¦æ•°ç»„çš„å¼•ç”¨ï¼Œè¿™æ„å‘³ç€å³ä½¿æ˜¯äº”å­—ç¬¦è¿™ä¹ˆå°çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ª1GBå­—ç¬¦æ•°ç»„æ— æ³•è¢«åžƒåœ¾å›žæ”¶ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚ è¿™ä¸ªé—®é¢˜åœ¨Java1.7ä¸­å·²ç»è¢«ä¿®å¤ï¼ŒåŽŸæ¥çš„å­—ç¬¦æ•°ç»„ä¸ä¼šè¢«å¼•ç”¨ï¼Œä½†æ˜¯ä¼šå¯¼è‡´åˆ›å»ºsubstringè€—æ—¶ä¼šæœ‰ç‚¹é•¿ï¼Œä»¥å‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(1), Java 7ä¹‹åŽæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ Javaä¸­å¦‚ä½•å¤„ç†å†™å­˜å‚¨è¿‡ç¨‹æˆ–è€…è¯»å­˜å‚¨è¿‡ç¨‹æ—¶é‡åˆ°çš„é”™è¯¯ ç­”ï¼š ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹åº”è¯¥åœ¨æ“ä½œé”™è¯¯æ—¶è¿”å›žé”™è¯¯ç ï¼Œä½†æ˜¯å¦‚æžœå­˜å‚¨è¿‡ç¨‹æœ¬èº«å‡ºé—®é¢˜ï¼Œæ•èŽ· SQLException æ˜¯å”¯ä¸€é€‰æ‹©ã€‚ å·¥åŽ‚æ¨¡å¼å’ŒæŠ½è±¡å·¥åŽ‚æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ« ç­”ï¼šæŠ½è±¡å·¥åœºæ¨¡å¼æä¾›ä¸€ä¸ªå¤šå±‚çº§çš„æŠ½è±¡ã€‚è€ƒè™‘ä¸åŒçš„å·¥åŽ‚ç»§æ‰¿è‡ªåŒä¸€ä¸ªæŠ½è±¡å·¥åŽ‚ï¼Œä»£è¡¨åŸºäºŽå·¥åŽ‚çš„ä¸åŒå¯¹è±¡ç»“æž„çš„åˆ›å»ºï¼Œä¾‹å¦‚ï¼Œ AutomobileFactory,UserFactory,RoleFactoryç­‰éƒ½ç»§æ‰¿è‡ª AbstractFactoryã€‚æ¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥åŽ‚ä»£è¡¨é‚£ç§ç±»åž‹ç‰©ä½“çš„åˆ›é€ å™¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå·¥åŽ‚æ¨¡å¼å’ŒæŠ½è±¡å·¥åŽ‚æ¨¡å¼çš„UMLå›¾ï¼š ä»€ä¹ˆæ—¶å€™é‡å†™ hashCode()å’Œ equals()æ–¹æ³• ç­”ï¼šå½“éœ€è¦é€šè¿‡ä¸šåŠ¡é€»è¾‘æ ¡éªŒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ‰§è¡ŒåŒä¸€åœ°å€ã€‚ä¾‹å¦‚ä¸¤ä¸ªå‘˜å·¥å¯¹è±¡åœ¨ emp_id ç›¸ç­‰çš„æ—¶å€™ç›¸ç­‰ï¼Œå³ä½¿å®ƒä»¬æ˜¯é€šè¿‡ä¸åŒçš„ä»£ç åˆ›å»ºå‡ºæ¥çš„ä¸¤ä¸ªä¸åŒå¯¹è±¡ã€‚ å¦å¤–ï¼Œå¦‚æžœä½ ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ä½œä¸º HashMapçš„keyï¼Œä½ å¿…é¡»é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ ä½œä¸ºjava equals-hashcodeçº¦æŸçš„ä¸€éƒ¨åˆ†ï¼Œå½“ä½ é‡å†™equalsçš„æ—¶å€™ï¼Œå¿…é¡»é‡å†™hashcode. å¦åˆ™ä½ ä¸èƒ½åœ¨Setï¼ŒMapè¿™æ ·çš„ç±»é‡Œé¢ä½¿ç”¨ï¼Œå› ä¸ºä»–ä»¬é€šè¿‡equals()æ–¹æ³•æ¥ä¿è¯é€»è¾‘æ­£ç¡®æ€§ã€‚ åŒå¼•å·ç›´æŽ¥åˆ›å»ºå­—ç¬¦ä¸²å’Œä½¿ç”¨new()åˆ›å»ºå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆåŒºåˆ« ç­”: ä½¿ç”¨new()åˆ›å»ºStringå¯¹è±¡ï¼Œå®žä¾‹è¢«åˆ›å»ºåœ¨å †ä¸­, ä¸ä¼šè¢«æ·»åŠ åˆ°Stringå¸¸é‡æ± ä¸­ï¼Œå½“é€šè¿‡å­—é¢é‡åˆ›å»ºæ—¶ï¼Œä¼šè¢«æ”¾åˆ°å †ä¸­çš„æ°¸ä¹…åŒºçš„Stringå¸¸é‡æ± ä¸­ã€‚ Stringstr = newString(&quot;Test&quot;) ä¸ä¼šæŠŠstræ”¾åˆ°Stringå¸¸é‡æ± ä¸­ï¼Œéœ€è¦è°ƒç”¨String.intern()æ–¹æ³•ï¼Œæ‰ä¼šæŠŠå®ƒæ”¾åˆ°Stringå¸¸é‡æ± ä¸­ã€‚ å½“ä½¿ç”¨Stringå­—é¢é‡åˆ›å»ºStringå¯¹è±¡æ—¶ï¼Œå¦‚é€šè¿‡String s = &quot;Test&quot;, javaä¼šè‡ªåŠ¨æ”¾å…¥Stringå¸¸é‡æ± ä¸­ã€‚ å¦å¤–ï¼Œå¦‚æžœæŠŠ&quot;Test&quot;è¿™æ ·çš„Stringå­—é¢é‡ä¼ è¿›åŽ»ï¼Œä¹Ÿä¼šåˆ›å»ºå¦å¤–ä¸€ä¸ªå¯¹è±¡:&quot;Test&quot; åœ¨Stringå¸¸é‡æ± ã€‚ ä»€ä¹ˆæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå¦‚ä½•å†™ä¸€ä¸ªä¸å¯å˜ç±» ç­”ï¼šä¸å¯å˜å¯¹è±¡æ˜¯æŒ‡Javaç±»çš„å¯¹è±¡ä¸€å•è¢«åˆ›å»ºï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚ä»»ä½•ä¸å¯å˜å¯¹è±¡å¯¹è±¡çš„ä¿®æ”¹åœ¨åˆ›å»ºæ—¶å€™å°±å·²ç»å®Œæˆï¼Œä¾‹å¦‚ï¼ŒJavaä¸­Stringæ˜¯ä¸å¯å˜çš„ã€‚ å¤§å¤šæ•°ä¸å¯å˜ç±»æ˜¯finalçš„, è¿™æ ·å¯ä»¥é˜²æ­¢å› å­ç±»é‡å†™æ–¹æ³•è€Œå¯¼è‡´ä¸å¯å˜å¤±æ•ˆã€‚ ä½ ä¹Ÿå¯ä»¥å®žçŽ°ç›¸åŒçš„åŠŸèƒ½é€šè¿‡è®©æˆå‘˜éžfinalä½†æ˜¯privateï¼Œä¸”é™¤äº†æž„é€ æ–¹æ³•ä»»ä½•å…¶ä»–æ–¹æ³•æ— æ³•ä¿®æ”¹ã€‚ å¦å¤–ï¼Œè¦ç¡®ä¿æ²¡æœ‰æš´éœ²ä¸å¯å˜å¯¹è±¡çš„å†…éƒ¨ï¼Œå°¤å…¶æ˜¯å®ƒåŒ…å«å¯å˜æˆå‘˜çš„æ—¶å€™ã€‚ åŒæ—¶ï¼Œå½“ä½ ä»Žå®¢æˆ·ç«¯æŽ¥æ”¶åˆ°å¯å˜çš„å¯¹è±¡æ—¶ï¼Œä¾‹å¦‚ java.util.Date, ä½¿ç”¨clone() æ–¹æ³• æ¥èŽ·å–ä¸€ä¸ªç‹¬ç«‹çš„æ‹·è´ï¼Œé˜²æ­¢æ¶æ„ä¿®æ”¹å¯å˜å¯¹è±¡å¸¦æ¥çš„é£Žé™©ã€‚ ç›¸åŒçš„ä¼˜åŒ–éœ€è¦åœ¨è¿”å›žä¸€ä¸ªå¯å˜æˆå‘˜æ—¶æ‰§è¡Œã€‚è¿”å›žå¦ä¸€ä¸ªç‹¬ç«‹æ‹·è´ç»™å®¢æˆ·ç«¯ï¼›ä¸è¦è¿”å›žå¯å˜å¯¹è±¡çš„åŽŸå§‹å¼•ç”¨ã€‚]]></content>
      <categories>
        <category>é¢è¯•é¢˜</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - é”æœºåˆ¶]]></title>
    <url>%2Fposts%2Fdd749e64.html</url>
    <content type="text"><![CDATA[å…¬å¹³é”/éžå…¬å¹³é” å…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥èŽ·å–é”ã€‚ éžå…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹èŽ·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åŽç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆèŽ·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿çŽ°è±¡ã€‚ å¯¹äºŽJava ReentrantLockè€Œè¨€ï¼Œé€šè¿‡æž„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éžå…¬å¹³é”ã€‚éžå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºŽåžåé‡æ¯”å…¬å¹³é”å¤§ã€‚ å¯¹äºŽSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éžå…¬å¹³é”ã€‚ç”±äºŽå…¶å¹¶ä¸åƒReentrantLockæ˜¯é€šè¿‡AQSçš„æ¥å®žçŽ°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠžæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚ å¯é‡å…¥é”/ä¸å¯é‡å…¥é” å¯é‡å…¥é” å¹¿ä¹‰ä¸Šçš„å¯é‡å…¥é”æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åŽï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼ˆå‰æå¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œè¿™æ ·çš„é”å°±å«åšå¯é‡å…¥é”ã€‚ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ã€‚ 1234567synchronized void setA() throws Exception&#123; Thread.sleep(1000); setB();&#125;synchronized void setB() throws Exception&#123; Thread.sleep(1000);&#125; ä¸å¯é‡å…¥é” ä¸å¯é‡å…¥é”ï¼Œä¸Žå¯é‡å…¥é”ç›¸åï¼Œä¸å¯é€’å½’è°ƒç”¨ï¼Œé€’å½’è°ƒç”¨å°±å‘ç”Ÿæ­»é”ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä½¿ç”¨è‡ªæ—‹é”æ¨¡æ‹Ÿä¸å¯é‡å…¥é”çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233package main.java.com.study.lock;import java.util.concurrent.atomic.AtomicReference;/** * @author: whb * @description: è‡ªæ—‹é”æ¨¡æ‹Ÿä¸å¯é‡å…¥é” */public class UnReentrantLock &#123; private AtomicReference&lt;Thread&gt; owner = new AtomicReference&lt;&gt;(); /** * åŠ é” */ public void lock() &#123; Thread current = Thread.currentThread(); //ç»å…¸çš„è‡ªæ—‹è¯­æ³• for (; ; ) &#123; if (!owner.compareAndSet(null, current)) &#123; return; &#125; &#125; &#125; /** * è§£é” */ public void unlock() &#123; Thread current = Thread.currentThread(); owner.compareAndSet(current, null); &#125;&#125; ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨åŽŸå­å¼•ç”¨æ¥å­˜æ”¾çº¿ç¨‹ï¼ŒåŒä¸€çº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨lock()æ–¹æ³•ï¼Œå¦‚æžœä¸æ‰§è¡Œunlock()é‡Šæ”¾é”çš„è¯ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è‡ªæ—‹çš„æ—¶å€™å°±ä¼šäº§ç”Ÿæ­»é”ï¼Œè¿™ä¸ªé”å°±ä¸æ˜¯å¯é‡å…¥çš„ï¼Œè€Œå®žé™…ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹ä¸å¿…æ¯æ¬¡éƒ½åŽ»é‡Šæ”¾é”å†æ¥èŽ·å–é”ï¼Œè¿™æ ·çš„è°ƒåº¦åˆ‡æ¢æ˜¯å¾ˆè€—èµ„æºçš„ã€‚ æŠŠå®ƒå˜æˆå¯é‡å…¥é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.lock;import java.util.concurrent.atomic.AtomicReference;/** * @author: whb * @description: è‡ªæ—‹é”æ¨¡æ‹Ÿå¯é‡å…¥é” */public class ReentrantLock &#123; private AtomicReference&lt;Thread&gt; owner = new AtomicReference&lt;&gt;(); //è®°å½•é‡å…¥æ¬¡æ•° private volatile int state = 0; /** * åŠ é” */ public void lock() &#123; Thread current = Thread.currentThread(); if (current == owner.get()) &#123; state++; return; &#125; for (; ; ) &#123; if (!owner.compareAndSet(null, current)) &#123; return; &#125; &#125; &#125; /** * é‡Šæ”¾é” */ public void unlock() &#123; Thread current = Thread.currentThread(); if (current == owner.get()) &#123; if (state != 0) &#123; state--; &#125; else &#123; owner.compareAndSet(current, null); &#125; &#125; &#125;&#125; åœ¨æ‰§è¡Œæ¯æ¬¡æ“ä½œä¹‹å‰ï¼Œåˆ¤æ–­å½“å‰é”æŒæœ‰è€…æ˜¯å¦æ˜¯å½“å‰å¯¹è±¡ï¼Œé‡‡ç”¨stateè®¡æ•°ï¼Œä¸ç”¨æ¯æ¬¡åŽ»é‡Šæ”¾é”ã€‚ J.U.CåŒ…ä¸­ReentrantLockä¸­å¯é‡å…¥é”å®žçŽ°ï¼Œçœ‹ä¸‹éžå…¬å¹³é”çš„é”èŽ·å–å®žçŽ°ï¼š 123456789101112131415161718final boolean nonfairTryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) &#123; if (compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; åœ¨AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªprivate volatile int stateæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œé¿å…äº†é¢‘ç¹çš„æŒæœ‰é‡Šæ”¾æ“ä½œï¼Œè¿™æ ·æ—¢æå‡äº†æ•ˆçŽ‡ï¼Œåˆé¿å…äº†æ­»é”ã€‚ ç‹¬å é”/å…±äº«é” ç‹¬å é” è¯¥é”æ¯ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚ å…±äº«é” è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹å…±æœ‰ï¼Œå…¸åž‹çš„å°±æ˜¯ReentrantReadWriteLocké‡Œçš„è¯»é”ï¼Œå®ƒçš„è¯»é”æ˜¯å¯ä»¥è¢«å…±äº«çš„ï¼Œä½†æ˜¯å®ƒçš„å†™é”ç¡®æ¯æ¬¡åªèƒ½è¢«ç‹¬å ã€‚ å¦å¤–è¯»é”çš„å…±äº«å¯ä¿è¯å¹¶å‘è¯»æ˜¯éžå¸¸é«˜æ•ˆçš„ï¼Œä½†æ˜¯è¯»å†™å’Œå†™å†™ï¼Œå†™è¯»éƒ½æ˜¯äº’æ–¥çš„ã€‚ ç‹¬å é”ä¸Žå…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®žçŽ°çš„ï¼Œé€šè¿‡å®žçŽ°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®žçŽ°ç‹¬å æˆ–è€…å…±äº«ã€‚å¯¹äºŽSynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬å é”ã€‚ äº’æ–¥é”/è¯»å†™é” äº’æ–¥é” åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰è¿›è¡ŒåŠ é”æ“ä½œï¼Œåœ¨è®¿é—®å®Œæˆä¹‹åŽè¿›è¡Œè§£é”æ“ä½œã€‚åŠ é”åŽï¼Œä»»ä½•å…¶ä»–è¯•å›¾å†æ¬¡åŠ é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°å½“å‰è¿›ç¨‹è§£é”ã€‚å¦‚æžœè§£é”æ—¶æœ‰ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹é˜»å¡žï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥é”ä¸Šçš„çº¿ç¨‹éƒ½è¢«å˜æˆå°±ç»ªçŠ¶æ€ï¼Œ ç¬¬ä¸€ä¸ªå˜ä¸ºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åˆæ‰§è¡ŒåŠ é”æ“ä½œï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åˆä¼šè¿›å…¥ç­‰å¾…ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®è¢«äº’æ–¥é”ä¿æŠ¤çš„èµ„æºã€‚ è¯»å†™é” è¯»å†™é”æ—¢æ˜¯äº’æ–¥é”ï¼Œåˆæ˜¯å…±äº«é”ï¼Œreadæ¨¡å¼æ˜¯å…±äº«ï¼Œwriteæ˜¯äº’æ–¥(æŽ’å®ƒé”)çš„ã€‚è¯»å†™é”åœ¨Javaä¸­çš„å…·ä½“å®žçŽ°å°±æ˜¯ReadWriteLockã€‚ è¯»å†™é”æœ‰ä¸‰ç§çŠ¶æ€ï¼šè¯»åŠ é”çŠ¶æ€ã€å†™åŠ é”çŠ¶æ€å’Œä¸åŠ é”çŠ¶æ€ã€‚ ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”ã€‚ åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™çŠ¶æ€çš„é”ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å æœ‰è¯»çŠ¶æ€é”ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥å®žçŽ°é«˜å¹¶å‘çš„åŽŸå› ã€‚å½“å…¶å¤„äºŽå†™çŠ¶æ€é”ä¸‹ï¼Œä»»ä½•æƒ³è¦å°è¯•èŽ·å¾—é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡žï¼Œç›´åˆ°å†™çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›å¦‚æžœæ˜¯å¤„äºŽè¯»çŠ¶æ€é”ä¸‹ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹èŽ·å¾—å®ƒçš„è¯»çŠ¶æ€é”ï¼Œä½†æ˜¯ä¸å…è®¸èŽ·å¾—å®ƒçš„å†™çŠ¶æ€é”ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹çš„è¯»çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›ä¸ºäº†é¿å…æƒ³è¦å°è¯•å†™æ“ä½œçš„çº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°å†™çŠ¶æ€é”ï¼Œå½“è¯»å†™é”æ„ŸçŸ¥åˆ°æœ‰çº¿ç¨‹æƒ³è¦èŽ·å¾—å†™çŠ¶æ€é”æ—¶ï¼Œä¾¿ä¼šé˜»å¡žå…¶åŽæ‰€æœ‰æƒ³è¦èŽ·å¾—è¯»çŠ¶æ€é”çš„çº¿ç¨‹ã€‚æ‰€ä»¥è¯»å†™é”éžå¸¸é€‚åˆèµ„æºçš„è¯»æ“ä½œè¿œå¤šäºŽå†™æ“ä½œçš„æƒ…å†µã€‚ æ‚²è§‚é”/ä¹è§‚é” æ‚²è§‚é” æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡žç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡žï¼Œç”¨å®ŒåŽå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»åž‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®žçŽ°ã€‚ ä¹è§‚é” æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡åŽ»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰åŽ»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®žçŽ°ã€‚ä¹è§‚é”é€‚ç”¨äºŽå¤šè¯»çš„åº”ç”¨ç±»åž‹ï¼Œè¿™æ ·å¯ä»¥æé«˜åžåé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºŽwrite_conditionæœºåˆ¶ï¼Œå…¶å®žéƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŽŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®žçŽ°æ–¹å¼CASå®žçŽ°çš„ã€‚ åˆ†æ®µé” åˆ†æ®µé”å…¶å®žæ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äºŽConcurrentHashMapè€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®žçŽ°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®žçŽ°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚ å¹¶å‘å®¹å™¨ç±»çš„åŠ é”æœºåˆ¶æ˜¯åŸºäºŽç²’åº¦æ›´å°çš„åˆ†æ®µé”ï¼Œåˆ†æ®µé”ä¹Ÿæ˜¯æå‡å¤šå¹¶å‘ç¨‹åºæ€§èƒ½çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚ åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä¸²è¡Œæ“ä½œæ˜¯ä¼šé™ä½Žå¯ä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šå‡ä½Žæ€§èƒ½ã€‚åœ¨é”ä¸Šå‘ç”Ÿç«žäº‰æ—¶å°†å¯¼è‡´è¿™ä¸¤ç§é—®é¢˜ï¼Œä½¿ç”¨ç‹¬å é”æ—¶ä¿æŠ¤å—é™èµ„æºçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šæ˜¯é‡‡ç”¨ä¸²è¡Œæ–¹å¼â€”-æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å®ƒã€‚æ‰€ä»¥å¯¹äºŽå¯ä¼¸ç¼©æ€§æ¥è¯´æœ€å¤§çš„å¨èƒå°±æ˜¯ç‹¬å é”ã€‚ ä¸‰ç§æ–¹å¼é™ä½Žé”çš„ç«žäº‰ç¨‹åº¦ï¼š 1ã€å‡å°‘é”çš„æŒæœ‰æ—¶é—´ 2ã€é™ä½Žé”çš„è¯·æ±‚é¢‘çŽ‡ 3ã€ä½¿ç”¨å¸¦æœ‰åè°ƒæœºåˆ¶çš„ç‹¬å é”ï¼Œè¿™äº›æœºåˆ¶å…è®¸æ›´é«˜çš„å¹¶ æ— é”/åå‘é”/è½»é‡çº§é”/é‡é‡çº§é” é”çš„å››ç§çŠ¶æ€ æ— é”çŠ¶æ€ï¼› åå‘é”çŠ¶æ€ï¼› è½»é‡çº§é”çŠ¶æ€ï¼› é‡é‡çº§é”çŠ¶æ€ï¼› è¿™å››ç§çŠ¶æ€éƒ½ä¸æ˜¯Javaè¯­è¨€ä¸­çš„é”ï¼Œè€Œæ˜¯Jvmä¸ºäº†æé«˜é”çš„èŽ·å–ä¸Žé‡Šæ”¾æ•ˆçŽ‡è€Œåšçš„ä¼˜åŒ–(ä½¿ç”¨synchronizedæ—¶)ã€‚é”çš„çŠ¶æ€æ˜¯é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜Žçš„ã€‚å››ç§çŠ¶æ€ä¼šéšç€ç«žäº‰çš„æƒ…å†µé€æ¸å‡çº§ï¼Œè€Œä¸”æ˜¯ä¸å¯é€†çš„è¿‡ç¨‹ï¼Œå³ä¸å¯é™çº§ã€‚ Javaå¯¹è±¡å¤´ ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»åž‹æŒ‡é’ˆï¼‰ã€‚ **Mark Wordï¼š**é»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸Žå¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéžå›ºå®šçš„æ•°æ®ç»“æž„ä»¥ä¾¿åœ¨æžå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚ **Klass Pointï¼š**å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ã€‚ Monitor Monitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚ Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æž„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚ synchronizedé€šè¿‡Monitoræ¥å®žçŽ°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºŽåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®žçŽ°çš„çº¿ç¨‹åŒæ­¥ã€‚â€œé˜»å¡žæˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æžœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºŽç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®žçŽ°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆçŽ‡ä½Žçš„åŽŸå› ã€‚è¿™ç§ä¾èµ–äºŽæ“ä½œç³»ç»ŸMutex Lockæ‰€å®žçŽ°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘èŽ·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚ æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»Žä½Žåˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚ ä¸‹é¢ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åŽå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š æ— é” æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªçŽ¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æžœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªçŽ¯å°è¯•ã€‚å¦‚æžœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŽŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®žçŽ°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éžå¸¸é«˜çš„ã€‚ åå‘é” åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨èŽ·å–é”ï¼Œé™ä½ŽèŽ·å–é”çš„ä»£ä»·ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡èŽ·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«žäº‰ï¼Œæ‰€ä»¥å‡ºçŽ°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶èŽ·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«žäº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„èŽ·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŽŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŽŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«žäº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºŽè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åŽæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”åœ¨JDK 6åŠä»¥åŽçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åŽç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é” æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•èŽ·å–é”ï¼Œä¸ä¼šé˜»å¡žï¼Œä»Žè€Œæé«˜æ€§èƒ½ã€‚ åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æžœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºŽå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åŽæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåŽï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æžœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºŽè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æžœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æžœæ˜¯å°±è¯´æ˜Žå½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æŽ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜Žå¤šä¸ªçº¿ç¨‹ç«žäº‰é”ã€‚ è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é” å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡žçŠ¶æ€ã€‚ è‡ªæ—‹é” CASç®—æ³• æˆ‘ä»¬çŸ¥é“CASç®—æ³•æ˜¯ä¹è§‚é”çš„ä¸€ç§å®žçŽ°æ–¹å¼ï¼ŒCASç®—æ³•ä¸­åˆæ¶‰åŠåˆ°è‡ªæ—‹é”ï¼Œå…ˆå›žé¡¾ä¸‹CASç®—æ³•ï¼š CASæ˜¯è‹±æ–‡å•è¯Compare and Swapï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æœ‰åçš„æ— é”ç®—æ³•ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®žçŽ°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡žçš„æƒ…å†µä¸‹å®žçŽ°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éžé˜»å¡žåŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•° éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V è¿›è¡Œæ¯”è¾ƒçš„å€¼ A æ‹Ÿå†™å…¥çš„æ–°å€¼ B æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®žé™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­çš„é‡è¯•ã€‚ CASå­˜åœ¨çš„é—®é¢˜ ABAé—®é¢˜ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æžœå†…å­˜å€¼åŽŸæ¥æ˜¯Aï¼ŒåŽæ¥å˜æˆäº†Bï¼Œç„¶åŽåˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘çŽ°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®žé™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»Žâ€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚ JDKä»Ž1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸Žé¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æžœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŽŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ å¾ªçŽ¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æžœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éžå¸¸å¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŽŸå­æ“ä½œã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŽŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŽŸå­æ€§çš„ã€‚ Javaä»Ž1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŽŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ è‡ªæ—‹é” åœ¨ä»‹ç»è‡ªæ—‹é”å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸€äº›å‰æçŸ¥è¯†æ¥å¸®åŠ©å¤§å®¶æ˜Žç™½è‡ªæ—‹é”çš„æ¦‚å¿µã€‚ é˜»å¡žæˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æžœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºŽç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚ åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´åŽ»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤çŽ°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æžœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åŽé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œè‡ªæ—‹ï¼Œå¦‚æžœåœ¨è‡ªæ—‹å®ŒæˆåŽå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸å¿…é˜»å¡žè€Œæ˜¯ç›´æŽ¥èŽ·å–åŒæ­¥èµ„æºï¼Œä»Žè€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯è‡ªæ—‹é”ã€‚ 1234567891011121314public class SpinLock &#123; private AtomicReference&lt;Thread&gt; cas = new AtomicReference&lt;Thread&gt;(); public void lock() &#123; Thread current = Thread.currentThread(); // åˆ©ç”¨CAS while (!cas.compareAndSet(null, current)) &#123; // DO nothing &#125; &#125; public void unlock() &#123; Thread current = Thread.currentThread(); cas.compareAndSet(current, null); &#125;&#125; lockï¼ˆ)æ–¹æ³•åˆ©ç”¨çš„CASï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹AèŽ·å–é”çš„æ—¶å€™ï¼Œèƒ½å¤ŸæˆåŠŸèŽ·å–åˆ°ï¼Œä¸ä¼šè¿›å…¥whileå¾ªçŽ¯ï¼Œå¦‚æžœæ­¤æ—¶çº¿ç¨‹Aæ²¡æœ‰é‡Šæ”¾é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹Båˆæ¥èŽ·å–é”ï¼Œæ­¤æ—¶ç”±äºŽä¸æ»¡è¶³CASï¼Œæ‰€ä»¥å°±ä¼šè¿›å…¥whileå¾ªçŽ¯ï¼Œä¸æ–­åˆ¤æ–­æ˜¯å¦æ»¡è¶³CASï¼Œç›´åˆ°Açº¿ç¨‹è°ƒç”¨unlockæ–¹æ³•é‡Šæ”¾äº†è¯¥é”ã€‚ è‡ªæ—‹é”çš„ç¼ºé™· å¦‚æžœæŸä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒç­‰å¾…èŽ·å–é”çš„çº¿ç¨‹è¿›å…¥å¾ªçŽ¯ç­‰å¾…ï¼Œæ¶ˆè€—CPUã€‚ä½¿ç”¨ä¸å½“ä¼šé€ æˆCPUä½¿ç”¨çŽ‡æžé«˜ã€‚æ‰€ä»¥ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æžœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸèŽ·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚ ä¸Šé¢Javaå®žçŽ°çš„è‡ªæ—‹é”ä¸æ˜¯å…¬å¹³çš„ï¼Œå³æ— æ³•æ»¡è¶³ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¼˜å…ˆèŽ·å–é”ã€‚ä¸å…¬å¹³çš„é”å°±ä¼šå­˜åœ¨â€œçº¿ç¨‹é¥¥é¥¿â€é—®é¢˜ã€‚ è‡ªæ—‹é”çš„ä¼˜ç‚¹ è‡ªæ—‹é”ä¸ä¼šä½¿çº¿ç¨‹çŠ¶æ€å‘ç”Ÿåˆ‡æ¢ï¼Œä¸€ç›´å¤„äºŽç”¨æˆ·æ€ï¼Œå³çº¿ç¨‹ä¸€ç›´éƒ½æ˜¯activeçš„ï¼›ä¸ä¼šä½¿çº¿ç¨‹è¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰§è¡Œé€Ÿåº¦å¿« éžè‡ªæ—‹é”åœ¨èŽ·å–ä¸åˆ°é”çš„æ—¶å€™ä¼šè¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œä»Žè€Œè¿›å…¥å†…æ ¸æ€ï¼Œå½“èŽ·å–åˆ°é”çš„æ—¶å€™éœ€è¦ä»Žå†…æ ¸æ€æ¢å¤ï¼Œéœ€è¦çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ï¼ˆçº¿ç¨‹è¢«é˜»å¡žåŽä¾¿è¿›å…¥å†…æ ¸ï¼ˆLinuxï¼‰è°ƒåº¦çŠ¶æ€ï¼Œè¿™ä¸ªä¼šå¯¼è‡´ç³»ç»Ÿåœ¨ç”¨æˆ·æ€ä¸Žå†…æ ¸æ€ä¹‹é—´æ¥å›žåˆ‡æ¢ï¼Œä¸¥é‡å½±å“é”çš„æ€§èƒ½ï¼‰ é€‚åº”æ€§è‡ªæ—‹é” è‡ªæ—‹é”åœ¨JDK1.4.2ä¸­å¼•å…¥ï¼Œä½¿ç”¨-XX:+UseSpinningæ¥å¼€å¯ã€‚JDK 6ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚ è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æžœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸèŽ·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æžœå¯¹äºŽæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸèŽ·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åŽå°è¯•èŽ·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æŽ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æŽ¥é˜»å¡žçº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlockã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2Fposts%2F18d8d4e.html</url>
    <content type="text"><![CDATA[å•¦å•¦å•¦å•¦å•¦å•¦å•¦å•¦å•¦]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - LongAdder]]></title>
    <url>%2Fposts%2Fd182cfa5.html</url>
    <content type="text"><![CDATA[CASæœ‰æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿè‚¯å®šæ˜¯æœ‰çš„ã€‚æ¯”å¦‚è¯´å¤§é‡çš„çº¿ç¨‹åŒæ—¶å¹¶å‘ä¿®æ”¹ä¸€ä¸ªAtomicLongï¼Œå¯èƒ½æœ‰å¾ˆå¤šçº¿ç¨‹ä¼šä¸åœçš„è‡ªæ—‹ï¼Œè¿›å…¥ä¸€ä¸ªæ— é™é‡å¤çš„å¾ªçŽ¯ä¸­ã€‚ è¿™äº›çº¿ç¨‹ä¸åœåœ°èŽ·å–å€¼ï¼Œç„¶åŽå‘èµ·CASæ“ä½œï¼Œä½†æ˜¯å‘çŽ°è¿™ä¸ªå€¼è¢«åˆ«äººæ”¹è¿‡äº†ï¼ŒäºŽæ˜¯å†æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªçŽ¯ï¼ŒèŽ·å–å€¼ï¼Œå‘èµ·CASæ“ä½œåˆå¤±è´¥äº†ï¼Œå†æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªçŽ¯ã€‚ åœ¨å¤§é‡çº¿ç¨‹é«˜å¹¶å‘æ›´æ–°AtomicLongçš„æ—¶å€™ï¼Œè¿™ç§é—®é¢˜å¯èƒ½ä¼šæ¯”è¾ƒæ˜Žæ˜¾ï¼Œå¯¼è‡´å¤§é‡çº¿ç¨‹ç©ºå¾ªçŽ¯ï¼Œè‡ªæ—‹è½¬ï¼Œæ€§èƒ½å’Œæ•ˆçŽ‡éƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚ äºŽæ˜¯ï¼ŒJava 8æŽ¨å‡ºäº†ä¸€ä¸ªæ–°çš„ç±»ï¼ŒLongAdderï¼Œåœ¨AtomicLongçš„åŸºç¡€ä¸Šè¿›è¡Œäº†çƒ­ç‚¹åˆ†ç¦»ï¼Œçƒ­ç‚¹åˆ†ç¦»ç±»ä¼¼äºŽæœ‰é”æ“ä½œä¸­çš„å‡å°é”ç²’åº¦ï¼Œå°è¯•ä½¿ç”¨åˆ†æ®µCASä»¥åŠè‡ªåŠ¨åˆ†æ®µè¿ç§»çš„æ–¹å¼æ¥å¤§å¹…åº¦æå‡å¤šçº¿ç¨‹é«˜å¹¶å‘æ‰§è¡ŒCASæ“ä½œçš„æ€§èƒ½ï¼åœ¨æ— é”ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼æ¥å¢žåŠ CASçš„æˆåŠŸçŽ‡ï¼Œä»Žè€Œæé«˜æ€§èƒ½ã€‚ LongAdderåŽŸç†å¦‚ä¸‹å›¾ï¼š AtomicLongçš„å®žçŽ°æ–¹å¼æ˜¯å†…éƒ¨æœ‰ä¸ªvalue å˜é‡ï¼Œå½“å¤šçº¿ç¨‹å¹¶å‘è‡ªå¢žï¼Œè‡ªå‡æ—¶ï¼Œå‡é€šè¿‡CAS æŒ‡ä»¤ä»Žæœºå™¨æŒ‡ä»¤çº§åˆ«æ“ä½œä¿è¯å¹¶å‘çš„åŽŸå­æ€§ã€‚å”¯ä¸€ä¼šåˆ¶çº¦AtomicLongé«˜æ•ˆçš„åŽŸå› æ˜¯é«˜å¹¶å‘ï¼Œé«˜å¹¶å‘æ„å‘³ç€CASçš„å¤±è´¥å‡ çŽ‡æ›´é«˜ï¼Œ é‡è¯•æ¬¡æ•°æ›´å¤šï¼Œè¶Šå¤šçº¿ç¨‹é‡è¯•ï¼ŒCASå¤±è´¥å‡ çŽ‡åˆè¶Šé«˜ï¼Œå˜æˆæ¶æ€§å¾ªçŽ¯ï¼ŒAtomicLongæ•ˆçŽ‡é™ä½Žã€‚ åœ¨LongAdderçš„åº•å±‚å®žçŽ°ä¸­ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªbaseå€¼ï¼Œåˆšå¼€å§‹å¤šçº¿ç¨‹æ¥ä¸åœçš„ç´¯åŠ æ•°å€¼ï¼Œéƒ½æ˜¯å¯¹baseè¿›è¡Œç´¯åŠ çš„ï¼Œæ¯”å¦‚åˆšå¼€å§‹ç´¯åŠ æˆäº†base = 5ã€‚ æŽ¥ç€å¦‚æžœå‘çŽ°å¹¶å‘æ›´æ–°çš„çº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œå°±ä¼šå¼€å§‹æ–½è¡Œåˆ†æ®µCASçš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨ä¼šæžä¸€ä¸ªCellæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªæ•°å€¼åˆ†æ®µã€‚ è¿™æ—¶ï¼Œè®©å¤§é‡çš„çº¿ç¨‹åˆ†åˆ«åŽ»å¯¹ä¸åŒCellå†…éƒ¨çš„valueå€¼è¿›è¡ŒCASç´¯åŠ æ“ä½œï¼Œè¿™æ ·å°±æŠŠCASè®¡ç®—åŽ‹åŠ›åˆ†æ•£åˆ°äº†ä¸åŒçš„Cellåˆ†æ®µæ•°å€¼ä¸­äº†ï¼ è¿™æ ·å°±å¯ä»¥å¤§å¹…åº¦çš„é™ä½Žå¤šçº¿ç¨‹å¹¶å‘æ›´æ–°åŒä¸€ä¸ªæ•°å€¼æ—¶å‡ºçŽ°çš„æ— é™å¾ªçŽ¯çš„é—®é¢˜ï¼Œå¤§å¹…åº¦æå‡äº†å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°æ•°å€¼çš„æ€§èƒ½å’Œæ•ˆçŽ‡ï¼ è€Œä¸”ä»–å†…éƒ¨å®žçŽ°äº†è‡ªåŠ¨åˆ†æ®µè¿ç§»çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¦‚æžœæŸä¸ªCellçš„valueæ‰§è¡ŒCASå¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨åŽ»æ‰¾å¦å¤–ä¸€ä¸ªCellåˆ†æ®µå†…çš„valueå€¼è¿›è¡ŒCASæ“ä½œã€‚ è¿™æ ·ä¹Ÿè§£å†³äº†çº¿ç¨‹ç©ºæ—‹è½¬ã€è‡ªæ—‹ä¸åœç­‰å¾…æ‰§è¡ŒCASæ“ä½œçš„é—®é¢˜ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‰§è¡ŒCASæ—¶å¯ä»¥å°½å¿«çš„å®Œæˆè¿™ä¸ªæ“ä½œã€‚ æœ€åŽï¼Œå¦‚æžœä½ è¦ä»ŽLongAdderä¸­èŽ·å–å½“å‰ç´¯åŠ çš„æ€»å€¼ï¼Œå°±ä¼šæŠŠbaseå€¼å’Œæ‰€æœ‰Cellåˆ†æ®µæ•°å€¼åŠ èµ·æ¥è¿”å›žç»™ä½ ã€‚LongAdderæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL-ç´¢å¼•ç»“æž„]]></title>
    <url>%2Fposts%2F3bf347e4.html</url>
    <content type="text"><![CDATA[BTreeç´¢å¼• BTreeï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸æ˜¯äºŒå‰çš„ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®ç»“æž„ã€‚ ä¸é€‚åˆï¼š å•åˆ—ç´¢å¼•çš„åˆ—ä¸èƒ½åŒ…å«nullçš„è®°å½•ï¼Œå¤åˆç´¢å¼•çš„å„ä¸ªåˆ—ä¸èƒ½åŒ…å«åŒæ—¶ä¸ºnullçš„è®°å½•ï¼Œå¦åˆ™ä¼šå…¨è¡¨æ‰«æï¼›ç´¢å¼•å¤±æ•ˆå¾ˆå¤šæ—¶å€™æ˜¯å› ä¸ºè¿™åˆ—æœ‰nullï¼Œç©ºå€¼ ä¸é€‚åˆé”®å€¼è¾ƒå°‘çš„åˆ—ï¼ˆé‡å¤æ•°æ®è¾ƒå¤šçš„åˆ—ï¼‰ï¼›å‡å¦‚ä½ å»ºç«‹äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼ŸæŸ¥è¯¢åè€Œä¼šå˜æ…¢ å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ä¸èƒ½åˆ©ç”¨ç´¢å¼•(like '%XX'æˆ–è€…like '%XX%')ï¼Œè¯¥ç±»sqlè¯­å¥å¯¼è‡´ç´¢å¼•å¤±æ•ˆ Hashæ•£åˆ—ç´¢å¼• Hashæ•£åˆ—ç´¢å¼•æ˜¯æ ¹æ®HASHç®—æ³•æ¥æž„å»ºçš„ç´¢å¼•ã€‚ é€‚åˆï¼š ç²¾ç¡®æŸ¥æ‰¾éžå¸¸å¿«ï¼ˆåŒ…æ‹¬= &lt;&gt; å’Œinï¼‰ï¼Œå…¶æ£€ç´¢æ•ˆçŽ‡éžå¸¸é«˜ï¼Œç´¢å¼•çš„æ£€ç´¢å¯ä»¥ä¸€æ¬¡å®šä½ï¼Œä¸åƒBTree ç´¢å¼•éœ€è¦ä»Žæ ¹èŠ‚ç‚¹åˆ°æžèŠ‚ç‚¹ï¼Œæ‰€ä»¥ Hash ç´¢å¼•çš„æŸ¥è¯¢æ•ˆçŽ‡è¦è¿œé«˜äºŽ B-Tree ç´¢å¼•ã€‚ ä¸é€‚åˆï¼š ä¸é€‚åˆæ¨¡ç³ŠæŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢ï¼ˆåŒ…æ‹¬likeï¼Œ&gt;ï¼Œ&lt;ï¼Œbetweenâ€¦â€¦andç­‰ï¼‰ï¼Œç”±äºŽ Hash ç´¢å¼•æ¯”è¾ƒçš„æ˜¯è¿›è¡Œ Hash è¿ç®—ä¹‹åŽçš„ Hash å€¼ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç”¨äºŽç­‰å€¼çš„è¿‡æ»¤ï¼Œä¸èƒ½ç”¨äºŽåŸºäºŽèŒƒå›´çš„è¿‡æ»¤ï¼Œå› ä¸ºç»è¿‡ç›¸åº”çš„ Hash ç®—æ³•å¤„ç†ä¹‹åŽçš„ Hash å€¼çš„å¤§å°å…³ç³»ï¼Œå¹¶ä¸èƒ½ä¿è¯å’ŒHashè¿ç®—å‰å®Œå…¨ä¸€æ ·ï¼› ä¸é€‚åˆæŽ’åºï¼Œæ•°æ®åº“æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æ•°æ®æ¥æå‡æŽ’åºæ€§èƒ½ï¼ŒåŒæ ·æ˜¯å› ä¸ºHashå€¼çš„å¤§å°ä¸ç¡®å®šï¼› å¤åˆç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•å­—æ®µæŸ¥è¯¢ï¼ŒHash ç´¢å¼•åœ¨è®¡ç®— Hash å€¼çš„æ—¶å€™æ˜¯ç»„åˆç´¢å¼•é”®åˆå¹¶åŽå†ä¸€èµ·è®¡ç®— Hash å€¼ï¼Œè€Œä¸æ˜¯å•ç‹¬è®¡ç®— Hash å€¼ï¼Œæ‰€ä»¥é€šè¿‡ç»„åˆç´¢å¼•çš„å‰é¢ä¸€ä¸ªæˆ–å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒHash ç´¢å¼•ä¹Ÿæ— æ³•è¢«åˆ©ç”¨ã€‚ åŒæ ·ä¸é€‚åˆé”®å€¼è¾ƒå°‘çš„åˆ—ï¼ˆé‡å¤å€¼è¾ƒå¤šçš„åˆ—ï¼‰ï¼› Bitmapä½å›¾ç´¢å¼• å°±æ˜¯ç”¨ä½å›¾è¡¨ç¤ºçš„ç´¢å¼•ï¼Œå¯¹åˆ—çš„æ¯ä¸ªé”®å€¼å»ºç«‹ä¸€ä¸ªä½å›¾ã€‚ç›¸å¯¹äºŽBTreeç´¢å¼•ï¼Œå ç”¨çš„ç©ºé—´éžå¸¸å°ï¼Œåˆ›å»ºå’Œä½¿ç”¨éžå¸¸å¿«ã€‚ä½å›¾ç´¢å¼•ç”±äºŽåªå­˜å‚¨é”®å€¼çš„èµ·æ­¢Rowidå’Œä½å›¾,å ç”¨çš„ç©ºé—´éžå¸¸å°‘ã€‚ é€‚åˆ é€‚åˆå†³ç­–æ”¯æŒç³»ç»Ÿï¼› å½“select count(XX) æ—¶,å¯ä»¥ç›´æŽ¥è®¿é—®ç´¢å¼•ä¸­ä¸€ä¸ªä½å›¾å°±å¿«é€Ÿå¾—å‡ºç»Ÿè®¡æ•°æ®ï¼› å½“æ ¹æ®é”®å€¼åšandï¼Œoræˆ– in(x,y,..)æŸ¥è¯¢æ—¶ï¼Œç›´æŽ¥ç”¨ç´¢å¼•çš„ä½å›¾è¿›è¡Œæˆ–è¿ç®—,å¿«é€Ÿå¾—å‡ºç»“æžœè¡Œæ•°æ®ã€‚ ä¸é€‚åˆ ä¸é€‚åˆé”®å€¼è¾ƒå¤šçš„åˆ—ï¼ˆé‡å¤å€¼è¾ƒå°‘çš„åˆ—ï¼‰ï¼› ä¸é€‚åˆupdateã€insertã€deleteé¢‘ç¹çš„åˆ—ï¼Œä»£ä»·å¾ˆé«˜ã€‚åˆ°åº•æ˜¯ä»€ä¹ˆä»£ä»·å‘¢ï¼Ÿupdate,insert,deleteçš„æ—¶å€™ä¼šé”ä½é”®å€¼ä¸€æ ·çš„è¡Œã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IDEAä½¿ç”¨FindBugsæ’ä»¶]]></title>
    <url>%2Fposts%2F570da5f6.html</url>
    <content type="text"><![CDATA[ä¸‹è½½å®‰è£… åœ¨Ideaä¸­ï¼Œæ‰“å¼€&quot;File&quot;--&gt;&quot;Settings&quot;ï¼Œæˆ–è€…ä½¿ç”¨å¿«æ·é”®&quot;Ctrl+Alt+S&quot;æ‰“å¼€è®¾ç½®çª—å£ï¼š åœ¨è®¾ç½®çª—å£æ‰¾åˆ°** plugins **æ ‡ç­¾é¡µï¼Œç„¶åŽç‚¹å‡»ä¸‹æ–¹çš„ ** Browse Repositories **ï¼š åœ¨æ–°æ‰“å¼€çš„Browse Repositoriesçª—å£æœç´¢findbugsï¼Œç„¶åŽç‚¹å‡»Installè¿›è¡Œå®‰è£…ï¼Œ å› ä¸ºæˆ‘å·²ç»å®‰è£…è¿‡äº†ï¼Œæ‰€ä»¥ä¸å†æ˜¾ç¤ºinstallæŒ‰é’®ï¼š ä½¿ç”¨FindBugs ç®€å•è¯´æ˜Žï¼š é¼ æ ‡ç§»åŠ¨åˆ°å³è¾¹çš„æ‰€æœ‰å›¾æ ‡ï¼Œçœ‹çœ‹æ¯ä¸ªå›¾æ ‡éƒ½æ˜¯ä»€ä¹ˆæ„æ€ã€‚å¤§æ¦‚è¯´ä¸€ä¸‹ï¼š ç¬¬ä¸€ç«–åˆ—çš„çº¢è‰²å›¾æ ‡æ˜¯åˆ†æžå½“å‰çš„è¿™ä¸ªæ–‡ä»¶ã€‚ ä¸‹é¢æ˜¯åˆ†æžæ˜¯æŸä¸€ä¸ªç±»ï¼Œé¼ æ ‡æ‰€åœ¨çš„é‚£ä¸ªç±»ã€‚ å†å¾€ä¸‹æ˜¯æŸä¸ªåŒ…ï¼ŒæŸä¸ªæ¨¡å—ï¼Œæ•´ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚ ç¬¬äºŒç«–åˆ—åˆ™æ˜¯æŽ§åˆ¶åˆ†æžç»“æžœçš„å±•ç¤ºæƒ…å†µã€‚ ä¸‹é¢å°±æ•´ä¸ªå®žé™…æ‰¾åˆ°çš„ä»£ç çš„é—®é¢˜ï¼Œå•ç‹¬åˆ†æžæŸä¸ªserviceæ–‡ä»¶ï¼Œçœ‹ä»£ç é‡Œé¢çš„é—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Find Bugsçš„æ„æ€æ˜¯è¯´ä»£ç é‡Œé¢æŠŠSimpleDateFormatå£°æ˜Žä¸ºé™æ€å±žæ€§ï¼Œä½†æ˜¯SimpleDateFormatæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ åœ¨å¤šçº¿ç¨‹ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æ‰€ä»¥å°±æ‰¾åˆ°ä¸ªé—®é¢˜å•¦ã€‚ æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ä¸­çœ‹åˆ°ä»£ç é‡Œæœ‰å¾ˆå¤šé»„è‰²æç¤ºï¼Œå¼ºè¿«ç—‡çš„äººçœ‹ç€å¾ˆä¸çˆ½ï¼Œé‚£æ€Žä¹ˆæŠŠä»£ç é‡Œé¢è¿™äº›é»„è‰²çš„æç¤ºç»™å…³æŽ‰å‘¢ï¼Ÿ ç‚¹è¿™ä¸ª ** Ã— ** å°±ä»¥å•¦ï¼Œä»£ç å°±æ¢å¤æˆåŽŸæ¥çš„æ ·å­å•¦ã€‚ å¸¸è§çš„é”™è¯¯ä¿¡æ¯ Bad practice ä»£ç ä¸­çš„ä¸€äº›åä¹ æƒ¯ Class names should start with an upper case letter ä¸»è¦åŒ…æ‹¬ç±»åçš„å‘½åï¼Œä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚ Method names should start with a lower case letter æ–¹æ³•åä»¥å°å†™å­—æ¯å¼€å¤´ã€‚ Field names should start with a lower case letter å­—æ®µåä»¥å°å†™å­—æ¯å¼€å¤´ã€‚ equals()method does not check for null argument equals()æ–¹æ³•åº”è¯¥æ£€æŸ¥éžç©ºã€‚ Class defines equals() and uses Object.hashCode() ä¸€ä¸ªç±»è¦†å†™äº†equalsæ–¹æ³•ï¼Œæ²¡æœ‰è¦†å†™hashCodeæ–¹æ³•ï¼Œä½¿ç”¨äº†Objectå¯¹è±¡çš„hashCodeæ–¹æ³•ã€‚ Method ignores exceptional return value æ–¹æ³•å¿½ç•¥è¿”å›žå€¼çš„å¼‚å¸¸ä¿¡æ¯ã€‚ Equals method should not assume anything about the type of its argument equals(Object o)æ–¹æ³•ä¸èƒ½å¯¹å‚æ•°oçš„ç±»åž‹åšä»»ä½•çš„å‡è®¾ã€‚æ¯”è¾ƒæ­¤å¯¹è±¡ä¸ŽæŒ‡å®šçš„å¯¹è±¡ã€‚å½“ä¸”ä»…å½“è¯¥å‚æ•°ä¸ä¸º nullï¼Œå¹¶ä¸”æ˜¯è¡¨ç¤ºä¸Žæ­¤å¯¹è±¡ç›¸åŒçš„ç±»åž‹çš„å¯¹è±¡æ—¶ï¼Œç»“æžœæ‰ä¸º trueã€‚ Comparison of String objects using == or != ç”¨==æˆ–è€…ï¼=åŽ»æ¯”è¾ƒStringç±»åž‹çš„å¯¹è±¡ã€‚ Method might ignore exception æ–¹æ³•å¯èƒ½å¿½ç•¥å¼‚å¸¸ã€‚ Method invokes System.exit() åœ¨æ–¹æ³•ä¸­è°ƒç”¨System.exit(â€¦)è¯­å¥ï¼Œè€ƒè™‘ç”¨RuntimeExceptionæ¥ä»£æ›¿ã€‚ Method ignores result of InputStream.read() InputStream.readæ–¹æ³•å¿½ç•¥è¿”å›žçš„å¤šä¸ªå­—ç¬¦ï¼Œå¦‚æžœå¯¹ç»“æžœæ²¡æœ‰æ£€æŸ¥å°±æ²¡æ³•æ­£ç¡®å¤„ç†ç”¨æˆ·è¯»å–å°‘é‡å­—ç¬¦è¯·æ±‚çš„æƒ…å†µã€‚ Dodgy code ç³Ÿç³•çš„ä»£ç  Switch statement found where default case is missing Switchæ²¡æœ‰é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œçš„caseè¯­å¥ã€‚ Switch statement found where one case falls through to the next case Switchè¯­å¥ä¸­ä¸€ä¸ªåˆ†æ”¯æ‰§è¡ŒåŽåˆæ‰§è¡Œäº†ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚é€šå¸¸caseåŽé¢è¦è·Ÿbreak æˆ–è€…returnè¯­å¥æ¥è·³å‡ºã€‚ Dead store to local variable è¯¥æŒ‡ä»¤ä¸ºå±€éƒ¨å˜é‡èµ‹å€¼ï¼Œä½†åœ¨å…¶åŽçš„æ²¡æœ‰å¯¹å¥¹åšä»»ä½•ä½¿ç”¨ã€‚é€šå¸¸ï¼Œè¿™è¡¨æ˜Žä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå€¼ä»Žæœªä½¿ç”¨è¿‡ã€‚ Write to static field from instance method åœ¨å®žä¾‹æ–¹æ³•å†™å…¥é™æ€å­—æ®µã€‚ Redundant nullcheck of value known to be non-null æ–¹æ³•ä¸­å¯¹ä¸ä¸ºç©ºçš„å€¼è¿›è¡Œä¸ºç©ºçš„åˆ¤æ–­ã€‚ Method uses the same code for two branches æ­¤æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œä»¥å®žçŽ°ä¸¤ä¸ªæœ‰æ¡ä»¶çš„åˆ†æ”¯ã€‚æ£€æŸ¥ä»¥ç¡®ä¿è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªç¼–ç é”™è¯¯ã€‚ Exception is caught when Exception is not thrown åœ¨try/catchå—ä¸­æ•èŽ·å¼‚å¸¸ï¼Œä½†æ˜¯å¼‚å¸¸æ²¡æœ‰åœ¨tryè¯­å¥ä¸­æŠ›å‡ºè€ŒRuntimeExceptionåˆæ²¡æœ‰æ˜Žç¡®çš„è¢«æ•èŽ·ã€‚ Integral division result cast to double or float æ•´å½¢æ•°é™¤æ³•å¼ºåˆ¶è½¬æ¢ä¸ºdoubleæˆ–è€…floatç±»åž‹ã€‚ Possible null pointer dereference due to return value of called method æ–¹æ³•çš„è¿”å›žå€¼æ²¡æœ‰è¿›è¡Œæ˜¯å¦ä¸ºç©ºçš„æ£€æŸ¥å°±é‡æ–°èµ‹å€¼ï¼Œè¿™æ ·å¯èƒ½ä¼šå‡ºçŽ°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ Useless object created å¯¹è±¡åˆ›å»ºäº†å¹¶æ²¡æœ‰ç”¨ã€‚ Unread public/protected field æ²¡æœ‰ç”¨åˆ°çš„å­—æ®µã€‚ Internationalization å…³äºŽä»£ç å›½é™…åŒ–ç›¸å…³æ–¹é¢çš„ Consider using Locale parameterized version of invoked method ä½¿ç”¨å¹³å°é»˜è®¤çš„ç¼–ç æ ¼å¼å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œè¿™å¯èƒ½å¯¼è‡´å›½é™…å­—ç¬¦çš„è½¬æ¢ä¸å½“ã€‚ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯¹å­—ç¬¦è¿›è¡Œè½¬æ¢ ** Performance ** å…³äºŽä»£ç æ€§èƒ½ç›¸å…³æ–¹é¢çš„ Boxing/unboxing to parse a primitive ç±»åž‹è½¬æ¢ æ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢æˆint åº”è¯¥ä½¿ç”¨Integer.parseInt(â€œâ€) ä»£æ›¿Integer.valueOf(â€œâ€) Method concatenates string using + in aloop æ¯æ¬¡å¾ªçŽ¯é‡Œçš„å­—ç¬¦ä¸²+è¿žæŽ¥ï¼Œéƒ½ä¼šæ–°äº§ç”Ÿä¸€ä¸ªstringå¯¹è±¡ï¼Œåœ¨javaä¸­ï¼Œæ–°å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ä»·æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾ªçŽ¯è¯­å¥ä¸­ï¼Œæ•ˆçŽ‡è¾ƒä½Ž è§£å†³åŠžæ³•ï¼šä½¿ç”¨StringBufferæˆ–è€…StringBuilderé‡ç”¨å¯¹è±¡ã€‚ Private method is never called ç§æœ‰æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨ Explicit garbage collection;extremely dubious except in benchmarking code åœ¨ä»£ç ä¸­æ˜¾å¼çš„è°ƒç”¨åžƒåœ¾å›žæ”¶å‘½åï¼Œè¿™æ ·åšå¹¶ä¸èƒ½èµ·ä½œç”¨ã€‚åœ¨è¿‡åŽ»ï¼Œæœ‰äººåœ¨å…³é—­æ“ä½œæˆ–è€…finalizeæ–¹æ³•ä¸­è°ƒç”¨åžƒåœ¾å›žæ”¶æ–¹æ³•å¯¼è‡´äº†å¾ˆå¤šçš„æ€§èƒ½æµªè´¹ã€‚è¿™æ ·å¤§è§„æ¨¡å›žæ”¶å¯¹è±¡æ—¶ä¼šé€ æˆå¤„ç†å™¨è¿è¡Œç¼“æ…¢ã€‚ Unread field:should this field be static? æ²¡æœ‰ç”¨åˆ°çš„static å­—æ®µ should be a static inner class æ­¤å†…éƒ¨ç±»åº”è¯¥ä½¿ç”¨staticä¿®é¥° ** Experimental ** Method may fail to clean up stream or resource on checked exception è¿™ç§æ–¹æ³•å¯èƒ½æ— æ³•æ¸…é™¤ï¼ˆå…³é—­ï¼Œå¤„ç½®ï¼‰ä¸€ä¸ªæµï¼Œæ•°æ®åº“å¯¹è±¡ï¼Œæˆ–å…¶ä»–èµ„æºéœ€è¦ä¸€ä¸ªæ˜Žç¡®çš„æ¸…ç†è¡ŒåŠ¨ è§£å†³æ–¹æ³•ï¼šæµçš„å…³é—­éƒ½å†™åœ¨finallyé‡Œé¢ Malicious code vulnerability å…³äºŽæ¶æ„ç ´åä»£ç ç›¸å…³æ–¹é¢çš„ May expose internal representation by incorporating reference to mutable object æ­¤ä»£ç æŠŠå¤–éƒ¨å¯å˜å¯¹è±¡å¼•ç”¨å­˜å‚¨åˆ°å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚å¦‚æžœå®žä¾‹å—åˆ°ä¸ä¿¡ä»»çš„ä»£ç çš„è®¿é—®å’Œæ²¡æœ‰æ£€æŸ¥çš„å˜åŒ–å±åŠå¯¹è±¡å’Œé‡è¦å±žæ€§çš„å®‰å…¨ã€‚å­˜å‚¨ä¸€ä¸ªå¯¹è±¡çš„å‰¯æœ¬ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯æ›´å¥½çš„åŠžæ³•ã€‚ Field isnâ€™t final but should be æ­¤å­—æ®µå‰åº”è¯¥åŠ final Field isnâ€™t final and canâ€™t be protected from malicious code æ­¤å­—æ®µå‰åº”è¯¥åŠ final Field should be package protected ä¸€ä¸ªé™æ€å­—æ®µæ˜¯å¯ä»¥è¢«æ¶æ„ä»£ç æˆ–å…¶ä»–çš„åŒ…è®¿é—®ä¿®æ”¹ã€‚å¯ä»¥æŠŠè¿™ç§ç±»åž‹çš„å­—æ®µå£°æ˜Žä¸ºfinalç±»åž‹çš„ä»¥é˜²æ­¢è¿™ç§é”™è¯¯ã€‚ Multithreaded correctness å…³äºŽå¤šçº¿ç¨‹ä»£ç æ­£ç¡®æ€§ç›¸å…³æ–¹é¢çš„ Static DateFormat DateFormat åœ¨å¤šçº¿ç¨‹ä¸­æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æžœåœ¨çº¿ç¨‹èŒƒå›´ä¸­å…±äº«ä¸€ä¸ªDateFormatçš„å®žä¾‹è€Œä¸ä½¿ç”¨ä¸€ä¸ªåŒæ­¥çš„æ–¹æ³•åœ¨åº”ç”¨ä¸­å°±ä¼šå‡ºçŽ°ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºã€‚ Call to static DateFormat DateFormatså¤šçº¿ç¨‹ä½¿ç”¨æœ¬äº‹å°±æ˜¯ä¸å®‰å…¨çš„,æ”¹è¿›æ–¹æ³•ï¼šéœ€è¦åˆ›å»ºå¤šå®žä¾‹æˆ–çº¿ç¨‹åŒæ­¥ Correctness å…³äºŽä»£ç æ­£ç¡®æ€§ç›¸å…³æ–¹é¢çš„ Nullcheck of value previously dereferenced æ­¤ä»£ç ä¹‹å‰åºŸå¼ƒnullå€¼æ£€æŸ¥ã€‚è§£å†³åŠžæ³• è¿›è¡Œnullæ£€æŸ¥ Possible null pointer dereference å¯èƒ½ä¸ºnull Null pointer dereference å¯¹è±¡èµ‹ä¸ºnullå€¼åŽ æ²¡æœ‰è¢«é‡æ–°èµ‹å€¼ Possible null pointer dereference in method on exception path åœ¨å¼‚å¸¸nullå€¼å¤„ç†åˆ†æ”¯è°ƒç”¨çš„æ–¹æ³•ä¸Šï¼Œå¯èƒ½å­˜åœ¨å¯¹è±¡åŽ»é™¤å¼•ç”¨æ“ä½œ value is null and guaranteed to be dereferenced on exception path exceptionåˆ†æ”¯ä¸Šï¼Œå­˜åœ¨å¼•ç”¨ä¸€ä¸ªnullå¯¹è±¡çš„æ–¹æ³•ï¼Œå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ Self comparison of value with itself æ–¹æ³•ä¸­å¯¹ä¸€ä¸ªå±€éƒ¨å˜é‡è‡ªèº«è¿›è¡Œæ¯”è¾ƒè¿ç®—ï¼Œå¹¶å¯è¯´æ˜Žé”™è¯¯æˆ–é€»è¾‘é”™è¯¯ã€‚è¯·ç¡®ä¿æ‚¨æ˜¯æ¯”è¾ƒæ­£ç¡®çš„äº‹æƒ…ã€‚ An apparent infinite recursive loop æ˜Žæ˜¾çš„æ— é™è¿­ä»£å¾ªçŽ¯,å°†å¯¼è‡´å †æ ˆæº¢å‡º.]]></content>
      <categories>
        <category>IDEA</category>
        <category>æ’ä»¶</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
        <tag>æ’ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼]]></title>
    <url>%2Fposts%2Fb6c1490f.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰ æ˜¯è¡Œä¸ºåž‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå…¶å°†é“¾ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çœ‹ä½œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¤„ç†çš„è¯·æ±‚å‡ä¸åŒï¼Œä»Žè€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’ŒæŽ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸”å†…éƒ¨è‡ªåŠ¨ç»´æŠ¤ä¸€ä¸ªä¸‹ä¸€èŠ‚ç‚¹å¯¹è±¡ã€‚å½“ä¸€ä¸ªè¯·æ±‚ä»Žé“¾å¼çš„é¦–ç«¯å‘å‡ºæ—¶ï¼Œä¼šæ²¿ç€é“¾çš„è·¯å¾„ä¾æ¬¡ä¼ é€’ç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œç›´è‡³æœ‰å¯¹è±¡å¤„ç†è¿™ä¸ªè¯·æ±‚ä¸ºæ­¢ã€‚ ä¸»è¦ä½œç”¨ è´£ä»»é“¾æ¨¡å¼ è§£è€¦äº†è¯·æ±‚ä¸Žå¤„ç†ï¼Œå®¢æˆ·åªéœ€å°†è¯·æ±‚å‘é€åˆ°é“¾ä¸Šå³å¯ï¼Œæ— éœ€å…³å¿ƒè¯·æ±‚çš„å…·ä½“å†…å®¹å’Œå¤„ç†ç»†èŠ‚ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨è¿›è¡Œä¼ é€’ç›´è‡³æœ‰èŠ‚ç‚¹å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ UMLç±»å›¾ è§’è‰² Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰ï¼šå®ƒå®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æŽ¥å£ï¼Œä¸€èˆ¬è®¾è®¡ä¸ºæŠ½è±¡ç±»ï¼Œç”±äºŽä¸åŒçš„å…·ä½“å¤„ç†è€…å¤„ç†è¯·æ±‚çš„æ–¹å¼ä¸åŒï¼Œå› æ­¤åœ¨å…¶ä¸­å®šä¹‰äº†æŠ½è±¡è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚å› ä¸ºæ¯ä¸€ä¸ªå¤„ç†è€…çš„ä¸‹å®¶è¿˜æ˜¯ä¸€ä¸ªå¤„ç†è€…ï¼Œå› æ­¤åœ¨æŠ½è±¡å¤„ç†è€…ä¸­å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡å¤„ç†è€…ç±»åž‹çš„å¯¹è±¡ï¼Œä½œä¸ºå…¶å¯¹ä¸‹å®¶çš„å¼•ç”¨ã€‚é€šè¿‡è¯¥å¼•ç”¨ï¼Œå¤„ç†è€…å¯ä»¥è¿žæˆä¸€æ¡é“¾ã€‚ ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡å¤„ç†è€…çš„å­ç±»ï¼Œå¯ä»¥å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œåœ¨å…·ä½“å¤„ç†è€…ç±»ä¸­å®žçŽ°äº†æŠ½è±¡å¤„ç†è€…ä¸­å®šä¹‰çš„æŠ½è±¡è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œåœ¨å¤„ç†è¯·æ±‚ä¹‹å‰éœ€è¦è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦æœ‰ç›¸åº”çš„å¤„ç†æƒé™ï¼Œå¦‚æžœå¯ä»¥å¤„ç†è¯·æ±‚å°±å¤„ç†å®ƒï¼Œå¦åˆ™å°†è¯·æ±‚è½¬å‘ç»™åŽç»§è€…ï¼›åœ¨å…·ä½“å¤„ç†è€…ä¸­å¯ä»¥è®¿é—®é“¾ä¸­ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿è¯·æ±‚çš„è½¬å‘ã€‚ æ¨¡å¼ä¼˜ç‚¹ å¯¹è±¡ä»…éœ€çŸ¥é“è¯¥è¯·æ±‚ä¼šè¢«å¤„ç†å³å¯ï¼Œä¸”é“¾ä¸­çš„å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æž„ï¼Œç”±å®¢æˆ·ç«¯è´Ÿè´£é“¾çš„åˆ›å»ºï¼Œé™ä½Žäº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ è¯·æ±‚å¤„ç†å¯¹è±¡ä»…éœ€ç»´æŒä¸€ä¸ªæŒ‡å‘å…¶åŽç»§è€…çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ç»´æŒå®ƒå¯¹æ‰€æœ‰çš„å€™é€‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œå¯ç®€åŒ–å¯¹è±¡çš„ç›¸äº’è¿žæŽ¥ã€‚ é“¾è·¯ç»“æž„çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜é“¾è·¯ç»“æž„åŠ¨æ€åœ°æ–°å¢žæˆ–åˆ å‡è´£ä»»ã€‚ æ–°å¢žä¸€ä¸ªæ–°çš„å…·ä½“è¯·æ±‚å¤„ç†è€…æ—¶æ— é¡»ä¿®æ”¹åŽŸæœ‰ä»£ç ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯é‡æ–°å»ºé“¾å³å¯ï¼Œç¬¦åˆ &quot;å¼€é—­åŽŸåˆ™&quot;ã€‚ æ¨¡å¼ç¼ºç‚¹ ä¸€ä¸ªè¯·æ±‚å¯èƒ½å› èŒè´£é“¾æ²¡æœ‰è¢«æ­£ç¡®é…ç½®è€Œå¾—ä¸åˆ°å¤„ç†ã€‚ å¯¹äºŽæ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œä¸”ä¸æ–¹ä¾¿è°ƒè¯•ã€‚ å¦‚æžœèŠ‚ç‚¹å¯¹è±¡å­˜åœ¨å¾ªçŽ¯å¼•ç”¨æ—¶ï¼Œä¼šé€ æˆæ­»å¾ªçŽ¯ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ é€‚ç”¨åœºæ™¯ æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚å¾…è¿è¡Œæ—¶åˆ»å†ç¡®å®šï¼Œå®¢æˆ·ç«¯åªéœ€å°†è¯·æ±‚æäº¤åˆ°é“¾ä¸Šï¼Œè€Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†å¯¹è±¡æ˜¯è°ä»¥åŠå®ƒæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ åœ¨ä¸æ˜Žç¡®æŒ‡å®šæŽ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€åˆ›å»ºèŒè´£é“¾æ¥å¤„ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥æ”¹å˜é“¾ä¸­å¤„ç†è€…ä¹‹é—´çš„å…ˆåŽæ¬¡åºã€‚ ä½¿ç”¨æ­¥éª¤ å®šä¹‰æŠ½è±¡å¤„ç†è€… 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®šä¹‰æŠ½è±¡å¤„ç†è€…--èŒè´£çš„æŽ¥å£ï¼Œä¹Ÿå°±æ˜¯å¤„ç†è¯·æ±‚çš„æŽ¥å£ */public abstract class Handler &#123; /** * æŒæœ‰åŽç»§çš„èŒè´£å¯¹è±¡ */ protected Handler successor; /** * è®¾ç½®åŽç»§çš„èŒè´£å¯¹è±¡ * * @param successor åŽç»§çš„èŒè´£å¯¹è±¡ */ public void setSuccessor(Handler successor) &#123; this.successor = successor; &#125; /** * ç¤ºæ„å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªç¤ºæ„æ–¹æ³•æ˜¯æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œ * ä½†å®žé™…æ˜¯å¯ä»¥ä¼ å…¥å‚æ•°çš„ï¼Œæ ¹æ®å…·ä½“éœ€è¦æ¥é€‰æ‹©æ˜¯å¦ä¼ é€’å‚æ•° */ public abstract void handleRequest();&#125; å®šä¹‰å…·ä½“å¤„ç†è€… 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®šä¹‰å…·ä½“å¤„ç†è€…--å…·ä½“çš„èŒè´£å¯¹è±¡ï¼Œç”¨æ¥å¤„ç†è¯·æ±‚ */public class ConcreteHandler1 extends Handler &#123; @Override public void handleRequest() &#123; //æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ //åˆ¤æ–­æ¡ä»¶æ¯”å¦‚ï¼šä»Žå¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œæˆ–è€…è¿™é‡Œä¸»åŠ¨åŽ»èŽ·å–çš„å¤–éƒ¨æ•°æ®ï¼Œ //å¦‚ä»Žæ•°æ®åº“ä¸­èŽ·å–ç­‰ï¼Œä¸‹é¢è¿™å¥è¯åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = false; if (someCondition) &#123; //å¦‚æžœå±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ //å…·ä½“çš„å¤„ç†ä»£ç  System.out.println("å…·ä½“å¤„ç†è€…1 å¤„ç†è¯·æ±‚..."); &#125; else &#123; //å¦‚æžœä¸å±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åŽç»§çš„èŒè´£å¯¹è±¡ //å¦‚æžœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åŽç»§çš„èŒè´£å¯¹è±¡ //å¦‚æžœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (this.successor != null) &#123; this.successor.handleRequest(); &#125; &#125; &#125;&#125;package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…2 */public class ConcreteHandler2 extends Handler &#123; @Override public void handleRequest() &#123; //æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ //åˆ¤æ–­æ¡ä»¶æ¯”å¦‚ï¼šä»Žå¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œæˆ–è€…è¿™é‡Œä¸»åŠ¨åŽ»èŽ·å–çš„å¤–éƒ¨æ•°æ®ï¼Œ //å¦‚ä»Žæ•°æ®åº“ä¸­èŽ·å–ç­‰ï¼Œä¸‹é¢è¿™å¥è¯åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = true; if (someCondition) &#123; //å¦‚æžœå±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ //å…·ä½“çš„å¤„ç†ä»£ç  System.out.println("å…·ä½“å¤„ç†è€…2 å¤„ç†è¯·æ±‚..."); &#125; else &#123; //å¦‚æžœä¸å±žäºŽè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åŽç»§çš„èŒè´£å¯¹è±¡ //å¦‚æžœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åŽç»§çš„èŒè´£å¯¹è±¡ //å¦‚æžœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (this.successor != null) &#123; this.successor.handleRequest(); &#125; &#125; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new ConcreteHandler1(); Handler h2 = new ConcreteHandler2(); h1.setSuccessor(h2); //ç„¶åŽæäº¤è¯·æ±‚ h1.handleRequest(); &#125;&#125; æ¨¡å¼ç¤ºä¾‹ èƒŒæ™¯ å¾ˆå¤šå…¬å¸éƒ½æœ‰è¿™æ ·çš„ç¦åˆ©ï¼Œå°±æ˜¯é¡¹ç›®ç»„æˆ–è€…æ˜¯éƒ¨é—¨å¯ä»¥å‘å…¬å¸ç”³è¯·ä¸€äº›èšé¤è´¹ç”¨ï¼Œç”¨äºŽç»„ç»‡é¡¹ç›®ç»„æˆå‘˜æˆ–è€…æ˜¯éƒ¨é—¨æˆå‘˜è¿›è¡Œèšé¤æ´»åŠ¨ï¼Œä»¥å¢žè¿›äººå‘˜ä¹‹é—´çš„æƒ…æ„Ÿï¼Œæ›´æœ‰åˆ©äºŽå·¥ä½œä¸­çš„ç›¸äº’åˆä½œã€‚ ç”³è¯·èšé¤è´¹ç”¨çš„å¤§è‡´æµç¨‹ä¸€èˆ¬æ˜¯ï¼šç”±ç”³è¯·äººå…ˆå¡«å†™ç”³è¯·å•ï¼Œç„¶åŽäº¤ç»™é¢†å¯¼å®¡æŸ¥ï¼Œå¦‚æžœç”³è¯·æ‰¹å‡†ä¸‹æ¥äº†ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹é€šè¿‡ï¼Œç„¶åŽç”³è¯·äººåŽ»è´¢åŠ¡æ ¸é¢†è´¹ç”¨ï¼Œå¦‚æžœæ²¡æœ‰æ ¸å‡†ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹æœªé€šè¿‡ï¼Œæ­¤äº‹ä¹Ÿå°±æ­¤ä½œç½¢äº†ã€‚ ä¸åŒçº§åˆ«çš„é¢†å¯¼ï¼Œå¯¹äºŽå®¡æ‰¹çš„é¢åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ï¼šé¡¹ç›®ç»ç†åªèƒ½å®¡æ‰¹500å…ƒä»¥å†…çš„ç”³è¯·ï¼›éƒ¨é—¨ç»ç†èƒ½å®¡æ‰¹1000å…ƒä»¥å†…çš„ç”³è¯·ï¼›è€Œæ€»ç»ç†å¯ä»¥å®¡æ ¸ä»»æ„é¢åº¦çš„ç”³è¯·ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åŽï¼Œè¯¥è¯·æ±‚ä¼šç”±é¡¹ç›®ç»ç†ã€éƒ¨é—¨ç»ç†ã€æ€»ç»ç†ä¹‹ä¸­çš„æŸä¸€ä½é¢†å¯¼æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯æå‡ºç”³è¯·çš„äººå¹¶ä¸çŸ¥é“æœ€ç»ˆä¼šç”±è°æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä¸€èˆ¬ç”³è¯·äººæ˜¯æŠŠè‡ªå·±çš„ç”³è¯·æäº¤ç»™é¡¹ç›®ç»ç†ï¼Œæˆ–è®¸æœ€åŽæ˜¯ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä½†æ˜¯ç”³è¯·äººå¹¶ä¸çŸ¥é“åº”è¯¥ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„ç”³è¯·è¯·æ±‚ã€‚ åˆ†æž å½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åŽï¼Œè¯¥è¯·æ±‚ä¼šåœ¨é¡¹ç›®ç»ç†-éƒ¨é—¨ç»ç†-æ€»ç»ç†è¿™æ ·ä¸€æ¡é¢†å¯¼å¤„ç†é“¾ä¸Šè¿›è¡Œä¼ é€’ï¼Œå‘å‡ºè¯·æ±‚çš„äººå¹¶ä¸çŸ¥é“è°ä¼šæ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œæ¯ä¸ªé¢†å¯¼ä¼šæ ¹æ®è‡ªå·±çš„èŒè´£èŒƒå›´ï¼Œæ¥åˆ¤æ–­æ˜¯å¤„ç†è¯·æ±‚è¿˜æ˜¯æŠŠè¯·æ±‚äº¤ç»™æ›´é«˜çº§çš„é¢†å¯¼ï¼Œåªè¦æœ‰é¢†å¯¼å¤„ç†äº†ï¼Œä¼ é€’å°±ç»“æŸäº†ã€‚ éœ€è¦æŠŠæ¯ä½é¢†å¯¼çš„å¤„ç†ç‹¬ç«‹å‡ºæ¥ï¼Œå®žçŽ°æˆå•ç‹¬çš„èŒè´£å¤„ç†å¯¹è±¡ï¼Œç„¶åŽä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªå…¬å…±çš„ã€æŠ½è±¡çš„çˆ¶èŒè´£å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯æ¥åŠ¨æ€çš„ç»„åˆèŒè´£é“¾ï¼Œå®žçŽ°ä¸åŒçš„åŠŸèƒ½è¦æ±‚äº†ã€‚ å…·ä½“ä»£ç  å®šä¹‰æŠ½è±¡å¤„ç†è€… 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æŠ½è±¡å¤„ç†è€…ç±»ï¼Œå®šä¹‰èŒè´£å¯¹è±¡ */public abstract class Handler &#123; /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) &#123; this.successor = successor; &#125; /** * å¤„ç†èšé¤è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param fee ç”³è¯·çš„é’±æ•° * @return æˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“é€šçŸ¥ */ public abstract String handleFeeRequest(String user, double fee);&#125; å®šä¹‰å…·ä½“å¤„ç†è€… é¡¹ç›®ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (fee &lt; 500) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(user)) &#123; str = "é¡¹ç›®ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125;&#125; éƒ¨é—¨ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--éƒ¨é—¨ç»ç† */public class DepManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (fee &lt; 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽç”³è¯·çš„ if ("å°æŽ".equals(user)) &#123; str = "éƒ¨é—¨ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125;&#125; æ€»ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--æ€»ç»ç† */public class GeneralManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (fee &gt;= 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(user)) &#123; str = "æ€»ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //å¦‚æžœè¿˜æœ‰åŽç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) &#123; return successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client &#123; public static void main(String[] args) &#123; //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DepManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯• String ret1 = h3.handleFeeRequest("å°æŽ", 300); System.out.println("the ret1=" + ret1); String ret2 = h3.handleFeeRequest("å°å¼ ", 300); System.out.println("the ret2=" + ret2); String ret3 = h3.handleFeeRequest("å°æŽ", 600); System.out.println("the ret3=" + ret3); String ret4 = h3.handleFeeRequest("å°å¼ ", 600); System.out.println("the ret4=" + ret4); String ret5 = h3.handleFeeRequest("å°æŽ", 1200); System.out.println("the ret5=" + ret5); String ret6 = h3.handleFeeRequest("å°å¼ ", 1200); System.out.println("the ret6=" + ret6); &#125;&#125; æ‹“å±•-å¤„ç†å¤šç§è¯·æ±‚ ä¸Šé¢çš„ç¤ºä¾‹æ˜¯åŒä¸€ä¸ªèŒè´£é“¾å¤„ç†ä¸€ç§è¯·æ±‚çš„æƒ…å†µï¼ŒçŽ°åœ¨æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè¿˜æ˜¯è´¹ç”¨ç”³è¯·çš„åŠŸèƒ½ï¼Œè¿™æ¬¡æ˜¯ç”³è¯·é¢„æ”¯å·®æ—…è´¹ï¼Œå‡è®¾è¿˜æ˜¯åŒä¸€æµç¨‹ï¼Œä¹Ÿå°±æ˜¯ç»„åˆåŒä¸€ä¸ªèŒè´£é“¾ï¼Œä»Žé¡¹ç›®ç»ç†-ä¼ é€’ç»™éƒ¨é—¨ç»ç†-ä¼ é€’ç»™æ€»ç»ç†ï¼Œè™½ç„¶æµç¨‹ç›¸åŒï¼Œä½†æ˜¯æ¯ä¸ªå¤„ç†ç±»éœ€è¦å¤„ç†ä¸¤ç§è¯·æ±‚ï¼Œå®ƒä»¬çš„å…·ä½“ä¸šåŠ¡é€»è¾‘æ˜¯ä¸ä¸€æ ·çš„ã€‚ ç®€å•çš„å¤„ç†æ–¹å¼ ç®€å•å¤„ç†æ–¹å¼å°±æ˜¯ä¸ºæ¯ç§ä¸šåŠ¡å•ç‹¬å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åŽå®¢æˆ·ç«¯æ ¹æ®ä¸åŒçš„éœ€è¦è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚ ç›´æŽ¥æ”¹é€ ä¸Šé¢çš„ä»£ç ï¼Œè¿™é‡Œæ•…æ„æŠŠä¸¤ä¸ªæ–¹æ³•åšçš„æœ‰äº›ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯è¿”å›žStringç±»åž‹çš„å€¼ï¼Œä¸€ä¸ªæ˜¯è¿”å›žbooleanç±»åž‹çš„å€¼ï¼›ä¸€ä¸ªè¿”å›žåˆ°å®¢æˆ·ç«¯å†è¾“å‡ºä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯ç›´æŽ¥åœ¨èŒè´£å¤„ç†é‡Œé¢å°±è¾“å‡ºä¿¡æ¯ã€‚ é¦–å…ˆæ˜¯æ”¹é€ èŒè´£å¯¹è±¡çš„æŽ¥å£ï¼Œæ·»åŠ ä¸Šæ–°çš„ä¸šåŠ¡æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æŠ½è±¡å¤„ç†è€…ç±»ï¼Œå®šä¹‰èŒè´£å¯¹è±¡ */public abstract class Handler &#123; /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) &#123; this.successor = successor; &#125; /** * å¤„ç†èšé¤è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param fee ç”³è¯·çš„é’±æ•° * @return æˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“é€šçŸ¥ */ public abstract String handleFeeRequest(String user, double fee); /** * å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param requestFee ç”³è¯·çš„é’±æ•° * @return æ˜¯å¦åŒæ„ */ public abstract boolean handlePreFeeRequest(String user, double requestFee);&#125; èŒè´£çš„æŽ¥å£å‘ç”Ÿäº†æ”¹å˜ï¼Œå¯¹åº”çš„å¤„ç†ç±»ä¹Ÿè¦æ”¹å˜ï¼Œè¿™å‡ ä¸ªå¤„ç†ç±»æ˜¯ç±»ä¼¼çš„ï¼ŒåŽŸæœ‰çš„åŠŸèƒ½ä¸å˜ï¼Œç„¶åŽåœ¨æ–°çš„å®žçŽ°æ–¹æ³•é‡Œé¢ï¼ŒåŒæ ·åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å±žäºŽè‡ªå·±å¤„ç†çš„èŒƒå›´ï¼Œå¦‚æžœå±žäºŽè‡ªå·±å¤„ç†çš„èŒƒå›´é‚£å°±å¤„ç†ï¼Œå¦åˆ™å°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¤„ç†ã€‚ é¡¹ç›®ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (fee &lt; 500) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(user)) &#123; str = "é¡¹ç›®ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125; @Override public boolean handlePreFeeRequest(String user, double requestNum) &#123; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨5000ä»¥å†… if (requestNum &lt; 5000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("é¡¹ç›®ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestNum + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //è¶…è¿‡5000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handlePreFeeRequest(user, requestNum); &#125; &#125; return false; &#125;&#125; éƒ¨é—¨ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--éƒ¨é—¨ç»ç† */public class DepManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (fee &lt; 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽç”³è¯·çš„ if ("å°æŽ".equals(user)) &#123; str = "éƒ¨é—¨ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125; @Override public boolean handlePreFeeRequest(String user, double requestFee) &#123; //éƒ¨é—¨ç»ç†çš„æƒé™20000ä»¥å†… if (requestFee &lt; 20000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("éƒ¨é—¨ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestFee + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //è¶…è¿‡20000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handlePreFeeRequest(user, requestFee); &#125; &#125; return false; &#125;&#125; æ€»ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--æ€»ç»ç† */public class GeneralManager extends Handler &#123; @Override public String handleFeeRequest(String user, double fee) &#123; String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (fee &gt;= 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(user)) &#123; str = "æ€»ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //å¦‚æžœè¿˜æœ‰åŽç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) &#123; return successor.handleFeeRequest(user, fee); &#125; &#125; return str; &#125; @Override public boolean handlePreFeeRequest(String user, double requestFee) &#123; //æ€»ç»ç†çš„æƒé™50000ä»¥å†… if (requestFee &lt; 50000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("æ€»ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestFee + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //å¦‚æžœè¿˜æœ‰åŽç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) &#123; return this.successor.handlePreFeeRequest(user, requestFee); &#125; &#125; return false; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client &#123; public static void main(String[] args) &#123; //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DepManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ String ret1 = h3.handleFeeRequest("å°æŽ", 300); System.out.println("the ret1=" + ret1); String ret2 = h3.handleFeeRequest("å°å¼ ", 300); System.out.println("the ret2=" + ret2); String ret3 = h3.handleFeeRequest("å°æŽ", 600); System.out.println("the ret3=" + ret3); String ret4 = h3.handleFeeRequest("å°å¼ ", 600); System.out.println("the ret4=" + ret4); String ret5 = h3.handleFeeRequest("å°æŽ", 1200); System.out.println("the ret5=" + ret5); String ret6 = h3.handleFeeRequest("å°å¼ ", 1200); System.out.println("the ret6=" + ret6); //å¼€å§‹æµ‹è¯•ç”³è¯·å·®æ—…è´¹ç”¨ h3.handlePreFeeRequest("å°å¼ ", 3000); h3.handlePreFeeRequest("å°å¼ ", 6000); h3.handlePreFeeRequest("å°å¼ ", 32000); &#125;&#125; é€šç”¨è¯·æ±‚å¤„ç†æ–¹å¼ ç®€å•å¤„ç†æ–¹å¼å®žçŽ°èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ˜Žæ˜¾çš„é—®é¢˜å°±æ˜¯åªè¦å¢žåŠ ä¸€ä¸ªä¸šåŠ¡ï¼Œå°±éœ€è¦ä¿®æ”¹èŒè´£çš„æŽ¥å£ï¼Œè¿™æ˜¯å¾ˆä¸çµæ´»çš„ï¼ŒJavaå¼€å‘ä¸­å¾ˆå¼ºè°ƒé¢å‘æŽ¥å£ç¼–ç¨‹ï¼Œå› æ­¤æŽ¥å£åº”è¯¥ç›¸å¯¹ä¿æŒç¨³å®šï¼ŒæŽ¥å£ä¸€æ”¹ï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±å¤ªå¤šäº†ï¼Œé¢‘ç¹ä¿®æ”¹æŽ¥å£ç»å¯¹ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ‰€ä»¥æ”¹é€ å¦‚ä¸‹ï¼š é¦–å…ˆå®šä¹‰ä¸€å¥—é€šç”¨çš„è°ƒç”¨æ¡†æž¶ï¼Œç”¨ä¸€ä¸ªé€šç”¨çš„è¯·æ±‚å¯¹è±¡æ¥å°è£…è¯·æ±‚ä¼ é€’çš„å‚æ•°ï¼› ç„¶åŽå®šä¹‰ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸åŽ»åŒºåˆ†å…·ä½“ä¸šåŠ¡ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡éƒ½æ˜¯è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨é€šç”¨çš„è¯·æ±‚å¯¹è±¡é‡Œé¢ä¼šæœ‰ä¸€ä¸ªä¸šåŠ¡çš„æ ‡è®°è¿›è¡Œä¸šåŠ¡åŒºåˆ†ï¼› åˆ°äº†èŒè´£å¯¹è±¡é‡Œé¢ï¼Œæ„¿æ„å¤„ç†å°±è·ŸåŽŸæ¥ä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼Œå¦‚æžœä¸æ„¿æ„å¤„ç†ï¼Œå°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡å°±å¥½äº†ã€‚ å¯¹äºŽè¿”å›žå€¼ä¹Ÿå¯ä»¥æ¥ä¸ªé€šç”¨çš„ï¼Œæœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨Objectç±»åž‹ã€‚ å…·ä½“ä»£ç  é€šç”¨çš„è¯·æ±‚å¯¹è±¡çš„å®šä¹‰ 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é€šç”¨çš„è¯·æ±‚å¯¹è±¡ */public class RequestModel &#123; /** * è¡¨ç¤ºå…·ä½“çš„ä¸šåŠ¡ç±»åž‹ */ private String type; /** * é€šè¿‡æž„é€ æ–¹æ³•æŠŠå…·ä½“çš„ä¸šåŠ¡ç±»åž‹ä¼ é€’è¿›æ¥ * * @param type å…·ä½“çš„ä¸šåŠ¡ç±»åž‹ */ public RequestModel(String type) &#123; this.type = type; &#125; public String getType() &#123; return type; &#125;&#125; æ­¤æ—¶çš„é€šç”¨èŒè´£å¤„ç†å¯¹è±¡ï¼Œåœ¨è¿™é‡Œè¦å®žçŽ°ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ¡†æž¶ 1234567891011121314151617181920212223242526272829303132333435363738package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é€šç”¨èŒè´£å¤„ç†å¯¹è±¡ï¼Œåœ¨è¿™é‡Œè¦å®žçŽ°ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ¡†æž¶ */public abstract class Handler &#123; /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) &#123; this.successor = successor; &#125; /** * é€šç”¨çš„è¯·æ±‚å¤„ç†æ–¹æ³• * * @param rm é€šç”¨çš„è¯·æ±‚å¯¹è±¡ * @return å¤„ç†åŽéœ€è¦è¿”å›žçš„å¯¹è±¡ */ public Object handleRequest(RequestModel rm) &#123; if (successor != null) &#123; //è¿™ä¸ªæ˜¯é»˜è®¤çš„å®žçŽ°ï¼Œå¦‚æžœå­ç±»ä¸æ„¿æ„å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œ //é‚£å°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŒè´£å¯¹è±¡åŽ»å¤„ç† return this.successor.handleRequest(rm); &#125; else &#123; System.out.println("æ²¡æœ‰åŽç»­å¤„ç†æˆ–è€…æš‚æ—¶ä¸æ”¯æŒè¿™æ ·çš„åŠŸèƒ½å¤„ç†"); return false; &#125; &#125;&#125; çŽ°åœ¨æ¥åŠ ä¸Šç¬¬ä¸€ä¸ªä¸šåŠ¡ï¼Œå°±æ˜¯â€œèšé¤è´¹ç”¨ç”³è¯·â€çš„å¤„ç†ï¼Œä¸ºäº†æè¿°å…·ä½“çš„ä¸šåŠ¡æ•°æ®ï¼Œéœ€è¦æ‰©å±•é€šç”¨çš„è¯·æ±‚å¯¹è±¡ï¼ŒæŠŠä¸šåŠ¡æ•°æ®å°è£…è¿›åŽ»ï¼Œå¦å¤–å®šä¹‰ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å…·ä½“çš„ä¸šåŠ¡è¯·æ±‚å¯¹è±¡--èšé¤è´¹ç”¨ç”³è¯· */public class FeeRequestModel extends RequestModel &#123; /** * çº¦å®šå…·ä½“çš„ä¸šåŠ¡ç±»åž‹ */ public final static String FEE_TYPE = "fee"; public FeeRequestModel() &#123; super(FEE_TYPE); &#125; /** * ç”³è¯·äºº */ private String user; /** * ç”³è¯·é‡‘é¢ */ private double fee; public String getUser() &#123; return user; &#125; public void setUser(String user) &#123; this.user = user; &#125; public double getFee() &#123; return fee; &#125; public void setFee(double fee) &#123; this.fee = fee; &#125;&#125; æŽ¥ä¸‹æ¥è¯¥å®žçŽ°èŒè´£å¯¹è±¡çš„å¤„ç†äº†ï¼Œé¦–å…ˆè¦è¦†ç›–çˆ¶ç±»çš„é€šç”¨ä¸šåŠ¡å¤„ç†æ–¹æ³•ï¼Œç„¶åŽåœ¨é‡Œé¢å¤„ç†è‡ªå·±æƒ³è¦å®žçŽ°çš„ä¸šåŠ¡ï¼Œä¸æƒ³å¤„ç†çš„å°±è®©çˆ¶ç±»åŽ»å¤„ç†ï¼Œçˆ¶ç±»ä¼šé»˜è®¤çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡ã€‚ é¡¹ç›®ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å…·ä½“çš„èŒè´£å¯¹è±¡--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„é¡¹ç›®ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (frm.getFee() &lt; 500) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(frm.getUser())) &#123; str = "é¡¹ç›®ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return successor.handleRequest(rm); &#125; &#125; return str; &#125;&#125; éƒ¨é—¨ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: éƒ¨é—¨ç»ç† */public class DeptManager extends Handler &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„éƒ¨é—¨ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (frm.getFee() &lt; 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(frm.getUser())) &#123; str = "éƒ¨é—¨ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return successor.handleRequest(rm); &#125; &#125; return str; &#125;&#125; æ€»ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: æ€»ç»ç† */public class GeneralManager extends Handler &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„æ€»ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (frm.getFee() &gt;= 1000) &#123; //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æŽçš„ if ("å°æŽ".equals(frm.getUser())) &#123; str = "æ€»ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; else &#123; //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; &#125; return str; &#125; else &#123; //å¦‚æžœè¿˜æœ‰åŽç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) &#123; return successor.handleRequest(rm); &#125; &#125; return str; &#125;&#125; å¯¹äºŽå®¢æˆ·ç«¯ï¼Œå”¯ä¸€çš„éº»çƒ¦æ˜¯éœ€è¦çŸ¥é“æ¯ä¸ªä¸šåŠ¡å¯¹åº”çš„å…·ä½“çš„è¯·æ±‚å¯¹è±¡ï¼Œå› ä¸ºè¦å°è£…ä¸šåŠ¡æ•°æ®è¿›åŽ». 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DeptManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ FeeRequestModel frm = new FeeRequestModel(); frm.setFee(300); frm.setUser("å°æŽ"); //è°ƒç”¨å¤„ç† String ret1 = (String) h3.handleRequest(frm); System.out.println("ret1=" + ret1); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(800); h3.handleRequest(frm); String ret2 = (String) h3.handleRequest(frm); System.out.println("ret2=" + ret2); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(1600); h3.handleRequest(frm); String ret3 = (String) h3.handleRequest(frm); System.out.println("ret3=" + ret3); &#125;&#125; æŽ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åœ¨ä¸æ”¹åŠ¨çŽ°æœ‰çš„æ¡†æž¶çš„å‰æä¸‹ï¼Œæ‰©å±•æ–°çš„ä¸šåŠ¡ï¼Œè¿™æ ·æ‰èƒ½è¯´æ˜Žè¿™ç§è®¾è®¡çš„çµæ´»æ€§ã€‚ å‡å¦‚å°±æ˜¯è¦å®žçŽ°ä¸Šé¢ç¤ºä¾‹è¿‡çš„å¦å¤–ä¸€ä¸ªåŠŸèƒ½â€œé¢„æ”¯å·®æ—…è´¹ç”³è¯·â€ã€‚è¦æƒ³æ‰©å±•æ–°çš„ä¸šåŠ¡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æ–°å»ºä¸€ä¸ªå°è£…ä¸šåŠ¡æ•°æ®çš„å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é¢„æ”¯å·®æ—…è´¹ç”¨è¯·æ±‚å¯¹è±¡ */public class PreFeeRequestModel extends RequestModel &#123; /** * çº¦å®šå…·ä½“çš„ä¸šåŠ¡ç±»åž‹ */ public final static String FEE_TYPE = "preFee"; public PreFeeRequestModel() &#123; super(FEE_TYPE); &#125; /** * ç”³è¯·äºº */ private String user; /** * ç”³è¯·é‡‘é¢ */ private double fee; public String getUser() &#123; return user; &#125; public void setUser(String user) &#123; this.user = user; &#125; public double getFee() &#123; return fee; &#125; public void setFee(double fee) &#123; this.fee = fee; &#125;&#125; å¯¹äºŽå…·ä½“è¿›è¡ŒèŒè´£å¤„ç†çš„ç±»ï¼Œæ¯”è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯æ‰©å±•å‡ºå­ç±»æ¥ï¼Œç„¶åŽåœ¨å­ç±»é‡Œé¢å®žçŽ°æ–°åŠ å…¥çš„ä¸šåŠ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æŽ¥åœ¨åŽŸæ¥çš„å¯¹è±¡ä¸Šæ”¹ã€‚è¿™é‡Œé‡‡ç”¨æ‰©å±•å‡ºå­ç±»çš„æ–¹å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®žçŽ°ä¸ºé¡¹ç›®ç»ç†å¢žåŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * çŽ°åœ¨çš„é¡¹ç›®ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class ProjectManager2 extends ProjectManager &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„è®©çˆ¶ç±»åŽ»å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨5000ä»¥å†… if (frm.getFee() &lt; 5000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("é¡¹ç›®ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //è¶…è¿‡5000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handleRequest(rm); &#125; &#125; return false; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®žçŽ°ä¸ºéƒ¨é—¨ç»ç†å¢žåŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * çŽ°åœ¨çš„éƒ¨é—¨ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class DeptManager2 extends ProjectManager &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„è®©çˆ¶ç±»åŽ»å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //éƒ¨é—¨ç»ç†çš„æƒé™åœ¨20000ä»¥å†… if (frm.getFee() &lt; 20000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("éƒ¨é—¨ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //è¶…è¿‡20000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handleRequest(rm); &#125; &#125; return false; &#125;&#125; 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®žçŽ°ä¸ºæ€»ç»ç†å¢žåŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * çŽ°åœ¨çš„æ€»ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class GeneralManager2 extends ProjectManager &#123; @Override public Object handleRequest(RequestModel rm) &#123; if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) &#123; //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); &#125; else &#123; //å…¶å®ƒçš„è®©çˆ¶ç±»åŽ»å¤„ç† return super.handleRequest(rm); &#125; &#125; /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) &#123; //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ åž‹å›žæ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //æ€»ç»ç†çš„æƒé™åœ¨20000ä»¥å†… if (frm.getFee() &gt;= 20000) &#123; //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("æ€»ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; &#125; else &#123; //å¦‚æžœè¿˜æœ‰åŽç»­ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) &#123; return this.successor.handleRequest(rm); &#125; &#125; return false; &#125;&#125; æ­¤æ—¶çš„æµ‹è¯•ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: æ‹“å±•åŽçš„æµ‹è¯•ç±» */public class Client2 &#123; public static void main(String[] args) &#123; //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager2(); Handler h2 = new DeptManager2(); Handler h3 = new ProjectManager2(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ FeeRequestModel frm = new FeeRequestModel(); frm.setFee(300); frm.setUser("å°æŽ"); //è°ƒç”¨å¤„ç† String ret1 = (String) h3.handleRequest(frm); System.out.println("ret1=" + ret1); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(800); h3.handleRequest(frm); String ret2 = (String) h3.handleRequest(frm); System.out.println("ret2=" + ret2); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(1600); h3.handleRequest(frm); String ret3 = (String) h3.handleRequest(frm); System.out.println("ret3=" + ret3); //å¼€å§‹æµ‹è¯•ç”³è¯·é¢„æ”¯å·®æ—…è´¹ç”¨ PreFeeRequestModel pfrm = new PreFeeRequestModel(); pfrm.setFee(3000); pfrm.setUser("å°å¼ "); //è°ƒç”¨å¤„ç† h3.handleRequest(pfrm); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† pfrm.setFee(6000); h3.handleRequest(pfrm); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† pfrm.setFee(36000); h3.handleRequest(pfrm); &#125;&#125; æ€»ç»“ è¿™ç§è®¾è®¡æ–¹å¼çš„å¥½å¤„ï¼Œç›¸å½“çš„é€šç”¨å’Œçµæ´»ï¼Œæœ‰äº†æ–°ä¸šåŠ¡ï¼Œåªéœ€è¦æ·»åŠ å®žçŽ°æ–°åŠŸèƒ½çš„å¯¹è±¡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¸¦æ¥çš„ç¼ºé™·å°±æ˜¯å¯èƒ½ä¼šé€ æˆå¯¹è±¡å±‚æ¬¡è¿‡å¤šï¼Œæˆ–è€…å‡ºçŽ°è¾ƒå¤šçš„ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œæžç«¯æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å°±æ‰©å±•ä¸€ä¸ªæ–¹æ³•ï¼Œä¼šå‡ºçŽ°å¤§é‡åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½çš„ç»†ç²’åº¦å¯¹è±¡ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼]]></title>
    <url>%2Fposts%2F210c1e9b.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å°†ä¸€ä¸ªæŽ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæŽ¥å£ï¼Œä½¿æŽ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨(Wrapper)ã€‚ é€‚é…å™¨æ¨¡å¼æ—¢å¯ä»¥ä½œä¸ºç±»ç»“æž„åž‹æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¯¹è±¡ç»“æž„åž‹æ¨¡å¼ã€‚ ä¸»è¦ä½œç”¨ æä¾›ä¸€ä¸ªè½¬æ¢å™¨ï¼ˆé€‚é…å™¨ï¼‰ï¼Œå°†å½“å‰ç³»ç»Ÿå­˜åœ¨çš„ä¸€ä¸ªå¯¹è±¡è½¬åŒ–ä¸ºå®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®çš„æŽ¥å£å¯¹è±¡ã€‚ æ¨¡å¼åˆ†ç±» æ ¹æ®é€‚é…å™¨ç±»ä¸Žé€‚é…è€…ç±»çš„å…³ç³»ä¸åŒï¼Œé€‚é…å™¨æ¨¡å¼å¯åˆ†ä¸ºå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ä¸¤ç§ã€‚ åœ¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸Žé€‚é…è€…ä¹‹é—´æ˜¯å…³è”å…³ç³»ï¼› åœ¨ç±»é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸Žé€‚é…è€…ä¹‹é—´æ˜¯ç»§æ‰¿ï¼ˆæˆ–å®žçŽ°ï¼‰å…³ç³»ã€‚ æ¨¡å¼è§’è‰² Targetï¼ˆç›®æ ‡æŠ½è±¡ç±»ï¼‰ï¼šç›®æ ‡æŠ½è±¡ç±»å®šä¹‰å®¢æˆ·æ‰€éœ€æŽ¥å£ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æŽ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“ç±»ã€‚ Adapteeï¼ˆé€‚é…è€…ç±»ï¼‰ï¼šé€‚é…è€…å³è¢«é€‚é…çš„è§’è‰²ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æŽ¥å£ï¼Œè¿™ä¸ªæŽ¥å£éœ€è¦é€‚é…ï¼Œé€‚é…è€…ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼ŒåŒ…å«äº†å®¢æˆ·å¸Œæœ›ä½¿ç”¨çš„ä¸šåŠ¡æ–¹æ³•ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ²¡æœ‰é€‚é…è€…ç±»çš„æºä»£ç ã€‚ Adapterï¼ˆé€‚é…å™¨ç±»ï¼‰ï¼šé€‚é…å™¨å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæŽ¥å£ï¼Œä½œä¸ºä¸€ä¸ªè½¬æ¢å™¨ï¼Œå¯¹Adapteeå’ŒTargetè¿›è¡Œé€‚é…ï¼Œé€‚é…å™¨ç±»æ˜¯é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒï¼Œåœ¨å¯¹è±¡é€‚é…å™¨ä¸­ï¼Œå®ƒé€šè¿‡ç»§æ‰¿Targetå¹¶å…³è”ä¸€ä¸ªAdapteeå¯¹è±¡ä½¿äºŒè€…äº§ç”Ÿè”ç³»ã€‚ ä¸‰ç§è§’è‰²ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š å‡è®¾å½“å‰ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ˜¯ Target æŽ¥å£ï¼Œä½† Target æŽ¥å£æ²¡æœ‰ä¸€ä¸ªå®žä¾‹ç¬¦åˆéœ€æ±‚ï¼Œè€Œ Adaptee å®žä¾‹ç¬¦åˆéœ€æ±‚ï¼›ä½†æ˜¯å®¢æˆ·ç«¯æ— æ³•ç›´æŽ¥ä½¿ç”¨ Adapteeï¼ˆæŽ¥å£ä¸å…¼å®¹ï¼‰ï¼›å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€‚é…å™¨ï¼ˆAdapterï¼‰æ¥è¿›è¡Œä¸­è½¬ï¼Œè®© Adaptee èƒ½è½¬åŒ–ä¸º Target æŽ¥å£å½¢å¼ï¼› æ¨¡å¼è§£æž ç±»é€‚é…å™¨ åŽŸç† é€šè¿‡ç»§æ‰¿æ¥å®žçŽ°é€‚é…å™¨åŠŸèƒ½ã€‚ å…·ä½“åšæ³• è®© Adapter å®žçŽ° Target æŽ¥å£ï¼Œå¹¶ä¸”ç»§æ‰¿ Adapteeï¼Œè¿™æ · Adapter å°±å…·å¤‡ Target å’Œ Adaptee çš„ç‰¹æ€§ï¼Œå°±å¯ä»¥å°†ä¸¤è€…è¿›è¡Œè½¬åŒ–ï¼› UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºTargetæŽ¥å£ 123456789101112package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: ç›®æ ‡ç±» */public interface Target &#123; /** * è¿™æ˜¯æºç±»Adapteeeæ²¡æœ‰çš„æ–¹æ³• */ public void request();&#125; åˆ›å»ºæºç±»ï¼ˆAdapteeï¼‰ 1234567891011121314package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: æºç±» */public class Adaptee &#123; /** * éœ€è¦é€‚é…çš„æŽ¥å£ */ public void specificRequest() &#123; System.out.println("éœ€è¦é€‚é…çš„æŽ¥å£..."); &#125;&#125; åˆ›å»ºé€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ 123456789101112131415161718package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: é€‚é…å™¨Adapterç»§æ‰¿è‡ªAdapteeï¼ŒåŒæ—¶åˆå®žçŽ°äº†ç›®æ ‡(Target)æŽ¥å£ã€‚ */public class Adapter extends Adaptee implements Target &#123; /** * ç›®æ ‡æŽ¥å£è¦æ±‚è°ƒç”¨request()è¿™ä¸ªæ–¹æ³•åï¼Œä½†æºç±»Adapteeæ²¡æœ‰æ–¹æ³•request()ï¼Œ * å› æ­¤é€‚é…å™¨è¡¥å……ä¸Šè¿™ä¸ªæ–¹æ³•åã€‚ * ä½†å®žé™…ä¸Šrequest()åªæ˜¯è°ƒç”¨æºç±»Adapteeçš„specificRequest()æ–¹æ³•çš„å†…å®¹ï¼Œ * æ‰€ä»¥é€‚é…å™¨åªæ˜¯å°†specificRequest()æ–¹æ³•ä½œäº†ä¸€å±‚å°è£…ï¼Œå°è£…æˆTargetå¯ä»¥è°ƒç”¨çš„request()è€Œå·²ã€‚ */ @Override public void request() &#123; this.specificRequest(); &#125;&#125; å®šä¹‰å…·ä½“ä½¿ç”¨ç›®æ ‡ç±» 123456789101112package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±»é€‚é…å™¨ */public class TestClassAdapter &#123; public static void main(String[] args) &#123; Target mAdapter = new Adapter(); mAdapter.request(); &#125;&#125; å¯¹è±¡é€‚é…å™¨ åŽŸç† é€šè¿‡ç»„åˆæ¥å®žçŽ°é€‚é…å™¨åŠŸèƒ½ã€‚ å…·ä½“åšæ³• è®© Adapter å®žçŽ° Target æŽ¥å£ï¼Œç„¶åŽå†…éƒ¨æŒæœ‰ Adaptee å®žä¾‹ï¼Œç„¶åŽå† Target æŽ¥å£è§„å®šçš„æ–¹æ³•å†…è½¬æ¢ Adaptee ã€‚ UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºTargetæŽ¥å£ 123456789101112package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: ç›®æ ‡ç±» */public interface Target &#123; /** * è¿™æ˜¯æºç±»Adapteeeæ²¡æœ‰çš„æ–¹æ³• */ void request();&#125; åˆ›å»ºæºç±»ï¼ˆAdapteeï¼‰ 1234567891011121314package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: æºç±» */public class Adaptee &#123; /** * éœ€è¦é€‚é…çš„æŽ¥å£ */ public void specificRequest() &#123; System.out.println("éœ€è¦é€‚é…çš„æŽ¥å£..."); &#125;&#125; åˆ›å»ºé€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: é€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ï¼ˆä¸é€‚ç”¨ç»§æ‰¿è€Œæ˜¯å§”æ´¾ï¼‰ */public class Adapter implements Target &#123; /** * ç›´æŽ¥å…³è”è¢«é€‚é…ç±» */ private Adaptee adaptee; /** * å¯ä»¥é€šè¿‡æž„é€ å‡½æ•°ä¼ å…¥å…·ä½“éœ€è¦é€‚é…çš„è¢«é€‚é…ç±»å¯¹è±¡ */ public Adapter(Adaptee adaptee) &#123; this.adaptee = adaptee; &#125; @Override public void request() &#123; //è¿™é‡Œä½¿ç”¨å§”æ‰˜çš„æ–¹å¼å®Œæˆé€‚é… this.adaptee.specificRequest(); &#125;&#125; å®šä¹‰å…·ä½“ä½¿ç”¨ç›®æ ‡ç±» 1234567891011121314package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: æµ‹è¯•å¯¹è±¡é€‚é… */public class TestObjectAdapter &#123; public static void main(String[] args) &#123; //éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªè¢«é€‚é…ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•° Target mAdapter = new Adapter(new Adaptee()); mAdapter.request(); &#125;&#125; ä¼˜ç¼ºç‚¹ é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»æ¥é‡ç”¨çŽ°æœ‰çš„é€‚é…è€…ç±»ï¼Œæ— é¡»ä¿®æ”¹åŽŸæœ‰ç»“æž„ã€‚ å¢žåŠ äº†ç±»çš„é€æ˜Žæ€§å’Œå¤ç”¨æ€§ï¼Œå°†å…·ä½“çš„ä¸šåŠ¡å®žçŽ°è¿‡ç¨‹å°è£…åœ¨é€‚é…è€…ç±»ä¸­ï¼Œå¯¹äºŽå®¢æˆ·ç«¯ç±»è€Œè¨€æ˜¯é€æ˜Žçš„ï¼Œè€Œä¸”æé«˜äº†é€‚é…è€…çš„å¤ç”¨æ€§ï¼ŒåŒä¸€ä¸ªé€‚é…è€…ç±»å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„ç³»ç»Ÿä¸­å¤ç”¨ã€‚ çµæ´»æ€§å’Œæ‰©å±•æ€§éƒ½éžå¸¸å¥½ï¼Œé€šè¿‡ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›´æ¢é€‚é…å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸ä¿®æ”¹åŽŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šå¢žåŠ æ–°çš„é€‚é…å™¨ç±»ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŽŸåˆ™â€ã€‚ ç¼ºç‚¹ è¿‡å¤šçš„ä½¿ç”¨é€‚é…å™¨ï¼Œä¼šè®©ç³»ç»Ÿéžå¸¸é›¶ä¹±ï¼Œä¸æ˜“æ•´ä½“è¿›è¡ŒæŠŠæ¡ã€‚ ç±»çš„é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ ç”±äºŽé€‚é…å™¨ç±»æ˜¯é€‚é…è€…ç±»çš„å­ç±»ï¼Œå› æ­¤å¯ä»¥åœ¨é€‚é…å™¨ç±»ä¸­ç½®æ¢ä¸€äº›é€‚é…è€…çš„æ–¹æ³•ï¼Œä½¿å¾—é€‚é…å™¨çš„çµæ´»æ€§æ›´å¼ºã€‚ ç¼ºç‚¹ å¯¹äºŽJavaç­‰ä¸æ”¯æŒå¤šé‡ç±»ç»§æ‰¿çš„è¯­è¨€ï¼Œä¸€æ¬¡æœ€å¤šåªèƒ½é€‚é…ä¸€ä¸ªé€‚é…è€…ç±»ï¼Œä¸èƒ½åŒæ—¶é€‚é…å¤šä¸ªé€‚é…è€…ï¼› é€‚é…è€…ç±»ä¸èƒ½ä¸ºæœ€ç»ˆç±»ï¼Œå¦‚åœ¨Javaä¸­ä¸èƒ½ä¸ºfinalç±»ï¼› åœ¨Javaç­‰è¯­è¨€ä¸­ï¼Œç±»é€‚é…å™¨æ¨¡å¼ä¸­çš„ç›®æ ‡æŠ½è±¡ç±»åªèƒ½ä¸ºæŽ¥å£ï¼Œä¸èƒ½ä¸ºç±»ï¼Œå…¶ä½¿ç”¨æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ ä¸€ä¸ªå¯¹è±¡é€‚é…å™¨å¯ä»¥æŠŠå¤šä¸ªä¸åŒçš„é€‚é…è€…é€‚é…åˆ°åŒä¸€ä¸ªç›®æ ‡ï¼› å¯ä»¥é€‚é…ä¸€ä¸ªé€‚é…è€…çš„å­ç±»ï¼Œç”±äºŽé€‚é…å™¨å’Œé€‚é…è€…ä¹‹é—´æ˜¯å…³è”å…³ç³»ï¼Œæ ¹æ®â€œé‡Œæ°ä»£æ¢åŽŸåˆ™â€ï¼Œé€‚é…è€…çš„å­ç±»ä¹Ÿå¯é€šè¿‡è¯¥é€‚é…å™¨è¿›è¡Œé€‚é…ã€‚ ç¼ºç‚¹ ä¸Žç±»é€‚é…å™¨æ¨¡å¼ç›¸æ¯”ï¼Œè¦åœ¨é€‚é…å™¨ä¸­ç½®æ¢é€‚é…è€…ç±»çš„æŸäº›æ–¹æ³•æ¯”è¾ƒéº»çƒ¦ã€‚å¦‚æžœä¸€å®šè¦ç½®æ¢æŽ‰é€‚é…è€…ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œå¯ä»¥å…ˆåšä¸€ä¸ªé€‚é…è€…ç±»çš„å­ç±»ï¼Œå°†é€‚é…è€…ç±»çš„æ–¹æ³•ç½®æ¢æŽ‰ï¼Œç„¶åŽå†æŠŠé€‚é…è€…ç±»çš„å­ç±»å½“åšçœŸæ­£çš„é€‚é…è€…è¿›è¡Œé€‚é…ï¼Œå®žçŽ°è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ã€‚ åº”ç”¨åœºæ™¯ é€‚é…å™¨çš„ä½¿ç”¨åœºæ™¯ ç³»ç»Ÿéœ€è¦å¤ç”¨çŽ°æœ‰ç±»ï¼Œè€Œè¯¥ç±»çš„æŽ¥å£ä¸ç¬¦åˆç³»ç»Ÿçš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŽŸæœ¬ç”±äºŽæŽ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ å¤šä¸ªç»„ä»¶åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æŽ¥å£ä¸ç»Ÿä¸€ä¸”å¯èƒ½ä¼šç»å¸¸åˆ‡æ¢æ—¶ï¼Œå¯ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥ä»¥ç»Ÿä¸€çš„æŽ¥å£ä½¿ç”¨å®ƒä»¬ ç±»å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ çµæ´»ä½¿ç”¨æ—¶ï¼šé€‰æ‹©å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ ç±»é€‚é…å™¨ä½¿ç”¨å¯¹è±¡ç»§æ‰¿çš„æ–¹å¼ï¼Œæ˜¯é™æ€çš„å®šä¹‰æ–¹å¼ï¼›è€Œå¯¹è±¡é€‚é…å™¨ä½¿ç”¨å¯¹è±¡ç»„åˆçš„æ–¹å¼ï¼Œæ˜¯åŠ¨æ€ç»„åˆçš„æ–¹å¼ã€‚ éœ€è¦åŒæ—¶é…æºç±»å’Œå…¶å­ç±»ï¼šé€‰æ‹©å¯¹è±¡çš„é€‚é…å™¨ å¯¹äºŽç±»é€‚é…å™¨ï¼Œç”±äºŽé€‚é…å™¨ç›´æŽ¥ç»§æ‰¿äº†Adapteeï¼Œä½¿å¾—é€‚é…å™¨ä¸èƒ½å’ŒAdapteeçš„å­ç±»ä¸€èµ·å·¥ä½œï¼Œå› ä¸ºç»§æ‰¿æ˜¯é™æ€çš„å…³ç³»ï¼Œå½“é€‚é…å™¨ç»§æ‰¿äº†AdapteeåŽï¼Œå°±ä¸å¯èƒ½å†åŽ»å¤„ç† Adapteeçš„å­ç±»äº†ï¼› å¯¹äºŽå¯¹è±¡é€‚é…å™¨ï¼Œä¸€ä¸ªé€‚é…å™¨å¯ä»¥æŠŠå¤šç§ä¸åŒçš„æºé€‚é…åˆ°åŒä¸€ä¸ªç›®æ ‡ã€‚æ¢è¨€ä¹‹ï¼ŒåŒä¸€ä¸ªé€‚é…å™¨å¯ä»¥æŠŠæºç±»å’Œå®ƒçš„å­ç±»éƒ½é€‚é…åˆ°ç›®æ ‡æŽ¥å£ã€‚å› ä¸ºå¯¹è±¡é€‚é…å™¨é‡‡ç”¨çš„æ˜¯å¯¹è±¡ç»„åˆçš„å…³ç³»ï¼Œåªè¦å¯¹è±¡ç±»åž‹æ­£ç¡®ï¼Œæ˜¯ä¸æ˜¯å­ç±»éƒ½æ— æ‰€è°“ã€‚ éœ€è¦é‡æ–°å®šä¹‰Adapteeçš„éƒ¨åˆ†è¡Œä¸ºï¼šé€‰æ‹©ç±»é€‚é…å™¨ å¯¹äºŽç±»é€‚é…å™¨ï¼Œé€‚é…å™¨å¯ä»¥é‡å®šä¹‰Adapteeçš„éƒ¨åˆ†è¡Œä¸ºï¼Œç›¸å½“äºŽå­ç±»è¦†ç›–çˆ¶ç±»çš„éƒ¨åˆ†å®žçŽ°æ–¹æ³•ã€‚ å¯¹äºŽå¯¹è±¡é€‚é…å™¨ï¼Œè¦é‡å®šä¹‰Adapteeçš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å®šä¹‰Adapteeçš„å­ç±»æ¥å®žçŽ°é‡å®šä¹‰ï¼Œç„¶åŽè®©é€‚é…å™¨ç»„åˆå­ç±»ã€‚è™½ç„¶é‡å®šä¹‰Adapteeçš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯æƒ³è¦å¢žåŠ ä¸€äº›æ–°çš„è¡Œä¸ºåˆ™æ–¹ä¾¿çš„å¾ˆï¼Œè€Œä¸”æ–°å¢žåŠ çš„è¡Œä¸ºå¯åŒæ—¶é€‚ç”¨äºŽæ‰€æœ‰çš„æºã€‚ ä»…ä»…å¸Œæœ›ä½¿ç”¨æ–¹ä¾¿æ—¶ï¼šé€‰æ‹©ç±»é€‚é…å™¨ å¯¹äºŽç±»é€‚é…å™¨ï¼Œä»…ä»…å¼•å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸éœ€è¦é¢å¤–çš„å¼•ç”¨æ¥é—´æŽ¥å¾—åˆ°Adapteeã€‚ å¯¹äºŽå¯¹è±¡é€‚é…å™¨ï¼Œéœ€è¦é¢å¤–çš„å¼•ç”¨æ¥é—´æŽ¥å¾—åˆ°Adapteeã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2Fposts%2Fea641220.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºŽä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚ ä¸»è¦ä½œç”¨(è§£å†³çš„é—®é¢˜) å°†ç®—æ³•çš„è´£ä»»å’Œæœ¬èº«è¿›è¡Œè§£è€¦ï¼Œä½¿å¾—ï¼š ç®—æ³•å¯ç‹¬ç«‹äºŽä½¿ç”¨å¤–éƒ¨è€Œå˜åŒ–ã€‚ å®¢æˆ·ç«¯æ–¹ä¾¿æ ¹æ®å¤–éƒ¨æ¡ä»¶é€‰æ‹©ä¸åŒç­–ç•¥æ¥è§£å†³ä¸åŒé—®é¢˜ã€‚ æ¨¡å¼åŽŸç† UMLç±»å›¾ æ¨¡å¼ä¼˜ç‚¹ 1ã€‚ ç­–ç•¥ç±»ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ ç”±äºŽç­–ç•¥ç±»éƒ½å®žçŽ°åŒä¸€ä¸ªæŽ¥å£ï¼Œæ‰€ä»¥ä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ æ˜“äºŽæ‰©å±• å¢žåŠ ä¸€ä¸ªæ–°çš„ç­–ç•¥åªéœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»å³å¯ï¼ŒåŸºæœ¬ä¸éœ€è¦æ”¹å˜åŽŸæœ‰çš„ä»£ç ï¼Œç¬¦åˆâ€œå¼€é—­åŽŸåˆ™â€œã€‚ é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼ˆif elseï¼‰ï¼Œå……åˆ†ä½“çŽ°é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚ æ¨¡å¼ç¼ºç‚¹ å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚ ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚ åº”ç”¨åœºæ™¯ å¦‚æžœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºŽå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚é‚£ä¹ˆè¿™äº›ç®—æ³•å¯ä»¥åŒ…è£…åˆ°ä¸€ä¸ªä¸ªçš„å…·ä½“ç®—æ³•ç±»é‡Œé¢ï¼Œè€Œè¿™äº›å…·ä½“ç®—æ³•ç±»éƒ½æ˜¯ä¸€ä¸ªæŠ½è±¡ç®—æ³•ç±»çš„å­ç±»ã€‚æ¢è¨€ä¹‹ï¼Œè¿™äº›å…·ä½“ç®—æ³•ç±»å‡æœ‰ç»Ÿä¸€çš„æŽ¥å£ï¼Œç”±äºŽå¤šæ€æ€§åŽŸåˆ™ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä½¿ç”¨ä»»ä½•ä¸€ä¸ªå…·ä½“ç®—æ³•ç±»ï¼Œå¹¶åªæŒæœ‰ä¸€ä¸ªæ•°æ®ç±»åž‹æ˜¯æŠ½è±¡ç®—æ³•ç±»çš„å¯¹è±¡ã€‚ ä¸€ä¸ªç³»ç»Ÿçš„ç®—æ³•ä½¿ç”¨çš„æ•°æ®ä¸å¯ä»¥è®©å®¢æˆ·ç«¯çŸ¥é“ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…è®©å®¢æˆ·ç«¯æ¶‰åŠåˆ°ä¸å¿…è¦æŽ¥è§¦åˆ°çš„å¤æ‚çš„å’Œåªä¸Žç®—æ³•æœ‰å…³çš„æ•°æ®ã€‚ å¦‚æžœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æžœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®žçŽ°ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼ŒæŠŠè¿™äº›è¡Œä¸ºè½¬ç§»åˆ°ç›¸åº”çš„å…·ä½“ç­–ç•¥ç±»é‡Œé¢ï¼Œå°±å¯ä»¥é¿å…ä½¿ç”¨éš¾ä»¥ç»´æŠ¤çš„å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼Œå¹¶ä½“çŽ°é¢å‘å¯¹è±¡è®¾è®¡çš„æ¦‚å¿µã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾æœ‰ä¸€å®¶ç™¾è´§å…¬å¸ï¼Œæœ€è¿‘åœ¨å®šå¹´åº¦çš„ä¿ƒé”€æ´»åŠ¨ å†²çªï¼šæ¯ä¸ªèŠ‚æ—¥ç”¨åŒä¸€ä¸ªä¿ƒé”€æ´»åŠ¨å¤ªæž¯ç‡¥ï¼Œæ²¡å¸å¼•åŠ› è§£å†³æ–¹æ¡ˆï¼šé’ˆå¯¹ä¸åŒèŠ‚ç›®ä½¿ç”¨ä¸åŒä¿ƒé”€æ´»åŠ¨è¿›è¡Œä¿ƒé”€ ä½¿ç”¨æ­¥éª¤ å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²ï¼ˆStrategyï¼‰ ç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæŽ¥å£ 123456789101112package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²ï¼šç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæŽ¥å£ */public abstract class Strategy &#123; /** * æ´»åŠ¨å±•ç¤º */ public abstract void show();&#125; å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼ˆConcrete Strategyï¼‰ æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼šæ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ */public class StrategyA extends Strategy &#123; @Override public void show() &#123; System.out.println("ä¸ºæ˜¥èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨A"); &#125;&#125; ä¸­ç§‹ä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼šä¸­ç§‹ä¿ƒé”€æ´»åŠ¨ */public class StrategyB extends Strategy &#123; @Override public void show() &#123; System.out.println("ä¸ºä¸­ç§‹èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨B"); &#125;&#125; åœ£è¯žä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰ç­–ç•¥è§’è‰²ï¼šåœ£è¯žä¿ƒé”€æ´»åŠ¨ */public class StrategyC extends Strategy &#123; @Override public void show() &#123; System.out.println("ä¸ºåœ£è¯žèŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨C"); &#125;&#125; å®šä¹‰çŽ¯å¢ƒè§’è‰²ï¼ˆContextï¼‰ ç”¨äºŽè¿žæŽ¥ä¸Šä¸‹æ–‡ï¼Œå³æŠŠä¿ƒé”€æ´»åŠ¨æŽ¨é”€ç»™å®¢æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜ 1234567891011121314151617181920212223242526272829303132333435363738package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰çŽ¯å¢ƒè§’è‰²ï¼šç”¨äºŽè¿žæŽ¥ä¸Šä¸‹æ–‡ï¼ŒæŠŠä¿ƒé”€æ´»åŠ¨æŽ¨é”€ç»™ç”¨æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜ */public class SalesMan &#123; //æŒæœ‰æŠ½è±¡ç­–ç•¥è§’è‰²çš„å¼•ç”¨ private Strategy strategy; /** * ç”Ÿæˆé”€å”®å‘˜å®žä¾‹æ—¶å‘Šè¯‰é”€å”®å‘˜ä»€ä¹ˆèŠ‚æ—¥ï¼ˆæž„é€ æ–¹æ³•ï¼‰ * ä½¿å¾—è®©é”€å”®å‘˜æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼ˆèŠ‚æ—¥ï¼‰é€‰æ‹©ä¿ƒé”€æ´»åŠ¨ï¼ˆè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„å·¥åŽ‚æ¨¡å¼ï¼‰ */ public SalesMan(String festival) &#123; switch (festival) &#123; //æ˜¥èŠ‚å°±ä½¿ç”¨æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ case "A": strategy = new StrategyA(); break; //ä¸­ç§‹èŠ‚å°±ä½¿ç”¨ä¸­ç§‹èŠ‚ä¿ƒé”€æ´»åŠ¨ case "B": strategy = new StrategyB(); break; //åœ£è¯žèŠ‚å°±ä½¿ç”¨åœ£è¯žèŠ‚ä¿ƒé”€æ´»åŠ¨ case "C": strategy = new StrategyC(); break; &#125; &#125; /** * å‘å®¢æˆ·å±•ç¤ºä¿ƒé”€æ´»åŠ¨ */ public void salesManShow() &#123; strategy.show(); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ è®©é”€å”®å‘˜è¿›è¡Œä¿ƒé”€æ´»åŠ¨çš„è½åœ° 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; SalesMan mSalesMan; //æ˜¥èŠ‚æ¥äº†ï¼Œä½¿ç”¨æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºŽæ˜¥èŠ‚ï¼š"); mSalesMan = new SalesMan("A"); mSalesMan.salesManShow(); //ä¸­ç§‹èŠ‚æ¥äº†ï¼Œä½¿ç”¨ä¸­ç§‹èŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºŽä¸­ç§‹èŠ‚ï¼š"); mSalesMan = new SalesMan("B"); mSalesMan.salesManShow(); //åœ£è¯žèŠ‚æ¥äº†ï¼Œä½¿ç”¨åœ£è¯žèŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºŽåœ£è¯žèŠ‚ï¼š"); mSalesMan = new SalesMan("C"); mSalesMan.salesManShow(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹é¢è¯•é¢˜æ€»ç»“]]></title>
    <url>%2Fposts%2Fe3e73bdc.html</url>
    <content type="text"><![CDATA[å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š å¤šçº¿ç¨‹æŠ€æœ¯ä½¿ç¨‹åºçš„å“åº”é€Ÿåº¦æ›´å¿«ã€‚ å½“å‰æ²¡æœ‰è¿›è¡Œå¤„ç†çš„ä»»åŠ¡å¯ä»¥å°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡ã€‚ å ç”¨å¤§é‡å¤„ç†æ—¶é—´çš„ä»»åŠ¡å¯ä»¥å®šæœŸå°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡ã€‚ å¯ä»¥éšæ—¶åœæ­¢ä»»åŠ¡ã€‚ å¯ä»¥åˆ†åˆ«è®¾ç½®å„ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ä»¥åŠä¼˜åŒ–æ€§èƒ½ã€‚ ç¼ºç‚¹ ç­‰å€™ä½¿ç”¨å…±äº«èµ„æºæ—¶é€ æˆç¨‹åºçš„è¿è¡Œé€Ÿåº¦å˜æ…¢ã€‚ å¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†è¦æ±‚é¢å¤–çš„cpuå¼€é”€ã€‚ å¯èƒ½å‡ºçŽ°çº¿ç¨‹æ­»é”æƒ…å†µã€‚å³è¾ƒé•¿æ—¶é—´çš„ç­‰å¾…æˆ–èµ„æºç«žäº‰ä»¥åŠæ­»é”ç­‰ç—‡çŠ¶ã€‚ åœ¨javaä¸­å®ˆæŠ¤çº¿ç¨‹å’Œæœ¬åœ°çº¿ç¨‹åŒºåˆ« javaä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç§ï¼šå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemonï¼‰å’Œç”¨æˆ·çº¿ç¨‹ï¼ˆUserï¼‰ã€‚ ä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ï¼Œé€šè¿‡æ–¹æ³•Thread.setDaemon(bool on)ï¼›trueåˆ™æŠŠè¯¥çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œåä¹‹åˆ™ä¸ºç”¨æˆ·çº¿ç¨‹ã€‚Thread.setDaemon()å¿…é¡»åœ¨Thread.start()ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ ä¸¤è€…çš„åŒºåˆ«ï¼š å”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ¤æ–­è™šæ‹Ÿæœº(JVM)ä½•æ—¶ç¦»å¼€ï¼ŒDaemonæ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ï¼Œå¦‚æžœå…¨éƒ¨çš„User Threadå·²ç»æ’¤ç¦»ï¼ŒDaemon æ²¡æœ‰å¯æœåŠ¡çš„çº¿ç¨‹ï¼ŒJVMæ’¤ç¦»ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå®ˆæŠ¤çº¿ç¨‹æ˜¯JVMè‡ªåŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼ˆä½†ä¸ä¸€å®šï¼‰ï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹ï¼›æ¯”å¦‚JVMçš„åžƒåœ¾å›žæ”¶çº¿ç¨‹æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æ‰€æœ‰çº¿ç¨‹å·²ç»æ’¤ç¦»ï¼Œä¸å†äº§ç”Ÿåžƒåœ¾ï¼Œå®ˆæŠ¤çº¿ç¨‹è‡ªç„¶å°±æ²¡äº‹å¯å¹²äº†ï¼Œå½“åžƒåœ¾å›žæ”¶çº¿ç¨‹æ˜¯Javaè™šæ‹Ÿæœºä¸Šä»…å‰©çš„çº¿ç¨‹æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šè‡ªåŠ¨ç¦»å¼€ã€‚ æ‰©å±•ï¼šThread Dumpæ‰“å°å‡ºæ¥çš„çº¿ç¨‹ä¿¡æ¯ï¼Œå«æœ‰daemonå­—æ ·çš„çº¿ç¨‹å³ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œå¯èƒ½ä¼šæœ‰ï¼šæœåŠ¡å®ˆæŠ¤è¿›ç¨‹ã€ç¼–è¯‘å®ˆæŠ¤è¿›ç¨‹ã€windowsä¸‹çš„ç›‘å¬Ctrl+breakçš„å®ˆæŠ¤è¿›ç¨‹ã€Finalizerå®ˆæŠ¤è¿›ç¨‹ã€å¼•ç”¨å¤„ç†å®ˆæŠ¤è¿›ç¨‹ã€GCå®ˆæŠ¤è¿›ç¨‹ã€‚ çº¿ç¨‹ä¸Žè¿›ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒã€‚ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ å¤šçº¿ç¨‹ä¼šå…±åŒä½¿ç”¨ä¸€ç»„è®¡ç®—æœºä¸Šçš„CPUï¼Œè€Œçº¿ç¨‹æ•°å¤§äºŽç»™ç¨‹åºåˆ†é…çš„CPUæ•°é‡æ—¶ï¼Œä¸ºäº†è®©å„ä¸ªçº¿ç¨‹éƒ½æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œå°±éœ€è¦è½®è½¬ä½¿ç”¨CPUã€‚ä¸åŒçš„çº¿ç¨‹åˆ‡æ¢ä½¿ç”¨CPUå‘ç”Ÿçš„åˆ‡æ¢æ•°æ®ç­‰å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ æ­»é”ä¸Žæ´»é”çš„åŒºåˆ«ï¼Œæ­»é”ä¸Žé¥¥é¥¿çš„åŒºåˆ« **æ­»é”ï¼š**æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„çŽ°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æŽ¨è¿›ä¸‹åŽ»ã€‚ äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šæ‰€è°“äº’æ–¥å°±æ˜¯è¿›ç¨‹åœ¨æŸä¸€æ—¶é—´å†…ç‹¬å èµ„æºã€‚ è¯·æ±‚ä¸Žä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡žæ—¶ï¼Œå¯¹å·²èŽ·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²èŽ·å¾—èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªçŽ¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æŽ¥çš„å¾ªçŽ¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ **æ´»é”ï¼š**ä»»åŠ¡æˆ–è€…æ‰§è¡Œè€…æ²¡æœ‰è¢«é˜»å¡žï¼Œç”±äºŽæŸäº›æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå¯¼è‡´ä¸€ç›´é‡å¤å°è¯•ï¼Œå¤±è´¥ï¼Œå°è¯•ï¼Œå¤±è´¥ã€‚ æ´»é”å’Œæ­»é”çš„åŒºåˆ«åœ¨äºŽï¼Œå¤„äºŽæ´»é”çš„å®žä½“æ˜¯åœ¨ä¸æ–­çš„æ”¹å˜çŠ¶æ€ï¼Œæ‰€è°“çš„â€œæ´»â€ï¼Œ è€Œå¤„äºŽæ­»é”çš„å®žä½“è¡¨çŽ°ä¸ºç­‰å¾…ï¼›æ´»é”æœ‰å¯èƒ½è‡ªè¡Œè§£å¼€ï¼Œæ­»é”åˆ™ä¸èƒ½ã€‚ **é¥¥é¥¿ï¼š**ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹å› ä¸ºç§ç§åŽŸå› æ— æ³•èŽ·å¾—æ‰€éœ€è¦çš„èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•æ‰§è¡Œçš„çŠ¶æ€ã€‚ Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŽŸå› ï¼š é«˜ä¼˜å…ˆçº§çº¿ç¨‹åžå™¬æ‰€æœ‰çš„ä½Žä¼˜å…ˆçº§çº¿ç¨‹çš„CPUæ—¶é—´ã€‚ çº¿ç¨‹è¢«æ°¸ä¹…å µå¡žåœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½åœ¨å®ƒä¹‹å‰æŒç»­åœ°å¯¹è¯¥åŒæ­¥å—è¿›è¡Œè®¿é—®ã€‚ çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæœ¬èº«ä¹Ÿå¤„äºŽæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡(æ¯”å¦‚è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„waitæ–¹æ³•)ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯è¢«æŒç»­åœ°èŽ·å¾—å”¤é†’ã€‚ start()æ–¹æ³•å’Œrun()æ–¹æ³•çš„åŒºåˆ« start()æ–¹æ³•ï¼š ç”¨startæ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®žçŽ°äº†å¤šçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•è€Œç›´æŽ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚ é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶æ­¤çº¿ç¨‹å¤„äºŽå°±ç»ªï¼ˆå¯è¿è¡Œï¼‰çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿è¡Œï¼Œä¸€æ—¦å¾—åˆ°CPUæ—¶é—´ç‰‡ï¼Œå°±å¼€å§‹æ‰§è¡Œrun()æ–¹æ³•ã€‚ run()æ–¹æ³•ï¼š run()æ–¹æ³•åªæ˜¯ç±»çš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²ï¼Œå¦‚æžœç›´æŽ¥è°ƒç”¨Runæ–¹æ³•ï¼Œç¨‹åºä¸­ä¾ç„¶åªæœ‰ä¸»çº¿ç¨‹è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶ç¨‹åºæ‰§è¡Œè·¯å¾„è¿˜æ˜¯åªæœ‰ä¸€æ¡ã€‚ æ€»ç»“ï¼š è°ƒç”¨startæ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹ã€‚ runæ–¹æ³•åªæ˜¯threadçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œè¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œæ‰§è¡Œã€‚ æŠŠéœ€è¦å¹¶è¡Œå¤„ç†çš„ä»£ç æ”¾åœ¨run()æ–¹æ³•ä¸­ï¼Œstart()æ–¹æ³•å¯åŠ¨çº¿ç¨‹å°†è‡ªåŠ¨è°ƒç”¨run()æ–¹æ³•ï¼Œè¿™æ˜¯ç”±jvmçš„å†…å­˜æœºåˆ¶è§„å®šçš„ã€‚ run()æ–¹æ³•å¿…é¡»æ˜¯publicè®¿é—®æƒé™ï¼Œè¿”å›žå€¼ç±»åž‹ä¸ºvoidã€‚ RunnableæŽ¥å£å’ŒCallableæŽ¥å£çš„ç›¸åŒç‚¹å’Œä¸åŒç‚¹ ç›¸åŒç‚¹ï¼š Callableå’ŒRunnableéƒ½æ˜¯æŽ¥å£ï¼› Callableå’ŒRunnableéƒ½ä¸€ç§‘åº”ç”¨äºŽExecutorsï¼› ä¸åŒç‚¹ï¼š Callableè¦å®žçŽ°call()æ–¹æ³•ï¼ŒRunnableè¦å®žçŽ°run()æ–¹æ³•ï¼› call()æ–¹æ³•å¯ä»¥æœ‰è¿”å›žå€¼ï¼Œrun()æ–¹æ³•ä¸èƒ½æœ‰è¿”å›žå€¼ï¼› call(0æ–¹æ³•å¯ä»¥æŠ›å‡ºChecked Exceptionï¼Œrun()æ–¹æ³•ä¸å¯ä»¥ï¼› RunnableæŽ¥å£åœ¨Jdk1.1ä¸­å°±æœ‰äº†ï¼ŒCallableåœ¨JDK1.5æ‰æœ‰ï¼› voliateå…³é”®å­—çš„ä½œç”¨ å¤šçº¿ç¨‹ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œä¿è¯äº†å…¶åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œå³æ¯æ¬¡è¯»å–åˆ°volatileå˜é‡ï¼Œä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®ã€‚ Javaä»£ç æ‰§è¡Œä¸­ï¼Œä¸ºäº†èŽ·å–æ›´å¥½çš„æ€§èƒ½JVMå¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æŽ’åºï¼Œå¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºçŽ°ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ä½¿ç”¨volatileåˆ™ä¼šå¯¹ç¦æ­¢è¯­ä¹‰é‡æŽ’åºï¼Œå½“ç„¶è¿™ä¹Ÿä¸€å®šç¨‹åº¦ä¸Šé™ä½Žäº†ä»£ç æ‰§è¡Œæ•ˆçŽ‡ã€‚ CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ« CountDownLatch CyclicBarrier å‡è®¡æ•°æ–¹å¼ åŠ è®¡æ•°æ–¹å¼ è®¡æ•°ä¸º0æ—¶å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ è®¡æ•°è¾¾åˆ°æŒ‡å®šå€¼æ—¶å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ è®¡æ•°ä¸º0æ— æ³•é‡ç½® è®¡æ•°è¾¾åˆ°æŒ‡å®šå€¼æ—¶ï¼Œè®¡æ•°ç½®ä¸º0é‡æ–°å¼€å§‹ è°ƒç”¨countDown()æ–¹æ³•è®¡æ•°å‡ä¸€ï¼Œè°ƒç”¨await()æ–¹æ³•åªè¿›è¡Œé˜»å¡žï¼Œå¯¹è®¡æ•°æ²¡æœ‰å½±å“ è°ƒç”¨await()æ–¹æ³•è®¡æ•°åŠ 1ï¼Œè‹¥åŠ 1åŽçš„å€¼ä¸ç­‰äºŽæž„é€ æ–¹æ³•çš„å€¼ï¼Œåˆ™çº¿ç¨‹é˜»å¡ž ä¸èƒ½é‡å¤åˆ©ç”¨ å¯é‡å¤ä½¿ç”¨ voliateå’Œsynchronizedå¯¹æ¯” volatileæœ¬è´¨æ˜¯åœ¨å‘Šè¯‰jvmå½“å‰å˜é‡åœ¨å¯„å­˜å™¨ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„,éœ€è¦ä»Žä¸»å­˜ä¸­è¯»å–,synchronizedåˆ™æ˜¯é”å®šå½“å‰å˜é‡,åªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡,å…¶ä»–çº¿ç¨‹è¢«é˜»å¡žä½ã€‚ volatileä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«,synchronizedåˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡,æ–¹æ³•ä»¥åŠç±»çº§åˆ«ã€‚ volatileä»…èƒ½å®žçŽ°å˜é‡çš„ä¿®æ”¹å¯è§æ€§,è€Œsynchronizedåˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŽŸå­æ€§ã€‚ volatileä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ž,è€Œsynchronizedå¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡žã€‚ æ€Žä¹ˆå”¤é†’ä¸€ä¸ªé˜»å¡žçš„çº¿ç¨‹ å¦‚æžœçº¿ç¨‹æ˜¯å› ä¸ºè°ƒç”¨äº†wait()ã€sleep()æˆ–è€…join()æ–¹æ³•è€Œå¯¼è‡´çš„é˜»å¡žï¼Œå¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡æŠ›å‡ºInterruptedExceptionæ¥å”¤é†’å®ƒï¼› å¦‚æžœçº¿ç¨‹é‡åˆ°äº†IOé˜»å¡žï¼Œæ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºIOæ˜¯æ“ä½œç³»ç»Ÿå®žçŽ°çš„ï¼ŒJavaä»£ç å¹¶æ²¡æœ‰åŠžæ³•ç›´æŽ¥æŽ¥è§¦åˆ°æ“ä½œç³»ç»Ÿã€‚ sleepæ–¹æ³•å’Œwaitæ–¹æ³•çš„ç›¸åŒç‚¹å’Œä¸åŒç‚¹ ç›¸åŒç‚¹ï¼š äºŒè€…éƒ½å¯ä»¥è®©çº¿ç¨‹å¤„äºŽé˜»å¡žï¼› ä¸åŒç‚¹ï¼š é¦–å…ˆsleepæ–¹æ³•æ˜¯Threadç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè€Œwaitæ–¹æ³•æ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ sleepæ–¹æ³•å¿…é¡»äººä¸ºåœ°ä¸ºå…¶æŒ‡å®šä¼‘çœ æ—¶é—´ã€‚waitæ–¹æ³•æ—¢å¯ä»¥æŒ‡å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ—¶é—´ã€‚ sleepæ–¹æ³•æ—¶é—´åˆ°äº†ï¼Œçº¿ç¨‹å¤„äºŽä¸´æ—¶é˜»å¡žçŠ¶æ€æˆ–è€…è¿è¡ŒçŠ¶æ€ã€‚waitæ–¹æ³•å¦‚æžœæ²¡æœ‰è¢«è®¾ç½®æ—¶é—´ï¼Œå°±å¿…é¡»è¦é€šè¿‡notifyæˆ–è€…notifyAllæ¥å”¤é†’ã€‚ sleepæ–¹æ³•ä¸ä¸€å®šéžè¦å®šä¹‰åœ¨åŒæ­¥ä¸­ã€‚waitæ–¹æ³•å¿…é¡»å®šä¹‰åœ¨åŒæ­¥ä¸­ã€‚ å½“äºŒè€…éƒ½å®šä¹‰åœ¨åŒæ­¥ä¸­æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œåˆ°sleepï¼Œä¸ä¼šé‡Šæ”¾é”ã€‚çº¿ç¨‹æ‰§è¡Œåˆ°waitï¼Œä¼šé‡Šæ”¾é”ã€‚ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡åž‹çš„ä½œç”¨ é€šè¿‡å¹³è¡¡ç”Ÿäº§è€…çš„ç”Ÿäº§èƒ½åŠ›å’Œæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›æ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆçŽ‡ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡åž‹æœ€é‡è¦çš„ä½œç”¨ã€‚ è§£è€¦ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡åž‹é™„å¸¦çš„ä½œç”¨ï¼Œè§£è€¦æ„å‘³ç€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è”ç³»å°‘ï¼Œè”ç³»è¶Šå°‘è¶Šå¯ä»¥ç‹¬è‡ªå‘å±•è€Œä¸éœ€è¦æ”¶åˆ°ç›¸äº’çš„åˆ¶çº¦ã€‚ Executor.submit()å’ŒExecutor.execute()çš„åŒºåˆ« å‰è€…è¿”å›žä¸€ä¸ª Futureå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºŽæ‰¾åˆ°å·¥ä½œçº¿ç¨‹çš„è¿è¡Œç»“æžœã€‚ åœ¨å¼‚å¸¸å¤„ç†ä¸Šä¹Ÿä¸ä¸€æ ·ï¼Œåœ¨ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¦‚æžœæ˜¯é€šè¿‡ execute()æäº¤çš„ï¼Œä¼šæŠ›å‡ºæ— éœ€æ•èŽ·çš„å¼‚å¸¸ï¼ˆå¦‚æžœä½ æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œä¼šæ‰“å°é”™è¯¯æ ˆé“System.errï¼‰ã€‚å¦‚æžœæ˜¯é€šè¿‡ submit()æäº¤çš„ï¼Œä»»ä½•å¼‚å¸¸ï¼Œæ— è®ºæ˜¯ä¸æ˜¯checked exceptionï¼Œéƒ½æ˜¯è¿”å›žçš„ä¸€éƒ¨åˆ†ï¼ŒFuture.getå°†æŠŠå¼‚å¸¸åŒ…åœ¨ ExecutionExeptionä¸­ï¼Œå‘ä¸Šå±‚æŠ›å‡ºã€‚ ThreadLocalçš„ä½œç”¨ ThreadLocalç”¨æ¥è§£å†³å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘é—®é¢˜ã€‚ ThreadLocalå¹¶ä¸æ˜¯ä¸€ä¸ªThread,è€Œæ˜¯Threadçš„å±€éƒ¨å˜é‡,å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶,ThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬,æ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬,è€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ ä»Žçº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œç›®æ ‡å˜é‡å°±è±¡æ˜¯çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯ç±»åä¸­â€œLocalâ€æ‰€è¦è¡¨è¾¾çš„æ„æ€ã€‚ çº¿ç¨‹å±€éƒ¨å˜é‡å¹¶ä¸æ˜¯Javaçš„æ–°å‘æ˜Ž,Javaæ²¡æœ‰æä¾›åœ¨è¯­è¨€çº§æ”¯æŒ(è¯­æ³•ä¸Š),è€Œæ˜¯å˜ç›¸åœ°é€šè¿‡ThreadLocalçš„ç±»æä¾›æ”¯æŒã€‚ waitæ–¹æ³•å’Œnotify/notifyAllæ–¹æ³•åœ¨æ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨æ—¶çš„åŒºåˆ« wait()æ–¹æ³•ç«‹å³é‡Šæ”¾å¯¹è±¡ç›‘è§†å™¨ï¼› notify()/notifyAll()æ–¹æ³•åˆ™ä¼šç­‰å¾…çº¿ç¨‹å‰©ä½™ä»£ç æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨ã€‚ Lockå’Œsynchronizedå¯¹æ¯” Lockæ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œè€Œsynchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œsynchronizedæ˜¯å†…ç½®çš„è¯­è¨€å®žçŽ°ï¼› synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”çŽ°è±¡å‘ç”Ÿï¼›è€ŒLockåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æžœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡unLock()åŽ»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”çŽ°è±¡ï¼Œå› æ­¤ä½¿ç”¨Lockæ—¶éœ€è¦åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼› Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹åŽ»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼› é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸèŽ·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠžåˆ°ã€‚ Lockå¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆçŽ‡ã€‚ åœ¨JDK1.5ä¸­ï¼Œsynchronizedæ˜¯æ€§èƒ½ä½Žæ•ˆçš„ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œï¼Œå®ƒå¯¹æ€§èƒ½æœ€å¤§çš„å½±å“æ˜¯é˜»å¡žå¼çš„å®žçŽ°ï¼ŒæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼Œè¿™äº›æ“ä½œç»™ç³»ç»Ÿçš„å¹¶å‘æ€§å¸¦æ¥äº†å¾ˆå¤§çš„åŽ‹åŠ›ã€‚ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨Javaæä¾›çš„Lockå¯¹è±¡ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚ ä½†æ˜¯ï¼ŒJDK1.6ï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¹synchronizeåŠ å…¥äº†å¾ˆå¤šä¼˜åŒ–æŽªæ–½ï¼Œæœ‰è‡ªé€‚åº”è‡ªæ—‹ï¼Œé”æ¶ˆé™¤ï¼Œé”ç²—åŒ–ï¼Œè½»é‡çº§é”ï¼Œåå‘é”ç­‰ç­‰ã€‚å¯¼è‡´åœ¨JDK1.6ä¸Šsynchronizeçš„æ€§èƒ½å¹¶ä¸æ¯”Lockå·®ã€‚å› æ­¤ã€‚æå€¡ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨synchronizedæ¥è¿›è¡ŒåŒæ­¥ã€‚ ReadWriteLockæ˜¯ä»€ä¹ˆ ReadWriteLockæ˜¯ä¸€ä¸ªè¯»å†™é”æŽ¥å£ï¼ŒReentrantReadWriteLockæ˜¯ReadWriteLockæŽ¥å£çš„ä¸€ä¸ªå…·ä½“å®žçŽ°ï¼Œå®žçŽ°äº†è¯»å†™çš„åˆ†ç¦»ï¼Œè¯»é”æ˜¯å…±äº«çš„ï¼Œå†™é”æ˜¯ç‹¬å çš„ï¼Œè¯»å’Œè¯»ä¹‹é—´ä¸ä¼šäº’æ–¥ï¼Œè¯»å’Œå†™ã€å†™å’Œè¯»ã€å†™å’Œå†™ä¹‹é—´æ‰ä¼šäº’æ–¥ï¼Œæå‡äº†è¯»å†™çš„æ€§èƒ½ã€‚ FutureTaskæ˜¯ä»€ä¹ˆ FutureTaskè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡ã€‚FutureTaské‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªCallableçš„å…·ä½“å®žçŽ°ç±»ï¼Œå¯ä»¥å¯¹è¿™ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡çš„ç»“æžœè¿›è¡Œç­‰å¾…èŽ·å–ã€åˆ¤æ–­æ˜¯å¦å·²ç»å®Œæˆã€å–æ¶ˆä»»åŠ¡ç­‰æ“ä½œã€‚ç”±äºŽFutureTaskä¹Ÿæ˜¯RunnableæŽ¥å£çš„å®žçŽ°ç±»ï¼Œæ‰€ä»¥FutureTaskä¹Ÿå¯ä»¥æ”¾å…¥çº¿ç¨‹æ± ä¸­ã€‚ Javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦ç®—æ³• æŠ¢å å¼ã€‚ä¸€ä¸ªçº¿ç¨‹ç”¨å®ŒCPUä¹‹åŽï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹é¥¥é¥¿æƒ…å†µç­‰æ•°æ®ç®—å‡ºä¸€ä¸ªæ€»çš„ä¼˜å…ˆçº§å¹¶åˆ†é…ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ç»™æŸä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ ä¹è§‚é”å’Œæ‚²è§‚é” ä¹è§‚é”ï¼šå¯¹äºŽå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒä¹è§‚çŠ¶æ€ï¼Œä¹è§‚é”è®¤ä¸ºç«žäº‰ä¸æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤å®ƒä¸éœ€è¦æŒæœ‰é”ï¼Œå°†æ¯”è¾ƒ-è®¾ç½®è¿™ä¸¤ä¸ªåŠ¨ä½œä½œä¸ºä¸€ä¸ªåŽŸå­æ“ä½œå°è¯•åŽ»ä¿®æ”¹å†…å­˜ä¸­çš„å˜é‡ï¼Œå¦‚æžœå¤±è´¥åˆ™è¡¨ç¤ºå‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ç›¸åº”çš„é‡è¯•é€»è¾‘ã€‚ æ‚²è§‚é”ï¼šå¯¹äºŽå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒæ‚²è§‚çŠ¶æ€ï¼Œæ‚²è§‚é”è®¤ä¸ºç«žäº‰æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤æ¯æ¬¡å¯¹æŸèµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œéƒ½ä¼šæŒæœ‰ä¸€ä¸ªç‹¬å çš„é”ï¼Œå°±åƒsynchronizedï¼Œç›´æŽ¥å¯¹æ“ä½œèµ„æºä¸Šäº†é”ã€‚ ç¼–å†™ä¸€ä¸ªæ­»é”ç¨‹åº æ­»é”çŽ°è±¡æè¿°ï¼š çº¿ç¨‹Aå’Œçº¿ç¨‹Bç›¸äº’ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”å¯¼è‡´ç¨‹åºæ— é™æ­»å¾ªçŽ¯ä¸‹åŽ»ã€‚ æ­»é”çš„å®žçŽ°æ­¥éª¤ï¼š ä¸¤ä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«æŒæœ‰ä¸¤ä¸ªObjectå¯¹è±¡ï¼šlock1å’Œlock2ã€‚è¿™ä¸¤ä¸ªlockä½œä¸ºåŒæ­¥ä»£ç å—çš„é”ï¼› çº¿ç¨‹1çš„run()æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆèŽ·å–lock1çš„å¯¹è±¡é”ï¼ŒThread.sleep(xxx)ï¼Œæ—¶é—´ä¸éœ€è¦å¤ªå¤šï¼Œ100æ¯«ç§’å·®ä¸å¤šäº†ï¼Œç„¶åŽæŽ¥ç€èŽ·å–lock2çš„å¯¹è±¡é”ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹1å¯åŠ¨ä¸€ä¸‹å­å°±è¿žç»­èŽ·å¾—äº†lock1å’Œlock2ä¸¤ä¸ªå¯¹è±¡çš„å¯¹è±¡é”; çº¿ç¨‹2çš„run)(æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆèŽ·å–lock2çš„å¯¹è±¡é”ï¼ŒæŽ¥ç€èŽ·å–lock1çš„å¯¹è±¡é”ï¼Œå½“ç„¶è¿™æ—¶lock1çš„å¯¹è±¡é”å·²ç»è¢«çº¿ç¨‹1é”æŒæœ‰ï¼Œçº¿ç¨‹2è‚¯å®šæ˜¯è¦ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾lock1çš„å¯¹è±¡é”çš„ è¿™æ ·ï¼Œçº¿ç¨‹1â€³ç¡è§‰â€ç¡å®Œï¼Œçº¿ç¨‹2å·²ç»èŽ·å–äº†lock2çš„å¯¹è±¡é”äº†ï¼Œçº¿ç¨‹1æ­¤æ—¶å°è¯•èŽ·å–lock2çš„å¯¹è±¡é”ï¼Œä¾¿è¢«é˜»å¡žï¼Œæ­¤æ—¶ä¸€ä¸ªæ­»é”å°±å½¢æˆäº†ã€‚ ä»£ç å®žçŽ°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class DeadLock &#123; public void run() &#123; TestDeadLock tl = new TestDeadLock(); new Thread(tl, "çº¿ç¨‹A").start(); new Thread(tl, "çº¿ç¨‹B").start(); &#125; class TestDeadLock implements Runnable &#123; private Object objA = new Object(); private Object objB = new Object(); private boolean flag = true; @Override public void run() &#123; if (flag) &#123; flag = false; synchronized (objA) &#123; System.out.println(Thread.currentThread().getName() + "é”ä½èµ„æºAï¼Œç­‰å¾…èµ„æºB"); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (objB) &#123; System.out.println(Thread.currentThread().getName() + "èŽ·å¾—èµ„æºB"); &#125; &#125; &#125; else &#123; flag = true; synchronized (objB) &#123; System.out.println(Thread.currentThread().getName() + "é”ä½èµ„æºBï¼Œç­‰å¾…èµ„æºA"); try &#123; Thread.sleep(100); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (objA) &#123; System.out.println(Thread.currentThread().getName() + "èŽ·å¾—èµ„æºA"); &#125; &#125; &#125; &#125; &#125; public static void main(String[] args) &#123; new DeadLock().run(); &#125;&#125;è¾“å‡ºç»“æžœæ˜¯ï¼šçº¿ç¨‹Aé”ä½èµ„æºAï¼Œç­‰å¾…èµ„æºBçº¿ç¨‹Bé”ä½èµ„æºBï¼Œç­‰å¾…èµ„æºA Javaä¸­å¦‚ä½•é¿å…æ­»é” æ­»é”å‘ç”Ÿæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹è¯•å›¾èŽ·å–è¢«å¯¹æ–¹æŒæœ‰çš„èµ„æºã€‚ä½†æ˜¯è¦æƒ³å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š ç›¸äº’æŽ’æ–¥ â€”â€” è‡³å°‘ä¸€ä¸ªè¿›ç¨‹å¿…é¡»å¤„äºŽéžå…±äº«æ¨¡å¼ï¼› ä¿æŒå¹¶ç­‰å¾… â€”â€” å¿…é¡»æœ‰ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ä¸€ä¸ªèµ„æºå¹¶ç­‰å¾…å¦ä¸€ä¸ªèµ„æºï¼› æ²¡æœ‰æŠ¢å  â€”â€” èµ„æºä¸èƒ½è¢«æŠ¢å ï¼› å¾ªçŽ¯ç­‰å¾… â€”â€” å­˜åœ¨è¿›ç¨‹é›†åˆã€‚ é€šè¿‡ä¸­æ–­å¾ªçŽ¯ç­‰å¾…å¯ä»¥é¿å…æ­»é”ã€‚å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­æŒ‡å®šèŽ·å–å’Œé‡Šæ”¾é”çš„é¡ºåºæ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚ å¦‚æžœå¤šä¸ªé”é€šè¿‡ä¸€è‡´çš„é¡ºåºè¢«èŽ·å–å’Œé‡Šæ”¾ï¼Œä¸ä¼šæœ‰äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„æƒ…å†µã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨Executoræ¡†æž¶ æ¯æ¬¡æ‰§è¡Œä»»åŠ¡åˆ›å»ºçº¿ç¨‹ new Thread()æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶ã€è€—èµ„æºçš„ã€‚ è°ƒç”¨ new Thread()åˆ›å»ºçš„çº¿ç¨‹ç¼ºä¹ç®¡ç†ï¼Œè¢«ç§°ä¸ºé‡Žçº¿ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºï¼Œçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’ç«žäº‰ä¼šå¯¼è‡´è¿‡å¤šå ç”¨ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªï¼Œè¿˜æœ‰çº¿ç¨‹ä¹‹é—´çš„é¢‘ç¹äº¤æ›¿ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚ ç›´æŽ¥ä½¿ç”¨new Thread() å¯åŠ¨çš„çº¿ç¨‹ä¸åˆ©äºŽæ‰©å±•ï¼Œæ¯”å¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å®šæ—¶å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ç­‰éƒ½ä¸ä¾¿å®žçŽ°ã€‚ èƒ½å¤ç”¨å·²å­˜åœ¨å¹¶ç©ºé—²çš„çº¿ç¨‹ä»Žè€Œå‡å°‘çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºä»Žè€Œå‡å°‘äº†æ¶ˆäº¡çº¿ç¨‹çš„å¼€é”€ã€‚ å¯æœ‰æ•ˆæŽ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºä½¿ç”¨çŽ‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«žäº‰ã€‚ æ¡†æž¶ä¸­å·²ç»æœ‰å®šæ—¶ã€å®šæœŸã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æŽ§åˆ¶ç­‰åŠŸèƒ½ã€‚ åœ¨Java Concurrency APIä¸­æœ‰å“ªäº›åŽŸå­ç±» åŽŸå­ç±»ï¼šAtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReference åŽŸå­æ•°ç»„ï¼šAtomicIntegerArray,AtomicLongArrayï¼ŒAtomicReferenceArray åŽŸå­å±žæ€§æ›´æ–°å™¨ï¼šAtomicLongFieldUpdater,AtomicIntegerFieldUpdaterï¼ŒAtomicReferenceFieldUpdater è§£å†³ABAé—®é¢˜çš„åŽŸå­ç±»ï¼šAtomicMarkableReference(é€šè¿‡å¼•å…¥ä¸€ä¸ªbooleanæ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰,AtomicStampedReferenceï¼ˆé€šè¿‡å¼•å…¥ä¸€ä¸ªintæ¥ç´¯åŠ æ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰ Java Concurrency APIä¸­çš„LockæŽ¥å£(Lock interface)æ˜¯ä»€ä¹ˆï¼Ÿå¯¹æ¯”åŒæ­¥å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ LockæŽ¥å£æ¯”åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—æä¾›äº†æ›´å…·æ‰©å±•æ€§çš„é”æ“ä½œã€‚ä»–ä»¬å…è®¸æ›´çµæ´»çš„ç»“æž„ï¼Œå¯ä»¥å…·æœ‰å®Œå…¨ä¸åŒçš„æ€§è´¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³ç±»çš„æ¡ä»¶å¯¹è±¡ã€‚ å®ƒçš„ä¼˜åŠ¿æœ‰ï¼š å¯ä»¥ä½¿é”æ›´å…¬å¹³ å¯ä»¥ä½¿çº¿ç¨‹åœ¨ç­‰å¾…é”çš„æ—¶å€™å“åº”ä¸­æ–­ å¯ä»¥è®©çº¿ç¨‹å°è¯•èŽ·å–é”ï¼Œå¹¶åœ¨æ— æ³•èŽ·å–é”çš„æ—¶å€™ç«‹å³è¿”å›žæˆ–è€…ç­‰å¾…ä¸€æ®µæ—¶é—´ å¯ä»¥åœ¨ä¸åŒçš„èŒƒå›´ï¼Œä»¥ä¸åŒçš„é¡ºåºèŽ·å–å’Œé‡Šæ”¾é” æ•´ä½“ä¸Šæ¥è¯´Lockæ˜¯synchronizedçš„æ‰©å±•ç‰ˆï¼ŒLockæä¾›äº†æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„(tryLockæ–¹æ³•)ã€å®šæ—¶çš„(tryLockå¸¦å‚æ–¹æ³•)ã€å¯ä¸­æ–­çš„(lockInterruptibly)ã€å¯å¤šæ¡ä»¶é˜Ÿåˆ—çš„(newConditionæ–¹æ³•)é”æ“ä½œã€‚å¦å¤–Lockçš„å®žçŽ°ç±»åŸºæœ¬éƒ½æ”¯æŒéžå…¬å¹³é”(é»˜è®¤)å’Œå…¬å¹³é”ï¼Œsynchronizedåªæ”¯æŒéžå…¬å¹³é”ï¼Œå½“ç„¶ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéžå…¬å¹³é”æ˜¯é«˜æ•ˆçš„é€‰æ‹©ã€‚ ä»€ä¹ˆæ˜¯é˜»å¡žé˜Ÿåˆ—ï¼Ÿé˜»å¡žé˜Ÿåˆ—çš„å®žçŽ°åŽŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡žé˜Ÿåˆ—æ¥å®žçŽ°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡åž‹ï¼Ÿ é˜»å¡žé˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚ è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼ŒèŽ·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéžç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ é˜»å¡žé˜Ÿåˆ—å¸¸ç”¨äºŽç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»Žé˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡žé˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»Žå®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚ JDK7æä¾›äº†7ä¸ªé˜»å¡žé˜Ÿåˆ—ã€‚åˆ†åˆ«æ˜¯ï¼š ArrayBlockingQueue ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æž„ç»„æˆçš„æœ‰ç•Œé˜»å¡žé˜Ÿåˆ—ã€‚ LinkedBlockingQueue ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æž„ç»„æˆçš„æœ‰ç•Œé˜»å¡žé˜Ÿåˆ—ã€‚ PriorityBlockingQueue ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æŽ’åºçš„æ— ç•Œé˜»å¡žé˜Ÿåˆ—ã€‚ DelayQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®žçŽ°çš„æ— ç•Œé˜»å¡žé˜Ÿåˆ—ã€‚ SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡žé˜Ÿåˆ—ã€‚ LinkedTransferQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æž„ç»„æˆçš„æ— ç•Œé˜»å¡žé˜Ÿåˆ—ã€‚ LinkedBlockingDequeï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æž„ç»„æˆçš„åŒå‘é˜»å¡žé˜Ÿåˆ—ã€‚ Java 5ä¹‹å‰å®žçŽ°åŒæ­¥å­˜å–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ™®é€šçš„ä¸€ä¸ªé›†åˆï¼Œç„¶åŽåœ¨ä½¿ç”¨çº¿ç¨‹çš„åä½œå’Œçº¿ç¨‹åŒæ­¥å¯ä»¥å®žçŽ°ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸»è¦çš„æŠ€æœ¯å°±æ˜¯ç”¨å¥½ï¼Œwait ,notify,notifyAll,sychronizedè¿™äº›å…³é”®å­—ã€‚è€Œåœ¨java 5ä¹‹åŽï¼Œå¯ä»¥ä½¿ç”¨é˜»å¡žé˜Ÿåˆ—æ¥å®žçŽ°ï¼Œæ­¤æ–¹å¼å¤§å¤§ç®€å°‘äº†ä»£ç é‡ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼Œå®‰å…¨æ–¹é¢ä¹Ÿæœ‰ä¿éšœã€‚ BlockingQueueæŽ¥å£æ˜¯Queueçš„å­æŽ¥å£ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å¹¶ä¸æ˜¯ä½œä¸ºå®¹å™¨ï¼Œè€Œæ˜¯ä½œä¸ºçº¿ç¨‹åŒæ­¥çš„çš„å·¥å…·ï¼Œå› æ­¤ä»–å…·æœ‰ä¸€ä¸ªå¾ˆæ˜Žæ˜¾çš„ç‰¹æ€§ï¼Œå½“ç”Ÿäº§è€…çº¿ç¨‹è¯•å›¾å‘BlockingQueueæ”¾å…¥å…ƒç´ æ—¶ï¼Œå¦‚æžœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™çº¿ç¨‹è¢«é˜»å¡žï¼Œå½“æ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»Žä¸­å–å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æžœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡žï¼Œæ­£æ˜¯å› ä¸ºå®ƒæ‰€å…·æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨ç¨‹åºä¸­å¤šä¸ªçº¿ç¨‹äº¤æ›¿å‘BlockingQueueä¸­æ”¾å…¥å…ƒç´ ï¼Œå–å‡ºå…ƒç´ ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„æŽ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ é˜»å¡žé˜Ÿåˆ—ä½¿ç”¨æœ€ç»å…¸çš„åœºæ™¯å°±æ˜¯socketå®¢æˆ·ç«¯æ•°æ®çš„è¯»å–å’Œè§£æžï¼Œè¯»å–æ•°æ®çš„çº¿ç¨‹ä¸æ–­å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åŽè§£æžçº¿ç¨‹ä¸æ–­ä»Žé˜Ÿåˆ—å–æ•°æ®è§£æžã€‚ ä»€ä¹ˆå«çº¿ç¨‹å®‰å…¨ï¼Ÿservletæ˜¯çº¿ç¨‹å®‰å…¨å—? çº¿ç¨‹å®‰å…¨æ˜¯ç¼–ç¨‹ä¸­çš„æœ¯è¯­ï¼ŒæŒ‡æŸä¸ªå‡½æ•°ã€å‡½æ•°åº“åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸­è¢«è°ƒç”¨æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡ï¼Œä½¿ç¨‹åºåŠŸèƒ½æ­£ç¡®å®Œæˆã€‚ Servletä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œservletæ˜¯å•å®žä¾‹å¤šçº¿ç¨‹çš„ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸èƒ½ä¿è¯å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨æ€§çš„ã€‚ Struts2çš„actionæ˜¯å¤šå®žä¾‹å¤šçº¿ç¨‹çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªè¯·æ±‚è¿‡æ¥éƒ½ä¼šnewä¸€ä¸ªæ–°çš„actionåˆ†é…ç»™è¿™ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚å®ŒæˆåŽé”€æ¯ã€‚ SpringMVCçš„Controlleræ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸æ˜¯çš„ï¼Œå’ŒServletç±»ä¼¼çš„å¤„ç†æµç¨‹ Struts2å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›Servletå’ŒSpringMVCéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¯ä»¥æå‡ä¸ç”¨å¤„ç†å¤ªå¤šçš„gcï¼Œå¯ä»¥ä½¿ç”¨ThreadLocalæ¥å¤„ç†å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚ Javaä¸­interrupted å’Œ isInterruptedæ–¹æ³•çš„åŒºåˆ« interrupt interruptæ–¹æ³•ç”¨äºŽä¸­æ–­çº¿ç¨‹ã€‚è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹çš„çŠ¶æ€ä¸ºå°†è¢«ç½®ä¸ºâ€ä¸­æ–­â€çŠ¶æ€ã€‚ æ³¨æ„ï¼šçº¿ç¨‹ä¸­æ–­ä»…ä»…æ˜¯ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œä¸ä¼šåœæ­¢çº¿ç¨‹ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±åŽ»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€ä¸ºå¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­åŽä¼šæŠ›å‡ºinterruptedExceptionçš„æ–¹æ³•ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚ interrupted æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸”æ¸…é™¤åŽŸçŠ¶æ€ã€‚å¦‚æžœä¸€ä¸ªçº¿ç¨‹è¢«ä¸­æ–­äº†ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨interruptedåˆ™è¿”å›žtrueï¼Œç¬¬äºŒæ¬¡å’ŒåŽé¢çš„å°±è¿”å›žfalseäº†ã€‚ isInterrupted ä»…ä»…æ˜¯æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚]]></content>
      <categories>
        <category>é¢è¯•é¢˜</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2Fposts%2F4eed4967.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ï¼Œåˆå« å‘å¸ƒ-è®¢é˜…ï¼ˆPublish/Subscribeï¼‰æ¨¡å¼ã€æ¨¡åž‹-è§†å›¾ï¼ˆModel/Viewï¼‰æ¨¡å¼ã€æº-ç›‘å¬å™¨ï¼ˆSource/Listenerï¼‰æ¨¡å¼ æˆ– ä»Žå±žè€…ï¼ˆDependentsï¼‰æ¨¡å¼ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªä¸»é¢˜å¯¹è±¡å¯è¢«å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬ï¼Œä½¿å¾—æ¯å½“ä¸»é¢˜å¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºŽå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ æ ¸å¿ƒï¼šæ¾è€¦åˆè§‚å¯Ÿè€…ä¸Žè¢«è§‚å¯Ÿè€…ï¼Œä»¥ç±»ä¼¼äºŽæ¶ˆæ¯/å¹¿æ’­å‘é€çš„æœºåˆ¶è”åŠ¨ä¸¤è€…ï¼Œä½¿è¢«è§‚å¯Ÿè€…çš„å˜åŠ¨èƒ½é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„è§‚å¯Ÿè€…ä»¬ï¼Œä»Žè€Œåšå‡ºç›¸åº”çš„å“åº”ã€‚ ä¸»è¦ä½œç”¨ å½“ç³»ç»Ÿä¸€æ–¹è¡Œä¸ºä¾èµ–äºŽå¦ä¸€æ–¹è¡Œä¸ºçš„å˜åŠ¨æ—¶ï¼Œå¯ä½¿ç”¨ è§‚å¯Ÿè€…æ¨¡å¼ æ¾è€¦åˆè”åŠ¨åŒæ–¹ï¼Œä½¿å¾—ä¸€æ–¹çš„å˜åŠ¨å¯ä»¥é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å¦ä¸€æ–¹å¯¹è±¡ï¼Œä»Žè€Œè®©å¦ä¸€æ–¹å¯¹è±¡å¯¹æ­¤åšå‡ºå“åº”ã€‚ UMLç±»å›¾ è§’è‰² æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼šç›®æ ‡åˆç§°ä¸ºä¸»é¢˜ï¼ŒæŒ‡è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼ˆObservableï¼‰ã€‚åœ¨ç›®æ ‡ä¸­å®šä¹‰äº†ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆï¼Œä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯ä»¥æŽ¥å—ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…æ¥è§‚å¯Ÿï¼Œå®ƒæä¾›ä¸€ç³»åˆ—æ–¹æ³•æ¥å¢žåŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼ŒåŒæ—¶å®ƒå®šä¹‰äº†é€šçŸ¥æ–¹æ³•notify()ã€‚ç›®æ ‡ç±»å¯ä»¥æ˜¯æŽ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–å…·ä½“ç±»ã€‚ å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰ï¼šå…·ä½“è¢«è§‚å¯Ÿè€…ï¼Œæ˜¯ç›®æ ‡ç±»ï¼ˆæŠ½è±¡ä¸»é¢˜ï¼‰çš„å­ç±»ï¼Œé€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œå½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼›åŒæ—¶å®ƒè¿˜å®žçŽ°äº†åœ¨ç›®æ ‡ç±»ä¸­å®šä¹‰çš„æŠ½è±¡ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚æžœæœ‰çš„è¯ï¼‰ã€‚å¦‚æžœæ— é¡»æ‰©å±•ç›®æ ‡ç±»ï¼Œåˆ™å…·ä½“ç›®æ ‡ç±»å¯ä»¥çœç•¥ã€‚ æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼šè§‚å¯Ÿè€…å°†å¯¹è§‚å¯Ÿç›®æ ‡çš„æ”¹å˜åšå‡ºååº”ï¼Œè§‚å¯Ÿè€…ä¸€èˆ¬å®šä¹‰ä¸ºæŽ¥å£ï¼Œè¯¥æŽ¥å£å£°æ˜Žäº†æ›´æ–°æ•°æ®çš„æ–¹æ³•update()ï¼Œå› æ­¤åˆç§°ä¸ºæŠ½è±¡è§‚å¯Ÿè€…ã€‚ å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcrereObserverï¼‰ï¼šåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜å‚¨å…·ä½“è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼›å®ƒå®žçŽ°äº†åœ¨æŠ½è±¡è§‚å¯Ÿè€…Observerä¸­å®šä¹‰çš„update()æ–¹æ³•ã€‚é€šå¸¸åœ¨å®žçŽ°æ—¶ï¼Œå¯ä»¥è°ƒç”¨å…·ä½“ç›®æ ‡ç±»çš„attach()æ–¹æ³•å°†è‡ªå·±æ·»åŠ åˆ°ç›®æ ‡ç±»çš„é›†åˆä¸­æˆ–é€šè¿‡detach()æ–¹æ³•å°†è‡ªå·±ä»Žç›®æ ‡ç±»çš„é›†åˆä¸­åˆ é™¤ã€‚ æ¨¡å¼ä¼˜ç‚¹ è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æ¾è€¦åˆï¼ˆæŠ½è±¡è€¦åˆï¼‰çš„ï¼Œç¬¦åˆ ä¾èµ–å€’ç½®åŽŸåˆ™ï¼› åˆ†ç¦»äº†è¡¨ç¤ºå±‚ï¼ˆè§‚å¯Ÿè€…ï¼‰å’Œæ•°æ®é€»è¾‘å±‚ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ï¼Œå¹¶ä¸”å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ï¼Œä½¿å¾—æ•°æ®çš„å˜åŒ–å¯ä»¥å“åº”åˆ°å¤šä¸ªè¡¨ç¤ºå±‚ä¸Šï¼› æ”¯æŒå¹¿æ’­é€šä¿¡ï¼Œå®žçŽ°äº†ä¸€å¯¹å¤šçš„é€šè®¯æœºåˆ¶ï¼Œæ”¯æŒäº‹ä»¶æ³¨å†Œæœºåˆ¶ï¼Œæ”¯æŒå…´è¶£åˆ†å‘æœºåˆ¶ï¼Œå½“è¢«è§‚å¯Ÿè€…è§¦å‘äº‹ä»¶æ—¶ï¼Œåªæœ‰æ„Ÿå…´è¶£çš„è§‚å¯Ÿè€…å¯ä»¥æŽ¥æ”¶åˆ°é€šçŸ¥ï¼› è§‚å¯Ÿè€…æ¨¡å¼æ»¡è¶³ â€œå¼€é—­åŽŸåˆ™â€ çš„è¦æ±‚ï¼Œå¢žåŠ æ–°çš„å…·ä½“è§‚å¯Ÿè€…æ— é¡»ä¿®æ”¹åŽŸæœ‰ç³»ç»Ÿä»£ç ï¼Œåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸Žè§‚å¯Ÿç›®æ ‡ä¹‹é—´ä¸å­˜åœ¨å…³è”å…³ç³»çš„æƒ…å†µä¸‹ï¼Œå¢žåŠ æ–°çš„è§‚å¯Ÿç›®æ ‡ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ æ¨¡å¼ç¼ºç‚¹ å¦‚æžœä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šç›´æŽ¥å’Œé—´æŽ¥è§‚å¯Ÿè€…ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼› äº‹ä»¶é€šçŸ¥å‘ˆçº¿æ€§å…³ç³»ï¼Œå¦‚æžœå…¶ä¸­ä¸€ä¸ªè§‚å¯Ÿè€…å¤„ç†äº‹ä»¶å¡å£³ï¼Œä¼šå½±å“åŽç»­çš„è§‚å¯Ÿè€…æŽ¥æ”¶è¯¥äº‹ä»¶ï¼› å¦‚æžœè§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å­˜åœ¨å¾ªçŽ¯ä¾èµ–ï¼Œåˆ™å¯èƒ½é€ æˆä¸¤è€…ä¹‹é—´çš„å¾ªçŽ¯è°ƒç”¨ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼› è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€Žä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚ é€‚ç”¨åœºæ™¯ ä¸€ä¸ªæŠ½è±¡æ¨¡åž‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºŽå¦ä¸€ä¸ªæ–¹é¢ï¼Œå°†è¿™ä¸¤ä¸ªæ–¹é¢å°è£…åœ¨ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä½¿å®ƒä»¬å¯ä»¥å„è‡ªç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨ã€‚ ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜å°†å¯¼è‡´ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Œè€Œå¹¶ä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡å°†å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›å¯¹è±¡æ˜¯è°ã€‚ éœ€è¦åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Cå¯¹è±¡â€¦â€¦ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶ã€‚ å®žçŽ°ç±»ä¼¼å¹¿æ’­æœºåˆ¶çš„åŠŸèƒ½ï¼Œæ— éœ€çŸ¥é“å…·ä½“æ”¶å¬è€…ï¼Œåªéœ€åˆ†å‘å¹¿æ’­ï¼Œç³»ç»Ÿä¸­æ„Ÿå…´è¶£çš„å¯¹è±¡ä¼šè‡ªåŠ¨æŽ¥æ”¶è¯¥å¹¿æ’­ï¼› ä½¿ç”¨æ­¥éª¤ æŠ½è±¡è§‚å¯Ÿè€… 123456789101112package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: æŠ½è±¡è§‚å¯Ÿè€… */public interface IObserver&lt;E&gt; &#123; /** * æ›´æ–°æ•°æ® */ void update(E event);&#125; æŠ½è±¡ä¸»é¢˜è€… 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: æŠ½è±¡ä¸»é¢˜ */public interface ISubject&lt;E&gt; &#123; /** * æ³¨å†Œ * * @param observer * @return */ boolean attach(IObserver&lt;E&gt; observer); /** * å–æ¶ˆæ³¨å†Œ * * @param observer * @return */ boolean detach(IObserver&lt;E&gt; observer); /** * é€šçŸ¥ * * @param event */ void notify(E event);&#125; å…·ä½“è§‚å¯Ÿè€… 12345678910111213package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: å…·ä½“è§‚å¯Ÿè€… */public class ConcreteObserver&lt;E&gt; implements IObserver&lt;E&gt; &#123; @Override public void update(E event) &#123; System.out.println("receive eventï¼š" + event); &#125;&#125; å…·ä½“ä¸»é¢˜è€… 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.observer.demoOne;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: å…·ä½“ä¸»é¢˜è€… */public class ConcreteSubject&lt;E&gt; implements ISubject&lt;E&gt; &#123; /** * è§‚å¯Ÿè€…é›†åˆ */ private List&lt;IObserver&lt;E&gt;&gt; mObservers = new ArrayList&lt;&gt;(); @Override public boolean attach(IObserver&lt;E&gt; observer) &#123; return !this.mObservers.contains(observer) &amp;&amp; this.mObservers.add(observer); &#125; @Override public boolean detach(IObserver&lt;E&gt; observer) &#123; return this.mObservers.remove(observer); &#125; @Override public void notify(E event) &#123; for (IObserver&lt;E&gt; observer : this.mObservers) &#123; observer.update(event); &#125; &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; // è¢«è§‚å¯Ÿè€… ISubject&lt;String&gt; observable = new ConcreteSubject&lt;&gt;(); // è§‚å¯Ÿè€… IObserver&lt;String&gt; observer = new ConcreteObserver&lt;&gt;(); // æ³¨å†Œ observable.attach(observer); // é€šçŸ¥ observable.notify("hello"); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼]]></title>
    <url>%2Fposts%2Fe3d6aa41.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ ç»™ç›®æ ‡å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æŽ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ã€‚ ä¸»è¦ä½œç”¨ é€šè¿‡å¼•å…¥ä»£ç†å¯¹è±¡çš„æ–¹å¼æ¥é—´æŽ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚ è§£å†³çš„é—®é¢˜ é˜²æ­¢ç›´æŽ¥è®¿é—®ç›®æ ‡å¯¹è±¡ç»™ç³»ç»Ÿå¸¦æ¥çš„ä¸å¿…è¦å¤æ‚æ€§ã€‚ æ¨¡å¼åŽŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ æŠ½è±¡ä¸»é¢˜è§’è‰²ï¼ˆSubjectï¼‰ï¼šæŠ½è±¡ä¸»é¢˜ç±» çš„ä¸»è¦èŒè´£æ˜¯å£°æ˜Ž çœŸå®žä¸»é¢˜ ä¸Ž ä»£ç† çš„å…±åŒæŽ¥å£æ–¹æ³•ï¼Œè¯¥ç±»å¯ä»¥æ˜¯æŽ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼› çœŸå®žä¸»é¢˜è§’è‰²ï¼ˆRealSubjectï¼‰ï¼šè¯¥ç±»ä¹Ÿè¢«ç§°ä¸º è¢«å§”æ‰˜ç±» æˆ– è¢«ä»£ç†ç±»ï¼Œè¯¥ç±»å®šä¹‰äº†ä»£ç†æ‰€è¡¨ç¤ºçš„çœŸå®žå¯¹è±¡ï¼Œæ˜¯è´Ÿè´£æ‰§è¡Œç³»ç»ŸçœŸæ­£çš„é€»è¾‘ä¸šåŠ¡å¯¹è±¡ï¼› ä»£ç†ä¸»é¢˜è§’è‰²ï¼ˆProxyï¼‰ï¼šä¹Ÿè¢«ç§°ä¸º å§”æ‰˜ç±» æˆ– ä»£ç†ç±»ï¼Œå…¶å†…éƒ¨æŒæœ‰ RealSubject çš„å¼•ç”¨ï¼Œå› æ­¤å…·å¤‡å®Œå…¨çš„å¯¹ RealSubject çš„ä»£ç†æƒï¼› æ¨¡å¼ä¼˜ç‚¹ åè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œé™ä½Žäº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ ä»£ç†å¯¹è±¡ä½œä¸ºå®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ï¼Œèµ·åˆ°äº†ä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚ èŒè´£æ¸…æ™°ï¼šçœŸå®žä¸»é¢˜è§’è‰² åªè´Ÿè´£å®žçŽ°å®žé™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å…³å¿ƒå…¶ä»–éžæœ¬èŒè´£çš„äº‹åŠ¡ï¼Œé€šè¿‡åŽæœŸä»£ç†çš„è®¿é—®æŽ§åˆ¶ï¼Œå¯ä»¥æ‰©å±•æˆ–ç¼©å‡å®žé™…äº‹åŠ¡ï¼Œç¬¦åˆè®¾è®¡æ¨¡å¼ å•ä¸€èŒè´£åŽŸåˆ™ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼› é«˜æ‰©å±•æ€§ï¼šçœŸå®žä¸»é¢˜è§’è‰² è´Ÿè´£å®žé™…ä¸šåŠ¡é€»è¾‘ï¼Œå¯èƒ½ç»å¸¸æ€§å˜åŠ¨ï¼Œä½†æ˜¯ç”±äºŽå…¶ä¸Ž ä»£ç†ç±» éƒ½å®žçŽ°äº† æŠ½è±¡ä¸»é¢˜ï¼Œå› æ­¤ï¼ŒçœŸå®žä¸»é¢˜ çš„æ”¹å˜ä¸ä¼šå½±å“åˆ°ä»£ç†ç±»ï¼Œç¬¦åˆè®¾è®¡æ¨¡å¼ ä¾èµ–å€’ç½®åŽŸåˆ™ï¼Œé‡Œæ°æ›¿æ¢åŽŸåˆ™ å’Œ å¼€é—­åŽŸåˆ™ï¼› æ™ºèƒ½åŒ–ï¼šä¸»è¦æ˜¯åŸºäºŽåŠ¨æ€ä»£ç†çš„å®žçŽ°ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„ä»£ç†ç±»ï¼› æ¨¡å¼ç¼ºç‚¹ ç”±äºŽåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®žä¸»é¢˜ä¹‹é—´å¢žåŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ï¼› å®žçŽ°ä»£ç†æ¨¡å¼éœ€è¦é¢å¤–çš„å·¥ä½œï¼ˆæœ‰äº›ä»£ç†æ¨¡å¼çš„å®žçŽ°éžå¸¸å¤æ‚ï¼‰ï¼Œä»Žè€Œå¢žåŠ äº†ç³»ç»Ÿå®žçŽ°çš„å¤æ‚åº¦ã€‚ åº”ç”¨åœºæ™¯ å½“æ— æ³•æˆ–ä¸æƒ³ç›´æŽ¥å¼•ç”¨æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¹Ÿç»™ä»£ç†å¯¹è±¡æ¥é—´æŽ¥è®¿é—®ï¼› æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾å¸Œæœ›ä¹°ä¸€å°æœ€æ–°çš„é¡¶é…Macç”µè„‘ å†²çªï¼šå›½å†…è¿˜æ²¡ä¸Šï¼Œåªæœ‰ç¾Žå›½æ‰æœ‰ è§£å†³æ–¹æ¡ˆï¼šå¯»æ‰¾ä»£è´­è¿›è¡Œè´­ä¹° ç¤ºä¾‹æ­¥éª¤ é™æ€ä»£ç† åˆ›å»ºæŠ½è±¡å¯¹è±¡æŽ¥å£(Subject) å£°æ˜Žä½ ï¼ˆçœŸå®žå¯¹è±¡ï¼‰éœ€è¦è®©ä»£è´­ï¼ˆä»£ç†å¯¹è±¡ï¼‰å¸®å¿™åšçš„äº‹ï¼ˆä¹°Macï¼‰ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: æŠ½è±¡å¯¹è±¡æŽ¥å£ï¼Œå£°æ˜Žä½ ï¼ˆçœŸå®žå¯¹è±¡ï¼‰éœ€è¦è®©ä»£è´­ï¼ˆä»£ç†å¯¹è±¡ï¼‰å¸®å¿™åšçš„äº‹ï¼ˆä¹°Macï¼‰ */public interface Subject &#123; /** * ä¹°macæœ¬ */ public void buyMac();&#125; åˆ›å»ºçœŸå®žå¯¹è±¡ç±»ï¼ˆRealSubjectï¼‰ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: çœŸå®žå¯¹è±¡ç±» */public class RealSubject implements Subject &#123; @Override public void buyMac() &#123; System.out.println("ä¹°ä¸€å°macæœ¬..."); &#125;&#125; åˆ›å»ºä»£ç†å¯¹è±¡ç±»(Proxy) 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: åˆ›å»ºä»£ç†å¯¹è±¡ */public class ProxySubject implements Subject &#123; /** * å¼•ç”¨çœŸå®žå¯¹è±¡ç¤ºä¾‹ */ private RealSubject realSubject; public ProxySubject(RealSubject realSubject) &#123; this.realSubject = realSubject; &#125; @Override public void buyMac() &#123; //è°ƒç”¨çœŸå®žå¯¹è±¡çš„æ–¹æ³•ï¼Œè¿›è¡Œä»£ç†è´­ä¹° realSubject.buyMac(); //ä»£ç†å¯¹è±¡é¢å¤–çš„æ“ä½œ this.wrapMac(); &#125; public void wrapMac() &#123; System.out.println("ç”¨ç›’å­åŒ…è£…å¥½mac..."); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: é™æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ */public class StaticProxyClient &#123; public static void main(String[] args) &#123; Subject proxy = new StaticProxy(); proxy.buyMac(); &#125;&#125; ä¸Šé¢ä»£ç æç»˜çš„ä»£ç†æ¨¡å¼ï¼Œæ›´åŠ ç»†åˆ†çš„è¯ä¸€èˆ¬ç§°ä¸ºé™æ€ä»£ç†æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆç§°ä¸ºé™æ€ä»£ç†ï¼Ÿå› ä¸ºä»£ç†å¯¹è±¡éœ€è¦ä¸Žç›®æ ‡å¯¹è±¡å®žçŽ°ä¸€æ ·çš„æŽ¥å£ï¼ˆä¹Ÿå°±æ˜¯RealSubjectå’ŒProxSubjectå®žçŽ°buyMacæŽ¥å£ï¼‰ã€‚ å‡è®¾çŽ°åœ¨æœ‰è¿™ç§æƒ…å†µï¼Œä¸ºäº†ä¿å®ˆèµ·è§ä¸ä»…æ‰¾ä»£è´­ï¼Œè¿˜é€šè¿‡å…¶ä»–å¤šç§æ¸ é“è´­ä¹°ï¼Œè¿™ç§æƒ…å†µä¸‹å°±ä¼šæœ‰å¾ˆå¤šä»£ç†ç±»ï¼Œä»£ç†ç±»å¦‚æžœå¤ªå¤šä¼šå‡ºçŽ°ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿ ä¸€æ—¦æŽ¥å£å¢žåŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡ä¸Žä»£ç†å¯¹è±¡éƒ½è¦ç»´æŠ¤ï¼Œè¿™æ ·çš„è¯ä»£ç æ”¹èµ·æ¥å°±ç›¸å½“çƒ¦çå’Œå†—ä½™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£å†³æ–¹å¼ï¼Œè¿™ç§è§£å†³æ–¹å¼å¤§å®¶ä¸€èˆ¬ç§°ä¸ºåŠ¨æ€ä»£ç†ã€‚ åŠ¨æ€ä»£ç† åŠ¨æ€ä»£ç†çš„ç±» 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.proxy.demoOne;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;/** * @author: whb * @description: åŠ¨æ€ä»£ç† */public class DynamicProxy &#123; /** * ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ */ private Object object; public DynamicProxy(Object object) &#123; this.object = object; &#125; /** * ç»™ç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ */ public Object getProxyInstance() &#123; return Proxy.newProxyInstance(object.getClass().getClassLoader(), object.getClass().getInterfaces(), new InvocationHandler() &#123; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; System.out.println("------------å¼€å§‹åŠ¨æ€ä»£ç†-----------" + "\n"); //æ‰§è¡Œç›®æ ‡æ–¹æ³• Object returnValue = method.invoke(object, args); System.out.println("------------ç»“æŸåŠ¨æ€ä»£ç†-----------"); return returnValue; &#125; &#125;); &#125;&#125; åŠ¨æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: åŠ¨æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ */public class DynamicProxyClient &#123; public static void main(String[] args) &#123; //åŠ¨æ€ä»£ç†éœ€è¦ä¼ å…¥æŽ¥å£å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æŽ¥å£å­ç±» Subject subject = new ProxySubject(new RealSubject()); //å°†æŽ¥å£åº“å¯¹è±¡ä¼ è¿›ä»£ç†ç±»ï¼Œä½¿ç”¨ä»£ç†æ–¹æ³• Subject proxy = (Subject) new DynamicProxy(subject).getProxyInstance(); //æ‰§è¡Œæ–¹æ³•ã€ä»£ç†å¯¹è±¡ã€‘ proxy.buyMac(); &#125;&#125; è™½ç„¶ç›¸å¯¹äºŽé™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¤§å¤§å‡å°‘äº†æˆ‘ä»¬çš„å¼€å‘ä»»åŠ¡ï¼ŒåŒæ—¶å‡å°‘äº†å¯¹ä¸šåŠ¡æŽ¥å£çš„ä¾èµ–ï¼Œé™ä½Žäº†è€¦åˆåº¦ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹å°å°çš„é—æ†¾ä¹‹å¤„ï¼Œé‚£å°±æ˜¯å®ƒå§‹ç»ˆæ— æ³•æ‘†è„±ä»…æ”¯æŒinterfaceä»£ç†çš„æ¡Žæ¢ï¼Œå› ä¸ºå®ƒçš„è®¾è®¡æ³¨å®šäº†è¿™ä¸ªé—æ†¾ã€‚å›žæƒ³ä¸€ä¸‹é‚£äº›åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç»§æ‰¿å…³ç³»å›¾ï¼Œå®ƒä»¬å·²ç»æ³¨å®šæœ‰ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»å«Proxyã€‚Javaçš„ç»§æ‰¿æœºåˆ¶æ³¨å®šäº†è¿™äº›åŠ¨æ€ä»£ç†ç±»ä»¬æ— æ³•å®žçŽ°å¯¹classçš„åŠ¨æ€ä»£ç†ï¼ŒåŽŸå› æ˜¯å¤šç»§æ‰¿åœ¨Javaä¸­æœ¬è´¨ä¸Šå°±è¡Œä¸é€šã€‚ CGLIBåŠ¨æ€ä»£ç† JDKå®žçŽ°åŠ¨æ€ä»£ç†éœ€è¦å®žçŽ°ç±»é€šè¿‡æŽ¥å£å®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼Œå¯¹äºŽæ²¡æœ‰æŽ¥å£çš„ç±»ï¼Œå¦‚ä½•å®žçŽ°åŠ¨æ€ä»£ç†å‘¢ï¼Œè¿™å°±éœ€è¦CGLibäº†ã€‚CGLibé‡‡ç”¨äº†éžå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼Œå…¶åŽŸç†æ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ä½†å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹finalä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†ã€‚JDKåŠ¨æ€ä»£ç†ä¸ŽCGLibåŠ¨æ€ä»£ç†å‡æ˜¯å®žçŽ°Spring AOPçš„åŸºç¡€ã€‚ CGLIBä»£ç†ç±» 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.proxy.cglibProxy;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;import java.lang.reflect.Method;/** * @author: whb * @description: Cglibä»£ç†ç±» */public class CglibProxy implements MethodInterceptor &#123; private Object target; public Object getInstance(final Object target) &#123; this.target = target; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(this.target.getClass()); enhancer.setCallback(this); return enhancer.create(); &#125; @Override public Object intercept(Object object, Method method, Object[] args, MethodProxy methodProxy) throws Throwable &#123; System.out.println("----------å¼€å¯äº‹åŠ¡---------"); Object result = methodProxy.invokeSuper(object, args); System.out.println("-----------ç»“æŸäº‹åŠ¡---------"); return result; &#125;&#125; CGLIBä»£ç†æµ‹è¯•ç±» 123456789101112131415package main.java.com.study.designPatterns.proxy.cglibProxy;/** * @author: whb * @description: CglibåŠ¨æ€ä»£ç†æµ‹è¯• */public class TestCglibProxy &#123; public static void main(String[] args) &#123; UserDao userDao = new UserDaoImpl(); CglibProxy cglibProxy = new CglibProxy(); UserDaoImpl userDaoCglibProxy = (UserDaoImpl) cglibProxy.getInstance(userDao); userDaoCglibProxy.save(); &#125;&#125; CGLIBåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ¯”JDKåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯CGLIBåˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯”JDKå¤šå¾—å¤šã€‚æ‰€ä»¥å¯¹äºŽå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨CGLIBåˆé€‚ï¼Œåä¹‹ä½¿ç”¨JDKæ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ç”±äºŽCGLibç”±äºŽæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äºŽfinalä¿®é¥°çš„æ–¹æ³•æ— æ³•è¿›è¡Œä»£ç†ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java-HashMapã€ConcurrentHashMapè§£æž]]></title>
    <url>%2Fposts%2Fbf7c5065.html</url>
    <content type="text"><![CDATA[Hashè¡¨ Hashè¡¨ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯æ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æŽ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æž„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡æŠŠå…³é”®ç å€¼æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚å­˜æ”¾è®°å½•çš„æ•°ç»„å«åšå“ˆå¸Œè¡¨ã€‚ åœ¨HashMapä¸­ï¼Œå°±æ˜¯å°†æ‰€ç»™çš„â€œé”®â€é€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°â€œç´¢å¼•â€ï¼Œç„¶åŽæŠŠå†…å®¹å­˜åœ¨æ•°ç»„ä¸­ï¼Œè¿™æ ·å°±å½¢æˆäº†â€œé”®â€å’Œå†…å®¹çš„æ˜ å°„å…³ç³»ã€‚ åœ¨äº†è§£å“ˆå¸Œè¡¨ä¹‹å‰ï¼Œå…ˆå¤§æ¦‚äº†è§£ä¸‹å…¶ä»–æ•°æ®ç»“æž„åœ¨æ–°å¢žï¼ŒæŸ¥æ‰¾ç­‰åŸºç¡€æ“ä½œæ‰§è¡Œæ€§èƒ½ï¼š æ•°ç»„ï¼šé‡‡ç”¨ä¸€æ®µè¿žç»­çš„å­˜å‚¨å•å…ƒæ¥å­˜å‚¨æ•°æ®ã€‚å¯¹äºŽæŒ‡å®šä¸‹æ ‡çš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›é€šè¿‡ç»™å®šå€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œéœ€è¦éåŽ†æ•°ç»„ï¼Œé€ä¸€æ¯”å¯¹ç»™å®šå…³é”®å­—å’Œæ•°ç»„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå½“ç„¶ï¼Œå¯¹äºŽæœ‰åºæ•°ç»„ï¼Œåˆ™å¯é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ’å€¼æŸ¥æ‰¾ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾ç­‰æ–¹å¼ï¼Œå¯å°†æŸ¥æ‰¾å¤æ‚åº¦æé«˜ä¸ºO(logn)ï¼›å¯¹äºŽä¸€èˆ¬çš„æ’å…¥åˆ é™¤æ“ä½œï¼Œæ¶‰åŠåˆ°æ•°ç»„å…ƒç´ çš„ç§»åŠ¨ï¼Œå…¶å¹³å‡å¤æ‚åº¦ä¹Ÿä¸ºO(n)ã€‚å¯¹åº”åˆ°é›†åˆå®žçŽ°ï¼Œä»£è¡¨å°±æ˜¯ArrayListã€‚ çº¿æ€§é“¾è¡¨ï¼šå¯¹äºŽé“¾è¡¨çš„æ–°å¢žï¼Œåˆ é™¤ç­‰æ“ä½œï¼ˆåœ¨æ‰¾åˆ°æŒ‡å®šæ“ä½œä½ç½®åŽï¼‰ï¼Œä»…éœ€å¤„ç†ç»“ç‚¹é—´çš„å¼•ç”¨å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€ŒæŸ¥æ‰¾æ“ä½œéœ€è¦éåŽ†é“¾è¡¨é€ä¸€è¿›è¡Œæ¯”å¯¹ï¼Œå¤æ‚åº¦ä¸ºO(n)ã€‚å¯¹åº”çš„é›†åˆç±»æ˜¯LinkedListã€‚ äºŒå‰æ ‘ï¼šå¯¹ä¸€æ£µç›¸å¯¹å¹³è¡¡çš„æœ‰åºäºŒå‰æ ‘ï¼Œå¯¹å…¶è¿›è¡Œæ’å…¥ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ç­‰æ“ä½œï¼Œå¹³å‡å¤æ‚åº¦å‡ä¸ºO(logn)ã€‚å¯¹åº”çš„é›†åˆç±»æœ‰TreeSetå’ŒTreeMapã€‚ å“ˆå¸Œè¡¨ï¼šç›¸æ¯”ä¸Šè¿°å‡ ç§æ•°æ®ç»“æž„ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­è¿›è¡Œæ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾ç­‰æ“ä½œï¼Œæ€§èƒ½ååˆ†ä¹‹é«˜ï¼Œä¸è€ƒè™‘å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ï¼Œä»…éœ€ä¸€æ¬¡å®šä½å³å¯å®Œæˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚å¯¹åº”çš„é›†åˆç±»å°±æ˜¯HashMapã€‚ å“ˆå¸Œè¡¨çš„ä¸»å¹²æ˜¯æ•°ç»„ã€‚è¦æ–°å¢žæˆ–æŸ¥æ‰¾æŸä¸ªå…ƒç´ ï¼Œé€šè¿‡æŠŠå½“å‰å…ƒç´ çš„å…³é”®å­— é€šè¿‡æŸä¸ªå‡½æ•°æ˜ å°„åˆ°æ•°ç»„ä¸­çš„æŸä¸ªä½ç½®ï¼Œé€šè¿‡æ•°ç»„ä¸‹æ ‡ä¸€æ¬¡å®šä½å°±å¯å®Œæˆæ“ä½œã€‚å³ï¼š 1å­˜å‚¨ä½ç½® = f(å…³é”®å­—) å…¶ä¸­ï¼Œè¿™ä¸ªå‡½æ•°fä¸€èˆ¬ç§°ä¸ºå“ˆå¸Œå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è®¾è®¡å¥½åä¼šç›´æŽ¥å½±å“åˆ°å“ˆå¸Œè¡¨çš„ä¼˜åŠ£ã€‚è¿™ä¼šæ¶‰åŠåˆ°å“ˆå¸Œå†²çªã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¦åœ¨å“ˆå¸Œè¡¨ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼š æŸ¥æ‰¾æ“ä½œåŒç†ï¼Œå…ˆé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºå®žé™…å­˜å‚¨åœ°å€ï¼Œç„¶åŽä»Žæ•°ç»„ä¸­å¯¹åº”åœ°å€å–å‡ºå³å¯ã€‚ å½“æˆ‘ä»¬å¯¹æŸä¸ªå…ƒç´ è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªå­˜å‚¨åœ°å€ï¼Œç„¶åŽè¦è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œå‘çŽ°å·²ç»è¢«å…¶ä»–å…ƒç´ å ç”¨äº†ï¼Œå…¶å®žè¿™å°±æ˜¯æ‰€è°“çš„å“ˆå¸Œå†²çªï¼Œä¹Ÿå«å“ˆå¸Œç¢°æ’žã€‚å“ˆå¸Œå‡½æ•°çš„è®¾è®¡è‡³å…³é‡è¦ï¼Œå¥½çš„å“ˆå¸Œå‡½æ•°ä¼šå°½å¯èƒ½åœ°ä¿è¯è®¡ç®—ç®€å•å’Œæ•£åˆ—åœ°å€åˆ†å¸ƒå‡åŒ€ã€‚ä½†æ˜¯ï¼Œæ•°ç»„æ˜¯ä¸€å—è¿žç»­çš„å›ºå®šé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå†å¥½çš„å“ˆå¸Œå‡½æ•°ä¹Ÿä¸èƒ½ä¿è¯å¾—åˆ°çš„å­˜å‚¨åœ°å€ç»å¯¹ä¸å‘ç”Ÿå†²çªã€‚é‚£ä¹ˆå“ˆå¸Œå†²çªå¦‚ä½•è§£å†³å‘¢ï¼Ÿå“ˆå¸Œå†²çªçš„è§£å†³æ–¹æ¡ˆæœ‰å¤šç§:å¼€æ”¾å®šå€æ³•ï¼ˆå‘ç”Ÿå†²çªï¼Œç»§ç»­å¯»æ‰¾ä¸‹ä¸€å—æœªè¢«å ç”¨çš„å­˜å‚¨åœ°å€ï¼‰ã€å†æ•£åˆ—å‡½æ•°æ³•ã€é“¾åœ°å€æ³•ã€‚è€ŒHashMapå³æ˜¯é‡‡ç”¨äº†é“¾åœ°å€æ³•ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„+é“¾è¡¨çš„æ–¹å¼ã€‚ ç®€å•æ¥è¯´ï¼ŒHashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼Œå¦‚æžœå®šä½åˆ°çš„æ•°ç»„ä½ç½®ä¸å«é“¾è¡¨ï¼ˆå½“å‰entryçš„nextæŒ‡å‘nullï¼‰,é‚£ä¹ˆå¯¹äºŽæŸ¥æ‰¾ï¼Œæ·»åŠ ç­‰æ“ä½œå¾ˆå¿«ï¼Œä»…éœ€ä¸€æ¬¡å¯»å€å³å¯ï¼›å¦‚æžœå®šä½åˆ°çš„æ•°ç»„åŒ…å«é“¾è¡¨ï¼Œå¯¹äºŽæ·»åŠ æ“ä½œï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¾ç„¶ä¸ºO(1)ï¼Œå› ä¸ºæœ€æ–°çš„Entryä¼šæ’å…¥é“¾è¡¨å¤´éƒ¨ï¼Œæ€¥éœ€è¦ç®€å•æ”¹å˜å¼•ç”¨é“¾å³å¯ï¼Œè€Œå¯¹äºŽæŸ¥æ‰¾æ“ä½œæ¥è®²ï¼Œæ­¤æ—¶å°±éœ€è¦éåŽ†é“¾è¡¨ï¼Œç„¶åŽé€šè¿‡keyå¯¹è±¡çš„equalsæ–¹æ³•é€ä¸€æ¯”å¯¹æŸ¥æ‰¾ã€‚æ‰€ä»¥ï¼Œæ€§èƒ½è€ƒè™‘ï¼ŒHashMapä¸­çš„é“¾è¡¨å‡ºçŽ°è¶Šå°‘ï¼Œæ€§èƒ½æ‰ä¼šè¶Šå¥½ã€‚ HashMap-Jdk1.7 ç±»å®šä¹‰ 123public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable ç®€ä»‹ ç»§æ‰¿AbstractMapæŠ½è±¡ç±»ï¼› å®žçŽ°MapæŽ¥å£ï¼Œæ‹¥æœ‰ä¸€ç»„Mapé€šç”¨æ“ä½œï¼› å®žçŽ°CloneableæŽ¥å£ï¼Œå¯è¿›è¡Œæ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰ï¼› å®žçŽ°äº†SerializableæŽ¥å£ï¼Œå¯å®žçŽ°åºåˆ—åŒ–ï¼› å…è®¸é”®/å€¼ä¸ºç©ºå¯¹è±¡ï¼ˆnullï¼‰ï¼› éžçº¿ç¨‹å®‰å…¨ï¼Œå¯é€šè¿‡Collectionsç±»çš„é™æ€æ–¹æ³•synchronizedMapèŽ·å¾—çº¿ç¨‹å®‰å…¨çš„HashMapï¼› ä¸ä¿è¯æœ‰åºæ€§ï¼ˆå¦‚æ’å…¥é¡ºåºï¼‰ï¼Œä¹Ÿä¸ä¿è¯é¡ºåºä¸éšæ—¶é—´å˜åŒ–ï¼› æ•°æ®ç»“æž„ HashMap é‡‡ç”¨çš„æ•°æ®ç»“æž„ = æ•°ç»„ï¼ˆä¸»ï¼‰ + å•é“¾è¡¨ï¼ˆå‰¯ï¼‰ï¼Œè¯¥ç»“æž„åˆç§°æ‹‰é“¾æ³•ï¼Œå…·ä½“æè¿°å¦‚ä¸‹: å½“å®žä¾‹åŒ–ä¸€ä¸ªHashMapæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºCapacityçš„Entryæ•°ç»„ï¼Œè¿™ä¸ªé•¿åº¦è¢«ç§°ä¸ºå®¹é‡(Capacity)ï¼Œåœ¨è¿™ä¸ªæ•°ç»„ä¸­å¯ä»¥å­˜æ”¾å…ƒç´ çš„ä½ç½®ç§°ä¹‹ä¸ºâ€œæ¡¶â€(bucket)ï¼Œæ¯ä¸ªbucketéƒ½æœ‰è‡ªå·±çš„ç´¢å¼•ï¼Œç³»ç»Ÿå¯ä»¥æ ¹æ®ç´¢å¼•å¿«é€Ÿçš„æŸ¥æ‰¾bucketä¸­çš„å…ƒç´ ã€‚ æ¯ä¸ªbucketä¸­å­˜å‚¨ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸€ä¸ªEntryå¯¹è±¡ï¼Œä½†æ¯ä¸€ä¸ªEntryå¯¹è±¡å¯ä»¥å¸¦ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œç”¨äºŽæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªæ¡¶ä¸­ï¼Œå°±æœ‰å¯èƒ½ç”Ÿæˆä¸€ä¸ªEntryé“¾ã€‚ Entryæ˜¯HashMapçš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œæ¯ä¸€ä¸ªEntryåŒ…å«ä¸€ä¸ªkey-valueé”®å€¼å¯¹ã€‚ Entryæ˜¯HashMapä¸­çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * Entryç±»å®žçŽ°äº†Map.EntryæŽ¥å£ * å³ å®žçŽ°äº†getKey()ã€getValue()ã€equals(Object o)å’ŒhashCode()ç­‰æ–¹æ³•**/ static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final K key; // é”® V value; // å€¼ Entry&lt;K,V&gt; next; // æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªEntryå¯¹è±¡ï¼Œä»Žè€Œå½¢æˆè§£å†³hashå†²çªçš„å•é“¾è¡¨ int hash; // å¯¹keyçš„hashcodeå€¼è¿›è¡Œhashè¿ç®—åŽå¾—åˆ°çš„å€¼ï¼Œå­˜å‚¨åœ¨Entryï¼Œé¿å…é‡å¤è®¡ç®— /** * æž„é€ æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªEntry * å‚æ•°ï¼šå“ˆå¸Œå€¼hï¼Œé”®å€¼kï¼Œå€¼vã€ä¸‹ä¸€ä¸ªç»“ç‚¹n */ Entry(int h, K k, V v, Entry&lt;K,V&gt; n) &#123; value = v; next = n; key = k; hash = h; &#125; // è¿”å›ž ä¸Ž æ­¤é¡¹ å¯¹åº”çš„é”® public final K getKey() &#123; return key; &#125; // è¿”å›ž ä¸Ž æ­¤é¡¹ å¯¹åº”çš„å€¼ public final V getValue() &#123; return value; &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; /** * åˆ¤æ–­2ä¸ªEntryæ˜¯å¦ç›¸ç­‰ï¼Œå¿…é¡»keyå’Œvalueéƒ½ç›¸ç­‰ï¼Œæ‰è¿”å›žtrue */ public final boolean equals(Object o) &#123; if (!(o instanceof Map.Entry)) return false; Map.Entry e = (Map.Entry)o; Object k1 = getKey(); Object k2 = e.getKey(); if (k1 == k2 || (k1 != null &amp;&amp; k1.equals(k2))) &#123; Object v1 = getValue(); Object v2 = e.getValue(); if (v1 == v2 || (v1 != null &amp;&amp; v1.equals(v2))) return true; &#125; return false; &#125; /** * hashCodeï¼ˆï¼‰ */ public final int hashCode() &#123; return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue()); &#125; public final String toString() &#123; return getKey() + "=" + getValue(); &#125; /** * å½“å‘HashMapä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå³è°ƒç”¨put(k,v)æ—¶ï¼Œ * å¯¹å·²ç»åœ¨HashMapä¸­kä½ç½®è¿›è¡Œvçš„è¦†ç›–æ—¶ï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³• * æ­¤å¤„æ²¡åšä»»ä½•å¤„ç† */ void recordAccess(HashMap&lt;K,V&gt; m) &#123; &#125; /** * å½“ä»ŽHashMapä¸­åˆ é™¤äº†ä¸€ä¸ªEntryæ—¶ï¼Œä¼šè°ƒç”¨è¯¥å‡½æ•° * æ­¤å¤„æ²¡åšä»»ä½•å¤„ç† */ void recordRemoval(HashMap&lt;K,V&gt; m) &#123; &#125; &#125; æ‰€ä»¥ï¼ŒHashMapçš„æ•´ä½“ç»“æž„å¦‚ä¸‹ï¼š é‡è¦å±žæ€§ 12345678910111213141516171819202122232425262728293031323334353637// 1. å®¹é‡ï¼ˆcapacityï¼‰ï¼š HashMapä¸­æ•°ç»„çš„é•¿åº¦// a. å®¹é‡èŒƒå›´ï¼šå¿…é¡»æ˜¯2çš„å¹‚ &amp; &lt;æœ€å¤§å®¹é‡ï¼ˆ2çš„30æ¬¡æ–¹ï¼‰// b. åˆå§‹å®¹é‡ = å“ˆå¸Œè¡¨åˆ›å»ºæ—¶çš„å®¹é‡// é»˜è®¤å®¹é‡ = 16 = 1&lt;&lt;4 = 00001ä¸­çš„1å‘å·¦ç§»4ä½ = 10000 = åè¿›åˆ¶çš„2^4=16static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; //æœ€å¤§å®¹é‡ = 2çš„30æ¬¡æ–¹ï¼ˆè‹¥ä¼ å…¥çš„å®¹é‡è¿‡å¤§ï¼Œå°†è¢«æœ€å¤§å€¼æ›¿æ¢ï¼‰ static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // 2. åŠ è½½å› å­(Load factor)ï¼šHashMapåœ¨å…¶å®¹é‡è‡ªåŠ¨å¢žåŠ å‰å¯è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦// a. åŠ è½½å› å­è¶Šå¤§ã€å¡«æ»¡çš„å…ƒç´ è¶Šå¤š = ç©ºé—´åˆ©ç”¨çŽ‡é«˜ã€ä½†å†²çªçš„æœºä¼šåŠ å¤§ã€æŸ¥æ‰¾æ•ˆçŽ‡å˜ä½Žï¼ˆå› ä¸ºé“¾è¡¨å˜é•¿äº†ï¼‰// b. åŠ è½½å› å­è¶Šå°ã€å¡«æ»¡çš„å…ƒç´ è¶Šå°‘ = ç©ºé—´åˆ©ç”¨çŽ‡å°ã€å†²çªçš„æœºä¼šå‡å°ã€æŸ¥æ‰¾æ•ˆçŽ‡é«˜ï¼ˆé“¾è¡¨ä¸é•¿ï¼‰// å®žé™…åŠ è½½å› å­final float loadFactor;//é»˜è®¤è£…è½½å› å­ = 0.75 static final float DEFAULT_LOAD_FACTOR = 0.75f; // 3. æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰ï¼šå½“å“ˆå¸Œè¡¨çš„å¤§å° â‰¥ æ‰©å®¹é˜ˆå€¼æ—¶ï¼Œå°±ä¼šæ‰©å®¹å“ˆå¸Œè¡¨ï¼ˆå³æ‰©å……HashMapçš„å®¹é‡ï¼‰ // a. æ‰©å®¹ = å¯¹å“ˆå¸Œè¡¨è¿›è¡Œresizeæ“ä½œï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æž„ï¼‰ï¼Œä»Žè€Œå“ˆå¸Œè¡¨å°†å…·æœ‰å¤§çº¦ä¸¤å€çš„æ¡¶æ•°// b. æ‰©å®¹é˜ˆå€¼ = å®¹é‡ x åŠ è½½å› å­int threshold; // å­˜å‚¨æ•°æ®çš„Entryç±»åž‹ æ•°ç»„ï¼Œé•¿åº¦ = 2çš„å¹‚// HashMapçš„å®žçŽ°æ–¹å¼ = æ‹‰é“¾æ³•ï¼ŒEntryæ•°ç»„ä¸Šçš„æ¯ä¸ªå…ƒç´ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE; //HashMapå†…éƒ¨çš„å­˜å‚¨ç»“æž„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ­¤å¤„æ•°ç»„ä¸ºç©ºï¼Œå³æ²¡æœ‰åˆå§‹åŒ–ä¹‹å‰çš„çŠ¶æ€ static final Entry&lt;?,?&gt;[] EMPTY_TABLE = &#123;&#125;; //å®žé™…å­˜å‚¨çš„key-valueé”®å€¼å¯¹çš„ä¸ªæ•°transient int size;//ç”¨äºŽå¿«é€Ÿå¤±è´¥ï¼Œç”±äºŽHashMapéžçº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¯¹HashMapè¿›è¡Œè¿­ä»£æ—¶ï¼Œå¦‚æžœæœŸé—´å…¶ä»–çº¿ç¨‹çš„å‚ä¸Žå¯¼è‡´HashMapçš„ç»“æž„å‘ç”Ÿå˜åŒ–äº†ï¼ˆæ¯”å¦‚putï¼Œremoveç­‰æ“ä½œï¼‰ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸ConcurrentModificationExceptiontransient int modCount;//é»˜è®¤çš„thresholdå€¼ static final int ALTERNATIVE_HASHING_THRESHOLD_DEFAULT = Integer.MAX_VALUE; åŠ è½½å› å­è¯¦è¿° åŠ è½½å› å­è¿‡å¤§ å¡«å……çš„å…ƒç´ è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨çŽ‡ä¹Ÿå°±è¶Šé«˜ï¼› å†²çªæ¦‚çŽ‡åŠ å¤§ï¼Œé“¾è¡¨è¾¹é•¿ï¼ŒæŸ¥æ‰¾æ•ˆçŽ‡å˜å°ï¼› åŠ è½½å› å­è¿‡å° å†²çªæ¦‚çŽ‡å‡å°ï¼Œé“¾è¡¨å˜çŸ­ï¼ŒæŸ¥æ‰¾æ•ˆçŽ‡å˜é«˜ï¼› å¡«å……çš„å…ƒç´ è¶Šå°‘ï¼Œç©ºé—´åˆ©ç”¨çŽ‡è¶Šä½Žï¼› ä½¿ç”¨å»ºè®® åœ¨æŸ¥æ‰¾æ•ˆçŽ‡&amp;ç©ºé—´åˆ©ç”¨çŽ‡ä¹‹é—´å¯»æ‰¾ä¸€ç§å¹³è¡¡ï¼Œå³æ‰€è°“çš„â€œç©ºé—´æ•ˆçŽ‡æ¢æ—¶é—´æ•ˆçŽ‡â€ or &quot;æ—¶é—´æ•ˆçŽ‡æ¢ç©ºé—´æ•ˆçŽ‡&quot;ï¼› è‹¥ç©ºé—´å†…å­˜å……è¶³ï¼Œå¯é€‰æ‹©â€œç©ºé—´æ•ˆçŽ‡æ¢æ—¶é—´æ•ˆçŽ‡â€ç­–ç•¥ï¼Œå³é€šè¿‡è®¾ç½®è¿‡å°çš„åŠ è½½å› å­æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ä¹Ÿè¦è€ƒè™‘é¢‘ç¹æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼› è‹¥ç©ºé—´å†…å­˜ä¸è¶³ï¼Œå¯é€‰æ‹©â€œæ—¶é—´æ•ˆçŽ‡æ¢ç©ºé—´æ•ˆçŽ‡â€ç­–ç•¥ï¼Œå³é€šè¿‡è®¾ç½®è¿‡å¤§çš„åŠ è½½å› å­æé«˜ç©ºé—´åˆ©ç”¨çŽ‡ï¼Œä½†ç‰ºç‰²äº†æŸ¥è¯¢é€ŸçŽ‡ï¼› åŠ è½½å› å­å¯è‡ªå®šä¹‰ä¿®æ”¹ï¼Œä½†éžç‰¹æ®Šæƒ…å†µä¸å»ºè®®ä¿®æ”¹ï¼ˆé»˜è®¤å€¼=0.75ï¼‰ï¼› æž„é€ æ–¹æ³• HashMapæœ‰4ä¸ªæž„é€ å™¨ï¼Œå…¶ä»–æž„é€ å™¨å¦‚æžœç”¨æˆ·æ²¡æœ‰ä¼ å…¥initialCapacity å’ŒloadFactorè¿™ä¸¤ä¸ªå‚æ•°ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚initialCapacityé»˜è®¤ä¸º16ï¼ŒloadFactoryé»˜è®¤ä¸º0.75ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//è®¡ç®—Hashå€¼æ—¶çš„key transient int hashSeed = 0; /** * æž„é€ å‡½æ•°1ï¼šé»˜è®¤æž„é€ å‡½æ•°ï¼ˆæ— å‚ï¼‰ * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ = 0.75ã€16 */ public HashMap() &#123; // å®žé™…ä¸Šæ˜¯è°ƒç”¨æž„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æž„é€ å‡½æ•° // ä¼ å…¥çš„æŒ‡å®šå®¹é‡ &amp; åŠ è½½å› å­ = é»˜è®¤ this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR); &#125; /** * æž„é€ å‡½æ•°2ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æž„é€ å‡½æ•° * åŠ è½½å› å­ = é»˜è®¤ = 0.75 ã€å®¹é‡ = æŒ‡å®šå¤§å° */ public HashMap(int initialCapacity) &#123; // å®žé™…ä¸Šæ˜¯è°ƒç”¨æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æž„é€ å‡½æ•° // åªæ˜¯åœ¨ä¼ å…¥çš„åŠ è½½å› å­å‚æ•° = é»˜è®¤åŠ è½½å› å­ this(initialCapacity, DEFAULT_LOAD_FACTOR); &#125; /** * æž„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æž„é€ å‡½æ•° * åŠ è½½å› å­ &amp; å®¹é‡ = è‡ªå·±æŒ‡å®š */ public HashMap(int initialCapacity, float loadFactor) &#123; if (initialCapacity &lt; 0)//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY)//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ throw new IllegalArgumentException("Illegal load factor: " + loadFactor); // è®¾ç½® åŠ è½½å› å­ this.loadFactor = loadFactor; // è®¾ç½® æ‰©å®¹é˜ˆå€¼ = åˆå§‹å®¹é‡ threshold = initialCapacity; init();//initæ–¹æ³•åœ¨HashMapä¸­æ²¡æœ‰å®žé™…å®žçŽ°ï¼Œä¸è¿‡åœ¨å…¶å­ç±»å¦‚ linkedHashMapä¸­å°±ä¼šæœ‰å¯¹åº”å®žçŽ°&#125; /** * æž„é€ å‡½æ•°4ï¼šåŒ…å«â€œå­Mapâ€çš„æž„é€ å‡½æ•° * å³ æž„é€ å‡ºæ¥çš„HashMapåŒ…å«ä¼ å…¥Mapçš„æ˜ å°„å…³ç³» * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ */ public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; // è®¾ç½®å®¹é‡å¤§å° &amp; åŠ è½½å› å­ = é»˜è®¤ this(Math.max((int) (m.size() / DEFAULT_LOAD_FACTOR) + 1, DEFAULT_INITIAL_CAPACITY), DEFAULT_LOAD_FACTOR); inflateTable(threshold);//åˆå§‹åŒ–HashMapåº•å±‚çš„æ•°ç»„ç»“æž„ putAllForCreate(m);//æ·»åŠ mä¸­çš„å…ƒç´  &#125; åœ¨å¸¸è§„æž„é€ å™¨ä¸­ï¼Œå¹¶æ²¡æœ‰é©¬ä¸Šä¸ºæ•°ç»„tableåˆ†é…å†…å­˜ç©ºé—´ï¼ˆæœ‰ä¸€ä¸ªå…¥å‚ä¸ºæŒ‡å®šMapçš„æž„é€ å™¨ä¾‹å¤–ï¼‰ï¼Œäº‹å®žä¸Šæ˜¯åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡putæ“ä½œçš„æ—¶å€™æ‰çœŸæ­£æž„å»ºtableæ•°ç»„ã€‚ putæ“ä½œ æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637public V put(K key, V value) // 1. è‹¥å“ˆå¸Œè¡¨æœªåˆå§‹åŒ–ï¼ˆå³ tableä¸ºç©º) // åˆ™ä½¿ç”¨æž„é€ å‡½æ•°è®¾ç½®çš„é˜ˆå€¼(å³åˆå§‹å®¹é‡) åˆå§‹åŒ–æ•°ç»„table if (table == EMPTY_TABLE) &#123; inflateTable(threshold); &#125; // 2. åˆ¤æ–­keyæ˜¯å¦ä¸ºç©ºå€¼null // 2.1 è‹¥key == nullï¼Œåˆ™å°†è¯¥é”®-å€¼ å­˜æ”¾åˆ°æ•°ç»„table ä¸­çš„ç¬¬1ä¸ªä½ç½®ï¼Œå³table [0] // ï¼ˆæœ¬è´¨ï¼škey = Nullæ—¶ï¼Œhashå€¼ = 0ï¼Œæ•…å­˜æ”¾åˆ°table[0]ä¸­ï¼‰ // è¯¥ä½ç½®æ°¸è¿œåªæœ‰1ä¸ªvalueï¼Œæ–°ä¼ è¿›æ¥çš„valueä¼šè¦†ç›–æ—§çš„value if (key == null) return putForNullKey(value); // 2.2 è‹¥ key â‰  nullï¼Œåˆ™è®¡ç®—å­˜æ”¾æ•°ç»„ table ä¸­çš„ä½ç½®ï¼ˆä¸‹æ ‡ã€ç´¢å¼•ï¼‰ // a. æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼ int hash = hash(key); // b. æ ¹æ®hashå€¼ æœ€ç»ˆèŽ·å¾— keyå¯¹åº”å­˜æ”¾çš„æ•°ç»„Tableä¸­ä½ç½® int i = indexFor(hash, table.length); // 3. åˆ¤æ–­è¯¥keyå¯¹åº”çš„å€¼æ˜¯å¦å·²å­˜åœ¨ï¼ˆé€šè¿‡éåŽ† ä»¥è¯¥æ•°ç»„å…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ é€ä¸ªåˆ¤æ–­ï¼‰ for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) &#123; Object k; // 3.1 è‹¥è¯¥keyå·²å­˜åœ¨ï¼ˆå³ key-valueå·²å­˜åœ¨ ï¼‰ï¼Œåˆ™ç”¨ æ–°value æ›¿æ¢ æ—§value if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; //å¹¶è¿”å›žæ—§çš„value &#125; &#125; //ä¿è¯å¹¶å‘è®¿é—®æ—¶ï¼Œè‹¥HashMapå†…éƒ¨ç»“æž„å‘ç”Ÿå˜åŒ–ï¼Œå¿«é€Ÿå“åº”å¤±è´¥ modCount++; // 3.2 è‹¥ è¯¥keyä¸å­˜åœ¨ï¼Œåˆ™å°†â€œkey-valueâ€æ·»åŠ åˆ°tableä¸­ addEntry(hash, key, value, i); return null;&#125; æ ¹æ®æºç åˆ†æžæ‰€ä½œå‡ºçš„æµç¨‹å›¾ï¼š inflateTable--åˆå§‹åŒ–å“ˆå¸Œè¡¨ 123456789101112131415private void inflateTable(int toSize) &#123; // 1. å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„æ¬¡å¹‚ // å³å¦‚æžœä¼ å…¥çš„æ˜¯å®¹é‡å¤§å°æ˜¯19ï¼Œé‚£ä¹ˆè½¬åŒ–åŽï¼Œåˆå§‹åŒ–å®¹é‡å¤§å°ä¸º32ï¼ˆå³2çš„5æ¬¡å¹‚ï¼‰ int capacity = roundUpToPowerOf2(toSize);-&gt;&gt;åˆ†æž1 // 2. é‡æ–°è®¡ç®—é˜ˆå€¼ threshold = å®¹é‡ * åŠ è½½å› å­ threshold = (int) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1); // 3. ä½¿ç”¨è®¡ç®—åŽçš„åˆå§‹å®¹é‡ï¼ˆå·²ç»æ˜¯2çš„æ¬¡å¹‚ï¼‰ åˆå§‹åŒ–æ•°ç»„tableï¼ˆä½œä¸ºæ•°ç»„é•¿åº¦ï¼‰ // å³ å“ˆå¸Œè¡¨çš„å®¹é‡å¤§å° = æ•°ç»„å¤§å°ï¼ˆé•¿åº¦ï¼‰ table = new Entry[capacity]; //ç”¨è¯¥å®¹é‡åˆå§‹åŒ–table //åˆå§‹åŒ–å“ˆå¸Œç§å­ initHashSeedAsNeeded(capacity); &#125; inflateTableè¿™ä¸ªæ–¹æ³•ç”¨äºŽä¸ºä¸»å¹²æ•°ç»„tableåœ¨å†…å­˜ä¸­åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé€šè¿‡roundUpToPowerOf2(toSize)å¯ä»¥ç¡®ä¿capacityä¸ºå¤§äºŽæˆ–ç­‰äºŽtoSizeçš„æœ€æŽ¥è¿‘toSizeçš„äºŒæ¬¡å¹‚ï¼Œæ¯”å¦‚toSize=13,åˆ™capacity=16;to_size=16,capacity=16;to_size=17,capacity=32ã€‚ 123456private static int roundUpToPowerOf2(int number) &#123; //è‹¥å®¹é‡è¶…è¿‡äº†æœ€å¤§å€¼ï¼Œåˆå§‹åŒ–å®¹é‡è®¾ç½®ä¸ºæœ€å¤§å€¼ ï¼›å¦åˆ™ï¼Œè®¾ç½®ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„æ¬¡å¹‚ return number &gt;= MAXIMUM_CAPACITY ? MAXIMUM_CAPACITY : (number &gt; 1) ? Integer.highestOneBit((number - 1) &lt;&lt; 1) : 1;&#125; putForNullKey 1234567891011121314151617181920212223private V putForNullKey(V value) &#123; // éåŽ†ä»¥table[0]ä¸ºé¦–çš„é“¾è¡¨ï¼Œå¯»æ‰¾æ˜¯å¦å­˜åœ¨key==null å¯¹åº”çš„é”®å€¼å¯¹ // 1. è‹¥æœ‰ï¼šåˆ™ç”¨æ–°value æ›¿æ¢ æ—§valueï¼›åŒæ—¶è¿”å›žæ—§çš„valueå€¼ for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) &#123; if (e.key == null) &#123; V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; &#125; &#125; modCount++; // 2 .è‹¥æ— key==nullçš„é”®ï¼Œé‚£ä¹ˆè°ƒç”¨addEntryï¼ˆï¼‰ï¼Œå°†ç©ºé”® &amp; å¯¹åº”çš„å€¼å°è£…åˆ°Entryä¸­ï¼Œå¹¶æ”¾åˆ°table[0]ä¸­ addEntry(0, null, value, 0); // æ³¨ï¼š // a. addEntryï¼ˆï¼‰çš„ç¬¬1ä¸ªå‚æ•° = hashå€¼ = ä¼ å…¥0 // b. å³ è¯´æ˜Žï¼šå½“key = nullæ—¶ï¼Œä¹Ÿæœ‰hashå€¼ = 0ï¼Œæ‰€ä»¥HashMapçš„key å¯ä¸ºnull // c. å¯¹æ¯”HashTableï¼Œç”±äºŽHashTableå¯¹keyç›´æŽ¥hashCodeï¼ˆï¼‰ï¼Œè‹¥keyä¸ºnullæ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥HashTableçš„keyä¸å¯ä¸ºnull // d. æ­¤å¤„åªéœ€çŸ¥é“æ˜¯å°† key-value æ·»åŠ åˆ°HashMapä¸­å³å¯ return null; &#125; è®¡ç®—Hashå€¼ 123456789101112// è®¡ç®—Hashå€¼ï¼šå°† é”®key è½¬æ¢æˆ å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰æ“ä½œ = ä½¿ç”¨hashCode() + 4æ¬¡ä½è¿ç®— + 5æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ9æ¬¡æ‰°åŠ¨ï¼‰final int hash(Object k) &#123; int h = hashSeed; //keyæ˜¯Stringç±»åž‹çš„å°±ä½¿ç”¨å¦å¤–çš„å“ˆå¸Œç®—æ³• if (0 != h &amp;&amp; k instanceof String) &#123; return sun.misc.Hashing.stringHash32((String) k); &#125; h ^= k.hashCode(); //æ‰°åŠ¨å‡½æ•° h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);&#125; hashæ–¹æ³•çš„æœ€åŽä¸¤è¡Œæ˜¯çœŸæ­£è®¡ç®—hashå€¼çš„ç®—æ³•ï¼Œè®¡ç®—hashç çš„ç®—æ³•è¢«ç§°ä¸ºæ‰°åŠ¨å‡½æ•°ï¼Œæ‰€è°“çš„æ‰°åŠ¨å‡½æ•°å°±æ˜¯æŠŠæ‰€æœ‰ä¸œè¥¿æ‚ç³…åˆ°ä¸€èµ·ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº†å››ä¸ªå‘å³ç§»ä½è¿ç®—ã€‚ç›®çš„å°±æ˜¯å°†hçš„é«˜ä½å€¼ä¸Žä½Žä½å€¼æ··åˆä¸€ä¸‹ï¼Œä»¥æ­¤å¢žåŠ ä½Žä½å€¼çš„éšæœºæ€§ã€‚å®šä½æ•°ç»„çš„ä¸‹æ ‡æ˜¯æ ¹æ®hashç çš„ä½Žä½å€¼æ¥ç¡®å®šçš„ã€‚keyçš„hashç æ˜¯é€šè¿‡hashCodeæ–¹æ³•æ¥ç”Ÿæˆçš„ï¼Œè€Œä¸€ä¸ªç³Ÿç³•çš„hashCodeæ–¹æ³•ç”Ÿæˆçš„hashç çš„ä½Žä½å€¼å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„é‡å¤ã€‚ä¸ºäº†ä½¿å¾—hashç åœ¨æ•°ç»„ä¸Šæ˜ å°„çš„æ¯”è¾ƒå‡åŒ€ï¼Œæ‰°åŠ¨å‡½æ•°å°±æ´¾ä¸Šç”¨åœºäº†ï¼ŒæŠŠé«˜ä½å€¼çš„ç‰¹æ€§ç³…åˆè¿›ä½Žä½å€¼ï¼Œå¢žåŠ ä½Žä½å€¼çš„éšæœºæ€§ï¼Œä»Žè€Œä½¿æ•£åˆ—åˆ†å¸ƒçš„æ›´åŠ æ¾æ•£ï¼Œä»¥æ­¤æé«˜æ€§èƒ½ã€‚ä¸‹å›¾ä¸¾äº†ä¸ªä¾‹å­å¸®åŠ©ç†è§£ã€‚ è®¡ç®—ç´¢å¼•å€¼ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰ 1234567/** * è®¡ç®—ç´¢å¼•ä½ç½® */ static int indexFor(int h, int length) &#123; return h &amp; (length-1); // å°†å¯¹å“ˆå¸Œç æ‰°åŠ¨å¤„ç†åŽçš„ç»“æžœ ä¸Žè¿ç®—(&amp;) ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°å­˜å‚¨åœ¨æ•°ç»„tableçš„ä½ç½®ï¼ˆå³æ•°ç»„ä¸‹æ ‡ã€ç´¢å¼•ï¼‰&#125; h&amp;ï¼ˆlength-1ï¼‰ä¿è¯èŽ·å–çš„indexä¸€å®šåœ¨æ•°ç»„èŒƒå›´å†…ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œé»˜è®¤å®¹é‡16ï¼Œlength-1=15ï¼Œh=18,è½¬æ¢æˆäºŒè¿›åˆ¶è®¡ç®—ä¸º: 1234 1 0 0 1 0&amp; 0 1 1 1 1__________________ 0 0 0 1 0 = 2 æœ€ç»ˆè®¡ç®—å‡ºçš„index=2ã€‚æœ‰äº›ç‰ˆæœ¬çš„å¯¹äºŽæ­¤å¤„çš„è®¡ç®—ä¼šä½¿ç”¨ å–æ¨¡è¿ç®—ï¼Œä¹Ÿèƒ½ä¿è¯indexä¸€å®šåœ¨æ•°ç»„èŒƒå›´å†…ï¼Œä¸è¿‡ä½è¿ç®—å¯¹è®¡ç®—æœºæ¥è¯´ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ï¼ˆHashMapä¸­æœ‰å¤§é‡ä½è¿ç®—ï¼‰ æ‰€ä»¥æœ€ç»ˆå­˜å‚¨ä½ç½®çš„ç¡®å®šæµç¨‹æ˜¯è¿™æ ·çš„ï¼š addEntry--æ·»åŠ é”®å€¼å¯¹ 1234567891011121314151617181920212223/** * æ·»åŠ é”®å€¼å¯¹ï¼ˆEntry ï¼‰åˆ° HashMapä¸­ * @param hash--keyå¯¹åº”çš„hashå€¼ * @param key--é”® * @param value--å€¼ * @param bucketIndex--å‡ºå…¥æ•°ç»„tableçš„ç´¢å¼•ä½ç½®--&gt;æ•°ç»„ä¸‹æ ‡ */void addEntry(int hash, K key, V value, int bucketIndex) &#123; // 1. æ’å…¥å‰ï¼Œå…ˆåˆ¤æ–­å®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œè‹¥ä¸è¶³å¤Ÿï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼ˆ2å€ï¼‰ã€é‡æ–°è®¡ç®—Hashå€¼ã€é‡æ–°è®¡ç®—å­˜å‚¨æ•°ç»„ä¸‹æ ‡ // å¦‚æžœHashMapçš„å¤§å°å¤§äºŽé˜€å€¼å¹¶ä¸”å“ˆå¸Œè¡¨å¯¹åº”æ§½ä½çš„å€¼ä¸ä¸ºç©º if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) &#123; //å› ä¸ºHashMapçš„å¤§å°å¤§äºŽé˜€å€¼, è¡¨æ˜Žå³å°†å‘ç”Ÿå“ˆå¸Œå†²çª, æ‰€ä»¥è¿›è¡Œæ‰©å®¹ //2å€æ‰©å®¹ resize(2 * table.length); //é‡æ–°è®¡ç®—è¯¥keyå¯¹åº”çš„hashå€¼ hash = (null != key) ? hash(key) : 0; //é‡æ–°è®¡ç®—è¯¥keyå¯¹åº”çš„hashå€¼çš„å­˜å‚¨æ•°ç»„ä¸‹æ ‡ bucketIndex = indexFor(hash, table.length); &#125; //åœ¨è¿™é‡Œè¡¨æ˜ŽHashMapçš„å¤§å°æ²¡æœ‰è¶…è¿‡é˜€å€¼, æ‰€ä»¥ä¸éœ€è¦æ‰©å®¹ //åˆ›å»º1ä¸ªæ–°çš„æ•°ç»„å…ƒç´ (Entry)å¹¶æ”¾å…¥æ•°ç»„ä¸­ createEntry(hash, key, value, bucketIndex);&#125; æµç¨‹å¦‚ä¸‹ï¼ˆé”®å€¼å¯¹çš„æ·»åŠ æ–¹å¼--&gt;å•é“¾è¡¨çš„å¤´æ’æ³•ï¼‰ï¼š resize--æ•°ç»„æ‰©å®¹ 12345678910111213141516171819202122/** * å¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ‰©å®¹ï¼Œå½“å®¹é‡ä¸è¶³æ—¶ï¼ˆå®¹é‡ &gt; é˜ˆå€¼ï¼‰ï¼Œåˆ™æ‰©å®¹ï¼ˆæ‰©åˆ°2å€ï¼‰ */void resize(int newCapacity) &#123; // 1. ä¿å­˜æ—§æ•°ç»„ï¼ˆold tableï¼‰ Entry[] oldTable = table; // 2. ä¿å­˜æ—§å®¹é‡ï¼ˆold capacity ï¼‰ï¼Œå³æ•°ç»„é•¿åº¦ int oldCapacity = oldTable.length; // 3. è‹¥æ—§å®¹é‡å·²ç»æ˜¯ç³»ç»Ÿé»˜è®¤æœ€å¤§å®¹é‡äº†ï¼Œé‚£ä¹ˆå°†é˜ˆå€¼è®¾ç½®æˆæ•´åž‹çš„æœ€å¤§å€¼ï¼Œé€€å‡º if (oldCapacity == MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return; &#125; // 4. æ ¹æ®æ–°å®¹é‡ï¼ˆ2å€å®¹é‡ï¼‰æ–°å»º1ä¸ªæ•°ç»„ï¼Œå³æ–°table Entry[] newTable = new Entry[newCapacity]; // 5. å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°tableä¸­ï¼Œä»Žè€Œå®Œæˆæ‰©å®¹ transfer(newTable, initHashSeedAsNeeded(newCapacity)); // 6. å°†å½“å‰å“ˆå¸Œè¡¨è®¾ç½®ä¸ºæ–°çš„å“ˆå¸Œè¡¨ table = newTable; // 7. æ›´æ–°å“ˆå¸Œè¡¨é˜ˆå€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);&#125; æµç¨‹å¦‚ä¸‹ï¼š transfer--æ•°æ®è½¬ç§» 123456789101112131415161718192021222324252627282930313233343536 /** * å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°tableä¸­ï¼Œä»Žè€Œå®Œæˆæ‰©å®¹ * è¿‡ç¨‹ï¼šæŒ‰æ—§é“¾è¡¨çš„æ­£åºéåŽ†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ */ void transfer(Entry[] newTable) &#123; // 1. srcå¼•ç”¨äº†æ—§æ•°ç»„ Entry[] src = table; // 2. èŽ·å–æ–°æ•°ç»„çš„å¤§å° = èŽ·å–æ–°å®¹é‡å¤§å° int newCapacity = newTable.length; // 3. é€šè¿‡éåŽ† æ—§æ•°ç»„ï¼Œå°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ for (int j = 0; j &lt; src.length; j++) &#123; // 3.1 å–å¾—æ—§æ•°ç»„çš„æ¯ä¸ªå…ƒç´  Entry&lt;K,V&gt; e = src[j]; if (e != null) &#123; // 3.2 é‡Šæ”¾æ—§æ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªçŽ¯åŽï¼Œæ—§æ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰ src[j] = null; do &#123; // 3.3 éåŽ† ä»¥è¯¥æ•°ç»„å…ƒç´ ä¸ºé¦– çš„é“¾è¡¨ // æ³¨ï¼šè½¬ç§»é“¾è¡¨æ—¶ï¼Œå› æ˜¯å•é“¾è¡¨ï¼Œæ•…è¦ä¿å­˜ä¸‹1ä¸ªç»“ç‚¹ï¼Œå¦åˆ™è½¬ç§»åŽé“¾è¡¨ä¼šæ–­å¼€ Entry&lt;K,V&gt; next = e.next; // 3.4 é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½® int i = indexFor(e.hash, newCapacity); // 3.5 å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Šï¼šé‡‡ç”¨å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ = åœ¨é“¾è¡¨å¤´ä¸Šå­˜æ”¾æ•°æ® = å°†æ•°ç»„ä½ç½®çš„åŽŸæœ‰æ•°æ®æ”¾åœ¨åŽ1ä¸ªæŒ‡é’ˆã€å°†éœ€æ”¾å…¥çš„æ•°æ®æ”¾åˆ°æ•°ç»„ä½ç½®ä¸­ // å³ æ‰©å®¹åŽï¼Œå¯èƒ½å‡ºçŽ°é€†åºï¼šæŒ‰æ—§é“¾è¡¨çš„æ­£åºéåŽ†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ e.next = newTable[i]; newTable[i] = e; // 3.6 è®¿é—®ä¸‹1ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ ï¼Œå¦‚æ­¤ä¸æ–­å¾ªçŽ¯ï¼Œç›´åˆ°éåŽ†å®Œè¯¥é“¾è¡¨ä¸Šçš„æ‰€æœ‰ç»“ç‚¹ e = next; &#125; while (e != null); // å¦‚æ­¤ä¸æ–­å¾ªçŽ¯ï¼Œç›´åˆ°éåŽ†å®Œæ•°ç»„ä¸Šçš„æ‰€æœ‰æ•°æ®å…ƒç´  &#125; &#125; &#125; æµç¨‹å¦‚ä¸‹ï¼š createEntry--æ·»åŠ é”®å€¼å¯¹ 123456789101112131415/** * åˆ›å»º1ä¸ªæ–°çš„æ•°ç»„å…ƒç´ ï¼ˆEntryï¼‰ å¹¶æ”¾å…¥åˆ°æ•°ç»„ä¸­ */ void createEntry(int hash, K key, V value, int bucketIndex) &#123; // 1. æŠŠtableä¸­è¯¥ä½ç½®åŽŸæ¥çš„Entryä¿å­˜ Entry&lt;K,V&gt; e = table[bucketIndex]; // 2. åœ¨tableä¸­è¯¥ä½ç½®æ–°å»ºä¸€ä¸ªEntryï¼šå°†åŽŸå¤´ç»“ç‚¹ä½ç½®ï¼ˆæ•°ç»„ä¸Šï¼‰çš„é”®å€¼å¯¹ æ”¾å…¥åˆ°ï¼ˆé“¾è¡¨ï¼‰åŽ1ä¸ªç»“ç‚¹ä¸­ã€å°†éœ€æ’å…¥çš„é”®å€¼å¯¹ æ”¾å…¥åˆ°å¤´ç»“ç‚¹ä¸­ï¼ˆæ•°ç»„ä¸Šï¼‰-&gt; ä»Žè€Œå½¢æˆé“¾è¡¨ // å³ åœ¨æ’å…¥å…ƒç´ æ—¶ï¼Œæ˜¯åœ¨é“¾è¡¨å¤´æ’å…¥çš„ï¼Œtableä¸­çš„æ¯ä¸ªä½ç½®æ°¸è¿œåªä¿å­˜æœ€æ–°æ’å…¥çš„Entryï¼Œæ—§çš„Entryåˆ™æ”¾å…¥åˆ°é“¾è¡¨ä¸­ï¼ˆå³ è§£å†³Hashå†²çªï¼‰ table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); // 3. å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹æ•°é‡è®¡æ•°å¢žåŠ  size++; &#125; æ€»ç»“ å‘ HashMap æ·»åŠ æ•°æ®ï¼ˆæˆå¯¹ æ”¾å…¥ é”® - å€¼å¯¹ï¼‰çš„å…¨æµç¨‹ï¼š getæ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * ä»ŽHashMapä¸­èŽ·å–æ•°æ® */ public V get(Object key) &#123; // 1. å½“key == nullæ—¶ï¼Œåˆ™åˆ° ä»¥å“ˆå¸Œè¡¨æ•°ç»„ä¸­çš„ç¬¬1ä¸ªå…ƒç´ ï¼ˆå³table[0]ï¼‰ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨åŽ»å¯»æ‰¾å¯¹åº” key == nullçš„é”® if (key == null) return getForNullKey(); // 2. å½“key â‰  nullæ—¶ï¼ŒåŽ»èŽ·å¾—å¯¹åº”å€¼ Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue(); &#125; /** * å½“key == nullæ—¶ï¼Œåˆ™åˆ° ä»¥å“ˆå¸Œè¡¨æ•°ç»„ä¸­çš„ç¬¬1ä¸ªå…ƒç´ ï¼ˆå³table[0]ï¼‰ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨åŽ»å¯»æ‰¾å¯¹åº” key == nullçš„é”® */ private V getForNullKey() &#123; if (size == 0) &#123; return null; &#125; // éåŽ†ä»¥table[0]ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œå¯»æ‰¾ key==null å¯¹åº”çš„å€¼ for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) &#123; // ä»Žtable[0]ä¸­å–key==nullçš„valueå€¼ if (e.key == null) return e.value; &#125; return null; &#125; /** * å½“key â‰  nullæ—¶ï¼ŒåŽ»èŽ·å¾—å¯¹åº”å€¼ */ final Entry&lt;K,V&gt; getEntry(Object key) &#123; if (size == 0) &#123; return null; &#125; // 1. æ ¹æ®keyå€¼ï¼Œé€šè¿‡hashï¼ˆï¼‰è®¡ç®—å‡ºå¯¹åº”çš„hashå€¼ int hash = (key == null) ? 0 : hash(key); // 2. æ ¹æ®hashå€¼è®¡ç®—å‡ºå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ // 3. éåŽ† ä»¥è¯¥æ•°ç»„ä¸‹æ ‡çš„æ•°ç»„å…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨æ‰€æœ‰ç»“ç‚¹ï¼Œå¯»æ‰¾è¯¥keyå¯¹åº”çš„å€¼ for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) &#123; Object k; // è‹¥ hashå€¼ &amp; key ç›¸ç­‰ï¼Œåˆ™è¯æ˜Žè¯¥Entry = æˆ‘ä»¬è¦çš„é”®å€¼å¯¹ // é€šè¿‡equalsï¼ˆï¼‰åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; return null; &#125; æµç¨‹å¦‚ä¸‹ï¼š å…¶ä»–æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132 /** * åˆ¤æ–­HashMapæ˜¯å¦ä¸ºç©ºï¼Œå³æ— é”®å€¼å¯¹ï¼›size == 0æ—¶ è¡¨ç¤ºä¸º ç©º */public boolean isEmpty() &#123; return size == 0; &#125; /** * è¿”å›žå“ˆå¸Œè¡¨ä¸­æ‰€æœ‰ é”®å€¼å¯¹çš„æ•°é‡ = æ•°ç»„ä¸­çš„é”®å€¼å¯¹ + é“¾è¡¨ä¸­çš„é”®å€¼å¯¹ */public int size() &#123; return size; &#125; /** * æ¸…ç©ºå“ˆå¸Œè¡¨ï¼Œå³åˆ é™¤æ‰€æœ‰é”®å€¼å¯¹ * åŽŸç†ï¼šå°†æ•°ç»„tableä¸­å­˜å‚¨çš„Entryå…¨éƒ¨ç½®ä¸ºnullã€sizeç½®ä¸º0 */ public void clear() &#123; modCount++; Arrays.fill(table, null); size = 0;&#125; /** * å°†æŒ‡å®šMapä¸­çš„é”®å€¼å¯¹ å¤åˆ¶åˆ° æ­¤Mapä¸­ */ public void putAll(Map&lt;? extends K, ? extends V&gt; m) &#123; // 1. ç»Ÿè®¡éœ€å¤åˆ¶å¤šå°‘ä¸ªé”®å€¼å¯¹ int numKeysToBeAdded = m.size(); if (numKeysToBeAdded == 0) return; // 2. è‹¥tableè¿˜æ²¡åˆå§‹åŒ–ï¼Œå…ˆç”¨åˆšåˆšç»Ÿè®¡çš„å¤åˆ¶æ•°åŽ»åˆå§‹åŒ–table if (table == EMPTY_TABLE) &#123; inflateTable((int) Math.max(numKeysToBeAdded * loadFactor, threshold)); &#125; // 3. è‹¥éœ€å¤åˆ¶çš„æ•°ç›® &gt; é˜ˆå€¼ï¼Œåˆ™éœ€å…ˆæ‰©å®¹ if (numKeysToBeAdded &gt; threshold) &#123; int targetCapacity = (int)(numKeysToBeAdded / loadFactor + 1); if (targetCapacity &gt; MAXIMUM_CAPACITY) targetCapacity = MAXIMUM_CAPACITY; int newCapacity = table.length; while (newCapacity &lt; targetCapacity) newCapacity &lt;&lt;= 1; if (newCapacity &gt; table.length) resize(newCapacity); &#125; // 4. å¼€å§‹å¤åˆ¶ï¼ˆå®žé™…ä¸Šä¸æ–­è°ƒç”¨Putå‡½æ•°æ’å…¥ï¼‰ for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) put(e.getKey(), e.getValue());&#125; /** * åˆ é™¤è¯¥é”®å€¼å¯¹ */ public V remove(Object key) &#123; Entry&lt;K,V&gt; e = removeEntryForKey(key); return (e == null ? null : e.value); &#125; final Entry&lt;K,V&gt; removeEntryForKey(Object key) &#123; if (size == 0) &#123; return null; &#125; // 1. è®¡ç®—hashå€¼ int hash = (key == null) ? 0 : hash(key); // 2. è®¡ç®—å­˜å‚¨çš„æ•°ç»„ä¸‹æ ‡ä½ç½® int i = indexFor(hash, table.length); Entry&lt;K,V&gt; prev = table[i]; Entry&lt;K,V&gt; e = prev; while (e != null) &#123; Entry&lt;K,V&gt; next = e.next; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) &#123; modCount++; size--; // è‹¥åˆ é™¤çš„æ˜¯tableæ•°ç»„ä¸­çš„å…ƒç´ ï¼ˆå³é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼‰ // åˆ™åˆ é™¤æ“ä½œ = å°†å¤´ç»“ç‚¹çš„nextå¼•ç”¨å­˜å…¥table[i]ä¸­ if (prev == e) table[i] = next; //å¦åˆ™ å°†ä»¥table[i]ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ä¸­ï¼Œå½“å‰Entryçš„å‰1ä¸ªEntryä¸­çš„next è®¾ç½®ä¸º å½“å‰Entryçš„nextï¼ˆå³åˆ é™¤å½“å‰Entry = ç›´æŽ¥è·³è¿‡å½“å‰Entryï¼‰ else prev.next = next; e.recordRemoval(this); return e; &#125; prev = e; e = next; &#125; return e; &#125; /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥é”®çš„é”®å€¼å¯¹ï¼›æ˜¯ åˆ™è¿”å›žtrue * åŽŸç†ï¼šè°ƒç”¨getï¼ˆï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºNull */public boolean containsKey(Object key) &#123; return getEntry(key) != null; &#125; /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥å€¼çš„é”®å€¼å¯¹ï¼›æ˜¯ åˆ™è¿”å›žtrue */ public boolean containsValue(Object value) &#123; // è‹¥valueä¸ºç©ºï¼Œåˆ™è°ƒç”¨containsNullValue() if (value == null) return containsNullValue(); // è‹¥valueä¸ä¸ºç©ºï¼Œåˆ™éåŽ†é“¾è¡¨ä¸­çš„æ¯ä¸ªEntryï¼Œé€šè¿‡equalsï¼ˆï¼‰æ¯”è¾ƒvalues åˆ¤æ–­æ˜¯å¦å­˜åœ¨ Entry[] tab = table; for (int i = 0; i &lt; tab.length ; i++) for (Entry e = tab[i] ; e != null ; e = e.next) if (value.equals(e.value)) return true;//è¿”å›žtrue return false; &#125; // valueä¸ºç©ºæ—¶è°ƒç”¨çš„æ–¹æ³• private boolean containsNullValue() &#123; Entry[] tab = table; for (int i = 0; i &lt; tab.length ; i++) for (Entry e = tab[i] ; e != null ; e = e.next) if (e.value == null) return true; return false; &#125; æ‰©å®¹å¯¼è‡´æ­»å¾ªçŽ¯åˆ†æž HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒåŽŸå› å°±æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘æ‰§è¡Œput()æ“ä½œå¯¼è‡´è§¦å‘æ‰©å®¹resize()ï¼Œä»Žè€Œå¯¼è‡´çŽ¯å½¢é“¾è¡¨ï¼Œä½¿å¾—åœ¨èŽ·å–æ•°æ®éåŽ†é“¾è¡¨æ—¶å½¢æˆæ­»å¾ªçŽ¯ã€‚ resize()çš„æºç å‰é¢å·²ç»åˆ†æžè¿‡äº†ï¼Œä»Žæºç å¯ä»¥çœ‹å‡ºåœ¨resize()è¿‡ç¨‹ä¸­ï¼Œåœ¨å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®è½¬ç§»åˆ°æ–°æ•°ç»„ä¸Šæ—¶ï¼Œè½¬ç§»æ•°æ®æ“ä½œéœ€è¦å°†æ—§é“¾è¡¨æ­£åºéåŽ†ï¼Œç„¶åŽåœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ï¼Œå³åœ¨è½¬ç§»æ•°æ®ã€æ‰©å®¹åŽï¼Œå®¹æ˜“å‡ºçŽ°é“¾è¡¨é€†åºçš„æƒ…å†µã€‚ å‡è®¾é‡æ–°è®¡ç®—å­˜å‚¨ä½ç½®åŽä¸å˜ï¼Œå³æ‰©å®¹å‰ 1-&gt;2-&gt;3ï¼Œæ‰©å®¹åŽ 3-&gt;2-&gt;1ï¼Œæ­¤æ—¶è‹¥ï¼ˆå¤šçº¿ç¨‹ï¼‰å¹¶å‘æ‰§è¡Œ putï¼ˆï¼‰æ“ä½œï¼Œä¸€æ—¦å‡ºçŽ°æ‰©å®¹æƒ…å†µï¼Œåˆ™ å®¹æ˜“å‡ºçŽ° çŽ¯å½¢é“¾è¡¨ï¼Œä»Žè€Œåœ¨èŽ·å–æ•°æ®ã€éåŽ†é“¾è¡¨æ—¶ å½¢æˆæ­»å¾ªçŽ¯ï¼ˆInfinite Loopï¼‰ï¼Œå³ æ­»é”çš„çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾ï¼š æ³¨ï¼šç”±äºŽ JDK 1.8 è½¬ç§»æ•°æ®æ“ä½œ = æŒ‰æ—§é“¾è¡¨çš„æ­£åºéåŽ†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å°¾éƒ¨ä¾æ¬¡æ’å…¥ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºçŽ°é“¾è¡¨ é€†åºã€å€’ç½®çš„æƒ…å†µï¼Œæ•…ä¸å®¹æ˜“å‡ºçŽ°çŽ¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚ä½† JDK 1.8 è¿˜æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œå› ä¸º æ— åŠ åŒæ­¥é”ä¿æŠ¤ã€‚ HashMap-Jdk1.8 æ•°æ®ç»“æž„ åœ¨Jdk1.8ä¸­ï¼Œä¼˜åŒ–äº†HashMapçš„æ•°æ®ç»“æž„ï¼Œå¼•å…¥çº¢é»‘æ ‘ï¼Œå³HashMapçš„æ•°æ®ç»“æž„ = æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ å¼•å…¥åŽŸå›  å¼•å…¥çº¢é»‘æ ‘çš„ç›®çš„åœ¨äºŽæé«˜HashMapçš„æ€§èƒ½ï¼Œå³è§£å†³å‘ç”Ÿå“ˆå¸Œç¢°æ’žåŽï¼Œé“¾è¡¨è¿‡é•¿å¯¼è‡´ç´¢å¼•æ•ˆçŽ‡æ…¢çš„é—®é¢˜ã€‚å…·ä½“å°±æ˜¯åˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢žåˆ æ”¹æŸ¥çš„ç‰¹ç‚¹ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»ŽåŽŸæ¥çš„O(n)é™åˆ°O(log(n))ã€‚ åº”ç”¨åœºæ™¯ å½“é“¾è¡¨é•¿åº¦&gt;8 æ—¶ï¼Œå°†è¯¥é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼› æ•°ç»„å…ƒç´ &amp;é“¾è¡¨ç»“ç‚¹å®žçŽ°ç±» Jdk1.8 HashMapä¸­çš„æ•°ç»„å…ƒç´ &amp;é“¾è¡¨ç»“ç‚¹é‡‡ç”¨Nodeç±»å®žçŽ°ï¼Œè¯¥ç±»æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Node = HashMapçš„å†…éƒ¨ç±»ï¼Œå®žçŽ°äº†Map.EntryæŽ¥å£ï¼Œæœ¬è´¨æ˜¯ = ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹) * å®žçŽ°äº†getKey()ã€getValue()ã€equals(Object o)å’ŒhashCode()ç­‰æ–¹æ³• **/ static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; // å“ˆå¸Œå€¼ï¼ŒHashMapæ ¹æ®è¯¥å€¼ç¡®å®šè®°å½•çš„ä½ç½® final K key; // key V value; // value Node&lt;K,V&gt; next;// é“¾è¡¨ä¸‹ä¸€ä¸ªç»“ç‚¹ // æž„é€ æ–¹æ³• Node(int hash, K key, V value, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125; public final K getKey() &#123; return key; &#125; // è¿”å›ž ä¸Ž æ­¤é¡¹ å¯¹åº”çš„é”® public final V getValue() &#123; return value; &#125; // è¿”å›ž ä¸Ž æ­¤é¡¹ å¯¹åº”çš„å€¼ public final String toString() &#123; return key + "=" + value; &#125; public final V setValue(V newValue) &#123; V oldValue = value; value = newValue; return oldValue; &#125; public final int hashCode() &#123; return Objects.hashCode(key) ^ Objects.hashCode(value); &#125; /** * åˆ¤æ–­2ä¸ªEntryæ˜¯å¦ç›¸ç­‰ï¼Œå¿…é¡»keyå’Œvalueéƒ½ç›¸ç­‰ï¼Œæ‰è¿”å›žtrue */ public final boolean equals(Object o) &#123; if (o == this) return true; if (o instanceof Map.Entry) &#123; Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; &#125; return false; &#125;&#125; çº¢é»‘æ ‘ç»“ç‚¹å®žçŽ°ç±» 12345678910111213141516171819202122232425/** * çº¢é»‘æ ‘ç»“ç‚¹ å®žçŽ°ç±»ï¼šç»§æ‰¿è‡ªLinkedHashMap.Entry&lt;K,V&gt;ç±» */static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123; // å±žæ€§ = çˆ¶ç»“ç‚¹ã€å·¦å­æ ‘ã€å³å­æ ‘ã€åˆ é™¤è¾…åŠ©ç»“ç‚¹ + é¢œè‰²TreeNode&lt;K,V&gt; parent; TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right;TreeNode&lt;K,V&gt; prev; boolean red; // æž„é€ å‡½æ•°TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; super(hash, key, val, next); &#125; // è¿”å›žå½“å‰ç»“ç‚¹çš„æ ¹ç»“ç‚¹ final TreeNode&lt;K,V&gt; root() &#123; for (TreeNode&lt;K,V&gt; r = this, p;;) &#123; if ((p = r.parent) == null) return r; r = p; &#125; &#125; é‡è¦å±žæ€§ 12345678910111213141516171819202122232425262728293031323334/** * ä¸»è¦å‚æ•° åŒ JDK 1.7 * å³ï¼šå®¹é‡ã€åŠ è½½å› å­ã€æ‰©å®¹é˜ˆå€¼ï¼ˆè¦æ±‚ã€èŒƒå›´å‡ç›¸åŒï¼‰ */// 1. å®¹é‡ï¼ˆcapacityï¼‰ï¼š å¿…é¡»æ˜¯2çš„å¹‚ &amp; &lt;æœ€å¤§å®¹é‡ï¼ˆ2çš„30æ¬¡æ–¹ï¼‰static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // é»˜è®¤å®¹é‡ = 16 = 1&lt;&lt;4 = 00001ä¸­çš„1å‘å·¦ç§»4ä½ = 10000 = åè¿›åˆ¶çš„2^4=16static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // æœ€å¤§å®¹é‡ = 2çš„30æ¬¡æ–¹ï¼ˆè‹¥ä¼ å…¥çš„å®¹é‡è¿‡å¤§ï¼Œå°†è¢«æœ€å¤§å€¼æ›¿æ¢ï¼‰// 2. åŠ è½½å› å­(Load factor)ï¼šHashMapåœ¨å…¶å®¹é‡è‡ªåŠ¨å¢žåŠ å‰å¯è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦ final float loadFactor; // å®žé™…åŠ è½½å› å­static final float DEFAULT_LOAD_FACTOR = 0.75f; // é»˜è®¤åŠ è½½å› å­ = 0.75// 3. æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰ï¼šå½“å“ˆå¸Œè¡¨çš„å¤§å° â‰¥ æ‰©å®¹é˜ˆå€¼æ—¶ï¼Œå°±ä¼šæ‰©å®¹å“ˆå¸Œè¡¨ï¼ˆå³æ‰©å……HashMapçš„å®¹é‡ï¼‰ // a. æ‰©å®¹ = å¯¹å“ˆå¸Œè¡¨è¿›è¡Œresizeæ“ä½œï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æž„ï¼‰ï¼Œä»Žè€Œå“ˆå¸Œè¡¨å°†å…·æœ‰å¤§çº¦ä¸¤å€çš„æ¡¶æ•°// b. æ‰©å®¹é˜ˆå€¼ = å®¹é‡ x åŠ è½½å› å­int threshold;// 4. å…¶ä»–transient Node&lt;K,V&gt;[] table; // å­˜å‚¨æ•°æ®çš„Nodeç±»åž‹ æ•°ç»„ï¼Œé•¿åº¦ = 2çš„å¹‚ï¼›æ•°ç»„çš„æ¯ä¸ªå…ƒç´  = 1ä¸ªå•é“¾è¡¨transient int size;// HashMapçš„å¤§å°ï¼Œå³ HashMapä¸­å­˜å‚¨çš„é”®å€¼å¯¹çš„æ•°é‡ /** * ä¸Žçº¢é»‘æ ‘ç›¸å…³çš„å‚æ•° */ // 1. æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼šå³ é“¾è¡¨è½¬æˆçº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œå½“é“¾è¡¨é•¿åº¦ &gt; è¯¥å€¼æ—¶ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ static final int TREEIFY_THRESHOLD = 8; // 2. æ¡¶çš„é“¾è¡¨è¿˜åŽŸé˜ˆå€¼ï¼šå³ çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨çš„é˜ˆå€¼ï¼Œå½“åœ¨æ‰©å®¹ï¼ˆresizeï¼ˆï¼‰ï¼‰æ—¶ï¼ˆæ­¤æ—¶HashMapçš„æ•°æ®å­˜å‚¨ä½ç½®ä¼šé‡æ–°è®¡ç®—ï¼‰ï¼Œåœ¨é‡æ–°è®¡ç®—å­˜å‚¨ä½ç½®åŽï¼Œå½“åŽŸæœ‰çš„çº¢é»‘æ ‘å†…æ•°é‡ &lt; 6æ—¶ï¼Œåˆ™å°† çº¢é»‘æ ‘è½¬æ¢æˆé“¾è¡¨ static final int UNTREEIFY_THRESHOLD = 6; // 3. æœ€å°æ ‘å½¢åŒ–å®¹é‡é˜ˆå€¼ï¼šå³ å½“å“ˆå¸Œè¡¨ä¸­çš„å®¹é‡ &gt; è¯¥å€¼æ—¶ï¼Œæ‰å…è®¸æ ‘å½¢åŒ–é“¾è¡¨ ï¼ˆå³ å°†é“¾è¡¨ è½¬æ¢æˆçº¢é»‘æ ‘ï¼‰ // å¦åˆ™ï¼Œè‹¥æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ï¼Œåˆ™ç›´æŽ¥æ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– // ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äºŽ 4 * TREEIFY_THRESHOLD static final int MIN_TREEIFY_CAPACITY = 64; æž„é€ å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * æºç åˆ†æžï¼šä¸»è¦æ˜¯HashMapçš„æž„é€ å‡½æ•° = 4ä¸ª * ä»…è´´å‡ºå…³äºŽHashMapæž„é€ å‡½æ•°çš„æºç  */public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable&#123; // çœç•¥ä¸ŠèŠ‚é˜è¿°çš„å‚æ•° /** * æž„é€ å‡½æ•°1ï¼šé»˜è®¤æž„é€ å‡½æ•°ï¼ˆæ— å‚ï¼‰ * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ = 0.75ã€16 */ public HashMap() &#123; this.loadFactor = DEFAULT_LOAD_FACTOR; &#125; /** * æž„é€ å‡½æ•°2ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æž„é€ å‡½æ•° * åŠ è½½å› å­ = é»˜è®¤ = 0.75 ã€å®¹é‡ = æŒ‡å®šå¤§å° */ public HashMap(int initialCapacity) &#123; // å®žé™…ä¸Šæ˜¯è°ƒç”¨æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æž„é€ å‡½æ•° // åªæ˜¯åœ¨ä¼ å…¥çš„åŠ è½½å› å­å‚æ•° = é»˜è®¤åŠ è½½å› å­ this(initialCapacity, DEFAULT_LOAD_FACTOR); &#125; /** * æž„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æž„é€ å‡½æ•° * åŠ è½½å› å­ &amp; å®¹é‡ = è‡ªå·±æŒ‡å®š */ public HashMap(int initialCapacity, float loadFactor) &#123; // æŒ‡å®šåˆå§‹å®¹é‡å¿…é¡»éžè´Ÿï¼Œå¦åˆ™æŠ¥é”™ if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); // HashMapçš„æœ€å¤§å®¹é‡åªèƒ½æ˜¯MAXIMUM_CAPACITYï¼Œå“ªæ€•ä¼ å…¥çš„ &gt; æœ€å¤§å®¹é‡ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; // å¡«å……æ¯”å¿…é¡»ä¸ºæ­£ if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); // è®¾ç½® åŠ è½½å› å­ this.loadFactor = loadFactor; // è®¾ç½® æ‰©å®¹é˜ˆå€¼ // æ³¨ï¼šæ­¤å¤„ä¸æ˜¯çœŸæ­£çš„é˜ˆå€¼ï¼Œä»…ä»…åªæ˜¯å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„å¹‚ï¼Œè¯¥é˜ˆå€¼åŽé¢ä¼šé‡æ–°è®¡ç®— this.threshold = tableSizeFor(initialCapacity); &#125; /** * æž„é€ å‡½æ•°4ï¼šåŒ…å«â€œå­Mapâ€çš„æž„é€ å‡½æ•° * å³ æž„é€ å‡ºæ¥çš„HashMapåŒ…å«ä¼ å…¥Mapçš„æ˜ å°„å…³ç³» * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ */ public HashMap(Map&lt;? extends K, ? extends V&gt; m) &#123; // è®¾ç½®å®¹é‡å¤§å° &amp; åŠ è½½å› å­ = é»˜è®¤ this.loadFactor = DEFAULT_LOAD_FACTOR; // å°†ä¼ å…¥çš„å­Mapä¸­çš„å…¨éƒ¨å…ƒç´ é€ä¸ªæ·»åŠ åˆ°HashMapä¸­ putMapEntries(m, false); &#125;&#125;/** * å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„å¹‚ * ä¸ŽJDK 1.7å¯¹æ¯”ï¼šç±»ä¼¼äºŽJDK 1.7 ä¸­ inflateTable()é‡Œçš„ roundUpToPowerOf2(toSize) */static final int tableSizeFor(int cap) &#123; int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;&#125; putæ“ä½œ 12345678/** * æºç åˆ†æžï¼šä¸»è¦åˆ†æžHashMapçš„putå‡½æ•° */public V put(K key, V value) &#123; // 1. å¯¹ä¼ å…¥æ•°ç»„çš„é”®Keyè®¡ç®—Hashå€¼ // 2. å†è°ƒç”¨putValï¼ˆï¼‰æ·»åŠ æ•°æ®è¿›åŽ» return putVal(hash(key), key, value, false, true);&#125; hash--è®¡ç®—Hashå€¼ 1234567891011121314151617/** * hash(key) * ä½œç”¨ï¼šè®¡ç®—ä¼ å…¥æ•°æ®çš„å“ˆå¸Œç ï¼ˆå“ˆå¸Œå€¼ã€Hashå€¼ï¼‰ * è¯¥å‡½æ•°åœ¨JDK 1.7 å’Œ 1.8 ä¸­çš„å®žçŽ°ä¸åŒï¼Œä½†åŽŸç†ä¸€æ · = æ‰°åŠ¨å‡½æ•° = ä½¿å¾—æ ¹æ®keyç”Ÿæˆçš„å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰åˆ†å¸ƒæ›´åŠ å‡åŒ€ã€æ›´å…·å¤‡éšæœºæ€§ï¼Œé¿å…å‡ºçŽ°hashå€¼å†²çªï¼ˆå³æŒ‡ä¸åŒkeyä½†ç”ŸæˆåŒ1ä¸ªhashå€¼ï¼‰ * JDK 1.7 åšäº†9æ¬¡æ‰°åŠ¨å¤„ç† = 4æ¬¡ä½è¿ç®— + 5æ¬¡å¼‚æˆ–è¿ç®— * JDK 1.8 ç®€åŒ–äº†æ‰°åŠ¨å‡½æ•° = åªåšäº†2æ¬¡æ‰°åŠ¨ = 1æ¬¡ä½è¿ç®— + 1æ¬¡å¼‚æˆ–è¿ç®— */ // JDK 1.8å®žçŽ°ï¼šå°† é”®key è½¬æ¢æˆ å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰æ“ä½œ = ä½¿ç”¨hashCode() + 1æ¬¡ä½è¿ç®— + 1æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ2æ¬¡æ‰°åŠ¨ï¼‰ // 1. å–hashCodeå€¼ï¼š h = key.hashCode() // 2. é«˜ä½å‚ä¸Žä½Žä½çš„è¿ç®—ï¼šh ^ (h &gt;&gt;&gt; 16) static final int hash(Object key) &#123; int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); // a. å½“key = nullæ—¶ï¼Œhashå€¼ = 0ï¼Œæ‰€ä»¥HashMapçš„key å¯ä¸ºnull // æ³¨ï¼šå¯¹æ¯”HashTableï¼ŒHashTableå¯¹keyç›´æŽ¥hashCodeï¼ˆï¼‰ï¼Œè‹¥keyä¸ºnullæ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥HashTableçš„keyä¸å¯ä¸ºnull // b. å½“key â‰  nullæ—¶ï¼Œåˆ™é€šè¿‡å…ˆè®¡ç®—å‡º keyçš„ hashCode()ï¼ˆè®°ä¸ºhï¼‰ï¼Œç„¶åŽ å¯¹å“ˆå¸Œç è¿›è¡Œ æ‰°åŠ¨å¤„ç†ï¼š æŒ‰ä½ å¼‚æˆ–ï¼ˆ^ï¼‰ å“ˆå¸Œç è‡ªèº«å³ç§»16ä½åŽçš„äºŒè¿›åˆ¶ &#125; putVal--å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ ç”±äºŽæ•°æ®ç»“æž„ä¸­åŠ å…¥äº†çº¢é»‘æ ‘ï¼Œæ‰€ä»¥åœ¨å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ä¸­æ—¶ï¼Œéœ€è¿›è¡Œå¤šæ¬¡æ•°æ®ç»“æž„çš„åˆ¤æ–­ï¼šæ•°ç»„ã€çº¢é»‘æ ‘ã€é“¾è¡¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185 /** * å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ */final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // 1. è‹¥å“ˆå¸Œè¡¨çš„æ•°ç»„tabä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œåˆ™ é€šè¿‡resize() åˆ›å»º // æ‰€ä»¥ï¼Œåˆå§‹åŒ–å“ˆå¸Œè¡¨çš„æ—¶æœº = ç¬¬1æ¬¡è°ƒç”¨putå‡½æ•°æ—¶ï¼Œå³è°ƒç”¨resize() åˆå§‹åŒ–åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // 2. è®¡ç®—æ’å…¥å­˜å‚¨çš„æ•°ç»„ç´¢å¼•iï¼šæ ¹æ®é”®å€¼keyè®¡ç®—çš„hashå€¼ å¾—åˆ° // æ­¤å¤„çš„æ•°ç»„ä¸‹æ ‡è®¡ç®—æ–¹å¼ = i = (n - 1) &amp; hashï¼ŒåŒJDK 1.7ä¸­çš„indexForï¼ˆï¼‰ // 3. æ’å…¥æ—¶ï¼Œéœ€åˆ¤æ–­æ˜¯å¦å­˜åœ¨Hashå†²çªï¼š // è‹¥ä¸å­˜åœ¨ï¼ˆå³å½“å‰table[i] == nullï¼‰ï¼Œåˆ™ç›´æŽ¥åœ¨è¯¥æ•°ç»„ä½ç½®æ–°å»ºç»“ç‚¹ï¼Œæ’å…¥å®Œæ¯• // å¦åˆ™ï¼Œä»£è¡¨å­˜åœ¨Hashå†²çªï¼Œå³å½“å‰å­˜å‚¨ä½ç½®å·²å­˜åœ¨ç»“ç‚¹ï¼Œåˆ™ä¾æ¬¡å¾€ä¸‹åˆ¤æ–­ï¼š // a. å½“å‰ä½ç½®çš„keyæ˜¯å¦ä¸Žéœ€æ’å…¥çš„keyç›¸åŒã€ // b. åˆ¤æ–­éœ€æ’å…¥çš„æ•°æ®ç»“æž„æ˜¯å¦ä¸ºçº¢é»‘æ ‘ or é“¾è¡¨ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else &#123;//è¯´æ˜Žå¾…æ’å…¥ä½ç½®å­˜åœ¨å…ƒç´  Node&lt;K,V&gt; e; K k; // a. åˆ¤æ–­ table[i]çš„å…ƒç´ çš„keyæ˜¯å¦ä¸Ž éœ€æ’å…¥çš„keyä¸€æ ·ï¼Œè‹¥ç›¸åŒåˆ™ ç›´æŽ¥ç”¨æ–°value è¦†ç›– æ—§value // åˆ¤æ–­åŽŸåˆ™ï¼šequalsï¼ˆï¼‰ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) //å°†ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™eï¼Œç”¨eæ¥è®°å½• e = p; // b. ç»§ç»­åˆ¤æ–­ï¼šéœ€æ’å…¥çš„æ•°æ®ç»“æž„æ˜¯å¦ä¸ºçº¢é»‘æ ‘ or é“¾è¡¨ // è‹¥æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æŽ¥åœ¨æ ‘ä¸­æ’å…¥ or æ›´æ–°é”®å€¼å¯¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // è‹¥æ˜¯é“¾è¡¨,åˆ™åœ¨é“¾è¡¨ä¸­æ’å…¥ or æ›´æ–°é”®å€¼å¯¹ // i. éåŽ†table[i]ï¼Œåˆ¤æ–­Keyæ˜¯å¦å·²å­˜åœ¨ï¼šé‡‡ç”¨equalsï¼ˆï¼‰ å¯¹æ¯”å½“å‰éåŽ†ç»“ç‚¹çš„key ä¸Ž éœ€æ’å…¥æ•°æ®çš„keyï¼šè‹¥å·²å­˜åœ¨ï¼Œåˆ™ç›´æŽ¥ç”¨æ–°value è¦†ç›– æ—§value // ii. éåŽ†å®Œæ¯•åŽä»æ— å‘çŽ°ä¸Šè¿°æƒ…å†µï¼Œåˆ™ç›´æŽ¥åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥æ•°æ® // æ³¨ï¼šæ–°å¢žç»“ç‚¹åŽï¼Œéœ€åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦&gt;8ï¼ˆ8 = æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼‰ï¼šè‹¥æ˜¯ï¼Œåˆ™æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ else &#123; //åœ¨é“¾è¡¨æœ«å°¾æ’å…¥ç»“ç‚¹ for (int binCount = 0; ; ++binCount) &#123; // å¯¹äºŽiiï¼šè‹¥æ•°ç»„çš„ä¸‹1ä¸ªä½ç½®ï¼Œè¡¨ç¤ºå·²åˆ°è¡¨å°¾ä¹Ÿæ²¡æœ‰æ‰¾åˆ°keyå€¼ç›¸åŒç»“ç‚¹ï¼Œåˆ™æ–°å»ºç»“ç‚¹ = æ’å…¥ç»“ç‚¹ // æ³¨ï¼šæ­¤å¤„æ˜¯ä»Žé“¾è¡¨å°¾æ’å…¥ï¼Œä¸ŽJDK 1.7ä¸åŒï¼ˆä»Žé“¾è¡¨å¤´æ’å…¥ï¼Œå³æ°¸è¿œéƒ½æ˜¯æ·»åŠ åˆ°æ•°ç»„çš„ä½ç½®ï¼ŒåŽŸæ¥æ•°ç»„ä½ç½®çš„æ•°æ®åˆ™å¾€åŽç§»ï¼‰ if ((e = p.next) == null) &#123; p.next = newNode(hash, key, value, null); // æ’å…¥ç»“ç‚¹åŽï¼Œè‹¥é“¾è¡¨ç»“ç‚¹&gt;æ•°é˜ˆå€¼ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st //é“¾è¡¨è½¬çº¢é»‘æ ‘ treeifyBin(tab, hash); break; &#125; //éåŽ†table[i]ï¼Œåˆ¤æ–­Keyæ˜¯å¦å·²å­˜åœ¨ï¼šé‡‡ç”¨equalsï¼ˆï¼‰ å¯¹æ¯”å½“å‰éåŽ†ç»“ç‚¹çš„key ä¸Ž éœ€æ’å…¥æ•°æ®çš„key if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) //ç›¸ç­‰ï¼Œè·³å‡ºå¾ªçŽ¯ break; // æ›´æ–°pæŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œç»§ç»­éåŽ† p = e; &#125; &#125; //è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸Žæ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹ï¼Œç›´æŽ¥ç”¨æ–°value è¦†ç›– æ—§value å¹¶ è¿”å›žæ—§value if (e != null) &#123; // existing mapping for key //è®°å½•eçš„value V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) //æ–°å€¼æ›¿æ¢æ—§å€¼ e.value = value; afterNodeAccess(e);// æ›¿æ¢æ—§å€¼æ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼ˆé»˜è®¤å®žçŽ°ä¸ºç©ºï¼‰ //è¿”å›žæ—§å€¼ return oldValue; &#125; &#125; ++modCount; // æ’å…¥æˆåŠŸåŽï¼Œåˆ¤æ–­å®žé™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡size &gt; æœ€å¤§å®¹é‡threshold // è‹¥ &gt; ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict);// æ’å…¥æˆåŠŸæ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼ˆé»˜è®¤å®žçŽ°ä¸ºç©ºï¼‰ return null;&#125;/** * å‘çº¢é»‘æ ‘æ’å…¥ or æ›´æ–°æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰ * è¿‡ç¨‹ï¼šéåŽ†çº¢é»‘æ ‘åˆ¤æ–­è¯¥ç»“ç‚¹çš„keyæ˜¯å¦ä¸Žéœ€æ’å…¥çš„key ç›¸åŒï¼š * a. è‹¥ç›¸åŒï¼Œåˆ™æ–°valueè¦†ç›–æ—§value * b. è‹¥ä¸ç›¸åŒï¼Œåˆ™æ’å…¥ */final TreeNode&lt;K,V&gt; putTreeVal(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, int h, K k, V v) &#123; Class&lt;?&gt; kc = null; boolean searched = false; TreeNode&lt;K,V&gt; root = (parent != null) ? root() : this; //ä»Žæ ¹ç»“ç‚¹å¼€å§‹æŸ¥æ‰¾åˆé€‚çš„æ’å…¥ä½ç½®ï¼ˆä¸ŽäºŒå‰æœç´¢æ ‘æŸ¥æ‰¾è¿‡ç¨‹ç›¸åŒï¼‰ for (TreeNode&lt;K,V&gt; p = root;;) &#123; int dir, ph; K pk; if ((ph = p.hash) &gt; h) dir = -1;//dirå°äºŽ0ï¼ŒæŽ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰ç»“ç‚¹çš„å·¦å­©å­ else if (ph &lt; h) dir = 1;//dirå¤§äºŽ0ï¼ŒæŽ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰ç»“ç‚¹çš„å³å­©å­ else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk))) //è¿™é‡Œä»£è¡¨hashå€¼ç›¸åŒï¼Œkeyç›¸åŒ return p; /** *è¦è¿›å…¥ä¸‹é¢è¿™ä¸ªelse if,ä»£è¡¨æœ‰ä»¥ä¸‹å‡ ä¸ªå«ä¹‰: *1ã€å½“å‰ç»“ç‚¹ä¸Žå¾…æ’å…¥ç»“ç‚¹ key ä¸åŒ, hash å€¼ç›¸åŒ; *2ã€ï½‹æ˜¯ä¸å¯æ¯”è¾ƒçš„ï¼Œå³ï½‹å¹¶æœªå®žçŽ° comparable&lt;K&gt; æŽ¥å£ * ï¼ˆè‹¥ k å®žçŽ°äº†comparable&lt;K&gt; æŽ¥å£ï¼ŒcomparableClassForï¼ˆkï¼‰è¿”å›žçš„æ˜¯ï½‹çš„ class,è€Œä¸æ˜¯ nullï¼‰ * æˆ–è€… compareComparables(kc, k, pk) è¿”å›žå€¼ä¸º 0 * (pk ä¸ºç©º æˆ–è€… æŒ‰ç…§ k.compareTo(pk) è¿”å›žå€¼ä¸ºï¼ï¼Œ * è¿”å›žå€¼ä¸ºï¼å¯èƒ½æ˜¯ç”±äºŽ ï½‹çš„compareTo æ–¹æ³•å®žçŽ°ä¸å½“å¼•èµ·çš„ï¼ŒcompareTo åˆ¤å®šç›¸ç­‰ï¼Œè€Œä¸Šä¸ª else if ä¸­ equals åˆ¤å®šä¸ç­‰) */ else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) &#123; //åœ¨ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„æ•´ä¸ªæ ‘ä¸Šæœç´¢æ˜¯å¦å­˜åœ¨å¾…æ’å…¥çš„ç»“ç‚¹ï¼ˆåªä¼šæœç´¢ä¸€æ¬¡ï¼‰ if (!searched) &#123; TreeNode&lt;K,V&gt; q, ch; searched = true; if (((ch = p.left) != null &amp;&amp; (q = ch.find(h, k, kc)) != null) || ((ch = p.right) != null &amp;&amp; (q = ch.find(h, k, kc)) != null)) return q; &#125; //å¦‚æžœä»æœªæ¯”è¾ƒå‡ºå¤§å°ï¼Œå°±éœ€è¦è¿›è¡Œä»²è£äº†ï¼Œä»²è£æ–¹æ³•ä¸º tieBreakOrder dir = tieBreakOrder(k, pk); &#125; TreeNode&lt;K,V&gt; xp = p; if ((p = (dir &lt;= 0) ? p.left : p.right) == null) &#123; //æ‰¾åˆ°äº†å¾…æ’å…¥çš„ä½ç½®ï¼Œxp ä¸ºå¾…æ’å…¥ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ //æ³¨æ„TreeNodeç»“ç‚¹ä¸­æ—¢å­˜åœ¨æ ‘çŠ¶å…³ç³»ï¼Œä¹Ÿå­˜åœ¨é“¾å¼å…³ç³»ï¼Œå¹¶ä¸”æ˜¯åŒç«¯é“¾è¡¨ Node&lt;K,V&gt; xpn = xp.next; TreeNode&lt;K,V&gt; x = map.newTreeNode(h, k, v, xpn); if (dir &lt;= 0) xp.left = x; else xp.right = x; xp.next = x; x.parent = x.prev = xp; if (xpn != null) ((TreeNode&lt;K,V&gt;)xpn).prev = x; //æ’å…¥ç»“ç‚¹åŽè¿›è¡ŒäºŒå‰æ ‘çš„å¹³è¡¡æ“ä½œ moveRootToFront(tab, balanceInsertion(root, x)); return null; &#125; &#125;&#125;/** * å°†æ™®é€šç»“ç‚¹é“¾è¡¨è½¬æ¢æˆæ ‘å½¢ç»“ç‚¹é“¾è¡¨ * æ ‘åŒ–è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š * 1. é“¾è¡¨é•¿åº¦å¤§äºŽç­‰äºŽ TREEIFY_THRESHOLD * 2. æ¡¶æ•°ç»„å®¹é‡å¤§äºŽç­‰äºŽ MIN_TREEIFY_CAPACITY * ç¬¬ä¸€ä¸ªæ¡ä»¶æ¯”è¾ƒå¥½ç†è§£ï¼ŒåŠ å…¥ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œä¸ªäººè§‰å¾—åŽŸå› å¦‚ä¸‹ï¼š * å½“æ¡¶æ•°ç»„å®¹é‡æ¯”è¾ƒå°æ—¶ï¼Œé”®å€¼å¯¹ç»“ç‚¹ hash çš„ç¢°æ’žçŽ‡å¯èƒ½ä¼šæ¯”è¾ƒé«˜ï¼Œè¿›è€Œå¯¼è‡´é“¾è¡¨é•¿åº¦è¾ƒé•¿ã€‚ * è¿™ä¸ªæ—¶å€™åº”è¯¥ä¼˜å…ˆæ‰©å®¹ï¼Œè€Œä¸æ˜¯ç«‹é©¬æ ‘åŒ–ã€‚æ¯•ç«Ÿé«˜ç¢°æ’žçŽ‡æ˜¯å› ä¸ºæ¡¶æ•°ç»„å®¹é‡è¾ƒå°å¼•èµ·çš„ï¼Œè¿™ä¸ªæ˜¯ä¸»å› ã€‚ * å®¹é‡å°æ—¶ï¼Œä¼˜å…ˆæ‰©å®¹å¯ä»¥é¿å…ä¸€äº›åˆ—çš„ä¸å¿…è¦çš„æ ‘åŒ–è¿‡ç¨‹ã€‚åŒæ—¶ï¼Œæ¡¶å®¹é‡è¾ƒå°æ—¶ï¼Œæ‰©å®¹ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œæ‰©å®¹æ—¶éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘å¹¶é‡æ–°æ˜ å°„ã€‚æ‰€ä»¥åœ¨æ¡¶å®¹é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå°†é•¿é“¾è¡¨è½¬æˆçº¢é»‘æ ‘æ˜¯ä¸€ä»¶åƒåŠ›ä¸è®¨å¥½çš„äº‹ã€‚ */final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) &#123; int n, index; Node&lt;K,V&gt; e; //// å¦‚æžœ tab.length å°äºŽ MIN_TREEIFY_CAPACITYï¼Œ ä¼˜å…ˆè¿›è¡Œæ‰©å®¹è€Œä¸æ˜¯æ ‘åŒ– if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) resize(); else if ((e = tab[index = (n - 1) &amp; hash]) != null) &#123; // hd ä¸ºå¤´ç»“ç‚¹ï¼ˆheadï¼‰ï¼Œtl ä¸ºå°¾ç»“ç‚¹ï¼ˆtailï¼‰ TreeNode&lt;K,V&gt; hd = null, tl = null; do &#123; // å°†æ™®é€šç»“ç‚¹æ›¿æ¢æˆæ ‘å½¢ç»“ç‚¹ TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else &#123; p.prev = tl; tl.next = p; &#125; tl = p; &#125; while ((e = e.next) != null);// å°†æ™®é€šé“¾è¡¨è½¬æˆç”±æ ‘å½¢ç»“ç‚¹é“¾è¡¨ if ((tab[index] = hd) != null) // å°†æ ‘å½¢é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ hd.treeify(tab); &#125;&#125; æµç¨‹å›¾å¦‚ä¸‹ï¼š resize--æ‰©å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185/** * æ‰©å®¹ * è¯¥å‡½æ•°æœ‰2ç§ä½¿ç”¨æƒ…å†µï¼š1.åˆå§‹åŒ–å“ˆå¸Œè¡¨ 2.å½“å‰æ•°ç»„å®¹é‡è¿‡å°ï¼Œéœ€æ‰©å®¹ */final Node&lt;K,V&gt;[] resize() &#123; //// æ‰©å®¹å‰çš„æ•°ç»„ï¼ˆå½“å‰æ•°ç»„ï¼‰ Node&lt;K,V&gt;[] oldTab = table; //// æ‰©å®¹å‰çš„æ•°ç»„çš„å®¹é‡ = é•¿åº¦ int oldCap = (oldTab == null) ? 0 : oldTab.length; //// æ‰©å®¹å‰çš„æ•°ç»„çš„é˜ˆå€¼ int oldThr = threshold; int newCap, newThr = 0; // å¦‚æžœ table ä¸ä¸ºç©ºï¼Œè¡¨æ˜Žå·²ç»åˆå§‹åŒ–è¿‡äº† if (oldCap &gt; 0) &#123; //è‹¥æ‰©å®¹å‰çš„æ•°ç»„å®¹é‡è¶…è¿‡æœ€å¤§å€¼ï¼Œåˆ™ä¸å†æ‰©å®¹ if (oldCap &gt;= MAXIMUM_CAPACITY) &#123; threshold = Integer.MAX_VALUE; return oldTab; &#125; //è‹¥æœªè¶…è¿‡æœ€å¤§å€¼ï¼Œåˆ™æ‰©å®¹ä¸ºåŽŸæ¥çš„2å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold &#125; else if (oldThr &gt; 0) // initial capacity was placed in threshold /* * åˆå§‹åŒ–æ—¶ï¼Œå°† threshold çš„å€¼èµ‹å€¼ç»™ newCapï¼Œ * HashMap ä½¿ç”¨ threshold å˜é‡æš‚æ—¶ä¿å­˜ initialCapacity å‚æ•°çš„å€¼ */ newCap = oldThr; else &#123; /* * è°ƒç”¨æ— å‚æž„é€ æ–¹æ³•æ—¶ï¼Œæ¡¶æ•°ç»„å®¹é‡ä¸ºé»˜è®¤å®¹é‡ï¼Œ * é˜ˆå€¼ä¸ºé»˜è®¤å®¹é‡ä¸Žé»˜è®¤è´Ÿè½½å› å­ä¹˜ç§¯ */ newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); &#125; //è®¡ç®—æ–°çš„resizeä¸Šé™ if (newThr == 0) &#123; float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); &#125; threshold = newThr; @SuppressWarnings(&#123;"rawtypes","unchecked"&#125;) // åˆ›å»ºæ–°çš„æ¡¶æ•°ç»„ï¼Œæ¡¶æ•°ç»„çš„åˆå§‹åŒ–ä¹Ÿæ˜¯åœ¨è¿™é‡Œå®Œæˆçš„ Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) &#123; // æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­ for (int j = 0; j &lt; oldCap; ++j) &#123; Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) &#123; // æ¸…é™¤åŽŸæ¥table[i]ä¸­çš„å€¼ oldTab[j] = null; if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) //å¦‚æžœeæ˜¯çº¢é»‘æ ‘ç»“ç‚¹ï¼Œèµ°çº¢é»‘æ ‘æ›¿æ¢æ–¹å¼ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else &#123;// å¦‚æžœ table[j] åŽæ˜¯ä¸€ä¸ªé“¾è¡¨ ï¼Œå°†åŽŸé“¾è¡¨æ‹†åˆ†ä¸ºä¸¤æ¡é“¾ï¼Œåˆ†åˆ«æ”¾åˆ°newTabä¸­ Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do &#123; next = e.next; // åŽŸç´¢å¼•ï¼Œ(e.hash &amp; oldCap) == 0 è¯´æ˜Ž åœ¨putæ“ä½œé€šè¿‡ hash &amp; newThr //è®¡ç®—å‡ºçš„ç´¢å¼•å€¼ç­‰äºŽçŽ°åœ¨çš„ç´¢å¼•å€¼ã€‚ if ((e.hash &amp; oldCap) == 0) &#123; if (loTail == null) loHead = e; else loTail.next = e; loTail = e; &#125; // åŽŸç´¢å¼•+oldCapï¼Œä¸æ˜¯åŽŸç´¢å¼•ï¼Œå°±ç§»åŠ¨åŽŸæ¥çš„é•¿åº¦ else &#123; if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; &#125; &#125; while ((e = next) != null); //åŽŸç´¢å¼•æ”¾åˆ°bucketé‡Œ if (loTail != null) &#123; loTail.next = null; newTab[j] = loHead; &#125; // åŽŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ if (hiTail != null) &#123; hiTail.next = null; newTab[j + oldCap] = hiHead; &#125; &#125; &#125; &#125; &#125; return newTab;&#125;// çº¢é»‘æ ‘è½¬é“¾è¡¨é˜ˆå€¼static final int UNTREEIFY_THRESHOLD = 6;/** *è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ˜¯å¯¹çº¢é»‘æ ‘è¿›è¡Œrehash æ“ä½œ(æ‹†åˆ†çº¢é»‘æ ‘) * é‡æ–°æ˜ å°„çº¢é»‘æ ‘çš„é€»è¾‘å’Œé‡æ–°æ˜ å°„é“¾è¡¨çš„é€»è¾‘åŸºæœ¬ä¸€è‡´ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºŽï¼Œé‡æ–°æ˜ å°„åŽï¼Œä¼šå°†çº¢é»‘æ ‘æ‹†åˆ†æˆä¸¤æ¡ç”± TreeNode ç»„æˆçš„é“¾è¡¨ã€‚ * å¦‚æžœé“¾è¡¨é•¿åº¦å°äºŽ UNTREEIFY_THRESHOLDï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆæ™®é€šé“¾è¡¨ã€‚å¦åˆ™æ ¹æ®æ¡ä»¶é‡æ–°å°† TreeNode é“¾è¡¨æ ‘åŒ–ã€‚ */final void split(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, int index, int bit) &#123; TreeNode&lt;K,V&gt; b = this; // Relink into lo and hi lists, preserving order TreeNode&lt;K,V&gt; loHead = null, loTail = null; TreeNode&lt;K,V&gt; hiHead = null, hiTail = null; int lc = 0, hc = 0; //ç”±äºŽTreeNode ç»“ç‚¹ä¹‹é—´å­˜åœ¨åŒç«¯é“¾è¡¨çš„å…³ç³»ï¼Œå¯ä»¥åˆ©ç”¨é“¾è¡¨å…³ç³»è¿›è¡Œ rehash for (TreeNode&lt;K,V&gt; e = b, next; e != null; e = next) &#123; next = (TreeNode&lt;K,V&gt;)e.next; e.next = null; if ((e.hash &amp; bit) == 0) &#123; if ((e.prev = loTail) == null) loHead = e; else loTail.next = e; loTail = e; ++lc; &#125; else &#123; if ((e.prev = hiTail) == null) hiHead = e; else hiTail.next = e; hiTail = e; ++hc; &#125; &#125; // å¦‚æžœ loHead ä¸ä¸ºç©ºï¼Œä¸”é“¾è¡¨é•¿åº¦å°äºŽç­‰äºŽ 6ï¼Œåˆ™å°†çº¢é»‘æ ‘è½¬æˆé“¾è¡¨ if (loHead != null) &#123; if (lc &lt;= UNTREEIFY_THRESHOLD) tab[index] = loHead.untreeify(map); else &#123; tab[index] = loHead; /* * hiHead == null æ—¶ï¼Œè¡¨æ˜Žæ‰©å®¹åŽï¼Œ * æ‰€æœ‰ç»“ç‚¹ä»åœ¨åŽŸä½ç½®ï¼Œæ ‘ç»“æž„ä¸å˜ï¼Œæ— éœ€é‡æ–°æ ‘åŒ– */ if (hiHead != null) loHead.treeify(tab); &#125; &#125; // ä¸Žä¸Šé¢ç±»ä¼¼ if (hiHead != null) &#123; if (hc &lt;= UNTREEIFY_THRESHOLD) tab[index + bit] = hiHead.untreeify(map); else &#123; tab[index + bit] = hiHead; if (loHead != null) hiHead.treeify(tab); &#125; &#125;&#125;/** *çº¢é»‘æ ‘é“¾åŒ– */final Node&lt;K,V&gt; untreeify(HashMap&lt;K,V&gt; map) &#123; Node&lt;K,V&gt; hd = null, tl = null; // éåŽ† TreeNode é“¾è¡¨ï¼Œå¹¶ç”¨ Node æ›¿æ¢ for (Node&lt;K,V&gt; q = this; q != null; q = q.next) &#123; // æ›¿æ¢ç»“ç‚¹ç±»åž‹ Node&lt;K,V&gt; p = map.replacementNode(q, null); if (tl == null) hd = p; else tl.next = p; tl = p; &#125; return hd;&#125;Node&lt;K,V&gt; replacementNode(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next) &#123; return new Node&lt;&gt;(p.hash, p.key, p.value, next);&#125; æµç¨‹å¦‚ä¸‹ï¼š resize()æ–¹æ³•ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯é“¾è¡¨å’Œçº¢é»‘æ ‘çš„ rehash æ“ä½œï¼Œrehash çš„å®žçŽ°åŽŸç†å¦‚ä¸‹ï¼š åœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯æŠŠé•¿åº¦æ‰©ä¸ºåŽŸæ¥2å€ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŽŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŽŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åŽkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸Žé«˜ä½è¿ç®—ç»“æžœã€‚ å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åŽï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š å› æ­¤ï¼Œåœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œåªéœ€è¦çœ‹çœ‹åŽŸæ¥çš„hashå€¼æ–°å¢žçš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŽŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š è¿™ä¸ªç®—æ³•å¾ˆå·§å¦™ï¼Œæ—¢çœåŽ»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºŽæ–°å¢žçš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„ç»“ç‚¹åˆ†æ•£åˆ°æ–°çš„æ§½ä¸­äº†ã€‚ getæ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637/** *ä»ŽHashMapä¸­èŽ·å–æ•°æ® */public V get(Object key) &#123; Node&lt;K,V&gt; e; // 1. è®¡ç®—éœ€èŽ·å–æ•°æ®çš„hashå€¼ // 2. é€šè¿‡getNodeï¼ˆï¼‰èŽ·å–æ‰€æŸ¥è¯¢çš„æ•°æ® // 3. èŽ·å–åŽï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºç©º return (e = getNode(hash(key), key)) == null ? null : e.value;&#125;/** * èŽ·å–æ‰€è¦æŸ¥è¯¢çš„æ•°æ® */final Node&lt;K,V&gt; getNode(int hash, Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; // 1. è®¡ç®—å­˜æ”¾åœ¨æ•°ç»„tableä¸­çš„ä½ç½® if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) &#123; //æ ¹æ®å½“å‰ä¼ å…¥çš„hashå€¼ä»¥åŠå‚æ•°keyèŽ·å–ä¸€ä¸ªç»“ç‚¹å³ä¸ºfirst,å¦‚æžœåŒ¹é…çš„è¯è¿”å›žå¯¹åº”çš„valueå€¼ // a. å…ˆåœ¨æ•°ç»„ä¸­æ‰¾ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™ç›´æŽ¥è¿”å›ž if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // b. è‹¥æ•°ç»„ä¸­æ²¡æœ‰ï¼Œåˆ™åˆ°çº¢é»‘æ ‘ä¸­å¯»æ‰¾ if ((e = first.next) != null) &#123; if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // c. è‹¥çº¢é»‘æ ‘ä¸­ä¹Ÿæ²¡æœ‰ï¼Œåˆ™é€šè¿‡éåŽ†ï¼Œåˆ°é“¾è¡¨ä¸­å¯»æ‰¾ do &#123; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; &#125; while ((e = e.next) != null); &#125; &#125; return null;&#125; æµç¨‹å¦‚ä¸‹ï¼š HashMap Jdk1.7å’ŒJdk1.8çš„åŒºåˆ« æ•°æ®ç»“æž„ æ·»åŠ æ•°æ® èŽ·å–æ•°æ® æ‰©å®¹æœºåˆ¶ ConcurrentHashMap-Jdk1.7 æ•°æ®ç»“æž„ ConcurrentHashMapé‡‡ç”¨åˆ†æ®µé”çš„è®¾è®¡Segment + HashEntryçš„æ–¹å¼è¿›è¡Œå®žçŽ°ï¼Œé‡‡ç”¨tableæ•°ç»„ï¼‹å•å‘é“¾è¡¨çš„æ•°æ®ç»“æž„ï¼Œç»“æž„å¦‚ä¸‹ï¼š é‡è¦å±žæ€§ 1234567891011121314151617181920212223242526272829//é»˜è®¤ConcurrentHashMapçš„å¤§å°static final int DEFAULT_INITIAL_CAPACITY = 16;//é»˜è®¤åŠ è½½å› å­ï¼Œç”¨äºŽè¡¨ç¤ºsegmentä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°ä¸ŽHashEntry[]æ•°ç»„é•¿åº¦çš„æ¯”å€¼ã€‚å½“æŸä¸ªsegmentä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°è¶…è¿‡äº†HashEntry[]æ•°ç»„çš„é•¿åº¦ä¸Žè£…è½½å› å­çš„ä¹˜ç§¯æ—¶ï¼Œå°†è§¦å‘æ‰©å®¹æ“ä½œã€‚static final float DEFAULT_LOAD_FACTOR = 0.75f;//é»˜è®¤æ”¯æŒçš„æœ€å¤§å¹¶å‘æ•°ï¼Œè¯¥å€¼è¡¨ç¤ºsegment[]æ•°ç»„çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯é”çš„æ€»æ•°ã€‚static final int DEFAULT_CONCURRENCY_LEVEL = 16;//ConcurrentHashMapçš„æœ€å¤§å®¹é‡static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;//segmentåˆ†æ®µé”çš„åˆå§‹å®¹é‡ä¹Ÿæ˜¯æœ€å°å®¹é‡(å³segmentä¸­HashEntryçš„åˆå§‹å®¹é‡)static final int MIN_SEGMENT_TABLE_CAPACITY = 2;//æœ€å¤§segmentæ•°(segmentsæ•°ç»„çš„æœ€å¤§é•¿åº¦)static final int MAX_SEGMENTS = 1 &lt;&lt; 16; // slightly conservative//é‡è¯•åŠ é”æ¬¡æ•°ï¼šåœ¨æ‰§è¡Œsize()å’ŒcontainsValue(value)æ“ä½œæ—¶,ConcurrentHashMapçš„åšæ³•æ˜¯å…ˆå°è¯• RETRIES_BEFORE_LOCK æ¬¡( å³ï¼Œ2æ¬¡ )é€šè¿‡ä¸é”ä½segmentçš„æ–¹å¼æ¥ç»Ÿè®¡ã€æŸ¥è¯¢å„ä¸ªsegmentï¼Œå¦‚æžœ2æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®¹å™¨çš„modCountå‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™å†é‡‡ç”¨åŠ é”çš„æ–¹å¼æ¥æ“ä½œæ‰€æœ‰çš„segmentstatic final int RETRIES_BEFORE_LOCK = 2;//åˆ†æ®µé”çš„æŽ©ç ï¼Œç”¨æ¥è®¡ç®—keyæ‰€åœ¨çš„segmentåœ¨segmentsçš„æ•°ç»„ä¸‹æ ‡final int segmentMask;//åˆ†æ®µé”åç§»é‡,ç”¨æ¥æŸ¥æ‰¾segmentåœ¨å†…å­˜ä¸­çš„ä½ç½®final int segmentShift;//segmentæ•°ç»„ï¼ŒSegment ç±»ç»§æ‰¿äºŽ ReentrantLock ç±»ï¼Œä»Žè€Œä½¿å¾— Segment å¯¹è±¡èƒ½å……å½“é”çš„è§’è‰²ã€‚final Segment&lt;K,V&gt;[] segments; é‡è¦å¯¹è±¡ Segment Segment ç±»ç»§æ‰¿äºŽ ReentrantLock ç±»ï¼Œä»Žè€Œä½¿å¾— Segment å¯¹è±¡èƒ½å……å½“é”çš„è§’è‰²ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚æ¯ä¸ª Segment å¯¹è±¡ç»´æŠ¤å…¶åŒ…å«çš„è‹¥å¹²ä¸ªæ¡¶(å³ï¼ŒHashEntry[])ã€‚ 1234567891011121314151617181920212223242526272829static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable &#123; private static final long serialVersionUID = 2249069246763182397L; //æœ€å¤§è‡ªæ—‹æ¬¡æ•°ï¼Œè‹¥æ˜¯å•æ ¸åˆ™ä¸º1ï¼Œå¤šæ ¸åˆ™ä¸º64ã€‚è¯¥å­—æ®µç”¨äºŽscanAndLockForPutã€scanAndLockæ–¹æ³• static final int MAX_SCAN_RETRIES = Runtime.getRuntime().availableProcessors() &gt; 1 ? 64 : 1; /** * table æ˜¯ç”± HashEntry å¯¹è±¡ç»„æˆçš„æ•°ç»„ * å¦‚æžœæ•£åˆ—æ—¶å‘ç”Ÿç¢°æ’žï¼Œç¢°æ’žçš„ HashEntry å¯¹è±¡å°±ä»¥é“¾è¡¨çš„å½¢å¼é“¾æŽ¥æˆä¸€ä¸ªé“¾è¡¨ * table æ•°ç»„çš„å…ƒç´ ä»£è¡¨æ•£åˆ—æ˜ å°„è¡¨çš„ä¸€ä¸ªæ¡¶ * æ¯ä¸ª table å®ˆæŠ¤æ•´ä¸ª ConcurrentHashMap æ•°æ®æ€»æ•°çš„ä¸€éƒ¨åˆ† * å¦‚æžœå¹¶å‘çº§åˆ«ä¸º 16ï¼Œtable åˆ™ç»´æŠ¤ ConcurrentHashMap æ•°æ®æ€»æ•°çš„ 1/16 */ transient volatile HashEntry&lt;K,V&gt;[] table; //segmentä¸­HashEntryçš„æ€»æ•° transient int count; //segmentä¸­æ•°æ®è¢«æ›´æ–°çš„æ¬¡æ•° transient int modCount; //å…ƒç´ çš„é˜€å€¼ï¼Œå½“tableä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°è¶…è¿‡æœ¬å˜é‡å€¼æ—¶ï¼Œè§¦å‘tableçš„æ‰©å®¹ transient int threshold; //åŠ è½½å› å­ final float loadFactor; &#125; HashEntry HashEntryå°è£…äº†key-valueå¯¹ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ç»“æž„ï¼Œæ¯ä¸ªHashEntryç»“ç‚¹éƒ½ç»´æŠ¤ç€next HashEntryç»“ç‚¹çš„å¼•ç”¨ã€‚ 12345678910111213static final class HashEntry&lt;K,V&gt; &#123; final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.value = value; this.next = next; &#125;&#125; åˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334353637383940414243public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) &#123; if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); //ä¿è¯æœ€å¤§å¹¶å‘ä¸è¶…è¿‡MAX_SEGMENTS(1 &lt;&lt; 16) if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // Find power-of-two sizes best matching arguments int sshift = 0; int ssize = 1; //å¾ªçŽ¯åˆ¤æ–­ä¿è¯ssizeæ˜¯2çš„å¹‚(å³Segmentæ•°ç»„çš„é•¿åº¦) //å¾ªçŽ¯å®Œsshift = 4,ssize = 16 while (ssize &lt; concurrencyLevel) &#123; ++sshift; ssize &lt;&lt;= 1;//ssize = size &lt;&lt; 1 &#125; //segmentShiftæœ€åŽä¸º16 this.segmentShift = 32 - sshift; //segmentMaskæœ€åŽä¸º15 this.segmentMask = ssize - 1; //ConcurrentHashMapåˆå§‹å®¹é‡ä¸è¶…è¿‡MAXIMUM_CAPACITY(1 &lt;&lt; 30) if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; //æ ¹æ®ConcurrentHashMapæ€»å®¹é‡initialCapacityé™¤ä»¥Segments[]æ•°ç»„çš„é•¿åº¦å¾—åˆ°å•ä¸ªåˆ†æ®µé”segmentä¸­HashEntry[]çš„å¤§å° int c = initialCapacity / ssize; //ä¿è¯åˆ†æ®µé”segmentçš„æ€»å®¹é‡cä¸å°äºŽåˆå§‹çš„å®¹é‡ if (c * ssize &lt; initialCapacity) ++c; //capä¸ºSegments[]æ•°ç»„ä¸­åˆ†æ®µé”segmentçš„HashEntry[]çš„å¤§å°,ä¿è¯ä¸º2çš„å¹‚ int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // create segments and segments[0] //è®°ä½è¿™é‡Œâ˜… //åˆ›å»ºä¸€ä¸ªs0,ç„¶åŽåˆå§‹åŒ–åˆ°Segments[0]ä¸­ Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); //åˆ›å»ºSegments[]æ•°ç»„ Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss;&#125; æ ¹æ®ç”¨æˆ·åˆ›å»ºnew ConcurrentHashMap(....)æ—¶ï¼Œä¼ é€’çš„å€¼æˆ–è€…é»˜è®¤å€¼è¿›è¡ŒConcurrentHashMapçš„åˆå§‹åŒ–ã€‚ åˆ›å»ºä¸€ä¸ªSegments[]æ•°ç»„ï¼Œæœ€å¤§æ•°ç»„é•¿åº¦æ˜¯16ï¼Œä¸å¯ä»¥æ‰©å®¹ã€‚ Sement[i]çš„é»˜è®¤å¤§å°ä¸º2ï¼Œè´Ÿè½½å› å­ä¸º0.75ï¼Œå¾—å‡ºåˆå§‹é˜ˆå€¼ä¸º1.5ï¼Œä¹Ÿå°±æ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¼šè§¦å‘æ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªè¿›è¡Œä¸€æ¬¡æ‰©å®¹ã€‚ åˆå§‹åŒ–äº† Segment[0]ï¼Œå…¶ä»–ä½ç½®è¿˜æ˜¯nullã€‚ putæ“ä½œ 1234567891011121314151617public V put(K key, V value) &#123; Segment&lt;K,V&gt; s; //åˆ¤æ–­valueæ˜¯å¦ä¸ºnull,å¦‚æžœä¸ºnullåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ if (value == null) throw new NullPointerException(); //è®¡ç®—keyçš„HASHå€¼ int hash = hash(key); //æ— ç¬¦å·å³ç§»segmentShiftä½(é»˜è®¤16),ç„¶åŽ &amp; segmentMask(é»˜è®¤15)å¾—åˆ°segmentåœ¨å†…å­˜ä¸­çš„åœ°å€ int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; //åˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦ä¸ºnullï¼Œ if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) //å¦‚æžœèŽ·å–åˆ°çš„segmentä¸ºnull s = ensureSegment(j);//åˆå§‹åŒ–segment //å¦‚æžœä¸ºnullï¼Œåˆå§‹åŒ–è¯¥ä½ç½®segment[j]ï¼Œé€šè¿‡ensureSegment(j) s = ensureSegment(j); //è°ƒç”¨Segmentçš„putæ–¹æ³•å°†æ•°æ®æ’å…¥åˆ°HashEntryä¸­ return s.put(key, hash, value, false);&#125; æ ¹æ®hashå€¼èŽ·å–åˆ†æ®µé”segmentçš„å†…å­˜åœ°å€ï¼Œå¦‚æžœèŽ·å–åˆ°çš„segmentä¸ºnullï¼Œåˆ™åˆå§‹åŒ–ã€‚å¦åˆ™å°±æ˜¯æ”¾å€¼ã€‚æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š ensureSegment-åˆå§‹åŒ–segment 1234567891011121314151617181920212223242526272829303132private Segment&lt;K,V&gt; ensureSegment(int k) &#123; //æ‹¿åˆ°å½“å‰Segments[]æ•°ç»„ final Segment&lt;K,V&gt;[] ss = this.segments; //èŽ·å–kæ‰€åœ¨çš„segmentåœ¨å†…å­˜ä¸­çš„åç§»é‡ long u = (k &lt;&lt; SSHIFT) + SBASE; // raw offset Segment&lt;K,V&gt; seg; //èŽ·å–kæ‰€åœ¨çš„segmen,åˆ¤æ–­segmenæ˜¯å¦ä¸ºnull if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; //åˆå§‹åŒ–ä¸€ä¸ªsegmentç­‰äºŽSegments[0] //Segments[0]åœ¨åˆå§‹åŒ–ConcurrentHashMapæ—¶ï¼Œå·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªsegmentæ”¾åˆ°Segments[0]ã€‚ Segment&lt;K,V&gt; proto = ss[0]; // use segment 0 as prototype //ç„¶åŽå°±æ˜¯èŽ·å–Segments[0]ä¸­HashEntryæ•°ç»„çš„æ•°æ® int cap = proto.table.length; float lf = proto.loadFactor; int threshold = (int)(cap * lf); //åˆå§‹åŒ–ä¸€ä¸ªHashEntryæ•°ç»„,å¤§å°å’ŒSegments[0]ä¸­çš„HashEntryä¸€æ ·ã€‚ HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])new HashEntry[cap]; //å†æ¬¡èŽ·å–kæ‰€åœ¨çš„segment(é˜²æ­¢å…¶ä»–çº¿ç¨‹å·²ç»åˆå§‹åŒ–å¥½) if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; // recheck //å¦‚æžœè¿˜æ˜¯nullï¼Œåˆ›å»ºä¸€ä¸ªsegmentå¹¶é€šè¿‡casè®¾ç½®åˆ°å¯¹åº”çš„ä½ç½® Segment&lt;K,V&gt; s = new Segment&lt;K,V&gt;(lf, threshold, tab); // ä½¿ç”¨ while å¾ªçŽ¯ï¼Œå†…éƒ¨ç”¨ CASï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè®¾å€¼æˆ–å…¶ä»–çº¿ç¨‹æˆåŠŸè®¾å€¼åŽï¼Œé€€å‡º while ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) &#123; if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s)) break; &#125; &#125; &#125; return seg;&#125; æ ¹æ®kçš„hashå€¼ï¼ŒèŽ·å–segmentï¼Œå¦‚ä½•èŽ·å–ä¸åˆ°åˆ™å°±åˆå§‹åŒ–ä¸€ä¸ªå’ŒSegment[0]ä¸€æ ·å¤§å°çš„segmentã€‚å¹¶é€šè¿‡CASæ“ä½œï¼Œåˆå§‹åŒ–åˆ°Segments[]ä¸­ã€‚ put-æ”¾å€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253final V put(K key, int hash, V value, boolean onlyIfAbsent) &#123; //å°è¯•èŽ·å–segmentçš„é” //å¤±è´¥å°±é€šè¿‡è‡ªæ—‹åŽ»èŽ·å–é”,è¶…è¿‡è‡ªæ—‹æœ€å¤§æ¬¡æ•°æ—¶,å°±å°†æ“ä½œæ”¾å…¥åˆ°Locké”çš„é˜Ÿåˆ—ä¸­ HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; //èµ°åˆ°è¿™é‡Œçš„çº¿ç¨‹ä¸€å®šèŽ·å–åˆ°é”,æ²¡èŽ·å–åˆ°çš„éƒ½æ”¾åˆ°äº†Lockçš„é˜Ÿåˆ—ä¸­ try &#123; //æ‹¿åˆ°segmentä¸­çš„HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] tab = table; //å¾—åˆ°keyæ‰€åœ¨HashEntryæ•°ç»„çš„ä¸‹æ ‡ int index = (tab.length - 1) &amp; hash; //èŽ·å–keyæ‰€åœ¨çš„HashEntryæ•°ç»„æŸä¸ªä½ç½®çš„å¤´ç»“ç‚¹(HashEntryæ˜¯ä¸€ä¸ªæ•°ç»„åŠ é“¾è¡¨ç»“æž„) HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) &#123; if (e != null) &#123;//HashEntryå¤´ç»“ç‚¹ä¸ä¸ºnull K k; //æ‰¾åˆ°ä¼ å…¥çš„å€¼ if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123; oldValue = e.value; //æ˜¯å¦æ›¿æ¢value,é»˜è®¤æ›¿æ¢(æœ‰ä¸ªputIfAbsent(key,value)å°±æ˜¯ä¸æ›¿æ¢) if (!onlyIfAbsent) &#123; e.value = value; ++modCount; &#125; break; &#125; e = e.next; &#125; else &#123;//å¦‚æžœæ²¡æœ‰æ‰¾åˆ°æˆ–HashEntryå¤´ç»“ç‚¹ä¸ºnull //åˆ¤æ–­nodeæ˜¯å¦å·²ç»åˆå§‹åŒ–(è‡ªæ—‹èŽ·å–é”åšçš„è¿™äº›æ“ä½œ,è¿™ä¸ªnodeè¦ä¹ˆä¸ºnullè¦ä¹ˆå°±æ˜¯æ–°å»ºçš„HashEntry) if (node != null) node.setNext(first);//å¤´æ’æ³• else node = new HashEntry&lt;K,V&gt;(hash, key, value, first);//å¤´æ’æ³• int c = count + 1;//ä¿®æ”¹segmentçš„å…ƒç´ æ€»æ•° if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)//å¦‚æžœè¶…è¿‡segmentçš„é˜€å€¼å¹¶ä¸”segmentæ²¡æœ‰è¶…è¿‡æœ€å¤§å®¹é‡,rehash //æ‰©å®¹ rehash(node); else //æ›´æ–°HashEntryæ•°ç»„ï¼ŒæŠŠæ–°çš„ç»“ç‚¹æ”¾åœ¨tabçš„indexä¸Šé¢ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; &#125; &#125; &#125; finally &#123; unlock();//é‡Šæ”¾é” &#125; return oldValue;&#125; é¦–å…ˆæ˜¯å°è¯•èŽ·å–segmentçš„é”ï¼ŒèŽ·å–åˆ°å‘ä¸‹æ‰§è¡Œï¼ŒèŽ·å–ä¸åˆ°å°±é€šè¿‡è‡ªæ—‹æ“ä½œåŽ»èŽ·å–é”ã€‚æ‹¿åˆ°é”ä¹‹åŽï¼Œæ‰¾åˆ°kæ‰€åœ¨çš„HashEntryæ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åŽèŽ·å–å¤´ç»“ç‚¹ã€‚å‘ä¸‹éåŽ†å¤´ç»“ç‚¹ï¼ŒæŸ¥æ‰¾åˆ°å°±æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ï¼Œæ²¡æŸ¥æ‰¾åˆ°å°±æ–°å»ºä¸€ä¸ªHashEntryï¼Œé€šè¿‡å¤´æ’æ³•æ”¾å…¥HashEntryæ•°ç»„ï¼Œæœ€åŽæ›´æ–°HashEntryã€‚ scanAndLockForPut-èŽ·å–é” 1234567891011121314151617181920212223242526272829private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) &#123; //èŽ·å–kæ‰€åœ¨çš„segmentä¸­çš„HashEntryçš„å¤´ç»“ç‚¹(segmentä¸­æ”¾å¾—æ˜¯HashEntryæ•°ç»„,HashEntryåˆæ˜¯ä¸ªé“¾è¡¨ç»“æž„) HashEntry&lt;K,V&gt; first = entryForHash(this, hash); HashEntry&lt;K,V&gt; e = first; HashEntry&lt;K,V&gt; node = null; int retries = -1; // negative while locating node while (!tryLock()) &#123;//å°è¯•èŽ·å–kæ‰€åœ¨segmentçš„é”ã€‚æˆåŠŸå°±ç›´æŽ¥è¿”å›žã€å¤±è´¥è¿›å…¥whileå¾ªçŽ¯è¿›è¡Œè‡ªæ—‹å°è¯•èŽ·å–é” HashEntry&lt;K,V&gt; f; // to recheck first below if (retries &lt; 0) &#123; if (e == null) &#123;//æ‰€åœ¨HashEntryé“¾è¡¨ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®ä¼ è¿‡æ¥çš„key-valueåˆ›å»ºä¸€ä¸ªHashEntry if (node == null) // speculatively create node //åˆå§‹åŒ–node node = new HashEntry&lt;K,V&gt;(hash, key, value, null); retries = 0; &#125; else if (key.equals(e.key))//æ‰¾åˆ°è¦æ”¾å¾—å€¼,åˆ™è®¾ç½®segmenté‡è¯•æ¬¡æ•°ä¸º0 retries = 0; else //ä»Žå¤´ç»“ç‚¹å¾€ä¸‹å¯»æ‰¾keyå¯¹åº”çš„HashEntry e = e.next; &#125; else if (++retries &gt; MAX_SCAN_RETRIES) &#123;//è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°å°±å°†å½“å‰æ“ä½œæ”¾å…¥åˆ°Lockçš„é˜Ÿåˆ—ä¸­ï¼Œæ”¹ä¸ºé˜»å¡žé”èŽ·å–ï¼Œä¿è¯èƒ½èŽ·å–æˆåŠŸ lock(); break; &#125; else if ((retries &amp; 1) == 0 &amp;&amp; (f = entryForHash(this, hash)) != first) &#123;//å¦‚æžœretriesä¸ºå¶æ•°,å°±é‡æ–°èŽ·å–HashEntryé“¾è¡¨çš„å¤´ç»“ç‚¹ e = first = f; // re-traverse if entry changed retries = -1; &#125; &#125; return node;&#125; æ‹¿åˆ°kæ‰€åœ¨çš„segmentçš„HashEntryçš„å¤´ç»“ç‚¹(æƒ³æƒ³segmentä¸­çš„æ•°æ®ç»“æž„)ï¼Œé¦–å…ˆå°è¯•èŽ·å–segmentçš„é”ã€‚ èŽ·å–å¤±è´¥ å¦‚æžœå¤´ç»“ç‚¹æ˜¯ä¸ºnullï¼Œåˆ™å°†ä¼ è¿›æ¥çš„key-valueæ–°å»ºä¸€ä¸ªHashEntry,åŒæ—¶è®¾ç½®retriesä¸º0,ä»Žè€Œå†æ¬¡åŽ»å°è¯•èŽ·å–segmentçš„é”ï¼› å¦‚æžœå¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´ç»“ç‚¹çš„key == ä¼ è¿›æ¥çš„key,è®¾ç½®retriesä¸º0,ä»Žè€Œå†æ¬¡åŽ»å°è¯•èŽ·å–segmentçš„é”ï¼› å¦‚æžœå¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´ç»“ç‚¹çš„key != ä¼ è¿›æ¥çš„key åˆ™èŽ·å–å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹,å†æ¬¡å°è¯•èŽ·å–segmentçš„é”ï¼› å¦‚æžœretries &gt; MAX_SCAN_RETRIES åˆ™è°ƒç”¨reentrantlockçš„lockæ–¹æ³•,å°†å½“å‰æ“ä½œæ”¾å…¥åˆ°locké˜Ÿåˆ—ä¸­.è·³å‡ºwhileå¾ªçŽ¯ï¼› å¦‚æžœretriesä¸ºå¶æ•°,åˆ™å†æ¬¡èŽ·å–å¯¹åº”segmentçš„å¤´ç»“ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–ï¼Œæœ‰å°±é‡æ–°èŽ·å–å¤´ç»“ç‚¹ï¼› èŽ·å–æˆåŠŸï¼šç›´æŽ¥è¿”å›žnull rehash-æ‰©å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778private void rehash(HashEntry&lt;K,V&gt; node) &#123;//nodeä¸ºå¾…æ–°åŠ å…¥çš„ç»“ç‚¹ //èŽ·å–å½“å‰segmentçš„HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] oldTable = table; //èŽ·å–åŽŸHashEntryæ•°ç»„çš„é•¿åº¦ int oldCapacity = oldTable.length; //æ–°HashEntryæ•°ç»„çš„é•¿åº¦ = åŽŸHashEntryæ•°ç»„é•¿åº¦*2 int newCapacity = oldCapacity &lt;&lt; 1; //é‡æ–°è®¡ç®—æ–°HashEntryæ•°ç»„çš„é˜€å€¼ threshold = (int)(newCapacity * loadFactor); //åˆ›å»ºæ–°HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; //æ–°HashEntryæ•°ç»„çš„æŽ©ç (ç”¨æ¥è®¡ç®—å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½ç½®) int sizeMask = newCapacity - 1; //éåŽ†åŽŸHashEntryæ•°ç»„ä¸­çš„å…ƒç´ (segmentä¸­æ˜¯ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œç»“æž„æ˜¯æ•°ç»„åŠ é“¾è¡¨) for (int i = 0; i &lt; oldCapacity ; i++) &#123; //èŽ·å–åŽŸHashEntry[i]ä½ç½®çš„å¤´ç»“ç‚¹HashEntry HashEntry&lt;K,V&gt; e = oldTable[i]; //åˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦ä¸ºç©º if (e != null) &#123; //èŽ·å–å½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ HashEntry&lt;K,V&gt; next = e.next; //é‡æ–°è®¡ç®—å½“å‰ç»“ç‚¹åœ¨æ–°HashEntryæ•°ç»„ä¸­çš„ä¸‹æ ‡ int idx = e.hash &amp; sizeMask; //å¦‚æžœä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºç©ºï¼Œåˆ™åŽŸHashEntryæ•°ç»„è¿™ä¸ªä½ç½®å°±ä¸€ä¸ªå…ƒç´ ï¼Œç›´æŽ¥æ”¾åˆ°æ–°HashEntryæ•°ç»„å°±è¡Œ if (next == null) // Single node on list newTable[idx] = e; //ä¸‹ä¸ªç»“ç‚¹ä¸ä¸ºç©º else &#123; // Reuse consecutive sequence at same slot //è¿™é‡Œå°±æ˜¯æ‰¾åˆ°æŸä¸ªç»“ç‚¹ï¼Œä»Žè¿™ä¸ªç»“ç‚¹å¾€ä¸‹ï¼Œéƒ½ä¼šåœ¨æ–°æ•°ç»„çš„æŸä¸ªåæ ‡ä¸‹ï¼Œå½¢æˆæ–°çš„é“¾è¡¨ //åŽŸ: //HashEntry:[0] [1]... //é‡Œé¢çš„å€¼: 1 // 2 // 3 // 4 // 5 // 6 //æ–°: //HashEntry:[0] [1]... //é‡Œé¢çš„å€¼: 4 // 5 // 6 //è¿™é‡Œæœ€åŽlastRunå°±æ˜¯4 ,idxå°±æ˜¯æ–°æ•°ç»„çš„ä¸‹æ ‡0 HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; //æ‰¾åˆ°ç¬¬ä¸€ä¸ªåŽç»­ç»“ç‚¹æ–°çš„indexä¸å˜çš„ç»“ç‚¹ for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) &#123; int k = last.hash &amp; sizeMask; if (k != lastIdx) &#123; lastIdx = k; lastRun = last; &#125; &#125; //ç„¶åŽæŠŠ4ç»“ç‚¹æ”¾åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™æ ·4,5,6å°±éƒ½è¿‡åŽ»äº† newTable[lastIdx] = lastRun; // Clone remaining nodes //å‰©ä¸‹çš„å°±æ˜¯è§£å†³1,2,3äº†,éåŽ†åŽŸHashEntryæ•°ç»„,ç›´åˆ°ç­‰äºŽ4ä¸ºæ­¢ //è¿™äº›ç»“ç‚¹é‡‡ç”¨å¤´æ’æ³•æ”¾åˆ°æ–°HashEntryæ•°ç»„ä¸­ for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) &#123; V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k];//å¤´æ’æ³• newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); &#125; &#125; &#125; &#125; //å°†å¾…æ–°åŠ å…¥çš„å…ƒç´ æ”¾åˆ°æ–°æ•°ç»„(å¤´æ’æ³•) int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; //segmentçš„æ•°ç»„æŒ‡åˆ°æ–°æ•°ç»„ table = newTable;&#125; åŽŸHashEntryæ•°ç»„æ‰©å¤§ä¸€å€ï¼Œç„¶åŽéåŽ†åŽŸHashEntryæ•°ç»„ï¼Œæ‰¾åˆ°æŸä¸ªç»“ç‚¹lastRunï¼Œä»Žè¿™ä¸ªç»“ç‚¹å¼€å§‹å¾€ä¸‹ï¼Œéƒ½ä¼šæ”¾åˆ°æ–°HashEntryæ•°ç»„çš„æŸä¸ªæ§½ä¸‹é¢ã€‚æŽ¥ä¸‹æ¥å°±æ˜¯éåŽ†å‰©ä¸‹çš„æ•°æ®ï¼Œç„¶åŽé‡‡ç”¨å¤´æ’æ³•ï¼Œæ”¾åˆ°æ–°æ•°ç»„ä¸­ã€‚æœ€åŽå°±æ˜¯å°†å¾…æ–°åŠ äººçš„ç»“ç‚¹ï¼Œæ”¾åˆ°æ–°æ•°ç»„ä¸­ã€‚ getæ“ä½œ 123456789101112131415161718192021public V get(Object key) &#123; Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; //keyçš„hashå€¼ int h = hash(key); //è®¡ç®—å‡ºkæ‰€åœ¨çš„segmentæ‰€åœ¨çš„å†…å­˜åœ°å€ long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; //é€šè¿‡CASæ“ä½œèŽ·å–segment,åˆ¤æ–­éƒ½ä¸ä¸ºnull if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) &#123; //å†é€šè¿‡CASæ“ä½œï¼ŒèŽ·å–çš„keyæ‰€åœ¨çš„HashEntry[]æ•°ç»„çš„ä¸‹æ ‡ï¼ŒèŽ·å–åˆ°å°±è¿”å›žï¼Œæ²¡æœ‰å°±è¿”å›žnull for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) &#123; K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; &#125; &#125; return null;&#125; è®¡ç®— hash å€¼ï¼Œæ‰¾åˆ° segment æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®,ä½¿ç”¨UnsafeèŽ·å–å¯¹åº”çš„Segment,æ ¹æ® hash æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ä½ç½®,ä»Žé“¾è¡¨å¤´å¼€å§‹éåŽ†æ•´ä¸ªé“¾è¡¨ï¼ˆå› ä¸ºHashå¯èƒ½ä¼šæœ‰ç¢°æ’žï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªé“¾è¡¨ä¿å­˜ï¼‰ï¼Œå¦‚æžœæ‰¾åˆ°å¯¹åº”çš„keyï¼Œåˆ™è¿”å›žå¯¹åº”çš„valueå€¼ï¼Œå¦åˆ™è¿”å›žnullã€‚ &lt;font color=&quot;red&quot;&gt;æ³¨ï¼šgetæ“ä½œä¸éœ€è¦é”ï¼Œç”±äºŽå…¶ä¸­æ¶‰åŠåˆ°çš„å…±äº«å˜é‡éƒ½ä½¿ç”¨volatileä¿®é¥°ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥ä¸ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®ã€‚&lt;/font&gt; removeæ“ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public V remove(Object key) &#123; int hash = hash(key); //keyçš„hashå€¼ï¼ŒèŽ·å–segment Segment&lt;K,V&gt; s = segmentForHash(hash); return s == null ? null : s.remove(key, hash, null);&#125;final V remove(Object key, int hash, Object value) &#123; //å°è¯•èŽ·å–segmenté” if (!tryLock()) //å¤±è´¥å°±è‡ªæ—‹ scanAndLock(key, hash); //æ‰§è¡Œåˆ°è¿™é‡Œä¸€å®šèŽ·å–äº†segmenté” V oldValue = null; try &#123; //èŽ·å–segmentçš„HashEntry[]æ•°ç»„ //èŽ·å–keyæ‰€åœ¨çš„ä¸‹æ ‡ï¼Œç„¶åŽèŽ·å–å¤´ç»“ç‚¹ HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; e = entryAt(tab, index); HashEntry&lt;K,V&gt; pred = null; while (e != null) &#123; K k; HashEntry&lt;K,V&gt; next = e.next; //åˆ¤æ–­å½“å‰ç»“ç‚¹eæ˜¯ä¸æ˜¯è¦åˆ é™¤çš„æ•°æ® if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) &#123;//keyç›¸åŒ V v = e.value; //å¦‚æžœæ²¡æœ‰ä¼ valueï¼Œæˆ–è€…valueç›¸åŒ if (value == null || value == v || value.equals(v)) &#123; if (pred == null)//è¦åˆ é™¤ç»“ç‚¹çš„å‰ä¸€ä¸ªç»“ç‚¹ä¸ºnull setEntryAt(tab, index, next);//ç›´æŽ¥èµ‹å€¼ else pred.setNext(next);//ç›´æŽ¥å°†å½“å‰ç»“ç‚¹çš„å‰ä¸€ä¸ªç»“ç‚¹çš„nextè®¾ç½®æˆå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ ++modCount; --count; oldValue = v; &#125; break; &#125; //å‰ç»“ç‚¹ä¸æ˜¯è¦æ‰¾çš„ç»“ç‚¹,éåŽ†ä¸‹ä¸€ä¸ª pred = e; e = next; &#125; &#125; finally &#123; unlock(); &#125; return oldValue;&#125; æ‰¾åˆ°keyæ‰€åœ¨HashEntry[]æ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åŽéåŽ†é“¾è¡¨ï¼Œæ‰¾åˆ°ç»“ç‚¹ã€‚å°†å½“å‰ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹çš„nextè®¾ç½®æˆå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ sizeæ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public int size() &#123; final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // // æ˜¯å¦æº¢å‡º long sum; // å­˜å‚¨æœ¬æ¬¡å¾ªçŽ¯è¿‡ç¨‹ä¸­è®¡ç®—å¾—åˆ°çš„modCountçš„å€¼ long last = 0L; // å­˜å‚¨ä¸Šä¸€æ¬¡éåŽ†è¿‡ç¨‹ä¸­è®¡ç®—å¾—åˆ°çš„modCountçš„å’Œ int retries = -1; // first iteration isn't retry try &#123; for (;;) &#123; //åˆ¤æ–­retriesæ˜¯å¦ç­‰äºŽRETRIES_BEFORE_LOCK(å€¼ä¸º2) //ä¹Ÿå°±æ˜¯é»˜è®¤æœ‰ä¸¤æ¬¡çš„æœºä¼šï¼Œæ˜¯ä¸åŠ é”æ¥æ±‚sizeçš„ if (retries++ == RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation &#125; sum = 0L; size = 0; overflow = false; //éåŽ†Segments[]æ•°ç»„èŽ·å–é‡Œé¢çš„æ¯ä¸€ä¸ªsegmentï¼Œç„¶åŽå¯¹modCountè¿›è¡Œæ±‚å’Œ //è¿™ä¸ªforåµŒå¥—åœ¨for(;;)ä¸­ï¼Œé»˜è®¤ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå¦‚æžœä¸¤æ¬¡å€¼ç›¸åŒï¼Œå°±è¿”å›ž //å¦‚æžœä¸¤æ¬¡å€¼ä¸åŒï¼Œå°±è¿›å…¥åˆ°ä¸Šé¢çš„ifä¸­ï¼Œè¿›è¡ŒåŠ é”ã€‚ä¹‹åŽåœ¨è¿›è¡Œæ±‚å’Œ for (int j = 0; j &lt; segments.length; ++j) &#123; Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) &#123; sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; &#125; &#125; if (sum == last) break; last = sum; &#125; &#125; finally &#123; //ç”±äºŽåªæœ‰åœ¨retriesç­‰äºŽRETRIES_BEFORE_LOCKæ—¶æ‰ä¼šæ‰§è¡Œå¼ºåˆ¶åŠ é”ï¼Œå¹¶ä¸”ç”±äºŽæ˜¯ç”¨çš„retries++ï¼Œ //æ‰€ä»¥å¼ºåˆ¶åŠ é”å®Œæ¯•åŽï¼Œretriesçš„å€¼æ˜¯ä¸€å®šä¼šå¤§äºŽRETRIES_BEFORE_LOCKçš„ï¼Œ //è¿™æ ·å°±é˜²æ­¢æ­£å¸¸éåŽ†è€Œæ²¡è¿›è¡ŒåŠ é”æ—¶è¿›è¡Œé”é‡Šæ”¾çš„æƒ…å†µ if (retries &gt; RETRIES_BEFORE_LOCK) &#123; for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); &#125; &#125; return overflow ? Integer.MAX_VALUE : size;&#125; å…ˆå°è¯•RETRIES_BEFORE_LOCKæ¬¡( å³2æ¬¡ )ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œå°†segment[]æ•°ç»„ä¸­æ¯ä¸ªsegmentçš„countç´¯åŠ ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†æ¯ä¸ªsegmentçš„modCountè¿›è¡Œç´¯åŠ ã€‚å¦‚æžœä¸¤æ¬¡ä¸åŠ é”çš„æ“ä½œåŽï¼ŒmodCountSumå€¼æ˜¯ä¸€æ ·çš„ï¼Œè¿™è¯´æ˜Žåœ¨è¿™ä¸¤æ¬¡ç´¯åŠ segmentcountçš„è¿‡ç¨‹ä¸­ConcurrentHashMapæ²¡æœ‰å‘ç”Ÿç»“æž„æ€§å˜åŒ–ï¼Œé‚£ä¹ˆå°±ç›´æŽ¥è¿”å›žç´¯åŠ çš„countå€¼; å¦‚æžœåœ¨ä¸¤æ¬¡ç´¯åŠ segmentçš„countæ“ä½œæœŸé—´ConcurrentHashMapå‘ç”Ÿäº†ç»“æž„æ€§æ”¹å˜ï¼Œåˆ™ä¼šé€šè¿‡å°†æ‰€æœ‰çš„segmentéƒ½åŠ é”ï¼Œç„¶åŽé‡æ–°è¿›è¡Œcountçš„ç´¯åŠ æ“ä½œã€‚åœ¨å®Œæˆcountçš„ç´¯åŠ æ“ä½œåŽï¼Œé‡Šæ”¾æ‰€æœ‰çš„é”ã€‚æœ€åŽè¿”å›žç´¯åŠ çš„countå€¼ã€‚ å¦‚æžœç´¯åŠ çš„countå€¼å¤§äºŽäº†Integer.MAX_VALUEï¼Œåˆ™è¿”å›žInteger.MAX_VALUEã€‚ ConcurrentHashMap-Jdk1.8 æ•°æ®ç»“æž„ Java7ä¸­ConcurrentHashMapæ˜¯é‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨çš„æ•°æ®ç»“æž„ã€‚è¦çŸ¥é“é“¾è¡¨çš„æŸ¥æ‰¾æ•ˆçŽ‡æ˜¯ä½Žä¸‹çš„ï¼Œå…¶å¹³å‡çš„æŸ¥æ‰¾æ—¶é—´æ˜¯O(logn)ï¼Œå…¶ä¸­næ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚å½“é“¾è¡¨è¾ƒé•¿æ—¶ï¼ŒæŸ¥æ‰¾å¯èƒ½ä¼šæˆä¸ºå“ˆå¸Œè¡¨çš„æ€§èƒ½ç“¶é¢ˆã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒJava8ä¸­å¯¹ConcurrentHashMapçš„æ•°æ®ç»“æž„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æž„ã€‚å½“æ•°ç»„ä¸­æŸä¸ªé“¾è¡¨çš„é•¿åº¦è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼ä¹‹åŽï¼Œä¼šå°†å…¶è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆçŽ‡ã€‚å½“çº¢é»‘æ ‘ç»“ç‚¹æ•°å°‘äºŽä¸€å®šé˜ˆå€¼åŽï¼Œè¿˜èƒ½é™çº¢é»‘æ ‘é€†é€€åŒ–æˆé“¾è¡¨ã€‚ä¸‹å›¾æ˜¯Java8 ConcurrentHashMapçš„æ•°æ®ç»“æž„ç¤ºæ„å›¾ï¼š Java8ä¸­å–æ¶ˆäº†Java7ä¸­çš„åˆ†æ®µé”è®¾è®¡ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ é‡è¦å±žæ€§ 123456789101112131415161718192021222324252627282930313233343536373839// æœ€å¤§å®¹é‡private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;// åˆå§‹å®¹é‡private static final int DEFAULT_CAPACITY = 16;// æ•°æ®æœ€å¤§é•¿åº¦static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;// é»˜è®¤å¹¶å‘åº¦private static final int DEFAULT_CONCURRENCY_LEVEL = 16;// é»˜è®¤åŠ è½½å› å­private static final float LOAD_FACTOR = 0.75f;// é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜€å€¼ï¼Œå¤§äºŽ8æ—¶static final int TREEIFY_THRESHOLD = 8;// çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜€å€¼ï¼Œå°äºŽç­‰äºŽ6ï¼ˆtranferæ—¶ï¼Œlcã€hc=0ä¸¤ä¸ªè®¡æ•°å™¨åˆ†åˆ«++è®°å½•åŽŸbinã€æ–°binTreeNodeæ•°é‡ï¼Œ&lt;=UNTREEIFY_THRESHOLD åˆ™untreeify(lo)ï¼‰ã€‚// ã€ä»…åœ¨æ‰©å®¹tranferæ—¶æ‰å¯èƒ½æ ‘è½¬é“¾è¡¨ã€‘static final int UNTREEIFY_THRESHOLD = 6;static final int MIN_TREEIFY_CAPACITY = 64;private static final int MIN_TRANSFER_STRIDE = 16;private static int RESIZE_STAMP_BITS = 16;// 2^15-1ï¼Œhelp resizeçš„æœ€å¤§çº¿ç¨‹æ•°private static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1;// 32-16=16ï¼ŒsizeCtlä¸­è®°å½•sizeå¤§å°çš„åç§»é‡private static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS;static final int MOVED = -1; // è¡¨ç¤ºæ­£åœ¨è½¬ç§»static final int TREEBIN = -2; // è¡¨ç¤ºå·²ç»è½¬æ¢æˆæ ‘static final int RESERVED = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hashtransient volatile Node&lt;K,V&gt;[] table;//é»˜è®¤æ²¡åˆå§‹åŒ–çš„æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å…ƒç´ private transient volatile Node&lt;K,V&gt;[] nextTable;//è½¬ç§»çš„æ—¶å€™ç”¨çš„æ•°ç»„// å¯ç”¨å¤„ç†å™¨æ•°é‡static final int NCPU = Runtime.getRuntime().availableProcessors();/** * ç”¨æ¥æŽ§åˆ¶è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹çš„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå½“åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šäº†å¤§å°ï¼Œè¿™ä¼šå°†è¿™ä¸ªå¤§å°ä¿å­˜åœ¨sizeCtlä¸­ï¼Œå¤§å°ä¸ºæ•°ç»„çš„0.75 * æ­£æ•°æˆ–0ä»£è¡¨hashè¡¨è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ•°å€¼è¡¨ç¤ºåˆå§‹åŒ–æˆ–ä¸‹ä¸€æ¬¡è¿›è¡Œæ‰©å®¹çš„å¤§å° * å½“ä¸ºè´Ÿçš„æ—¶å€™ï¼Œè¯´æ˜Žè¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œ * -1è¡¨ç¤ºåˆå§‹åŒ– * -(1+n) n:è¡¨ç¤ºæ´»åŠ¨çš„æ‰©å®¹çº¿ç¨‹ */private transient volatile int sizeCtl; é‡è¦ç±» Node-æž„æˆå…ƒç´ çš„åŸºæœ¬ç±» æœ€æ ¸å¿ƒçš„å†…éƒ¨ç±»ï¼Œå®ƒåŒ…è£…äº†key-valueé”®å€¼å¯¹ï¼Œæ‰€æœ‰æ’å…¥ConcurrentHashMapçš„æ•°æ®éƒ½åŒ…è£…åœ¨è¿™é‡Œé¢ã€‚å®ƒä¸ŽHashMapä¸­çš„å®šä¹‰å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä½†æ˜¯æœ‰ä¸€äº›å·®åˆ«å®ƒå¯¹valueå’Œnextå±žæ€§è®¾ç½®äº†volatileåŒæ­¥é”(ä¸ŽJDK7çš„Segmentç›¸åŒ)ï¼Œå®ƒä¸å…è®¸è°ƒç”¨setValueæ–¹æ³•ç›´æŽ¥æ”¹å˜Nodeçš„valueåŸŸï¼Œå®ƒå¢žåŠ äº†findæ–¹æ³•è¾…åŠ©map.get()æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; &#123; final int hash; //keyçš„hashå€¼ final K key; //key volatile V val; //value volatile Node&lt;K,V&gt; next; //è¡¨ç¤ºé“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ Node(int hash, K key, V val, Node&lt;K,V&gt; next) &#123; this.hash = hash; this.key = key; this.val = val; this.next = next; &#125; public final K getKey() &#123; return key; &#125; public final V getValue() &#123; return val; &#125; public final int hashCode() &#123; return key.hashCode() ^ val.hashCode(); &#125; public final String toString()&#123; return key + "=" + val; &#125; public final V setValue(V value) &#123; throw new UnsupportedOperationException(); &#125; public final boolean equals(Object o) &#123; Object k, v, u; Map.Entry&lt;?,?&gt; e; return ((o instanceof Map.Entry) &amp;&amp; (k = (e = (Map.Entry&lt;?,?&gt;)o).getKey()) != null &amp;&amp; (v = e.getValue()) != null &amp;&amp; (k == key || k.equals(key)) &amp;&amp; (v == (u = val) || v.equals(u))); &#125; /** * Virtualized support for map.get(); overridden in subclasses. */ Node&lt;K,V&gt; find(int h, Object k) &#123; Node&lt;K,V&gt; e = this; if (k != null) &#123; do &#123; K ek; if (e.hash == h &amp;&amp; ((ek = e.key) == k || (ek != null &amp;&amp; k.equals(ek)))) return e; &#125; while ((e = e.next) != null); &#125; return null; &#125;&#125; TreeNode-æ ‘ç»“ç‚¹ç±» æ ‘èŠ‚ç‚¹ç±»ï¼Œå¦å¤–ä¸€ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æž„ã€‚å½“é“¾è¡¨é•¿åº¦è¿‡é•¿çš„æ—¶å€™ï¼Œä¼šè½¬æ¢ä¸ºTreeNodeã€‚ä½†æ˜¯ä¸ŽHashMapä¸ç›¸åŒçš„æ˜¯ï¼Œå®ƒå¹¶ä¸æ˜¯ç›´æŽ¥è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè€Œæ˜¯æŠŠè¿™äº›ç»“ç‚¹åŒ…è£…æˆTreeNodeæ”¾åœ¨TreeBinå¯¹è±¡ä¸­ï¼Œç”±TreeBinå®Œæˆå¯¹çº¢é»‘æ ‘çš„åŒ…è£…ã€‚è€Œä¸”TreeNodeåœ¨ConcurrentHashMapé›†æˆè‡ªNodeç±»ï¼Œè€Œå¹¶éžHashMapä¸­çš„é›†æˆè‡ªLinkedHashMap.Entry&lt;K,V&gt;ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´TreeNodeå¸¦æœ‰nextæŒ‡é’ˆï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯æ–¹ä¾¿åŸºäºŽTreeBinçš„è®¿é—®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next, TreeNode&lt;K,V&gt; parent) &#123; super(hash, key, val, next); this.parent = parent; &#125; Node&lt;K,V&gt; find(int h, Object k) &#123; return findTreeNode(h, k, null); &#125; /** * Returns the TreeNode (or null if not found) for the given key * starting at given root. */ final TreeNode&lt;K,V&gt; findTreeNode(int h, Object k, Class&lt;?&gt; kc) &#123; if (k != null) &#123; TreeNode&lt;K,V&gt; p = this; do &#123; int ph, dir; K pk; TreeNode&lt;K,V&gt; q; TreeNode&lt;K,V&gt; pl = p.left, pr = p.right; if ((ph = p.hash) &gt; h) p = pl; else if (ph &lt; h) p = pr; else if ((pk = p.key) == k || (pk != null &amp;&amp; k.equals(pk))) return p; else if (pl == null) p = pr; else if (pr == null) p = pl; else if ((kc != null || (kc = comparableClassFor(k)) != null) &amp;&amp; (dir = compareComparables(kc, k, pk)) != 0) p = (dir &lt; 0) ? pl : pr; else if ((q = pr.findTreeNode(h, k, kc)) != null) return q; else p = pl; &#125; while (p != null); &#125; return null; &#125;&#125; TreeBin-æ ‘çš„å¤´ç»“ç‚¹ è¿™ä¸ªç±»å¹¶ä¸è´Ÿè´£åŒ…è£…ç”¨æˆ·çš„keyã€valueä¿¡æ¯ï¼Œè€Œæ˜¯åŒ…è£…çš„å¾ˆå¤šTreeNodeèŠ‚ç‚¹ã€‚å®ƒä»£æ›¿äº†TreeNodeçš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®žé™…çš„ConcurrentHashMapâ€œæ•°ç»„â€ä¸­ï¼Œå­˜æ”¾çš„æ˜¯TreeBinå¯¹è±¡ï¼Œè€Œä¸æ˜¯TreeNodeå¯¹è±¡ï¼Œè¿™æ˜¯ä¸ŽHashMapçš„åŒºåˆ«ã€‚å¦å¤–è¿™ä¸ªç±»è¿˜å¸¦æœ‰äº†è¯»å†™é”ã€‚åœ¨æž„é€ TreeBinèŠ‚ç‚¹æ—¶ï¼Œä»…ä»…æŒ‡å®šäº†å®ƒçš„hashå€¼ä¸ºTREEBINå¸¸é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ªæ ‡è¯†ã€‚ 12345678910static final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; TreeNode&lt;K,V&gt; root; volatile TreeNode&lt;K,V&gt; first; volatile Thread waiter; volatile int lockState; // values for lockState static final int WRITER = 1; // set while holding write lock static final int WAITER = 2; // set when waiting for write lock static final int READER = 4; // increment value for setting read lock&#125; ForwardingNode-è½¬ç§»çš„æ—¶å€™æ”¾åœ¨å¤´éƒ¨çš„ç»“ç‚¹ ä¸€ä¸ªç”¨äºŽè¿žæŽ¥ä¸¤ä¸ªtableçš„èŠ‚ç‚¹ç±»ã€‚å®ƒåŒ…å«ä¸€ä¸ªnextTableæŒ‡é’ˆï¼Œç”¨äºŽæŒ‡å‘ä¸‹ä¸€å¼ è¡¨ã€‚è€Œä¸”è¿™ä¸ªèŠ‚ç‚¹çš„key value nextæŒ‡é’ˆå…¨éƒ¨ä¸ºnullï¼Œå®ƒçš„hashå€¼ä¸º-1. è¿™é‡Œé¢å®šä¹‰çš„findçš„æ–¹æ³•æ˜¯ä»ŽnextTableé‡Œè¿›è¡ŒæŸ¥è¯¢èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»¥è‡ªèº«ä¸ºå¤´èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ã€‚å…¶ä¸­å­˜å‚¨nextTableçš„å¼•ç”¨ã€‚åªæœ‰tableå‘ç”Ÿæ‰©å®¹çš„æ—¶å€™ï¼ŒForwardingNodeæ‰ä¼šå‘æŒ¥ä½œç”¨ï¼Œä½œä¸ºä¸€ä¸ªå ä½ç¬¦æ”¾åœ¨tableä¸­è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºnullæˆ–åˆ™å·²ç»è¢«ç§»åŠ¨ã€‚ 1234567static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; &#123; final Node&lt;K,V&gt;[] nextTable; ForwardingNode(Node&lt;K,V&gt;[] tab) &#123; super(MOVED, null, null, null); this.nextTable = tab; &#125;&#125; 3ä¸ªåŽŸå­æ“ä½œ åœ¨ConcurrentHashMapä¸­ä½¿ç”¨äº†unSafeæ–¹æ³•ï¼Œé€šè¿‡ç›´æŽ¥æ“ä½œå†…å­˜çš„æ–¹å¼æ¥ä¿è¯å¹¶å‘å¤„ç†çš„å®‰å…¨æ€§ï¼Œä½¿ç”¨çš„æ˜¯ç¡¬ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚ 123456789101112131415161718192021/* * ç”¨æ¥è¿”å›žèŠ‚ç‚¹æ•°ç»„çš„æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹çš„åŽŸå­æ“ä½œ */@SuppressWarnings("unchecked")static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) &#123; return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);&#125;/* * åˆ©ç”¨CASç®—æ³•è®¾ç½®iä½ç½®ä¸Šçš„NodeèŠ‚ç‚¹ï¼ˆå°†cå’Œtable[i]æ¯”è¾ƒï¼Œç›¸åŒåˆ™æ’å…¥vï¼‰ã€‚ */static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) &#123; return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);&#125;/* * è®¾ç½®èŠ‚ç‚¹ä½ç½®çš„å€¼ï¼Œä»…åœ¨ä¸Šé”åŒºè¢«è°ƒç”¨ */static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) &#123; U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);&#125; æž„é€ å™¨ 1234567891011121314151617//ç©ºçš„æž„é€ public ConcurrentHashMapDebug() &#123;&#125;//å¦‚æžœåœ¨å®žä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æŒ‡å®šäº†å®¹é‡ï¼Œåˆ™åˆå§‹åŒ–sizeCtlpublic ConcurrentHashMapDebug(int initialCapacity) &#123; if (initialCapacity &lt; 0) throw new IllegalArgumentException(); int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); this.sizeCtl = cap;&#125;//å½“å‡ºå…¥ä¸€ä¸ªMapçš„æ—¶å€™ï¼Œå…ˆè®¾å®šsizeCtlä¸ºé»˜è®¤å®¹é‡ï¼Œåœ¨æ·»åŠ å…ƒç´ public ConcurrentHashMapDebug(Map&lt;? extends K, ? extends V&gt; m) &#123; this.sizeCtl = DEFAULT_CAPACITY; putAll(m);&#125; åœ¨ä»»ä½•ä¸€ä¸ªæž„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ²¡æœ‰å¯¹å­˜å‚¨Mapå…ƒç´ Nodeçš„tableå˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚è€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡putæ“ä½œçš„æ—¶å€™åœ¨è¿›è¡Œåˆå§‹åŒ–ã€‚ putæ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121/* * å•çº¯çš„è°ƒç”¨putValæ–¹æ³•ï¼Œå¹¶ä¸”putValçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºfalse * å½“è®¾ç½®ä¸ºfalseçš„æ—¶å€™è¡¨ç¤ºè¿™ä¸ªvalueä¸€å®šä¼šè®¾ç½® * trueçš„æ—¶å€™ï¼Œåªæœ‰å½“è¿™ä¸ªkeyçš„valueä¸ºç©ºçš„æ—¶å€™æ‰ä¼šè®¾ç½® */public V put(K key, V value) &#123; return putVal(key, value, false);&#125;/* * å½“æ·»åŠ ä¸€å¯¹é”®å€¼å¯¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šåŽ»åˆ¤æ–­ä¿å­˜è¿™äº›é”®å€¼å¯¹çš„æ•°ç»„æ˜¯ä¸æ˜¯åˆå§‹åŒ–äº†ï¼Œ * å¦‚æžœæ²¡æœ‰çš„è¯å°±åˆå§‹åŒ–æ•°ç»„ * ç„¶åŽé€šè¿‡è®¡ç®—hashå€¼æ¥ç¡®å®šæ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½® * å¦‚æžœè¿™ä¸ªä½ç½®ä¸ºç©ºåˆ™ç›´æŽ¥æ·»åŠ ï¼Œå¦‚æžœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™å–å‡ºè¿™ä¸ªèŠ‚ç‚¹æ¥ * å¦‚æžœå–å‡ºæ¥çš„èŠ‚ç‚¹çš„hashå€¼æ˜¯MOVED(-1)çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ­£åœ¨å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¤åˆ¶åˆ°æ–°çš„æ•°ç»„ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹ŸåŽ»å¸®åŠ©å¤åˆ¶ * æœ€åŽä¸€ç§æƒ…å†µå°±æ˜¯ï¼Œå¦‚æžœè¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸ä¸ºç©ºï¼Œä¹Ÿä¸åœ¨æ‰©å®¹ï¼Œåˆ™é€šè¿‡synchronizedæ¥åŠ é”ï¼Œè¿›è¡Œæ·»åŠ æ“ä½œ * ç„¶åŽåˆ¤æ–­å½“å‰å–å‡ºçš„èŠ‚ç‚¹ä½ç½®å­˜æ”¾çš„æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘ * å¦‚æžœæ˜¯é“¾è¡¨çš„è¯ï¼Œåˆ™éåŽ†æ•´ä¸ªé“¾è¡¨ï¼Œç›´åˆ°å–å‡ºæ¥çš„èŠ‚ç‚¹çš„keyæ¥ä¸ªè¦æ”¾çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æžœkeyç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„hashå€¼ä¹Ÿç›¸ç­‰çš„è¯ï¼Œ * åˆ™è¯´æ˜Žæ˜¯åŒä¸€ä¸ªkeyï¼Œåˆ™è¦†ç›–æŽ‰valueï¼Œå¦åˆ™çš„è¯åˆ™æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ * å¦‚æžœæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æŠŠè¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­åŽ» * æœ€åŽåœ¨æ·»åŠ å®Œæˆä¹‹åŽï¼Œä¼šåˆ¤æ–­åœ¨è¯¥èŠ‚ç‚¹å¤„å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ˆæ³¨æ„æ˜¯æ·»åŠ å‰çš„ä¸ªæ•°ï¼‰ï¼Œå¦‚æžœè¾¾åˆ°8ä¸ªä»¥ä¸Šäº†çš„è¯ï¼Œ * åˆ™è°ƒç”¨treeifyBinæ–¹æ³•æ¥å°è¯•å°†å¤„çš„é“¾è¡¨è½¬ä¸ºæ ‘ï¼Œæˆ–è€…æ‰©å®¹æ•°ç»„ */final V putVal(K key, V value, boolean onlyIfAbsent) &#123; //K,Véƒ½ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™çš„è¯è·‘å‡ºå¼‚å¸¸ if (key == null || value == null) throw new NullPointerException(); //å–å¾—keyçš„hashå€¼ int hash = spread(key.hashCode()); //ç”¨æ¥è®¡ç®—åœ¨è¿™ä¸ªç»“ç‚¹æ€»å…±æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œç”¨æ¥æŽ§åˆ¶æ‰©å®¹æˆ–è€…è½¬ç§»æ ‘ int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) &#123; Node&lt;K,V&gt; f; int n, i, fh; //å¦‚æžœæ•°ç»„ä¸ºç©ºæˆ–æ•°ç»„é•¿åº¦ä¸º0 if (tab == null || (n = tab.length) == 0) //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™tableæ²¡æœ‰åˆå§‹åŒ–åˆ™åˆå§‹åŒ–table tab = initTable(); //æ‰¾è¯¥ hash å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ f else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) &#123; //å¦‚æžœè¿™ä¸ªä½ç½®æ²¡æœ‰å…ƒç´ çš„è¯ï¼Œåˆ™é€šè¿‡casçš„æ–¹å¼å°è¯•æ·»åŠ ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”çš„ //åˆ›å»ºä¸€ä¸ªNodeæ·»åŠ åˆ°æ•°ç»„ä¸­åŒºï¼Œnullè¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin &#125; /* * å¦‚æžœæ£€æµ‹åˆ°æŸä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯MOVEDï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ•°ç»„æ‰©å¼ çš„æ•°æ®å¤åˆ¶é˜¶æ®µï¼Œ * åˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šå‚ä¸ŽåŽ»å¤åˆ¶ï¼Œé€šè¿‡å…è®¸å¤šçº¿ç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œä¾æ­¤æ¥å‡å°‘æ•°ç»„çš„å¤åˆ¶æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤± */ else if ((fh = f.hash) == MOVED) //æ•°æ®è¿ç§» tab = helpTransfer(tab, f); else &#123; /* * å¦‚æžœåœ¨è¿™ä¸ªä½ç½®æœ‰å…ƒç´ çš„è¯ï¼Œå°±é‡‡ç”¨synchronizedçš„æ–¹å¼åŠ é”ï¼Œ * å¦‚æžœæ˜¯é“¾è¡¨çš„è¯(hashå¤§äºŽ0)ï¼Œå°±å¯¹è¿™ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ è¿›è¡ŒéåŽ†ï¼Œ * å¦‚æžœæ‰¾åˆ°äº†keyå’Œkeyçš„hashå€¼éƒ½ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™æŠŠå®ƒçš„å€¼æ›¿æ¢åˆ° * å¦‚æžœæ²¡æ‰¾åˆ°çš„è¯ï¼Œåˆ™æ·»åŠ åœ¨é“¾è¡¨çš„æœ€åŽé¢ * å¦åˆ™ï¼Œæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æ·»åŠ åˆ°æ ‘ä¸­åŽ» * * åœ¨æ·»åŠ å®Œä¹‹åŽï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹ä¸Šå…³è”çš„çš„æ•°ç›®è¿›è¡Œåˆ¤æ–­ï¼Œ * å¦‚æžœåœ¨8ä¸ªä»¥ä¸Šçš„è¯ï¼Œåˆ™ä¼šè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œæ¥å°è¯•è½¬åŒ–ä¸ºæ ‘ï¼Œæˆ–è€…æ˜¯æ‰©å®¹ */ V oldVal = null; synchronized (f) &#123; if (tabAt(tab, i) == f) &#123;//å†æ¬¡å–å‡ºè¦å­˜å‚¨çš„ä½ç½®çš„å…ƒç´ ï¼Œè·Ÿå‰é¢å–å‡ºæ¥çš„æ¯”è¾ƒ if (fh &gt;= 0) &#123;//å–å‡ºæ¥çš„å…ƒç´ çš„hashå€¼å¤§äºŽ0è¯´æ˜Žæ˜¯é“¾è¡¨ï¼Œå½“è½¬æ¢ä¸ºæ ‘ä¹‹åŽï¼Œhashå€¼ä¸º-2 //ç”¨äºŽç´¯åŠ ï¼Œè®°å½•é“¾è¡¨é•¿åº¦ binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) &#123;//éåŽ†è¿™ä¸ªé“¾è¡¨ K ek; //è¦å­˜çš„å…ƒç´ çš„hashï¼Œkeyè·Ÿè¦å­˜å‚¨çš„ä½ç½®çš„èŠ‚ç‚¹çš„ç›¸åŒçš„æ—¶å€™ï¼Œæ›¿æ¢æŽ‰è¯¥èŠ‚ç‚¹çš„valueå³å¯ if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) &#123; oldVal = e.val; //å½“ä½¿ç”¨putIfAbsentçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è¿™ä¸ªkeyæ²¡æœ‰è®¾ç½®å€¼å¾—æ—¶å€™æ‰è®¾ç½® if (!onlyIfAbsent) e.val = value; break; &#125; Node&lt;K,V&gt; pred = e; //å¦‚æžœä¸æ˜¯åŒæ ·çš„hashï¼ŒåŒæ ·çš„keyçš„æ—¶å€™ï¼Œåˆ™åˆ¤æ–­è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©º if ((e = e.next) == null) &#123; //ä¸ºç©ºçš„è¯æŠŠè¿™ä¸ªè¦åŠ å…¥çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; &#125; &#125; &#125; else if (f instanceof TreeBin) &#123;//è¡¨ç¤ºå·²ç»è½¬åŒ–æˆçº¢é»‘æ ‘ç±»åž‹äº† Node&lt;K,V&gt; p; binCount = 2; //è°ƒç”¨putTreeValæ–¹æ³•ï¼Œå°†è¯¥å…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­åŽ» if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) &#123; oldVal = p.val; if (!onlyIfAbsent) p.val = value; &#125; &#125; &#125; &#125; //è¯´æ˜Žä¸Šé¢åœ¨åšé“¾è¡¨æ“ä½œ if (binCount != 0) &#123; //åˆ¤æ–­æ˜¯å¦è¦å°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘ï¼Œä¸´ç•Œå€¼å’ŒHashMapä¸€æ ·ï¼Œä¹Ÿæ˜¯8 if (binCount &gt;= TREEIFY_THRESHOLD) // è¿™ä¸ªæ–¹æ³•å’Œ HashMap ä¸­ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯ä¸€å®šä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œ // å¦‚æžœå½“å‰æ•°ç»„çš„é•¿åº¦å°äºŽ 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ treeifyBin(tab, i); if (oldVal != null) return oldVal; break; &#125; &#125; &#125; addCount(1L, binCount); return null;&#125; initTable-æ•°ç»„åˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334353637/** * åˆå§‹åŒ–æ•°ç»„tableï¼Œ * å¦‚æžœsizeCtlå°äºŽ0ï¼Œè¯´æ˜Žåˆ«çš„æ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™è®©å‡ºæ‰§è¡Œæƒ * å¦‚æžœsizeCtlå¤§äºŽ0çš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtlçš„æ•°ç»„ * å¦åˆ™çš„è¯åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å¤§å°(16)çš„æ•°ç»„ * ç„¶åŽè®¾ç½®sizeCtlçš„å€¼ä¸ºæ•°ç»„é•¿åº¦çš„3/4 */private final Node&lt;K,V&gt;[] initTable() &#123; Node&lt;K,V&gt;[] tab; int sc; //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™ï¼Œtableè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè¿›å…¥while while ((tab = table) == null || tab.length == 0) &#123; //sizeCtlåˆå§‹å€¼ä¸º0ï¼Œå½“å°äºŽ0çš„æ—¶å€™è¡¨ç¤ºåœ¨åˆ«çš„çº¿ç¨‹åœ¨åˆå§‹åŒ–è¡¨æˆ–æ‰©å®¹ if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin //CASä¸€ä¸‹ï¼Œå°†sizectlè®¾ç½®ä¸º-1ï¼Œä»£è¡¨æŠ¢åˆ°äº†é” else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if ((tab = table) == null || tab.length == 0) &#123; //æŒ‡å®šäº†å¤§å°çš„æ—¶å€™å°±åˆ›å»ºæŒ‡å®šå¤§å°çš„Nodeæ•°ç»„ï¼Œå¦åˆ™åˆ›å»ºæŒ‡å®šå¤§å°(16)çš„Nodeæ•°ç»„ int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; //åˆå§‹åŒ–æ•°ç»„ï¼Œé•¿åº¦ä¸º16ï¼Œæˆ–åˆå§‹åŒ–æ—¶æä¾›çš„é•¿åº¦ @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; // å°†è¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™ tableï¼Œtable æ˜¯ volatile çš„ table = tab = nt; // å¦‚æžœ n ä¸º 16 çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œ sc = 12ï¼Œå…¶å®žå°±æ˜¯ 0.75 * n sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; //åˆå§‹åŒ–åŽï¼ŒsizeCtlé•¿åº¦ä¸ºæ•°ç»„é•¿åº¦çš„3/4 sizeCtl = sc; &#125; break; &#125; &#125; return tab;&#125; ä¸»è¦å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªåˆé€‚å¤§å°çš„æ•°ç»„ï¼Œç„¶åŽä¼šè®¾ç½® sizeCtlã€‚åˆå§‹åŒ–æ–¹æ³•ä¸­çš„å¹¶å‘é—®é¢˜æ˜¯é€šè¿‡å¯¹ sizeCtl è¿›è¡Œä¸€ä¸ª CAS æ“ä½œæ¥æŽ§åˆ¶çš„ã€‚ treeifyBin-é“¾è¡¨è½¬çº¢é»‘æ ‘ 12345678910111213141516171819202122232425262728293031private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) &#123; Node&lt;K,V&gt; b; int n, sc; if (tab != null) &#123; // MIN_TREEIFY_CAPACITY ä¸º 64 // æ‰€ä»¥ï¼Œå¦‚æžœæ•°ç»„é•¿åº¦å°äºŽ 64 çš„æ—¶å€™ï¼Œå…¶å®žä¹Ÿå°±æ˜¯ 32 æˆ–è€… 16 æˆ–è€…æ›´å°çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) tryPresize(n &lt;&lt; 1);//æ•°ç»„æ‰©å®¹ // bæ˜¯å¤´ç»“ç‚¹ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) &#123; synchronized (b) &#123; if (tabAt(tab, index) == b) &#123; // ä¸‹é¢å°±æ˜¯éåŽ†é“¾è¡¨ï¼Œå»ºç«‹ä¸€é¢—çº¢é»‘æ ‘ TreeNode&lt;K,V&gt; hd = null, tl = null;//hd æ ‘çš„å¤´ç»“ç‚¹ for (Node&lt;K,V&gt; e = b; e != null; e = e.next) &#123; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val, null, null); //æŠŠNodeç»„æˆçš„é“¾è¡¨ï¼Œè½¬åŒ–ä¸ºTreeNodeçš„é“¾è¡¨ï¼Œå¤´ç»“ç‚¹ä»»ç„¶æ”¾åœ¨ç›¸åŒçš„ä½ç½® if ((p.prev = tl) == null) hd = p;//è®¾ç½®head else tl.next = p; tl = p; &#125; // å°†çº¢é»‘æ ‘è®¾ç½®åˆ°æ•°ç»„ç›¸åº”ä½ç½®ä¸­ setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd)); &#125; &#125; &#125; &#125;&#125; treeifyBin ä¸ä¸€å®šå°±ä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»…ä»…åšæ•°ç»„æ‰©å®¹ã€‚ tryPresize-æ‰©å®¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768private final void tryPresize(int size) &#123; // cï¼šsize çš„ 1.5 å€ï¼Œå†åŠ  1ï¼Œå†å¾€ä¸Šå–æœ€è¿‘çš„ 2 çš„ n æ¬¡æ–¹ã€‚ // å¦‚æžœç»™å®šçš„å¤§å°å¤§äºŽç­‰äºŽæ•°ç»„å®¹é‡çš„ä¸€åŠï¼Œåˆ™ç›´æŽ¥ä½¿ç”¨æœ€å¤§å®¹é‡ï¼Œå¦åˆ™ä½¿ç”¨tableSizeForç®—å‡ºæ¥ int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) &#123; Node&lt;K,V&gt;[] tab = table; int n; /* * å¦‚æžœæ•°ç»„tableè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtrlå’Œåˆšåˆšç®—å‡ºæ¥çš„cä¸­è¾ƒå¤§çš„ä¸€ä¸ªå¤§å°çš„æ•°ç»„ * åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®¾ç½®sizeCtrlä¸º-1ï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åŽæŠŠsizeCtrlè®¾ç½®ä¸ºæ•°ç»„é•¿åº¦çš„3/4 * ä¸ºä»€ä¹ˆè¦åœ¨æ‰©å®¹çš„åœ°æ–¹æ¥åˆå§‹åŒ–æ•°ç»„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æžœç¬¬ä¸€æ¬¡putçš„æ—¶å€™ä¸æ˜¯putå•ä¸ªå…ƒç´ ï¼Œ * è€Œæ˜¯è°ƒç”¨putAllæ–¹æ³•ç›´æŽ¥putä¸€ä¸ªmapçš„è¯ï¼Œåœ¨putALlæ–¹æ³•ä¸­æ²¡æœ‰è°ƒç”¨initTableæ–¹æ³•åŽ»åˆå§‹åŒ–tableï¼Œ * è€Œæ˜¯ç›´æŽ¥è°ƒç”¨äº†tryPresizeæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åšä¸€ä¸ªæ˜¯ä¸æ˜¯éœ€è¦åˆå§‹åŒ–tableçš„åˆ¤æ–­ */ if (tab == null || (n = tab.length) == 0) &#123; n = (sc &gt; c) ? sc : c; //åˆå§‹åŒ–tabçš„æ—¶å€™ï¼ŒæŠŠsizeCtlè®¾ä¸º-1 if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) &#123; try &#123; if (table == tab) &#123; @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); &#125; &#125; finally &#123; sizeCtl = sc; &#125; &#125; &#125; /* * ä¸€ç›´æ‰©å®¹åˆ°çš„cå°äºŽç­‰äºŽsizeCtlæˆ–è€…æ•°ç»„é•¿åº¦å¤§äºŽæœ€å¤§é•¿åº¦çš„æ—¶å€™ï¼Œåˆ™é€€å‡º * æ‰€ä»¥åœ¨ä¸€æ¬¡æ‰©å®¹ä¹‹åŽï¼Œä¸æ˜¯åŽŸæ¥é•¿åº¦çš„ä¸¤å€ï¼Œè€Œæ˜¯2çš„næ¬¡æ–¹å€ */ else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) break; else if (tab == table) &#123; int rs = resizeStamp(n); /* * å¦‚æžœæ­£åœ¨æ‰©å®¹Tableçš„è¯ï¼Œåˆ™å¸®åŠ©æ‰©å®¹ * å¦åˆ™çš„è¯ï¼Œå¼€å§‹æ–°çš„æ‰©å®¹ * åœ¨transferæ“ä½œï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°çš„tableä¸­çš„å…ƒç´ ï¼Œç§»åŠ¨åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„tableä¸­åŽ»ï¼Œ * è™½ç„¶æ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®çš„æ˜¯nullï¼Œä½†æ˜¯ï¼Œåœ¨transferæ–¹æ³•ä¸­ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°ä¸ºnullçš„æ—¶å€™ï¼Œ * ä¼šåˆ›å»ºä¸€ä¸ªä¸¤å€å¤§å°çš„table */ if (sc &lt; 0) &#123; Node&lt;K,V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; /* * transferçš„çº¿ç¨‹æ•°åŠ ä¸€,è¯¥çº¿ç¨‹å°†è¿›è¡Œtransferçš„å¸®å¿™ * åœ¨transferçš„æ—¶å€™ï¼Œscè¡¨ç¤ºåœ¨transferå·¥ä½œçš„çº¿ç¨‹æ•° */ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); &#125; /* * æ²¡æœ‰åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œåˆ™å¼€å§‹æ‰©å®¹ */ else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); &#125; &#125;&#125; è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåœ¨äºŽ sizeCtl å€¼çš„æ“ä½œï¼Œé¦–å…ˆå°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªè´Ÿæ•°ï¼Œç„¶åŽæ‰§è¡Œ transfer(tab, null)ï¼Œå†ä¸‹ä¸€ä¸ªå¾ªçŽ¯å°† sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ï¼Œä¹‹åŽå¯èƒ½æ˜¯ç»§ç»­ sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ã€‚æ‰€ä»¥ï¼Œå¯èƒ½çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ 1 æ¬¡ transfer(tab, null) +å¤šæ¬¡ transfer(tab, nt)ï¼Œè¿™é‡Œæ€Žä¹ˆç»“æŸå¾ªçŽ¯çš„éœ€è¦çœ‹å®Œ transfer æºç æ‰æ¸…æ¥šã€‚ transfer-æ•°æ®è¿ç§» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213/** * æŠŠæ•°ç»„ä¸­çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ–°çš„æ•°ç»„çš„ç›¸åŒä½ç½®ï¼Œæˆ–è€…ç§»åŠ¨åˆ°æ‰©å¼ éƒ¨åˆ†çš„ç›¸åŒä½ç½® * åœ¨è¿™é‡Œé¦–å…ˆä¼šè®¡ç®—ä¸€ä¸ªæ­¥é•¿ï¼Œè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°ç»„é•¿åº¦ï¼Œç”¨æ¥æŽ§åˆ¶å¯¹CPUçš„ä½¿ç”¨ï¼Œ * æ¯ä¸ªCPUæœ€å°‘å¤„ç†16ä¸ªé•¿åº¦çš„æ•°ç»„å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æžœä¸€ä¸ªæ•°ç»„çš„é•¿åº¦åªæœ‰16ï¼Œé‚£åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå¯¹å…¶è¿›è¡Œæ‰©å®¹çš„å¤åˆ¶ç§»åŠ¨æ“ä½œ * æ‰©å®¹çš„æ—¶å€™ä¼šä¸€ç›´éåŽ†ï¼ŒçŸ¥é“å¤åˆ¶å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ²¡å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šåœ¨é“¾è¡¨çš„å¤´éƒ¨è®¾ç½®ä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±ä¼šè·³è¿‡ä»–ï¼Œ * å¤åˆ¶åŽåœ¨æ–°æ•°ç»„ä¸­çš„é“¾è¡¨ä¸æ˜¯ç»å¯¹çš„ååºçš„ */private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) &#123; int n = tab.length, stride; // stride åœ¨å•æ ¸ä¸‹ç›´æŽ¥ç­‰äºŽ nï¼Œå¤šæ ¸æ¨¡å¼ä¸‹ä¸º (n&gt;&gt;&gt;3)/NCPUï¼Œæœ€å°å€¼æ˜¯ 16 // stride å¯ä»¥ç†è§£ä¸ºâ€æ­¥é•¿â€œï¼Œæœ‰ n ä¸ªä½ç½®æ˜¯éœ€è¦è¿›è¡Œè¿ç§»çš„ï¼Œ // å°†è¿™ n ä¸ªä»»åŠ¡åˆ†ä¸ºå¤šä¸ªä»»åŠ¡åŒ…ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…æœ‰ stride ä¸ªä»»åŠ¡ if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range /* * å¦‚æžœå¤åˆ¶çš„ç›®æ ‡nextTabä¸ºnullçš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªtableä¸¤å€é•¿çš„nextTab * æ­¤æ—¶nextTableè¢«è®¾ç½®å€¼äº†(åœ¨åˆå§‹æƒ…å†µä¸‹æ˜¯ä¸ºnullçš„) * å› ä¸ºå¦‚æžœæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å§‹äº†è¡¨çš„æ‰©å¼ çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šè¿›æ¥å¸®å¿™æ‰©å¼ ï¼Œ * è€Œåªæ˜¯ç¬¬ä¸€ä¸ªå¼€å§‹æ‰©å¼ çš„çº¿ç¨‹éœ€è¦åˆå§‹åŒ–ä¸‹ç›®æ ‡æ•°ç»„ */ if (nextTab == null) &#123; // initiating try &#123; //å®¹é‡ç¿»å€ @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; &#125; catch (Throwable ex) &#123; // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; &#125; // nextTable æ˜¯ ConcurrentHashMap ä¸­çš„å±žæ€§ nextTable = nextTab; // transferIndex ä¹Ÿæ˜¯ ConcurrentHashMap çš„å±žæ€§ï¼Œç”¨äºŽæŽ§åˆ¶è¿ç§»çš„ä½ç½® transferIndex = n; &#125; int nextn = nextTab.length; // ForwardingNode--&gt;æ­£åœ¨è¢«è¿ç§»çš„ Node // è¿™ä¸ªæž„é€ æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªNodeï¼Œkeyã€value å’Œ next éƒ½ä¸º nullï¼Œå…³é”®æ˜¯ hash ä¸º MOVED // åŽé¢ä¼šçœ‹åˆ°ï¼ŒåŽŸæ•°ç»„ä¸­ä½ç½® i å¤„çš„èŠ‚ç‚¹å®Œæˆè¿ç§»å·¥ä½œåŽï¼Œ // å°±ä¼šå°†ä½ç½® i å¤„è®¾ç½®ä¸ºè¿™ä¸ª ForwardingNodeï¼Œç”¨æ¥å‘Šè¯‰å…¶ä»–çº¿ç¨‹è¯¥ä½ç½®å·²ç»å¤„ç†è¿‡äº† // æ‰€ä»¥å®ƒå…¶å®žç›¸å½“äºŽæ˜¯ä¸€ä¸ªæ ‡å¿—ã€‚ ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); // advance æŒ‡çš„æ˜¯åšå®Œäº†ä¸€ä¸ªä½ç½®çš„è¿ç§»å·¥ä½œï¼Œå¯ä»¥å‡†å¤‡åšä¸‹ä¸€ä¸ªä½ç½®çš„äº† boolean advance = true; boolean finishing = false; // to ensure sweep(æ¸…æ‰«) before committing nextTab,åœ¨å®Œæˆä¹‹å‰é‡æ–°åœ¨æ‰«æä¸€éæ•°ç»„ï¼Œçœ‹çœ‹æœ‰æ²¡å®Œæˆçš„æ²¡ // i æ˜¯ä½ç½®ç´¢å¼•ï¼Œbound æ˜¯è¾¹ç•Œï¼Œæ³¨æ„æ˜¯ä»ŽåŽå¾€å‰ for (int i = 0, bound = 0;;) &#123; Node&lt;K,V&gt; f; int fh; // advance ä¸º true è¡¨ç¤ºå¯ä»¥è¿›è¡Œä¸‹ä¸€ä¸ªä½ç½®çš„è¿ç§»äº† // ç®€å•ç†è§£ï¼ši æŒ‡å‘äº† transferIndexï¼Œbound æŒ‡å‘äº† transferIndex-stride while (advance) &#123; int nextIndex, nextBound; if (--i &gt;= bound || finishing) advance = false; // å°† transferIndex å€¼èµ‹ç»™ nextIndex // è¿™é‡Œ transferIndex ä¸€æ—¦å°äºŽç­‰äºŽ 0ï¼Œè¯´æ˜ŽåŽŸæ•°ç»„çš„æ‰€æœ‰ä½ç½®éƒ½æœ‰ç›¸åº”çš„çº¿ç¨‹åŽ»å¤„ç†äº† else if ((nextIndex = transferIndex) &lt;= 0) &#123; i = -1; advance = false; &#125; // nextBound æ˜¯è¿™æ¬¡è¿ç§»ä»»åŠ¡çš„è¾¹ç•Œï¼Œæ³¨æ„ï¼Œæ˜¯ä»ŽåŽå¾€å‰ else if (U.compareAndSwapInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) &#123; bound = nextBound; i = nextIndex - 1; advance = false; &#125; &#125; if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) &#123; int sc; // æ‰€æœ‰çš„è¿ç§»æ“ä½œå·²ç»å®Œæˆ if (finishing) &#123; nextTable = null; // å°†æ–°çš„ nextTab èµ‹å€¼ç»™ table å±žæ€§ï¼Œå®Œæˆè¿ç§» table = nextTab; // é‡æ–°è®¡ç®— sizeCtlï¼šn æ˜¯åŽŸæ•°ç»„é•¿åº¦ï¼Œæ‰€ä»¥ sizeCtl å¾—å‡ºçš„å€¼å°†æ˜¯æ–°æ•°ç»„é•¿åº¦çš„ 0.75 å€ sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; &#125; // sizeCtl åœ¨è¿ç§»å‰ä¼šè®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2 // ç„¶åŽï¼Œæ¯æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸Žè¿ç§»å°±ä¼šå°† sizeCtl åŠ  1ï¼Œ // è¿™é‡Œä½¿ç”¨ CAS æ“ä½œå¯¹ sizeCtl è¿›è¡Œå‡ 1ï¼Œä»£è¡¨åšå®Œäº†å±žäºŽè‡ªå·±çš„ä»»åŠ¡ if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) &#123; if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; // åˆ°è¿™é‡Œï¼Œè¯´æ˜Ž (sc - 2) == resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFTï¼Œ // ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„è¿ç§»ä»»åŠ¡éƒ½åšå®Œäº†ï¼Œä¹Ÿå°±ä¼šè¿›å…¥åˆ°ä¸Šé¢çš„ if(finishing)&#123;&#125; åˆ†æ”¯äº† finishing = advance = true; i = n; // recheck before commit &#125; &#125; // å¦‚æžœä½ç½® i å¤„æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ”¾å…¥åˆšåˆšåˆå§‹åŒ–çš„ ForwardingNode â€ç©ºèŠ‚ç‚¹â€œ else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); // è¯¥ä½ç½®å¤„æ˜¯ä¸€ä¸ª ForwardingNodeï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»è¿‡äº† else if ((fh = f.hash) == MOVED) advance = true; // already processed else &#123; // å¯¹æ•°ç»„è¯¥ä½ç½®å¤„çš„ç»“ç‚¹åŠ é”ï¼Œå¼€å§‹å¤„ç†æ•°ç»„è¯¥ä½ç½®å¤„çš„è¿ç§»å·¥ä½œ synchronized (f) &#123; if (tabAt(tab, i) == f) &#123; Node&lt;K,V&gt; ln, hn; // å¤´ç»“ç‚¹çš„ hash å¤§äºŽ 0ï¼Œè¯´æ˜Žæ˜¯é“¾è¡¨çš„ Node èŠ‚ç‚¹ if (fh &gt;= 0) &#123; // éœ€è¦å°†é“¾è¡¨ä¸€åˆ†ä¸ºäºŒï¼Œæ‰¾åˆ°åŽŸé“¾è¡¨ä¸­çš„ lastRunï¼Œ // ç„¶åŽ lastRun åŠå…¶ä¹‹åŽçš„èŠ‚ç‚¹æ˜¯ä¸€èµ·è¿›è¡Œè¿ç§»çš„lastRun ä¹‹å‰çš„èŠ‚ç‚¹éœ€è¦è¿›è¡Œå…‹éš†ï¼Œç„¶åŽåˆ†åˆ°ä¸¤ä¸ªé“¾è¡¨ä¸­ int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; /* * lastRun è¡¨ç¤ºçš„æ˜¯éœ€è¦å¤åˆ¶çš„æœ€åŽä¸€ä¸ªèŠ‚ç‚¹ * æ¯å½“æ–°èŠ‚ç‚¹çš„hash&amp;n -&gt; b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±æŠŠrunBitè®¾ç½®ä¸ºè¿™ä¸ªç»“æžœb * è¿™æ ·forå¾ªçŽ¯ä¹‹åŽï¼ŒrunBitçš„å€¼å°±æ˜¯æœ€åŽä¸å˜çš„hash&amp;nçš„å€¼ * è€ŒlastRunçš„å€¼å°±æ˜¯æœ€åŽä¸€æ¬¡å¯¼è‡´hash&amp;n å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹(å‡è®¾ä¸ºpèŠ‚ç‚¹) * ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºpèŠ‚ç‚¹åŽé¢çš„èŠ‚ç‚¹çš„hash&amp;n å€¼è·ŸpèŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œ * æ‰€ä»¥åœ¨å¤åˆ¶åˆ°æ–°çš„tableçš„æ—¶å€™ï¼Œå®ƒè‚¯å®šè¿˜æ˜¯è·ŸpèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªä½ç½® * åœ¨å¤åˆ¶å®ŒpèŠ‚ç‚¹ä¹‹åŽï¼ŒpèŠ‚ç‚¹çš„nextèŠ‚ç‚¹è¿˜æ˜¯æŒ‡å‘å®ƒåŽŸæ¥çš„èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦è¿›è¡Œå¤åˆ¶äº†ï¼Œè‡ªå·±å°±è¢«å¸¦è¿‡åŽ»äº† * è¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤åˆ¶åŽçš„é“¾è¡¨çš„é¡ºåºå¹¶ä¸ä¸€å®šæ˜¯åŽŸæ¥çš„å€’åº */ for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) &#123; int b = p.hash &amp; n; //nçš„å€¼ä¸ºæ‰©å¼ å‰çš„æ•°ç»„çš„é•¿åº¦ if (b != runBit) &#123; runBit = b; lastRun = p; &#125; &#125; if (runBit == 0) &#123; ln = lastRun; hn = null; &#125; else &#123; hn = lastRun; ln = null; &#125; /* * æž„é€ ä¸¤ä¸ªé“¾è¡¨ï¼Œé¡ºåºå¤§éƒ¨åˆ†å’ŒåŽŸæ¥æ˜¯åçš„ * åˆ†åˆ«æ”¾åˆ°åŽŸæ¥çš„ä½ç½®å’Œæ–°å¢žåŠ çš„é•¿åº¦çš„ç›¸åŒä½ç½®(i/n+i) */ for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) &#123; int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) /* * å‡è®¾runBitçš„å€¼ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºŽæŠŠæ—§çš„åºåˆ—çš„æœ€åŽä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åŽé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—åŽåŒä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åŽä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›žï¼Œç„¶åŽåœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåŽé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else /* * å‡è®¾runBitçš„å€¼ä¸ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºŽæŠŠæ—§çš„åºåˆ—çš„æœ€åŽä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åŽé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—åŽåŒä¸ä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åŽä¸ä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›žï¼Œç„¶åŽåœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåŽé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); &#125; // å…¶ä¸­çš„ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i setTabAt(nextTab, i, ln); // å¦ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i+n setTabAt(nextTab, i + n, hn); // å°†åŽŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ // å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº† setTabAt(tab, i, fwd); // advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯• advance = true; &#125; else if (f instanceof TreeBin) &#123; // çº¢é»‘æ ‘çš„è¿ç§» TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) &#123; int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) &#123; if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; &#125; else &#123; if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; &#125; &#125; // å¦‚æžœä¸€åˆ†ä¸ºäºŒåŽï¼ŒèŠ‚ç‚¹æ•°â‰¤6ï¼Œé‚£ä¹ˆå°†çº¢é»‘æ ‘è½¬æ¢å›žé“¾è¡¨ ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; // å°†lnæ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½®i setTabAt(nextTab, i, ln); // å°†hnæ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½®i+n setTabAt(nextTab, i + n, hn); //å°†åŽŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ //å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº† setTabAt(tab, i, fwd); // advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯• advance = true; &#125; &#125; &#125; &#125; &#125;&#125; æ­¤æ–¹æ³•æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œï¼Œå¤–å›´è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šä¿è¯ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ï¼ŒnextTab å‚æ•°ä¸º nullï¼Œä¹‹åŽå†è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼ŒnextTab ä¸ä¼šä¸º nullã€‚ å…ˆç†è§£ä¸‹å¹¶å‘æ“ä½œçš„æœºåˆ¶ã€‚åŽŸæ•°ç»„é•¿åº¦ä¸º nï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ n ä¸ªè¿ç§»ä»»åŠ¡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£ä¸€ä¸ªå°ä»»åŠ¡æ˜¯æœ€ç®€å•çš„ï¼Œæ¯åšå®Œä¸€ä¸ªä»»åŠ¡å†æ£€æµ‹æ˜¯å¦æœ‰å…¶ä»–æ²¡åšå®Œçš„ä»»åŠ¡ï¼Œå¸®åŠ©è¿ç§»å°±å¯ä»¥äº†ï¼Œè€Œ Doug Lea ä½¿ç”¨äº†ä¸€ä¸ª strideï¼Œç®€å•ç†è§£å°±æ˜¯æ­¥é•¿ï¼Œæ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£è¿ç§»å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æ¯æ¬¡è¿ç§» 16 ä¸ªå°ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå…¨å±€çš„è°ƒåº¦è€…æ¥å®‰æŽ’å“ªä¸ªçº¿ç¨‹æ‰§è¡Œå“ªå‡ ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯å±žæ€§ transferIndex çš„ä½œç”¨ã€‚ ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ä¼šå°† transferIndex æŒ‡å‘åŽŸæ•°ç»„æœ€åŽçš„ä½ç½®ï¼Œç„¶åŽä»ŽåŽå¾€å‰çš„ stride ä¸ªä»»åŠ¡å±žäºŽç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åŽå°† transferIndex æŒ‡å‘æ–°çš„ä½ç½®ï¼Œå†å¾€å‰çš„ stride ä¸ªä»»åŠ¡å±žäºŽç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¾æ­¤ç±»æŽ¨ã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ç¬¬äºŒä¸ªçº¿ç¨‹ä¸æ˜¯çœŸçš„ä¸€å®šæŒ‡ä»£äº†ç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¯»è€…åº”è¯¥èƒ½ç†è§£å§ã€‚å…¶å®žå°±æ˜¯å°†ä¸€ä¸ªå¤§çš„è¿ç§»ä»»åŠ¡åˆ†ä¸ºäº†ä¸€ä¸ªä¸ªä»»åŠ¡åŒ…ã€‚ putTreeVal-æ’å…¥æ ‘ç»“ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778final TreeNode&lt;K,V&gt; putTreeVal(int h, K k, V v) &#123; Class&lt;?&gt; kc = null; boolean searched = false; for (TreeNode&lt;K,V&gt; p = root;;) &#123; int dir, ph; K pk; if (p == null) &#123; // å½“å‰æ¡¶ä¸ºç©ºï¼Œåˆ™ç›´æŽ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ first = root = new TreeNode&lt;K,V&gt;(h, k, v, null, null); break; &#125; else if ((ph = p.hash) &gt; h) // hashå€¼å¤§äºŽå½“å‰keyçš„ï¼Œåœ¨å·¦å­æ ‘ dir = -1; else if (ph &lt; h) // hashå€¼å°äºŽå½“å‰keyçš„ï¼Œåœ¨å³å­æ ‘ dir = 1; else if ((pk = p.key) == k || (pk != null &amp;&amp; k.equals(pk))) // ç­‰äºŽï¼Œåˆ™æ¯”è¾ƒkeyæ˜¯å¦ç›¸ç­‰ return p; else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) &#123; // å¦‚æžœhashå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒä¸‹æ˜¯å¦æ˜¯Stringæˆ–è€…å®žçŽ°äº†ComparableæŽ¥å£ // å¦‚æžœç­‰å‡ºçŽ°äºŒæ¬¡ç¢°æ’žï¼Œåˆ™å·¦å³å­æ ‘éƒ½æœç´¢ if (!searched) &#123; TreeNode&lt;K,V&gt; q, ch; searched = true; // æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ if (((ch = p.left) != null &amp;&amp; (q = ch.findTreeNode(h, k, kc)) != null) || ((ch = p.right) != null &amp;&amp; (q = ch.findTreeNode(h, k, kc)) != null)) // æ‰¾åˆ°ç›´æŽ¥è¿”å›žå³å¯ return q; &#125; // å‡å¦‚æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æ ¹æ®ç±»åã€System.identityHashCodeæ¯”è¾ƒæ¥ç¡®å®šåˆ°åº•æ”¾åœ¨å·¦å³å“ªè¾¹ dir = tieBreakOrder(k, pk); &#125; TreeNode&lt;K,V&gt; xp = p; // æ ¹æ®æ¯”è¾ƒçš„å¤§å°diræ¥ç¡®å®šæ’å…¥å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ if ((p = (dir &lt;= 0) ? p.left : p.right) == null) &#123; TreeNode&lt;K,V&gt; x, f = first; first = x = new TreeNode&lt;K,V&gt;(h, k, v, f, xp); if (f != null) f.prev = x; if (dir &lt;= 0) // &lt;=0 å·¦å­æ ‘ xp.left = x; else // &gt;0 å³å­æ ‘ xp.right = x; if (!xp.red) x.red = true; else &#123; // åŠ é”ï¼Œè°ƒæ•´å¹³è¡¡ lockRoot(); try &#123; root = balanceInsertion(root, x); &#125; finally &#123; unlockRoot(); &#125; &#125; break; &#125; &#125; assert checkInvariants(root); return null;&#125;// å¤šæ¬¡å†²çªç¢°æ’žä¹‹åŽï¼Œå°±ç”¨æ­¤æ¥å†³å®šè°å¤§è°å°ï¼Œä»¥åŒºåˆ†åœ¨å·¦è¿˜æ˜¯åœ¨å³å­æ ‘ä¸Šstatic int tieBreakOrder(Object a, Object b) &#123; int d; if (a == null || b == null || (d = a.getClass().getName(). compareTo(b.getClass().getName())) == 0) d = (System.identityHashCode(a) &lt;= System.identityHashCode(b) ? -1 : 1); return d;&#125; getæ“ä½œ 123456789101112131415161718192021222324public V get(Object key) &#123; Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) &#123; // åˆ¤æ–­å¤´ç»“ç‚¹æ˜¯å¦å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„èŠ‚ç‚¹ if ((eh = e.hash) == h) &#123; if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; &#125; // å¦‚æžœå¤´ç»“ç‚¹çš„ hash å°äºŽ 0ï¼Œè¯´æ˜Ž æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…è¯¥ä½ç½®æ˜¯çº¢é»‘æ ‘ else if (eh &lt; 0) // å‚è€ƒ ForwardingNode.find(int h, Object k) å’Œ TreeBin.find(int h, Object k) return (p = e.find(h, key)) != null ? p.val : null; // éåŽ†é“¾è¡¨ while ((e = e.next) != null) &#123; if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; &#125; &#125; return null;&#125; è®¡ç®— hash å€¼; æ ¹æ® hash å€¼æ‰¾åˆ°æ•°ç»„å¯¹åº”ä½ç½®: (n - 1) &amp; h; æ ¹æ®è¯¥ä½ç½®å¤„ç»“ç‚¹æ€§è´¨è¿›è¡Œç›¸åº”æŸ¥æ‰¾ å¦‚æžœè¯¥ä½ç½®ä¸º nullï¼Œé‚£ä¹ˆç›´æŽ¥è¿”å›ž null å°±å¯ä»¥äº†; å¦‚æžœè¯¥ä½ç½®å¤„çš„èŠ‚ç‚¹åˆšå¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè¿”å›žè¯¥èŠ‚ç‚¹çš„å€¼å³å¯; å¦‚æžœè¯¥ä½ç½®èŠ‚ç‚¹çš„ hash å€¼å°äºŽ 0ï¼Œè¯´æ˜Žæ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…æ˜¯çº¢é»‘æ ‘; å¦‚æžœä»¥ä¸Š 3 æ¡éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±æ˜¯é“¾è¡¨ï¼Œè¿›è¡ŒéåŽ†æ¯”å¯¹å³å¯;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-awkç”¨æ³•]]></title>
    <url>%2Fposts%2Fed2e0218.html</url>
    <content type="text"><![CDATA[å·¥ä½œåŽŸç† è¯»è¾“å…¥æ–‡ä»¶ä¹‹å‰æ‰§è¡Œçš„ä»£ç æ®µï¼ˆç”±BEGINå…³é”®å­—æ ‡è¯†ï¼‰ã€‚ ä¸»å¾ªçŽ¯æ‰§è¡Œè¾“å…¥æ–‡ä»¶çš„ä»£ç æ®µã€‚ è¯»è¾“å…¥æ–‡ä»¶ä¹‹åŽçš„ä»£ç æ®µï¼ˆç”±ENDå…³é”®å­—æ ‡è¯†ï¼‰ã€‚ å‘½ä»¤ç»“æž„ 1awk &apos;BEGIN&#123; commands &#125; pattern&#123; commands &#125; END&#123; commands &#125;&apos; å·¥ä½œæµç¨‹ 1ã€é€šè¿‡å…³é”®å­— BEGIN æ‰§è¡Œ BEGIN å—çš„å†…å®¹ï¼Œå³ BEGIN åŽèŠ±æ‹¬å· {} çš„å†…å®¹ã€‚2ã€å®Œæˆ BEGIN å—çš„æ‰§è¡Œï¼Œå¼€å§‹æ‰§è¡Œbodyå—ã€‚3ã€è¯»å…¥æœ‰ \n æ¢è¡Œç¬¦åˆ†å‰²çš„è®°å½•ã€‚4ã€å°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0 åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ(å³ä¸€è¡Œå†…å®¹)ï¼Œ$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸï¼Œ$n è¡¨ç¤ºç¬¬ n ä¸ªåŸŸã€‚5ã€ä¾æ¬¡æ‰§è¡Œå„ BODY å—ï¼Œpattern éƒ¨åˆ†åŒ¹é…è¯¥è¡Œå†…å®¹æˆåŠŸåŽï¼Œæ‰ä¼šæ‰§è¡Œ awk-commands çš„å†…å®¹ã€‚6ã€å¾ªçŽ¯è¯»å–å¹¶æ‰§è¡Œå„è¡Œç›´åˆ°æ–‡ä»¶ç»“æŸï¼Œå®Œæˆbodyå—æ‰§è¡Œã€‚7ã€å¼€å§‹ END å—æ‰§è¡Œï¼ŒEND å—å¯ä»¥è¾“å‡ºæœ€ç»ˆç»“æžœã€‚ å¼€å§‹å—ï¼ˆBEGINï¼‰ å¼€å§‹å—çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1BEGIN &#123;awk-commands&#125; å¼€å§‹å—å°±æ˜¯åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç éƒ¨åˆ†ï¼Œå¹¶ä¸”å®ƒåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­åªæ‰§è¡Œä¸€æ¬¡ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å§‹å—ä¸­åˆå§‹åŒ–ä¸€äº›å˜é‡ã€‚ BEGIN æ˜¯ AWK çš„å…³é”®å­—ï¼Œå› æ­¤å®ƒå¿…é¡»æ˜¯å¤§å†™çš„ã€‚ æ³¨æ„ï¼šå¼€å§‹å—éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œä½ çš„ç¨‹åºå¯ä»¥æ²¡æœ‰å¼€å§‹å—éƒ¨åˆ†ã€‚ ä¸»ä½“å—ï¼ˆBODYï¼‰ ä¸»ä½“éƒ¨åˆ†çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1/pattern/ &#123;awk-commands&#125; å¯¹äºŽæ¯ä¸€ä¸ªè¾“å…¥çš„è¡Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ä¸»ä½“éƒ¨åˆ†çš„å‘½ä»¤ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºŽè¾“å…¥çš„æ¯ä¸€è¡Œï¼ŒAWK éƒ½ä¼šæ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶é™å®šåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­ã€‚ æ³¨æ„ï¼šåœ¨ä¸»ä½“å—éƒ¨åˆ†æ²¡æœ‰å…³é”®å­—å­˜åœ¨ã€‚ ç»“æŸå—ï¼ˆENDï¼‰ ç»“æŸå—çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1END &#123;awk-commands&#125; ç»“æŸå—æ˜¯åœ¨ç¨‹åºç»“æŸæ—¶æ‰§è¡Œçš„ä»£ç ã€‚ END ä¹Ÿæ˜¯ AWK çš„å…³é”®å­—ï¼Œå®ƒä¹Ÿå¿…é¡»å¤§å†™ã€‚ ä¸Žå¼€å§‹å—ç›¸ä¼¼ï¼Œç»“æŸå—ä¹Ÿæ˜¯å¯é€‰çš„ã€‚ å‘½ä»¤å½¢å¼ 1awk [-F|-f|-v] â€˜BEGIN&#123;&#125; //&#123;command1; command2&#125; END&#123;&#125;â€™ file [-F|-f|-v] å¤§å‚æ•°ï¼Œ-FæŒ‡å®šåˆ†éš”ç¬¦ï¼Œ-fè°ƒç”¨è„šæœ¬ï¼Œ-vå®šä¹‰å˜é‡ var=value ' ' å¼•ç”¨ä»£ç å— BEGIN åˆå§‹åŒ–ä»£ç å—ï¼Œåœ¨å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†ä¹‹å‰ï¼Œåˆå§‹åŒ–ä»£ç ï¼Œä¸»è¦æ˜¯å¼•ç”¨å…¨å±€å˜é‡ï¼Œè®¾ç½®FSåˆ†éš”ç¬¦ // åŒ¹é…ä»£ç å—ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ {} å‘½ä»¤ä»£ç å—ï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡å‘½ä»¤ ï¼› å¤šæ¡å‘½ä»¤ä½¿ç”¨åˆ†å·åˆ†éš” END ç»“å°¾ä»£ç å—ï¼Œåœ¨å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†ä¹‹åŽå†æ‰§è¡Œçš„ä»£ç å—ï¼Œä¸»è¦æ˜¯è¿›è¡Œæœ€ç»ˆè®¡ç®—æˆ–è¾“å‡ºç»“å°¾æ‘˜è¦ä¿¡æ¯ ç‰¹æ®Šè¦ç‚¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243$0 è¡¨ç¤ºæ•´ä¸ªå½“å‰è¡Œ$1 æ¯è¡Œç¬¬ä¸€ä¸ªå­—æ®µNF å­—æ®µæ•°é‡å˜é‡NR æ¯è¡Œçš„è®°å½•å·ï¼Œå¤šæ–‡ä»¶è®°å½•é€’å¢žFNR ä¸ŽNRç±»ä¼¼ï¼Œä¸è¿‡å¤šæ–‡ä»¶è®°å½•ä¸é€’å¢žï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä»Ž1å¼€å§‹\t åˆ¶è¡¨ç¬¦\n æ¢è¡Œç¬¦FS BEGINæ—¶å®šä¹‰åˆ†éš”ç¬¦RS è¾“å…¥çš„è®°å½•åˆ†éš”ç¬¦ï¼Œ é»˜è®¤ä¸ºæ¢è¡Œç¬¦(å³æ–‡æœ¬æ˜¯æŒ‰ä¸€è¡Œä¸€è¡Œè¾“å…¥)~ åŒ¹é…ï¼Œä¸Ž==ç›¸æ¯”ä¸æ˜¯ç²¾ç¡®æ¯”è¾ƒ!~ ä¸åŒ¹é…ï¼Œä¸ç²¾ç¡®æ¯”è¾ƒ== ç­‰äºŽï¼Œå¿…é¡»å…¨éƒ¨ç›¸ç­‰ï¼Œç²¾ç¡®æ¯”è¾ƒ!= ä¸ç­‰äºŽï¼Œç²¾ç¡®æ¯”è¾ƒ&amp;&amp; é€»è¾‘ä¸Ž|| é€»è¾‘æˆ–+ åŒ¹é…æ—¶è¡¨ç¤º1ä¸ªæˆ–1ä¸ªä»¥ä¸Š/[0-9][0-9]+/ ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šæ•°å­—/[0-9][0-9]*/ ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šæ•°å­—FILENAME æ–‡ä»¶åOFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œ é»˜è®¤ä¹Ÿæ˜¯ç©ºæ ¼ï¼Œå¯ä»¥æ”¹ä¸ºåˆ¶è¡¨ç¬¦ç­‰ORS è¾“å‡ºçš„è®°å½•åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦,å³å¤„ç†ç»“æžœä¹Ÿæ˜¯ä¸€è¡Œä¸€è¡Œè¾“å‡ºåˆ°å±å¹•-F&apos;[:#/]&apos; å®šä¹‰ä¸‰ä¸ªåˆ†éš”ç¬¦ æµ‹è¯•å‘½ä»¤ï¼š 1awk &apos;BEGIN&#123;FS=&quot;&quot;&#125;&#123;for(i=1;i&lt;=NF;i++) &#123;if (i==NF)&#123;print $i&#125;else &#123;printf $i&#125;;system(&quot;sleep 0.03&quot;)&#125;&#125;&apos; /etc/fstab awkæ˜¾ç¤ºæ–‡ä»¶ä¸­çš„å†…å®¹ &lt;div class=&quot;note info no-icon&quot;&gt;&lt;p&gt;awkæ˜¾ç¤ºpasswdä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”è®¾ç½®åªæ˜¾ç¤ºå‰é¢5æ¡ä¿¡æ¯ã€‚&lt;/p&gt;&lt;/div&gt; awkå°†passwdä¸­çš„å†…å®¹ä»¥å†’å·ä¸ºåˆ†éš”ï¼Œå¹¶å–å‡ºç¬¬1ï¼Œ3ï¼Œ6ä½çš„æ•°æ® awkå°†passwdä¸­çš„å†…å®¹ä»¥å†’å·ä¸ºåˆ†éš”ï¼Œå¹¶å–å‡ºç¬¬1ï¼Œ3ï¼Œ6ä½çš„æ•°æ®ï¼Œå¹¶ç”¨é‡‡ç”¨tabé”®ä½œä¸ºåˆ†éš”ç¬¦ awkä»¥å†’å·ä¸ºåˆ†éš”ç¬¦ï¼Œæ˜¾ç¤ºä¸€è¡Œä¸­æœ‰å¤šå°‘å­—æ®µ awkå°†æ¯ä¸€è¡Œæœ€åŽçš„ä¸€ä¸ªå­—æ®µæ˜¾ç¤ºå‡ºæ¥ awkåœ¨æ¯ä¸€è¡Œå‰é¢è¾“å‡ºè¡Œå· awkæ˜¾ç¤ºç¬¬å‡ è¡Œçš„æ•°æ® ç»Ÿè®¡æ—¥å¿—æ–‡ä»¶ä¸­æ¯å°æ—¶çš„è¯·æ±‚æ¬¡æ•° 1awk -F: &apos;&#123;a[$2]++&#125;END&#123;for(i in a)&#123;split(i,t);print i&quot; è‡³&quot;,t[1]&quot;:&quot;t[2]+59,&quot; è®¿é—® &quot;a[i] &quot; æ¬¡&quot; | &quot;sort -t: -k1n -k2n&quot;&#125;&#125;&apos; xxx.xxxx.com_access.log-20190512 ç»Ÿè®¡æ—¥å¿—æ–‡ä»¶ä¸­æ¯å°æ—¶æŒ‡å®šè¯·æ±‚å¼€å¤´çš„è¯·æ±‚æ¬¡æ•° 1grep &quot;2019-05-13T23&quot; xxxx.xxxx.com_access.log-20190512|grep &quot;/pppppp&quot;|wc -l æŸ¥javaè¿›ç¨‹ID 1ps -ef|grep java |grep -v java |awk &apos;&#123;print $2&#125;&apos; æ¡ä»¶è¯­å¥ IFè¯­å¥ IF æ¡ä»¶è¯­å¥è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 12if (condition) action ä¹Ÿå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·æ¥æ‰§è¡Œä¸€ç»„æ“ä½œï¼š 12345678if (condition)&#123; action-1 action-1 . . action-n&#125; ä»¥ä¸‹å®žä¾‹ç”¨æ¥åˆ¤æ–­æ•°å­—æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼š 1awk &apos;BEGIN &#123;num = 10; if (num % 2 == 0) printf &quot;%d æ˜¯å¶æ•°\n&quot;, num &#125;&apos; IF - ELSE è¯­å¥ IF - ELSE æ¡ä»¶è¯­å¥è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1234if (condition) action-1else action-2 åœ¨æ¡ä»¶è¯­å¥ condition ä¸º true æ—¶åªéœ€ action-1ï¼Œå¦åˆ™æ‰§è¡Œ action-2ã€‚ 12345awk &apos;BEGIN &#123; num = 11; if (num % 2 == 0) printf &quot;%d æ˜¯å¶æ•°\n&quot;, num; else printf &quot;%d æ˜¯å¥‡æ•°\n&quot;, num &#125;&apos; IF - ELSE - IF å¯ä»¥åˆ›å»ºå¤šä¸ª IF - ELSE æ ¼å¼çš„åˆ¤æ–­è¯­å¥æ¥å®žçŽ°å¤šä¸ªæ¡ä»¶çš„åˆ¤æ–­ï¼š 123456789awk &apos;BEGIN &#123;a=30;if (a==10) print &quot;a = 10&quot;;else if (a == 20) print &quot;a = 20&quot;;else if (a == 30) print &quot;a = 30&quot;;&#125;&apos; å¾ªçŽ¯è¯­å¥ Forå¾ªçŽ¯ For å¾ªçŽ¯çš„è¯­æ³•å¦‚ä¸‹ï¼š 12for (initialisation; condition; increment/decrement) action for è¯­å¥é¦–å…ˆæ‰§è¡Œåˆå§‹åŒ–åŠ¨ä½œ( initialisation )ï¼Œç„¶åŽå†æ£€æŸ¥æ¡ä»¶( condition )ã€‚ å¦‚æžœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡ŒåŠ¨ä½œ( action )ï¼Œç„¶åŽæ‰§è¡Œé€’å¢ž( increment )æˆ–è€…é€’å‡( decrement )æ“ä½œã€‚ åªè¦æ¡ä»¶ä¸º true å¾ªçŽ¯å°±ä¼šä¸€ç›´æ‰§è¡Œã€‚æ¯æ¬¡å¾ªçŽ¯ç»“æŸéƒ½ä¼šè¿›æ¡ä»¶æ£€æŸ¥ï¼Œè‹¥æ¡ä»¶ä¸º false åˆ™ç»“æŸå¾ªçŽ¯ã€‚ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ For å¾ªçŽ¯è¾“å‡ºæ•°å­— 1 è‡³ 5ï¼š 1awk &apos;BEGIN &#123; for (i = 1; i &lt;= 5; ++i) print i &#125;&apos; Whileå¾ªçŽ¯ While å¾ªçŽ¯çš„è¯­æ³•å¦‚ä¸‹ï¼š 12while (condition) action While å¾ªçŽ¯é¦–å…ˆæ£€æŸ¥æ¡ä»¶ condition æ˜¯å¦ä¸º true ï¼Œè‹¥æ¡ä»¶ä¸º true åˆ™æ‰§è¡ŒåŠ¨ä½œ actionã€‚æ­¤è¿‡ç¨‹ä¸€ç›´é‡å¤ç›´åˆ°æ¡ä»¶ condition ä¸º flase æ‰åœæ­¢ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨ While å¾ªçŽ¯è¾“å‡ºæ•°å­— 1 åˆ° 5 çš„ä¾‹å­ï¼š 1awk &apos;BEGIN &#123;i = 1; while (i &lt; 6) &#123; print i; ++i &#125; &#125;&apos; Break ç»ˆæ­¢å¾ªçŽ¯ åœ¨ä¸‹é¢çš„ç¤ºä¾‹å­ä¸­ï¼Œå½“è®¡ç®—çš„å’Œå¤§äºŽ 50 çš„æ—¶å€™ä½¿ç”¨ break ç»“æŸå¾ªçŽ¯ï¼š 12345awk &apos;BEGIN &#123; sum = 0; for (i = 0; i &lt; 20; ++i) &#123; sum += i; if (sum &gt; 50) break; else print &quot;Sum =&quot;, sum &#125; &#125;&apos; Continue ç»“æŸæœ¬æ¬¡å¾ªçŽ¯è¿›å…¥ä¸‹æ¬¡å¾ªçŽ¯ Continue è¯­å¥ç”¨äºŽåœ¨å¾ªçŽ¯ä½“å†…éƒ¨ç»“æŸæœ¬æ¬¡å¾ªçŽ¯ï¼Œä»Žè€Œç›´æŽ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªçŽ¯è¿­ä»£ã€‚ ä¸‹é¢çš„ä¾‹å­è¾“å‡º 1 åˆ° 20 ä¹‹é—´çš„å¶æ•°ï¼š 1awk &apos;BEGIN &#123;for (i = 1; i &lt;= 20; ++i) &#123;if (i % 2 == 0) print i ; else continue&#125; &#125;&apos; Exit ç»“æŸç¨‹åº è¯¥å‡½æ•°æŽ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°è¡¨ç¤º AWK è¿›ç¨‹ç»“æŸçŠ¶æ€ã€‚ å¦‚æžœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œå…¶é»˜è®¤çŠ¶æ€ä¸º 0ã€‚ ä¸‹é¢ä¾‹å­ä¸­å½“å’Œå¤§äºŽ 50 æ—¶ç»“æŸ AWK ç¨‹åºã€‚ 12345awk &apos;BEGIN &#123; sum = 0; for (i = 0; i &lt; 20; ++i) &#123; sum += i; if (sum &gt; 50) exit(10); else print &quot;Sum =&quot;, sum &#125; &#125;&apos;]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼]]></title>
    <url>%2Fposts%2F6f592ef9.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å¤–è§‚æ¨¡å¼ï¼Œåˆç§°ä¸ºé—¨é¢æ¨¡å¼ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨é¢‘çŽ‡éžå¸¸é«˜çš„ç»“æž„åž‹è®¾è®¡æ¨¡å¼ï¼Œæ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„ä¸€ç§å…·ä½“å®žçŽ°ï¼Œå®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªå¤–è§‚è§’è‰²æ¥ç®€åŒ–å®¢æˆ·ç«¯ä¸Žå­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œä¸ºå¤æ‚çš„å­ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œé™ä½Žå­ç³»ç»Ÿä¸Žå®¢æˆ·ç«¯çš„è€¦åˆåº¦ï¼Œä¸”å®¢æˆ·ç«¯è°ƒç”¨éžå¸¸æ–¹ä¾¿ã€‚å¦‚ä¸‹å›¾ï¼š ä¸¾ä¸ªä¾‹å­ï¼šå¦‚ç½‘ç«™å¯¼èˆª ä¸»è¦ä½œç”¨ å®žçŽ°å®¢æˆ·ç±»ä¸Žå­ç³»ç»Ÿç±»çš„æ¾è€¦åˆï¼› é™ä½ŽåŽŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦ï¼› æé«˜äº†å®¢æˆ·ç«¯ä½¿ç”¨çš„ä¾¿æ·æ€§ï¼Œä½¿å¾—å®¢æˆ·ç«¯æ— é¡»å…³å¿ƒå­ç³»ç»Ÿçš„å·¥ä½œç»†èŠ‚ï¼Œé€šè¿‡å¤–è§‚è§’è‰²å³å¯è°ƒç”¨ç›¸å…³åŠŸèƒ½ã€‚ UMLç±»å›¾ è§’è‰² å¤–è§‚è§’è‰²ï¼ˆFacadeï¼‰ï¼šä¹Ÿç§° é—¨é¢è§’è‰²ï¼Œç³»ç»Ÿå¯¹å¤–çš„ç»Ÿä¸€æŽ¥å£ï¼› å­ç³»ç»Ÿè§’è‰²ï¼ˆSubSystemï¼‰ï¼šå¯ä»¥åŒæ—¶æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª SubSystemã€‚æ¯ä¸ª SubSytem éƒ½ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»çš„é›†åˆã€‚SubSystem å¹¶ä¸çŸ¥é“ Facade çš„å­˜åœ¨ï¼Œå¯¹äºŽ SubSystem è€Œè¨€ï¼ŒFacade åªæ˜¯å¦ä¸€ä¸ªå®¢æˆ·ç«¯è€Œå·²ï¼ˆå³ Facade å¯¹ SubSystem é€æ˜Žï¼‰ã€‚ å¤–è§‚æ¨¡å¼çš„ç›®çš„ä¸æ˜¯ç»™äºˆå­ç³»ç»Ÿæ·»åŠ æ–°çš„åŠŸèƒ½æŽ¥å£ï¼Œè€Œæ˜¯ä¸ºäº†è®©å¤–éƒ¨å‡å°‘ä¸Žå­ç³»ç»Ÿå†…å¤šä¸ªæ¨¡å—çš„äº¤äº’ï¼Œæ¾æ•£è€¦åˆï¼Œä»Žè€Œè®©å¤–éƒ¨èƒ½å¤Ÿæ›´ç®€å•åœ°ä½¿ç”¨å­ç³»ç»Ÿã€‚ å¤–è§‚æ¨¡å¼çš„æœ¬è´¨æ˜¯ï¼šå°è£…äº¤äº’ï¼Œç®€åŒ–è°ƒç”¨ã€‚ æ¨¡å¼ä¼˜ç‚¹ é™ä½Žäº†å®¢æˆ·ç±»ä¸Žå­ç³»ç»Ÿç±»çš„è€¦åˆåº¦ï¼Œå®žçŽ°äº†å­ç³»ç»Ÿä¸Žå®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼› åªæ˜¯æä¾›äº†ä¸€ä¸ªè®¿é—®å­ç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼Œå¹¶ä¸å½±å“ç”¨æˆ·ç›´æŽ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼› å‡å°‘äº†ä¸Žå­ç³»ç»Ÿçš„å…³è”å¯¹è±¡ï¼Œå®žçŽ°äº†å­ç³»ç»Ÿä¸Žå®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼Œæ¾è€¦åˆä½¿å¾—å­ç³»ç»Ÿçš„ç»„ä»¶å˜åŒ–ä¸ä¼šå½±å“åˆ°å®ƒçš„å®¢æˆ·ã€‚ å¤–è§‚æ¨¡å¼å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œä»Žè€Œç®€åŒ–äº†æŽ¥å£ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®å¹¶ä½¿å­ç³»ç»Ÿçš„ä½¿ç”¨æ›´åŠ ç®€å•ã€‚ å¼•å…¥å¤–è§‚è§’è‰²ä¹‹åŽï¼Œç”¨æˆ·åªéœ€è¦ä¸Žå¤–è§‚è§’è‰²äº¤äº’ï¼› ç”¨æˆ·ä¸Žå­ç³»ç»Ÿä¹‹é—´çš„å¤æ‚é€»è¾‘å…³ç³»ç”±å¤–è§‚è§’è‰²æ¥å®žçŽ°ã€‚ é™ä½ŽåŽŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œå¹¶ç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ã€‚ å› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸€èˆ¬ä¸éœ€è¦ç¼–è¯‘æ‰€æœ‰å…¶ä»–çš„å­ç³»ç»Ÿã€‚ä¸€ä¸ªå­ç³»ç»Ÿçš„ä¿®æ”¹å¯¹å…¶ä»–å­ç³»ç»Ÿæ²¡æœ‰ä»»ä½•å½±å“ï¼Œè€Œä¸”å­ç³»ç»Ÿå†…éƒ¨å˜åŒ–ä¹Ÿä¸ä¼šå½±å“åˆ°å¤–è§‚å¯¹è±¡ã€‚ æ¨¡å¼ç¼ºç‚¹ ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ç«¯ç›´æŽ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¦‚æžœå¯¹å®¢æˆ·ç«¯è®¿é—®å­ç³»ç»Ÿç±»åšå¤ªå¤šçš„é™åˆ¶åˆ™å‡å°‘äº†å¯å˜æ€§å’Œçµæ´»æ€§ã€‚ åœ¨ä¸å¼•å…¥æŠ½è±¡å¤–è§‚ç±»çš„æƒ…å†µä¸‹ï¼Œå¢žåŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŽŸåˆ™â€ã€‚ é€‚ç”¨åœºæ™¯ ä¸ºä¸€ä¸ªå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€æ´çš„ä¾›å¤–ç•Œè®¿é—®çš„æŽ¥å£ï¼› å¸Œæœ›æé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§æ—¶ï¼› é¢„é˜²ä»£ç æ±¡æŸ“ï¼šå½“å­ç³»ç»Ÿç”±äºŽä¸å¯é¿å…çš„æš‚æ—¶åŽŸå› å¯¼è‡´å¯èƒ½å­˜åœ¨ bug æˆ–æ€§èƒ½ç›¸å…³é—®é¢˜æ—¶ï¼Œå¯ä»¥é€šè¿‡ å¤–è§‚æ¨¡å¼ æä¾›ä¸€ä¸ªé«˜å±‚æŽ¥å£ï¼Œéš”ç¦»å®¢æˆ·ç«¯ä¸Žå­ç³»ç»Ÿçš„ç›´æŽ¥äº¤äº’ï¼Œæ–¹ä¾¿åŽç»­é—®é¢˜ä¿®æ”¹ï¼› åœ¨å±‚æ¬¡åŒ–ç»“æž„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ï¼Œå±‚ä¸Žå±‚ä¹‹é—´ä¸ç›´æŽ¥äº§ç”Ÿè”ç³»ï¼Œè€Œé€šè¿‡å¤–è§‚ç±»å»ºç«‹è”ç³»ï¼Œé™ä½Žå±‚ä¹‹é—´çš„è€¦åˆåº¦ã€‚ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºå¤–è§‚è§’è‰² 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å¤–è§‚è§’è‰²Facade */public class Facade &#123; /** * å­ç³»ç»ŸA */ private SubSystemA a = new SubSystemA(); /** * å­ç³»ç»ŸB */ private SubSystemB b = new SubSystemB(); /** * å­ç³»ç»ŸC */ private SubSystemC c = new SubSystemC(); // å¯¹å¤–æŽ¥å£ public void doA() &#123; this.a.doA(); &#125; // å¯¹å¤–æŽ¥å£ public void doB() &#123; this.b.doB(); &#125; // å¯¹å¤–æŽ¥å£ public void doC() &#123; this.c.doC(); &#125;&#125; åˆ›å»ºå­ç³»ç»Ÿ 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸA */public class SubSystemA &#123; public void doA() &#123; System.out.println("å¤„ç†Aç³»ç»Ÿçš„ä¸šåŠ¡..."); &#125;&#125;package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸB */public class SubSystemB &#123; public void doB() &#123; System.out.println("å¤„ç†Bç³»ç»Ÿçš„ä¸šåŠ¡..."); &#125;&#125;package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸC */public class SubSystemC &#123; public void doC() &#123; System.out.println("å¤„ç†Cç³»ç»Ÿçš„ä¸šåŠ¡..."); &#125;&#125; æµ‹è¯•ç±» 1234567891011121314package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; Facade facade = new Facade(); facade.doA(); facade.doB(); facade.doC(); &#125;&#125; ä¸Žé€‚é…æ¨¡å¼çš„åŒºåˆ« å¤–è§‚æ¨¡å¼çš„å®žçŽ°æ ¸å¿ƒä¸»è¦æ˜¯â€”â€”ç”±å¤–è§‚ç±»åŽ»ä¿å­˜å„ä¸ªå­ç³»ç»Ÿçš„å¼•ç”¨ï¼Œå®žçŽ°ç”±ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚ç±»åŽ»åŒ…è£…å¤šä¸ªå­ç³»ç»Ÿç±»ï¼Œç„¶è€Œå®¢æˆ·ç«¯åªéœ€è¦å¼•ç”¨è¿™ä¸ªå¤–è§‚ç±»ï¼Œç„¶åŽç”±å¤–è§‚ç±»æ¥è°ƒç”¨å„ä¸ªå­ç³»ç»Ÿä¸­çš„æ–¹æ³•ã€‚ è¿™æ ·çš„å®žçŽ°æ–¹å¼éžå¸¸ç±»ä¼¼é€‚é…å™¨æ¨¡å¼ï¼Œç„¶è€Œå¤–è§‚æ¨¡å¼ä¸Žé€‚é…å™¨æ¨¡å¼ä¸åŒçš„æ˜¯ï¼šé€‚é…å™¨æ¨¡å¼æ˜¯å°†ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ä»¥æ”¹å˜å…¶æŽ¥å£ï¼Œè€Œå¤–è§‚æ˜¯å°†ä¸€ç¾¤å¯¹è±¡ â€åŒ…è£…â€œèµ·æ¥ä»¥ç®€åŒ–å…¶æŽ¥å£ã€‚å®ƒä»¬çš„æ„å›¾æ˜¯ä¸ä¸€æ ·çš„ï¼Œé€‚é…å™¨æ˜¯å°†æŽ¥å£è½¬æ¢ä¸ºä¸åŒæŽ¥å£ï¼Œè€Œå¤–è§‚æ¨¡å¼æ˜¯æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æŽ¥å£æ¥ç®€åŒ–æŽ¥å£ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œåŸºç¡€å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fb2437d15.html</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æž„ ä½“ç³»ä»‹ç» è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æž„åˆ†ä¸º3ç§ï¼šOSIä½“ç³»ç»“æž„ã€TCP / IPä½“ç³»ç»“æž„ã€äº”å±‚ä½“ç³»ç»“æž„ ä½Žä¸‰å±‚ä¸ºé€šä¿¡å­ç½‘ï¼Œè´Ÿè´£æ•°æ®ä¼ è¾“ï¼› é«˜ä¸‰å±‚ä¸ºèµ„æºå­ç½‘ï¼Œç›¸å½“äºŽè®¡ç®—æœºç³»ç»Ÿï¼Œå®Œæˆæ•°æ®å¤„ç†ï¼› ä¼ è¾“å±‚æ‰¿ä¸Šå¯ä¸‹ï¼› TCP/IPä½“ç³»ç»“æž„è¯¦ä»‹ OSIä½“ç³»ç»“æž„è¯¦ä»‹ TCP åè®® å®šä¹‰ Transmission Control Protocolï¼Œå³ ä¼ è¾“æŽ§åˆ¶åè®®ï¼Œå±žäºŽä¼ è¾“å±‚é€šä¿¡åè®®ï¼ŒåŸºäºŽTCPçš„åº”ç”¨å±‚åè®®æœ‰HTTPã€SMTPã€FTPã€Telnet å’Œ POP3ã€‚ ç‰¹ç‚¹ é¢å‘è¿žæŽ¥ï¼šä½¿ç”¨TCPä¼ è¾“æ•°æ®å‰ï¼Œå¿…é¡»å…ˆå»ºç«‹TCPè¿žæŽ¥ï¼›ä¼ è¾“å®ŒæˆåŽå†é‡Šæ”¾è¿žæŽ¥ã€‚ å…¨åŒå·¥é€šä¿¡ï¼šå»ºç«‹TCPè¿žæŽ¥åŽï¼Œé€šä¿¡åŒæ–¹éƒ½èƒ½å‘é€æ•°æ®ã€‚ å¯é ï¼šé€šè¿‡TCPè¿žæŽ¥ä¼ é€æ•°æ®ï¼šä¸ä¸¢å¤±ã€æ— å·®é”™ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾ã€‚ é¢å‘å­—èŠ‚æµï¼šæ•°æ®ä»¥æµçš„å½¢å¼è¿›è¡Œä¼ è¾“ã€‚ æŠ¥æ–‡æ®µæ ¼å¼ æŠ¥æ–‡æ®µ = é¦–éƒ¨ + æ•°æ® 2éƒ¨åˆ† ä¸‹é¢åˆ†åˆ«å¯¹å…¶ä¸­çš„å­—æ®µè¿›è¡Œä»‹ç»ï¼š æºç«¯å£å’Œç›®çš„ç«¯å£ï¼šå„å 2ä¸ªå­—èŠ‚ï¼Œè¿™ä¸¤ä¸ªå€¼åŠ ä¸ŠIPé¦–éƒ¨ä¸­çš„æºç«¯IPåœ°å€å’Œç›®çš„ç«¯IPåœ°å€å”¯ä¸€ç¡®å®šä¸€ä¸ªTCPè¿žæŽ¥ã€‚æœ‰æ—¶ä¸€ä¸ªIPåœ°å€å’Œä¸€ä¸ªç«¯å£å·ä¹Ÿç§°ä¸ºsocketï¼ˆæ’å£ï¼‰ã€‚åºå·ï¼šå 4ä¸ªå­—èŠ‚ï¼Œæ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®é¡¹ç›®ç»„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚åœ¨TCPä¼ é€çš„æ•°æ®æµä¸­ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªåºå·ã€‚ä¾‹å¦‚ï¼Œä¸€æŠ¥æ–‡æ®µçš„åºå·ä¸º300ï¼Œè€Œä¸”æ•°æ®å…±100å­—èŠ‚ï¼Œåˆ™ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å°±æ˜¯400ï¼›åºå·æ˜¯32bitçš„æ— ç¬¦å·æ•°ï¼Œåºå·åˆ°è¾¾2^32-1åŽä»Ž0å¼€å§‹ã€‚ï¼ˆæ³¨ï¼šå¦‚ä½•é˜²æ­¢ä»Ž0å¼€å§‹åŽåºå·ç›¸åŒçš„é—®é¢˜ï¼‰ç¡®è®¤åºå·ï¼šå 4å­—èŠ‚ï¼Œæ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹æ¬¡å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼Œä¹Ÿå°±æ˜¯æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„é¦–éƒ¨ä¸­çš„åºå·ï¼›ç¡®è®¤åºå·åº”è¯¥æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·+1ã€‚åªæœ‰ACKæ ‡å¿—ä¸º1æ—¶ï¼Œç¡®è®¤åºå·æ‰æœ‰æ•ˆã€‚æ•°æ®åç§»ï¼šå 4æ¯”ç‰¹ï¼Œè¡¨ç¤ºæ•°æ®å¼€å§‹çš„åœ°æ–¹ç¦»TCPæ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚å®žé™…ä¸Šå°±æ˜¯TCPæ®µé¦–éƒ¨çš„é•¿åº¦ã€‚ç”±äºŽé¦–éƒ¨é•¿åº¦ä¸å›ºå®šï¼Œå› æ­¤æ•°æ®åç§»å­—æ®µæ˜¯å¿…è¦çš„ã€‚æ•°æ®åç§»ä»¥32ä½ä¸ºé•¿åº¦å•ä½ï¼Œä¹Ÿå°±æ˜¯4ä¸ªå­—èŠ‚ï¼Œå› æ­¤TCPé¦–éƒ¨çš„æœ€å¤§é•¿åº¦æ˜¯60ä¸ªå­—èŠ‚ã€‚å³åç§»æœ€å¤§ä¸º15ä¸ªé•¿åº¦å•ä½=1532ä½=154å­—èŠ‚ã€‚ä¿ç•™ï¼š 6æ¯”ç‰¹ï¼Œä¾›ä»¥åŽåº”ç”¨ï¼ŒçŽ°åœ¨ç½®ä¸º0ã€‚6ä¸ªæ ‡å¿—ä½æ¯”ç‰¹ï¼šURGï¼šå½“URG=1æ—¶ï¼Œæ³¨è§£æ­¤æŠ¥æ–‡åº”å°½å¿«ä¼ é€ï¼Œè€Œä¸è¦æŒ‰æœ¬æ¥çš„åˆ—é˜Ÿæ¬¡åºæ¥ä¼ é€ã€‚ä¸Žâ€œç´§æ€¥æŒ‡é’ˆâ€å­—æ®µå…±åŒåº”ç”¨ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºåœ¨æœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼Œä½¿æŽ¥ç®¡æ–¹å¯ä»¥çŸ¥é“ç´§æ€¥æ•°æ®å…±æœ‰å¤šé•¿ï¼›ACKï¼šåªæœ‰å½“ACK=1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼›PSHï¼šå½“PSH=1æ—¶ï¼ŒæŽ¥æ”¶æ–¹åº”è¯¥å°½å¿«å°†æœ¬æŠ¥æ–‡æ®µç«‹å³ä¼ é€ç»™å…¶åº”ç”¨å±‚ï¼›RSTï¼šå½“RST=1æ—¶ï¼Œè¡¨ç¤ºå‡ºçŽ°è¿žæŽ¥é”™è¯¯ï¼Œå¿…é¡»é‡Šæ”¾è¿žæŽ¥ï¼Œç„¶åŽå†é‡å»ºä¼ è¾“è¿žæŽ¥ã€‚å¤ä½æ¯”ç‰¹è¿˜ç”¨æ¥æ‹’ç»ä¸€ä¸ªä¸æ³•çš„æŠ¥æ–‡æ®µæˆ–æ‹’ç»æ‰“å¼€ä¸€ä¸ªè¿žæŽ¥ï¼›SYNï¼šSYN=1,ACK=0æ—¶è¡¨ç¤ºè¯·æ±‚å»ºç«‹ä¸€ä¸ªè¿žæŽ¥ï¼Œæºå¸¦SYNæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºåŒæ­¥æŠ¥æ–‡æ®µï¼›FINï¼šå‘ç«¯å®Œæˆå‘é€ä»»åŠ¡ã€‚çª—å£ï¼šTCPé€šè¿‡æ»‘åŠ¨çª—å£çš„æ¦‚å¿µæ¥è¿›è¡Œæµé‡æŽ§åˆ¶ã€‚è®¾æƒ³åœ¨å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿåº¦å¾ˆå¿«è€ŒæŽ¥æ”¶ç«¯æŽ¥æ”¶é€Ÿåº¦å´å¾ˆæ…¢çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ˜¾ç„¶éœ€è¦è¿›è¡Œæµé‡æŽ§åˆ¶ï¼Œ åè°ƒå¥½é€šä¿¡åŒæ–¹çš„å·¥ä½œèŠ‚å¥ã€‚æ‰€è°“æ»‘åŠ¨çª—å£ï¼Œå¯ä»¥ç†è§£æˆæŽ¥æ”¶ç«¯æ‰€èƒ½æä¾›çš„ç¼“å†²åŒºå¤§å°ã€‚TCPåˆ©ç”¨ä¸€ä¸ªæ»‘åŠ¨çš„çª—å£æ¥å‘Šè¯‰å‘é€ç«¯å¯¹å®ƒæ‰€å‘é€çš„æ•°æ®èƒ½æä¾›å¤šå¤§çš„ç¼“å†²åŒºã€‚çª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œèµ·å§‹äºŽç¡®è®¤åºå·å­—æ®µæŒ‡æ˜Žçš„å€¼ï¼ˆè¿™ä¸ªå€¼æ˜¯æŽ¥æ”¶ç«¯æ­£æœŸæœ›æŽ¥æ”¶çš„å­—èŠ‚ï¼‰ã€‚çª—å£å¤§å°æ˜¯ä¸€ä¸ª16bitå­—æ®µï¼Œå› è€Œçª—å£å¤§å°æœ€å¤§ä¸º65535å­—èŠ‚ã€‚æ£€éªŒå’Œï¼šæ£€éªŒå’Œè¦†ç›–äº†æ•´ä¸ªTCPæŠ¥æ–‡æ®µï¼šTCPé¦–éƒ¨å’Œæ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„å­—æ®µï¼Œä¸€å®šæ˜¯ç”±å‘ç«¯è®¡ç®—å’Œå­˜å‚¨ï¼Œå¹¶ç”±æ”¶ç«¯è¿›è¡ŒéªŒè¯ã€‚ç´§æ€¥æŒ‡é’ˆï¼šåªæœ‰å½“URGæ ‡å¿—ç½®1æ—¶ç´§æ€¥æŒ‡é’ˆæ‰æœ‰æ•ˆã€‚ç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ï¼Œå’Œåºå·å­—æ®µä¸­çš„å€¼ç›¸åŠ è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ å»ºç«‹è¿žæŽ¥-ä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹è¯´æ˜Žï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ—¶æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· Seq=X ï¼Œæ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æŽ‰ä¸€ä¸ªåºå·ã€‚ TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åŽï¼Œå¦‚æžœåŒæ„è¿žæŽ¥ï¼Œåˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­åº”è¯¥ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯Ack=X+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· Seq=Yï¼Œæ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åŽï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼ŒAck=Y+1ï¼Œè‡ªå·±çš„åºåˆ—å·Seq=X+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿žæŽ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿žæŽ¥ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æžœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚ å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åŽä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤åŽåŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ ä¸ºä»€ä¹ˆTCPå»ºç«‹è¿žæŽ¥éœ€ä¸‰æ¬¡æ¡æ‰‹ é¦–å…ˆè¦çŸ¥é“ä¿¡é“æ˜¯ä¸å¯é çš„ï¼Œä½†æ˜¯è¦å»ºç«‹å¯é çš„è¿žæŽ¥å‘é€å¯é çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“æ˜¯éœ€è¦å¯é çš„ã€‚åœ¨è¿™ä¸ªæ—¶å€™ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸€ä¸ªç†è®ºä¸Šçš„æœ€å°å€¼ï¼Œå¹¶ä¸æ˜¯è¯´æ˜¯tcpåè®®è¦æ±‚çš„ï¼Œè€Œæ˜¯ä¸ºäº†æ»¡è¶³åœ¨ä¸å¯é çš„ä¿¡é“ä¸Šä¼ è¾“å¯é çš„æ•°æ®æ‰€è¦æ±‚çš„ã€‚ åœ¨ã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸€ä¹¦ä¸­å…¶ä¸­æœ‰æåˆ°ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯â€œä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ åˆ°æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯â€è¿™ç§æƒ…å†µæ˜¯ï¼šä¸€ç«¯(client)Aå‘å‡ºåŽ»çš„ç¬¬ä¸€ä¸ªè¿žæŽ¥è¯·æ±‚æŠ¥æ–‡å¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯å› ä¸ºæŸäº›æœªçŸ¥çš„åŽŸå› åœ¨æŸä¸ªç½‘ç»œèŠ‚ç‚¹ä¸Šå‘ç”Ÿæ»žç•™ï¼Œå¯¼è‡´å»¶è¿Ÿåˆ°è¿žæŽ¥é‡Šæ”¾ä»¥åŽçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾å¦ä¸€ç«¯(server)Bã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µï¼Œä½†æ˜¯Bæ”¶åˆ°æ­¤å¤±æ•ˆçš„æŠ¥æ–‡ä¹‹åŽï¼Œä¼šè¯¯è®¤ä¸ºæ˜¯Aå†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿žæŽ¥è¯·æ±‚ï¼ŒäºŽæ˜¯Bç«¯å°±å‘Aåˆå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿žæŽ¥ã€‚å¦‚æžœä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦Bç«¯å‘å‡ºç¡®è®¤æŠ¥æ–‡å°±ä¼šè®¤ä¸ºæ–°çš„è¿žæŽ¥å·²ç»å»ºç«‹äº†ï¼Œä½†æ˜¯Aç«¯å¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿žæŽ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šåŽ»å‘Bç«¯å‘é€æ•°æ®ï¼ŒBç«¯æ²¡æœ‰æ”¶åˆ°æ•°æ®å°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè¿™æ ·Bç«¯å°±ä¼šç™½ç™½æµªè´¹æŽ‰å¾ˆå¤šèµ„æºã€‚å¦‚æžœé‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€çš„è¯å°±ä¸ä¼šå‡ºçŽ°è¿™ç§æƒ…å†µï¼ŒBç«¯æ”¶åˆ°ä¸€ä¸ªè¿‡æ—¶å¤±æ•ˆçš„æŠ¥æ–‡æ®µä¹‹åŽï¼Œå‘Aç«¯å‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶Aå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿žæŽ¥ï¼Œæ‰€ä»¥å°±ä¸ä¼šå‘Bç«¯å‘é€ç¡®è®¤ï¼Œè¿™ä¸ªæ—¶å€™Bç«¯ä¹Ÿèƒ½å¤ŸçŸ¥é“è¿žæŽ¥æ²¡æœ‰å»ºç«‹ã€‚ é‡Šæ”¾è¿žæŽ¥-å››æ¬¡æŒ¥æ‰‹ è¿‡ç¨‹è¯´æ˜Žï¼š å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºŽå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºŽåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æŽ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åŽï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æŽ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åŽçš„æ•°æ®ï¼‰ã€‚ æœåŠ¡å™¨å°†æœ€åŽçš„æ•°æ®å‘é€å®Œæ¯•åŽï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºŽåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åŽç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿žæŽ¥é‡Šæ”¾æŠ¥æ–‡åŽï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿žæŽ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åŽï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåŽï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚ æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåŽï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿žæŽ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿žæŽ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚ ä¸ºä»€ä¹ˆTCPé‡Šæ”¾è¿žæŽ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹ ä¸ºäº†ä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€åŽ1ä¸ªè¿žæŽ¥é‡Šæ”¾ç¡®è®¤æŠ¥æ–‡èƒ½åˆ°è¾¾æœåŠ¡å™¨ï¼Œä»Žè€Œä½¿å¾—æœåŠ¡å™¨èƒ½æ­£å¸¸é‡Šæ”¾è¿žæŽ¥ã€‚ å…³é—­è¿žæŽ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡é€šçŸ¥æ—¶ï¼Œå®ƒä»…ä»…è¡¨ç¤ºå¯¹æ–¹æ²¡æœ‰æ•°æ®å‘é€ç»™ä½ äº†ï¼Œä½†æœªå¿…ä½ æ‰€æœ‰çš„æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥ä½ ä¸å¿…é©¬ä¸Šå…³é—­SOCKETï¼Œä¹Ÿå³ä½ å¯èƒ½è¿˜éœ€è¦å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹ä¹‹åŽï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºä½ åŒæ„å…³é—­è¿žæŽ¥äº†ï¼Œæ‰€ä»¥å®ƒè¿™é‡Œçš„ACKæŠ¥æ–‡å’ŒFINæŠ¥æ–‡å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯åˆ†å¼€å‘é€çš„ã€‚ é˜²æ­¢ä¸Šæ–‡æåˆ°çš„æ—©å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡å‡ºçŽ°åœ¨æœ¬è¿žæŽ¥ä¸­ã€‚ å®¢æˆ·ç«¯å‘é€äº†æœ€åŽ1ä¸ªè¿žæŽ¥é‡Šæ”¾è¯·æ±‚ç¡®è®¤æŠ¥æ–‡åŽï¼Œå†ç»è¿‡2MSLæ—¶é—´ï¼Œåˆ™å¯ä½¿æœ¬è¿žæŽ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»Žç½‘ç»œä¸­æ¶ˆå¤±ã€‚å³åœ¨ä¸‹1ä¸ªæ–°çš„è¿žæŽ¥ä¸­å°±ä¸ä¼šå‡ºçŽ°æ—©å·²å¤±æ•ˆçš„è¿žæŽ¥è¯·æ±‚æŠ¥æ–‡ã€‚ é‡Šæ”¾è¿žæŽ¥æ—¶ä¸ºä»€ä¹ˆTIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLæ—¶é—´ é¦–å…ˆè¯´ä¸‹ä»€ä¹ˆæ˜¯MSL: MSLæ˜¯Maximum Segment Lifetimeè‹±æ–‡çš„ç¼©å†™ï¼Œä¸­æ–‡å¯ä»¥è¯‘ä¸ºâ€œæŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´â€ï¼Œä»–æ˜¯ä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚ ç¬¬ä¸€ï¼Œä¸ºäº†ä¿è¯Aå‘é€çš„æœ€åŽä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾Bã€‚è¿™ä¸ªACKæŠ¥æ–‡æ®µæœ‰å¯èƒ½ä¸¢å¤±ï¼Œå› è€Œä½¿å¤„åœ¨LAST-ACKçŠ¶æ€çš„Bæ”¶ä¸åˆ°å¯¹å·²å‘é€çš„FIN+ACKæŠ¥æ–‡æ®µçš„ç¡®è®¤ã€‚Bä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ªFIN+ACKæŠ¥æ–‡æ®µï¼Œè€ŒAå°±èƒ½åœ¨2MSLæ—¶é—´å†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„FIN+ACKæŠ¥æ–‡æ®µï¼Œé‡ç½®æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼ˆ2MSLï¼‰ã€‚ å¦‚æžœAåœ¨TIME-WAITçŠ¶æ€ä¸ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè€Œæ˜¯åœ¨å‘é€å®ŒACKæŠ¥æ–‡æ®µåŽå°±ç«‹å³é‡Šæ”¾è¿žæŽ¥ï¼Œå°±æ— æ³•æ”¶åˆ°Bé‡ä¼ çš„FIN+ACKæŠ¥æ–‡æ®µï¼Œå› è€Œä¹Ÿä¸ä¼šå†å‘é€ä¸€æ¬¡ç¡®è®¤æŠ¥æ–‡æ®µã€‚è¿™æ ·ï¼ŒBå°±æ— æ³•æŒ‰ç…§æ­£å¸¸çš„æ­¥éª¤è¿›å…¥CLOSEDçŠ¶æ€ã€‚ ç¬¬äºŒï¼ŒAåœ¨å‘é€å®ŒACKæŠ¥æ–‡æ®µåŽï¼Œå†ç»è¿‡2MSLæ—¶é—´ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿žæŽ¥æŒç»­çš„æ—¶é—´æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»Žç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªæ–°çš„è¿žæŽ¥ä¸­ä¸ä¼šå‡ºçŽ°è¿™ç§æ—§çš„è¿žæŽ¥è¯·æ±‚çš„æŠ¥æ–‡æ®µã€‚ å®¢æˆ·ç«¯çªç„¶æŒ‚æŽ‰äº†æ€Žä¹ˆåŠž æ­£å¸¸è¿žæŽ¥æ—¶ï¼Œå®¢æˆ·ç«¯çªç„¶æŒ‚æŽ‰äº†ï¼Œå¦‚æžœæ²¡æœ‰æŽªæ–½å¤„ç†è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆå°±ä¼šå‡ºçŽ°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å‡ºçŽ°é•¿æ—¶æœŸçš„ç©ºé—²ã€‚ è§£å†³åŠžæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå°±å°†è®¡æ—¶å™¨å¤ä½ã€‚è¶…æ—¶æ—¶é—´é€šå¸¸è®¾ç½®ä¸º2å°æ—¶ã€‚è‹¥æœåŠ¡å™¨è¶…è¿‡2å°æ—¶æ²¡æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€æŽ¢æµ‹æŠ¥æ–‡æ®µã€‚è‹¥å‘é€äº†10ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µï¼Œæ¯ä¸€ä¸ªç›¸éš”75ç§’ï¼Œè¿˜æ²¡æœ‰å“åº”å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œå› è€Œç»ˆæ­¢è¯¥è¿žæŽ¥ã€‚ æ»‘åŠ¨çª—å£åè®® åŸºç¡€æ¦‚å¿µ å‘é€çª—å£ï¼šä»»æ„æ—¶åˆ»ï¼Œå‘é€æ–¹ç»´æŒçš„ä¸€ç»„è¿žç»­çš„ã€å…è®¸å‘é€å¸§çš„å¸§åºå·ï¼›ç”¨äºŽå¯¹å‘é€æ–¹è¿›è¡Œæµé‡æŽ§åˆ¶ï¼› æŽ¥æ”¶çª—å£ï¼šä»»æ„æ—¶åˆ»ï¼ŒæŽ¥æ”¶æ–¹ç»´æŒçš„ä¸€ç»„è¿žç»­çš„ã€å…è®¸æŽ¥æ”¶å¸§çš„å¸§åºå·ï¼›ç”¨äºŽæŽ§åˆ¶å¯æŽ¥æ”¶å“ªäº›æ•°æ®å¸§ã€ä¸å¯æŽ¥æ”¶å“ªäº›æ•°æ®å¸§ï¼ŒæŽ¥æ”¶æ–¹åªæœ‰å½“æ”¶åˆ°æ•°æ®å¸§çš„åºå·è½å…¥æŽ¥æ”¶çª—å£å†…æ‰å…è®¸å°†è¯¥æ•°æ®å¸§æ”¶ä¸‹ï¼Œå¦åˆ™ä¸€å¾‹ä¸¢å¼ƒã€‚ å·¥ä½œåŽŸç† å‘é€ç«¯ æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤å¸§ï¼Œå‘é€çª—å£å°±å‘å‰æ»‘åŠ¨ä¸€ä¸ªå¸§çš„è·ç¦»ã€‚ å½“å‘é€çª—å£å†…æ— å¯å‘é€çš„å¸§æ—¶ï¼ˆå³çª—å£å†…çš„å¸§å…¨éƒ¨æ˜¯å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„å¸§ï¼‰ï¼Œå‘é€æ–¹å°±ä¼šåœæ­¢å‘é€ï¼Œç›´åˆ°æ”¶åˆ°æŽ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤å¸§ä½¿çª—å£ç§»åŠ¨ï¼Œçª—å£å†…æœ‰å¯ä»¥å‘é€çš„å¸§ï¼Œä¹‹åŽæ‰å¼€å§‹ç»§ç»­å‘é€ã€‚ æŽ¥æ”¶ç«¯ å½“æ”¶åˆ°æ•°æ®å¸§åŽï¼Œå°†çª—å£å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå¹¶å‘å›žç¡®è®¤å¸§ï¼Œè‹¥æ”¶åˆ°çš„æ•°æ®å¸§è½åœ¨æŽ¥æ”¶çª—å£ä¹‹å¤–ï¼Œåˆ™ä¸€å¾‹ä¸¢å¼ƒã€‚ é‡è¦ç‰¹æ€§ åªæœ‰æŽ¥æ”¶çª—å£å‘å‰æ»‘åŠ¨ã€æŽ¥æ”¶æ–¹å‘é€äº†ç¡®è®¤å¸§æ—¶ï¼Œå‘é€çª—å£æ‰æœ‰å¯èƒ½ï¼ˆåªæœ‰å‘é€æ–¹æ”¶åˆ°ç¡®è®¤å¸§æ‰æ˜¯ä¸€å®šï¼‰å‘å‰æ»‘åŠ¨ã€‚ åœæ­¢-ç­‰å¾…åè®®ã€åŽé€€Nå¸§åè®® &amp; é€‰æ‹©é‡ä¼ åè®®åªæ˜¯åœ¨å‘é€çª—å£å¤§å°å’ŒæŽ¥æ”¶çª—å£å¤§å°ä¸Šæœ‰æ‰€å·®åˆ«ï¼š åœæ­¢ç­‰å¾…åè®®ï¼šå‘é€çª—å£å¤§å°=1ï¼ŒæŽ¥æ”¶çª—å£å¤§å°=1ï¼›å³ å•å¸§æ»‘åŠ¨çª—å£ ç­‰äºŽ åœæ­¢-ç­‰å¾…åè®® åŽé€€Nå¸§åè®®ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼ŒæŽ¥æ”¶çª—å£å¤§å°=1ã€‚ é€‰æ‹©é‡ä¼ åè®®ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼ŒæŽ¥æ”¶çª—å£å¤§å°&gt;1ã€‚ å½“æŽ¥æ”¶çª—å£çš„å¤§å°ä¸º1æ—¶ï¼Œå¯ä¿è¯å¸§æœ‰åºæŽ¥æ”¶ã€‚ æ•°æ®é“¾è·¯å±‚çš„æ»‘åŠ¨çª—å£åè®®ä¸­ï¼Œçª—å£çš„å¤§å°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å›ºå®šçš„ï¼ˆæ³¨æ„è¦ä¸ŽTCPçš„æ»‘åŠ¨çª—å£åè®®åŒºåˆ«ï¼‰ã€‚ è‡ªåŠ¨é‡ä¼ è¯·æ±‚åè®®ARQ å®šä¹‰ Auto Repeat reQuestï¼Œä¼ è¾“å‡ºçŽ°å·®é”™æ—¶ï¼ŒæŽ¥æ”¶æ–¹è‡ªåŠ¨è¯·æ±‚å‘é€æ–¹é‡ä¼ å‡ºé”™çš„æ•°æ®ã€‚ ä½œç”¨ ä¿è¯ä¿¡é“çš„æ•°æ®ä¼ è¾“æ— å·®é”™ã€‚ æœºåˆ¶ ç¡®è®¤æœºåˆ¶ å‘é€æ–¹æ¯å‘é€ä¸€å¸§ï¼Œè¦ç­‰åˆ°æŽ¥æ”¶æ–¹çš„åº”ç­”ä¿¡å·åŽæ‰èƒ½å‘é€ä¸‹ä¸€å¸§ï¼› æŽ¥æ”¶æ–¹æ¯æŽ¥æ”¶ä¸€å¸§ï¼Œéƒ½è¦åé¦ˆä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œè¡¨ç¤ºå¯æŽ¥æ”¶ä¸‹ä¸€å¸§ï¼› è‹¥æŽ¥æ”¶æ–¹ä¸åé¦ˆåº”ç­”ä¿¡å·ï¼Œåˆ™å‘é€æ–¹å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚ è¶…æ—¶é‡ä¼ æœºåˆ¶ å‘é€æ–¹åœ¨å‘é€æŸä¸ªæ•°æ®å¸§åŽå°±å¼€å¯è®¡æ—¶å™¨ï¼› åœ¨ä¸€å®šæ—¶é—´å†…è‹¥æ²¡å¾—åˆ°å‘é€çš„æ•°æ®å¸§çš„ç¡®è®¤å¸§ï¼Œåˆ™é‡æ–°æ–¹æ³•è¯¥æ•°æ®å¸§ï¼Œç›´åˆ°å‘é€æˆåŠŸä¸ºæ­¢ã€‚ ç±»åž‹ åœç­‰å¼ARQï¼ˆStop-and-Waitï¼‰ åŽé€€Nå¸§ARQï¼ˆGo-Back-Nï¼‰ é€‰æ‹©é‡ä¼ ARQï¼ˆSelective Repeatï¼‰ åœç­‰å¼ARQï¼ˆStop-and-Waitï¼‰ åŽŸç†ï¼š ï¼ˆå•å¸§æ»‘åŠ¨çª—å£ï¼‰åœæ­¢ - ç­‰å¾…åè®® + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°=1ã€æŽ¥æ”¶çª—å£å¤§å°=1 å…·ä½“æè¿°ï¼š å‘é€æ–¹æ¯å‘é€ä¸€å¸§ï¼Œè¦ç­‰åˆ°æŽ¥æ”¶æ–¹çš„åº”ç­”ä¿¡å·åŽæ‰èƒ½å‘é€ä¸‹ä¸€å¸§ï¼› æŽ¥æ”¶æ–¹æ¯æŽ¥æ”¶ä¸€å¸§ï¼Œéƒ½è¦åé¦ˆä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œè¡¨ç¤ºå¯æŽ¥ä¸‹ä¸€å¸§ï¼› è‹¥æŽ¥æ”¶æ–¹ä¸åé¦ˆåº”ç­”ä¿¡å·ï¼Œåˆ™å‘é€æ–¹å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚ åŽé€€Nå¸§åè®® åŽŸç†ï¼š å¤šå¸§æ»‘åŠ¨çª—å£ + ç´¯è®¡ç¡®è®¤ + åŽé€€Nå¸§ + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°&gt;1ã€æŽ¥æ”¶çª—å£å¤§å°=1 å…·ä½“æè¿°ï¼š å‘é€æ–¹ï¼šé‡‡ç”¨å¤šå¸§æ»‘åŠ¨çª—å£çš„åŽŸç†ï¼Œå¯è¿žç»­å‘é€å¤šä¸ªæ•°æ®å¸§ è€Œä¸éœ€ç­‰å¾…å¯¹æ–¹ç¡®è®¤ æŽ¥æ”¶æ–¹ï¼šé‡‡ç”¨ ç´¯è®¡ç¡®è®¤ &amp; åŽé€€Nå¸§çš„åŽŸç†ï¼Œåªå…è®¸æŒ‰é¡ºåºæŽ¥æ”¶å¸§ã€‚ ç´¯è®¡ç¡®è®¤ æ”¶åˆ°å¤šä¸ªæ•°æ®åˆ†ç»„åŽï¼Œåªéœ€å¯¹æŒ‰åºåˆ°è¾¾çš„æœ€åŽ1ä¸ªåˆ†ç»„å‘é€ç¡®è®¤è€Œä¸å¿…å¯¹æ”¶åˆ°çš„æ¯ä¸ªåˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤å³å¯è¡¨ç¤ºåˆ°è¯¥åˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚ ä¼˜ç‚¹ï¼šå®žçŽ°ç®€ç­”ï¼›æ•°æ®ä¸¢å¤±ä¸å¿…é‡ä¼ ã€‚ ç¼ºç‚¹ï¼šä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæŽ¥æ”¶æ–¹å·²æ­£ç¡®æ”¶åˆ°æ‰€æœ‰åˆ†ç»„ä¿¡æ¯ã€‚ åŽé€€Nå¸§ é€€å›žæ¥é‡ä¼ å·²å‘é€è¿‡çš„Nä¸ªåˆ†ç»„ã€‚ä¿è¯æŒ‰åºæŽ¥æ”¶æ•°æ®å¸§ã€‚ åŽé€€Nå¸§åè®®çš„æŽ¥å£çª—å£é•¿åº¦ = 1ï¼Œè‹¥é‡‡ç”¨nä¸ªæ¯”ç‰¹å¯¹å¸§ç¼–å·ï¼Œåˆ™å…¶å‘é€çª—å£WTåº”æ»¡è¶³1â‰¤WTâ‰¤2n-1;è‹¥å‘é€çª—å£å°ºå¯¸å¤§äºŽ2n-1ï¼Œåˆ™ä¼šé€ æˆæŽ¥æ”¶æ–¹æ— æ³•åˆ†è¾¨æ–°å¸§å’Œæ—§å¸§ã€‚ é€‰æ‹©é‡ä¼ ARQï¼ˆSelective Repeatï¼‰ åŽŸç†ï¼š å¤šå¸§æ»‘åŠ¨çª—å£ + ç´¯è®¡ç¡®è®¤ + åŽé€€Nå¸§ + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°&gt;1ã€æŽ¥æ”¶çª—å£å¤§å°&gt;1 ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šå› è¿žç»­å‘é€æ•°æ®å¸§è€Œæé«˜äº†ä¿¡é“çš„åˆ©ç”¨çŽ‡ï¼›ç¼ºç‚¹ï¼šé‡ä¼ æ—¶åˆå¿…é¡»æŠŠåŽŸæ¥å·²ç»ä¼ é€æ­£ç¡®çš„æ•°æ®å¸§è¿›è¡Œé‡ä¼ ï¼ˆä»…å› ä¸ºè¿™äº›æ•°æ®å¸§å‰é¢æœ‰ä¸€ä¸ªæ•°æ®å¸§å‡ºäº†é”™ï¼‰ï¼Œå°†å¯¼è‡´ä¼ é€æ•ˆçŽ‡é™ä½Žã€‚ TCPè¶…æ—¶é‡ä¼  åœ¨å‘é€æŸä¸€ä¸ªæ•°æ®ä»¥åŽå°±å¼€å¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…å¦‚æžœæ²¡æœ‰å¾—åˆ°å‘é€çš„æ•°æ®æŠ¥çš„ACKæŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±é‡æ–°å‘é€æ•°æ®ï¼Œç›´åˆ°å‘é€æˆåŠŸä¸ºæ­¢ã€‚ å½±å“è¶…æ—¶é‡ä¼ æœºåˆ¶åè®®æ•ˆçŽ‡çš„ä¸€ä¸ªå…³é”®å‚æ•°æ˜¯é‡ä¼ è¶…æ—¶æ—¶é—´ï¼ˆRTOï¼ŒRetransmission TimeOutï¼‰ã€‚RTOçš„å€¼è¢«è®¾ç½®è¿‡å¤§è¿‡å°éƒ½ä¼šå¯¹åè®®é€ æˆä¸åˆ©å½±å“ã€‚ ï¼ˆ1ï¼‰RTOè®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œæ²¡æœ‰æ•ˆçŽ‡ï¼Œæ€§èƒ½å·®ã€‚ ï¼ˆ2ï¼‰RTOè®¾çŸ­äº†ï¼Œé‡å‘çš„å°±å¿«ï¼Œä¼šå¢žåŠ ç½‘ç»œæ‹¥å¡žï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘ã€‚ è¿žæŽ¥å¾€è¿”æ—¶é—´ï¼ˆRTTï¼ŒRound Trip Timeï¼‰ï¼ŒæŒ‡å‘é€ç«¯ä»Žå‘é€TCPåŒ…å¼€å§‹åˆ°æŽ¥æ”¶å®ƒçš„ç«‹å³å“åº”æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ RTOç†è®ºä¸Šæœ€å¥½æ˜¯ç½‘ç»œ RTT æ—¶é—´ï¼Œä½†åˆå—åˆ¶äºŽç½‘ç»œè·ç¦»ä¸Žçž¬æ€æ—¶å»¶å˜åŒ–ï¼Œæ‰€ä»¥å®žé™…ä¸Šä½¿ç”¨è‡ªé€‚åº”çš„åŠ¨æ€ç®—æ³•ï¼ˆä¾‹å¦‚ Jacobson ç®—æ³•å’Œ Karn ç®—æ³•ç­‰ï¼‰æ¥ç¡®å®šè¶…æ—¶æ—¶é—´ã€‚ TCPæµé‡æŽ§åˆ¶ TCPæµé‡æŽ§åˆ¶ä¸»è¦æ˜¯é’ˆå¯¹æŽ¥æ”¶ç«¯çš„å¤„ç†é€Ÿåº¦ä¸å¦‚å‘é€ç«¯å‘é€é€Ÿåº¦å¿«çš„é—®é¢˜ï¼Œæ¶ˆé™¤å‘é€æ–¹ä½¿æŽ¥æ”¶æ–¹ç¼“å­˜æº¢å‡ºçš„å¯èƒ½æ€§ã€‚ TCPæµé‡æŽ§åˆ¶ä¸»è¦ä½¿ç”¨æ»‘åŠ¨çª—å£åè®®ï¼Œæ»‘åŠ¨çª—å£æ˜¯æŽ¥å—æ•°æ®ç«¯ä½¿ç”¨çš„çª—å£å¤§å°ï¼Œç”¨æ¥å‘Šè¯‰å‘é€ç«¯æŽ¥æ”¶ç«¯çš„ç¼“å­˜å¤§å°ï¼Œä»¥æ­¤å¯ä»¥æŽ§åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„å¤§å°ï¼Œä»Žè€Œè¾¾åˆ°æµé‡æŽ§åˆ¶çš„ç›®çš„ã€‚ æŽ¥æ”¶ç«¯é€šè¿‡TCPé¦–éƒ¨çš„çª—å£å¤§å°å­—æ®µåé¦ˆå½“å‰å¯æŽ¥æ”¶çš„å­—èŠ‚æ•°ã€‚ å¯¹äºŽå‘é€ç«¯çš„æ•°æ®ç¼“å†²åŒºæœ‰è¿™äº›é‡ï¼š LastByteSentæ˜¯ç›®å‰å‘é€çš„æœ€åŽ1å­—èŠ‚çš„æ•°æ®ç¼–å·ï¼› LastByteAckdæ˜¯ç›®å‰æŽ¥æ”¶åˆ°ç¡®è®¤çš„æœ€åŽ1å­—èŠ‚çš„æ•°æ®ç¼–å·ï¼› LastByteRcvdï¼šæŽ¥æ”¶ç«¯ä»Žç½‘ç»œæŽ¥æ”¶çš„æœ€åŽä¸€ä¸ªå­—èŠ‚åºå·ï¼› LastByteReadï¼šä¸Šå±‚åº”ç”¨ç¨‹åºæŽ¥æ”¶çš„æœ€åŽä¸€ä¸ªå­—èŠ‚åºå·ï¼› Rcvwinæ˜¯çª—å£å¤§å°ã€‚ é‰´äºŽæ¯æ¬¡å‘é€æ–¹éƒ½æ˜¯æ”¶åˆ°ACKä¹‹åŽæ»‘åŠ¨çª—å£ç»§ç»­å‘é€ï¼Œå‘é€åˆ°LastByteSentè¿™ä¸ªä½ç½®ï¼ŒLastByteSent-LastByteAckdä¹Ÿå°±æ˜¯è¿™æ¬¡å‘é€æ•°æ®çš„å¤šå°‘ï¼Œé‚£ä¹ˆåªè¦æ»¡è¶³ï¼šLastByteSentâ€“LastByteAckd&lt;=RcvWin(æŽ¥æ”¶ç«¯ç©ºé—²çª—å£å¤§å°) å°±ä¼šä¿è¯ä¸ä¼šæº¢å‡ºäº†ã€‚ é‚£ä¹ˆæŽ¥æ”¶ç«¯RcvWinæ€Žä¹ˆç®—å‘¢ï¼Ÿ å‡è®¾æŽ¥æ”¶ç«¯ç¼“å†²åŒºå¤§å°ä¸ºRcvBuffer,é‚£ä¹ˆLastByteRcvdâ€“LastByteReadå°±æ˜¯å·²ç»æŽ¥å—ä½†æ˜¯è¿˜æ²¡æœ‰ä¼ é€’ç»™ä¸Šå±‚çš„æ•°æ®ã€‚æ‰€ä»¥ç©ºé—²åŒºåŸŸRcvWin= RcvBuffer-(LastByteRcvdâ€“LastByteRead)ã€‚ TCPæ‹¥å¡žæŽ§åˆ¶ TCPå‘é€æ–¹å¯èƒ½å› ä¸ºIPç½‘ç»œçš„æ‹¥å¡žè€Œè¢«éåˆ¶ï¼ŒTCPæ‹¥å¡žæŽ§åˆ¶å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆæ³¨æ„å’ŒTCPæµé‡æŽ§åˆ¶çš„åŒºåˆ«ï¼‰ã€‚ TCPæ‹¥å¡žæŽ§åˆ¶çš„å‡ ç§æ–¹æ³•ï¼šæ…¢å¯åŠ¨ï¼Œæ‹¥å¡žé¿å…ï¼Œå¿«é‡ä¼ å’Œå¿«æ¢å¤ã€‚åœ¨äº†è§£è¿™å‡ ç§æ–¹æ³•ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹æ‹¥å¡žçª—å£ã€æ…¢å¼€å§‹ç®—æ³•ã€æ‹¥å¡žé¿å…ç®—æ³•ã€‚ æ‹¥å¡žçª—å£ å®šä¹‰ å‘é€æ–¹ç»´æŒä¸€ä¸ªå«åšæ‹¥å¡žçª—å£ cwndçš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡žçª—å£çš„å¤§å°å–å†³äºŽç½‘ç»œçš„æ‹¥å¡žç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹çš„è®©è‡ªå·±çš„å‘é€çª—å£=min(cwndï¼ŒæŽ¥å—ç«¯æŽ¥æ”¶çª—å£å¤§å°ï¼‰ã€‚ å‘é€æ–¹æŽ§åˆ¶æ‹¥å¡žçª—å£çš„åŽŸåˆ™ åªè¦ç½‘ç»œæ²¡æœ‰å‡ºçŽ°æ‹¥å¡žï¼Œæ‹¥å¡žçª—å£å°±å¢žå¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºåŽ»ã€‚ä½†åªè¦ç½‘ç»œå‡ºçŽ°æ‹¥å¡žï¼Œæ‹¥å¡žçª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚ æ…¢å¼€å§‹ç®—æ³• å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æžœç«‹å³å°†å¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¼•èµ·ç½‘ç»œæ‹¥å¡žï¼Œå› ä¸ºçŽ°åœ¨å¹¶ä¸æ¸…æ¥šç½‘ç»œçš„è´Ÿè·æƒ…å†µã€‚å› æ­¤ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯ å…ˆæŽ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢žå¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”±å°åˆ°å¤§é€æ¸å¢žå¤§æ‹¥å¡žçª—å£æ•°å€¼ã€‚ é€šå¸¸åœ¨åˆšåˆšå¼€å§‹å‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå…ˆæŠŠæ‹¥å¡žçª—å£ cwnd è®¾ç½®ä¸ºä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µMSSçš„æ•°å€¼ã€‚è€Œåœ¨æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åŽï¼ŒæŠŠæ‹¥å¡žçª—å£å¢žåŠ è‡³å¤šä¸€ä¸ªMSSçš„æ•°å€¼ã€‚ç”¨è¿™æ ·çš„æ–¹æ³•é€æ­¥å¢žå¤§å‘é€æ–¹çš„æ‹¥å¡žçª—å£ cwnd ï¼Œå¯ä»¥ä½¿åˆ†ç»„æ³¨å…¥åˆ°ç½‘ç»œçš„é€ŸçŽ‡æ›´åŠ åˆç†ã€‚ æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡žçª—å£ cwnd å°±åŠ å€ã€‚ä¸€ä¸ªä¼ è¾“è½®æ¬¡æ‰€ç»åŽ†çš„æ—¶é—´å…¶å®žå°±æ˜¯å¾€è¿”æ—¶é—´RTTã€‚ä¸è¿‡â€œä¼ è¾“è½®æ¬¡â€æ›´åŠ å¼ºè°ƒï¼šæŠŠæ‹¥å¡žçª—å£cwndæ‰€å…è®¸å‘é€çš„æŠ¥æ–‡æ®µéƒ½è¿žç»­å‘é€å‡ºåŽ»ï¼Œå¹¶æ”¶åˆ°äº†å¯¹å·²å‘é€çš„æœ€åŽä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ã€‚ æ…¢å¼€å§‹çš„â€œæ…¢â€å¹¶ä¸æ˜¯æŒ‡cwndçš„å¢žé•¿é€ŸçŽ‡æ…¢ï¼Œè€Œæ˜¯æŒ‡åœ¨TCPå¼€å§‹å‘é€æŠ¥æ–‡æ®µæ—¶å…ˆè®¾ç½®cwnd=1ï¼Œä½¿å¾—å‘é€æ–¹åœ¨å¼€å§‹æ—¶åªå‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆç›®çš„æ˜¯è¯•æŽ¢ä¸€ä¸‹ç½‘ç»œçš„æ‹¥å¡žæƒ…å†µï¼‰ï¼Œç„¶åŽå†é€æ¸å¢žå¤§cwndã€‚ ä¸ºäº†é˜²æ­¢æ‹¥å¡žçª—å£cwndå¢žé•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡žï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™ssthreshçŠ¶æ€å˜é‡ã€‚æ…¢å¼€å§‹é—¨é™ssthreshçš„ç”¨æ³•å¦‚ä¸‹ï¼š å½“ cwnd &lt; ssthresh æ—¶ï¼Œä½¿ç”¨ä¸Šè¿°çš„æ…¢å¼€å§‹ç®—æ³•ã€‚ å½“ cwnd &gt; ssthresh æ—¶ï¼Œåœæ­¢ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•è€Œæ”¹ç”¨æ‹¥å¡žé¿å…ç®—æ³•ã€‚ å½“ cwnd = ssthresh æ—¶ï¼Œæ—¢å¯ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œä¹Ÿå¯ä½¿ç”¨æ‹¥å¡žæŽ§åˆ¶é¿å…ç®—æ³•ã€‚ æ‹¥å¡žé¿å…ç®—æ³• è®©æ‹¥å¡žçª—å£cwndç¼“æ…¢åœ°å¢žå¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ–¹çš„æ‹¥å¡žçª—å£cwndåŠ 1ï¼Œè€Œä¸æ˜¯åŠ å€ã€‚è¿™æ ·æ‹¥å¡žçª—å£cwndæŒ‰çº¿æ€§è§„å¾‹ç¼“æ…¢å¢žé•¿ï¼Œæ¯”æ…¢å¼€å§‹ç®—æ³•çš„æ‹¥å¡žçª—å£å¢žé•¿é€ŸçŽ‡ç¼“æ…¢å¾—å¤šã€‚ æ‹¥å¡žé¿å…å¹¶ä¸å¯é¿å…æ‹¥å¡žï¼Œåªæ˜¯å°†æ‹¥å¡žçª—å£æŒ‰çŽ°è¡Œè§„å¾‹ç¼“æ…¢å¢žé•¿ï¼Œä½¿å¾—ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºçŽ°æ‹¥å¡žã€‚ æ…¢å¼€å§‹å’Œæ‹¥å¡žé¿å…ç®—æ³•çš„å®žçŽ°ä¸¾ä¾‹ æ— è®ºåœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯åœ¨æ‹¥å¡žé¿å…é˜¶æ®µï¼Œåªè¦å‘é€æ–¹åˆ¤æ–­ç½‘ç»œå‡ºçŽ°æ‹¥å¡žï¼ˆå…¶æ ¹æ®å°±æ˜¯æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼‰ï¼Œå°±è¦æŠŠæ…¢å¼€å§‹é—¨é™ssthreshè®¾ç½®ä¸ºå‡ºçŽ°æ‹¥å¡žæ—¶çš„å‘é€ æ–¹çª—å£å€¼çš„ä¸€åŠï¼ˆä½†ä¸èƒ½å°äºŽ2ï¼‰ã€‚ç„¶åŽæŠŠæ‹¥å¡žçª—å£cwndé‡æ–°è®¾ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯è¦è¿…é€Ÿå‡å°‘ä¸»æœºå‘é€åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ï¼Œä½¿å¾—å‘ç”Ÿ æ‹¥å¡žçš„è·¯ç”±å™¨æœ‰è¶³å¤Ÿæ—¶é—´æŠŠé˜Ÿåˆ—ä¸­ç§¯åŽ‹çš„åˆ†ç»„å¤„ç†å®Œæ¯•ã€‚ å¦‚ä¸‹å›¾ï¼Œç”¨å…·ä½“æ•°å€¼è¯´æ˜Žäº†ä¸Šè¿°æ‹¥å¡žæŽ§åˆ¶çš„è¿‡ç¨‹ã€‚çŽ°åœ¨å‘é€çª—å£çš„å¤§å°å’Œæ‹¥å¡žçª—å£ä¸€æ ·å¤§ã€‚ è¿‡ç¨‹è¯´æ˜Žï¼š å½“TCPè¿žæŽ¥è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼ŒæŠŠæ‹¥å¡žçª—å£cwndç½®ä¸º1ã€‚ä¸ºäº†ä¾¿äºŽç†è§£ï¼Œå›¾ä¸­çš„çª—å£å•ä½ä¸ä½¿ç”¨å­—èŠ‚è€Œä½¿ç”¨æŠ¥æ–‡æ®µçš„ä¸ªæ•°ã€‚æ…¢å¼€å§‹é—¨é™çš„åˆå§‹å€¼è®¾ç½®ä¸º16ä¸ªæŠ¥æ–‡æ®µï¼Œå³ ssthresh= 16 ã€‚åœ¨æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•æ—¶ï¼Œæ‹¥å¡žçª—å£ cwnd çš„åˆå§‹å€¼ä¸º1ã€‚ä»¥åŽå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤ACKï¼Œå°±æŠŠæ‹¥å¡žçª—å£å€¼åŠ 1ï¼Œç„¶åŽå¼€å§‹ä¸‹ä¸€è½®çš„ä¼ è¾“ï¼ˆå›¾ä¸­æ¨ªåæ ‡ä¸ºä¼ è¾“è½®æ¬¡ï¼‰ã€‚å› æ­¤æ‹¥å¡žçª—å£cwnd éšç€ä¼ è¾“è½®æ¬¡æŒ‰æŒ‡æ•°è§„å¾‹å¢žé•¿ã€‚å½“æ‹¥å¡žçª—å£cwndå¢žé•¿åˆ°æ…¢å¼€å§‹é—¨é™å€¼ssthreshæ—¶ï¼ˆå³å½“cwnd=16æ—¶ï¼‰ï¼Œå°±æ”¹ä¸ºæ‰§è¡Œæ‹¥å¡žæŽ§åˆ¶ç®—æ³•ï¼Œæ‹¥å¡žçª—å£æŒ‰çº¿æ€§è§„å¾‹å¢žé•¿ã€‚å‡å®šæ‹¥å¡žçª—å£çš„æ•°å€¼å¢žé•¿åˆ°24æ—¶ï¼Œç½‘ç»œå‡ºçŽ°è¶…æ—¶ï¼ˆè¿™å¾ˆå¯èƒ½å°±æ˜¯ç½‘ç»œå‘ç”Ÿæ‹¥å¡žäº†ï¼‰ã€‚æ›´æ–°åŽçš„ssthreshå€¼å˜ä¸º12ï¼ˆå³å˜ä¸ºå‡ºçŽ°è¶…æ—¶æ—¶çš„æ‹¥å¡žçª—å£æ•°å€¼ 24çš„ä¸€åŠï¼‰ï¼Œæ‹¥å¡žçª—å£å†é‡æ–°è®¾ç½®ä¸º1ï¼Œå¹¶æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚å½“cwnd=ssthresh=12æ—¶æ”¹ä¸ºæ‰§è¡Œæ‹¥å¡žé¿å…ç®—æ³•ï¼Œæ‹¥å¡žçª—å£æŒ‰çº¿æ€§è§„å¾‹å¢žé•¿ï¼Œæ¯ç»è¿‡ ä¸€ä¸ªå¾€è¿”æ—¶é—´å¢žåŠ ä¸€ä¸ªMSSçš„å¤§å°ã€‚å¼ºè°ƒï¼šâ€œæ‹¥å¡žé¿å…â€å¹¶éžæŒ‡å®Œå…¨èƒ½å¤Ÿé¿å…äº†æ‹¥å¡žã€‚åˆ©ç”¨ä»¥ä¸Šçš„æŽªæ–½è¦å®Œå…¨é¿å…ç½‘ç»œæ‹¥å¡žè¿˜æ˜¯ä¸å¯èƒ½çš„ã€‚â€œæ‹¥å¡žé¿å…â€æ˜¯è¯´åœ¨æ‹¥å¡žé¿å…é˜¶æ®µå°†æ‹¥å¡žçª—å£æŽ§åˆ¶ä¸ºæŒ‰çº¿æ€§è§„å¾‹å¢žé•¿ï¼Œä½¿ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºçŽ°æ‹¥å¡žã€‚ å¿«é‡ä¼  åŽŸç† æŽ¥æ”¶æ–¹ï¼šæ¯æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µåŽ å°±ç«‹å³å‘å‡ºé‡å¤ç¡®è®¤ï¼ˆä¸ºçš„æ˜¯ä½¿å‘é€æ–¹åŠæ—©çŸ¥é“æœ‰æŠ¥æ–‡æ®µæ²¡æœ‰åˆ°è¾¾å¯¹æ–¹ï¼‰ï¼Œè€Œä¸è¦ç­‰åˆ°è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡ŒæŽå¸¦ç¡®è®¤ã€‚ å‘é€æ–¹ï¼šåªè¦ä¸€è¿žæ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤å°±ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸å¿…ç»§ç»­ç­‰å¾…è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸã€‚ ä½œç”¨ ç”±äºŽå‘é€æ–¹å°½æ—©é‡ä¼ æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œå› æ­¤é‡‡ç”¨å¿«é‡ä¼ åŽå¯ä»¥ä½¿æ•´ä¸ªç½‘ç»œåžåé‡æé«˜çº¦20%ã€‚ ç¤ºä¾‹ å¿«æ¢å¤ ä¸Žå¿«é‡ä¼ é…åˆä½¿ç”¨çš„è¿˜æœ‰å¿«æ¢å¤ç®—æ³•ï¼Œå…¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªè¦ç‚¹ï¼š å½“å‘é€æ–¹è¿žç»­æ”¶åˆ°æŽ¥æ”¶æ–¹å‘æ¥çš„ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™å‡åŠï¼ˆè¿™ä¸ªå‡åŠæŒ‡çš„æ˜¯å˜æˆå‘ç”Ÿé˜»å¡žæ—¶çš„é˜»å¡žçª—å£å¤§å°çš„ä¸€åŠï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†é¢„é˜²ç½‘ç»œå‘ç”Ÿæ‹¥å¡žã€‚ï¼ˆæ³¨æ„ï¼šæŽ¥ä¸‹æ¥ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼‰ ç”±äºŽå‘é€æ–¹çŽ°åœ¨è®¤ä¸ºç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡žï¼Œå› æ­¤çŽ°åœ¨ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ˜¯æŠŠcwnd(æ‹¥å¡žçª—å£)å€¼è®¾ç½®ä¸ºæ…¢å¼€å§‹é—¨é™å‡åŠåŽçš„å€¼ï¼Œç„¶åŽå¼€å§‹æ‰§è¡Œæ‹¥å¡žé¿å…ç®—æ³•ï¼Œä½¿æ‹¥å¡žçª—å£ç¼“æ…¢çš„çº¿æ€§å¢žå¤§ã€‚ æ³¨ï¼šç”±äºŽè·³è¿‡äº†æ‹¥å¡žçª—å£ï¼ˆcwndï¼‰ä»Ž1èµ·å§‹çš„æ…¢å¼€å§‹è¿‡ç¨‹ï¼Œæ‰€ä»¥ç§°ä¸ºï¼šå¿«æ¢å¤ã€‚ æ­¤å¤„ç½‘ç»œä¸ä¼šå‘ç”Ÿç½‘ç»œæ‹¥å¡žï¼Œå› è‹¥æ‹¥å¡žï¼Œåˆ™ä¸ä¼šæ”¶åˆ°å¤šä¸ªé‡å¤ç¡®è®¤æŠ¥æ–‡ã€‚ ç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š TCPå››ç§è®¡æ—¶å™¨ TCPä¸­æœ‰å››ç§è®¡æ—¶å™¨ï¼ˆTimerï¼‰ï¼Œåˆ†åˆ«ä¸ºï¼š é‡ä¼ è®¡æ—¶å™¨ï¼šRetransmission Timer åšæŒè®¡æ—¶å™¨ï¼šPersistent Timer ä¿æ´»è®¡æ—¶å™¨ï¼šKeeplive Timer æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼šTimer_Wait Timer é‡ä¼ è®¡æ—¶å™¨ TCPæ˜¯å¯ä»¥ä¿è¯æ•°æ®å¯é ä¼ è¾“çš„ã€‚æ€Žä¹ˆä¿è¯å‘¢ï¼Ÿå¸¦ç¡®è®¤çš„é‡ä¼ æœºåˆ¶ã€‚ åœ¨æ»‘åŠ¨çª—å£åè®®ä¸­ï¼ŒæŽ¥æ”¶çª—å£ä¼šåœ¨è¿žç»­æ”¶åˆ°çš„åŒ…åºåˆ—ä¸­çš„æœ€åŽä¸€ä¸ªåŒ…å‘æŽ¥æ”¶ç«¯å‘é€ä¸€ä¸ªACKï¼Œå½“ç½‘ç»œæ‹¥å µçš„æ—¶å€™ï¼Œå‘é€ç«¯çš„æ•°æ®åŒ…å’ŒæŽ¥æ”¶ç«¯çš„ACKåŒ…éƒ½æœ‰å¯èƒ½ä¸¢å¤±ã€‚ TCPä¸ºäº†ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œå°±è§„å®šåœ¨é‡ä¼ çš„â€œæ—¶é—´ç‰‡â€åˆ°äº†ä»¥åŽï¼Œå¦‚æžœè¿˜æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ACKï¼Œå°±é‡å‘æ­¤åŒ…ï¼Œä»¥é¿å…é™·å…¥æ— é™ç­‰å¾…ä¸­ã€‚ å½“TCPå‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå°±åˆ›å»ºè¯¥ç‰¹å®šæŠ¥æ–‡çš„é‡ä¼ è®¡æ—¶å™¨ã€‚å¯èƒ½å‘ç”Ÿä¸¤ç§æƒ…å†µï¼š 1ï¼‰è‹¥åœ¨è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´åˆ°ä¹‹å‰æ”¶åˆ°äº†å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œåˆ™æ’¤é”€æ­¤è®¡æ—¶å™¨ã€‚ 2ï¼‰è‹¥åœ¨æ”¶åˆ°äº†å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡æ®µçš„ç¡®è®¤ä¹‹å‰è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´åˆ°ï¼Œåˆ™é‡ä¼ æ­¤æŠ¥æ–‡æ®µï¼Œå¹¶å°†è®¡æ—¶å™¨å¤ä½ã€‚ åšæŒè®¡æ—¶å™¨ ä¸“é—¨å¯¹ä»˜é›¶çª—å£é€šçŸ¥è€Œè®¾ç«‹çš„ã€‚ å…ˆæ¥è€ƒè™‘ä¸€ä¸‹æƒ…æ™¯ï¼š å‘é€ç«¯å‘æŽ¥æ”¶ç«¯å‘é€æ•°æ®åŒ…çŸ¥é“æŽ¥æ”¶çª—å£å¡«æ»¡äº†ï¼Œç„¶åŽæŽ¥æ”¶çª—å£å‘Šè¯‰å‘é€æ–¹æŽ¥æ”¶çª—å£å¡«æ»¡äº†åœæ­¢å‘é€æ•°æ®ã€‚æ­¤æ—¶çš„çŠ¶æ€ç§°ä¸ºâ€œé›¶çª—å£â€çŠ¶æ€ï¼Œå‘é€ç«¯å’ŒæŽ¥æ”¶ç«¯çª—å£å¤§å°å‡ä¸º0.ç›´åˆ°æŽ¥å—TCPå‘é€ç¡®è®¤å¹¶å®£å¸ƒä¸€ä¸ªéžé›¶çš„çª—å£å¤§å°ã€‚ä½†è¿™ä¸ªç¡®è®¤ä¼šä¸¢å¤±ã€‚ æˆ‘ä»¬çŸ¥é“TCPä¸­ï¼Œå¯¹ç¡®è®¤æ˜¯ä¸éœ€è¦å‘é€ç¡®è®¤çš„ã€‚è‹¥ç¡®è®¤ä¸¢å¤±äº†ï¼ŒæŽ¥å—TCPå¹¶ä¸çŸ¥é“ï¼Œè€Œæ˜¯ä¼šè®¤ä¸ºä»–å·²ç»å®Œæˆäº†ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…ç€å‘é€TCPæŽ¥ç€ä¼šå‘é€æ›´å¤šçš„æŠ¥æ–‡æ®µã€‚ ä½†å‘é€TCPç”±äºŽæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±ç­‰å¾…å¯¹æ–¹å‘é€ç¡®è®¤æ¥é€šçŸ¥çª—å£å¤§å°ã€‚åŒæ–¹çš„TCPéƒ½åœ¨æ°¸è¿œçš„ç­‰å¾…ç€å¯¹æ–¹ã€‚ è¦æ‰“å¼€è¿™ç§æ­»é”ï¼ŒTCPä¸ºæ¯ä¸€ä¸ªé“¾æŽ¥ä½¿ç”¨ä¸€ä¸ªæŒä¹…è®¡æ—¶å™¨ã€‚å½“å‘é€TCPæ”¶åˆ°çª—å£å¤§å°ä¸º0çš„ç¡®è®¤æ—¶ï¼Œå°±åšæŒå¯åŠ¨è®¡æ—¶å™¨ã€‚å½“åšæŒè®¡æ—¶å™¨æœŸé™åˆ°æ—¶ï¼Œå‘é€TCPå°±å‘é€ä¸€ä¸ªç‰¹æ®Šçš„æŠ¥æ–‡æ®µï¼Œå«åšæŽ¢æµ‹æŠ¥æ–‡ã€‚ è¿™ä¸ªæŠ¥æ–‡æ®µåªæœ‰ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ä»–æœ‰ä¸€ä¸ªåºå·ï¼Œä½†ä»–çš„åºå·æ°¸è¿œä¸éœ€è¦ç¡®è®¤ï¼›ç”šè‡³åœ¨è®¡ç®—æœºå¯¹å…¶ä»–éƒ¨åˆ†çš„æ•°æ®çš„ç¡®è®¤æ—¶è¯¥åºå·ä¹Ÿè¢«å¿½ç•¥ã€‚æŽ¢æµ‹æŠ¥æ–‡æ®µæé†’æŽ¥å—TCPï¼šç¡®è®¤å·²ä¸¢å¤±ï¼Œå¿…é¡»é‡ä¼ ã€‚ åšæŒè®¡æ—¶å™¨çš„å€¼è®¾ç½®ä¸ºé‡ä¼ æ—¶é—´çš„æ•°å€¼ã€‚ä½†æ˜¯ï¼Œè‹¥æ²¡æœ‰æ”¶åˆ°ä»ŽæŽ¥æ”¶ç«¯æ¥çš„å“åº”ï¼Œåˆ™éœ€å‘é€å¦ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µï¼Œå¹¶å°†åšæŒè®¡æ—¶å™¨çš„å€¼åŠ å€å’Œå¤ä½ã€‚ å‘é€ç«¯ç»§ç»­å‘é€æŽ¢æµ‹æŠ¥æ–‡æ®µï¼Œå°†åšæŒè®¡æ—¶å™¨è®¾å®šçš„å€¼åŠ å€å’Œå¤ä½ï¼Œç›´åˆ°è¿™ä¸ªå€¼å¢žå¤§åˆ°é—¨é™å€¼ï¼ˆé€šå¸¸æ˜¯60ç§’ï¼‰ä¸ºæ­¢ã€‚åœ¨è¿™ä»¥åŽï¼Œå‘é€ç«¯æ¯éš”60ç§’å°±å‘é€ä¸€ä¸ªæŽ¢æµ‹æŠ¥æ–‡ï¼Œç›´åˆ°çª—å£é‡æ–°æ‰“å¼€ã€‚ ä¿æ´»è®¡æ—¶å™¨ ä¿æ´»è®¡æ—¶å™¨ä½¿ç”¨åœ¨æŸäº›å®žçŽ°ä¸­ï¼Œç”¨æ¥é˜²æ­¢åœ¨ä¸¤ä¸ªTCPä¹‹é—´çš„è¿žæŽ¥å‡ºçŽ°é•¿æ—¶é—´çš„ç©ºé—²ã€‚ å‡å®šå®¢æˆ·æ‰“å¼€äº†åˆ°æœåŠ¡å™¨çš„è¿žæŽ¥ï¼Œä¼ é€äº†ä¸€äº›æ•°æ®ï¼Œç„¶åŽå°±ä¿æŒé™é»˜äº†ã€‚ä¹Ÿè®¸è¿™ä¸ªå®¢æˆ·å‡ºæ•…éšœäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¿žæŽ¥å°†æ°¸è¿œçš„å¤„äºŽæ‰“å¼€çŠ¶æ€ã€‚ è¦è§£å†³è¿™ç§é—®é¢˜ï¼Œåœ¨å¤§å¤šæ•°çš„å®žçŽ°ä¸­éƒ½æ˜¯ä½¿æœåŠ¡å™¨è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œå°±å°†è®¡æ—¶å™¨å¤ä½ã€‚é€šå¸¸è®¾ç½®ä¸ºä¸¤å°æ—¶ã€‚ è‹¥æœåŠ¡å™¨è¿‡äº†ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€æŽ¢æµ‹æŠ¥æ–‡æ®µã€‚è‹¥å‘é€äº†10ä¸ªæŽ¢æµ‹æŠ¥æ–‡æ®µï¼ˆæ¯ä¸€ä¸ªé—´éš”75ç§’ï¼‰è¿˜æ²¡æœ‰å“åº”ï¼Œå°±å‡å®šå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œå› è€Œå°±ç»ˆæ­¢äº†è¯¥è¿žæŽ¥ã€‚ è¿™ç§è¿žæŽ¥çš„æ–­å¼€å½“ç„¶ä¸ä¼šä½¿ç”¨å››æ¬¡æ¡æ‰‹ï¼Œè€Œæ˜¯ç›´æŽ¥ç¡¬æ€§çš„ä¸­æ–­å’Œå®¢æˆ·ç«¯çš„TCPè¿žæŽ¥ã€‚ æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨æ˜¯åœ¨å››æ¬¡æŒ¥æ‰‹æ‰‹çš„æ—¶å€™ä½¿ç”¨çš„ã€‚å³åœ¨é‡Šæ”¾è¿žæŽ¥çš„æœ€ç»ˆé˜¶æ®µï¼Œå®¢æˆ·ç«¯è¿˜è¦ç­‰å¾…2MSLï¼ˆMSL=maxinum segment lifetimeæœ€é•¿æŠ¥æ–‡ç”Ÿå­˜æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸¤å€çš„MSLï¼‰æ‰èƒ½çœŸæ­£çš„å…³é—­è¿žæŽ¥ã€‚ UDPåè®® å®šä¹‰ User Datagram Protocolï¼Œå³ ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œå±žäºŽ ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚åŸºäºŽUDPçš„åº”ç”¨å±‚åè®®æœ‰ TFTPã€SNMP ä¸Ž DNSã€‚ ç‰¹ç‚¹ æ— è¿žæŽ¥ï¼šä½¿ç”¨UDPä¼ è¾“æ•°æ®å‰ï¼Œä¸éœ€è¦å»ºç«‹UDPè¿žæŽ¥ï¼Œå°±åƒå†™ä¿¡ï¼Œå†™å¥½ä¿¡äº¤ç»™é‚®å±€ï¼Œå…¶ä½™ä¸éœ€è¦ç®¡ã€‚ ä¸å¯é ï¼šUDPçš„æ•°æ®åŒ…å‘é€åŽï¼Œä¸ç®¡å…¶æ˜¯å¦ä¼šåˆ°è¾¾æŽ¥æ”¶æ–¹ï¼Œæ•…å¯èƒ½å‡ºçŽ°ä¸¢åŒ…çŽ°è±¡ã€‚ é¢å‘æŠ¥æ–‡ï¼šæ•°æ®ä»¥æ•°æ®æŠ¥æ–‡(åŒ…)çš„å½¢å¼ä¼ è¾“ï¼ŒUDPæ•°æ®æŠ¥æ–‡é•¿åº¦æ— é™åˆ¶ï¼Œéƒ½ä¸€æ¬¡æ€§å‘é€ï¼Œä¸åƒTCPä¼šæ‹†åˆ†ã€‚ æ— æ‹¥å¡žæŽ§åˆ¶ï¼šç”±äºŽæ˜¯ä¸å¯é ä¼ è¾“ï¼Œå³ä¸ç®¡æ˜¯å¦åˆ°è¾¾æŽ¥æ”¶æ–¹ï¼Œæ•…ä¸éœ€æ‹¥å¡žæŽ§åˆ¶ã€‚ æŠ¥æ–‡æ®µæ ¼å¼ ä¼ªé¦–éƒ¨ï¼šè®¡ç®—æ£€éªŒå’Œï¼ˆä¸å‘ä¸‹ä¼ é€ï¼Œä¹Ÿä¸å‘ä¸Šé€’äº¤ï¼‰ã€‚ æºç«¯å£ï¼šéœ€è¦å¯¹æ–¹å›žä¿¡æ—¶ä½¿ç”¨ï¼Œå¦‚æžœä¸éœ€è¦åˆ™è®¾ä¸ºå…¨0ã€‚ ç›®çš„ç«¯å£ï¼šç»ˆç‚¹äº¤ä»˜æŠ¥æ–‡æ—¶ç”¨åˆ°ã€‚ é•¿åº¦ï¼šUDPç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œæœ€å°å€¼æ˜¯8ï¼ˆä»…æœ‰é¦–éƒ¨ï¼‰ã€‚ æ£€éªŒå’Œï¼šæ£€æµ‹UDPç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ï¼Œè‹¥æœ‰é”™åˆ™ä¸¢å¼ƒã€‚ TCPã€UDPçš„åŒºåˆ« HTTPåè®® å®šä¹‰ HyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œè§„å®šäº†åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å‡†åˆ™ï¼Œå±žäºŽåº”ç”¨å±‚åè®®ã€‚ ç‰¹ç‚¹ æ— è¿žæŽ¥ï¼Œå³äº¤æ¢HTTPæŠ¥æ–‡å‰ï¼Œä¸éœ€è¦å»ºç«‹HTTPè¿žæŽ¥ã€‚ æ— çŠ¶æ€ï¼Œå³æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¿å­˜ä»»ä½•åŽ†å²çŠ¶æ€ä¿¡æ¯ï¼Œè¯¥ç‰¹æ€§ç®€åŒ–äº†æœåŠ¡å™¨çš„è®¾è®¡ï¼Œä½¿æœåŠ¡å™¨æ›´å®¹æ˜“æ”¯æŒå¤§é‡å¹¶å‘çš„HTTPè¯·æ±‚ã€‚ ä¼ è¾“æ ¼å¼ç®€å•ï¼Œå³è¯·æ±‚æ—¶åªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ ä¼ è¾“å¯é æ€§é«˜ï¼Œé‡‡ç”¨TCPä½œä¸ºè¿è¾“å±‚åè®®ã€‚ å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒB/Sã€C/Sæ¨¡å¼ã€‚ çµæ´»æ€§é«˜ï¼ŒHTTPå…è®¸ä¼ è¾“ä»»æ„ç±»åž‹çš„æ•°æ®å¯¹è±¡ã€‚ å·¥ä½œæ–¹å¼ HTTPåè®®é‡‡ç”¨è¯·æ±‚/å“åº”çš„å·¥ä½œæ–¹å¼ï¼Œå…·ä½“å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š HTTPæŠ¥æ–‡ HTTPæŠ¥æ–‡åˆ†ä¸ºï¼šè¯·æ±‚æŠ¥æ–‡ã€å“åº”æŠ¥æ–‡ã€‚ è¯·æ±‚æŠ¥æ–‡ HTTPçš„è¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç»„æˆã€‚å¦‚ä¸‹å›¾ï¼š è¯·æ±‚è¡Œ è¯·æ±‚è¡Œ = è¯·æ±‚æ–¹æ³• + è¯·æ±‚è·¯å¾„ + åè®®ç‰ˆæœ¬ ç”¨äºŽå£°æ˜Ž è¯·æ±‚æ–¹æ³• ã€ä¸»æœºåŸŸåã€èµ„æºè·¯å¾„ ã€åè®®ç‰ˆæœ¬ã€‚ å„éƒ¨åˆ†ç»„æˆä»‹ç»å¦‚ä¸‹å›¾ï¼š è¯·æ±‚å¤´ ä¸»è¦ç”¨äºŽå£°æ˜Žå®¢æˆ·ç«¯ã€æœåŠ¡å™¨/æŠ¥æ–‡çš„éƒ¨åˆ†ä¿¡æ¯ã€‚é‡‡ç”¨header(å­—æ®µå):value(å€¼)çš„æ–¹å¼ã€‚ è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„é€šç”¨Header åç§° ä½œç”¨ Content-Type è¯·æ±‚ä½“/å“åº”ä½“çš„ç±»åž‹ï¼Œå¦‚ï¼štext/plainã€application/json Accept è¯´æ˜ŽæŽ¥æ”¶çš„ç±»åž‹ï¼Œå¯ä»¥å¤šä¸ªå€¼ï¼Œç”¨ï¼Œï¼ˆåŠè§’é€—å·ï¼‰åˆ†å¼€ Content-Length è¯·æ±‚ä½“/å“åº”ä½“çš„é•¿åº¦ï¼Œå•ä½å­—èŠ‚ Content-Encoding è¯·æ±‚ä½“/å“åº”ä½“çš„ç¼–ç æ ¼å¼ï¼Œå¦‚gzip,deflate Accept-Encoding å‘ŠçŸ¥å¯¹æ–¹æˆ‘æ–¹æŽ¥å—çš„Content-Encoding ETag ç»™å½“å‰èµ„æºçš„æ ‡è¯†ï¼Œå’ŒLast-Modifiedã€If-None-Matchã€If-Modified-Since é…åˆï¼Œç”¨äºŽç¼“å­˜æŽ§åˆ¶ Cache-Control å–å€¼ä¸ºä¸€èˆ¬ä¸ºno-cacheæˆ–max-age=Xxï¼ŒXXä¸ºä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¯¥èµ„æºç¼“å­˜æœ‰æ•ˆæœŸï¼ˆç§’) å¸¸è§çš„è¯·æ±‚Header åç§° ä½œç”¨ Authorization ç”¨äºŽè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯ User-Agent ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOSå’Œæµè§ˆå™¨çš„ç±»åž‹å’Œç‰ˆæœ¬ If-Modified-Since å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›žçš„Last-Modifiedå€¼ï¼Œç”¨äºŽç¡®è®¤æŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡ï¼ˆ304ï¼‰å°±ä»Žç¼“å­˜ä¸­è¯»å– If-None-Match å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›žçš„ETagå€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Sinceä¸€èµ·å‡ºçŽ° Cookie å·²æœ‰çš„Cookie Referer è¡¨ç¤ºè¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»Žé¡µé¢Aè·³è½¬åˆ°é¡µé¢Bæ—¶ï¼Œå€¼ä¸ºé¡µé¢Açš„åœ°å€ Host è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å· è¯·æ±‚ä½“ ä¸»è¦ç”¨äºŽå­˜æ”¾éœ€å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ä¿¡æ¯ã€‚ ä½¿ç”¨æ–¹å¼å…±3ç§ï¼Œå¦‚ä¸‹å›¾ï¼š å“åº”æŠ¥æ–‡ HTTPå“åº”æŠ¥æ–‡åŒ…æ‹¬ï¼šçŠ¶æ€è¡Œã€å“åº”å¤´ã€å“åº”ä½“ã€‚ç»“æž„å¦‚ä¸‹å›¾ï¼š çŠ¶æ€è¡Œ çŠ¶æ€è¡Œ = åè®®ç‰ˆæœ¬ + çŠ¶æ€ç  + çŠ¶æ€ä¿¡æ¯ç»„æˆ ä¸»è¦ç”¨äºŽå£°æ˜Žåè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ç æè¿°ã€‚ å„éƒ¨åˆ†ç»„æˆå…·ä½“ä»‹ç»å¦‚ä¸‹ï¼š å“åº”å¤´ ä¸»è¦ç”¨äºŽå£°æ˜Žå®¢æˆ·ç«¯ã€æœåŠ¡å™¨/æŠ¥æ–‡çš„éƒ¨åˆ†ä¿¡æ¯ã€‚é‡‡ç”¨header(å­—æ®µå):value(å€¼)çš„æ–¹å¼ã€‚ å¸¸è§å“åº”Header åç§° ä½œç”¨ Date æœåŠ¡å™¨çš„æ—¥æœŸ Last-Modified è¯¥èµ„æºæœ€åŽè¢«ä¿®æ”¹æ—¶é—´ Transfer-Encoding å–å€¼ä¸ºä¸€èˆ¬ä¸ºchunkedï¼Œå‡ºçŽ°åœ¨Content-Lengthä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”ç‰ˆä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶è¿˜ä¼šå‡ºçŽ°Content-Encoding å“åº”å¤´ Set-Cookie è®¾ç½®Cookie Location é‡å®šå‘åˆ°å¦ä¸€ä¸ªURLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥baidu.comå›žè½¦ï¼Œä¼šè‡ªåŠ¨è·³åˆ°https://www.baidu.comï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æŽ§åˆ¶çš„ Server åŽå°æœåŠ¡å™¨ å“åº”ä½“ ä¸»è¦ç”¨äºŽå­˜æ”¾éœ€è¿”å›žç»™å®¢æˆ·ç«¯çš„æ•°æ®ä¿¡æ¯ã€‚ä½¿ç”¨æ–¹å¼åŒè¯·æ±‚æŠ¥æ–‡çš„è¯·æ±‚ä½“ã€‚ HTTP1.1 ä¸Ž HTTP1.0çš„åŒºåˆ« Http1.1 æ¯” Http1.0 å¤šäº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š å¼•å…¥æŒä¹…è¿žæŽ¥ï¼Œå³ åœ¨åŒä¸€ä¸ªTCPçš„è¿žæŽ¥ä¸­å¯ä¼ é€å¤šä¸ªHTTPè¯·æ±‚ &amp; å“åº”ï¼› å¤šä¸ªè¯·æ±‚ &amp; å“åº”å¯åŒæ—¶è¿›è¡Œã€å¯é‡å ï¼› å¼•å…¥æ›´åŠ å¤šçš„è¯·æ±‚å¤´ &amp; å“åº”å¤´ï¼› å…¶ä»–çŸ¥è¯† æµè§ˆå™¨ä¸­è¾“å…¥URLåˆ°é¡µé¢è¿”å›žçš„å…¨è¿‡ç¨‹ æ€»å…±åˆ†ä¸º7ä¸ªæ­¥éª¤ï¼Œæµç¨‹å¦‚ä¸‹å›¾ï¼š ç¬¬ä¸€æ­¥ï¼šåŸŸåè§£æž æµè§ˆå™¨æŸ¥æ‰¾æµè§ˆå™¨ç¼“å­˜ï¼Œå¦‚æžœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›žï¼Œå¦‚æžœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ æµè§ˆå™¨æŸ¥çœ‹æœ¬æœºçš„hostæ–‡ä»¶ï¼Œå¦‚æžœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›žï¼Œå¦‚æžœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ ç„¶åŽæ˜¯è·¯ç”±å™¨ç¼“å­˜ï¼Œè·¯ç”±å™¨ä¸€èˆ¬æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æžœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›žï¼Œå¦‚æžœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ æŽ¥ç€æ˜¯å¯¹æœ¬åœ°DNSæœåŠ¡å™¨è¿›è¡Œé€’å½’æŸ¥è¯¢ï¼Œçœ‹æ˜¯å¦æœ‰åŸŸåå¯¹åº”çš„IPã€‚ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨é€’å½’æŸ¥è¯¢ã€‚æ‰€è°“é€’å½’æŸ¥è¯¢å°±æ˜¯å¦‚æžœä¸»æœºæ‰€è¯¢é—®çš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“è¢«æŸ¥è¯¢åŸŸåçš„IPåœ°å€ï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ä»¥DNSå®¢æˆ·çš„èº«ä»½ï¼Œå‘å…¶ä»–æ ¹åŸŸåæœåŠ¡å™¨ç»§ç»­å‘å‡ºæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯è®©è¯¥ä¸»æœºè‡ªå·±è¿›è¡Œä¸‹ä¸€æ­¥æŸ¥è¯¢ã€‚ï¼ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨åœ°å€æ˜¯é€šè¿‡DHPCåè®®èŽ·å–åœ°å€ï¼ŒDHPCæ˜¯è´Ÿè´£åˆ†é…IPåœ°å€çš„ï¼‰ æœ¬åœ°åŸŸåæœåŠ¡å™¨é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œå®ƒå…ˆå‘ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ã€‚æ‰€è°“è¿­ä»£æŸ¥è¯¢å°±æ˜¯å½“æ ¹åŸŸåæœåŠ¡å™¨æ”¶åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºçš„æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡åŽï¼Œè¦ä¹ˆå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸‹ä¸€æ­¥åº”è¯¥æŸ¥è¯¢å“ªä¸€ä¸ªåŸŸåæœåŠ¡å™¨ï¼Œç„¶åŽæœ¬åœ°æœåŠ¡å™¨è‡ªå·±è¿›è¡ŒåŽç»­çš„æŸ¥è¯¢ã€‚ï¼ˆè€Œä¸æ˜¯æ›¿ä»£æœ¬åœ°æœåŠ¡å™¨è¿›è¡ŒåŽç»­æŸ¥è¯¢ï¼‰ã€‚ æ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”æŸ¥è¯¢çš„é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comè¿›è¡ŒæŸ¥è¯¢ã€‚ é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”æŸ¥è¯¢çš„æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comè¿›è¡ŒæŸ¥è¯¢ã€‚ æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œæ‰€æŸ¥è¯¢çš„ä¸»æœºwww.baidu.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€åŽæŠŠæŸ¥è¯¢ç»“æžœå‘Šè¯‰ä¸»æœºã€‚ ç¬¬äºŒæ­¥ï¼šå»ºç«‹TCPè¿žæŽ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹ ç¬¬ä¸‰æ­¥ï¼šWebæµè§ˆå™¨å‘WebæœåŠ¡ç«¯å‘é€HTTPè¯·æ±‚æŠ¥æ–‡ ç¬¬å››æ­¥ï¼šæœåŠ¡å™¨å“åº”HTTPè¯·æ±‚ ç¬¬äº”æ­¥ï¼šæµè§ˆå™¨è§£æžHTMLä»£ç ï¼Œå¹¶è¯·æ±‚HTMLä»£ç ä¸­çš„èµ„æºï¼ˆJSï¼ŒCSSï¼Œå›¾ç‰‡ï¼‰ï¼ˆè¿™æ˜¯è‡ªåŠ¨å‘æœåŠ¡å™¨è¯·æ±‚ä¸‹è½½çš„ï¼‰ ç¬¬å…­æ­¥ï¼šæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“å‘ˆçŽ°ç»™å®¢æˆ· ç¬¬ä¸ƒæ­¥ï¼šæ–­å¼€TCPè¿žæŽ¥ï¼Œå››æ¬¡æŒ¥æ‰‹ IPåœ°å€(IPV4) å®šä¹‰ è¿žæŽ¥åœ¨Internetä¸­çš„æ¯ä¸€å°ä¸»æœºï¼ˆæˆ– è·¯ç”±å™¨ï¼‰çš„å…¨çƒå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ ç»„æˆ IPåœ°å€ = 32ä½ = ç½‘ç»œå· + ä¸»æœºå·ï¼›å³IPåœ°å€::={&lt;ç½‘ç»œå·&gt;ï¼Œ&lt;ä¸»æœºå·&gt;} ç½‘ç»œå·ï¼šæ ‡å¿—ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰æ‰€è¿žæŽ¥åˆ°çš„ç½‘ç»œã€‚ä¸€ä¸ªç½‘ç»œå·åœ¨æ•´ä¸ªå› ç‰¹ç½‘èŒƒå›´å†…å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸»æœºå·ï¼šæ ‡å¿—è¯¥ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰ã€‚ä¸€ä¸ªä¸»æœºå·åœ¨å®ƒé¢å‰çš„ç½‘ç»œå·æ‰€æŒ‡æ˜Žçš„ç½‘ç»œèŒƒå›´å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸åŒç±»åž‹çš„IPåœ°å€ï¼Œå…¶ä¸»æœºå· &amp; ç½‘ç»œå·æ‰€å å­—èŠ‚æ•°ä¸åŒï¼›æ•…ï¼šä¸€ä¸ªIPåœ°å€åœ¨æ•´ä¸ªç½‘ç»œèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ã€‚ åˆ†ç±» ä¼ ç»Ÿçš„IPåœ°å€æ˜¯åˆ†ç±»çš„åœ°å€ï¼Œåˆ†ä¸ºAï¼ŒBï¼ŒCï¼ŒDï¼ŒEäº”ç±»ï¼ŒåŒºåˆ«åœ¨äºŽç½‘ç»œå· &amp; ä¸»æœºå·å çš„å­—èŠ‚æ•°ä¸åŒã€‚ ç‰¹åˆ«æ³¨æ„ï¼šåœ¨å„ç±»IPåœ°å€ä¸­ï¼Œæœ‰ä¸€äº›IPåœ°å€ç”¨äºŽç‰¹æ®Šç”¨é€”ï¼Œä¸èƒ½ç”¨äºŽåšä¸»æœºIPåœ°å€ Cookieä¸ŽSession]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMç±»åŠ è½½æœºåˆ¶]]></title>
    <url>%2Fposts%2Fde06556f.html</url>
    <content type="text"><![CDATA[ç±»åŠ è½½æ—¶æœº ç±»çš„ç”Ÿå‘½å‘¨æœŸ ä¸€ä¸ªç±»ä»ŽåŠ è½½è¿›å†…å­˜åˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œä¸€å…±ç»åŽ†7ä¸ªé˜¶æ®µï¼š &lt;span id=&quot;inline-blue&quot;&gt; åŠ è½½â€”â€”&gt;éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æžâ€”â€”&gt;åˆå§‹åŒ–â€”â€”&gt;ä½¿ç”¨â€”â€”&gt;å¸è½½ &lt;/span&gt; å…¶ä¸­ï¼Œç±»åŠ è½½åŒ…æ‹¬5ä¸ªé˜¶æ®µï¼š &lt;span id=&quot;inline-green&quot;&gt; åŠ è½½â€”â€”&gt;éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æžâ€”â€”&gt;åˆå§‹åŒ– &lt;/span&gt; åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œä»¥ä¸‹3ä¸ªè¿‡ç¨‹ç§°ä¸ºè¿žæŽ¥ï¼š &lt;span id=&quot;inline-purple&quot;&gt; éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æž &lt;/span&gt; å› æ­¤ï¼ŒJVMçš„ç±»åŠ è½½è¿‡ç¨‹ä¹Ÿå¯ä»¥æ¦‚æ‹¬ä¸º3ä¸ªè¿‡ç¨‹ï¼š &lt;span id=&quot;inline-yellow&quot;&gt; åŠ è½½â€”â€”&gt;è¿žæŽ¥â€”â€”&gt;åˆå§‹åŒ– &lt;/span&gt; C/C++åœ¨è¿è¡Œå‰éœ€è¦å®Œæˆé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æŽ¥ï¼›è€Œåœ¨Javaä¸­ï¼Œç±»åŠ è½½(åŠ è½½ã€è¿žæŽ¥ã€åˆå§‹åŒ–)æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ã€‚ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´è¿›è¡Œç±»åŠ è½½ä¼šç¨å¾®å¢žåŠ ç¨‹åºçš„å¼€é”€ï¼Œä½†éšä¹‹ä¼šå¸¦æ¥æ›´å¤§çš„å¥½å¤„â€”â€”æé«˜ç¨‹åºçš„çµæ´»æ€§ã€‚Javaè¯­è¨€çš„çµæ´»æ€§ä½“çŽ°åœ¨å®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸé—´&lt;span id=&quot;inline-blue&quot;&gt;åŠ¨æ€æ‰©å±•&lt;/span&gt;ï¼Œæ‰€è°“åŠ¨æ€æ‰©å±•å°±æ˜¯åœ¨è¿è¡ŒæœŸé—´&lt;span id=&quot;inline-blue&quot;&gt;åŠ¨æ€åŠ è½½&lt;/span&gt;å’Œ&lt;span id=&quot;inline-blue&quot;&gt;åŠ¨æ€è¿žæŽ¥&lt;/span&gt;ã€‚ ç±»åŠ è½½çš„æ—¶æœº ç±»åŠ è½½è¿‡ç¨‹ä¸­æ¯ä¸ªæ­¥éª¤çš„é¡ºåº ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬ï¼šåŠ è½½ã€è¿žæŽ¥ã€åˆå§‹åŒ–ï¼Œè¿žæŽ¥åˆåˆ†ä¸ºï¼šéªŒè¯ã€å‡†å¤‡ã€è§£æžï¼Œæ‰€ä»¥è¯´ç±»åŠ è½½ä¸€å…±åˆ†ä¸º5æ­¥ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æžã€åˆå§‹åŒ–ã€‚ å…¶ä¸­åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–çš„å¼€å§‹é¡ºåºæ˜¯ä¾æ¬¡è¿›è¡Œçš„ï¼Œè¿™äº›æ­¥éª¤å¼€å§‹ä¹‹åŽçš„è¿‡ç¨‹å¯èƒ½ä¼šæœ‰é‡å ã€‚ è€Œè§£æžè¿‡ç¨‹ä¼šå‘ç”Ÿåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ã€‚ ç±»åŠ è½½è¿‡ç¨‹ä¸­â€œåˆå§‹åŒ–â€å¼€å§‹çš„æ—¶æœº JVMè§„èŒƒä¸­åªå®šä¹‰äº†ç±»åŠ è½½è¿‡ç¨‹ä¸­åˆå§‹åŒ–è¿‡ç¨‹å¼€å§‹çš„æ—¶æœºï¼ŒåŠ è½½ã€è¿žæŽ¥è¿‡ç¨‹éƒ½åº”è¯¥åœ¨åˆå§‹åŒ–ä¹‹å‰å¼€å§‹(è§£æžé™¤å¤–)ï¼Œè¿™äº›è¿‡ç¨‹å…·ä½“åœ¨ä½•æ—¶å¼€å§‹ï¼ŒJVMè§„èŒƒå¹¶æ²¡æœ‰å®šä¹‰ï¼Œä¸åŒçš„è™šæ‹Ÿæœºå¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚è‡ªå®šä¹‰ã€‚ &lt;span id=&quot;inline-purple&quot;&gt; åˆå§‹åŒ–å¼€å§‹çš„æ—¶æœºï¼š&lt;/span&gt; åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¦‚ä¸‹å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æžœç±»å°šæœªåˆå§‹åŒ–ï¼Œé‚£å°±è¦è¿›è¡Œåˆå§‹åŒ–ï¼šnewã€getstaticã€putstaticã€invokestaticã€‚è¿™å››ä¸ªæŒ‡ä»¤å¯¹åº”çš„Javaä»£ç åœºæ™¯æ˜¯ï¼š é€šè¿‡newåˆ›å»ºå¯¹è±¡ï¼› è¯»å–ã€è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å˜é‡(ä¸åŒ…æ‹¬finalä¿®é¥°çš„é™æ€å˜é‡)ï¼› è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å‡½æ•°ã€‚ ä½¿ç”¨java.lang.reflectè¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æžœç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£å°±éœ€è¦åˆå§‹åŒ–ï¼› å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè‹¥å…¶çˆ¶ç±»å°šæœªåˆå§‹åŒ–ï¼Œé‚£å°±å…ˆè¦è®©å…¶çˆ¶ç±»åˆå§‹åŒ–ï¼Œç„¶åŽå†åˆå§‹åŒ–æœ¬ç±»ï¼› å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œè™šæ‹Ÿæœºä¼šé¦–å…ˆåˆå§‹åŒ–å¸¦æœ‰mainæ–¹æ³•çš„ç±»ï¼Œå³ä¸»ç±»ï¼› å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æžœä¸€ä¸ª java.lang.invoke.MethodHandle å®žä¾‹æœ€åŽçš„è§£æžç»“æžœ REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ ä¸»åŠ¨å¼•ç”¨ ä¸Ž è¢«åŠ¨å¼•ç”¨ JVMè§„èŒƒä¸­è¦æ±‚åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œâ€œå½“ä¸”ä»…å½“â€å‡ºçŽ°ä¸Šè¿°4ä¸ªæ¡ä»¶ä¹‹ä¸€çš„æƒ…å†µæ‰ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ã€‚å¦‚æžœé—´æŽ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–æ¡ä»¶æ˜¯ä¸ä¼šåˆå§‹åŒ–ç±»çš„ã€‚ å…¶ä¸­ï¼Œç›´æŽ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–æ¡ä»¶çš„æƒ…å†µå«åšä¸»åŠ¨å¼•ç”¨ï¼›é—´æŽ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–è¿‡ç¨‹çš„æƒ…å†µå«åšè¢«åŠ¨å¼•ç”¨ã€‚ é‚£ä¹ˆï¼Œåªæœ‰å½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ»¡è¶³ä¸»åŠ¨å¼•ç”¨çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œè‹¥æ»¡è¶³è¢«åŠ¨å¼•ç”¨å°±ä¸ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ã€‚ è¢«åŠ¨å¼•ç”¨çš„åœºæ™¯ç¤ºä¾‹ ç¤ºä¾‹ä¸€ 12345678910111213141516public class Fu&#123; public static String name = "ç±»åˆå§‹åŒ–çš„æ—¶æœº"; static&#123; System.out.println("çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼"); &#125;&#125;public class Zi&#123; static&#123; System.out.println("å­ç±»è¢«åˆå§‹åŒ–ï¼"); &#125;&#125;public static void main(String[] args)&#123; System.out.println(Zi.name);&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; 12çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼ ç±»åˆå§‹åŒ–çš„æ—¶æœº &lt;span id=&quot;inline-green&quot;&gt; åŽŸå› åˆ†æžï¼š &lt;/span&gt; æœ¬ç¤ºä¾‹çœ‹ä¼¼æ»¡è¶³åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€æ¡ï¼šå½“è¦èŽ·å–æŸä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å˜é‡çš„æ—¶å€™å¦‚æžœè¯¥ç±»å°šæœªåˆå§‹åŒ–ï¼Œåˆ™å¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚ ä½†ç”±äºŽè¿™ä¸ªé™æ€æˆå‘˜å˜é‡å±žäºŽFuç±»ï¼ŒZiç±»åªæ˜¯é—´æŽ¥è°ƒç”¨Fuç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡ï¼Œå› æ­¤Ziç±»è°ƒç”¨nameå±žæ€§å±žäºŽé—´æŽ¥å¼•ç”¨ï¼Œè€ŒFuç±»è°ƒç”¨nameå±žæ€§å±žäºŽç›´æŽ¥å¼•ç”¨ï¼Œç”±äºŽJVMåªåˆå§‹åŒ–ç›´æŽ¥å¼•ç”¨çš„ç±»ï¼Œå› æ­¤åªæœ‰Fuç±»è¢«åˆå§‹åŒ–ã€‚ ç¤ºä¾‹äºŒ 12345public class Test&#123; public static void main(String[] args)&#123; Fu[] arr = new Fu[10]; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; å¹¶æ²¡æœ‰è¾“å‡ºâ€œçˆ¶ç±»è¢«åˆå§‹åŒ–ï¼â€ &lt;span id=&quot;inline-green&quot;&gt; åŽŸå› åˆ†æžï¼š &lt;/span&gt; è¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼æ»¡è¶³åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€æ¡ï¼šé‡åˆ°newåˆ›å»ºå¯¹è±¡æ—¶è‹¥ç±»æ²¡è¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–è¯¥ç±»ã€‚ ä½†çŽ°åœ¨é€šè¿‡newè¦åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œè€ŒéžFuç±»å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå±žäºŽé—´æŽ¥å¼•ç”¨ï¼Œä¸ä¼šåˆå§‹åŒ–Fuç±»ã€‚ ç¤ºä¾‹ä¸‰ 123456789101112public class Fu&#123; public static final String name = "ç±»åˆå§‹åŒ–çš„æ—¶æœº"; static&#123; System.out.println("çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼"); &#125;&#125;public class Son&#123; public static void main(String[] args)&#123; System.out.println(Fu.name); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; ç±»åˆå§‹åŒ–çš„æ—¶æœº &lt;span id=&quot;inline-green&quot;&gt; åŽŸå› åˆ†æžï¼š &lt;/span&gt; æœ¬ç¤ºä¾‹çœ‹ä¼¼æ»¡è¶³ç±»åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼šèŽ·å–ä¸€ä¸ªç±»é™æ€æˆå‘˜å˜é‡çš„æ—¶å€™è‹¥ç±»å°šæœªåˆå§‹åŒ–åˆ™åˆå§‹åŒ–ç±»ã€‚ ä½†æ˜¯ï¼ŒFuç±»çš„é™æ€æˆå‘˜å˜é‡è¢«finalä¿®é¥°ï¼Œå®ƒå·²ç»æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚è¢«finalä¿®é¥°çš„å¸¸é‡åœ¨Javaä»£ç ç¼–è¯‘çš„è¿‡ç¨‹ä¸­å°±ä¼šè¢«æ”¾å…¥å®ƒè¢«å¼•ç”¨çš„classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­(è¿™é‡Œæ˜¯Açš„å¸¸é‡æ± )ã€‚æ‰€ä»¥ç¨‹åºåœ¨è¿è¡ŒæœŸé—´å¦‚æžœéœ€è¦è°ƒç”¨è¿™ä¸ªå¸¸é‡ï¼Œç›´æŽ¥åŽ»å½“å‰ç±»çš„å¸¸é‡æ± ä¸­å–ï¼Œè€Œä¸éœ€è¦åˆå§‹åŒ–è¿™ä¸ªç±»ã€‚ æŽ¥å£çš„åˆå§‹åŒ– æŽ¥å£å’Œç±»éƒ½éœ€è¦åˆå§‹åŒ–ï¼ŒæŽ¥å£å’Œç±»çš„åˆå§‹åŒ–è¿‡ç¨‹åŸºæœ¬ä¸€æ ·ï¼Œä¸åŒç‚¹åœ¨äºŽï¼šç±»åˆå§‹åŒ–æ—¶ï¼Œå¦‚æžœå‘çŽ°çˆ¶ç±»å°šæœªè¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆè¦åˆå§‹åŒ–çˆ¶ç±»ï¼Œç„¶åŽå†åˆå§‹åŒ–è‡ªå·±ï¼›ä½†æŽ¥å£åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚çˆ¶æŽ¥å£å·²ç»å…¨éƒ¨åˆå§‹åŒ–ï¼Œåªæœ‰ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”¨åˆ°å½“çˆ¶æŽ¥å£ä¸­çš„ä¸œè¥¿æ—¶æ‰åˆå§‹åŒ–çˆ¶æŽ¥å£ã€‚ ç±»åŠ è½½çš„è¿‡ç¨‹ åŠ è½½ &lt;font color=&quot;red&quot;&gt;æ³¨æ„ï¼šâ€œåŠ è½½â€æ˜¯â€œç±»åŠ è½½â€è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œåƒä¸‡ä¸è¦æ··æ·†ã€‚&lt;/font&gt; åŠ è½½çš„è¿‡ç¨‹ åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒJVMä¸»è¦åš3ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥èŽ·å–è¿™ä¸ªç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå³classæ–‡ä»¶ï¼š åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“è¦è®¿é—®ä¸€ä¸ªç±»æ—¶ï¼Œè‹¥å‘çŽ°è¿™ä¸ªç±»å°šæœªè¢«åŠ è½½ï¼Œå¹¶æ»¡è¶³ç±»åˆå§‹åŒ–æ—¶æœºçš„æ¡ä»¶æ—¶ï¼Œå°±æ ¹æ®è¦è¢«åˆå§‹åŒ–çš„è¿™ä¸ªç±»çš„å…¨é™å®šåæ‰¾åˆ°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå¼€å§‹åŠ è½½è¿‡ç¨‹ã€‚ å°†äºŒè¿›åˆ¶å­—èŠ‚æµçš„å­˜å‚¨ç»“æž„è½¬åŒ–ä¸ºç‰¹å®šçš„æ•°æ®ç»“æž„ï¼Œå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼› åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªjava.lang.Classç±»åž‹çš„å¯¹è±¡ï¼š æŽ¥ä¸‹æ¥ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰å¯¹è¯¥ç±»çš„è®¿é—®éƒ½é€šè¿‡è¿™ä¸ªç±»å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªClassç±»åž‹çš„ç±»å¯¹è±¡æ˜¯æä¾›ç»™å¤–ç•Œè®¿é—®è¯¥ç±»çš„æŽ¥å£ã€‚ ä»Žå“ªé‡ŒåŠ è½½ JVMè§„èŒƒå¯¹äºŽåŠ è½½è¿‡ç¨‹ç»™äºˆäº†è¾ƒå¤§çš„å®½æ¾åº¦ã€‚ä¸€èˆ¬äºŒè¿›åˆ¶å­—èŠ‚æµéƒ½ä»Žå·²ç»ç¼–è¯‘å¥½çš„æœ¬åœ°classæ–‡ä»¶ä¸­è¯»å–ï¼Œæ­¤å¤–è¿˜å¯ä»¥ä»Žä»¥ä¸‹åœ°æ–¹è¯»å–ï¼š ä»ŽåŽ‹ç¼©åŒ…ä¸­è¯»å–ï¼Œå¦‚ï¼šJarã€Warã€Earç­‰ã€‚ ä»Žå…¶å®ƒæ–‡ä»¶ä¸­åŠ¨æ€ç”Ÿæˆï¼Œå¦‚ï¼šä»ŽJSPæ–‡ä»¶ä¸­ç”ŸæˆClassç±»ã€‚ ä»Žæ•°æ®åº“ä¸­è¯»å–ï¼Œå°†äºŒè¿›åˆ¶å­—èŠ‚æµå­˜å‚¨è‡³æ•°æ®åº“ä¸­ï¼Œç„¶åŽåœ¨åŠ è½½æ—¶ä»Žæ•°æ®åº“ä¸­è¯»å–ã€‚æœ‰äº›ä¸­é—´ä»¶ä¼šè¿™ä¹ˆåšï¼Œç”¨æ¥å®žçŽ°ä»£ç åœ¨é›†ç¾¤é—´åˆ†å‘ã€‚ ä»Žç½‘ç»œä¸­èŽ·å–ï¼Œä»Žç½‘ç»œä¸­èŽ·å–äºŒè¿›åˆ¶å­—èŠ‚æµã€‚å…¸åž‹å°±æ˜¯Appletã€‚ ç±» å’Œ æ•°ç»„åŠ è½½è¿‡ç¨‹çš„åŒºåˆ« æ•°ç»„ä¹Ÿæœ‰ç±»åž‹ï¼Œç§°ä¸ºâ€œæ•°ç»„ç±»åž‹â€ã€‚å¦‚ï¼šString[] str = new String[10]; è¿™ä¸ªæ•°ç»„çš„æ•°ç»„ç±»åž‹æ˜¯Ljava.lang.Stringï¼Œè€ŒStringåªæ˜¯è¿™ä¸ªæ•°ç»„ä¸­å…ƒç´ çš„ç±»åž‹ã€‚ å½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°newå…³é”®å­—åˆ›å»ºä¸€ä¸ªæ•°ç»„æ—¶ï¼Œç”±JVMç›´æŽ¥åˆ›å»ºæ•°ç»„ç±»ï¼Œå†ç”±ç±»åŠ è½½å™¨åˆ›å»ºæ•°ç»„ä¸­çš„å…ƒç´ ç±»ã€‚ è€Œæ™®é€šç±»çš„åŠ è½½ç”±ç±»åŠ è½½å™¨å®Œæˆã€‚æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚ åŠ è½½è¿‡ç¨‹çš„æ³¨æ„ç‚¹ JVMè§„èŒƒå¹¶æœªç»™å‡ºç±»åœ¨æ–¹æ³•åŒºä¸­å­˜æ”¾çš„æ•°æ®ç»“æž„ ç±»å®ŒæˆåŠ è½½åŽï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå°±ä»¥ç‰¹å®šçš„æ•°æ®ç»“æž„å­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä½†å­˜å‚¨çš„æ•°æ®ç»“æž„æ˜¯ç”±è™šæ‹Ÿæœºè‡ªå·±å®šä¹‰çš„ï¼ŒJVMè§„èŒƒå¹¶æ²¡æœ‰æŒ‡å®šã€‚ JVMè§„èŒƒå¹¶æ²¡æœ‰æŒ‡å®šClasså¯¹è±¡å­˜æ”¾çš„ä½ç½® åœ¨äºŒè¿›åˆ¶å­—èŠ‚æµä»¥ç‰¹å®šæ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºåŽï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»åž‹çš„å¯¹è±¡ï¼Œä½œä¸ºæœ¬ç±»çš„å¤–éƒ¨æŽ¥å£ã€‚æ—¢ç„¶æ˜¯å¯¹è±¡å°±åº”è¯¥å­˜æ”¾åœ¨å †å†…å­˜ä¸­ï¼Œä¸è¿‡JVMè§„èŒƒå¹¶æ²¡æœ‰ç»™å‡ºé™åˆ¶ï¼Œä¸åŒçš„è™šæ‹Ÿæœºæ ¹æ®è‡ªå·±çš„éœ€æ±‚å­˜æ”¾è¿™ä¸ªå¯¹è±¡ã€‚HotSpotå°†Classå¯¹è±¡å­˜æ”¾åœ¨æ–¹æ³•åŒºã€‚ åŠ è½½é˜¶æ®µå’Œè¿žæŽ¥é˜¶æ®µæ˜¯äº¤å‰çš„ é€šè¿‡å‰æ–‡å¯çŸ¥ï¼Œç±»åŠ è½½è¿‡ç¨‹ä¸­æ¯ä¸ªæ­¥éª¤çš„å¼€å§‹é¡ºåºéƒ½æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œä½†æ¯ä¸ªæ­¥éª¤çš„ç»“æŸé¡ºåºæ²¡æœ‰é™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»æŒ‰ç…§å¦‚ä¸‹é¡ºåºå¼€å§‹ï¼š åŠ è½½ã€è¿žæŽ¥ã€åˆå§‹åŒ–ï¼Œä½†ç»“æŸé¡ºåºæ— æ‰€è°“ï¼Œå› æ­¤ç”±äºŽæ¯ä¸ªæ­¥éª¤å¤„ç†æ—¶é—´çš„é•¿çŸ­ä¸ä¸€å°±ä¼šå¯¼è‡´æœ‰äº›æ­¥éª¤ä¼šå‡ºçŽ°äº¤å‰ã€‚ éªŒè¯ éªŒè¯é˜¶æ®µæ¯”è¾ƒè€—æ—¶ï¼Œå®ƒéžå¸¸é‡è¦ä½†ä¸ä¸€å®šå¿…è¦ï¼Œå¦‚æžœæ‰€è¿è¡Œçš„ä»£ç å·²ç»è¢«åå¤ä½¿ç”¨å’ŒéªŒè¯è¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨-Xverify:noneå‚æ•°å…³é—­ï¼Œä»¥ç¼©çŸ­ç±»åŠ è½½æ—¶é—´ã€‚ éªŒè¯çš„ç›®çš„ éªŒè¯æ˜¯ä¸ºäº†ä¿è¯äºŒè¿›åˆ¶å­—èŠ‚æµä¸­çš„ä¿¡æ¯ç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒï¼Œå¹¶æ²¡æœ‰å®‰å…¨é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯ è™½ç„¶Javaè¯­è¨€æ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œå®ƒèƒ½ç¡®ä¿ç¨‹åºçŒ¿æ— æ³•è®¿é—®æ•°ç»„è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€é¿å…è®©ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä»»æ„ç±»åž‹ã€é¿å…è·³è½¬åˆ°ä¸å­˜åœ¨çš„ä»£ç è¡Œï¼Œå¦‚æžœå‡ºçŽ°è¿™äº›æƒ…å†µï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJavaè¯­è¨€çš„å®‰å…¨æ€§æ˜¯é€šè¿‡ç¼–è¯‘å™¨æ¥ä¿è¯çš„ã€‚ ä½†æ˜¯ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ä¸œè¥¿ï¼Œè™šæ‹Ÿæœºåªè®¤äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå®ƒä¸ä¼šç®¡æ‰€èŽ·å¾—çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å“ªæ¥çš„ï¼Œå½“ç„¶ï¼Œå¦‚æžœæ˜¯ç¼–è¯‘å™¨ç»™å®ƒçš„ï¼Œé‚£ä¹ˆå°±ç›¸å¯¹å®‰å…¨ï¼Œä½†å¦‚æžœæ˜¯ä»Žå…¶å®ƒé€”å¾„èŽ·å¾—çš„ï¼Œé‚£ä¹ˆæ— æ³•ç¡®ä¿è¯¥äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å®‰å…¨çš„ã€‚é€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼Œè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰é™åˆ¶äºŒè¿›åˆ¶å­—èŠ‚æµçš„æ¥æºï¼Œé‚£ä¹ˆä»»æ„æ¥æºçš„äºŒè¿›åˆ¶å­—èŠ‚æµè™šæ‹Ÿæœºéƒ½èƒ½æŽ¥å—ï¼Œä¸ºäº†é˜²æ­¢å­—èŠ‚æµä¸­æœ‰å®‰å…¨é—®é¢˜ï¼Œå› æ­¤éœ€è¦éªŒè¯ï¼ éªŒè¯çš„è¿‡ç¨‹ æ–‡ä»¶æ ¼å¼éªŒè¯ æ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†… å¸¸é‡æ± çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒå¸¸é‡çš„ç±»åž‹ï¼ˆæ£€æŸ¥å¸¸é‡ tag æ ‡å¿—ï¼‰ æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»åž‹çš„å¸¸é‡ CONSTANT_Utf8_info åž‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆ UTF8 ç¼–ç çš„æ•°æ® Class æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†é›†æ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„é™„åŠ çš„å…¶ä»–ä¿¡æ¯ â€¦â€¦ è¿™ä¸ªé˜¶æ®µä¸»è¦éªŒè¯è¾“å…¥çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å¦ç¬¦åˆclassæ–‡ä»¶ç»“æž„çš„è§„èŒƒã€‚äºŒè¿›åˆ¶å­—èŠ‚æµåªæœ‰é€šè¿‡äº†æœ¬é˜¶æ®µçš„éªŒè¯ï¼Œæ‰ä¼šè¢«å…è®¸å­˜å…¥åˆ°æ–¹æ³•åŒºä¸­ã€‚ æœ¬éªŒè¯é˜¶æ®µæ˜¯åŸºäºŽäºŒè¿›åˆ¶å­—èŠ‚æµçš„ï¼Œè€ŒåŽé¢çš„ä¸‰ä¸ªéªŒè¯é˜¶æ®µéƒ½æ˜¯åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œï¼Œå¹¶åŸºäºŽç±»ç‰¹å®šçš„æ•°æ®ç»“æž„çš„ã€‚ é€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼ŒåŠ è½½å¼€å§‹å‰ï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµè¿˜æ²¡è¿›æ–¹æ³•åŒºï¼Œè€ŒåŠ è½½å®ŒæˆåŽï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå·²ç»å­˜å…¥æ–¹æ³•åŒºã€‚è€Œåœ¨æ–‡ä»¶æ ¼å¼éªŒè¯å‰ï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå°šæœªè¿›å…¥æ–¹æ³•åŒºï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯é€šè¿‡ä¹‹åŽæ‰è¿›å…¥æ–¹æ³•åŒºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½å¼€å§‹åŽï¼Œç«‹å³å¯åŠ¨äº†æ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œæœ¬é˜¶æ®µéªŒè¯é€šè¿‡åŽï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµè¢«è½¬æ¢æˆç‰¹å®šæ•°æ®ç»“æž„å­˜å‚¨è‡³æ–¹æ³•åŒºä¸­ï¼Œç»§è€Œå¼€å§‹ä¸‹é˜¶æ®µçš„éªŒè¯å’Œåˆ›å»ºClasså¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹å°è¯äº†ï¼šåŠ è½½å’ŒéªŒè¯æ˜¯äº¤å‰è¿›è¡Œçš„ã€‚ å…ƒæ•°æ®éªŒè¯ è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤ java.lang.Object ä¹‹å¤–ï¼‰ è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆfinal ä¿®é¥°çš„ç±»ï¼‰ å¦‚æžœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®žçŽ°äº†å…¶çˆ¶ç±»æˆ–æŽ¥å£ä¹‹ä¸­è¦æ±‚å®žçŽ°çš„æ‰€æœ‰æ–¹æ³• ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸Žçˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆè¦†ç›–çˆ¶ç±» final å­—æ®µã€å‡ºçŽ°ä¸ç¬¦åˆè§„èŒƒçš„é‡è½½ï¼‰ æœ¬é˜¶æ®µå¯¹æ–¹æ³•åŒºä¸­çš„å­—èŠ‚ç æè¿°ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æžï¼Œç¡®ä¿å…¶ç¬¦åˆJavaè¯­æ³•è§„èŒƒã€‚ å­—èŠ‚ç éªŒè¯ ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»åž‹ä¸ŽæŒ‡ä»¤ä»£ç åºåˆ—éƒ½éž¥é…åˆå·¥ä½œï¼ˆä¸ä¼šå‡ºçŽ°æŒ‰ç…§ long ç±»åž‹è¯»ä¸€ä¸ª int åž‹æ•°æ®ï¼‰ ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Š ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»åž‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ï¼ˆå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»åž‹æ˜¯å®‰å…¨çš„ï¼Œåè¿‡æ¥ä¸åˆæ³•çš„ï¼‰ â€¦â€¦ è¿™æ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’ŒæŽ§åˆ¶æµåˆ†æžï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚è¿™ä¸ªé˜¶æ®µå¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æžï¼Œä¿è¯æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦åˆ›æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±» åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦æ–¹æ³•çš„å­—æ®µæè¿°ç¬¦ä»¥åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—® â€¦â€¦ æœ¬é˜¶æ®µéªŒè¯å‘ç”Ÿåœ¨è§£æžé˜¶æ®µï¼Œç¡®ä¿è§£æžèƒ½æ­£å¸¸æ‰§è¡Œã€‚å¦‚æžœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯å°†æŠ›å‡ºä¸€ä¸ª java.lang.IncompatibleClass.ChangeError å¼‚å¸¸çš„å­ç±»ã€‚å¦‚ java.lang.IllegalAccessErrorã€java.lang.NoSuchFieldErrorã€java.lang.NoSuchMethodError ç­‰ã€‚ å‡†å¤‡ å‡†å¤‡é˜¶æ®µå®Œæˆä¸¤ä»¶äº‹æƒ…ï¼š ä¸ºå·²ç»åœ¨æ–¹æ³•åŒºä¸­çš„ç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡åˆ†é…å†…å­˜ ç±»çš„é™æ€æˆå‘˜å˜é‡ä¹Ÿå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ã€‚ ä¸ºé™æ€æˆå‘˜å˜é‡è®¾ç½®åˆå§‹å€¼ åˆå§‹å€¼ä¸º0ã€falseã€nullç­‰ã€‚ æ•°æ®ç±»åž‹çš„é›¶å€¼: æ•°æ®ç±»åž‹ é›¶å€¼ byte (byte) 0 short (short) 0 int 0 long 0L float 0.0f double 0.0d char '\u0000' boolean false reference null ç¤ºä¾‹1ï¼š 1public static String name = "æµ‹è¯•ç±»åŠ è½½"; åœ¨å‡†å¤‡é˜¶æ®µï¼ŒJVMä¼šåœ¨æ–¹æ³•åŒºä¸­ä¸ºnameåˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶èµ‹ä¸Šåˆå§‹å€¼nullã€‚ ç»™nameèµ‹ä¸Šâ€æµ‹è¯•ç±»åŠ è½½â€æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆçš„ã€‚ ç¤ºä¾‹2: 1public static final String name = "æµ‹è¯•ç±»åŠ è½½"; è¢«finalä¿®é¥°çš„å¸¸é‡å¦‚æžœæœ‰åˆå§‹å€¼ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šå°†åˆå§‹å€¼å­˜å…¥constantValueå±žæ€§ä¸­ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå°±å°†constantValueçš„å€¼èµ‹ç»™è¯¥å­—æ®µã€‚ è§£æž è§£æžé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æŽ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ åˆå§‹åŒ– åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æž„é€ å™¨clinit()çš„è¿‡ç¨‹ã€‚ clinit()æ–¹æ³•ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿï¼Œæ”¶é›†ç±»ä¸­static{}ä»£ç å—ä¸­çš„ç±»å˜é‡èµ‹å€¼è¯­å¥å’Œç±»ä¸­é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼è¯­å¥ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»ä¸­é™æ€æˆå‘˜å˜é‡å·²ç»å®Œæˆäº†é»˜è®¤åˆå§‹åŒ–ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œclinit()æ–¹æ³•å¯¹é™æ€æˆå‘˜å˜é‡è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ã€‚ åˆå§‹åŒ–è¿‡ç¨‹çš„æ³¨æ„ç‚¹ clinit()æ–¹æ³•ä¸­é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼é¡ºåºæ˜¯æ ¹æ®Javaä»£ç ä¸­æˆå‘˜å˜é‡çš„å‡ºçŽ°çš„é¡ºåºå†³å®šçš„ã€‚ é™æ€ä»£ç å—èƒ½è®¿é—®å‡ºçŽ°åœ¨é™æ€ä»£ç å—ä¹‹å‰çš„é™æ€æˆå‘˜å˜é‡ï¼Œæ— æ³•è®¿é—®å‡ºçŽ°åœ¨é™æ€ä»£ç å—ä¹‹åŽçš„æˆå‘˜å˜é‡ã€‚ é™æ€ä»£ç å—èƒ½ç»™å‡ºçŽ°åœ¨é™æ€ä»£ç å—ä¹‹åŽçš„é™æ€æˆå‘˜å˜é‡èµ‹å€¼ã€‚ æž„é€ å‡½æ•°init()éœ€è¦æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æž„é€ å‡½æ•°ï¼Œè€Œç±»çš„æž„é€ å‡½æ•°clinit()ä¸éœ€è¦è°ƒç”¨çˆ¶ç±»çš„ç±»æž„é€ å‡½æ•°ï¼Œå› ä¸ºè™šæ‹Ÿæœºä¼šç¡®ä¿å­ç±»çš„clinit()æ–¹æ³•æ‰§è¡Œå‰å·²ç»æ‰§è¡Œäº†çˆ¶ç±»çš„clinit()æ–¹æ³•ã€‚ å¦‚æžœä¸€ä¸ªç±»/æŽ¥å£ä¸­æ²¡æœ‰é™æ€ä»£ç å—ï¼Œä¹Ÿæ²¡æœ‰é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¸ä¼šç”Ÿæˆclinit()æ–¹æ³•ã€‚ æŽ¥å£ä¹Ÿéœ€è¦é€šè¿‡clinit()æ–¹æ³•ä¸ºæŽ¥å£ä¸­å®šä¹‰çš„é™æ€æˆå‘˜å˜é‡æ˜¾ç¤ºåˆå§‹åŒ–ã€‚ æŽ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€ä»£ç å—ã€‚ æŽ¥å£åœ¨æ‰§è¡Œclinit()æ–¹æ³•å‰ï¼Œè™šæ‹Ÿæœºä¸ä¼šç¡®ä¿å…¶çˆ¶æŽ¥å£çš„clinit()æ–¹æ³•è¢«æ‰§è¡Œï¼Œåªæœ‰å½“çˆ¶æŽ¥å£ä¸­çš„é™æ€æˆå‘˜å˜é‡è¢«ä½¿ç”¨åˆ°æ—¶æ‰ä¼šæ‰§è¡Œçˆ¶æŽ¥å£çš„clinit()æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šç»™clinit()æ–¹æ³•åŠ é”ï¼Œå› æ­¤å½“å¤šæ¡çº¿ç¨‹åŒæ—¶æ‰§è¡ŒæŸä¸€ä¸ªç±»çš„clinit()æ–¹æ³•æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œå…¶å®ƒçš„æ–¹æ³•éƒ½è¢«é˜»å¡žã€‚å¹¶ä¸”ï¼Œåªè¦æœ‰ä¸€ä¸ªclinit()æ–¹æ³•æ‰§è¡Œå®Œï¼Œå…¶å®ƒçš„clinit()æ–¹æ³•å°±ä¸ä¼šå†è¢«æ‰§è¡Œã€‚å› æ­¤ï¼Œåœ¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸‹ï¼ŒåŒä¸€ä¸ªç±»åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚ ç±»åŠ è½½å™¨ java.lang.ClassLoaderç±»çš„åŸºæœ¬èŒè´£å°±æ˜¯æ ¹æ®ä¸€ä¸ªæŒ‡å®šçš„ç±»çš„åç§°ï¼Œæ‰¾åˆ°æˆ–è€…ç”Ÿæˆå…¶å¯¹åº”çš„å­—èŠ‚ç ï¼Œç„¶åŽä»Žè¿™äº›å­—èŠ‚ä»£ç ä¸­å®šä¹‰å‡ºä¸€ä¸ª Java ç±»ï¼Œå³ java.lang.Classç±»çš„ä¸€ä¸ªå®žä¾‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒClassLoaderè¿˜è´Ÿè´£åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºï¼Œå¦‚å›¾åƒæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ç­‰ã€‚ä¸ºäº†å®ŒæˆåŠ è½½ç±»çš„è¿™ä¸ªèŒè´£ï¼ŒClassLoaderæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•: getParent() è¿”å›žè¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ loadClass(String name) åŠ è½½åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›žçš„ç»“æžœæ˜¯ java.lang.Classç±»çš„å®žä¾‹ã€‚ findClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›žçš„ç»“æžœæ˜¯ java.lang.Classç±»çš„å®žä¾‹ã€‚ findLoadedClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›žçš„ç»“æžœæ˜¯ java.lang.Classç±»çš„å®žä¾‹ã€‚ defineClass(String name, byte[] b, int off, int len) æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿”å›žçš„ç»“æžœæ˜¯java.lang.Classç±»çš„å®žä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜Žä¸º finalçš„ã€‚ resolveClass(Class) ç±»åŠ è½½å™¨ç§ç±» JVMæä¾›å¦‚ä¸‹å››ç§ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½Java_Home\libä¸­çš„classæ–‡ä»¶ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½Java_Home\lib\extç›®å½•ä¸‹çš„classæ–‡ä»¶ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½ç”¨æˆ·classpathä¸‹çš„classæ–‡ä»¶ã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç±»åŠ è½½çš„å†…å­˜åˆ†å¸ƒæƒ…å†µ å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap ClassLoaderï¼‰åŠ è½½ç³»ç»Ÿç±»åŽï¼ŒJVMå†…å­˜ä¼šå‘ˆçŽ°å¦‚ä¸‹æ ¼å±€ï¼š å¼•å¯¼ç±»åŠ è½½å™¨å°†ç±»ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œä»¥ç‰¹å®šæ–¹å¼ç»„ç»‡ï¼Œå¯¹äºŽæŸä¸€ä¸ªç‰¹å®šçš„ç±»è€Œè¨€ï¼Œåœ¨æ–¹æ³•åŒºä¸­å®ƒåº”è¯¥æœ‰ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»åž‹ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œå¯¹åº”classå®žä¾‹çš„å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ ç±»åŠ è½½å™¨çš„å¼•ç”¨,ç”±äºŽè¿™äº›ç±»æ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Classloader)è¿›è¡ŒåŠ è½½çš„ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯æœ‰C++è¯­è¨€å®žçŽ°çš„ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è®¿é—®çš„ï¼Œæ•…è€Œè¯¥å¼•ç”¨ä¸ºNULLã€‚ å¯¹åº”classå®žä¾‹çš„å¼•ç”¨ï¼Œç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­åŽï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Class ç±»åž‹çš„å®žä¾‹æ”¾åˆ°å †(Heap)ä¸­, ä½œä¸ºå¼€å‘äººå‘˜è®¿é—®æ–¹æ³•åŒºä¸­ç±»å®šä¹‰çš„å…¥å£å’Œåˆ‡å…¥ç‚¹ã€‚ åŒäº²å§”æ´¾æ¨¡åž‹ å·¥ä½œè¿‡ç¨‹ å¦‚æžœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†åŠ è½½ç±»çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆå°†è¯·æ±‚äº¤ç”±çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼›è‹¥çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼Œå½“å‰ç±»åŠ è½½å™¨æ‰ä¼šè‡ªå·±åŠ è½½ç±»ã€‚ ä½œç”¨ åƒjava.lang.Objectè¿™äº›å­˜æ”¾åœ¨rt.jarä¸­çš„ç±»ï¼Œæ— è®ºä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ´¾ç»™æœ€é¡¶ç«¯çš„å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œä»Žè€Œä½¿å¾—ä¸åŒåŠ è½½å™¨åŠ è½½çš„Objectç±»éƒ½æ˜¯åŒä¸€ä¸ªã€‚ åŽŸç† åŒäº²å§”æ´¾æ¨¡åž‹çš„ä»£ç åœ¨java.lang.ClassLoaderç±»ä¸­çš„loadClasså‡½æ•°ä¸­å®žçŽ°ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰é¦–å…ˆæ£€æŸ¥ç±»æ˜¯å¦è¢«åŠ è½½ï¼› ï¼ˆ2ï¼‰è‹¥æœªåŠ è½½ï¼Œåˆ™è°ƒç”¨çˆ¶ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•ï¼› ï¼ˆ3ï¼‰è‹¥è¯¥æ–¹æ³•æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œåˆ™è¡¨ç¤ºçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œåˆ™å½“å‰ç±»åŠ è½½å™¨è°ƒç”¨findClassåŠ è½½ç±»ï¼› ï¼ˆ4ï¼‰è‹¥çˆ¶ç±»åŠ è½½å™¨å¯ä»¥åŠ è½½ï¼Œåˆ™ç›´æŽ¥è¿”å›žClasså¯¹è±¡ï¼› åŠ è½½ç±»çš„è¿‡ç¨‹ ç±»åœ¨åŠ è½½è¿‡ç¨‹ä¸­ç±»åŠ è½½å™¨ä¼šé¦–å…ˆå§”æ‰˜ç»™å…¶å®ƒç±»åŠ è½½å™¨æ¥å°è¯•åŠ è½½æŸä¸ªç±»ã€‚ è¿™å°±æ„å‘³ç€çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚ çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ defineClassæ¥å®žçŽ°çš„ï¼›è€Œå¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ loadClassæ¥å®žçŽ°çš„ã€‚ å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼ŒåŽè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚ åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºŽï¼šä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨ã€‚å¦‚ç±» com.example.Outerå¼•ç”¨äº†ç±» com.example.Innerï¼Œåˆ™ç”±ç±» com.example.Outerçš„å®šä¹‰åŠ è½½å™¨è´Ÿè´£å¯åŠ¨ç±» com.example.Innerçš„åŠ è½½è¿‡ç¨‹ã€‚æ–¹æ³• loadClass()æŠ›å‡ºçš„æ˜¯ java.lang.ClassNotFoundExceptionå¼‚å¸¸ï¼›æ–¹æ³• defineClass()æŠ›å‡ºçš„æ˜¯ java.lang.NoClassDefFoundErrorå¼‚å¸¸ã€‚ ç±»åŠ è½½å™¨åœ¨æˆåŠŸåŠ è½½æŸä¸ªç±»ä¹‹åŽï¼Œä¼šæŠŠå¾—åˆ°çš„ java.lang.Classç±»çš„å®žä¾‹ç¼“å­˜èµ·æ¥ã€‚ä¸‹æ¬¡å†è¯·æ±‚åŠ è½½è¯¥ç±»çš„æ—¶å€™ï¼Œç±»åŠ è½½å™¨ä¼šç›´æŽ¥ä½¿ç”¨ç¼“å­˜çš„ç±»çš„å®žä¾‹ï¼Œè€Œä¸ä¼šå°è¯•å†æ¬¡åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºŽä¸€ä¸ªç±»åŠ è½½å™¨å®žä¾‹æ¥è¯´ï¼Œç›¸åŒå…¨åçš„ç±»åªåŠ è½½ä¸€æ¬¡ï¼Œå³ loadClassæ–¹æ³•ä¸ä¼šè¢«é‡å¤è°ƒç”¨ã€‚ ClassNotFoundException å½“åº”ç”¨ç¨‹åºè¯•å›¾ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é€šè¿‡å­—ç¬¦ä¸²ååŠ è½½ç±»æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼š Class ç±»ä¸­çš„ forName æ–¹æ³•ã€‚ ClassLoader ç±»ä¸­çš„ findSystemClass æ–¹æ³•ã€‚ ClassLoader ç±»ä¸­çš„ loadClass æ–¹æ³•ã€‚ ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°å…·æœ‰æŒ‡å®šåç§°çš„ç±»çš„å®šä¹‰ã€‚ä»Ž 1.4 ç‰ˆæœ¬å¼€å§‹ï¼Œæ­¤å¼‚å¸¸å·²ç»æ›´æ–°ï¼Œä»¥ç¬¦åˆé€šç”¨çš„å¼‚å¸¸é“¾æœºåˆ¶ã€‚ åœ¨æž„é€ æ—¶æä¾›å¹¶é€šè¿‡ getException() æ–¹æ³•è®¿é—®çš„â€œåŠ è½½ç±»æ—¶å¼•å‘çš„å¯é€‰å¼‚å¸¸â€ï¼ŒçŽ°åœ¨è¢«ç§°ä¸ºåŽŸå› ï¼Œå®ƒå¯ä»¥é€šè¿‡ Throwable.getCause() æ–¹æ³•ä»¥åŠä¸Žä¸Šé¢æåˆ°çš„â€œé—ç•™æ–¹æ³•â€æ¥è®¿é—®ã€‚ NoClassDefFoundError å½“ Java è™šæ‹Ÿæœºæˆ– ClassLoader å®žä¾‹è¯•å›¾åœ¨ç±»çš„å®šä¹‰ä¸­åŠ è½½ï¼ˆä½œä¸ºé€šå¸¸æ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†æˆ–è€…ä½œä¸ºä½¿ç”¨ new è¡¨è¾¾å¼åˆ›å»ºçš„æ–°å®žä¾‹çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œä½†æ— æ³•æ‰¾åˆ°è¯¥ç±»çš„å®šä¹‰æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ å¼•èµ·NoClassDefFoundErrorçš„ä¸‰ç§æƒ…å†µï¼š JARé‡å¤å¼•å…¥ï¼Œç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡³ æ‰“ç¨‹åºç‰ˆæœ¬æ—¶ï¼Œæ²¡æœ‰æŠŠå…³è”ç±»æ‰“å‡ºåŽ»ï¼ˆè¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯ï¼‰ java.lang.nosuchmethoderror è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯Aå¼•ç”¨Bæ—¶ï¼ŒBåˆå§‹åŒ–å¤±è´¥æ—¶ä¹Ÿä¼šå¯¼è‡´ä»¥ä¸Šçš„é”™è¯¯å‡ºçŽ°ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è£…é¥°å™¨æ¨¡å¼]]></title>
    <url>%2Fposts%2F4f101877.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è£…é¥°è€…æ¨¡å¼(Decorator Pattern)ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢žåŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå¢žåŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»å®žçŽ°æ›´ä¸ºçµæ´»ã€‚è£…é¥°æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡ç»“æž„åž‹æ¨¡å¼ã€‚ æ¨¡å¼åŽŸç† è®©è£…é¥°å™¨å®žçŽ°è¢«åŒ…è£…ç±»ï¼ˆConcrete Componentï¼‰ç›¸åŒçš„æŽ¥å£ï¼ˆComponentï¼‰ï¼ˆä½¿å¾—è£…é¥°å™¨ä¸Žè¢«æ‰©å±•ç±»ç±»åž‹ä¸€è‡´ï¼‰ï¼Œå¹¶åœ¨æž„é€ å‡½æ•°ä¸­ä¼ å…¥è¯¥æŽ¥å£ï¼ˆComponentï¼‰å¯¹è±¡ï¼Œç„¶åŽå°±å¯ä»¥åœ¨æŽ¥å£éœ€è¦å®žçŽ°çš„æ–¹æ³•ä¸­åœ¨è¢«åŒ…è£…ç±»å¯¹è±¡çš„çŽ°æœ‰åŠŸèƒ½ä¸Šæ·»åŠ æ–°åŠŸèƒ½äº†ã€‚ æ¨¡å¼è§’è‰² æŠ½è±¡ç»„ä»¶ï¼ˆComponentï¼‰ï¼šå¯ä»¥æ˜¯ä¸€ä¸ªæŽ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå…¶å……å½“è¢«è£…é¥°ç±»çš„åŽŸå§‹å¯¹è±¡ï¼Œè§„å®šäº†è¢«è£…é¥°å¯¹è±¡çš„è¡Œä¸ºï¼› å…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰ï¼šå®žçŽ°/ç»§æ‰¿ Component çš„ä¸€ä¸ªå…·ä½“å¯¹è±¡ï¼Œä¹Ÿå³ è¢«è£…é¥°å¯¹è±¡ï¼› æŠ½è±¡è£…é¥°å™¨ï¼ˆDecoratorï¼‰ï¼šé€šç”¨çš„è£…é¥° ConcreteComponent çš„è£…é¥°å™¨ï¼Œå…¶å†…éƒ¨å¿…ç„¶æœ‰ä¸€ä¸ªå±žæ€§æŒ‡å‘ ComponentæŠ½è±¡ç»„ä»¶ï¼›å…¶å®žçŽ°ä¸€èˆ¬æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©å…¶å­ç±»æŒ‰ç…§å…¶æž„é€ å½¢å¼ä¼ å…¥ä¸€ä¸ª ComponentæŠ½è±¡ç»„ä»¶ï¼Œè¿™æ˜¯å¼ºåˆ¶çš„é€šç”¨è¡Œä¸ºï¼ˆå½“ç„¶ï¼Œå¦‚æžœç³»ç»Ÿä¸­è£…é¥°é€»è¾‘å•ä¸€ï¼Œå¹¶ä¸éœ€è¦å®žçŽ°è®¸å¤šè£…é¥°å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æŽ¥çœç•¥è¯¥ç±»ï¼Œè€Œç›´æŽ¥å®žçŽ°ä¸€ä¸ª å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ å³å¯ï¼‰ï¼› å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ï¼šDecorator çš„å…·ä½“å®žçŽ°ç±»ï¼Œç†è®ºä¸Šï¼Œæ¯ä¸ª ConcreteDecorator éƒ½æ‰©å±•äº† Component å¯¹è±¡çš„ä¸€ç§åŠŸèƒ½ï¼› è£…é¥°æ¨¡å¼ è§’è‰²åˆ†é…ç¬¦åˆè®¾è®¡æ¨¡å¼ é‡Œæ°æ›¿æ¢åŽŸåˆ™ï¼Œä¾èµ–å€’ç½®åŽŸåˆ™ï¼Œä»Žè€Œä½¿å¾—å…¶å…·å¤‡å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œæœ€ç»ˆæ»¡è¶³ å¼€é—­åŽŸåˆ™ã€‚ UMLç±»å›¾ æ¨¡å¼ä¼˜ç‚¹ å¯¹äºŽæ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œè£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æ€§ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°æ€¥å‰§å¢žåŠ ã€‚ å¯ä»¥é€šè¿‡ä¸€ç§åŠ¨æ€çš„æ–¹å¼æ¥æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„å…·ä½“è£…é¥°ç±»ï¼Œä»Žè€Œå®žçŽ°ä¸åŒçš„è¡Œä¸ºã€‚ å¯ä»¥å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œå¤šæ¬¡è£…é¥°ï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„å…·ä½“è£…é¥°ç±»ä»¥åŠè¿™äº›è£…é¥°ç±»çš„æŽ’åˆ—ç»„åˆï¼Œå¯ä»¥åˆ›é€ å‡ºå¾ˆå¤šä¸åŒè¡Œä¸ºçš„ç»„åˆï¼Œå¾—åˆ°åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„å¯¹è±¡ã€‚ å…·ä½“ç»„ä»¶ç±»ä¸Žå…·ä½“è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å¢žåŠ æ–°çš„å…·ä½“æž„ä»¶ç±»å’Œå…·ä½“è£…é¥°ç±»ï¼ŒåŽŸæœ‰ç±»åº“ä»£ç æ— é¡»æ”¹å˜ï¼Œç¬¦åˆ â€œå¼€é—­åŽŸåˆ™â€ã€‚ æ¨¡å¼ç¼ºç‚¹ ä½¿ç”¨è£…é¥°æ¨¡å¼è¿›è¡Œç³»ç»Ÿè®¾è®¡æ—¶å°†äº§ç”Ÿå¾ˆå¤šå°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„åŒºåˆ«åœ¨äºŽå®ƒä»¬ä¹‹é—´ç›¸äº’è¿žæŽ¥çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„ç±»æˆ–è€…å±žæ€§å€¼æœ‰æ‰€ä¸åŒï¼Œå¤§é‡å°å¯¹è±¡çš„äº§ç”ŸåŠ¿å¿…ä¼šå ç”¨æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œåœ¨ä¸€å®šç¨‹åºä¸Šå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ è£…é¥°æ¨¡å¼æä¾›äº†ä¸€ç§æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æœºåŠ¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€æ¯”ç»§æ‰¿æ›´åŠ æ˜“äºŽå‡ºé”™ï¼ŒæŽ’é”™ä¹Ÿå¾ˆå›°éš¾ï¼Œå¯¹äºŽå¤šæ¬¡è£…é¥°çš„å¯¹è±¡ï¼Œè°ƒè¯•æ—¶å¯»æ‰¾é”™è¯¯å¯èƒ½éœ€è¦é€çº§æŽ’æŸ¥ï¼Œè¾ƒä¸ºç¹çã€‚ åº”ç”¨åœºæ™¯ éœ€è¦æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œæˆ–ç»™ä¸€ä¸ªç±»å¢žåŠ é™„åŠ åŠŸèƒ½ï¼› éœ€è¦åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢žåŠ åŠŸèƒ½ï¼Œä¸”è¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€åœ°æ’¤é”€ï¼› éœ€è¦ä¸ºä¸€æ‰¹çš„å…„å¼Ÿç±»è¿›è¡Œæ”¹è£…æˆ–åŠ è£…åŠŸèƒ½ï¼› åº”ç”¨ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ æ‰€è°“äººé è¡£è£…é©¬é éžï¼Œå‡è®¾çŽ°åœ¨è¦ä¸ºç”·äººå¢žåŠ ç©¿è¡£æœçš„åŠŸèƒ½ï¼ˆç©¿è£¤å­ã€ç©¿å†…è¡£ã€ç©¿å¤–å¥—ï¼‰ã€‚ åˆ†æž ä»¥ è£…é¥°æ¨¡å¼ çš„è§’åº¦æ¥çœ‹å¾…ä¸Šè¿°ä¾‹å­ï¼Œã€Œäººã€å±žäºŽ Component è§’è‰²ï¼› ã€Œç”·äººã€ å±žäºŽ ConcreteComponent è§’è‰²ï¼Œå› æ­¤ï¼Œã€Œç”·äººã€ æ˜¯è¢«è£…é¥°å¯¹è±¡ï¼› ã€Œç©¿è¡£æœã€ æ˜¯åŠŸèƒ½æ‰©å±•ï¼Œå±žäºŽ Decorator è§’è‰²ï¼› è€Œã€Œç©¿è£¤å­ã€ï¼Œã€Œç©¿å†…è¡£ã€ï¼Œã€Œç©¿å¤–å¥—ã€ æ˜¯3ä¸ªå…·ä½“åŠŸèƒ½æ‰©å±•ï¼Œå‡å±žäºŽ ConcreteDecorator è§’è‰²ï¼› ä½¿ç”¨æ­¥éª¤ æŠ½è±¡ç»„ä»¶(Component) 123456789101112package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰äºº--æŠ½è±¡ç»„ä»¶ï¼ˆComponentï¼‰ */public interface IPerson &#123; /** * ç©¿è¡£æœ */ void dress();&#125; å…·ä½“ç»„ä»¶(ConcreteComponent) 12345678910111213package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰ç”·äºº--å…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰ï¼Œå³è¢«ä¿®é¥°è€… */public class Man implements IPerson &#123; @Override public void dress() &#123; System.out.println("ç©¿äº†å†…è£¤ï¼"); &#125;&#125; æŠ½è±¡è£…é¥°å™¨(Decorator) 12345678910111213141516171819202122package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰è¡£æœ--æŠ½è±¡è£…é¥°å™¨ï¼ˆDecoratorï¼‰ï¼ŒæŽ¥æ”¶ä¸€ä¸ªå…·ä½“çš„Componentï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªComponent */public abstract class ClothesDecorator implements IPerson &#123; protected IPerson mPerson; /** * æž„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æž„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson */ public ClothesDecorator(IPerson person) &#123; this.mPerson = person; &#125; @Override public void dress() &#123; this.mPerson.dress(); &#125;&#125; å…·ä½“è£…é¥°å™¨(ConcreteDecorator) TrousersDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: è£¤å­è£…é¥°å™¨-å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ */public class TrousersDecorator extends ClothesDecorator &#123; /** * æž„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æž„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public TrousersDecorator(IPerson person) &#123; super(person); &#125; @Override public void dress() &#123; super.dress(); this.dressTrousers(); &#125; /** * ç©¿è£¤å­ */ private void dressTrousers() &#123; System.out.println("ç©¿ä¸Šè£¤å­äº†ï¼"); &#125;&#125; UnderClothesDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å†…è¡£è£…é¥°å™¨ */public class UnderClothesDecorator extends ClothesDecorator &#123; /** * æž„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æž„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public UnderClothesDecorator(IPerson person) &#123; super(person); &#125; @Override public void dress() &#123; super.dress(); this.dressUnderClothes(); &#125; /** * ç©¿å†…è¡£ */ private void dressUnderClothes() &#123; System.out.println("ç©¿ä¸Šå†…è¡£äº†ï¼"); &#125;&#125; OvercoatDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å¤–å¥—è£…é¥°å™¨ */public class OvercoatDecorator extends ClothesDecorator &#123; /** * æž„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æž„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public OvercoatDecorator(IPerson person) &#123; super(person); &#125; @Override public void dress() &#123; super.dress(); this.dressOvercoat(); &#125; /** * ç©¿å¤–å¥— */ private void dressOvercoat() &#123; System.out.println("ç©¿ä¸Šå¤–å¥—äº†ï¼"); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; IPerson person = new Man(); person.dress(); System.out.println("----------------------"); System.out.println("å¢žåŠ è£¤å­è£…é¥°å™¨"); person = new TrousersDecorator(person); person.dress(); System.out.println("----------------------"); System.out.println("å†å¢žåŠ å†…è¡£è£…é¥°å™¨"); person = new UnderClothesDecorator(person); person.dress(); System.out.println("----------------------"); System.out.println("å†å¢žåŠ å¤–å¥—è£…é¥°å™¨"); person = new OvercoatDecorator(person); person.dress(); &#125;&#125; ä¸Šé¢ä»£ç ä¸­å®¢æˆ·æ˜¯ä¸ºnew Man()è¿™ä¸ªIPersonä¸€ä»¶ä¸€ä»¶çš„è¿›è¡Œè¡£æœè¯•ç©¿ï¼Œå¤ªæµªè´¹æ—¶é—´äº†ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨è£…é¥°å™¨åµŒå¥—ï¼ˆå› ä¸ºè£…é¥°å™¨æŽ¥æ”¶ä¸€ä¸ªIPersonï¼Œè€Œè‡ªå·±åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªIPersonï¼Œå› æ­¤å®Œå…¨æ”¯æŒåµŒå¥—ï¼‰æ¨¡å¼ï¼Œè¿™æ ·ä¸€æ¬¡æ€§å°±ç©¿å®Œï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: è£…é¥°å™¨åµŒå¥— */public class Client2 &#123; public static void main(String[] args) &#123; IPerson person = new OvercoatDecorator(new UnderClothesDecorator(new TrousersDecorator(new Man()))); person.dress(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼]]></title>
    <url>%2Fposts%2F2a48474d.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å»ºé€ è€…æ¨¡å¼(Builder Pattern)ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æž„å»ºä¸Žå®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æž„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºåž‹æ¨¡å¼ã€‚ å»ºé€ è€…æ¨¡å¼ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»åž‹å’Œå†…å®¹å°±å¯ä»¥æž„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æž„å»ºç»†èŠ‚ã€‚ ä¸»è¦ä½œç”¨ é™ä½Žåˆ›å»ºå¤æ‚å¯¹è±¡çš„å¤æ‚åº¦ï¼› éš”ç¦»äº†åˆ›å»ºå¯¹è±¡çš„æž„å»ºè¿‡ç¨‹ &amp; è¡¨ç¤ºã€‚ UMLç±»å›¾ è§’è‰² æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼šä¸»è¦ç”¨äºŽè§„èŒƒäº§å“Productå¯¹è±¡çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå¹¶æä¾›ä¸€ä¸ªè¿”å›žå®Œæ•´äº§å“çš„æŽ¥å£ï¼Œåœ¨è¯¥æŽ¥å£ä¸­ä¸€èˆ¬å£°æ˜Žä¸¤ç±»æ–¹æ³•ï¼Œä¸€ç±»æ–¹æ³•æ˜¯buildPartX()ï¼Œå®ƒä»¬ç”¨äºŽåˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶ï¼›å¦ä¸€ç±»æ–¹æ³•æ˜¯getResult()ï¼Œå®ƒä»¬ç”¨äºŽè¿”å›žå¤æ‚å¯¹è±¡ã€‚Builderæ—¢å¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯æŽ¥å£ã€‚ å…·ä½“å»ºé€ è€…ï¼ˆConcrete Builderï¼‰ï¼šå®žçŽ° æŠ½è±¡å»ºé€ è€… è§„å®šçš„å„ä¸ªæ–¹æ³•ï¼Œè¿”å›žä¸€ä¸ªç»„å»ºå¥½çš„å…·ä½“äº§å“ã€‚ äº§å“ï¼ˆProductï¼‰ï¼šå®ƒæ˜¯è¢«æž„å»ºçš„å¤æ‚å¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶ï¼Œå…·ä½“å»ºé€ è€…åˆ›å»ºè¯¥äº§å“çš„å†…éƒ¨è¡¨ç¤ºå¹¶å®šä¹‰å®ƒçš„è£…é…è¿‡ç¨‹ã€‚ å¯¼æ¼”è€…ï¼ˆDirectorï¼‰ï¼šåˆç§°æŒ‡æŒ¥è€…ï¼Œå®ƒè´Ÿè´£å®‰æŽ’å¤æ‚å¯¹è±¡çš„å»ºé€ æ¬¡åºï¼ŒæŒ‡æŒ¥è€…ä¸ŽæŠ½è±¡å»ºé€ è€…ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¯ä»¥åœ¨å…¶construct()å»ºé€ æ–¹æ³•ä¸­è°ƒç”¨å»ºé€ è€…å¯¹è±¡çš„éƒ¨ä»¶æž„é€ ä¸Žè£…é…æ–¹æ³•ï¼Œå®Œæˆå¤æ‚å¯¹è±¡çš„å»ºé€ ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬åªéœ€è¦ä¸ŽæŒ‡æŒ¥è€…è¿›è¡Œäº¤äº’ï¼Œåœ¨å®¢æˆ·ç«¯ç¡®å®šå…·ä½“å»ºé€ è€…çš„ç±»åž‹ï¼Œå¹¶å®žä¾‹åŒ–å…·ä½“å»ºé€ è€…å¯¹è±¡ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œåå°„æœºåˆ¶ï¼‰ï¼Œç„¶åŽé€šè¿‡æŒ‡æŒ¥è€…ç±»çš„æž„é€ å‡½æ•°æˆ–è€…Setteræ–¹æ³•å°†è¯¥å¯¹è±¡ä¼ å…¥æŒ‡æŒ¥è€…ç±»ä¸­ã€‚ æ€»ç»“ï¼š å»ºé€ è€…æ¨¡å¼ æœ€ç»ˆè¿”å›žä¸€ä¸ªå…·ä½“çš„æž„å»ºå¤æ‚çš„äº§å“ï¼› ç³»ç»Ÿä¸­äº§å“å¯èƒ½åªæœ‰ä¸€ç§ç±»åž‹æˆ–å¤šç§ç±»åž‹ï¼Œä½†å¯¹æŸäº›äº§å“æ—æ¥è¯´ï¼Œå®ƒä»¬å…·å¤‡ç›¸åŒçš„è¡Œä¸ºï¼Œå› æ­¤å¯¹è¿™äº›å…±æ€§è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼ŒæŠ½ç¦»å‡º æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼› è€Œå¯¹è¿™äº›è¡Œä¸ºçš„å…·ä½“æž„å»ºè¿‡ç¨‹ï¼Œåˆ™äº¤ç”± å…·ä½“å»ºé€ è€…ï¼ˆConcrete Builderï¼‰ è´Ÿè´£ï¼Œä¸åŒçš„ å…·ä½“å»ºé€ è€… ä¼šæž„å»ºå‡ºä¸åŒè¡¨ç¤ºçš„äº§å“ï¼› è€Œå…·ä½“è¦æž„å»ºå‡ºå“ªç§äº§å“ï¼Œç”± å¯¼æ¼”è€…ï¼ˆDirectorï¼‰ å†³å®šã€‚å¯¼æ¼”è€… ä¼šé€‰æ‹©ä¸åŒçš„ å…·ä½“å»ºé€ è€…ï¼ŒæŒ‡å¯¼å®ƒæž„å»ºå‡ºäº§å“ã€‚ æ¨¡å¼ä¼˜ç‚¹ åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸Žäº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ã€‚ æ¯ä¸€ä¸ªå…·ä½“å»ºé€ è€…éƒ½ç›¸å¯¹ç‹¬ç«‹ï¼Œè€Œä¸Žå…¶ä»–çš„å…·ä½“å»ºé€ è€…æ— å…³ï¼Œå› æ­¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢å…·ä½“å»ºé€ è€…æˆ–å¢žåŠ æ–°çš„å…·ä½“å»ºé€ è€…ï¼Œç”¨æˆ·ä½¿ç”¨ä¸åŒçš„å…·ä½“å»ºé€ è€…å³å¯å¾—åˆ°ä¸åŒçš„äº§å“å¯¹è±¡ã€‚ç”±äºŽæŒ‡æŒ¥è€…ç±»é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç¼–ç¨‹ï¼Œå¢žåŠ æ–°çš„å…·ä½“å»ºé€ è€…æ— é¡»ä¿®æ”¹åŽŸæœ‰ç±»åº“çš„ä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ–¹ä¾¿ï¼Œç¬¦åˆ â€œå¼€é—­åŽŸåˆ™â€ã€‚ å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æŽ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æŽ§åˆ¶åˆ›å»ºè¿‡ç¨‹ã€‚ æ¨¡å¼ç¼ºç‚¹ å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼›å¦‚æžœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚ å¦‚æžœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…ç±»æ¥å®žçŽ°è¿™ç§å˜åŒ–ï¼Œå¯¼è‡´ç³»ç»Ÿå˜å¾—å¾ˆåºžå¤§ã€‚ é€‚ç”¨åœºæ™¯ éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡æœ‰å¤æ‚çš„å†…éƒ¨ç»“æž„ï¼Œè¿™äº›äº§å“å¯¹è±¡é€šå¸¸åŒ…å«å¤šä¸ªæˆå‘˜å±žæ€§ã€‚ éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡çš„å±žæ€§ç›¸äº’ä¾èµ–ï¼Œéœ€è¦æŒ‡å®šå…¶ç”Ÿæˆé¡ºåºã€‚ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ç‹¬ç«‹äºŽåˆ›å»ºè¯¥å¯¹è±¡çš„ç±»ã€‚åœ¨å»ºé€ è€…æ¨¡å¼ä¸­é€šè¿‡å¼•å…¥äº†æŒ‡æŒ¥è€…ç±»ï¼Œå°†åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨æŒ‡æŒ¥è€…ç±»ä¸­ï¼Œè€Œä¸åœ¨å»ºé€ è€…ç±»å’Œå®¢æˆ·ç±»ä¸­ã€‚ éš”ç¦»å¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œå¹¶ä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚ æ¨¡å¼ç¤ºä¾‹ ä»¥å·¥åŽ‚åˆ¶é€ ç”µè„‘ä¸ºä¾‹ã€‚ äº§å“è§’è‰² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: äº§å“è§’è‰²--ç”µè„‘ */public class Computer &#123; /** * å“ç‰Œ */ private String brand; /** * cpu */ private String cpu; /** * ä¸»æ¿ */ private String mainBoard; /** * ç¡¬ç›˜ */ private String hardDisk; /** * æ˜¾å¡ */ private String displayCard; /** * ç”µæº */ private String power; /** * å†…å­˜ */ private String memory; public String getBrand() &#123; return brand; &#125; public void setBrand(String brand) &#123; this.brand = brand; &#125; public String getCpu() &#123; return cpu; &#125; public void setCpu(String cpu) &#123; this.cpu = cpu; &#125; public String getMainBoard() &#123; return mainBoard; &#125; public void setMainBoard(String mainBoard) &#123; this.mainBoard = mainBoard; &#125; public String getHardDisk() &#123; return hardDisk; &#125; public void setHardDisk(String hardDisk) &#123; this.hardDisk = hardDisk; &#125; public String getDisplayCard() &#123; return displayCard; &#125; public void setDisplayCard(String displayCard) &#123; this.displayCard = displayCard; &#125; public String getPower() &#123; return power; &#125; public void setPower(String power) &#123; this.power = power; &#125; public String getMemory() &#123; return memory; &#125; public void setMemory(String memory) &#123; this.memory = memory; &#125; @Override public String toString() &#123; return "Computer&#123;" + "brand='" + brand + '\'' + ", cpu='" + cpu + '\'' + ", mainBoard='" + mainBoard + '\'' + ", hardDisk='" + hardDisk + '\'' + ", displayCard='" + displayCard + '\'' + ", power='" + power + '\'' + ", memory='" + memory + '\'' + '&#125;'; &#125;&#125; æŠ½è±¡å»ºé€ è€… 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: æŠ½è±¡å»ºé€ è€… */public abstract class Builder &#123; /** * äº§å“è§’è‰² */ protected Computer computer = new Computer(); public abstract void buildBrand(); public abstract void buildCPU(); public abstract void buildMainBoard(); public abstract void buildHardDisk(); public abstract void buildDisplayCard(); public abstract void buildPower(); public abstract void buildMemory(); /** * åˆ¶é€ ç”µè„‘ * * @return */ public Computer createComputer() &#123; return computer; &#125;&#125; å…·ä½“å»ºé€ è€… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: å…·ä½“å»ºé€ è€…--æˆ´å°” */public class DellComputerBuilder extends Builder &#123; @Override public void buildBrand() &#123; computer.setBrand("æˆ´å°”ç”µè„‘"); &#125; @Override public void buildCPU() &#123; computer.setCpu("i5-8300H å››æ ¸"); &#125; @Override public void buildMainBoard() &#123; computer.setMainBoard("æˆ´å°”ä¸»æ¿"); &#125; @Override public void buildHardDisk() &#123; computer.setHardDisk("1T + 128GB SSD"); &#125; @Override public void buildDisplayCard() &#123; computer.setDisplayCard("GTX1060 ç‹¬ç«‹6GB"); &#125; @Override public void buildPower() &#123; computer.setPower("4èŠ¯ é”‚ç¦»å­ç”µæ±  180W ACé€‚é…å™¨"); &#125; @Override public void buildMemory() &#123; computer.setMemory("4G + 4G"); &#125;&#125;package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: å…·ä½“å»ºé€ è€…--åŽç¡•ç”µè„‘ */public class ASUSComputerBuilder extends Builder &#123; @Override public void buildBrand() &#123; computer.setBrand("åŽç¡•ç”µè„‘"); &#125; @Override public void buildCPU() &#123; computer.setCpu("Intel ç¬¬8ä»£ é…·ç¿"); &#125; @Override public void buildMainBoard() &#123; computer.setMainBoard("åŽç¡•ä¸»æ¿"); &#125; @Override public void buildHardDisk() &#123; computer.setHardDisk("256GB SSD"); &#125; @Override public void buildDisplayCard() &#123; computer.setDisplayCard("MX150 ç‹¬ç«‹2GB"); &#125; @Override public void buildPower() &#123; computer.setPower("3èŠ¯ é”‚ç¦»å­ç”µæ±  65W ACé€‚é…å™¨"); &#125; @Override public void buildMemory() &#123; computer.setMemory("1 x SO-DIMM 8GB"); &#125;&#125; æµ‹è¯•ç±» 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±» */public class TestBuilder &#123; public static void main(String[] args) &#123; ComputerDirector director = new ComputerDirector(); //åŽç¡•ç”µè„‘ Builder asusBuilder = new ASUSComputerBuilder(); Computer asusComputer = director.construct(asusBuilder); System.out.println(asusComputer.toString()); //æˆ´å°”ç”µè„‘--é€šè¿‡åå°„æœºåˆ¶åˆ›å»ºå…·ä½“å»ºé€ è€… try &#123; Class clazz = Class.forName("main.java.com.study.designPatterns.builder.demoOne.DellComputerBuilder"); Builder dellBuilder = (DellComputerBuilder) clazz.newInstance(); Computer dellComputer = director.construct(dellBuilder); System.out.println(dellComputer.toString()); &#125; catch (ClassNotFoundException e) &#123; e.printStackTrace(); &#125; catch (IllegalAccessException e) &#123; e.printStackTrace(); &#125; catch (InstantiationException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å»ºé€ è€…æ¨¡å¼ä¸Žå·¥åŽ‚æ¨¡å¼çš„åŒºåˆ« å»ºé€ è€…æ¨¡å¼ ä¸Ž å·¥åŽ‚æ¨¡å¼ çš„å”¯ä¸€åŒºåˆ«å°±åœ¨äºŽ æž„å»ºå¤æ‚å¯¹è±¡ï¼Œè¿™å…¶å®žæ˜¯å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«ã€‚è€Œä»Žè¡¨çŽ°å½¢å¼ä¸Šçœ‹ï¼Œå»ºé€ è€…æ¨¡å¼ æ¯” å·¥åŽ‚æ¨¡å¼ å¤šäº†ä¸€ä¸ª å¯¼æ¼”è€…ï¼ˆDirectorï¼‰çš„è§’è‰²ã€‚å¦‚æžœå¿½ç•¥ å¯¼æ¼”è€…ï¼Œé‚£ä¹ˆ å»ºé€ è€…æ¨¡å¼ ä¸Ž å·¥åŽ‚æ¨¡å¼ å‡ ä¹Žæ˜¯ä¸€æ ·çš„ã€‚ ä»Žä¸Šæ–‡ å»ºé€ è€…æ¨¡å¼ UML ç±»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯¼æ¼”è€… æ˜¯è´Ÿè´£æ²Ÿé€š å®¢æˆ· ä¸Ž å…·ä½“å»ºé€ è€… çš„æ¡¥æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¼æ¼”è€… è§£è€¦äº† å®¢æˆ· ä¸Ž å…·ä½“å»ºé€ è€…ã€‚å› ä¸º å…·ä½“å»ºé€ è€… å±žäºŽç»†èŠ‚å®žçŽ°ï¼Œæ˜¯åº•å±‚æ¨¡å—ï¼Œä¸šåŠ¡ç»å¸¸å˜æ¢ï¼Œä¸ç¨³å®šï¼›è€Œ å®¢æˆ· å±žäºŽä¸Šå±‚æ¨¡å—ï¼Œæ˜¯ä¸šåŠ¡é€»è¾‘éƒ¨åˆ†ï¼Œç›¸å¯¹ç¨³å®šï¼›å¦‚æžœä¸è®¾ç½® å¯¼æ¼”è€… ä½œä¸ºä¸­é—´äººï¼Œç›´æŽ¥æŠŠ å…·ä½“å»ºé€ è€… åµŒå…¥åˆ°ä¸šåŠ¡é€»è¾‘ï¼ˆå®¢æˆ·ï¼‰ä¸­ï¼Œä¼šå¯¼è‡´å½“ä¸šåŠ¡æ”¹å˜ï¼ˆäº§å“æ”¹å˜ï¼‰æ—¶ï¼Œéœ€è¦æ›´æ¢ å…·ä½“å»ºé€ è€…ï¼Œä¾µå…¥äº†ä¸šåŠ¡é€»è¾‘ï¼ˆå®¢æˆ·ï¼‰ä»£ç ï¼Œä¸ç¬¦åˆè®¾è®¡æ¨¡å¼çš„è¿ªç±³ç‰¹æ³•åˆ™ã€‚ è€Œ å·¥åŽ‚æ¨¡å¼ ä¹‹æ‰€ä»¥æ²¡æœ‰ å¯¼æ¼”è€… è¿™ä¸ªè§’è‰²ï¼Œæ˜¯å› ä¸º å·¥åŽ‚ æœ¬èº«å°±æ‹…å½“äº†è¯¥è§’è‰²ã€‚å› ä¸º å¯¼æ¼”è€… æœ€ç»ˆçš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ä¸ªç»„è£…å¥½çš„å¯¹è±¡ç»™åˆ° å®¢æˆ·ï¼Œä¸Ž å·¥åŽ‚ çš„ä½œç”¨ä¸€è‡´ã€‚åªæ˜¯ç”±äºŽ å·¥åŽ‚ ç”Ÿäº§çš„éƒ½æ˜¯ç®€å•å¯¹è±¡ï¼Œå› æ­¤ å·¥åŽ‚ ç›´æŽ¥æä¾›ç»™ å®¢æˆ· å°±è¡Œäº†ï¼›è€Œ å»ºé€ è€…æ¨¡å¼ æä¾›çš„æ˜¯å¤æ‚å¯¹è±¡ï¼Œéœ€è¦ä¸“é—¨çš„æž„å»ºè¿‡ç¨‹ï¼Œå› æ­¤å€ŸåŠ© å¯¼æ¼”è€… åŽ»æ²Ÿé€š å…·ä½“çš„å»ºé€ è€… æž„å»ºå‡ºç›¸åº”çš„å¤æ‚å¯¹è±¡ï¼Œç„¶åŽç”± å¯¼æ¼”è€… è¿”å›žç»™ å®¢æˆ·ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JDKåŠ¨æ€ä»£ç†]]></title>
    <url>%2Fposts%2Fdfdc2005.html</url>
    <content type="text"><![CDATA[ä»£ç†æ¨¡å¼å®žçŽ°æ–¹å¼ä»‹ç» ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ æ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°ä»£ç†æ¨¡å¼ï¼Œä¾‹å¦‚æˆ‘ä»¬æ‰¾æˆ¿äº§ä¸­ä»‹å¸®æˆ‘ä»¬æ‰¾æˆ¿å­ï¼Œæ‰¾å©šå§»ä¸­ä»‹å¸®æˆ‘ä»¬ä»‹ç»å¯¹è±¡ï¼Œæ‰¾ä¿æ´å¸®æˆ‘ä»¬æ‰“ç†æˆ¿é—´ç­‰ã€‚åœ¨æ— å½¢ä¸­è¿ç”¨åˆ°äº†ä»£ç†æ¨¡å¼ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»£ç†ï¼Ÿ è¿ç”¨ä»£ç†å¯ä»¥ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»æ›´åŠ ä¾¿åˆ©ï¼Œæœ‰äº†ä»£ç†ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±åŽ»æ‰¾æˆ¿å­ï¼Œä¸éœ€è¦è‡ªå·±åŽ»æ‰¾å¯¹è±¡ï¼Œä¸éœ€è¦è‡ªå·±åŽ»æ‰“ç†æˆ¿é—´ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€åˆ‡éƒ½è‡ªå·±æ¥å¹²ï¼Œä½†æ˜¯å­˜åœ¨å‰ææ¡ä»¶ï¼Œä¸€æ˜¯ä½ æ˜¯å¦éƒ½å…·å¤‡è¿™æ ·çš„èµ„æºå’Œèƒ½åŠ›æ¥åšè¿™äº›äº‹æƒ…ï¼ŒäºŒæ˜¯ä½ æ˜¯å¦æ„¿æ„èŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å’Œæ—¶é—´æ¥åšè¿™äº›äº‹æƒ…ã€‚æ€»ä¹‹ï¼Œä»£ç†æ¨¡å¼ä½¿æˆ‘ä»¬å„ä¸“å…¶äº‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´æ¶ˆè€—åœ¨ç¾Žå¥½çš„äº‹æƒ…ä¸Šï¼Œè€Œä¸ç”¨å¤©å¤©è¢«ä¸€äº›çäº‹æ‰€ç¾ç»Šã€‚ ä»£ç†æ¨¡å¼æœ‰å“ªäº›å®žçŽ°ï¼Ÿ Javaä¸­çš„ä»£ç†æœ‰é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œä¸‹é¢åˆ†åˆ«ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä»£ç å®žçŽ°ã€‚ é™æ€ä»£ç† ä»£ç†æŽ¥å£ 12345678910111213package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ä»£ç†æŽ¥å£ */public interface UserDao &#123; /** * ä¿å­˜ */ void save();&#125; ç›®æ ‡å¯¹è±¡ 12345678910111213package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ç›®æ ‡å¯¹è±¡ */public class UserDaoImpl implements UserDao &#123; @Override public void save() &#123; System.out.println("æ­£åœ¨ä¿å­˜ç”¨æˆ·..."); &#125;&#125; ä»£ç†å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ä»£ç†å¯¹è±¡ */public class TransactionHandler implements UserDao &#123; /** * ç›®æ ‡ä»£ç†å¯¹è±¡ */ private UserDaoImpl target; /** * æž„é€ ä»£ç†å¯¹è±¡æ—¶ä¼ å…¥ç›®æ ‡å¯¹è±¡ * * @param target */ public TransactionHandler(UserDaoImpl target) &#123; this.target = target; &#125; @Override public void save() &#123; //è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰çš„å¤„ç† System.out.println("å¼€å¯äº‹åŠ¡æŽ§åˆ¶..."); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• target.save(); //è°ƒç”¨ç›®æ ‡æ–¹æ³•åŽçš„å¤„ç† System.out.println("å…³é—­äº‹åŠ¡æŽ§åˆ¶..."); &#125;&#125; æµ‹è¯•è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: æµ‹è¯•é™æ€ä»£ç† */public class TestStaticProxy &#123; public static void main(String[] args) &#123; //æ–°å»ºç›®æ ‡å¯¹è±¡ UserDaoImpl target = new UserDaoImpl(); //åˆ›å»ºä»£ç†å¯¹è±¡, å¹¶ä½¿ç”¨æŽ¥å£å¯¹å…¶è¿›è¡Œå¼•ç”¨ UserDao userDao = new TransactionHandler(target); //é’ˆå¯¹æŽ¥å£è¿›è¡Œè°ƒç”¨ userDao.save(); &#125;&#125; æµ‹è¯•ç»“æžœ 123å¼€å¯äº‹åŠ¡æŽ§åˆ¶...æ­£åœ¨ä¿å­˜ç”¨æˆ·...å…³é—­äº‹åŠ¡æŽ§åˆ¶... æ€»ç»“ é™æ€ä»£ç†å®žçŽ°ç®€å•ä¹Ÿå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯é™æ€ä»£ç†ä¸èƒ½ä½¿ä¸€ä¸ªä»£ç†ç±»åå¤ä½œç”¨äºŽå¤šä¸ªç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ç›´æŽ¥æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™å¯¼è‡´ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ç±»åž‹ç´§å¯†è€¦åˆäº†åœ¨ä¸€èµ·ã€‚å¦‚æžœUserDaoæŽ¥å£ä¸‹è¿˜æœ‰å¦ä¸€ä¸ªå®žçŽ°ç±»ä¹Ÿéœ€è¦è¿›è¡Œäº‹åŠ¡æŽ§åˆ¶ï¼Œé‚£ä¹ˆå°±è¦é‡æ–°å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿè®¸å¤šé‡å¤çš„æ¨¡ç‰ˆä»£ç ï¼Œä¸èƒ½è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚è€ŒåŠ¨æ€ä»£ç†å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ åŠ¨æ€ä»£ç† ä»£ç†æŽ¥å£ 12345678910111213package main.java.com.study.designPatterns.proxy.JdkProxy;/** * @author: whb * @date: 2019/9/4 9:50 * @description: ä»£ç†æŽ¥å£ */public interface UserDao &#123; /** * ä¿å­˜ç”¨æˆ· */ void save();&#125; ç›®æ ‡å¯¹è±¡ 1234567891011121314package main.java.com.study.designPatterns.proxy.JdkProxy;/** * @author: whb * @date: 2019/9/4 9:51 * @description: ç›®æ ‡å¯¹è±¡ */public class UserDaoImpl implements UserDao &#123; @Override public void save() &#123; System.out.println("ä¿å­˜ç”¨æˆ·ä¿¡æ¯..."); &#125;&#125; ä»£ç†å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.proxy.JdkProxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * @author: whb * @description: ä»£ç†å¯¹è±¡ */public class TransactionHandler implements InvocationHandler &#123; /** * éœ€è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œè¿™é‡Œè®¾è®¡ä¸ºå¯ä»¥ä¸ºä»»æ„å¯¹è±¡æ·»åŠ äº‹åŠ¡æŽ§åˆ¶, æ‰€ä»¥å°†ç›®æ ‡å¯¹è±¡å£°æ˜Žä¸ºObject */ private Object target; /** * æž„é€ TransactionHandleræ—¶ä¼ å…¥ç›®æ ‡å¯¹è±¡ * * @param target */ public TransactionHandler(Object target) &#123; this.target = target; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; //è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰çš„å¤„ç† System.out.println("å¼€å¯äº‹åŠ¡æŽ§åˆ¶..."); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object result = method.invoke(target, args); //è°ƒç”¨ç›®æ ‡æ–¹æ³•åŽçš„å¤„ç† System.out.println("å…³é—­äº‹åŠ¡æŽ§åˆ¶..."); //æ”¾å›žæ–¹æ³•è°ƒç”¨ç»“æžœ return result; &#125;&#125; æµ‹è¯•ç±» 123456789101112131415161718192021222324package main.java.com.study.designPatterns.proxy.JdkProxy;import java.lang.reflect.Proxy;/** * @author: whb * @description: æµ‹è¯•JDKåŠ¨æ€ä»£ç† */public class TestJdkProxy &#123; public static void main(String[] args) &#123; //æ–°å»ºç›®æ ‡å¯¹è±¡ Object target = new UserDaoImpl(); //åˆ›å»ºäº‹åŠ¡å¤„ç†å™¨ TransactionHandler handler = new TransactionHandler(target); //ç”Ÿæˆä»£ç†ç±»å¹¶ä½¿ç”¨æŽ¥å£å¯¹å…¶è¿›è¡Œå¼•ç”¨ UserDao userDao = (UserDao) Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), handler); //é’ˆå¯¹æŽ¥å£è¿›è¡Œæ–¹æ³•è°ƒç”¨ userDao.save(); &#125;&#125; æµ‹è¯•ç»“æžœ 123å¼€å¯äº‹åŠ¡æŽ§åˆ¶...ä¿å­˜ç”¨æˆ·ä¿¡æ¯...å…³é—­äº‹åŠ¡æŽ§åˆ¶... æ€»ç»“ ä¹‹å‰å‘çŽ°é™æ€ä»£ç†ä¼šäº§ç”Ÿè®¸å¤šé‡å¤ä»£ç ï¼Œä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œä»£ç å¤ç”¨ï¼Œè€ŒåŠ¨æ€ä»£ç†èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç†ç±»TransactionHandlerå®žçŽ°äº†InvocationHandleræŽ¥å£ï¼Œå¹¶ä¸”å®ƒæŒæœ‰çš„ç›®æ ‡å¯¹è±¡ç±»åž‹æ˜¯Objectï¼Œå› æ­¤äº‹åŠ¡æŽ§åˆ¶ä»£ç†ç±»TransactionHandlerèƒ½å¤Ÿä»£ç†ä»»æ„çš„å¯¹è±¡ï¼Œä¸ºä»»æ„çš„å¯¹è±¡æ·»åŠ äº‹åŠ¡æŽ§åˆ¶çš„é€»è¾‘ã€‚å› æ­¤åŠ¨æ€ä»£ç†æ‰çœŸæ­£çš„å°†ä»£ç ä¸­æ¨ªå‘åˆ‡é¢çš„é€»è¾‘å‰¥ç¦»äº†å‡ºæ¥ï¼Œèµ·åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚ ä½†æ˜¯åŠ¨æ€ä»£ç†ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œä¸€æ˜¯å®ƒçš„å®žçŽ°æ¯”é™æ€ä»£ç†æ›´åŠ å¤æ‚ä¹Ÿä¸å¥½ç†è§£ï¼›äºŒæ˜¯å®ƒå­˜åœ¨ä¸€å®šçš„é™åˆ¶ï¼Œä¾‹å¦‚å®ƒè¦æ±‚éœ€è¦ä»£ç†çš„å¯¹è±¡å¿…é¡»å®žçŽ°äº†æŸä¸ªæŽ¥å£ï¼›ä¸‰æ˜¯å®ƒä¸å¤Ÿçµæ´»ï¼ŒåŠ¨æ€ä»£ç†ä¼šä¸ºæŽ¥å£ä¸­çš„å£°æ˜Žçš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ä¸Šç›¸åŒçš„ä»£ç†é€»è¾‘ã€‚ JDKåŠ¨æ€ä»£ç†çš„åº•å±‚å®žçŽ°Proxyåˆ†æž åœ¨åŠ¨æ€ä»£ç†çš„æµ‹è¯•ç±»TestJdkProxyä¸­ä½¿ç”¨äº†Proxyç±»çš„é™æ€æ–¹æ³•newProxyInstanceæ–¹æ³•åŽ»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªé™æ€æ–¹æ³•æŽ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨ï¼Œç›®æ ‡ç±»å®žçŽ°çš„æŽ¥å£é›†åˆï¼ŒInvocationHandlerå®žä¾‹ï¼Œæœ€åŽè¿”å›žä¸€ä¸ªObjectç±»åž‹çš„ä»£ç†ç±»ã€‚å…ˆä»Žè¯¥æ–¹æ³•å¼€å§‹ï¼Œçœ‹çœ‹ä»£ç†ç±»æ˜¯æ€Žæ ·ä¸€æ­¥ä¸€æ­¥é€ å‡ºæ¥çš„ã€‚ newProxyInstanceæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * è¿”å›žæŒ‡å®šæŽ¥å£çš„ä»£ç†ç±»çš„å®žä¾‹ï¼Œè¯¥æŽ¥å£å°†æ–¹æ³•è°ƒç”¨åˆ†å‘ç»™æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚è¿™ä¸ªé™æ€æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š * @param ClassLoader loaderï¼ŒæŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨ç±»åŠ è½½å™¨ * @param Class&lt;?&gt;[ ] interfacesï¼Œç›®æ ‡å¯¹è±¡å®žçŽ°çš„æŽ¥å£çš„ç±»åž‹,ä½¿ç”¨æ³›åž‹æ–¹å¼ç¡®è®¤ç±»åž‹ * @param InvocationHandler hï¼Œäº‹ä»¶å¤„ç†,æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶,ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•,ä¼šæŠŠå½“å‰æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ å…¥ */public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException &#123; //éªŒè¯ä¼ å…¥çš„InvocationHandlerä¸èƒ½ä¸ºç©º Objects.requireNonNull(h); //å¤åˆ¶ä»£ç†ç±»å®žçŽ°çš„æ‰€æœ‰æŽ¥å£ final Class&lt;?&gt;[] intfs = interfaces.clone(); //èŽ·å–å®‰å…¨ç®¡ç†å™¨ final SecurityManager sm = System.getSecurityManager(); //è¿›è¡Œä¸€äº›æƒé™æ£€éªŒ if (sm != null) &#123; checkProxyAccess(Reflection.getCallerClass(), loader, intfs); &#125; /* * è¯¥æ–¹æ³•å…ˆä»Žç¼“å­˜èŽ·å–ä»£ç†ç±», å¦‚æžœæ²¡æœ‰å†åŽ»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±» */ Class&lt;?&gt; cl = getProxyClass0(loader, intfs); /* * ä½¿ç”¨æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºè°ƒç”¨å…¶æž„é€ å‡½æ•°. */ try &#123; //è¿›è¡Œä¸€äº›æƒé™æ£€éªŒ if (sm != null) &#123; checkNewProxyPermission(Reflection.getCallerClass(), cl); &#125; //èŽ·å–å‚æ•°ç±»åž‹æ˜¯InvocationHandler.classçš„ä»£ç†ç±»æž„é€ å™¨ final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; //å¦‚æžœä»£ç†ç±»æ˜¯ä¸å¯è®¿é—®çš„, å°±ä½¿ç”¨ç‰¹æƒå°†å®ƒçš„æž„é€ å™¨è®¾ç½®ä¸ºå¯è®¿é—® if (!Modifier.isPublic(cl.getModifiers())) &#123; AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; cons.setAccessible(true); return null; &#125; &#125;); &#125; //æ‰€æœ‰ä»£ç†ç±»éƒ½ç»§æ‰¿è‡ªProxy, å› æ­¤è¿™é‡Œä¼šè°ƒç”¨Proxyçš„æž„é€ å™¨å°†InvocationHandlerå¼•ç”¨ä¼ å…¥åŽ»æž„é€ ä¸€ä¸ªä»£ç†ç±»çš„å®žä¾‹ return cons.newInstance(new Object[]&#123;h&#125;); &#125; catch (IllegalAccessException|InstantiationException e) &#123; throw new InternalError(e.toString(), e); &#125; catch (InvocationTargetException e) &#123; Throwable t = e.getCause(); if (t instanceof RuntimeException) &#123; throw (RuntimeException) t; &#125; else &#123; throw new InternalError(t.toString(), t); &#125; &#125; catch (NoSuchMethodException e) &#123; throw new InternalError(e.toString(), e); &#125;&#125; newProxyInstanceæ–¹æ³•é¦–å…ˆæ˜¯å¯¹å‚æ•°è¿›è¡Œä¸€äº›æƒé™æ ¡éªŒï¼Œä¹‹åŽé€šè¿‡è°ƒç”¨getProxyClass0æ–¹æ³•ç”Ÿæˆäº†ä»£ç†ç±»çš„ç±»å¯¹è±¡ï¼Œç„¶åŽèŽ·å–å‚æ•°ç±»åž‹æ˜¯InvocationHandler.classçš„ä»£ç†ç±»æž„é€ å™¨ã€‚æ£€éªŒæž„é€ å™¨æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œæœ€åŽä¼ å…¥InvocationHandlerå®žä¾‹çš„å¼•ç”¨åŽ»æž„é€ å‡ºä¸€ä¸ªä»£ç†ç±»å®žä¾‹ï¼ŒInvocationHandlerå®žä¾‹çš„å¼•ç”¨å…¶å®žæ˜¯ProxyæŒæœ‰ç€ï¼Œå› ä¸ºç”Ÿæˆçš„ä»£ç†ç±»é»˜è®¤ç»§æ‰¿è‡ªProxyï¼Œæ‰€ä»¥æœ€åŽä¼šè°ƒç”¨Proxyçš„æž„é€ å™¨å°†å¼•ç”¨ä¼ å…¥ã€‚ getProxyClass0æ–¹æ³• ä¸‹é¢çœ‹ä¸‹getProxyClass0è¿™ä¸ªæ–¹æ³•ï¼Œçœ‹çœ‹ä»£ç†ç±»çš„Classå¯¹è±¡æ˜¯æ€Žæ ·æ¥çš„ã€‚ 123456789101112/** * ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ã€‚å¿…é¡»è°ƒç”¨checkProxyAccessæ–¹æ³•ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰éœ€è¦æ£€æŸ¥æƒé™ã€‚ */ private static Class&lt;?&gt; getProxyClass0(ClassLoader loader, Class&lt;?&gt;... interfaces) &#123; //ç›®æ ‡ç±»å®žçŽ°çš„æŽ¥å£ä¸èƒ½å¤§äºŽ65535 if (interfaces.length &gt; 65535) &#123; throw new IllegalArgumentException("interface limit exceeded"); &#125; //å¦‚æžœç”±ç»™å®šçš„è£…è½½æœºå®šä¹‰çš„ä»£ç†ç±»å®žçŽ°ç»™å®šçš„æŽ¥å£å­˜åœ¨ï¼Œè¿™å°†ä¼šè¿”å›žç¼“å­˜ï¼›å¦åˆ™ï¼Œå®ƒå°†é€šè¿‡ProxyClassFactoryåˆ›å»ºä»£ç†ç±»ã€‚ return proxyClassCache.get(loader, interfaces);&#125; getProxyClass0æ–¹æ³•å†…éƒ¨æ²¡æœ‰å¤šå°‘å†…å®¹ï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥ç›®æ ‡ä»£ç†ç±»å®žçŽ°çš„æŽ¥å£ä¸èƒ½å¤§äºŽ65535è¿™ä¸ªæ•°ï¼Œä¹‹åŽæ˜¯é€šè¿‡ç±»åŠ è½½å™¨å’ŒæŽ¥å£é›†åˆåŽ»ç¼“å­˜é‡Œé¢èŽ·å–ï¼Œå¦‚æžœèƒ½æ‰¾åˆ°ä»£ç†ç±»å°±ç›´æŽ¥è¿”å›žï¼Œå¦åˆ™å°±ä¼šè°ƒç”¨ProxyClassFactoryè¿™ä¸ªå·¥åŽ‚åŽ»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ã€‚ ProxyClassFactoryå·¥åŽ‚ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485//ä»£ç†ç±»ç”Ÿæˆå·¥åŽ‚private static final class ProxyClassFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; &#123; //ä»£ç†ç±»åç§°å‰ç¼€ private static final String proxyClassNamePrefix = "$Proxy"; //ç”¨åŽŸå­ç±»æ¥ç”Ÿæˆä»£ç†ç±»çš„åºå·, ä»¥æ­¤æ¥ç¡®å®šå”¯ä¸€çš„ä»£ç†ç±» private static final AtomicLong nextUniqueNumber = new AtomicLong(); @Override public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) &#123; Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length); for (Class&lt;?&gt; intf : interfaces) &#123; //è¿™é‡ŒéåŽ†interfacesæ•°ç»„è¿›è¡ŒéªŒè¯, ä¸»è¦åšä¸‰ä»¶äº‹æƒ… /* * 1.intfæ˜¯å¦å¯ä»¥ç”±æŒ‡å®šçš„ç±»åŠ è½½è¿›è¡ŒåŠ è½½ */ Class&lt;?&gt; interfaceClass = null; try &#123; interfaceClass = Class.forName(intf.getName(), false, loader); &#125; catch (ClassNotFoundException e) &#123; &#125; if (interfaceClass != intf) &#123; throw new IllegalArgumentException( intf + " is not visible from class loader"); &#125; /* * 2.intfæ˜¯å¦æ˜¯ä¸€ä¸ªæŽ¥å£ */ if (!interfaceClass.isInterface()) &#123; throw new IllegalArgumentException( interfaceClass.getName() + " is not an interface"); &#125; /* * 3.intfåœ¨æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤ */ if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) &#123; throw new IllegalArgumentException( "repeated interface: " + interfaceClass.getName()); &#125; &#125; //ç”Ÿæˆä»£ç†ç±»çš„åŒ…å String proxyPkg = null; //ç”Ÿæˆä»£ç†ç±»çš„è®¿é—®æ ‡å¿—, é»˜è®¤æ˜¯public finalçš„ int accessFlags = Modifier.PUBLIC | Modifier.FINAL; for (Class&lt;?&gt; intf : interfaces) &#123; //èŽ·å–æŽ¥å£çš„è®¿é—®æ ‡å¿— int flags = intf.getModifiers(); //å¦‚æžœæŽ¥å£çš„è®¿é—®æ ‡å¿—ä¸æ˜¯public, é‚£ä¹ˆç”Ÿæˆä»£ç†ç±»çš„åŒ…åå’ŒæŽ¥å£åŒ…åç›¸åŒ if (!Modifier.isPublic(flags)) &#123; //ç”Ÿæˆçš„ä»£ç†ç±»çš„è®¿é—®æ ‡å¿—è®¾ç½®ä¸ºfinal accessFlags = Modifier.FINAL; //èŽ·å–æŽ¥å£å…¨é™å®šå, ä¾‹å¦‚ï¼šjava.util.Collection String name = intf.getName(); int n = name.lastIndexOf('.'); //å‰ªè£åŽå¾—åˆ°åŒ…å:java.util String pkg = ((n == -1) ? "" : name.substring(0, n + 1)); //ç”Ÿæˆçš„ä»£ç†ç±»çš„åŒ…åå’ŒæŽ¥å£åŒ…åæ˜¯ä¸€æ ·çš„ if (proxyPkg == null) &#123; proxyPkg = pkg; &#125; else if (!pkg.equals(proxyPkg)) &#123; //ä»£ç†ç±»å¦‚æžœå®žçŽ°ä¸åŒåŒ…çš„æŽ¥å£, å¹¶ä¸”æŽ¥å£éƒ½ä¸æ˜¯publicçš„, é‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡ŒæŠ¥é”™ throw new IllegalArgumentException( "non-public interfaces from different packages"); &#125; &#125; &#125; //å¦‚æžœæŽ¥å£è®¿é—®æ ‡å¿—éƒ½æ˜¯publicçš„è¯, é‚£ç”Ÿæˆçš„ä»£ç†ç±»éƒ½æ”¾åˆ°é»˜è®¤çš„åŒ…ä¸‹ï¼šcom.sun.proxy if (proxyPkg == null) &#123; proxyPkg = ReflectUtil.PROXY_PACKAGE + "."; &#125; //ç”Ÿæˆä»£ç†ç±»çš„åºå· long num = nextUniqueNumber.getAndIncrement(); //ç”Ÿæˆä»£ç†ç±»çš„å…¨é™å®šå, åŒ…å+å‰ç¼€+åºå·, ä¾‹å¦‚ï¼šcom.sun.proxy.$Proxy0 String proxyName = proxyPkg + proxyClassNamePrefix + num; //è¿™é‡Œæ˜¯æ ¸å¿ƒ, ç”¨ProxyGeneratoræ¥ç”Ÿæˆå­—èŠ‚ç , è¯¥ç±»æ”¾åœ¨sun.miscåŒ…ä¸‹ byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags); try &#123; //æ ¹æ®äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„Classå®žä¾‹ return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length); &#125; catch (ClassFormatError e) &#123; throw new IllegalArgumentException(e.toString()); &#125; &#125;&#125; è¯¥å·¥åŽ‚çš„applyæ–¹æ³•ä¼šè¢«è°ƒç”¨ç”¨æ¥ç”Ÿæˆä»£ç†ç±»çš„Classå¯¹è±¡ï¼Œç”±äºŽä»£ç çš„æ³¨é‡Šæ¯”è¾ƒè¯¦ç»†ï¼ŒåªæŒ‘å…³é”®ç‚¹è¿›è¡Œé˜è¿°ã€‚ åœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°JDKç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åæ˜¯â€œ$Proxyâ€+åºå·ã€‚ å¦‚æžœæŽ¥å£æ˜¯publicçš„ï¼Œä»£ç†ç±»é»˜è®¤æ˜¯public finalçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„ä»£ç†ç±»é»˜è®¤æ”¾åˆ°com.sun.proxyè¿™ä¸ªåŒ…ä¸‹ã€‚ å¦‚æžœæŽ¥å£æ˜¯éžpublicçš„ï¼Œé‚£ä¹ˆä»£ç†ç±»ä¹Ÿæ˜¯éžpublicçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„ä»£ç†ç±»ä¼šæ”¾åœ¨å¯¹åº”æŽ¥å£æ‰€åœ¨çš„åŒ…ä¸‹ã€‚ å¦‚æžœæŽ¥å£æ˜¯éžpublicçš„ï¼Œå¹¶ä¸”è¿™äº›æŽ¥å£ä¸åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚ WeakCacheç¼“å­˜çš„å®žçŽ°æœºåˆ¶ Proxyå†…éƒ¨ç”¨åˆ°äº†ç¼“å­˜æœºåˆ¶ï¼Œå¦‚æžœæ ¹æ®æä¾›çš„ç±»åŠ è½½å™¨å’ŒæŽ¥å£æ•°ç»„èƒ½åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°ä»£ç†ç±»å°±ç›´æŽ¥è¿”å›žè¯¥ä»£ç†ç±»ï¼Œå¦åˆ™ä¼šè°ƒç”¨ProxyClassFactoryå·¥åŽ‚åŽ»ç”Ÿæˆä»£ç†ç±»ã€‚è¿™é‡Œç”¨åˆ°çš„ç¼“å­˜æ˜¯äºŒçº§ç¼“å­˜ï¼Œå®ƒçš„ä¸€çº§ç¼“å­˜keyæ˜¯æ ¹æ®ç±»åŠ è½½å™¨ç”Ÿæˆçš„ï¼ŒäºŒçº§ç¼“å­˜keyæ˜¯æ ¹æ®æŽ¥å£æ•°ç»„ç”Ÿæˆçš„ã€‚å…·ä½“çš„å†…éƒ¨æœºåˆ¶ç›´æŽ¥ä¸Šä»£ç è¯¦ç»†è§£é‡Šã€‚ 1234567891011121314151617//Referenceå¼•ç”¨é˜Ÿåˆ—private final ReferenceQueue&lt;K&gt; refQueue = new ReferenceQueue&lt;&gt;();//ç¼“å­˜çš„åº•å±‚å®žçŽ°, keyä¸ºä¸€çº§ç¼“å­˜, valueä¸ºäºŒçº§ç¼“å­˜ã€‚ ä¸ºäº†æ”¯æŒnull, mapçš„keyç±»åž‹è®¾ç½®ä¸ºObjectprivate final ConcurrentMap&lt;Object, ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt;&gt; map = new ConcurrentHashMap&lt;&gt;();//reverseMapè®°å½•äº†æ‰€æœ‰ä»£ç†ç±»ç”Ÿæˆå™¨æ˜¯å¦å¯ç”¨, è¿™æ˜¯ä¸ºäº†å®žçŽ°ç¼“å­˜çš„è¿‡æœŸæœºåˆ¶private final ConcurrentMap&lt;Supplier&lt;V&gt;, Boolean&gt; reverseMap = new ConcurrentHashMap&lt;&gt;();//ç”ŸæˆäºŒçº§ç¼“å­˜keyçš„å·¥åŽ‚, è¿™é‡Œä¼ å…¥çš„æ˜¯KeyFactoryprivate final BiFunction&lt;K, P, ?&gt; subKeyFactory;//ç”ŸæˆäºŒçº§ç¼“å­˜valueçš„å·¥åŽ‚, è¿™é‡Œä¼ å…¥çš„æ˜¯ProxyClassFactoryprivate final BiFunction&lt;K, P, V&gt; valueFactory;//æž„é€ å™¨, ä¼ å…¥ç”ŸæˆäºŒçº§ç¼“å­˜keyçš„å·¥åŽ‚å’Œç”ŸæˆäºŒçº§ç¼“å­˜valueçš„å·¥åŽ‚public WeakCache(BiFunction&lt;K, P, ?&gt; subKeyFactory, BiFunction&lt;K, P, V&gt; valueFactory) &#123; this.subKeyFactory = Objects.requireNonNull(subKeyFactory); this.valueFactory = Objects.requireNonNull(valueFactory);&#125; é¦–å…ˆçœ‹ä¸€ä¸‹WeakCacheçš„æˆå‘˜å˜é‡å’Œæž„é€ å™¨ï¼ŒWeakCacheç¼“å­˜çš„å†…éƒ¨å®žçŽ°æ˜¯é€šè¿‡ConcurrentMapæ¥å®Œæˆçš„ï¼Œæˆå‘˜å˜é‡mapå°±æ˜¯äºŒçº§ç¼“å­˜çš„åº•å±‚å®žçŽ°ï¼ŒreverseMapæ˜¯ä¸ºäº†å®žçŽ°ç¼“å­˜çš„è¿‡æœŸæœºåˆ¶ï¼ŒsubKeyFactoryæ˜¯äºŒçº§ç¼“å­˜keyçš„ç”Ÿæˆå·¥åŽ‚ï¼Œé€šè¿‡æž„é€ å™¨ä¼ å…¥ï¼Œè¿™é‡Œä¼ å…¥çš„å€¼æ˜¯Proxyç±»çš„KeyFactoryï¼ŒvalueFactoryæ˜¯äºŒçº§ç¼“å­˜valueçš„ç”Ÿæˆå·¥åŽ‚ï¼Œé€šè¿‡æž„é€ å™¨ä¼ å…¥ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯Proxyç±»çš„ProxyClassFactoryã€‚æŽ¥ä¸‹æ¥çœ‹ä¸€ä¸‹WeakCacheçš„getæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public V get(K key, P parameter) &#123; //è¿™é‡Œè¦æ±‚å®žçŽ°çš„æŽ¥å£ä¸èƒ½ä¸ºç©º Objects.requireNonNull(parameter); //æ¸…é™¤è¿‡æœŸçš„ç¼“å­˜ expungeStaleEntries(); //å°†ClassLoaderåŒ…è£…æˆCacheKey, ä½œä¸ºä¸€çº§ç¼“å­˜çš„key Object cacheKey = CacheKey.valueOf(key, refQueue); //èŽ·å–å¾—åˆ°äºŒçº§ç¼“å­˜ ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey); //å¦‚æžœæ ¹æ®ClassLoaderæ²¡æœ‰èŽ·å–åˆ°å¯¹åº”çš„å€¼ if (valuesMap == null) &#123; //ä»¥CASæ–¹å¼æ”¾å…¥, å¦‚æžœä¸å­˜åœ¨åˆ™æ”¾å…¥ï¼Œå¦åˆ™è¿”å›žåŽŸå…ˆçš„å€¼ ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap = map.putIfAbsent(cacheKey, valuesMap = new ConcurrentHashMap&lt;&gt;()); //å¦‚æžœoldValuesMapæœ‰å€¼, è¯´æ˜Žæ”¾å…¥å¤±è´¥ if (oldValuesMap != null) &#123; valuesMap = oldValuesMap; &#125; &#125; //æ ¹æ®ä»£ç†ç±»å®žçŽ°çš„æŽ¥å£æ•°ç»„æ¥ç”ŸæˆäºŒçº§ç¼“å­˜key, åˆ†ä¸ºkey0, key1, key2, keyx Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter)); //è¿™é‡Œé€šè¿‡subKeyèŽ·å–åˆ°äºŒçº§ç¼“å­˜çš„å€¼ Supplier&lt;V&gt; supplier = valuesMap.get(subKey); Factory factory = null; //è¿™ä¸ªå¾ªçŽ¯æä¾›äº†è½®è¯¢æœºåˆ¶, å¦‚æžœæ¡ä»¶ä¸ºå‡å°±ç»§ç»­é‡è¯•ç›´åˆ°æ¡ä»¶ä¸ºçœŸä¸ºæ­¢ while (true) &#123; //å¦‚æžœé€šè¿‡subKeyå–å‡ºæ¥çš„å€¼ä¸ä¸ºç©º if (supplier != null) &#123; //åœ¨è¿™é‡Œsupplierå¯èƒ½æ˜¯ä¸€ä¸ªFactoryä¹Ÿå¯èƒ½ä¼šæ˜¯ä¸€ä¸ªCacheValue //åœ¨è¿™é‡Œä¸ä½œåˆ¤æ–­, è€Œæ˜¯åœ¨Supplierå®žçŽ°ç±»çš„getæ–¹æ³•é‡Œé¢è¿›è¡ŒéªŒè¯ V value = supplier.get(); if (value != null) &#123; return value; &#125; &#125; if (factory == null) &#123; //æ–°å»ºä¸€ä¸ªFactoryå®žä¾‹ä½œä¸ºsubKeyå¯¹åº”çš„å€¼ factory = new Factory(key, parameter, subKey, valuesMap); &#125; if (supplier == null) &#123; //åˆ°è¿™é‡Œè¡¨æ˜ŽsubKeyæ²¡æœ‰å¯¹åº”çš„å€¼, å°±å°†factoryä½œä¸ºsubKeyçš„å€¼æ”¾å…¥ supplier = valuesMap.putIfAbsent(subKey, factory); if (supplier == null) &#123; //åˆ°è¿™é‡Œè¡¨æ˜ŽæˆåŠŸå°†factoryæ”¾å…¥ç¼“å­˜ supplier = factory; &#125; //å¦åˆ™, å¯èƒ½æœŸé—´æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†å€¼, é‚£ä¹ˆå°±ä¸å†ç»§ç»­ç»™subKeyèµ‹å€¼, è€Œæ˜¯å–å‡ºæ¥ç›´æŽ¥ç”¨ &#125; else &#123; //æœŸé—´å¯èƒ½å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†å€¼, é‚£ä¹ˆå°±å°†åŽŸå…ˆçš„å€¼æ›¿æ¢ if (valuesMap.replace(subKey, supplier, factory)) &#123; //æˆåŠŸå°†factoryæ›¿æ¢æˆæ–°çš„å€¼ supplier = factory; &#125; else &#123; //æ›¿æ¢å¤±è´¥, ç»§ç»­ä½¿ç”¨åŽŸå…ˆçš„å€¼ supplier = valuesMap.get(subKey); &#125; &#125; &#125;&#125; WeakCacheçš„getæ–¹æ³•å¹¶æ²¡æœ‰ç”¨é”è¿›è¡ŒåŒæ­¥ï¼Œé‚£å®ƒæ˜¯æ€Žæ ·å®žçŽ°çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ å› ä¸ºå®ƒçš„æ‰€æœ‰ä¼šè¿›è¡Œä¿®æ”¹çš„æˆå‘˜å˜é‡éƒ½ä½¿ç”¨äº†ConcurrentMapï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› æ­¤å®ƒå°†è‡ªèº«çš„çº¿ç¨‹å®‰å…¨å§”æ‰˜ç»™äº†ConcurrentMapï¼Œ getæ–¹æ³•å°½å¯èƒ½çš„å°†åŒæ­¥ä»£ç å—ç¼©å°ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆæé«˜WeakCacheçš„æ€§èƒ½ã€‚ ClassLoaderä½œä¸ºäº†ä¸€çº§ç¼“å­˜çš„keyï¼Œè¿™æ ·å¯ä»¥é¦–å…ˆæ ¹æ®ClassLoaderç­›é€‰ä¸€éï¼Œå› ä¸ºä¸åŒClassLoaderåŠ è½½çš„ç±»æ˜¯ä¸åŒçš„ã€‚ ç„¶åŽå®ƒç”¨æŽ¥å£æ•°ç»„æ¥ç”ŸæˆäºŒçº§ç¼“å­˜çš„keyï¼Œè¿™é‡Œå®ƒè¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç±»éƒ½æ˜¯å®žçŽ°äº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªæŽ¥å£ï¼Œæ‰€ä»¥äºŒçº§ç¼“å­˜keyåˆ†ä¸ºkey0ï¼Œkey1ï¼Œkey2ï¼ŒkeyXã€‚key0åˆ°key2åˆ†åˆ«è¡¨ç¤ºå®žçŽ°äº†0åˆ°2ä¸ªæŽ¥å£ï¼ŒkeyXè¡¨ç¤ºå®žçŽ°äº†3ä¸ªæˆ–ä»¥ä¸Šçš„æŽ¥å£ï¼Œäº‹å®žä¸Šå¤§éƒ¨åˆ†éƒ½åªä¼šç”¨åˆ°key1å’Œkey2ã€‚è¿™äº›keyçš„ç”Ÿæˆå·¥åŽ‚æ˜¯åœ¨Proxyç±»ä¸­ï¼Œé€šè¿‡WeakCacheçš„æž„é€ å™¨å°†keyå·¥åŽ‚ä¼ å…¥ã€‚è¿™é‡Œçš„äºŒçº§ç¼“å­˜çš„å€¼æ˜¯ä¸€ä¸ªFactoryå®žä¾‹ï¼Œæœ€ç»ˆä»£ç†ç±»çš„å€¼æ˜¯é€šè¿‡Factoryè¿™ä¸ªå·¥åŽ‚æ¥èŽ·å¾—çš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private final class Factory implements Supplier&lt;V&gt; &#123; //ä¸€çº§ç¼“å­˜key, æ ¹æ®ClassLoaderç”Ÿæˆ private final K key; //ä»£ç†ç±»å®žçŽ°çš„æŽ¥å£æ•°ç»„ private final P parameter; //äºŒçº§ç¼“å­˜key, æ ¹æ®æŽ¥å£æ•°ç»„ç”Ÿæˆ private final Object subKey; //äºŒçº§ç¼“å­˜ private final ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap; Factory(K key, P parameter, Object subKey, ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap) &#123; this.key = key; this.parameter = parameter; this.subKey = subKey; this.valuesMap = valuesMap; &#125; @Override public synchronized V get() &#123; //è¿™é‡Œå†ä¸€æ¬¡åŽ»äºŒçº§ç¼“å­˜é‡Œé¢èŽ·å–Supplier, ç”¨æ¥éªŒè¯æ˜¯å¦æ˜¯Factoryæœ¬èº« Supplier&lt;V&gt; supplier = valuesMap.get(subKey); if (supplier != this) &#123; //åœ¨è¿™é‡ŒéªŒè¯supplieræ˜¯å¦æ˜¯Factoryå®žä¾‹æœ¬èº«, å¦‚æžœä¸åˆ™è¿”å›žnullè®©è°ƒç”¨è€…ç»§ç»­è½®è¯¢é‡è¯• //æœŸé—´supplierå¯èƒ½æ›¿æ¢æˆäº†CacheValue, æˆ–è€…ç”±äºŽç”Ÿæˆä»£ç†ç±»å¤±è´¥è¢«ä»ŽäºŒçº§ç¼“å­˜ä¸­ç§»é™¤äº† return null; &#125; V value = null; try &#123; //å§”æ‰˜valueFactoryåŽ»ç”Ÿæˆä»£ç†ç±», è¿™é‡Œä¼šé€šè¿‡ä¼ å…¥çš„ProxyClassFactoryåŽ»ç”Ÿæˆä»£ç†ç±» value = Objects.requireNonNull(valueFactory.apply(key, parameter)); &#125; finally &#123; //å¦‚æžœç”Ÿæˆä»£ç†ç±»å¤±è´¥, å°±å°†è¿™ä¸ªäºŒçº§ç¼“å­˜åˆ é™¤ if (value == null) &#123; valuesMap.remove(subKey, this); &#125; &#125; //åªæœ‰valueçš„å€¼ä¸ä¸ºç©ºæ‰èƒ½åˆ°è¾¾è¿™é‡Œ assert value != null; //ä½¿ç”¨å¼±å¼•ç”¨åŒ…è£…ç”Ÿæˆçš„ä»£ç†ç±» CacheValue&lt;V&gt; cacheValue = new CacheValue&lt;&gt;(value); //å°†åŒ…è£…åŽçš„cacheValueæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­, è¿™ä¸ªæ“ä½œå¿…é¡»æˆåŠŸ, å¦åˆ™å°±æŠ¥é”™ if (valuesMap.replace(subKey, this, cacheValue)) &#123; //å°†cacheValueæˆåŠŸæ”¾å…¥äºŒçº§ç¼“å­˜åŽ, å†å¯¹å®ƒè¿›è¡Œæ ‡è®° reverseMap.put(cacheValue, Boolean.TRUE); &#125; else &#123; throw new AssertionError("Should not reach here"); &#125; //æœ€åŽè¿”å›žæ²¡æœ‰è¢«å¼±å¼•ç”¨åŒ…è£…çš„ä»£ç†ç±» return value; &#125;&#125; å†çœ‹çœ‹Factoryè¿™ä¸ªå†…éƒ¨å·¥åŽ‚ç±»ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„getæ–¹æ³•æ˜¯ä½¿ç”¨synchronizedå…³é”®å­—è¿›è¡Œäº†åŒæ­¥ã€‚è¿›è¡Œgetæ–¹æ³•åŽé¦–å…ˆä¼šåŽ»éªŒè¯subKeyå¯¹åº”çš„suppileræ˜¯å¦æ˜¯å·¥åŽ‚æœ¬èº«ï¼Œå¦‚æžœä¸æ˜¯å°±è¿”å›žnullï¼Œè€ŒWeakCacheçš„getæ–¹æ³•ä¼šç»§ç»­è¿›è¡Œé‡è¯•ã€‚å¦‚æžœç¡®å®žæ˜¯å·¥åŽ‚æœ¬èº«ï¼Œé‚£ä¹ˆå°±ä¼šå§”æ‰˜ProxyClassFactoryç”Ÿæˆä»£ç†ç±»ï¼ŒProxyClassFactoryæ˜¯åœ¨æž„é€ WeakCacheçš„æ—¶å€™ä¼ å…¥çš„ã€‚æ‰€ä»¥è¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆæœ€åŽä¼šè°ƒç”¨åˆ°Proxyçš„ProxyClassFactoryè¿™ä¸ªå†…éƒ¨å·¥åŽ‚æ¥ç”Ÿæˆä»£ç†ç±»ã€‚ç”Ÿæˆä»£ç†ç±»åŽä½¿ç”¨å¼±å¼•ç”¨è¿›è¡ŒåŒ…è£…å¹¶æ”¾å…¥reverseMapä¸­ï¼Œæœ€åŽä¼šè¿”å›žåŽŸè£…çš„ä»£ç†ç±»ã€‚ ProxyGeneratorç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ é€šè¿‡å‰é¢çš„åˆ†æžï¼ŒçŸ¥é“äº†ä»£ç†ç±»æ˜¯é€šè¿‡Proxyç±»çš„ProxyClassFactoryå·¥åŽ‚ç”Ÿæˆçš„ï¼Œè¿™ä¸ªå·¥åŽ‚ç±»ä¼šåŽ»è°ƒç”¨ProxyGeneratorç±»çš„generateProxyClass()æ–¹æ³•æ¥ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç ã€‚ProxyGeneratorè¿™ä¸ªç±»å­˜æ”¾åœ¨sun.miscåŒ…ä¸‹ï¼Œè¯¥ç±»çš„generateProxyClass()é™æ€æ–¹æ³•çš„æ ¸å¿ƒå†…å®¹å°±æ˜¯åŽ»è°ƒç”¨generateClassFile()å®žä¾‹æ–¹æ³•æ¥ç”ŸæˆClassæ–‡ä»¶ã€‚æŽ¥ä¸‹æ¥çœ‹çœ‹generateClassFile()è¿™ä¸ªæ–¹æ³•å†…éƒ¨åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128private byte[] generateClassFile() &#123; //ç¬¬ä¸€æ­¥, å°†æ‰€æœ‰çš„æ–¹æ³•ç»„è£…æˆProxyMethodå¯¹è±¡ //é¦–å…ˆä¸ºä»£ç†ç±»ç”ŸæˆtoString, hashCode, equalsç­‰ä»£ç†æ–¹æ³• this.addProxyMethod(hashCodeMethod, Object.class); this.addProxyMethod(equalsMethod, Object.class); this.addProxyMethod(toStringMethod, Object.class); //èŽ·å–æŽ¥å£ç±» Class[] var1 = this.interfaces; int var2 = var1.length; int var3; Class var4; //éåŽ†æ¯ä¸€ä¸ªæŽ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•, å¹¶ä¸”ä¸ºå…¶ç”ŸæˆProxyMethodå¯¹è±¡ for(var3 = 0; var3 &lt; var2; ++var3) &#123; var4 = var1[var3]; Method[] var5 = var4.getMethods(); int var6 = var5.length; for(int var7 = 0; var7 &lt; var6; ++var7) &#123; Method var8 = var5[var7]; this.addProxyMethod(var8, var4); &#125; &#125; //å¯¹äºŽå…·æœ‰ç›¸åŒç­¾åçš„ä»£ç†æ–¹æ³•, æ£€éªŒæ–¹æ³•çš„è¿”å›žå€¼æ˜¯å¦å…¼å®¹ Iterator var11 = this.proxyMethods.values().iterator(); List var12; while(var11.hasNext()) &#123; var12 = (List)var11.next(); checkReturnTypes(var12); &#125; //ç¬¬äºŒæ­¥, ç»„è£…è¦ç”Ÿæˆçš„classæ–‡ä»¶çš„æ‰€æœ‰çš„å­—æ®µä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ Iterator var15; try &#123; //æ·»åŠ æž„é€ å™¨æ–¹æ³• this.methods.add(this.generateConstructor()); var11 = this.proxyMethods.values().iterator(); //éåŽ†ç¼“å­˜ä¸­çš„ä»£ç†æ–¹æ³• while(var11.hasNext()) &#123; var12 = (List)var11.next(); var15 = var12.iterator(); while(var15.hasNext()) &#123; ProxyGenerator.ProxyMethod var16 = (ProxyGenerator.ProxyMethod)var15.next(); //æ·»åŠ ä»£ç†ç±»çš„é™æ€å­—æ®µ, ä¾‹å¦‚:private static Method m1; this.fields.add(new ProxyGenerator.FieldInfo(var16.methodFieldName, "Ljava/lang/reflect/Method;", 10)); //æ·»åŠ ä»£ç†ç±»çš„ä»£ç†æ–¹æ³• this.methods.add(var16.generateMethod()); &#125; &#125; //æ·»åŠ ä»£ç†ç±»çš„é™æ€å­—æ®µåˆå§‹åŒ–æ–¹æ³• this.methods.add(this.generateStaticInitializer()); &#125; catch (IOException var10) &#123; throw new InternalError("unexpected I/O Exception", var10); &#125; //éªŒè¯æ–¹æ³•å’Œå­—æ®µé›†åˆä¸èƒ½å¤§äºŽ65535 if (this.methods.size() &gt; 65535) &#123; throw new IllegalArgumentException("method limit exceeded"); &#125; else if (this.fields.size() &gt; 65535) &#123; throw new IllegalArgumentException("field limit exceeded"); &#125; else &#123; //ç¬¬ä¸‰æ­¥, å†™å…¥æœ€ç»ˆçš„classæ–‡ä»¶ //éªŒè¯å¸¸é‡æ± ä¸­å­˜åœ¨ä»£ç†ç±»çš„å…¨é™å®šå this.cp.getClass(dotToSlash(this.className)); //éªŒè¯å¸¸é‡æ± ä¸­å­˜åœ¨ä»£ç†ç±»çˆ¶ç±»çš„å…¨é™å®šå, çˆ¶ç±»åä¸º:"java/lang/reflect/Proxy" this.cp.getClass("java/lang/reflect/Proxy"); var1 = this.interfaces; var2 = var1.length; //éªŒè¯å¸¸é‡æ± å­˜åœ¨ä»£ç†ç±»æŽ¥å£çš„å…¨é™å®šå for(var3 = 0; var3 &lt; var2; ++var3) &#123; var4 = var1[var3]; this.cp.getClass(dotToSlash(var4.getName())); &#125; //æŽ¥ä¸‹æ¥è¦å¼€å§‹å†™å…¥æ–‡ä»¶äº†,è®¾ç½®å¸¸é‡æ± åªè¯» this.cp.setReadOnly(); ByteArrayOutputStream var13 = new ByteArrayOutputStream(); DataOutputStream var14 = new DataOutputStream(var13); try &#123; //1.å†™å…¥é­”æ•° var14.writeInt(-889275714); //2.å†™å…¥æ¬¡ç‰ˆæœ¬å· var14.writeShort(0); //3.å†™å…¥ä¸»ç‰ˆæœ¬å· var14.writeShort(49); //4.å†™å…¥å¸¸é‡æ±  this.cp.write(var14); //5.å†™å…¥è®¿é—®ä¿®é¥°ç¬¦ var14.writeShort(this.accessFlags); //6.å†™å…¥ç±»ç´¢å¼• var14.writeShort(this.cp.getClass(dotToSlash(this.className))); //7.å†™å…¥çˆ¶ç±»ç´¢å¼•, ç”Ÿæˆçš„ä»£ç†ç±»éƒ½ç»§æ‰¿è‡ªProxy var14.writeShort(this.cp.getClass("java/lang/reflect/Proxy")); //8.å†™å…¥æŽ¥å£è®¡æ•°å€¼ var14.writeShort(this.interfaces.length); Class[] var17 = this.interfaces; int var18 = var17.length; //9.å†™å…¥æŽ¥å£é›†åˆ for(int var19 = 0; var19 &lt; var18; ++var19) &#123; Class var22 = var17[var19]; var14.writeShort(this.cp.getClass(dotToSlash(var22.getName()))); &#125; //10.å†™å…¥å­—æ®µè®¡æ•°å€¼ var14.writeShort(this.fields.size()); var15 = this.fields.iterator(); //11.å†™å…¥å­—æ®µé›†åˆ while(var15.hasNext()) &#123; ProxyGenerator.FieldInfo var20 = (ProxyGenerator.FieldInfo)var15.next(); var20.write(var14); &#125; //12.å†™å…¥æ–¹æ³•è®¡æ•°å€¼ var14.writeShort(this.methods.size()); var15 = this.methods.iterator(); //13.å†™å…¥æ–¹æ³•é›†åˆ while(var15.hasNext()) &#123; ProxyGenerator.MethodInfo var21 = (ProxyGenerator.MethodInfo)var15.next(); var21.write(var14); &#125; //14.å†™å…¥å±žæ€§è®¡æ•°å€¼, ä»£ç†ç±»classæ–‡ä»¶æ²¡æœ‰å±žæ€§æ‰€ä»¥ä¸º0 var14.writeShort(0); //è½¬æ¢æˆäºŒè¿›åˆ¶æ•°ç»„è¾“å‡º return var13.toByteArray(); &#125; catch (IOException var9) &#123; throw new InternalError("unexpected I/O Exception", var9); &#125; &#125;&#125; å¯ä»¥çœ‹åˆ°generateClassFile()æ–¹æ³•æ˜¯æŒ‰ç…§Classæ–‡ä»¶ç»“æž„è¿›è¡ŒåŠ¨æ€æ‹¼æŽ¥çš„ã€‚é‚£ä»€ä¹ˆæ˜¯Classæ–‡ä»¶å‘¢ï¼Ÿ æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„Javaæ–‡ä»¶æ˜¯ä»¥.javaç»“å°¾çš„ï¼Œåœ¨ç¼–å†™å¥½äº†ä¹‹åŽé€šè¿‡ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ä¼šç”Ÿæˆ.classæ–‡ä»¶ï¼Œè¿™ä¸ª.classæ–‡ä»¶å°±æ˜¯Classæ–‡ä»¶ã€‚Javaç¨‹åºçš„æ‰§è¡Œåªä¾èµ–äºŽClassæ–‡ä»¶ï¼Œå’ŒJavaæ–‡ä»¶æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚è¿™ä¸ªClassæ–‡ä»¶æè¿°äº†ä¸€ä¸ªç±»çš„ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªç±»æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæå‰åŽ»åŠ è½½è¿™ä¸ªç±»çš„Classæ–‡ä»¶å¹¶è¿›è¡Œåˆå§‹åŒ–å’Œç›¸å…³çš„æ£€éªŒå·¥ä½œï¼ŒJavaè™šæ‹Ÿæœºèƒ½å¤Ÿä¿è¯åœ¨ä½ ä½¿ç”¨åˆ°è¿™ä¸ªç±»ä¹‹å‰å°±ä¼šå®Œæˆè¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬åªéœ€è¦å®‰å¿ƒçš„åŽ»ä½¿ç”¨å®ƒå°±å¥½äº†ï¼Œè€Œä¸å¿…å…³å¿ƒJavaè™šæ‹Ÿæœºæ˜¯æ€Žæ ·åŠ è½½å®ƒçš„ã€‚å½“ç„¶ï¼ŒClassæ–‡ä»¶å¹¶ä¸ä¸€å®šéžå¾—é€šè¿‡ç¼–è¯‘Javaæ–‡ä»¶è€Œæ¥ï¼Œä½ ç”šè‡³å¯ä»¥ç›´æŽ¥é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨æ¥ç¼–å†™Classæ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼ŒJDKåŠ¨æ€ä»£ç†å°±æ˜¯é€šè¿‡ç¨‹åºæ¥åŠ¨æ€ç”ŸæˆClassæ–‡ä»¶çš„ã€‚ ç”ŸæˆClassæ–‡ä»¶ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰è¦ç”Ÿæˆçš„ä»£ç†æ–¹æ³•ï¼Œå°†å…¶åŒ…è£…æˆProxyMethodå¯¹è±¡å¹¶æ³¨å†Œåˆ°Mapé›†åˆä¸­ã€‚ ç¬¬äºŒæ­¥ï¼šæ”¶é›†æ‰€æœ‰è¦ä¸ºClassæ–‡ä»¶ç”Ÿæˆçš„å­—æ®µä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ã€‚ ç¬¬ä¸‰æ­¥ï¼šå®Œæˆäº†ä¸Šé¢çš„å·¥ä½œåŽï¼Œå¼€å§‹ç»„è£…Classæ–‡ä»¶ã€‚ ä¸€ä¸ªç±»çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯å®ƒçš„å­—æ®µå’Œæ–¹æ³•ã€‚é‡ç‚¹èšç„¦ç¬¬äºŒæ­¥ï¼Œçœ‹çœ‹å®ƒä¸ºä»£ç†ç±»ç”Ÿæˆäº†å“ªäº›å­—æ®µå’Œæ–¹æ³•ã€‚åœ¨ç¬¬äºŒæ­¥ä¸­ï¼ŒæŒ‰é¡ºåºåšäº†ä¸‹é¢å››ä»¶äº‹ã€‚ ä¸ºä»£ç†ç±»ç”Ÿæˆä¸€ä¸ªå¸¦å‚æž„é€ å™¨ï¼Œä¼ å…¥InvocationHandlerå®žä¾‹çš„å¼•ç”¨å¹¶è°ƒç”¨çˆ¶ç±»çš„å¸¦å‚æž„é€ å™¨ã€‚ éåŽ†ä»£ç†æ–¹æ³•Mapé›†åˆï¼Œä¸ºæ¯ä¸ªä»£ç†æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„Methodç±»åž‹é™æ€åŸŸï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°fieldsé›†åˆä¸­ã€‚ éåŽ†ä»£ç†æ–¹æ³•Mapé›†åˆï¼Œä¸ºæ¯ä¸ªä»£ç†æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„MethodInfoå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°methodsé›†åˆä¸­ã€‚ ä¸ºä»£ç†ç±»ç”Ÿæˆé™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥é™æ€åˆå§‹åŒ–æ–¹æ³•ä¸»è¦æ˜¯å°†æ¯ä¸ªä»£ç†æ–¹æ³•çš„å¼•ç”¨èµ‹å€¼ç»™å¯¹åº”çš„é™æ€å­—æ®µã€‚ é€šè¿‡ä»¥ä¸Šåˆ†æžï¼Œå¯ä»¥å¤§è‡´çŸ¥é“JDKåŠ¨æ€ä»£ç†æœ€ç»ˆä¼šç”Ÿæˆå¦‚ä¸‹ç»“æž„çš„ä»£ç†ç±»ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class Proxy0 extends Proxy implements UserDao &#123; //ç¬¬ä¸€æ­¥, ç”Ÿæˆæž„é€ å™¨ protected Proxy0(InvocationHandler h) &#123; super(h); &#125; //ç¬¬äºŒæ­¥, ç”Ÿæˆé™æ€åŸŸ private static Method m1; //hashCodeæ–¹æ³• private static Method m2; //equalsæ–¹æ³• private static Method m3; //toStringæ–¹æ³• private static Method m4; //... //ç¬¬ä¸‰æ­¥, ç”Ÿæˆä»£ç†æ–¹æ³• @Override public int hashCode() &#123; try &#123; return (int) h.invoke(this, m1, null); &#125; catch (Throwable e) &#123; throw new UndeclaredThrowableException(e); &#125; &#125; @Override public boolean equals(Object obj) &#123; try &#123; Object[] args = new Object[] &#123;obj&#125;; return (boolean) h.invoke(this, m2, args); &#125; catch (Throwable e) &#123; throw new UndeclaredThrowableException(e); &#125; &#125; @Override public String toString() &#123; try &#123; return (String) h.invoke(this, m3, null); &#125; catch (Throwable e) &#123; throw new UndeclaredThrowableException(e); &#125; &#125; @Override public void save(User user) &#123; try &#123; //æž„é€ å‚æ•°æ•°ç»„, å¦‚æžœæœ‰å¤šä¸ªå‚æ•°å¾€åŽé¢æ·»åŠ å°±è¡Œäº† Object[] args = new Object[] &#123;user&#125;; h.invoke(this, m4, args); &#125; catch (Throwable e) &#123; throw new UndeclaredThrowableException(e); &#125; &#125; //ç¬¬å››æ­¥, ç”Ÿæˆé™æ€åˆå§‹åŒ–æ–¹æ³• static &#123; try &#123; Class c1 = Class.forName(Object.class.getName()); Class c2 = Class.forName(UserDao.class.getName()); m1 = c1.getMethod("hashCode", null); m2 = c1.getMethod("equals", new Class[]&#123;Object.class&#125;); m3 = c1.getMethod("toString", null); m4 = c2.getMethod("save", new Class[]&#123;User.class&#125;); //... &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; ç»è¿‡å±‚å±‚åˆ†æžï¼Œæ·±å…¥æŽ¢ç©¶JDKæºç ï¼Œè¿˜åŽŸåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„æœ¬æ¥é¢ç›®ï¼Œæ˜Žç™½äº†ä»¥ä¸‹å‡ ç‚¹ï¼š ä»£ç†ç±»é»˜è®¤ç»§æ‰¿Porxyç±»ï¼Œå› ä¸ºJavaä¸­åªæ”¯æŒå•ç»§æ‰¿ï¼Œæ‰€ä»¥JDKåŠ¨æ€ä»£ç†åªèƒ½åŽ»å®žçŽ°æŽ¥å£ã€‚ ä»£ç†æ–¹æ³•éƒ½ä¼šåŽ»è°ƒç”¨InvocationHandlerçš„invoke()æ–¹æ³•ï¼Œå› æ­¤éœ€è¦é‡å†™InvocationHandlerçš„invoke()æ–¹æ³•ã€‚ è°ƒç”¨invoke()æ–¹æ³•æ—¶ä¼šä¼ å…¥ä»£ç†å®žä¾‹æœ¬èº«ï¼Œç›®æ ‡æ–¹æ³•å’Œç›®æ ‡æ–¹æ³•å‚æ•°ã€‚è§£é‡Šäº†invoke()æ–¹æ³•çš„å‚æ•°æ˜¯æ€Žæ ·æ¥çš„ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­try...catch...finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ]]></title>
    <url>%2Fposts%2F65251ffc.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹å‡ ä¸ªç¤ºä¾‹ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; ç¤ºä¾‹ä¸€ï¼ˆtryä¸­æœ‰returnï¼Œfinallyä¸­æ²¡æœ‰returnï¼‰ï¼š&lt;/p&gt; 12345678910111213141516171819202122232425262728package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: tryä¸­æœ‰returnï¼Œfinallyä¸­æ²¡æœ‰return */public class DemoOne &#123; public static void main(String[] args) &#123; System.out.println(test()); &#125; private static int test() &#123; int num = 10; try &#123; System.out.println("try..."); return num += 100; &#125; catch (Exception e) &#123; System.out.println("catch..."); &#125; finally &#123; if (num &gt; 50) &#123; System.out.println("num &gt; 50 : " + num); &#125; System.out.println("finally..."); &#125; return num; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; 1234try...num &gt; 50 : 110finally...110 &lt;span id=&quot;inline-green&quot;&gt; åˆ†æžï¼š &lt;/span&gt; æ˜¾ç„¶â€œreturn num += 100â€è¢«æ‹†åˆ†æˆäº†â€œnum = num+100â€å’Œâ€œreturn numâ€ä¸¤ä¸ªè¯­å¥ï¼Œçº¿æ‰§è¡Œtryä¸­çš„â€œnum = num+100â€è¯­å¥ï¼Œå°†å…¶ä¿å­˜èµ·æ¥ï¼Œåœ¨tryä¸­çš„â€return numâ€œæ‰§è¡Œå‰ï¼Œå…ˆå°†finallyä¸­çš„è¯­å¥æ‰§è¡Œå®Œï¼Œè€ŒåŽå†å°†110è¿”å›žã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; ç¤ºä¾‹äºŒï¼ˆtryå’Œfinallyä¸­å‡æœ‰returnï¼‰ï¼š&lt;/p&gt; 1234567891011121314151617181920212223242526272829package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: tryå’Œfinallyä¸­å‡æœ‰return */public class DemoTwo &#123; public static void main(String[] args) &#123; System.out.println(testTwo()); &#125; private static int testTwo() &#123; int num = 10; try &#123; System.out.println("try..."); return num += 100; &#125; catch (Exception e) &#123; System.out.println("catch error..."); &#125; finally &#123; if (num &gt; 50) &#123; System.out.println("num &gt; 50 : " + num); &#125; System.out.println("finally..."); num = 100; return num; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; 1234try...num &gt; 50 : 110finally...100 &lt;span id=&quot;inline-green&quot;&gt; åˆ†æžï¼š &lt;/span&gt; tryä¸­çš„returnè¯­å¥åŒæ ·è¢«æ‹†åˆ†äº†ï¼Œfinallyä¸­çš„returnè¯­å¥å…ˆäºŽtryä¸­çš„returnè¯­å¥æ‰§è¡Œï¼Œå› è€Œtryä¸­çš„returnè¢«â€è¦†ç›–â€œæŽ‰äº†ï¼Œä¸å†æ‰§è¡Œã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; ç¤ºä¾‹ä¸‰ï¼ˆfinallyä¸­æ”¹å˜è¿”å›žå€¼numï¼‰ï¼š&lt;/p&gt; 1234567891011121314151617181920212223242526272829package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: finallyä¸­æ”¹å˜è¿”å›žå€¼num */public class DemoThree &#123; public static void main(String[] args) &#123; System.out.println(testThree()); &#125; private static int testThree() &#123; int num = 10; try &#123; System.out.println("try..."); return num; &#125; catch (Exception e) &#123; System.out.println("catch error..."); &#125; finally &#123; if (num &gt; 20) &#123; System.out.println("num &gt; 20 : " + num); &#125; System.out.println("finally"); num = 100; &#125; return num; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; 123try...finally10 &lt;span id=&quot;inline-green&quot;&gt; åˆ†æžï¼š &lt;/span&gt; è™½ç„¶åœ¨finallyä¸­æ”¹å˜äº†è¿”å›žå€¼numï¼Œä½†å› ä¸ºfinallyä¸­æ²¡æœ‰returnè¯¥numçš„å€¼ï¼Œå› æ­¤åœ¨æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åŽï¼ŒtestThree()å‡½æ•°ä¼šå¾—åˆ°tryä¸­è¿”å›žçš„numçš„å€¼ï¼Œè€Œtryä¸­çš„numçš„å€¼ä¾ç„¶æ˜¯ç¨‹åºè¿›å…¥finallyä»£ç å—å‰ä¿ç•™ä¸‹æ¥çš„å€¼ï¼Œå› æ­¤å¾—åˆ°çš„è¿”å›žå€¼ä¸º10ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; ç¤ºä¾‹å››ï¼ˆå°†numçš„å€¼åŒ…è£…åœ¨Numç±»ä¸­ï¼‰ï¼š&lt;/p&gt; 12345678910111213141516171819202122232425262728293031package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: å°†numçš„å€¼åŒ…è£…åœ¨Numç±»ä¸­ */public class DemoFour &#123; public static void main(String[] args) &#123; System.out.println(test().num); &#125; private static Num test() &#123; Num number = new Num(); try &#123; System.out.println("try"); return number; &#125; catch (Exception e) &#123; System.out.println("error"); &#125; finally &#123; if (number.num &gt; 20) &#123; System.out.println("number.num &gt; 20 : " + number.num); &#125; System.out.println("finally"); number.num = 100; &#125; return number; &#125;&#125;class Num &#123; public int num = 10;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¾“å‡ºç»“æžœï¼š &lt;/span&gt; 123tryfinally100 &lt;span id=&quot;inline-green&quot;&gt; åˆ†æžï¼š &lt;/span&gt; ä»Žç»“æžœä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒæ ·æ˜¯åœ¨finallyä¸­æ”¹å˜äº†è¿”å›žå€¼numçš„å€¼ï¼Œåœ¨ç¤ºä¾‹ä¸‰ä¸­ï¼Œå¹¶æ²¡æœ‰è¢«tryä¸­çš„returnè¿”å›žï¼ˆtestï¼ˆï¼‰æ–¹æ³•å¾—åˆ°çš„ä¸æ˜¯100ï¼‰ï¼Œä½†åœ¨è¿™é‡Œå´è¢«tryä¸­çš„returnè¯­å¥è¿”å›žäº†ã€‚ å¯¹äºŽå«æœ‰returnè¯­å¥çš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ€»ç»“å¦‚ä¸‹ï¼š &lt;font color=&quot;blue&quot;&gt;tryè¯­å¥åœ¨è¿”å›žå‰ï¼Œå°†å…¶ä»–æ‰€æœ‰çš„æ“ä½œæ‰§è¡Œå®Œï¼Œä¿ç•™å¥½è¦è¿”å›žçš„å€¼ï¼Œè€ŒåŽè½¬å…¥æ‰§è¡Œfinallyä¸­çš„è¯­å¥ï¼Œè€ŒåŽåˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;æƒ…å†µä¸€ï¼šå¦‚æžœfinallyä¸­æœ‰returnè¯­å¥ï¼Œåˆ™ä¼šå°†tryä¸­çš„returnè¯­å¥â€è¦†ç›–â€œæŽ‰ï¼Œç›´æŽ¥æ‰§è¡Œfinallyä¸­çš„returnè¯­å¥ï¼Œå¾—åˆ°è¿”å›žå€¼ï¼Œè¿™æ ·ä¾¿æ— æ³•å¾—åˆ°tryä¹‹å‰ä¿ç•™å¥½çš„è¿”å›žå€¼ã€‚&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;æƒ…å†µäºŒï¼šå¦‚æžœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä¹Ÿæ²¡æœ‰æ”¹å˜è¦è¿”å›žå€¼ï¼Œåˆ™æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åŽï¼Œä¼šæŽ¥ç€æ‰§è¡Œtryä¸­çš„returnè¯­å¥ï¼Œè¿”å›žä¹‹å‰ä¿ç•™çš„å€¼ã€‚&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;æƒ…å†µä¸‰ï¼šå¦‚æžœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä½†æ˜¯æ”¹å˜äº†è¦è¿”å›žçš„å€¼ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä¸Žå¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’çš„åŒºåˆ«ï¼Œåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;1ï¼‰å¦‚æžœreturnçš„æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»åž‹æˆ–æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œåˆ™åœ¨finallyä¸­å¯¹è¯¥åŸºæœ¬æ•°æ®çš„æ”¹å˜ä¸èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›žè¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„å€¼ã€‚&lt;/font&gt; &lt;font color=&quot;blue&quot;&gt;2ï¼‰å¦‚æžœreturnçš„æ•°æ®æ˜¯å¼•ç”¨æ•°æ®ç±»åž‹ï¼Œè€Œåœ¨finallyä¸­å¯¹è¯¥å¼•ç”¨æ•°æ®ç±»åž‹çš„å±žæ€§å€¼çš„æ”¹å˜èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›žçš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åŽçš„è¯¥å±žæ€§çš„å€¼ã€‚&lt;/font&gt;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMåŽŸç†]]></title>
    <url>%2Fposts%2F6f6b6cd5.html</url>
    <content type="text"><![CDATA[Javaå†…å­˜æ¨¡åž‹ Javaç¨‹åºæ‰§è¡Œæµç¨‹ æ—¥å¸¸Javaçš„åŸºæœ¬å¼€å‘æ¨¡å¼æ˜¯ï¼Œæˆ‘ä»¬å†™çš„æ‰€æœ‰javaç¨‹åºéƒ½ä¿å­˜åœ¨*.javaçš„æ–‡ä»¶ä¸­ï¼Œå³æˆ‘ä»¬çš„æºä»£ç ï¼Œè¿™äº›æºä»£ç å¿…é¡»ç»è¿‡javac.exeå‘½ä»¤å°†å…¶ç¼–è¯‘æˆ*.classæ–‡ä»¶ï¼Œè€ŒåŽåˆ©ç”¨java.exeå‘½ä»¤åœ¨JVMè¿›ç¨‹ä¸­è§£é‡Šæ‰§è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š å®žé™…ä¸Šï¼Œå½“JVMå°†æ‰€éœ€è¦çš„ .class æ–‡ä»¶åŠ è½½åˆ° JVM è¿›ç¨‹ä¹‹ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆClassLoad),ç±»åŠ è½½å™¨çš„å¥½å¤„åœ¨äºŽï¼šå¯ä»¥éšå®šæŒ‡å®š *.class æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚ JVMï¼šjavaè™šæ‹Ÿæœºï¼Œæ‰€æœ‰çš„ç¨‹åºéƒ½è¦æ±‚è¿è¡Œåœ¨JVMä¸Šï¼Œæ˜¯å› ä¸ºè€ƒè™‘åˆ°äº†å¯ç§»æ¤æ€§é—®é¢˜ ï¼Œä½†å¦‚æžœçœŸæ­£åŽ»æ‰§è¡Œç¨‹åºï¼Œæ— æ³•ç¦»å¼€æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚ åœ¨ java ä¸­å¯ä»¥ä½¿ç”¨ native å®žçŽ° æœ¬åœ° C å‡½æ•°çš„è°ƒç”¨ï¼ŒNative Interfaceï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯å±žäºŽç¨‹åºçš„è¾…åŠ©æ‰‹æ®µï¼Œè€ŒçœŸæ­£çš„ç¨‹åºè¿è¡Œéƒ½åœ¨â€œè¿è¡Œæ—¶æ•°æ®åŒºâ€ä¹‹ä¸­ã€‚ ç¨‹åºè®¡æ•°å™¨ ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºè®¡æ•°å™¨é‡Œé¢è®°å½•çš„æ˜¯å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ æ³¨ï¼šä½†æ˜¯ï¼Œå¦‚æžœå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¨‹åºè®¡æ•°å™¨ä¸ºç©ºã€‚ ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ ç¨‹åºè®¡æ•°å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»Žè€Œå®žçŽ°ä»£ç çš„æµç¨‹æŽ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªçŽ¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºŽè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»Žè€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›žæ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ ç¨‹åºè®¡æ•°å™¨çš„ç‰¹ç‚¹ æ˜¯ä¸€å—è¾ƒå°çš„å­˜å‚¨ç©ºé—´ çº¿ç¨‹ç§æœ‰ã€‚æ¯æ¡çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ã€‚ æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºçŽ°OutOfMemoryErrorçš„å†…å­˜åŒºåŸŸã€‚ ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ Javaè™šæ‹Ÿæœºæ ˆ(JVM Stack) ä»€ä¹ˆæ˜¯Javaè™šæ‹Ÿæœºæ ˆ Javaè™šæ‹Ÿæœºæ ˆæ˜¯æè¿°Javaæ–¹æ³•è¿è¡Œè¿‡ç¨‹çš„å†…å­˜æ¨¡åž‹ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¼šä¸ºæ¯ä¸€ä¸ªå³å°†è¿è¡Œçš„Javaæ–¹æ³•åˆ›å»ºä¸€å—å«åšâ€œæ ˆå¸§â€çš„åŒºåŸŸï¼Œè¿™å—åŒºåŸŸç”¨äºŽå­˜å‚¨è¯¥æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ä¸€äº›ä¿¡æ¯ã€‚ åœ¨JVM ä¸­ç”¨æ ˆå¸§ï¼ˆStack Frameï¼‰æ¥å®šä¹‰æ ˆçš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªæ ˆå¸§è¡¨ç¤ºæ¯ä¸ªå¯èƒ½æ‰§è¡Œçš„æ–¹æ³•ã€‚ è€Œæ ˆå¸§ä¸­åˆ™åŒ…å«äº†ï¼šå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿”å›žåœ°å€å’ŒåŠ¨æ€é“¾æŽ¥ã€‚ å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰:æ–¹æ³•çš„å±€éƒ¨å˜é‡æˆ–å½¢å‚ï¼Œå…¶ä»¥å˜é‡æ§½ï¼ˆsoltï¼‰ä¸ºæœ€å°å•ä½ï¼Œåªå…è®¸ä¿å­˜32ä¸ºé•¿åº¦çš„å˜é‡ï¼Œå¦‚æžœè¶…è¿‡32ä½åˆ™ä¼šå¼€è¾Ÿä¸¤ä¸ªè¿žç»­çš„solt(64ä½é•¿åº¦ï¼Œlongå’Œdouble)ï¼› æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ï¼šè¡¨è¾¾å¼è®¡ç®—åœ¨æ ˆä¸­å®Œæˆï¼› æŒ‡å‘å½“å‰æ–¹æ³•æ‰€å±žçš„ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ï¼ˆReference to runtime constant poolï¼‰ï¼šå¼•ç”¨å…¶ä»–ç±»çš„å¸¸é‡æˆ–è€…ä½¿ç”¨String æ± ä¸­çš„å­—ç¬¦ä¸²ï¼› æ–¹æ³•è¿”å›žåœ°å€ï¼ˆReturn Addressï¼‰ï¼šæ–¹æ³•æ‰§è¡Œå®ŒåŽéœ€è¦è¿”å›žè°ƒç”¨æ­¤æ–¹æ³•çš„ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦å†æ ˆå¸§ä¸­ä¿å­˜æ–¹æ³•è¿”å›žåœ°å€ï¼› Javaè™šæ‹Ÿæœºæ ˆçš„ç‰¹ç‚¹ å±€éƒ¨å˜é‡è¡¨çš„åˆ›å»ºæ˜¯åœ¨æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œéšç€æ ˆå¸§çš„åˆ›å»ºè€Œåˆ›å»ºã€‚è€Œä¸”ï¼Œå±€éƒ¨å˜é‡è¡¨çš„å¤§å°åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šä¸‹æ¥äº†ï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™åªéœ€åˆ†é…äº‹å…ˆè§„å®šå¥½çš„å¤§å°å³å¯ã€‚æ­¤å¤–ï¼Œåœ¨æ–¹æ³•è¿è¡Œçš„è¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡è¡¨çš„å¤§å°æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¼šå‡ºçŽ°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowErrorå’ŒOutOfMemoryErrorã€‚ a) StackOverFlowErrorï¼š è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰Javaè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ã€‚ b) OutOfMemoryErrorï¼š è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„Javaè™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚ æ³¨ï¼šStackOverFlowErrorå’ŒOutOfMemoryErrorçš„å¼‚åŒï¼Ÿ StackOverFlowErrorè¡¨ç¤ºå½“å‰çº¿ç¨‹ç”³è¯·çš„æ ˆè¶…è¿‡äº†äº‹å…ˆå®šå¥½çš„æ ˆçš„æœ€å¤§æ·±åº¦ï¼Œä½†å†…å­˜ç©ºé—´å¯èƒ½è¿˜æœ‰å¾ˆå¤šã€‚ è§£å†³è¿™ç§é—®é¢˜å¯ä»¥é€‚å½“åŠ å¤§æ ˆçš„æ·±åº¦ï¼ˆå¢žåŠ æ ˆç©ºé—´å¤§å°ï¼‰ï¼Œä¹Ÿå°±æ˜¯æŠŠ -Xss çš„å€¼è®¾ç½®å¤§ä¸€äº›ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä»£ç é—®é¢˜çš„å¯èƒ½æ€§è¾ƒå¤§ è€ŒOutOfMemoryErroræ˜¯æŒ‡å½“çº¿ç¨‹ç”³è¯·æ ˆæ—¶å‘çŽ°æ ˆå·²ç»æ»¡äº†ï¼Œè€Œä¸”å†…å­˜ä¹Ÿå…¨éƒ½ç”¨å…‰äº†ã€‚ è§£å†³è¿™ç§é—®é¢˜å¯ä»¥é€‚å½“å‡å°æ ˆçš„æ·±åº¦ï¼Œä¹Ÿå°±æ˜¯æŠŠ -Xss çš„å€¼è®¾ç½®å°ä¸€äº›ï¼Œæ¯ä¸ªçº¿ç¨‹å ç”¨çš„ç©ºé—´å°äº†ï¼Œæ€»ç©ºé—´ä¸€å®šå°±èƒ½å®¹çº³æ›´å¤šçš„çº¿ç¨‹ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°æœ‰é™åˆ¶ï¼Œç»éªŒå€¼åœ¨ 3000~5000 å·¦å³ã€‚ åœ¨ jdk1.5 ä¹‹å‰ -Xss é»˜è®¤æ˜¯ 256kï¼Œjdk1.5 ä¹‹åŽé»˜è®¤æ˜¯ 1Mï¼Œè¿™ä¸ªé€‰é¡¹å¯¹ç³»ç»Ÿå½±å“è¿˜æ˜¯è›®å¤§çš„ï¼Œè®¾ç½®æ—¶è¦æ ¹æ®å®žé™…æƒ…å†µï¼Œè°¨æ…Žæ“ä½œã€‚ æœ¬åœ°æ–¹æ³•æ ˆ ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•æ ˆ æœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaè™šæ‹Ÿæœºæ ˆå®žçŽ°çš„åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡æœ¬åœ°æ–¹æ³•æ ˆæ˜¯æœ¬åœ°æ–¹æ³•è¿è¡Œçš„å†…å­˜æ¨¡åž‹ã€‚ æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºŽå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æŽ¥ã€å‡ºå£ä¿¡æ¯ã€‚ æ–¹æ³•æ‰§è¡Œå®Œæ¯•åŽç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ä¹Ÿä¼šæŠ›å‡ºStackOverFlowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚ å † ä»€ä¹ˆæ˜¯å † å †æ˜¯ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚ å‡ ä¹Žæ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †ä¸­ã€‚ å †çš„ç‰¹ç‚¹ çº¿ç¨‹å…±äº«ï¼Œæ•´ä¸ªJavaè™šæ‹Ÿæœºåªæœ‰ä¸€ä¸ªå †ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½è®¿é—®åŒä¸€ä¸ªå †ã€‚è€Œç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªçš„ã€‚ åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º åžƒåœ¾å›žæ”¶çš„ä¸»è¦åœºæ‰€ã€‚ å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€‚ æ–°ç”Ÿä»£åˆå¯è¢«åˆ†ä¸ºï¼šEdenã€From Surviorã€To Surviorã€‚ ä¸åŒçš„åŒºåŸŸå­˜æ”¾å…·æœ‰ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥æ ¹æ®ä¸åŒçš„åŒºåŸŸä½¿ç”¨ä¸åŒçš„åžƒåœ¾å›žæ”¶ç®—æ³•ï¼Œä»Žè€Œæ›´å…·æœ‰é’ˆå¯¹æ€§ï¼Œæ›´é«˜æ•ˆã€‚ å †çš„å¤§å°æ—¢å¯ä»¥å›ºå®šä¹Ÿå¯ä»¥æ‰©å±•ï¼Œä½†ä¸»æµçš„è™šæ‹Ÿæœºå †çš„å¤§å°æ˜¯å¯æ‰©å±•çš„ï¼Œå› æ­¤å½“çº¿ç¨‹è¯·æ±‚åˆ†é…å†…å­˜ï¼Œä½†å †å·²æ»¡ï¼Œä¸”å†…å­˜å·²æ»¡æ— æ³•å†æ‰©å±•æ—¶ï¼Œå°±æŠ›å‡ºOutOfMemoryErrorã€‚ æ–¹æ³•åŒº ä»€ä¹ˆæ˜¯æ–¹æ³•åŒº Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰æ–¹æ³•åŒºæ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ã€‚æ–¹æ³•åŒºä¸­å­˜æ”¾å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„ä»£ç ç­‰ã€‚ æ–¹æ³•åŒºçš„ç‰¹ç‚¹ çº¿ç¨‹å…±äº« æ–¹æ³•åŒºæ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œå› æ­¤å’Œå †ä¸€æ ·ï¼Œéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚æ•´ä¸ªè™šæ‹Ÿæœºä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•åŒºã€‚ æ°¸ä¹…ä»£ æ–¹æ³•åŒºä¸­çš„ä¿¡æ¯ä¸€èˆ¬éœ€è¦é•¿æœŸå­˜åœ¨ï¼Œè€Œä¸”å®ƒåˆæ˜¯å †çš„é€»è¾‘åˆ†åŒºï¼Œå› æ­¤ç”¨å †çš„åˆ’åˆ†æ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠæ–¹æ³•åŒºç§°ä¸ºæ°¸ä¹…ä»£ã€‚ å†…å­˜å›žæ”¶æ•ˆçŽ‡ä½Ž æ–¹æ³•åŒºçš„ä¿¡æ¯ä¸€èˆ¬éœ€è¦é•¿æœŸå­˜åœ¨ï¼Œå›žæ”¶ä¸€éå†…å­˜ä¹‹åŽå¯èƒ½åªæœ‰å°‘é‡ä¿¡æ¯æ— æ•ˆã€‚ å¯¹æ–¹æ³•åŒºçš„å†…å­˜å›žæ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯ï¼šå¯¹å¸¸é‡æ± çš„å›žæ”¶ å’Œ å¯¹ç±»çš„å¸è½½ã€‚ Javaè™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºçš„è¦æ±‚æ¯”è¾ƒå®½æ¾ã€‚ å’Œå †ä¸€æ ·ï¼Œå…è®¸å›ºå®šå¤§å°ï¼Œä¹Ÿå…è®¸å¯æ‰©å±•çš„å¤§å°ï¼Œè¿˜å…è®¸ä¸å®žçŽ°åžƒåœ¾å›žæ”¶ã€‚ ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶å¸¸é‡æ±  æ–¹æ³•åŒºä¸­å­˜æ”¾ä¸‰ç§æ•°æ®ï¼šç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åŽçš„ä»£ç ã€‚å…¶ä¸­å¸¸é‡å­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚jdk1,6å¸¸é‡æ± æ”¾åœ¨æ–¹æ³•åŒºï¼Œjdk1.7å¸¸é‡æ± æ”¾åœ¨å †å†…å­˜ï¼Œjdk1.8æ”¾åœ¨å…ƒç©ºé—´é‡Œé¢ï¼Œå’Œå †ç›¸ç‹¬ç«‹ã€‚ æˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸€ä¸ªç±»ä¸­é€šè¿‡public static finalæ¥å£°æ˜Žä¸€ä¸ªå¸¸é‡ã€‚è¿™ä¸ªç±»è¢«ç¼–è¯‘åŽä¾¿ç”ŸæˆClassæ–‡ä»¶ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨è¿™ä¸ªclassæ–‡ä»¶ä¸­ã€‚ å½“è¿™ä¸ªç±»è¢«Javaè™šæ‹ŸæœºåŠ è½½åŽï¼Œclassæ–‡ä»¶ä¸­çš„å¸¸é‡å°±å­˜æ”¾åœ¨æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚è€Œä¸”åœ¨è¿è¡ŒæœŸé—´ï¼Œå¯ä»¥å‘å¸¸é‡æ± ä¸­æ·»åŠ æ–°çš„å¸¸é‡ã€‚å¦‚ï¼šStringç±»çš„intern()æ–¹æ³•å°±èƒ½åœ¨è¿è¡ŒæœŸé—´å‘å¸¸é‡æ± ä¸­æ·»åŠ å­—ç¬¦ä¸²å¸¸é‡ã€‚ å½“è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„æŸäº›å¸¸é‡æ²¡æœ‰è¢«å¯¹è±¡å¼•ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è¢«å˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦åžƒåœ¾æ”¶é›†å™¨å›žæ”¶ã€‚ ç›´æŽ¥å†…å­˜ ç›´æŽ¥å†…å­˜æ˜¯é™¤Javaè™šæ‹Ÿæœºä¹‹å¤–çš„å†…å­˜ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è¢«Javaä½¿ç”¨ã€‚ åœ¨NIOä¸­å¼•å…¥äº†ä¸€ç§åŸºäºŽé€šé“å’Œç¼“å†²çš„IOæ–¹å¼ã€‚å®ƒå¯ä»¥é€šè¿‡è°ƒç”¨æœ¬åœ°æ–¹æ³•ç›´æŽ¥åˆ†é…Javaè™šæ‹Ÿæœºä¹‹å¤–çš„å†…å­˜ï¼Œç„¶åŽé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ç›´æŽ¥æ“ä½œè¯¥å†…å­˜ï¼Œè€Œæ— éœ€å…ˆå°†å¤–é¢å†…å­˜ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å †ä¸­å†æ“ä½œï¼Œä»Žè€Œæå‡äº†æ•°æ®æ“ä½œçš„æ•ˆçŽ‡ã€‚ ç›´æŽ¥å†…å­˜çš„å¤§å°ä¸å—Javaè™šæ‹ŸæœºæŽ§åˆ¶ï¼Œä½†æ—¢ç„¶æ˜¯å†…å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶å°±ä¼šæŠ›å‡ºOOMå¼‚å¸¸ã€‚ Javaå¯¹è±¡è®¿é—®æ¨¡å¼ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å«æœ‰newçš„æŒ‡ä»¤æ—¶ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—å¯¹è±¡åˆ›å»ºçš„æ“ä½œï¼š æ£€æŸ¥å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰å³å°†è¦åˆ›å»ºçš„è¿™ä¸ªå¯¹è±¡æ‰€å±žçš„ç±»çš„ç¬¦å·å¼•ç”¨ï¼› è‹¥å¸¸é‡æ± ä¸­æ²¡æœ‰è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œè¯´æ˜Žè¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«å®šä¹‰ï¼æŠ›å‡ºClassNotFoundExceptionï¼› è‹¥å¸¸é‡æ± ä¸­æœ‰è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œï¼› è¿›è€Œæ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨æ‰€ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«JVMåŠ è½½ï¼› è‹¥è¯¥ç±»è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œå°±æ‰¾è¯¥ç±»çš„classæ–‡ä»¶ï¼Œå¹¶åŠ è½½è¿›æ–¹æ³•åŒºï¼› è‹¥è¯¥ç±»å·²ç»è¢«JVMåŠ è½½ï¼Œåˆ™å‡†å¤‡ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼› æ ¹æ®æ–¹æ³•åŒºä¸­è¯¥ç±»çš„ä¿¡æ¯ç¡®å®šè¯¥ç±»æ‰€éœ€çš„å†…å­˜å¤§å°ï¼› ä¸€ä¸ªå¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡æ‰€å±žç±»è¢«å®šä¹‰å®Œå°±èƒ½ç¡®å®šçš„ï¼ä¸”ä¸€ä¸ªç±»æ‰€ç”Ÿäº§çš„æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å¤§å°æ˜¯ä¸€æ ·çš„ï¼JVMåœ¨ä¸€ä¸ªç±»è¢«åŠ è½½è¿›æ–¹æ³•åŒºçš„æ—¶å€™å°±çŸ¥é“è¯¥ç±»ç”Ÿäº§çš„æ¯ä¸€ä¸ªå¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜å¤§å°ã€‚ ä»Žå †ä¸­åˆ’åˆ†ä¸€å—å¯¹åº”å¤§å°çš„å†…å­˜ç©ºé—´ç»™æ–°çš„å¯¹è±¡ï¼› åˆ†é…å †ä¸­å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š &lt;span id=&quot;inline-purple&quot;&gt; æŒ‡é’ˆç¢°æ’ž &lt;/span&gt; å¦‚æžœJVMçš„åžƒåœ¾æ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•æˆ–æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œé‚£ä¹ˆå †ä¸­ç©ºé—²å†…å­˜æ˜¯å®Œæ•´çš„åŒºåŸŸï¼Œå¹¶ä¸”ç©ºé—²å†…å­˜å’Œå·²ä½¿ç”¨å†…å­˜ä¹‹é—´ç”±ä¸€ä¸ªæŒ‡é’ˆæ ‡è®°ã€‚é‚£ä¹ˆå½“ä¸ºä¸€ä¸ªå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€ç§»åŠ¨æŒ‡é’ˆå³å¯ã€‚å› æ­¤ï¼Œè¿™ç§åœ¨å®Œæ•´ç©ºé—²åŒºåŸŸä¸Šé€šè¿‡ç§»åŠ¨æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æ–¹å¼å°±å«åšâ€œæŒ‡é’ˆç¢°æ’žâ€ã€‚ &lt;span id=&quot;inline-purple&quot;&gt; ç©ºé—²åˆ—è¡¨ &lt;/span&gt; å¦‚æžœJVMçš„åžƒåœ¾æ”¶é›†å™¨é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œé‚£ä¹ˆå †ä¸­ç©ºé—²åŒºåŸŸå’Œå·²ä½¿ç”¨åŒºåŸŸäº¤é”™ï¼Œå› æ­¤éœ€è¦ç”¨ä¸€å¼ â€œç©ºé—²åˆ—è¡¨â€æ¥è®°å½•å †ä¸­å“ªäº›åŒºåŸŸæ˜¯ç©ºé—²åŒºåŸŸï¼Œä»Žè€Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æ ¹æ®è¿™å¼ â€œç©ºé—²åˆ—è¡¨â€æ‰¾åˆ°ç©ºé—²åŒºåŸŸï¼Œå¹¶åˆ†é…å†…å­˜ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼šJVMç©¶ç«Ÿé‡‡ç”¨å“ªç§å†…å­˜åˆ†é…æ–¹æ³•ï¼Œå–å†³äºŽå®ƒä½¿ç”¨äº†ä½•ç§åžƒåœ¾æ”¶é›†å™¨ã€‚ ä¸ºå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡èµ‹ä¸Šåˆå§‹å€¼(é»˜è®¤åˆå§‹åŒ–)ï¼› è®¾ç½®å¯¹è±¡å¤´ä¸­çš„ä¿¡æ¯ï¼› è°ƒç”¨å¯¹è±¡çš„æž„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ– æ­¤æ—¶ï¼Œæ•´ä¸ªå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å°±å®Œæˆäº†ã€‚ å¯¹è±¡çš„å†…å­˜æ¨¡åž‹ ä¸€ä¸ªå¯¹è±¡ä»Žé€»è¾‘è§’åº¦çœ‹ï¼Œå®ƒç”±æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°æž„æˆï¼Œä»Žç‰©ç†è§’åº¦æ¥çœ‹ï¼Œå¯¹è±¡æ˜¯å­˜å‚¨åœ¨å †ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°ï¼Œè¿™ä¸²äºŒè¿›åˆ¶æ•°çš„ç»„ç»‡ç»“æž„å¦‚ä¸‹ã€‚ å¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š å¯¹è±¡å¤´ å®žä¾‹æ•°æ® å¯¹é½è¡¥å…… å¯¹è±¡å¤´ åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºŽå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œ32 ä½è™šæ‹Ÿæœºå  32 bitï¼Œ64 ä½è™šæ‹Ÿæœºå  64 bitã€‚å®˜æ–¹ç§°ä¸º â€˜Mark Wordâ€™ã€‚ ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»åž‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»çš„å…ƒæ•°æ®æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®žä¾‹ã€‚ å¦å¤–ï¼Œå¦‚æžœæ˜¯ Java æ•°ç»„ï¼Œå¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºŽè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸ºæ™®é€šå¯¹è±¡å¯ä»¥é€šè¿‡ Java å¯¹è±¡å…ƒæ•°æ®ç¡®å®šå¤§å°ï¼Œè€Œæ•°ç»„å¯¹è±¡ä¸å¯ä»¥ã€‚ å®žä¾‹æ•°æ® å®žä¾‹æ•°æ®éƒ¨åˆ†å°±æ˜¯æˆå‘˜å˜é‡çš„å€¼ï¼Œå…¶ä¸­åŒ…å«çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œæœ¬ç±»çš„æˆå‘˜å˜é‡ã€‚ å¯¹é½è¡¥å…… ç”¨äºŽç¡®ä¿å¯¹è±¡çš„æ€»é•¿åº¦ä¸º8å­—èŠ‚çš„æ•´æ•°å€ã€‚ HotSpotè¦æ±‚å¯¹è±¡çš„æ€»é•¿åº¦å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚ç”±äºŽå¯¹è±¡å¤´ä¸€å®šæ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œä½†å®žä¾‹æ•°æ®éƒ¨åˆ†çš„é•¿åº¦æ˜¯ä»»æ„çš„ï¼Œå› æ­¤éœ€è¦å¯¹é½è¡¥å……å­—æ®µç¡®ä¿æ•´ä¸ªå¯¹è±¡çš„æ€»é•¿åº¦ä¸º8çš„æ•´æ•°å€ã€‚ è®¿é—®å¯¹è±¡çš„è¿‡ç¨‹ æˆ‘ä»¬çŸ¥é“ï¼Œå¼•ç”¨ç±»åž‹çš„å˜é‡ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆæ ¹æ®åœ°å€ç±»åž‹çš„ä¸åŒï¼Œå¯¹è±¡æœ‰ä¸åŒçš„è®¿é—®æ–¹å¼ï¼š å¥æŸ„è®¿é—®æ–¹å¼ å †ä¸­éœ€è¦æœ‰ä¸€å—å«åšâ€œå¥æŸ„æ± â€çš„å†…å­˜ç©ºé—´ï¼Œç”¨äºŽå­˜æ”¾æ‰€æœ‰å¯¹è±¡çš„åœ°å€å’Œæ‰€æœ‰å¯¹è±¡æ‰€å±žç±»çš„ç±»ä¿¡æ¯ã€‚ å¼•ç”¨ç±»åž‹çš„å˜é‡å­˜æ”¾çš„æ˜¯è¯¥å¯¹è±¡åœ¨å¥æŸ„æ± ä¸­çš„åœ°å€ã€‚è®¿é—®å¯¹è±¡æ—¶ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡å¼•ç”¨ç±»åž‹çš„å˜é‡æ‰¾åˆ°è¯¥å¯¹è±¡çš„å¥æŸ„ï¼Œç„¶åŽæ ¹æ®å¥æŸ„ä¸­å¯¹è±¡çš„åœ°å€å†è®¿é—®å¯¹è±¡ã€‚ è¿™ç§æ¨¡å¼çš„å‡†ç¡®åº¦å¾ˆé«˜ï¼Œä½†è¿‡ç¨‹è¾ƒä¸ºç¹çï¼Œè€Œjavaä¸­æ˜¯æ²¡æœ‰å¥æŸ„çš„ï¼Œæ‰€ä»¥ï¼Œjavaä¸­ç›´æŽ¥åˆ©ç”¨çš„å¯¹è±¡ä¿å­˜æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å †å†…å­˜ä¸­ï¼Œä¸éœ€è¦ä¿å­˜å¥æŸ„ï¼Œè€Œç›´æŽ¥ä¿å­˜å…·ä½“çš„å¯¹è±¡ã€‚å°±ç›¸å½“äºŽçœç•¥äº†å¥æŸ„åˆ°å¯¹è±¡ä¹‹é—´çš„æŸ¥æ‰¾ã€‚è€ŒåŽè¿™ä¸ªå¯¹è±¡å¯ä»¥ç›´æŽ¥è¿›è¡ŒJavaæ–¹æ³•åŒºçš„è°ƒç”¨ã€‚ ç›´æŽ¥æŒ‡é’ˆè®¿é—®æ–¹å¼ å¼•ç”¨ç±»åž‹çš„å˜é‡ç›´æŽ¥å­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼Œä»Žè€Œä¸éœ€è¦å¥æŸ„æ± ï¼Œé€šè¿‡å¼•ç”¨èƒ½å¤Ÿç›´æŽ¥è®¿é—®å¯¹è±¡ã€‚ ä½†å¯¹è±¡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸­éœ€è¦é¢å¤–çš„ç­–ç•¥å­˜å‚¨å¯¹è±¡æ‰€å±žçš„ç±»ä¿¡æ¯çš„åœ°å€ã€‚ æ¯”è¾ƒ HotSpoté‡‡ç”¨ç›´æŽ¥æŒ‡é’ˆæ–¹å¼è®¿é—®å¯¹è±¡ï¼Œå› ä¸ºå®ƒåªéœ€ä¸€æ¬¡å¯»å€æ“ä½œï¼Œä»Žè€Œæ€§èƒ½æ¯”å¥æŸ„è®¿é—®æ–¹å¼å¿«ä¸€å€ã€‚ä½†å®ƒéœ€è¦é¢å¤–çš„ç­–ç•¥å­˜å‚¨å¯¹è±¡åœ¨æ–¹æ³•åŒºä¸­ç±»ä¿¡æ¯çš„åœ°å€ã€‚ åžƒåœ¾æ”¶é›†ç­–ç•¥ ç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯æ¯æ¡çº¿ç¨‹éƒ½æ‹¥æœ‰è¿™ä¸‰å—åŒºåŸŸï¼Œè€Œä¸”ä¼šéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹çš„ç»“æŸè€Œé”€æ¯ã€‚é‚£ä¹ˆï¼Œåžƒåœ¾æ”¶é›†å™¨åœ¨ä½•æ—¶æ¸…æ‰«è¿™ä¸‰å—åŒºåŸŸçš„é—®é¢˜å°±è§£å†³äº†ã€‚ æ­¤å¤–ï¼ŒJavaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„æ ˆå¸§ä¼šéšç€æ–¹æ³•çš„å¼€å§‹è€Œå…¥æ ˆï¼Œæ–¹æ³•çš„ç»“æŸè€Œå‡ºæ ˆï¼Œå¹¶ä¸”æ¯ä¸ªæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨éƒ½æ˜¯åœ¨ç±»è¢«åŠ è½½çš„æ—¶å€™å°±ç¡®å®šçš„ã€‚å› æ­¤ä»¥ä¸Šä¸‰ä¸ªåŒºåŸŸçš„åžƒåœ¾æ”¶é›†å·¥ä½œå…·æœ‰ç¡®å®šæ€§ï¼Œåžƒåœ¾æ”¶é›†å™¨èƒ½å¤Ÿæ¸…æ¥šåœ°çŸ¥é“ä½•æ—¶æ¸…æ‰«è¿™ä¸‰å—åŒºåŸŸä¸­çš„å“ªäº›æ•°æ®ã€‚ ç„¶è€Œï¼Œå †å’Œæ–¹æ³•åŒºä¸­çš„å†…å­˜æ¸…ç†å·¥ä½œå°±æ²¡é‚£ä¹ˆå®¹æ˜“äº†ã€‚ å †å’Œæ–¹æ³•åŒºæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå¹¶ä¸”éƒ½åœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸€ç›´å¾—è¿è¡Œåˆ°JVMåœæ­¢æ—¶ã€‚å› æ­¤å®ƒä»¬æ²¡åŠžæ³•æ ¹æ®çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºã€çº¿ç¨‹çš„ç»“æŸè€Œé‡Šæ”¾ã€‚ å †ä¸­å­˜æ”¾JVMè¿è¡ŒæœŸé—´çš„æ‰€æœ‰å¯¹è±¡ï¼Œè™½ç„¶æ¯ä¸ªå¯¹è±¡çš„å†…å­˜å¤§å°åœ¨åŠ è½½è¯¥å¯¹è±¡æ‰€å±žç±»çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œä½†ç©¶ç«Ÿåˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡åªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šã€‚ æ–¹æ³•åŒºä¸­å­˜æ”¾ç±»ä¿¡æ¯ã€é™æ€æˆå‘˜å˜é‡ã€å¸¸é‡ã€‚ç±»çš„åŠ è½½æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦åˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡æ—¶æ‰ä¼šåŠ è½½è¿™ä¸ªç±»ã€‚å› æ­¤ï¼ŒJVMç©¶ç«Ÿè¦åŠ è½½å¤šå°‘ä¸ªç±»ä¹Ÿéœ€è¦åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç¡®å®šã€‚ å› æ­¤ï¼Œå †å’Œæ–¹æ³•åŒºçš„å†…å­˜å›žæ”¶å…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå› æ­¤åžƒåœ¾æ”¶é›†å™¨åœ¨å›žæ”¶å †å’Œæ–¹æ³•åŒºå†…å­˜çš„æ—¶å€™èŠ±äº†ä¸€äº›å¿ƒæ€ã€‚ å †å†…å­˜çš„å›žæ”¶ å¦‚ä½•åˆ¤å®šå“ªäº›å¯¹è±¡éœ€è¦å›žæ”¶ åœ¨å¯¹å †è¿›è¡Œå¯¹è±¡å›žæ”¶ä¹‹å‰ï¼Œé¦–å…ˆè¦åˆ¤æ–­å“ªäº›æ˜¯æ— æ•ˆå¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¯¹è±¡ä¸è¢«ä»»ä½•å¯¹è±¡æˆ–å˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±æ˜¯æ— æ•ˆå¯¹è±¡ï¼Œéœ€è¦è¢«å›žæ”¶ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§åˆ¤åˆ«æ–¹å¼ï¼š å¼•ç”¨è®¡æ•°æ³• æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è¿™ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªå˜é‡æˆ–å¦ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä¸€æ¬¡ï¼Œè¯¥è®¡æ•°å™¨åŠ ä¸€ï¼›è‹¥è¯¥å¼•ç”¨å¤±æ•ˆåˆ™è®¡æ•°å™¨å‡ä¸€ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œå°±è®¤ä¸ºè¯¥å¯¹è±¡æ˜¯æ— æ•ˆå¯¹è±¡ã€‚ å¼•ç”¨è®¡æ•°æ³•è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå®ƒæ— æ³•è§£å†³å¾ªçŽ¯å¼•ç”¨çš„é—®é¢˜ã€‚ï¼ˆæ¯”å¦‚å¯¹è±¡Aå¼•ç”¨å¯¹è±¡Bï¼ŒåŒæ—¶ï¼Œå¯¹è±¡Bä¹Ÿå¼•ç”¨å¯¹è±¡Aï¼Œé€ æˆå¾ªçŽ¯å¼•ç”¨ï¼‰ å¯è¾¾æ€§åˆ†æžæ³• æ‰€æœ‰å’ŒGC Rootsç›´æŽ¥æˆ–é—´æŽ¥å…³è”çš„å¯¹è±¡éƒ½æ˜¯æœ‰æ•ˆå¯¹è±¡ï¼Œå’ŒGC Rootsæ²¡æœ‰å…³è”çš„å¯¹è±¡å°±æ˜¯æ— æ•ˆå¯¹è±¡ã€‚ GC Rootsæ˜¯æŒ‡ï¼š Javaè™šæ‹Ÿæœºæ ˆæ‰€å¼•ç”¨çš„å¯¹è±¡(æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨ç±»åž‹çš„å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡) æ–¹æ³•åŒºä¸­é™æ€å±žæ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆæ‰€å¼•ç”¨çš„å¯¹è±¡ &lt;font color=&quot;red&quot;&gt; æ³¨æ„ï¼šGC Rootså¹¶ä¸åŒ…æ‹¬å †ä¸­å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼è¿™æ ·å°±ä¸ä¼šå‡ºçŽ°å¾ªçŽ¯å¼•ç”¨ã€‚ &lt;/font&gt; å›žæ”¶æ— æ•ˆå¯¹è±¡çš„è¿‡ç¨‹ å½“JVMç­›é€‰å‡ºå¤±æ•ˆçš„å¯¹è±¡ä¹‹åŽï¼Œå¹¶ä¸æ˜¯ç«‹å³æ¸…é™¤ï¼Œè€Œæ˜¯å†ç»™å¯¹è±¡ä¸€æ¬¡é‡ç”Ÿçš„æœºä¼šï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦è¦†ç›–äº†finalize()æ–¹æ³• è‹¥å·²è¦†ç›–è¯¥æ–¹æ³•ï¼Œå¹¶è¯¥å¯¹è±¡çš„finalize()æ–¹æ³•è¿˜æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆå°±ä¼šå°†finalize()æ‰”åˆ°F-Queueé˜Ÿåˆ—ä¸­ï¼› è‹¥æœªè¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™ç›´æŽ¥é‡Šæ”¾å¯¹è±¡å†…å­˜ã€‚ æ‰§è¡ŒF-Queueé˜Ÿåˆ—ä¸­çš„finalize()æ–¹æ³• è™šæ‹Ÿæœºä¼šä»¥è¾ƒä½Žçš„ä¼˜å…ˆçº§æ‰§è¡Œè¿™äº›finalize()æ–¹æ³•ä»¬ï¼Œä¹Ÿä¸ä¼šç¡®ä¿æ‰€æœ‰çš„finalize()æ–¹æ³•éƒ½ä¼šæ‰§è¡Œç»“æŸã€‚å¦‚æžœfinalize()æ–¹æ³•ä¸­å‡ºçŽ°è€—æ—¶æ“ä½œï¼Œè™šæ‹Ÿæœºå°±ç›´æŽ¥åœæ­¢æ‰§è¡Œï¼Œå°†è¯¥å¯¹è±¡æ¸…é™¤ã€‚ å¯¹è±¡é‡ç”Ÿæˆ–æ­»äº¡ å¦‚æžœåœ¨æ‰§è¡Œfinalize()æ–¹æ³•æ—¶ï¼Œå°†thisèµ‹ç»™äº†æŸä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±é‡ç”Ÿäº†ã€‚å¦‚æžœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«åžƒåœ¾æ”¶é›†å™¨æ¸…é™¤ã€‚ &lt;font color=&quot;red&quot;&gt; æ³¨æ„ï¼š å¼ºçƒˆä¸å»ºè®®ä½¿ç”¨finalize()å‡½æ•°è¿›è¡Œä»»ä½•æ“ä½œï¼å¦‚æžœéœ€è¦é‡Šæ”¾èµ„æºï¼Œè¯·ä½¿ç”¨try-finallyã€‚ å› ä¸ºfinalize()ä¸ç¡®å®šæ€§å¤§ï¼Œå¼€é”€å¤§ï¼Œæ— æ³•ä¿è¯é¡ºåˆ©æ‰§è¡Œã€‚ &lt;/font&gt; æ–¹æ³•åŒºçš„å†…å­˜å›žæ”¶ å¦‚æžœä½¿ç”¨å¤åˆ¶ç®—æ³•å®žçŽ°å †çš„å†…å­˜å›žæ”¶ï¼Œå †å°±ä¼šè¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡â€œæœç”Ÿå¤•æ­»â€ï¼Œæ¯æ¬¡åžƒåœ¾å›žæ”¶éƒ½ä¼šæ¸…é™¤æŽ‰å¤§é‡çš„å¯¹è±¡ï¼›è€Œè€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½è¾ƒé•¿ï¼Œæ¯æ¬¡åžƒåœ¾å›žæ”¶åªæœ‰å°‘é‡çš„å¯¹è±¡è¢«æ¸…é™¤æŽ‰ã€‚ ç”±äºŽæ–¹æ³•åŒºä¸­å­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå› æ­¤æ–¹æ³•åŒºå°±åƒæ˜¯å †çš„è€å¹´ä»£ï¼Œæ¯æ¬¡åžƒåœ¾æ”¶é›†çš„åªæœ‰å°‘é‡çš„åžƒåœ¾è¢«æ¸…é™¤æŽ‰ã€‚ æ–¹æ³•åŒºä¸­ä¸»è¦æ¸…é™¤ä¸¤ç§åžƒåœ¾ï¼š åºŸå¼ƒå¸¸é‡ åºŸå¼ƒçš„ç±» å¦‚ä½•æ¸…é™¤åºŸå¼ƒå¸¸é‡ æ¸…é™¤åºŸå¼ƒçš„å¸¸é‡å’Œæ¸…é™¤å¯¹è±¡ç±»ä¼¼ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡ä¸è¢«ä»»ä½•å˜é‡æˆ–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™äº›å¸¸é‡å°±ä¼šè¢«æ¸…é™¤æŽ‰ã€‚ å¦‚ä½•æ¸…é™¤åºŸå¼ƒçš„ç±» æ¸…é™¤åºŸå¼ƒç±»çš„æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼š è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å·²è¢«æ¸…é™¤ è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å¯¹è±¡æˆ–å˜é‡å¼•ç”¨ åªè¦ä¸€ä¸ªç±»è¢«è™šæ‹ŸæœºåŠ è½½è¿›æ–¹æ³•åŒºï¼Œé‚£ä¹ˆåœ¨å †ä¸­å°±ä¼šæœ‰ä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„å¯¹è±¡ï¼šjava.lang.Classã€‚è¿™ä¸ªå¯¹è±¡åœ¨ç±»è¢«åŠ è½½è¿›æ–¹æ³•åŒºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨æ–¹æ³•åŒºä¸­è¯¥ç±»è¢«åˆ é™¤æ—¶æ¸…é™¤ã€‚ åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›žæ”¶ åžƒåœ¾æ”¶é›†ç®—æ³• æ ‡è®°-æ¸…é™¤ç®—æ³• é¦–å…ˆåˆ©ç”¨åˆšæ‰ä»‹ç»çš„æ–¹æ³•åˆ¤æ–­éœ€è¦æ¸…é™¤å“ªäº›æ•°æ®ï¼Œå¹¶ç»™å®ƒä»¬åšä¸Šæ ‡è®°ï¼›ç„¶åŽæ¸…é™¤è¢«æ ‡è®°çš„æ•°æ®ã€‚ è¿™ç§ç®—æ³•æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆçŽ‡éƒ½å¾ˆä½Žï¼Œè€Œä¸”æ¸…é™¤å®ŒåŽå­˜åœ¨å¤§é‡ç¢Žç‰‡ç©ºé—´ï¼Œå¯¼è‡´æ— æ³•å­˜å‚¨å¤§å¯¹è±¡ï¼Œé™ä½Žäº†ç©ºé—´åˆ©ç”¨çŽ‡ã€‚ å¤åˆ¶ç®—æ³• å°†å†…å­˜åˆ†æˆä¸¤ä»½ï¼Œåªå°†æ•°æ®å­˜å‚¨åœ¨å…¶ä¸­ä¸€å—ä¸Šã€‚å½“éœ€è¦å›žæ”¶åžƒåœ¾æ—¶ï¼Œä¹Ÿæ˜¯é¦–å…ˆæ ‡è®°å‡ºåºŸå¼ƒçš„æ•°æ®ï¼Œç„¶åŽå°†æœ‰ç”¨çš„æ•°æ®å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ä¸Šï¼Œæœ€åŽå°†ç¬¬ä¸€å—å†…å­˜å…¨éƒ¨æ¸…é™¤ã€‚ &lt;span id=&quot;inline-blue&quot;&gt; åˆ†æžï¼š&lt;/span&gt; è¿™ç§ç®—æ³•é¿å…äº†ç¢Žç‰‡ç©ºé—´ï¼Œä½†å†…å­˜è¢«ç¼©å°äº†ä¸€åŠã€‚è€Œä¸”æ¯æ¬¡éƒ½éœ€è¦å°†æœ‰ç”¨çš„æ•°æ®å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€ç‰‡å†…å­˜ä¸ŠåŽ»ï¼Œæ•ˆçŽ‡ä¸é«˜ã€‚ &lt;span id=&quot;inline-purple&quot;&gt; è§£å†³ç©ºé—´åˆ©ç”¨çŽ‡é—®é¢˜ï¼š&lt;/span&gt; åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œç”±äºŽå¤§é‡çš„å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡åžƒåœ¾æ”¶é›†åŽåªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤å¯ä»¥å°†å†…å­˜åˆ’åˆ†æˆä¸‰å—ï¼šEdenã€Survior1ã€Survior2ï¼Œå†…å­˜å¤§å°åˆ†åˆ«æ˜¯8:1:1ã€‚åˆ†é…å†…å­˜æ—¶ï¼Œåªä½¿ç”¨Edenå’Œä¸€å—Survior1ã€‚å½“å‘çŽ°Eden+Survior1çš„å†…å­˜å³å°†æ»¡æ—¶ï¼ŒJVMä¼šå‘èµ·ä¸€æ¬¡MinorGCï¼Œæ¸…é™¤æŽ‰åºŸå¼ƒçš„å¯¹è±¡ï¼Œå¹¶å°†æ‰€æœ‰å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—Survior2ä¸­ã€‚é‚£ä¹ˆï¼ŒæŽ¥ä¸‹æ¥å°±ä½¿ç”¨Survior2+Edenè¿›è¡Œå†…å­˜åˆ†é…ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªéœ€è¦æµªè´¹10%çš„å†…å­˜ç©ºé—´å³å¯å®žçŽ°å¸¦æœ‰åŽ‹ç¼©åŠŸèƒ½çš„åžƒåœ¾æ”¶é›†æ–¹æ³•ï¼Œé¿å…äº†å†…å­˜ç¢Žç‰‡çš„é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¦ç”³è¯·å†…å­˜ç©ºé—´æ—¶ï¼Œå‘çŽ°Eden+Surviorä¸­å‰©ä¸‹çš„ç©ºé—´æ— æ³•æ”¾ç½®è¯¥å¯¹è±¡ï¼Œæ­¤æ—¶éœ€è¦è¿›è¡ŒMinor GCï¼Œå¦‚æžœMinorGCè¿‡åŽç©ºé—²å‡ºæ¥çš„å†…å­˜ç©ºé—´ä»ç„¶æ— æ³•æ”¾ç½®è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦å°†å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œè¿™ç§æ–¹å¼å«åšâ€œåˆ†é…æ‹…ä¿â€ã€‚ &lt;span id=&quot;inline-green&quot;&gt; â€œåˆ†é…æ‹…ä¿â€ç­–ç•¥è¯¦è§£ &lt;/span&gt; å½“åžƒåœ¾æ”¶é›†å™¨å‡†å¤‡è¦åœ¨æ–°ç”Ÿä»£å‘èµ·ä¸€æ¬¡MinorGCæ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥â€œè€å¹´ä»£ä¸­æœ€å¤§çš„è¿žç»­ç©ºé—²åŒºåŸŸçš„å¤§å° æ˜¯å¦å¤§äºŽ æ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡çš„å¤§å°ï¼Ÿâ€ï¼Œä¹Ÿå°±æ˜¯è€å¹´ä»£ä¸­ç›®å‰èƒ½å¤Ÿå°†æ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡å…¨éƒ¨è£…ä¸‹ï¼Ÿ è‹¥è€å¹´ä»£èƒ½å¤Ÿè£…ä¸‹æ–°ç”Ÿä»£ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿›è¡ŒMinorGCæ²¡æœ‰ä»»ä½•é£Žé™©ï¼Œç„¶åŽå°±è¿›è¡ŒMinorGCã€‚ è‹¥è€å¹´ä»£æ— æ³•è£…ä¸‹æ–°ç”Ÿä»£ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿›è¡ŒMinorGCæ˜¯æœ‰é£Žé™©çš„ï¼Œåžƒåœ¾æ”¶é›†å™¨ä¼šè¿›è¡Œä¸€æ¬¡é¢„æµ‹ï¼šæ ¹æ®ä»¥å¾€MinorGCè¿‡åŽå­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°æ¥é¢„æµ‹è¿™æ¬¡MinorGCåŽå­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°ã€‚ å¦‚æžœä»¥å¾€å­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°å°äºŽå½“å‰è€å¹´ä»£æœ€å¤§çš„è¿žç»­ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒMinorGCï¼Œè™½ç„¶æ­¤æ¬¡MinorGCæ˜¯æœ‰é£Žé™©çš„ã€‚ å¦‚æžœä»¥å¾€å­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°å¤§äºŽå½“å‰è€å¹´ä»£æœ€å¤§çš„è¿žç»­ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆå°±å¯¹è€å¹´ä»£è¿›è¡Œä¸€æ¬¡Full GCï¼Œé€šè¿‡æ¸…é™¤è€å¹´ä»£ä¸­åºŸå¼ƒæ•°æ®æ¥æ‰©å¤§è€å¹´ä»£ç©ºé—²ç©ºé—´ï¼Œä»¥ä¾¿ç»™æ–°ç”Ÿä»£ä½œæ‹…ä¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ†é…æ‹…ä¿ã€‚ æ ‡è®°-æ•´ç†ç®—æ³• åœ¨å›žæ”¶åžƒåœ¾å‰ï¼Œé¦–å…ˆå°†æ‰€æœ‰åºŸå¼ƒçš„å¯¹è±¡åšä¸Šæ ‡è®°ï¼Œç„¶åŽå°†æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ç§»åˆ°ä¸€è¾¹ï¼Œæœ€åŽæ¸…ç©ºå¦ä¸€è¾¹åŒºåŸŸå³å¯ã€‚ &lt;span id=&quot;inline-blue&quot;&gt; åˆ†æžï¼š&lt;/span&gt; å®ƒæ˜¯ä¸€ç§è€å¹´ä»£çš„åžƒåœ¾æ”¶é›†ç®—æ³•ã€‚è€å¹´ä»£ä¸­çš„å¯¹è±¡ä¸€èˆ¬å¯¿å‘½æ¯”è¾ƒé•¿ï¼Œå› æ­¤æ¯æ¬¡åžƒåœ¾å›žæ”¶ä¼šæœ‰å¤§é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤å¦‚æžœé€‰ç”¨â€œå¤åˆ¶â€ç®—æ³•ï¼Œæ¯æ¬¡éœ€è¦å¤åˆ¶å¤§é‡å­˜æ´»çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´æ•ˆçŽ‡å¾ˆä½Žã€‚è€Œä¸”ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•ï¼Œå½“Eden+Surviorä¸­éƒ½è£…ä¸ä¸‹æŸä¸ªå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è€å¹´ä»£çš„å†…å­˜è¿›è¡Œâ€œåˆ†é…æ‹…ä¿â€ï¼Œè€Œå¦‚æžœåœ¨è€å¹´ä»£ä½¿ç”¨è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆåœ¨è€å¹´ä»£ä¸­å¦‚æžœå‡ºçŽ°Eden+Surviorè£…ä¸ä¸‹æŸä¸ªå¯¹è±¡æ—¶ï¼Œæ²¡æœ‰å…¶ä»–åŒºåŸŸç»™ä»–ä½œåˆ†é…æ‹…ä¿ã€‚å› æ­¤ï¼Œè€å¹´ä»£ä¸­ä¸€èˆ¬ä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚ åˆ†ä»£æ”¶é›†ç®—æ³• å°†å†…å­˜åˆ’åˆ†ä¸ºè€å¹´ä»£å’Œæ–°ç”Ÿä»£ã€‚è€å¹´ä»£ä¸­å­˜æ”¾å¯¿å‘½è¾ƒé•¿çš„å¯¹è±¡ï¼Œæ–°ç”Ÿä»£ä¸­å­˜æ”¾â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡ã€‚ç„¶åŽåœ¨ä¸åŒçš„åŒºåŸŸä½¿ç”¨ä¸åŒçš„åžƒåœ¾æ”¶é›†ç®—æ³•ã€‚ åžƒåœ¾å›žæ”¶æµç¨‹ å¯¹äºŽæ•´ä¸ªGCæµç¨‹é‡Œï¼Œæœ€éœ€è¦å¤„ç†çš„å°±æ˜¯å¹´è½»ä»£å’Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†æ“ä½œï¼Œè€Œå…ƒç©ºé—´ï¼ˆæ°¸ä¹…ä»£ï¼‰éƒ½ä¸åœ¨GCèŒƒå›´å†…ï¼› å½“çŽ°åœ¨æœ‰ä¸€ä¸ªæ–°çš„å¯¹è±¡äº§ç”Ÿï¼Œé‚£ä¹ˆå¯¹è±¡ä¸€å®šéœ€è¦å†…å­˜ç©ºé—´ï¼ŒäºŽæ˜¯çŽ°åœ¨å°±éœ€è¦ä¸ºè¯¥å¯¹è±¡è¿›è¡Œå†…å­˜ç©ºé—´çš„ç”³è¯·ã€‚ é¦–å…ˆä¼šåˆ¤æ–­ä¼Šç”¸å›­åŒºæ˜¯å¦æœ‰å†…å­˜ç©ºé—´ï¼Œå¦‚æžœæ­¤æ—¶æœ‰å†…å­˜ç©ºé—´ï¼Œåˆ™å°†æ–°å¯¹è±¡ä¿å­˜åœ¨ä¼Šç”¸å›­åŒºï¼› ä½†å¦‚æžœä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸€ä¸ª Minor GC æ“ä½œï¼Œå°†ä¼Šç”¸å›­åŒºæ— ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œå½“æ¸…ç†ä¹‹åŽä¼šç»§ç»­åˆ¤æ–­ä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Ÿå……è¶³åˆ™å°†æ–°çš„å¯¹è±¡è¿›è¡Œç©ºé—´åˆ†é…ï¼› å¦‚æžœæ‰§è¡Œäº† Minor GC ä¹‹åŽå‘çŽ°ä¼Šç”¸å›­åŒºçš„å†…å­˜ä¾ç„¶ä¸è¶³ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¼šè¿›è¡Œå­˜è´§åŒºåˆ¤æ–­ï¼Œå¦‚æžœå­˜æ´»åŒºæœ‰å‰©ä½™ç©ºé—´ï¼Œåˆ™å°†ä¼Šç”¸å›­åŒºçš„éƒ¨åˆ†å¯¹è±¡ä¿å­˜åœ¨å­˜æ´»åŒºï¼Œé‚£ä¹ˆéšåŽç»§ç»­åˆ¤æ–­ä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œå¦‚ä½•å†…å­˜å……è¶³ï¼Œåˆ™åœ¨ä¼Šç”¸å›­åŒºè¿›è¡Œç©ºé—´åˆ†é…ï¼› å¦‚æžœæ­¤æ—¶å­˜æ´»åŒºä¹Ÿå·²ç»æ²¡æœ‰å†…å­˜ç©ºé—´äº†ï¼Œåˆ™å¼€å§‹åˆ¤æ–­è€å¹´åŒºï¼Œå¦‚æžœæ­¤æ—¶è€å¹´åŒºçš„ç©ºé—´å……è¶³ï¼Œåˆ™å°†å­˜æ´»åŒºä¸­çš„æ´»è·ƒå¯¹è±¡ä¿å­˜åœ¨è€å¹´ä»£ï¼Œè€ŒåŽå­˜æ´»åŒºå°±ä¼šå­˜çŽ°æœ‰ç©ºä½™ç©ºé—´ï¼ŒéšåŽï¼Œä¼Šç”¸å›­åŒºå°†æ´»è·ƒå¯¹è±¡ä¿å­˜åœ¨å­˜æ´»åŒºä¹‹ä¸­ï¼Œè€ŒåŽåœ¨ä¼Šç”¸å›­åŒºé‡Œä¸ºæ–°å¯¹è±¡å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼› å¦‚æžœè¿™ä¸ªæ—¶å€™è€å¹´ä»£ä¹Ÿæ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°†äº§ç”Ÿ Major GC(Full GC)ï¼Œè¿›è¡Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†ï¼› å¦‚æžœè€å¹´ä»£æ‰§è¡Œäº† Full GC ä¹‹åŽï¼Œä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM()å¼‚å¸¸â€œOutOfMemoryErrorâ€ã€‚ Javaä¸­å¼•ç”¨çš„ç§ç±» Javaä¸­æ ¹æ®ç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­ï¼Œå°†å¼•ç”¨åˆ†ä¸º4ç±»ã€‚ å¼ºå¼•ç”¨ æˆ‘ä»¬å¹³æ—¶æ‰€ä½¿ç”¨çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ã€‚ A a = new A(); ä¹Ÿå°±æ˜¯é€šè¿‡å…³é”®å­—newåˆ›å»ºçš„å¯¹è±¡æ‰€å…³è”çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ã€‚ åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œè¯¥å¯¹è±¡æ°¸è¿œä¹Ÿä¸ä¼šè¢«å›žæ”¶ã€‚ è½¯å¼•ç”¨ åªæœ‰å½“å †å³å°†å‘ç”ŸOOMå¼‚å¸¸æ—¶ï¼ŒJVMæ‰ä¼šå›žæ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚ è½¯å¼•ç”¨é€šè¿‡SoftReferenceç±»å®žçŽ°ã€‚ è½¯å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”å¼ºå¼•ç”¨çŸ­ä¸€äº›ã€‚ å¼±å¼•ç”¨ åªè¦åžƒåœ¾æ”¶é›†å™¨è¿è¡Œï¼Œè½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡å°±ä¼šè¢«å›žæ”¶ã€‚ å¼±å¼•ç”¨é€šè¿‡WeakReferenceç±»å®žçŽ°ã€‚ å¼±å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”è½¯å¼•ç”¨çŸ­ã€‚ è™šå¼•ç”¨ è™šå¼•ç”¨ä¹Ÿå«å¹½çµå¼•ç”¨ï¼Œå®ƒå’Œæ²¡æœ‰å¼•ç”¨æ²¡æœ‰åŒºåˆ«ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨è®¿é—®å¯¹è±¡çš„ä»»ä½•å±žæ€§æˆ–å‡½æ•°ã€‚ ä¸€ä¸ªå¯¹è±¡å…³è”è™šå¼•ç”¨å”¯ä¸€çš„ä½œç”¨å°±æ˜¯åœ¨è¯¥å¯¹è±¡è¢«åžƒåœ¾æ”¶é›†å™¨å›žæ”¶ä¹‹å‰ä¼šå—åˆ°ä¸€æ¡ç³»ç»Ÿé€šçŸ¥ã€‚ è™šå¼•ç”¨é€šè¿‡PhantomReferenceç±»æ¥å®žçŽ°ã€‚ å¯¹è±¡å†…å­˜åˆ†é…ç­–ç•¥ Javaæ‰€æ‰¿è¯ºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›žæ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚ åœ¨Javaè™šæ‹Ÿæœºçš„äº”å—å†…å­˜ç©ºé—´ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå†…å­˜çš„åˆ†é…å’Œå›žæ”¶éƒ½å…·æœ‰ç¡®å®šæ€§ï¼Œä¸€èˆ¬åœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½ç¡®å®šéœ€è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œå¹¶ä¸”ç”±äºŽéƒ½æ˜¯çº¿ç¨‹ç§æœ‰ï¼Œå› æ­¤å®ƒä»¬çš„å†…å­˜ç©ºé—´éƒ½éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹çš„ç»“æŸè€Œå›žæ”¶ã€‚ä¹Ÿå°±æ˜¯è¿™ä¸‰ä¸ªåŒºåŸŸçš„å†…å­˜åˆ†é…å’Œå›žæ”¶éƒ½å…·æœ‰ç¡®å®šæ€§ï¼Œåžƒåœ¾å›žæ”¶å™¨ä¸éœ€è¦åœ¨è¿™é‡ŒèŠ±è´¹å¤ªå¤§çš„ç²¾åŠ›ã€‚ è€ŒJavaè™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºå› ä¸ºæ˜¯ç”¨æ¥å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œè¿™äº›æ•°æ®çš„å˜åŠ¨æ€§è¾ƒå°ï¼Œå› æ­¤ä¸æ˜¯Javaå†…å­˜ç®¡ç†é‡ç‚¹éœ€è¦å…³æ³¨çš„åŒºåŸŸã€‚ è€Œå¯¹äºŽå †ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½éœ€è¦åœ¨å †ä¸­åˆ›å»ºå’Œå›žæ”¶ã€‚è™½ç„¶æ¯ä¸ªå¯¹è±¡çš„å¤§å°åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±èƒ½ç¡®å®šï¼Œä½†å¯¹è±¡çš„æ•°é‡åªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šï¼Œå› æ­¤å †ä¸­å†…å­˜çš„åˆ†é…å…·æœ‰è¾ƒå¤§çš„ä¸ç¡®å®šæ€§ã€‚æ­¤å¤–ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿çŸ­ä¸ä¸€ï¼Œå› æ­¤éœ€è¦é’ˆå¯¹ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡é‡‡ç”¨ä¸åŒçš„å†…å­˜å›žæ”¶ç®—æ³•ï¼Œå¢žåŠ äº†å†…å­˜å›žæ”¶çš„å¤æ‚æ€§ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼šJavaè‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯å †å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸Žå›žæ”¶ã€‚ å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºä¸­åˆ†é… ç›®å‰ä¸»æµçš„åžƒåœ¾æ”¶é›†å™¨éƒ½ä¼šé‡‡ç”¨åˆ†ä»£å›žæ”¶ç®—æ³•ï¼Œå› æ­¤éœ€è¦å°†å †å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ åœ¨æ–°ç”Ÿä»£ä¸­ä¸ºäº†é˜²æ­¢å†…å­˜ç¢Žç‰‡é—®é¢˜ï¼Œå› æ­¤åžƒåœ¾æ”¶é›†å™¨ä¸€èˆ¬éƒ½é€‰ç”¨â€œå¤åˆ¶â€ç®—æ³•ã€‚å› æ­¤ï¼Œå †å†…å­˜çš„æ–°ç”Ÿä»£è¢«è¿›ä¸€æ­¥åˆ†ä¸ºï¼šEdenåŒºï¼‹Survior1åŒºï¼‹Survior2åŒºã€‚ æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šåœ¨EdenåŒºä¸­åˆ†é…ã€‚ è‹¥EdenåŒºå·²æ»¡ï¼Œåˆ™åœ¨Survior1åŒºä¸­åˆ†é…ã€‚ è‹¥EdenåŒºï¼‹Survior1åŒºå‰©ä½™å†…å­˜å¤ªå°‘ï¼Œå¯¼è‡´å¯¹è±¡æ— æ³•æ”¾å…¥è¯¥åŒºåŸŸæ—¶ï¼Œå°±ä¼šå¯ç”¨â€œåˆ†é…æ‹…ä¿â€ï¼Œå°†å½“å‰EdenåŒºï¼‹Survior1åŒºä¸­çš„å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œç„¶åŽå†å°†æ–°å¯¹è±¡å­˜å…¥EdenåŒºã€‚ å¤§å¯¹è±¡ç›´æŽ¥è¿›å…¥è€å¹´ä»£ æ‰€è°“â€œå¤§å¯¹è±¡â€å°±æ˜¯æŒ‡ä¸€ä¸ªå ç”¨å¤§é‡è¿žç»­å­˜å‚¨ç©ºé—´çš„å¯¹è±¡ï¼Œå¦‚æ•°ç»„ã€‚ å½“å‘çŽ°ä¸€ä¸ªå¤§å¯¹è±¡åœ¨EdenåŒºï¼‹Survior1åŒºä¸­å­˜ä¸ä¸‹çš„æ—¶å€™å°±éœ€è¦åˆ†é…æ‹…ä¿æœºåˆ¶æŠŠå½“å‰EdenåŒºï¼‹Survior1åŒºçš„æ‰€æœ‰å¯¹è±¡éƒ½å¤åˆ¶åˆ°è€å¹´ä»£ä¸­åŽ»ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¤§å¯¹è±¡èƒ½å¤Ÿå­˜å…¥EdenåŒºï¼‹Survior1åŒºçš„æ¦‚çŽ‡æ¯”è¾ƒå°ï¼Œå‘ç”Ÿåˆ†é…æ‹…ä¿çš„æ¦‚çŽ‡æ¯”è¾ƒå¤§ï¼Œè€Œåˆ†é…æ‹…ä¿éœ€è¦æ¶‰åŠåˆ°å¤§é‡çš„å¤åˆ¶ï¼Œå°±ä¼šé€ æˆæ•ˆçŽ‡ä½Žä¸‹ã€‚ å› æ­¤ï¼Œå¯¹äºŽå¤§å¯¹è±¡æˆ‘ä»¬ç›´æŽ¥æŠŠä»–æ”¾åˆ°è€å¹´ä»£ä¸­åŽ»ï¼Œä»Žè€Œå°±èƒ½é¿å…å¤§é‡çš„å¤åˆ¶æ“ä½œã€‚ é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„å¯¹è±¡æ‰æ˜¯â€œå¤§å¯¹è±¡â€å‘¢ï¼Ÿ é€šè¿‡-XX:PretrnureSizeThresholdå‚æ•°è®¾ç½®å¤§å¯¹è±¡ è¯¥å‚æ•°ç”¨äºŽè®¾ç½®å¤§å°è¶…è¿‡è¯¥å‚æ•°çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯â€œå¤§å¯¹è±¡â€ï¼Œç›´æŽ¥è¿›å…¥è€å¹´ä»£ã€‚ æ³¨æ„ï¼šè¯¥å‚æ•°åªå¯¹Serialå’ŒParNewæ”¶é›†å™¨æœ‰æ•ˆ ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ è€å¹´ä»£ç”¨äºŽå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å¹´é¾„å‘¢ï¼Ÿ æ–°ç”Ÿä»£ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå½“æ–°ç”Ÿä»£å‘ç”Ÿä¸€æ¬¡MinorGCåŽï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡çš„å¹´é¾„å°±åŠ ä¸€ï¼Œå½“å¹´é¾„è¶…è¿‡ä¸€å®šå€¼æ—¶ï¼Œå°±å°†è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­åŽ»ã€‚ ä½¿ç”¨-XXMaxTenuringThresholdè®¾ç½®æ–°ç”Ÿä»£çš„æœ€å¤§å¹´é¾„,è®¾ç½®è¯¥å‚æ•°åŽï¼Œåªè¦è¶…è¿‡è¯¥å‚æ•°çš„æ–°ç”Ÿä»£å¯¹è±¡éƒ½ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­åŽ»ã€‚ ç›¸åŒå¹´é¾„çš„å¯¹è±¡å†…å­˜è¶…è¿‡Surviorå†…å­˜ä¸€åŠçš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ å¦‚æžœå½“å‰æ–°ç”Ÿä»£çš„Surviorä¸­ï¼Œå¹´é¾„ç›¸åŒçš„å¯¹è±¡çš„å†…å­˜ç©ºé—´æ€»å’Œè¶…è¿‡äº†Surviorå†…å­˜ç©ºé—´çš„ä¸€åŠï¼Œé‚£ä¹ˆæ‰€æœ‰å¹´é¾„ç›¸åŒçš„å¯¹è±¡å’Œè¶…è¿‡è¯¥å¹´é¾„çš„å¯¹è±¡éƒ½è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­åŽ»ã€‚æ— éœ€ç­‰åˆ°å¯¹è±¡çš„å¹´é¾„è¶…è¿‡MaxTenuringThresholdæ‰è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­åŽ»ã€‚ HotSpotåžƒåœ¾æ”¶é›†å™¨ &lt;font color=&quot;red&quot;&gt; è¯´æ˜Žï¼šå¦‚æžœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿žçº¿è¯´æ˜Žä»–ä»¬ä¹‹é—´å¯ä»¥æ­é…ä½¿ç”¨ã€‚ &lt;/font&gt; æ–°ç”Ÿä»£åžƒåœ¾æ”¶é›†å™¨ Serialåžƒåœ¾æ”¶é›†å™¨ å•çº¿ç¨‹ åªå¼€å¯ä¸€æ¡GCçº¿ç¨‹è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œå¹¶ä¸”åœ¨åžƒåœ¾å›žæ”¶è¿‡ç¨‹ä¸­åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œä»Žè€Œç”¨æˆ·çš„è¯·æ±‚æˆ–å›¾å½¢åŒ–ç•Œé¢ä¼šå‡ºçŽ°å¡é¡¿ã€‚ é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ ä¸€èˆ¬å®¢æˆ·ç«¯åº”ç”¨æ‰€éœ€å†…å­˜è¾ƒå°ï¼Œä¸ä¼šåˆ›å»ºå¤ªå¤šçš„å¯¹è±¡ï¼Œè€Œä¸”å †å†…å­˜ä¸å¤§ï¼Œå› æ­¤åžƒåœ¾å›žæ”¶æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå³ä½¿åœ¨è¿™æ®µæ—¶é—´åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿå—åˆ°æ˜Žæ˜¾çš„åœé¡¿ï¼Œå› æ­¤æœ¬åžƒåœ¾æ”¶é›†å™¨é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ã€‚ ç®€å•é«˜æ•ˆ ç”±äºŽSerialæ”¶é›†å™¨åªæœ‰ä¸€æ¡GCçº¿ç¨‹ï¼Œå› æ­¤é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä»Žè€Œç®€å•é«˜æ•ˆã€‚ é‡‡ç”¨â€œå¤åˆ¶â€ç®—æ³• ParNewåžƒåœ¾æ”¶é›†å™¨ ParNewæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ ParNewç”±å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œåœ°è¿›è¡Œåžƒåœ¾æ¸…ç†ã€‚ä½†æ¸…ç†è¿‡ç¨‹ä»ç„¶éœ€è¦åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ã€‚ä½†ç”±äºŽæœ‰å¤šæ¡GCçº¿ç¨‹åŒæ—¶æ¸…ç†ï¼Œæ¸…ç†é€Ÿåº¦æ¯”Serialæœ‰ä¸€å®šçš„æå‡ã€‚ é€‚åˆå¤šCPUçš„æœåŠ¡å™¨çŽ¯å¢ƒ ç”±äºŽä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œå› æ­¤é€‚åˆCPUè¾ƒå¤šçš„æœåŠ¡å™¨çŽ¯å¢ƒã€‚ ä¸ŽSerialæ€§èƒ½å¯¹æ¯” ParNewå’ŒSerialå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä½¿ç”¨äº†å¤šçº¿ç¨‹è¿›è¡Œåžƒåœ¾å›žæ”¶ï¼Œåœ¨å¤šCPUçš„çŽ¯å¢ƒä¸‹æ€§èƒ½æ¯”Serialä¼šæœ‰ä¸€å®šç¨‹åº¦çš„æå‡ï¼›ä½†çº¿ç¨‹åˆ‡æ¢éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åœ¨å•CPUçŽ¯å¢ƒä¸­è¡¨çŽ°ä¸å¦‚Serialã€‚ é‡‡ç”¨â€œå¤åˆ¶â€ç®—æ³• è¿½æ±‚â€œé™ä½Žåœé¡¿æ—¶é—´â€ å’ŒSerialç›¸æ¯”ï¼ŒParNewä½¿ç”¨å¤šçº¿ç¨‹çš„ç›®çš„å°±æ˜¯ç¼©çŸ­åžƒåœ¾æ”¶é›†æ—¶é—´ï¼Œä»Žè€Œå‡å°‘ç”¨æˆ·çº¿ç¨‹è¢«åœé¡¿çš„æ—¶é—´ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; å¹¶è¡Œ(Parallel)ï¼šæŒ‡å¤šæ¡åžƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹å¤„äºŽç­‰å¾…çŠ¶æ€ã€‚ &lt;/p&gt; &lt;p id=&quot;div-border-left-red&quot;&gt; å¹¶å‘(Concurrent)ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹å’Œåžƒåœ¾å›žæ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œ(ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œæœ‰å¯èƒ½æ˜¯äº¤å‰æ‰§è¡Œ)ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨è¿è¡Œï¼Œè€Œåžƒåœ¾å›žæ”¶çº¿ç¨‹åœ¨å¦ä¸€ä¸ª CPU ä¸Šè¿è¡Œã€‚ &lt;/p&gt; Parallel Scavengeåžƒåœ¾æ”¶é›†å™¨ Parallel Scavengeå’ŒParNewä¸€æ ·éƒ½æ˜¯å¤šçº¿ç¨‹ã€æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œéƒ½ä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•è¿›è¡Œåžƒåœ¾å›žæ”¶ã€‚ä½†å®ƒä»¬æœ‰ä¸ªå·¨å¤§çš„ä¸åŒç‚¹ï¼šParNewæ”¶é›†å™¨è¿½æ±‚é™ä½Žç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œå› æ­¤é€‚åˆäº¤äº’å¼åº”ç”¨ï¼›è€ŒParallel Scavengeè¿½æ±‚CPUåžåé‡ï¼Œèƒ½å¤Ÿåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å®ŒæˆæŒ‡å®šä»»åŠ¡ï¼Œå› æ­¤é€‚åˆæ²¡æœ‰äº¤äº’çš„åŽå°è®¡ç®—ã€‚ ä»€ä¹ˆæ˜¯â€œåžåé‡â€ï¼Ÿ åžåé‡æ˜¯æŒ‡ç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´å CPUæ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚ CPUæ€»æ—¶é—´åŒ…æ‹¬ï¼šç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´ å’Œ GCçº¿ç¨‹è¿è¡Œçš„æ—¶é—´ã€‚ å› æ­¤ï¼Œåžåé‡è¶Šé«˜è¡¨ç¤ºç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´è¶Šé•¿ï¼Œä»Žè€Œç”¨æˆ·çº¿ç¨‹èƒ½å¤Ÿè¢«å¿«é€Ÿå¤„ç†å®Œã€‚ é™ä½Žåœé¡¿æ—¶é—´çš„ä¸¤ç§æ–¹å¼ åœ¨å¤šCPUçŽ¯å¢ƒä¸­ä½¿ç”¨å¤šæ¡GCçº¿ç¨‹ï¼Œä»Žè€Œåžƒåœ¾å›žæ”¶çš„æ—¶é—´å‡å°‘ï¼Œä»Žè€Œç”¨æˆ·çº¿ç¨‹åœé¡¿çš„æ—¶é—´ä¹Ÿå‡å°‘ï¼› å®žçŽ°GCçº¿ç¨‹ä¸Žç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ‰€è°“å¹¶å‘ï¼Œå°±æ˜¯ç”¨æˆ·çº¿ç¨‹ä¸ŽGCçº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œä»Žè€Œæ¯æ¬¡åœé¡¿çš„æ—¶é—´ä¼šå‡å°‘ï¼Œç”¨æˆ·æ„Ÿå—åˆ°çš„åœé¡¿æ„Ÿé™ä½Žï¼Œä½†çº¿ç¨‹ä¹‹é—´ä¸æ–­åˆ‡æ¢æ„å‘³ç€éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œä»Žè€Œåžƒåœ¾å›žæ”¶å’Œç”¨æˆ·çº¿ç¨‹çš„æ€»æ—¶é—´å°†ä¼šå»¶é•¿ã€‚ Parallel Scavengeæä¾›çš„å‚æ•° è®¾ç½®â€œåžåé‡â€ï¼šé€šè¿‡å‚æ•°-XX:GCTimeRadioè®¾ç½®åžƒåœ¾å›žæ”¶æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ è®¾ç½®â€œåœé¡¿æ—¶é—´â€ï¼šé€šè¿‡å‚æ•°-XX:MaxGCPauseMillisè®¾ç½®åžƒåœ¾å¤„ç†è¿‡ç¨‹æœ€ä¹…åœé¡¿æ—¶é—´ã€‚Parallel Scavengeä¼šæ ¹æ®è¿™ä¸ªå€¼çš„å¤§å°ç¡®å®šæ–°ç”Ÿä»£çš„å¤§å°ã€‚å¦‚æžœè¿™ä¸ªå€¼è¶Šå°ï¼Œæ–°ç”Ÿä»£å°±ä¼šè¶Šå°ï¼Œä»Žè€Œæ”¶é›†å™¨å°±èƒ½ä»¥è¾ƒçŸ­çš„æ—¶é—´è¿›è¡Œä¸€æ¬¡å›žæ”¶ã€‚ä½†æ–°ç”Ÿä»£å˜å°åŽï¼Œå›žæ”¶çš„é¢‘çŽ‡å°±ä¼šæé«˜ï¼Œå› æ­¤è¦åˆç†æŽ§åˆ¶è¿™ä¸ªå€¼ã€‚ å¯ç”¨è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼šé€šè¿‡å‘½ä»¤-XX:+UseAdaptiveSizePolicyå°±èƒ½å¼€å¯è‡ªé€‚åº”ç­–ç•¥ã€‚æˆ‘ä»¬åªè¦è®¾ç½®å¥½å †çš„å¤§å°å’ŒMaxGCPauseMillisæˆ–GCTimeRadioï¼Œæ”¶é›†å™¨ä¼šè‡ªåŠ¨è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°ã€Edenå’ŒSurviorçš„æ¯”ä¾‹ã€å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œä»¥æœ€å¤§ç¨‹åº¦ä¸ŠæŽ¥è¿‘æˆ‘ä»¬è®¾ç½®çš„MaxGCPauseMillisæˆ–GCTimeRadioã€‚ è€å¹´ä»£åžƒåœ¾æ”¶é›†å™¨ Serial Oldåžƒåœ¾æ”¶é›†å™¨ Serial Oldæ”¶é›†å™¨æ˜¯Serialçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒä»¬éƒ½æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä¹Ÿå°±æ˜¯åžƒåœ¾æ”¶é›†æ—¶åªå¯åŠ¨ä¸€æ¡GCçº¿ç¨‹ï¼Œå› æ­¤éƒ½é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ã€‚ å®ƒä»¬å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯Serial Oldå·¥ä½œåœ¨è€å¹´ä»£ï¼Œä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼›è€ŒSerialå·¥ä½œåœ¨æ–°ç”Ÿä»£ï¼Œä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•ã€‚ Parallel Oldåžƒåœ¾æ”¶é›†å™¨ Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¸€èˆ¬å®ƒä»¬æ­é…ä½¿ç”¨ï¼Œè¿½æ±‚CPUåžåé‡ã€‚ å®ƒä»¬åœ¨åžƒåœ¾æ”¶é›†æ—¶éƒ½æ˜¯ç”±å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ã€‚å› æ­¤ï¼Œç”±äºŽåœ¨åžƒåœ¾æ¸…ç†è¿‡ç¨‹ä¸­æ²¡æœ‰ä½¿åžƒåœ¾æ”¶é›†å’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬æ˜¯è¿½æ±‚åžåé‡çš„åžƒåœ¾æ”¶é›†å™¨ã€‚ CMSåžƒåœ¾æ”¶é›†å™¨ CMSæ”¶é›†å™¨æ˜¯ä¸€æ¬¾è¿½æ±‚åœé¡¿æ—¶é—´çš„è€å¹´ä»£æ”¶é›†å™¨ï¼Œå®ƒåœ¨åžƒåœ¾æ”¶é›†æ—¶ä½¿å¾—ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤åœ¨åžƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿå—åˆ°æ˜Žæ˜¾çš„å¡é¡¿ã€‚ä½†ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ä¹‹é—´ä¸åœåœ°åˆ‡æ¢ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åžƒåœ¾å›žæ”¶æ€»æ—¶é—´å°±ä¼šè¢«å»¶é•¿ã€‚ å›žæ”¶è¿‡ç¨‹ åˆå§‹æ ‡è®° åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œä»…ä½¿ç”¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹å¯¹æ‰€æœ‰ä¸ŽGC ROOTSç›´æŽ¥å…³è”çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚é€Ÿåº¦å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®° ä½¿ç”¨å¤šæ¡å¹¶å‘æ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶ä¸Žç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ­¤è¿‡ç¨‹è¿›è¡Œå¯è¾¾æ€§åˆ†æžï¼Œæ ‡è®°å‡ºæ‰€æœ‰åºŸå¼ƒçš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆæ…¢ã€‚ é‡æ–°æ ‡è®° åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡é‡æ–°æ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå°†åˆšæ‰å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­æ–°å‡ºçŽ°çš„åºŸå¼ƒå¯¹è±¡æ ‡è®°å‡ºæ¥ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¿è¡Œæ—¶é—´ä»‹äºŽåˆå§‹æ ‡è®°å’Œå¹¶å‘æ ‡è®°ä¹‹é—´ã€‚ å¹¶å‘æ¸…é™¤ åªä½¿ç”¨ä¸€æ¡å¹¶å‘æ¸…é™¤çº¿ç¨‹ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä»¬å¹¶å‘æ‰§è¡Œï¼Œæ¸…é™¤åˆšæ‰æ ‡è®°çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹éžå¸¸è€—æ—¶ã€‚ CMSçš„ç¼ºç‚¹ åžåé‡ä½Ž ç”±äºŽCMSåœ¨åžƒåœ¾æ”¶é›†è¿‡ç¨‹ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œä»Žè€Œçº¿ç¨‹åˆ‡æ¢ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå› æ­¤CPUåžåé‡å°±ä¸å¦‚åœ¨åžƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹çš„æ–¹å¼æ¥çš„é«˜ã€‚ æ— æ³•å¤„ç†æµ®åŠ¨åžƒåœ¾ï¼Œå¯¼è‡´é¢‘ç¹Full GC ç”±äºŽåžƒåœ¾æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çº¿ç¨‹ä»åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿåžƒåœ¾ï¼Œè¿™äº›åžƒåœ¾ç§°ä¸ºâ€œæµ®åŠ¨åžƒåœ¾â€ã€‚ å¦‚æžœCMSåœ¨åžƒåœ¾æ¸…ç†è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦åœ¨è€å¹´ä»£ä¸­åˆ†é…å†…å­˜æ—¶å‘çŽ°ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±éœ€è¦å†æ¬¡å‘èµ·Full GCï¼Œè€Œæ­¤æ—¶CMSæ­£åœ¨è¿›è¡Œæ¸…é™¤å·¥ä½œï¼Œå› æ­¤æ­¤æ—¶åªèƒ½ç”±Serial Oldä¸´æ—¶å¯¹è€å¹´ä»£è¿›è¡Œä¸€æ¬¡Full GCã€‚ ä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•äº§ç”Ÿç¢Žç‰‡ç©ºé—´ ç”±äºŽCMSä½¿ç”¨äº†â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œ å› æ­¤æ¸…é™¤ä¹‹åŽä¼šäº§ç”Ÿå¤§é‡çš„ç¢Žç‰‡ç©ºé—´ï¼Œä¸åˆ©äºŽç©ºé—´åˆ©ç”¨çŽ‡ã€‚ä¸è¿‡CMSæä¾›äº†åº”å¯¹ç­–ç•¥ï¼š å¼€å¯-XX:+UseCMSCompactAtFullCollection å¼€å¯è¯¥å‚æ•°åŽï¼Œæ¯æ¬¡FullGCå®ŒæˆåŽéƒ½ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜åŽ‹ç¼©æ•´ç†ï¼Œå°†é›¶æ•£åœ¨å„å¤„çš„å¯¹è±¡æ•´ç†åˆ°ä¸€å—å„¿ã€‚ä½†æ¯æ¬¡éƒ½æ•´ç†æ•ˆçŽ‡ä¸é«˜ï¼Œå› æ­¤æä¾›äº†ä»¥ä¸‹å‚æ•°ã€‚ è®¾ç½®å‚æ•°-XX:CMSFullGCsBeforeCompaction æœ¬å‚æ•°å‘Šè¯‰CMSï¼Œç»è¿‡äº†Næ¬¡Full GCè¿‡åŽå†è¿›è¡Œä¸€æ¬¡å†…å­˜æ•´ç†ã€‚ é€šç”¨åžƒåœ¾æ”¶é›†å™¨--G1åžƒåœ¾æ”¶é›†å™¨ G1çš„ç‰¹ç‚¹ è¿½æ±‚åœé¡¿æ—¶é—´ å¤šçº¿ç¨‹GC é¢å‘æœåŠ¡ç«¯åº”ç”¨ æ ‡è®°-æ•´ç†å’Œå¤åˆ¶ç®—æ³•åˆå¹¶ä¸ä¼šäº§ç”Ÿç¢Žç‰‡å†…å­˜ã€‚ å¯å¯¹æ•´ä¸ªå †è¿›è¡Œåžƒåœ¾å›žæ”¶ å¯é¢„æµ‹åœé¡¿æ—¶é—´ G1çš„å†…å­˜æ¨¡åž‹ G1åžƒåœ¾æ”¶é›†å™¨æ²¡æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µäº†ï¼Œè€Œæ˜¯å°†å †åˆ’åˆ†ä¸ºä¸€å—å—ç‹¬ç«‹çš„Regionã€‚å½“è¦è¿›è¡Œåžƒåœ¾æ”¶é›†æ—¶ï¼Œé¦–å…ˆä¼°è®¡æ¯ä¸ªRegionä¸­çš„åžƒåœ¾æ•°é‡ï¼Œæ¯æ¬¡éƒ½ä»Žåžƒåœ¾å›žæ”¶ä»·å€¼æœ€å¤§çš„Regionå¼€å§‹å›žæ”¶ï¼Œå› æ­¤å¯ä»¥èŽ·å¾—æœ€å¤§çš„å›žæ”¶æ•ˆçŽ‡ã€‚ Remembered Set ä¸€ä¸ªå¯¹è±¡å’Œå®ƒå†…éƒ¨æ‰€å¼•ç”¨çš„å¯¹è±¡å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªRegionä¸­ï¼Œé‚£ä¹ˆå½“åžƒåœ¾å›žæ”¶æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªå †å†…å­˜æ‰èƒ½å®Œæ•´åœ°è¿›è¡Œä¸€æ¬¡å¯è¾¾æ€§åˆ†æžï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼Œæ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªRemembered Setï¼Œç”¨äºŽè®°å½•æœ¬åŒºåŸŸä¸­æ‰€æœ‰å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡æ‰€åœ¨çš„åŒºåŸŸï¼Œä»Žè€Œåœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†æžæ—¶ï¼Œåªè¦åœ¨GC ROOTsä¸­å†åŠ ä¸ŠRemembered Setå³å¯é˜²æ­¢å¯¹æ‰€æœ‰å †å†…å­˜çš„éåŽ†ã€‚ G1åžƒåœ¾æ”¶é›†è¿‡ç¨‹ åˆå§‹æ ‡è®° æ ‡è®°ä¸ŽGC ROOTSç›´æŽ¥å…³è”çš„å¯¹è±¡ï¼Œåœæ­¢æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œåªå¯åŠ¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®° è¿›è¡Œå…¨é¢çš„å¯è¾¾æ€§åˆ†æžï¼Œå¼€å¯ä¸€æ¡å¹¶å‘æ ‡è®°çº¿ç¨‹ä¸Žç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒé•¿ã€‚ æœ€ç»ˆæ ‡è®° æ ‡è®°å‡ºå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ç”¨æˆ·çº¿ç¨‹æ–°äº§ç”Ÿçš„åžƒåœ¾ã€‚åœæ­¢æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡æœ€ç»ˆæ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ ç­›é€‰å›žæ”¶ å›žæ”¶åºŸå¼ƒçš„å¯¹è±¡ã€‚æ­¤æ—¶ä¹Ÿéœ€è¦åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡ç­›é€‰å›žæ”¶çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ Classæ–‡ä»¶ç»“æž„ ä»€ä¹ˆæ˜¯JVMçš„â€œæ— å…³æ€§â€ Javaå…·æœ‰å¹³å°æ— å…³æ€§ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•æ“ä½œç³»ç»Ÿéƒ½èƒ½è¿è¡ŒJavaä»£ç ã€‚ä¹‹æ‰€ä»¥èƒ½å®žçŽ°è¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºJavaè¿è¡Œåœ¨è™šæ‹Ÿæœºä¹‹ä¸Šï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿéƒ½æ‹¥æœ‰å„è‡ªçš„Javaè™šæ‹Ÿæœºï¼Œå› æ­¤Javaèƒ½å®žçŽ°â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œâ€ã€‚ è€ŒJVMä¸ä»…å…·æœ‰å¹³å°æ— å…³æ€§ï¼Œè¿˜å…·æœ‰è¯­è¨€æ— å…³æ€§ã€‚ å¹³å°æ— å…³æ€§æ˜¯æŒ‡ä¸åŒæ“ä½œç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„JVMï¼Œè€Œè¯­è¨€æ— å…³æ€§æ˜¯æŒ‡Javaè™šæ‹Ÿæœºèƒ½è¿è¡Œé™¤Javaä»¥å¤–çš„ä»£ç ï¼ è¿™å¬èµ·æ¥éžå¸¸æƒŠäººï¼Œä½†JVMå¯¹èƒ½è¿è¡Œçš„è¯­è¨€æ˜¯æœ‰ä¸¥æ ¼è¦æ±‚çš„ã€‚é¦–å…ˆæ¥äº†è§£ä¸‹Javaä»£ç çš„è¿è¡Œè¿‡ç¨‹ã€‚ Javaæºä»£ç é¦–å…ˆéœ€è¦ä½¿ç”¨Javacç¼–è¯‘å™¨ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åŽå¯åŠ¨JVMæ‰§è¡Œclassæ–‡ä»¶ï¼Œä»Žè€Œç¨‹åºå¼€å§‹è¿è¡Œã€‚ ä¹Ÿå°±æ˜¯JVMåªè®¤è¯†classæ–‡ä»¶ï¼Œå®ƒå¹¶ä¸ç®¡ä½•ç§è¯­è¨€ç”Ÿæˆäº†classæ–‡ä»¶ï¼Œåªè¦classæ–‡ä»¶ç¬¦åˆJVMçš„è§„èŒƒå°±èƒ½è¿è¡Œã€‚ å› æ­¤ç›®å‰å·²ç»æœ‰Scalaã€JRubyã€Jythonç­‰è¯­è¨€èƒ½å¤Ÿåœ¨JVMä¸Šè¿è¡Œã€‚å®ƒä»¬æœ‰å„è‡ªçš„è¯­æ³•è§„åˆ™ï¼Œä¸è¿‡å®ƒä»¬çš„ç¼–è¯‘å™¨éƒ½èƒ½å°†å„è‡ªçš„æºç ç¼–è¯‘æˆç¬¦åˆJVMè§„èŒƒçš„classæ–‡ä»¶ï¼Œä»Žè€Œèƒ½å¤Ÿå€ŸåŠ©JVMè¿è¡Œå®ƒä»¬ã€‚ Classæ–‡ä»¶åŸºæœ¬ç»„ç»‡ç»“æž„ classæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹å…·æœ‰ä¸¥æ ¼çš„è§„èŒƒï¼Œæ–‡ä»¶ä¸­æ²¡æœ‰ä»»ä½•ç©ºæ ¼ï¼Œå…¨æ˜¯è¿žç»­çš„0/1ã€‚classæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹è¢«åˆ†ä¸ºä¸¤ç§ç±»åž‹ï¼šæ— ç¬¦å·æ•° å’Œ è¡¨ã€‚ æ— ç¬¦å·æ•° å®ƒè¡¨ç¤ºclassæ–‡ä»¶ä¸­çš„å€¼ï¼Œè¿™äº›å€¼æ²¡æœ‰ä»»ä½•ç±»åž‹ï¼Œä½†æœ‰ä¸åŒçš„é•¿åº¦ã€‚æ ¹æ®è¿™äº›å€¼é•¿åº¦çš„ä¸åŒåˆ†ä¸ºï¼šu1ã€u2ã€u4ã€u8ï¼Œåˆ†åˆ«ä»£è¡¨1å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€2å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€4å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€8å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€‚ è¡¨ classæ–‡ä»¶ä¸­æ‰€æœ‰æ•°æ®(å³æ— ç¬¦å·æ•°)è¦ä¹ˆå•ç‹¬å­˜åœ¨ï¼Œè¦ä¹ˆç”±å¤šä¸ªæ— ç¬¦å·æ•°ç»„æˆäºŒç»´è¡¨ã€‚å³classæ–‡ä»¶ä¸­çš„æ•°æ®è¦ä¹ˆæ˜¯å•ä¸ªå€¼ï¼Œè¦ä¹ˆæ˜¯äºŒç»´è¡¨ã€‚ é­”æ•°(magic) æ‰€æœ‰çš„ç”±Javaç¼–è¯‘å™¨ç¼–è¯‘è€Œæˆçš„classæ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚éƒ½æ˜¯â€œ0xCAFEBABEâ€ å®ƒçš„ä½œç”¨åœ¨äºŽï¼šå½“JVMåœ¨å°è¯•åŠ è½½æŸä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­æ¥çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ­¤classæ–‡ä»¶æœ‰æ²¡æœ‰JVMè®¤ä¸ºå¯ä»¥æŽ¥å—çš„â€œç­¾åâ€ï¼Œå³JVMä¼šé¦–å…ˆè¯»å–æ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­è¯¥4ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯â€œ0xCAFEBABEâ€ï¼Œå¦‚æžœæ˜¯ï¼Œåˆ™JVMä¼šè®¤ä¸ºå¯ä»¥å°†æ­¤æ–‡ä»¶å½“ä½œclassæ–‡ä»¶æ¥åŠ è½½å¹¶ä½¿ç”¨ã€‚ ç‰ˆæœ¬å·(minor_version,major_version) ç´§æŽ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚æ˜¯ç‰ˆæœ¬å·ã€‚å®ƒè¡¨ç¤ºæœ¬classä¸­ä½¿ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„JDKã€‚ ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·åœ¨classæ–‡ä»¶ä¸­å„å ä¸¤ä¸ªå­—èŠ‚ï¼Œå‰¯ç‰ˆæœ¬å·å ç”¨ç¬¬5ã€6ä¸¤ä¸ªå­—èŠ‚ï¼Œè€Œä¸»ç‰ˆæœ¬å·åˆ™å ç”¨ç¬¬7ï¼Œ8ä¸¤ä¸ªå­—èŠ‚ã€‚JDK1.0çš„ä¸»ç‰ˆæœ¬å·ä¸º45ï¼Œä»¥åŽçš„æ¯ä¸ªæ–°ä¸»ç‰ˆæœ¬éƒ½ä¼šåœ¨åŽŸå…ˆç‰ˆæœ¬çš„åŸºç¡€ä¸ŠåŠ 1ã€‚è‹¥çŽ°åœ¨ä½¿ç”¨çš„æ˜¯JDK1.7ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶ï¼Œåˆ™ç›¸åº”çš„ä¸»ç‰ˆæœ¬å·åº”è¯¥æ˜¯51,å¯¹åº”çš„7ï¼Œ8ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶çš„å€¼åº”è¯¥æ˜¯ 0x33ã€‚ ä¸€ä¸ª JVMå®žä¾‹åªèƒ½æ”¯æŒç‰¹å®šèŒƒå›´å†…çš„ä¸»ç‰ˆæœ¬å· ï¼ˆMi è‡³Mjï¼‰ å’Œ 0 è‡³ç‰¹å®šèŒƒå›´å†… ï¼ˆ0 è‡³ mï¼‰ çš„å‰¯ç‰ˆæœ¬å·ã€‚å‡è®¾ä¸€ä¸ª Class æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ä¸º Vï¼Œ ä»…å½“Mi.0 â‰¤ v â‰¤ Mj.mæˆç«‹æ—¶ï¼Œè¿™ä¸ª Class æ–‡ä»¶æ‰å¯ä»¥è¢«æ­¤ Java è™šæ‹Ÿæœºæ”¯æŒã€‚ä¸åŒç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºå®žçŽ°æ”¯æŒçš„ç‰ˆæœ¬å·ä¹Ÿä¸åŒï¼Œé«˜ç‰ˆæœ¬å·çš„ Java è™šæ‹Ÿæœºå®žçŽ°å¯ä»¥æ”¯æŒä½Žç‰ˆæœ¬å·çš„ Class æ–‡ä»¶ï¼Œåä¹‹åˆ™ä¸æˆç«‹ã€‚ JVMåœ¨åŠ è½½classæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šè¯»å–å‡ºä¸»ç‰ˆæœ¬å·ï¼Œç„¶åŽæ¯”è¾ƒè¿™ä¸ªclassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·å’ŒJVMæœ¬èº«çš„ç‰ˆæœ¬å·ï¼Œå¦‚æžœJVMæœ¬èº«çš„ç‰ˆæœ¬å· &lt; classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼ŒJVMä¼šè®¤ä¸ºåŠ è½½ä¸äº†è¿™ä¸ªclassæ–‡ä»¶ï¼Œä¼šæŠ›å‡ºæˆ‘ä»¬ç»å¸¸è§åˆ°çš„&quot;java.lang.UnsupportedClassVersionError: Bad version number in .class file &quot; Error é”™è¯¯ï¼›åä¹‹ï¼ŒJVMä¼šè®¤ä¸ºå¯ä»¥åŠ è½½æ­¤classæ–‡ä»¶ï¼Œç»§ç»­åŠ è½½æ­¤classæ–‡ä»¶ã€‚ å¸¸é‡æ± (constant_pool) ä»€ä¹ˆæ˜¯å¸¸é‡æ±  ç´§æŽ¥ç€ç‰ˆæœ¬å·ä¹‹åŽçš„å°±æ˜¯å¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å­˜æ”¾ä¸¤ç§ç±»åž‹çš„å¸¸é‡ï¼š å­—é¢å€¼å¸¸é‡ å­—é¢å€¼å¸¸é‡å³æˆ‘ä»¬åœ¨ç¨‹åºä¸­å®šä¹‰çš„å­—ç¬¦ä¸²ã€è¢«finalä¿®é¥°çš„å€¼ã€‚ ç¬¦å·å¼•ç”¨ ç¬¦å·å¼•ç”¨å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„å„ç§åå­—ï¼š ç±»å’ŒæŽ¥å£çš„å…¨é™å®šå å­—æ®µçš„åå­— å’Œ æè¿°ç¬¦ æ–¹æ³•çš„åå­— å’Œ æè¿°ç¬¦ å¸¸é‡æ± çš„ç‰¹ç‚¹ å¸¸é‡æ± é•¿åº¦ä¸å›ºå®š å¸¸é‡æ± çš„å¤§å°æ˜¯ä¸å›ºå®šçš„ï¼Œå› æ­¤å¸¸é‡æ± å¼€å¤´æ”¾ç½®ä¸€ä¸ªu2ç±»åž‹çš„æ— ç¬¦å·æ•°ï¼Œç”¨æ¥å­˜å‚¨å½“å‰å¸¸é‡æ± çš„å®¹é‡ã€‚JVMæ ¹æ®è¿™ä¸ªå€¼å°±çŸ¥é“å¸¸é‡æ± çš„å¤´å°¾æ¥ã€‚ æ³¨ï¼šè¿™ä¸ªå€¼æ˜¯ä»Ž1å¼€å§‹çš„ï¼Œè‹¥ä¸º5è¡¨ç¤ºæ± ä¸­æœ‰4ä¸ªå¸¸é‡ã€‚ å¸¸é‡æ± ä¸­çš„å¸¸é‡ç”±è€Œä¸ºè¡¨æ¥è¡¨ç¤º å¸¸é‡æ± å¼€å¤´æœ‰ä¸ªå¸¸é‡æ± å®¹é‡è®¡æ•°å™¨ï¼ŒæŽ¥ä¸‹æ¥å°±å…¨æ˜¯ä¸€ä¸ªä¸ªå¸¸é‡äº†ï¼Œåªä¸è¿‡å¸¸é‡éƒ½æ˜¯ç”±ä¸€å¼ å¼ äºŒç»´è¡¨æž„æˆï¼Œé™¤äº†è®°å½•å¸¸é‡çš„å€¼ä»¥å¤–ï¼Œè¿˜è®°å½•å½“å‰å¸¸é‡çš„ç›¸å…³ä¿¡æ¯ã€‚ å¸¸é‡æ± æ˜¯classæ–‡ä»¶çš„èµ„æºä»“åº“ å¸¸é‡æ± æ˜¯ä¸Žæœ¬classä¸­å…¶å®ƒéƒ¨åˆ†å…³è”æœ€å¤šçš„éƒ¨åˆ† å¸¸é‡æ± æ˜¯classæ–‡ä»¶ä¸­ç©ºé—´å ç”¨æœ€å¤§çš„éƒ¨åˆ†ä¹‹ä¸€ å¸¸é‡æ± ä¸­å¸¸é‡çš„ç±»åž‹ åˆšæ‰ä»‹ç»äº†ï¼Œå¸¸é‡æ± ä¸­çš„å¸¸é‡å¤§ä½“ä¸Šåˆ†ä¸ºï¼šå­—é¢å€¼å¸¸é‡ å’Œ ç¬¦å·å¼•ç”¨ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ ¹æ®å¸¸é‡çš„æ•°æ®ç±»åž‹ä¸åŒï¼Œåˆå¯ä»¥è¢«ç»†åˆ†ä¸º14ç§å¸¸é‡ç±»åž‹ã€‚è¿™14ç§å¸¸é‡ç±»åž‹éƒ½æœ‰å„è‡ªçš„äºŒç»´è¡¨ç¤ºç»“æž„ã€‚æ¯ç§å¸¸é‡ç±»åž‹çš„å¤´1ä¸ªå­—èŠ‚éƒ½æ˜¯tagï¼Œç”¨äºŽè¡¨ç¤ºå½“å‰å¸¸é‡å±žäºŽ14ç§ç±»åž‹ä¸­çš„å“ªä¸€ä¸ªã€‚ ä»¥CONSTANT_Class_infoå¸¸é‡ä¸ºä¾‹ï¼Œå®ƒçš„äºŒç»´è¡¨ç¤ºç»“æž„å¦‚ä¸‹ï¼š ç±»åž‹ åç§° æ•°é‡ u1 tag 1 u2 length 1 tagè¡¨ç¤ºå½“å‰å¸¸é‡çš„ç±»åž‹(å½“å‰å¸¸é‡ä¸ºCONSTANT_Class_infoï¼Œå› æ­¤tagçš„å€¼åº”ä¸º7ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»æˆ–æŽ¥å£çš„å…¨é™å®šå)ï¼› name_indexè¡¨ç¤ºè¿™ä¸ªç±»æˆ–æŽ¥å£å…¨é™å®šåçš„ä½ç½®ã€‚å®ƒçš„å€¼è¡¨ç¤ºæŒ‡å‘å¸¸é‡æ± çš„ç¬¬å‡ ä¸ªå¸¸é‡ã€‚å®ƒä¼šæŒ‡å‘ä¸€ä¸ªCONSTANT_Utf8_infoç±»åž‹çš„å¸¸é‡ï¼Œå®ƒçš„äºŒç»´è¡¨ç»“æž„å¦‚ä¸‹ï¼š ç±»åž‹ åç§° æ•°é‡ u1 tag 1 u2 length 1 u1 bytes length CONSTANT_Utf8_infoè¡¨ç¤ºå­—ç¬¦ä¸²å¸¸é‡ï¼› tagè¡¨ç¤ºå½“å‰å¸¸é‡çš„ç±»åž‹ï¼Œè¿™é‡Œåº”è¯¥æ˜¯1ï¼› lengthè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼› bytesä¸ºè¿™ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹(é‡‡ç”¨ç¼©ç•¥çš„UTF8ç¼–ç ) ä¸ºä»€ä¹ˆJavaä¸­å®šä¹‰çš„ç±»ã€å˜é‡åå­—å¿…é¡»å°äºŽ64K ç±»ã€æŽ¥å£ã€å˜é‡ç­‰åå­—éƒ½å±žäºŽç¬¦å·å¼•ç”¨ï¼Œå®ƒä»¬éƒ½å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚è€Œä¸ç®¡å“ªç§ç¬¦å·å¼•ç”¨ï¼Œå®ƒä»¬çš„åå­—éƒ½ç”±CONSTANT_Utf8_infoç±»åž‹çš„å¸¸é‡è¡¨ç¤ºï¼Œè¿™ç§ç±»åž‹çš„å¸¸é‡ä½¿ç”¨u2å­˜å‚¨å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ç”±äºŽ2å­—èŠ‚æœ€å¤šèƒ½è¡¨ç¤º65535ä¸ªæ•°ï¼Œå› æ­¤è¿™äº›åå­—çš„æœ€å¤§é•¿åº¦æœ€å¤šåªèƒ½æ˜¯64Kã€‚ è®¿é—®æ ‡å¿—(access_flags) åœ¨å¸¸é‡æ± ä¹‹åŽæ˜¯2å­—èŠ‚çš„è®¿é—®æ ‡å¿—ã€‚è®¿é—®æ ‡å¿—æ˜¯ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªclassæ–‡ä»¶æ˜¯ç±»è¿˜æ˜¯æŽ¥å£ã€æ˜¯å¦è¢«publicä¿®é¥°ã€æ˜¯å¦è¢«abstractä¿®é¥°ã€æ˜¯å¦è¢«finalä¿®é¥°ç­‰ã€‚ ç”±äºŽè¿™äº›æ ‡å¿—éƒ½ç”±æ˜¯/å¦è¡¨ç¤ºï¼Œå› æ­¤å¯ä»¥ç”¨0/1è¡¨ç¤ºã€‚ è®¿é—®æ ‡å¿—ä¸º2å­—èŠ‚ï¼Œå¯ä»¥è¡¨ç¤º16ä½æ ‡å¿—ï¼Œä½†JVMç›®å‰åªå®šä¹‰äº†8ç§ï¼Œæœªå®šä¹‰çš„ç›´æŽ¥å†™0. ç±»ç´¢å¼•(this_class) ç±»ç´¢å¼•ï¼Œthis_classçš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»åž‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æŽ¥å£ã€‚ çˆ¶ç±»ç´¢å¼•(super_class) çˆ¶ç±»ç´¢å¼•ï¼Œå¯¹äºŽç±»æ¥è¯´ï¼Œsuper_class çš„å€¼å¿…é¡»ä¸º 0 æˆ–è€…æ˜¯å¯¹constant_pool è¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¦‚æžœå®ƒçš„å€¼ä¸ä¸º 0ï¼Œé‚£ constant_pool è¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»åž‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»çš„ç›´æŽ¥çˆ¶ç±»ã€‚å½“å‰ç±»çš„ç›´æŽ¥çˆ¶ç±»ï¼Œä»¥åŠå®ƒæ‰€æœ‰é—´æŽ¥çˆ¶ç±»çš„access_flag ä¸­éƒ½ä¸èƒ½å¸¦æœ‰ACC_FINAL æ ‡è®°ã€‚å¯¹äºŽæŽ¥å£æ¥è¯´ï¼Œå®ƒçš„Classæ–‡ä»¶çš„super_classé¡¹çš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºä»£è¡¨ java.lang.Object çš„ CONSTANT_Class_info ç±»åž‹å¸¸é‡ ã€‚å¦‚æžœ Class æ–‡ä»¶çš„ super_classçš„å€¼ä¸º 0ï¼Œé‚£è¿™ä¸ªClassæ–‡ä»¶åªå¯èƒ½æ˜¯å®šä¹‰çš„æ˜¯java.lang.Objectç±»ï¼Œåªæœ‰å®ƒæ˜¯å”¯ä¸€æ²¡æœ‰çˆ¶ç±»çš„ç±»ã€‚ æŽ¥å£è®¡æ•°å™¨(interfaces_count) æŽ¥å£è®¡æ•°å™¨ï¼Œinterfaces_countçš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æŽ¥å£çš„ç›´æŽ¥çˆ¶æŽ¥å£æ•°é‡ã€‚ æŽ¥å£ä¿¡æ¯æ•°æ®åŒº(interfaces[interfaces_count]) æŽ¥å£è¡¨ï¼Œinterfaces[]æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ï¼Œ å®ƒçš„é•¿åº¦ä¸º interfaces_countã€‚æ¯ä¸ªæˆå‘˜ interfaces[i] å¿…é¡»ä¸º CONSTANT_Class_infoç±»åž‹å¸¸é‡ï¼Œå…¶ä¸­ 0 â‰¤ i &lt;interfaces_countã€‚åœ¨interfaces[]æ•°ç»„ä¸­ï¼Œæˆå‘˜æ‰€è¡¨ç¤ºçš„æŽ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æŽ¥å£é¡ºåºï¼ˆä»Žå·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æŽ¥å£ã€‚ å­—æ®µè¡¨çš„é›†åˆ ä»€ä¹ˆæ˜¯å­—æ®µè¡¨é›†åˆ å­—æ®µè¡¨é›†åˆç”¨äºŽå­˜å‚¨æœ¬ç±»æ‰€æ¶‰åŠåˆ°çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å®žä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€‚ æ¯ä¸€ä¸ªå­—æ®µè¡¨åªè¡¨ç¤ºä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œæœ¬ç±»ä¸­æ‰€æœ‰çš„æˆå‘˜å˜é‡æž„æˆäº†å­—æ®µè¡¨é›†åˆã€‚ æè¿°ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯åŒ…æ‹¬ï¼šå­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublicã€protectedã€privateï¼‰ã€å®žä¾‹å˜é‡ä¸Žå¦ï¼ˆstaticï¼‰ã€å¯å˜æ€§ï¼ˆfinalï¼‰ã€å¹¶å‘å¯è§æ€§ï¼ˆvolatileï¼‰ã€å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransientï¼‰ã€å­—æ®µæ•°æ®ç±»åž‹ï¼ˆåŸºæœ¬æ•°æ®ç±»åž‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰ã€å­—æ®µåç§°ã€‚è€Œå­—æ®µå«ä»€ä¹ˆåå­—ï¼Œå­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»åž‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚ å­—æ®µè¡¨ç»“æž„çš„å®šä¹‰ ç±»åž‹ åç§° æ•°é‡ u2 access_flags 1 u2 name_index 1 u2 descriptor_index 1 u2 attributes_count 1 attribute_info attributes attributes_count access_flags å­—æ®µçš„è®¿é—®æ ‡å¿—ã€‚åœ¨Javaä¸­ï¼Œæ¯ä¸ªæˆå‘˜å˜é‡éƒ½æœ‰ä¸€ç³»åˆ—çš„ä¿®é¥°ç¬¦ï¼Œå’Œä¸Šè¿°classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ä½œç”¨ä¸€æ ·ï¼Œåªä¸è¿‡æˆå‘˜å˜é‡çš„è®¿é—®æ ‡å¿—ä¸Žç±»çš„è®¿é—®æ ‡å¿—ç¨æœ‰åŒºåˆ«ã€‚ name_index æœ¬å­—æ®µåå­—çš„ç´¢å¼•ã€‚æŒ‡å‘ä¸€ä¸ªCONSTANT_Class_infoç±»åž‹çš„å¸¸é‡ï¼Œè¿™é‡Œé¢å­˜å‚¨äº†æœ¬å­—æ®µçš„åå­—ç­‰ä¿¡æ¯ã€‚ descriptor_index æè¿°ç¬¦ã€‚ç”¨äºŽæè¿°æœ¬å­—æ®µåœ¨Javaä¸­çš„æ•°æ®ç±»åž‹ç­‰ä¿¡æ¯(ä¸‹é¢è¯¦ç»†ä»‹ç») attributes_count å±žæ€§è¡¨é›†åˆçš„é•¿åº¦ã€‚ attributes å±žæ€§è¡¨é›†åˆã€‚åˆ°descriptor_indexä¸ºæ­¢æ˜¯å­—æ®µè¡¨çš„å›ºå®šä¿¡æ¯ï¼Œå…‰æœ‰ä¸Šè¿°ä¿¡æ¯å¯èƒ½æ— æ³•å®Œæ•´åœ°æè¿°ä¸€ä¸ªå­—æ®µï¼Œå› æ­¤ç”¨å±žæ€§è¡¨é›†åˆæ¥å­˜æ”¾é¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚ ä»€ä¹ˆæ˜¯æè¿°ç¬¦ æˆå‘˜å˜é‡(åŒ…æ‹¬é™æ€æˆå‘˜å˜é‡å’Œå®žä¾‹å˜é‡) å’Œ æ–¹æ³•éƒ½æœ‰å„è‡ªçš„æè¿°ç¬¦ã€‚ å¯¹äºŽå­—æ®µè€Œè¨€ï¼Œæè¿°ç¬¦ç”¨äºŽæè¿°å­—æ®µçš„æ•°æ®ç±»åž‹ï¼› å¯¹äºŽæ–¹æ³•è€Œè¨€ï¼Œæè¿°ç¬¦ç”¨äºŽæè¿°å­—æ®µçš„æ•°æ®ç±»åž‹ã€å‚æ•°åˆ—è¡¨ã€è¿”å›žå€¼ã€‚ åœ¨æè¿°ç¬¦ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»åž‹ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå¯¹è±¡ç±»åž‹ç”¨â€œLå¯¹è±¡ç±»åž‹çš„å…¨é™å®šåâ€è¡¨ç¤ºï¼Œæ•°ç»„ç”¨â€œæ•°ç»„ç±»åž‹çš„å…¨é™å®šåâ€è¡¨ç¤ºã€‚ æè¿°æ–¹æ³•æ—¶ï¼Œå°†å‚æ•°æ ¹æ®ä¸Šè¿°è§„åˆ™æ”¾åœ¨()ä¸­ï¼Œ()å³ä¾§æŒ‰ç…§ä¸Šè¿°æ–¹æ³•æ”¾ç½®è¿”å›žå€¼ã€‚è€Œä¸”ï¼Œå‚æ•°ä¹‹é—´æ— éœ€ä»»ä½•ç¬¦å·ã€‚ å­—æ®µè¡¨é›†åˆçš„æ³¨æ„ç‚¹ ä¸€ä¸ªclassæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­ä¸èƒ½å‡ºçŽ°ä»Žçˆ¶ç±»/æŽ¥å£ç»§æ‰¿è€Œæ¥å­—æ®µï¼› ä¸€ä¸ªclassæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­å¯èƒ½ä¼šå‡ºçŽ°ç¨‹åºçŒ¿æ²¡æœ‰å®šä¹‰çš„å­—æ®µ å¦‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°åœ¨å†…éƒ¨ç±»çš„classæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­æ·»åŠ å¤–éƒ¨ç±»å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä¾›å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»ã€‚ Javaä¸­åªè¦ä¸¤ä¸ªå­—æ®µåå­—ç›¸åŒå°±æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ä½†åœ¨JVMè§„èŒƒä¸­ï¼Œå…è®¸ä¸¤ä¸ªå­—æ®µçš„åå­—ç›¸åŒä½†æè¿°ç¬¦ä¸åŒçš„æƒ…å†µï¼Œå¹¶ä¸”è®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—æ®µã€‚ æ–¹æ³•è¡¨çš„é›†åˆ åœ¨classæ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•ä»¥äºŒç»´è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œæ¯å¼ è¡¨æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•æž„æˆæ–¹æ³•è¡¨çš„é›†åˆã€‚ æ–¹æ³•è¡¨çš„ç»“æž„å’Œå­—æ®µè¡¨çš„ç»“æž„ä¸€è‡´ï¼Œåªä¸è¿‡è®¿é—®æ ‡å¿—å’Œå±žæ€§è¡¨é›†åˆçš„å¯é€‰é¡¹æœ‰æ‰€ä¸åŒã€‚ æ–¹æ³•è¡¨çš„å±žæ€§è¡¨é›†åˆä¸­æœ‰ä¸€å¼ Codeå±žæ€§è¡¨ï¼Œç”¨äºŽå­˜å‚¨å½“å‰æ–¹æ³•ç»ç¼–è¯‘å™¨ç¼–è¯‘è¿‡åŽçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ æ–¹æ³•è¡¨é›†åˆçš„æ³¨æ„ç‚¹ å¦‚æžœæœ¬classæ²¡æœ‰é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæœ¬classæ–‡ä»¶çš„æ–¹æ³•è¡¨é›†åˆä¸­æ˜¯ä¸ä¼šå‡ºçŽ°çˆ¶ç±»/çˆ¶æŽ¥å£çš„æ–¹æ³•è¡¨ï¼› æœ¬classçš„æ–¹æ³•è¡¨é›†åˆå¯èƒ½å‡ºçŽ°ç¨‹åºçŒ¿æ²¡æœ‰å®šä¹‰çš„æ–¹æ³• ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šåœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨é›†åˆä¸­åŠ å…¥ç±»æž„é€ å™¨å’Œå®žä¾‹æž„é€ å™¨ã€‚ é‡è½½ä¸€ä¸ªæ–¹æ³•éœ€è¦æœ‰ç›¸åŒçš„ç®€å•åç§°å’Œä¸åŒçš„ç‰¹å¾ç­¾åã€‚JVMçš„ç‰¹å¾ç­¾åå’ŒJavaçš„ç‰¹å¾ç­¾åæœ‰æ‰€ä¸åŒï¼š Javaç‰¹å¾ç­¾åï¼šæ–¹æ³•å‚æ•°åœ¨å¸¸é‡æ± ä¸­çš„å­—æ®µç¬¦å·å¼•ç”¨çš„é›†åˆ JVMç‰¹å¾ç­¾åï¼šæ–¹æ³•å‚æ•°ï¼‹è¿”å›žå€¼ å±žæ€§è¡¨ å±žæ€§è®¡æ•°å™¨(attributes_count) å±žæ€§è®¡æ•°å™¨ï¼Œattributes_countçš„å€¼è¡¨ç¤ºå½“å‰ Class æ–‡ä»¶attributesè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚attributesè¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_info ç»“æž„çš„æ•°æ®é¡¹ã€‚ å±žæ€§ä¿¡æ¯æ•°æ®åŒº(attributes[attributes_count]) å±žæ€§è¡¨ï¼Œattributes è¡¨çš„æ¯ä¸ªé¡¹çš„å€¼å¿…é¡»æ˜¯attribute_infoç»“æž„ã€‚ åœ¨Java 7 è§„èŒƒé‡Œï¼ŒClassæ–‡ä»¶ç»“æž„ä¸­çš„attributesè¡¨çš„é¡¹åŒ…æ‹¬ä¸‹åˆ—å®šä¹‰çš„å±žæ€§ï¼š InnerClasses ã€ EnclosingMethod ã€ Synthetic ã€Signatureã€SourceFileï¼ŒSourceDebugExtension ã€Deprecatedã€RuntimeVisibleAnnotations ã€RuntimeInvisibleAnnotationsä»¥åŠBootstrapMethodså±žæ€§ã€‚ å¯¹äºŽæ”¯æŒ Class æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 49.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®žçŽ°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å–attributesè¡¨ä¸­çš„Signatureã€RuntimeVisibleAnnotationså’ŒRuntimeInvisibleAnnotationså±žæ€§ã€‚å¯¹äºŽæ”¯æŒClassæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 51.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®žçŽ°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å– attributesè¡¨ä¸­çš„BootstrapMethodså±žæ€§ã€‚Java 7 è§„èŒƒ è¦æ±‚ä»»ä¸€ Java è™šæ‹Ÿæœºå®žçŽ°å¯ä»¥è‡ªåŠ¨å¿½ç•¥ Class æ–‡ä»¶çš„ attributesè¡¨ä¸­çš„è‹¥å¹² ï¼ˆç”šè‡³å…¨éƒ¨ï¼‰ å®ƒä¸å¯è¯†åˆ«çš„å±žæ€§é¡¹ã€‚ä»»ä½•æœ¬è§„èŒƒæœªå®šä¹‰çš„å±žæ€§ä¸èƒ½å½±å“Classæ–‡ä»¶çš„è¯­ä¹‰ï¼Œåªèƒ½æä¾›é™„åŠ çš„æè¿°ä¿¡æ¯ ã€‚ æ ¹æ®ä¸Šè¿°çš„å™è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†classçš„æ–‡ä»¶ç»„ç»‡ç»“æž„æ¦‚æ‹¬æˆä»¥ä¸‹é¢è¿™ä¸ªç»“æž„ä½“ï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux - å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2Fposts%2Fcb6839f2.html</url>
    <content type="text"><![CDATA[å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ [root@localhost~] rootä¸ºç”¨æˆ·åï¼ˆ#è¶…çº§ç”¨æˆ· $æ™®é€šç”¨æˆ·ï¼‰ localhostä¸»æœºå å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ï¼š 1å‘½ä»¤[é€‰é¡¹][å‚æ•°] æŸ¥è¯¢ç›®å½•çš„å†…å®¹ å‘½ä»¤æ ¼å¼ï¼š 1ls [é€‰é¡¹][æ–‡ä»¶æˆ–ç›®å½•] é€‰é¡¹ï¼š -a æ‰€æœ‰æ–‡ä»¶,åŒ…æ‹¬éšè—æ–‡ä»¶ã€‚ -l æŸ¥çœ‹è¯¦æƒ…,åŒ…å«æ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œæ‹¥æœ‰è¯¥æ–‡ä»¶çš„äººå‘˜ï¼Œæœ‰æƒæŸ¥çœ‹è¯¥æ–‡ä»¶ï¼Œä»¥åŠä½•æ—¶è¿›è¡Œä¸Šæ¬¡ä¿®æ”¹ã€‚ -d æŸ¥çœ‹ç›®å½•å±žæ€§ -h æ˜¾ç¤ºæ–‡ä»¶å¤§å° æ–‡ä»¶å¤„ç† å»ºç«‹ç›®å½• mkdir -p[ç›®å½•å] -pè¡¨ç¤ºé€’å½’åˆ›å»ºæ–‡ä»¶å¤¹ åˆ‡æ¢ç›®å½• cd [ç›®å½•] ç®€åŒ–æ“ä½œï¼š 1234cd ~ è¿›å…¥å½“å‰ç”¨æˆ·ç›®å½•cd - ä¸Šæ¬¡ç›®å½•cd .. è¿›å…¥ä¸Šä¸€çº§ç›®å½•pwd æŸ¥çœ‹å½“å‰ç›®å½•æ‰€åœ¨ä½ç½® åˆ é™¤ç›®å½• 12rmdir [ç›®å½•] åˆ é™¤æ‰€æœ‰æ–‡ä»¶rm -rf [ç›®å½•] åˆ é™¤ç›®å½•æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶ç›®å½• cp [é€‰é¡¹] [åŽŸæ–‡ä»¶ç›®å½•] [ç›®æ ‡ç›®å½•] é€‰é¡¹ï¼š -rå¤åˆ¶ç›®å½• -pè¿žæ–‡ä»¶å±žæ€§ä¸€èµ·å¤åˆ¶ -a ç›¸å½“äºŽ-pdr å‰ªåˆ‡ã€æ”¹å mv [åŽŸæ–‡ä»¶ç›®å½•] [ç›®æ ‡æ–‡ä»¶ç›®å½•] 1mv filename1 filename2 filename1 æ–‡ä»¶çš„æºè·¯å¾„ï¼Œfilename2 æ˜¯ç›®æ ‡è·¯å¾„ã€‚ å¸¸è§ç›®å½•ä½œç”¨ 123456789101112131415/ æ ¹ç›®å½•/bin å‘½ä»¤ä¿å­˜ç›®å½•/boot å¯åŠ¨ç›®å½•/dev è®¾å¤‡æ–‡ä»¶å‘½ä»¤/etc é…ç½®æ–‡ä»¶ä¿å­˜ç›®å½•/home å®¶ç›®å½•/lib ç³»ç»Ÿåº“ä¿å­˜å‘½ä»¤/mnt ç³»ç»ŸæŒ‚è½½ç›®å½• åˆ›å»ºæˆ–æ›´æ–°æ–‡ä»¶ 1touch filename cat å®ƒå¯ä»¥åœ¨UNIXæˆ–Linuxä¸‹ç”¨äºŽä»¥ä¸‹ç›®çš„ã€‚ åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶ å¤åˆ¶æ–‡æœ¬æ–‡ä»¶ åˆå¹¶æ–‡æœ¬æ–‡ä»¶ åˆ›å»ºæ–°çš„æ–‡æœ¬æ–‡ä»¶ 123cat filenamecat file1 file2 cat file1 file2 &gt; newcombinedfile more æ˜¾ç¤ºæ–‡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç”¨ç©ºæ ¼ç§»åŠ¨å¹¶é”®å…¥qä»¥é€€å‡ºï¼‰ã€‚ 1more filename head è¾“å‡ºæ–‡ä»¶çš„å‰10è¡Œã€‚ 1head filename tail è¾“å‡ºæœ€åŽ10è¡Œæ–‡ä»¶ã€‚ç”¨äºŽ-fåœ¨æ–‡ä»¶å¢žé•¿æ—¶è¾“å‡ºé™„åŠ æ•°æ®ã€‚ 1tail filename diff æ¯”è¾ƒæ–‡ä»¶ï¼Œå¹¶åˆ—å‡ºä»–ä»¬çš„å·®å¼‚ã€‚ 1diff filename1 filename2 lpr æ‰“å°æ–‡ä»¶ã€‚ 1lpr filename æ–‡ä»¶æœç´¢ locate locate [æ–‡ä»¶å] åœ¨ç³»ç»Ÿæ•°æ®åº“ä¸­æŸ¥æ‰¾æ–‡ä»¶ã€‚æ–°å»ºçš„æ–‡ä»¶ï¼Œè¦æ‰§è¡Œupdatedbæ“ä½œä¹‹åŽæ‰èƒ½æœåˆ°ã€‚ å‘½ä»¤æœç´¢ whereis [é€‰é¡¹] [å‘½ä»¤å] æˆ–è€… which [é€‰é¡¹][å‘½ä»¤å] é€‰é¡¹ï¼š -b åªæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ -m åªæŸ¥æ‰¾å¸®åŠ©æ–‡ä»¶ è¯´æ˜Žï¼šwhereisä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨æž„å»ºçš„æ•°æ®åº“æ¥æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæºæ–‡ä»¶å’Œæ‰‹å†Œé¡µé¢ã€‚ whichåœ¨çŽ¯å¢ƒå˜é‡PATHæŒ‡å®šçš„ç›®å½•ä¸­æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ­¤å‘½ä»¤å°†æ‰“å°å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ æ–‡ä»¶æœç´¢ find [æœç´¢èŒƒå›´][é€‰é¡¹][æ¡ä»¶] ä¸¾ä¾‹ï¼š åœ¨æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºinstall.logæ–‡ä»¶ find / -name install.log å¿½ç•¥å¤§å°å†™æŸ¥æ‰¾æ–‡ä»¶ find /root -inname install.log find /var/log -mtime +10 å…¶ä¸­-mtime æ–‡ä»¶ä¿®æ”¹æ—¶é—´ -atime æ–‡ä»¶è®¿é—®æ—¶é—´ -ctime æ”¹å˜æ–‡ä»¶å±žæ€§æ—¶é—´ +10 10å¤©å‰ 10 10å¤© -10 10å¤©å†… æŸ¥æ‰¾æ–‡ä»¶å¤§äºŽ20Mçš„æ–‡ä»¶ find /etc -size +20M æ–‡æœ¬æ“ä½œ awk awk æ˜¯å¤„ç†æ–‡æœ¬æ–‡ä»¶æœ€æœ‰ç”¨çš„å‘½ä»¤ã€‚å®ƒä¸€è¡Œä¸€è¡Œåœ°åœ¨æ•´ä¸ªæ–‡ä»¶ä¸Šè¿è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ç©ºæ ¼åˆ†éš”å­—æ®µã€‚awkå‘½ä»¤æœ€å¸¸ç”¨çš„è¯­æ³•æ˜¯: 1awk &apos;/search_pattern/ &#123; action_to_take_if_pattern_matches; &#125;&apos; file_to_parse ä»¥/etc/passwdæ–‡ä»¶åŒ…å«çš„ç¤ºä¾‹æ•°æ®ä¸ºä¾‹ï¼š 12345root:x:0:0:root:/root:/usr/bin/zshdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/sync çŽ°åœ¨ä»Žè¿™ä¸ªæ–‡ä»¶åªèŽ·å–ç”¨æˆ·åã€‚ -FæŒ‡å®šè¦åŸºäºŽå“ªä¸ªåˆ†éš”å­—æ®µã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ { print $1 } æ„å‘³ç€æ‰“å°å‡ºç¬¬ä¸€ä¸ªåŒ¹é…å­—æ®µã€‚ 1awk -F&apos;:&apos; &apos;&#123; print $1 &#125;&apos; /etc/passwd è¿è¡Œä¸Šè¿°å‘½ä»¤åŽï¼Œå°†èŽ·å¾—ä»¥ä¸‹è¾“å‡ºã€‚ 12345rootdaemonbinsyssync grep æŸ¥æ‰¾æ–‡ä»¶å†…çš„æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨ grep æœç´¢ä¸Žä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–‡æœ¬è¡Œï¼Œå¹¶ä»…è¾“å‡ºåŒ¹é…çš„è¡Œã€‚ 1grep pattern filename ç¤ºä¾‹ï¼š 1234$ grep admin /etc/passwd_kadmin_admin:*:218:-2:Kerberos Admin Service:/var/empty:/usr/bin/false_kadmin_changepw:*:219:-2:Kerberos Change Password Service:/var/empty:/usr/bin/false_krb_kadmin:*:231:-2:Open Directory Kerberos Admin Service:/var/empty:/usr/bin/false è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨-ié€‰é¡¹å¼ºåˆ¶grepå¿½ç•¥å•è¯å¤§å°å†™ã€‚-rå¯ç”¨äºŽæœç´¢æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š 1$ grep -r admin /etc/ -w åªæœç´¢å•è¯ã€‚ wc ç»Ÿè®¡ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰å¤šå°‘è¡Œï¼Œå¤šå°‘å•è¯å’Œå¤šå°‘å­—ç¬¦ã€‚ 1wc filename ç¤ºä¾‹ï¼š 12$ wc demo.txt7459 15915 398400 demo.txt 7459 æ˜¯è¡Œæ•°, 15915 æ˜¯å•è¯æ•°ï¼Œ 398400 æ˜¯å­—ç¬¦æ•°. sed ç”¨äºŽè¿‡æ»¤å’Œè½¬æ¢æ–‡æœ¬çš„æµç¼–è¾‘å™¨ã€‚ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1Hello This is a Test 1 2 3 4 ç”¨è¿žå­—ç¬¦æ›¿æ¢æ‰€æœ‰ç©ºæ ¼ 1sed &apos;s/ /-/g&apos; example.txt ç»“æžœå¦‚ä¸‹ï¼š 1Hello-This-is-a-Test-1-2-3-4 ä½¿ç”¨&quot;d&quot;æ›¿æ¢æ‰€æœ‰çš„æ•°å­— 1sed &apos;s/[0-9]/d/g&apos; example.txt ç»“æžœå¦‚ä¸‹ï¼š 1Hello This is a Test d d d d sort æŽ’åºæ–‡æœ¬æ–‡ä»¶çš„è¡Œ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1234567fbcgaed æŽ’åºexample.txt 1sort example.txt ç»“æžœå¦‚ä¸‹ï¼š 1234567abcdefg éšæœºåŒ–ä¸€ä¸ªæŽ’åºçš„example.txt 1sort example.txt | sort -R ç»“æžœå¦‚ä¸‹ï¼š 1234567bfacdge uniq æŠ¥å‘Šæˆ–çœç•¥é‡å¤çš„è¡Œ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678aababcdc åªæ˜¾ç¤ºexample.txtçš„å”¯ä¸€è¡Œï¼ˆé¦–å…ˆä½ éœ€è¦æŽ’åºï¼Œå¦åˆ™çœ‹ä¸åˆ°é‡å ï¼‰ 1sort example.txt | uniq ç»“æžœå¦‚ä¸‹ï¼š 1234abcd æ˜¾ç¤ºæ¯è¡Œçš„å”¯ä¸€é¡¹ï¼Œå¹¶å‘Šè¯‰æˆ‘æ‰¾åˆ°äº†å¤šå°‘ä¸ªå®žä¾‹ 1sort example.txt | uniq -c ç»“æžœå¦‚ä¸‹ï¼š 12343 a2 b2 c1 d cut ä»Žæ¯è¡Œæ–‡ä»¶ä¸­åˆ é™¤éƒ¨åˆ†ã€‚ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1red riding hood went to the park to play æ˜¾ç¤ºç¬¬2,7å’Œ9æ çš„ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ 1cut -d &quot; &quot; -f2,7,9 example.txt ç»“æžœå¦‚ä¸‹ï¼š 1riding park play echo æ˜¾ç¤ºä¸€è¡Œæ–‡å­— æ˜¾ç¤º &quot;Hello World&quot; 1echo Hello World ç»“æžœå¦‚ä¸‹ï¼š 1Hello World ç”¨å­—æ¯ä¹‹é—´çš„æ¢è¡Œæ˜¾ç¤º &quot;Hello World&quot; 1echo -ne &quot;Hello\nWorld\n&quot; ç»“æžœå¦‚ä¸‹ï¼š 12HelloWorld fmt ç®€å•çš„æœ€ä½³æ–‡æœ¬æ ¼å¼åŒ–ç¨‹åº example.txtå†…å®¹å¦‚ä¸‹ï¼š 1Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. å°†example.txtçš„è¡Œè¾“å‡ºä¸º20ä¸ªå­—ç¬¦çš„å®½åº¦ 1234567891011121314151617181920cat example.txt | fmt -w 20Lorem ipsumdolor sit amet,consetetursadipscing elitr,sed diam nonumyeirmod temporinvidunt ut laboreet dolore magnaaliquyam erat, seddiam voluptua. Atvero eos etaccusam et justoduo dolores et earebum. Stet clitakasd gubergren,no sea takimatasanctus est Loremipsum dolor sitamet. tr ç¿»è¯‘æˆ–åˆ é™¤å­—ç¬¦ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1Hello World Foo Bar Baz! æŠŠæ‰€æœ‰å°å†™å­—æ¯å˜æˆä¸ºå¤§å†™ 1cat example.txt | tr &apos;a-z&apos; &apos;A-Z&apos; ç»“æžœå¦‚ä¸‹ï¼š 1HELLO WORLD FOO BAR BAZ! æŠŠæ‰€æœ‰çš„ç©ºæ ¼å˜æˆæ¢è¡Œç¬¦ 1cat example.txt | tr &apos; &apos; &apos;\n&apos; ç»“æžœå¦‚ä¸‹ï¼š 12345HelloWorldFooBarBaz! nl æ˜¾ç¤ºæ–‡ä»¶çš„è¡Œæ•° example.txtå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819Lorem ipsumdolor sit amet,consetetursadipscing elitr,sed diam nonumyeirmod temporinvidunt ut laboreet dolore magnaaliquyam erat, seddiam voluptua. Atvero eos etaccusam et justoduo dolores et earebum. Stet clitakasd gubergren,no sea takimatasanctus est Loremipsum dolor sitamet. å¸¦è¡Œå·æ˜¾ç¤º example.txt 1nl -s&quot;. &quot; example.txt ç»“æžœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526 1. Lorem ipsum 2. dolor sit amet, 3. consetetur 4. sadipscing elitr, 5. sed diam nonumy 6. eirmod tempor 7. invidunt ut labore 8. et dolore magna 9. aliquyam erat, sed 10. diam voluptua. At 11. vero eos et 12. accusam et justo 13. duo dolores et ea 14. rebum. Stet clita 15. kasd gubergren, 16. no sea takimata 17. sanctus est Lorem 18. ipsum dolor sit 19. amet.``` 12. `egrep`æ‰“å°åŒ¹é…æ¨¡å¼çš„è¡Œ - æ‰©å±•è¡¨è¾¾å¼ï¼ˆåˆ«åä¸ºï¼š&apos;grep -E&apos;ï¼‰`example.txt`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. 12&gt;åœ¨å…¶ä¸­æ˜¾ç¤ºâ€œLoremâ€æˆ–â€œdolorâ€çš„è¡Œ egrep '(Lorem|dolor)' example.txt or grep -E '(Lorem|dolor)' example.txt 12ç»“æžœå¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, et dolore magna duo dolores et ea sanctus est Lorem ipsum dolor sit 12345613. `fgrep`æ‰“å°åŒ¹é…æ¨¡å¼åˆ°çš„è¡Œ - FIXEDæ¨¡å¼åŒ¹é…ï¼ˆåˆ«åä¸ºï¼š&apos;grep -F&apos;ï¼‰`example.txt`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor foo (Lorem|dolor) invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. 12&gt;åœ¨example.txtä¸­æ‰¾åˆ°å…·ä½“çš„å­—ç¬¦ä¸²&apos;ï¼ˆLorem | doloarï¼‰&apos; fgrep '(Lorem|dolor)' example.txt or grep -F '(Lorem|dolor)' example.txt 12ç»“æžœå¦‚ä¸‹ï¼š foo (Lorem|dolor) 123456789101112131415#### åŽ‹ç¼©ä¸Žè§£åŽ‹ç¼©å¸¸è§åŽ‹ç¼©æ ¼å¼ï¼š.zip ã€ .gz ã€ .bz2ã€ .tar.gz ã€ .tar.bz21. zipæ ¼å¼**åŽ‹ç¼©æ–‡ä»¶**`zip [åŽ‹ç¼©æ–‡ä»¶å][åŽŸæ–‡ä»¶]`**åŽ‹ç¼©ç›®å½•**`zip -r [åŽ‹ç¼©æ–‡ä»¶å][åŽŸæ–‡ä»¶]`ä¸¾ä¾‹ï¼š touch jp/cangls touch jp/longls zip -r jp.zip jp 1234567891011121314151617181920212223242526**è§£åŽ‹ï¼š**`unzip [åŽ‹ç¼©æ–‡ä»¶å]`**åŽ‹ç¼©ä¸ºgzæ ¼å¼ï¼ŒåŽŸæ–‡ä»¶ä¸ä¿ç•™**`gzip [åŽŸæ–‡ä»¶]`2. gzæ ¼å¼**åŽ‹ç¼©.gzæ ¼å¼ï¼ŒåŽŸæ–‡ä»¶ä¿ç•™**`gzip -c åŽŸæ–‡ä»¶ &gt; åŽ‹ç¼©æ–‡ä»¶`**åŽ‹ç¼©ç›®å½•ï¼š**`gzip -r ç›®å½•`**è§£åŽ‹ï¼š**`guzip [æ–‡ä»¶]``guzip -r [ç›®å½•]`**æŸ¥çœ‹gzipåŽ‹ç¼©æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦gunzipå®ƒ** gzcat filename 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859603. tar**æ‰“åŒ…**`tar -cvf æ‰“åŒ…æ–‡ä»¶å åŽŸæ–‡ä»¶`**è§£åŽ‹**`tar -xvf jp.tar`4. tar.gz**æ‰“åŒ…**`tar -zcvf åŽ‹ç¼©åŒ…å.tar.gz åŽŸæ–‡ä»¶`**è§£åŽ‹**`tar -zxvf åŽ‹ç¼©åŒ…å.tar.gz`#### å…³æœºã€é‡å¯`shutdown [é€‰é¡¹][æ—¶é—´]`**é€‰é¡¹ï¼š**+ -c å–æ¶ˆå‰ä¸€ä¸ªå…³æœºå‘½ä»¤+ -h å…³æœº+ -r é‡å¯+ init 6 é‡å¯+ init 0 å…³æœº+ logout é€€å‡ºç™»é™†#### æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯`w`ã€`who`ã€`last`ã€`lastlog`#### è¾“å‡ºé‡å®šå‘`å‘½ä»¤&gt;æ–‡ä»¶` ä»¥è¦†ç›–çš„æ–¹å¼ï¼ŒæŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶`å‘½ä»¤&gt;&gt;æ–‡ä»¶` ä»¥è¿½åŠ çš„æ–¹å¼ï¼ŒæŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€`é”™è¯¯å‘½ä»¤ 2&gt; æ–‡ä»¶` ä»¥è¦†ç›–çš„æ–¹å¼æŠŠé”™è¯¯çš„å‘½ä»¤è¦†ç›–åˆ°æŒ‡å®šæ–‡ä»¶`é”™è¯¯å‘½ä»¤ 2&gt;&gt; æ–‡ä»¶` ä»¥è¿½å‡»çš„æ–¹å¼æŠŠé”™è¯¯çš„å‘½ä»¤è¦†ç›–åˆ°æŒ‡å®šæ–‡ä»¶`å‘½ä»¤&gt;&gt;æ–‡ä»¶ 2&gt;&amp;1` åŒæ—¶è¿½åŠ æ­£ç¡®å‘½ä»¤å’Œé”™è¯¯å‘½ä»¤åˆ° æŒ‡å®šæ–‡ä»¶`å‘½ä»¤ &gt;&gt;æ–‡ä»¶1 2&gt;&gt;æ–‡ä»¶2` æŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æ–‡ä»¶1é”™è¯¯çš„æ–‡ä»¶2#### ç½‘ç»œç›¸å…³1. ifconfigæŸ¥çœ‹ipä¸¾ä¸ªä¾‹å­ï¼š ifconfig&gt;&gt; ip.log cat ip.log 2. æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ `netstat [é€‰é¡¹]` é€‰é¡¹ï¼š + -t: åˆ—å‡ºtcp åè®®ç«¯å£ + -u: åˆ—å‡ºupdåè®®ç«¯å£ + -n ipåœ°å€ä¸ªç«¯å£å· + -l åˆ—å‡ºç›‘å¬çŠ¶æ€çš„ + -a æ‰€æœ‰ 3. æŸ¥çœ‹è·¯ç”±åˆ—è¡¨ `netstat -rn` æˆ–è€… `route -n` 4. æŸ¥çœ‹æŸåŸŸåä¸Žè‡ªå·±çš„ç”µè„‘çš„ç½‘ç»œçŠ¶æ€ `ping www.baidu.com` #### viç¼–è¾‘å™¨ viçš„å‡çº§ç‰ˆæ˜¯vim 1. vimçš„æ“ä½œæ¨¡å¼ `commond mode` å‘½ä»¤æ¨¡å¼ `inser tmode` ç¼–è¾‘æ¨¡å¼ `lastline mode` åº•è¡Œæ¨¡å¼ 2. æ¨¡å¼åˆ‡æ¢ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ `esc` è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ 3. å‘½ä»¤æ¨¡å¼ `vim [æ–‡ä»¶]` è¿›å…¥æ–‡ä»¶æˆ–è€…åˆ›å»ºæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼‰ `vim + [æ–‡ä»¶å]` è¿›å…¥æ–‡ä»¶å°¾éƒ¨ `vim +/[å­—ç¬¦ä¸²] [æ–‡ä»¶å]` å…‰æ ‡å®šä½åˆ°æ–‡ä»¶ç¬¬ä¸€æ¬¡å‡ºçŽ°è¯¥å­—ç¬¦ä¸²çš„ä½ç½® 4. åº•è¡Œæ¨¡å¼ `:w` ä¿å­˜ `:q `é€€å‡º `:!` å¼ºåˆ¶ `:15` å®šä½çš„ç¬¬15è¡Œ `/[å­—ç¬¦ä¸²]` å…‰æ ‡ä½ç½®å‘åŽæœç´¢è¯¥å­—ç¬¦ä¸² `?[å­—ç¬¦ä¸²]` å…‰æ ‡ä½ç½®å‘å‰æœç´¢è¯¥å­—ç¬¦ä¸² `dd `åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ `ctr+f` å‘ä¸‹ç¿»é¡µ `ctr+b` å‘ä¸Šç¿»é¡µ #### å¸¸ç”¨æ“ä½œå¿«æ·é”® `ctr+c` ç»ˆæ­¢å½“å‰å‘½ä»¤ `ctr+l` æ¸…å± ç›¸å½“äºŽ clear `ctr+a` å…‰æ ‡ç§»åˆ°è¡Œé¦– `ctr+e` å…‰æ ‡ç§»åˆ°è¡Œå°¾ `ctr+u` æŠŠå…‰æ ‡æ‰€åœ¨ä½ç½®åˆ é™¤åˆ°è¡Œé¦– `ctr+z` æŠŠå‘½ä»¤æ”¾å…¥åŽå° `ctr+r` åœ¨åŽ†å²å‘½ä»¤ä¸­æœç´¢]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - CompletableFuture]]></title>
    <url>%2Fposts%2Fcad2f756.html</url>
    <content type="text"><![CDATA[CompletableFutureæ˜¯Java8ä¸­å¯¹Futureçš„å¢žå¼ºã€‚å®žçŽ°CompletionStageæŽ¥å£(40ä½™ä¸ªæ–¹æ³•)ï¼Œå¤§å¤šæ•°æ–¹æ³•å¤šæ•°åº”ç”¨åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå¹¶ä¸”æ”¯æŒæµå¼è°ƒç”¨ã€‚ ç®€å•å®žçŽ°ï¼š 123456789101112131415161718192021222324252627282930public class CompletableFutureTest implements Runnable &#123; CompletableFuture&lt;Integer&gt; completableFuture = null; public CompletableFutureTest(CompletableFuture&lt;Integer&gt; completableFuture) &#123; this.completableFuture = completableFuture; &#125; @Override public void run() &#123; int result = 0; try &#123; result = completableFuture.get() * completableFuture.get(); &#125; catch (Exception e) &#123; &#125; System.out.println(result); &#125; public static void main(String[] args) throws InterruptedException, ExecutionException &#123; final CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;(); new Thread(new CompletableFutureTest(future)).start(); //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„è®¡ç®—è¿‡ç¨‹ Thread.sleep(1000); //å‘ŠçŸ¥å®Œæˆç»“æžœ future.complete(60); &#125;&#125; Futureæœ€ä»¤äººè¯Ÿç—…çš„å°±æ˜¯è¦ç­‰å¾…ï¼Œè¦è‡ªå·±åŽ»æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆäº†ï¼Œåœ¨Futureä¸­ï¼Œä»»åŠ¡å®Œæˆçš„æ—¶é—´æ˜¯ä¸å¯æŽ§çš„ã€‚è€ŒCompletableFutureçš„æœ€å¤§æ”¹è¿›åœ¨äºŽï¼Œä»»åŠ¡å®Œæˆçš„æ—¶é—´ä¹Ÿå¼€æ”¾äº†å‡ºæ¥ã€‚ CompletableFutureçš„å¼‚æ­¥æ‰§è¡Œï¼š 12345678910111213141516public static Integer calc(Integer param) &#123; try &#123; //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125; return param * param;&#125;public static void main(String[] args) throws InterruptedException, ExecutionException &#123; //å¼‚æ­¥è°ƒç”¨ final CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; calc(50)); System.out.println(future2.get());&#125; CompletableFutureçš„æµå¼è°ƒç”¨ï¼š 1234567891011121314151617181920public static Integer calc(Integer param) &#123; try &#123; //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125; return param * param;&#125;public static void main(String[] args) throws InterruptedException, ExecutionException &#123; //æµå¼è°ƒç”¨ CompletableFuture&lt;Void&gt; future3 = CompletableFuture.supplyAsync(() -&gt; calc(40)) .thenApply((i) -&gt; Integer.toString(i)) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future3.get();&#125; ç»„åˆå¤šä¸ªCompletableFutureï¼š 123456789101112public static Integer calc2(Integer param) &#123; return param / 2;&#125;public static void main(String[] args) throws InterruptedException, ExecutionException &#123; //ç»„åˆå¤šä¸ªCompletableFuture CompletableFuture&lt;Void&gt; future4 = CompletableFuture.supplyAsync(() -&gt; calc2(100)) .thenCompose((i) -&gt; CompletableFuture.supplyAsync(() -&gt; calc2(i))) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future4.get();&#125; CompletableFutureè·Ÿæ€§èƒ½ä¸Šå…³ç³»ä¸å¤§ï¼Œæ›´å¤šçš„æ˜¯ä¸ºäº†æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œåœ¨åŠŸèƒ½ä¸Šçš„å¢žå¼ºã€‚å½“ç„¶å¼€æ”¾äº†å®Œæˆæ—¶é—´çš„è®¾ç½®æ˜¯ä¸€å¤§äº®ç‚¹ã€‚ æ¼”ç¤ºçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package main.java.com.study.completableFuture;import java.util.concurrent.CompletableFuture;import java.util.concurrent.ExecutionException;/** * @author: whb * @description: å¢žå¼ºç‰ˆFutureæµ‹è¯•ç±» */public class CompletableFutureTest implements Runnable &#123; CompletableFuture&lt;Integer&gt; completableFuture = null; public CompletableFutureTest(CompletableFuture&lt;Integer&gt; completableFuture) &#123; this.completableFuture = completableFuture; &#125; @Override public void run() &#123; int result = 0; try &#123; result = completableFuture.get() * completableFuture.get(); &#125; catch (Exception e) &#123; &#125; System.out.println(result); &#125; public static Integer calc(Integer param) &#123; try &#123; //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); &#125; catch (InterruptedException e) &#123; &#125; return param * param; &#125; public static Integer calc2(Integer param) &#123; return param / 2; &#125; public static void main(String[] args) throws InterruptedException, ExecutionException &#123; final CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;(); new Thread(new CompletableFutureTest(future)).start(); //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„è®¡ç®—è¿‡ç¨‹ Thread.sleep(1000); //å‘ŠçŸ¥å®Œæˆç»“æžœ future.complete(60); //å¼‚æ­¥è°ƒç”¨ final CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; calc(50)); System.out.println(future2.get()); //æµå¼è°ƒç”¨ CompletableFuture&lt;Void&gt; future3 = CompletableFuture.supplyAsync(() -&gt; calc(40)) .thenApply((i) -&gt; Integer.toString(i)) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future3.get(); //ç»„åˆå¤šä¸ªCompletableFuture CompletableFuture&lt;Void&gt; future4 = CompletableFuture.supplyAsync(() -&gt; calc2(100)) .thenCompose((i) -&gt; CompletableFuture.supplyAsync(() -&gt; calc2(i))) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future4.get(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-12ä¹‹-Callableã€Futureã€FutureTask]]></title>
    <url>%2Fposts%2F75995567.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ä»ŽJava 1.5å¼€å§‹ï¼Œå¼€å§‹æä¾›äº†Callableå’ŒFutureï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åŽå¾—åˆ°ä»»åŠ¡æ‰§è¡Œç»“æžœã€‚ å¯¹æ¯”Runnableå’ŒCallbale Runnableæ˜¯åœ¨java.lang.RunnableåŒ…ä¸‹é¢ï¼Œæ²¡æœ‰è¿”å›žå€¼ï¼Œè€ŒCallableæ˜¯åœ¨java.util.concurrentåŒ…ä¸‹é¢ï¼ˆè¯´æ˜ŽCallableæ˜¯ä¸ºå¹¶å‘ç¼–ç¨‹åšå‡†å¤‡çš„ï¼‰å¯ä»¥æœ‰è¿”å›žå€¼ã€‚ Callableä¸èƒ½ä½¿ç”¨Threadæ¥ç›´æŽ¥æ‰§è¡Œï¼Œä¸€èˆ¬æƒ…å†µä¸‹é¢ä½¿ç”¨ExecutorServiceä¸­çš„submitæ–¹æ³•ç±»æ‰§è¡Œï¼ŒRunnableä½¿ç”¨ExecutorServiceçš„executeæ¥æ‰§è¡Œã€‚ RunnableæŽ¥å£é‡Œé¢æœ‰ä¸€ä¸ªrun()æ–¹æ³•ï¼Œæ— è¿”å›žå€¼ï¼›CallableæŽ¥å£é‡Œé¢æœ‰ä¸€ä¸ªcall()ï¼Œæœ‰è¿”å›žå€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ Future Futureå°±æ˜¯å¯¹äºŽå…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡çš„æ‰§è¡Œç»“æžœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€èŽ·å–ç»“æžœã€‚å¿…è¦æ—¶å¯ä»¥é€šè¿‡getæ–¹æ³•èŽ·å–æ‰§è¡Œç»“æžœï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡žç›´åˆ°ä»»åŠ¡è¿”å›žç»“æžœã€‚ åœ¨FutureæŽ¥å£ä¸­å£°æ˜Žäº†5ä¸ªæ–¹æ³•ï¼Œä¾æ¬¡è§£é‡Šæ¯ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š cancelæ–¹æ³•ç”¨æ¥å–æ¶ˆä»»åŠ¡ï¼Œå¦‚æžœå–æ¶ˆä»»åŠ¡æˆåŠŸåˆ™è¿”å›žtrueï¼Œå¦‚æžœå–æ¶ˆä»»åŠ¡å¤±è´¥åˆ™è¿”å›žfalseã€‚å‚æ•°mayInterruptIfRunningè¡¨ç¤ºæ˜¯å¦å…è®¸å–æ¶ˆæ­£åœ¨æ‰§è¡Œå´æ²¡æœ‰æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ï¼Œå¦‚æžœè®¾ç½®trueï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å–æ¶ˆæ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡ã€‚å¦‚æžœä»»åŠ¡å·²ç»å®Œæˆï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œæ­¤æ–¹æ³•è‚¯å®šè¿”å›žfalseï¼Œå³å¦‚æžœå–æ¶ˆå·²ç»å®Œæˆçš„ä»»åŠ¡ä¼šè¿”å›žfalseï¼›å¦‚æžœä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºtrueï¼Œåˆ™è¿”å›žtrueï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºfalseï¼Œåˆ™è¿”å›žfalseï¼›å¦‚æžœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œè‚¯å®šè¿”å›žtrueã€‚ isCancelledæ–¹æ³•è¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆæˆåŠŸï¼Œå¦‚æžœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆæˆåŠŸï¼Œåˆ™è¿”å›ž trueã€‚ isDoneæ–¹æ³•è¡¨ç¤ºä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œè‹¥ä»»åŠ¡å®Œæˆï¼Œåˆ™è¿”å›žtrueï¼› get()æ–¹æ³•ç”¨æ¥èŽ·å–æ‰§è¡Œç»“æžœï¼Œè¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿé˜»å¡žï¼Œä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰è¿”å›žï¼› get(long timeout, TimeUnit unit)ç”¨æ¥èŽ·å–æ‰§è¡Œç»“æžœï¼Œå¦‚æžœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œè¿˜æ²¡èŽ·å–åˆ°ç»“æžœï¼Œå°±ç›´æŽ¥è¿”å›žnullã€‚ ä¹Ÿå°±æ˜¯è¯´Futureæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š 1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼› 2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼› 3ï¼‰èƒ½å¤ŸèŽ·å–ä»»åŠ¡æ‰§è¡Œç»“æžœã€‚ å› ä¸ºFutureåªæ˜¯ä¸€ä¸ªæŽ¥å£ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ç›´æŽ¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ä½¿ç”¨çš„ï¼Œå› æ­¤å°±æœ‰äº†FutureTaskã€‚ FutureTask å…ˆæ¥çœ‹ä¸€ä¸‹FutureTaskçš„å®žçŽ°ï¼š 1public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; FutureTaskç±»å®žçŽ°äº†RunnableFutureæŽ¥å£ï¼Œçœ‹ä¸€ä¸‹RunnableFutureæŽ¥å£çš„å®žçŽ°ï¼š 123public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; &#123; void run();&#125; å¯ä»¥çœ‹å‡ºRunnableFutureç»§æ‰¿äº†RunnableæŽ¥å£å’ŒFutureæŽ¥å£ï¼Œè€ŒFutureTaskå®žçŽ°äº†RunnableFutureæŽ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›žå€¼ã€‚ FutureTaskæä¾›äº†2ä¸ªæž„é€ å™¨ï¼š 1234public FutureTask(Callable&lt;V&gt; callable) &#123;&#125;public FutureTask(Runnable runnable, V result) &#123;&#125; äº‹å®žä¸Šï¼ŒFutureTaskæ˜¯FutureæŽ¥å£çš„ä¸€ä¸ªå”¯ä¸€å®žçŽ°ç±»ã€‚ ä½¿ç”¨ç¤ºä¾‹ ä½¿ç”¨Callable+FutureèŽ·å–æ‰§è¡Œç»“æžœ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.thread;import java.util.concurrent.*;/** * @author: whb * @description: ä½¿ç”¨Callable+FutureèŽ·å–æ‰§è¡Œç»“æžœ */public class TestCallableFuture &#123; public static void main(String[] args) &#123; ExecutorService executor = Executors.newCachedThreadPool(); Task task = new Task(); Future&lt;Integer&gt; result = executor.submit(task); executor.shutdown(); try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; System.out.println("ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡"); try &#123; System.out.println("taskè¿è¡Œç»“æžœ" + result.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; System.out.println("æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•"); &#125;&#125;class Task implements Callable&lt;Integer&gt; &#123; @Override public Integer call() throws Exception &#123; System.out.println("å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—"); Thread.sleep(3000); int sum = 0; for (int i = 0; i &lt; 100; i++) &#123; sum += i; &#125; return sum; &#125;&#125; æ‰§è¡Œç»“æžœï¼š 1234å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡taskè¿è¡Œç»“æžœ4950æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯• ä½¿ç”¨Callable+FutureTaskèŽ·å–æ‰§è¡Œç»“æžœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package main.java.com.study.thread;import java.util.concurrent.*;/** * @author: whb * @description: ä½¿ç”¨Callable+FutureTaskèŽ·å–æ‰§è¡Œç»“æžœ */public class TestCallableFutureTask &#123; public static void main(String[] args) &#123; //ç¬¬ä¸€ç§æ–¹å¼ ExecutorService executor = Executors.newCachedThreadPool(); Task2 task = new Task2(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(task); executor.submit(futureTask); executor.shutdown(); //ç¬¬äºŒç§æ–¹å¼ï¼Œæ³¨æ„è¿™ç§æ–¹å¼å’Œç¬¬ä¸€ç§æ–¹å¼æ•ˆæžœæ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªä½¿ç”¨çš„æ˜¯ExecutorServiceï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯Thread /*Task task = new Task(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(task); Thread thread = new Thread(futureTask); thread.start();*/ try &#123; Thread.sleep(1000); &#125; catch (InterruptedException e1) &#123; e1.printStackTrace(); &#125; System.out.println("ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡"); try &#123; System.out.println("taskè¿è¡Œç»“æžœ" + futureTask.get()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; catch (ExecutionException e) &#123; e.printStackTrace(); &#125; System.out.println("æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•"); &#125;&#125;class Task2 implements Callable&lt;Integer&gt; &#123; @Override public Integer call() throws Exception &#123; System.out.println("å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—"); Thread.sleep(3000); int sum = 0; for (int i = 0; i &lt; 100; i++) sum += i; return sum; &#125;&#125; æ‰§è¡Œç»“æžœï¼š 1234å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡taskè¿è¡Œç»“æžœ4950æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯• å¦‚æžœä¸ºäº†å¯å–æ¶ˆæ€§è€Œä½¿ç”¨ Future ä½†åˆä¸æä¾›å¯ç”¨çš„ç»“æžœï¼Œåˆ™å¯ä»¥å£°æ˜Ž Future&lt;?&gt; å½¢å¼ç±»åž‹ã€å¹¶è¿”å›ž null ä½œä¸ºåº•å±‚ä»»åŠ¡çš„ç»“æžœã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-11ä¹‹-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡åž‹]]></title>
    <url>%2Fposts%2F4189fc6.html</url>
    <content type="text"><![CDATA[ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡åž‹ ç”Ÿäº§/æ¶ˆè´¹è€…é—®é¢˜æ˜¯ä¸ªéžå¸¸å…¸åž‹çš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œæ¶‰åŠåˆ°çš„å¯¹è±¡åŒ…æ‹¬â€œç”Ÿäº§è€…â€ã€â€œæ¶ˆè´¹è€…â€ã€â€œä»“åº“â€å’Œâ€œäº§å“â€ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š ç”Ÿäº§è€…ä»…ä»…åœ¨ä»“å‚¨æœªæ»¡æ—¶å€™ç”Ÿäº§ï¼Œä»“æ»¡åˆ™åœæ­¢ç”Ÿäº§ã€‚ æ¶ˆè´¹è€…ä»…ä»…åœ¨ä»“å‚¨æœ‰äº§å“æ—¶å€™æ‰èƒ½æ¶ˆè´¹ï¼Œä»“ç©ºåˆ™ç­‰å¾…ã€‚ å½“æ¶ˆè´¹è€…å‘çŽ°ä»“å‚¨æ²¡äº§å“å¯æ¶ˆè´¹æ—¶å€™ä¼šé€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§ã€‚ ç”Ÿäº§è€…åœ¨ç”Ÿäº§å‡ºå¯æ¶ˆè´¹äº§å“æ—¶å€™ï¼Œåº”è¯¥é€šçŸ¥ç­‰å¾…çš„æ¶ˆè´¹è€…åŽ»æ¶ˆè´¹ã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140package main.java.com.study.thread;/** * @author: whb * @description: ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡åž‹æµ‹è¯• */public class ProducerConsumerDemo &#123; public static void main(String[] args) &#123; Depot mDepot = new Depot(100); Producer mPro = new Producer(mDepot); Customer mCus = new Customer(mDepot); mPro.produce(60); mPro.produce(120); mCus.consume(90); mCus.consume(150); mPro.produce(110); &#125;&#125;/** * ä»“åº“ */class Depot &#123; /** * ä»“åº“çš„å®¹é‡ */ private int capacity; /** * ä»“åº“çš„å®žé™…æ•°é‡ */ private int size; public Depot(int capacity) &#123; this.capacity = capacity; this.size = 0; &#125; /** * ç”Ÿäº§ * * @param val */ public synchronized void produce(int val) &#123; try &#123; // left è¡¨ç¤ºâ€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€(æœ‰å¯èƒ½ç”Ÿäº§é‡å¤ªå¤šï¼Œéœ€å¤šæ­¤ç”Ÿäº§) int left = val; while (left &gt; 0) &#123; // åº“å­˜å·²æ»¡æ—¶ï¼Œç­‰å¾…â€œæ¶ˆè´¹è€…â€æ¶ˆè´¹äº§å“ã€‚ while (size &gt;= capacity) &#123; wait(); &#125; // èŽ·å–â€œå®žé™…ç”Ÿäº§çš„æ•°é‡â€(å³åº“å­˜ä¸­æ–°å¢žçš„æ•°é‡) // å¦‚æžœâ€œåº“å­˜â€+â€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€&gt;â€œæ€»çš„å®¹é‡â€ï¼Œåˆ™â€œå®žé™…å¢žé‡â€=â€œæ€»çš„å®¹é‡â€-â€œå½“å‰å®¹é‡â€ã€‚(æ­¤æ—¶å¡«æ»¡ä»“åº“) // å¦åˆ™â€œå®žé™…å¢žé‡â€=â€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€ int inc = (size + left) &gt; capacity ? (capacity - size) : left; size += inc; left -= inc; System.out.printf("%s produce(%3d) --&gt; left=%3d, inc=%3d, size=%3d\n", Thread.currentThread().getName(), val, left, inc, size); // é€šçŸ¥â€œæ¶ˆè´¹è€…â€å¯ä»¥æ¶ˆè´¹äº†ã€‚ notifyAll(); &#125; &#125; catch (InterruptedException e) &#123; &#125; &#125; /** * æ¶ˆè´¹ * * @param val */ public synchronized void consume(int val) &#123; try &#123; // left è¡¨ç¤ºâ€œå®¢æˆ·è¦æ¶ˆè´¹æ•°é‡â€(æœ‰å¯èƒ½æ¶ˆè´¹é‡å¤ªå¤§ï¼Œåº“å­˜ä¸å¤Ÿï¼Œéœ€å¤šæ­¤æ¶ˆè´¹) int left = val; while (left &gt; 0) &#123; // åº“å­˜ä¸º0æ—¶ï¼Œç­‰å¾…â€œç”Ÿäº§è€…â€ç”Ÿäº§äº§å“ã€‚ while (size &lt;= 0) &#123; wait(); &#125; // èŽ·å–â€œå®žé™…æ¶ˆè´¹çš„æ•°é‡â€(å³åº“å­˜ä¸­å®žé™…å‡å°‘çš„æ•°é‡) // å¦‚æžœâ€œåº“å­˜â€&lt;â€œå®¢æˆ·è¦æ¶ˆè´¹çš„æ•°é‡â€ï¼Œåˆ™â€œå®žé™…æ¶ˆè´¹é‡â€=â€œåº“å­˜â€ï¼› // å¦åˆ™ï¼Œâ€œå®žé™…æ¶ˆè´¹é‡â€=â€œå®¢æˆ·è¦æ¶ˆè´¹çš„æ•°é‡â€ã€‚ int dec = (size &lt; left) ? size : left; size -= dec; left -= dec; System.out.printf("%s consume(%3d) &lt;-- left=%3d, dec=%3d, size=%3d\n", Thread.currentThread().getName(), val, left, dec, size); notifyAll(); &#125; &#125; catch (InterruptedException e) &#123; &#125; &#125; @Override public String toString() &#123; return "capacity:" + capacity + ", actual size:" + size; &#125;&#125;/** * ç”Ÿäº§è€… */class Producer &#123; private Depot depot; public Producer(Depot depot) &#123; this.depot = depot; &#125; /** * æ¶ˆè´¹äº§å“ï¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å‘ä»“åº“ä¸­ç”Ÿäº§äº§å“ã€‚ * * @param val */ public void produce(final int val) &#123; new Thread(() -&gt; depot.produce(val)).start(); &#125;&#125;/** * æ¶ˆè´¹è€… */class Customer &#123; private Depot depot; public Customer(Depot depot) &#123; this.depot = depot; &#125; /** * æ¶ˆè´¹äº§å“ï¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ä»Žä»“åº“ä¸­æ¶ˆè´¹äº§å“ã€‚ * * @param val */ public void consume(final int val) &#123; new Thread(() -&gt; depot.consume(val)).start(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; Produceræ˜¯â€œç”Ÿäº§è€…â€ç±»ï¼Œå®ƒä¸Žâ€œä»“åº“(depot)â€å…³è”ã€‚å½“è°ƒç”¨â€œç”Ÿäº§è€…â€çš„produce()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å‘â€œä»“åº“â€ä¸­ç”Ÿäº§äº§å“ã€‚ Customeræ˜¯â€œæ¶ˆè´¹è€…â€ç±»ï¼Œå®ƒä¸Žâ€œä»“åº“(depot)â€å…³è”ã€‚å½“è°ƒç”¨â€œæ¶ˆè´¹è€…â€çš„consume()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ¶ˆè´¹â€œä»“åº“â€ä¸­çš„äº§å“ã€‚ Depotæ˜¯â€œä»“åº“â€ç±»ï¼Œä»“åº“ä¸­è®°å½•â€œä»“åº“çš„å®¹é‡(capacity)â€ä»¥åŠâ€œä»“åº“ä¸­å½“å‰äº§å“æ•°ç›®(size)â€ã€‚ â€œä»“åº“â€ç±»çš„ç”Ÿäº§æ–¹æ³•produce()å’Œæ¶ˆè´¹æ–¹æ³•consume()æ–¹æ³•éƒ½æ˜¯synchronizedæ–¹æ³•ï¼Œè¿›å…¥synchronizedæ–¹æ³•ä½“ï¼Œæ„å‘³ç€è¿™ä¸ªçº¿ç¨‹èŽ·å–åˆ°äº†è¯¥â€œä»“åº“â€å¯¹è±¡çš„åŒæ­¥é”ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€æ—¶é—´ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªèƒ½è¿è¡Œã€‚é€šè¿‡åŒæ­¥é”ï¼Œå®žçŽ°äº†å¯¹â€œæ®‹é…·â€çš„äº’æ–¥è®¿é—®ã€‚ å¯¹äºŽç”Ÿäº§æ–¹æ³•produce()è€Œè¨€ï¼šå½“ä»“åº“æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œéœ€è¦ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“ä¹‹åŽï¼Œç”Ÿäº§çº¿ç¨‹æ‰èƒ½ç”Ÿäº§ï¼›ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§å®Œäº§å“ä¹‹åŽï¼Œä¼šé€šè¿‡notifyAll()å”¤é†’åŒæ­¥é”ä¸Šçš„æ‰€æœ‰çº¿ç¨‹ï¼ŒåŒ…æ‹¬â€œæ¶ˆè´¹è€…çº¿ç¨‹â€ï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„â€œé€šçŸ¥æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹â€ã€‚ å¯¹äºŽæ¶ˆè´¹æ–¹æ³•consume()è€Œè¨€ï¼šå½“ä»“åº“ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œéœ€è¦ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§äº§å“ä¹‹åŽï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æ‰èƒ½æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹å®Œäº§å“ä¹‹åŽï¼Œä¼šé€šè¿‡notifyAll()å”¤é†’åŒæ­¥é”ä¸Šçš„æ‰€æœ‰çº¿ç¨‹ï¼ŒåŒ…æ‹¬â€œç”Ÿäº§è€…çº¿ç¨‹â€ï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„â€œé€šçŸ¥ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§â€ã€‚ &lt;span id=&quot;inline-green&quot;&gt; (æŸä¸€æ¬¡)è¿è¡Œç»“æžœï¼š &lt;/span&gt; Thread-0 produce( 60) --&gt; left= 0, inc= 60, size= 60 Thread-4 produce(110) --&gt; left= 70, inc= 40, size=100 Thread-3 consume(150) &lt;-- left= 50, dec=100, size= 0 Thread-1 produce(120) --&gt; left= 20, inc=100, size=100 Thread-2 consume( 90) &lt;-- left= 0, dec= 90, size= 10 Thread-3 consume(150) &lt;-- left= 40, dec= 10, size= 0 Thread-4 produce(110) --&gt; left= 0, inc= 70, size= 70 Thread-3 consume(150) &lt;-- left= 0, dec= 40, size= 30 Thread-1 produce(120) --&gt; left= 0, inc= 20, size= 50]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2Fposts%2F2d3dc485.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„æ¡†æž¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æž„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§åŸºäºŽç»§æ‰¿çš„ä»£ç å¤ç”¨æŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸€ç§ç±»è¡Œä¸ºåž‹æ¨¡å¼ã€‚ ä¸»è¦ä½œç”¨ å½“å®Œæˆä¸€ä¸ªæ“ä½œå…·æœ‰å›ºå®šçš„æµç¨‹æ—¶ï¼Œç”±æŠ½è±¡å›ºå®šæµç¨‹æ­¥éª¤ï¼Œå…·ä½“æ­¥éª¤äº¤ç»™å­ç±»è¿›è¡Œå…·ä½“å®žçŽ°ï¼ˆå›ºå®šçš„æµç¨‹ï¼Œä¸åŒçš„å®žçŽ°ï¼‰ã€‚ UMLç±»å›¾ è§’è‰² AbstractClassï¼ˆæŠ½è±¡ç±»ï¼‰ï¼šåœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—åŸºæœ¬æ“ä½œ(PrimitiveOperations)ï¼Œè¿™äº›åŸºæœ¬æ“ä½œå¯ä»¥æ˜¯å…·ä½“çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡çš„ï¼Œæ¯ä¸€ä¸ªåŸºæœ¬æ“ä½œå¯¹åº”ç®—æ³•çš„ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨å…¶å­ç±»ä¸­å¯ä»¥é‡å®šä¹‰æˆ–å®žçŽ°è¿™äº›æ­¥éª¤ã€‚åŒæ—¶ï¼Œåœ¨æŠ½è±¡ç±»ä¸­å®žçŽ°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•(Template Method)ï¼Œç”¨äºŽå®šä¹‰ä¸€ä¸ªç®—æ³•çš„æ¡†æž¶ï¼Œæ¨¡æ¿æ–¹æ³•ä¸ä»…å¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡ç±»ä¸­å®žçŽ°çš„åŸºæœ¬æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡ç±»çš„å­ç±»ä¸­å®žçŽ°çš„åŸºæœ¬æ–¹æ³•ï¼Œè¿˜å¯ä»¥è°ƒç”¨å…¶ä»–å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ ConcreteClassï¼ˆå…·ä½“å­ç±»ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡ç±»çš„å­ç±»ï¼Œç”¨äºŽå®žçŽ°åœ¨çˆ¶ç±»ä¸­å£°æ˜Žçš„æŠ½è±¡åŸºæœ¬æ“ä½œä»¥å®Œæˆå­ç±»ç‰¹å®šç®—æ³•çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥è¦†ç›–åœ¨çˆ¶ç±»ä¸­å·²ç»å®žçŽ°çš„å…·ä½“åŸºæœ¬æ“ä½œã€‚ æ¨¡å¼åŽŸç† ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ˜¯å®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­çš„ã€æŠŠåŸºæœ¬æ“ä½œæ–¹æ³•ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ€»ç®—æ³•æˆ–ä¸€ä¸ªæ€»è¡Œä¸ºçš„æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•å®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­ï¼Œå¹¶ç”±å­ç±»ä¸åŠ ä»¥ä¿®æ”¹åœ°å®Œå…¨ç»§æ‰¿ä¸‹æ¥ã€‚æ¨¡æ¿æ–¹æ³•æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªé¡¶å±‚é€»è¾‘æ¡†æž¶ï¼Œè€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨æŠ½è±¡ç±»ä¸­å¯ä»¥æ˜¯å…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡æ–¹æ³•ã€‚ åŸºæœ¬æ–¹æ³•æ˜¯å®žçŽ°ç®—æ³•å„ä¸ªæ­¥éª¤çš„æ–¹æ³•ï¼Œæ˜¯æ¨¡æ¿æ–¹æ³•çš„ç»„æˆéƒ¨åˆ†ã€‚åŸºæœ¬æ–¹æ³•åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šæŠ½è±¡æ–¹æ³•(Abstract Method)ã€å…·ä½“æ–¹æ³•(Concrete Method)å’Œé’©å­æ–¹æ³•(Hook Method)ã€‚ æŠ½è±¡æ–¹æ³•ï¼šä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”±æŠ½è±¡ç±»å£°æ˜Žã€ç”±å…¶å…·ä½“å­ç±»å®žçŽ°ã€‚ å…·ä½“æ–¹æ³•ï¼šä¸€ä¸ªå…·ä½“æ–¹æ³•ç”±ä¸€ä¸ªæŠ½è±¡ç±»æˆ–å…·ä½“ç±»å£°æ˜Žå¹¶å®žçŽ°ï¼Œå…¶å­ç±»å¯ä»¥è¿›è¡Œè¦†ç›–ä¹Ÿå¯ä»¥ç›´æŽ¥ç»§æ‰¿ã€‚ é’©å­æ–¹æ³•ï¼šå¯ä»¥ä¸Žä¸€äº›å…·ä½“æ­¥éª¤ â€œæŒ‚é’©â€ ï¼Œä»¥å®žçŽ°åœ¨ä¸åŒæ¡ä»¶ä¸‹æ‰§è¡Œæ¨¡æ¿æ–¹æ³•ä¸­çš„ä¸åŒæ­¥éª¤ã€‚ æ¨¡å¼ä¼˜ç‚¹ æé«˜ä»£ç å¤ç”¨æ€§ï¼šå°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„çˆ¶ç±»ä¸­ã€‚ æé«˜äº†æ‹“å±•æ€§ï¼šå°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢žåŠ æ–°çš„è¡Œä¸ºã€‚ å®žçŽ°äº†åå‘æŽ§åˆ¶ï¼šé€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢žåŠ æ–°çš„è¡Œä¸ºï¼Œå®žçŽ°äº†åå‘æŽ§åˆ¶ï¼Œç¬¦åˆâ€œå•ä¸€èŒè´£â€å’Œâ€œå¼€é—­åŽŸåˆ™â€ æ¨¡å¼ç¼ºç‚¹ å¼•å…¥äº†æŠ½è±¡ç±»ï¼Œæ¯ä¸€ä¸ªä¸åŒçš„å®žçŽ°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®žçŽ°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢žåŠ ï¼Œä»Žè€Œå¢žåŠ äº†ç³»ç»Ÿå®žçŽ°çš„å¤æ‚åº¦ã€‚ é€‚ç”¨åœºæ™¯ ä¸€æ¬¡æ€§å®žçŽ°ä¸€ä¸ªç®—æ³•çš„ä¸å˜éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®žçŽ°ã€‚ å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ä»¥é¿å…ä»£ç é‡å¤ã€‚ éœ€è¦é€šè¿‡å­ç±»æ¥å†³å®šçˆ¶ç±»ç®—æ³•ä¸­æŸä¸ªæ­¥éª¤æ˜¯å¦æ‰§è¡Œï¼Œå®žçŽ°å­ç±»å¯¹çˆ¶ç±»çš„åå‘æŽ§åˆ¶ã€‚ ä½¿ç”¨æ­¥éª¤ æŠ½è±¡æ¨¡æ¿ç±» 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: æŠ½è±¡æ¨¡æ¿ç±»ï¼Œå®šä¹‰äº†ä¸€å¥—ç®—æ³•æ¡†æž¶/æµç¨‹ï¼› */public abstract class AbstractClass &#123; protected void step1() &#123; System.out.println("AbstractClass:step1"); &#125; protected void step2() &#123; System.out.println("AbstractClass:step2"); &#125; protected void step3() &#123; System.out.println("AbstractClass:step3"); &#125; /** * å›ºå®šç®—æ³•ï¼Œå£°æ˜Žä¸ºfinalæ–¹æ³•ï¼Œé¿å…å­ç±»è¦†å†™ */ public final void templateMehthod() &#123; this.step1(); this.step2(); this.step3(); &#125;&#125; å…·ä½“å®žçŽ°ç±» 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: å…·ä½“å®žçŽ°ç±»A */public class ConcreteClassA extends AbstractClass &#123; @Override protected void step1() &#123; System.out.println("ConcreateClassA:step1"); &#125;&#125;package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: å…·ä½“å®žçŽ°ç±»B */public class ConcreteClassB extends AbstractClass &#123; @Override protected void step2() &#123; System.out.println("ConcreateClassB:step2"); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client &#123; public static void main(String[] args) &#123; AbstractClass abc = new ConcreteClassA(); abc.templateMehthod(); abc = new ConcreteClassB(); abc.templateMehthod(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“é”æœºåˆ¶åŠäº‹åŠ¡éš”ç¦»çº§åˆ«]]></title>
    <url>%2Fposts%2F57a9974a.html</url>
    <content type="text"><![CDATA[å‰è¨€ ç”¨T1ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“æ‰§è¡Œè¯·æ±‚ï¼ŒT2ä»£è¡¨å¦ä¸€ä¸ªè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºT1ä¸ºä¸€ä¸ªçº¿ç¨‹ï¼ŒT2 ä¸ºå¦ä¸€ä¸ªçº¿ç¨‹ã€‚T3,T4ä»¥æ­¤ç±»æŽ¨ã€‚ é”çš„ç§ç±» å…±äº«é”(Shared lock) &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹1ï¼š 12T1: select * from table (è¯·æƒ³è±¡å®ƒéœ€è¦æ‰§è¡Œ1ä¸ªå°æ—¶ä¹‹ä¹…ï¼ŒåŽé¢çš„sqlè¯­å¥è¯·éƒ½è¿™ä¹ˆæƒ³è±¡ï¼‰T2: update table set column1=&apos;hello&apos; &lt;i class=&quot;fa fa-cog&quot;&gt;&lt;/i&gt; è¿‡ç¨‹ï¼š T1è¿è¡Œ ï¼ˆåŠ å…±äº«é”)T2è¿è¡ŒIf T1 è¿˜æ²¡æ‰§è¡Œå®ŒT2ç­‰......elseé”è¢«é‡Šæ”¾T2æ‰§è¡Œendif T2ä¹‹æ‰€ä»¥è¦ç­‰ï¼Œæ˜¯å› ä¸ºT2åœ¨æ‰§è¡Œupdateå‰ï¼Œè¯•å›¾å¯¹tableè¡¨åŠ ä¸€ä¸ªæŽ’ä»–é”ï¼Œè€Œæ•°æ®åº“è§„å®šåŒä¸€èµ„æºä¸Šä¸èƒ½åŒæ—¶å…±å­˜å…±äº«é”å’ŒæŽ’ä»–é”ã€‚æ‰€ä»¥T2å¿…é¡»ç­‰T1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†å…±äº«é”ï¼Œæ‰èƒ½åŠ ä¸ŠæŽ’ä»–é”ï¼Œç„¶åŽæ‰èƒ½å¼€å§‹æ‰§è¡Œupdateè¯­å¥ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹2ï¼š 12T1: select * from tableT2: select * from table è¿™é‡ŒT2ä¸ç”¨ç­‰å¾…T1æ‰§è¡Œå®Œï¼Œè€Œæ˜¯å¯ä»¥é©¬ä¸Šæ‰§è¡Œã€‚ &lt;i class=&quot;fa fa-cog&quot;&gt;&lt;/i&gt; åˆ†æžï¼š T1è¿è¡Œï¼Œåˆ™tableè¢«åŠ é”ï¼Œæ¯”å¦‚å«lockAï¼ŒT2è¿è¡Œï¼Œå†å¯¹tableåŠ ä¸€ä¸ªå…±äº«é”ï¼Œæ¯”å¦‚å«lockBã€‚ä¸¤ä¸ªé”æ˜¯å¯ä»¥åŒæ—¶å­˜åœ¨äºŽåŒä¸€èµ„æºä¸Šçš„ï¼ˆæ¯”å¦‚åŒä¸€ä¸ªè¡¨ä¸Šï¼‰ã€‚è¿™è¢«ç§°ä¸ºå…±äº«é”ä¸Žå…±äº«é”å…¼å®¹ã€‚è¿™æ„å‘³ç€å…±äº«é”ä¸é˜»æ­¢å…¶å®ƒsessionåŒæ—¶è¯»èµ„æºï¼Œä½†é˜»æ­¢å…¶å®ƒsession update &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹3ï¼š 123T1: select * from tableT2: select * from tableT3: update table set column1=&apos;hello&apos; è¿™æ¬¡ï¼ŒT2ä¸ç”¨ç­‰T1è¿è¡Œå®Œå°±èƒ½è¿è¡Œï¼ŒT3å´è¦ç­‰T1å’ŒT2éƒ½è¿è¡Œå®Œæ‰èƒ½è¿è¡Œã€‚ å› ä¸ºT3å¿…é¡»ç­‰T1å’ŒT2çš„å…±äº«é”å…¨éƒ¨é‡Šæ”¾æ‰èƒ½è¿›è¡ŒåŠ æŽ’ä»–é”ç„¶åŽæ‰§è¡Œupdateæ“ä½œã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹4ï¼šï¼ˆæ­»é”çš„å‘ç”Ÿï¼‰ 12345678T1:begin transelect * from table (holdlock) (holdlockæ„æ€æ˜¯åŠ å…±äº«é”ï¼Œç›´åˆ°äº‹ç‰©ç»“æŸæ‰é‡Šæ”¾)update table set column1=&apos;hello&apos;T2:begin transelect * from table(holdlock)update table set column1=&apos;world&apos; å‡è®¾T1å’ŒT2åŒæ—¶è¾¾åˆ°selectï¼ŒT1å¯¹tableåŠ å…±äº«é”ï¼ŒT2ä¹Ÿå¯¹åŠ å…±äº«é”ï¼Œå½“T1çš„selectæ‰§è¡Œå®Œï¼Œå‡†å¤‡æ‰§è¡Œupdateæ—¶ï¼Œæ ¹æ®é”æœºåˆ¶ï¼ŒT1çš„å…±äº«é”éœ€è¦å‡çº§åˆ°æŽ’ä»–é”æ‰èƒ½æ‰§è¡ŒæŽ¥ä¸‹æ¥çš„update.åœ¨å‡çº§æŽ’ä»–é”å‰ï¼Œå¿…é¡»ç­‰tableä¸Šçš„å…¶å®ƒå…±äº«é”é‡Šæ”¾ï¼Œä½†å› ä¸ºholdlockè¿™æ ·çš„å…±äº«é”åªæœ‰ç­‰äº‹åŠ¡ç»“æŸåŽæ‰é‡Šæ”¾ï¼Œæ‰€ä»¥å› ä¸ºT2çš„å…±äº«é”ä¸é‡Šæ”¾è€Œå¯¼è‡´T1ç­‰(ç­‰T2é‡Šæ”¾å…±äº«é”ï¼Œè‡ªå·±å¥½å‡çº§æˆæŽ’ä»–é”ï¼‰ï¼ŒåŒç†ï¼Œä¹Ÿå› ä¸ºT1çš„å…±äº«é”ä¸é‡Šæ”¾è€Œå¯¼è‡´T2ç­‰ã€‚æ­»é”äº§ç”Ÿäº†ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹5ï¼š 123456T1:begin tranupdate table set column1=&apos;hello&apos; where id=10T2:begin tranupdate table set column1=&apos;world&apos; where id=20 è¿™ç§è¯­å¥è™½ç„¶æœ€ä¸ºå¸¸è§ï¼Œå¾ˆå¤šäººè§‰å¾—å®ƒæœ‰æœºä¼šäº§ç”Ÿæ­»é”ï¼Œä½†å®žé™…ä¸Šè¦çœ‹æƒ…å†µï¼Œå¦‚æžœidæ˜¯ä¸»é”®ä¸Šé¢æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆT1ä¼šä¸€ä¸‹å­æ‰¾åˆ°è¯¥æ¡è®°å½•(id=10çš„è®°å½•ï¼‰ï¼Œç„¶åŽå¯¹è¯¥æ¡è®°å½•åŠ æŽ’ä»–é”ï¼ŒT2ï¼ŒåŒæ ·ï¼Œä¸€ä¸‹å­é€šè¿‡ç´¢å¼•å®šä½åˆ°è®°å½•ï¼Œç„¶åŽå¯¹id=20çš„è®°å½•åŠ æŽ’ä»–é”ï¼Œè¿™æ ·T1å’ŒT2å„æ›´æ–°å„çš„ï¼Œäº’ä¸å½±å“ã€‚T2ä¹Ÿä¸éœ€è¦ç­‰ã€‚ ä½†å¦‚æžœidæ˜¯æ™®é€šçš„ä¸€åˆ—ï¼Œæ²¡æœ‰ç´¢å¼•ã€‚é‚£ä¹ˆå½“T1å¯¹id=10è¿™ä¸€è¡ŒåŠ æŽ’ä»–é”åŽï¼ŒT2ä¸ºäº†æ‰¾åˆ°id=20ï¼Œéœ€è¦å¯¹å…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆå°±ä¼šé¢„å…ˆå¯¹è¡¨åŠ ä¸Šå…±äº«é”æˆ–æ›´æ–°é”æˆ–æŽ’ä»–é”(ä¾èµ–äºŽæ•°æ®åº“æ‰§è¡Œç­–ç•¥å’Œæ–¹å¼ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡æ‰§è¡Œå’Œç¬¬äºŒæ¬¡æ‰§è¡Œæ•°æ®åº“æ‰§è¡Œç­–ç•¥å°±ä¼šä¸åŒï¼‰ã€‚ä½†å› ä¸ºT1å·²ç»ä¸ºä¸€æ¡è®°å½•åŠ äº†æŽ’ä»–é”ï¼Œå¯¼è‡´T2çš„å…¨è¡¨æ‰«æè¿›è¡Œä¸ä¸‹åŽ»ï¼Œå°±å¯¼è‡´T2ç­‰å¾…ã€‚ æ­»é”æ€Žä¹ˆè§£å†³å‘¢ï¼Ÿä¸€ç§åŠžæ³•æ˜¯ï¼Œå¦‚ä¸‹ï¼š &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹6ï¼š 12345678T1:begin transelect * from table(xlock) (xlockæ„æ€æ˜¯ç›´æŽ¥å¯¹è¡¨åŠ æŽ’ä»–é”)update table set column1=&apos;hello&apos;T2:begin transelect * from table(xlock)update table set column1=&apos;world&apos; å½“T1çš„select æ‰§è¡Œæ—¶ï¼Œç›´æŽ¥å¯¹è¡¨åŠ ä¸Šäº†æŽ’ä»–é”ï¼ŒT2åœ¨æ‰§è¡Œselectæ—¶ï¼Œå°±éœ€è¦ç­‰T1äº‹åŠ¡å®Œå…¨æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œã€‚æŽ’é™¤äº†æ­»é”å‘ç”Ÿã€‚ä½†å½“ç¬¬ä¸‰ä¸ªuserè¿‡æ¥æƒ³æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ—¶ï¼Œä¹Ÿå› ä¸ºæŽ’ä»–é”çš„å­˜åœ¨è€Œä¸å¾—ä¸ç­‰å¾…ï¼Œç¬¬å››ä¸ªã€ç¬¬äº”ä¸ªuserä¹Ÿä¼šå› æ­¤è€Œç­‰å¾…ã€‚åœ¨å¤§å¹¶å‘æƒ…å†µä¸‹ï¼Œè®©å¤§å®¶ç­‰å¾…æ˜¾å¾—æ€§èƒ½å°±å¤ªå‹å¥½äº†ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¼•å…¥äº†æ›´æ–°é”ã€‚ æ›´æ–°é”(Update lock) ä¸ºè§£å†³æ­»é”ï¼Œå¼•å…¥æ›´æ–°é”ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹7ï¼š 12345678T1:begin transelect * from table(updlock) (åŠ æ›´æ–°é”)update table set column1=&apos;hello&apos;T2:begin transelect * from table(updlock)update table set column1=&apos;world&apos; æ›´æ–°é”çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘çŽ°åœ¨åªæƒ³è¯»ï¼Œä½ ä»¬åˆ«äººä¹Ÿå¯ä»¥è¯»ï¼Œä½†æˆ‘å°†æ¥å¯èƒ½ä¼šåšæ›´æ–°æ“ä½œï¼Œæˆ‘å·²ç»èŽ·å–äº†ä»Žå…±äº«é”ï¼ˆç”¨æ¥è¯»ï¼‰åˆ°æŽ’ä»–é”ï¼ˆç”¨æ¥æ›´æ–°ï¼‰çš„èµ„æ ¼â€ã€‚ä¸€ä¸ªäº‹ç‰©åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°é”èŽ·æ­¤èµ„æ ¼ã€‚ T1æ‰§è¡Œselectï¼ŒåŠ æ›´æ–°é”ã€‚ T2è¿è¡Œï¼Œå‡†å¤‡åŠ æ›´æ–°é”ï¼Œä½†å‘çŽ°å·²ç»æœ‰ä¸€ä¸ªæ›´æ–°é”åœ¨é‚£å„¿äº†ï¼Œåªå¥½ç­‰ã€‚ å½“åŽæ¥æœ‰user3ã€user4...éœ€è¦æŸ¥è¯¢tableè¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šå› ä¸ºT1çš„selectåœ¨æ‰§è¡Œå°±è¢«é˜»å¡žï¼Œç…§æ ·èƒ½æŸ¥è¯¢ï¼Œç›¸æ¯”èµ·ä¾‹6ï¼Œè¿™æé«˜äº†æ•ˆçŽ‡ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹8ï¼š 123T1: select * from table(updlock) (åŠ æ›´æ–°é”ï¼‰T2: select * from table(updlock) (ç­‰å¾…ï¼Œç›´åˆ°T1é‡Šæ”¾æ›´æ–°é”ï¼Œå› ä¸ºåŒä¸€æ—¶é—´ä¸èƒ½åœ¨åŒä¸€èµ„æºä¸Šæœ‰ä¸¤ä¸ªæ›´æ–°é”ï¼‰T3: select * from table (åŠ å…±äº«é”ï¼Œä½†ä¸ç”¨ç­‰updlocké‡Šæ”¾ï¼Œå°±å¯ä»¥è¯»ï¼‰ è¿™ä¸ªä¾‹å­æ˜¯è¯´æ˜Žï¼šå…±äº«é”å’Œæ›´æ–°é”å¯ä»¥åŒæ—¶åœ¨åŒä¸€ä¸ªèµ„æºä¸Šã€‚è¿™è¢«ç§°ä¸ºå…±äº«é”å’Œæ›´æ–°é”æ˜¯å…¼å®¹çš„ã€‚ æŽ’ä»–é”ï¼ˆç‹¬å é”ï¼ŒExclusive Locks) å…¶å®ƒäº‹åŠ¡æ—¢ä¸èƒ½è¯»ï¼Œåˆä¸èƒ½æ”¹æŽ’ä»–é”é”å®šçš„èµ„æºã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹9ï¼š 12345678T1:beginselect * from table(updlock) (åŠ æ›´æ–°é”ï¼‰update table set column1=&apos;hello&apos; (é‡ç‚¹ï¼šè¿™é‡ŒT1åšupdateæ—¶ï¼Œä¸éœ€è¦ç­‰T2é‡Šæ”¾ä»€ä¹ˆï¼Œè€Œæ˜¯ç›´æŽ¥æŠŠæ›´æ–°é”å‡çº§ä¸ºæŽ’ä»–é”ï¼Œç„¶åŽæ‰§è¡Œupdate)T2:beginselect * from table (T1åŠ çš„æ›´æ–°é”ä¸å½±å“T2è¯»å–ï¼‰update table set column1=&apos;world&apos; (T2çš„updateéœ€è¦ç­‰T1çš„updateåšå®Œæ‰èƒ½æ‰§è¡Œ) ç¬¬ä¸€ç§æƒ…å†µï¼šT1å…ˆè¾¾ï¼ŒT2ç´§æŽ¥åˆ°è¾¾ï¼›åœ¨è¿™ç§æƒ…å†µä¸­ï¼ŒT1å…ˆå¯¹è¡¨åŠ æ›´æ–°é”ï¼ŒT2å¯¹è¡¨åŠ å…±äº«é”ï¼Œå‡è®¾T2çš„selectå…ˆæ‰§è¡Œå®Œï¼Œå‡†å¤‡æ‰§è¡Œupdateï¼Œå‘çŽ°å·²æœ‰æ›´æ–°é”å­˜åœ¨ï¼ŒT2ç­‰ã€‚T1è¿™æ—¶æ‰æ‰§è¡Œå®Œselectï¼Œå‡†å¤‡æ‰§è¡Œupdateï¼Œæ›´æ–°é”å‡çº§ä¸ºæŽ’ä»–é”ï¼Œç„¶åŽæ‰§è¡Œupdateï¼Œæ‰§è¡Œå®Œæˆï¼Œäº‹åŠ¡ç»“æŸï¼Œé‡Šæ”¾é”ï¼ŒT2æ‰è½®åˆ°æ‰§è¡Œupdateã€‚ ç¬¬äºŒç§æƒ…å†µï¼šT2å…ˆè¾¾ï¼ŒT1ç´§æŽ¥è¾¾ï¼›åœ¨è¿™ç§æƒ…å†µï¼ŒT2å…ˆå¯¹è¡¨åŠ å…±äº«é”ï¼ŒT1åˆ°è¾¾åŽï¼ŒT1å¯¹è¡¨åŠ æ›´æ–°é”ï¼Œå‡è®¾T2 selectå…ˆç»“æŸï¼Œå‡†å¤‡updateï¼Œå‘çŽ°å·²æœ‰æ›´æ–°é”ï¼Œåˆ™ç­‰å¾…ï¼ŒåŽé¢æ­¥éª¤å°±è·Ÿç¬¬ä¸€ç§æƒ…å†µä¸€æ ·äº†ã€‚ è¿™ä¸ªä¾‹å­æ˜¯è¯´æ˜Žï¼šæŽ’ä»–é”ä¸Žæ›´æ–°é”æ˜¯ä¸å…¼å®¹çš„ï¼Œå®ƒä»¬ä¸èƒ½åŒæ—¶åŠ åœ¨åŒä¸€èµ„æºä¸Šã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹10ï¼š 12T1: update table set column1=&apos;hello&apos; where id&lt;1000T2: update table set column1=&apos;world&apos; where id&gt;1000 å‡è®¾T1å…ˆè¾¾ï¼ŒT2éšåŽè‡³ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­T1ä¼šå¯¹id&lt;1000çš„è®°å½•æ–½åŠ æŽ’ä»–é”.ä½†ä¸ä¼šé˜»å¡žT2çš„updateã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹11ï¼š(å‡è®¾idéƒ½æ˜¯è‡ªå¢žé•¿ä¸”è¿žç»­çš„ï¼‰ 12T1: update table set column1=&apos;hello&apos; where id&lt;1000T2: update table set column1=&apos;world&apos; where id&gt;900 å¦‚åŒä¾‹10ï¼ŒT1å…ˆè¾¾ï¼ŒT2ç«‹åˆ»ä¹Ÿåˆ°ï¼ŒT1åŠ çš„æŽ’ä»–é”ä¼šé˜»å¡žT2çš„updateã€‚ æ„å‘é”(Intent Locks) æ„å‘é”å°±æ˜¯è¯´åœ¨å±‹ï¼ˆæ¯”å¦‚ä»£è¡¨ä¸€ä¸ªè¡¨ï¼‰é—¨å£è®¾ç½®ä¸€ä¸ªæ ‡è¯†ï¼Œè¯´æ˜Žå±‹å­é‡Œæœ‰äººï¼ˆæ¯”å¦‚ä»£è¡¨æŸäº›è®°å½•ï¼‰è¢«é”ä½äº†ã€‚å¦ä¸€ä¸ªäººæƒ³çŸ¥é“å±‹å­é‡Œæ˜¯å¦æœ‰äººè¢«é”ï¼Œä¸ç”¨è¿›å±‹å­é‡Œä¸€ä¸ªä¸ªåŽ»æŸ¥ï¼Œç›´æŽ¥çœ‹é—¨å£æ ‡è¯†å°±è¡Œäº†ã€‚ å½“ä¸€ä¸ªè¡¨ä¸­çš„æŸä¸€è¡Œè¢«åŠ ä¸ŠæŽ’ä»–é”åŽï¼Œè¯¥è¡¨å°±ä¸èƒ½å†è¢«åŠ è¡¨é”ã€‚æ•°æ®åº“ç¨‹åºå¦‚ä½•çŸ¥é“è¯¥è¡¨ä¸èƒ½è¢«åŠ è¡¨é”ï¼Ÿä¸€ç§æ–¹å¼æ˜¯é€æ¡çš„åˆ¤æ–­è¯¥è¡¨çš„æ¯ä¸€æ¡è®°å½•æ˜¯å¦å·²ç»æœ‰æŽ’ä»–é”ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯ç›´æŽ¥åœ¨è¡¨è¿™ä¸€å±‚çº§æ£€æŸ¥è¡¨æœ¬èº«æ˜¯å¦æœ‰æ„å‘é”ï¼Œä¸éœ€è¦é€æ¡åˆ¤æ–­ã€‚æ˜¾ç„¶åŽè€…æ•ˆçŽ‡é«˜ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹12ï¼š 1234T1: begin transelect * from table (xlock) where id=10 --æ„æ€æ˜¯å¯¹id=10è¿™ä¸€è¡Œå¼ºåŠ æŽ’ä»–é”T2: begin transelect * from table (tablock) --æ„æ€æ˜¯è¦åŠ è¡¨çº§é” å‡è®¾T1å…ˆæ‰§è¡Œï¼ŒT2åŽæ‰§è¡Œï¼ŒT2æ‰§è¡Œæ—¶ï¼Œæ¬²åŠ è¡¨é”ï¼Œä¸ºåˆ¤æ–­æ˜¯å¦å¯ä»¥åŠ è¡¨é”ï¼Œæ•°æ®åº“ç³»ç»Ÿè¦é€æ¡åˆ¤æ–­tableè¡¨æ¯è¡Œè®°å½•æ˜¯å¦å·²æœ‰æŽ’ä»–é”ï¼Œå¦‚æžœå‘çŽ°å…¶ä¸­ä¸€è¡Œå·²ç»æœ‰æŽ’ä»–é”äº†ï¼Œå°±ä¸å…è®¸å†åŠ è¡¨é”äº†ã€‚åªæ˜¯è¿™æ ·é€æ¡åˆ¤æ–­æ•ˆçŽ‡å¤ªä½Žäº†ã€‚ å®žé™…ä¸Šï¼Œæ•°æ®åº“ç³»ç»Ÿä¸æ˜¯è¿™æ ·å·¥ä½œçš„ã€‚å½“T1çš„selectæ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿå¯¹è¡¨tableçš„id=10çš„è¿™ä¸€è¡ŒåŠ äº†æŽ’ä»–é”ï¼Œè¿˜åŒæ—¶æ‚„æ‚„çš„å¯¹æ•´ä¸ªè¡¨åŠ äº†æ„å‘æŽ’ä»–é”(IX)ï¼Œå½“T2æ‰§è¡Œè¡¨é”æ—¶ï¼Œåªéœ€è¦çœ‹åˆ°è¿™ä¸ªè¡¨å·²ç»æœ‰æ„å‘æŽ’ä»–é”å­˜åœ¨ï¼Œå°±ç›´æŽ¥ç­‰å¾…ï¼Œè€Œä¸éœ€è¦é€æ¡æ£€æŸ¥èµ„æºäº†ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹13ï¼š 1234T1: begin tranupdate table set column1=&apos;hello&apos; where id=1T2: begin tranupdate table set column1=&apos;world&apos; where id=1 è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„ä¾‹å­å®žé™…æ•ˆæžœç›¸åŒï¼ŒT1æ‰§è¡Œï¼Œç³»ç»ŸåŒæ—¶å¯¹è¡ŒåŠ æŽ’ä»–é”ã€å¯¹é¡µåŠ æ„å‘æŽ’ä»–é”ã€å¯¹è¡¨åŠ æ„å‘æŽ’ä»–é”ã€‚ è®¡åˆ’é”(Schema Locks) &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹14ï¼š 1alter table .... (åŠ schema locksï¼Œç§°ä¹‹ä¸ºSchema modification (Sch-M) locks DDLè¯­å¥éƒ½ä¼šåŠ Sch-Mé”ï¼Œè¯¥é”ä¸å…è®¸ä»»ä½•å…¶å®ƒsessionè¿žæŽ¥è¯¥è¡¨ã€‚è¿žéƒ½è¿žä¸äº†è¿™ä¸ªè¡¨äº†ï¼Œå½“ç„¶æ›´ä¸ç”¨è¯´æƒ³å¯¹è¯¥è¡¨æ‰§è¡Œä»€ä¹ˆsqlè¯­å¥äº†ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹15ï¼š ç”¨jdbcå‘æ•°æ®åº“å‘é€äº†ä¸€æ¡æ–°çš„sqlè¯­å¥ï¼Œæ•°æ®åº“è¦å…ˆå¯¹ä¹‹è¿›è¡Œç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼Œä¹Ÿä¼šåŠ é”ï¼Œç§°ä¹‹ä¸ºï¼šSchema stability (Sch-S) locksã€‚ 1select * from tableA ç¼–è¯‘è¿™æ¡è¯­å¥è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒsessionå¯ä»¥å¯¹è¡¨tableAåšä»»ä½•æ“ä½œ(update,deleteï¼ŒåŠ æŽ’ä»–é”ç­‰ç­‰ï¼‰ï¼Œä½†ä¸èƒ½åšDDL(æ¯”å¦‚alter table)æ“ä½œã€‚ Bulk Update Locks ä¸»è¦åœ¨æ‰¹é‡å¯¼æ•°æ®æ—¶ç”¨ï¼ˆæ¯”å¦‚ç”¨ç±»ä¼¼äºŽoracleä¸­çš„imp/expçš„bcpå‘½ä»¤ï¼‰ã€‚ ä½•æ—¶åŠ é” &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹16ï¼š 12345T1: begin tranupdate table set column1=&apos;hello&apos; where id=1T2: SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED -- äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå…è®¸è„è¯»select * from table where id=1 è¿™é‡Œï¼ŒT2çš„selectå¯ä»¥æŸ¥å‡ºç»“æžœã€‚å¦‚æžœäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è®¾ä¸ºè„è¯»ï¼Œåˆ™T2ä¼šç­‰T1äº‹åŠ¡æ‰§è¡Œå®Œæ‰èƒ½è¯»å‡ºç»“æžœã€‚ æ•°æ®åº“å¦‚ä½•è‡ªåŠ¨åŠ é”çš„ï¼Ÿ T1æ‰§è¡Œï¼Œæ•°æ®åº“è‡ªåŠ¨åŠ æŽ’ä»–é” T2æ‰§è¡Œï¼Œæ•°æ®åº“å‘çŽ°äº‹åŠ¡éš”ç¦»çº§åˆ«å…è®¸è„è¯»ï¼Œä¾¿ä¸åŠ å…±äº«é”ã€‚ä¸åŠ å…±äº«é”ï¼Œåˆ™ä¸ä¼šä¸Žå·²æœ‰çš„æŽ’ä»–é”å†²çªï¼Œæ‰€ä»¥å¯ä»¥è„è¯»ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹17ï¼š 123T1: begin tranupdate table set column1=&apos;hello&apos; where id=1T2: select * from table where id=1 â€“æœªæŒ‡å®šéš”ç¦»çº§åˆ«ï¼Œåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå®ƒä¸å…è®¸è„è¯» å¦‚æžœäº‹åŠ¡çº§åˆ«ä¸è®¾ä¸ºè„è¯»ï¼Œåˆ™ï¼šT1æ‰§è¡Œï¼Œæ•°æ®åº“è‡ªåŠ¨åŠ æŽ’ä»–é”T2æ‰§è¡Œï¼Œæ•°æ®åº“å‘çŽ°äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸å…è®¸è„è¯»ï¼Œä¾¿å‡†å¤‡ä¸ºæ­¤æ¬¡selectè¿‡ç¨‹åŠ å…±äº«é”ï¼Œä½†å‘çŽ°åŠ ä¸ä¸Šï¼Œå› ä¸ºå·²ç»æœ‰æŽ’ä»–é”äº†ï¼Œæ‰€ä»¥å°±ç­‰åˆ°T1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†æŽ’ä»–é”ï¼ŒT2æ‰åŠ ä¸Šäº†å…±äº«é”ï¼Œç„¶åŽå¼€å§‹è¯».... é”çš„ç²’åº¦ é”çš„ç²’åº¦å°±æ˜¯æŒ‡é”çš„ç”Ÿæ•ˆèŒƒå›´ï¼Œå°±æ˜¯è¯´æ˜¯è¡Œé”ï¼Œè¿˜æ˜¯é¡µé”ï¼Œè¿˜æ˜¯æ•´è¡¨é”. é”çš„ç²’åº¦åŒæ ·æ—¢å¯ä»¥ç”±æ•°æ®åº“è‡ªåŠ¨ç®¡ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰‹å·¥æŒ‡å®šhintæ¥ç®¡ç†ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹18ï¼š 12T1: select * from table (paglock)T2: update table set column1=&apos;hello&apos; where id&gt;10 T1æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆå¯¹ç¬¬ä¸€é¡µåŠ é”ï¼Œè¯»å®Œç¬¬ä¸€é¡µåŽï¼Œé‡Šæ”¾é”ï¼Œå†å¯¹ç¬¬äºŒé¡µåŠ é”ï¼Œä¾æ­¤ç±»æŽ¨ã€‚å‡è®¾å‰10è¡Œè®°å½•æ°å¥½æ˜¯ä¸€é¡µ(å½“ç„¶ï¼Œä¸€èˆ¬ä¸å¯èƒ½ä¸€é¡µåªæœ‰10è¡Œè®°å½•ï¼‰ï¼Œé‚£ä¹ˆT1æ‰§è¡Œåˆ°ç¬¬ä¸€é¡µæŸ¥è¯¢æ—¶ï¼Œå¹¶ä¸ä¼šé˜»å¡žT2çš„æ›´æ–°ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹19ï¼š 12T1: select * from table (rowlock)T2: update table set column1=&apos;hello&apos; where id=10 T1æ‰§è¡Œæ—¶ï¼Œå¯¹æ¯è¡ŒåŠ å…±äº«é”ï¼Œè¯»å–ï¼Œç„¶åŽé‡Šæ”¾ï¼Œå†å¯¹ä¸‹ä¸€è¡ŒåŠ é”;T2æ‰§è¡Œæ—¶ï¼Œä¼šå¯¹id=10çš„é‚£ä¸€è¡Œè¯•å›¾åŠ é”ï¼Œåªè¦è¯¥è¡Œæ²¡æœ‰è¢«T1åŠ ä¸Šè¡Œé”ï¼ŒT2å°±å¯ä»¥é¡ºåˆ©æ‰§è¡Œupdateæ“ä½œã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹20ï¼š 12T1: select * from table (tablock)T2: update table set column1=&apos;hello&apos; where id = 10 T1æ‰§è¡Œï¼Œå¯¹æ•´ä¸ªè¡¨åŠ å…±äº«é”. T1å¿…é¡»å®Œå…¨æŸ¥è¯¢å®Œï¼ŒT2æ‰å¯ä»¥å…è®¸åŠ é”ï¼Œå¹¶å¼€å§‹æ›´æ–°ã€‚ é”ä¸Žäº‹åŠ¡éš”ç¦»çº§åˆ«çš„ä¼˜å…ˆçº§ æ‰‹å·¥æŒ‡å®šçš„é”ä¼˜å…ˆã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹21ï¼š 1234567T1: SET TRANSACTION ISOLATION LEVEL SERIALIZABLEBEGIN TRANSACTIONSELECT * FROM table (NOLOCK)T2: update table set column1=&apos;hello&apos; where id=10 T1æ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºæœ€é«˜çº§ï¼Œä¸²è¡Œé”ï¼Œæ•°æ®åº“ç³»ç»Ÿæœ¬åº”å¯¹åŽé¢çš„selectè¯­å¥è‡ªåŠ¨åŠ è¡¨çº§é”ï¼Œä½†å› ä¸ºæ‰‹å·¥æŒ‡å®šäº†NOLOCKï¼Œæ‰€ä»¥è¯¥selectè¯­å¥ä¸ä¼šåŠ ä»»ä½•é”ï¼Œæ‰€ä»¥T2ä¹Ÿå°±ä¸ä¼šæœ‰ä»»ä½•é˜»å¡žã€‚ æ•°æ®åº“å…¶ä»–é”åŠå…¶åŒºåˆ« holdlock å¯¹è¡¨åŠ å…±äº«é”ï¼Œä¸”äº‹åŠ¡ï¼ˆcommit/rollbackï¼‰ä¸å®Œæˆï¼Œå…±äº«é”ä¸é‡Šæ”¾ã€‚ tablock å¯¹è¡¨åŠ å…±äº«é”ï¼Œåªè¦statementä¸å®Œæˆï¼Œå…±äº«é”ä¸é‡Šæ”¾ã€‚ tablock &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹22ï¼š 123456T1:begin transelect * from table (tablock)T2:begin tranupdate table set column1=&apos;hello&apos; where id = 10 T1æ‰§è¡Œå®Œselectï¼Œå°±ä¼šé‡Šæ”¾å…±äº«é”ï¼Œç„¶åŽT2å°±å¯ä»¥æ‰§è¡Œupdateã€‚ holdlock &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹23ï¼š 123456T1:begin transelect * from table (holdlock)T2:begin tranupdate table set column1=&apos;hello&apos; where id = 10 T1æ‰§è¡Œå®Œselectï¼Œå…±äº«é”ä»ç„¶ä¸ä¼šé‡Šæ”¾ï¼Œä»ç„¶ä¼šè¢«hold(æŒæœ‰ï¼‰ï¼ŒT2ä¹Ÿå› æ­¤å¿…é¡»ç­‰å¾…è€Œä¸èƒ½update. å½“T1æœ€åŽæ‰§è¡Œäº†commitæˆ–rollbackè¯´æ˜Žè¿™ä¸€ä¸ªäº‹åŠ¡ç»“æŸäº†ï¼ŒT2æ‰å–å¾—æ‰§è¡Œæƒã€‚ TABLOCKX å¯¹è¡¨åŠ æŽ’ä»–é” &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹24ï¼š 1T1: select * from table(tablockx) (å¼ºè¡ŒåŠ æŽ’ä»–é”ï¼‰ å…¶å®ƒsessionå°±æ— æ³•å¯¹è¿™ä¸ªè¡¨è¿›è¡Œè¯»å’Œæ›´æ–°äº†ï¼Œé™¤éžT1æ‰§è¡Œå®Œäº†ï¼Œå°±ä¼šè‡ªåŠ¨é‡Šæ”¾æŽ’ä»–é”ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹25ï¼š 12T1: begin transelect * from table(tablockx) å•å•selectæ‰§è¡Œå®Œè¿˜ä¸è¡Œï¼Œå¿…é¡»æ•´ä¸ªäº‹åŠ¡å®Œæˆï¼ˆcommitæˆ–rollbackåŽï¼‰æ‰ä¼šé‡Šæ”¾æŽ’ä»–é”ã€‚ xlock åŠ æŽ’ä»–é” &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹26ï¼š 1select * from table(xlock paglock) å¯¹pageåŠ æŽ’ä»–é” xlockè¿˜å¯è¿™ä¹ˆç”¨ï¼š 1select * from table(xlock tablock) æ•ˆæžœç­‰åŒäºŽ 1select * from table(tablockx) é”çš„è¶…æ—¶ç­‰å¾… SET LOCK_TIMEOUT 4000 ç”¨æ¥è®¾ç½®é”ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œ4000æ„å‘³ç€ç­‰å¾…4ç§’å¯ä»¥ç”¨select @@LOCK_TIMEOUTæŸ¥çœ‹å½“å‰sessionçš„é”è¶…æ—¶è®¾ç½®ã€‚-1 æ„å‘³ç€æ°¸è¿œç­‰å¾…ã€‚ &lt;i class=&quot;fa fa-pencil&quot;&gt;&lt;/i&gt; ä¾‹27ï¼š 1234T1: begin tranudpate table set column1=&apos;hello&apos; where id = 10T2: set lock_timeout 4000select * from table wehre id = 10 T2æ‰§è¡Œæ—¶ï¼Œä¼šç­‰å¾…T1é‡Šæ”¾æŽ’ä»–é”ï¼Œç­‰äº†4ç§’é’Ÿï¼Œå¦‚æžœT1è¿˜æ²¡æœ‰é‡Šæ”¾æŽ’ä»–é”ï¼ŒT2å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š Lock request time out period exceededã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ« SQLæ ‡å‡†è§„å®šäº†å››ä¸ªéš”ç¦»æ°´å¹³ï¼š READ_UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰ ï¼šäº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥çœ‹å¾—åˆ°ï¼Œä¼šå¯¼è‡´â€œè„è¯»â€ã€â€œå¹»è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€ã€‚READ_COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰ï¼šå¤§å¤šæ•°ä¸»æµæ•°æ®åº“çš„é»˜è®¤äº‹åŠ¡ç­‰çº§ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šè¯»åˆ°å¦ä¸€ä¸ªå¹¶è¡Œäº‹åŠ¡å·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œé¿å…äº†â€œè„è¯»â€ï¼Œä½†ä¸èƒ½é¿å…â€œå¹»è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€ã€‚è¯¥çº§åˆ«é€‚ç”¨äºŽå¤§å¤šæ•°ç³»ç»Ÿï¼Œå¦‚Oracleã€SQLServerç­‰ã€‚REPETABLE_READï¼ˆé‡å¤è¯»ï¼‰ ï¼šä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šä¿®æ”¹å·²ç»ç”±å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–ä½†æœªæäº¤ï¼ˆå›žæ»šï¼‰çš„æ•°æ®ã€‚é¿å…äº†â€œè„è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€çš„æƒ…å†µï¼Œä½†ä¸èƒ½é¿å…â€œå¹»è¯»â€ã€‚MySQLé»˜è®¤å°±æ˜¯è¿™ç§éš”ç¦»çº§åˆ«ã€‚SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰ï¼šæœ€ä¸¥æ ¼çš„çº§åˆ«ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œèµ„æºæ¶ˆè€—æœ€å¤§ï¼› è„è¯» è„è¯»å‘ç”Ÿåœ¨ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å…è®¸è¯»å–ä¸€ä¸ªè¢«å…¶ä»–äº‹åŠ¡æ”¹å˜ä½†æ˜¯æœªæäº¤çš„çŠ¶æ€æ—¶ï¼Œè¿™æ˜¯å› ä¸ºå¹¶æ²¡æœ‰é”é˜»æ­¢è¯»å–ã€‚ å¦‚ä¸Šå›¾ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–äº†ä¸€ä¸ªå¹¶ä¸ä¸€è‡´çš„å€¼ã€‚ä¸ä¸€è‡´çš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªå€¼æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºä¿®æ”¹è¿™ä¸ªå€¼çš„ç¬¬ä¸€ä¸ªäº‹åŠ¡å·²ç»å›žæ»šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œä½†æ˜¯æœªæäº¤ç¡®è®¤ï¼Œå´è¢«ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡åˆæ”¾å¼ƒä¿®æ”¹ï¼Œè€Œç¬¬äºŒä¸ªäº‹åŠ¡å°±å¾—åˆ°ä¸€ä¸ªè„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯» åå¤è¯»åŒä¸€ä¸ªæ•°æ®å´å¾—åˆ°ä¸åŒçš„ç»“æžœï¼Œè¿™æ˜¯å› ä¸ºåœ¨åå¤å‡ æ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬ä½¿ç”¨äº†staleæ•°æ®ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªå…±äº«è¯»é”æ¥é¿å…ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«READ_COMMITTEDä¼šå¯¼è‡´å¯é‡å¤è¯»çš„åŽŸå› ã€‚è®¾ç½®å…±äº«è¯»é”ä¹Ÿå°±æ˜¯éš”ç¦»çº§åˆ«æé«˜åˆ°REPETABLE_READã€‚ å¹»è¯» å½“ç¬¬äºŒä¸ªäº‹åŠ¡æ’å…¥ä¸€è¡Œè®°å½•ï¼Œè€Œæ­£å¥½ä¹‹å‰ç¬¬ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†åº”è¯¥åŒ…å«è¿™ä¸ªæ–°çºªå½•çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢äº‹åŠ¡çš„ç»“æžœé‡Œè‚¯å®šæ²¡æœ‰åŒ…å«è¿™ä¸ªåˆšåˆšæ–°æ’å…¥çš„æ•°æ®ï¼Œè¿™æ—¶å¹»å½±è¯»å‘ç”Ÿäº†ï¼Œé€šè¿‡å˜åŒ–é”å’Œpredicate lockingé¿å…ã€‚ æ€»ç»“ ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«æ˜¯ï¼šå‰è€…æ˜¯æŒ‡è¯»åˆ°äº†å·²ç»æäº¤çš„äº‹åŠ¡çš„æ›´æ”¹æ•°æ®ï¼ˆupdateæˆ–deleteï¼‰ï¼ŒåŽè€…æ˜¯æŒ‡è¯»åˆ°äº†å…¶ä»–å·²ç»æäº¤äº‹åŠ¡çš„æ–°å¢žæ•°æ®ï¼ˆinsertï¼‰ã€‚ å¯¹äºŽè¿™ä¸¤ç§é—®é¢˜è§£å†³é‡‡ç”¨ä¸åŒçš„åŠžæ³•ï¼Œé˜²æ­¢è¯»åˆ°æ›´æ”¹æ•°æ®ï¼Œåªéœ€å¯¹æ“ä½œçš„æ•°æ®æ·»åŠ è¡Œçº§é”ï¼Œé˜²æ­¢æ“ä½œä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼› é˜²æ­¢è¯»åˆ°æ–°å¢žæ•°æ®ï¼Œå¾€å¾€éœ€è¦æ·»åŠ è¡¨çº§é”ï¼Œå°†æ•´å¼ è¡¨é”å®šï¼Œé˜²æ­¢æ–°å¢žæ•°æ®ï¼ˆoracleé‡‡ç”¨å¤šç‰ˆæœ¬æ•°æ®çš„æ–¹å¼å®žçŽ°ï¼‰ã€‚ READ_COMMITED æ˜¯æ¯”è¾ƒæ­£ç¡®çš„é€‰æ‹©ï¼Œå› ä¸ºSERIALIZABLEè™½ç„¶èƒ½åœ¨ä¸åŒäº‹åŠ¡å‘ç”Ÿæ—¶é¿å…staleæ•°æ®ï¼Œä¹Ÿå°±æ˜¯é¿å…ä¸Šè¿°ä¸¢å¤±åˆšåˆšä¿®æ”¹çš„æ•°æ®ï¼Œä½†æ˜¯æ€§èƒ½æ˜¯æœ€ä½Žçš„ï¼Œå› ä¸ºæ˜¯ä¸€ç§æœ€å¤§åŒ–çš„ä¸²è¡Œã€‚]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-10ä¹‹-çº¿ç¨‹ä¼˜å…ˆçº§å’Œå®ˆæŠ¤çº¿ç¨‹]]></title>
    <url>%2Fposts%2Ffc4de834.html</url>
    <content type="text"><![CDATA[çº¿ç¨‹ä¼˜å…ˆçº§ java ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯1ï½ž10ï¼Œé»˜è®¤çš„ä¼˜å…ˆçº§æ˜¯5ã€‚â€œé«˜ä¼˜å…ˆçº§çº¿ç¨‹â€ä¼šä¼˜å…ˆäºŽâ€œä½Žä¼˜å…ˆçº§çº¿ç¨‹â€æ‰§è¡Œã€‚ java ä¸­æœ‰ä¸¤ç§çº¿ç¨‹ï¼šç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡isDaemon()æ–¹æ³•æ¥åŒºåˆ«å®ƒä»¬ï¼šå¦‚æžœè¿”å›žfalseï¼Œåˆ™è¯´æ˜Žè¯¥çº¿ç¨‹æ˜¯â€œç”¨æˆ·çº¿ç¨‹â€ï¼›å¦åˆ™å°±æ˜¯â€œå®ˆæŠ¤çº¿ç¨‹â€ã€‚ ç”¨æˆ·çº¿ç¨‹ä¸€èˆ¬ç”¨æˆ·æ‰§è¡Œç”¨æˆ·çº§ä»»åŠ¡ï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±æ˜¯â€œåŽå°çº¿ç¨‹â€ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡ŒåŽå°ä»»åŠ¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šJavaè™šæ‹Ÿæœºåœ¨â€œç”¨æˆ·çº¿ç¨‹â€éƒ½ç»“æŸåŽä¼šåŽé€€å‡ºã€‚ JDK ä¸­å…³äºŽçº¿ç¨‹ä¼˜å…ˆçº§å’Œå®ˆæŠ¤çº¿ç¨‹çš„ä»‹ç»å¦‚ä¸‹ï¼š 1234567Every thread has a priority. Threads with higher priority are executed in preference to threads with lower priority. Each thread may or may not also be marked as a daemon. When code running in some thread creates a new Thread object, the new thread has its priority initially set equal to the priority of the creating thread, and is a daemon thread if and only if the creating thread is a daemon.When a Java Virtual Machine starts up, there is usually a single non-daemon thread (which typically calls the method named main of some designated class). The Java Virtual Machine continues to execute threads until either of the following occurs:The exit method of class Runtime has been called and the security manager has permitted the exit operation to take place.All threads that are not daemon threads have died, either by returning from the call to the run method or by throwing an exception that propagates beyond the run method. Marks this thread as either a daemon thread or a user thread. The Java Virtual Machine exits when the only threads running are all daemon threads. å¤§è‡´æ„æ€æ˜¯ï¼š 1234567æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ã€‚â€œé«˜ä¼˜å…ˆçº§çº¿ç¨‹â€ä¼šä¼˜å…ˆäºŽâ€œä½Žä¼˜å…ˆçº§çº¿ç¨‹â€æ‰§è¡Œã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è¢«æ ‡è®°ä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹æˆ–éžå®ˆæŠ¤è¿›ç¨‹ã€‚åœ¨ä¸€äº›è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸­åˆ›å»ºæ–°çš„å­çº¿ç¨‹æ—¶ï¼Œå­çº¿ç¨‹çš„ä¼˜å…ˆçº§è¢«è®¾ç½®ä¸ºç­‰äºŽâ€œåˆ›å»ºå®ƒçš„ä¸»çº¿ç¨‹çš„ä¼˜å…ˆçº§â€ï¼Œå½“ä¸”ä»…å½“â€œåˆ›å»ºå®ƒçš„ä¸»çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹â€æ—¶â€œå­çº¿ç¨‹æ‰ä¼šæ˜¯å®ˆæŠ¤çº¿ç¨‹â€ã€‚å½“Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªå•ä¸€çš„éžå®ˆæŠ¤çº¿ç¨‹ï¼ˆè¯¥çº¿ç¨‹é€šè¿‡æ˜¯é€šè¿‡main()æ–¹æ³•å¯åŠ¨ï¼‰ã€‚JVMä¼šä¸€ç›´è¿è¡Œç›´åˆ°ä¸‹é¢çš„ä»»æ„ä¸€ä¸ªæ¡ä»¶å‘ç”Ÿï¼ŒJVMå°±ä¼šç»ˆæ­¢è¿è¡Œï¼š(01) è°ƒç”¨äº†exit()æ–¹æ³•ï¼Œå¹¶ä¸”exit()æœ‰æƒé™è¢«æ­£å¸¸æ‰§è¡Œã€‚(02) æ‰€æœ‰çš„â€œéžå®ˆæŠ¤çº¿ç¨‹â€éƒ½æ­»äº†(å³JVMä¸­ä»…ä»…åªæœ‰â€œå®ˆæŠ¤çº¿ç¨‹â€)ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½è¢«æ ‡è®°ä¸ºâ€œå®ˆæŠ¤çº¿ç¨‹â€æˆ–â€œç”¨æˆ·çº¿ç¨‹â€ã€‚å½“åªæœ‰å®ˆæŠ¤çº¿ç¨‹è¿è¡Œæ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºã€‚ çº¿ç¨‹ä¼˜å…ˆçº§çš„ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940package main.java.com.study.thread.priority;/** * @author: whb * @description: çº¿ç¨‹ä¼˜å…ˆçº§æµ‹è¯• */public class PriorityDemo &#123; public static void main(String[] args) &#123; System.out.println(Thread.currentThread().getName() + "(" + Thread.currentThread().getPriority() + ")"); // æ–°å»ºçº¿ç¨‹t1 Thread t1 = new MyThread("t1"); // æ–°å»ºçº¿ç¨‹t2 Thread t2 = new MyThread("t2"); // è®¾ç½®t1çš„ä¼˜å…ˆçº§ä¸º1 t1.setPriority(1); // è®¾ç½®t2çš„ä¼˜å…ˆçº§ä¸º10 t2.setPriority(10); // å¯åŠ¨t1 t1.start(); // å¯åŠ¨t2 t2.start(); &#125;&#125;class MyThread extends Thread &#123; public MyThread(String name) &#123; super(name); &#125; @Override public void run() &#123; for (int i = 0; i &lt; 5; i++) &#123; System.out.println(Thread.currentThread().getName() + "(" + Thread.currentThread().getPriority() + ")" + ", loop " + i); &#125; &#125;&#125;; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234567891011main(5)t1(1), loop 0t2(10), loop 0t1(1), loop 1t1(1), loop 2t1(1), loop 3t2(10), loop 1t1(1), loop 4t2(10), loop 2t2(10), loop 3t2(10), loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainçš„ä¼˜å…ˆçº§æ˜¯5ã€‚ t1çš„ä¼˜å…ˆçº§è¢«è®¾ä¸º1ï¼Œè€Œt2çš„ä¼˜å…ˆçº§è¢«è®¾ä¸º10ã€‚cpuåœ¨æ‰§è¡Œt1å’Œt2çš„æ—¶å€™ï¼Œæ ¹æ®æ—¶é—´ç‰‡è½®å¾ªè°ƒåº¦ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œã€‚ å®ˆæŠ¤çº¿ç¨‹çš„ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.thread.priority;/** * @author: whb * @description: å®ˆæŠ¤çº¿ç¨‹ç¤ºä¾‹ */public class DaemonDemo &#123; public static void main(String[] args) &#123; System.out.println(Thread.currentThread().getName() + "(isDaemon=" + Thread.currentThread().isDaemon() + ")"); // æ–°å»ºçº¿ç¨‹t1 Thread t1 = new MyThread2("t1"); // æ–°å»ºçº¿ç¨‹t2 Thread t2 = new MyDaemon("t2"); // è®¾ç½®t2ä¸ºå®ˆæŠ¤çº¿ç¨‹ t2.setDaemon(true); // å¯åŠ¨t1 t1.start(); // å¯åŠ¨t2 t2.start(); &#125;&#125;class MyThread2 extends Thread &#123; public MyThread2(String name) &#123; super(name); &#125; @Override public void run() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(3); System.out.println(this.getName() + "(isDaemon=" + this.isDaemon() + ")" + ", loop " + i); &#125; &#125; catch (InterruptedException e) &#123; &#125; &#125;&#125;;class MyDaemon extends Thread &#123; public MyDaemon(String name) &#123; super(name); &#125; @Override public void run() &#123; try &#123; for (int i = 0; i &lt; 10000; i++) &#123; Thread.sleep(1); System.out.println(this.getName() + "(isDaemon=" + this.isDaemon() + ")" + ", loop " + i); &#125; &#125; catch (InterruptedException e) &#123; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910111213141516main(isDaemon=false)t2(isDaemon=true), loop 0t2(isDaemon=true), loop 1t1(isDaemon=false), loop 0t2(isDaemon=true), loop 2t1(isDaemon=false), loop 1t2(isDaemon=true), loop 3t2(isDaemon=true), loop 4t1(isDaemon=false), loop 2t2(isDaemon=true), loop 5t2(isDaemon=true), loop 6t2(isDaemon=true), loop 7t1(isDaemon=false), loop 3t2(isDaemon=true), loop 8t2(isDaemon=true), loop 9t1(isDaemon=false), loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå®ƒåˆ›å»ºçš„å­çº¿ç¨‹t1ä¹Ÿæ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚ t2æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚åœ¨â€œä¸»çº¿ç¨‹mainâ€å’Œâ€œå­çº¿ç¨‹t1â€(å®ƒä»¬éƒ½æ˜¯ç”¨æˆ·çº¿ç¨‹)æ‰§è¡Œå®Œæ¯•ï¼Œåªå‰©t2è¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹çš„æ—¶å€™ï¼ŒJVMè‡ªåŠ¨é€€å‡ºã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-09ä¹‹-çº¿ç¨‹ä¸­æ–­å’Œç»ˆæ­¢æ–¹å¼]]></title>
    <url>%2Fposts%2Fbafe248a.html</url>
    <content type="text"><![CDATA[interrupt()è¯´æ˜Ž å…³äºŽinterrupt()ï¼Œjavaçš„djkæ–‡æ¡£æè¿°å¦‚ä¸‹ï¼šhttp://docs.oracle.com/javase/7/docs/api/ Interrupts this thread. Unless the current thread is interrupting itself, which is always permitted, the checkAccess method of this thread is invoked, which may cause a SecurityException to be thrown. If this thread is blocked in an invocation of the wait(), wait(long), or wait(long, int) methods of the Object class, or of the join(), join(long), join(long, int), sleep(long), or sleep(long, int), methods of this class, then its interrupt status will be cleared and it will receive an InterruptedException. If this thread is blocked in an I/O operation upon an interruptible channel then the channel will be closed, the thread's interrupt status will be set, and the thread will receive a ClosedByInterruptException. If this thread is blocked in a Selector then the thread's interrupt status will be set and it will return immediately from the selection operation, possibly with a non-zero value, just as if the selector's wakeup method were invoked. If none of the previous conditions hold then this thread's interrupt status will be set. Interrupting a thread that is not alive need not have any effect. å¤§è‡´æ„æ€æ˜¯ï¼š interrupt()çš„ä½œç”¨æ˜¯ä¸­æ–­æœ¬çº¿ç¨‹ã€‚ æœ¬çº¿ç¨‹ä¸­æ–­è‡ªå·±æ˜¯è¢«å…è®¸çš„ï¼›å…¶å®ƒçº¿ç¨‹è°ƒç”¨æœ¬çº¿ç¨‹çš„interrupt()æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡checkAccess()æ£€æŸ¥æƒé™ã€‚è¿™æœ‰å¯èƒ½æŠ›å‡ºSecurityExceptionå¼‚å¸¸ã€‚ å¦‚æžœæœ¬çº¿ç¨‹æ˜¯å¤„äºŽé˜»å¡žçŠ¶æ€ï¼šè°ƒç”¨çº¿ç¨‹çš„wait(), wait(long)æˆ–wait(long, int)ä¼šè®©å®ƒè¿›å…¥ç­‰å¾…(é˜»å¡ž)çŠ¶æ€ï¼Œæˆ–è€…è°ƒç”¨çº¿ç¨‹çš„join(), join(long), join(long, int), sleep(long), sleep(long, int)ä¹Ÿä¼šè®©å®ƒè¿›å…¥é˜»å¡žçŠ¶æ€ã€‚è‹¥çº¿ç¨‹åœ¨é˜»å¡žçŠ¶æ€æ—¶ï¼Œè°ƒç”¨äº†å®ƒçš„interrupt()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„â€œä¸­æ–­çŠ¶æ€â€ä¼šè¢«æ¸…é™¤å¹¶ä¸”ä¼šæ”¶åˆ°ä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹é€šè¿‡wait()è¿›å…¥é˜»å¡žçŠ¶æ€ï¼Œæ­¤æ—¶é€šè¿‡interrupt()ä¸­æ–­è¯¥çº¿ç¨‹ï¼›è°ƒç”¨interrupt()ä¼šç«‹å³å°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºâ€œtrueâ€ï¼Œä½†æ˜¯ç”±äºŽçº¿ç¨‹å¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œæ‰€ä»¥è¯¥â€œä¸­æ–­æ ‡è®°â€ä¼šç«‹å³è¢«æ¸…é™¤ä¸ºâ€œfalseâ€ï¼ŒåŒæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªInterruptedExceptionçš„å¼‚å¸¸ã€‚ å¦‚æžœçº¿ç¨‹è¢«é˜»å¡žåœ¨ä¸€ä¸ªSelectoré€‰æ‹©å™¨ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­å®ƒæ—¶ï¼›çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”å®ƒä¼šç«‹å³ä»Žé€‰æ‹©æ“ä½œä¸­è¿”å›žã€‚ å¦‚æžœä¸å±žäºŽå‰é¢æ‰€è¯´çš„æƒ…å†µï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­çº¿ç¨‹æ—¶ï¼Œå®ƒçš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºâ€œtrueâ€ã€‚ ä¸­æ–­ä¸€ä¸ªâ€œå·²ç»ˆæ­¢çš„çº¿ç¨‹â€ä¸ä¼šäº§ç”Ÿä»»ä½•æ“ä½œã€‚ ç»ˆæ­¢çº¿ç¨‹çš„æ–¹å¼ ç»ˆæ­¢å¤„äºŽâ€œé˜»å¡žçŠ¶æ€â€çš„çº¿ç¨‹ é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡â€œä¸­æ–­â€æ–¹å¼ç»ˆæ­¢å¤„äºŽâ€œé˜»å¡žçŠ¶æ€â€çš„çº¿ç¨‹ã€‚ å½“çº¿ç¨‹ç”±äºŽè¢«è°ƒç”¨äº†sleep(), wait(), join()ç­‰æ–¹æ³•è€Œè¿›å…¥é˜»å¡žçŠ¶æ€ï¼›è‹¥æ­¤æ—¶è°ƒç”¨çº¿ç¨‹çš„interrupt()å°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºtrueã€‚ç”±äºŽå¤„äºŽé˜»å¡žçŠ¶æ€ï¼Œä¸­æ–­æ ‡è®°ä¼šè¢«æ¸…é™¤ï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚å°†InterruptedExceptionæ”¾åœ¨é€‚å½“çš„ä¸ºæ­¢å°±èƒ½ç»ˆæ­¢çº¿ç¨‹ï¼Œå½¢å¼å¦‚ä¸‹ï¼š 12345678910@Overridepublic void run() &#123; try &#123; while (true) &#123; // æ‰§è¡Œä»»åŠ¡... &#125; &#125; catch (InterruptedException ie) &#123; // ç”±äºŽäº§ç”ŸInterruptedExceptionå¼‚å¸¸ï¼Œé€€å‡ºwhile(true)å¾ªçŽ¯ï¼Œçº¿ç¨‹ç»ˆæ­¢ï¼ &#125;&#125; &lt;span id=&quot;inline-green&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-red&quot;&gt; åœ¨while(true)ä¸­ä¸æ–­çš„æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹å¤„äºŽé˜»å¡žçŠ¶æ€æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹çš„interrupt()äº§ç”ŸInterruptedExceptionä¸­æ–­ã€‚ä¸­æ–­çš„æ•èŽ·åœ¨while(true)ä¹‹å¤–ï¼Œè¿™æ ·å°±é€€å‡ºäº†while(true)å¾ªçŽ¯ï¼ &lt;/p&gt; &lt;span id=&quot;inline-purple&quot;&gt; æ³¨æ„ï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-blue&quot;&gt; å¯¹InterruptedExceptionçš„æ•èŽ·åŠ¡ä¸€èˆ¬æ”¾åœ¨while(true)å¾ªçŽ¯ä½“çš„å¤–é¢ï¼Œè¿™æ ·ï¼Œåœ¨äº§ç”Ÿå¼‚å¸¸æ—¶å°±é€€å‡ºäº†while(true)å¾ªçŽ¯ã€‚å¦åˆ™ï¼ŒInterruptedExceptionåœ¨while(true)å¾ªçŽ¯ä½“ä¹‹å†…ï¼Œå°±éœ€è¦é¢å¤–çš„æ·»åŠ é€€å‡ºå¤„ç†ã€‚ &lt;/p&gt; å½¢å¼å¦‚ä¸‹ï¼š 123456789101112@Overridepublic void run() &#123; while (true) &#123; try &#123; // æ‰§è¡Œä»»åŠ¡... &#125; catch (InterruptedException ie) &#123; // InterruptedExceptionåœ¨while(true)å¾ªçŽ¯ä½“å†…ã€‚ // å½“çº¿ç¨‹äº§ç”Ÿäº†InterruptedExceptionå¼‚å¸¸æ—¶ï¼Œwhile(true)ä»èƒ½ç»§ç»­è¿è¡Œï¼éœ€è¦æ‰‹åŠ¨é€€å‡º break; &#125; &#125;&#125; &lt;span id=&quot;inline-green&quot;&gt; è¯´æ˜Žï¼š&lt;/span&gt; &lt;p id=&quot;div-border-left-red&quot;&gt; ä¸Šé¢çš„InterruptedExceptionå¼‚å¸¸çš„æ•èŽ·åœ¨whle(true)ä¹‹å†…ã€‚å½“äº§ç”ŸInterruptedExceptionå¼‚å¸¸æ—¶ï¼Œè¢«catchå¤„ç†ä¹‹å¤–ï¼Œä»ç„¶åœ¨while(true)å¾ªçŽ¯ä½“å†…ï¼›è¦é€€å‡ºwhile(true)å¾ªçŽ¯ä½“ï¼Œéœ€è¦é¢å¤–çš„æ‰§è¡Œé€€å‡ºwhile(true)çš„æ“ä½œã€‚ &lt;/p&gt; ç»ˆæ­¢å¤„äºŽâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡â€œæ ‡è®°â€æ–¹å¼ç»ˆæ­¢å¤„äºŽâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ã€‚å…¶ä¸­ï¼ŒåŒ…æ‹¬â€œä¸­æ–­æ ‡è®°â€å’Œâ€œé¢å¤–æ·»åŠ æ ‡è®°â€ã€‚ é€šè¿‡â€œä¸­æ–­æ ‡è®°â€ç»ˆæ­¢çº¿ç¨‹ å½¢å¼å¦‚ä¸‹ï¼š 123456@Overridepublic void run() &#123; while (!isInterrupted()) &#123; // æ‰§è¡Œä»»åŠ¡... &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; isInterrupted()æ˜¯åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°æ˜¯ä¸æ˜¯ä¸ºtrueã€‚å½“çº¿ç¨‹å¤„äºŽè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦ç»ˆæ­¢å®ƒæ—¶ï¼›å¯ä»¥è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œä½¿ç”¨çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä¸ºtrueï¼Œå³isInterrupted()ä¼šè¿”å›žtrueã€‚æ­¤æ—¶ï¼Œå°±ä¼šé€€å‡ºwhileå¾ªçŽ¯ã€‚ &lt;/p&gt; &lt;font color=&quot;red&quot;&gt; æ³¨æ„ï¼šinterrupt()å¹¶ä¸ä¼šç»ˆæ­¢å¤„äºŽâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ï¼å®ƒä¼šå°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºtrueã€‚ &lt;/font&gt; é€šè¿‡â€œé¢å¤–æ·»åŠ æ ‡è®°â€ å½¢å¼å¦‚ä¸‹ï¼š 1234567891011private volatile boolean flag= true;protected void stopTask() &#123; flag = false;&#125;@Overridepublic void run() &#123; while (flag) &#123; // æ‰§è¡Œä»»åŠ¡... &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; çº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªflagæ ‡è®°ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯trueï¼›å¹¶ä¸”æˆ‘ä»¬æä¾›stopTask()æ¥è®¾ç½®flagæ ‡è®°ã€‚å½“æˆ‘ä»¬éœ€è¦ç»ˆæ­¢è¯¥çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨è¯¥çº¿ç¨‹çš„stopTask()æ–¹æ³•å°±å¯ä»¥è®©çº¿ç¨‹é€€å‡ºwhileå¾ªçŽ¯ã€‚ &lt;/p&gt; &lt;font color=&quot;red&quot;&gt; æ³¨æ„ï¼šå°†flagå®šä¹‰ä¸ºvolatileç±»åž‹ï¼Œæ˜¯ä¸ºäº†ä¿è¯flagçš„å¯è§æ€§ã€‚å³å…¶å®ƒçº¿ç¨‹é€šè¿‡stopTask()ä¿®æ”¹äº†flagä¹‹åŽï¼Œæœ¬çº¿ç¨‹èƒ½çœ‹åˆ°ä¿®æ”¹åŽçš„flagçš„å€¼ã€‚ &lt;/font&gt; ç»¼åˆçº¿ç¨‹å¤„äºŽâ€œé˜»å¡žçŠ¶æ€â€å’Œâ€œè¿è¡ŒçŠ¶æ€â€çš„ç»ˆæ­¢æ–¹å¼ï¼Œæ¯”è¾ƒ &lt;span id=&quot;inline-purple&quot;&gt; é€šç”¨çš„ç»ˆæ­¢çº¿ç¨‹çš„å½¢å¼ &lt;/span&gt; å¦‚ä¸‹ï¼š 1234567891011@Overridepublic void run() &#123; try &#123; // 1. isInterrupted()ä¿è¯ï¼Œåªè¦ä¸­æ–­æ ‡è®°ä¸ºtrueå°±ç»ˆæ­¢çº¿ç¨‹ã€‚ while (!isInterrupted()) &#123; // æ‰§è¡Œä»»åŠ¡... &#125; &#125; catch (InterruptedException ie) &#123; // 2. InterruptedExceptionå¼‚å¸¸ä¿è¯ï¼Œå½“InterruptedExceptionå¼‚å¸¸äº§ç”Ÿæ—¶ï¼Œçº¿ç¨‹è¢«ç»ˆæ­¢ã€‚ &#125;&#125; ç»ˆæ­¢çº¿ç¨‹çš„ç¤ºä¾‹ é¦–å…ˆå®šä¹‰çº¿ç¨‹å¯¹è±¡MyThread 1234567891011121314151617181920212223242526package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹å¯¹è±¡ */public class MyThread extends Thread &#123; public MyThread(String name) &#123; super(name); &#125; @Override public void run() &#123; int i = 0; while (!isInterrupted()) &#123; try &#123; Thread.sleep(100); &#125; catch (InterruptedException ie) &#123; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") catch InterruptedException."); &#125; i++; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") loop " + i); &#125; &#125;&#125; 123456789101112131415161718192021222324252627282930package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹1 */public class Demo1 &#123; public static void main(String[] args) &#123; try &#123; // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.interrupt(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234567t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) catch InterruptedException.t1 (TERMINATED) is interrupted now. &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­é€šè¿‡new MyThread(&quot;t1&quot;)åˆ›å»ºçº¿ç¨‹t1ï¼Œä¹‹åŽé€šè¿‡t1.start()å¯åŠ¨çº¿ç¨‹t1ã€‚ t1å¯åŠ¨ä¹‹åŽï¼Œä¼šä¸æ–­çš„æ£€æŸ¥å®ƒçš„ä¸­æ–­æ ‡è®°ï¼Œå¦‚æžœä¸­æ–­æ ‡è®°ä¸ºâ€œfalseâ€ï¼›åˆ™ä¼‘çœ 100msã€‚ t1ä¼‘çœ ä¹‹åŽï¼Œä¼šåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹mainï¼›ä¸»çº¿ç¨‹å†æ¬¡è¿è¡Œæ—¶ï¼Œä¼šæ‰§è¡Œt1.interrupt()ä¸­æ–­çº¿ç¨‹t1ã€‚t1æ”¶åˆ°ä¸­æ–­æŒ‡ä»¤ä¹‹åŽï¼Œä¼šå°†t1çš„ä¸­æ–­æ ‡è®°è®¾ç½®â€œfalseâ€ï¼Œè€Œä¸”ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚åœ¨t1çš„run()æ–¹æ³•ä¸­ï¼Œæ˜¯åœ¨å¾ªçŽ¯ä½“whileä¹‹å¤–æ•èŽ·çš„å¼‚å¸¸ï¼›å› æ­¤å¾ªçŽ¯è¢«ç»ˆæ­¢ã€‚ å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå°å°çš„ä¿®æ”¹ï¼Œå°†run()æ–¹æ³•ä¸­æ•èŽ·InterruptedExceptionå¼‚å¸¸çš„ä»£ç å—ç§»åˆ°whileå¾ªçŽ¯ä½“å†…ã€‚ 12345678910111213141516171819202122232425262728293031package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹2 */public class Demo2 &#123; public static void main(String[] args) &#123; try &#123; // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t1.start(); System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.interrupt(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 123456789101112131415t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) catch InterruptedException.t1 (RUNNABLE) loop 3t1 (RUNNABLE) loop 4t1 (RUNNABLE) loop 5t1 (TIMED_WAITING) is interrupted now.t1 (RUNNABLE) loop 6t1 (RUNNABLE) loop 7t1 (RUNNABLE) loop 8t1 (RUNNABLE) loop 9... &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; &lt;font color=&quot;red&quot;&gt; ç¨‹åºè¿›å…¥äº†æ­»å¾ªçŽ¯ï¼ &lt;/font&gt; ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œt1åœ¨â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€æ—¶ï¼Œè¢«interrupt()ä¸­æ–­ï¼›æ­¤æ—¶ï¼Œä¼šæ¸…é™¤ä¸­æ–­æ ‡è®°ã€Œå³isInterrupted()ä¼šè¿”å›žfalseã€ï¼Œè€Œä¸”ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€Œè¯¥å¼‚å¸¸åœ¨whileå¾ªçŽ¯ä½“å†…è¢«æ•èŽ·ã€ã€‚å› æ­¤ï¼Œt1ç†æ‰€å½“ç„¶çš„ä¼šè¿›å…¥æ­»å¾ªçŽ¯äº†ã€‚ &lt;p id=&quot;div-border-left-red&quot;&gt; è§£å†³è¯¥é—®é¢˜ï¼Œéœ€è¦åœ¨æ•èŽ·å¼‚å¸¸æ—¶ï¼Œé¢å¤–çš„è¿›è¡Œé€€å‡ºwhileå¾ªçŽ¯çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨MyThreadçš„catch(InterruptedException)ä¸­æ·»åŠ break æˆ– returnå°±èƒ½è§£å†³è¯¥é—®é¢˜ã€‚ &lt;/p&gt; ä¸‹é¢æ˜¯é€šè¿‡â€œé¢å¤–æ·»åŠ æ ‡è®°â€çš„æ–¹å¼ç»ˆæ­¢â€œçŠ¶æ€çŠ¶æ€â€çš„çº¿ç¨‹çš„ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹3 */public class Demo3 &#123; public static void main(String[] args) &#123; try &#123; // æ–°å»ºâ€œçº¿ç¨‹t1â€ TestThread t1 = new TestThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.stopTask(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åŽæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125;class TestThread extends Thread &#123; private volatile boolean flag = true; public void stopTask() &#123; flag = false; &#125; public TestThread(String name) &#123; super(name); &#125; @Override public void run() &#123; synchronized (this) &#123; try &#123; int i = 0; while (flag) &#123; Thread.sleep(100); i++; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") catch InterruptedException."); &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234567t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) loop 3t1 (TERMINATED) is interrupted now. interrupted() å’Œ isInterrupted()çš„åŒºåˆ« interrupted() å’Œ isInterrupted()éƒ½èƒ½å¤Ÿç”¨äºŽæ£€æµ‹å¯¹è±¡çš„â€œä¸­æ–­æ ‡è®°â€ã€‚ åŒºåˆ«æ˜¯ï¼Œinterrupted()é™¤äº†è¿”å›žä¸­æ–­æ ‡è®°ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šæ¸…é™¤ä¸­æ–­æ ‡è®°(å³å°†ä¸­æ–­æ ‡è®°è®¾ä¸ºfalse)ï¼›è€ŒisInterrupted()ä»…ä»…è¿”å›žä¸­æ–­æ ‡è®°ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-å†…å®¹æ€»ç»“]]></title>
    <url>%2Fposts%2Fc0ec3ded.html</url>
    <content type="text"><![CDATA[å¤„ç†å™¨å†…å­˜æ¨¡åž‹ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡åž‹ï¼ŒJMM å’Œå¤„ç†å™¨å†…å­˜æ¨¡åž‹åœ¨è®¾è®¡æ—¶é€šå¸¸ä¼šæŠŠé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä½œä¸ºå‚ç…§ã€‚JMM å’Œå¤„ç†å™¨å†…å­˜æ¨¡åž‹åœ¨è®¾è®¡æ—¶ä¼šå¯¹é¡ºåºä¸€è‡´æ€§æ¨¡åž‹åšä¸€äº›æ”¾æ¾ï¼Œå› ä¸ºå¦‚æžœå®Œå…¨æŒ‰ç…§é¡ºåºä¸€è‡´æ€§æ¨¡åž‹æ¥å®žçŽ°å¤„ç†å™¨å’Œ JMMï¼Œé‚£ä¹ˆå¾ˆå¤šçš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨ä¼˜åŒ–éƒ½è¦è¢«ç¦æ­¢ï¼Œè¿™å¯¹æ‰§è¡Œæ€§èƒ½å°†ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚ æ ¹æ®å¯¹ä¸åŒç±»åž‹è¯» / å†™æ“ä½œç»„åˆçš„æ‰§è¡Œé¡ºåºçš„æ”¾æ¾ï¼Œå¯ä»¥æŠŠå¸¸è§å¤„ç†å™¨çš„å†…å­˜æ¨¡åž‹åˆ’åˆ†ä¸ºä¸‹é¢å‡ ç§ç±»åž‹ï¼š æ”¾æ¾ç¨‹åºä¸­å†™ - è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† total store ordering å†…å­˜æ¨¡åž‹ï¼ˆç®€ç§°ä¸º TSOï¼‰ã€‚ åœ¨å‰é¢ 1 çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­å†™ - å†™æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† partial store order å†…å­˜æ¨¡åž‹ï¼ˆç®€ç§°ä¸º PSOï¼‰ã€‚ åœ¨å‰é¢ 1 å’Œ 2 çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­è¯» - å†™å’Œè¯» - è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† relaxed memory order å†…å­˜æ¨¡åž‹ï¼ˆç®€ç§°ä¸º RMOï¼‰å’Œ PowerPC å†…å­˜æ¨¡åž‹ã€‚ æ³¨æ„ï¼Œè¿™é‡Œå¤„ç†å™¨å¯¹è¯» / å†™æ“ä½œçš„æ”¾æ¾ï¼Œæ˜¯ä»¥ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ä¸ºå‰æçš„ï¼ˆå› ä¸ºå¤„ç†å™¨è¦éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–æ€§çš„ä¸¤ä¸ªå†…å­˜æ“ä½œåšé‡æŽ’åºï¼‰ã€‚ å¸¸è§å¤„ç†å™¨å†…å­˜æ¨¡åž‹çš„ç»†èŠ‚ç‰¹å¾ï¼š å†…å­˜æ¨¡åž‹åç§° å¯¹åº”çš„å¤„ç†å™¨ Store-Loadé‡æŽ’åº Store-Storeé‡æŽ’åº Load-Loadå’ŒLoad-Storeé‡æŽ’åº å¯ä»¥æ›´æ—©è¯»å–åˆ°å…¶ä»–å¤„ç†å™¨çš„å†™ å¯ä»¥æ›´æ—©è¯»å–åˆ°å½“å‰å¤„ç†å™¨çš„å†™ TSO sparc-TSO X64 Y Y PSO sparc-PSO Y Y Y RMO ia64 Y Y Y Y PowerPC PowerPC Y Y Y Y Y åœ¨è¿™ä¸ªè¡¨æ ¼ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰å¤„ç†å™¨å†…å­˜æ¨¡åž‹éƒ½å…è®¸å†™ - è¯»é‡æŽ’åºï¼ŒåŽŸå› ï¼šå®ƒä»¬éƒ½ä½¿ç”¨äº†å†™ç¼“å­˜åŒºï¼Œå†™ç¼“å­˜åŒºå¯èƒ½å¯¼è‡´å†™ - è¯»æ“ä½œé‡æŽ’åºã€‚åŒæ—¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›å¤„ç†å™¨å†…å­˜æ¨¡åž‹éƒ½å…è®¸æ›´æ—©è¯»åˆ°å½“å‰å¤„ç†å™¨çš„å†™ï¼ŒåŽŸå› åŒæ ·æ˜¯å› ä¸ºå†™ç¼“å­˜åŒºï¼šç”±äºŽå†™ç¼“å­˜åŒºä»…å¯¹å½“å‰å¤„ç†å™¨å¯è§ï¼Œè¿™ä¸ªç‰¹æ€§å¯¼è‡´å½“å‰å¤„ç†å™¨å¯ä»¥æ¯”å…¶ä»–å¤„ç†å™¨å…ˆçœ‹åˆ°ä¸´æ—¶ä¿å­˜åœ¨è‡ªå·±çš„å†™ç¼“å­˜åŒºä¸­çš„å†™ã€‚ ä¸Šé¢è¡¨æ ¼ä¸­çš„å„ç§å¤„ç†å™¨å†…å­˜æ¨¡åž‹ï¼Œä»Žä¸Šåˆ°ä¸‹ï¼Œæ¨¡åž‹ç”±å¼ºå˜å¼±ã€‚è¶Šæ˜¯è¿½æ±‚æ€§èƒ½çš„å¤„ç†å™¨ï¼Œå†…å­˜æ¨¡åž‹è®¾è®¡çš„ä¼šè¶Šå¼±ã€‚å› ä¸ºè¿™äº›å¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡åž‹å¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åšå°½å¯èƒ½å¤šçš„ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚ ç”±äºŽå¸¸è§çš„å¤„ç†å™¨å†…å­˜æ¨¡åž‹æ¯” JMM è¦å¼±ï¼Œjava ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®æ’å…¥å†…å­˜å±éšœæ¥é™åˆ¶å¤„ç†å™¨çš„é‡æŽ’åºã€‚åŒæ—¶ï¼Œç”±äºŽå„ç§å¤„ç†å™¨å†…å­˜æ¨¡åž‹çš„å¼ºå¼±å¹¶ä¸ç›¸åŒï¼Œä¸ºäº†åœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°å‘ç¨‹åºå‘˜å±•ç¤ºä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡åž‹ï¼ŒJMM åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„æ•°é‡å’Œç§ç±»ä¹Ÿä¸ç›¸åŒã€‚ ä¸‹å›¾å±•ç¤ºäº† JMM åœ¨ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡åž‹ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJMM å±è”½äº†ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡åž‹çš„å·®å¼‚ï¼Œå®ƒåœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šä¸º java ç¨‹åºå‘˜å‘ˆçŽ°äº†ä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡åž‹ã€‚ JMMã€å¤„ç†å™¨å†…å­˜æ¨¡åž‹ä¸Žé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¹‹é—´çš„å…³ç³» JMM æ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡åž‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡åž‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡åž‹ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡åž‹ã€‚ä¸‹é¢æ˜¯è¯­è¨€å†…å­˜æ¨¡åž‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡åž‹å’Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹çš„å¼ºå¼±å¯¹æ¯”ç¤ºæ„å›¾ï¼š ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šå¸¸è§çš„ 4 ç§å¤„ç†å™¨å†…å­˜æ¨¡åž‹æ¯”å¸¸ç”¨çš„ 3 ä¸­è¯­è¨€å†…å­˜æ¨¡åž‹è¦å¼±ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡åž‹å’Œè¯­è¨€å†…å­˜æ¨¡åž‹éƒ½æ¯”é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹è¦å¼±ã€‚åŒå¤„ç†å™¨å†…å­˜æ¨¡åž‹ä¸€æ ·ï¼Œè¶Šæ˜¯è¿½æ±‚æ‰§è¡Œæ€§èƒ½çš„è¯­è¨€ï¼Œå†…å­˜æ¨¡åž‹è®¾è®¡çš„ä¼šè¶Šå¼±ã€‚ JMMçš„è®¾è®¡ ä»Ž JMM è®¾è®¡è€…çš„è§’åº¦æ¥è¯´ï¼Œåœ¨è®¾è®¡ JMM æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®å› ç´ ï¼š ç¨‹åºå‘˜å¯¹å†…å­˜æ¨¡åž‹çš„ä½¿ç”¨ã€‚ç¨‹åºå‘˜å¸Œæœ›å†…å­˜æ¨¡åž‹æ˜“äºŽç†è§£ï¼Œæ˜“äºŽç¼–ç¨‹ã€‚ç¨‹åºå‘˜å¸Œæœ›åŸºäºŽä¸€ä¸ªå¼ºå†…å­˜æ¨¡åž‹æ¥ç¼–å†™ä»£ç ã€‚ ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹å†…å­˜æ¨¡åž‹çš„å®žçŽ°ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡åž‹å¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åšå°½å¯èƒ½å¤šçš„ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å®žçŽ°ä¸€ä¸ªå¼±å†…å­˜æ¨¡åž‹ã€‚ ç”±äºŽè¿™ä¸¤ä¸ªå› ç´ äº’ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥ JSR-133 ä¸“å®¶ç»„åœ¨è®¾è®¡ JMM æ—¶çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¥½çš„å¹³è¡¡ç‚¹ï¼šä¸€æ–¹é¢è¦ä¸ºç¨‹åºå‘˜æä¾›è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é™åˆ¶è¦å°½å¯èƒ½çš„æ”¾æ¾ã€‚ JSR-133 æ˜¯å¦‚ä½•å®žçŽ°è¿™ä¸€ç›®æ ‡çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼šhappens-beforeè§„åˆ™ã€‚ JMM æŠŠ happens- before è¦æ±‚ç¦æ­¢çš„é‡æŽ’åºåˆ†ä¸ºäº†ä¸‹é¢ä¸¤ç±»ï¼š ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æžœçš„é‡æŽ’åºã€‚ ä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æžœçš„é‡æŽ’åºã€‚ JMM å¯¹è¿™ä¸¤ç§ä¸åŒæ€§è´¨çš„é‡æŽ’åºï¼Œé‡‡å–äº†ä¸åŒçš„ç­–ç•¥ï¼š å¯¹äºŽä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æžœçš„é‡æŽ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æŽ’åºã€‚ å¯¹äºŽä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æžœçš„é‡æŽ’åºï¼ŒJMM å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä½œè¦æ±‚ï¼ˆJMM å…è®¸è¿™ç§é‡æŽ’åºï¼‰ ä¸‹é¢æ˜¯ JMM çš„è®¾è®¡ç¤ºæ„å›¾ï¼š ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸¤ç‚¹ï¼š JMM å‘ç¨‹åºå‘˜æä¾›çš„ happens- before è§„åˆ™èƒ½æ»¡è¶³ç¨‹åºå‘˜çš„éœ€æ±‚ã€‚JMM çš„ happens- before è§„åˆ™ä¸ä½†ç®€å•æ˜“æ‡‚ï¼Œè€Œä¸”ä¹Ÿå‘ç¨‹åºå‘˜æä¾›äº†è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ JMM å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„æŸç¼šå·²ç»å°½å¯èƒ½çš„å°‘ã€‚JMM å…¶å®žæ˜¯åœ¨éµå¾ªä¸€ä¸ªåŸºæœ¬åŽŸåˆ™ï¼šåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æžœï¼ˆæŒ‡çš„æ˜¯å•çº¿ç¨‹ç¨‹åºå’Œæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€Žä¹ˆä¼˜åŒ–éƒ½è¡Œã€‚æ¯”å¦‚ï¼Œå¦‚æžœç¼–è¯‘å™¨ç»è¿‡ç»†è‡´çš„åˆ†æžåŽï¼Œè®¤å®šä¸€ä¸ªé”åªä¼šè¢«å•ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å¯ä»¥è¢«æ¶ˆé™¤ã€‚å†æ¯”å¦‚ï¼Œå¦‚æžœç¼–è¯‘å™¨ç»è¿‡ç»†è‡´çš„åˆ†æžåŽï¼Œè®¤å®šä¸€ä¸ª volatile å˜é‡ä»…ä»…åªä¼šè¢«å•ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥æŠŠè¿™ä¸ª volatile å˜é‡å½“ä½œä¸€ä¸ªæ™®é€šå˜é‡æ¥å¯¹å¾…ã€‚è¿™äº›ä¼˜åŒ–æ—¢ä¸ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æžœï¼Œåˆèƒ½æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆçŽ‡ã€‚ JMMå†…å­˜å¯è§æ€§ä¿è¯ Java ç¨‹åºçš„å†…å­˜å¯è§æ€§ä¿è¯æŒ‰ç¨‹åºç±»åž‹å¯ä»¥åˆ†ä¸ºä¸‹åˆ—ä¸‰ç±»ï¼š å•çº¿ç¨‹ç¨‹åºã€‚å•çº¿ç¨‹ç¨‹åºä¸ä¼šå‡ºçŽ°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨ä¼šå…±åŒç¡®ä¿å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æžœä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœç›¸åŒã€‚ æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æžœä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœç›¸åŒï¼‰ã€‚è¿™æ˜¯ JMM å…³æ³¨çš„é‡ç‚¹ï¼ŒJMM é€šè¿‡é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æŽ’åºæ¥ä¸ºç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ æœªåŒæ­¥ / æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚JMM ä¸ºå®ƒä»¬æä¾›äº†æœ€å°å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼Œnullï¼Œfalseï¼‰ã€‚ ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸‰ç±»ç¨‹åºåœ¨ JMM ä¸­ä¸Žåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœçš„å¼‚åŒï¼š åªè¦å¤šçº¿ç¨‹ç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼ŒJMM ä¿è¯è¯¥ç¨‹åºåœ¨ä»»æ„çš„å¤„ç†å™¨å¹³å°ä¸Šçš„æ‰§è¡Œç»“æžœï¼Œä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœä¸€è‡´ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-08ä¹‹-çº¿ç¨‹Join]]></title>
    <url>%2Fposts%2F38c1adea.html</url>
    <content type="text"><![CDATA[join()ä»‹ç» join() çš„ä½œç”¨ï¼šè®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…â€œå­çº¿ç¨‹â€ç»“æŸä¹‹åŽæ‰èƒ½ç»§ç»­è¿è¡Œã€‚é€šè¿‡ä¾‹å­æ¥ç†è§£ï¼š 123456789101112131415// ä¸»çº¿ç¨‹public class Father extends Thread &#123; public void run() &#123; Son s = new Son(); s.start(); s.join(); ... &#125;&#125;// å­çº¿ç¨‹public class Son extends Thread &#123; public void run() &#123; ... &#125;&#125; &lt;span id=&quot;inline-purple&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; ä¸Šé¢çš„æœ‰ä¸¤ä¸ªç±»Father(ä¸»çº¿ç¨‹ç±»)å’ŒSon(å­çº¿ç¨‹ç±»)ã€‚å› ä¸ºSonæ˜¯åœ¨Fatherä¸­åˆ›å»ºå¹¶å¯åŠ¨çš„ï¼Œæ‰€ä»¥ï¼ŒFatheræ˜¯ä¸»çº¿ç¨‹ç±»ï¼ŒSonæ˜¯å­çº¿ç¨‹ç±»ã€‚ åœ¨Fatherä¸»çº¿ç¨‹ä¸­ï¼Œé€šè¿‡new Son()æ–°å»ºâ€œå­çº¿ç¨‹sâ€ã€‚æŽ¥ç€é€šè¿‡s.start()å¯åŠ¨â€œå­çº¿ç¨‹sâ€ï¼Œå¹¶ä¸”è°ƒç”¨s.join()ã€‚åœ¨è°ƒç”¨s.join()ä¹‹åŽï¼ŒFatherä¸»çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°â€œå­çº¿ç¨‹sâ€è¿è¡Œå®Œæ¯•ï¼›åœ¨â€œå­çº¿ç¨‹sâ€è¿è¡Œå®Œæ¯•ä¹‹åŽï¼ŒFatherä¸»çº¿ç¨‹æ‰èƒ½æŽ¥ç€è¿è¡Œã€‚ è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œjoin()çš„ä½œç”¨ï¼Œæ˜¯è®©ä¸»çº¿ç¨‹ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸä¹‹åŽæ‰èƒ½ç»§ç»­è¿è¡Œâ€ï¼ join()æºç åˆ†æž 12345678910111213141516171819202122232425262728public final void join() throws InterruptedException &#123; join(0);&#125;public final synchronized void join(long millis)throws InterruptedException &#123; long base = System.currentTimeMillis(); long now = 0; if (millis &lt; 0) &#123; throw new IllegalArgumentException("timeout value is negative"); &#125; if (millis == 0) &#123; while (isAlive()) &#123; wait(0); &#125; &#125; else &#123; while (isAlive()) &#123; long delay = millis - now; if (delay &lt;= 0) &#123; break; &#125; wait(delay); now = System.currentTimeMillis() - base; &#125; &#125;&#125; &lt;span id=&quot;inline-purple&quot;&gt;è¯´æ˜Žï¼š &lt;/span&gt; ä»Žä»£ç ä¸­ï¼Œå¯ä»¥å‘çŽ°ã€‚å½“millis==0æ—¶ï¼Œä¼šè¿›å…¥while(isAlive())å¾ªçŽ¯ï¼›å³åªè¦å­çº¿ç¨‹æ˜¯æ´»çš„ï¼Œä¸»çº¿ç¨‹å°±ä¸åœçš„ç­‰å¾…ã€‚ æ ¹æ®ä¸Šé¢è§£é‡Šjoin()ä½œç”¨æ—¶çš„ä»£ç æ¥ç†è§£join()çš„ç”¨æ³•ï¼ &lt;span id=&quot;inline-blue&quot;&gt; é—®é¢˜ï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-red&quot;&gt;è™½ç„¶s.join()è¢«è°ƒç”¨çš„åœ°æ–¹æ˜¯å‘ç”Ÿåœ¨â€œFatherä¸»çº¿ç¨‹â€ä¸­ï¼Œä½†æ˜¯s.join()æ˜¯é€šè¿‡â€œå­çº¿ç¨‹sâ€åŽ»è°ƒç”¨çš„join()ã€‚é‚£ä¹ˆï¼Œjoin()æ–¹æ³•ä¸­çš„isAlive()åº”è¯¥æ˜¯åˆ¤æ–­â€œå­çº¿ç¨‹sâ€æ˜¯ä¸æ˜¯AliveçŠ¶æ€ï¼›å¯¹åº”çš„wait(0)ä¹Ÿåº”è¯¥æ˜¯â€œè®©å­çº¿ç¨‹sâ€ç­‰å¾…æ‰å¯¹ã€‚ä½†å¦‚æžœæ˜¯è¿™æ ·çš„è¯ï¼Œs.join()çš„ä½œç”¨æ€Žä¹ˆå¯èƒ½æ˜¯â€œè®©ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å­çº¿ç¨‹så®Œæˆä¸ºæ­¢â€å‘¢ï¼Œåº”è¯¥æ˜¯è®©&quot;å­çº¿ç¨‹ç­‰å¾…æ‰å¯¹(å› ä¸ºè°ƒç”¨å­çº¿ç¨‹å¯¹è±¡sçš„waitæ–¹æ³•å˜›)&quot;ï¼Ÿ&lt;/p&gt; &lt;span id=&quot;inline-green&quot;&gt; ç­”æ¡ˆï¼š &lt;/span&gt; &lt;p id=&quot;div-border-left-green&quot;&gt;wait()çš„ä½œç”¨æ˜¯è®©â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œè¿™é‡Œçš„â€œå½“å‰çº¿ç¨‹â€æ˜¯æŒ‡å½“å‰åœ¨CPUä¸Šè¿è¡Œçš„çº¿ç¨‹ã€‚æ‰€ä»¥ï¼Œè™½ç„¶æ˜¯è°ƒç”¨å­çº¿ç¨‹çš„wait()æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡â€œä¸»çº¿ç¨‹â€åŽ»è°ƒç”¨çš„ï¼›æ‰€ä»¥ï¼Œä¼‘çœ çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œè€Œä¸æ˜¯â€œå­çº¿ç¨‹â€ï¼&lt;/p&gt; join()ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940package main.java.com.study.thread.join;/** * @author: whb * @description: join() çš„ä½œç”¨ï¼šè®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…â€œå­çº¿ç¨‹â€ç»“æŸä¹‹åŽæ‰èƒ½ç»§ç»­è¿è¡Œã€‚ */public class JoinTest &#123; public static void main(String[] args) &#123; try &#123; // æ–°å»ºâ€œçº¿ç¨‹t1â€ ThreadA t1 = new ThreadA("t1"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t1.join(); // å°†â€œçº¿ç¨‹t1â€åŠ å…¥åˆ°â€œä¸»çº¿ç¨‹mainâ€ä¸­ï¼Œå¹¶ä¸”â€œä¸»çº¿ç¨‹main()ä¼šç­‰å¾…å®ƒçš„å®Œæˆâ€ System.out.printf("%s finish\n", Thread.currentThread().getName()); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; static class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; System.out.printf("%s start\n", this.getName()); // å»¶æ—¶æ“ä½œ for (int i = 0; i &lt; 1000000; i++) &#123; ; &#125; System.out.printf("%s finish\n", this.getName()); &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 123t1 startt1 finishmain finish &lt;span id=&quot;inline-green&quot;&gt; è¿è¡Œç»“æžœï¼š&lt;/span&gt; (01) åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­é€šè¿‡ new ThreadA(&quot;t1&quot;) æ–°å»ºâ€œçº¿ç¨‹t1â€ã€‚ æŽ¥ç€ï¼Œé€šè¿‡ t1.start() å¯åŠ¨â€œçº¿ç¨‹t1â€ï¼Œå¹¶æ‰§è¡Œt1.join()ã€‚ (02) æ‰§è¡Œt1.join()ä¹‹åŽï¼Œâ€œä¸»çº¿ç¨‹mainâ€ä¼šè¿›å…¥â€œé˜»å¡žçŠ¶æ€â€ç­‰å¾…t1è¿è¡Œç»“æŸã€‚â€œå­çº¿ç¨‹t1â€ç»“æŸä¹‹åŽï¼Œä¼šå”¤é†’â€œä¸»çº¿ç¨‹mainâ€ï¼Œâ€œä¸»çº¿ç¨‹â€é‡æ–°èŽ·å–cpuæ‰§è¡Œæƒï¼Œç»§ç»­è¿è¡Œã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-ç†è§£final]]></title>
    <url>%2Fposts%2F5a0704df.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ä¸Žé”å’Œ volatile ç›¸æ¯”è¾ƒï¼Œå¯¹ final åŸŸçš„è¯»å’Œå†™æ›´åƒæ˜¯æ™®é€šçš„å˜é‡è®¿é—®ã€‚å¯¹äºŽ final åŸŸï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¦éµå®ˆä¸¤ä¸ªé‡æŽ’åºè§„åˆ™ï¼š åœ¨æž„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final åŸŸçš„å†™å…¥ï¼Œä¸ŽéšåŽæŠŠè¿™ä¸ªè¢«æž„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æŽ’åºã€‚ åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å« final åŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸ŽéšåŽåˆæ¬¡è¯»è¿™ä¸ª final åŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æŽ’åºã€‚ ç¤ºä¾‹ä»£ç ï¼š 1234567891011121314151617181920public class FinalExample &#123; int i; // æ™®é€šå˜é‡ final int j; //final å˜é‡ static FinalExample obj; public void FinalExample () &#123; // æž„é€ å‡½æ•° i = 1; // å†™æ™®é€šåŸŸ j = 2; // å†™ final åŸŸ &#125; public static void writer () &#123; // å†™çº¿ç¨‹ A æ‰§è¡Œ obj = new FinalExample (); &#125; public static void reader () &#123; // è¯»çº¿ç¨‹ B æ‰§è¡Œ FinalExample object = obj; // è¯»å¯¹è±¡å¼•ç”¨ int a = object.i; // è¯»æ™®é€šåŸŸ int b = object.j; // è¯» final åŸŸ &#125;&#125; è¿™é‡Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹ A æ‰§è¡Œ writer () æ–¹æ³•ï¼ŒéšåŽå¦ä¸€ä¸ªçº¿ç¨‹ B æ‰§è¡Œ reader () æ–¹æ³•ã€‚ å†™finalåŸŸçš„é‡æŽ’åºè§„åˆ™ å†™ final åŸŸçš„é‡æŽ’åºè§„åˆ™ç¦æ­¢æŠŠ final åŸŸçš„å†™é‡æŽ’åºåˆ°æž„é€ å‡½æ•°ä¹‹å¤–ã€‚è¿™ä¸ªè§„åˆ™çš„å®žçŽ°åŒ…å«ä¸‹é¢ 2 ä¸ªæ–¹é¢ï¼š JMM ç¦æ­¢ç¼–è¯‘å™¨æŠŠ final åŸŸçš„å†™é‡æŽ’åºåˆ°æž„é€ å‡½æ•°ä¹‹å¤–ã€‚ ç¼–è¯‘å™¨ä¼šåœ¨ final åŸŸçš„å†™ä¹‹åŽï¼Œæž„é€ å‡½æ•° return ä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚è¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠ final åŸŸçš„å†™é‡æŽ’åºåˆ°æž„é€ å‡½æ•°ä¹‹å¤–ã€‚ çŽ°åœ¨åˆ†æž writer () æ–¹æ³•ï¼šfinalExample = new FinalExample ()ã€‚è¿™è¡Œä»£ç åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š æž„é€ ä¸€ä¸ª FinalExample ç±»åž‹çš„å¯¹è±¡ï¼› æŠŠè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™å¼•ç”¨å˜é‡ objã€‚ å‡è®¾çº¿ç¨‹ B è¯»å¯¹è±¡å¼•ç”¨ä¸Žè¯»å¯¹è±¡çš„æˆå‘˜åŸŸä¹‹é—´æ²¡æœ‰é‡æŽ’åºï¼Œä¸‹å›¾æ˜¯ä¸€ç§å¯èƒ½çš„æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œå†™æ™®é€šåŸŸçš„æ“ä½œè¢«ç¼–è¯‘å™¨é‡æŽ’åºåˆ°äº†æž„é€ å‡½æ•°ä¹‹å¤–ï¼Œè¯»çº¿ç¨‹ B é”™è¯¯çš„è¯»å–äº†æ™®é€šå˜é‡ i åˆå§‹åŒ–ä¹‹å‰çš„å€¼ã€‚è€Œå†™ final åŸŸçš„æ“ä½œï¼Œè¢«å†™ final åŸŸçš„é‡æŽ’åºè§„åˆ™â€œé™å®šâ€åœ¨äº†æž„é€ å‡½æ•°ä¹‹å†…ï¼Œè¯»çº¿ç¨‹ B æ­£ç¡®çš„è¯»å–äº† final å˜é‡åˆå§‹åŒ–ä¹‹åŽçš„å€¼ã€‚ å†™ final åŸŸçš„é‡æŽ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œå¯¹è±¡çš„ final åŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ï¼Œè€Œæ™®é€šåŸŸä¸å…·æœ‰è¿™ä¸ªä¿éšœã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œåœ¨è¯»çº¿ç¨‹ Bâ€œçœ‹åˆ°â€å¯¹è±¡å¼•ç”¨ obj æ—¶ï¼Œå¾ˆå¯èƒ½ obj å¯¹è±¡è¿˜æ²¡æœ‰æž„é€ å®Œæˆï¼ˆå¯¹æ™®é€šåŸŸ i çš„å†™æ“ä½œè¢«é‡æŽ’åºåˆ°æž„é€ å‡½æ•°å¤–ï¼Œæ­¤æ—¶åˆå§‹å€¼ 2 è¿˜æ²¡æœ‰å†™å…¥æ™®é€šåŸŸ iï¼‰ã€‚ è¯»finalåŸŸçš„é‡æŽ’åºè§„åˆ™ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸Žåˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„ final åŸŸï¼ŒJMM ç¦æ­¢å¤„ç†å™¨é‡æŽ’åºè¿™ä¸¤ä¸ªæ“ä½œï¼ˆè¿™ä¸ªè§„åˆ™ä»…ä»…é’ˆå¯¹å¤„ç†å™¨ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šåœ¨è¯» final åŸŸæ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸Žåˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„ final åŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨é—´æŽ¥ä¾èµ–å…³ç³»ã€‚ç”±äºŽç¼–è¯‘å™¨éµå®ˆé—´æŽ¥ä¾èµ–å…³ç³»ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¸ä¼šé‡æŽ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚å¤§å¤šæ•°å¤„ç†å™¨ä¹Ÿä¼šéµå®ˆé—´æŽ¥ä¾èµ–ï¼Œå¤§å¤šæ•°å¤„ç†å™¨ä¹Ÿä¸ä¼šé‡æŽ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚ä½†æœ‰å°‘æ•°å¤„ç†å™¨å…è®¸å¯¹å­˜åœ¨é—´æŽ¥ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æŽ’åºï¼ˆæ¯”å¦‚ alpha å¤„ç†å™¨ï¼‰ï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯ä¸“é—¨ç”¨æ¥é’ˆå¯¹è¿™ç§å¤„ç†å™¨ã€‚ reader() æ–¹æ³•åŒ…å«ä¸‰ä¸ªæ“ä½œï¼š åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj; åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj æŒ‡å‘å¯¹è±¡çš„æ™®é€šåŸŸ jã€‚ åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj æŒ‡å‘å¯¹è±¡çš„ final åŸŸ iã€‚ çŽ°åœ¨å‡è®¾å†™çº¿ç¨‹ A æ²¡æœ‰å‘ç”Ÿä»»ä½•é‡æŽ’åºï¼ŒåŒæ—¶ç¨‹åºåœ¨ä¸éµå®ˆé—´æŽ¥ä¾èµ–çš„å¤„ç†å™¨ä¸Šæ‰§è¡Œï¼Œä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œè¯»å¯¹è±¡çš„æ™®é€šåŸŸçš„æ“ä½œè¢«å¤„ç†å™¨é‡æŽ’åºåˆ°è¯»å¯¹è±¡å¼•ç”¨ä¹‹å‰ã€‚è¯»æ™®é€šåŸŸæ—¶ï¼Œè¯¥åŸŸè¿˜æ²¡æœ‰è¢«å†™çº¿ç¨‹ A å†™å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„è¯»å–æ“ä½œã€‚è€Œè¯» final åŸŸçš„é‡æŽ’åºè§„åˆ™ä¼šæŠŠè¯»å¯¹è±¡ final åŸŸçš„æ“ä½œâ€œé™å®šâ€åœ¨è¯»å¯¹è±¡å¼•ç”¨ä¹‹åŽï¼Œæ­¤æ—¶è¯¥ final åŸŸå·²ç»è¢« A çº¿ç¨‹åˆå§‹åŒ–è¿‡äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„è¯»å–æ“ä½œã€‚ è¯» final åŸŸçš„é‡æŽ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„ final åŸŸä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆè¯»åŒ…å«è¿™ä¸ª final åŸŸçš„å¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ç¨‹åºä¸­ï¼Œå¦‚æžœè¯¥å¼•ç”¨ä¸ä¸º nullï¼Œé‚£ä¹ˆå¼•ç”¨å¯¹è±¡çš„ final åŸŸä¸€å®šå·²ç»è¢« A çº¿ç¨‹åˆå§‹åŒ–è¿‡äº†ã€‚ finalåŸŸæ˜¯å¼•ç”¨ç±»åž‹ 1234567891011121314151617181920212223public class FinalReferenceExample &#123; final int[] intArray; //final æ˜¯å¼•ç”¨ç±»åž‹ static FinalReferenceExample obj; public FinalReferenceExample () &#123; // æž„é€ å‡½æ•° intArray = new int[1]; //1 intArray[0] = 1; //2 &#125; public static void writerOne () &#123; // å†™çº¿ç¨‹ A æ‰§è¡Œ obj = new FinalReferenceExample (); //3 &#125; public static void writerTwo () &#123; // å†™çº¿ç¨‹ B æ‰§è¡Œ obj.intArray[0] = 2; //4 &#125; public static void reader () &#123; // è¯»çº¿ç¨‹ C æ‰§è¡Œ if (obj != null) &#123; //5 int temp1 = obj.intArray[0]; //6 &#125; &#125;&#125; è¿™é‡Œ final åŸŸä¸ºä¸€ä¸ªå¼•ç”¨ç±»åž‹ï¼Œå®ƒå¼•ç”¨ä¸€ä¸ª int åž‹çš„æ•°ç»„å¯¹è±¡ã€‚å¯¹äºŽå¼•ç”¨ç±»åž‹ï¼Œå†™ final åŸŸçš„é‡æŽ’åºè§„åˆ™å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¢žåŠ äº†å¦‚ä¸‹çº¦æŸï¼š åœ¨æž„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final å¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œä¸ŽéšåŽåœ¨æž„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æž„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æŽ’åºã€‚ å¯¹ä¸Šé¢çš„ç¤ºä¾‹ç¨‹åºï¼Œå‡è®¾é¦–å…ˆçº¿ç¨‹ A æ‰§è¡Œ writerOne() æ–¹æ³•ï¼Œæ‰§è¡Œå®ŒåŽçº¿ç¨‹ B æ‰§è¡Œ writerTwo() æ–¹æ³•ï¼Œæ‰§è¡Œå®ŒåŽçº¿ç¨‹ C æ‰§è¡Œ reader () æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„çº¿ç¨‹æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œ1 æ˜¯å¯¹ final åŸŸçš„å†™å…¥ï¼Œ2 æ˜¯å¯¹è¿™ä¸ª final åŸŸå¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œ3 æ˜¯æŠŠè¢«æž„é€ çš„å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™æŸä¸ªå¼•ç”¨å˜é‡ã€‚è¿™é‡Œé™¤äº†å‰é¢æåˆ°çš„ 1 ä¸èƒ½å’Œ 3 é‡æŽ’åºå¤–ï¼Œ2 å’Œ 3 ä¹Ÿä¸èƒ½é‡æŽ’åºã€‚ JMM å¯ä»¥ç¡®ä¿è¯»çº¿ç¨‹ C è‡³å°‘èƒ½çœ‹åˆ°å†™çº¿ç¨‹ A åœ¨æž„é€ å‡½æ•°ä¸­å¯¹ final å¼•ç”¨å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ã€‚å³ C è‡³å°‘èƒ½çœ‹åˆ°æ•°ç»„ä¸‹æ ‡ 0 çš„å€¼ä¸º 1ã€‚è€Œå†™çº¿ç¨‹ B å¯¹æ•°ç»„å…ƒç´ çš„å†™å…¥ï¼Œè¯»çº¿ç¨‹ C å¯èƒ½çœ‹çš„åˆ°ï¼Œä¹Ÿå¯èƒ½çœ‹ä¸åˆ°ã€‚JMM ä¸ä¿è¯çº¿ç¨‹ B çš„å†™å…¥å¯¹è¯»çº¿ç¨‹ C å¯è§ï¼Œå› ä¸ºå†™çº¿ç¨‹ B å’Œè¯»çº¿ç¨‹ C ä¹‹é—´å­˜åœ¨æ•°æ®ç«žäº‰ï¼Œæ­¤æ—¶çš„æ‰§è¡Œç»“æžœä¸å¯é¢„çŸ¥ã€‚ ä¸ºä»€ä¹ˆfinalå¼•ç”¨ä¸èƒ½ä»Žæž„é€ å‡½æ•°å†…é€¸å‡º å†™ final åŸŸçš„é‡æŽ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¼•ç”¨å˜é‡ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œè¯¥å¼•ç”¨å˜é‡æŒ‡å‘çš„å¯¹è±¡çš„ final åŸŸå·²ç»åœ¨æž„é€ å‡½æ•°ä¸­è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ã€‚å…¶å®žè¦å¾—åˆ°è¿™ä¸ªæ•ˆæžœï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¿è¯ï¼šåœ¨æž„é€ å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½è®©è¿™ä¸ªè¢«æž„é€ å¯¹è±¡çš„å¼•ç”¨ä¸ºå…¶ä»–çº¿ç¨‹å¯è§ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å¼•ç”¨ä¸èƒ½åœ¨æž„é€ å‡½æ•°ä¸­â€œé€¸å‡ºâ€ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516171819public class FinalReferenceEscapeExample &#123; final int i; static FinalReferenceEscapeExample obj; public FinalReferenceEscapeExample () &#123; i = 1; //1 å†™ final åŸŸ obj = this; //2 this å¼•ç”¨åœ¨æ­¤â€œé€¸å‡ºâ€ &#125; public static void writer() &#123; new FinalReferenceEscapeExample (); &#125; public static void reader &#123; if (obj != null) &#123; //3 int temp = obj.i; //4 &#125; &#125;&#125; å‡è®¾ä¸€ä¸ªçº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚è¿™é‡Œçš„æ“ä½œ 2 ä½¿å¾—å¯¹è±¡è¿˜æœªå®Œæˆæž„é€ å‰å°±ä¸ºçº¿ç¨‹ B å¯è§ã€‚å³ä½¿è¿™é‡Œçš„æ“ä½œ 2 æ˜¯æž„é€ å‡½æ•°çš„æœ€åŽä¸€æ­¥ï¼Œä¸”å³ä½¿åœ¨ç¨‹åºä¸­æ“ä½œ 2 æŽ’åœ¨æ“ä½œ 1 åŽé¢ï¼Œæ‰§è¡Œ read() æ–¹æ³•çš„çº¿ç¨‹ä»ç„¶å¯èƒ½æ— æ³•çœ‹åˆ° final åŸŸè¢«åˆå§‹åŒ–åŽçš„å€¼ï¼Œå› ä¸ºè¿™é‡Œçš„æ“ä½œ 1 å’Œæ“ä½œ 2 ä¹‹é—´å¯èƒ½è¢«é‡æŽ’åºã€‚å®žé™…çš„æ‰§è¡Œæ—¶åºå¯èƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»Žä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šåœ¨æž„é€ å‡½æ•°è¿”å›žå‰ï¼Œè¢«æž„é€ å¯¹è±¡çš„å¼•ç”¨ä¸èƒ½ä¸ºå…¶ä»–çº¿ç¨‹å¯è§ï¼Œå› ä¸ºæ­¤æ—¶çš„ final åŸŸå¯èƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚åœ¨æž„é€ å‡½æ•°è¿”å›žåŽï¼Œä»»æ„çº¿ç¨‹éƒ½å°†ä¿è¯èƒ½çœ‹åˆ° final åŸŸæ­£ç¡®åˆå§‹åŒ–ä¹‹åŽçš„å€¼ã€‚ JSR-133ä¸ºä»€ä¹ˆè¦å¢žå¼ºfinalè¯­ä¹‰ åœ¨æ—§çš„ Java å†…å­˜æ¨¡åž‹ä¸­ ï¼Œæœ€ä¸¥é‡çš„ä¸€ä¸ªç¼ºé™·å°±æ˜¯çº¿ç¨‹å¯èƒ½çœ‹åˆ° final åŸŸçš„å€¼ä¼šæ”¹å˜ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹å½“å‰çœ‹åˆ°ä¸€ä¸ªæ•´å½¢ final åŸŸçš„å€¼ä¸º 0ï¼ˆè¿˜æœªåˆå§‹åŒ–ä¹‹å‰çš„é»˜è®¤å€¼ï¼‰ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åŽè¿™ä¸ªçº¿ç¨‹å†åŽ»è¯»è¿™ä¸ª final åŸŸçš„å€¼æ—¶ï¼Œå´å‘çŽ°å€¼å˜ä¸ºäº† 1ï¼ˆè¢«æŸä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¹‹åŽçš„å€¼ï¼‰ã€‚æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯åœ¨æ—§çš„ Java å†…å­˜æ¨¡åž‹ä¸­ï¼ŒString çš„å€¼å¯èƒ½ä¼šæ”¹å˜ã€‚ ä¸ºäº†ä¿®è¡¥è¿™ä¸ªæ¼æ´žï¼ŒJSR-133 ä¸“å®¶ç»„å¢žå¼ºäº† final çš„è¯­ä¹‰ã€‚é€šè¿‡ä¸º final åŸŸå¢žåŠ å†™å’Œè¯»é‡æŽ’åºè§„åˆ™ï¼Œå¯ä»¥ä¸º java ç¨‹åºå‘˜æä¾›åˆå§‹åŒ–å®‰å…¨ä¿è¯ï¼šåªè¦å¯¹è±¡æ˜¯æ­£ç¡®æž„é€ çš„ï¼ˆè¢«æž„é€ å¯¹è±¡çš„å¼•ç”¨åœ¨æž„é€ å‡½æ•°ä¸­æ²¡æœ‰â€œé€¸å‡ºâ€ï¼‰ï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼ˆæŒ‡ lock å’Œ volatile çš„ä½¿ç”¨ï¼‰ï¼Œå°±å¯ä»¥ä¿è¯ä»»æ„çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°è¿™ä¸ª final åŸŸåœ¨æž„é€ å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ä¹‹åŽçš„å€¼ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-ç†è§£é”]]></title>
    <url>%2Fposts%2Fa87ac669.html</url>
    <content type="text"><![CDATA[é”çš„happens-beforeå…³ç³» é”æ˜¯ java å¹¶å‘ç¼–ç¨‹ä¸­æœ€é‡è¦çš„åŒæ­¥æœºåˆ¶ã€‚é”é™¤äº†è®©ä¸´ç•ŒåŒºäº’æ–¥æ‰§è¡Œå¤–ï¼Œè¿˜å¯ä»¥è®©é‡Šæ”¾é”çš„çº¿ç¨‹å‘èŽ·å–åŒä¸€ä¸ªé”çš„çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚ 123456789101112class MonitorExample &#123; int a = 0; public synchronized void writer() &#123; //1 a++; //2 &#125; //3 public synchronized void reader() &#123; //4 int i = a; //5 â€¦â€¦ &#125; //6&#125; å‡è®¾çº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ï¼ŒéšåŽçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚æ ¹æ® happens before è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…å«çš„ happens before å…³ç³»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2, 2 happens before 3; 4 happens before 5, 5 happens before 6ã€‚ æ ¹æ®ç›‘è§†å™¨é”è§„åˆ™ï¼Œ3 happens before 4ã€‚ æ ¹æ® happens before çš„ä¼ é€’æ€§ï¼Œ2 happens before 5ã€‚ ä¸Šè¿° happens-before å…³ç³»å›¾å¦‚ä¸‹ï¼š ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æŽ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ª happens before å…³ç³»ã€‚é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›æ©™è‰²ç®­å¤´è¡¨ç¤ºç›‘è§†å™¨é”è§„åˆ™ï¼›è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åŽæä¾›çš„ happens before ä¿è¯ã€‚ ä¸Šå›¾è¡¨ç¤ºåœ¨çº¿ç¨‹ A é‡Šæ”¾äº†é”ä¹‹åŽï¼ŒéšåŽçº¿ç¨‹ B èŽ·å–åŒä¸€ä¸ªé”ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œ2 happens before 5ã€‚å› æ­¤ï¼Œçº¿ç¨‹ A åœ¨é‡Šæ”¾é”ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨çº¿ç¨‹ B èŽ·å–åŒä¸€ä¸ªé”ä¹‹åŽï¼Œå°†ç«‹åˆ»å˜å¾—å¯¹ B çº¿ç¨‹å¯è§ã€‚ é”çš„å†…å­˜è¯­ä¹‰ é”é‡Šæ”¾çš„å†…å­˜è¯­ä¹‰ å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ä»¥ä¸Šé¢çš„ç¨‹åºä¸ºä¾‹ï¼ŒA çº¿ç¨‹é‡Šæ”¾é”åŽï¼Œå…±äº«æ•°æ®çš„çŠ¶æ€ç¤ºæ„å›¾å¦‚ä¸‹ï¼š é”èŽ·å–çš„å†…å­˜è¯­ä¹‰ å½“çº¿ç¨‹èŽ·å–é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚ä»Žè€Œä½¿å¾—è¢«ç›‘è§†å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»è¦ä»Žä¸»å†…å­˜ä¸­åŽ»è¯»å–å…±äº«å˜é‡ã€‚ä¸‹é¢æ˜¯é”èŽ·å–çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¯¹æ¯”é”é‡Šæ”¾ - èŽ·å–çš„å†…å­˜è¯­ä¹‰ä¸Ž volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œå¯ä»¥çœ‹å‡ºï¼šé”é‡Šæ”¾ä¸Ž volatile å†™æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›é”èŽ·å–ä¸Ž volatile è¯»æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ é”å†…å­˜è¯­ä¹‰çš„å®žçŽ° 1234567891011121314151617181920212223class ReentrantLockExample &#123; int a = 0; ReentrantLock lock = new ReentrantLock(); public void writer() &#123; lock.lock(); // èŽ·å–é” try &#123; a++; &#125; finally &#123; lock.unlock(); // é‡Šæ”¾é” &#125; &#125; public void reader () &#123; lock.lock(); // èŽ·å–é” try &#123; int i = a; â€¦â€¦ &#125; finally &#123; lock.unlock(); // é‡Šæ”¾é” &#125; &#125;&#125; åœ¨ ReentrantLock ä¸­ï¼Œè°ƒç”¨ lock() æ–¹æ³•èŽ·å–é”ï¼›è°ƒç”¨ unlock() æ–¹æ³•é‡Šæ”¾é”ã€‚ ReentrantLock çš„å®žçŽ°ä¾èµ–äºŽ java åŒæ­¥å™¨æ¡†æž¶ AbstractQueuedSynchronizerï¼ˆç®€ç§° AQSï¼‰ã€‚AQS ä½¿ç”¨ä¸€ä¸ªæ•´åž‹çš„ volatile å˜é‡ï¼ˆå‘½åä¸º stateï¼‰æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œé©¬ä¸Šæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œè¿™ä¸ª volatile å˜é‡æ˜¯ ReentrantLock å†…å­˜è¯­ä¹‰å®žçŽ°çš„å…³é”®ã€‚ ä¸‹é¢æ˜¯ ReentrantLock çš„ç±»å›¾ï¼ˆä»…éƒ¨åˆ†ï¼‰ï¼š ReentrantLock åˆ†ä¸ºå…¬å¹³é”å’Œéžå…¬å¹³é”ï¼Œé¦–å…ˆåˆ†æžå…¬å¹³é”ã€‚ ä½¿ç”¨å…¬å¹³é”æ—¶ï¼ŒåŠ é”æ–¹æ³• lock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : lock() FairSync : lock() AbstractQueuedSynchronizer : acquire(int arg) ReentrantLock : tryAcquire(int acquires) åœ¨ç¬¬ 4 æ­¥çœŸæ­£å¼€å§‹åŠ é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 12345678910111213141516171819protected final boolean tryAcquire(int acquires) &#123; final Thread current = Thread.currentThread(); int c = getState(); // èŽ·å–é”çš„å¼€å§‹ï¼Œé¦–å…ˆè¯» volatile å˜é‡ state if (c == 0) &#123; if (isFirst(current) &amp;&amp; compareAndSetState(0, acquires)) &#123; setExclusiveOwnerThread(current); return true; &#125; &#125; else if (current == getExclusiveOwnerThread()) &#123; int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; &#125; return false;&#125; ä»Žä¸Šé¢æºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŠ é”æ–¹æ³•é¦–å…ˆè¯» volatile å˜é‡ stateã€‚ åœ¨ä½¿ç”¨å…¬å¹³é”æ—¶ï¼Œè§£é”æ–¹æ³• unlock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : unlock() AbstractQueuedSynchronizer : release(int arg) Sync : tryRelease(int releases) åœ¨ç¬¬ 3 æ­¥çœŸæ­£å¼€å§‹é‡Šæ”¾é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 123456789101112protected final boolean tryRelease(int releases) &#123; int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) &#123; free = true; setExclusiveOwnerThread(null); &#125; setState(c); // é‡Šæ”¾é”çš„æœ€åŽï¼Œå†™ volatile å˜é‡ state return free;&#125; ä»Žä¸Šé¢çš„æºä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨é‡Šæ”¾é”çš„æœ€åŽå†™ volatile å˜é‡ stateã€‚ å…¬å¹³é”åœ¨é‡Šæ”¾é”çš„æœ€åŽå†™ volatile å˜é‡ stateï¼›åœ¨èŽ·å–é”æ—¶é¦–å…ˆè¯»è¿™ä¸ª volatile å˜é‡ã€‚æ ¹æ® volatile çš„ happens-before è§„åˆ™ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™ volatile å˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨èŽ·å–é”çš„çº¿ç¨‹è¯»å–åŒä¸€ä¸ª volatile å˜é‡åŽå°†ç«‹å³å˜çš„å¯¹èŽ·å–é”çš„çº¿ç¨‹å¯è§ã€‚ çŽ°åœ¨åˆ†æžéžå…¬å¹³é”çš„å†…å­˜è¯­ä¹‰çš„å®žçŽ°ã€‚ éžå…¬å¹³é”çš„é‡Šæ”¾å’Œå…¬å¹³é”å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œä»…ä»…åˆ†æžéžå…¬å¹³é”çš„èŽ·å–ã€‚ ä½¿ç”¨å…¬å¹³é”æ—¶ï¼ŒåŠ é”æ–¹æ³• lock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : lock() NonfairSync : lock() AbstractQueuedSynchronizer : compareAndSetState(int expect, int update) åœ¨ç¬¬ 3 æ­¥çœŸæ­£å¼€å§‹åŠ é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 123protected final boolean compareAndSetState(int expect, int update) &#123; return unsafe.compareAndSwapInt(this, stateOffset, expect, update);&#125; è¯¥æ–¹æ³•ä»¥åŽŸå­æ“ä½œçš„æ–¹å¼æ›´æ–° state å˜é‡ï¼ŒJDK æ–‡æ¡£å¯¹è¯¥æ–¹æ³•çš„è¯´æ˜Žå¦‚ä¸‹ï¼šå¦‚æžœå½“å‰çŠ¶æ€å€¼ç­‰äºŽé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŽŸå­æ–¹å¼å°†åŒæ­¥çŠ¶æ€è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚æ­¤æ“ä½œå…·æœ‰ volatile è¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰ã€‚ å‰æ–‡è¯´è¿‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹ volatile è¯»ä¸Ž volatile è¯»åŽé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºï¼›ç¼–è¯‘å™¨ä¸ä¼šå¯¹ volatile å†™ä¸Ž volatile å†™å‰é¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºã€‚ç»„åˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€ä¸ºäº†åŒæ—¶å®žçŽ° volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨ä¸èƒ½å¯¹ CAS ä¸Ž CAS å‰é¢å’ŒåŽé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æŽ’åºã€‚ å¯¹å…¬å¹³é”å’Œéžå…¬å¹³é”çš„å†…å­˜è¯­ä¹‰åšä¸ªæ€»ç»“ï¼š å…¬å¹³é”å’Œéžå…¬å¹³é”é‡Šæ”¾æ—¶ï¼Œæœ€åŽéƒ½è¦å†™ä¸€ä¸ª volatile å˜é‡ stateã€‚ å…¬å¹³é”èŽ·å–æ—¶ï¼Œé¦–å…ˆä¼šåŽ»è¯»è¿™ä¸ª volatile å˜é‡ã€‚ éžå…¬å¹³é”èŽ·å–æ—¶ï¼Œé¦–å…ˆä¼šç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡, è¿™ä¸ªæ“ä½œåŒæ—¶å…·æœ‰ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ã€‚ ä»Žå¯¹ ReentrantLock çš„åˆ†æžå¯ä»¥çœ‹å‡ºï¼Œé”é‡Šæ”¾ - èŽ·å–çš„å†…å­˜è¯­ä¹‰çš„å®žçŽ°è‡³å°‘æœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š åˆ©ç”¨ volatile å˜é‡çš„å†™ - è¯»æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ã€‚ åˆ©ç”¨ CAS æ‰€é™„å¸¦çš„ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ã€‚ J.U.CåŒ…çš„å®žçŽ° ç”±äºŽ java çš„ CAS åŒæ—¶å…·æœ‰ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ï¼Œå› æ­¤ Java çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡çŽ°åœ¨æœ‰äº†ä¸‹é¢å››ç§æ–¹å¼ï¼š A çº¿ç¨‹å†™ volatile å˜é‡ï¼ŒéšåŽ B çº¿ç¨‹è¯»è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹å†™ volatile å˜é‡ï¼ŒéšåŽ B çº¿ç¨‹ç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹ç”¨ CAS æ›´æ–°ä¸€ä¸ª volatile å˜é‡ï¼ŒéšåŽ B çº¿ç¨‹ç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹ç”¨ CAS æ›´æ–°ä¸€ä¸ª volatile å˜é‡ï¼ŒéšåŽ B çº¿ç¨‹è¯»è¿™ä¸ª volatile å˜é‡ã€‚ Java çš„ CAS ä¼šä½¿ç”¨çŽ°ä»£å¤„ç†å™¨ä¸Šæä¾›çš„é«˜æ•ˆæœºå™¨çº§åˆ«åŽŸå­æŒ‡ä»¤ï¼Œè¿™äº›åŽŸå­æŒ‡ä»¤ä»¥åŽŸå­æ–¹å¼å¯¹å†…å­˜æ‰§è¡Œè¯» - æ”¹ - å†™æ“ä½œï¼Œè¿™æ˜¯åœ¨å¤šå¤„ç†å™¨ä¸­å®žçŽ°åŒæ­¥çš„å…³é”®ï¼ˆä»Žæœ¬è´¨ä¸Šæ¥è¯´ï¼Œèƒ½å¤Ÿæ”¯æŒåŽŸå­æ€§è¯» - æ”¹ - å†™æŒ‡ä»¤çš„è®¡ç®—æœºå™¨ï¼Œæ˜¯é¡ºåºè®¡ç®—å›¾çµæœºçš„å¼‚æ­¥ç­‰ä»·æœºå™¨ï¼Œå› æ­¤ä»»ä½•çŽ°ä»£çš„å¤šå¤„ç†å™¨éƒ½ä¼šåŽ»æ”¯æŒæŸç§èƒ½å¯¹å†…å­˜æ‰§è¡ŒåŽŸå­æ€§è¯» - æ”¹ - å†™æ“ä½œçš„åŽŸå­æŒ‡ä»¤ï¼‰ã€‚åŒæ—¶ï¼Œvolatile å˜é‡çš„è¯» / å†™å’Œ CAS å¯ä»¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚æŠŠè¿™äº›ç‰¹æ€§æ•´åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†æ•´ä¸ª J.U.C åŒ…å¾—ä»¥å®žçŽ°çš„åŸºçŸ³ã€‚å¦‚æžœä»”ç»†åˆ†æž J.U.C åŒ…çš„æºä»£ç å®žçŽ°ï¼Œä¼šå‘çŽ°ä¸€ä¸ªé€šç”¨åŒ–çš„å®žçŽ°æ¨¡å¼ï¼š é¦–å…ˆï¼Œå£°æ˜Žå…±äº«å˜é‡ä¸º volatileï¼› ç„¶åŽï¼Œä½¿ç”¨ CAS çš„åŽŸå­æ¡ä»¶æ›´æ–°æ¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼› åŒæ—¶ï¼Œé…åˆä»¥ volatile çš„è¯» / å†™å’Œ CAS æ‰€å…·æœ‰çš„ volatile è¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®žçŽ°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ AQSï¼Œéžé˜»å¡žæ•°æ®ç»“æž„å’ŒåŽŸå­å˜é‡ç±»ï¼ˆjava.util.concurrent.atomic åŒ…ä¸­çš„ç±»ï¼‰ï¼Œè¿™äº› J.U.C åŒ…ä¸­çš„åŸºç¡€ç±»éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ¨¡å¼æ¥å®žçŽ°çš„ï¼Œè€Œ J.U.C åŒ…ä¸­çš„é«˜å±‚ç±»åˆæ˜¯ä¾èµ–äºŽè¿™äº›åŸºç¡€ç±»æ¥å®žçŽ°çš„ã€‚ä»Žæ•´ä½“æ¥çœ‹ï¼ŒJ.U.C åŒ…çš„å®žçŽ°ç¤ºæ„å›¾å¦‚ä¸‹ï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-é¡ºåºä¸€è‡´æ€§æ¨¡åž‹]]></title>
    <url>%2Fposts%2F60b19e41.html</url>
    <content type="text"><![CDATA[é¡ºåºä¸€è‡´æ€§ä¿è¯ å½“ç¨‹åºæœªæ­£ç¡®åŒæ­¥æ—¶ï¼Œå°±ä¼šå­˜åœ¨æ•°æ®ç«žäº‰ã€‚java å†…å­˜æ¨¡åž‹è§„èŒƒå¯¹æ•°æ®ç«žäº‰çš„å®šä¹‰å¦‚ä¸‹ï¼š åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å†™ä¸€ä¸ªå˜é‡ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»åŒä¸€ä¸ªå˜é‡ï¼Œè€Œä¸”å†™å’Œè¯»æ²¡æœ‰é€šè¿‡åŒæ­¥æ¥æŽ’åºã€‚ å½“ä»£ç ä¸­åŒ…å«æ•°æ®ç«žäº‰æ—¶ï¼Œç¨‹åºçš„æ‰§è¡Œå¾€å¾€äº§ç”Ÿè¿åç›´è§‰çš„ç»“æžœã€‚å¦‚æžœä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºèƒ½æ­£ç¡®åŒæ­¥ï¼Œè¿™ä¸ªç¨‹åºå°†æ˜¯ä¸€ä¸ªæ²¡æœ‰æ•°æ®ç«žäº‰çš„ç¨‹åºã€‚ JMM å¯¹æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„å†…å­˜ä¸€è‡´æ€§åšäº†å¦‚ä¸‹ä¿è¯ï¼š å¦‚æžœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆsequentially consistentï¼‰-- å³ç¨‹åºçš„æ‰§è¡Œç»“æžœä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœç›¸åŒã€‚è¿™é‡Œçš„åŒæ­¥æ˜¯æŒ‡å¹¿ä¹‰ä¸Šçš„åŒæ­¥ï¼ŒåŒ…æ‹¬å¯¹å¸¸ç”¨åŒæ­¥åŽŸè¯­ï¼ˆlockï¼Œvolatile å’Œ finalï¼‰çš„æ­£ç¡®ä½¿ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹æ˜¯ç†è®ºå‚è€ƒæ¨¡åž‹ï¼Œå®ƒä¸ºç¨‹åºå‘˜æä¾›äº†æžå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œã€‚ ï¼ˆä¸ç®¡ç¨‹åºæ˜¯å¦åŒæ­¥ï¼‰æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŽŸå­æ‰§è¡Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸ºç¨‹åºå‘˜æä¾›çš„è§†å›¾å¦‚ä¸‹ï¼š åœ¨æ¦‚å¿µä¸Šï¼Œé¡ºåºä¸€è‡´æ€§æ¨¡åž‹æœ‰ä¸€ä¸ªå•ä¸€çš„å…¨å±€å†…å­˜ï¼Œè¿™ä¸ªå†…å­˜é€šè¿‡ä¸€ä¸ªå·¦å³æ‘†åŠ¨çš„å¼€å…³å¯ä»¥è¿žæŽ¥åˆ°ä»»æ„ä¸€ä¸ªçº¿ç¨‹ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¿…é¡»æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œå†…å­˜è¯» / å†™æ“ä½œã€‚åœ¨ä»»æ„æ—¶é—´ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿žæŽ¥åˆ°å†…å­˜ã€‚å½“å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå›¾ä¸­çš„å¼€å…³è£…ç½®èƒ½æŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜è¯» / å†™æ“ä½œä¸²è¡ŒåŒ–ã€‚ ç¤ºä¾‹ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ B å¹¶å‘æ‰§è¡Œã€‚å…¶ä¸­ A çº¿ç¨‹æœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šA1-&gt;A2-&gt;A3ã€‚B çº¿ç¨‹ä¹Ÿæœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šB1-&gt;B2-&gt;B3ã€‚ å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨ç›‘è§†å™¨æ¥æ­£ç¡®åŒæ­¥ï¼šA çº¿ç¨‹çš„ä¸‰ä¸ªæ“ä½œæ‰§è¡ŒåŽé‡Šæ”¾ç›‘è§†å™¨ï¼ŒéšåŽ B çº¿ç¨‹èŽ·å–åŒä¸€ä¸ªç›‘è§†å™¨ã€‚é‚£ä¹ˆç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­çš„æ‰§è¡Œæ•ˆæžœå°†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å†å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹æ²¡æœ‰åšåŒæ­¥ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªæœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­çš„æ‰§è¡Œç¤ºæ„å›¾ï¼š æœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­è™½ç„¶æ•´ä½“æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œä½†æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªä¸€è‡´çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œçº¿ç¨‹ A å’Œ B çœ‹åˆ°çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯ï¼šB1-&gt;A1-&gt;A2-&gt;B2-&gt;A3-&gt;B3ã€‚ä¹‹æ‰€ä»¥èƒ½å¾—åˆ°è¿™ä¸ªä¿è¯æ˜¯å› ä¸ºé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡åž‹ä¸­çš„æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§ã€‚ ä½†æ˜¯ï¼Œåœ¨ JMM ä¸­å°±æ²¡æœ‰è¿™ä¸ªä¿è¯ã€‚æœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­ä¸ä½†æ•´ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œè€Œä¸”æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºä¹Ÿå¯èƒ½ä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œåœ¨å½“å‰çº¿ç¨‹æŠŠå†™è¿‡çš„æ•°æ®ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œä¸”è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹å‰ï¼Œè¿™ä¸ªå†™æ“ä½œä»…å¯¹å½“å‰çº¿ç¨‹å¯è§ï¼›ä»Žå…¶ä»–çº¿ç¨‹çš„è§’åº¦æ¥è§‚å¯Ÿï¼Œä¼šè®¤ä¸ºè¿™ä¸ªå†™æ“ä½œæ ¹æœ¬è¿˜æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚åªæœ‰å½“å‰çº¿ç¨‹æŠŠæœ¬åœ°å†…å­˜ä¸­å†™è¿‡çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åŽï¼Œè¿™ä¸ªå†™æ“ä½œæ‰èƒ½å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹å’Œå…¶å®ƒçº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºå°†ä¸ä¸€è‡´ã€‚ åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§ 12345678910111213141516class SynchronizedExample &#123; int a = 0; boolean flag = false; public synchronized void writer() &#123; a = 1; flag = true; &#125; public synchronized void reader() &#123; if (flag) &#123; int i = a; â€¦â€¦ &#125; &#125;&#125; ç¤ºä¾‹ä»£ç ä¸­ï¼Œå‡è®¾ A çº¿ç¨‹æ‰§è¡Œ writer() æ–¹æ³•åŽï¼ŒB çº¿ç¨‹æ‰§è¡Œ reader() æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ ¹æ® JMM è§„èŒƒï¼Œè¯¥ç¨‹åºçš„æ‰§è¡Œç»“æžœå°†ä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœç›¸åŒã€‚å¦‚ä¸‹æ‰§è¡Œå¯¹æ¯”å›¾ï¼š åœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œå®Œå…¨æŒ‰ç¨‹åºçš„é¡ºåºä¸²è¡Œæ‰§è¡Œã€‚è€Œåœ¨ JMM ä¸­ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æŽ’åºï¼ˆä½† JMM ä¸å…è®¸ä¸´ç•ŒåŒºå†…çš„ä»£ç â€œé€¸å‡ºâ€åˆ°ä¸´ç•ŒåŒºä¹‹å¤–ï¼Œé‚£æ ·ä¼šç ´åç›‘è§†å™¨çš„è¯­ä¹‰ï¼‰ã€‚JMM ä¼šåœ¨é€€å‡ºç›‘è§†å™¨å’Œè¿›å…¥ç›‘è§†å™¨è¿™ä¸¤ä¸ªå…³é”®æ—¶é—´ç‚¹åšä¸€äº›ç‰¹åˆ«å¤„ç†ï¼Œä½¿å¾—çº¿ç¨‹åœ¨è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹å…·æœ‰ä¸Žé¡ºåºä¸€è‡´æ€§æ¨¡åž‹ç›¸åŒçš„å†…å­˜è§†å›¾ã€‚è™½ç„¶çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…åšäº†é‡æŽ’åºï¼Œä½†ç”±äºŽç›‘è§†å™¨çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§ï¼Œè¿™é‡Œçš„çº¿ç¨‹ B æ ¹æœ¬æ— æ³•â€œè§‚å¯Ÿâ€åˆ°çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…çš„é‡æŽ’åºã€‚è¿™ç§é‡æŽ’åºæ—¢æé«˜äº†æ‰§è¡Œæ•ˆçŽ‡ï¼Œåˆæ²¡æœ‰æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æžœã€‚ ä»Žè¿™é‡Œå¯ä»¥çœ‹åˆ° JMM åœ¨å…·ä½“å®žçŽ°ä¸Šçš„åŸºæœ¬æ–¹é’ˆï¼šåœ¨ä¸æ”¹å˜ï¼ˆæ­£ç¡®åŒæ­¥çš„ï¼‰ç¨‹åºæ‰§è¡Œç»“æžœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„ä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–æ‰“å¼€æ–¹ä¾¿ä¹‹é—¨ã€‚ æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§ å¯¹äºŽæœªåŒæ­¥æˆ–æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼ŒJMM åªæä¾›æœ€å°å®‰å…¨æ€§ï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼Œnullï¼Œfalseï¼‰ï¼ŒJMM ä¿è¯çº¿ç¨‹è¯»æ“ä½œè¯»å–åˆ°çš„å€¼ä¸ä¼šæ— ä¸­ç”Ÿæœ‰ï¼ˆout of thin airï¼‰çš„å†’å‡ºæ¥ã€‚ä¸ºäº†å®žçŽ°æœ€å°å®‰å…¨æ€§ï¼ŒJVM åœ¨å †ä¸Šåˆ†é…å¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šæ¸…é›¶å†…å­˜ç©ºé—´ï¼Œç„¶åŽæ‰ä¼šåœ¨ä¸Šé¢åˆ†é…å¯¹è±¡ï¼ˆJVM å†…éƒ¨ä¼šåŒæ­¥è¿™ä¸¤ä¸ªæ“ä½œï¼‰ã€‚å› æ­¤ï¼Œåœ¨å·²æ¸…é›¶çš„å†…å­˜ç©ºé—´ï¼ˆpre-zeroed memoryï¼‰åˆ†é…å¯¹è±¡æ—¶ï¼ŒåŸŸçš„é»˜è®¤åˆå§‹åŒ–å·²ç»å®Œæˆäº†ã€‚ JMM ä¸ä¿è¯æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç»“æžœä¸Žè¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœä¸€è‡´ã€‚å› ä¸ºæœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸­æ‰§è¡Œæ—¶ï¼Œæ•´ä½“ä¸Šæ˜¯æ— åºçš„ï¼Œå…¶æ‰§è¡Œç»“æžœæ— æ³•é¢„çŸ¥ã€‚ä¿è¯æœªåŒæ­¥ç¨‹åºåœ¨ä¸¤ä¸ªæ¨¡åž‹ä¸­çš„æ‰§è¡Œç»“æžœä¸€è‡´æ¯«æ— æ„ä¹‰ã€‚ å’Œé¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¸€æ ·ï¼ŒæœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­çš„æ‰§è¡Œæ—¶ï¼Œæ•´ä½“ä¸Šä¹Ÿæ˜¯æ— åºçš„ï¼Œå…¶æ‰§è¡Œç»“æžœä¹Ÿæ— æ³•é¢„çŸ¥ã€‚åŒæ—¶ï¼ŒæœªåŒæ­¥ç¨‹åºåœ¨è¿™ä¸¤ä¸ªæ¨¡åž‹ä¸­çš„æ‰§è¡Œç‰¹æ€§æœ‰ä¸‹é¢å‡ ä¸ªå·®å¼‚ï¼š é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼Œè€Œ JMM ä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œè¿°ã€‚ é¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¿è¯æ‰€æœ‰çº¿ç¨‹åªèƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œè€Œ JMM ä¸ä¿è¯æ‰€æœ‰çº¿ç¨‹èƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚ã€‚ JMM ä¸ä¿è¯å¯¹ 64 ä½çš„ long åž‹å’Œ double åž‹å˜é‡çš„è¯» / å†™æ“ä½œå…·æœ‰åŽŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ¨¡åž‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯» / å†™æ“ä½œéƒ½å…·æœ‰åŽŸå­æ€§ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-æŒ‡ä»¤é‡æŽ’åº]]></title>
    <url>%2Fposts%2F60874885.html</url>
    <content type="text"><![CDATA[æ•°æ®ä¾èµ–æ€§ å¦‚æžœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚æ•°æ®ä¾èµ–åˆ†ä¸‹åˆ—ä¸‰ç§ç±»åž‹ï¼š åç§° ä»£ç ç¤ºä¾‹ è¯´æ˜Ž å†™åŽè¯» a = 1;b = a; å†™ä¸€ä¸ªå˜é‡ä¹‹åŽï¼Œå†è¯»è¿™ä¸ªå˜é‡ã€‚ å†™åŽå†™ a = 1;a = 2; å†™ä¸€ä¸ªå˜é‡åŽï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ è¯»åŽå†™ a = b;b = 1; è¯»ä¸€ä¸ªå˜é‡ä¹‹åŽï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œåªè¦é‡æŽ’åºä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œç¨‹åºçš„æ‰§è¡Œç»“æžœå°†ä¼šè¢«æ”¹å˜ã€‚ ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æ“ä½œåšé‡æŽ’åºã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨é‡æŽ’åºæ—¶ï¼Œä¼šéµå®ˆæ•°æ®ä¾èµ–æ€§ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚ æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ã€‚ as-if-serialè¯­ä¹‰ as-if-serial è¯­ä¹‰æ˜¯æŒ‡ï¼šä¸ç®¡æ€Žä¹ˆé‡æŽ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æžœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚ ä¸ºäº†éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æŽ’åºï¼Œå› ä¸ºè¿™ç§é‡æŽ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æžœã€‚ä½†æ˜¯ï¼Œå¦‚æžœæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æŽ’åºã€‚å¦‚ä¸‹è®¡ç®—åœ†é¢ç§¯çš„ä»£ç ç¤ºä¾‹ï¼š 123double pi = 3.14; //Adouble r = 1.0; //Bdouble area = pi * r * r; //C ä¸Šé¢ä¸‰ä¸ªæ“ä½œçš„æ•°æ®ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒA å’Œ C ä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶ B å’Œ C ä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒC ä¸èƒ½è¢«é‡æŽ’åºåˆ° A å’Œ B çš„å‰é¢ï¼ˆC æŽ’åˆ° A å’Œ B çš„å‰é¢ï¼Œç¨‹åºçš„ç»“æžœå°†ä¼šè¢«æ”¹å˜ï¼‰ã€‚ä½† A å’Œ B ä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æŽ’åº A å’Œ B ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹å›¾æ˜¯è¯¥ç¨‹åºçš„ä¸¤ç§æ‰§è¡Œé¡ºåºï¼š as-if-serial è¯­ä¹‰æŠŠå•çº¿ç¨‹ç¨‹åºä¿æŠ¤äº†èµ·æ¥ï¼Œéµå®ˆ as-if-serial è¯­ä¹‰çš„ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨å…±åŒä¸ºç¼–å†™å•çº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›å»ºäº†ä¸€ä¸ªå¹»è§‰ï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚as-if-serial è¯­ä¹‰ä½¿å•çº¿ç¨‹ç¨‹åºå‘˜æ— éœ€æ‹…å¿ƒé‡æŽ’åºä¼šå¹²æ‰°ä»–ä»¬ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒå†…å­˜å¯è§æ€§é—®é¢˜ã€‚ ç¨‹åºé¡ºåºè§„åˆ™ æ ¹æ® happens- before çš„ç¨‹åºé¡ºåºè§„åˆ™ï¼Œä¸Šé¢è®¡ç®—åœ†çš„é¢ç§¯çš„ç¤ºä¾‹ä»£ç å­˜åœ¨ä¸‰ä¸ª happens- before å…³ç³»ï¼š A happens- before Bï¼› B happens- before Cï¼› A happens- before Cï¼› è¿™é‡Œçš„ç¬¬ 3 ä¸ª happens- before å…³ç³»ï¼Œæ˜¯æ ¹æ® happens- before çš„ä¼ é€’æ€§æŽ¨å¯¼å‡ºæ¥çš„ã€‚ è¿™é‡Œ A happens- before Bï¼Œä½†å®žé™…æ‰§è¡Œæ—¶ B å´å¯ä»¥æŽ’åœ¨ A ä¹‹å‰æ‰§è¡Œã€‚æ ¹æ®happens-beforeè§„åˆ™ï¼Œå¦‚æžœ A happens- before Bï¼ŒJMM å¹¶ä¸è¦æ±‚ A ä¸€å®šè¦åœ¨ B ä¹‹å‰æ‰§è¡Œã€‚JMM ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æžœï¼‰å¯¹åŽä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæŽ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚è¿™é‡Œæ“ä½œ A çš„æ‰§è¡Œç»“æžœä¸éœ€è¦å¯¹æ“ä½œ B å¯è§ï¼›è€Œä¸”é‡æŽ’åºæ“ä½œ A å’Œæ“ä½œ B åŽçš„æ‰§è¡Œç»“æžœï¼Œä¸Žæ“ä½œ A å’Œæ“ä½œ B æŒ‰ happens- before é¡ºåºæ‰§è¡Œçš„ç»“æžœä¸€è‡´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJMM ä¼šè®¤ä¸ºè¿™ç§é‡æŽ’åºå¹¶ä¸éžæ³•ï¼ˆnot illegalï¼‰ï¼ŒJMM å…è®¸è¿™ç§é‡æŽ’åºã€‚ åœ¨è®¡ç®—æœºä¸­ï¼Œè½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æžœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„å¼€å‘å¹¶è¡Œåº¦ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµä»Žè¿™ä¸€ç›®æ ‡ï¼Œä»Ž happens- before çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒJMM åŒæ ·éµä»Žè¿™ä¸€ç›®æ ‡ã€‚ é‡æŽ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“ 12345678910111213141516class ReorderExample &#123; int a = 0; boolean flag = false; public void writer() &#123; a = 1; //1 flag = true; //2 &#125; Public void reader() &#123; if (flag) &#123; //3 int i = a * a; //4 â€¦â€¦ &#125; &#125;&#125; flag å˜é‡æ˜¯ä¸ªæ ‡è®°ï¼Œç”¨æ¥æ ‡è¯†å˜é‡ a æ˜¯å¦å·²è¢«å†™å…¥ã€‚è¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ Bï¼ŒA é¦–å…ˆæ‰§è¡Œ writer() æ–¹æ³•ï¼ŒéšåŽ B çº¿ç¨‹æŽ¥ç€æ‰§è¡Œ reader() æ–¹æ³•ã€‚çº¿ç¨‹ B åœ¨æ‰§è¡Œæ“ä½œ 4 æ—¶ï¼Œèƒ½å¦çœ‹åˆ°çº¿ç¨‹ A åœ¨æ“ä½œ 1 å¯¹å…±äº«å˜é‡ a çš„å†™å…¥ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä¸ä¸€å®šèƒ½çœ‹åˆ°ã€‚ ç”±äºŽæ“ä½œ 1 å’Œæ“ä½œ 2 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æŽ’åºï¼›åŒæ ·ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æŽ’åºã€‚ä¸‹é¢æ¥çœ‹çœ‹ï¼Œå½“æ“ä½œ 1 å’Œæ“ä½œ 2 é‡æŽ’åºæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæžœï¼Ÿå¦‚ä¸‹å›¾ï¼š æ“ä½œ 1 å’Œæ“ä½œ 2 åšäº†é‡æŽ’åºã€‚ç¨‹åºæ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆå†™æ ‡è®°å˜é‡ flagï¼ŒéšåŽçº¿ç¨‹ B è¯»è¿™ä¸ªå˜é‡ã€‚ç”±äºŽæ¡ä»¶åˆ¤æ–­ä¸ºçœŸï¼Œçº¿ç¨‹ B å°†è¯»å–å˜é‡ aã€‚æ­¤æ—¶ï¼Œå˜é‡ a è¿˜æ ¹æœ¬æ²¡æœ‰è¢«çº¿ç¨‹ A å†™å…¥ï¼Œåœ¨è¿™é‡Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æŽ’åºç ´åäº†ï¼ &lt;font color=&quot;red&quot;&gt;â€»æ³¨ï¼šçº¢è‰²çš„è™šç®­çº¿è¡¨ç¤ºé”™è¯¯çš„è¯»æ“ä½œï¼Œç”¨ç»¿è‰²çš„è™šç®­çº¿è¡¨ç¤ºæ­£ç¡®çš„è¯»æ“ä½œã€‚&lt;/font&gt; ä¸‹é¢å†çœ‹çœ‹ï¼Œå½“æ“ä½œ 3 å’Œæ“ä½œ 4 é‡æŽ’åºæ—¶ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæžœï¼ˆå€ŸåŠ©è¿™ä¸ªé‡æŽ’åºï¼Œå¯ä»¥é¡ºä¾¿è¯´æ˜ŽæŽ§åˆ¶ä¾èµ–æ€§ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼š åœ¨ç¨‹åºä¸­ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 å­˜åœ¨æŽ§åˆ¶ä¾èµ–å…³ç³»ã€‚å½“ä»£ç ä¸­å­˜åœ¨æŽ§åˆ¶ä¾èµ–æ€§æ—¶ï¼Œä¼šå½±å“æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šé‡‡ç”¨çŒœæµ‹ï¼ˆSpeculationï¼‰æ‰§è¡Œæ¥å…‹æœæŽ§åˆ¶ç›¸å…³æ€§å¯¹å¹¶è¡Œåº¦çš„å½±å“ã€‚ä»¥å¤„ç†å™¨çš„çŒœæµ‹æ‰§è¡Œä¸ºä¾‹ï¼Œæ‰§è¡Œçº¿ç¨‹ B çš„å¤„ç†å™¨å¯ä»¥æå‰è¯»å–å¹¶è®¡ç®— a*aï¼Œç„¶åŽæŠŠè®¡ç®—ç»“æžœä¸´æ—¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºé‡æŽ’åºç¼“å†²ï¼ˆreorder buffer ROBï¼‰çš„ç¡¬ä»¶ç¼“å­˜ä¸­ã€‚å½“æŽ¥ä¸‹æ¥æ“ä½œ 3 çš„æ¡ä»¶åˆ¤æ–­ä¸ºçœŸæ—¶ï¼Œå°±æŠŠè¯¥è®¡ç®—ç»“æžœå†™å…¥å˜é‡ i ä¸­ã€‚ ä»Žå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒçŒœæµ‹æ‰§è¡Œå®žè´¨ä¸Šå¯¹æ“ä½œ 3 å’Œ 4 åšäº†é‡æŽ’åºã€‚é‡æŽ’åºåœ¨è¿™é‡Œç ´åäº†å¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰ï¼ åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æŽ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æŽ’åºï¼Œä¸ä¼šæ”¹å˜æ‰§è¡Œç»“æžœï¼ˆè¿™ä¹Ÿæ˜¯ as-if-serial è¯­ä¹‰å…è®¸å¯¹å­˜åœ¨æŽ§åˆ¶ä¾èµ–çš„æ“ä½œåšé‡æŽ’åºçš„åŽŸå› ï¼‰ï¼›ä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æŽ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æŽ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æžœã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-æŠ½è±¡å·¥åŽ‚æ¨¡å¼]]></title>
    <url>%2Fposts%2F5a86ebac.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ æŠ½è±¡å·¥åŽ‚æ¨¡å¼ï¼Œå³Abstract Factory Patternï¼Œæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æŽ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ï¼›å…·ä½“çš„å·¥åŽ‚è´Ÿè´£å®žçŽ°å…·ä½“çš„äº§å“å®žä¾‹ã€‚ ä¸»è¦ä½œç”¨ å…è®¸ä½¿ç”¨æŠ½è±¡çš„æŽ¥å£æ¥åˆ›å»ºä¸€ç»„ç›¸å…³äº§å“ï¼Œè€Œä¸éœ€è¦çŸ¥é“æˆ–å…³å¿ƒå®žé™…ç”Ÿäº§å‡ºçš„å…·ä½“äº§å“æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·å°±å¯ä»¥ä»Žå…·ä½“äº§å“ä¸­è¢«è§£è€¦ã€‚ è§£å†³çš„é—®é¢˜ è§£å†³å·¥åŽ‚æ–¹æ³•æ¨¡å¼çš„ç¼ºç‚¹ï¼šæ¯ä¸ªå·¥åŽ‚åªèƒ½åˆ›å»ºä¸€ç±»äº§å“ã€‚ æ¨¡å¼åŽŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“æ—ï¼ˆAbstractProductï¼‰ æŠ½è±¡äº§å“çš„çˆ¶ç±» æè¿°æŠ½è±¡äº§å“çš„å…¬å…±æŽ¥å£ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥åŽ‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ æŠ½è±¡å·¥åŽ‚ï¼ˆCreatorï¼‰ å…·ä½“å·¥åŽ‚çš„çˆ¶ç±» æè¿°å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ å…·ä½“å·¥åŽ‚ï¼ˆConcrete Creatorï¼‰ æŠ½è±¡å·¥åŽ‚çš„å­ç±»ï¼› è¢«å¤–ç•Œè°ƒç”¨ æè¿°å…·ä½“å·¥åŽ‚ï¼› å®žçŽ°FactoryMethodå·¥åŽ‚æ–¹æ³•åˆ›å»ºäº§å“çš„å®žä¾‹ å¦‚ä½•ç†è§£æŠ½è±¡äº§å“æ—ã€æŠ½è±¡äº§å“å’Œå…·ä½“äº§å“çš„åŒºåˆ«å‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡å·¥åŽ‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“æ—ç±» ï¼Œå®šä¹‰æŠ½è±¡äº§å“çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“ç±» ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“æ—ç±»ï¼‰ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå…·ä½“å·¥åŽ‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥åŽ‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®žä¾‹çš„æ–¹æ³•ï¼› å®¢æˆ·ç«¯é€šè¿‡å®žä¾‹åŒ–å…·ä½“çš„å·¥åŽ‚ç±»ï¼Œå¹¶è°ƒç”¨å…¶åˆ›å»ºä¸åŒç›®æ ‡äº§å“çš„æ–¹æ³•åˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®žä¾‹ æ¨¡å¼ä¼˜ç‚¹ é™ä½Žè€¦åˆ æŠ½è±¡å·¥åŽ‚æ¨¡å¼å°†å…·ä½“äº§å“çš„åˆ›å»ºå»¶è¿Ÿåˆ°å…·ä½“å·¥åŽ‚çš„å­ç±»ä¸­ï¼Œè¿™æ ·å°†å¯¹è±¡çš„åˆ›å»ºå°è£…èµ·æ¥ï¼Œå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸Žå…·ä½“äº§å“ç±»ä¹‹é—´çš„ä¾èµ–ï¼Œä»Žè€Œä½¿ç³»ç»Ÿè€¦åˆåº¦ä½Žï¼Œè¿™æ ·æ›´æœ‰åˆ©äºŽåŽæœŸçš„ç»´æŠ¤å’Œæ‰©å±•ã€‚ æ›´ç¬¦åˆå¼€-é—­åŽŸåˆ™ æ–°å¢žä¸€ç§äº§å“ç±»æ—¶ï¼Œåªéœ€è¦å¢žåŠ ç›¸åº”çš„å…·ä½“äº§å“ç±»å’Œç›¸åº”çš„å·¥åŽ‚å­ç±»å³å¯ã€‚ ç¬¦åˆå•ä¸€èŒè´£åŽŸåˆ™ æ¯ä¸ªå…·ä½“å·¥åŽ‚ç±»åªè´Ÿè´£åˆ›å»ºå¯¹åº”çš„äº§å“ã€‚ ä¸ä½¿ç”¨é™æ€å·¥åŽ‚æ–¹æ³•ï¼Œå¯ä»¥å½¢æˆåŸºäºŽç»§æ‰¿çš„ç­‰çº§ç»“æž„ã€‚ æ¨¡å¼ç¼ºç‚¹ æŠ½è±¡å·¥åŽ‚æ¨¡å¼å¾ˆéš¾æ”¯æŒæ–°ç§ç±»äº§å“çš„å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºæŠ½è±¡å·¥åŽ‚æŽ¥å£ä¸­å·²ç»ç¡®å®šäº†å¯ä»¥è¢«åˆ›å»ºçš„äº§å“é›†åˆï¼Œå¦‚æžœéœ€è¦æ·»åŠ æ–°äº§å“ï¼Œæ­¤æ—¶å°±å¿…é¡»åŽ»ä¿®æ”¹æŠ½è±¡å·¥åŽ‚çš„æŽ¥å£ï¼Œè¿™æ ·å°±æ¶‰åŠåˆ°æŠ½è±¡å·¥åŽ‚ç±»çš„ä»¥åŠæ‰€æœ‰å­ç±»çš„æ”¹å˜ï¼Œè¿™æ ·ä¹Ÿå°±è¿èƒŒäº†â€œå¼€æ”¾â€”â€”å°é—­â€åŽŸåˆ™ã€‚ åº”ç”¨åœºæ™¯ ä¸€ä¸ªç³»ç»Ÿä¸è¦æ±‚ä¾èµ–äº§å“ç±»å®žä¾‹å¦‚ä½•è¢«åˆ›å»ºã€ç»„åˆå’Œè¡¨è¾¾çš„è¡¨è¾¾ï¼Œè¿™ç‚¹ä¹Ÿæ˜¯æ‰€æœ‰å·¥åŽ‚æ¨¡å¼åº”ç”¨çš„å‰æã€‚ è¿™ä¸ªç³»ç»Ÿæœ‰å¤šä¸ªç³»åˆ—äº§å“ï¼Œè€Œç³»ç»Ÿä¸­åªæ¶ˆè´¹å…¶ä¸­æŸä¸€ç³»åˆ—äº§å“ã€‚ ç³»ç»Ÿè¦æ±‚æä¾›ä¸€ä¸ªäº§å“ç±»çš„åº“ï¼Œæ‰€æœ‰äº§å“ä»¥åŒæ ·çš„æŽ¥å£å‡ºçŽ°ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ä¾èµ–å…·ä½“å®žçŽ°ã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾æœ‰ä¸¤é—´å¡‘æ–™åŠ å·¥åŽ‚ï¼ˆAåŽ‚ä»…ç”Ÿäº§å®¹å™¨ç±»äº§å“ï¼›BåŽ‚ä»…ç”Ÿäº§æ¨¡å…·ç±»äº§å“ï¼‰ï¼›éšç€å®¢æˆ·éœ€æ±‚çš„å˜åŒ–ï¼ŒAåŽ‚æ‰€åœ¨åœ°çš„å®¢æˆ·éœ€è¦ä¹Ÿæ¨¡å…·ç±»äº§å“ï¼ŒBåŽ‚æ‰€åœ¨åœ°çš„å®¢æˆ·ä¹Ÿéœ€è¦å®¹å™¨ç±»äº§å“ï¼› å†²çªï¼šæ²¡æœ‰èµ„æºï¼ˆèµ„é‡‘+ç§Ÿä½ï¼‰åœ¨å½“åœ°åˆ†åˆ«å¼€è®¾å¤šä¸€å®¶æ³¨å¡‘åˆ†åŽ‚ è§£å†³æ–¹æ¡ˆï¼šåœ¨åŽŸæœ‰çš„ä¸¤å®¶å¡‘æ–™åŽ‚é‡Œå¢žè®¾ç”Ÿäº§éœ€æ±‚çš„åŠŸèƒ½ï¼Œå³AåŽ‚èƒ½ç”Ÿäº§å®¹å™¨+æ¨¡å…·äº§å“ï¼›BåŽ‚é—´èƒ½ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ã€‚ æŠ½è±¡å·¥åŽ‚ç±» 123456789101112131415161718192021package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡å·¥åŽ‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ */public abstract class Factory &#123; /** * ç”Ÿäº§å®¹å™¨ * * @return */ public abstract AbstractProduct manufactureContainer(); /** * ç”Ÿäº§æ¨¡å…· * * @return */ public abstract AbstractProduct manufactureMould();&#125; æŠ½è±¡äº§å“æ—ç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“æ—ç±» ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ï¼› */public abstract class AbstractProduct &#123; /** * å±•ç¤ºäº§å“ */ public abstract void show();&#125; æŠ½è±¡äº§å“ç±» å®¹å™¨äº§å“æŠ½è±¡ç±» 12345678910package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»--å®¹å™¨ ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ */public abstract class ContainerProduct extends AbstractProduct &#123; @Override public abstract void show();&#125; æ¨¡å…·äº§å“æŠ½è±¡ç±» 12345678910package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»--æ¨¡å…· ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ */public abstract class MouldProduct extends AbstractProduct &#123; @Override public abstract void show();&#125; å…·ä½“äº§å“ç±» å®¹å™¨äº§å“Aç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--å®¹å™¨Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ContainerProductA extends ContainerProduct &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§å‡ºäº†å®¹å™¨äº§å“A..."); &#125;&#125; å®¹å™¨äº§å“Bç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»-å®¹å™¨Bï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ContainerProductB extends ContainerProduct &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§å‡ºäº†å®¹å™¨äº§å“B..."); &#125;&#125; æ¨¡å…·äº§å“Aç±» 12345678910111213package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--æ¨¡å…·Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class MouldProductA extends MouldProduct &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§å‡ºäº†æ¨¡å…·äº§å“A..."); &#125;&#125; æ¨¡å…·äº§å“Bç±» 12345678910111213package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--æ¨¡å…·Bï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class MouldProductB extends MouldProduct &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§å‡ºäº†æ¨¡å…·äº§å“B..."); &#125;&#125; å…·ä½“å·¥åŽ‚ç±» AåŽ‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ 12345678910111213141516171819package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“å·¥åŽ‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥åŽ‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®žä¾‹çš„æ–¹æ³• * AåŽ‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ */public class FactoryA extends Factory &#123; @Override public AbstractProduct manufactureContainer() &#123; return new ContainerProductA(); &#125; @Override public AbstractProduct manufactureMould() &#123; return new MouldProductA(); &#125;&#125; BåŽ‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ 12345678910111213141516171819package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“å·¥åŽ‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥åŽ‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®žä¾‹çš„æ–¹æ³• * BåŽ‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ */public class FactoryB extends Factory &#123; @Override public AbstractProduct manufactureContainer() &#123; return new ContainerProductB(); &#125; @Override public AbstractProduct manufactureMould() &#123; return new MouldProductB(); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; FactoryA mFactoryA = new FactoryA(); FactoryB mFactoryB = new FactoryB(); //AåŽ‚å½“åœ°å®¢æˆ·éœ€è¦å®¹å™¨äº§å“A mFactoryA.manufactureContainer().show(); //AåŽ‚å½“åœ°å®¢æˆ·éœ€è¦æ¨¡å…·äº§å“A mFactoryA.manufactureMould().show(); //BåŽ‚å½“åœ°å®¢æˆ·éœ€è¦å®¹å™¨äº§å“B mFactoryB.manufactureContainer().show(); //BåŽ‚å½“åœ°å®¢æˆ·éœ€è¦æ¨¡å…·äº§å“B mFactoryB.manufactureMould().show(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-ç†è§£Volatile]]></title>
    <url>%2Fposts%2Fe72020d.html</url>
    <content type="text"><![CDATA[volatileç‰¹æ€§ å½“å£°æ˜Žå…±äº«å˜é‡ä¸º volatile åŽï¼Œå¯¹è¿™ä¸ªå˜é‡çš„è¯» / å†™å°†ä¼šå¾ˆç‰¹åˆ«ã€‚ç†è§£ volatile ç‰¹æ€§çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ï¼šæŠŠå¯¹ volatile å˜é‡çš„å•ä¸ªè¯» / å†™ï¼Œçœ‹æˆæ˜¯ä½¿ç”¨åŒä¸€ä¸ªç›‘è§†å™¨é”å¯¹è¿™äº›å•ä¸ªè¯» / å†™æ“ä½œåšäº†åŒæ­¥ã€‚å¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š 12345678910111213141516class VolatileFeaturesExample &#123; volatile long vl = 0L; // ä½¿ç”¨ volatile å£°æ˜Ž 64 ä½çš„ long åž‹å˜é‡ public void set(long l) &#123; vl = l; // å•ä¸ª volatile å˜é‡çš„å†™ &#125; public void getAndIncrement () &#123; vl++; // å¤åˆï¼ˆå¤šä¸ªï¼‰volatile å˜é‡çš„è¯» / å†™ &#125; public long get() &#123; return vl; // å•ä¸ª volatile å˜é‡çš„è¯» &#125;&#125; å‡è®¾æœ‰å¤šä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ä¸Šé¢ç¨‹åºçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªç¨‹åºåœ¨è¯­æ„ä¸Šå’Œä¸‹é¢ç¨‹åºç­‰ä»·ï¼š 1234567891011121314151617class VolatileFeaturesExample &#123; long vl = 0L; // 64 ä½çš„ long åž‹æ™®é€šå˜é‡ public synchronized void set(long l) &#123; // å¯¹å•ä¸ªçš„æ™®é€š å˜é‡çš„å†™ç”¨åŒä¸€ä¸ªç›‘è§†å™¨åŒæ­¥ vl = l; &#125; public void getAndIncrement () &#123; // æ™®é€šæ–¹æ³•è°ƒç”¨ long temp = get(); // è°ƒç”¨å·²åŒæ­¥çš„è¯»æ–¹æ³• temp += 1L; // æ™®é€šå†™æ“ä½œ set(temp); // è°ƒç”¨å·²åŒæ­¥çš„å†™æ–¹æ³• &#125; public synchronized long get() &#123; // å¯¹å•ä¸ªçš„æ™®é€šå˜é‡çš„è¯»ç”¨åŒä¸€ä¸ªç›‘è§†å™¨åŒæ­¥ return vl; &#125;&#125; å¦‚ç¤ºä¾‹ç¨‹åºæ‰€ç¤ºï¼Œå¯¹ä¸€ä¸ª volatile å˜é‡çš„å•ä¸ªè¯» / å†™æ“ä½œï¼Œä¸Žå¯¹ä¸€ä¸ªæ™®é€šå˜é‡çš„è¯» / å†™æ“ä½œä½¿ç”¨åŒä¸€ä¸ªç›‘è§†å™¨é”æ¥åŒæ­¥ï¼Œå®ƒä»¬ä¹‹é—´çš„æ‰§è¡Œæ•ˆæžœç›¸åŒã€‚ ç›‘è§†å™¨é”çš„ happens-before è§„åˆ™ä¿è¯é‡Šæ”¾ç›‘è§†å™¨å’ŒèŽ·å–ç›‘è§†å™¨çš„ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ï¼Œè¿™æ„å‘³ç€å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åŽçš„å†™å…¥ã€‚ ç›‘è§†å™¨é”çš„è¯­ä¹‰å†³å®šäº†ä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŽŸå­æ€§ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯ 64 ä½çš„ long åž‹å’Œ double åž‹å˜é‡ï¼Œåªè¦å®ƒæ˜¯ volatile å˜é‡ï¼Œå¯¹è¯¥å˜é‡çš„è¯»å†™å°±å°†å…·æœ‰åŽŸå­æ€§ã€‚å¦‚æžœæ˜¯å¤šä¸ª volatile æ“ä½œæˆ–ç±»ä¼¼äºŽ volatile++ è¿™ç§å¤åˆæ“ä½œï¼Œè¿™äº›æ“ä½œæ•´ä½“ä¸Šä¸å…·æœ‰åŽŸå­æ€§ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œvolatile å˜é‡è‡ªèº«å…·æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š å¯è§æ€§ã€‚å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åŽçš„å†™å…¥ã€‚ åŽŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ª volatile å˜é‡çš„è¯» / å†™å…·æœ‰åŽŸå­æ€§ï¼Œä½†ç±»ä¼¼äºŽ volatile++ è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŽŸå­æ€§ã€‚ volatileçš„happens-beforeå…³ç³» ä»Žå†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´ï¼Œvolatile ä¸Žç›‘è§†å™¨é”æœ‰ç›¸åŒçš„æ•ˆæžœï¼švolatile å†™å’Œç›‘è§†å™¨çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›volatile è¯»ä¸Žç›‘è§†å™¨çš„èŽ·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ 12345678910111213141516class VolatileExample &#123; int a = 0; volatile boolean flag = false; public void writer() &#123; a = 1; //1 flag = true; //2 &#125; public void reader() &#123; if (flag) &#123; //3 int i = a; //4 â€¦â€¦ &#125; &#125;&#125; å‡è®¾çº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ä¹‹åŽï¼Œçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚æ ¹æ® happens before è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹å»ºç«‹çš„ happens before å…³ç³»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2; 3 happens before 4ã€‚ æ ¹æ® volatile è§„åˆ™ï¼Œ2 happens before 3ã€‚ æ ¹æ® happens before çš„ä¼ é€’æ€§è§„åˆ™ï¼Œ1 happens before 4ã€‚ ä¸Šè¿° happens before å…³ç³»çš„å›¾å½¢åŒ–è¡¨çŽ°å½¢å¼å¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æŽ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ª happens before å…³ç³»ã€‚é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›æ©™è‰²ç®­å¤´è¡¨ç¤º volatile è§„åˆ™ï¼›è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åŽæä¾›çš„ happens before ä¿è¯ã€‚ è¿™é‡Œ A çº¿ç¨‹å†™ä¸€ä¸ª volatile å˜é‡åŽï¼ŒB çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚A çº¿ç¨‹åœ¨å†™ volatile å˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨ B çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡åŽï¼Œå°†ç«‹å³å˜å¾—å¯¹ B çº¿ç¨‹å¯è§ã€‚ volatileçš„å†…å­˜è¯­ä¹‰ volatile å†™çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“å†™ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ ä»¥ä¸Šé¢ç¤ºä¾‹ç¨‹åºä¸ºä¾‹ï¼Œå‡è®¾çº¿ç¨‹ A é¦–å…ˆæ‰§è¡Œ writer() æ–¹æ³•ï¼ŒéšåŽçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ï¼Œåˆå§‹æ—¶ä¸¤ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­çš„ flag å’Œ a éƒ½æ˜¯åˆå§‹çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯çº¿ç¨‹ A æ‰§è¡Œ volatile å†™åŽï¼Œå…±äº«å˜é‡çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A åœ¨å†™ flag å˜é‡åŽï¼Œæœ¬åœ°å†…å­˜ A ä¸­è¢«çº¿ç¨‹ A æ›´æ–°è¿‡çš„ä¸¤ä¸ªå…±äº«å˜é‡çš„å€¼è¢«åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚æ­¤æ—¶ï¼Œæœ¬åœ°å†…å­˜ A å’Œä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚ volatile è¯»çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“è¯»ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æŽ¥ä¸‹æ¥å°†ä»Žä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ ä¸‹é¢æ˜¯çº¿ç¨‹ B è¯»åŒä¸€ä¸ª volatile å˜é‡åŽï¼Œå…±äº«å˜é‡çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è¯» flag å˜é‡åŽï¼Œæœ¬åœ°å†…å­˜ B å·²ç»è¢«ç½®ä¸ºæ— æ•ˆã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ B å¿…é¡»ä»Žä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚çº¿ç¨‹ B çš„è¯»å–æ“ä½œå°†å¯¼è‡´æœ¬åœ°å†…å­˜ B ä¸Žä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼ä¹Ÿå˜æˆä¸€è‡´çš„äº†ã€‚ å¦‚æžœæŠŠ volatile å†™å’Œ volatile è¯»è¿™ä¸¤ä¸ªæ­¥éª¤ç»¼åˆèµ·æ¥çœ‹çš„è¯ï¼Œåœ¨è¯»çº¿ç¨‹ B è¯»ä¸€ä¸ª volatile å˜é‡åŽï¼Œå†™çº¿ç¨‹ A åœ¨å†™è¿™ä¸ª volatile å˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡çš„å€¼éƒ½å°†ç«‹å³å˜å¾—å¯¹è¯»çº¿ç¨‹ B å¯è§ã€‚ volatileå†…å­˜è¯­ä¹‰å®žçŽ° é‡æŽ’åºåˆ†ä¸ºç¼–è¯‘å™¨é‡æŽ’åºå’Œå¤„ç†å™¨é‡æŽ’åºã€‚ä¸ºäº†å®žçŽ° volatile å†…å­˜è¯­ä¹‰ï¼ŒJMM ä¼šåˆ†åˆ«é™åˆ¶è¿™ä¸¤ç§ç±»åž‹çš„é‡æŽ’åºç±»åž‹ã€‚ä¸‹é¢æ˜¯ JMM é’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®šçš„ volatile é‡æŽ’åºè§„åˆ™è¡¨ï¼š èƒ½å¦é‡æŽ’åº ç¬¬äºŒä¸ªæ“ä½œ ç¬¬ä¸€ä¸ªæ“ä½œ æ™®é€šè¯» / å†™ volatile è¯» volatile å†™ æ™®é€šè¯» / å†™ NO volatile è¯» NO NO NO volatile å†™ NO NO ä»Žä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼š å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile å†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æŽ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile å†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æŽ’åºåˆ° volatile å†™ä¹‹åŽã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æŽ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile è¯»ä¹‹åŽçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æŽ’åºåˆ° volatile è¯»ä¹‹å‰ã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile å†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸èƒ½é‡æŽ’åºã€‚ ä¸ºäº†å®žçŽ° volatile çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»åž‹çš„å¤„ç†å™¨é‡æŽ’åºã€‚å¯¹äºŽç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘çŽ°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœçš„æ€»æ•°å‡ ä¹Žä¸å¯èƒ½ï¼Œä¸ºæ­¤ï¼ŒJMM é‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºŽä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åŽé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éžå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ volatile å†…å­˜è¯­ä¹‰ã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile å†™æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ StoreStore å±éšœå¯ä»¥ä¿è¯åœ¨ volatile å†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œå·²ç»å¯¹ä»»æ„å¤„ç†å™¨å¯è§äº†ã€‚è¿™æ˜¯å› ä¸º StoreStore å±éšœå°†ä¿éšœä¸Šé¢æ‰€æœ‰çš„æ™®é€šå†™åœ¨ volatile å†™ä¹‹å‰åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ volatile å†™åŽé¢çš„ StoreLoad å±éšœã€‚è¿™ä¸ªå±éšœçš„ä½œç”¨æ˜¯é¿å… volatile å†™ä¸ŽåŽé¢å¯èƒ½æœ‰çš„ volatile è¯» / å†™æ“ä½œé‡æŽ’åºã€‚å› ä¸ºç¼–è¯‘å™¨å¸¸å¸¸æ— æ³•å‡†ç¡®åˆ¤æ–­åœ¨ä¸€ä¸ª volatile å†™çš„åŽé¢ï¼Œæ˜¯å¦éœ€è¦æ’å…¥ä¸€ä¸ª StoreLoad å±éšœï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ª volatile å†™ä¹‹åŽæ–¹æ³•ç«‹å³ returnï¼‰ã€‚ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®å®žçŽ° volatile çš„å†…å­˜è¯­ä¹‰ï¼ŒJMM åœ¨è¿™é‡Œé‡‡å–äº†ä¿å®ˆç­–ç•¥ï¼šåœ¨æ¯ä¸ª volatile å†™çš„åŽé¢æˆ–åœ¨æ¯ä¸ª volatile è¯»çš„å‰é¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ä»Žæ•´ä½“æ‰§è¡Œæ•ˆçŽ‡çš„è§’åº¦è€ƒè™‘ï¼ŒJMM é€‰æ‹©äº†åœ¨æ¯ä¸ª volatile å†™çš„åŽé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚å› ä¸º volatile å†™ - è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™ volatile å˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨ volatile å†™ä¹‹åŽæ’å…¥ StoreLoad å±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆçŽ‡çš„æå‡ã€‚ä»Žè¿™é‡Œå¯ä»¥çœ‹åˆ° JMM åœ¨å®žçŽ°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åŽå†åŽ»è¿½æ±‚æ‰§è¡Œæ•ˆçŽ‡ã€‚ ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile è¯»æ’å…¥å†…å­˜å±éšœåŽç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ LoadLoad å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸Žä¸‹é¢çš„æ™®é€šè¯»é‡æŽ’åºã€‚LoadStore å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸Žä¸‹é¢çš„æ™®é€šå†™é‡æŽ’åºã€‚ ä¸Šè¿° volatile å†™å’Œ volatile è¯»çš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éžå¸¸ä¿å®ˆã€‚åœ¨å®žé™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜ volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚ä¸‹é¢é€šè¿‡ç¤ºä¾‹ä»£ç æ¥è¯´æ˜Žï¼š 123456789101112131415class VolatileBarrierExample &#123; int a; volatile int v1 = 1; volatile int v2 = 2; void readAndWrite() &#123; int i = v1; // ç¬¬ä¸€ä¸ª volatile è¯» int j = v2; // ç¬¬äºŒä¸ª volatile è¯» a = i + j; // æ™®é€šå†™ v1 = i + 1; // ç¬¬ä¸€ä¸ª volatile å†™ v2 = j * 2; // ç¬¬äºŒä¸ª volatile å†™ &#125; â€¦ // å…¶ä»–æ–¹æ³• &#125; é’ˆå¯¹ readAndWrite() æ–¹æ³•ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶å¯ä»¥åšå¦‚ä¸‹çš„ä¼˜åŒ–ï¼š æ³¨æ„ï¼Œæœ€åŽçš„ StoreLoad å±éšœä¸èƒ½çœç•¥ã€‚å› ä¸ºç¬¬äºŒä¸ª volatile å†™ä¹‹åŽï¼Œæ–¹æ³•ç«‹å³ returnã€‚æ­¤æ—¶ç¼–è¯‘å™¨å¯èƒ½æ— æ³•å‡†ç¡®æ–­å®šåŽé¢æ˜¯å¦ä¼šæœ‰ volatile è¯»æˆ–å†™ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œç¼–è¯‘å™¨å¸¸å¸¸ä¼šåœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ ä¸Šé¢çš„ä¼˜åŒ–æ˜¯é’ˆå¯¹ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œç”±äºŽä¸åŒçš„å¤„ç†å™¨æœ‰ä¸åŒâ€œæ¾ç´§åº¦â€çš„å¤„ç†å™¨å†…å­˜æ¨¡åž‹ï¼Œå†…å­˜å±éšœçš„æ’å…¥è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„å¤„ç†å™¨å†…å­˜æ¨¡åž‹ç»§ç»­ä¼˜åŒ–ã€‚ä»¥ x86 å¤„ç†å™¨ä¸ºä¾‹ï¼Œä¸Šå›¾ä¸­é™¤æœ€åŽçš„ StoreLoad å±éšœå¤–ï¼Œå…¶å®ƒçš„å±éšœéƒ½ä¼šè¢«çœç•¥ã€‚ å‰é¢ä¿å®ˆç­–ç•¥ä¸‹çš„ volatile è¯»å’Œå†™ï¼Œåœ¨ x86 å¤„ç†å™¨å¹³å°å¯ä»¥ä¼˜åŒ–æˆï¼š å‰é¢æåˆ°è¿‡ï¼Œx86 å¤„ç†å™¨ä»…ä¼šå¯¹å†™ - è¯»æ“ä½œåšé‡æŽ’åºã€‚X86 ä¸ä¼šå¯¹è¯» - è¯»ï¼Œè¯» - å†™å’Œå†™ - å†™æ“ä½œåšé‡æŽ’åºï¼Œå› æ­¤åœ¨ x86 å¤„ç†å™¨ä¸­ä¼šçœç•¥æŽ‰è¿™ä¸‰ç§æ“ä½œç±»åž‹å¯¹åº”çš„å†…å­˜å±éšœã€‚åœ¨ x86 ä¸­ï¼ŒJMM ä»…éœ€åœ¨ volatile å†™åŽé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœå³å¯æ­£ç¡®å®žçŽ° volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ã€‚è¿™æ„å‘³ç€åœ¨ x86 å¤„ç†å™¨ä¸­ï¼Œvolatile å†™çš„å¼€é”€æ¯” volatile è¯»çš„å¼€é”€ä¼šå¤§å¾ˆå¤šï¼ˆå› ä¸ºæ‰§è¡Œ StoreLoad å±éšœå¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼‰ã€‚ JSR-133 ä¸ºä»€ä¹ˆè¦å¢žå¼º volatile çš„å†…å­˜è¯­ä¹‰ åœ¨ JSR-133 ä¹‹å‰çš„æ—§ Java å†…å­˜æ¨¡åž‹ä¸­ï¼Œè™½ç„¶ä¸å…è®¸ volatile å˜é‡ä¹‹é—´é‡æŽ’åºï¼Œä½†æ—§çš„ Java å†…å­˜æ¨¡åž‹å…è®¸ volatile å˜é‡ä¸Žæ™®é€šå˜é‡ä¹‹é—´é‡æŽ’åºã€‚ å› æ­¤åœ¨æ—§çš„å†…å­˜æ¨¡åž‹ä¸­ ï¼Œvolatile çš„å†™ - è¯»æ²¡æœ‰ç›‘è§†å™¨çš„é‡Šæ”¾ - èŽ·æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ã€‚ä¸ºäº†æä¾›ä¸€ç§æ¯”ç›‘è§†å™¨é”æ›´è½»é‡çº§çš„çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ï¼ŒJSR-133 ä¸“å®¶ç»„å†³å®šå¢žå¼º volatile çš„å†…å­˜è¯­ä¹‰ï¼šä¸¥æ ¼é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹ volatile å˜é‡ä¸Žæ™®é€šå˜é‡çš„é‡æŽ’åºï¼Œç¡®ä¿ volatile çš„å†™ - è¯»å’Œç›‘è§†å™¨çš„é‡Šæ”¾ - èŽ·å–ä¸€æ ·ï¼Œå…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ä»Žç¼–è¯‘å™¨é‡æŽ’åºè§„åˆ™å’Œå¤„ç†å™¨å†…å­˜å±éšœæ’å…¥ç­–ç•¥æ¥çœ‹ï¼Œåªè¦ volatile å˜é‡ä¸Žæ™®é€šå˜é‡ä¹‹é—´çš„é‡æŽ’åºå¯èƒ½ä¼šç ´å volatile çš„å†…å­˜è¯­æ„ï¼Œè¿™ç§é‡æŽ’åºå°±ä¼šè¢«ç¼–è¯‘å™¨é‡æŽ’åºè§„åˆ™å’Œå¤„ç†å™¨å†…å­˜å±éšœæ’å…¥ç­–ç•¥ç¦æ­¢ã€‚ ç”±äºŽ volatile ä»…ä»…ä¿è¯å¯¹å•ä¸ª volatile å˜é‡çš„è¯» / å†™å…·æœ‰åŽŸå­æ€§ï¼Œè€Œç›‘è§†å™¨é”çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§å¯ä»¥ç¡®ä¿å¯¹æ•´ä¸ªä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŽŸå­æ€§ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œç›‘è§†å™¨é”æ¯” volatile æ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatile æ›´æœ‰ä¼˜åŠ¿ã€‚å¦‚æžœæƒ³åœ¨ç¨‹åºä¸­ç”¨ volatile ä»£æ›¿ç›‘è§†å™¨é”ï¼Œè¯·ä¸€å®šè°¨æ…Žã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡åž‹-åŸºç¡€å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fd4946f29.html</url>
    <content type="text"><![CDATA[å¹¶å‘ç¼–ç¨‹æ¨¡åž‹åˆ†ç±» åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œéœ€è¦å¤„ç†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼šçº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡åŠçº¿ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ï¼ˆè¿™é‡Œçš„çº¿ç¨‹æ˜¯æŒ‡å¹¶å‘æ‰§è¡Œçš„æ´»åŠ¨å®žä½“ï¼‰ã€‚é€šä¿¡æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ã€‚åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚ åœ¨å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡åž‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´é€šè¿‡å†™ - è¯»å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€æ¥éšå¼è¿›è¡Œé€šä¿¡ã€‚åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡åž‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡æ˜Žç¡®çš„å‘é€æ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€šä¿¡ã€‚ åŒæ­¥æ˜¯æŒ‡ç¨‹åºç”¨äºŽæŽ§åˆ¶ä¸åŒçº¿ç¨‹ä¹‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ã€‚åœ¨å…±äº«å†…å­˜å¹¶å‘æ¨¡åž‹é‡Œï¼ŒåŒæ­¥æ˜¯æ˜¾å¼è¿›è¡Œçš„ã€‚ç¨‹åºå‘˜å¿…é¡»æ˜¾å¼æŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´äº’æ–¥æ‰§è¡Œã€‚åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡åž‹é‡Œï¼Œç”±äºŽæ¶ˆæ¯çš„å‘é€å¿…é¡»åœ¨æ¶ˆæ¯çš„æŽ¥æ”¶ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼è¿›è¡Œçš„ã€‚ Java çš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡åž‹ï¼ŒJava çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜Žã€‚ Javaå†…å­˜æ¨¡åž‹çš„æŠ½è±¡ Java çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”± Java å†…å­˜æ¨¡åž‹ï¼ˆç®€ç§°ä¸º JMMï¼‰æŽ§åˆ¶ï¼ŒJMM å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ä»ŽæŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼ŒJMM å®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯» / å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®žå­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚Java å†…å­˜æ¨¡åž‹çš„æŠ½è±¡ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ä»Žä¸Šå›¾æ¥çœ‹ï¼Œçº¿ç¨‹ A ä¸Žçº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»åŽ†2ä¸ªæ­¥éª¤ï¼š é¦–å…ˆï¼Œçº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­åŽ»ã€‚ ç„¶åŽï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­åŽ»è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚ ä¸‹é¢é€šè¿‡ç¤ºæ„å›¾æ¥è¯´æ˜Žè¿™ä¸¤ä¸ªæ­¥éª¤ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ¬åœ°å†…å­˜ A å’Œ B æœ‰ä¸»å†…å­˜ä¸­å…±äº«å˜é‡ x çš„å‰¯æœ¬ã€‚å‡è®¾åˆå§‹æ—¶ï¼Œè¿™ä¸‰ä¸ªå†…å­˜ä¸­çš„ x å€¼éƒ½ä¸º 0ã€‚çº¿ç¨‹ A åœ¨æ‰§è¡Œæ—¶ï¼ŒæŠŠæ›´æ–°åŽçš„ x å€¼ï¼ˆå‡è®¾å€¼ä¸º 1ï¼‰ä¸´æ—¶å­˜æ”¾åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ A ä¸­ã€‚å½“çº¿ç¨‹ A å’Œçº¿ç¨‹ B éœ€è¦é€šä¿¡æ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆä¼šæŠŠè‡ªå·±æœ¬åœ°å†…å­˜ä¸­ä¿®æ”¹åŽçš„ x å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œæ­¤æ—¶ä¸»å†…å­˜ä¸­çš„ x å€¼å˜ä¸ºäº† 1ã€‚éšåŽï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­åŽ»è¯»å–çº¿ç¨‹ A æ›´æ–°åŽçš„ x å€¼ï¼Œæ­¤æ—¶çº¿ç¨‹ B çš„æœ¬åœ°å†…å­˜çš„ x å€¼ä¹Ÿå˜ä¸ºäº† 1ã€‚ ä»Žæ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤å®žè´¨ä¸Šæ˜¯çº¿ç¨‹ A åœ¨å‘çº¿ç¨‹ B å‘é€æ¶ˆæ¯ï¼Œè€Œä¸”è¿™ä¸ªé€šä¿¡è¿‡ç¨‹å¿…é¡»è¦ç»è¿‡ä¸»å†…å­˜ã€‚JMM é€šè¿‡æŽ§åˆ¶ä¸»å†…å­˜ä¸Žæ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸º java ç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ æŒ‡ä»¤é‡æŽ’åº åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æŽ’åºã€‚é‡æŽ’åºåˆ†ä¸‰ç§ç±»åž‹ï¼š ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æŽ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æŽ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æŽ’åºã€‚çŽ°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼Œ ILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æžœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ å†…å­˜ç³»ç»Ÿçš„é‡æŽ’åºã€‚ç”±äºŽå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯» / å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸ŠåŽ»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚ ä¸Šè¿°çš„1å±žäºŽç¼–è¯‘å™¨é‡æŽ’åºï¼Œ2 å’Œ 3å±žäºŽå¤„ç†å™¨é‡æŽ’åºã€‚è¿™äº›é‡æŽ’åºéƒ½å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºçŽ°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚å¯¹äºŽç¼–è¯‘å™¨ï¼ŒJMM çš„ç¼–è¯‘å™¨é‡æŽ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»åž‹çš„ç¼–è¯‘å™¨é‡æŽ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æŽ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºŽå¤„ç†å™¨é‡æŽ’åºï¼ŒJMM çš„å¤„ç†å™¨é‡æŽ’åºè§„åˆ™ä¼šè¦æ±‚ java ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»åž‹çš„å†…å­˜å±éšœï¼ˆmemory barriersï¼Œintel ç§°ä¹‹ä¸º memory fenceï¼‰æŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»åž‹çš„å¤„ç†å™¨é‡æŽ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„å¤„ç†å™¨é‡æŽ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚ JMM å±žäºŽè¯­è¨€çº§çš„å†…å­˜æ¨¡åž‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»åž‹çš„ç¼–è¯‘å™¨é‡æŽ’åºå’Œå¤„ç†å™¨é‡æŽ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ å†…å­˜å±éšœæŒ‡ä»¤ çŽ°ä»£çš„å¤„ç†å™¨ä½¿ç”¨å†™ç¼“å†²åŒºæ¥ä¸´æ—¶ä¿å­˜å‘å†…å­˜å†™å…¥çš„æ•°æ®ã€‚å†™ç¼“å†²åŒºå¯ä»¥ä¿è¯æŒ‡ä»¤æµæ°´çº¿æŒç»­è¿è¡Œï¼Œå®ƒå¯ä»¥é¿å…ç”±äºŽå¤„ç†å™¨åœé¡¿ä¸‹æ¥ç­‰å¾…å‘å†…å­˜å†™å…¥æ•°æ®è€Œäº§ç”Ÿçš„å»¶è¿Ÿã€‚åŒæ—¶ï¼Œé€šè¿‡ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åˆ·æ–°å†™ç¼“å†²åŒºï¼Œä»¥åŠåˆå¹¶å†™ç¼“å†²åŒºä¸­å¯¹åŒä¸€å†…å­˜åœ°å€çš„å¤šæ¬¡å†™ï¼Œå¯ä»¥å‡å°‘å¯¹å†…å­˜æ€»çº¿çš„å ç”¨ã€‚è™½ç„¶å†™ç¼“å†²åŒºæœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œä½†æ¯ä¸ªå¤„ç†å™¨ä¸Šçš„å†™ç¼“å†²åŒºï¼Œä»…ä»…å¯¹å®ƒæ‰€åœ¨çš„å¤„ç†å™¨å¯è§ã€‚è¿™ä¸ªç‰¹æ€§ä¼šå¯¹å†…å­˜æ“ä½œçš„æ‰§è¡Œé¡ºåºäº§ç”Ÿé‡è¦çš„å½±å“ï¼šå¤„ç†å™¨å¯¹å†…å­˜çš„è¯» / å†™æ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œä¸ä¸€å®šä¸Žå†…å­˜å®žé™…å‘ç”Ÿçš„è¯» / å†™æ“ä½œé¡ºåºä¸€è‡´ï¼å¦‚ä¸‹ç¤ºä¾‹ï¼š ProcessorA ProcessorB a = 1; //A1x = b; //A2 b = 2; //B1y = a; //B2 åˆå§‹çŠ¶æ€ï¼ša = b = 0å¤„ç†å™¨å…è®¸å¾—åˆ°ç»“æžœï¼šx = y = 0 å‡è®¾å¤„ç†å™¨ A å’Œå¤„ç†å™¨ B æŒ‰ç¨‹åºçš„é¡ºåºå¹¶è¡Œæ‰§è¡Œå†…å­˜è®¿é—®ï¼Œæœ€ç»ˆå´å¯èƒ½å¾—åˆ° x = y = 0 çš„ç»“æžœã€‚å…·ä½“çš„åŽŸå› å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™é‡Œå¤„ç†å™¨ A å’Œå¤„ç†å™¨ B å¯ä»¥åŒæ—¶æŠŠå…±äº«å˜é‡å†™å…¥è‡ªå·±çš„å†™ç¼“å†²åŒºï¼ˆA1ï¼ŒB1ï¼‰ï¼Œç„¶åŽä»Žå†…å­˜ä¸­è¯»å–å¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆA2ï¼ŒB2ï¼‰ï¼Œæœ€åŽæ‰æŠŠè‡ªå·±å†™ç¼“å­˜åŒºä¸­ä¿å­˜çš„è„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆA3ï¼ŒB3ï¼‰ã€‚å½“ä»¥è¿™ç§æ—¶åºæ‰§è¡Œæ—¶ï¼Œç¨‹åºå°±å¯ä»¥å¾—åˆ° x = y = 0 çš„ç»“æžœã€‚ ä»Žå†…å­˜æ“ä½œå®žé™…å‘ç”Ÿçš„é¡ºåºæ¥çœ‹ï¼Œç›´åˆ°å¤„ç†å™¨ A æ‰§è¡Œ A3 æ¥åˆ·æ–°è‡ªå·±çš„å†™ç¼“å­˜åŒºï¼Œå†™æ“ä½œ A1 æ‰ç®—çœŸæ­£æ‰§è¡Œäº†ã€‚è™½ç„¶å¤„ç†å™¨ A æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºä¸ºï¼šA1-&gt;A2ï¼Œä½†å†…å­˜æ“ä½œå®žé™…å‘ç”Ÿçš„é¡ºåºå´æ˜¯ï¼šA2-&gt;A1ã€‚æ­¤æ—¶ï¼Œå¤„ç†å™¨ A çš„å†…å­˜æ“ä½œé¡ºåºè¢«é‡æŽ’åºäº†ï¼ˆå¤„ç†å™¨ B çš„æƒ…å†µå’Œå¤„ç†å™¨ A ä¸€æ ·ï¼‰ã€‚ è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œç”±äºŽå†™ç¼“å†²åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸Žå†…å­˜å®žé™…çš„æ“ä½œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´ã€‚ç”±äºŽçŽ°ä»£çš„å¤„ç†å™¨éƒ½ä¼šä½¿ç”¨å†™ç¼“å†²åŒºï¼Œå› æ­¤çŽ°ä»£çš„å¤„ç†å™¨éƒ½ä¼šå…è®¸å¯¹å†™ - è¯»æ“åšé‡æŽ’åºã€‚ ä¸‹é¢æ˜¯å¸¸è§å¤„ç†å™¨å…è®¸çš„é‡æŽ’åºç±»åž‹çš„åˆ—è¡¨ï¼š Load-Load Load-Store Store-Store Store-Load æ•°æ®ä¾èµ– sparc-TSO N N N Y N x86 N N N Y N ia64 N N N Y N PowerPC N N N Y N ä¸Šè¡¨å•å…ƒæ ¼ä¸­çš„â€œNâ€è¡¨ç¤ºå¤„ç†å™¨ä¸å…è®¸ä¸¤ä¸ªæ“ä½œé‡æŽ’åºï¼Œâ€œYâ€è¡¨ç¤ºå…è®¸é‡æŽ’åºã€‚å¸¸è§çš„å¤„ç†å™¨éƒ½å…è®¸ Store-Load é‡æŽ’åºï¼›å¸¸è§çš„å¤„ç†å™¨éƒ½ä¸å…è®¸å¯¹å­˜åœ¨æ•°æ®ä¾èµ–çš„æ“ä½œåšé‡æŽ’åºã€‚sparc-TSO å’Œ x86 æ‹¥æœ‰ç›¸å¯¹è¾ƒå¼ºçš„å¤„ç†å™¨å†…å­˜æ¨¡åž‹ï¼Œå®ƒä»¬ä»…å…è®¸å¯¹å†™ - è¯»æ“ä½œåšé‡æŽ’åºï¼ˆå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨äº†å†™ç¼“å†²åŒºï¼‰ã€‚ ä¸ºäº†ä¿è¯å†…å­˜å¯è§æ€§ï¼Œjava ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®ä¼šæ’å…¥å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»åž‹çš„å¤„ç†å™¨é‡æŽ’åºã€‚JMM æŠŠå†…å­˜å±éšœæŒ‡ä»¤åˆ†ä¸ºä¸‹åˆ—å››ç±»ï¼š å±éšœç±»åž‹ æŒ‡ä»¤ç¤ºä¾‹ è¯´æ˜Ž LoadLoad Barriers Load1; LoadLoad; Load2 ç¡®ä¿ Load1 æ•°æ®çš„è£…è½½ï¼Œä¹‹å‰äºŽ Load2 åŠæ‰€æœ‰åŽç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚ StoreStore Barriers Store1; StoreStore; Store2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å¯è§ï¼ˆåˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äºŽ Store2 åŠæ‰€æœ‰åŽç»­å­˜å‚¨æŒ‡ä»¤çš„å­˜å‚¨ã€‚ LoadStore Barriers Load1; LoadStore; Store2 ç¡®ä¿ Load1 æ•°æ®è£…è½½ï¼Œä¹‹å‰äºŽ Store2 åŠæ‰€æœ‰åŽç»­çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°åˆ°å†…å­˜ã€‚ StoreLoad Barriers Store1; StoreLoad; Load2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å˜å¾—å¯è§ï¼ˆæŒ‡åˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äºŽ Load2 åŠæ‰€æœ‰åŽç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚StoreLoad Barriers ä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ˆå­˜å‚¨å’Œè£…è½½æŒ‡ä»¤ï¼‰å®Œæˆä¹‹åŽï¼Œæ‰æ‰§è¡Œè¯¥å±éšœä¹‹åŽçš„å†…å­˜è®¿é—®æŒ‡ä»¤ã€‚ StoreLoad Barriers æ˜¯ä¸€ä¸ªâ€œå…¨èƒ½åž‹â€çš„å±éšœï¼Œå®ƒåŒæ—¶å…·æœ‰å…¶ä»–ä¸‰ä¸ªå±éšœçš„æ•ˆæžœã€‚çŽ°ä»£çš„å¤šå¤„ç†å™¨å¤§éƒ½æ”¯æŒè¯¥å±éšœï¼ˆå…¶ä»–ç±»åž‹çš„å±éšœä¸ä¸€å®šè¢«æ‰€æœ‰å¤„ç†å™¨æ”¯æŒï¼‰ã€‚æ‰§è¡Œè¯¥å±éšœå¼€é”€ä¼šå¾ˆæ˜‚è´µï¼Œå› ä¸ºå½“å‰å¤„ç†å™¨é€šå¸¸è¦æŠŠå†™ç¼“å†²åŒºä¸­çš„æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆbuffer fully flushï¼‰ã€‚ happens-before ä»Ž JDK5 å¼€å§‹ï¼Œjava ä½¿ç”¨æ–°çš„ JSR -133 å†…å­˜æ¨¡åž‹ï¼ŒJSR-133 æå‡ºäº† happens-before çš„æ¦‚å¿µï¼Œé€šè¿‡è¿™ä¸ªæ¦‚å¿µæ¥é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚å¦‚æžœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æžœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨ happens-before å…³ç³»ã€‚è¿™é‡Œæåˆ°çš„ä¸¤ä¸ªæ“ä½œæ—¢å¯ä»¥æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ã€‚ ä¸Žç¨‹åºå‘˜å¯†åˆ‡ç›¸å…³çš„ happens-before è§„åˆ™å¦‚ä¸‹ï¼š ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens- before äºŽè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åŽç»­æ“ä½œã€‚ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨é”çš„è§£é”ï¼Œhappens- before äºŽéšåŽå¯¹è¿™ä¸ªç›‘è§†å™¨é”çš„åŠ é”ã€‚ volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™ï¼Œhappens- before äºŽä»»æ„åŽç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ã€‚ ä¼ é€’æ€§ï¼šå¦‚æžœ A happens- before Bï¼Œä¸” B happens- before Cï¼Œé‚£ä¹ˆ A happens- before Cã€‚ æ³¨æ„ï¼šä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰ happens-before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åŽä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æžœï¼‰å¯¹åŽä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæŽ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ª happens-before è§„åˆ™é€šå¸¸å¯¹åº”äºŽå¤šä¸ªç¼–è¯‘å™¨é‡æŽ’åºè§„åˆ™å’Œå¤„ç†å™¨é‡æŽ’åºè§„åˆ™ã€‚å¯¹äºŽ java ç¨‹åºå‘˜æ¥è¯´ï¼Œhappens-before è§„åˆ™ç®€å•æ˜“æ‡‚ï¼Œå®ƒé¿å…ç¨‹åºå‘˜ä¸ºäº†ç†è§£ JMM æä¾›çš„å†…å­˜å¯è§æ€§ä¿è¯è€ŒåŽ»å­¦ä¹ å¤æ‚çš„é‡æŽ’åºè§„åˆ™ä»¥åŠè¿™äº›è§„åˆ™çš„å…·ä½“å®žçŽ°ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-07ä¹‹-çº¿ç¨‹ä¼‘çœ ]]></title>
    <url>%2Fposts%2Fc0fad076.html</url>
    <content type="text"><![CDATA[sleep()ä»‹ç» sleep() çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œå³å½“å‰çº¿ç¨‹ä¼šä»Žâ€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡ž)çŠ¶æ€â€ã€‚sleep()ä¼šæŒ‡å®šä¼‘çœ æ—¶é—´ï¼Œçº¿ç¨‹ä¼‘çœ çš„æ—¶é—´ä¼šå¤§äºŽ/ç­‰äºŽè¯¥ä¼‘çœ æ—¶é—´ï¼›åœ¨çº¿ç¨‹é‡æ–°è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šç”±â€œé˜»å¡žçŠ¶æ€â€å˜æˆâ€œå°±ç»ªçŠ¶æ€â€ï¼Œä»Žè€Œç­‰å¾…cpuçš„è°ƒåº¦æ‰§è¡Œã€‚ sleep()ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233package main.java.com.study.thread.sleep;/** * @author: whb * @description: çº¿ç¨‹ä¼‘çœ æµ‹è¯• */public class SleepTest &#123; public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); t1.start(); &#125;&#125;class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public synchronized void run() &#123; try &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.printf("%s: %d\n", this.getName(), i); // ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œä¼‘çœ 100æ¯«ç§’ if (i % 4 == 0) &#123; Thread.sleep(100); &#125; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t1: 0t1: 1t1: 2t1: 3t1: 4t1: 5t1: 6t1: 7t1: 8t1: 9 &lt;span id=&quot;inline-purple&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ç¨‹åºæ¯”è¾ƒç®€å•ï¼Œåœ¨ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨çº¿ç¨‹t1ã€‚t1å¯åŠ¨ä¹‹åŽï¼Œå½“t1ä¸­çš„è®¡ç®—ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œt1ä¼šé€šè¿‡Thread.sleep(100)ä¼‘çœ 100æ¯«ç§’ã€‚ sleep() ä¸Ž wait()çš„æ¯”è¾ƒ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œsleep()çš„ä½œç”¨æ˜¯ä¹Ÿæ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡ž)çŠ¶æ€â€ã€‚ä½†æ˜¯ï¼Œwait()ä¼šé‡Šæ”¾å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œsleep()åˆ™ä¸ä¼šé‡Šæ”¾é”ã€‚ ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºsleep()æ˜¯ä¸ä¼šé‡Šæ”¾é”çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.thread.sleep;/** * @author: whb * @description: wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œsleep()çš„ä½œç”¨æ˜¯ä¹Ÿæ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡ž)çŠ¶æ€â€ã€‚ * ä½†æ˜¯ï¼Œwait()ä¼šé‡Šæ”¾å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œsleep()åˆ™ä¸ä¼šé‡Šæ”¾é”ã€‚ */public class SleepLockTest &#123; private static Object obj = new Object(); public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); &#125; static class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; // èŽ·å–objå¯¹è±¡çš„åŒæ­¥é” synchronized (obj) &#123; try &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.printf("%s: %d\n", this.getName(), i); // ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œä¼‘çœ 100æ¯«ç§’ if (i % 4 == 0) &#123; Thread.sleep(100); &#125; &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234567891011121314151617181920t1: 0t1: 1t1: 2t1: 3t1: 4t1: 5t1: 6t1: 7t1: 8t1: 9t2: 0t2: 1t2: 2t2: 3t2: 4t2: 5t2: 6t2: 7t2: 8t2: 9 &lt;span id=&quot;inline-purple&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2åœ¨run()ä¼šå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œå³synchronized(obj)ã€‚åœ¨t1è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å®ƒä¼šè°ƒç”¨Thread.sleep(100)ï¼›ä½†æ˜¯ï¼Œt2æ˜¯ä¸ä¼šèŽ·å–cpuæ‰§è¡Œæƒçš„ã€‚å› ä¸ºï¼Œt1å¹¶æ²¡æœ‰é‡Šæ”¾â€œobjæ‰€æŒæœ‰çš„åŒæ­¥é”â€ï¼]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å·¥åŽ‚æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2Fposts%2F89a20157.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å·¥åŽ‚æ–¹æ³•æ¨¡å¼ï¼Œåˆç§°å·¥åŽ‚æ¨¡å¼ã€å¤šæ€å·¥åŽ‚æ¨¡å¼å’Œè™šæ‹Ÿæž„é€ å™¨æ¨¡å¼ï¼Œé€šè¿‡å®šä¹‰å·¥åŽ‚çˆ¶ç±»è´Ÿè´£å®šä¹‰åˆ›å»ºå¯¹è±¡çš„å…¬å…±æŽ¥å£ï¼Œè€Œå­ç±»åˆ™è´Ÿè´£ç”Ÿæˆå…·ä½“çš„å¯¹è±¡ã€‚ ä¸»è¦ä½œç”¨ å°†ç±»çš„å®žä¾‹åŒ–ï¼ˆå…·ä½“äº§å“çš„åˆ›å»ºï¼‰å»¶è¿Ÿåˆ°å·¥åŽ‚ç±»çš„å­ç±»ï¼ˆå…·ä½“å·¥åŽ‚ï¼‰ä¸­å®Œæˆï¼Œå³ç”±å­ç±»æ¥å†³å®šåº”è¯¥å®žä¾‹åŒ–ï¼ˆåˆ›å»ºï¼‰å“ªä¸€ä¸ªç±»ã€‚ è§£å†³çš„é—®é¢˜ è§£å†³ç®€å•å·¥åŽ‚æ¨¡å¼ä¸€æ—¦éœ€è¦ç”Ÿäº§æ–°äº§å“å°±éœ€è¦ä¿®æ”¹å·¥åŽ‚ç±»çš„æ–¹æ³•é€»è¾‘ï¼Œè¿èƒŒäº†â€œå¼€æ”¾ - å…³é—­åŽŸåˆ™çš„ç¼ºç‚¹ã€‚ ä¹‹æ‰€ä»¥å¯ä»¥è§£å†³ç®€å•å·¥åŽ‚çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºå·¥åŽ‚æ–¹æ³•æ¨¡å¼æŠŠå…·ä½“äº§å“çš„åˆ›å»ºæŽ¨è¿Ÿåˆ°å·¥åŽ‚ç±»çš„å­ç±»ï¼ˆå…·ä½“å·¥åŽ‚ï¼‰ä¸­ï¼Œæ­¤æ—¶å·¥åŽ‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼Œè€Œåªæ˜¯ç»™å‡ºå…·ä½“å·¥åŽ‚å¿…é¡»å®žçŽ°çš„æŽ¥å£ï¼Œè¿™æ ·å·¥åŽ‚æ–¹æ³•æ¨¡å¼åœ¨æ·»åŠ æ–°äº§å“çš„æ—¶å€™å°±ä¸ä¿®æ”¹å·¥åŽ‚ç±»é€»è¾‘è€Œæ˜¯æ·»åŠ æ–°çš„å·¥åŽ‚å­ç±»ï¼Œç¬¦åˆå¼€æ”¾å°é—­åŽŸåˆ™ï¼Œå…‹æœäº†ç®€å•å·¥åŽ‚æ¨¡å¼ä¸­ç¼ºç‚¹ æ¨¡å¼åŽŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥åŽ‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ æŠ½è±¡å·¥åŽ‚ï¼ˆCreatorï¼‰ å…·ä½“å·¥åŽ‚çš„çˆ¶ç±» æè¿°å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ å…·ä½“å·¥åŽ‚ï¼ˆConcrete Creatorï¼‰ æŠ½è±¡å·¥åŽ‚çš„å­ç±»ï¼› è¢«å¤–ç•Œè°ƒç”¨ æè¿°å…·ä½“å·¥åŽ‚ï¼› å®žçŽ°FactoryMethodå·¥åŽ‚æ–¹æ³•åˆ›å»ºäº§å“çš„å®žä¾‹ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡å·¥åŽ‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“ç±» ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå…·ä½“å·¥åŽ‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥åŽ‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®žä¾‹çš„æ–¹æ³•ï¼› å¤–ç•Œé€šè¿‡è°ƒç”¨å…·ä½“å·¥åŽ‚ç±»çš„æ–¹æ³•ï¼Œä»Žè€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®žä¾‹ã€‚ æ¨¡å¼ä¼˜ç‚¹ æ›´ç¬¦åˆå¼€-é—­åŽŸåˆ™ï¼Œæ–°å¢žä¸€ç§äº§å“æ—¶ï¼Œåªéœ€è¦å¢žåŠ ç›¸åº”çš„å…·ä½“äº§å“ç±»å’Œç›¸åº”çš„å·¥åŽ‚å­ç±»å³å¯ã€‚ ç¬¦åˆå•ä¸€èŒè´£åŽŸåˆ™ï¼Œæ¯ä¸ªå…·ä½“å·¥åŽ‚ç±»åªè´Ÿè´£åˆ›å»ºå¯¹åº”çš„äº§å“ã€‚ ä¸ä½¿ç”¨é™æ€å·¥åŽ‚æ–¹æ³•ï¼Œå¯ä»¥å½¢æˆåŸºäºŽç»§æ‰¿çš„ç­‰çº§ç»“æž„ã€‚ æ¨¡å¼ç¼ºç‚¹ æ·»åŠ æ–°äº§å“æ—¶ï¼Œé™¤äº†å¢žåŠ æ–°äº§å“ç±»å¤–ï¼Œè¿˜è¦æä¾›ä¸Žä¹‹å¯¹åº”çš„å…·ä½“å·¥åŽ‚ç±»ï¼Œç³»ç»Ÿç±»çš„ä¸ªæ•°å°†æˆå¯¹å¢žåŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢žåŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›åŒæ—¶ï¼Œæœ‰æ›´å¤šçš„ç±»éœ€è¦ç¼–è¯‘å’Œè¿è¡Œï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ï¼› ç”±äºŽè€ƒè™‘åˆ°ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œéœ€è¦å¼•å…¥æŠ½è±¡å±‚ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å‡ä½¿ç”¨æŠ½è±¡å±‚è¿›è¡Œå®šä¹‰ï¼Œå¢žåŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ï¼Œä¸”åœ¨å®žçŽ°æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°DOMã€åå°„ç­‰æŠ€æœ¯ï¼Œå¢žåŠ äº†ç³»ç»Ÿçš„å®žçŽ°éš¾åº¦ã€‚ è™½ç„¶ä¿è¯äº†å·¥åŽ‚æ–¹æ³•å†…çš„å¯¹ä¿®æ”¹å…³é—­ï¼Œä½†å¯¹äºŽä½¿ç”¨å·¥åŽ‚æ–¹æ³•çš„ç±»ï¼Œå¦‚æžœè¦æ›´æ¢å¦å¤–ä¸€ç§äº§å“ï¼Œä»ç„¶éœ€è¦ä¿®æ”¹å®žä¾‹åŒ–çš„å…·ä½“å·¥åŽ‚ç±»ï¼› ä¸€ä¸ªå…·ä½“å·¥åŽ‚åªèƒ½åˆ›å»ºä¸€ç§å…·ä½“äº§å“ã€‚ åº”ç”¨åœºæ™¯ å½“ä¸€ä¸ªç±»ä¸çŸ¥é“å®ƒæ‰€éœ€è¦çš„å¯¹è±¡çš„ç±»æ—¶ åœ¨å·¥åŽ‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“æ‰€å¯¹åº”çš„å·¥åŽ‚å³å¯ï¼› å½“ä¸€ä¸ªç±»å¸Œæœ›é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå¯¹è±¡æ—¶ åœ¨å·¥åŽ‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå¯¹äºŽæŠ½è±¡å·¥åŽ‚ç±»åªéœ€è¦æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„æŽ¥å£ï¼Œè€Œç”±å…¶å­ç±»æ¥ç¡®å®šå…·ä½“è¦åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ©ç”¨é¢å‘å¯¹è±¡çš„å¤šæ€æ€§å’Œé‡Œæ°ä»£æ¢åŽŸåˆ™ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå­ç±»å¯¹è±¡å°†è¦†ç›–çˆ¶ç±»å¯¹è±¡ï¼Œä»Žè€Œä½¿å¾—ç³»ç»Ÿæ›´å®¹æ˜“æ‰©å±•ã€‚ å°†åˆ›å»ºå¯¹è±¡çš„ä»»åŠ¡å§”æ‰˜ç»™å¤šä¸ªå·¥åŽ‚å­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå®¢æˆ·ç«¯åœ¨ä½¿ç”¨æ—¶å¯ä»¥æ— é¡»å…³å¿ƒæ˜¯å“ªä¸€ä¸ªå·¥åŽ‚å­ç±»åˆ›å»ºäº§å“å­ç±»ï¼Œéœ€è¦æ—¶å†åŠ¨æ€æŒ‡å®šï¼Œå¯å°†å…·ä½“å·¥åŽ‚ç±»çš„ç±»åå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ ä»¥å¡‘æ–™åŠ å·¥åŽ‚ä¸ºä¾‹ï¼Œç›®å‰åŠ å·¥åŽ‚ä»…ç”Ÿäº§Aç±»äº§å“ï¼Œéšç€å®¢æˆ·éœ€æ±‚å˜åŒ–ï¼Œå®¢æˆ·éœ€è¦ç”Ÿäº§Bç±»äº§å“ï¼› ä½†æ˜¯æ”¹å˜åŽŸæœ‰å¡‘æ–™åŠ å·¥åŽ‚çš„é…ç½®å’Œå˜åŒ–éžå¸¸å›°éš¾ï¼Œå‡è®¾ä¸‹ä¸€æ¬¡å®¢æˆ·éœ€è¦å†å‘ç”Ÿå˜åŒ–ï¼Œå†æ¬¡æ”¹å˜å°†å¢žåŠ éžå¸¸å¤§çš„æˆæœ¬ï¼› æ‰€ä»¥é€šè¿‡ç½®åŠžå¡‘æ–™åˆ†åŽ‚Bæ¥ç”Ÿäº§Bç±»äº§å“ã€‚ æŠ½è±¡å·¥åŽ‚ç±» 1234567891011121314package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: æŠ½è±¡å·¥åŽ‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥åŽ‚çš„å…¬å…±æŽ¥å£ */public abstract class Factory &#123; /** * ç”Ÿäº§äº§å“ * * @return */ public abstract Product manuFacture();&#125; æŠ½è±¡äº§å“ç±» 12345678910111213package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ */public abstract class Product &#123; /** * å±•ç¤ºäº§å“ */ public abstract void show();&#125; å…·ä½“äº§å“ç±» 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œå®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ProductA extends Product &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§äº†äº§å“A"); &#125;&#125;package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»B, å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ProductB extends Product &#123; @Override public void show() &#123; System.out.println("ç”Ÿäº§äº†äº§å“B"); &#125;&#125; å…·ä½“å·¥åŽ‚ç±» 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“å·¥åŽ‚ç±»Aï¼Œå®šä¹‰åˆ›å»ºå…·ä½“äº§å“çš„å®žä¾‹æ–¹æ³• */public class FactoryA extends Factory &#123; @Override public Product manuFacture() &#123; return new ProductA(); &#125;&#125;package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“å·¥åŽ‚ç±»Bï¼Œå®šä¹‰åˆ›å»ºå…·ä½“äº§å“çš„å®žä¾‹æ–¹æ³• */public class FactoryB extends Factory &#123; @Override public Product manuFacture() &#123; return new ProductB(); &#125;&#125; å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client &#123; public static void main(String[] args) &#123; //å®¢æˆ·è¦äº§å“A FactoryA factoryA = new FactoryA(); factoryA.manuFacture().show(); //å®¢æˆ·è¦äº§å“B FactoryB factoryB = new FactoryB(); factoryB.manuFacture().show(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ç®€å•å·¥åŽ‚æ¨¡å¼]]></title>
    <url>%2Fposts%2Faac06fee.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ ç®€å•å·¥åŽ‚æ¨¡å¼(Simple Factory Pattern)ï¼šåˆç§°ä¸ºé™æ€å·¥åŽ‚æ–¹æ³•(Static Factory Method)æ¨¡å¼ï¼Œå®ƒå±žäºŽç±»åˆ›å»ºåž‹æ¨¡å¼ã€‚æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡å®žä¾‹çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€å…³å¿ƒå…¶å…·ä½“å®žçŽ°ã€‚è¢«åˆ›å»ºå®žä¾‹çš„ç±»åž‹å¯ä»¥æ˜¯æŽ¥å£ã€æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“ç±»ã€‚ è§£å†³çš„é—®é¢˜ å°†â€œç±»å®žä¾‹åŒ–çš„æ“ä½œâ€ä¸Žâ€œä½¿ç”¨å¯¹è±¡çš„æ“ä½œâ€åˆ†å¼€ï¼Œè®©ä½¿ç”¨è€…ä¸ç”¨çŸ¥é“å…·ä½“å‚æ•°å°±å¯ä»¥å®žä¾‹åŒ–å‡ºæ‰€éœ€è¦çš„â€œäº§å“â€ç±»ï¼Œä»Žè€Œé¿å…äº†åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ˜¾å¼æŒ‡å®šï¼Œå®žçŽ°äº†è§£è€¦ã€‚å³ä½¿ç”¨è€…å¯ç›´æŽ¥æ¶ˆè´¹äº§å“è€Œä¸éœ€è¦çŸ¥é“å…¶ç”Ÿäº§çš„ç»†èŠ‚ã€‚ é€‚ç”¨çš„çŽ¯å¢ƒ å·¥åŽ‚ç±»åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°ï¼Œè¿™æ ·ä¸ä¼šé€ æˆå·¥åŽ‚æ–¹æ³•ä¸­ä¸šåŠ¡çš„é€»è¾‘è¿‡äºŽå¤æ‚ã€‚ å®¢æˆ·ç«¯åªæ˜¯çŸ¥é“ä¼ å…¥å·¥åŽ‚ç±»çš„å‚æ•°ã€å¯¹äºŽå¦‚ä½•åŽ»åˆ›å»ºå¯¹è±¡å¹¶ä¸å…³å¿ƒã€‚å®¢æˆ·ç«¯ä¸éœ€è¦åŽ»å…³å¿ƒåˆ›å»ºçš„ç»†èŠ‚ï¼Œåªéœ€è¦æ˜Žç¡®éœ€è¦çš„å‚æ•°ï¼Œè€Œç”±å·¥åŽ‚å†…éƒ¨è´Ÿè´£å…·ä½“çš„ç±»çš„åˆ›å»ºã€‚ æ¨¡å¼åŽŸç† æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°äº§å“çš„å…¬å…±æŽ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥åŽ‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ å·¥åŽ‚ï¼ˆCreatorï¼‰ è¢«å¤–ç•Œè°ƒç”¨ æ ¹æ®ä¼ å…¥ä¸åŒå‚æ•°ä»Žè€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®žä¾‹ UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡äº§å“ç±» &amp; å®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æŽ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå·¥åŽ‚ç±»ï¼Œé€šè¿‡åˆ›å»ºé™æ€æ–¹æ³•æ ¹æ®ä¼ å…¥ä¸åŒå‚æ•°ä»Žè€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®žä¾‹ï¼› å¤–ç•Œé€šè¿‡è°ƒç”¨å·¥åŽ‚ç±»çš„é™æ€æ–¹æ³•ï¼Œä¼ å…¥ä¸åŒå‚æ•°ä»Žè€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®žä¾‹ æ¨¡å¼ä¼˜ç‚¹ è´£ä»»åˆ†å‰²ï¼šå·¥åŽ‚ç±»å«æœ‰å¤„ç†é€»è¾‘ï¼Œå†³å®šä½•æ—¶åŽ»åˆ›å»ºäº§å“å¯¹è±¡ï¼Œå®¢æˆ·ç«¯åªæ˜¯éœ€è¦ä¼ é€’å¯¹åº”çš„å‚æ•°ï¼Œå³å¯ä»¥å®Œæˆäº§å“çš„åˆ›å»ºã€‚ åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼šå¯ä»¥é€šè¿‡å¼•å…¥é…ç½®æ–‡ä»¶çš„æ–¹æ³•ï¼Œåœ¨ä¸åŽ»ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹ï¼Œæ›´æ¢å’Œå¢žå‡æ–°çš„äº§å“ã€‚ æ¨¡å¼ç¼ºç‚¹ å·¥åŽ‚ç±»é›†ä¸­äº†æ‰€æœ‰å®žä¾‹ï¼ˆäº§å“ï¼‰çš„åˆ›å»ºé€»è¾‘ï¼Œä¸€æ—¦è¿™ä¸ªå·¥åŽ‚ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½ä¼šå—åˆ°å½±å“ã€‚ è¿èƒŒâ€œå¼€æ”¾ - å…³é—­åŽŸåˆ™â€ï¼Œä¸€æ—¦æ·»åŠ æ–°äº§å“å°±ä¸å¾—ä¸ä¿®æ”¹å·¥åŽ‚ç±»çš„é€»è¾‘ï¼Œè¿™æ ·å°±ä¼šé€ æˆå·¥åŽ‚é€»è¾‘è¿‡äºŽå¤æ‚ã€‚ ç®€å•å·¥åŽ‚æ¨¡å¼ç”±äºŽä½¿ç”¨äº†é™æ€å·¥åŽ‚æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿å’Œé‡å†™ï¼Œä¼šé€ æˆå·¥åŽ‚è§’è‰²æ— æ³•å½¢æˆåŸºäºŽç»§æ‰¿çš„ç­‰çº§ç»“æž„ã€‚ æ¨¡å¼åº”ç”¨ JDKç±»åº“ä¸­å¹¿æ³›ä½¿ç”¨äº†ç®€å•å·¥åŽ‚æ¨¡å¼ï¼Œå¦‚å·¥å…·ç±»java.text.DateFormatï¼Œå®ƒç”¨äºŽæ ¼å¼åŒ–ä¸€ä¸ªæœ¬åœ°æ—¥æœŸæˆ–è€…æ—¶é—´ã€‚ 123public final static DateFormat getDateInstance(); public final static DateFormat getDateInstance(int style); public final static DateFormat getDateInstance(int style,Locale locale); èŽ·å–ä¸åŒåŠ å¯†ç®—æ³•çš„å¯†é’¥ç”Ÿæˆå™¨ã€‚ 1KeyGenerator keyGen=KeyGenerator.getInstance("DESede"); æ¨¡å¼ç¤ºä¾‹ ä»¥ç”Ÿäº§ç”µè„‘ä¸ºä¾‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç”µè„‘çš„ä»£å·¥ç”Ÿäº§å•†ï¼Œå®ƒç›®å‰å·²ç»å¯ä»¥ä»£å·¥ç”Ÿäº§è”æƒ³ç”µè„‘ï¼Œéšç€ä¸šåŠ¡çš„æ‹“å±•ï¼Œè¿™ä¸ªä»£å·¥ç”Ÿäº§å•†è¿˜è¦ç”Ÿäº§æƒ æ™®å’ŒåŽç¡•çš„ç”µè„‘ï¼Œè¿™æ ·å°±éœ€è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥ä¸“é—¨ç”Ÿäº§ç”µè„‘ï¼Œè¿™å°±ç”¨åˆ°äº†ç®€å•å·¥åŽ‚æ¨¡å¼ã€‚ æŠ½è±¡äº§å“ç±» åˆ›å»ºä¸€ä¸ªç”µè„‘çš„æŠ½è±¡äº§å“ç±»ï¼Œä»–æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”¨äºŽå¯åŠ¨ç”µè„‘ç”Ÿäº§ï¼š 12345678910111213package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»ï¼šç”µè„‘ */public abstract class Computer &#123; /** * äº§å“çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å…·ä½“çš„äº§å“åŽ»å®žçŽ° */ public abstract void startProduce();&#125; å…·ä½“äº§å“ç±» æŽ¥ç€åˆ›å»ºå„ä¸ªå“ç‰Œçš„ç”µè„‘ï¼Œä»–ä»¬éƒ½ç»§æ‰¿äº†ä»–ä»¬çš„çˆ¶ç±»Computerï¼Œå¹¶å®žçŽ°äº†çˆ¶ç±»çš„startProduceæ–¹æ³•ï¼š è”æƒ³ç”µè„‘ 12345678910111213package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šè”æƒ³ç”µè„‘ */public class LenovoComputer extends Computer &#123; @Override public void startProduce() &#123; System.out.println("è”æƒ³ç”µè„‘å¯åŠ¨ç”Ÿäº§"); &#125;&#125; æƒ æ™®ç”µè„‘ 123456789101112package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šæƒ æ™®ç”µè„‘ */public class HpComputer extends Computer &#123; @Override public void startProduce() &#123; System.out.println("æƒ æ™®ç”µè„‘å¯åŠ¨ç”Ÿäº§"); &#125;&#125; åŽç¡•ç”µè„‘ 123456789101112package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šåŽç¡•ç”µè„‘ */public class AsusComputer extends Computer&#123; @Override public void startProduce() &#123; System.out.println("åŽç¡•ç”µè„‘å¯åŠ¨ç”Ÿäº§"); &#125;&#125; å·¥åŽ‚ç±» æŽ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªå·¥åŽ‚ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•createComputerç”¨æ¥ç”Ÿäº§ç”µè„‘ã€‚ä½ åªéœ€è¦ä¼ å…¥ä½ æƒ³ç”Ÿäº§çš„ç”µè„‘çš„å“ç‰Œï¼Œå®ƒå°±ä¼šå®žä¾‹åŒ–ç›¸åº”å“ç‰Œçš„ç”µè„‘å¯¹è±¡ï¼š 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å·¥åŽ‚ç±» */public class ComputerFactory &#123; /** * ç”Ÿäº§ç”µè„‘ * * @param type * @return */ public static Computer createComputer(String type) &#123; Computer computer = null; switch (type) &#123; case "lenovo": computer = new LenovoComputer(); break; case "hp": computer = new HpComputer(); break; case "asus": computer = new AsusComputer(); break; &#125; return computer; &#125;&#125; å®¢æˆ·ç«¯ å®¢æˆ·ç«¯è°ƒç”¨å·¥åŽ‚ç±»ï¼Œä¼ å…¥â€œasusâ€ç”Ÿäº§å‡ºåŽç¡•ç”µè„‘å¹¶è°ƒç”¨è¯¥ç”µè„‘å¯¹è±¡çš„startProduceæ–¹æ³•ï¼š 1234567891011package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯ */public class Client &#123; public static void main(String[] args) &#123; ComputerFactory.createComputer("asus").startProduce(); &#125;&#125;]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-06ä¹‹-çº¿ç¨‹è®©æ­¥]]></title>
    <url>%2Fposts%2Fa8d456e8.html</url>
    <content type="text"><![CDATA[yield()ä»‹ç» &lt;p id=&quot;div-border-left-green&quot;&gt; yield()çš„ä½œç”¨æ˜¯è®©æ­¥ã€‚å®ƒèƒ½è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»Žè€Œè®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹èŽ·å–æ‰§è¡Œæƒï¼›ä½†æ˜¯ï¼Œå¹¶ä¸èƒ½ä¿è¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨yield()ä¹‹åŽï¼Œå…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹å°±ä¸€å®šèƒ½èŽ·å¾—æ‰§è¡Œæƒï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å½“å‰çº¿ç¨‹åˆè¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€ç»§ç»­è¿è¡Œï¼ &lt;/p&gt; yield()ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031package main.java.com.study.thread.yield;/** * @author: whb * @description: yield()çš„ä½œç”¨æ˜¯è®©æ­¥ã€‚å®ƒèƒ½è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»Žè€Œè®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹èŽ·å–æ‰§è¡Œæƒï¼›ä½†æ˜¯ï¼Œå¹¶ä¸èƒ½ä¿è¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨yield()ä¹‹åŽï¼Œå…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹å°±ä¸€å®šèƒ½èŽ·å¾—æ‰§è¡Œæƒï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å½“å‰çº¿ç¨‹åˆè¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€ç»§ç»­è¿è¡Œï¼ */public class YieldTest &#123; public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); &#125;&#125;class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public synchronized void run() &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.printf("%s [%d]:%d\n", this.getName(), this.getPriority(), i); // iæ•´é™¤4æ—¶ï¼Œè°ƒç”¨yield if (i % 4 == 0) &#123; Thread.yield(); &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; (æŸä¸€æ¬¡çš„)è¿è¡Œç»“æžœ: &lt;/span&gt; 1234567891011121314151617181920t1 [5]:0t2 [5]:0t1 [5]:1t1 [5]:2t1 [5]:3t1 [5]:4t1 [5]:5t1 [5]:6t1 [5]:7t1 [5]:8t1 [5]:9t2 [5]:1t2 [5]:2t2 [5]:3t2 [5]:4t2 [5]:5t2 [5]:6t2 [5]:7t2 [5]:8t2 [5]:9 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; â€œçº¿ç¨‹t1â€åœ¨èƒ½è¢«4æ•´æ•°çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰åˆ‡æ¢åˆ°â€œçº¿ç¨‹t2â€ã€‚è¿™è¡¨æ˜Žï¼Œyield()è™½ç„¶å¯ä»¥è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼›ä½†æ˜¯ï¼Œå®ƒä¸ä¸€å®šä¼šè®©å…¶å®ƒçº¿ç¨‹èŽ·å–CPUæ‰§è¡Œæƒ(å³ï¼Œå…¶å®ƒçº¿ç¨‹è¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€)ï¼Œå³ä½¿è¿™ä¸ªâ€œå…¶å®ƒçº¿ç¨‹â€ä¸Žå½“å‰è°ƒç”¨yield()çš„çº¿ç¨‹å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ã€‚ yield() ä¸Ž wait()çš„æ¯”è¾ƒ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œyield()çš„ä½œç”¨æ˜¯è®©æ­¥ï¼Œå®ƒä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹ç¦»å¼€â€œè¿è¡ŒçŠ¶æ€â€ã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š (01) wait()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œè€Œä¸yield()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ã€‚ (02) wait()æ˜¯ä¼šçº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œyield()æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”ã€‚ ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºyield()æ˜¯ä¸ä¼šé‡Šæ”¾é”çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.thread.yield;/** * @author: whb * @description: wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œyield()çš„ä½œç”¨æ˜¯è®©æ­¥ï¼Œå®ƒä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹ç¦»å¼€â€œè¿è¡ŒçŠ¶æ€â€ã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š * (01) wait()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œè€Œä¸yield()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ã€‚ * (02) wait()æ˜¯ä¼šçº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œyield()æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”ã€‚ */public class YieldLockTest &#123; private static Object obj = new Object(); public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); &#125; static class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; // èŽ·å–objå¯¹è±¡çš„åŒæ­¥é” synchronized (obj) &#123; for (int i = 0; i &lt; 10; i++) &#123; System.out.printf("%s [%d]:%d\n", this.getName(), this.getPriority(), i); // iæ•´é™¤4æ—¶ï¼Œè°ƒç”¨yield if (i % 4 == 0) &#123; Thread.yield(); &#125; &#125; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; (æŸä¸€æ¬¡)è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234567891011121314151617181920t1 [5]:0t1 [5]:1t1 [5]:2t1 [5]:3t1 [5]:4t1 [5]:5t1 [5]:6t1 [5]:7t1 [5]:8t1 [5]:9t2 [5]:0t2 [5]:1t2 [5]:2t2 [5]:3t2 [5]:4t2 [5]:5t2 [5]:6t2 [5]:7t2 [5]:8t2 [5]:9 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2åœ¨run()ä¼šå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œå³synchronized(obj)ã€‚åœ¨t1è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å®ƒä¼šè°ƒç”¨Thread.yield()ï¼›ä½†æ˜¯ï¼Œt2æ˜¯ä¸ä¼šèŽ·å–cpuæ‰§è¡Œæƒçš„ã€‚å› ä¸ºï¼Œt1å¹¶æ²¡æœ‰é‡Šæ”¾â€œobjæ‰€æŒæœ‰çš„åŒæ­¥é”â€ï¼]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - æ¢³æŽ’åº]]></title>
    <url>%2Fposts%2F9d531ce3.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ æ¢³æŽ’åºå’Œå¸Œå°”æŽ’åºå¾ˆç±»ä¼¼ã€‚å¸Œå°”æŽ’åºæ˜¯åœ¨ç›´æŽ¥æ’å…¥æŽ’åºçš„åŸºç¡€ä¸Šåšçš„ä¼˜åŒ–ï¼Œè€Œæ¢³æŽ’åºæ˜¯åœ¨å†’æ³¡æŽ’åºçš„åŸºç¡€ä¸Šåšçš„ä¼˜åŒ–ã€‚ä¹Ÿæ˜¯åƒå¸Œå°”æŽ’åºä¸€æ ·ï¼Œå°†å¾…æŽ’åºåºåˆ—é€šè¿‡å¢žé‡åˆ†ä¸ºè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œç„¶åŽå¯¹å­åºåˆ—è¿›è¡Œä¸€è¶Ÿå†’æ³¡æŽ’åºï¼Œä¸€æ­¥æ­¥å‡å°å¢žé‡ï¼Œç›´è‡³å¢žé‡ä¸º1ã€‚æ‰€ä»¥æ¢³æŽ’åºçš„æœ€åŽä¸€æ¬¡æŽ’åºæ˜¯å†’æ³¡æŽ’åºã€‚ æ¢³æŽ’åºå¢žé‡æ˜¯æ ¹æ®é€’å‡çŽ‡å‡å°çš„ï¼Œé€’å‡çŽ‡çš„è®¾å®šå½±å“ç€æ¢³æŽ’åºçš„æ•ˆçŽ‡ï¼ŒåŽŸä½œè€…ä»¥éšæœºæ•°ä½œå®žéªŒï¼Œå¾—åˆ°æœ€æœ‰æ•ˆé€’å‡çŽ‡ä¸º1.3çš„ã€‚å› ä¸ºç¼–ç¨‹ä¸­ä¹˜æ³•æ¯”é™¤æ³•å¿«ï¼Œæ‰€ä»¥ä¼šå–é€’å‡çŽ‡çš„å€’æ•°ä¸Žé—´è·ç›¸ä¹˜ï¼Œå³0.8ã€‚å…¶å®žå½“é—´è·ä¸º1çš„æ—¶å€™ï¼Œæ¢³æŽ’åºå°±æ˜¯å†’æ³¡æŽ’åºï¼Œè€Œé—´è·å¤§äºŽ1çš„æ—¶å€™ï¼Œæ¢³æŽ’åºçš„å°±æ˜¯å°½é‡æŠŠå°çš„æ•°å­—å¾€å‰ç§»åŠ¨å¹¶ä¿è¯æ­¤æ¬¡é—´éš”å†…çš„ç»„æ˜¯æœ‰åºçš„ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å¾…æ•°ç»„[10 4 3 9 6 5 2 1 7 8] å¾…æŽ’æ•°ç»„é•¿åº¦ä¸º10,è€Œ10Ã·1.3=8,åˆ™æ¯”è¾ƒ10å’Œ7,4å’Œ8,å¹¶åšäº¤æ¢ã€‚ äº¤æ¢åŽçš„ç»“æžœä¸ºï¼š [7 4 3 9 6 5 2 1 10 8] ç¬¬äºŒæ¬¡å¾ªçŽ¯,æ›´æ–°é—´è·ä¸º8Ã·1.3=6,æ¯”è¾ƒ7å’Œ2,4å’Œ1,3å’Œ10,9å’Œ8,7å’Œ2ï¼Œ4å’Œ1,9å’Œ8éœ€è¦äº¤æ¢ã€‚ äº¤æ¢åŽçš„ç»“æžœä¸ºï¼š [2 1 3 8 6 5 7 4 10 9] ç¬¬ä¸‰æ¬¡å¾ªçŽ¯,æ›´æ–°è·ç¦»ä¸º4,æ¯”è¾ƒ2å’Œ6,1å’Œ5,3å’Œ7,8å’Œ4,6å’Œ10,5å’Œ9,8å’Œ4éœ€è¦äº¤æ¢ã€‚ [2 1 3 4 6 5 7 8 10 9] ç¬¬å››æ¬¡å¾ªçŽ¯,æ›´æ–°è·ç¦»ä¸º3,æ¯”è¾ƒ2å’Œ4,1å’Œ6,3å’Œ5,4å’Œ7,6å’Œ8,5å’Œ10,7å’Œ9ï¼Œä¸éœ€è¦äº¤æ¢ã€‚ ç¬¬äº”æ¬¡å¾ªçŽ¯,æ›´æ–°è·ç¦»ä¸º2,æ¯”è¾ƒ2å’Œ3,1å’Œ4,3å’Œ6,4å’Œ5,6å’Œ7,5å’Œ8,7å’Œ10,8å’Œ9ï¼Œä¸éœ€è¦äº¤æ¢ã€‚ ç¬¬å…­æ¬¡å¾ªçŽ¯ï¼Œæ›´æ–°è·ç¦»ä¸º1ï¼Œä¸ºå†’æ³¡æŽ’åºã€‚ [1 2 3 4 5 6 7 8 9 10] äº¤æ¢åŽæŽ’åºç»“æŸ,é¡ºåºè¾“å‡ºå³å¯å¾—åˆ°[1 2 3 4 5 6 7 8 9 10]ã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ¢³æŽ’åº */public class CombSort &#123; /** * æ¢³æŽ’åº * * @param unsorted å¾…æŽ’åºåˆ— */ public static void combSort(int[] unsorted) &#123; int gap = unsorted.length; boolean swapped = true; while (gap &gt; 1 || swapped) &#123; if (gap &gt; 1) &#123; gap = (int) (gap / 1.3); &#125; int i = 0; swapped = false; while (i + gap &lt; unsorted.length) &#123; if (unsorted[i] &gt; unsorted[i + gap]) &#123; swap(unsorted, i, i + gap); swapped = true; &#125; i++; &#125; &#125; &#125; /** * æŒ‰ä»Žå°åˆ°å¤§çš„é¡ºåºäº¤æ¢æ•°ç»„ * * @param a ä¼ å…¥çš„æ•°ç»„ * @param b ä¼ å…¥çš„è¦äº¤æ¢çš„æ•°b * @param c ä¼ å…¥çš„è¦äº¤æ¢çš„æ•°c */ public static void swap(int[] a, int b, int c) &#123; if (b == c) &#123; return; &#125; int temp = a[b]; a[b] = a[c]; a[c] = temp; &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;11, 95, 45, 15, 78, 84, 51, 24, 12&#125;; System.out.println("**************æ¢³æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); combSort(unsorted); CommonUtils.display(unsorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - åœ°ç²¾æŽ’åº]]></title>
    <url>%2Fposts%2Fd703cb77.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å·ç§°æœ€ç®€å•çš„æŽ’åºç®—æ³•,åªæœ‰ä¸€å±‚å¾ªçŽ¯,é»˜è®¤æƒ…å†µä¸‹å‰è¿›å†’æ³¡,ä¸€æ—¦é‡åˆ°å†’æ³¡çš„æƒ…å†µå‘ç”Ÿå°±å¾€å›žå†’,ç›´åˆ°æŠŠè¿™ä¸ªæ•°å­—æ”¾å¥½ä¸ºæ­¢ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æŽ’æ•°ç»„[6 2 4 1 5 9]ã€‚ å…ˆè®¾è®¡ä¸€ä¸ªæ ‡è¯†i=0ç„¶åŽä»Žå¤´å¼€å§‹åˆ¤æ–­,ä»€ä¹ˆæ—¶å€™(i &lt; 6)ä¸æˆç«‹,ä»€ä¹ˆæ—¶å€™æŽ’åºç»“æŸã€‚ [6 2 4 1 5 9] [0 1 2 3 4 5] ä¸‹å…·ä½“çš„æŽ’åºè¿‡ç¨‹å¦‚ä¸‹ï¼š [ i = 0 ]æ—¶å•¥ä¹Ÿä¸å¹²,å…ˆè®©iè‡ªå¢ž1,è¾¾åˆ°å€¼ä¸º1æ‰å¼€å§‹çœŸæ­£çš„æ¯”è¾ƒã€‚ äº¤æ¢å‰[6 2 4 1 5 9][ i = 0] äº¤æ¢åŽ[6 2 4 1 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ6å’Œ2,å‘ç”Ÿäº¤æ¢,åªè¦å‘ç”Ÿäº¤æ¢iå°±å‡1ã€‚ äº¤æ¢å‰[6 2 4 1 5 9][ i = 1] äº¤æ¢åŽ[2 6 4 1 5 9][ i = 0] [ i = 0 ]åˆæˆ0äº†,å•¥ä¹Ÿä¸å¹²,è‡ªå¢žå˜æˆ1å†è¯´ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 0] äº¤æ¢åŽ[2 6 4 1 5 9][ i = 1] [ i = 1 ]å†æ¯”è¾ƒ2å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 1] äº¤æ¢åŽ[2 6 4 1 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ6å’Œ4,å‘ç”Ÿäº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 2] äº¤æ¢åŽ[2 4 6 1 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ2å’Œ4,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 1] äº¤æ¢åŽ[2 4 6 1 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ4å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 2] äº¤æ¢åŽ[2 4 6 1 5 9][ i = 3] [ i = 3 ]æ¯”è¾ƒ6å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 3] äº¤æ¢åŽ[2 4 1 6 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ4å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 4 1 6 5 9][ i = 2] äº¤æ¢åŽ[2 1 4 6 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ2å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 1 4 6 5 9][ i = 1] äº¤æ¢åŽ[1 2 4 6 5 9][ i = 0] [ i = 0 ]æ—¶å•¥ä¹Ÿä¸å¹²,å…ˆè®©iè‡ªå¢ž1,è¾¾åˆ°å€¼ä¸º1æ‰å¼€å§‹çœŸæ­£çš„æ¯”è¾ƒã€‚ äº¤æ¢å‰[1 2 4 6 5 9][ i = 0] äº¤æ¢åŽ[1 2 4 6 5 9][ i = 1] [ i = 1]æ¯”è¾ƒ1å’Œ2,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 2]æ¯”è¾ƒ2å’Œ4,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 3]æ¯”è¾ƒ4å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 4]æ¯”è¾ƒ6å’Œ5,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[1 2 4 6 5 9][ i = 4] äº¤æ¢åŽ[1 2 4 5 6 9][ i = 3] [ i = 3]æ¯”è¾ƒ4å’Œ5,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 4]æ¯”è¾ƒ5å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 5]æ¯”è¾ƒ6å’Œ9,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢ž1ã€‚ [ i = 6]è¡¨è¾¾å¼(i &lt; n)ä¸æˆç«‹,æŽ’åºç»“æŸã€‚ é¡ºåºè¾“å‡ºç»“æžœå³å¯:[ 1 2 4 5 6 9]ã€‚ ä»£ç  12345678910111213141516171819202122232425262728293031323334package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: åœ°ç²¾æŽ’åºï¼šå·ç§°æœ€ç®€å•çš„æŽ’åºç®—æ³•,åªæœ‰ä¸€å±‚å¾ªçŽ¯,é»˜è®¤æƒ…å†µä¸‹å‰è¿›å†’æ³¡,ä¸€æ—¦é‡åˆ°å†’æ³¡çš„æƒ…å†µå‘ç”Ÿå°±å¾€å›žå†’,ç›´åˆ°æŠŠè¿™ä¸ªæ•°å­—æ”¾å¥½ä¸ºæ­¢ã€‚ */public class GnomeSort &#123; public static void gnomeSort(int[] unsorted) &#123; int i = 0; while (i &lt; unsorted.length) &#123; if (i == 0 || unsorted[i - 1] &lt;= unsorted[i]) &#123; i++; &#125; else &#123; int temp = unsorted[i]; unsorted[i] = unsorted[i - 1]; unsorted[i - 1] = temp; i--; &#125; &#125; &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;6, 2, 4, 1, 5, 9&#125;; System.out.println("**************åœ°ç²¾æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); gnomeSort(unsorted); CommonUtils.display(unsorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - é¸¡å°¾é…’æŽ’åº]]></title>
    <url>%2Fposts%2F6d9204ec.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ é¸¡å°¾é…’æŽ’åºåŸºäºŽå†’æ³¡æŽ’åº,åŒå‘å¾ªçŽ¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šç»™å®šå¾…æŽ’æ•°ç»„[2 3 4 5 1] ç¬¬ä¸€è¶Ÿè¿‡åŽ»æ—¶çš„æ¯ä¸€æ­¥ã€‚ ç¬¬ä¸€æ­¥è¿­ä»£,2 &lt; 3ä¸æ¢ [2 3 4 5 1] ç¬¬äºŒæ­¥è¿­ä»£,3 &lt; 4ä¸æ¢ [2 3 4 5 1] ç¬¬ä¸‰æ­¥è¿­ä»£,4 &lt; 5ä¸æ¢ [2 3 4 5 1] ç¬¬å››æ­¥è¿­ä»£,5 &gt; 1äº¤æ¢ [2 3 4 1 5] ç¬¬ä¸€è¶Ÿå›žæ¥æ—¶çš„ç¬¬ä¸€æ­¥,é¸¡å°¾é…’ä¸€æ¬¡åˆ°å¤´åŽå°±å›žè¿”å›žæ¥,å†åˆ°å¤´åŽå†è¿‡åŽ»,æ¥å›žæ¯”,ä¸€ä¸ªæ¥å›žèƒ½æŽ’ä¸¤ä¸ªæ•°å­—ã€‚ ç¬¬äº”æ­¥è¿­ä»£,1 &lt; 5ä¸äº¤æ¢ [2 3 4 1 5] ç¬¬å…­æ­¥è¿­ä»£,1 &lt; 4äº¤æ¢ [2 3 1 4 5] ç¬¬ä¸ƒæ­¥è¿­ä»£,1 &lt; 3äº¤æ¢ [2 1 3 4 5] ç¬¬å…«æ­¥è¿­ä»£,2 &gt; 1äº¤æ¢ [1 2 3 4 5] æŽ’åºå®Œæ¯•,é¡ºåºè¾“å‡ºç»“æžœå³å¯å¾—[ 1 2 3 4 5]ã€‚ å¦‚ä½•åˆ¤æ–­æŽ’åºç»“æŸäº†? å‡å¦‚ä¸€è¶Ÿæ¥å›žæ²¡æœ‰äº¤æ¢ä»»ä½•æ•°å­—,åˆ™è¡¨ç¤ºè¯¥æ•°ç»„å·²ç»æœ‰åºäº†,å¯ä»¥è®¾ç½®äº†ä¸ªå˜é‡è¡¨ç¤ºæœ‰æ²¡æœ‰äº¤æ¢è¿‡ã€‚ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é¸¡å°¾é…’æŽ’åº åŸºäºŽå†’æ³¡æŽ’åº,åŒå‘å¾ªçŽ¯ */public class CocktailSort &#123; public static void cocktailSort(int[] unsorted) &#123; boolean swapped = false; do &#123; for (int i = 0; i &lt; unsorted.length - 1; i++) &#123; if (unsorted[i] &gt; unsorted[i + 1]) &#123; int temp = unsorted[i]; unsorted[i] = unsorted[i + 1]; unsorted[i + 1] = temp; swapped = true; &#125; &#125; swapped = false; for (int j = unsorted.length - 1; j &gt; 0; j--) &#123; if (unsorted[j] &lt; unsorted[j - 1]) &#123; int temp = unsorted[j]; unsorted[j] = unsorted[j - 1]; unsorted[j - 1] = temp; swapped = true; &#125; &#125; &#125; while (swapped); &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;6, 2, 4, 1, 5, 9&#125;; System.out.println("**************é¸¡å°¾é…’æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); cocktailSort(unsorted); CommonUtils.display(unsorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - æ¡¶æŽ’åº]]></title>
    <url>%2Fposts%2F41e434a7.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ æ˜¯å°†é˜µåˆ—åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶å­é‡Œã€‚æ¯ä¸ªæ¡¶å­å†ä¸ªåˆ«æŽ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æŽ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å›žæ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æŽ’åºè¿›è¡ŒæŽ’åºï¼‰ã€‚æ¡¶æŽ’åºæ˜¯é¸½å·¢æŽ’åºçš„ä¸€ç§å½’çº³ç»“æžœã€‚å½“è¦è¢«æŽ’åºçš„é˜µåˆ—å†…çš„æ•°å€¼æ˜¯å‡åŒ€åˆ†é…çš„æ—¶å€™ï¼Œæ¡¶æŽ’åºä½¿ç”¨çº¿æ€§æ—¶é—´ï¼ˆÎ˜ï¼ˆnï¼‰ï¼‰ã€‚ä½†æ¡¶æŽ’åºå¹¶ä¸æ˜¯ æ¯”è¾ƒæŽ’åºï¼Œä»–ä¸å—åˆ° O(n log n) ä¸‹é™çš„å½±å“ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ•°æ®åˆ†ç»„ï¼Œæ”¾åœ¨ä¸€ä¸ªä¸ªçš„æ¡¶ä¸­ï¼Œç„¶åŽå¯¹æ¯ä¸ªæ¡¶é‡Œé¢çš„åœ¨è¿›è¡ŒæŽ’åºã€‚ ä¾‹å¦‚è¦å¯¹å¤§å°ä¸º[1..1000]èŒƒå›´å†…çš„nä¸ªæ•´æ•°A[1..n]æŽ’åºã€‚ é¦–å…ˆï¼Œå¯ä»¥æŠŠæ¡¶è®¾ä¸ºå¤§å°ä¸º10çš„èŒƒå›´ï¼Œå…·ä½“è€Œè¨€ï¼Œè®¾é›†åˆB[1]å­˜å‚¨[1..10]çš„æ•´æ•°ï¼Œé›†åˆB[2]å­˜å‚¨(10..20]çš„æ•´æ•°ï¼Œâ€¦â€¦é›†åˆB[i]å­˜å‚¨((i-1)10, i10]çš„æ•´æ•°ï¼Œi = 1,2,..100ã€‚æ€»å…±æœ‰100ä¸ªæ¡¶ã€‚ ç„¶åŽï¼Œå¯¹A[1..n]ä»Žå¤´åˆ°å°¾æ‰«æä¸€éï¼ŒæŠŠæ¯ä¸ªA[i]æ”¾å…¥å¯¹åº”çš„æ¡¶B[j]ä¸­ã€‚å†å¯¹è¿™100ä¸ªæ¡¶ä¸­æ¯ä¸ªæ¡¶é‡Œçš„æ•°å­—æŽ’åºï¼Œè¿™æ—¶å¯ç”¨å†’æ³¡ï¼Œé€‰æ‹©ï¼Œä¹ƒè‡³å¿«æŽ’ï¼Œä¸€èˆ¬æ¥è¯´ä»»ä½•æŽ’åºæ³•éƒ½å¯ä»¥ã€‚ æœ€åŽï¼Œä¾æ¬¡è¾“å‡ºæ¯ä¸ªæ¡¶é‡Œé¢çš„æ•°å­—ï¼Œä¸”æ¯ä¸ªæ¡¶ä¸­çš„æ•°å­—ä»Žå°åˆ°å¤§è¾“å‡ºï¼Œè¿™æ ·å°±å¾—åˆ°æ‰€æœ‰æ•°å­—æŽ’å¥½åºçš„ä¸€ä¸ªåºåˆ—äº†ã€‚ å‡è®¾æœ‰nä¸ªæ•°å­—ï¼Œæœ‰mä¸ªæ¡¶ï¼Œå¦‚æžœæ•°å­—æ˜¯å¹³å‡åˆ†å¸ƒçš„ï¼Œåˆ™æ¯ä¸ªæ¡¶é‡Œé¢å¹³å‡æœ‰n/mä¸ªæ•°å­—ã€‚å¦‚æžœå¯¹æ¯ä¸ªæ¡¶ä¸­çš„æ•°å­—é‡‡ç”¨å¿«é€ŸæŽ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªç®—æ³•çš„å¤æ‚åº¦æ˜¯ O(n + m * n/m*log(n/m)) = O(n + nlogn - nlogm) ä»Žä¸Šå¼çœ‹å‡ºï¼Œå½“mæŽ¥è¿‘nçš„æ—¶å€™ï¼Œæ¡¶æŽ’åºå¤æ‚åº¦æŽ¥è¿‘O(n)ã€‚ å½“ç„¶ï¼Œä»¥ä¸Šå¤æ‚åº¦çš„è®¡ç®—æ˜¯åŸºäºŽè¾“å…¥çš„nä¸ªæ•°å­—æ˜¯å¹³å‡åˆ†å¸ƒè¿™ä¸ªå‡è®¾çš„ã€‚è¿™ä¸ªå‡è®¾æ˜¯å¾ˆå¼ºçš„ ï¼Œå®žé™…åº”ç”¨ä¸­æ•ˆæžœå¹¶æ²¡æœ‰è¿™ä¹ˆå¥½ã€‚å¦‚æžœæ‰€æœ‰çš„æ•°å­—éƒ½è½åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œé‚£å°±é€€åŒ–æˆä¸€èˆ¬çš„æŽ’åºäº†ã€‚ æ¡¶æŽ’åºçš„ç¼ºç‚¹æ˜¯ï¼š 1ï¼‰é¦–å…ˆæ˜¯ç©ºé—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œéœ€è¦çš„é¢å¤–å¼€é”€å¤§ã€‚æŽ’åºæœ‰ä¸¤ä¸ªæ•°ç»„çš„ç©ºé—´å¼€é”€ï¼Œä¸€ä¸ªå­˜æ”¾å¾…æŽ’åºæ•°ç»„ï¼Œä¸€ä¸ªå°±æ˜¯æ‰€è°“çš„æ¡¶ï¼Œæ¯”å¦‚å¾…æŽ’åºå€¼æ˜¯ä»Ž0åˆ°m-1ï¼Œé‚£å°±éœ€è¦mä¸ªæ¡¶ï¼Œè¿™ä¸ªæ¡¶æ•°ç»„å°±è¦è‡³å°‘mä¸ªç©ºé—´ã€‚ 2ï¼‰å…¶æ¬¡å¾…æŽ’åºçš„å…ƒç´ éƒ½è¦åœ¨ä¸€å®šçš„èŒƒå›´å†…ç­‰ç­‰ã€‚ æ¡¶å¼æŽ’åºæ˜¯ä¸€ç§åˆ†é…æŽ’åºã€‚åˆ†é…æŽ’åºçš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦è¿›è¡Œå…³é”®ç çš„æ¯”è¾ƒï¼Œä½†å‰ææ˜¯è¦çŸ¥é“å¾…æŽ’åºåˆ—çš„ä¸€äº›å…·ä½“æƒ…å†µã€‚ ä¾‹å¦‚å¾…æŽ’æ•°å­—[6 2 4 1 5 9] å‡†å¤‡10ä¸ªç©ºæ¡¶,æœ€å¤§æ•°ä¸ªç©ºæ¡¶ [6 2 4 1 5 9] å¾…æŽ’æ•°ç»„ [0 0 0 0 0 0 0 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®žé™…ä¸å­˜åœ¨) 1,é¡ºåºä»Žå¾…æŽ’æ•°ç»„ä¸­å–å‡ºæ•°å­—,é¦–å…ˆ6è¢«å–å‡º,ç„¶åŽæŠŠ6å…¥6å·æ¡¶,è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼è¿™æ ·:ç©ºæ¡¶[ å¾…æŽ’æ•°ç»„[ 0 ] ] = å¾…æŽ’æ•°ç»„[ 0 ] [6 2 4 1 5 9] å¾…æŽ’æ•°ç»„ [0 0 0 0 0 0 6 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®žé™…ä¸å­˜åœ¨) 2,é¡ºåºä»Žå¾…æŽ’æ•°ç»„ä¸­å–å‡ºä¸‹ä¸€ä¸ªæ•°å­—,æ­¤æ—¶2è¢«å–å‡º,å°†å…¶æ”¾å…¥2å·æ¡¶,æ˜¯å‡ å°±æ”¾å‡ å·æ¡¶ [6 2 4 1 5 9] å¾…æŽ’æ•°ç»„ [0 0 2 0 0 0 6 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®žé™…ä¸å­˜åœ¨) 3,4,5,6çœç•¥,è¿‡ç¨‹ä¸€æ ·,å…¨éƒ¨å…¥æ¡¶åŽå˜æˆä¸‹è¾¹è¿™æ · [6 2 4 1 5 9] å¾…æŽ’æ•°ç»„ [0 1 2 0 4 5 6 0 0 9] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®žé™…ä¸å­˜åœ¨) 0è¡¨ç¤ºç©ºæ¡¶,è·³è¿‡,é¡ºåºå–å‡ºå³å¯:1 2 4 5 6 9 ä»£ç  12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ¡¶æŽ’åº */public class BucketSort &#123; /** * æ˜¯å°†é˜µåˆ—åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶å­é‡Œã€‚æ¯ä¸ªæ¡¶å­å†ä¸ªåˆ«æŽ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æŽ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å›žæ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æŽ’åºè¿›è¡ŒæŽ’åºï¼‰ã€‚ * æ¡¶æŽ’åºæ˜¯é¸½å·¢æŽ’åºçš„ä¸€ç§å½’çº³ç»“æžœã€‚å½“è¦è¢«æŽ’åºçš„é˜µåˆ—å†…çš„æ•°å€¼æ˜¯å‡åŒ€åˆ†é…çš„æ—¶å€™ï¼Œæ¡¶æŽ’åºä½¿ç”¨çº¿æ€§æ—¶é—´ï¼ˆÎ˜ï¼ˆnï¼‰ï¼‰ã€‚ * ä½†æ¡¶æŽ’åºå¹¶ä¸æ˜¯ æ¯”è¾ƒæŽ’åºï¼Œä»–ä¸å—åˆ° O(n log n) ä¸‹é™çš„å½±å“ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ•°æ®åˆ†ç»„ï¼Œæ”¾åœ¨ä¸€ä¸ªä¸ªçš„æ¡¶ä¸­ï¼Œç„¶åŽå¯¹æ¯ä¸ªæ¡¶é‡Œé¢çš„åœ¨è¿›è¡ŒæŽ’åºã€‚ */ public static int[] bucketSort(int[] unsorted, int maxNumber) &#123; int[] sorted = new int[maxNumber + 1]; for (int i = 0; i &lt; unsorted.length; i++) &#123; sorted[unsorted[i]] = unsorted[i]; &#125; return sorted; &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;99, 65, 24, 47, 50, 88, 33, 66, 67, 31, 18&#125;; int[] sorted = bucketSort(unsorted, 99); System.out.println("**************æ¡¶æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); for (int tmp : sorted) &#123; if (tmp &gt; 0) &#123; System.out.print(tmp + " "); &#125; &#125; &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-05ä¹‹-çº¿ç¨‹ç­‰å¾…ä¸Žå”¤é†’]]></title>
    <url>%2Fposts%2Ff777650b.html</url>
    <content type="text"><![CDATA[wait(), notify(), notifyAll()ç­‰æ–¹æ³•ä»‹ç» åœ¨Object.javaä¸­ï¼Œå®šä¹‰äº†wait(), notify()å’ŒnotifyAll()ç­‰æŽ¥å£ã€‚ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶ï¼Œwait()ä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„é”ã€‚ è€Œnotify()å’ŒnotifyAll()çš„ä½œç”¨ï¼Œåˆ™æ˜¯å”¤é†’å½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼›notify()æ˜¯å”¤é†’å•ä¸ªçº¿ç¨‹ï¼Œè€ŒnotifyAll()æ˜¯å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ã€‚ Objectç±»ä¸­å…³äºŽç­‰å¾…/å”¤é†’çš„APIè¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š &lt;font color=&quot;green&quot;&gt;notify()&lt;/font&gt; -- å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚ &lt;font color=&quot;green&quot;&gt;notifyAll()&lt;/font&gt; -- å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ &lt;font color=&quot;green&quot;&gt;wait()&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºŽâ€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ &lt;font color=&quot;green&quot;&gt;wait(long timeout)&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºŽâ€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ &lt;font color=&quot;green&quot;&gt;wait(long timeout, int nanos)&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºŽâ€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…å…¶ä»–æŸä¸ªçº¿ç¨‹ä¸­æ–­å½“å‰çº¿ç¨‹ï¼Œæˆ–è€…å·²è¶…è¿‡æŸä¸ªå®žé™…æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ wait()å’Œnotify()ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait()å’Œnotify()ä½¿ç”¨ç¤ºä¾‹ */public class WaitTest &#123; public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); synchronized (t1) &#123; try &#123; // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(Thread.currentThread().getName() + " start t1"); t1.start(); // ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " wait()"); t1.wait(); System.out.println(Thread.currentThread().getName() + " continue"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; synchronized (this) &#123; System.out.println(Thread.currentThread().getName() + " call notify()"); // å”¤é†’å½“å‰çš„waitçº¿ç¨‹ notify(); &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœ: &lt;/span&gt; 1234main start t1main wait()t1 call notify()main continue &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; å¦‚ä¸‹å›¾ï¼Œè¯´æ˜Žäº†â€œä¸»çº¿ç¨‹â€å’Œâ€œçº¿ç¨‹t1â€çš„æµç¨‹ã€‚ (01) æ³¨æ„ï¼Œå›¾ä¸­&quot;ä¸»çº¿ç¨‹&quot; ä»£è¡¨â€œä¸»çº¿ç¨‹mainâ€ã€‚&quot;çº¿ç¨‹t1&quot; ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„â€œçº¿ç¨‹t1â€ã€‚ è€Œâ€œé”â€ ä»£è¡¨â€œt1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ (02) â€œä¸»çº¿ç¨‹â€é€šè¿‡ new ThreadA(&quot;t1&quot;) æ–°å»ºâ€œçº¿ç¨‹t1â€ã€‚éšåŽé€šè¿‡synchronized(t1)èŽ·å–â€œt1å¯¹è±¡çš„åŒæ­¥é”â€ã€‚ç„¶åŽè°ƒç”¨t1.start()å¯åŠ¨â€œçº¿ç¨‹t1â€ã€‚ (03) â€œä¸»çº¿ç¨‹â€æ‰§è¡Œt1.wait() é‡Šæ”¾â€œt1å¯¹è±¡çš„é”â€å¹¶ä¸”è¿›å…¥â€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ã€‚ç­‰å¾…t1å¯¹è±¡ä¸Šçš„çº¿ç¨‹é€šè¿‡notify() æˆ– notifyAll()å°†å…¶å”¤é†’ã€‚ (04) â€œçº¿ç¨‹t1â€è¿è¡Œä¹‹åŽï¼Œé€šè¿‡synchronized(this)èŽ·å–â€œå½“å‰å¯¹è±¡çš„é”â€ï¼›æŽ¥ç€è°ƒç”¨notify()å”¤é†’â€œå½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹â€ï¼Œä¹Ÿå°±æ˜¯å”¤é†’â€œä¸»çº¿ç¨‹â€ã€‚ (05) â€œçº¿ç¨‹t1â€è¿è¡Œå®Œæ¯•ä¹‹åŽï¼Œé‡Šæ”¾â€œå½“å‰å¯¹è±¡çš„é”â€ã€‚ç´§æŽ¥ç€ï¼Œâ€œä¸»çº¿ç¨‹â€èŽ·å–â€œt1å¯¹è±¡çš„é”â€ï¼Œç„¶åŽæŽ¥ç€è¿è¡Œã€‚ å¯¹äºŽä¸Šé¢çš„ä»£ç ï¼š&lt;font color=&quot;red&quot;&gt;t1.wait()åº”è¯¥æ˜¯è®©â€œçº¿ç¨‹t1â€ç­‰å¾…ï¼›ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆå´æ˜¯è®©â€œä¸»çº¿ç¨‹mainâ€ç­‰å¾…äº†å‘¢ï¼Ÿ&lt;/font&gt; åœ¨è§£ç­”è¯¥é—®é¢˜å‰ï¼Œå…ˆçœ‹çœ‹jdkæ–‡æ¡£ä¸­å…³äºŽwaitçš„ä¸€æ®µä»‹ç»ï¼š &lt;p id=&quot;div-border-left-red&quot;&gt; Causes the current thread to wait until another thread invokes the notify() method or the notifyAll() method for this object. In other words, this method behaves exactly as if it simply performs the call wait(0). The current thread must own this object's monitor. The thread releases ownership of this monitor and waits until another thread notifies threads waiting on this object's monitor to wake up either through a call to the notify method or the notifyAll method. The thread then waits until it can re-obtain ownership of the monitor and resumes execution. &lt;/p&gt; ä¸­æ–‡æ„æ€å¤§æ¦‚æ˜¯ï¼š &lt;p id=&quot;div-border-left-green&quot;&gt; å¼•èµ·â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notify()æˆ–notifyAll()å”¤é†’è¯¥çº¿ç¨‹ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å’Œwait(0)çš„æ•ˆæžœä¸€æ ·ï¼(è¡¥å……ï¼Œå¯¹äºŽwait(long millis)æ–¹æ³•ï¼Œå½“millisä¸º0æ—¶ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…ï¼Œç›´åˆ°è¢«notify()æˆ–notifyAll()å”¤é†’)ã€‚ â€œå½“å‰çº¿ç¨‹â€åœ¨è°ƒç”¨wait()æ—¶ï¼Œå¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚è¯¥çº¿ç¨‹è°ƒç”¨wait()ä¹‹åŽï¼Œä¼šé‡Šæ”¾è¯¥é”ï¼›ç„¶åŽä¸€ç›´ç­‰å¾…ç›´åˆ°â€œå…¶å®ƒçº¿ç¨‹â€è°ƒç”¨å¯¹è±¡çš„åŒæ­¥é”çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚ç„¶åŽï¼Œè¯¥çº¿ç¨‹ç»§ç»­ç­‰å¾…ç›´åˆ°å®ƒé‡æ–°èŽ·å–â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ï¼Œç„¶åŽå°±å¯ä»¥æŽ¥ç€è¿è¡Œã€‚ &lt;/p&gt; &lt;span id=&quot;inline-purple&quot;&gt; æ³¨æ„ï¼šjdkçš„è§£é‡Šä¸­ï¼Œè¯´wait()çš„ä½œç”¨æ˜¯è®©â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œâ€œå½“å‰çº¿ç¨‹â€æ˜¯æŒ‡æ­£åœ¨cpuä¸Šè¿è¡Œçš„çº¿ç¨‹ï¼ &lt;/span&gt; è¿™ä¹Ÿæ„å‘³ç€ï¼Œè™½ç„¶t1.wait()æ˜¯é€šè¿‡â€œçº¿ç¨‹t1â€è°ƒç”¨çš„wait()æ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨t1.wait()çš„åœ°æ–¹æ˜¯åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­ã€‚è€Œä¸»çº¿ç¨‹å¿…é¡»æ˜¯â€œå½“å‰çº¿ç¨‹â€ï¼Œä¹Ÿå°±æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰§è¡Œt1.wait()ã€‚æ‰€ä»¥ï¼Œæ­¤æ—¶çš„â€œå½“å‰çº¿ç¨‹â€æ˜¯â€œä¸»çº¿ç¨‹mainâ€ï¼å› æ­¤ï¼Œt1.wait()æ˜¯è®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œä¸æ˜¯â€œçº¿ç¨‹t1â€ï¼ wait(long timeout)å’Œnotify() wait(long timeout)ä¼šè®©å½“å‰çº¿ç¨‹å¤„äºŽâ€œç­‰å¾…(é˜»å¡ž)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait(long timeout)å’Œnotify()çš„ä½¿ç”¨ç¤ºä¾‹ */public class WaitTimeoutTest &#123; public static void main(String[] args) &#123; ThreadB t1 = new ThreadB("t1"); synchronized (t1) &#123; try &#123; // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(Thread.currentThread().getName() + " start t1"); t1.start(); // ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ æˆ– notifyAll()å”¤é†’ï¼Œæˆ–è¶…è¿‡3000mså»¶æ—¶ï¼›ç„¶åŽæ‰è¢«å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " call wait "); t1.wait(3000); System.out.println(Thread.currentThread().getName() + " continue"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125;&#125;class ThreadB extends Thread &#123; public ThreadB(String name) &#123; super(name); &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + " run "); // æ­»å¾ªçŽ¯ï¼Œä¸æ–­è¿è¡Œã€‚ while (true) &#123; ; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234main start t1main call wait t1 run // å¤§çº¦3ç§’ä¹‹åŽ...è¾“å‡ºâ€œmain continueâ€main continue &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; å¦‚ä¸‹å›¾ï¼Œè¯´æ˜Žäº†â€œä¸»çº¿ç¨‹â€å’Œâ€œçº¿ç¨‹t1â€çš„æµç¨‹ã€‚ (01) æ³¨æ„ï¼Œå›¾ä¸­&quot;ä¸»çº¿ç¨‹&quot; ä»£è¡¨WaitTimeoutTestä¸»çº¿ç¨‹(å³ï¼Œçº¿ç¨‹main)ã€‚&quot;çº¿ç¨‹t1&quot; ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„çº¿ç¨‹t1ã€‚ è€Œâ€œé”â€ ä»£è¡¨â€œt1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ (02) ä¸»çº¿ç¨‹mainæ‰§è¡Œt1.start()å¯åŠ¨â€œçº¿ç¨‹t1â€ã€‚ (03) ä¸»çº¿ç¨‹mainæ‰§è¡Œt1.wait(3000)ï¼Œæ­¤æ—¶ï¼Œä¸»çº¿ç¨‹è¿›å…¥â€œé˜»å¡žçŠ¶æ€â€ã€‚éœ€è¦â€œç”¨äºŽt1å¯¹è±¡é”çš„çº¿ç¨‹é€šè¿‡notify() æˆ–è€… notifyAll()å°†å…¶å”¤é†’â€ æˆ–è€… â€œè¶…æ—¶3000msä¹‹åŽâ€ï¼Œä¸»çº¿ç¨‹mainæ‰è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œç„¶åŽæ‰å¯ä»¥è¿è¡Œã€‚ (04) â€œçº¿ç¨‹t1â€è¿è¡Œä¹‹åŽï¼Œè¿›å…¥äº†æ­»å¾ªçŽ¯ï¼Œä¸€ç›´ä¸æ–­çš„è¿è¡Œã€‚ (05) è¶…æ—¶3000msä¹‹åŽï¼Œä¸»çº¿ç¨‹mainä¼šè¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œç„¶åŽæŽ¥ç€è¿›å…¥â€œè¿è¡ŒçŠ¶æ€â€ã€‚ wait() å’Œ notifyAll() é€šè¿‡å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ notify() å¯ä»¥å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚ ä¸‹é¢ï¼Œé€šè¿‡ç¤ºä¾‹æ¼”ç¤ºnotifyAll()çš„ç”¨æ³•ï¼›å®ƒçš„ä½œç”¨æ˜¯å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait() å’Œ notifyAll()ä½¿ç”¨ç¤ºä¾‹ */public class NotifyAllTest &#123; private static Object obj = new Object(); public static void main(String[] args) &#123; ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); ThreadA t3 = new ThreadA("t3"); t1.start(); t2.start(); t3.start(); try &#123; System.out.println(Thread.currentThread().getName() + " sleep(3000)"); Thread.sleep(3000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; synchronized (obj) &#123; // ä¸»çº¿ç¨‹ç­‰å¾…å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " notifyAll()"); obj.notifyAll(); &#125; &#125; static class ThreadA extends Thread &#123; public ThreadA(String name) &#123; super(name); &#125; @Override public void run() &#123; synchronized (obj) &#123; try &#123; // æ‰“å°è¾“å‡ºç»“æžœ System.out.println(Thread.currentThread().getName() + " wait"); // å”¤é†’å½“å‰çš„waitçº¿ç¨‹ obj.wait(); // æ‰“å°è¾“å‡ºç»“æžœ System.out.println(Thread.currentThread().getName() + " continue"); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678t1 waitmain sleep(3000)t3 waitt2 waitmain notifyAll()t2 continuet3 continuet1 continue &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; (01) ä¸»çº¿ç¨‹ä¸­æ–°å»ºå¹¶ä¸”å¯åŠ¨äº†3ä¸ªçº¿ç¨‹&quot;t1&quot;, &quot;t2&quot;å’Œ&quot;t3&quot;ã€‚ (02) ä¸»çº¿ç¨‹é€šè¿‡sleep(3000)ä¼‘çœ 3ç§’ã€‚åœ¨ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾&quot;t1&quot;, &quot;t2&quot;å’Œ&quot;t3&quot;è¿™3ä¸ªçº¿ç¨‹éƒ½è¿è¡Œäº†ã€‚ä»¥&quot;t1&quot;ä¸ºä¾‹ï¼Œå½“å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæ‰§è¡Œobj.wait()ç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡notify()æˆ–é¢nofityAll()æ¥å”¤é†’å®ƒï¼›ç›¸åŒçš„é“ç†ï¼Œ&quot;t2&quot;å’Œ&quot;t3&quot;ä¹Ÿä¼šç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡nofity()æˆ–nofityAll()æ¥å”¤é†’å®ƒä»¬ã€‚ (03) ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’ä¹‹åŽï¼ŒæŽ¥ç€è¿è¡Œã€‚æ‰§è¡Œ obj.notifyAll() å”¤é†’objä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼Œå³å”¤é†’&quot;t1&quot;, &quot;t2&quot;å’Œ&quot;t3&quot;è¿™3ä¸ªçº¿ç¨‹ã€‚ ç´§æŽ¥ç€ï¼Œä¸»çº¿ç¨‹çš„synchronized(obj)è¿è¡Œå®Œæ¯•ä¹‹åŽï¼Œä¸»çº¿ç¨‹é‡Šæ”¾â€œobjé”â€ã€‚è¿™æ ·ï¼Œ&quot;t1&quot;, &quot;t2&quot;å’Œ&quot;t3&quot;å°±å¯ä»¥èŽ·å–â€œobjé”â€è€Œç»§ç»­è¿è¡Œäº†ï¼ ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectä¸­ï¼Œè€Œä¸æ˜¯Threadä¸­ Objectä¸­çš„wait(), notify()ç­‰å‡½æ•°ï¼Œå’Œsynchronizedä¸€æ ·ï¼Œä¼šå¯¹â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è¡Œæ“ä½œã€‚ wait()ä¼šä½¿â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œå› ä¸ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ‰€ä»¥çº¿ç¨‹åº”è¯¥é‡Šæ”¾å®ƒé”æŒæœ‰çš„â€œåŒæ­¥é”â€ï¼Œå¦åˆ™å…¶å®ƒçº¿ç¨‹èŽ·å–ä¸åˆ°è¯¥â€œåŒæ­¥é”â€è€Œæ— æ³•è¿è¡Œï¼ çº¿ç¨‹è°ƒç”¨wait()ä¹‹åŽï¼Œä¼šé‡Šæ”¾å®ƒé”æŒæœ‰çš„â€œåŒæ­¥é”â€ï¼›è€Œä¸”ï¼Œç­‰å¾…çº¿ç¨‹å¯ä»¥è¢«notify()æˆ–notifyAll()å”¤é†’ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šnotify()æ˜¯ä¾æ®ä»€ä¹ˆå”¤é†’ç­‰å¾…çº¿ç¨‹çš„ï¼Ÿæˆ–è€…è¯´ï¼Œwait()ç­‰å¾…çº¿ç¨‹å’Œnotify()ä¹‹é—´æ˜¯é€šè¿‡ä»€ä¹ˆå…³è”èµ·æ¥çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¾æ®â€œå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ è´Ÿè´£å”¤é†’ç­‰å¾…çº¿ç¨‹çš„é‚£ä¸ªçº¿ç¨‹(ç§°ä¸ºâ€œå”¤é†’çº¿ç¨‹â€)ï¼Œå®ƒåªæœ‰åœ¨èŽ·å–â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€(è¿™é‡Œçš„åŒæ­¥é”å¿…é¡»å’Œç­‰å¾…çº¿ç¨‹çš„åŒæ­¥é”æ˜¯åŒä¸€ä¸ª)ï¼Œå¹¶ä¸”è°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•ä¹‹åŽï¼Œæ‰èƒ½å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚è™½ç„¶ï¼Œç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ï¼›ä½†æ˜¯ï¼Œå®ƒä¸èƒ½ç«‹åˆ»æ‰§è¡Œï¼Œå› ä¸ºå”¤é†’çº¿ç¨‹è¿˜æŒæœ‰â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ã€‚å¿…é¡»ç­‰åˆ°å”¤é†’çº¿ç¨‹é‡Šæ”¾äº†â€œå¯¹è±¡çš„åŒæ­¥é”â€ä¹‹åŽï¼Œç­‰å¾…çº¿ç¨‹æ‰èƒ½èŽ·å–åˆ°â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è€Œç»§ç»­è¿è¡Œã€‚ æ€»ä¹‹ï¼Œnotify(), wait()ä¾èµ–äºŽâ€œåŒæ­¥é”â€ï¼Œè€Œâ€œåŒæ­¥é”â€æ˜¯å¯¹è±¡é”æŒæœ‰ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectç±»ï¼Œè€Œä¸æ˜¯Threadç±»ä¸­çš„åŽŸå› ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - è€å¿ƒæŽ’åº]]></title>
    <url>%2Fposts%2Fde5a6680.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ è€å¿ƒæŽ’åºå……åˆ†é›†åˆäº†æ¡¶æŽ’åºå’Œæ’å…¥æŽ’åºçš„ä¼˜ç‚¹ï¼Œé¦–å…ˆä½¿ç”¨æ¡¶æŽ’åºï¼ŒæŽ’åºä¹‹åŽæ¯ä¸ªæ¡¶ä¸­æ•°æ®ç›¸å¯¹æœ‰åºï¼Œè¿™æ ·å†ä½¿ç”¨æ’å…¥æŽ’åºï¼Œç®€åŒ–äº†é—®é¢˜ï¼Œé€Ÿåº¦å˜çš„æ›´å¿«ã€‚ å»ºæ¡¶è§„åˆ™:å¦‚æžœæ²¡æœ‰æ¡¶,æ–°å»ºä¸€ä¸ªæ¡¶;å¦‚æžœä¸ç¬¦åˆå…¥æ¡¶è§„åˆ™é‚£ä¹ˆæ–°å»ºä¸€ä¸ªæ¡¶ã€‚ å…¥æ¡¶è§„åˆ™:åªè¦æ¯”æ¡¶é‡Œæœ€ä¸Šè¾¹çš„æ•°å­—å°å³å¯å…¥æ¡¶,å¦‚æžœæœ‰å¤šä¸ªæ¡¶å¯å…¥,é‚£ä¹ˆæŒ‰ç…§ä»Žå·¦åˆ°å³çš„é¡ºåºå…¥æ¡¶å³å¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æŽ’åºæ•°ç»„[6 4 5 1 8 7 2 3] ç¬¬ä¸€æ­¥ï¼šå› ä¸ºæ­¤å‰è¿˜æ²¡æœ‰æ¡¶ï¼Œåˆ™å»ºç«‹ä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬å‘½åä¸ºæ¡¶1,ä»Žä¸Šé¢å–å‡ºç¬¬ä¸€ä¸ªæ•°å­— 6ï¼Œç„¶åŽå°†6æ”¾å…¥åˆ°æ¡¶ä¸­ã€‚ ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªå€¼4ï¼Œç„¶åŽéåŽ†çŽ°æœ‰çš„æ¡¶ï¼ŒéåŽ†çš„å·¥ç¨‹ä¸­å…ˆé‡åˆ°æ¡¶1ï¼Œæˆ‘ä»¬å‘çŽ°æ¡¶1ä¸­æœ€ä¸Šé¢çš„å…ƒç´ æ˜¯6,4æ¯”6å¤§ï¼Œåˆ™6ä¸‹æ²‰ï¼Œæœ‰æ¡¶ã€4,6ã€‘ã€‚ ç¬¬ä¸‰æ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰ä¸ªå€¼5ï¼Œç„¶åŽéåŽ†çŽ°æœ‰çš„æ¡¶ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯4ï¼Œæ¯”5å°ï¼Œæ‰€ä»¥é‡æ–°å¼€ä¸€ä¸ªæ¡¶ã€5ã€‘ï¼Œä¹‹åŽå…±æœ‰ä¸¤ä¸ªæ¡¶ã€4,5ã€‘ã€5ã€‘ã€‚ ç¬¬å››éƒ¨ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬å››ä¸ªå€¼1ï¼Œç„¶åŽéåŽ†çŽ°æœ‰çš„æ¡¶ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯4ï¼Œæ¯”1å¤§ï¼Œæ‰€ä»¥æ”¾åˆ°æ¡¶1ã€4,6ã€‘æœ€å‰é¢ï¼Œä»Žè€Œå½¢æˆã€1,4,6ã€‘ã€5ã€‘ã€‚ ç¬¬äº”æ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬äº”ä¸ªå…ƒç´ ï¼Œç„¶åŽéåŽ†çŽ°æœ‰çš„æ¡¶ï¼Œç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯1ï¼Œç¬¬äºŒä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯5ï¼Œéƒ½æ¯”8å°ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å¼€ä¸€ä¸ªæ¡¶ã€8ã€‘ï¼Œæ­¤æ—¶å…±æœ‰æ¡¶ã€1,4,6ã€‘ã€5ã€‘ã€8ã€‘ã€‚ ç¬¬å…­æ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åŽæ¡¶æ˜¯ã€1,4,6ã€‘ã€5ã€‘ã€7ï¼Œ8ã€‘ã€‚ ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åŽæ¡¶æ˜¯ã€1,4,6ã€‘ã€2ï¼Œ5ã€‘ã€7ï¼Œ8ã€‘ã€‚ ç¬¬å…«æ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åŽæ¡¶æ˜¯ã€1,4,6ã€‘ã€2ï¼Œ5ã€‘ã€3ï¼Œ7ï¼Œ8ã€‘ã€‚ æ³¨æ„ï¼šéåŽ†çš„æ•°ç»„ï¼Œåªè·Ÿå„ä¸ªæ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ åšæ¯”è¾ƒï¼Œè¿™æ ·ä¿è¯å„ä¸ªæ¡¶å…ƒç´ æœ‰åºã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: è€å¿ƒæŽ’åº */public class PatienceSort &#123; public static int[] patienceSort(int[] unsorted) &#123; List new_list = new ArrayList(); for (int i = 0; i &lt; unsorted.length; i++) &#123; List bucket_list = new ArrayList(); if (i == 0) &#123; bucket_list.add(unsorted[i]); new_list.add(bucket_list); &#125; else &#123; boolean is_ok = false; for (int j = 0; j &lt; new_list.size(); j++) &#123; if (unsorted[i] &lt; (int) ((List) new_list.get(j)).get(0)) &#123; ((List) new_list.get(j)).add(0, unsorted[i]); is_ok = true; break; &#125; &#125; if (!is_ok) &#123; bucket_list.add(unsorted[i]); new_list.add(bucket_list); &#125; &#125; &#125; //å¤šç»´æ•°ç»„å˜æˆå•ç»´æ•°ç»„ int[] ok_list = new int[unsorted.length]; int q = 0; for (int m = 0; m &lt; new_list.size(); m++) &#123; for (int n = 0; n &lt; ((List) new_list.get(m)).size(); n++) &#123; ok_list[q] = (int) ((List) new_list.get(m)).get(n); q++; &#125; &#125; //æ’å…¥å¾ªçŽ¯ //å°†æ•°ç»„çš„é•¿åº¦èµ‹ç»™næ˜¯ä¸ºäº†é˜²æ­¢æ¯æ¬¡forå¾ªçŽ¯ä¸­åˆ¤æ–­æ—¶éƒ½è°ƒç”¨lengthæ–¹æ³•å½±å“æ€§èƒ½ int n = ok_list.length; //ç”¨äºŽä¸­è½¬æ•°æ® int tmp; int j; //æŽ’åºçš„æ¬¡æ•° for (int i = 1; i &lt; n; i++) &#123; tmp = ok_list[i]; //å–iå‰é¢çš„æ‰€æœ‰è·Ÿiä½ç½®å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå…ˆæ¯”è¾ƒi-1å’Œiï¼Œå¦‚æžœi-1å¤§äºŽiï¼Œåˆ™äº’æ¢ä½ç½®ï¼Œi-1å’Œi-2æ¯”è¾ƒï¼Œä»¥æ­¤ç±»æŽ¨ for (j = i - 1; j &gt;= 0 &amp;&amp; ok_list[j] &gt; tmp; j--) &#123; ok_list[j + 1] = ok_list[j]; &#125; ok_list[j + 1] = tmp; &#125; return ok_list; &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;6, 4, 5, 1, 8, 7, 2, 3&#125;; System.out.println("**************è€å¿ƒæŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); int[] sorted = patienceSort(unsorted); CommonUtils.display(sorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - è®¡æ•°æŽ’åº]]></title>
    <url>%2Fposts%2F4531d6c3.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ è®¡æ•°æŽ’åºæ˜¯ä¸€ç§éžåŸºäºŽæ¯”è¾ƒçš„æŽ’åºç®—æ³•ï¼Œå…¶ç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n+k)ï¼Œå…¶ä¸­kæ˜¯æ•´æ•°çš„èŒƒå›´ã€‚åŸºäºŽæ¯”è¾ƒçš„æŽ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦æœ€å°æ˜¯O(nlogn)çš„ã€‚è¯¥ç®—æ³•äºŽ1954å¹´ç”± Harold H. Seward æå‡ºã€‚ è®¡æ•°æŽ’åºçš„æ ¸å¿ƒåœ¨äºŽå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æŽ’åºï¼Œè®¡æ•°æŽ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚ ç®—æ³•æ­¥éª¤ èŠ±O(n)çš„æ—¶é—´æ‰«æä¸€ä¸‹æ•´ä¸ªåºåˆ— Aï¼ŒèŽ·å–æœ€å°å€¼ min å’Œæœ€å¤§å€¼ maxã€‚ å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´åˆ›å»ºæ–°çš„æ•°ç»„ Bï¼Œé•¿åº¦ä¸º ( max - min + 1)ã€‚ æ•°ç»„ B ä¸­ index çš„å…ƒç´ è®°å½•çš„å€¼æ˜¯ A ä¸­æŸå…ƒç´ å‡ºçŽ°çš„æ¬¡æ•°ã€‚ æœ€åŽè¾“å‡ºç›®æ ‡æ•´æ•°åºåˆ—ï¼Œå…·ä½“çš„é€»è¾‘æ˜¯éåŽ†æ•°ç»„ Bï¼Œè¾“å‡ºç›¸åº”å…ƒç´ ä»¥åŠå¯¹åº”çš„ä¸ªæ•°ã€‚ ç®—æ³•æ¼”ç¤º ç®—æ³•æ¼”ç¤ºè¯´æ˜Ž é¦–å…ˆï¼Œæ‰«æä¸€ä¸‹æ•´ä¸ªåºåˆ—ã€‚ èŽ·å¾—æœ€å°å€¼ä¸º 2 ï¼Œæœ€å¤§å€¼ä¸º 7ã€‚ æ–°å»ºæ•°ç»„åŒ…å« 2~7 çš„å…ƒç´ ã€‚ å†æ¬¡æ‰«æåºåˆ—ï¼Œå°†åºåˆ—çš„å€¼æ”¾ç½®åœ¨æ–°å»ºæ•°ç»„ä¸­ã€‚ æ‰«ææ•°å­— 5ï¼Œæ•°ç»„ä¸­ index ä¸º 3 çš„å€¼ä¸º 5ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 3ï¼Œæ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 4ï¼Œæ•°ç»„ä¸­ index ä¸º 2 çš„å€¼ä¸º 4ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 7ï¼Œæ•°ç»„ä¸­ index ä¸º 5 çš„å€¼ä¸º 7ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 2ï¼Œæ•°ç»„ä¸­ index ä¸º 0 çš„å€¼ä¸º 2ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 4ï¼Œæ•°ç»„ä¸­ index ä¸º 2 çš„å€¼ä¸º 4ï¼Œæ¬¡æ•°ä¸º 2ã€‚ æ‰«ææ•°å­— 3ï¼Œæ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3ï¼Œæ¬¡æ•°ä¸º 2ã€‚ æŒ‰ç…§è¿™ç§èŠ‚å¥ï¼Œæ‰«æç»“æŸåŽï¼Œæ–°å»ºæ•°ç»„ä¸­å­˜æ”¾äº†æ•´ä¸ªåºåˆ—ä»¥åŠæ¯ä¸ªæ•°å­—å‡ºçŽ°çš„æ¬¡æ•°ã€‚ æœ€åŽè¾“å‡ºç›®æ ‡æ•´æ•°åºåˆ—ã€‚ è¾“å‡ºæ•°å­— 2ï¼ŒåŒæ—¶æ•°ç»„ä¸­ index ä¸º 0 çš„å€¼ä¸º 2 çš„å…ƒç´ æ¬¡æ•°å˜ä¸º 0ã€‚ è¾“å‡ºæ•°å­— 3ï¼ŒåŒæ—¶æ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3 çš„å…ƒç´ æ¬¡æ•°å˜ä¸º 1ã€‚ åŒæ ·çš„æ“ä½œï¼Œæ•´ä¸ªåºåˆ—å°±å®Œå…¨è¾“å‡ºäº†ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;import java.util.Arrays;/** * @author: whb * @description: è®¡æ•°æŽ’åº */public class CountingSort &#123; public static int[] countingSort(int[] unsorted) &#123; //å¼€å§‹å£°æ˜Žæ¡¶,æ‰¾åˆ°æ•°ç»„çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ int minNum = unsorted[0]; int maxNum = unsorted[0]; for (int i = 0; i &lt; unsorted.length; i++) &#123; if (unsorted[i] &lt; minNum) &#123; minNum = unsorted[i]; &#125; if (unsorted[i] &gt; maxNum) &#123; maxNum = unsorted[i]; &#125; &#125; System.out.println("æœ€å°æ•°å­—ä¸º:" + minNum); System.out.println("æœ€å¤§æ•°å­—ä½:" + maxNum); //æ‰¾åˆ°æœ€å¤§æœ€å°å€¼çš„ä¹‹åŽ,å°±å¼€å§‹å£°æ˜Žæœ‰åºæ¡¶,æ¡¶çš„åˆå§‹ä½ä»£è¡¨çš„å€¼ä¸ºminNumæœ€å¤§å€¼ä¸ºmaxNum //æ•°ç»„çš„é•¿åº¦ä¸º(maxNum-minNum+1) int[] bucket = new int[(maxNum - minNum + 1)]; //å£°æ˜Žäº†æœ‰åºæ¡¶ä¹‹åŽ,å¼€å§‹å¯¹æ•°å­—è¿›è¡Œæ”¾æ¡¶æ“ä½œ for (int j = 0; j &lt; unsorted.length; j++) &#123; //å› ä¸ºæ˜¯æ‰¾åˆ°äº†å¾…æŽ’åºæ•°ç»„çš„æœ€å°å€¼minNum,æ‰€ä»¥,ä¸Žæ•°ç»„æ•°ç»„æ¯”è¾ƒçš„å€¼åº”ä¸º(j+minNum) //å¦‚æžœéåŽ†çš„å€¼å¤§å°ä¸Žæ•°ç»„ä»£è¡¨çš„æ•°å­—å¤§å°ç›¸ç­‰,åˆ™æ”¾å…¥ //jæ¬¡å¾ªçŽ¯å¾—åˆ°çš„æ•°å­—æ˜¯tempArray[j],åˆ™å­˜å‚¨åˆ°ä¸‹æ ‡ä¸ºtempArray[j]+minNumçš„æ¡¶ä¸­ bucket[unsorted[j] - minNum] = bucket[unsorted[j] - minNum] + 1; &#125; //å°†å¾—åˆ°çš„æ¡¶æŽ’åºç»“æžœè¿›è¡Œè¾“å‡º,è¾“å‡ºçš„æ˜¯æ¡¶æŽ’åºçš„æ•°ç»„çš„ä¸‹æ ‡ //å¯ä»¥å£°æ˜Žæ–°æ•°ç»„å¯¹è¯¥åºåˆ—è¿›è¡Œå­˜å‚¨ int[] sorted = new int[unsorted.length]; int count = 0; for (int k = 0; k &lt; bucket.length; k++) &#123; if (bucket[k] != 0) &#123; //æ¡¶é‡Œè£…çš„å€¼å¯èƒ½ä¸æ˜¯1,æ‰€ä»¥,åœ¨ä¸ç­‰äºŽä¸€çš„æ—¶å€™,å¯¹æ¡¶é‡Œé¢çš„æ•°å­—è¿›è¡ŒéåŽ†å­˜å‚¨ if (bucket[k] != 1) &#123; for (int z = 0; z &lt; bucket[k]; z++) &#123; sorted[count] = k + minNum; count++; &#125; &#125; else &#123; sorted[count] = k + minNum; count++; &#125; &#125; &#125; return sorted; &#125; public static void main(String[] args) &#123; //äº§ç”Ÿéšæœºå¾…æŽ’åºåˆ— int[] unsorted = new int[(int) (Math.random() * 11) + 5]; for (int i = 0; i &lt; unsorted.length; i++) &#123; unsorted[i] = (int) (Math.random() * 100); &#125; System.out.println("**************è®¡æ•°æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); int[] sorted = countingSort(unsorted); CommonUtils.display(sorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - é¸½å·¢æŽ’åº]]></title>
    <url>%2Fposts%2Fd7da214b.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ é¸½å·¢æŽ’åºæ˜¯æ¡¶æŽ’åºçš„ä¸€ç§ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€æŽ’é¸½å·¢ï¼Œçœ‹é‡Œé¢æœ‰å‡ ä¸ªé¸½å·¢ï¼Œç„¶åŽéåŽ†è¿™äº›é¸½å·¢ï¼Œæ‰“å°å‡ºæ¥å°±å¥½ï¼ŒæŽ’åºä¹‹å‰å¾—å…ˆçŸ¥é“åŒºé—´å’Œæœ€å¤§å€¼ã€‚ æ¯”å¦‚æœ‰æ•°ç»„a = [2,7,5,9,8,8]ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡ŒæŽ’åºï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€å¤§å€¼ä¸è¶…è¿‡10çš„æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šåŒºé—´ä¸º0-10ï¼Œå®šä¹‰ä¸€ä¸ªä¸‹æ ‡0-10è¿™æ ·ä¸€ä¸ª11ä½æ•°ç»„b,åˆå§‹åŒ–å€¼ä¸º0ã€‚ç„¶åŽéåŽ†å·²çŸ¥æ•°ç»„aï¼Œé€šè¿‡açš„ä¸€é¡¹ä¸€é¡¹çš„å€¼å’Œæˆ‘ä»¬å®šä¹‰çš„æ•°ç»„bçš„ä¸‹æ ‡è¿›è¡Œå¯¹åº”ã€‚ éåŽ†å¼€å§‹ï¼š å–a[0]=2ï¼Œç„¶åŽæ“ä½œb[2]=1 å–a[1]=7ï¼Œç„¶åŽæ“ä½œb[7]=1 å–a[2]=5ï¼Œç„¶åŽæ“ä½œb[5]=1 å–a[3]=9ï¼Œç„¶åŽæ“ä½œb[9]=1 å–a[4]=8ï¼Œç„¶åŽæ“ä½œb[8]=1 å–a[5]=8ï¼Œç„¶åŽæ“ä½œb[8]=2ï¼ˆæ³¨æ„äº†å“¦ï¼‰ è¿™æ ·å°±å¯¹å·å…¥åº§äº†ï¼Œä¹‹åŽéåŽ†bï¼Œå¦‚æžœbä¸­æŸä¸ªå°æ ‡å¯¹åº”çš„å€¼æ˜¯å¤šä¸ªï¼Œåˆ™éåŽ†å¤šæ¬¡ï¼ŒæŠŠä¸æ˜¯0çš„ç»™æ‰“å°å‡ºæ¥ï¼Œç»“æžœå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„äº† ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é¸½å·¢æŽ’åº * åŽŸç†ç±»ä¼¼æ¡¶æŽ’åº,åŒæ ·éœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„é¸½å·¢[æ¡¶æŽ’åºé‡Œç®¡è¿™ä¸ªå«æ¡¶,åå­—æ— æ‰€è°“] * é¸½å·¢å…¶å®žå°±æ˜¯æ•°ç»„,æ•°ç»„çš„ç´¢å¼•ä½ç½®å°±è¡¨ç¤ºå€¼,è¯¥ç´¢å¼•ä½ç½®çš„å€¼è¡¨ç¤ºå‡ºçŽ°æ¬¡æ•°,å¦‚æžœå…¨éƒ¨ä¸º1æ¬¡æˆ–0æ¬¡é‚£å°±æ˜¯æ¡¶æŽ’åº * ä¾‹å¦‚ * int[] pigeonHole = new int[100]; * pigeonHole[0]çš„å€¼è¡¨ç¤º0çš„å‡ºçŽ°æ¬¡æ•°... * pigeonHole[1]çš„å€¼è¡¨ç¤º1çš„å‡ºçŽ°æ¬¡æ•°... * pigeonHole[2]çš„å€¼è¡¨ç¤º2çš„å‡ºçŽ°æ¬¡æ•°... */public class PigeonholeSort &#123; /** * é¸½å·¢æŽ’åº * * @param unsorted å¾…æŽ’åºåˆ— * @param maxNumber æœ€å¤§æ•° * @return */ public static int[] pigeonholeSort(int[] unsorted, int maxNumber) &#123; int[] pogeonHole = new int[maxNumber + 1]; for (int item : unsorted) &#123; pogeonHole[item]++; &#125; return pogeonHole; &#125; public static void main(String[] args) &#123; int[] unsorted = &#123;99, 65, 24, 47, 47, 50, 99, 88, 66, 33, 66, 67, 31, 18, 24&#125;; System.out.println("**************é¸½å·¢æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); int[] sorted = pigeonholeSort(unsorted, 99); System.out.println("æŽ’åºåŽï¼š"); for (int i = 0; i &lt; sorted.length; i++) &#123; for (int j = 0; j &lt; sorted[i]; j++) &#123; System.out.print(i + " "); &#125; &#125; &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - åŸºæ•°æŽ’åº]]></title>
    <url>%2Fposts%2Fed3439ee.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åŸºæ•°æŽ’åºè¿‡ç¨‹æ— é¡»æ¯”è¾ƒå…³é”®å­—ï¼Œè€Œæ˜¯é€šè¿‡â€œåˆ†é…â€å’Œâ€œæ”¶é›†â€è¿‡ç¨‹æ¥å®žçŽ°æŽ’åºã€‚å®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯è¾¾åˆ°çº¿æ€§é˜¶ï¼šO(n)ã€‚ å®žä¾‹ æ‰‘å…‹ç‰Œä¸­52å¼ ç‰Œï¼Œå¯æŒ‰èŠ±è‰²å’Œé¢å€¼åˆ†æˆä¸¤ä¸ªå­—æ®µï¼Œå…¶å¤§å°å…³ç³»ä¸ºï¼š èŠ±è‰²ï¼š æ¢…èŠ±&lt; æ–¹å—&lt; çº¢å¿ƒ&lt; é»‘å¿ƒ é¢å€¼ï¼š 2 &lt; 3 &lt; 4 &lt; 5 &lt; 6 &lt; 7 &lt; 8 &lt; 9 &lt; 10 &lt; J &lt; Q &lt; K &lt; A è‹¥å¯¹æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼è¿›è¡Œå‡åºæŽ’åºï¼Œå¾—åˆ°å¦‚ä¸‹åºåˆ—ï¼š å³ä¸¤å¼ ç‰Œï¼Œè‹¥èŠ±è‰²ä¸åŒï¼Œä¸è®ºé¢å€¼æ€Žæ ·ï¼ŒèŠ±è‰²ä½Žçš„é‚£å¼ ç‰Œå°äºŽèŠ±è‰²é«˜çš„ï¼Œåªæœ‰åœ¨åŒèŠ±è‰²æƒ…å†µä¸‹ï¼Œå¤§å°å…³ç³»æ‰ç”±é¢å€¼çš„å¤§å°ç¡®å®šã€‚è¿™å°±æ˜¯å¤šå…³é”®ç æŽ’åºã€‚ ä¸ºå¾—åˆ°æŽ’åºç»“æžœï¼Œæˆ‘ä»¬è®¨è®ºä¸¤ç§æŽ’åºæ–¹æ³•ã€‚ æ–¹æ³•1ï¼šå…ˆå¯¹èŠ±è‰²æŽ’åºï¼Œå°†å…¶åˆ†ä¸º4 ä¸ªç»„ï¼Œå³æ¢…èŠ±ç»„ã€æ–¹å—ç»„ã€çº¢å¿ƒç»„ã€é»‘å¿ƒç»„ã€‚å†å¯¹æ¯ä¸ªç»„åˆ†åˆ«æŒ‰é¢å€¼è¿›è¡ŒæŽ’åºï¼Œæœ€åŽï¼Œå°†4 ä¸ªç»„è¿žæŽ¥èµ·æ¥å³å¯ã€‚ æ–¹æ³•2ï¼šå…ˆæŒ‰13 ä¸ªé¢å€¼ç»™å‡º13 ä¸ªç¼–å·ç»„(2 å·ï¼Œ3 å·ï¼Œ...ï¼ŒA å·)ï¼Œå°†ç‰ŒæŒ‰é¢å€¼ä¾æ¬¡æ”¾å…¥å¯¹åº”çš„ç¼–å·ç»„ï¼Œåˆ†æˆ13 å †ã€‚å†æŒ‰èŠ±è‰²ç»™å‡º4 ä¸ªç¼–å·ç»„(æ¢…èŠ±ã€æ–¹å—ã€çº¢å¿ƒã€é»‘å¿ƒ)ï¼Œå°†2å·ç»„ä¸­ç‰Œå–å‡ºåˆ†åˆ«æ”¾å…¥å¯¹åº”èŠ±è‰²ç»„ï¼Œå†å°†3 å·ç»„ä¸­ç‰Œå–å‡ºåˆ†åˆ«æ”¾å…¥å¯¹åº”èŠ±è‰²ç»„ï¼Œâ€¦â€¦ï¼Œè¿™æ ·ï¼Œ4 ä¸ªèŠ±è‰²ç»„ä¸­å‡æŒ‰é¢å€¼æœ‰åºï¼Œç„¶åŽï¼Œå°†4 ä¸ªèŠ±è‰²ç»„ä¾æ¬¡è¿žæŽ¥èµ·æ¥å³å¯ã€‚ è®¾n ä¸ªå…ƒç´ çš„å¾…æŽ’åºåˆ—åŒ…å«d ä¸ªå…³é”®ç {k1ï¼Œk2ï¼Œâ€¦ï¼Œkd}ï¼Œåˆ™ç§°åºåˆ—å¯¹å…³é”®ç {k1ï¼Œk2ï¼Œâ€¦ï¼Œkd}æœ‰åºæ˜¯æŒ‡ï¼šå¯¹äºŽåºåˆ—ä¸­ä»»ä¸¤ä¸ªè®°å½•r[i]å’Œrjéƒ½æ»¡è¶³ä¸‹åˆ—æœ‰åºå…³ç³»ï¼š å…¶ä¸­k1 ç§°ä¸ºæœ€ä¸»ä½å…³é”®ç ï¼Œkd ç§°ä¸ºæœ€æ¬¡ä½å…³é”®ç ã€‚ ä¸¤ç§å¤šå…³é”®ç æŽ’åºæ–¹æ³• å¤šå…³é”®ç æŽ’åºæŒ‰ç…§ä»Žæœ€ä¸»ä½å…³é”®ç åˆ°æœ€æ¬¡ä½å…³é”®ç æˆ–ä»Žæœ€æ¬¡ä½åˆ°æœ€ä¸»ä½å…³é”®ç çš„é¡ºåºé€æ¬¡æŽ’åºï¼Œåˆ†ä¸¤ç§æ–¹æ³•ï¼š æœ€é«˜ä½ä¼˜å…ˆ(Most Significant Digit first)æ³•ï¼Œç®€ç§°MSD æ³•ï¼š 1ï¼‰å…ˆæŒ‰k1 æŽ’åºåˆ†ç»„ï¼Œå°†åºåˆ—åˆ†æˆè‹¥å¹²å­åºåˆ—ï¼ŒåŒä¸€ç»„åºåˆ—çš„è®°å½•ä¸­ï¼Œå…³é”®ç k1 ç›¸ç­‰ã€‚ 2ï¼‰å†å¯¹å„ç»„æŒ‰k2 æŽ’åºåˆ†æˆå­ç»„ï¼Œä¹‹åŽï¼Œå¯¹åŽé¢çš„å…³é”®ç ç»§ç»­è¿™æ ·çš„æŽ’åºåˆ†ç»„ï¼Œç›´åˆ°æŒ‰æœ€æ¬¡ä½å…³é”®ç kd å¯¹å„å­ç»„æŽ’åºåŽã€‚ 3ï¼‰å†å°†å„ç»„è¿žæŽ¥èµ·æ¥ï¼Œä¾¿å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼æŽ’åºä¸­ä»‹ç»çš„æ–¹æ³•ä¸€å³æ˜¯MSD æ³•ã€‚ æœ€ä½Žä½ä¼˜å…ˆ(Least Significant Digit first)æ³•ï¼Œç®€ç§°LSD æ³•ï¼š å…ˆä»Žkd å¼€å§‹æŽ’åºï¼Œå†å¯¹kd-1è¿›è¡ŒæŽ’åºï¼Œä¾æ¬¡é‡å¤ï¼Œç›´åˆ°æŒ‰k1æŽ’åºåˆ†ç»„åˆ†æˆæœ€å°çš„å­åºåˆ—åŽã€‚ æœ€åŽå°†å„ä¸ªå­åºåˆ—è¿žæŽ¥èµ·æ¥ï¼Œä¾¿å¯å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—, æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼æŽ’åºä¸­ä»‹ç»çš„æ–¹æ³•äºŒå³æ˜¯LSD æ³•ã€‚ åŸºäºŽLSDæ–¹æ³•çš„é“¾å¼åŸºæ•°æŽ’åºçš„åŸºæœ¬æ€æƒ³ â€œå¤šå…³é”®å­—æŽ’åºâ€çš„æ€æƒ³å®žçŽ°â€œå•å…³é”®å­—æŽ’åºâ€ã€‚å¯¹æ•°å­—åž‹æˆ–å­—ç¬¦åž‹çš„å•å…³é”®å­—ï¼Œå¯ä»¥çœ‹ä½œç”±å¤šä¸ªæ•°ä½æˆ–å¤šä¸ªå­—ç¬¦æž„æˆçš„å¤šå…³é”®å­—ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨â€œåˆ†é…-æ”¶é›†â€çš„æ–¹æ³•è¿›è¡ŒæŽ’åºï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä½œåŸºæ•°æŽ’åºæ³•ï¼Œå…¶ä¸­æ¯ä¸ªæ•°å­—æˆ–å­—ç¬¦å¯èƒ½çš„å–å€¼ä¸ªæ•°ç§°ä¸ºåŸºæ•°ã€‚æ¯”å¦‚ï¼Œæ‰‘å…‹ç‰Œçš„èŠ±è‰²åŸºæ•°ä¸º4ï¼Œé¢å€¼åŸºæ•°ä¸º13ã€‚åœ¨æ•´ç†æ‰‘å…‹ç‰Œæ—¶ï¼Œæ—¢å¯ä»¥å…ˆæŒ‰èŠ±è‰²æ•´ç†ï¼Œä¹Ÿå¯ä»¥å…ˆæŒ‰é¢å€¼æ•´ç†ã€‚æŒ‰èŠ±è‰²æ•´ç†æ—¶ï¼Œå…ˆæŒ‰çº¢ã€é»‘ã€æ–¹ã€èŠ±çš„é¡ºåºåˆ†æˆ4æ‘žï¼ˆåˆ†é…ï¼‰ï¼Œå†æŒ‰æ­¤é¡ºåºå†å æ”¾åœ¨ä¸€èµ·ï¼ˆæ”¶é›†ï¼‰ï¼Œç„¶åŽæŒ‰é¢å€¼çš„é¡ºåºåˆ†æˆ13æ‘žï¼ˆåˆ†é…ï¼‰ï¼Œå†æŒ‰æ­¤é¡ºåºå æ”¾åœ¨ä¸€èµ·ï¼ˆæ”¶é›†ï¼‰ï¼Œå¦‚æ­¤è¿›è¡ŒäºŒæ¬¡åˆ†é…å’Œæ”¶é›†å³å¯å°†æ‰‘å…‹ç‰ŒæŽ’åˆ—æœ‰åºã€‚ åŸºæ•°æŽ’åº: æ˜¯æŒ‰ç…§ä½Žä½å…ˆæŽ’åºï¼Œç„¶åŽæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æŽ’åºï¼Œç„¶åŽå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æŽ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±žæ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½Žä¼˜å…ˆçº§æŽ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æŽ’åºã€‚æœ€åŽçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½Žä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚åŸºæ•°æŽ’åºåŸºäºŽåˆ†åˆ«æŽ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: åŸºæ•°æŽ’åºï¼šè¿‡ç¨‹æ— é¡»æ¯”è¾ƒå…³é”®å­—ï¼Œè€Œæ˜¯é€šè¿‡â€œåˆ†é…â€å’Œâ€œæ”¶é›†â€è¿‡ç¨‹æ¥å®žçŽ°æŽ’åºã€‚ * å¹³å‡O(d(n+r)),æœ€å¥½O(d(n+r)),æœ€åO(d(n+r));ç©ºé—´å¤æ‚åº¦O(n+r);ç¨³å®š;è¾ƒå¤æ‚ * dä¸ºä½æ•°,rä¸ºåˆ†é…åŽé“¾è¡¨çš„ä¸ªæ•° */public class RadixSort &#123; /** * åŸºæ•°æŽ’åº * * @param unsorted å¾…æŽ’æ•°ç»„ * @param max æœ€å¤§å‡ ä½æ•° */ public static void radixSort(int[] unsorted, int max) &#123; //countæ•°ç»„ç”¨æ¥è®¡æ•° int[] count = new int[unsorted.length]; //bucketç”¨æ¥å½“æ¡¶ï¼Œæ”¾æ•°æ®ï¼Œå–æ•°æ® int[] bucket = new int[unsorted.length]; //kè¡¨ç¤ºç¬¬å‡ ä½ï¼Œ1ä»£è¡¨ä¸ªä½ï¼Œ2ä»£è¡¨åä½ï¼Œ3ä»£è¡¨ç™¾ä½ for (int k = 1; k &lt;= max; k++) &#123; //æŠŠcountç½®ç©ºï¼Œé˜²æ­¢ä¸Šæ¬¡å¾ªçŽ¯çš„æ•°æ®å½±å“ for (int i = 0; i &lt; unsorted.length; i++) &#123; count[i] = 0; &#125; //åˆ†åˆ«ç»Ÿè®¡ç¬¬kä½æ˜¯0,1,2,3,4,5,6,7,8,9çš„æ•°é‡ //ä»¥ä¸‹ä¾¿ç§°ä¸ºæ¡¶ //å³æ­¤å¾ªçŽ¯ç”¨æ¥ç»Ÿè®¡æ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®çš„æ•°é‡ for (int i = 0; i &lt; unsorted.length; i++) &#123; count[getFigure(unsorted[i], k)]++; &#125; //åˆ©ç”¨count[i]æ¥ç¡®å®šæ”¾ç½®æ•°æ®çš„ä½ç½® for (int i = 1; i &lt; unsorted.length; i++) &#123; count[i] = count[i] + count[i - 1]; &#125; //æ‰§è¡Œå®Œæ­¤å¾ªçŽ¯ä¹‹åŽçš„count[i]å°±æ˜¯ç¬¬iä¸ªæ¡¶å³è¾¹ç•Œçš„ä½ç½® //åˆ©ç”¨å¾ªçŽ¯æŠŠæ•°æ®è£…å…¥å„ä¸ªæ¡¶ä¸­ï¼Œæ³¨æ„æ˜¯ä»ŽåŽå¾€å‰è£… for (int i = unsorted.length - 1; i &gt;= 0; i--) &#123; int j = getFigure(unsorted[i], k); bucket[count[j] - 1] = unsorted[i]; count[j]--; &#125; //å°†æ¡¶ä¸­çš„æ•°æ®å–å‡ºæ¥ï¼Œèµ‹å€¼ç»™unsorted for (int i = 0, j = 0; i &lt; unsorted.length; i++, j++) &#123; unsorted[i] = bucket[j]; &#125; &#125; &#125; /** * è¿”å›žæ•´åž‹æ•°numçš„ç¬¬posä½æ˜¯ä»€ä¹ˆ * * @param num æ•´æ•°num * @param pos pos=1è¡¨ç¤ºä¸ªä½ï¼Œpos=2è¡¨ç¤ºåä½ * @return */ public static int getFigure(int num, int pos) &#123; int tmp = 1; for (int i = 0; i &lt; pos - 1; i++) &#123; tmp *= 10; &#125; return (num / tmp) % 10; &#125; /** * äºŒç»´æ•°ç»„çš„æ–¹å¼å®žçŽ°åŸºæ•°æŽ’åº * * @param unsorted å¾…æŽ’åºåˆ— * @param arr_x æœ€å¤§æ•°å­—ä¸è¶…è¿‡999999999...(array_xä¸ª9) * @param arr_y æœ€å¤§ä½æ•° */ public static void radix_sort(int[] unsorted, int arr_x, int arr_y) &#123; for (int i = 0; i &lt; arr_x; i++) &#123; int[][] bucket = new int[arr_x][arr_y]; //åˆ†é… for (int item : unsorted) &#123; int temp = (item / (int) Math.pow(10, i)) % 10; for (int j = 0; j &lt; arr_y; j++) &#123; if (bucket[temp][j] == 0) &#123; bucket[temp][j] = item; break; &#125; &#125; &#125; //æ”¶é›† for (int o = 0, x = 0; x &lt; arr_x; x++) &#123; for (int y = 0; y &lt; arr_y; y++) &#123; if (bucket[x][y] == 0) &#123; continue; &#125; unsorted[o++] = bucket[x][y]; &#125; &#125; &#125; &#125; public static void main(String[] args) &#123; //å®šä¹‰å¾…æŽ’æ•´åž‹æ•°ç»„ int[] arr = &#123;21, 56, 88, 195, 354, 1, 35, 12, 6, 7&#125;; System.out.println("**************åŸºæ•°æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(arr); //è°ƒç”¨åŸºæ•°æŽ’åºå‡½æ•° radixSort(arr, 3); System.out.println("æŽ’åºåŽï¼š"); //è¾“å‡ºæŽ’åºåŽçš„æ•°ç»„ CommonUtils.display(arr); System.out.println(" "); int[] unsorted = &#123;999999999, 65, 24, 47, 13, 50, 92, 88, 66, 33, 22445, 10001, 624159, 624158, 624155501&#125;; System.out.println("**************äºŒç»´æ•°ç»„æ–¹å¼å®žçŽ°çš„åŸºæ•°æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); radix_sort(unsorted, 10, 100); System.out.println("æŽ’åºåŽï¼š"); for (int tmp : unsorted) &#123; if (tmp &gt; 0) &#123; System.out.print(tmp + " "); &#125; &#125; &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å“†å•¦Aæ¢¦]]></title>
    <url>%2Fposts%2F9a1a736f.html</url>
    <content type="text"><![CDATA[ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset="utf-8"/&gt; &lt;title&gt;å“†å•¦Aæ¢¦&lt;/title&gt; &lt;style&gt; body &#123; margin: 0; padding: 0; &#125; #doraemon &#123; background-color: #fff; display: block; &#125; &lt;/style&gt;&lt;/head&gt;&lt;body onmousemove="zuobiao(event)"&gt;&lt;canvas id="doraemon" width="400" height="600"&gt;&lt;/canvas&gt;&lt;div id="put" style="width: 50px" height="20px"&gt;&lt;/div&gt;&lt;script&gt; window.onload = function () &#123; var cxt = document.getElementById('doraemon').getContext('2d'); /* å¤´éƒ¨*/ cxt.beginPath();//èµ·å§‹è·¯å¾„ cxt.lineWidth = 1;//çº¿å®½åº¦ä¸º1 cxt.strokeStyle = '#000';//ç¬”è§¦çš„é¢œè‰² cxt.arc(200, 175, 175, 0.7 * Math.PI, 0.3 * Math.PI);//ç»˜åˆ¶å¼§ï¼Œä¸­å¿ƒç‚¹ï¼ˆ200ï¼Œ175ï¼‰ï¼ŒåŠå¾„175 cxt.fillStyle = '#0bb0da';//è®¾ç½®å¡«å……æ—¶çš„é¢œè‰² cxt.fill();//å¡«å……é¢œè‰² cxt.stroke();//ç»˜åˆ¶è·¯å¾„ /*è„¸éƒ¨*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.moveTo(110, 110);//å°†è·¯å¾„ç§»åˆ°ç‚¹ï¼ˆ110ï¼Œ110ï¼‰ï¼Œä¸åˆ›å»ºçº¿æ¡ cxt.quadraticCurveTo(-10, 200, 120, 315);//åˆ›å»ºäºŒæ¬¡è´å¡žå°”æ›²çº¿,æŽ§åˆ¶ç‚¹(-10,200),ç»“æŸç‚¹(120,315) cxt.lineTo(280, 315);//æ·»åŠ ä¸€ä¸ªæ–°ç‚¹ï¼Œç„¶åŽåœ¨ç”»å¸ƒä¸­åˆ›å»ºä»Žï¼ˆ110ï¼Œ110ï¼‰åˆ°ï¼ˆ280ï¼Œ315ï¼‰çš„çº¿æ¡ cxt.quadraticCurveTo(410, 210, 290, 110); cxt.lineTo(110, 110); cxt.fill(); cxt.stroke(); /*çœ¼ç›*/ cxt.beginPath(); cxt.lineWidth = 1; cxt.fillStyle = '#fff'; cxt.moveTo(110, 110); cxt.bezierCurveTo(110, 25, 200, 25, 200, 100);//åˆ›å»ºä¸‰æ¬¡è´å¡žå°”æ›²çº¿,æŽ§åˆ¶ç‚¹1(110,25),æŽ§åˆ¶ç‚¹2(200,25),ç»“æŸç‚¹(200,100)ï¼Œä¹Ÿå°±æ˜¯ç”»å·¦ä¸ŠåŠæ¤­åœ† cxt.bezierCurveTo(200, 175, 110, 175, 110, 100);//ç”»å·¦ä¸‹åŠæ¤­åœ† cxt.moveTo(200, 100); cxt.bezierCurveTo(200, 25, 290, 25, 290, 100); cxt.bezierCurveTo(290, 175, 200, 175, 200, 100); cxt.fill(); cxt.stroke(); /*å³çœ¼çƒ*/ cxt.beginPath(); cxt.fillStyle = '#000'; cxt.arc(230, 130, 12, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /*å·¦çœ¼çƒ*/ cxt.beginPath(); cxt.fillStyle = '#000'; cxt.arc(170, 130, 12, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /* é¼»å­*/ cxt.beginPath(); cxt.arc(200, 165, 25, 0, 2 * Math.PI); cxt.fillStyle = '#d05823'; cxt.fill(); cxt.stroke(); /*èƒ¡é¡»*/ //å·¦èƒ¡é¡» cxt.beginPath(); cxt.moveTo(80, 175); cxt.lineTo(150, 195); cxt.moveTo(80, 200); cxt.lineTo(150, 205); cxt.moveTo(80, 225); cxt.lineTo(150, 215); //ä¸­éƒ¨èƒ¡é¡» cxt.moveTo(200, 195); cxt.lineTo(200, 290); //å³èƒ¡é¡» cxt.moveTo(250, 195); cxt.lineTo(320, 175); cxt.moveTo(250, 205); cxt.lineTo(320, 200); cxt.moveTo(250, 215); cxt.lineTo(320, 225); cxt.stroke(); /*å˜´*/ cxt.moveTo(80, 240); cxt.quadraticCurveTo(200, 350, 320, 240); cxt.stroke(); /*å›´å·¾*/ cxt.beginPath(); cxt.moveTo(96, 316); cxt.lineTo(305, 316); cxt.lineTo(320, 316); cxt.arcTo(330, 316, 330, 326, 10);//åœ¨ç”»å¸ƒä¸Šåˆ›å»ºä»‹äºŽä¸¤ä¸ªåˆ‡çº¿ä¹‹é—´çš„å¼§ï¼Œèµ·ç‚¹åæ ‡ä¸º(330,316),ç»ˆç‚¹åæ ‡ä¸º(330,326),åŠå¾„ä¸º10 cxt.lineTo(330, 336); cxt.arcTo(330, 346, 305, 346, 10); cxt.lineTo(81, 346); cxt.arcTo(71, 346, 71, 336, 10); cxt.lineTo(71, 326); cxt.arcTo(71, 316, 81, 316, 10); cxt.lineTo(96, 316); cxt.fillStyle = '#b13209'; cxt.fill(); cxt.stroke(); /*ä¸‹åŠèº«*/ cxt.beginPath(); cxt.fillStyle = '#0bb0da'; cxt.moveTo(80, 346); //å·¦è¡£æœ cxt.lineTo(26, 406); cxt.lineTo(65, 440); cxt.lineTo(85, 418); cxt.lineTo(85, 528); cxt.lineTo(185, 528); //å³è¡£æœ cxt.lineTo(315, 528); cxt.lineTo(315, 418); cxt.lineTo(337, 440); cxt.lineTo(374, 406); cxt.lineTo(320, 346); cxt.fill(); cxt.stroke(); /*æ‰‹*/ //å·¦æ‰‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(37, 433, 30, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); //å³æ‰‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(363, 433, 30, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /*è‚š*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(200, 400, 91, 1.8 * Math.PI, 1.2 * Math.PI); cxt.fill(); cxt.stroke(); //å°å£è¢‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.moveTo(130, 394); cxt.lineTo(270, 394); cxt.moveTo(130, 394); cxt.bezierCurveTo(130, 490, 270, 490, 270, 394); cxt.fill(); cxt.stroke(); /*ä¸¤åªè„šçš„ç©ºéš™*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(200, 529, 20,Math.PI, 0); cxt.fill(); cxt.stroke(); /*è„š*/ //å·¦è„š cxt.beginPath(); cxt.fillStyle='#fff'; cxt.moveTo(180,528); cxt.lineTo(72,528); cxt.bezierCurveTo(52,528,52,558,72,558); cxt.lineTo(180,558); cxt.moveTo(180,558); cxt.bezierCurveTo(200,558,200,528,180,528); cxt.fill(); cxt.stroke(); //å³è„š cxt.beginPath(); cxt.fillStyle='#fff'; cxt.moveTo(220,528); cxt.lineTo(328,528); cxt.bezierCurveTo(348,528,348,558,328,558); cxt.lineTo(220,558); cxt.moveTo(220,558); cxt.bezierCurveTo(200,558,200,528,220,528); cxt.fill(); cxt.stroke(); &#125;; //æ˜¾ç¤ºåæ ‡ function zuobiao(event) &#123; var x = event.clientX; var y = event.clientY; var out = document.getElementById("put"); out.innerHTML = "x:" + x + " y:" + y; &#125;&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ•ˆæžœ]]></content>
      <categories>
        <category>Html</category>
        <category>Js</category>
      </categories>
      <tags>
        <tag>Html</tag>
        <tag>Js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å½’å¹¶æŽ’åº]]></title>
    <url>%2Fposts%2F9bca323a.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å½’å¹¶ï¼ˆMergeï¼‰æŽ’åºæ³•æ˜¯å°†ä¸¤ä¸ªï¼ˆæˆ–ä¸¤ä¸ªä»¥ä¸Šï¼‰æœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºè¡¨ï¼Œå³æŠŠå¾…æŽ’åºåºåˆ—åˆ†ä¸ºè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œæ¯ä¸ªå­åºåˆ—æ˜¯æœ‰åºçš„ã€‚ç„¶åŽå†æŠŠæœ‰åºå­åºåˆ—åˆå¹¶ä¸ºæ•´ä½“æœ‰åºåºåˆ—ã€‚ ç®—æ³•æ­¥éª¤ ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æŽ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åŽçš„åºåˆ— è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æŽ’åºåºåˆ—çš„èµ·å§‹ä½ç½® æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½® é‡å¤æ­¥éª¤3ç›´åˆ°æŸä¸€æŒ‡é’ˆåˆ°è¾¾åºåˆ—å°¾ å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æŽ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾ ç®—æ³•æµç¨‹å›¾ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å½’å¹¶æŽ’åº */public class MergeSort &#123; /** * å½’å¹¶æŽ’åºï¼ˆMerge Sortï¼‰ä¸Žå¿«é€ŸæŽ’åºæ€æƒ³ç±»ä¼¼ï¼šå°†å¾…æŽ’åºæ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç»§ç»­å°†ä¸¤ä¸ªå­éƒ¨åˆ†è¿›è¡Œé€’å½’çš„å½’å¹¶æŽ’åºï¼›ç„¶åŽå°†å·²ç»æœ‰åºçš„ä¸¤ä¸ªå­éƒ¨åˆ†è¿›è¡Œåˆå¹¶ï¼Œæœ€ç»ˆå®ŒæˆæŽ’åºã€‚ * å…¶æ—¶é—´å¤æ‚åº¦ä¸Žå¿«é€ŸæŽ’åºå‡ä¸ºO(nlogn)ï¼Œä½†æ˜¯å½’å¹¶æŽ’åºé™¤äº†é€’å½’è°ƒç”¨é—´æŽ¥ä½¿ç”¨äº†è¾…åŠ©ç©ºé—´æ ˆï¼Œè¿˜éœ€è¦é¢å¤–çš„O(n)ç©ºé—´è¿›è¡Œä¸´æ—¶å­˜å‚¨ã€‚ä»Žæ­¤è§’åº¦å½’å¹¶æŽ’åºç•¥é€ŠäºŽå¿«é€ŸæŽ’åºï¼Œä½†æ˜¯å½’å¹¶æŽ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æŽ’åºç®—æ³•ï¼Œå¿«é€ŸæŽ’åºåˆ™ä¸ç„¶ã€‚ * æ‰€è°“ç¨³å®šæŽ’åºï¼Œè¡¨ç¤ºå¯¹äºŽå…·æœ‰ç›¸åŒå€¼çš„å¤šä¸ªå…ƒç´ ï¼Œå…¶é—´çš„å…ˆåŽé¡ºåºä¿æŒä¸å˜ã€‚å¯¹äºŽåŸºæœ¬æ•°æ®ç±»åž‹è€Œè¨€ï¼Œä¸€ä¸ªæŽ’åºç®—æ³•æ˜¯å¦ç¨³å®šï¼Œå½±å“å¾ˆå°ï¼Œä½†æ˜¯å¯¹äºŽç»“æž„ä½“æ•°ç»„ï¼Œç¨³å®šæŽ’åºå°±ååˆ†é‡è¦ã€‚ä¾‹å¦‚å¯¹äºŽstudentç»“æž„ä½“æŒ‰ç…§å…³é”®å­—scoreè¿›è¡Œéžé™åºæŽ’åºï¼š */ public static void mergeSort(int[] numArr, int[] tempArr, int head, int rear) &#123; if (head &lt; rear) &#123; //å–åˆ†å‰²ä½ç½® int middle = (head + rear) / 2; //é€’å½’åˆ’åˆ†åˆ—è¡¨çš„å·¦åºåˆ— mergeSort(numArr, tempArr, head, middle); //é€’å½’åˆ’åˆ†åˆ—è¡¨çš„å³åºåˆ— mergeSort(numArr, tempArr, middle + 1, rear); //åˆ—è¡¨çš„åˆå¹¶ merge(numArr, tempArr, head, middle + 1, rear); &#125; &#125; /** * åˆå¹¶æ“ä½œ(åˆ—è¡¨çš„ä¸¤ä¸¤åˆå¹¶) * * @param numArr * @param tempArr * @param head * @param middle * @param rear */ public static void merge(int[] numArr, int[] tempArr, int head, int middle, int rear) &#123; //å·¦æŒ‡é’ˆå°¾ int headEnd = middle - 1; //å³æŒ‡é’ˆå¤´ int rearStart = middle; //ä¸´æ—¶è¡¨çš„ä¸‹æ ‡ int tempIndex = head; //åˆ—è¡¨åˆå¹¶åŽçš„é•¿åº¦ int tempLength = rear - head + 1; //å…ˆå¾ªçŽ¯ä¸¤ä¸ªåŒºé—´æ®µéƒ½æ²¡æœ‰ç»“æŸçš„æƒ…å†µ while ((headEnd &gt;= head) &amp;&amp; (rearStart &lt;= rear)) &#123; //å¦‚æžœå‘çŽ°å³åºåˆ—å¤§ï¼Œåˆ™å°†æ­¤æ•°æ”¾å…¥ä¸´æ—¶åˆ—è¡¨ if (numArr[head] &lt; numArr[rearStart]) &#123; tempArr[tempIndex++] = numArr[head++]; &#125; else &#123; tempArr[tempIndex++] = numArr[rearStart++]; &#125; &#125; //åˆ¤æ–­å·¦åºåˆ—æ˜¯å¦ç»“æŸ while (head &lt;= headEnd) &#123; tempArr[tempIndex++] = numArr[head++]; &#125; //åˆ¤æ–­å³åºåˆ—æ˜¯å¦ç»“æŸ while (rearStart &lt;= rear) &#123; tempArr[tempIndex++] = numArr[rearStart++]; &#125; //äº¤æ¢æ•°æ® for (int i = 0; i &lt; tempLength; i++) &#123; numArr[rear] = tempArr[rear]; rear--; &#125; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************å½’å¹¶æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); mergeSort(numArr, new int[numArr.length], 0, numArr.length - 1); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-04ä¹‹-synchronizedå…³é”®å­—]]></title>
    <url>%2Fposts%2F2965099a.html</url>
    <content type="text"><![CDATA[synchronizedåŽŸç† &lt;font color=&quot;red&quot;&gt;åœ¨javaä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåŒæ­¥é”ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼ŒåŒæ­¥é”æ˜¯ä¾èµ–äºŽå¯¹è±¡è€Œå­˜åœ¨ã€‚&lt;/font&gt; &lt;font color=&quot;green&quot;&gt;å½“æˆ‘ä»¬è°ƒç”¨æŸå¯¹è±¡çš„synchronizedæ–¹æ³•æ—¶ï¼Œå°±èŽ·å–äº†è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚&lt;/font&gt;ä¾‹å¦‚ï¼Œsynchronized(obj)å°±èŽ·å–äº†â€œobjè¿™ä¸ªå¯¹è±¡â€çš„åŒæ­¥é”ã€‚ &lt;font color=&quot;green&quot;&gt;ä¸åŒçº¿ç¨‹å¯¹åŒæ­¥é”çš„è®¿é—®æ˜¯äº’æ–¥çš„ã€‚&lt;/font&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸæ—¶é—´ç‚¹ï¼Œå¯¹è±¡çš„åŒæ­¥é”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹èŽ·å–åˆ°ï¼é€šè¿‡åŒæ­¥é”ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå®žçŽ°å¯¹â€œå¯¹è±¡/æ–¹æ³•â€çš„äº’æ–¥è®¿é—®ã€‚ ä¾‹å¦‚ï¼ŒçŽ°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼Œå®ƒä»¬éƒ½ä¼šè®¿é—®â€œå¯¹è±¡objçš„åŒæ­¥é”â€ã€‚å‡è®¾ï¼Œåœ¨æŸä¸€æ—¶åˆ»ï¼Œçº¿ç¨‹AèŽ·å–åˆ°â€œobjçš„åŒæ­¥é”â€å¹¶åœ¨æ‰§è¡Œä¸€äº›æ“ä½œï¼›è€Œæ­¤æ—¶ï¼Œçº¿ç¨‹Bä¹Ÿä¼å›¾èŽ·å–â€œobjçš„åŒæ­¥é”â€ â€”â€” çº¿ç¨‹Bä¼šèŽ·å–å¤±è´¥ï¼Œå®ƒå¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹Aé‡Šæ”¾äº†â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ä¹‹åŽçº¿ç¨‹Bæ‰èƒ½èŽ·å–åˆ°â€œobjçš„åŒæ­¥é”â€ä»Žè€Œæ‰å¯ä»¥è¿è¡Œã€‚ synchronizedåŸºæœ¬è§„åˆ™ &lt;p id=&quot;div-border-left-red&quot;&gt; 1. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ &lt;/p&gt; &lt;p id=&quot;div-border-left-red&quot;&gt; 2. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éžåŒæ­¥ä»£ç å—ã€‚ &lt;/p&gt; &lt;p id=&quot;div-border-left-red&quot;&gt; 3. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ &lt;/p&gt; ç¬¬ä¸€æ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ 12345678910111213141516171819202122232425262728293031323334package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ */public class Demo1_1 &#123; public static void main(String[] args) &#123; // æ–°å»ºâ€œRunnableå¯¹è±¡â€ Runnable demo = new MyRunable(); // æ–°å»ºâ€œçº¿ç¨‹t1â€, t1æ˜¯åŸºäºŽdemoè¿™ä¸ªRunnableå¯¹è±¡ Thread t1 = new Thread(demo, "t1"); // æ–°å»ºâ€œçº¿ç¨‹t2â€, t2æ˜¯åŸºäºŽdemoè¿™ä¸ªRunnableå¯¹è±¡ Thread t2 = new Thread(demo, "t2"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t2.start(); // å¯åŠ¨â€œçº¿ç¨‹t2â€ &#125;&#125;class MyRunable implements Runnable &#123; @Override public void run() &#123; synchronized (this) &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t1 loop 0t1 loop 1t1 loop 2t1 loop 3t1 loop 4t2 loop 0t2 loop 1t2 loop 2t2 loop 3t2 loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; run()æ–¹æ³•ä¸­å­˜åœ¨â€œsynchronized(this)ä»£ç å—â€ï¼Œè€Œä¸”t1å’Œt2éƒ½æ˜¯åŸºäºŽ&quot;demoè¿™ä¸ªRunnableå¯¹è±¡&quot;åˆ›å»ºçš„çº¿ç¨‹ã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥å°†synchronized(this)ä¸­çš„thisçœ‹ä½œæ˜¯â€œdemoè¿™ä¸ªRunnableå¯¹è±¡â€ï¼›å› æ­¤ï¼Œçº¿ç¨‹t1å’Œt2å…±äº«â€œdemoå¯¹è±¡çš„åŒæ­¥é”â€ã€‚æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¿…é¡»ç­‰å¾…â€œè¿è¡Œçº¿ç¨‹â€é‡Šæ”¾â€œdemoçš„åŒæ­¥é”â€ä¹‹åŽæ‰èƒ½è¿è¡Œã€‚ æŽ¥ä¸‹æ¥å°†ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œç„¶åŽå†è¿è¡Œçœ‹çœ‹ç»“æžœæ€Žä¹ˆæ ·ã€‚ä¿®æ”¹åŽçš„æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ */public class Demo1_2 &#123; public static void main(String[] args) &#123; // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); // æ–°å»ºâ€œçº¿ç¨‹t2â€ Thread t2 = new MyThread("t2"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t2.start(); // å¯åŠ¨â€œçº¿ç¨‹t2â€ &#125;&#125;class MyThread extends Thread &#123; public MyThread(String name) &#123; super(name); &#125; @Override public void run() &#123; synchronized (this) &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-purple&quot;&gt; ä»£ç è¯´æ˜Žï¼š &lt;/span&gt; æ¯”è¾ƒDemo1_2 å’Œ Demo1_1åŽå‘çŽ°ï¼ŒDemo1_2ä¸­çš„MyThreadç±»æ˜¯ç›´æŽ¥ç»§æ‰¿äºŽThreadï¼Œè€Œä¸”t1å’Œt2éƒ½æ˜¯MyThreadå­çº¿ç¨‹ã€‚ åœ¨â€œDemo1_2çš„run()æ–¹æ³•â€ä¹Ÿè°ƒç”¨äº†synchronized(this)ï¼Œæ­£å¦‚â€œDemo1_1çš„run()æ–¹æ³•â€ä¹Ÿè°ƒç”¨äº†synchronized(this)ä¸€æ ·ï¼ é‚£ä¹ˆï¼ŒDemo1_2çš„æ‰§è¡Œæµç¨‹æ˜¯ä¸æ˜¯å’ŒDemo1_1ä¸€æ ·å‘¢ï¼Ÿ &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t1 loop 0t2 loop 0t1 loop 1t2 loop 1t1 loop 2t2 loop 2t1 loop 3t2 loop 3t1 loop 4t2 loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; synchronized(this)ä¸­çš„thisæ˜¯æŒ‡â€œå½“å‰çš„ç±»å¯¹è±¡â€ï¼Œå³synchronized(this)æ‰€åœ¨çš„ç±»å¯¹åº”çš„å½“å‰å¯¹è±¡ã€‚å®ƒçš„ä½œç”¨æ˜¯èŽ·å–â€œå½“å‰å¯¹è±¡çš„åŒæ­¥é”â€ã€‚ å¯¹äºŽDemo1_2ä¸­ï¼Œsynchronized(this)ä¸­çš„thisä»£è¡¨çš„æ˜¯MyThreadå¯¹è±¡ï¼Œè€Œt1å’Œt2æ˜¯ä¸¤ä¸ªä¸åŒçš„MyThreadå¯¹è±¡ï¼Œå› æ­¤t1å’Œt2åœ¨æ‰§è¡Œsynchronized(this)æ—¶ï¼ŒèŽ·å–çš„æ˜¯ä¸åŒå¯¹è±¡çš„åŒæ­¥é”ã€‚å¯¹äºŽDemo1_1å¯¹è€Œè¨€ï¼Œsynchronized(this)ä¸­çš„thisä»£è¡¨çš„æ˜¯MyRunableå¯¹è±¡ï¼›t1å’Œt2å…±åŒä¸€ä¸ªMyRunableå¯¹è±¡ï¼Œå› æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹èŽ·å–äº†å¯¹è±¡çš„åŒæ­¥é”ï¼Œä¼šé€ æˆå¦å¤–ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ã€‚ ç¬¬äºŒæ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éžåŒæ­¥ä»£ç å—ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éžåŒæ­¥ä»£ç å—ã€‚ */public class Demo2 &#123; public static void main(String[] args) &#123; final Count count = new Count(); // æ–°å»ºt1, t1ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„synMethod()æ–¹æ³• Thread t1 = new Thread( new Runnable() &#123; @Override public void run() &#123; count.synMethod(); &#125; &#125;, "t1"); // æ–°å»ºt2, t2ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„nonSynMethod()æ–¹æ³• Thread t2 = new Thread( new Runnable() &#123; @Override public void run() &#123; count.nonSynMethod(); &#125; &#125;, "t2"); t1.start(); // å¯åŠ¨t1 t2.start(); // å¯åŠ¨t2 &#125;&#125;class Count &#123; /** * å«æœ‰synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void synMethod() &#123; synchronized (this) &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " synMethod loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; &#125; /** * éžåŒæ­¥çš„æ–¹æ³• */ public void nonSynMethod() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " nonSynMethod loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t1 synMethod loop 0t2 nonSynMethod loop 0t1 synMethod loop 1t2 nonSynMethod loop 1t1 synMethod loop 2t2 nonSynMethod loop 2t1 synMethod loop 3t2 nonSynMethod loop 3t1 synMethod loop 4t2 nonSynMethod loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹ä¸­æ–°å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹t1å’Œt2ã€‚t1ä¼šè°ƒç”¨countå¯¹è±¡çš„synMethod()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…å«æœ‰åŒæ­¥å—ï¼›è€Œt2åˆ™ä¼šè°ƒç”¨countå¯¹è±¡çš„nonSynMethod()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯åŒæ­¥æ–¹æ³•ã€‚t1è¿è¡Œæ—¶ï¼Œè™½ç„¶è°ƒç”¨synchronized(this)èŽ·å–â€œcountçš„åŒæ­¥é”â€ï¼›ä½†æ˜¯å¹¶æ²¡æœ‰é€ æˆt2çš„é˜»å¡žï¼Œå› ä¸ºt2æ²¡æœ‰ç”¨åˆ°â€œcountâ€åŒæ­¥é”ã€‚ ç¬¬ä¸‰æ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡žã€‚ */public class Demo3 &#123; public static void main(String[] args) &#123; final Count2 count = new Count2(); // æ–°å»ºt1, t1ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„synMethod()æ–¹æ³• Thread t1 = new Thread( new Runnable() &#123; @Override public void run() &#123; count.synMethod(); &#125; &#125;, "t1"); // æ–°å»ºt2, t2ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„nonSynMethod()æ–¹æ³• Thread t2 = new Thread( new Runnable() &#123; @Override public void run() &#123; count.nonSynMethod(); &#125; &#125;, "t2"); t1.start(); // å¯åŠ¨t1 t2.start(); // å¯åŠ¨t2 &#125;&#125;class Count2 &#123; /** * å«æœ‰synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void synMethod() &#123; synchronized (this) &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " synMethod loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; &#125; /** * ä¹ŸåŒ…å«synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void nonSynMethod() &#123; synchronized (this) &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " nonSynMethod loop " + i); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t1 synMethod loop 0t1 synMethod loop 1t1 synMethod loop 2t1 synMethod loop 3t1 synMethod loop 4t2 nonSynMethod loop 0t2 nonSynMethod loop 1t2 nonSynMethod loop 2t2 nonSynMethod loop 3t2 nonSynMethod loop 4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; ä¸»çº¿ç¨‹ä¸­æ–°å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2è¿è¡Œæ—¶éƒ½è°ƒç”¨synchronized(this)ï¼Œè¿™ä¸ªthisæ˜¯Countå¯¹è±¡(count)ï¼Œè€Œt1å’Œt2å…±ç”¨countã€‚å› æ­¤ï¼Œåœ¨t1è¿è¡Œæ—¶ï¼Œt2ä¼šè¢«é˜»å¡žï¼Œç­‰å¾…t1è¿è¡Œé‡Šæ”¾â€œcountå¯¹è±¡çš„åŒæ­¥é”â€ï¼Œt2æ‰èƒ½è¿è¡Œã€‚ synchronizedæ–¹æ³• å’Œ synchronizedä»£ç å— â€œsynchronizedæ–¹æ³•â€æ˜¯ç”¨synchronizedä¿®é¥°æ–¹æ³•ï¼Œè€Œ â€œsynchronizedä»£ç å—â€åˆ™æ˜¯ç”¨synchronizedä¿®é¥°ä»£ç å—ã€‚ synchronizedæ–¹æ³•ç¤ºä¾‹: 123public synchronized void foo1() &#123; System.out.println("synchronized methoed");&#125; synchronizedä»£ç å—ç¤ºä¾‹ï¼š 12345public void foo2() &#123; synchronized (this) &#123; System.out.println("synchronized methoed"); &#125;&#125; synchronizedä»£ç å—ä¸­çš„thisæ˜¯æŒ‡å½“å‰å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥å°†thisæ›¿æ¢æˆå…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚å°†thisæ›¿æ¢æˆobjï¼Œåˆ™foo2()åœ¨æ‰§è¡Œsynchronized(obj)æ—¶å°±èŽ·å–çš„æ˜¯objçš„åŒæ­¥é”ã€‚ synchronizedä»£ç å—å¯ä»¥æ›´ç²¾ç¡®çš„æŽ§åˆ¶å†²çªé™åˆ¶è®¿é—®åŒºåŸŸï¼Œæœ‰æ—¶å€™è¡¨çŽ°æ›´é«˜æ•ˆçŽ‡ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: synchronizedä»£ç å—å¯ä»¥æ›´ç²¾ç¡®çš„æŽ§åˆ¶å†²çªé™åˆ¶è®¿é—®åŒºåŸŸï¼Œæœ‰æ—¶å€™è¡¨çŽ°æ›´é«˜æ•ˆçŽ‡ã€‚ */public class Demo4 &#123; public synchronized void synMethod() &#123; for (int i = 0; i &lt; 1000000; i++) &#123; ; &#125; &#125; public void synBlock() &#123; synchronized (this) &#123; for (int i = 0; i &lt; 1000000; i++) &#123; ; &#125; &#125; &#125; public static void main(String[] args) &#123; Demo4 demo = new Demo4(); long start, diff; // èŽ·å–å½“å‰æ—¶é—´(millis) start = System.currentTimeMillis(); // è°ƒç”¨â€œsynchronizedæ–¹æ³•â€ demo.synMethod(); // èŽ·å–â€œæ—¶é—´å·®å€¼â€ diff = System.currentTimeMillis() - start; System.out.println("synMethod() : " + diff); // èŽ·å–å½“å‰æ—¶é—´(millis) start = System.currentTimeMillis(); // è°ƒç”¨â€œsynchronizedæ–¹æ³•å—â€ demo.synBlock(); // èŽ·å–â€œæ—¶é—´å·®å€¼â€ diff = System.currentTimeMillis() - start; System.out.println("synBlock() : " + diff); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; (æŸä¸€æ¬¡)æ‰§è¡Œç»“æžœï¼š &lt;/span&gt; 12synMethod() : 11synBlock() : 3 å®žä¾‹é” å’Œ å…¨å±€é” å®žä¾‹é” -- é”åœ¨æŸä¸€ä¸ªå®žä¾‹å¯¹è±¡ä¸Šã€‚å¦‚æžœè¯¥ç±»æ˜¯å•ä¾‹ï¼Œé‚£ä¹ˆè¯¥é”ä¹Ÿå…·æœ‰å…¨å±€é”çš„æ¦‚å¿µã€‚ å®žä¾‹é”å¯¹åº”çš„å°±æ˜¯synchronizedå…³é”®å­—ã€‚ å…¨å±€é” -- è¯¥é”é’ˆå¯¹çš„æ˜¯ç±»ï¼Œæ— è®ºå®žä¾‹å¤šå°‘ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆçº¿ç¨‹éƒ½å…±äº«è¯¥é”ã€‚ å…¨å±€é”å¯¹åº”çš„å°±æ˜¯static synchronizedï¼ˆæˆ–è€…æ˜¯é”åœ¨è¯¥ç±»çš„classæˆ–è€…classloaderå¯¹è±¡ä¸Šï¼‰ã€‚ å…³äºŽâ€œå®žä¾‹é”â€å’Œâ€œå…¨å±€é”â€æœ‰ä¸€ä¸ªå¾ˆå½¢è±¡çš„ä¾‹å­ï¼š 123456pulbic class Something &#123; public synchronized void isSyncA()&#123;&#125; public synchronized void isSyncB()&#123;&#125; public static synchronized void cSyncA()&#123;&#125; public static synchronized void cSyncB()&#123;&#125;&#125; å‡è®¾ï¼ŒSomethingæœ‰ä¸¤ä¸ªå®žä¾‹xå’Œyã€‚åˆ†æžä¸‹é¢4ç»„è¡¨è¾¾å¼èŽ·å–çš„é”çš„æƒ…å†µã€‚ (01) x.isSyncA()ä¸Žx.isSyncB() (02) x.isSyncA()ä¸Žy.isSyncA() (03) x.cSyncA()ä¸Žy.cSyncB() (04) x.isSyncA()ä¸ŽSomething.cSyncA() ä¸‹é¢é€šè¿‡å››ä¸ªç¤ºä¾‹æ¼”ç¤ºè¿›è¡Œåˆ†æžã€‚é¦–å…ˆå®šä¹‰Somethingå¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: Somethingå¯¹è±¡ */public class Something &#123; public synchronized void isSyncA() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : isSyncA"); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; public synchronized void isSyncB() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : isSyncB"); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; public static synchronized void cSyncA() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : cSyncA"); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125; public static synchronized void cSyncB() &#123; try &#123; for (int i = 0; i &lt; 5; i++) &#123; Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : cSyncB"); &#125; &#125; catch (InterruptedException ie) &#123; &#125; &#125;&#125; (01) ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()å’ŒisSyncB()éƒ½æ˜¯è®¿é—®åŒä¸€ä¸ªå¯¹è±¡(å¯¹è±¡x)çš„åŒæ­¥é”ï¼ 123456789101112131415161718192021222324252627282930313233package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®žä¾‹é”å’Œå…¨å±€é”åˆ†æžç¤ºä¾‹1 * ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()å’ŒisSyncB()éƒ½æ˜¯è®¿é—®åŒä¸€ä¸ªå¯¹è±¡(å¯¹è±¡x)çš„åŒæ­¥é”ï¼ */public class LockTest1 &#123; Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(01) x.isSyncA()ä¸Žx.isSyncB() */ private void test1() &#123; // æ–°å»ºt11, t11ä¼šè°ƒç”¨ x.isSyncA() Thread t11 = new Thread( () -&gt; x.isSyncA(), "t11"); // æ–°å»ºt12, t12ä¼šè°ƒç”¨ x.isSyncB() Thread t12 = new Thread( () -&gt; x.isSyncB(), "t12"); t11.start(); // å¯åŠ¨t11 t12.start(); // å¯åŠ¨t12 &#125; public static void main(String[] args) &#123; LockTest1 demo = new LockTest1(); demo.test1(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t11 : isSyncAt11 : isSyncAt11 : isSyncAt11 : isSyncAt11 : isSyncAt12 : isSyncBt12 : isSyncBt12 : isSyncBt12 : isSyncBt12 : isSyncB (02) å¯ä»¥åŒæ—¶è¢«è®¿é—®ã€‚å› ä¸ºè®¿é—®çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œx.isSyncA()è®¿é—®çš„æ˜¯xçš„åŒæ­¥é”ï¼Œè€Œy.isSyncA()è®¿é—®çš„æ˜¯yçš„åŒæ­¥é”ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®žä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹2 * å¯ä»¥åŒæ—¶è¢«è®¿é—®ã€‚å› ä¸ºè®¿é—®çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œx.isSyncA()è®¿é—®çš„æ˜¯xçš„åŒæ­¥é”ï¼Œè€Œy.isSyncA()è®¿é—®çš„æ˜¯yçš„åŒæ­¥é”ã€‚ */public class LockTest2 &#123; Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(02) x.isSyncA()ä¸Žy.isSyncA() */ private void test2() &#123; // æ–°å»ºt21, t21ä¼šè°ƒç”¨ x.isSyncA() Thread t21 = new Thread( () -&gt; x.isSyncA(), "t21"); // æ–°å»ºt22, t22ä¼šè°ƒç”¨ x.isSyncB() Thread t22 = new Thread( () -&gt; y.isSyncA(), "t22"); t21.start(); // å¯åŠ¨t21 t22.start(); // å¯åŠ¨t22 &#125; public static void main(String[] args) &#123; LockTest2 demo = new LockTest2(); demo.test2(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncA (03) ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºcSyncA()å’ŒcSyncB()éƒ½æ˜¯staticç±»åž‹ï¼Œx.cSyncA()ç›¸å½“äºŽSomething.isSyncA()ï¼Œy.cSyncB()ç›¸å½“äºŽSomething.isSyncB()ï¼Œå› æ­¤å®ƒä»¬å…±ç”¨ä¸€ä¸ªåŒæ­¥é”ï¼Œä¸èƒ½è¢«åŒæ—¶åé—®ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®žä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹3 * ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºcSyncA()å’ŒcSyncB()éƒ½æ˜¯staticç±»åž‹ï¼Œx.cSyncA()ç›¸å½“äºŽSomething.isSyncA()ï¼Œy.cSyncB()ç›¸å½“äºŽSomething.isSyncB()ï¼Œå› æ­¤å®ƒä»¬å…±ç”¨ä¸€ä¸ªåŒæ­¥é”ï¼Œä¸èƒ½è¢«åŒæ—¶åé—®ã€‚ */public class LockTest3 &#123; Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(03) x.cSyncA()ä¸Žy.cSyncB() */ private void test3() &#123; // æ–°å»ºt31, t31ä¼šè°ƒç”¨ x.isSyncA() Thread t31 = new Thread( () -&gt; x.cSyncA(), "t31"); // æ–°å»ºt32, t32ä¼šè°ƒç”¨ x.isSyncB() Thread t32 = new Thread( () -&gt; y.cSyncB(), "t32"); t31.start(); // å¯åŠ¨t31 t32.start(); // å¯åŠ¨t32 &#125; public static void main(String[] args) &#123; LockTest3 demo = new LockTest3(); demo.test3(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t31 : cSyncAt31 : cSyncAt31 : cSyncAt31 : cSyncAt31 : cSyncAt32 : cSyncBt32 : cSyncBt32 : cSyncBt32 : cSyncBt32 : cSyncB (04) å¯ä»¥è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()æ˜¯å®žä¾‹æ–¹æ³•ï¼Œx.isSyncA()ä½¿ç”¨çš„æ˜¯å¯¹è±¡xçš„é”ï¼›è€ŒcSyncA()æ˜¯é™æ€æ–¹æ³•ï¼ŒSomething.cSyncA()å¯ä»¥ç†è§£å¯¹ä½¿ç”¨çš„æ˜¯â€œç±»çš„é”â€ã€‚å› æ­¤ï¼Œå®ƒä»¬æ˜¯å¯ä»¥è¢«åŒæ—¶è®¿é—®çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®žä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹4 * å¯ä»¥è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()æ˜¯å®žä¾‹æ–¹æ³•ï¼Œx.isSyncA()ä½¿ç”¨çš„æ˜¯å¯¹è±¡xçš„é”ï¼›è€ŒcSyncA()æ˜¯é™æ€æ–¹æ³•ï¼ŒSomething.cSyncA()å¯ä»¥ç†è§£å¯¹ä½¿ç”¨çš„æ˜¯â€œç±»çš„é”â€ã€‚å› æ­¤ï¼Œå®ƒä»¬æ˜¯å¯ä»¥è¢«åŒæ—¶è®¿é—®çš„ã€‚ */public class LockTest4 &#123; Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(04) x.isSyncA()ä¸ŽSomething.cSyncA() */ private void test4() &#123; // æ–°å»ºt41, t41ä¼šè°ƒç”¨ x.isSyncA() Thread t41 = new Thread( () -&gt; x.isSyncA(), "t41"); // æ–°å»ºt42, t42ä¼šè°ƒç”¨ x.isSyncB() Thread t42 = new Thread( () -&gt; Something.cSyncA(), "t42"); t41.start(); // å¯åŠ¨t41 t42.start(); // å¯åŠ¨t42 &#125; public static void main(String[] args) &#123; LockTest4 demo = new LockTest4(); demo.test4(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910t41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncA]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å¥‡å¶æŽ’åº]]></title>
    <url>%2Fposts%2F185015d0.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åŸºæœ¬æ€è·¯æ˜¯å¥‡æ•°åˆ—æŽ’ä¸€è¶Ÿåº,å¶æ•°åˆ—æŽ’ä¸€è¶Ÿåº,å†å¥‡æ•°æŽ’,å†å¶æ•°æŽ’,ç›´åˆ°å…¨éƒ¨æœ‰åºã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æŽ’æ•°ç»„[6 2 4 1 5 9] ç¬¬ä¸€æ¬¡æ¯”è¾ƒå¥‡æ•°åˆ—,å¥‡æ•°åˆ—ä¸Žå®ƒçš„é‚»å±…å¶æ•°åˆ—æ¯”è¾ƒ,å¦‚6å’Œ2æ¯”,4å’Œ1æ¯”,5å’Œ9æ¯”ã€‚ [6 2 4 1 5 9] äº¤æ¢åŽå˜æˆ [2 6 1 4 5 9] ç¬¬äºŒæ¬¡æ¯”è¾ƒå¶æ•°åˆ—,å³6å’Œ1æ¯”,5å’Œ5æ¯”ã€‚ [2 6 1 4 5 9] äº¤æ¢åŽå˜æˆ [2 1 6 4 5 9] ç¬¬ä¸‰è¶Ÿåˆæ˜¯å¥‡æ•°åˆ—,é€‰æ‹©çš„æ˜¯2,6,5åˆ†åˆ«ä¸Žå®ƒä»¬çš„é‚»å±…åˆ—æ¯”è¾ƒã€‚ [2 1 6 4 5 9] äº¤æ¢åŽ [1 2 4 6 5 9] ç¬¬å››è¶Ÿå¶æ•°åˆ—ã€‚ [1 2 4 6 5 9] ä¸€æ¬¡äº¤æ¢ [1 2 4 5 6 9] ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¥‡å¶æŽ’åºï¼šåŸºæœ¬æ€è·¯æ˜¯å¥‡æ•°åˆ—æŽ’ä¸€è¶Ÿåº,å¶æ•°åˆ—æŽ’ä¸€è¶Ÿåº,å†å¥‡æ•°æŽ’,å†å¶æ•°æŽ’,ç›´åˆ°å…¨éƒ¨æœ‰åº */public class OddEventSort &#123; public static void oddEventSort(int[] unsorted) &#123; int temp; for (int i = unsorted.length - 1; i &gt; unsorted.length / 2 - 1; i--) &#123; //å¥‡æ•°æŽ’åº for (int j = 1; j &lt;= i; j += 2) &#123; if (j == unsorted.length - 1) &#123; break; &#125; if (unsorted[j] &gt; unsorted[j + 1]) &#123; temp = unsorted[j]; unsorted[j] = unsorted[j + 1]; unsorted[j + 1] = temp; &#125; &#125; //å¶æ•°æŽ’åº for (int j = 0; j &lt;= i; j += 2) &#123; if (j == unsorted.length - 1) &#123; break; &#125; if (unsorted[j] &gt; unsorted[j + 1]) &#123; temp = unsorted[j]; unsorted[j] = unsorted[j + 1]; unsorted[j + 1] = temp; &#125; &#125; &#125; &#125; public static void main(String[] args) &#123; int[] unsorted = new int[]&#123;12, 33, 45, 33, 13, 55, 34, 7, 6&#125;; System.out.println("**************å¥‡å¶æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); oddEventSort(unsorted); CommonUtils.display(unsorted); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2Fposts%2Fdb6149c7.html</url>
    <content type="text"><![CDATA[git config --global user.name &quot;ä½ çš„åå­—&quot; è®©ä½ å…¨éƒ¨çš„Gitä»“åº“ç»‘å®šä½ çš„åå­— git config --global user.email &quot;ä½ çš„é‚®ç®±&quot; è®©ä½ å…¨éƒ¨çš„Gitä»“åº“ç»‘å®šä½ çš„é‚®ç®± git init åˆå§‹åŒ–ä½ çš„ä»“åº“ git add . æŠŠå·¥ä½œåŒºçš„æ–‡ä»¶å…¨éƒ¨æäº¤åˆ°æš‚å­˜åŒº git add ./&lt;file&gt;/ æŠŠå·¥ä½œåŒºçš„&lt;file&gt;æ–‡ä»¶æäº¤åˆ°æš‚å­˜åŒº git commit -m &quot;xxx&quot; æŠŠæš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶æäº¤åˆ°ä»“åº“åŒºï¼Œæš‚å­˜åŒºç©ºç©ºè¡è¡ git remote add origin https://github.com/name/name_cangku.git æŠŠæœ¬åœ°ä»“åº“ä¸Žè¿œç¨‹ä»“åº“è¿žæŽ¥èµ·æ¥ git push -u origin master æŠŠä»“åº“åŒºçš„ä¸»åˆ†æ”¯masteræäº¤åˆ°è¿œç¨‹ä»“åº“é‡Œ git push -u origin &lt;å…¶ä»–åˆ†æ”¯&gt; æŠŠå…¶ä»–åˆ†æ”¯æäº¤åˆ°è¿œç¨‹ä»“åº“ git statusæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹çš„å…·ä½“å†…å®¹ git log æ˜¾ç¤ºä»Žæœ€è¿‘åˆ°æœ€è¿œçš„æäº¤åŽ†å² git clone + ä»“åº“åœ°å€ä¸‹è½½å…‹éš†æ–‡ä»¶ git reset --hard + ç‰ˆæœ¬å· å›žæº¯ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å·åœ¨commitçš„æ—¶å€™ä¸Žmasterè·Ÿéšåœ¨ä¸€èµ· git reflog æ˜¾ç¤ºå‘½ä»¤åŽ†å² git checkout -- &lt;file&gt; æ’¤é”€å‘½ä»¤ï¼Œç”¨ç‰ˆæœ¬åº“é‡Œçš„æ–‡ä»¶æ›¿æ¢æŽ‰å·¥ä½œåŒºçš„æ–‡ä»¶ã€‚æˆ‘è§‰å¾—å°±åƒæ˜¯Gitä¸–ç•Œçš„ctrl + z git rm åˆ é™¤ç‰ˆæœ¬åº“çš„æ–‡ä»¶ git branch æŸ¥çœ‹å½“å‰æ‰€æœ‰åˆ†æ”¯ git branch &lt;åˆ†æ”¯åå­—&gt; åˆ›å»ºåˆ†æ”¯ git checkout &lt;åˆ†æ”¯åå­—&gt; åˆ‡æ¢åˆ°åˆ†æ”¯ git merge &lt;åˆ†æ”¯åå­—&gt; åˆå¹¶åˆ†æ”¯ git branch -d &lt;åˆ†æ”¯åå­—&gt; åˆ é™¤åˆ†æ”¯,æœ‰å¯èƒ½ä¼šåˆ é™¤å¤±è´¥ï¼Œå› ä¸ºGitä¼šä¿æŠ¤æ²¡æœ‰è¢«åˆå¹¶çš„åˆ†æ”¯ git branch -D + &lt;åˆ†æ”¯åå­—&gt; å¼ºè¡Œåˆ é™¤ï¼Œä¸¢å¼ƒæ²¡è¢«åˆå¹¶çš„åˆ†æ”¯ git log --graph æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾ git merge --no-ff &lt;åˆ†æ”¯åå­—&gt; åˆå¹¶åˆ†æ”¯çš„æ—¶å€™ç¦ç”¨Fast forwardæ¨¡å¼,å› ä¸ºè¿™ä¸ªæ¨¡å¼ä¼šä¸¢å¤±åˆ†æ”¯åŽ†å²ä¿¡æ¯ git stash å½“æœ‰å…¶ä»–ä»»åŠ¡æ’è¿›æ¥æ—¶ï¼ŒæŠŠå½“å‰å·¥ä½œçŽ°åœºâ€œå­˜å‚¨â€èµ·æ¥,ä»¥åŽæ¢å¤åŽç»§ç»­å·¥ä½œ git stash list æŸ¥çœ‹ä½ åˆšåˆšâ€œå­˜æ”¾â€èµ·æ¥çš„å·¥ä½œåŽ»å“ªé‡Œäº† git stash apply æ¢å¤å´ä¸åˆ é™¤stashå†…å®¹ git stash drop åˆ é™¤stashå†…å®¹ git stash pop æ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ äº† git remote æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯ï¼Œä¼šæ˜¾ç¤ºoriginï¼Œè¿œç¨‹ä»“åº“é»˜è®¤åç§°ä¸ºorigin git remote -v æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ git pull æŠŠæœ€æ–°çš„æäº¤ä»Žè¿œç¨‹ä»“åº“ä¸­æŠ“å–ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°åˆå¹¶,å’Œgit pushç›¸å git rebase æŠŠåˆ†å‰çš„æäº¤åŽ†å²â€œæ•´ç†â€æˆä¸€æ¡ç›´çº¿ï¼Œçœ‹ä¸ŠåŽ»æ›´ç›´è§‚ git tag æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ï¼Œå¯ä»¥çŸ¥é“åŽ†å²ç‰ˆæœ¬çš„tag git tag &lt;name&gt; æ‰“æ ‡ç­¾ï¼Œé»˜è®¤ä¸ºHEADã€‚æ¯”å¦‚git tag v1.0 git tag &lt;tagName&gt; &lt;ç‰ˆæœ¬å·&gt; æŠŠç‰ˆæœ¬å·æ‰“ä¸Šæ ‡ç­¾ï¼Œç‰ˆæœ¬å·å°±æ˜¯commitæ—¶ï¼Œè·Ÿåœ¨æ—è¾¹çš„ä¸€ä¸²å­—æ¯æ•°å­— git show &lt;tagName&gt; æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ git tag -a &lt;tagName&gt; -m &quot;&lt;è¯´æ˜Ž&gt;&quot; åˆ›å»ºå¸¦è¯´æ˜Žçš„æ ‡ç­¾ã€‚-aæŒ‡å®šæ ‡ç­¾åï¼Œ-mæŒ‡å®šè¯´æ˜Žæ–‡å­— git tag -d &lt;tagName&gt; åˆ é™¤æ ‡ç­¾ git push origin &lt;tagname&gt; æŽ¨é€æŸä¸ªæ ‡ç­¾åˆ°è¿œç¨‹ git push origin --tags ä¸€æ¬¡æ€§æŽ¨é€å…¨éƒ¨å°šæœªæŽ¨é€åˆ°è¿œç¨‹çš„æœ¬åœ°æ ‡ç­¾ git push origin :refs/tags/&lt;tagname&gt; åˆ é™¤è¿œç¨‹æ ‡ç­¾&lt;tagname&gt; git config --global color.ui true è®©Gitæ˜¾ç¤ºé¢œè‰²ï¼Œä¼šè®©å‘½ä»¤è¾“å‡ºçœ‹èµ·æ¥æ›´é†’ç›® git add -f &lt;file&gt; å¼ºåˆ¶æäº¤å·²å¿½ç•¥çš„çš„æ–‡ä»¶ git check-ignore -v &lt;file&gt; æ£€æŸ¥ä¸ºä»€ä¹ˆGitä¼šå¿½ç•¥è¯¥æ–‡ä»¶]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å¿«é€ŸæŽ’åº]]></title>
    <url>%2Fposts%2F71d3e504.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ 1ï¼‰é€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´ ,é€šå¸¸é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…æœ€åŽä¸€ä¸ªå…ƒç´ , 2ï¼‰å¦‚æžœé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å…ƒç´ ï¼Œåˆ™å…ˆä»Žå³å‘å·¦æ‰¾æ¯”åŸºå‡†å…ƒç´ å°çš„å…ƒç´ ï¼Œå†ä»Žå·¦å‘å³æ‰¾æ¯”åŸºå‡†å…ƒç´ å¤§çš„å…ƒç´ ï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®ã€‚ï¼ˆå¦‚æžœé€‰æ‹©æœ€åŽä¸€ä¸ªå…ƒç´ åšåŸºå‡†å…ƒç´ ï¼Œåˆ™å…ˆä»Žå·¦å‘å³æ‰¾ï¼‰ç›´åˆ°æ‰¾åˆ°åŒä¸€ä½ç½®ï¼Œè·ŸåŸºå‡†å…ƒç´ ä½ç½®äº¤æ¢ï¼Œç¬¬ä¸€è¶ŸæŽ’åºå°±ç»“æŸã€‚ 3ï¼‰é€šè¿‡ä¸€è¶ŸæŽ’åºå°†è®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…ƒç´ å€¼å‡æ¯”åŸºå‡†å…ƒç´ å€¼å°ã€‚å¦ä¸€éƒ¨åˆ†è®°å½•çš„å…ƒç´ å€¼æ¯”åŸºå‡†å€¼å¤§ã€‚ 4ï¼‰æ­¤æ—¶åŸºå‡†å…ƒç´ åœ¨å…¶æŽ’å¥½åºåŽçš„æ­£ç¡®ä½ç½® 5ï¼‰ç„¶åŽåˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç”¨åŒæ ·çš„æ–¹æ³•ç»§ç»­è¿›è¡ŒæŽ’åºï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ ç®—æ³•æµç¨‹å›¾ å¿«é€ŸæŽ’åºä¹‹æ‰€æ¯”è¾ƒå¿«ï¼Œå› ä¸ºç›¸æ¯”å†’æ³¡æŽ’åºï¼Œæ¯æ¬¡äº¤æ¢æ˜¯è·³è·ƒå¼çš„ã€‚æ¯æ¬¡æŽ’åºçš„æ—¶å€™è®¾ç½®ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œå°†å°äºŽç­‰äºŽåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å·¦è¾¹ï¼Œå°†å¤§äºŽç­‰äºŽåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å³è¾¹ã€‚è¿™æ ·åœ¨æ¯æ¬¡äº¤æ¢çš„æ—¶å€™å°±ä¸ä¼šåƒå†’æ³¡æŽ’åºä¸€æ ·æ¯æ¬¡åªèƒ½åœ¨ç›¸é‚»çš„æ•°ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢çš„è·ç¦»å°±å¤§çš„å¤šäº†ã€‚å› æ­¤æ€»çš„æ¯”è¾ƒå’Œäº¤æ¢æ¬¡æ•°å°±å°‘äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æé«˜äº†ã€‚å½“ç„¶åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªæ•°è¿›è¡Œäº†äº¤æ¢ã€‚å› æ­¤å¿«é€ŸæŽ’åºçš„æœ€å·®æ—¶é—´å¤æ‚åº¦å’Œå†’æ³¡æŽ’åºæ˜¯ä¸€æ ·çš„éƒ½æ˜¯O(N2)ï¼Œå®ƒçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(NlogN)ã€‚ ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¿«é€ŸæŽ’åº */public class QuickSort &#123; /** * å¿«é€ŸæŽ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œé€šè¿‡ä¸€è¶ŸæŽ’åºå°†å¾…æŽ’è®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç»§ç»­è¿›è¡ŒæŽ’åºï¼Œä»¥è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ * &lt;p&gt; * ä¸€è¶Ÿå¿«é€ŸæŽ’åºï¼ˆæˆ–ä¸€æ¬¡åˆ’åˆ†ï¼‰çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆä»»æ„é€‰å–ä¸€ä¸ªè®°å½•ï¼ˆé€šå¸¸å¯é€‰ç¬¬ä¸€ä¸ªè®°å½•ï¼‰ä½œä¸ºæž¢è½´ï¼ˆæˆ–æ”¯ç‚¹ï¼‰ï¼ˆpivotï¼‰ï¼Œç„¶åŽæŒ‰ä¸‹åˆ—åŽŸåˆ™é‡æ–°æŽ’åˆ—å…¶ä½™è®°å½•ï¼šå°†æ‰€æœ‰å…³é”®å­—æ¯”å®ƒå°çš„è®°å½•éƒ½å®‰ç½®åœ¨å®ƒçš„ä½ç½®ä¹‹å‰ï¼Œå°†æ‰€æœ‰å…³é”®å­—æ¯”å®ƒå¤§çš„è®°å½•éƒ½å®‰ç½®åœ¨å®ƒçš„ä½ç½®ä¹‹åŽã€‚ * &lt;p&gt; * ç»è¿‡ä¸€è¶Ÿå¿«é€ŸæŽ’åºä¹‹åŽï¼Œä»¥è¯¥æž¢è½´è®°å½•æœ€åŽæ‰€è½çš„ä½ç½®iä½œåˆ†ç•Œçº¿ï¼Œå°†åºåˆ—åˆ†å‰²æˆä¸¤ä¸ªå­åºåˆ—ï¼Œä¹‹åŽå†åˆ†åˆ«å¯¹åˆ†å‰²æ‰€å¾—çš„ä¸¤ä¸ªå­åºåˆ—è¿›è¡Œå¿«é€ŸæŽ’åºã€‚ * &lt;p&gt; * å¯ä»¥çœ‹å‡ºè¿™ä¸ªç®—æ³•å¯ä»¥é€’å½’å®žçŽ°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®žçŽ°åˆ’åˆ†ï¼Œå¹¶è¿”å›žåˆ†ç•Œä½ç½®ã€‚ç„¶åŽä¸æ–­åœ°è¿™ä¹ˆåˆ†ä¸‹åŽ»ç›´åˆ°æŽ’åºå®Œæˆï¼Œå¯ä»¥çœ‹å‡ºå‡½æ•°çš„è¾“å…¥å‚æ•°éœ€è¦æä¾›åºåˆ—çš„é¦–å°¾ä½ç½®ã€‚ */ public static void quickSort(int[] numArr, int left, int right) &#123; //ä¸ç®¡ä½¿ç”¨å“ªç§åˆ†å‰²æ–¹å¼ï¼Œéƒ½å¯ä»¥é€šè¿‡é€’å½’å½¢å¼è¿›è¡ŒæŽ’åº // éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªifè¯­å¥ä¸èƒ½å°‘ï¼Œä¸ç„¶æ²¡æ³•åœæ­¢ï¼Œä¼šå¯¼è‡´å †æ ˆæº¢å‡ºçš„å¼‚å¸¸ã€‚ if (left &lt; right) &#123; //åˆ†å‰²æ•°ç»„ï¼Œæ‰¾åˆ°åˆ†å‰²ç‚¹ int point = partitionTwo(numArr, left, right); //é€’å½’è°ƒç”¨ï¼Œå¯¹å·¦å­æ•°ç»„è¿›è¡Œå¿«é€ŸæŽ’åº quickSort(numArr, left, point - 1); //é€’å½’è°ƒç”¨ï¼Œå¯¹å³å­æ•°ç»„è¿›è¡Œå¿«é€ŸæŽ’åº quickSort(numArr, point + 1, right); &#125; &#125; /** * åˆ’åˆ†å®žçŽ°1 ï¼ˆæž¢è½´è·³æ¥è·³åŽ»æ³•ï¼‰ * ä¸€è¶Ÿå¿«é€ŸæŽ’åºçš„å®žçŽ°ï¼šè®¾ä¸¤ä¸ªæŒ‡é’ˆleftå’Œrightï¼Œè®¾æž¢è½´è®°å½•çš„å…³é”®å­—ä¸ºfirstï¼Œåˆ™é¦–å…ˆä»Žrightæ‰€æŒ‡ä½ç½®èµ·å‘å‰æœç´¢æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…³é”®å­—å°äºŽfirstçš„è®°å½•å’Œæž¢è½´è®°å½•äº’ç›¸äº¤æ¢ï¼Œ * ç„¶åŽä»Žleftæ‰€æŒ‡ä½ç½®èµ·å‘åŽæœç´¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå…³é”®å­—å¤§äºŽfirstçš„è®°å½•å’Œæž¢è½´è®°å½•äº’ç›¸äº¤æ¢ï¼Œé‡å¤è¿™ä¸¤æ­¥ç›´è‡³left==rightä¸ºæ­¢ã€‚ */ public static int partitionOne(int[] numArr, int left, int right) &#123; //ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åšåŸºå‡†å…ƒç´  int first = numArr[left]; while (left &lt; right) &#123; while (left &lt; right &amp;&amp; numArr[right] &gt;= first) &#123; right--; &#125; //äº¤æ¢ swap(numArr, left, right); while (left &lt; right &amp;&amp; numArr[left] &lt;= first) &#123; left++; &#125; //äº¤æ¢ swap(numArr, left, right); &#125; //è¿”å›žåˆ†å‰²ç‚¹æ‰€åœ¨çš„ä½ç½® return left; &#125; /** * åˆ’åˆ†å®žçŽ°2 ï¼ˆæž¢è½´ä¸€æ¬¡åˆ°ä½æ³•ï¼‰ * partitionOneå®žçŽ°å¯ä»¥çœ‹å‡ºï¼Œæž¢è½´å…ƒç´ ï¼ˆå³æœ€å¼€å§‹é€‰çš„â€œä¸­é—´â€å…ƒç´ ï¼ˆå…¶å®žå¾€å¾€æ˜¯æ‹¿ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºâ€œä¸­é—´â€å…ƒç´ ï¼‰ï¼‰éœ€è¦ä¸æ–­åœ°å’Œå…¶ä»–å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè€Œæ¯äº¤æ¢ä¸€æ¬¡ä½ç½®å®žé™…ä¸Šéœ€è¦ä¸‰æ¬¡èµ‹å€¼æ“ä½œã€‚ * &lt;p&gt; * å®žé™…ä¸Šï¼Œåªæœ‰æœ€åŽleft=rightçš„ä½ç½®æ‰æ˜¯æž¢è½´å…ƒç´ çš„æœ€ç»ˆä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†æž¢è½´å…ƒç´ ä¿å­˜èµ·æ¥ï¼ŒæŽ’åºè¿‡ç¨‹ä¸­åªä½œå…ƒç´ çš„å•å‘ç§»åŠ¨ï¼Œç›´è‡³ä¸€è¶ŸæŽ’åºç»“æŸåŽå†å°†æž¢è½´å…ƒç´ ç§»è‡³æ­£ç¡®çš„ä½ç½®ä¸Šã€‚ * * @return */ public static int partitionTwo(int[] numArr, int left, int right) &#123; int first = numArr[left]; int temp = numArr[left]; while (left &lt; right) &#123; while (left &lt; right &amp;&amp; numArr[right] &gt;= first) &#123; right--; &#125; numArr[left] = numArr[right]; while (left &lt; right &amp;&amp; numArr[left] &lt;= first) &#123; left++; &#125; numArr[right] = numArr[left]; &#125; numArr[left] = temp; return left; &#125; /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªä½ç½®çš„å…ƒç´  */ public static void swap(int[] numArr, int left, int right) &#123; int temp = 0; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; temp = numArr[left]; numArr[left] = numArr[right]; numArr[right] = temp; &#125; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************å¿«é€ŸæŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); quickSort(numArr, 0, numArr.length - 1); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å†’æ³¡æŽ’åº]]></title>
    <url>%2Fposts%2F9ab57c2f.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åœ¨è¦æŽ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œå¯¹å½“å‰è¿˜æœªæŽ’å¥½åºçš„èŒƒå›´å†…çš„å…¨éƒ¨æ•°ï¼Œè‡ªä¸Šè€Œä¸‹å¯¹ç›¸é‚»çš„ä¸¤ä¸ªæ•°ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒå’Œè°ƒæ•´ï¼Œè®©è¾ƒå¤§çš„æ•°å¾€ä¸‹æ²‰ï¼Œè¾ƒå°çš„å¾€ä¸Šå†’ã€‚å³ï¼šæ¯å½“ä¸¤ç›¸é‚»çš„æ•°æ¯”è¾ƒåŽå‘çŽ°å®ƒä»¬çš„æŽ’åºä¸ŽæŽ’åºè¦æ±‚ç›¸åæ—¶ï¼Œå°±å°†å®ƒä»¬äº’æ¢ã€‚ ç®—æ³•æ­¥éª¤ æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æžœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚ å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»Žå¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åŽä¸€å¯¹ã€‚åœ¨è¿™ä¸€ç‚¹ï¼Œæœ€åŽçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚ é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åŽä¸€ä¸ªã€‚ æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚ ç®—æ³•æµç¨‹å›¾ ç®—æ³•æ”¹è¿› å¯¹å†’æ³¡æŽ’åºå¸¸è§çš„æ”¹è¿›æ–¹æ³•æ˜¯åŠ å…¥ä¸€æ ‡å¿—æ€§å˜é‡exchangeï¼Œç”¨äºŽæ ‡å¿—æŸä¸€è¶ŸæŽ’åºè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰æ•°æ®äº¤æ¢ï¼Œå¦‚æžœè¿›è¡ŒæŸä¸€è¶ŸæŽ’åºæ—¶å¹¶æ²¡æœ‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œåˆ™è¯´æ˜Žæ•°æ®å·²ç»æŒ‰è¦æ±‚æŽ’åˆ—å¥½ï¼Œå¯ç«‹å³ç»“æŸæŽ’åºï¼Œé¿å…ä¸å¿…è¦çš„æ¯”è¾ƒè¿‡ç¨‹ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å†’æ³¡æŽ’åº */public class BubbleSort &#123; /** * å†’æ³¡æŽ’åºçš„è¿‡ç¨‹å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªå…ƒç´ çš„å¤§å°å…³ç³»ï¼Œè‹¥é€†åºåˆ™äº¤æ¢ï¼Œè¿™æ ·é€šè¿‡ä¸€è½®æ¯”è¾ƒï¼Œå…³å­å¥æœ€å¤§çš„è®°å½•å°±æ²‰åº•äº†ã€‚ * ä¸€èˆ¬åœ°ï¼Œç¬¬iè¶Ÿå†’æ³¡æŽ’åºä»Žç¬¬ä¸€ä¸ªå…ƒç´ èµ·åˆ°ç¬¬n-i+1ä¸ªå…ƒç´ ä¾æ¬¡æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªè®°å½•çš„å…³é”®å­—ï¼Œå¹¶åœ¨é€†åºæ—¶äº¤æ¢ç›¸é‚»è®°å½•ï¼Œå…¶ç»“æžœå°±æ˜¯è¿™n-i+1ä¸ªè®°å½•ä¸­å…³é”®å­—æœ€å¤§çš„è®°å½•è¢«äº¤æ¢åˆ°n-i+1çš„ä½ç½®ä¸Šã€‚ * å½“ç„¶ä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œä»ŽåŽå¾€å‰è¿›è¡Œï¼Œè¿™æ ·æ¯ç»è¿‡ä¸€è¶ŸæŽ’åºï¼Œå°±æŠŠæœªæŽ’åºçš„åºåˆ—ä¸­æœ€å°çš„å…ƒç´ æ”¾åœ¨å®ƒåº”å½“å¤„äºŽçš„ä½ç½®ä¸Šï¼Œç„¶åŽä¸‹æ¬¡æ¯”è¾ƒå°±ä¸å†è®©å‰é¢çš„å…ƒç´ å‚ä¸Žäº†ã€‚ * æ•´ä¸ªæŽ’åºè¿‡ç¨‹éœ€è¦è¿›è¡Œkè¶Ÿå†’æ³¡æŽ’åºï¼Œå…¶ä¸­kè‡³å°‘ä¸º1ï¼Œè‡³å¤šä¸ºn-1æ¬¡ï¼Œå¦‚æžœä¸€è¶Ÿå†’æ³¡æŽ’åºä¸­æ²¡æœ‰å‡ºçŽ°äº¤æ¢å…ƒç´ çš„æ“ä½œï¼Œåˆ™è¯´æ˜Žåºåˆ—å·²ç»æœ‰åºäº†ï¼Œå¯ä»¥åœæ­¢æŽ’åºäº†ã€‚ * æ—¶é—´å¤æ‚åº¦ï¼šæ­£åºæ—¶O(n)ï¼Œ é€†åºæ—¶O(n2)ï¼Œå¹³å‡æ—¶é—´å¤æ‚æ€§O(n2)ã€‚ä½¿ç”¨temp ä½œä¸ºä¸´æ—¶äº¤æ¢å˜é‡ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1). * &lt;p&gt; * ä¸€èˆ¬æƒ…å†µä¸‹è²Œä¼¼æ•ˆçŽ‡ä¸åŠç›´æŽ¥æ’å…¥æŽ’åºï¼ˆå°½ç®¡å®ƒä»¬çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n2)ï¼‰ã€‚ */ public static void bubbleSort(int[] numArr) &#123; int length = numArr.length; //æœ€å¤šlength-1æ¬¡æŽ’åº for (int i = 0; i &lt; length; i++) &#123; //æ¯ä¸€è½®å¤šå°‘å…ƒç´ å‚ä¸ŽæŽ’åº for (int j = 0; j &lt; length - 1 - i; j++) &#123; if (numArr[j] &gt; numArr[j + 1]) &#123; /** * äº¤æ¢é¡ºåºï¼Œä¸ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œåˆ©ç”¨ * a = a + b; * b = a - b; * a = a - b; */ numArr[j] = numArr[j] + numArr[j + 1]; numArr[j + 1] = numArr[j] - numArr[j + 1]; numArr[j] = numArr[j] - numArr[j + 1]; &#125; &#125; &#125; &#125; /** * æ”¹è¿›ç‰ˆå†’æ³¡ï¼šå½“æŸè¶ŸæŽ’åºæ²¡æœ‰å…ƒç´ äº¤æ¢çš„æ—¶å€™ï¼Œè¯æ˜Žæ•´ä¸ªåºåˆ—æœ‰åºï¼Œæ— éœ€å†å¾ªçŽ¯æ¯”è¾ƒ * * @param numArr */ public static void bubbleSortImprove(int[] numArr) &#123; int length = numArr.length; //è®¾ç½®æ ‡å¿—å˜é‡ï¼Œè¿™æ ·å½“åºåˆ—æœ‰åºæ—¶åŠæ—¶é€€å‡ºå¾ªçŽ¯ï¼Œé¿å…å†—ä½™å¤„ç†ã€‚ boolean sorted = false; //æœ€å¤šlength-1æ¬¡æŽ’åº for (int i = 0; i &lt; length; i++) &#123; sorted = true; //æ¯ä¸€è½®å¤šå°‘å…ƒç´ å‚ä¸ŽæŽ’åº for (int j = 0; j &lt; length - 1 - i; j++) &#123; if (numArr[j] &gt; numArr[j + 1]) &#123; /** * äº¤æ¢é¡ºåºï¼Œä¸ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œåˆ©ç”¨ * a = a + b; * b = a - b; * a = a - b; */ numArr[j] = numArr[j] + numArr[j + 1]; numArr[j + 1] = numArr[j] - numArr[j + 1]; numArr[j] = numArr[j] - numArr[j + 1]; sorted = false; &#125; &#125; if (sorted) &#123; break; &#125; &#125; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************å†’æ³¡æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); bubbleSortImprove(numArr); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å †æŽ’åº]]></title>
    <url>%2Fposts%2F1ca0adae.html</url>
    <content type="text"><![CDATA[å †æŽ’åºæ˜¯ä¸€ç§æ ‘å½¢é€‰æ‹©æŽ’åºï¼Œæ˜¯å¯¹ç›´æŽ¥é€‰æ‹©æŽ’åºçš„æœ‰æ•ˆæ”¹è¿›ã€‚ åŸºæœ¬æ€æƒ³ å †çš„å®šä¹‰å¦‚ä¸‹ï¼šå…·æœ‰nä¸ªå…ƒç´ çš„åºåˆ—ï¼ˆk1,k2,...,kn),å½“ä¸”ä»…å½“æ»¡è¶³ æ—¶ç§°ä¹‹ä¸ºå †ã€‚ç”±å †çš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå †é¡¶å…ƒç´ ï¼ˆå³ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å¿…ä¸ºæœ€å°é¡¹ï¼ˆå°é¡¶å †ï¼‰ã€‚ è‹¥ä»¥ä¸€ç»´æ•°ç»„å­˜å‚¨ä¸€ä¸ªå †ï¼Œåˆ™å †å¯¹åº”ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œä¸”æ‰€æœ‰éžå¶ç»“ç‚¹çš„å€¼å‡ä¸å¤§äºŽ(æˆ–ä¸å°äºŽ)å…¶å­å¥³çš„å€¼ï¼Œæ ¹ç»“ç‚¹ï¼ˆå †é¡¶å…ƒç´ ï¼‰çš„å€¼æ˜¯æœ€å°(æˆ–æœ€å¤§)çš„ã€‚å¦‚ï¼š ï¼ˆaï¼‰å¤§é¡¶å †åºåˆ—ï¼šï¼ˆ96, 83,27,38,11,09) ï¼ˆbï¼‰å°é¡¶å †åºåˆ—ï¼šï¼ˆ12ï¼Œ36ï¼Œ24ï¼Œ85ï¼Œ47ï¼Œ30ï¼Œ53ï¼Œ91ï¼‰ åˆå§‹æ—¶æŠŠè¦æŽ’åºçš„nä¸ªæ•°çš„åºåˆ—çœ‹ä½œæ˜¯ä¸€æ£µé¡ºåºå­˜å‚¨çš„äºŒå‰æ ‘ï¼ˆä¸€ç»´æ•°ç»„å­˜å‚¨äºŒå‰æ ‘ï¼‰ï¼Œè°ƒæ•´å®ƒä»¬çš„å­˜å‚¨é¡ºåºï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªå †ï¼Œå°†å †é¡¶å…ƒç´ è¾“å‡ºï¼Œå¾—åˆ°n ä¸ªå…ƒç´ ä¸­æœ€å°(æˆ–æœ€å¤§)çš„å…ƒç´ ï¼Œè¿™æ—¶å †çš„æ ¹èŠ‚ç‚¹çš„æ•°æœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰ã€‚ç„¶åŽå¯¹å‰é¢(n-1)ä¸ªå…ƒç´ é‡æ–°è°ƒæ•´ä½¿ä¹‹æˆä¸ºå †ï¼Œè¾“å‡ºå †é¡¶å…ƒç´ ï¼Œå¾—åˆ°n ä¸ªå…ƒç´ ä¸­æ¬¡å°(æˆ–æ¬¡å¤§)çš„å…ƒç´ ã€‚ä¾æ­¤ç±»æŽ¨ï¼Œç›´åˆ°åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„å †ï¼Œå¹¶å¯¹å®ƒä»¬ä½œäº¤æ¢ï¼Œæœ€åŽå¾—åˆ°æœ‰nä¸ªèŠ‚ç‚¹çš„æœ‰åºåºåˆ—ã€‚ç§°è¿™ä¸ªè¿‡ç¨‹ä¸ºå †æŽ’åºã€‚ å› æ­¤ï¼Œå®žçŽ°å †æŽ’åºéœ€è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š å¦‚ä½•å°†n ä¸ªå¾…æŽ’åºçš„æ•°å»ºæˆå †ï¼› è¾“å‡ºå †é¡¶å…ƒç´ åŽï¼Œæ€Žæ ·è°ƒæ•´å‰©ä½™n-1 ä¸ªå…ƒç´ ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ–°å †ã€‚ é¦–å…ˆè®¨è®ºç¬¬äºŒä¸ªé—®é¢˜ï¼šè¾“å‡ºå †é¡¶å…ƒç´ åŽï¼Œå¯¹å‰©ä½™n-1å…ƒç´ é‡æ–°å»ºæˆå †çš„è°ƒæ•´è¿‡ç¨‹ã€‚ è°ƒæ•´å°é¡¶å †çš„æ–¹æ³•ï¼š 1ï¼‰è®¾æœ‰m ä¸ªå…ƒç´ çš„å †ï¼Œè¾“å‡ºå †é¡¶å…ƒç´ åŽï¼Œå‰©ä¸‹m-1 ä¸ªå…ƒç´ ã€‚å°†å †åº•å…ƒç´ é€å…¥å †é¡¶ï¼ˆï¼ˆæœ€åŽä¸€ä¸ªå…ƒç´ ä¸Žå †é¡¶è¿›è¡Œäº¤æ¢ï¼‰ï¼Œå †è¢«ç ´åï¼Œå…¶åŽŸå› ä»…æ˜¯æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ã€‚ 2ï¼‰å°†æ ¹ç»“ç‚¹ä¸Žå·¦ã€å³å­æ ‘ä¸­è¾ƒå°å…ƒç´ çš„è¿›è¡Œäº¤æ¢ã€‚ 3ï¼‰è‹¥ä¸Žå·¦å­æ ‘äº¤æ¢ï¼šå¦‚æžœå·¦å­æ ‘å †è¢«ç ´åï¼Œå³å·¦å­æ ‘çš„æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ï¼Œåˆ™é‡å¤æ–¹æ³• ï¼ˆ2ï¼‰. 4ï¼‰è‹¥ä¸Žå³å­æ ‘äº¤æ¢ï¼Œå¦‚æžœå³å­æ ‘å †è¢«ç ´åï¼Œå³å³å­æ ‘çš„æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ã€‚åˆ™é‡å¤æ–¹æ³• ï¼ˆ2ï¼‰. 5ï¼‰ç»§ç»­å¯¹ä¸æ»¡è¶³å †æ€§è´¨çš„å­æ ‘è¿›è¡Œä¸Šè¿°äº¤æ¢æ“ä½œï¼Œç›´åˆ°å¶å­ç»“ç‚¹ï¼Œå †è¢«å»ºæˆã€‚ ç§°è¿™ä¸ªè‡ªæ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è°ƒæ•´è¿‡ç¨‹ä¸ºç­›é€‰ã€‚å¦‚å›¾ï¼š å†è®¨è®ºå¯¹n ä¸ªå…ƒç´ åˆå§‹å»ºå †çš„è¿‡ç¨‹ã€‚ å»ºå †æ–¹æ³•ï¼šå¯¹åˆå§‹åºåˆ—å»ºå †çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªåå¤è¿›è¡Œç­›é€‰çš„è¿‡ç¨‹ã€‚ 1ï¼‰n ä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ™æœ€åŽä¸€ä¸ªç»“ç‚¹æ˜¯ç¬¬ä¸ªç»“ç‚¹çš„å­æ ‘ã€‚ 2ï¼‰ç­›é€‰ä»Žç¬¬ ä¸ªç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘å¼€å§‹ï¼Œè¯¥å­æ ‘æˆä¸ºå †ã€‚ 3ï¼‰ä¹‹åŽå‘å‰ä¾æ¬¡å¯¹å„ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘è¿›è¡Œç­›é€‰ï¼Œä½¿ä¹‹æˆä¸ºå †ï¼Œç›´åˆ°æ ¹ç»“ç‚¹ã€‚ å¦‚å›¾å»ºå †åˆå§‹è¿‡ç¨‹ï¼šæ— åºåºåˆ—ï¼šï¼ˆ49ï¼Œ38ï¼Œ65ï¼Œ97ï¼Œ76ï¼Œ13ï¼Œ27ï¼Œ49ï¼‰ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å †æŽ’åº */public class HeapSort &#123; /** * å †æŽ’åºçš„æ˜¯é›†åˆäº†æ’å…¥æŽ’åºçš„å•æ•°ç»„æ“ä½œï¼Œåˆæœ‰å½’å¹¶æŽ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå®Œç¾Žçš„ç»“åˆäº†2è€…çš„ä¼˜ç‚¹ã€‚ */ public static void heapSort(int[] numArr) &#123; //å°†æ— åºå †æž„é€ æˆä¸€ä¸ªå¤§æ ¹å †ï¼Œå¤§æ ¹å †æœ‰length/2ä¸ªçˆ¶èŠ‚ç‚¹ for (int i = numArr.length / 2 - 1; i &gt;= 0; i--) &#123; headAdjust(numArr, i, numArr.length); &#125; //é€æ­¥å°†æ¯ä¸ªæœ€å¤§å€¼çš„æ ¹èŠ‚ç‚¹ä¸Žæœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå¹¶ä¸”å†è°ƒæ•´å…¶ä¸ºæœ€å¤§å † for (int i = numArr.length - 1; i &gt; 0; i--) &#123; //å°†å †é¡¶å…ƒç´ å’Œå½“å‰æœªç»æŽ’åºçš„å­åºåˆ—çš„æœ€åŽä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½® swap(numArr, 0, i); headAdjust(numArr, 0, i); &#125; &#125; /** * æž„é€ å¤§æ ¹å † */ public static void headAdjust(int[] numArr, int parent, int length) &#123; //ä¿å­˜å½“å‰çˆ¶èŠ‚ç‚¹ int temp = numArr[parent]; //å¾—åˆ°å·¦å­©å­ int leftChild = 2 * parent + 1; while (leftChild &lt; length) &#123; //å¦‚æžœparentæœ‰å·¦å­©å­ï¼Œåˆ™è¦åˆ¤æ–­å·¦å­©å­æ˜¯å¦å°äºŽå³å­©å­ if (leftChild + 1 &lt; length &amp;&amp; numArr[leftChild] &lt; numArr[leftChild + 1]) &#123; leftChild++; &#125; //å¦‚æžœçˆ¶èŠ‚ç‚¹å¤§äºŽå­èŠ‚ç‚¹ï¼Œå°±ä¸äº¤æ¢ if (temp &gt;= numArr[leftChild]) &#123; break; &#125; //å°†è¾ƒå¤§å­èŠ‚ç‚¹çš„å€¼èµ‹ç»™çˆ¶èŠ‚ç‚¹ numArr[parent] = numArr[leftChild]; //ç„¶åŽå°†å­èŠ‚ç‚¹ä½œä¸ºçˆ¶èŠ‚ç‚¹ parent = leftChild; //æ‰¾åˆ°è¯¥çˆ¶èŠ‚ç‚¹è¾ƒå°çš„å·¦å­©å­ leftChild = 2 * parent + 1; &#125; //æœ€åŽå°†tempçš„å€¼èµ‹ç»™è¾ƒå¤§çš„å­èŠ‚ç‚¹ï¼Œä»¥å½¢æˆä¸¤å€¼äº¤æ¢ numArr[parent] = temp; &#125; /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªä½ç½®çš„å…ƒç´  */ public static void swap(int[] numArr, int top, int last) &#123; int temp = numArr[top]; numArr[top] = numArr[last]; numArr[last] = temp; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************å †æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); heapSort(numArr); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼--å•ä¾‹æ¨¡å¼]]></title>
    <url>%2Fposts%2F6d67519e.html</url>
    <content type="text"><![CDATA[å•ä¾‹æ¨¡å¼ä»‹ç» ** æ„å›¾ **ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ ** ä¸»è¦è§£å†³ **ï¼šä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»é¢‘ç¹åœ°åˆ›å»ºä¸Žé”€æ¯ã€‚ ** ä½•æ—¶ä½¿ç”¨ **ï¼šå½“æ‚¨æƒ³æŽ§åˆ¶å®žä¾‹æ•°ç›®ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºçš„æ—¶å€™ã€‚ ** å¦‚ä½•è§£å†³ **ï¼šåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰è¿™ä¸ªå•ä¾‹ï¼Œå¦‚æžœæœ‰åˆ™è¿”å›žï¼Œå¦‚æžœæ²¡æœ‰åˆ™åˆ›å»ºã€‚ ** å…³é”®ä»£ç  **ï¼šæž„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚ ** ä¼˜ç‚¹ **ï¼š åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®žä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®žä¾‹ï¼ˆæ¯”å¦‚ç®¡ç†å­¦é™¢é¦–é¡µé¡µé¢ç¼“å­˜ï¼‰ã€‚ é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚ ** ç¼ºç‚¹ **ï¼šæ²¡æœ‰æŽ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸Žå•ä¸€èŒè´£åŽŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€Žä¹ˆæ ·æ¥å®žä¾‹åŒ–ã€‚ ** ä½¿ç”¨åœºæ™¯ **ï¼š è¦æ±‚ç”Ÿäº§å”¯ä¸€åºåˆ—å·ã€‚ WEB ä¸­çš„è®¡æ•°å™¨ï¼Œä¸ç”¨æ¯æ¬¡åˆ·æ–°éƒ½åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€æ¬¡ï¼Œç”¨å•ä¾‹å…ˆç¼“å­˜èµ·æ¥ã€‚ åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡éœ€è¦æ¶ˆè€—çš„èµ„æºè¿‡å¤šï¼Œæ¯”å¦‚ I/O ä¸Žæ•°æ®åº“çš„è¿žæŽ¥ç­‰ã€‚ æ³¨æ„äº‹é¡¹ï¼šgetInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ instance è¢«å¤šæ¬¡å®žä¾‹åŒ–ã€‚ å®žçŽ°æ–¹å¼ é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 12345678910111213141516171819202122package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ * ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®žä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ * ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®žä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæžœã€‚å¦‚æžœä»Žå§‹è‡³ç»ˆä»Žæœªä½¿ç”¨è¿‡è¿™ä¸ªå®žä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚ */public class Hungry &#123; //è‡ªæœ‰æ°¸ä¹…çš„å¯¹è±¡ private static final Hungry hungry = new Hungry(); //æž„é€ å™¨ç§æœ‰åŒ– private Hungry() &#123; System.out.println("é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰..."); &#125; public static Hungry getInstance() &#123; return hungry; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ */ Hungry hungry = Hungry.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„hungryå¯¹è±¡çš„hashCodeï¼š" + hungry.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ * å°†ç±»å®žä¾‹åŒ–çš„è¿‡ç¨‹æ”¾åœ¨äº†é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆå§‹åŒ–ç±»çš„å®žä¾‹ã€‚ * ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®žä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ * ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®žä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæžœã€‚å¦‚æžœä»Žå§‹è‡³ç»ˆä»Žæœªä½¿ç”¨è¿‡è¿™ä¸ªå®žä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚ */public class Hungry2 &#123; private static Hungry2 hungry2; static &#123; hungry2 = new Hungry2(); &#125; private Hungry2() &#123; System.out.println("é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰..."); &#125; public static Hungry2 getInstance() &#123; return hungry2; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ */ Hungry2 hungry2 = Hungry2.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„hungry2å¯¹è±¡çš„hashCodeï¼š" + hungry2.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 123456789101112131415161718192021222324package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ * è¿™ç§å†™æ³•èµ·åˆ°äº†Lazy Loadingçš„æ•ˆæžœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚ * å¦‚æžœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†if (singleton == null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œ * è¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®žä¾‹ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹çŽ¯å¢ƒä¸‹ä¸å¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ */public class Lazy &#123; private static Lazy lazy; private Lazy() &#123; System.out.println("æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰..."); &#125; public static Lazy getInstance() &#123; if (lazy == null) &#123; lazy = new Lazy(); &#125; return lazy; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ */ Lazy lazy = Lazy.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„lazyå¯¹è±¡çš„hashCodeï¼š" + lazy.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æŽ¨èç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 123456789101112131415161718192021222324package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æŽ¨èç”¨ã€‘ * æœ‰ç‚¹ï¼šè§£å†³äº†çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œåšä¸ªçº¿ç¨‹åŒæ­¥å°±å¯ä»¥äº†ï¼ŒäºŽæ˜¯å°±å¯¹getInstance()æ–¹æ³•è¿›è¡Œäº†çº¿ç¨‹åŒæ­¥ã€‚ * ç¼ºç‚¹ï¼šæ•ˆçŽ‡å¤ªä½Žäº†ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æƒ³èŽ·å¾—ç±»çš„å®žä¾‹æ—¶å€™ï¼Œæ‰§è¡ŒgetInstance()æ–¹æ³•éƒ½è¦è¿›è¡ŒåŒæ­¥ã€‚ * è€Œå…¶å®žè¿™ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡å®žä¾‹åŒ–ä»£ç å°±å¤Ÿäº†ï¼ŒåŽé¢çš„æƒ³èŽ·å¾—è¯¥ç±»å®žä¾‹ï¼Œç›´æŽ¥returnå°±è¡Œäº†ã€‚æ–¹æ³•è¿›è¡ŒåŒæ­¥æ•ˆçŽ‡å¤ªä½Žè¦æ”¹è¿›ã€‚ */public class Lazy2 &#123; private static Lazy2 lazy; private Lazy2() &#123; System.out.println("æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)..."); &#125; public static synchronized Lazy2 getInstance() &#123; if (lazy == null) &#123; lazy = new Lazy2(); &#125; return lazy; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æŽ¨èç”¨ã€‘ */ Lazy2 lazy2 = Lazy2.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„lazy2å¯¹è±¡çš„hashCodeï¼š" + lazy2.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ ï¼Œ åŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ ï¼Œ åŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ * ç”±äºŽåŒæ­¥æ–¹æ³•çš„åŒæ­¥æ•ˆçŽ‡å¤ªä½Žï¼Œæ‰€ä»¥æ‘’å¼ƒåŒæ­¥æ–¹æ³•ï¼Œæ”¹ä¸ºåŒæ­¥äº§ç”Ÿå®žä¾‹åŒ–çš„çš„ä»£ç å—ã€‚ * ä½†æ˜¯è¿™ç§åŒæ­¥å¹¶ä¸èƒ½èµ·åˆ°çº¿ç¨‹åŒæ­¥çš„ä½œç”¨ã€‚å‡å¦‚ä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†if (singleton == null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®žä¾‹ã€‚ */public class Lazy3 &#123; private static volatile Lazy3 lazy; private Lazy3() &#123; System.out.println("æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)..."); &#125; public static Lazy3 getInstance() &#123; if (lazy == null) &#123; synchronized (Lazy3.class) &#123; lazy = new Lazy3(); &#125; &#125; return lazy; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ */ Lazy3 lazy3 = Lazy3.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„lazy3å¯¹è±¡çš„hashCodeï¼š" + lazy3.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š é™æ€å†…éƒ¨ç±»ã€æŽ¨èç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é™æ€å†…éƒ¨ç±»ã€æŽ¨èç”¨ã€‘ * è¿™ç§æ–¹å¼è·Ÿé¥¿æ±‰å¼æ–¹å¼é‡‡ç”¨çš„æœºåˆ¶ç±»ä¼¼ï¼Œä½†åˆæœ‰ä¸åŒã€‚ä¸¤è€…éƒ½æ˜¯é‡‡ç”¨äº†ç±»è£…è½½çš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–å®žä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸åŒçš„åœ°æ–¹åœ¨é¥¿æ±‰å¼æ–¹å¼æ˜¯åªè¦Singletonç±»è¢«è£…è½½å°±ä¼šå®žä¾‹åŒ–ï¼Œæ²¡æœ‰Lazy-Loadingçš„ä½œç”¨ï¼Œè€Œé™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨Singletonç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®žä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®žä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨getInstanceæ–¹æ³•ï¼Œæ‰ä¼šè£…è½½SingletonInstanceç±»ï¼Œä»Žè€Œå®ŒæˆSingletonçš„å®žä¾‹åŒ–ã€‚ * &lt;p&gt; * ç±»çš„é™æ€å±žæ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVMå¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚ * &lt;p&gt; * ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ•ˆçŽ‡é«˜ã€‚ */public class StaticInnerClass &#123; private StaticInnerClass() &#123; System.out.println("é™æ€å†…éƒ¨ç±»..."); &#125; private static class SingletonInstance &#123; private static StaticInnerClass instance = new StaticInnerClass(); &#125; public static StaticInnerClass getInstance() &#123; return SingletonInstance.instance; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * é™æ€å†…éƒ¨ç±»ã€æŽ¨èç”¨ã€‘ */ StaticInnerClass staticInnerClass = StaticInnerClass.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„staticInnerClasså¯¹è±¡çš„hashCodeï¼š" + staticInnerClass.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š åŒé‡æ£€æŸ¥ã€æŽ¨èç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.single;/** * @author: whb * @description: åŒé‡æ£€æŸ¥ã€æŽ¨èç”¨ã€‘ * æˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡if (doubleCheck == null)æ£€æŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚è¿™æ ·ï¼Œå®žä¾‹åŒ–ä»£ç åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼ŒåŽé¢å†æ¬¡è®¿é—®æ—¶ï¼Œåˆ¤æ–­if (doubleCheck == null)ï¼Œç›´æŽ¥returnå®žä¾‹åŒ–å¯¹è±¡ã€‚ * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼›å»¶è¿ŸåŠ è½½ï¼›æ•ˆçŽ‡è¾ƒé«˜ã€‚ */public class DoubleCheck &#123; private static volatile DoubleCheck doubleCheck; private DoubleCheck() &#123; System.out.println("åŒé‡æ£€æŸ¥..."); &#125; public static DoubleCheck getInstance() &#123; if (doubleCheck == null) &#123; synchronized (DoubleCheck.class) &#123; if (doubleCheck == null) &#123; doubleCheck = new DoubleCheck(); &#125; &#125; &#125; return doubleCheck; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * åŒé‡æ£€æŸ¥ã€æŽ¨èç”¨ã€‘ */ DoubleCheck doubleCheck = DoubleCheck.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„doubleCheckå¯¹è±¡çš„hashCodeï¼š" + doubleCheck.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š æžšä¸¾ã€æŽ¨èç”¨ã€‘ ** ä»£ç å®žçŽ° **ï¼š 12345678910111213package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æžšä¸¾ã€æŽ¨èç”¨ã€‘ * ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ */public enum EnumSingleton &#123; Instance; public void whatEverMethod() &#123; &#125;&#125; ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest &#123; public static void main(String[] args) &#123; for (int i = 0; i &lt; 10; i++) &#123; int finalI = i; new Thread(() -&gt; &#123; /** * åŒé‡æ£€æŸ¥ã€æŽ¨èç”¨ã€‘ */ DoubleCheck doubleCheck = DoubleCheck.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡èŽ·å¾—çš„doubleCheckå¯¹è±¡çš„hashCodeï¼š" + doubleCheck.hashCode()); &#125;).start(); &#125; &#125;&#125; ** è¾“å‡ºç»“æžœ **ï¼š]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - å¸Œå°”æŽ’åº]]></title>
    <url>%2Fposts%2F94971cbd.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å…ˆå°†æ•´ä¸ªå¾…æŽ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æŽ¥æ’å…¥æŽ’åºã€‚å¸Œå°”æŽ’åºï¼Œä¹Ÿç§°é€’å‡å¢žé‡æŽ’åºç®—æ³•ï¼Œæ˜¯æ’å…¥æŽ’åºçš„ä¸€ç§é«˜é€Ÿè€Œç¨³å®šçš„æ”¹è¿›ç‰ˆæœ¬ã€‚ æ“ä½œæ–¹æ³• é€‰æ‹©ä¸€ä¸ªå¢žé‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1ï¼› æŒ‰å¢žé‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶ŸæŽ’åºï¼› æ¯è¶ŸæŽ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢žé‡tiï¼Œå°†å¾…æŽ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºã€‚ä»…å¢žé‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚ ç®—æ³•æµç¨‹å›¾ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¸Œå°”æŽ’åº */public class ShellSort &#123; /** * å¸Œå°”æŽ’åºï¼ˆShellâ€™s Sortï¼‰åˆç§°â€œç¼©å°å¢žé‡æŽ’åºâ€(Diminishing Increment Sort)ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§å±žäºŽæ’å…¥æŽ’åºç±»çš„æ–¹æ³•ï¼Œä½†åœ¨æ—¶é—´æ•ˆçŽ‡ä¸Šæ¯”ç›´æŽ¥æ’å…¥æŽ’åºæ–¹æ³•æœ‰è¾ƒå¤§çš„æ”¹è¿›ã€‚ * ä»Žå¯¹ç›´æŽ¥æ’å…¥æŽ’åºçš„åˆ†æžå¯çŸ¥ï¼Œå…¶ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(n2)ï¼Œä½†æ˜¯ï¼Œè‹¥å¾…æŽ’è®°å½•åºåˆ—ä¸ºâ€œæ­£åºâ€æ—¶ï¼Œå…¶æ—¶é—´å¤æ‚åº¦å¯æé«˜è‡³O(n)ã€‚ * ç”±æ­¤è®¾æƒ³ï¼Œè‹¥å¾…æŽ’è®°å½•åºåˆ—æŒ‰å…³é”®å­—â€œåŸºæœ¬æœ‰åºâ€ï¼Œç›´æŽ¥æ’å…¥æŽ’åºçš„æ•ˆçŽ‡å°±å¯ä»¥å¤§å¤§æé«˜ã€‚ * ä»Žå¦ä¸€æ–¹é¢æ¥çœ‹ï¼Œç”±äºŽç›´æŽ¥æ’å…¥æŽ’åºç®—æ³•ç®€å•ï¼Œæ‰€ä»¥åœ¨nå€¼å¾ˆå°æ—¶æ•ˆçŽ‡æ¯”è¾ƒé«˜ã€‚å¸Œå°”æŽ’åºæ­£æ˜¯ä»Žè¿™ä¸¤ç‚¹åˆ†æžå‡ºå‘å¯¹ç›´æŽ¥æ’å…¥æŽ’åºè¿›è¡Œæ”¹è¿›è€Œå¾—åˆ°çš„ä¸€ç§æ’å…¥æŽ’åºæ–¹æ³•ã€‚ * &lt;p&gt; * å¸Œå°”æŽ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æŽ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¸€æ¬¡ç›´æŽ¥æ’å…¥æŽ’åºã€‚ï¼ˆè¿™æ˜¯ã€Šæ•°æ®ç»“æž„ã€‹è¿™æœ¬ä¹¦é‡Œçš„è¯´æ³•ã€‚ï¼‰ * &lt;p&gt; * é€šä¿—ç‚¹è¯´å°±æ˜¯ï¼šå…ˆå–è¾ƒå¤§çš„æ­¥é•¿å¯¹å¾…æŽ’åºåˆ—è¿›è¡Œç›´æŽ¥æ’å…¥æŽ’åºï¼Œæ¯æŽ’ä¸€æ¬¡å°±ç¼©å°ä¸€æ¬¡æ­¥é•¿ï¼Œå†è¿›è¡Œæ’å…¥æŽ’åºï¼Œç›´åˆ°æœ€åŽæ­¥é•¿å˜ä¸º1ã€‚ */ public static void shellSort(int[] numArr) &#123; int length = numArr.length; //å–å¢žé‡ int gap = length / 2; while (gap &gt;= 1) &#123; //æ— åºåºåˆ— for (int i = gap; i &lt; length; i++) &#123; int temp = numArr[i]; int j; //æœ‰åºåºåˆ— for (j = i - gap; j &gt;= 0 &amp;&amp; numArr[j] &gt; temp; j = j - gap) &#123; numArr[j + gap] = numArr[j]; &#125; numArr[j + gap] = temp; &#125; //ç¼©å°å¢žé‡ gap = gap / 2; &#125; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************å¸Œå°”æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); shellSort(numArr); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - ç æŽ’åº]]></title>
    <url>%2Fposts%2Fbe6df974.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å°†æ¯ä¸ªæ•°ç”¨ç å­è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šæ•°å­—5å°±æ˜¯5ä¸ªç å­ã€‚ç”¨ç å­è¡¨ç¤ºå¥½æ¯ä¸€ä¸ªæ•°åŽï¼Œè®©æ‰€æœ‰çš„ç å­è‡ªç”±ä¸‹è½ã€‚æŽ’åºå®Œæˆã€‚ ä¸Šå›¾ä¸­çš„ä¸‰ä¸ªç å°±è¡¨ç¤ºæ•°å­—3,ä¸¤ä¸ªç è¡¨ç¤ºæ•°å­—2,è¿™ä¸ªOKäº†ç»§ç»­,è¿™é‡Œçš„3å’Œ2éƒ½å«beadã€‚ ä¸Šå›¾(a)ä¸­æœ‰ä¸¤ä¸ªæ•°å­—,4å’Œ3,åˆ†åˆ«ä¸²åœ¨å››æ¡çº¿ä¸Š,äºŽæ˜¯æ•°å­—4çš„æœ€åŽä¸€ä¸ªç å­ä¸‹è½,å› ä¸ºå®ƒä¸‹è¾¹æ˜¯ç©ºçš„,è‡ªç”±ä¸‹è½åŽå˜æˆä¸Šå›¾(b) ä¸Šå›¾(c)ä¸­éšæœºç»™äº†å››ä¸ªæ•°å­—,åˆ†åˆ«æ˜¯3,2,4,2,è¿™äº›ç å­è‡ªç”±ä¸‹è½,å°±å˜æˆäº†(d)ä¸­,è½å®Œå°±æœ‰åºäº†,2,2,3,4 ä»¥ä¸Šå°±æ˜¯ç æŽ’åºçš„ç²¾åŽã€‚ ä¸Šå›¾ä¸­çš„nè¡¨ç¤ºå¾…æŽ’åºæ•°ç»„çš„é•¿åº¦,æœ‰å¤šå°‘æ•°å­—å°±æœ‰å¤šå°‘å±‚,æ¨ªå‘è¡¨ç¤ºä¸€å±‚;mè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªç å­,å°±æ˜¯å¤šå°‘ä¸ª1,è¿™å–å†³äºŽæœ€å¤§æ•°æ˜¯å‡ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚å¾…æŽ’æ•°ç»„[6 2 4 1 5 9]ã€‚ è®©ç å­å…¨éƒ¨åšè‡ªç”±è½ä½“è¿åŠ¨ 9æ²¡æœ‰ä»€ä¹ˆå¥½è½çš„,å®ƒåœ¨æœ€åº•å±‚ 5ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½è½çš„,å…¨éƒ¨æœ‰æ”¯æ’‘ç‚¹ 1åŒæ ·ä¸éœ€è¦æ»‘è½ 4é™¤äº†ç¬¬ä¸€ä¸ªç å­ä¸åŠ¨å¤–,å…¶å®ƒä¸‰é¢—å…¨éƒ¨ä¸‹è½,è½åˆ°1çš„ä½ç½®å˜æˆä¸‹è¾¹è¿™æ · è¿‡ç¨‹çš„ç»†èŠ‚ä¸ç”»äº†,åŽŸåˆ™å°±æ˜¯ä½ ä¸‹è¾¹æœ‰æ”¯ç‚¹,ä½ å°±ä¸ç”¨å†æ»‘è½äº†,æœ€åŽå˜æˆä¸‹è¾¹è¿™æ ·,æŽ’åºå®Œæ¯•ã€‚ ä»Žä¸Šåˆ°ä¸‹é¡ºåºè¾“å‡ºå³å¯å¾—åˆ°ç»“æžœ:[ 1 2 4 5 6 9]ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: ç æŽ’åº:å°†æ¯ä¸ªæ•°ç”¨ç å­è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šæ•°å­—5å°±æ˜¯5ä¸ªç å­ã€‚ç”¨ç å­è¡¨ç¤ºå¥½æ¯ä¸€ä¸ªæ•°åŽï¼Œè®©æ‰€æœ‰çš„ç å­è‡ªç”±ä¸‹è½ã€‚æŽ’åºå®Œæˆã€‚ */public class BeadSort &#123; /** * ç æŽ’åº * * @param unsorted å¾…æŽ’åºåˆ— * @return */ public static int[] beadSort(int[] unsorted) &#123; //å¾…æŽ’åºåˆ—ä¸­çš„æœ€å¤§å€¼ int max = 0; //èŽ·å–æœ€å¤§å€¼ for (int i = 0; i &lt; unsorted.length; i++) &#123; if (unsorted[i] &gt; max) &#123; max = unsorted[i]; &#125; &#125; //æ¯ä¸ªæ•°éƒ½ç”¨ç å­è¡¨ç¤ºï¼Œæ¯”å¦‚5å°±ç”¨5ä¸ªç å­ï¼Œæ‰€ä»¥ç”¨äºŒç»´æ•°ç»„è¡¨ç¤ºæ¯ä¸ªæ•° char[][] grid = new char[unsorted.length][max]; int[] levelCount = new int[max]; for (int i = 0; i &lt; max; i++) &#123; levelCount[i] = 0; for (int j = 0; j &lt; unsorted.length; j++) &#123; grid[j][i] = '_'; &#125; &#125; //åˆ é™¤ç å­ for (int i = 0; i &lt; unsorted.length; i++) &#123; int num = unsorted[i]; for (int j = 0; num &gt; 0; j++) &#123; grid[levelCount[j]++][j] = '*'; num--; &#125; &#125; //æ•°ç å­ï¼Œæ”¾åˆ°å·²æŽ’åºåˆ—è¡¨ int[] sorted = new int[unsorted.length]; for (int i = 0; i &lt; unsorted.length; i++) &#123; int putt = 0; for (int j = 0; j &lt; max &amp;&amp; grid[unsorted.length - 1 - i][j] == '*'; j++) &#123; putt++; &#125; sorted[i] = putt; &#125; return sorted; &#125; public static void main(String[] args) &#123; //äº§ç”Ÿéšæœºå¾…æŽ’åºåˆ— int[] unsorted = new int[(int) (Math.random() * 11) + 5]; for (int i = 0; i &lt; unsorted.length; i++) &#123; unsorted[i] = (int) (Math.random() * 10); &#125; System.out.println("**************ç æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æŽ’åºåŽï¼š"); int[] sorted = beadSort(unsorted); CommonUtils.display(sorted); &#125;&#125; æµ‹è¯•ç»“æžœå¦‚ä¸‹]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - ç®€å•é€‰æ‹©æŽ’åº]]></title>
    <url>%2Fposts%2F8d8fd18d.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åœ¨è¦æŽ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œé€‰å‡ºæœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸€ä¸ªæ•°ä¸Žç¬¬1ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼›ç„¶åŽåœ¨å‰©ä¸‹çš„æ•°å½“ä¸­å†æ‰¾æœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸Žç¬¬2ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼Œä¾æ¬¡ç±»æŽ¨ï¼Œç›´åˆ°ç¬¬n-1ä¸ªå…ƒç´ ï¼ˆå€’æ•°ç¬¬äºŒä¸ªæ•°ï¼‰å’Œç¬¬nä¸ªå…ƒç´ ï¼ˆæœ€åŽä¸€ä¸ªæ•°ï¼‰æ¯”è¾ƒä¸ºæ­¢ã€‚ æ“ä½œæ–¹æ³• ç¬¬ä¸€è¶Ÿï¼Œä»Žn ä¸ªè®°å½•ä¸­æ‰¾å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸Žç¬¬ä¸€ä¸ªè®°å½•äº¤æ¢ï¼› ç¬¬äºŒè¶Ÿï¼Œä»Žç¬¬äºŒä¸ªè®°å½•å¼€å§‹çš„n-1 ä¸ªè®°å½•ä¸­å†é€‰å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸Žç¬¬äºŒä¸ªè®°å½•äº¤æ¢ï¼› ä»¥æ­¤ç±»æŽ¨..... ç¬¬i è¶Ÿï¼Œåˆ™ä»Žç¬¬i ä¸ªè®°å½•å¼€å§‹çš„n-i+1 ä¸ªè®°å½•ä¸­é€‰å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸Žç¬¬i ä¸ªè®°å½•äº¤æ¢ï¼Œ ç›´åˆ°æ•´ä¸ªåºåˆ—æŒ‰å…³é”®ç æœ‰åºã€‚ ç®—æ³•æµç¨‹å›¾ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é€‰æ‹©æŽ’åº */public class SelectionSort &#123; /** * é€‰æ‹©æŽ’åºï¼šæ¯ä¸€è¶Ÿåœ¨å‰©ä½™æœªæŽ’åºçš„è‹¥å¹²è®°å½•ä¸­é€‰å–å…³é”®å­—æœ€å°çš„ï¼ˆä¹Ÿå¯ä»¥æ˜¯æœ€å¤§çš„ï¼‰è®°å½•ä½œä¸ºæœ‰åºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªè®°å½•ã€‚ * å¦‚ç¬¬iè¶Ÿé€‰æ‹©æŽ’åºå°±æ˜¯åœ¨n-i+1ä¸ªè®°å½•ä¸­é€‰å–å…³é”®å­—æœ€å°çš„è®°å½•ä½œä¸ºæœ‰åºåºåˆ—ä¸­ç¬¬iä¸ªè®°å½•ã€‚ * è¿™æ ·ï¼Œæ•´ä¸ªåºåˆ—å…±éœ€è¦n-1è¶ŸæŽ’åºã€‚ */ public static void selctionSort(int[] numArr) &#123; int length = numArr.length; //è¦éåŽ†çš„æ¬¡æ•°ï¼ˆlength-1ï¼‰ for (int i = 0; i &lt; length - 1; i++) &#123; //å°†å½“å‰ä¸‹æ ‡å®šä¹‰ä¸ºæœ€å°å€¼ä¸‹æ ‡ int min = i; //éåŽ†minä¹‹åŽçš„æ•°æ® for (int j = i + 1; j &lt; length - 1; j++) &#123; //å¦‚æžœæœ‰å°äºŽå½“å‰æœ€å°å€¼çš„å…ƒç´ ï¼Œå°†å®ƒçš„ä¸‹æ ‡èµ‹å€¼ç»™min if (numArr[j] &lt; numArr[min]) &#123; min = j; &#125; &#125; //å¦‚æžœminä¸ç­‰äºŽiï¼Œåˆ™è¯´æ˜Žæ‰¾åˆ°äº†çœŸæ­£çš„æœ€å°å€¼ if (min != i) &#123; swap(numArr, min, i); &#125; &#125; &#125; /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªå…ƒç´ çš„ä½ç½® * * @param numArr * @param min * @param i */ public static void swap(int[] numArr, int min, int i) &#123; int temp = numArr[min]; numArr[min] = numArr[i]; numArr[i] = temp; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************é€‰æ‹©æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); selctionSort(numArr); CommonUtils.display(numArr); &#125;&#125; CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æŽ’åºç®—æ³• - ç›´æŽ¥æ’å…¥æŽ’åº]]></title>
    <url>%2Fposts%2Fda1a6844.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å°†ä¸€ä¸ªè®°å½•æ’å…¥åˆ°å·²æŽ’åºå¥½çš„æœ‰åºè¡¨ä¸­ï¼Œä»Žè€Œå¾—åˆ°ä¸€ä¸ªæ–°ï¼Œè®°å½•æ•°å¢ž1çš„æœ‰åºè¡¨ã€‚å³ï¼šå…ˆå°†åºåˆ—çš„ç¬¬1ä¸ªè®°å½•çœ‹æˆæ˜¯ä¸€ä¸ªæœ‰åºçš„å­åºåˆ—ï¼Œç„¶åŽä»Žç¬¬2ä¸ªè®°å½•é€ä¸ªè¿›è¡Œæ’å…¥ï¼Œç›´è‡³æ•´ä¸ªåºåˆ—æœ‰åºä¸ºæ­¢ã€‚ æ“ä½œæ–¹æ³• ä»Žç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æŽ’åº å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æŽ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»ŽåŽå‘å‰æ‰«æ å¦‚æžœè¯¥å…ƒç´ ï¼ˆå·²æŽ’åºï¼‰å¤§äºŽæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½® é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æŽ’åºçš„å…ƒç´ å°äºŽæˆ–è€…ç­‰äºŽæ–°å…ƒç´ çš„ä½ç½® å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®åŽ é‡å¤æ­¥éª¤2~5 ç®—æ³•æµç¨‹å›¾ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ’å…¥æŽ’åº */public class InsertSort &#123; /** * ç›´æŽ¥æ’å…¥æŽ’åºæ˜¯ä¸€ç§æœ€ç®€å•çš„æŽ’åºæ–¹æ³•ï¼Œå®ƒçš„åŸºæœ¬æ“ä½œæ˜¯å°†ä¸€ä¸ªè®°å½•æ’å…¥åˆ°å·²æŽ’å¥½çš„æœ‰åºçš„è¡¨ä¸­ï¼Œä»Žè€Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ã€è®°å½•æ•°å¢ž1çš„æœ‰åºè¡¨ã€‚ * &lt;p&gt; * å½“å‰å…ƒç´ çš„å‰é¢å…ƒç´ å‡ä¸ºæœ‰åºï¼Œè¦æ’å…¥æ—¶ï¼Œä»Žå½“å‰å…ƒç´ çš„å·¦è¾¹å¼€å§‹å¾€å‰æ‰¾ï¼ˆä»ŽåŽå¾€å‰æ‰¾ï¼‰ï¼Œæ¯”å½“å‰å…ƒç´ å¤§çš„å…ƒç´ å‡å¾€å³ç§»ä¸€ä¸ªä½ç½®ï¼Œæœ€åŽæŠŠå½“å‰å…ƒç´ æ”¾åœ¨å®ƒåº”è¯¥å‘†çš„ä½ç½®å°±è¡Œäº†ã€‚ * ç§»åŠ¨ã€æ¯”è¾ƒçš„æ¬¡æ•°å¯ä½œä¸ºè¡¡é‡æ—¶é—´å¤æ‚æ€§çš„æ ‡å‡†ã€‚ * &lt;p&gt; * æœ€ä¼˜æƒ…å†µï¼šå¦‚æžœåŽŸå§‹çš„è¾“å…¥åºåˆ—ä¸ºæ­£åºï¼š * &lt;p&gt; * æ¯”è¾ƒæ¬¡æ•°ï¼šn-1 * &lt;p&gt; * ç§»åŠ¨æ¬¡æ•°ï¼š0 * &lt;p&gt; * æœ€å·®æƒ…å†µï¼šå¦‚æžœåŽŸå§‹çš„è¾“å…¥åºåˆ—ä¸ºé€†åºï¼š * &lt;p&gt; * æ¯”è¾ƒæ¬¡æ•°ï¼š(n+2)(n-1)/2 * &lt;p&gt; * ç§»åŠ¨æ¬¡æ•°ï¼š(n+4)(n-1)/2 * &lt;p&gt; * æ‰€ä»¥ç›´æŽ¥æ’å…¥æŽ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n2)ã€‚ */ public static void insertSort(int[] numArr) &#123; int length = numArr.length; for (int i = 1; i &lt; length; i++) &#123; int temp = numArr[i]; int j; //éåŽ†æœ‰åºåºåˆ—ï¼Œå¦‚æžœæœ‰åºåºåˆ—ä¸­çš„å…ƒç´ æ¯”ä¸´æ—¶å…ƒç´ å¤§ï¼Œåˆ™å°†æœ‰åºåºåˆ—ä¸­æ¯”ä¸´æ—¶å…ƒç´ å¤§çš„å…ƒç´ ä¾æ¬¡å‘åŽç§»åŠ¨ for (j = i - 1; j &gt;= 0 &amp;&amp; numArr[j] &gt; temp; j--) &#123; numArr[j + 1] = numArr[j]; &#125; //å°†ä¸´æ—¶å…ƒç´ æ’å…¥åˆ°è…¾å‡ºçš„ä½ç½® numArr[j + 1] = temp; &#125; &#125; public static void main(String[] args) &#123; int[] numArr = &#123;27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66&#125;; System.out.println("**************ç›´æŽ¥æ’å…¥æŽ’åº******************"); System.out.println("æŽ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æŽ’åºåŽï¼š"); insertSort(numArr); CommonUtils.display(numArr); &#125;&#125;``` CommonUtilså·¥å…·ç±»ï¼š```Javapackage main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils &#123; /** * éåŽ†æ‰“å° * * @param numArr */ public static void display(int[] numArr) &#123; if (numArr != null &amp;&amp; numArr.length &gt; 0) &#123; for (int num : numArr) &#123; System.out.print(num + " "); &#125; &#125; System.out.println(""); &#125;&#125; æµ‹è¯•ç»“æžœ]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è®¾è®¡æ¨¡å¼ç®€ä»‹]]></title>
    <url>%2Fposts%2Ff7d67188.html</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ç®€ä»‹ è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰ä»£è¡¨äº†æœ€ä½³çš„å®žè·µï¼Œé€šå¸¸è¢«æœ‰ç»éªŒçš„é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘äººå‘˜æ‰€é‡‡ç”¨ã€‚è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚ è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨çš„ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚ æ¯«æ— ç–‘é—®ï¼Œè®¾è®¡æ¨¡å¼äºŽå·±äºŽä»–äººäºŽç³»ç»Ÿéƒ½æ˜¯å¤šèµ¢çš„ï¼Œè®¾è®¡æ¨¡å¼ä½¿ä»£ç ç¼–åˆ¶çœŸæ­£å·¥ç¨‹åŒ–ï¼Œè®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„åŸºçŸ³ï¼Œå¦‚åŒå¤§åŽ¦çš„ä¸€å—å—ç –çŸ³ä¸€æ ·ã€‚é¡¹ç›®ä¸­åˆç†åœ°è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥å®Œç¾Žåœ°è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯ç§æ¨¡å¼åœ¨çŽ°å®žä¸­éƒ½æœ‰ç›¸åº”çš„åŽŸç†æ¥ä¸Žä¹‹å¯¹åº”ï¼Œæ¯ç§æ¨¡å¼éƒ½æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬å‘¨å›´ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼èƒ½è¢«å¹¿æ³›åº”ç”¨çš„åŽŸå› ã€‚ è®¾è®¡æ¨¡å¼çš„ç±»åž‹ æ€»å…±æœ‰ 23 ç§è®¾è®¡æ¨¡å¼ï¼Œè¿™äº›æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåˆ›å»ºåž‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æž„åž‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰ã€è¡Œä¸ºåž‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¦ä¸€ç±»è®¾è®¡æ¨¡å¼ï¼šJ2EE è®¾è®¡æ¨¡å¼ã€‚ .tg {border-collapse:collapse;border-spacing:0;border-color:#aaa;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:2px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:2px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;} .tg .tg-84q5{border-color:#00009b;text-align:left;vertical-align:top} .tg .tg-c3ow{border-color:inherit;text-align:center;vertical-align:top} .tg .tg-hdkn{border-color:#cb0000;text-align:center;vertical-align:top} .tg .tg-tkru{border-color:#3531ff;text-align:left;vertical-align:top} åº å· æ¨¡å¼ &amp; æè¿° åŒ…æ‹¬ 1 åˆ›å»ºåž‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new è¿ç®—ç¬¦ç›´æŽ¥å®žä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨åˆ¤æ–­é’ˆå¯¹æŸä¸ªç»™å®šå®žä¾‹éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´åŠ çµæ´»ã€‚ â˜…å·¥åŽ‚æ¨¡å¼ï¼ˆFactory Patternï¼‰â˜…æŠ½è±¡å·¥åŽ‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰â˜…å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰â˜…å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰â˜…åŽŸåž‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰ 2 ç»“æž„åž‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚ç»§æ‰¿çš„æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæŽ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡èŽ·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚ â˜…é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰â˜…æ¡¥æŽ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰â˜…è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆFilterã€Criteria Patternï¼‰â˜…ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰â˜…è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰â˜…å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰â˜…äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰â˜…ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ 3 è¡Œä¸ºåž‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ â˜…è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰â˜…å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰â˜…è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰â˜…è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰â˜…ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰â˜…å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰â˜…è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰â˜…çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰â˜…ç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Object Patternï¼‰â˜…ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰â˜…æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰â˜…è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ 4 J2EE æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨è¡¨ç¤ºå±‚ã€‚è¿™äº›æ¨¡å¼æ˜¯ç”± Sun Java Center é‰´å®šçš„ã€‚ â˜…MVC æ¨¡å¼ï¼ˆMVC Patternï¼‰â˜…ä¸šåŠ¡ä»£è¡¨æ¨¡å¼ï¼ˆBusiness Delegate Patternï¼‰â˜…ç»„åˆå®žä½“æ¨¡å¼ï¼ˆComposite Entity Patternï¼‰â˜…æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼ï¼ˆData Access Object Patternï¼‰â˜…å‰ç«¯æŽ§åˆ¶å™¨æ¨¡å¼ï¼ˆFront Controller Patternï¼‰â˜…æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼ˆIntercepting Filter Patternï¼‰â˜…æœåŠ¡å®šä½å™¨æ¨¡å¼ï¼ˆService Locator Patternï¼‰â˜…ä¼ è¾“å¯¹è±¡æ¨¡å¼ï¼ˆTransfer Object Patternï¼‰ ä¸‹é¢ç”¨ä¸€ä¸ªå›¾ç‰‡æ¥æ•´ä½“æè¿°ä¸€ä¸‹è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»ï¼š åˆ›å»ºåž‹æ¨¡å¼ åˆ›å»ºåž‹è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new è¿ç®—ç¬¦ç›´æŽ¥å®žä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨åˆ¤æ–­é’ˆå¯¹æŸä¸ªç»™å®šå®žä¾‹éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´åŠ çµæ´»ã€‚ ç»“æž„åž‹æ¨¡å¼ ç»“æž„åž‹æ¨¡å¼è®¾è®¡ï¼Œå®ƒå…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚ç»§æ‰¿è¿™ä¸€æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæŽ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡èŽ·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚ è¡Œä¸ºåž‹æ¨¡å¼ è¡Œä¸ºåž‹æ¨¡å¼è®¾è®¡ï¼Œæ›´å…³æ³¨å¯¹è±¡ä¸Žå¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ è®¾è®¡æ¨¡å¼çš„å…­å¤§åŽŸåˆ™ å¼€é—­åŽŸåˆ™ï¼ˆOpen Close Principleï¼‰ å¼€é—­åŽŸåˆ™çš„æ„æ€æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½åŽ»ä¿®æ”¹åŽŸæœ‰çš„ä»£ç ï¼Œå®žçŽ°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæžœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºŽç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæžœï¼Œéœ€è¦ä½¿ç”¨æŽ¥å£å’ŒæŠ½è±¡ç±»ã€‚ é‡Œæ°ä»£æ¢åŽŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ é‡Œæ°ä»£æ¢åŽŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŽŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŽŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºçŽ°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºçŽ°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“æ´¾ç”Ÿç±»å¯ä»¥æ›¿æ¢æŽ‰åŸºç±»ï¼Œä¸”è½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢žåŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŽŸåˆ™æ˜¯å¯¹å¼€é—­åŽŸåˆ™çš„è¡¥å……ã€‚å®žçŽ°å¼€é—­åŽŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ï¼Œè€ŒåŸºç±»ä¸Žå­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®žçŽ°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŽŸåˆ™æ˜¯å¯¹å®žçŽ°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚ ä¾èµ–å€’è½¬åŽŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ è¿™ä¸ªåŽŸåˆ™æ˜¯å¼€é—­åŽŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šé’ˆå¯¹æŽ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºŽæŠ½è±¡è€Œä¸ä¾èµ–äºŽå…·ä½“ã€‚ æŽ¥å£éš”ç¦»åŽŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ è¿™ä¸ªåŽŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æŽ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæŽ¥å£è¦å¥½ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€æ˜¯ï¼šé™ä½Žç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç”±æ­¤å¯è§ï¼Œå…¶å®žè®¾è®¡æ¨¡å¼å°±æ˜¯ä»Žå¤§åž‹è½¯ä»¶æž¶æž„å‡ºå‘ã€ä¾¿äºŽå‡çº§å’Œç»´æŠ¤çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒé™ä½Žä¾èµ–ï¼Œé™ä½Žè€¦åˆã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆç§°æœ€å°‘çŸ¥é“åŽŸåˆ™ï¼ˆDemeter Principleï¼‰ æœ€å°‘çŸ¥é“åŽŸåˆ™æ˜¯æŒ‡ï¼šä¸€ä¸ªå®žä½“åº”å½“å°½é‡å°‘åœ°ä¸Žå…¶ä»–å®žä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚ åˆæˆå¤ç”¨åŽŸåˆ™ï¼ˆComposite Reuse Principleï¼‰ åˆæˆå¤ç”¨åŽŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-03ä¹‹-Threadä¸­start()å’Œrun()çš„åŒºåˆ«]]></title>
    <url>%2Fposts%2F22f6e11d.html</url>
    <content type="text"><![CDATA[start()å’Œrun()æ–¹æ³•çš„åŒºåˆ« start(): å®ƒçš„ä½œç”¨æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹ä¼šæ‰§è¡Œç›¸åº”çš„run()æ–¹æ³•ã€‚start()ä¸èƒ½è¢«é‡å¤è°ƒç”¨ã€‚ run(): run()å°±å’Œæ™®é€šçš„æˆå‘˜æ–¹æ³•ä¸€æ ·ï¼Œå¯ä»¥è¢«é‡å¤è°ƒç”¨ã€‚å•ç‹¬è°ƒç”¨run()çš„è¯ï¼Œä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œrun()ï¼Œè€Œå¹¶ä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ï¼ ä¸‹é¢ä»¥ä»£ç æ¥è¿›è¡Œè¯´æ˜Žã€‚ 123456class MyThread extends Thread&#123; public void run()&#123; ... &#125; &#125;;MyThread mythread = new MyThread(); mythread.start()ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œrun()æ–¹æ³•ã€‚ è€Œmythread.run()åˆ™ä¼šç›´æŽ¥åœ¨å½“å‰çº¿ç¨‹ä¸­è¿è¡Œrun()æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥è¿è¡Œrun()ã€‚ start()å’Œrun()æ–¹æ³•ç¤ºä¾‹ ä¸‹é¢ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¼”ç¤ºå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122class TestThread extends Thread &#123; public TestThread(String name) &#123; super(name); &#125; @Override public void run() &#123; System.out.println(Thread.currentThread().getName() + " is running"); &#125;&#125;;public class ThreadMethodDemo &#123; public static void main(String[] args) &#123; Thread mythread = new TestThread("testThread"); System.out.println(Thread.currentThread().getName() + " call testThread.run()"); mythread.run(); System.out.println(Thread.currentThread().getName() + " call testThread.start()"); mythread.start(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 1234main call testThread.run()main is runningmain call testThread.start()testThread is running &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; Thread.currentThread().getName()æ˜¯ç”¨äºŽèŽ·å–â€œå½“å‰çº¿ç¨‹â€çš„åå­—ã€‚å½“å‰çº¿ç¨‹æ˜¯æŒ‡æ­£åœ¨cpuä¸­è°ƒåº¦æ‰§è¡Œçš„çº¿ç¨‹ã€‚ testThread.run()æ˜¯åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­è°ƒç”¨çš„ï¼Œè¯¥run()æ–¹æ³•ç›´æŽ¥è¿è¡Œåœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸Šã€‚ testThread.start()ä¼šå¯åŠ¨â€œçº¿ç¨‹testThreadâ€ï¼Œâ€œçº¿ç¨‹testThreadâ€å¯åŠ¨ä¹‹åŽï¼Œä¼šè°ƒç”¨run()æ–¹æ³•ï¼›æ­¤æ—¶çš„run()æ–¹æ³•æ˜¯è¿è¡Œåœ¨â€œçº¿ç¨‹testThreadâ€ä¸Šã€‚ start()å’Œrun()æºç è¯´æ˜Žï¼ˆåŸºäºŽJDK1.8.0_171ï¼‰ Thread.javaä¸­start()æ–¹æ³•æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728public synchronized void start() &#123; /** * å¦‚æžœçº¿ç¨‹ä¸æ˜¯"æ–°å»ºçŠ¶æ€"ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ * çŠ¶æ€å€¼0 å¯¹åº”"æ–°å»º" */ if (threadStatus != 0) throw new IllegalThreadStateException(); /** å°†çº¿ç¨‹æ·»åŠ åˆ°ThreadGroupä¸­ */ group.add(this); boolean started = false; try &#123; /** é€šè¿‡start0()å¯åŠ¨çº¿ç¨‹ */ start0(); /** è®¾ç½®startedæ ‡è®° */ started = true; &#125; finally &#123; try &#123; if (!started) &#123; group.threadStartFailed(this); &#125; &#125; catch (Throwable ignore) &#123; /* do nothing. If start0 threw a Throwable then it will be passed up the call stack */ &#125; &#125;&#125; &lt;span id=&quot;inline-green&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; start()å®žé™…ä¸Šæ˜¯é€šè¿‡æœ¬åœ°æ–¹æ³•start0()å¯åŠ¨çº¿ç¨‹çš„ã€‚è€Œstart0()ä¼šæ–°è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ–°çº¿ç¨‹ä¼šè°ƒç”¨run()æ–¹æ³•ã€‚ 1private native void start0(); Thread.javaä¸­run()æ–¹æ³•æºç å¦‚ä¸‹ï¼š 12345public void run() &#123; if (target != null) &#123; target.run(); &#125;&#125; &lt;span id=&quot;inline-green&quot;&gt; è¯´æ˜Žï¼š &lt;/span&gt; targetæ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ã€‚run()å°±æ˜¯ç›´æŽ¥è°ƒç”¨Threadçº¿ç¨‹çš„Runnableæˆå‘˜çš„run()æ–¹æ³•ï¼Œå¹¶ä¸ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~cherry-pickã€revertã€resetä»‹ç»]]></title>
    <url>%2Fposts%2F1c4d9168.html</url>
    <content type="text"><![CDATA[** gti checkout -- filename ** git checkout -- filename å¯ä»¥æŠŠå·¥ä½œåŒºçš„æŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹æ’¤å›žåˆ°ä¸Šä¸€æ¬¡addæˆ–è€…commitçš„çŠ¶æ€ï¼Œä¸è¿‡filenameä¸èƒ½çœç•¥. å¯ä»¥ä½¿ç”¨ git checkout -- ä¸åŠ æ–‡ä»¶åæ¥æŸ¥çœ‹å½“å‰å·¥ä½œåŒºä¿®æ”¹äº†å“ªäº›æ–‡ä»¶ï¼Œè¿™ä¸ªåªæ˜¯é’ˆå¯¹å·¥ä½œåŒºçš„é—®é¢˜ï¼› ** git reset head filename ** git reset HEAD filename å¯ä»¥æŠŠaddåˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶å›žé€€åˆ°å·¥ä½œåŒºï¼Œä¹Ÿå°±æ˜¯æŠŠadd filenameè¿™ä¸ªè¿‡ç¨‹ç»™å›žé€€äº†ï¼Œè¿™å¹¶ä¸ä¼šä¿®æ”¹æ–‡ä»¶çš„å†…å®¹ï¼Œ åªæ˜¯æŠŠç¼“å­˜åŒºçš„æŸä¸ªæ–‡ä»¶å˜æˆå’ŒHEADè¿™ä¸ªå½“å‰ç‰ˆæœ¬ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æžœä½ å¤šæ¬¡addï¼Œè¿™ä¼šå›žé€€åˆ°ç¬¬ä¸€æ¬¡addçš„è¿‡ç¨‹ï¼Œå’Œä¸Šé¢çš„æ“ä½œä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸å¸¦ä¸Šæ–‡ä»¶åæ¥æŸ¥çœ‹å“ªäº›æ–‡ä»¶è¢«æ·»åŠ åˆ°äº†ç¼“å­˜åŒºï¼› ** git reset --hard head^ ** git reset --hard HEAD~ã€1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5...ã€‘è¿™ä¸ªæ˜¯å¤§å®¶ç†Ÿæ‚‰çš„æœ¬åœ°ç‰ˆæœ¬çš„å›žé€€ ** æŸåˆ†æ”¯ä¸Šçš„ä¿®æ”¹è¿ç§»åˆ°å¦ä¸€åˆ†æ”¯ ** æ¯”å¦‚æˆ‘ä»¬åœ¨åˆ†æ”¯aä¸Šå¼€å‘æ–°åŠŸèƒ½ï¼Œæ­¤æ—¶æœ‰ä¸ªç´§æ€¥bugéœ€è¦ä¿®æ”¹ï¼Œç„¶åŽåˆ‡æ¢åˆ°äº†åˆ†æ”¯bã€‚bugä¿®å¤å®Œä¹‹åŽå¿˜äº†åˆ‡å›žä¹‹å‰çš„åˆ†æ”¯aï¼Œè€Œæ˜¯åœ¨åˆ†æ”¯bä¸Šé¢ç»§ç»­ç¼–å†™æœ¬åº”è¯¥æ˜¯åˆ†æ”¯açš„å†…å®¹ï¼Œ è¿™æ ·båˆ†æ”¯å­˜åœ¨äº†ä¸€éƒ¨åˆ†aåˆ†æ”¯çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠè¿™æ®µä»£ç è¿ç§»åˆ°aåˆ†æ”¯ä¸Šï¼Œä¸¤ä¸ªæ€è·¯ï¼š 1ï¼‰å¦‚æžœè¿˜æ²¡æœ‰åœ¨båˆ†æ”¯ä¸Šcommitçš„è¯(addçš„è¯æ²¡å½±å“ï¼Œåœ¨è¿ç§»åŽï¼Œå°±ä¸ä¼šå†å½“å‰åˆ†æ”¯çš„ç¼“å­˜ä¸­)ã€‚ ç›´æŽ¥åˆ‡åˆ°aåˆ†æ”¯ï¼Œæ­¤æ—¶ä¼šæç¤ºæœ‰æ²¡æœ‰è¢«commitçš„ä»£ç ï¼Œåˆ‡åˆ°aåˆ†æ”¯åŽï¼Œå°±å¯ä»¥commitè¿™æ®µæ²¡æœ‰è¢«commitçš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯åœ¨båˆ†æ”¯ä¸Šç¼–å†™çš„ä»£ç æ­£ç¡®çš„è¢«è¿ç§»åˆ°äº†aåˆ†æ”¯ã€‚ 2ï¼‰å¦‚æžœå·²ç»commitäº†ï¼Œå¯ä»¥è¿™ä¹ˆæ¥ï¼šgit logæ‰¾åˆ°ä½ commitçš„åˆ†æ”¯å·ï¼Œç„¶åŽç›´æŽ¥åˆ‡æ¢åˆ°aåˆ†æ”¯ï¼Œæ‰§è¡Œgit cherry-pick commit-idï¼Œè¿™ä¸ªcommit-idå°±æ˜¯é‚£ä¸ªbåˆ†æ”¯é”™è¯¯commitçš„idï¼Œ è¿™ä¸ªå‘½ä»¤å°±æ˜¯æŠŠè¿™ä¸ªcommitçš„ä¿®æ”¹æ‹¿åˆ°å½“å‰åˆ†æ”¯æ¥ï¼Œå¾ˆç®€å•ç²—æš´è€Œæœ‰æ•ˆã€‚å†åˆ‡æ¢åˆ°båˆ†æ”¯ï¼Œä½¿ç”¨git revert commit-idæŠŠè¿™ä¸ªé”™è¯¯çš„åˆ†æ”¯å·ç§»é™¤ã€‚ ** revert reset cherry-pick ** git revert å½“æˆ‘ä»¬çš„æŸä¸ªåˆ†æ”¯ä¸­æœ‰äº†å¾ˆå¤šç‰ˆæœ¬ä¹‹åŽï¼Œå½¢æˆäº†ä¸€æ¡ç‰ˆæœ¬é“¾ï¼Œå¦‚æžœæƒ³åŽ»é™¤è¿™ä¸ªçº¿è·¯ä¸­çš„æŸä¸€ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¿ç•™ç‰ˆæœ¬é“¾ä¸­çš„å…¶ä»–æ‰€æœ‰ä¿®æ”¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾ä¸­çš„HEADå°±æ˜¯revertæœ€æ–°ç”Ÿæˆçš„ç‰ˆæœ¬ã€‚æ‰€ä»¥revertæ˜¯ä¼šç”Ÿæˆæ–°ç‰ˆæœ¬çš„æŒ‡ä»¤ã€‚ å¯ä»¥è¿™ä¹ˆæƒ³ï¼Œé“¾å°±åƒä¸€ä¸ªé“¾æ¡ï¼Œæ˜¯ä¸€çŽ¯æ‰£ä¸€çŽ¯çš„ï¼Œå…¶ä¸­çš„ä¸€çŽ¯å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼ŒçŽ°åœ¨æƒ³åŽ»è¿™ä¸ªé“¾æ¡ä¸­çš„æŸä¸€çŽ¯ï¼ˆæŸä¸ªç‰ˆæœ¬ï¼‰ï¼Œ æ‰§è¡Œgit revert HEAD~2ï¼Œè¿™ä¸ªHEAD~2å°±æ˜¯è¿™ä¸ªè¦åˆ é™¤çš„ç‰ˆæœ¬ï¼ˆé“¾æ¡ä¸­çš„ä¸€çŽ¯ï¼‰ï¼Œå°±ä¼šæŠŠè¿™ä¸ªçŽ¯è§£å¼€å‰”é™¤ï¼Œ æŠŠå’Œè¿™ä¸ªå‰”é™¤çš„çŽ¯ï¼ˆç‰ˆæœ¬ï¼‰ç›¸é‚»çš„çŽ¯è¿žåœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªæ–°çš„é“¾æ¡ï¼ˆå°‘äº†ä¸€çŽ¯ï¼‰ï¼Œ ç„¶åŽåœ¨é“¾æ¡çš„æœ€åŽé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ²¡æœ‰ä»»ä½•ä¿®æ”¹çš„çŽ¯ï¼ˆrevert HEAD~2 è¿™ä¸ªæ–°çš„commitç‰ˆæœ¬ï¼‰ æ•´ä¸ªè¿‡ç¨‹å°±åƒå‰”é™¤äº†ä¸­é—´æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œæœ€åŽåŠ ä¸Šäº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ä¿®æ”¹çš„æ–°çš„ç‰ˆæœ¬ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦éšæ„åˆ é™¤ä¸­é—´çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå¯èƒ½ä¼šå­˜åœ¨ä¾èµ–ï¼Œæœ€å¥½æ˜¯revertæœ€æ–°çš„ç‰ˆæœ¬ï¼Œé£Žé™©ä¼šå°å¾ˆå¤šã€‚ git reset git reset [--hard|soft|mixed|merge|keep] [&lt;commit&gt;æˆ–HEAD]æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æŒ‡ä»¤ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯modeï¼Œä¹Ÿå°±æ˜¯ --hardã€--softã€--mixedã€‚ã€‚ã€‚æ¯”è¾ƒå¸¸è§çš„æ˜¯--hardå’Œ--softï¼› --hardæ˜¯æŒ‡å®Œå…¨é‡è®¾ï¼Œä¼šæŠŠå›žé€€åˆ°æŸç‰ˆæœ¬ä¹‹åŽçš„ä¿®æ”¹å…¨éƒ¨åˆ é™¤ï¼Œ --softè¿™æ˜¯ä¸ªå›žé€€è§£ä½“ï¼Œè®©ç‰ˆæœ¬åº“å›žé€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¹‹åŽçš„ä¿®æ”¹å…¨éƒ¨å­˜åœ¨ç¼“å­˜åŒºï¼Œè¿™ä¸ªæ—¶å€™åœ¨commitçš„è¯ï¼Œåˆä¼šæŠŠä¼šé€€çš„éƒ¨åˆ†é‡æ–°åŠ è½½åˆ°æœ€æ–°ç‰ˆæœ¬ä¸­ï¼› git cherry-pick git cherry-pick &lt;commit id&gt;ç”¨äºŽæŠŠå¦ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯çš„commitä¿®æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ï¼Œä¹Ÿæ˜¯è§£å†³ä¹‹å‰é‡åˆ°é—®é¢˜çš„å…³é”®ï¼Œå¯ä»¥ç›´æŽ¥æŠŠå…¶ä»–çš„åˆ†æ”¯ä¸Šçš„ä¿®æ”¹æˆ–è€…æ˜¯æŸä¸€ä¸ªç‰ˆæœ¬ç›´æŽ¥å¼•è¿‡æ¥ï¼Œå¯èƒ½ä¼šå­˜åœ¨å†²çªï¼Œè¿™ä¸ªæ—¶å€™å°±å’Œæ­£å¸¸çš„å†²çªä¸€æ ·çš„è§£å†³å°±å¥½äº†ã€‚]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~åˆå¹¶æŒ‡å®šæ–‡ä»¶æˆ–Commitsåˆ°å¦ä¸€åˆ†æ”¯]]></title>
    <url>%2Fposts%2F5040fe16.html</url>
    <content type="text"><![CDATA[åˆšä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„æ—¶å€™ï¼Œç”±äºŽæˆå‘˜é—´çš„ä»£ç æœ‰çš„éœ€è¦ä¸Šçº¿ï¼Œæœ‰çš„ä¸éœ€è¦ä¸Šçº¿ï¼Œå¦‚æžœç›´æŽ¥mergeï¼Œç»å¸¸ ä¼šæŠŠåˆ«äººä¸éœ€è¦ä¸Šçº¿çš„ä»£ç åˆå¹¶çš„masterï¼Œå¯¼è‡´é—®é¢˜ä»Žç”Ÿã€‚æ‰€ä»¥ï¼Œæœ€ç¨³å¦¥çš„æ˜¯åªåˆå¹¶ä½ éœ€è¦çš„é‚£äº›commitsï¼Œä¸éœ€è¦çš„commitså°±ä¸åˆå¹¶è¿›åŽ»ã€‚ é‚£ä¹ˆå¦‚ä½•ä»Žä¸€ä¸ªåˆ†æ”¯åˆå¹¶ç‰¹å®šçš„æ–‡ä»¶æˆ–è€…Commitsåˆ°å¦ä¸€ä¸ªåˆ†æ”¯è¿™ä¸ªé—®é¢˜æ€¥å¾…è§£ã€‚ åˆå¹¶æŸä¸ªåˆ†æ”¯ä¸Šçš„å•ä¸ªcommit é¦–å…ˆï¼Œç”¨git logæˆ–sourcetreeå·¥å…·æŸ¥çœ‹ä½ æƒ³é€‰æ‹©å“ªäº›commitsè¿›è¡Œåˆå¹¶ï¼Œä¾‹å¦‚ï¼š æ¯”å¦‚dev-w åˆ†æ”¯ä¸Šçš„commit 2aeefdacad6ed1586a1e035fb8860f11533db23c éžå¸¸é‡è¦ï¼Œå®ƒå«æœ‰ä¸€ä¸ªç´§æ€¥bugçš„ä¿®å¤æˆ–æ˜¯å…¶ä»–å†…å®¹ã€‚æ— è®ºä»€ä¹ˆåŽŸå› ï¼Œ ä½ çŽ°åœ¨åªéœ€è¦å°† 2aeefdacad6ed1586a1e035fb8860f11533db23c åˆå¹¶åˆ°masterï¼Œè€Œä¸åˆå¹¶dev-wä¸Šçš„å…¶ä»–commitsï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨git cherry-pickå‘½ä»¤æ¥åšï¼š 123git checkout master git cherry-pick 2aeefdacad6ed1586a1e035fb8860f11533db23c è¿™æ · 2aeefdacad6ed1586a1e035fb8860f11533db23c å°±è¢«åˆå¹¶åˆ°masteråˆ†æ”¯ï¼Œå¹¶åœ¨masterä¸­æ·»åŠ äº†commitï¼ˆä½œä¸ºä¸€ä¸ªæ–°çš„commitï¼‰ã€‚ cherry-pick å’Œmergeæ¯”è¾ƒç±»ä¼¼ï¼Œå¦‚æžœgitä¸èƒ½åˆå¹¶ä»£ç æ”¹åŠ¨ï¼ˆæ¯”å¦‚é‡åˆ°åˆå¹¶å†²çªï¼‰ï¼Œgitéœ€è¦ä½ è‡ªå·±æ¥è§£å†³å†²çªå¹¶æ‰‹åŠ¨æ·»åŠ commitã€‚ è¿™é‡Œgit cherry-pickæ¯æ¬¡åˆå¹¶è¿‡æ¥ä¼šæ˜¾ç¤ºæ–‡ä»¶å†²çª(å…¶å®žå¹¶æ²¡æœ‰ä»£ç å†²çªéƒ¨åˆ†ï¼Œåªéœ€æ‰‹åŠ¨è§£å†³æ—¢å¯) åˆå¹¶æŸä¸ªåˆ†æ”¯ä¸Šçš„ä¸€ç³»åˆ—commits åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œåˆå¹¶å•ä¸ªcommitå¹¶ä¸å¤Ÿï¼Œä½ éœ€è¦åˆå¹¶ä¸€ç³»åˆ—ç›¸è¿žçš„commitsã€‚è¿™ç§æƒ…å†µä¸‹å°±ä¸è¦ä½¿ç”¨cherry-pickäº†ï¼Œrebase æ›´é€‚åˆã€‚ å‡è®¾ä½ éœ€è¦åˆå¹¶dev-wåˆ†æ”¯çš„commit 76cada ~62ecb3 åˆ°masteråˆ†æ”¯ã€‚ é¦–å…ˆéœ€è¦åŸºäºŽdev-wåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå¹¶æŒ‡æ˜Žæ–°åˆ†æ”¯çš„æœ€åŽä¸€ä¸ªcommitï¼š 12git checkout dev-w git checkout -b newbranch 62ecb3 ç„¶åŽï¼Œrebaseè¿™ä¸ªæ–°åˆ†æ”¯çš„commitåˆ°masterï¼ˆâ€“ontomasterï¼‰ã€‚76cada^ æŒ‡æ˜Žä½ æƒ³ä»Žå“ªä¸ªç‰¹å®šçš„commitå¼€å§‹ã€‚ 1git rebase --ontomaster 76cada^ å¾—åˆ°çš„ç»“æžœå°±æ˜¯dev-wåˆ†æ”¯çš„commit 76cada ~ 62ecb3 éƒ½è¢«åˆå¹¶åˆ°äº†masteråˆ†æ”¯ã€‚ å¦å¤–å¦‚æžœåªæƒ³å°†dev-wåˆ†æ”¯çš„æŸä¸ªæ–‡ä»¶Test.javaåˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šã€‚ 12git checkout dev-wgit checkout --patch master Test.java ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼š åˆ‡æ¢åˆ°dev-wåˆ†æ”¯ï¼› ç¬¬äºŒä¸ªå‘½ä»¤ï¼šåˆå¹¶masteråˆ†æ”¯ä¸ŠTest.javaæ–‡ä»¶åˆ°dev-wåˆ†æ”¯ä¸Šï¼Œå°†masteråˆ†æ”¯ä¸Š Test.java æ–‡ä»¶è¿½åŠ è¡¥ä¸åˆ°dev-wåˆ†æ”¯ä¸Š Test.javaæ–‡ä»¶ã€‚ä½ å¯ä»¥æŽ¥å—æˆ–è€…æ‹’ç»è¡¥ä¸å†…å®¹ã€‚ å¦‚æžœåªæ˜¯ç®€å•çš„å°†dev-wåˆ†æ”¯çš„æ–‡ä»¶Test.java copyåˆ°masteråˆ†æ”¯ä¸Šï¼› 12git checkout mastergit checkout dev-w Test.java åˆ†æ”¯testä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶Aï¼Œä½ åœ¨test1åˆ†æ”¯ä¸Šï¼Œ æ­¤æ—¶å¦‚æžœæƒ³ç”¨teståˆ†æ”¯ä¸Šçš„Aæ–‡ä»¶æ›¿æ¢test1åˆ†æ”¯ä¸Šçš„æ–‡ä»¶çš„è¯ï¼Œ å¯ä»¥ä½¿ç”¨git checkout test1, ç„¶åŽgit checkout test â€“ A åœ¨featureåˆ†æ”¯commit åˆ‡æ¢è‡³releaseåˆ†æ”¯ ä»Žfeatureåˆ†æ”¯æ£€å‡ºç›¸åº”æ–‡ä»¶ 12345678#branch featuregit commit -a -m &quot;msg&quot;git checkout release#branch releasegit checkout feature file-01git checkout feature file-x...git commit -a -m &quot;msg&quot;]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-02ä¹‹ å¤šçº¿ç¨‹å®žçŽ°æ–¹å¼]]></title>
    <url>%2Fposts%2F3868ed28.html</url>
    <content type="text"><![CDATA[å®žçŽ°å¤šçº¿ç¨‹çš„å‡ ç§æ–¹å¼ ç»§æ‰¿Threadç±» å®žçŽ°RunnableæŽ¥å£ é€šè¿‡Callableå’ŒFuture é€šè¿‡çº¿ç¨‹æ±  Threadå’ŒRunnableç®€ä»‹ Runnable Runnableæ˜¯ä¸€ä¸ªæŽ¥å£åº“ï¼Œè¯¥æŽ¥å£åªåŒ…å«äº†ä¸€ä¸ªrun()æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 123public interface Runnable &#123; public abstract void run();&#125; Runnableçš„ä½œç”¨ï¼Œå®žçŽ°å¤šçº¿ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç±»Aå®žçŽ°RunnableæŽ¥å£ï¼›ç„¶åŽï¼Œé€šè¿‡new Thread(new A())ç­‰æ–¹å¼æ–°å»ºçº¿ç¨‹ã€‚ Thread Thread æ˜¯ä¸€ä¸ªç±»ã€‚Threadæœ¬èº«å°±å®žçŽ°äº†RunnableæŽ¥å£ã€‚å®ƒçš„å£°æ˜Žå¦‚ä¸‹ï¼š 1public class Thread implements Runnable &#123;&#125; Threadå’ŒRunnableçš„å¼‚åŒç‚¹ Thread å’Œ Runnable çš„ç›¸åŒç‚¹ï¼šéƒ½æ˜¯â€œå¤šçº¿ç¨‹çš„å®žçŽ°æ–¹å¼â€ã€‚ Thread å’Œ Runnable çš„ä¸åŒç‚¹ï¼š Thread æ˜¯ç±»ï¼Œè€ŒRunnableæ˜¯æŽ¥å£ï¼›Threadæœ¬èº«æ˜¯å®žçŽ°äº†RunnableæŽ¥å£çš„ç±»ã€‚æˆ‘ä»¬çŸ¥é“â€œä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†æ˜¯å´èƒ½å®žçŽ°å¤šä¸ªæŽ¥å£â€ï¼Œå› æ­¤Runnableå…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ã€‚ æ­¤å¤–ï¼ŒRunnableè¿˜å¯ä»¥ç”¨äºŽâ€œèµ„æºçš„å…±äº«â€ã€‚å³ï¼Œå¤šä¸ªçº¿ç¨‹éƒ½æ˜¯åŸºäºŽæŸä¸€ä¸ªRunnableå¯¹è±¡å»ºç«‹çš„ï¼Œå®ƒä»¬ä¼šå…±äº«Runnableå¯¹è±¡ä¸Šçš„èµ„æºã€‚ é€šå¸¸ï¼Œå»ºè®®é€šè¿‡â€œRunnableâ€å®žçŽ°å¤šçº¿ç¨‹ï¼ Threadå’ŒRunnableçš„å¤šçº¿ç¨‹ç¤ºä¾‹ Threadçš„å¤šçº¿ç¨‹ç¤ºä¾‹ 123456789101112131415161718192021222324public class ThreadTest &#123; public static void main(String[] args) &#123; // å¯åŠ¨3ä¸ªçº¿ç¨‹t1,t2,t3ï¼›æ¯ä¸ªçº¿ç¨‹å„å–10å¼ ç¥¨ï¼ MyThread t1 = new MyThread(); MyThread t2 = new MyThread(); MyThread t3 = new MyThread(); t1.start(); t2.start(); t3.start(); &#125;&#125;class MyThread extends Thread &#123; private int ticket = 10; @Override public void run() &#123; for (int i = 0; i &lt; 20; i++) &#123; if (this.ticket &gt; 0) &#123; System.out.println(this.getName() + " å–ç¥¨ï¼šticket" + this.ticket--); &#125; &#125; &#125;&#125;; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 123456789101112131415161718192021222324252627282930Thread-2 å–ç¥¨ï¼šticket10Thread-1 å–ç¥¨ï¼šticket10Thread-0 å–ç¥¨ï¼šticket10Thread-1 å–ç¥¨ï¼šticket9Thread-2 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket8Thread-0 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket7Thread-2 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket6Thread-0 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket7Thread-1 å–ç¥¨ï¼šticket4Thread-0 å–ç¥¨ï¼šticket7Thread-1 å–ç¥¨ï¼šticket3Thread-2 å–ç¥¨ï¼šticket6Thread-1 å–ç¥¨ï¼šticket2Thread-0 å–ç¥¨ï¼šticket6Thread-1 å–ç¥¨ï¼šticket1Thread-2 å–ç¥¨ï¼šticket5Thread-0 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket4Thread-0 å–ç¥¨ï¼šticket4Thread-2 å–ç¥¨ï¼šticket3Thread-0 å–ç¥¨ï¼šticket3Thread-2 å–ç¥¨ï¼šticket2Thread-0 å–ç¥¨ï¼šticket2Thread-2 å–ç¥¨ï¼šticket1Thread-0 å–ç¥¨ï¼šticket1 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; (01) MyThreadç»§æ‰¿äºŽThreadï¼Œå®ƒæ˜¯è‡ªå®šä¹‰ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªMyThreadéƒ½ä¼šå–å‡º10å¼ ç¥¨ã€‚ (02) ä¸»çº¿ç¨‹mainåˆ›å»ºå¹¶å¯åŠ¨3ä¸ªMyThreadå­çº¿ç¨‹ã€‚æ¯ä¸ªå­çº¿ç¨‹éƒ½å„è‡ªå–å‡ºäº†10å¼ ç¥¨ã€‚ Runnableçš„å¤šçº¿ç¨‹ç¤ºä¾‹ 1234567891011121314151617181920212223242526class MyThread2 implements Runnable &#123; private int ticket = 10; @Override public void run() &#123; for (int i = 0; i &lt; 20; i++) &#123; if (this.ticket &gt; 0) &#123; System.out.println(Thread.currentThread().getName() + " å–ç¥¨ï¼šticket" + this.ticket--); &#125; &#125; &#125;&#125;;public class RunnableTest &#123; public static void main(String[] args) &#123; MyThread2 mt = new MyThread2(); // å¯åŠ¨3ä¸ªçº¿ç¨‹t1,t2,t3(å®ƒä»¬å…±ç”¨ä¸€ä¸ªRunnableå¯¹è±¡)ï¼Œè¿™3ä¸ªçº¿ç¨‹ä¸€å…±å–10å¼ ç¥¨ï¼ Thread t1 = new Thread(mt); Thread t2 = new Thread(mt); Thread t3 = new Thread(mt); t1.start(); t2.start(); t3.start(); &#125;&#125; &lt;span id=&quot;inline-blue&quot;&gt; è¿è¡Œç»“æžœï¼š &lt;/span&gt; 12345678910Thread-0 å–ç¥¨ï¼šticket10Thread-0 å–ç¥¨ï¼šticket7Thread-0 å–ç¥¨ï¼šticket6Thread-0 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket2Thread-1 å–ç¥¨ï¼šticket1Thread-2 å–ç¥¨ï¼šticket3Thread-0 å–ç¥¨ï¼šticket4 &lt;span id=&quot;inline-green&quot;&gt; ç»“æžœè¯´æ˜Žï¼š &lt;/span&gt; (01) å’Œä¸Šé¢â€œMyThreadç»§æ‰¿äºŽThreadâ€ä¸åŒï¼›è¿™é‡Œçš„MyThreadå®žçŽ°äº†ThreadæŽ¥å£ã€‚ (02) ä¸»çº¿ç¨‹mainåˆ›å»ºå¹¶å¯åŠ¨3ä¸ªå­çº¿ç¨‹ï¼Œè€Œä¸”è¿™3ä¸ªå­çº¿ç¨‹éƒ½æ˜¯åŸºäºŽâ€œmtè¿™ä¸ªRunnableå¯¹è±¡â€è€Œåˆ›å»ºçš„ã€‚è¿è¡Œç»“æžœæ˜¯è¿™3ä¸ªå­çº¿ç¨‹ä¸€å…±å–å‡ºäº†10å¼ ç¥¨ã€‚è¿™è¯´æ˜Žå®ƒä»¬æ˜¯å…±äº«äº†MyThreadæŽ¥å£çš„ã€‚]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~é‡ç½®]]></title>
    <url>%2Fposts%2Fb9f23f09.html</url>
    <content type="text"><![CDATA[åˆ†æ”¯æ¸¸æ ‡masterçš„æŽ¢ç§˜ å…ˆæ¥çœ‹çœ‹å½“æœ‰æ–°çš„æäº¤å‘ç”Ÿæ—¶ï¼Œæ–‡ä»¶.git/refs/heads/masterçš„å†…å®¹å¦‚ä½•æ”¹å˜ã€‚é¦–å…ˆåœ¨å·¥ä½œåŒºåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå§‘ä¸”å«åšnew-commit.txtï¼Œç„¶åŽæäº¤åˆ°ç‰ˆæœ¬åº“ä¸­ã€‚ 123$ touch new-commit.txt $ git add new-commit.txt $ git commit -m &quot;does master follow this new commit?&quot; æ­¤æ—¶å·¥ä½œç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æ–‡ä»¶new-commit.txtæ˜¯æ–°å¢žçš„ã€‚ 12$ lsnew-commit.txt welcome.txt æ¥çœ‹çœ‹masteråˆ†æ”¯æŒ‡å‘çš„æäº¤IDæ˜¯å¦æ”¹å˜äº†ã€‚ å…ˆçœ‹çœ‹åœ¨ç‰ˆæœ¬åº“å¼•ç”¨ç©ºé—´(.git/refs/ç›®å½•)ä¸‹çš„masteræ–‡ä»¶å†…å®¹çš„ç¡®æ›´æ”¹äº†ï¼ŒæŒ‡å‘äº†æ–°çš„æäº¤ã€‚ 12$ cat .git/refs/heads/master23995a2d61d0a2667ba0db8aa4a17b127c1977d1 å†ç”¨git logæŸ¥çœ‹ä¸€ä¸‹æäº¤æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°åˆšåˆšå®Œæˆçš„æäº¤ã€‚ 1$ gilt log --graph --oneline å¼•ç”¨refs/heads/masterå°±å¥½åƒæ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œåœ¨æœ‰æ–°çš„æäº¤å‘ç”Ÿçš„æ—¶å€™æŒ‡å‘äº†æ–°çš„æäº¤ã€‚å¯æ˜¯å¦‚æžœåªå¯ä¸Šã€ä¸å¯ä¸‹ï¼Œå°±ä¸èƒ½ç§°ä¸ºâ€œæ¸¸æ ‡â€ã€‚ Gitæä¾›äº†git resetå‘½ä»¤ï¼Œå¯ä»¥å°†â€œæ¸¸æ ‡â€æŒ‡å‘ä»»æ„ä¸€ä¸ªå­˜åœ¨çš„æäº¤IDã€‚ä¸‹é¢å°±å°è¯•äººä¸ºæ›´æ”¹æ¸¸æ ‡ã€‚ 1$ git reset --hard HEAD^ æ³¨æ„ï¼Œä¸Šé¢çš„å‘½ä»¤ä¸­ä½¿ç”¨äº†--hardå‚æ•°ï¼Œä¼šç ´åå·¥ä½œåŒºæœªæäº¤çš„æ”¹åŠ¨ï¼Œè¦æ…Žç”¨ã€‚è¿™æ¡å‘½ä»¤å°†masteré‡ç½®åˆ°äº†ä¸Šä¸€ä¸ªè€çš„æäº¤ä¸Šï¼Œæ¥çœ‹ä¸‹masteræ–‡ä»¶å†…å®¹æ˜¯å¦æ›´æ”¹äº†ã€‚ 12$ cat .git/refs/heads/mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31 æžœç„¶masteråˆ†æ”¯çš„å¼•ç”¨æ–‡ä»¶çš„æŒ‡å‘æ›´æ”¹ä¸ºå‰ä¸€æ¬¡æäº¤çš„IDäº†ã€‚è€Œä¸”é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°æ–°æ·»åŠ çš„æ–‡ä»¶new-commit.txtä¹Ÿä¸¢å¤±äº†ã€‚ 1$ ls é‡ç½®å‘½ä»¤ä¸ä»…å¯ä»¥é‡ç½®åˆ°å‰ä¸€æ¬¡æäº¤ï¼Œè¿˜å¯ä»¥ç›´æŽ¥ä½¿ç”¨æäº¤IDé‡ç½®åˆ°ä»»ä½•ä¸€æ¬¡æäº¤ã€‚ é€šè¿‡git logæŸ¥è¯¢åˆ°æœ€æ—©çš„æäº¤IDã€‚ 1$ git log --graph --oneline ç„¶åŽé‡ç½®åˆ°æœ€æ—©çš„ä¸€æ¬¡æäº¤ã€‚ 1$ git reset --hard d3e0684 -é‡ç½®åŽä¼šå‘çŽ°welcome.txtä¹Ÿå›žé€€åˆ°äº†æœ€åŽŸå§‹ç‰ˆæœ¬åº“ï¼Œæ›¾ç»çš„ä¿®æ”¹éƒ½ä¸¢å¤±äº†ã€‚ 1$ cat welcome.txt ä½¿ç”¨é‡ç½®å‘½ä»¤å¾ˆå±é™©ï¼Œä¼šå½»åº•çš„ä¸¢å¼ƒåŽ†å²ã€‚é‚£ä¹ˆè¿˜èƒ½å¤Ÿé€šè¿‡æµè§ˆæäº¤åŽ†å²çš„åŠžæ³•æ‰¾åˆ°ä¸¢å¼ƒçš„æäº¤IDï¼Œå†ä½¿ç”¨é‡ç½®å‘½ä»¤æ¢å¤åŽ†å²å—ï¼Ÿ ä¸å¯èƒ½ï¼ï¼ï¼å› ä¸ºé‡ç½®è®©æäº¤åŽ†å²ä¹Ÿæ”¹å˜äº†ã€‚ 1$ git log ä½¿ç”¨reflogæŒ½æ•‘é”™è¯¯çš„é‡ç½® å¦‚æžœæ²¡æœ‰è®°ä¸‹é‡ç½®å‰masteråˆ†æ”¯æŒ‡å‘çš„æäº¤IDï¼Œæƒ³è¦é‡ç½®å›žåŽŸæ¥çš„æäº¤çœŸçš„æ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…(åŽ»å¯¹è±¡åº“ä¸­ä¸€ä¸ªä¸ªåœ°æ‰¾)ã€‚å¹¸å¥½Gitæä¾›äº†ä¸€ä¸ªæŒ½æ•‘æœºåˆ¶ï¼Œ é€šè¿‡.git/logsç›®å½•ä¸‹æ—¥å¿—æ–‡ä»¶è®°å½•äº†åˆ†æ”¯çš„å˜æ›´ã€‚é»˜è®¤éžè£¸ç‰ˆæœ¬åº“ï¼ˆå¸¦æœ‰å·¥ä½œåŒºï¼‰éƒ½æä¾›åˆ†æ”¯æ—¥å¿—åŠŸèƒ½ï¼Œè¿™æ˜¯å› ä¸ºå¸¦æœ‰å·¥ä½œåŒºçš„å…«æœ¬åº“éƒ½æœ‰å¦‚ä¸‹è®¾ç½®ï¼š 1$ git config core.logallrefupdates æŸ¥çœ‹ä¸€ä¸‹masteråˆ†æ”¯çš„æ—¥å¿—æ–‡ä»¶.git/logs/refs/heads/masterä¸­çš„å†…å®¹ã€‚ä¸‹é¢å‘½ä»¤æ˜¾ç¤ºäº†è¯¥æ–‡ä»¶çš„æœ€åŽå‡ è¡Œã€‚ 1$ tail -5 .git/logs/refs/heads/master å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–‡ä»¶è®°å½•äº†masteråˆ†æ”¯æŒ‡å‘çš„å˜è¿ï¼Œæœ€æ–°çš„æ”¹å˜è¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾å› æ­¤æœ€åŽå‡ºçŽ°ã€‚æœ€åŽä¸€è¡Œå¯ä»¥çœ‹å‡ºå› æ‰§è¡Œgit reset --hardå‘½ä»¤ï¼Œ æŒ‡å‘çš„æäº¤IDç”±a67c6fæ”¹å˜ä¸ºd3e0684ã€‚ Gitæä¾›äº†ä¸€ä¸ªgit reflogå‘½ä»¤ï¼Œå¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œã€‚ä½¿ç”¨showå­å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ­¤æ–‡ä»¶çš„å†…å®¹ã€‚ 1$ git reflog show master | head -5 ä½¿ç”¨git reflogçš„è¾“å‡ºå’Œç›´æŽ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„ä¸åŒåœ¨äºŽæ˜¾ç¤ºé¡ºåºä¸åŒï¼Œå³æœ€æ–°æ”¹å˜æ”¾åœ¨äº†æœ€å‰é¢æ˜¾ç¤ºï¼Œè€Œä¸”åªæ˜¾ç¤ºæ¯æ¬¡æ”¹å˜çš„æœ€ç»ˆçš„SHA1å“ˆå¸Œå€¼ã€‚ è¿˜æœ‰ä¸ªåŒºåˆ«åœ¨äºŽä½¿ç”¨git reflogçš„è¾“å‡ºä¸­è¿˜æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿æ˜“è®°çš„è¡¨è¾¾å¼ï¼š&lt;refname&gt;@{&lt;n&gt;}ã€‚è¿™ä¸ªè¡¨è¾¾å¼çš„å«ä¹‰æ˜¯å¼•ç”¨&lt;refname&gt;ä¹‹å‰ç¬¬&lt;n&gt;æ¬¡æ”¹å˜æ—¶çš„SHA1å“ˆå¸Œå€¼ã€‚ é‚£ä¹ˆå°†å¼•ç”¨masteråˆ‡æ¢åˆ°ä¸¤æ¬¡å˜æ›´ä¹‹å‰çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š é‡ç½®masterä¸ºä¸¤æ¬¡æ”¹å˜ä¹‹å‰çš„å€¼ã€‚ 1$ git reset --hard master@&#123;2&#125; é‡ç½®åŽå·¥ä½œåŒºä¸­æ–‡ä»¶new-commit.txtåˆå›žæ¥äº†ã€‚ 12$ lsnew-commit.txt welcome.txt æäº¤çš„åŽ†å²ä¹Ÿå›žæ¥äº†ã€‚ 1$ git log --oneline æ­¤æ—¶å¦‚æžœå†ç”¨git reflogæŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°æ¢å¤masterçš„æ“ä½œä¹Ÿè®°å½•åœ¨äº†æ—¥å¿—ä¸­ã€‚ 1$ git reflog show master | head -5 æ·±å…¥äº†è§£git resetå‘½ä»¤ é‡ç½®å‘½ä»¤git resetæ˜¯Gitæœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€å±é™©ï¼Œæœ€å®¹æ˜“è¯¯ç”¨çš„å‘½ä»¤ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š 12ç”¨æ³•ä¸€ï¼šgit reset [-q] [&lt;commit&gt;] [--] &lt;paths&gt;â€¦â€‹ç”¨æ³•äºŒï¼šgit reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;] ä¸Šé¢åˆ—å‡ºçš„ç”¨æ³•ä¸­ï¼Œ&lt;commit&gt;æ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨å¼•ç”¨æˆ–è€…æäº¤IDï¼Œå¦‚æžœçœç•¥&lt;commit&gt;åˆ™ç›¸å½“äºŽä½¿ç”¨äº†HEADçš„æŒ‡å‘ä½œä¸ºæäº¤IDã€‚ ä¸Šé¢åˆ—å‡ºçš„ä¸¤ç§ç”¨æ³•çš„åŒºåˆ«åœ¨äºŽï¼Œç¬¬ä¸€ç§ç”¨æ³•åœ¨å‘½ä»¤ä¸­åŒ…å«è·¯å¾„&lt;paths&gt;ã€‚ä¸ºäº†é¿å…è·¯å¾„å’Œå¼•ç”¨ï¼ˆæˆ–è€…æäº¤IDï¼‰åŒåè€Œå†²çªï¼Œå¯ä»¥åœ¨&lt;paths&gt;å‰ç”¨ä¸¤ä¸ªè¿žç»­çš„çŸ­çº¿ä½œä¸ºåˆ†éš”ã€‚ ç¬¬ä¸€ç§ç”¨æ³•ä¸ä¼šé‡ç½®å¼•ç”¨ï¼Œæ›´ä¸ä¼šæ”¹å˜å·¥ä½œåŒºï¼Œè€Œæ˜¯ç”¨æŒ‡å®šæäº¤çŠ¶æ€ï¼ˆ&lt;commit&gt;ï¼‰ä¸‹çš„æ–‡ä»¶ï¼ˆ&lt;paths&gt;ï¼‰æ›¿æ¢æŽ‰æš‚å­˜åŒºçš„æ–‡ä»¶ã€‚ ä¾‹å¦‚å‘½ä»¤git reset HEAD &lt;paths&gt;ç›¸å½“äºŽå–æ¶ˆä¹‹å‰æ‰§è¡Œçš„git add &lt;paths&gt;å‘½ä»¤æ—¶æ”¹å˜çš„æš‚å­˜åŒºã€‚ ç¬¬äºŒç§ç”¨æ³•ï¼ˆä¸ä½¿ç”¨è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•ï¼‰åˆ™ä¼šé‡ç½®å¼•ç”¨ã€‚æ ¹æ®ä¸åŒçš„é€‰é¡¹ï¼Œå¯ä»¥å¯¹æš‚å­˜åŒºæˆ–è€…å·¥ä½œåŒºè¿›è¡Œé‡ç½®ã€‚ å‚ç…§ä¸‹é¢çš„ç‰ˆæœ¬åº“æ¨¡åž‹å›¾ï¼Œæ¥çœ‹ä¸€çœ‹ä¸åŒçš„å‚æ•°å¯¹ç¬¬äºŒç§é‡ç½®è¯­æ³•çš„å½±å“ã€‚ å‘½ä»¤æ ¼å¼ï¼šgit reset [--soft | --mixed | --hard] [&lt;commit&gt;] ä½¿ç”¨å‚æ•°--hardï¼Œå¦‚ï¼šgit reset --hard &lt;commit&gt; ä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„1ã€2ã€3å…¨éƒ¨çš„ä¸‰ä¸ªåŠ¨ä½œã€‚å³ï¼š æ›¿æ¢å¼•ç”¨çš„æŒ‡å‘ã€‚å¼•ç”¨æŒ‡å‘æ–°çš„æäº¤IDã€‚ æ›¿æ¢æš‚å­˜åŒºã€‚æ›¿æ¢åŽï¼Œæš‚å­˜åŒºçš„å†…å®¹å’Œå¼•ç”¨æŒ‡å‘çš„ç›®å½•æ ‘ä¸€è‡´ã€‚ æ›¿æ¢å·¥ä½œåŒºã€‚æ›¿æ¢åŽï¼Œå·¥ä½œåŒºçš„å†…å®¹å˜å¾—å’Œæš‚å­˜åŒºä¸€è‡´ï¼Œä¹Ÿå’ŒHEADæŒ‡å‘çš„ç›®å½•æ ‘å†…å®¹ç›¸åŒã€‚ ä½¿ç”¨å‚æ•°--softï¼Œå¦‚ï¼šgit reset --soft &lt;commit&gt;ï¼Œä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„æ“ä½œ1.å³åªæ›´æ”¹å¼•ç”¨çš„æŒ‡å‘ï¼Œä¸æ”¹å˜æš‚å­˜åŒºå’Œå·¥ä½œåŒºã€‚ ä½¿ç”¨å‚æ•°--mixedæˆ–è€…ä¸ä½¿ç”¨å‚æ•°ï¼ˆç¼ºçœä¸º--mixedï¼‰ï¼Œå¦‚ï¼šgit reset &lt;commit&gt;ï¼Œä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„æ“ä½œ1å’Œæ“ä½œ2ã€‚å³æ›´æ”¹å¼•ç”¨çš„æŒ‡å‘ä»¥åŠé‡ç½®æš‚å­˜åŒºï¼Œä½†ä¸æ”¹å˜å·¥ä½œåŒºã€‚ ä¸‹é¢é€šè¿‡ä¸€äº›ç¤ºä¾‹ï¼Œçœ‹ä¸€ä¸‹é‡ç½®å‘½ä»¤çš„ä¸åŒç”¨æ³•ã€‚ å‘½ä»¤ï¼šgit reset ä»…ç”¨HEADæŒ‡å‘çš„ç›®å½•æ ‘é‡ç½®æš‚å­˜åŒºï¼Œå·¥ä½œåŒºä¸å—å½±å“ï¼Œç›¸å½“äºŽå°†ä¹‹å‰ç”¨git addå‘½ä»¤æ›´æ–°åˆ°æš‚å­˜åŒºçš„å†…å®¹æ’¤å‡ºæš‚å­˜åŒºã€‚ å¼•ç”¨ä¹Ÿæœªæ”¹å˜ï¼Œå› ä¸ºå¼•ç”¨é‡ç½®åˆ°HEADç›¸å½“äºŽæ²¡æœ‰é‡ç½®ã€‚ å‘½ä»¤ï¼šgit reset HEAD åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset -- filenameã€‚ä»…å°†æ–‡ä»¶filenameæ’¤å‡ºæš‚å­˜åŒºï¼Œæš‚å­˜åŒºä¸­å…¶ä»–æ–‡ä»¶ä¸æ”¹å˜ã€‚ç›¸å½“äºŽå¯¹å‘½ä»¤git add filenameçš„åå‘æ“ä½œã€‚ å‘½ä»¤ï¼šgit reset HEAD filenameã€‚åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset --soft HEAD^ã€‚å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸æ”¹å˜ï¼Œä½†æ˜¯å¼•ç”¨å‘å‰å›žé€€ä¸€æ¬¡ã€‚å½“å¯¹æœ€æ–°æäº¤çš„æäº¤è¯´æ˜Žæˆ–è€…æäº¤çš„æ›´æ”¹ä¸æ»¡æ„æ—¶ï¼Œæ’¤é”€ä¸‹æœ€æ–°çš„æäº¤ä»¥ä¾¿é‡æ–°æäº¤ã€‚ ä¹‹å‰æ›¾ç»ä»‹ç»è¿‡ä¸€ä¸ªä¿®æ”¹æäº¤å‘½ä»¤ï¼šgit commit --amendï¼Œç”¨äºŽå¯¹æœ€æ–°çš„æäº¤è¿›è¡Œé‡æ–°æäº¤ä»¥ä¿®è¡¥é”™è¯¯çš„æäº¤è¯´æ˜Žæˆ–è€…é”™è¯¯çš„æäº¤æ–‡ä»¶ã€‚ ä¿®è¡¥å‘½ä»¤å®žé™…ä¸Šç›¸å½“äºŽæ‰§è¡Œäº†ä¸‹é¢ä¸¤æ¡å‘½ä»¤ã€‚ï¼ˆæ–‡ä»¶.git/COMMIT_EDITMSGä¿å­˜äº†ä¸Šæ¬¡çš„æäº¤æ—¥å¿—ï¼‰ 12$ git reset --soft HEAD^$ git commit -e -F .git/COMMIT_EDITMSG å‘½ä»¤ï¼šgit reset HEAD^ã€‚å·¥ä½œåŒºä¸æ”¹å˜ï¼Œä½†æ˜¯æš‚å­˜åŒºä¼šå›žé€€åˆ°ä¸Šä¸€æ¬¡æäº¤ä¹‹å‰ï¼Œå¼•ç”¨ä¹Ÿä¼šå›žé€€ä¸€æ¬¡ã€‚ å‘½ä»¤ï¼šgit reset --mixed HEAD^ã€‚åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset --hard HEAD^ã€‚å½»åº•æ’¤é”€æœ€è¿‘çš„æäº¤ã€‚å¼•ç”¨ä¼šå›žé€€åˆ°å‰ä¸€æ¬¡ï¼Œè€Œä¸”å·¥ä½œåŒºå’Œæš‚å­˜åŒºéƒ½ä¼šå›žé€€åˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€ã€‚è‡ªä¸Šä¸€æ¬¡ä»¥æ¥çš„æäº¤å…¨éƒ¨ä¸¢å¤±ã€‚]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å¯¹è±¡]]></title>
    <url>%2Fposts%2F779ee1e1.html</url>
    <content type="text"><![CDATA[Gitå¯¹è±¡åº“æŽ¢ç§˜ é€šè¿‡æŸ¥çœ‹æ—¥å¿—çš„è¯¦å°½è¾“å‡ºï¼Œä¼šçœ‹åˆ°éžå¸¸å¤šçš„SHA1å“ˆå¸Œå€¼ã€‚ 1$ git log -l --pretty=raw ä¸€ä¸ªæäº¤ä¸­å±…ç„¶åŒ…å«äº†ä¸‰ä¸ªSHA1å“ˆå¸Œå€¼è¡¨ç¤ºçš„å¯¹è±¡IDã€‚ commit a67c6fdd0a0e809340944432a3bf7d78e7e10f31 è¿™æ˜¯æœ¬æ¬¡æäº¤çš„å”¯ä¸€æ ‡è¯†ã€‚ tree b79fd13fac802739388af44a81d72b6e1d68da89 è¿™æ˜¯æœ¬æ¬¡æäº¤æ‰€å¯¹åº”çš„çš„ç›®å½•æ ‘ã€‚ parent d3617dadd10c274e6e2b6caf47635d5771b9034c è¿™æ˜¯æœ¬æ¬¡æäº¤çš„çˆ¶æäº¤ï¼ˆä¸Šä¸€æ¬¡æäº¤ï¼‰ã€‚ ç ”ç©¶Gitå¯¹è±¡IDçš„ä¸€ä¸ªé‡é‡çº§æ­¦å™¨ï¼šgit cat-fileå‘½ä»¤ã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿™ä¸‰ä¸ªIDçš„ç±»åž‹ã€‚ 123456$ git cat-file -t a67c6fcommit$ git cat-file -t b79ftree$ git cat-file d3617commit åœ¨å¼•ç”¨å¯¹è±¡IDçš„æ—¶å€™ï¼Œæ²¡æœ‰å¿…è¦æŠŠæ•´ä¸ª40ä½çš„IDå†™å…¨ï¼Œåªéœ€è¦ä»Žå¤´å¼€å§‹çš„å‡ ä½ä¸å†²çªå³å¯ã€‚ ä¸‹é¢å†ä½¿ç”¨git cat-fileå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªå¯¹è±¡çš„å†…å®¹ã€‚ commitå¯¹è±¡a67c6fdd0a0e809340944432a3bf7d78e7e10f31 1$ git cat-file -p a67c6f treeå¯¹è±¡b79fd13fac802739388af44a81d72b6e1d68da89 1$ git cat-file -p b79fd commitå¯¹è±¡d3617dadd10c274e6e2b6caf47635d5771b9034c 1$ git cat-file -p d3617 åœ¨ä¸Šé¢ç›®å½•æ ‘(tree)å¯¹è±¡ä¸­çœ‹åˆ°äº†ä¸€ä¸ªæ–°çš„ç±»åž‹çš„å¯¹è±¡ï¼šblobå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¿å­˜ç€æ–‡ä»¶welcome.txtçš„å†…å®¹ã€‚ è¯¥å¯¹è±¡çš„ç±»åž‹ä¸ºblobã€‚ 12$ git cat-file -t d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16blob è¯¥å¯¹è±¡çš„å†…å®¹å°±æ˜¯welcome.txtæ–‡ä»¶çš„å†…å®¹ã€‚ 123$ git cat-file -p d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16Hello Git.å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ è¿™äº›å¯¹è±¡ä¿å­˜åœ¨å“ªé‡Œï¼Ÿå½“ç„¶æ˜¯Gitåº“ä¸­çš„objectsç›®å½•ä¸‹ï¼ˆIDçš„å‰ä¸¤ä½ä½œä¸ºç›®å½•åï¼ŒåŽ38ä½ä½œä¸ºæ–‡ä»¶åã€‚ï¼‰ ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿™äº›å¯¹è±¡åœ¨å¯¹è±¡åº“ä¸­çš„å®žé™…ä½ç½®ã€‚ 1for id in a67c6f b79fd d3617 d7230d; do ls .git/objects/$&#123;id:0:2&#125;/$&#123;id:2&#125;*;done é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°æäº¤å¯¹è±¡ä¹‹é—´ç›¸äº’å…³è”çš„è·Ÿè¸ªè¿žã€‚ 1$ git log --pretty=raw --graph a67c ä¸Šé¢çš„å‘½ä»¤é€šè¿‡--graphå‚æ•°å¯ä»¥çœ‹åˆ°æäº¤é“¾è·¯ï¼Œé€šè¿‡--pretty=rawå‚æ•°ä»¥ä¾¿æ˜¾ç¤ºæ¯ä¸ªæäº¤å¯¹è±¡çš„parentå±žæ€§ã€‚ æœ€åŽä¸€ä¸ªæäº¤æ²¡æœ‰parentå±žæ€§ï¼Œæ‰€ä»¥è·Ÿè¸ªè¿žåˆ°æ­¤ç»ˆç»“ï¼Œè¿™å®žé™…ä¸Šå°±æ˜¯æäº¤çš„èµ·ç‚¹ã€‚ HEADå’ŒMasteræŽ¢ç§˜ çŽ°åœ¨å…ˆçœ‹ä¸‹å·¥ä½œåŒºçš„çŠ¶æ€ã€‚ 12$ git status -s -b## master ä¸Šé¢åœ¨æ˜¾ç¤ºå·¥ä½œåŒºçŠ¶æ€æ—¶ï¼Œé™¤äº†ä½¿ç”¨-så‚æ•°ä»¥æ˜¾ç¤ºç²¾ç®€è¾“å‡ºå¤–ï¼Œè¿˜ä½¿ç”¨äº†-bå‚æ•°ä»¥ä¾¿èƒ½å¤ŸåŒæ—¶æ˜¾ç¤ºå‡ºå½“å‰å·¥ä½œåˆ†æ”¯çš„åç§°ã€‚ ä½¿ç”¨git branchä¹Ÿå¯ä»¥æ˜¾ç¤ºå½“å‰çš„å·¥ä½œåˆ†æ”¯ã€‚ 12$ git branch * master åœ¨masteråˆ†æ”¯åç§°å‰é¢å‡ºçŽ°ä¸€ä¸ªæ˜Ÿå·è¡¨æ˜Žè¿™ä¸ªåˆ†æ”¯æ˜¯å½“å‰å·¥ä½œåˆ†æ”¯ã€‚ çŽ°åœ¨è¿žç»­æ‰§è¡Œä¸‹é¢ä¸‰ä¸ªå‘½ä»¤ä¼šçœ‹åˆ°ç›¸åŒçš„è¾“å‡ºï¼š 12345$ git log -1 HEAD $ git log -1 master $ git log -1 refs/heads/master ä¹Ÿå°±æ˜¯è¯´åœ¨å½“å‰ç‰ˆæœ¬åº“ä¸­ï¼ŒHEADã€masterå’Œrefs/heads/masterå…·æœ‰ç›¸åŒçš„æŒ‡å‘ã€‚è®©æˆ‘ä»¬åŽ»ç‰ˆæœ¬åº“.gitç›®å½•ä¸­çœ‹ä¸€çœ‹ã€‚ 12345$ find .git -name HEAD -o -name master.git/HEAD.git/logs/HEAD.git/logs/refs/heads/master.git/refs/heads/master æ˜¾ç¤ºä¸€ä¸‹.git/HEADçš„å†…å®¹ï¼š 12$ cat .git/HEADref: refs/heads/master æŠŠHEADçš„å†…å®¹ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šâ€œæŒ‡å‘ä¸€ä¸ªå¼•ç”¨ï¼šrefs/heads/masterâ€ã€‚è¿™ä¸ªå¼•ç”¨åœ¨æ–‡ä»¶.git/refs/heads/masterã€‚ 12$ cat .git/refs/heads/mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31 ç”¨git cat-fileå‘½ä»¤æŸ¥çœ‹ä¸‹a67c6fdd0a0e809340944432a3bf7d78e7e10f31çš„å†…å®¹ã€‚ æ˜¾ç¤ºSHA1å“ˆå¸Œå€¼æŒ‡ä»£çš„æ•°æ®ç±»åž‹ã€‚ 12$ git cat-file -t a67c6commit æ˜¾ç¤ºæäº¤çš„å†…å®¹ã€‚ 1234567$ git cat-file -p a67c6tree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ åŽŸæ¥åˆ†æ”¯masteræŒ‡å‘çš„æ˜¯ä¸€ä¸ªæäº¤IDï¼ˆæœ€æ–°æäº¤ï¼‰ã€‚è¿™æ ·çš„åˆ†æ”¯å®žçŽ°å¾ˆå·§å¦™ï¼šæ—¢ç„¶å¯ä»¥ä»Žä»»ä½•æäº¤å¼€å§‹å»ºç«‹ä¸€æ¡åŽ†å²è·Ÿè¸ªè¿žï¼Œ é‚£ä¹ˆç”¨ä¸€ä¸ªæ–‡ä»¶æŒ‡å‘è¿™ä¸ªé“¾æ¡çš„æœ€æ–°æäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥ç”¨äºŽè¿½è¸ªæ•´ä¸ªæäº¤åŽ†å²äº†ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯.git/refs/heads/masteræ–‡ä»¶ã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªæ›´æŽ¥è¿‘äºŽçœŸå®žçš„ç‰ˆæœ¬åº“ç»“æž„å›¾ï¼š ç›®å½•.git/refsæ˜¯ä¿å­˜å¼•ç”¨çš„å‘½åç©ºé—´ï¼Œå…¶ä¸­.git/refs/headsç›®å½•ä¸‹çš„å¼•ç”¨åˆç§°ä¸ºåˆ†æ”¯ã€‚å¯¹äºŽåˆ†æ”¯æ—¢å¯ä»¥ä½¿ç”¨æ­£è§„çš„é•¿æ ¼å¼è¡¨ç¤ºæ³•ï¼Œå¦‚refs/heads/masterï¼Œ ä¹Ÿå¯ä»¥åŽ»æŽ‰å‰é¢çš„ä¸¤çº§ç›®å½•ç”¨masterè¡¨ç¤ºã€‚Gitæœ‰ä¸€ä¸ªåº•å±‚å‘½ä»¤git rev-parseå¯ä»¥ç”¨äºŽæ˜¾ç¤ºå¼•ç”¨å¯¹åº”çš„æäº¤IDã€‚ 12345678$ git rev-parse mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git rev-parse refs/heads/master a67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git rev-parse HEAD a67c6fdd0a0e809340944432a3bf7d78e7e10f31 å¯ä»¥çœ‹å‡ºå®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ä¸‹é¢æ¥å±•ç¤ºä¸€ä¸‹æäº¤çš„SHA1å“ˆå¸Œå€¼ç”Ÿæˆæ–¹æ³•ã€‚ çœ‹çœ‹HEADå¯¹åº”çš„æäº¤çš„å†…å®¹ã€‚ä½¿ç”¨git cat-fileå‘½ä»¤ã€‚ 1234567$ git cat-file commit HEADtree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ æäº¤ä¿¡æ¯ä¸­æ€»å…±åŒ…å«243ä¸ªå­—ç¬¦ã€‚ 1$ git cat-file commit HEAD | wc -c åœ¨æäº¤ä¿¡æ¯çš„å‰é¢åŠ ä¸Šå†…å®¹commit 243&lt;null&gt;(&lt;null&gt;ä¸ºç©ºå­—ç¬¦)ï¼Œç„¶åŽæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf &quot;commit 243\000&quot;; git cat-file commit HEAD) | sha1suma67c6fdd0a0e809340944432a3bf7d78e7e10f31 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 1$ git rev-parse HEAD ä¸‹é¢çœ‹ä¸€çœ‹æ–‡ä»¶å†…å®¹çš„SHA1å“ˆå¸Œå€¼ç”Ÿæˆæ–¹æ³•ã€‚ çœ‹çœ‹ç‰ˆæœ¬åº“ä¸­welcome.txtçš„å†…å®¹ï¼Œä½¿ç”¨git cat-fileå‘½ä»¤ã€‚ 123$ git cat-file blob HEAD:welcome.txtHello Git.å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ æ–‡ä»¶æ€»å…±åŒ…å«33å­—èŠ‚çš„å†…å®¹ã€‚ 12$ git cat-file blob HEAD:welcome.txt | wc -c 33 åœ¨æ–‡ä»¶å†…å®¹çš„å‰é¢åŠ ä¸Šblob 33&lt;null&gt;çš„å†…å®¹ï¼Œç„¶åŽæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf &quot;blob 33\000&quot;; git cat-file blob HEAD:welcome.txt) | sha1sumd7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 12$ git rev-parse HEAD:welcome.txtd7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 æœ€åŽå†æ¥çœ‹çœ‹æ ‘çš„SHA1å“ˆå¸Œå€¼çš„å½¢æˆæ–¹æ³•ã€‚ HEADå¯¹åº”çš„æ ‘çš„å†…å®¹å…±åŒ…å«39ä¸ªå­—èŠ‚ã€‚ 12$ git cat-file tree HEAD^&#123;tree&#125; | wc -c39 åœ¨æ ‘çš„å†…å®¹çš„å‰é¢åŠ ä¸Štree 39&lt;null&gt;çš„å†…å®¹ï¼Œç„¶åŽæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf &quot;tree 39\000&quot;; git cat-file tree HEAD^&#123;tree&#125;) | sha1sumb79fd13fac802739388af44a81d72b6e1d68da89 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 12$ git rev-parse HEAD^&#123;tree&#125;b79fd13fac802739388af44a81d72b6e1d68da89 Gitæä¾›äº†å¾ˆå¤šæ–¹æ³•å¯ä»¥æ–¹ä¾¿çš„è®¿é—®Gitåº“ä¸­çš„å¯¹è±¡ã€‚ é‡‡ç”¨éƒ¨åˆ†SHA1å“ˆå¸Œå€¼ã€‚ä¸å¿…å†™å…¨40ä½çš„å“ˆå¸Œå€¼ï¼Œåªé‡‡ç”¨å¼€å¤´çš„éƒ¨åˆ†ï¼Œä¸å’ŒçŽ°æœ‰å…¶ä»–çš„å†²çªå³å¯ã€‚ ä½¿ç”¨masterä»£è¡¨åˆ†æ”¯masterä¸­æœ€æ–°çš„æäº¤ï¼Œä½¿ç”¨å…¨ç§°refs/heads/masteräº¦å¯ã€‚ ä½¿ç”¨HEADä»£è¡¨ç‰ˆæœ¬åº“ä¸­æœ€è¿‘çš„ä¸€æ¬¡æäº¤ã€‚ ç¬¦å·^å¯ä»¥ç”¨äºŽæŒ‡ä»£çˆ¶æäº¤ã€‚ä¾‹å¦‚ï¼š HEAD^ä»£è¡¨ç‰ˆæœ¬åº“ä¸­ä¸Šä¸€æ¬¡æäº¤ï¼Œå³æœ€è¿‘ä¸€æ¬¡æäº¤çš„çˆ¶æäº¤ã€‚ HEAD^^åˆ™ä»£è¡¨HEAD^çš„çˆ¶æäº¤ã€‚ å¯¹äºŽä¸€ä¸ªæäº¤æœ‰å¤šä¸ªçˆ¶æäº¤ï¼Œå¯ä»¥åœ¨ç¬¦å·^åŽé¢ç”¨æ•°å­—è¡¨ç¤ºæ˜¯ç¬¬å‡ ä¸ªçˆ¶æäº¤ã€‚ä¾‹å¦‚ï¼š a5731^2å«ä¹‰æ˜¯æäº¤a5731çš„å¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬äºŒä¸ªçˆ¶æäº¤ã€‚ HEAD^1ç›¸å½“äºŽHEAD^å«ä¹‰æ˜¯HEADå¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ HEAD^^2å«ä¹‰æ˜¯HEAD^(HEADçˆ¶æäº¤)çš„å¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬äºŒä¸ªã€‚ ç¬¦å·~&lt;n&gt;ä¹Ÿå¯ä»¥ç”¨äºŽæŒ‡ä»£ç¥–å…ˆæäº¤ã€‚ä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼æ•ˆæžœç­‰åŒï¼š 12a5731~5a5731^^^^^ æäº¤æ‰€å¯¹åº”çš„æ ‘å¯¹è±¡ï¼Œå¯ä»¥ç”¨ç±»ä¼¼å¦‚ä¸‹çš„è¯­æ³•è®¿é—®ã€‚ 1a5731^&#123;tree&#125; æŸä¸€æ­¤æäº¤å¯¹åº”çš„æ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„è¯­æ³•è®¿é—®ã€‚ 1a5731:path/to/file æš‚å­˜åŒºä¸­çš„æ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹è¯­æ³•è®¿é—®ã€‚ 1:path/to/file ä¸‹é¢ä½¿ç”¨git rev-parseç»ƒä¹ ä¸‹ã€‚ 12345678910111213141516$ git rev-parse HEAD a67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git cat-file -p a67c6f tree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ$ git rev-parse a67c6f^&#123;tree&#125;b79fd13fac802739388af44a81d72b6e1d68da89$ git rev-parse a67c6f^^&#123;tree&#125;a070b35c2d55e057a2eead7b8ae1b06c3e4d8e3b]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å·¥ä½œåŒºã€æš‚å­˜åŒºã€HEAD]]></title>
    <url>%2Fposts%2F2c9fc045.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹ä¸€ä¸‹git-demoçš„æäº¤æ—¥å¿—ï¼Œä½¿ç”¨git logæŸ¥çœ‹æäº¤æ—¥å¿—ï¼ˆé™„åŠ --statå‚æ•°å¯ä»¥çœ‹åˆ°æ¯æ¬¡æäº¤çš„æ–‡ä»¶å˜æ›´ç»Ÿè®¡ï¼‰ã€‚ 1$ git log --stat é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡æäº¤å¯¹æ–‡ä»¶welcome.txtæœ‰ä¸€è¡Œçš„å˜æ›´ï¼Œè€Œç¬¬äºŒæ¬¡æäº¤å› ä¸ºä½¿ç”¨äº†--allow-emptyå‚æ•°è¿›è¡Œçš„ç©ºæäº¤ï¼Œæ‰€ä»¥æäº¤è¯´æ˜Žä¸­çœ‹ä¸åˆ°ä»»ä½•å¯¹å®žè´¨å†…å®¹çš„ä¿®æ”¹ã€‚ ä¿®æ”¹ä¸èƒ½ç›´æŽ¥æäº¤ï¼Ÿ é¦–å…ˆæ›´æ”¹welcome.txtæ–‡ä»¶çš„å†…å®¹ï¼Œåœ¨æ–‡ä»¶åŽé¢è¿½åŠ ä¸€è¡Œã€‚ 1$ echo &quot;å¾ˆé«˜å…´è§åˆ°ä½ ã€‚&quot; &gt;&gt; welcome.txt è¿™æ—¶å°±å¯ä»¥é€šè¿‡git diffå‘½ä»¤çœ‹åˆ°ä¿®æ”¹åŽçš„æ–‡ä»¶å’Œç‰ˆæœ¬åº“ä¸­æ–‡ä»¶çš„å·®å¼‚ã€‚å®žè´¨å’Œæœ¬åœ°æ¯”è¾ƒçš„ä¸æ˜¯ç‰ˆæœ¬åº“ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸­é—´çŠ¶æ€çš„æ–‡ä»¶ã€‚ 1$ git diff æŽ¥ä¸‹æ¥æ‰§è¡Œæäº¤ï¼Œçœ‹èƒ½å¦æäº¤æˆåŠŸã€‚ 1$ git commit -m &quot;è¿½åŠ ä¸€è¡Œï¼šå¾ˆé«˜å…´è§åˆ°ä½ ã€‚&quot; æäº¤æˆåŠŸäº†å—ï¼Ÿå¥½åƒæ²¡æœ‰ã€‚ æäº¤æ²¡æœ‰æˆåŠŸçš„è¯æ®ï¼š å…ˆçœ‹çœ‹æäº¤æ—¥å¿—ï¼Œå¦‚æžœæäº¤æˆåŠŸå°±ä¼šæœ‰æ–°çš„æäº¤è®°å½•ã€‚ 1$ git log --pretty=oneline ä½¿ç”¨äº†ç²¾ç®€è¾“å‡ºæ¥æ˜¾ç¤ºæ—¥å¿—ï¼Œä»¥ä¾¿æ›´ç®€æ´å’Œæ¸…æ™°åœ°çœ‹åˆ°æäº¤åŽ†å²ã€‚å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬åº“ä¸­åªæœ‰ä¸¤ä¸ªæäº¤ï¼Œé’ˆå¯¹åˆšæ‰ä¿®æ”¹æ–‡ä»¶çš„æäº¤æ²¡æœ‰æˆåŠŸï¼ æ‰§è¡Œgit diffå¯ä»¥çœ‹åˆ°å’Œä¹‹å‰ç›¸åŒçš„å·®å¼‚è¾“å‡ºï¼Œè¿™ä¹Ÿè¯´æ˜Žæäº¤æ²¡æœ‰æˆåŠŸã€‚ æ‰§è¡Œgit statusæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤„äºŽæœªæäº¤çŠ¶æ€ã€‚ æ‰§è¡Œgit status -så¯ä»¥æ˜¾ç¤ºç²¾ç®€æ ¼å¼çš„çŠ¶æ€è¾“å‡ºã€‚ æäº¤ä¸ºä»€ä¹ˆä¼šå¤±è´¥å‘¢ï¼ŸåŽŸå› æ˜¯æ²¡æœ‰å¯¹ä¿®æ”¹çš„welcome.txtæ–‡ä»¶æ‰§è¡Œgit addå‘½ä»¤ï¼Œå°†ä¿®æ”¹çš„æ–‡ä»¶æ·»åŠ åˆ°â€œæäº¤ä»»åŠ¡â€ï¼Œç„¶åŽæ‰èƒ½æäº¤ã€‚ çŽ°åœ¨å°±å°†ä¿®æ”¹çš„æ–‡ä»¶â€œæ·»åŠ â€åˆ°æäº¤ä»»åŠ¡ã€‚ 1$ git add welcome.txt çŽ°åœ¨å†æ‰§è¡Œä¸€äº›Gitå‘½ä»¤ï¼Œçœ‹çœ‹å½“æ‰§è¡Œâ€œæ·»åŠ â€åŽä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚ æ‰§è¡Œgit diffæ²¡æœ‰è¾“å‡ºã€‚ æ‰§è¡Œgit diff headæˆ–git diff masterè¿›è¡Œæ¯”è¾ƒä¼šå‘çŽ°æœ‰å·®å¼‚ï¼Œè¿™ä¸ªå·®å¼‚æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æäº¤ã€‚ 1$ git diff head æ‰§è¡Œgit statusï¼ŒçŠ¶æ€è¾“å‡ºå’Œä¹‹å‰ä¸ä¸€æ ·äº†ã€‚ 1$ git status å¯¹æ–°çš„GitçŠ¶æ€è¾“å‡ºåšä¸‹ç¿»è¯‘ï¼š 12345ä½äºŽåˆ†æ”¯masterä¸Šä¸‹åˆ—çš„ä¿®æ”¹å°†è¢«æäº¤ï¼š ï¼ˆå¦‚æžœä½ åŽæ‚”äº†ï¼Œå¯ä»¥ä½¿ç”¨â€œgit reset HEAD &lt;file&gt;...â€å‘½ä»¤å°†ä¸‹åˆ—æ”¹åŠ¨æ’¤å‡ºæäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ï¼Œ å¦åˆ™æ‰§è¡Œæäº¤å‘½ä»¤å°†ä¼šæäº¤ï¼‰ å·²ä¿®æ”¹ï¼š welcome.txt ä¸å¾—ä¸è¯´ï¼ŒGitå¤ªäººæ€§åŒ–äº†ï¼Œå®ƒæŠŠå„ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨åˆ°çš„å‘½ä»¤éƒ½å‘Šè¯‰äº†ç”¨æˆ·ï¼Œè™½ç„¶è¿™æ˜¾å¾—æœ‰ç‚¹å•°å—¦ã€‚ å¦‚æžœä¸è¦è¿™ä¹ˆå•°å—¦ï¼Œå¯ä»¥ä½¿ç”¨ç®€æ´æ–¹å¼ï¼š 12$ git status -sM welcome.txt ä¸Šé¢ç²¾ç®€çŠ¶æ€è¾“å‡ºä¸Žæ‰§è¡Œgit addä¹‹å‰çš„ç²¾ç®€çŠ¶æ€çš„è¾“å‡ºç›¸æ¯”ï¼Œæœ‰ç»†å¾®çš„å·®åˆ«ã€‚ è™½ç„¶éƒ½æ˜¯M(Modified)æ ‡è¯†ï¼Œä½†æ˜¯ä½ç½®ä¸åŒã€‚åœ¨æ‰§è¡Œgit addä¹‹å‰ï¼Œè¿™ä¸ªMä½äºŽç¬¬äºŒåˆ—ï¼ˆç¬¬ä¸€åˆ—æ˜¯ä¸ªç©ºæ ¼ï¼‰ï¼Œæ‰§è¡Œå®Œgit addä¹‹åŽï¼Œå­—ç¬¦Mä½äºŽç¬¬ä¸€åˆ—ï¼ˆç¬¬äºŒåˆ—æ˜¯ç©ºç™½ï¼‰ã€‚ ä½äºŽç¬¬ä¸€åˆ—çš„å­—ç¬¦Mçš„å«ä¹‰ï¼šç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å’Œå¤„äºŽä¸­é—´çŠ¶æ€--æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”æœ‰æ”¹åŠ¨ï¼› ä½äºŽç¬¬äºŒåˆ—çš„å­—ç¬¦Mçš„å«ä¹‰ï¼šå·¥ä½œåŒºå½“å‰çš„æ–‡ä»¶å’Œå¤„äºŽä¸­é—´çŠ¶æ€--æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”æœ‰æ”¹åŠ¨ã€‚ è¿™æ—¶å¦‚æžœç›´æŽ¥æäº¤git commit,åŠ å…¥æäº¤ä»»åŠ¡çš„welcome.txtæ–‡ä»¶çš„æ›´æ”¹å°±è¢«æäº¤å…¥åº“äº†ã€‚ä½†æ˜¯å…ˆä¸å¿™ç€æäº¤ï¼Œå†è¿›è¡Œä¸€äº›æ“ä½œï¼Œçœ‹çœ‹èƒ½å¦è¢«å½»åº•æžç³Šæ¶‚ã€‚ ç»§ç»­ä¿®æ”¹welcome.txtæ–‡ä»¶ï¼ˆåœ¨æ–‡ä»¶åŽé¢è¿½åŠ ä¸€è¡Œï¼‰ã€‚ 1$ echo &quot;Good-bye&quot; &gt;&gt; welcome.txt ç„¶åŽæ‰§è¡Œgit statusæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š 1git status çŠ¶æ€è¾“å‡ºä¸­å±…ç„¶æ˜¯ä¹‹å‰å‡ºçŽ°çš„ä¸¤ç§ä¸åŒçŠ¶æ€çš„è¾“å‡ºã€‚ ä½¿ç”¨ç®€æ´æ¨¡å¼è¾“å‡ºï¼Œä¹Ÿä¼šçœ‹åˆ°ä¸¤ç§ç²¾ç®€è¾“å‡ºçš„æ‚åˆã€‚ 1git status -s ä¸Šé¢GitçŠ¶æ€çš„è¾“å‡ºå¯ä»¥è¿™ä¹ˆç†è§£ï¼šä¸ä½†ç‰ˆæœ¬åº“ä¸­æœ€æ–°æäº¤çš„æ–‡ä»¶å’Œå¤„äºŽä¸­é—´çŠ¶æ€ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­æ–‡ä»¶ ç›¸æ¯”æœ‰æ”¹åŠ¨ï¼Œè€Œä¸”å·¥ä½œåŒºå½“å‰çš„æ–‡ä»¶å’Œå¤„äºŽä¸­é—´çŠ¶æ€ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”ä¹Ÿæœ‰æ”¹åŠ¨ã€‚ å³çŽ°åœ¨welcome.txtä¸­æœ‰ä¸‰ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼šä¸€ä¸ªåœ¨å·¥ä½œåŒºï¼Œä¸€ä¸ªåœ¨æš‚å­˜åŒºï¼Œä¸€ä¸ªæ˜¯ç‰ˆæœ¬åº“ä¸­æœ€æ–°ç‰ˆæœ¬ã€‚é€šè¿‡ ä¸åŒçš„å‚æ•°è°ƒç”¨git diffå‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸åŒç‰ˆæœ¬åº“ä¹‹é—´çš„å·®å¼‚ã€‚ ä¸å¸¦ä»»ä½•é€‰é¡¹å’Œå‚æ•°è°ƒç”¨git diffæ˜¾ç¤ºå·¥ä½œåŒºæœ€æ–°æ”¹åŠ¨ï¼Œå³å·¥ä½œåŒºå’Œæäº¤æš‚å­˜åŒºä¸­ç›¸æ¯”çš„å·®å¼‚ã€‚ å°†å·¥ä½œåŒºå’ŒHEADï¼ˆå½“å‰å·¥ä½œåˆ†æ”¯ï¼‰ç›¸æ¯”ï¼Œä¼šçœ‹åˆ°æ›´å¤šå·®å¼‚ã€‚ é€šè¿‡å‚æ•°--cachedæˆ–è€…--stagedå‚æ•°è°ƒç”¨git diffå‘½ä»¤ï¼Œçœ‹åˆ°çš„æ˜¯æäº¤æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¸­æ–‡ä»¶çš„å·®å¼‚ã€‚ å¥½äº†ï¼ŒçŽ°åœ¨æäº¤ä¸‹çœ‹çœ‹ã€‚ 123$ git commit -m &quot;å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ&quot;[master a67c6fd] å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ 1 file changed, 1 insertion(+) è¿™æ¬¡æäº¤ç»ˆäºŽæˆåŠŸäº†ï¼ŒæŸ¥çœ‹ä¸‹æ—¥å¿—ï¼š 1234$ git log --pretty=onelinea67c6fdd0a0e809340944432a3bf7d78e7e10f31 (HEAD -&gt; master) å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿd3617dadd10c274e6e2b6caf47635d5771b9034c è¿™æ˜¯è°æäº¤çš„ï¼Ÿd3e0684a1c510f4effd155b01591019e2c5d7812 åˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤ æŸ¥çœ‹ç²¾ç®€çŠ¶æ€è¾“å‡ºï¼š 12$ git status -s M welcome.txt çŠ¶æ€è¾“å‡ºä¸­æ–‡ä»¶åçš„å‰é¢å‡ºçŽ°äº†ä¸€ä¸ªå­—æ¯Mï¼Œå³åªä½äºŽç¬¬äºŒåˆ—çš„å­—æ¯Mã€‚é‚£ä¹ˆç¬¬ä¸€åˆ—çš„MåŽ»å“ªäº†ï¼Ÿå¾ˆæ˜Žæ˜¾è¢«æäº¤äº†ã€‚ å³æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„å†…å®¹è¢«æäº¤åˆ°ç‰ˆæœ¬åº“ï¼Œæ‰€ä»¥ç¬¬ä¸€åˆ—å› ä¸ºæäº¤æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¸­çš„çŠ¶æ€ä¸€è‡´ï¼Œæ‰€ä»¥æ˜¾ç¤ºç©ºç™½ã€‚ é‚£æäº¤çš„welcome.txtæ˜¯å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Ÿé€šè¿‡æ‰§è¡Œgit diffæˆ–è€…git diff headå‘½ä»¤æŸ¥çœ‹å·®å¼‚ã€‚è™½ç„¶å‘½ä»¤ git diffå’Œgit diff headçš„æ¯”è¾ƒè¿‡ç¨‹å¹¶ä¸åŒï¼Œä½†æ˜¯ä¼šçœ‹åˆ°ä¸‹é¢ç›¸åŒçš„å·®å¼‚è¾“å‡ºç»“æžœã€‚ 12$ git diff$ git diff head ç†è§£Gitæš‚å­˜åŒºï¼ˆstageï¼‰ Gitæš‚å­˜åŒºï¼ˆstageï¼Œæˆ–ç§°ä¸ºindexï¼‰çš„è®¾è®¡æ˜¯Gitæœ€æˆåŠŸçš„è®¾è®¡ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ä¸€ä¸ªè®¾è®¡ã€‚ åœ¨ç‰ˆæœ¬åº“.gitç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªindexæ–‡ä»¶ï¼Œä¸‹é¢é’ˆå¯¹è¿™ä¸ªæ–‡ä»¶åšä¸ªå®žéªŒã€‚ é¦–å…ˆæ‰§è¡Œgit checkoutå‘½ä»¤ï¼Œæ’¤é”€å·¥ä½œåŒºä¸­welcome.txtæ–‡ä»¶å°šæœªæäº¤çš„ä¿®æ”¹ã€‚ 12$ git checkout -- welcome.txt$ git status -s é€šè¿‡çŠ¶æ€è¾“å‡ºå¯ä»¥çœ‹åˆ°å·¥ä½œåŒºå·²ç»æ²¡æœ‰æ”¹åŠ¨äº†ï¼ŒæŸ¥çœ‹ä¸‹.git/indexæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼š 2019-06-10 22:00:43 1$ ls --full-time .git/index å†æ¬¡æ‰§è¡Œgit statuså‘½ä»¤ï¼Œç„¶åŽæ˜¾ç¤º.git/indexæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼š2019-06-10 22:00:43ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ã€‚ 12$ git status -s $ ls --full-time .git/index çŽ°åœ¨æ›´æ”¹ä¸€ä¸‹welcome.txtæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œä½†ä¸æ”¹å˜å®ƒçš„å†…å®¹ã€‚ç„¶åŽå†æ‰§è¡Œgit statuså‘½ä»¤ï¼Œç„¶åŽæŸ¥çœ‹.git/indexæ–‡ä»¶æ—¶é—´æˆ³ä¸ºï¼š22:06:32 123$ touch welcome.txt$ git status -s $ ls --full-time .git/index å¯ä»¥çœ‹åˆ°æ—¶é—´æˆ³æ”¹å˜äº†ã€‚ è¿™ä¸ªå®žéªŒè¯´æ˜Žå½“æ‰§è¡Œgit statusæˆ–è€…git diffå‘½ä»¤æ‰«æå·¥ä½œåŒºæ”¹åŠ¨çš„æ—¶å€™ï¼Œå…ˆä¾æ®.git/indexæ–‡ä»¶ä¸­è®°å½•çš„ ï¼ˆå·¥ä½œåŒºè·Ÿè¸ªæ–‡ä»¶ï¼‰æ—¶é—´æˆ³ã€é•¿åº¦ç­‰ä¿¡æ¯åˆ¤æ–­å·¥ä½œåŒºæ–‡ä»¶æ˜¯å¦æ”¹å˜ã€‚å¦‚æžœå·¥ä½œåŒºçš„æ–‡ä»¶æ—¶é—´æˆ³æ”¹å˜ï¼Œè¯´æ˜Žæ–‡ä»¶çš„ å†…å®¹å¯èƒ½è¢«æ”¹å˜äº†ï¼Œéœ€è¦æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå’Œæ›´æ”¹å‰çš„åŽŸå§‹æ–‡ä»¶ç›¸æ¯”ï¼Œåˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦è¢«æ›´æ”¹ã€‚å¦‚æžœ æ–‡ä»¶å†…å®¹æ²¡æœ‰æ”¹å˜ï¼Œåˆ™å°†è¯¥æ–‡ä»¶æ–°çš„æ—¶é—´æˆ³è®°å½•åˆ°.git/indexæ–‡ä»¶ä¸­ã€‚å› ä¸ºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ›´æ”¹ä½¿ç”¨çš„æ˜¯æ—¶é—´æˆ³ã€ æ–‡ä»¶é•¿åº¦ç­‰ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œè¦æ¯”é€šè¿‡æ–‡ä»¶å†…å®¹æ¯”è¾ƒå¿«çš„å¤šï¼Œæ‰€ä»¥GItè¿™æ ·çš„å®žçŽ°æ–¹å¼å¯ä»¥è®©å·¥ä½œåŒºçŠ¶æ€æ‰«ææ›´å¿« æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯Gité«˜æ•ˆçš„å› ç´ ä¹‹ä¸€ã€‚ æ–‡ä»¶.git/indexå®žé™…ä¸Šå°±æ˜¯ä¸€ä¸ªåŒ…å«æ–‡ä»¶ç´¢å¼•çš„ç›®å½•æ ‘ï¼Œåƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å·¥ä½œåŒºã€‚åœ¨è¿™ä¸ªè™šæ‹Ÿå·¥ä½œåŒºçš„ç›®å½•æ ‘ä¸­ï¼Œ è®°å½•äº†æ–‡ä»¶åã€æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼ˆæ—¶é—´æˆ³ã€æ–‡ä»¶é•¿åº¦ç­‰ï¼‰ã€‚æ–‡ä»¶çš„å†…å®¹å¹¶ä¸å­˜å‚¨å…¶ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨Gitå¯¹è±¡åº“ .git/objectsç›®å½•ä¸­ï¼Œæ–‡ä»¶ç´¢å¼•å»ºç«‹äº†æ–‡ä»¶å’Œå¯¹è±¡åº“ä¸­å¯¹è±¡å®žä½“ä¹‹é—´çš„å¯¹åº”ã€‚ ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†å·¥ä½œåŒºã€ç‰ˆæœ¬åº“ä¸­çš„æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´çš„å…³ç³»ã€‚ å›¾ä¸­å·¦ä¾§ä¸ºå·¥ä½œåŒºï¼Œå³ä¾§ä¸ºç‰ˆæœ¬åº“ã€‚åœ¨ç‰ˆæœ¬åº“ä¸­æ ‡è®°ä¸ºindexçš„åŒºåŸŸæ˜¯æš‚å­˜åŒº(stageï¼Œäº¦ç§°index),æ ‡è®°ä¸ºmasterçš„æ˜¯masteråˆ†æ”¯æ‰€ä»£è¡¨çš„ç›®å½•æ ‘ã€‚ å›¾ä¸­å¯ä»¥çœ‹å‡ºæ­¤æ—¶HEADå®žé™…ä¸Šæ˜¯æŒ‡å‘masteråˆ†æ”¯çš„ä¸€ä¸ªâ€œæ¸¸æ ‡â€ï¼Œæ‰€ä»¥å›¾ç¤ºçš„å‘½ä»¤ä¸­å‡ºçŽ°HEADçš„åœ°æ–¹å¯ä»¥ç”¨masteræ›¿æ¢ã€‚ å›¾ä¸­çš„objectsæ ‡è¯†çš„åŒºåŸŸä¸ºGitçš„å¯¹è±¡åº“ï¼Œå®žé™…ä½äºŽ.git/objectsç›®å½•ä¸‹ã€‚ å½“å¯¹å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢žï¼‰çš„æ–‡ä»¶æ‰§è¡Œgit addå‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘è¢«æ›´æ–°ï¼ŒåŒæ—¶å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢žï¼‰çš„æ–‡ä»¶ å†…å®¹è¢«å†™å…¥åˆ°å¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­ï¼Œè€Œå¯¹è±¡çš„IDè¢«è®°å½•åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ç´¢å¼•ä¸­ã€‚ å½“æ‰§è¡Œæäº¤æ“ä½œæ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘å†™åˆ°ç‰ˆæœ¬åº“ï¼ˆå¯¹è±¡åº“ï¼‰ä¸­ï¼Œmasteråˆ†æ”¯ä¼šåšå‡ºç›¸åº”çš„æ›´æ–°ã€‚å³masteræœ€æ–°æŒ‡å‘çš„ç›®å½•æ ‘å°±æ˜¯æäº¤æ—¶åŽŸæš‚å­˜åŒºçš„ç›®å½•æ ‘ã€‚ å½“æ‰§è¡Œgit reset HEADå‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘ä¼šè¢«é‡å†™ï¼Œè¢«masteråˆ†æ”¯æŒ‡å‘çš„ç›®å½•æ ‘æ‰€æ›¿æ¢ï¼Œä½†æ˜¯å·¥ä½œåŒºä¸å—å½±å“ã€‚ å½“æ‰§è¡Œgit rm --cached &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç›´æŽ¥ä»Žæš‚å­˜åŒºåˆ é™¤æ–‡ä»¶ï¼Œå·¥ä½œåŒºåˆ™ä¸åšæ”¹å˜ã€‚ å½“æ‰§è¡Œgit checkout . æˆ–è€…git checkout -- &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç”¨æš‚å­˜åŒºå…¨éƒ¨æˆ–æŒ‡å®šçš„æ–‡ä»¶æ›¿æ¢å·¥ä½œåŒºçš„æ–‡ä»¶ï¼Œã€‚ è¿™ä¸ªæ“ä½œå¾ˆå±é™©ï¼Œä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„æ”¹åŠ¨ã€‚ å½“æ‰§è¡Œgit checkout HEAD .æˆ–è€…git checkout HEAD &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç”¨HEADæŒ‡å‘çš„masteråˆ†æ”¯ä¸­çš„å…¨éƒ¨æˆ–è€… éƒ¨åˆ†æ–‡ä»¶æ›¿æ¢æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­çš„æ–‡ä»¶ã€‚è¿™ä¸ªå‘½ä»¤ä¹Ÿæžå…·å±é™©æ€§ï¼Œå› ä¸ºä¸ä½†ä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ï¼Œä¹Ÿä¼šæ¸…é™¤æš‚å­˜åŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ã€‚ Git Diff é­”æ³• æš‚å­˜åŒºç›®å½•æ ‘æµè§ˆ å¯¹äºŽHEADï¼ˆç‰ˆæœ¬åº“ä¸­å½“å‰æäº¤ï¼‰æŒ‡å‘çš„ç›®å½•æ ‘ï¼Œå¯ä»¥ä½¿ç”¨git ls-treeæ¥æŸ¥çœ‹ã€‚ 12$ git ls-tree -l HEAD 100644 blob d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 33 welcome.txt ä½¿ç”¨-lå‚æ•°ï¼Œå¯ä»¥æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚ä¸Šé¢welcome.txtå¤§å°33å­—èŠ‚ã€‚ è¾“å‡ºçš„æ¡ç›®ä»Žå·¦è‡³å³ï¼Œç¬¬ä¸€ä¸ªå­—æ®µæ˜¯æ–‡ä»¶çš„å±žæ€§ï¼ˆrw-r--r--ï¼‰,ç¬¬äºŒä¸ªå­—æ®µè¯´æ˜Žæ˜¯Gitå¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªblobå¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰ï¼Œ ç¬¬ä¸‰ä¸ªå­—æ®µåˆ™æ˜¯è¯¥æ–‡ä»¶åœ¨å¯¹è±¡åº“ä¸­å¯¹åº”çš„ID--ä¸€ä¸ª40ä½çš„SHA1å“ˆå¸Œå€¼æ ¼å¼çš„IDï¼Œç¬¬å››ä¸ªå­—æ®µæ˜¯æ–‡ä»¶å¤§å°ï¼Œç¬¬äº”ä¸ªå­—æ®µæ˜¯æ–‡ä»¶åã€‚ åœ¨æµè§ˆæš‚å­˜åŒºä¸­çš„ç›®å½•æ ‘ä¹‹å‰ï¼Œé¦–å…ˆæ¸…é™¤å·¥ä½œåŒºå½“ä¸­çš„æ”¹åŠ¨ã€‚é€šè¿‡ git clean -fdå‘½ä»¤æ¸…é™¤å½“å‰å·¥ä½œåŒºä¸­æ²¡æœ‰åŠ å…¥ ç‰ˆæœ¬åº“çš„æ–‡ä»¶å’Œç›®å½•ï¼ˆéžè·Ÿè¸ªæ–‡ä»¶å’Œç›®å½•ï¼‰ï¼Œç„¶åŽæ‰§è¡Œgit checkout .å‘½ä»¤ï¼Œç”¨æš‚å­˜åŒºåˆ·æ–°å·¥ä½œåŒºã€‚ 12$ git clean -fd$ git checkout . ç„¶åŽåœ¨å·¥ä½œåŒºä¸­åšå‡ºä¸€äº›ä¿®æ”¹ï¼ˆä¿®æ”¹welcome.txtï¼Œå¢žåŠ ä¸€ä¸ªå­ç›®å½•å’Œæ–‡ä»¶ï¼‰ï¼Œç„¶åŽæ·»åŠ åˆ°æš‚å­˜åŒºã€‚æœ€åŽå†å¯¹å·¥ä½œåŒºåšå‡ºä¿®æ”¹ã€‚ 123456$ echo &quot;( ^_^ )/~~æ‹œæ‹œ&quot; &gt;&gt; welcome.txt$ mkdir -p a/b/c$ echo &quot;Hello.&quot; &gt;&gt; a/b/c/hello.txt $ git add .$ echo &quot;ãƒ¾(ï¿£â–½ï¿£)Bye~Bye~&quot; &gt;&gt; a/b/c/hello.txt $ git status -s ä¸Šé¢çš„å‘½ä»¤è¿è¡Œå®Œæ¯•åŽï¼Œé€šè¿‡ç²¾ç®€çš„çŠ¶æ€è¾“å‡ºï¼Œå¯ä»¥çœ‹å‡ºå·¥ä½œåŒºã€æš‚å­˜åŒºã€ç‰ˆæœ¬åº“å½“å‰åˆ†æ”¯çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆHEADï¼‰å„ä¸ç›¸åŒã€‚å…ˆæ¥çœ‹çœ‹å·¥ä½œåŒºä¸­æ–‡ä»¶çš„å¤§å°ï¼š 123$ find . -path ./.git -prune -o -type f -printf &quot;%-20p\t%s\n&quot;./a/b/c/hello.txt 30./welcome.txt 52 è¦æ˜¾ç¤ºæš‚å­˜åŒºçš„ç›®å½•æ ‘ï¼Œå¯ä»¥ä½¿ç”¨git ls-fileså‘½ä»¤ã€‚ 123$ git ls-files -s100644 18832d35117ef2f013c4009f5b2128dfaeff354f 0 a/b/c/hello.txt100644 a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 0 welcome.txt è¿™ä¸ªè¾“å‡ºå’Œä¹‹å‰ä½¿ç”¨git ls-treeå‘½ä»¤çš„è¾“å‡ºä¸ä¸€æ ·ï¼Œå¦‚æžœæƒ³è¦ä½¿ç”¨git ls-treeå‘½ä»¤ï¼Œéœ€è¦å…ˆå°†æš‚å­˜åŒºçš„ ç›®å½•æ ‘å†™å…¥Gitå¯¹è±¡åº“git write-treeå‘½ä»¤ï¼Œç„¶åŽåœ¨é’ˆå¯¹git write-treeå‘½ä»¤å†™å…¥çš„treeæ‰§è¡Œgit ls-treeã€‚ 12345$ git write-tree 1e9d611d50af21a2f0ec7bce6e270fd170a8f557$ git ls-tree -l 040000 tree 53583ee687fbb2e913d18d508aefd512465b2092 - a100644 blob a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 50 welcome.txt ä»Žä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹å‡ºï¼š åˆ°å¤„éƒ½æ˜¯40ä½çš„SHA1å“ˆå¸Œå€¼æ ¼å¼çš„IDï¼Œå¯ä»¥ç”¨äºŽæŒ‡ä»£æ–‡ä»¶å†…å®¹ï¼ˆblobï¼‰ï¼Œç”¨äºŽæŒ‡ä»£ç›®å½•æ ‘(tree)ï¼Œè¿˜å¯ä»¥ç”¨äºŽæŒ‡ä»£æäº¤ã€‚ git write-treeçš„è¾“å‡ºå°±æ˜¯å†™å…¥Gitå¯¹è±¡åº“ä¸­çš„Tree IDï¼Œè¿™ä¸ªIDå°†ä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤çš„è¾“å…¥ã€‚ git ls-treeå‘½ä»¤ä¸­ï¼Œæ²¡æœ‰æŠŠ40ä½çš„IDå†™å…¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å‰å‡ ä½ï¼Œå®žé™…ä¸Šåªè¦ä¸å’Œå…¶ä»–çš„å¯¹è±¡IDå†²çªï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨ç¼©å†™IDã€‚ git ls-treeçš„è¾“å‡ºæ˜¾ç¤ºçš„ç¬¬ä¸€æ¡æ˜¯ä¸€ä¸ªtreeå¯¹è±¡ï¼Œå³åˆšæ‰åˆ›å»ºçš„ä¸€çº§ç›®å½•aã€‚ å¦‚æžœæƒ³è¦é€’å½’æ˜¾ç¤ºç›®å½•å†…å®¹ï¼Œåˆ™ä½¿ç”¨-rå‚æ•°è°ƒç”¨ã€‚ä½¿ç”¨å‚æ•°-tå¯ä»¥æŠŠé€’å½’è¿‡ç¨‹ä¸­é‡åˆ°çš„æ¯æ£µæ ‘éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸æ˜¯åªæ˜¾ç¤ºæœ€ç»ˆçš„æ–‡ä»¶ã€‚ä¸‹é¢æ‰§è¡Œé€’å½’æ“ä½œæ˜¾ç¤ºç›®å½•æ ‘çš„å†…å®¹ã€‚ 123456$ git write-tree | xargs git ls-tree -l -r -t040000 tree 53583ee687fbb2e913d18d508aefd512465b2092 - a040000 tree 514d729095b7bc203cf336723af710d41b84867b - a/b040000 tree deaec688e84302d4a0b98a1b78a434be1b22ca02 - a/b/c100644 blob 18832d35117ef2f013c4009f5b2128dfaeff354f 7 a/b/c/hello.txt100644 blob a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 50 welcome.txt é€šè¿‡ä½¿ç”¨ä¸åŒçš„å‚æ•°è°ƒç”¨git diffå‘½ä»¤ï¼Œå¯ä»¥å¯¹å·¥ä½œåŒºã€æš‚å­˜åŒºã€HEADä¸­çš„å†…å®¹ä¸¤ä¸¤æ¯”è¾ƒã€‚ä¸‹é¢çš„å›¾å±•ç¤ºäº†git diffå‘½ä»¤çš„ä½œç”¨èŒƒå›´ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾å°±ä¸éš¾ç†è§£ä¸‹é¢å‘½ä»¤çš„è¾“å‡ºã€‚ å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ¯”è¾ƒã€‚ 1$ git diff æš‚å­˜åŒºå’ŒHEADæ¯”è¾ƒã€‚ 1$ git diff --cached å·¥ä½œåŒºå’ŒHEADæ¯”è¾ƒã€‚ 1$ git diff HEAD ä¸è¦ä½¿ç”¨git commit -a å®žé™…ä¸ŠGitçš„æäº¤å‘½ä»¤git commitå¯ä»¥å¸¦ä¸Š-aå‚æ•°ï¼Œå¯¹æœ¬åœ°æ‰€æœ‰å˜æ›´çš„æ–‡ä»¶æ‰§è¡Œæäº¤æ“ä½œï¼ŒåŒ…æ‹¬æœ¬åœ°ä¿®æ”¹çš„æ–‡ä»¶ï¼Œåˆ é™¤çš„æ–‡ä»¶ï¼Œä½†ä¸åŒ…æ‹¬æœªè¢«ç‰ˆæœ¬åº“è·Ÿè¸ªçš„æ–‡ä»¶ã€‚ è¿™ä¸ªå‘½ä»¤çš„ç¡®å¯ä»¥ç®€åŒ–ä¸€äº›æ“ä½œï¼Œä½†åŒæ—¶ä¼šä¸¢æŽ‰Gitæš‚å­˜åŒºå¸¦ç»™ç”¨æˆ·æœ€å¤§çš„å¥½å¤„ï¼šå¯¹æäº¤å†…å®¹è¿›è¡ŒæŽ§åˆ¶çš„èƒ½åŠ›ã€‚]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~åˆå§‹åŒ–]]></title>
    <url>%2Fposts%2F7230a407.html</url>
    <content type="text"><![CDATA[åˆ›å»ºç‰ˆæœ¬åº“åŠç¬¬ä¸€æ¬¡æäº¤ é¦–å…ˆçœ‹ä¸€ä¸‹å½“å‰Gitçš„ç‰ˆæœ¬ 1$ git --version åœ¨å¼€å§‹Gitä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸‹Gitçš„çŽ¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªè®¾ç½®æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œã€‚å³è¿™äº›è®¾ç½®ä¼šåœ¨å…¨å±€æ–‡ä»¶ï¼ˆç”¨æˆ·ä¸»ç›®å½•çš„ .gitconfigï¼‰æˆ–ç³»ç»Ÿæ–‡ä»¶ï¼ˆ/etc/gitconfigï¼‰ä¸­åšæ°¸ä¹…è®°å½•ã€‚ å‘Šè¯‰Gitå½“å‰ç”¨æˆ·çš„å§“åå’Œé‚®ä»¶åœ°å€ï¼Œé…ç½®çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€å°†åœ¨ç‰ˆæœ¬åº“æäº¤æ—¶ä½œä¸ºæäº¤è€…çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€ã€‚ 12$ git config --global user.name &quot;wanghongbo&quot;$ git config --global user.email whb@163.com è®¾ç½®ä¸€äº›Gitåˆ«åï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨æ›´ä¸ºç®€æ´çš„å­å‘½ä»¤ã€‚ ä¾‹å¦‚ï¼šè¾“å…¥ git ci å³ç›¸å½“äºŽ git commit -s ï¼Œè¾“å…¥git st å³ç›¸å½“äºŽ git -p statusã€‚ å¦‚æžœæ‹¥æœ‰ç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼Œå¸Œæœ›æ³¨å†Œçš„å‘½ä»¤åˆ«åèƒ½è¢«æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1234$ git config --system alias.br branch$ git config --system alias.ci &quot;commit -s&quot;$ git config --system alias.co checkout$ git config --system alias.st &quot;-p status&quot; - å¦‚æžœåªåœ¨æœ¬ç”¨æˆ·ä½¿ç”¨ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1234$ git config --global alias.st status$ git config --global alias.ci &quot;commit -s&quot;$ git config --global alias.co checkout$ git config --global alias.br branch åˆ›å»ºGitç‰ˆæœ¬åº“ ä¸‹é¢å°±ä»Žä¸€ä¸ªç©ºç›®å½•å¼€å§‹åˆå§‹åŒ–ç‰ˆæœ¬åº“ï¼Œè¿™ä¸ªç‰ˆæœ¬åº“å‘½åä¸ºâ€œgit-demoâ€ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•ï¼Œè¿›å…¥è¯¥ç›®å½•åŽï¼Œæ‰§è¡Œgit initåˆ›å»ºç‰ˆæœ¬åº“ 12345$ cd /d/workspace$ mkdir git-demo$ cd git-demo$ git initInitialized empty Git repository in D:/workspace/git-demo/.git/ ä»Žä¸Šé¢ç‰ˆæœ¬åº“åˆå§‹åŒ–åŽçš„è¾“å‡ºä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œgit initå‘½ä»¤åœ¨å·¥ä½œåŒºåˆ›å»ºäº†éšè—ç›®å½•.gitã€‚ 12$ ls -aF./ ../ .git/ è¿™ä¸ªéšè—çš„.gitç›®å½•å°±æ˜¯Gitç‰ˆæœ¬åº“ï¼ˆåˆå«ä»“åº“ï¼Œrepositoryï¼‰ã€‚.gitç‰ˆæœ¬åº“ç›®å½•æ‰€åœ¨çš„ç›®å½•ï¼Œå³/d/workspace/git-demoç›®å½•ç§°ä¸ºå·¥ä½œåŒºï¼Œç›®å‰å·¥ä½œåŒºé™¤äº†åŒ…å«ä¸€ä¸ªéšè—çš„.gitç›®å½•å¤–ç©ºæ— ä¸€ç‰©ã€‚ ä¸‹é¢åœ¨å·¥ä½œåŒºä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼šwelcome.txtï¼Œå†…å®¹å°±æ˜¯ä¸€è¡Œâ€œHello Git.â€ã€‚ 1$ echo &quot;Hello Git.&quot; &gt;&gt; welcome.txt ä¸ºäº†å°†è¿™ä¸ªæ–°å»ºç«‹çš„æ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬åº“ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1$ git add welcome.txt Gitå’Œå¤§éƒ¨åˆ†å…¶ä»–ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿéƒ½éœ€è¦å†æ‰§è¡Œä¸€ä¸ªæäº¤æ“ä½œï¼Œå¯¹äºŽGitæ‰§è¡Œgit commitå‘½ä»¤å®Œæˆæäº¤ã€‚åœ¨æäº¤è¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥æäº¤è¯´æ˜Žï¼Œè¿™ä¸ªè¦æ±‚å¯¹Gitæ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä¸åƒCVSã€SVNç­‰å…è®¸ç©ºç™½çš„æäº¤è¯´æ˜Žã€‚ åœ¨Gitæäº¤æ—¶ï¼Œå¦‚æžœåœ¨å‘½ä»¤è¡Œä¸æä¾›æäº¤è¯´æ˜Žï¼ˆæ²¡æœ‰ä½¿ç”¨ -m å‚æ•°ï¼‰ï¼ŒGitä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œè¦æ±‚æ‚¨åœ¨å…¶ä¸­è¾“å…¥æäº¤è¯´æ˜Žï¼Œè¾“å…¥å®Œæ¯•ä¿å­˜é€€å‡ºã€‚ ä¸‹é¢è¿›è¡Œæäº¤ï¼Œä¸ºäº†è¯´æ˜Žæ–¹ä¾¿ï¼Œä½¿ç”¨ -m å‚æ•°ç›´æŽ¥ç»™å‡ºæäº¤è¯´æ˜Žã€‚ 1$ git commit -m &quot;åˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤&quot; ä»Žä¸Šé¢çš„å‘½ä»¤åŠè¾“å‡ºå¯ä»¥çœ‹å‡ºï¼š é€šè¿‡-må‚æ•°è®¾ç½®æäº¤è¯´æ˜Žä¸ºï¼šâ€œåˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤â€ã€‚è¯¥æäº¤è¯´æ˜Žä¹Ÿæ˜¾ç¤ºåœ¨å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€è¡Œä¸­ã€‚ å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€è¡Œè¿˜æ˜¾ç¤ºäº†å½“å‰å¤„äºŽåä¸ºmasterçš„åˆ†æ”¯ä¸Šï¼Œæäº¤IDä¸ºe55c54cï¼Œä¸”è¯¥æäº¤æ˜¯è¯¥åˆ†æ”¯çš„ç¬¬ä¸€ä¸ªæäº¤ï¼Œå³æ ¹æäº¤ï¼ˆroot-commitï¼‰ã€‚æ ¹æäº¤å’Œå…¶ä»–æäº¤çš„åŒºåˆ«åœ¨äºŽæ²¡æœ‰å…³è”çš„çˆ¶æäº¤ã€‚ å‘½ä»¤è¾“å‡ºçš„ç¬¬äºŒè¡Œå¼€å§‹æ˜¾ç¤ºæœ¬æ¬¡æäº¤æ‰€åšä¿®æ”¹çš„ç»Ÿè®¡ï¼šä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸€è¡Œçš„æ’å…¥ã€‚ æ€è€ƒï¼šGitå·¥ä½œåŒºä¸‹ä¸ºä»€ä¹ˆæœ‰ä¸ª.gitç›®å½•ï¼Ÿ GitåŠå…¶ä»–åˆ†å¸ƒå¼ç‰ˆæœ¬æŽ§åˆ¶ç³»ç»Ÿçš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹ï¼šç‰ˆæœ¬åº“ä½äºŽå·¥ä½œåŒºçš„æ ¹ç›®å½•ä¸‹ã€‚å¯¹äºŽGitï¼Œç‰ˆæœ¬åº“ä½äºŽå·¥ä½œåŒºæ ¹ç›®å½•ä¸‹çš„.gitç›®å½•ä¸­ï¼Œä¸”ä»…æ­¤ä¸€å¤„ï¼Œåœ¨å·¥ä½œåŒºçš„å­ç›®å½•ä¸‹åˆ™æ²¡æœ‰ä»»ä½•å…¶ä»–è·Ÿè¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚Gitä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿ å¯¹äºŽCVSï¼Œå·¥ä½œåŒºçš„æ ¹ç›®å½•åŠæ¯ä¸ªå­ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªCVSç›®å½•ï¼Œè¯¥ç›®å½•ä¸­åŒ…å«å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œå»ºç«‹äº†å¯¹ç‰ˆæœ¬åº“çš„è¿½è¸ªã€‚ å¦‚CVSç›®å½•ä¸‹çš„Entriesæ–‡ä»¶è®°å½•äº†ä»Žç‰ˆæœ¬åº“æ£€å‡ºåˆ°å·¥ä½œåŒºçš„æ–‡ä»¶çš„åç§°ã€ç‰ˆæœ¬å’Œæ—¶é—´æˆ³ç­‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å¯¹ å·¥ä½œåŒºæ–‡ä»¶æ—¶é—´æˆ³çš„æ”¹å˜æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ›´æ”¹ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥å°†å·¥ä½œåŒºç§»åŠ¨åˆ°ä»»ä½•å…¶ä»–ç›®å½•ï¼Œå·¥ä½œåŒºå’Œç‰ˆæœ¬ æŽ§åˆ¶æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»ä¿æŒä¸å˜ï¼Œè¿™æ ·å·¥ä½œåŒºä¾ç„¶èƒ½æ­£å¸¸å·¥ä½œã€‚ç”šè‡³è¿˜å°†å·¥ä½œåŒºçš„æŸä¸ªå­ç›®å½•ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ï¼Œå½¢æˆ æ–°çš„å·¥ä½œåŒºï¼Œåœ¨æ–°çš„å·¥ä½œåŒºä»ç„¶èƒ½å®Œæˆç‰ˆæœ¬æŽ§åˆ¶ç›¸å…³çš„æ“ä½œã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆå¤šï¼Œä¾‹å¦‚å·¥ä½œåŒºæ–‡ä»¶ä¿®æ”¹äº†ï¼Œå› ä¸ºæ²¡æœ‰ åŽŸå§‹æ–‡ä»¶åšæ¯”å¯¹ï¼Œå› æ­¤å‘æœåŠ¡å™¨æäº¤ä¿®æ”¹çš„æ—¶å€™åªèƒ½å¯¹æ•´ä¸ªæ–‡ä»¶è¿›è¡Œä¼ è¾“è€Œä¸èƒ½ä»…ä¼ è¾“æ–‡ä»¶çš„æ”¹åŠ¨éƒ¨åˆ†ã€‚è¿˜æœ‰ ä¸€ä¸ªé£Žé™©å°±æ˜¯ä¿¡æ¯æ³„éœ²ï¼Œé€šè¿‡æ‰«æCVS/Entriesæ–‡ä»¶å°±èƒ½å¾—åˆ°ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œé€ æˆä¿¡æ¯æ³„éœ²ã€‚ å¯¹äºŽSVNï¼Œå·¥ä½œåŒºçš„æ ¹ç›®å½•å’Œæ¯ä¸€ä¸ªå­ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª.svnç›®å½•ï¼Œè¯¥ç›®å½•ä¸ä»…åŒ…å«äº†ç±»ä¼¼CVSçš„è·Ÿè¸ªç›®å½•ä¸‹çš„ é…ç½®æ–‡ä»¶ï¼Œè¿˜åŒ…å«äº†å½“å‰å·¥ä½œåŒºä¸‹æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ‹·è´ã€‚å¤šå‡ºæ–‡ä»¶çš„åŽŸå§‹æ‹·è´è®©æŸäº›svnå‘½ä»¤å¯ä»¥è„±ç¦»ç‰ˆæœ¬åº“æ‰§è¡Œï¼Œ è¿˜å¯ä»¥åœ¨ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æäº¤æ—¶ï¼Œä»…ä»…å¯¹æ–‡ä»¶æ”¹åŠ¨çš„å†…å®¹æäº¤ï¼Œå› æ­¤æ”¹åŠ¨çš„æ–‡ä»¶å¯ä»¥å’ŒåŽŸå§‹æ‹·è´è¿›è¡Œå·®å¼‚æ¯”è¾ƒã€‚ ç¼ºç‚¹é™¤äº†åƒCVSè·Ÿè¸ªç›®å½•é€ æˆä¿¡æ¯æ³„éœ²ï¼Œè¿˜å¯¼è‡´åŠ å€å ç”¨å·¥ä½œåŒºçš„ç©ºé—´ã€‚å†æœ‰å°±æ˜¯å½“åœ¨å·¥ä½œåŒºç›®å½•ä¸‹é’ˆå¯¹æ–‡ä»¶å†…å®¹ è¿›è¡Œæœç´¢æ—¶ï¼Œä¼šå› ä¸º.svnç›®å½•ä¸‹æ–‡ä»¶çš„åŽŸå§‹æ‹·è´ï¼Œå¯¼è‡´æœç´¢çš„ç»“æžœåŠ å€ï¼Œè€Œå‡ºçŽ°æ··ä¹±çš„æœç´¢ç»“æžœã€‚ Gitçš„è®¾è®¡ï¼Œå°†ç‰ˆæœ¬åº“æ”¾åœ¨å·¥ä½œåŒºæ ¹ç›®å½•ä¸‹ï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬æŽ§åˆ¶æ“ä½œï¼ˆé™¤äº†å’Œè¿œç¨‹ç‰ˆæœ¬åº“ä¹‹é—´çš„ç›¸äº’æ“ä½œï¼‰éƒ½æ˜¯åœ¨ æœ¬åœ°å³å¯å®Œæˆï¼Œä¸å‘SVNåªæœ‰å¯¥å¯¥å‡ ä¸ªå‘½ä»¤æ‰èƒ½è„±ç¦»ç½‘ç»œæ‰§è¡Œã€‚è€Œä¸”Gitä¹Ÿä¸å­˜åœ¨å®‰å…¨æ³„éœ²ï¼ˆåªè¦ä¿æŠ¤å¥½.gitç›®å½•ï¼‰ï¼Œ ä¹Ÿæ²¡æœ‰SVNæœ¬åœ°æ–‡ä»¶æœç´¢ç»“æžœæ··ä¹±çš„é—®é¢˜ï¼ŒGitç”šè‡³è¿˜æä¾›äº†ä¸€æ¡git grepå‘½ä»¤æ¥æ›´å¥½åœ°æœç´¢å·¥ä½œåŒºçš„æ–‡ä»¶å†…å®¹ã€‚ 1$ git grep &quot;Hello&quot; å½“å·¥ä½œåŒºä¸­åŒ…å«å­ç›®å½•ï¼Œåœ¨å­ç›®å½•ä¸­æ‰§è¡ŒGitå‘½ä»¤æ—¶ï¼Œå¦‚ä½•å®šä½ç‰ˆæœ¬åº“ï¼Ÿ å®žé™…ä¸Šï¼ŒGitå·¥ä½œåŒºç›®å½•ä¸‹æ‰§è¡Œæ“ä½œæ—¶ï¼Œä¼šå¯¹ç›®å½•ä¾æ¬¡å‘ä¸Šé€’å½’æŸ¥æ‰¾.gitç›®å½•ï¼Œæ‰¾åˆ°.gitç›®å½•å°±æ˜¯å·¥ä½œåŒºå¯¹åº”çš„ç‰ˆæœ¬åº“ï¼Œ.gitæ‰€åœ¨çš„ç›®å½•å°±æ˜¯å·¥ä½œåŒºçš„æ ¹ç›®å½•ï¼Œæ–‡ä»¶.git/indexè®°å½•äº†å·¥ä½œåŒºæ–‡ä»¶çš„çŠ¶æ€ï¼ˆå®žé™…ä¸Šæ˜¯æš‚å­˜åŒºçš„çŠ¶æ€ï¼‰ã€‚ ä¾‹å¦‚ï¼Œåœ¨éžGitå·¥ä½œåŒºæ‰§è¡Œgitå‘½ä»¤ï¼Œä¼šå› æ‰¾ä¸åˆ°.gitç›®å½•è€ŒæŠ¥é”™ã€‚ 12$ cd /d/workspace/webstrom$ git status æ€Žæ ·èŽ·å–Gitç‰ˆæœ¬åº“çš„ä½ç½®ä»¥åŠå·¥ä½œåŒºæ ¹ç›®å½•ä½ç½®ï¼Ÿ å…ˆåœ¨å·¥ä½œåŒºä¸‹å»ºç«‹ç›®å½•a/b/cï¼Œè¿›å…¥è¯¥ç›®å½•ä¸­ã€‚ 12$ mkdir -p a/b/c`$ cd a/b/c æ˜¾ç¤ºç‰ˆæœ¬åº“.gitç›®å½•æ‰€åœ¨çš„ä½ç½®ã€‚ 12$ git rev-parse --git-dirD:/workspace/git-demo/.git æ˜¾ç¤ºå·¥ä½œåŒºæ ¹ç›®å½• 12$ git rev-parse --show-toplevelD:/workspace/git-demo ç›¸å¯¹äºŽå·¥ä½œåŒºæ ¹ç›®å½•çš„ç›¸å¯¹ç›®å½• 12$ git rev-parse --show-prefixa/b/c æ˜¾ç¤ºä»Žå½“å‰ç›®å½•ï¼ˆcdï¼‰åŽé€€ï¼ˆupï¼‰åˆ°å·¥ä½œåŒºçš„æ ¹çš„æ·±åº¦ã€‚ 12$ git rev-parse --show-cdup../../../ æ€è€ƒï¼šgit config å‘½ä»¤å‚æ•°çš„åŒºåˆ«ï¼Ÿ åœ¨ä¹‹å‰ä½¿ç”¨è¿‡çš„git configå‘½ä»¤ï¼Œæœ‰çš„ä½¿ç”¨äº†--globalå‚æ•°ï¼Œæœ‰çš„ä½¿ç”¨äº†--systemå‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€D:/workspace/git-demo/.git/configæ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 12$ cd /d/workspace/git-demo/$ git config -e æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€C:/Users/ASUS/.gitconfigï¼ˆç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.gitconfigæ–‡ä»¶ï¼‰å…¨å±€é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 1$ git config -e --global æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€E:/developerTools/git/mingw64/etc/gitconfigç³»ç»Ÿçº§é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 1$ git config -e --system Gitçš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«æ˜¯ç‰ˆæœ¬åº“çº§åˆ«çš„é…ç½®ã€å…¨å±€é…ç½®ï¼ˆç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼‰å’Œç³»ç»Ÿçº§é…ç½®ï¼ˆGitå®‰è£…ç›®å½•ä¸‹ï¼‰ã€‚ å…¶ä¸­ç‰ˆæœ¬åº“çº§åˆ«é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…¨å±€é…ç½®æ–‡ä»¶æ¬¡ä¹‹ï¼Œç³»ç»Ÿçº§é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æœ€ä½Žã€‚è¿™æ ·çš„ä¼˜å…ˆçº§è®¾ç½® å¯ä»¥è®©ç‰ˆæœ¬åº“.gitç›®å½•ä¸‹çš„configæ–‡ä»¶ä¸­çš„é…ç½®å¯ä»¥è¦†ç›–ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„GitçŽ¯å¢ƒé…ç½®ï¼Œè€Œç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„é…ç½®ä¹Ÿå¯ä»¥è¦†ç›–ç³»ç»Ÿçš„Gité…ç½®æ–‡ä»¶ã€‚ æ‰§è¡Œä¹‹å‰çš„ä¸‰ä¸ªgit configå‘½ä»¤ï¼Œä¼šçœ‹åˆ°è¿™ä¸‰ä¸ªçº§åˆ«é…ç½®æ–‡ä»¶çš„æ ¼å¼å’Œå†…å®¹ï¼Œé‡‡ç”¨INIæ–‡ä»¶æ ¼å¼ã€‚å¦‚ä¸‹ï¼š 12345678$ cat /d/workspace/git-demo/.git/config[core] repositoryformatversion = 0 filemode = false bare = false logallrefupdates = true symlinks = false ignorecase = true git configå‘½ä»¤å¯ä»¥ç”¨æ¥è¯»å–å’Œæ›´æ”¹INIé…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚ä½¿ç”¨git config &lt;section&gt;.&lt;key&gt;ï¼Œæ¥è¯»å–INIé…ç½®æ–‡ä»¶ä¸­æŸä¸ªé…ç½®çš„é”®å€¼ã€‚ä¾‹å¦‚è¯»å–[core]å°èŠ‚çš„bareçš„å±žæ€§å€¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 12$ git config core.barefalse å¦‚æžœæƒ³è¦æ›´æ”¹æˆ–é…ç½®INIæ–‡ä»¶ä¸­æŸä¸ªå±žæ€§çš„å€¼ä¹Ÿå¾ˆç®€å•ï¼Œå‘½ä»¤æ ¼å¼ï¼šgit config &lt;section&gt;.&lt;key&gt; &lt;value&gt;ã€‚ 12$ git config a.b learningGit$ git config x.y.z something æ‰“å¼€.git/configæ–‡ä»¶ä¼šçœ‹åˆ°å¢žåŠ çš„å†…å®¹ï¼š 1234[a] b = learningGit[x &quot;y&quot;] z = something æ€è€ƒï¼šæ˜¯è°æäº¤çš„ï¼Ÿ åœ¨ä¸€å¼€å§‹æˆ‘ä»¬ä¸ºGitè®¾ç½®äº†user.nameå’Œuser.emailå…¨å±€çŽ¯å¢ƒå˜é‡ï¼Œå¦‚æžœä¸è®¾ç½®ä¼šæ€Žæ ·ï¼Ÿæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ é™¤Gitå…¨å±€é…ç½®æ–‡ä»¶ä¸­å…³äºŽuser.nameå’Œuser.emailçš„è®¾ç½®ï¼š 12$ git config --unset --global user.name$ git config --unset --global user.email è¿™æ ·å…³äºŽç”¨æˆ·åå’Œé‚®ä»¶çš„è®¾ç½®éƒ½è¢«æ¸…ç©ºäº†ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†çœ‹ä¸åˆ°è¾“å‡º 12$ git config user.name$ git config user.email ä¸‹é¢å†è¿›è¡Œä¸€æ¬¡æäº¤ï¼Œçœ‹çœ‹æäº¤è¿‡ç¨‹æœ‰ä»€ä¹ˆä¸åŒï¼Œä»¥åŠæäº¤ä¹‹åŽæ˜¾ç¤ºçš„æäº¤è€…æ˜¯è°ï¼Ÿ 1$ git commit --allow-empty -m &quot;è¿™æ˜¯è°æäº¤çš„ï¼Ÿ&quot; ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨äº†--allow-emptyå‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰å¯¹å·¥ä½œåŒºçš„æ–‡ä»¶è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼ŒGité»˜è®¤æ˜¯ä¸ä¼šæ‰§è¡Œæäº¤ï¼Œä½¿ç”¨äº†--allow-emptyå‚æ•°åŽï¼Œå…è®¸æ‰§è¡Œç©ºç™½æäº¤ã€‚ ä»Žæäº¤ç»“æžœçœ‹åˆ°ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®user.nameå’Œuser.emailï¼Œæäº¤ç»“æžœä¸­Gitæä¾›äº†è¯¦ç»†çš„å¸®åŠ©æŒ‡å¼•æ¥å‘Šè¯‰å¦‚ä½•è®¾ç½®å¿…é¡»çš„å˜é‡ï¼Œä»¥åŠå¦‚ä½•ä¿®æ”¹ä¹‹å‰æäº¤ä¸­å‡ºçŽ°çš„é”™è¯¯çš„æäº¤è€…ä¿¡æ¯ã€‚ ä¸ºäº†ä¿è¯æäº¤æ—¶æäº¤è€…å’Œä½œè€…ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œé‡æ–°æ¢å¤user.nameå’Œuser.emailçš„è®¾ç½®ã€‚ 12$ git config --global user.name &quot;wanghongbo&quot;$ git config --global user.email youreamil@email.com ç„¶åŽæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé‡æ–°ä¿®æ”¹æœ€æ–°çš„æäº¤ï¼Œä¿®æ­£æäº¤è€…çš„é”™è¯¯ä¿¡æ¯ã€‚ 1$ git commit --amend --allow-empty --reset-author è¯´æ˜Žï¼š å‚æ•°--amendæ˜¯å¯¹åˆšåˆšçš„æäº¤è¿›è¡Œä¿®è¡¥ï¼Œè¿™æ ·å°±å¯ä»¥æ”¹æ­£ä¹‹å‰é”™è¯¯çš„æäº¤ï¼Œè€Œä¸ä¼šäº§ç”Ÿæ–°çš„æäº¤ï¼› å‚æ•°--allow-emptyæ˜¯å› ä¸ºè¦è¿›è¡Œä¿®æ”¹çš„æäº¤å®žé™…ä¸Šæ˜¯ä¸€ä¸ªç©ºç™½æäº¤ï¼ŒGité»˜è®¤ä¸å…è®¸ç©ºç™½æäº¤ï¼› å‚æ•°--reset-authorçš„å«ä¹‰æ˜¯å°†æäº¤è€…çš„IDé‡ç½®ï¼Œå¦åˆ™ä¼šå½±å“æœ€æ–°çš„Commitçš„IDã€‚è¿™æ¡å‘½ä»¤ä¹Ÿä¼šé‡ç½®AuthorDateçš„ä¿¡æ¯ã€‚ é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°æäº¤è€…çš„ä¿¡æ¯å·²ç»æ”¹æ­£äº†ã€‚ 1$ git log --pretty=fuller]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~æ£€å‡º]]></title>
    <url>%2Fposts%2Fb27802af.html</url>
    <content type="text"><![CDATA[HEADçš„é‡ç½®å³æ£€å‡º HEADå¯ä»¥ç†è§£ä¸ºâ€œå¤´æŒ‡é’ˆâ€ï¼Œæ˜¯å½“å‰å·¥ä½œåŒºçš„â€œåŸºç¡€ç‰ˆæœ¬â€ï¼Œå½“æ‰§è¡Œæäº¤æ—¶ï¼ŒHEADæŒ‡å‘çš„æäº¤ä½œä¸ºæ–°æäº¤çš„çˆ¶æäº¤ã€‚çœ‹çœ‹å½“å‰HEADçš„æŒ‡å‘ã€‚ 1$ cat .git/HEAD å¯ä»¥çœ‹å‡ºHEADæŒ‡å‘äº†åˆ†æ”¯masterï¼Œæ­¤æ—¶æ‰§è¡Œgit branchä¼šçœ‹åˆ°å½“å‰å¤„äºŽmasteråˆ†æ”¯ã€‚ 1$ git branch -v çŽ°åœ¨ä½¿ç”¨git checkoutå‘½ä»¤æ£€å‡ºè¯¥IDçš„çˆ¶æäº¤ï¼Œçœ‹çœ‹ä¼šæ€Žä¹ˆæ ·ã€‚ 1$ git checkout 23995a2 ç¿»è¯‘ä¸€ä¸‹ä¸Šé¢çš„è¾“å‡ºç»“æžœï¼š 12345678910$ git checkout 23995a2æ³¨æ„ï¼šæ­£åœ¨æ£€å‡º &apos;23995a2&apos;.æ‚¨çŽ°åœ¨å¤„äºŽ&apos;åˆ†ç¦»å¤´æŒ‡é’ˆ&apos;çŠ¶æ€ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ã€æµ‹è¯•å’Œæäº¤ï¼Œè€Œä¸å½±å“ä»»ä½•åˆ†æ”¯ã€‚é€šè¿‡æ‰§è¡Œå¦å¤–çš„ä¸€ä¸ª checkout æ£€å‡ºæŒ‡ä»¤ä¼šä¸¢å¼ƒåœ¨æ­¤çŠ¶æ€ä¸‹çš„ä¿®æ”¹å’Œæäº¤ã€‚å¦‚æžœæƒ³ä¿ç•™åœ¨æ­¤çŠ¶æ€ä¸‹çš„ä¿®æ”¹å’Œæäº¤ï¼Œä½¿ç”¨ -b å‚æ•°è°ƒç”¨ checkout æ£€å‡ºæŒ‡ä»¤ä»¥åˆ›å»ºæ–°çš„è·Ÿè¸ªåˆ†æ”¯ã€‚å¦‚ï¼š git checkout -b new_branch_name å¤´æŒ‡é’ˆçŽ°åœ¨æŒ‡å‘ 23995a2... æäº¤è¯´æ˜Žä¸ºï¼šdoes master follow this new commit? ä»€ä¹ˆå«åšâ€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ï¼ŸæŸ¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„HEADçš„å†…å®¹å°±æ˜Žç™½äº†ã€‚ 12$ cat .git/HEAD23995a2d61d0a2667ba0db8aa4a17b127c1977d1 åŽŸæ¥â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€æŒ‡çš„å°±æ˜¯HEADå¤´æŒ‡é’ˆæŒ‡å‘äº†ä¸€ä¸ªå…·ä½“çš„æäº¤IDï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆåˆ†æ”¯ï¼‰ã€‚ æŸ¥çœ‹æœ€æ–°æäº¤çš„reflogä¹Ÿå¯ä»¥çœ‹åˆ°å½“é’ˆå¯¹æäº¤æ‰§è¡Œgit checkoutå‘½ä»¤æ—¶ï¼ŒHEADå¤´æŒ‡é’ˆå°±è¢«æ›´æ”¹äº†ï¼šç”±æŒ‡å‘masteråˆ†æ”¯å˜æˆäº†æŒ‡å‘ä¸€ä¸ªæäº¤IDã€‚ 12$ git reflog -l23995a2 (HEAD, master) HEAD@&#123;0&#125;: checkout: moving from master to 23995a2 æ³¨æ„ä¸Šé¢çš„reflogæ˜¯HEADå¤´æŒ‡é’ˆçš„å˜è¿è®°å½•ï¼Œè€Œéžmasteråˆ†æ”¯ã€‚ æŸ¥çœ‹ä¸€ä¸‹HEADå’Œmasterå¯¹åº”çš„æäº¤IDï¼Œä¼šå‘çŽ°çŽ°åœ¨å®ƒä»¬æŒ‡å‘çš„ä¸ä¸€æ ·ã€‚ 1$ git rev-parse HEAD master å‰ä¸€ä¸ªæ˜¯HEADå¤´æŒ‡é’ˆçš„æŒ‡å‘ï¼ŒåŽä¸€ä¸ªæ˜¯masteråˆ†æ”¯çš„æŒ‡å‘ã€‚è€Œä¸”è¿˜å¯ä»¥çœ‹åˆ°æ‰§è¡Œgit checkoutå‘½ä»¤ä¸Žæ‰§è¡Œgit resetå‘½ä»¤ä¸åŒï¼Œåˆ†æ”¯(master)çš„æŒ‡å‘å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä»æ—§æŒ‡å‘åŽŸæœ‰çš„æäº¤IDã€‚ çŽ°åœ¨ç‰ˆæœ¬åº“çš„HEADæ˜¯æŒ‡å‘23995aæäº¤çš„ï¼Œå†åšä¸€æ¬¡æäº¤ï¼ŒHEADä¼šå¦‚ä½•å˜åŒ–ï¼Ÿ å…ˆåšä¸€æ¬¡ä¿®æ”¹ï¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶detached-commit.txtï¼Œæ·»åŠ åˆ°æš‚å­˜åŒºä¸­ã€‚ 12$ touch detached-commit.txt $ git add detached-commit.txt çœ‹ä¸€ä¸‹çŠ¶æ€ï¼Œä¼šå‘çŽ°å…¶ä¸­æœ‰â€œå½“å‰ä¸å¤„äºŽä»»ä½•åˆ†æ”¯â€çš„å­—æ ·ï¼Œæ˜¾ç„¶è¿™æ˜¯å› ä¸ºHEADå¤„äºŽâ€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€æ¨¡å¼ã€‚ 1$ git status æ‰§è¡Œæäº¤ã€‚åœ¨æäº¤è¾“å‡ºä¸­ä¹Ÿä¼šå‡ºçŽ°[detached HEAD...]çš„æ ‡è¯†ï¼Œè¿™ä¹Ÿæ˜¯å¯¹ç”¨æˆ·çš„è­¦ç¤ºã€‚ 1$ git commit -m &quot;commit in detached HEAD mode&quot; æ­¤æ—¶å¤´æŒ‡é’ˆæŒ‡å‘äº†æ–°çš„æäº¤ã€‚ 12$ cat .git/HEAD1fe77f7b9993cd79b050826df1c73715cc1d1e45 å†æŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ä¼šå‘çŽ°æ–°çš„æäº¤æ˜¯å»ºç«‹åœ¨ä¹‹å‰çš„æäº¤åŸºç¡€ä¸Šçš„ã€‚ 1$ git log --graph --oneline è®°ä¸‹æ–°çš„æäº¤ID(1fe77f7b9993cd79b050826df1c73715cc1d1e45)ï¼Œç„¶åŽä»¥masteråˆ†æ”¯åä½œä¸ºå‚æ•°æ‰§è¡Œgit checkoutå‘½ä»¤ï¼Œä¼šåˆ‡æ¢åˆ°masteråˆ†æ”¯ä¸Šã€‚ åˆ‡æ¢åˆ°masteråˆ†æ”¯ä¸Šï¼Œå†æ²¡æœ‰ä¹‹å‰å¤§æ®µçš„æ–‡å­—è­¦å‘Šã€‚ 1$ git checkout master å› ä¸ºHEADå¤´æŒ‡é’ˆé‡æ–°æŒ‡å‘äº†åˆ†æ”¯ï¼Œè€Œä¸æ˜¯å¤„äºŽâ€œåˆ†ç¦»å¤´æŒ‡é’ˆæ¨¡å¼â€ã€‚ 1$ cat .git/HEAD åˆ‡æ¢ä¹‹åŽï¼Œä¹‹å‰æœ¬åœ°å»ºç«‹çš„detached-commit.txtæ–‡ä»¶ä¸è§äº†ã€‚ 12$ lsnew-commit.txt welcome.txt åˆ‡æ¢ä¹‹åŽï¼Œåˆšæ‰çš„æäº¤æ—¥å¿—ä¹Ÿä¸è§äº†ã€‚ 1$ git log --graph --oneline åˆšæ‰çš„æäº¤è¿˜å­˜åœ¨äºŽç‰ˆæœ¬åº“çš„å¯¹è±¡åº“ä¸­å—ï¼Ÿçœ‹çœ‹åˆšæ‰è®°ä¸‹çš„æäº¤IDã€‚ 1$ git show 1fe77 å¯ä»¥çœ‹å‡ºè¿™ä¸ªæäº¤çŽ°åœ¨ä»åœ¨ç‰ˆæœ¬åº“ä¸­ã€‚ç”±äºŽè¿™ä¸ªæäº¤æ²¡æœ‰è¢«ä»»ä½•åˆ†æ”¯è·Ÿè¸ªåˆ°ï¼Œå› æ­¤ä¸èƒ½ä¿è¯è¿™ä¸ªæäº¤ä¼šæ°¸ä¹…å­˜åœ¨ã€‚å®žé™…ä¸Šå½“reflogä¸­å«æœ‰è¯¥æäº¤çš„æ—¥å¿—è¿‡æœŸåŽï¼Œè¿™ä¸ªæäº¤éšæ—¶éƒ½ä¼šä»Žç‰ˆæœ¬åº“ä¸­å½»åº•æ¸…é™¤ã€‚ æŒ½æ•‘åˆ†ç¦»å¤´æŒ‡é’ˆ åœ¨â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€æ¨¡å¼ä¸‹è¿›è¡Œçš„æµ‹è¯•æäº¤é™¤äº†ä½¿ç”¨IDï¼ˆ1fe77ï¼‰è®¿é—®ä¹‹å¤–ï¼Œä¸èƒ½é€šè¿‡masteråˆ†æ”¯æˆ–å…¶ä»–å¼•ç”¨è®¿é—®åˆ°ã€‚å¦‚æžœè¿™ä¸ªæäº¤æ˜¯masteråˆ†æ”¯æ‰€éœ€çš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ å¦‚æžœä½¿ç”¨git resetï¼Œçš„ç¡®å¯ä»¥å°†masteråˆ†æ”¯é‡ç½®åˆ°è¯¥æµ‹è¯•æäº¤çš„1fe77ï¼Œä½†è¿™å°±ä¼šä¸¢æŽ‰masteråˆ†æ”¯åŽŸå…ˆçš„æäº¤23995a2ã€‚ä½¿ç”¨åˆå¹¶æ“ä½œgit mergeå¯ä»¥å®žçŽ°ä¸¤è€…çš„å…¼é¡¾ã€‚ ä¸‹é¢çš„æ“ä½œä¼šå°†æäº¤1fe77åˆå¹¶åˆ°masteråˆ†æ”¯ä¸­æ¥ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š ç¡®è®¤å½“å‰å¤„äºŽmasteråˆ†æ”¯ã€‚ 1$ git branch -v æ‰§è¡Œåˆå¹¶æ“ä½œï¼Œå°†1fe77æäº¤åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ 1$ git merge 1fe77 å·¥ä½œåŒºä¸­å¤šäº†ä¸€ä¸ªdetached-commit.txtæ–‡ä»¶ã€‚ æ·±å…¥äº†è§£git checkoutå‘½ä»¤ git checkoutæ˜¯Gitå¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¾ˆå±é™©çš„å‘½ä»¤ï¼Œå› ä¸ºè¿™æ¡å‘½ä»¤ä¼šé‡å†™å·¥ä½œåŒºã€‚æ£€å‡ºå‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š 123ç”¨æ³•ä¸€ï¼š git checkout [-q] [&lt;commit&gt;] [--] &lt;paths&gt;...ç”¨æ³•äºŒï¼š git checkout [&lt;branch&gt;]ç”¨æ³•ä¸‰ï¼š git checkout [-m] [[-b|--orphan] &lt;new_branch&gt;] [&lt;start_point&gt;] ç”¨æ³•ä¸€å’Œç”¨æ³•äºŒçš„åŒºåˆ«åœ¨äºŽï¼Œç”¨æ³•ä¸€åœ¨å‘½ä»¤ä¸­åŒ…å«è·¯å¾„&lt;paths&gt;ã€‚ä¸ºäº†é¿å…è·¯å¾„å’Œå¼•ç”¨ï¼ˆæˆ–è€…æäº¤IDï¼‰åŒåè€Œå‘ç”Ÿå†²çªï¼Œå¯ä»¥åœ¨&lt;paths&gt;å‰ç”¨ä¸¤ä¸ªè¿žç»­çš„çŸ­çº¿ä½œä¸ºåˆ†éš”ã€‚ ç¬¬ä¸€ç§ç”¨æ³•çš„&lt;commit&gt;æ˜¯å¯é€‰é¡¹ï¼Œå¦‚æžœçœç•¥ç›¸å½“äºŽä»Žæš‚å­˜åŒº(index)è¿›è¡Œæ£€å‡ºã€‚è¿™å’Œé‡ç½®å‘½ä»¤å¤§ä¸ç›¸åŒï¼šé‡ç½®çš„é»˜è®¤å€¼æ˜¯HEADï¼Œè€Œæ£€å‡ºçš„é»˜è®¤å€¼æ˜¯æš‚å­˜åŒºã€‚ å› æ­¤é‡ç½®ä¸€èˆ¬ç”¨äºŽé‡ç½®æš‚å­˜åŒº(é™¤éžä½¿ç”¨--hardå‚æ•°ï¼Œå¦åˆ™ä¸é‡ç½®å·¥ä½œåŒº)ï¼Œè€Œæ£€å‡ºå‘½ä»¤ä¸»è¦æ˜¯è¦†ç›–å·¥ä½œåŒº(å¦‚æžœ&lt;commit&gt;ä¸çœç•¥ï¼Œä¹Ÿä¼šæ›¿æ¢æš‚å­˜åŒºä¸­ç›¸åº”çš„æ–‡ä»¶)ã€‚ ç”¨æ³•ä¸€(åŒ…å«äº†è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•)ä¸ä¼šæ”¹å˜HEADå¤´æŒ‡é’ˆï¼Œä¸»è¦æ˜¯ç”¨äºŽæŒ‡å®šç‰ˆæœ¬çš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºä¸­å¯¹åº”çš„æ–‡ä»¶ã€‚å¦‚æžœçœç•¥&lt;commit&gt;ï¼Œåˆ™ä¼šç”¨æš‚å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼Œå¦åˆ™ç”¨æŒ‡å®šæäº¤ä¸­çš„æ–‡ä»¶è¦†ç›–æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­å¯¹åº”çš„æ–‡ä»¶ã€‚ ç”¨æ³•äºŒ(ä¸ä½¿ç”¨è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•)åˆ™ä¼šæ”¹å˜HEADå¤´æŒ‡é’ˆã€‚ä¹‹æ‰€ä»¥åŽé¢çš„å‚æ•°å†™ä½œ&lt;branch&gt;ï¼Œæ˜¯å› ä¸ºåªæœ‰HEADåˆ‡æ¢ä¸€ä¸ªåˆ†æ”¯æ‰å¯ä»¥å¯¹æäº¤è¿›è¡Œè·Ÿè¸ªï¼Œå¦åˆ™ä»ç„¶ä¼šè¿›å…¥â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ã€‚åœ¨â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ä¸‹çš„æäº¤ä¸èƒ½è¢«å¼•ç”¨å…³è”åˆ°ï¼Œä»Žè€Œå¯èƒ½ä¸¢å¤±ã€‚ ç”¨æ³•äºŒçš„æœ€ä¸»è¦ä½œç”¨å°±æ˜¯åˆ‡æ¢åˆ°åˆ†æ”¯ã€‚å¦‚æžœçœç•¥&lt;branch&gt;åˆ™ç›¸å½“äºŽå¯¹å·¥ä½œåŒºè¿›è¡ŒçŠ¶æ€æ£€æŸ¥ã€‚ ç”¨æ³•ä¸‰ä¸»è¦æ˜¯åˆ›å»ºå’Œåˆ‡æ¢åˆ°æ–°åˆ†æ”¯(&lt;new_branch&gt;)ï¼Œæ–°çš„åˆ†æ”¯ä»Ž&lt;start_point&gt;æŒ‡å®šçš„æäº¤å¼€å§‹åˆ›å»ºã€‚æ–°åˆ†æ”¯å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„masteråˆ†æ”¯æ²¡æœ‰ä»€ä¹ˆå®žè´¨çš„ä¸åŒï¼Œéƒ½æ˜¯åœ¨refs/headså‘½åç©ºé—´ä¸‹å¼•ç”¨ã€‚]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å®‰è£…]]></title>
    <url>%2Fposts%2Ffe22a4f2.html</url>
    <content type="text"><![CDATA[æœ€æ—©Gitæ˜¯åœ¨Linuxä¸Šå¼€å‘çš„ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼ŒGitä¹Ÿåªèƒ½åœ¨Linuxå’ŒUnixç³»ç»Ÿä¸Šè·‘ã€‚åŽæ¥æœ‰äººæŠŠå®ƒç§»æ¤åˆ°äº†Windowsä¸Šã€‚çŽ°åœ¨ï¼ŒGitå¯ä»¥åœ¨Linuxã€Unixã€Macå’ŒWindowsè¿™å‡ å¤§å¹³å°ä¸Šæ­£å¸¸è¿è¡Œäº†ã€‚ è¦ä½¿ç”¨Gitï¼Œç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å®‰è£…Gitäº†ã€‚æ ¹æ®ä½ ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå¦‚ä¸‹ï¼š Linuxä¸Šå®‰è£…Git é¦–å…ˆï¼Œä½ å¯ä»¥è¯•ç€è¾“å…¥gitï¼Œçœ‹çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰å®‰è£…Gitï¼š 123$ gitThe program &apos;git&apos; is currently not installed. You can install it by typing:sudo apt-get install git åƒä¸Šé¢çš„å‘½ä»¤ï¼Œæœ‰å¾ˆå¤šLinuxä¼šå‹å¥½åœ°å‘Šè¯‰ä½ Gitæ²¡æœ‰å®‰è£…ï¼Œè¿˜ä¼šå‘Šè¯‰ä½ å¦‚ä½•å®‰è£…Gitã€‚ å¦‚æžœä½ ç”¨çš„æ˜¯Debianæˆ–Ubuntu Linuxï¼Œé€šè¿‡ sudo apt-get install git å°±å¯ä»¥ç›´æŽ¥å®ŒæˆGitçš„å®‰è£…ï¼Œéžå¸¸ç®€å•ã€‚ è€ä¸€ç‚¹çš„Debianæˆ–Ubuntu Linuxï¼Œè¦æŠŠå‘½ä»¤æ”¹ä¸ºsudo apt-get install git-coreï¼Œå› ä¸ºä»¥å‰æœ‰ä¸ªè½¯ä»¶ä¹Ÿå«GITï¼ˆGNU Interactive Toolsï¼‰ï¼Œç»“æžœGitå°±åªèƒ½å«git-coreäº†ã€‚ç”±äºŽGitåæ°”å®žåœ¨å¤ªå¤§ï¼ŒåŽæ¥å°±æŠŠGNU Interactive Toolsæ”¹æˆgnuitï¼Œgit-coreæ­£å¼æ”¹ä¸ºgitã€‚ å¦‚æžœæ˜¯å…¶ä»–Linuxç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æŽ¥é€šè¿‡æºç å®‰è£…ã€‚å…ˆä»ŽGitå®˜ç½‘ä¸‹è½½æºç ï¼Œç„¶åŽè§£åŽ‹ï¼Œä¾æ¬¡è¾“å…¥ï¼š./configï¼Œmakeï¼Œsudo make installè¿™å‡ ä¸ªå‘½ä»¤å®‰è£…å°±å¥½äº†ã€‚ Mac OS Xä¸Šå®‰è£…Git æœ‰ä¸¤ç§å®‰è£…Gitçš„æ–¹æ³•: ä¸€æ˜¯å®‰è£…homebrewï¼Œç„¶åŽé€šè¿‡homebrewå®‰è£…Gitï¼Œå…·ä½“æ–¹æ³•è¯·å‚è€ƒhomebrewçš„æ–‡æ¡£ã€‚ ç¬¬äºŒç§æ–¹æ³•æ›´ç®€å•ï¼Œç›´æŽ¥ä»ŽAppStoreå®‰è£…Xcodeï¼ŒXcodeé›†æˆäº†Gitï¼Œä¸è¿‡é»˜è®¤æ²¡æœ‰å®‰è£…ï¼Œä½ éœ€è¦è¿è¡ŒXcodeï¼Œé€‰æ‹©èœå•â€œXcodeâ€-&gt;â€œPreferencesâ€ï¼Œåœ¨å¼¹å‡ºçª—å£ä¸­æ‰¾åˆ°â€œDownloadsâ€ï¼Œé€‰æ‹©â€œCommand Line Toolsâ€ï¼Œç‚¹â€œInstallâ€å°±å¯ä»¥å®Œæˆå®‰è£…äº†ã€‚ Xcodeæ˜¯Appleå®˜æ–¹IDEï¼ŒåŠŸèƒ½éžå¸¸å¼ºå¤§ï¼Œæ˜¯å¼€å‘Macå’ŒiOS Appçš„å¿…é€‰è£…å¤‡ï¼Œè€Œä¸”æ˜¯å…è´¹çš„ï¼ Windowsä¸Šå®‰è£…Git åœ¨Windowsä¸Šä½¿ç”¨Gitï¼Œå¯ä»¥ä»ŽGitå®˜ç½‘ç›´æŽ¥ä¸‹è½½å®‰è£…ç¨‹åºï¼Œç„¶åŽæŒ‰é»˜è®¤é€‰é¡¹å®‰è£…å³å¯ã€‚ å®‰è£…å®ŒæˆåŽï¼Œåœ¨å¼€å§‹èœå•é‡Œæ‰¾åˆ°â€œGitâ€-&gt;â€œGit Bashâ€ï¼Œè¹¦å‡ºä¸€ä¸ªç±»ä¼¼å‘½ä»¤è¡Œçª—å£çš„ä¸œè¥¿ï¼Œå°±è¯´æ˜ŽGitå®‰è£…æˆåŠŸï¼ å®‰è£…å®ŒæˆåŽï¼Œè¿˜éœ€è¦æœ€åŽä¸€æ­¥è®¾ç½®ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š 12$ git config --global user.name &quot;Your Name&quot;$ git config --global user.email &quot;email@example.com&quot; æ³¨æ„git configå‘½ä»¤çš„--globalå‚æ•°ï¼Œç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä½ è¿™å°æœºå™¨ä¸Šæ‰€æœ‰çš„Gitä»“åº“éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹æŸä¸ªä»“åº“æŒ‡å®šä¸åŒçš„ç”¨æˆ·åå’ŒEmailåœ°å€ã€‚ Gitå¯ä»¥å®‰è£…åœ¨å“ªäº›æ“ä½œç³»ç»Ÿä¸Šï¼Ÿ [x] Linux [x] macOS [x] Solaris [x] Windows [x] Raspberry Pi [x] Submit]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~çˆ±ä¸ŠGitçš„ç†ç”±]]></title>
    <url>%2Fposts%2Fd9014d70.html</url>
    <content type="text"><![CDATA[çŽ°åœºç‰ˆæœ¬æŽ§åˆ¶ çŽ°åœºç‰ˆæœ¬åº“åˆ›å»ºã€‚ ç›´æŽ¥åœ¨éœ€è¦ç‰ˆæœ¬æŽ§åˆ¶çš„ç›®å½•ä¸‹æ‰§è¡ŒGitç‰ˆæœ¬åº“åˆå§‹åŒ–å‘½ä»¤ã€‚ 1git init æ·»åŠ æ–‡ä»¶å¹¶æäº¤ 12git add -Agit commit -m &quot;æœ¬æ¬¡æäº¤çš„å†…å®¹æè¿°&quot; ä¸ºåˆå§‹æäº¤å»ºç«‹ä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼š&quot;v1&quot; 1git tag v1 ç„¶åŽå¼€å§‹åœ¨å·¥ä½œåŒºä¸­å·¥ä½œ--ä¿®æ”¹æ–‡ä»¶ï¼Œæäº¤ 1git commit -a å½“å¯¹ä¿®æ”¹ç»“æžœæ»¡æ„ï¼Œæƒ³å°†å·¥ä½œæˆåŠŸä¿å­˜å¸¦èµ°æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†ä»Žv1å¼€å§‹çš„åŽ†æ¬¡æäº¤ é€ä¸€å¯¼å‡ºä¸ºè¡¥ä¸æ–‡ä»¶ã€‚è½¬æ¢çš„è¡¥ä¸æ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ªæ•°å­—å‰ç¼€ï¼Œå¹¶æå–æäº¤æ—¥å¿—ä¿¡æ¯ä½œä¸ºæ–‡ä»¶åï¼Œè€Œä¸”è¡¥ä¸æ–‡ä»¶ è¿˜æä¾›å¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„æ”¯æŒã€‚ 1git format-patch v1..HEAD é€šè¿‡é‚®ä»¶å°†è¡¥ä¸æ–‡ä»¶å‘å‡ºã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å°†è¡¥ä¸æ–‡ä»¶å¸¦èµ°ã€‚ 1git send-email *.patch Gitåˆ›å»ºçš„è¡¥ä¸æ–‡ä»¶ä½¿ç”¨äº†Gitæ‰©å±•æ ¼å¼ï¼Œå› æ­¤åœ¨å¯¼å…¥æ—¶ä¸ºäº†é¿å…æ•°æ®é—æ¼ï¼Œè¦ä½¿ç”¨Gitæä¾›çš„å‘½ä»¤è€Œä¸èƒ½ ä½¿ç”¨GNU patchå‘½ä»¤ã€‚å³æ—¶è¦å¯¼å…¥çš„ä¸æ˜¯Gitç‰ˆæœ¬åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Gitå‘½ä»¤ã€‚ ä¿®æ”¹æäº¤è¯´æ˜Ž 1git commit --amend è¿™ä¸ªå‘½ä»¤å¦‚æžœä¸å¸¦&quot;-m&quot;å‚æ•°ï¼Œä¼šè¿›å…¥æäº¤æäº¤è¯´æ˜Žç¼–è¾‘ç•Œé¢ï¼Œä¿®æ”¹åŽŸæ¥çš„æäº¤è¯´æ˜Žï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ã€‚ å¦‚æžœè¦ä¿®æ”¹æŸä¸ªåŽ†å²æäº¤çš„æäº¤è¯´æ˜Žï¼ŒGitä¹Ÿå¯ä»¥å®žçŽ°ï¼Œä½†è¦ç”¨åˆ°å¦ä¸€ä¸ªå‘½ä»¤ï¼šå˜åŸºå‘½ä»¤ã€‚ ä¾‹å¦‚è¦ä¿®æ”¹&lt;commit-id&gt;æ‰€æ ‡è¯†æäº¤çš„æäº¤è¯´æ˜Žï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¹¶åœ¨å¼¹å‡ºçš„å˜åŸºç´¢å¼•æ–‡ä»¶ä¸­ ä¿®æ”¹ç›¸åº”æäº¤å‰é¢çš„åŠ¨ä½œçš„å…³é”®å­—ã€‚ 1git rebase -i &lt;commit-id&gt;^ åˆ é™¤ä¸åº”æäº¤çš„æ–‡ä»¶ 12git rm --cached æ–‡ä»¶ågit commit --amend å¦‚æžœæ˜¯åŽ†å²ç‰ˆæœ¬ï¼Œä¾‹å¦‚æ˜¯åœ¨&lt;commit-id&gt;æ‰€æ ‡è¯†çš„æäº¤ä¸­å¼•å…¥çš„æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨å˜åŸºæ“ä½œã€‚ 1git rebase -i &lt;commit-id&gt;^ æ›´å¥½ç”¨çš„æäº¤åˆ—è¡¨ git add å‘½ä»¤å°†ä¿®æ”¹å†…å®¹åŠ å…¥æäº¤æš‚å­˜åŒºã€‚ git add -u å‘½ä»¤å¯ä»¥å°†æ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºã€‚ git add -A å‘½ä»¤å¯ä»¥å°†æœ¬åœ°åˆ é™¤æ–‡ä»¶å’Œæ–°å¢žæ–‡ä»¶éƒ½ç™»è®°åˆ°æš‚å­˜åŒºã€‚ git add -p å‘½ä»¤ç”šè‡³å¯ä»¥å¯¹ä¸€ä¸ªæ–‡ä»¶å†…çš„ä¿®æ”¹è¿›è¡Œæœ‰é€‰æ‹©æ€§çš„æ·»åŠ ã€‚ ä¸€ä¸ªä¿®æ”¹åŽçš„æ–‡ä»¶è¢«ç™»è®°åˆ°æäº¤æš‚å­˜åŒºåŽï¼Œå¯ä»¥ç»§ç»­ä¿®æ”¹ï¼Œç»§ç»­ä¿®æ”¹çš„å†…å®¹ä¸ä¼šè¢«æäº¤ï¼Œé™¤éžå†å¯¹æ­¤æ–‡ä»¶ å†æ‰§è¡Œä¸€æ¬¡ git add å‘½ä»¤ã€‚å³ä¸€ä¸ªä¿®æ”¹æ–‡ä»¶å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåœ¨æäº¤æš‚å­˜åŒºä¸­æœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨å·¥ä½œåŒº ä¸­æœ‰å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ æ‰§è¡Œ git commitå‘½ä»¤æäº¤ï¼Œæ— é¡»è®¾å®šä»€ä¹ˆå˜æ›´åˆ—è¡¨ï¼Œç›´æŽ¥å°†ç™»è®°åœ¨æš‚å­˜åŒºä¸­çš„å†…å®¹æäº¤ã€‚ Gitæ”¯æŒå¯¹æäº¤çš„æ’¤é”€ï¼Œè€Œä¸”å¯ä»¥æ’¤é”€ä»»æ„å¤šæ¬¡ã€‚ å·¥ä½œè¿›åº¦ä¿å­˜ å¦‚æžœå·¥ä½œåŒºçš„ä¿®æ”¹å°šæœªå®Œæˆæ—¶ï¼Œå¿½ç„¶æœ‰ä¸€ä¸ªç´§æ€¥çš„ä»»åŠ¡ï¼Œéœ€è¦ä»Žä¸€ä¸ªå¹²å‡€çš„å·¥ä½œåŒºå¼€å§‹æ–°çš„å·¥ä½œï¼Œ æˆ–è€…è¦åˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯è¿›è¡Œå·¥ä½œï¼Œé‚£ä¹ˆå¦‚æžœä¿å­˜å½“å‰å°šæœªå®Œæˆçš„å·¥ä½œè¿›åº¦å‘¢ï¼Ÿ 1git stash åœ¨åˆ‡æ¢åˆ°æ–°çš„å·¥ä½œåˆ†æ”¯ä¹‹å‰ï¼Œæ‰§è¡Œ git stash ä¿å­˜å·¥ä½œè¿›åº¦ï¼Œå·¥ä½œåŒºä¼šå˜çš„éžå¸¸å¹²å‡€ï¼Œç„¶åŽå°±å¯ä»¥åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯ã€‚ 12git stash git checkout &lt;new_branch&gt; æ–°çš„å·¥ä½œåˆ†æ”¯ä¿®æ”¹å®Œæ¯•åŽï¼Œå†åˆ‡æ¢å›žå½“å‰åˆ†æ”¯ï¼Œè°ƒç”¨ git stash pop å‘½ä»¤åˆ™å¯æ¢å¤ä¹‹å‰ä¿å­˜çš„å·¥ä½œè¿›åº¦ã€‚ 12git checkout &lt;orignal_branch&gt;git stash pop æ›´å¥½çš„å·®å¼‚æ¯”è¾ƒ Gitå¯¹å·®å¼‚æ¯”è¾ƒè¿›è¡Œäº†æ‰©å±•ï¼Œæ”¯æŒå¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„å·®å¼‚æ¯”è¾ƒï¼Œè¿™æ˜¯å¯¹GNUçš„ diff å’Œ patch å‘½ä»¤çš„é‡è¦è¡¥å……ã€‚ è¿˜æœ‰Gitçš„å·®å¼‚æ¯”è¾ƒé™¤äº†æ”¯æŒåŸºäºŽè¡Œçš„å·®å¼‚æ¯”è¾ƒå¤–ï¼Œè¿˜æ”¯æŒåœ¨ä¸€è¡Œå†…é€å­—æ¯”è¾ƒçš„æ–¹å¼ï¼Œå½“å‘ git diff å‘½ä»¤ ä¼ é€’ --word-diff å‚æ•°æ—¶ï¼Œå°±ä¼šè¿›è¡Œé€å­—æ¯”è¾ƒã€‚ åœ¨ä¸Šé¢ä»‹ç»äº†å·¥ä½œåŒºçš„æ–‡ä»¶ä¿®æ”¹å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯åœ¨æäº¤æš‚å­˜åŒºï¼Œä¸€ä¸ªæ˜¯åœ¨å·¥ä½œåŒºã€‚å› æ­¤åœ¨ æ‰§è¡Œ git diff å‘½ä»¤æ—¶ä¼šé‡åˆ°ä»¤Gitæ–°æ‰‹è´¹è§£çš„çŽ°è±¡ã€‚ ä¿®æ”¹åŽçš„æ–‡ä»¶åœ¨æ‰§è¡Œ git diff å‘½ä»¤æ—¶ä¼šçœ‹åˆ°ä¿®æ”¹é€ æˆçš„å·®å¼‚ã€‚ ä¿®æ”¹åŽçš„æ–‡ä»¶é€šè¿‡ git add å‘½ä»¤æäº¤åˆ°æš‚å­˜åŒºï¼Œå†æ‰§è¡Œ git diff å‘½ä»¤ä¼šçœ‹ä¸åˆ°è¯¥æ–‡ä»¶çš„å·®å¼‚ã€‚ æ‰§è¡Œ git diff --cached å‘½ä»¤æ‰å¯ä»¥çœ‹åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºä¸­çš„æ–‡ä»¶æ‰€åšå‡ºçš„ä¿®æ”¹ã€‚ æ— å¤„ä¸åœ¨çš„åˆ†é¡µå™¨ åˆ†é¡µå™¨é»˜è®¤ä½¿ç”¨ lesså‘½ä»¤ï¼ˆless -FRSXï¼‰è¿›è¡Œåˆ†é¡µã€‚ ä¸‹é¢æ˜¯åœ¨åˆ†é¡µå™¨ä¸­å¸¸ç”¨çš„çƒ­é”®ï¼š å­—æ¯qï¼šé€€å‡ºåˆ†é¡µå™¨ï¼› å­—æ¯hï¼šæ˜¾ç¤ºåˆ†é¡µå™¨å¸®åŠ©ï¼› æŒ‰ç©ºæ ¼ä¸‹ç¿»ä¸€é¡µï¼ŒæŒ‰å­—æ¯bä¸Šç¿»ä¸€é¡µï¼› å­—æ¯då’Œuï¼šåˆ†åˆ«ä»£è¡¨å‘ä¸‹ç¿»åŠ¨åŠé¡µå’Œå‘ä¸Šç¿»åŠ¨åŠé¡µï¼› å­—æ¯jå’Œkï¼šåˆ†åˆ«ä»£è¡¨å‘ä¸Šç¿»ä¸€è¡Œå’Œå‘ä¸‹ç¿»ä¸€è¡Œï¼› å¦‚æžœè¡Œå¤ªé•¿è¢«æˆªæ–­ï¼Œå¯ä»¥ç”¨å·¦ç®­å¤´å’Œå³ç®­å¤´ä½¿å¾—çª—å£å†…å®¹å·¦å³æ»šåŠ¨ï¼› è¾“å…¥/patternï¼šå‘ä¸‹å¯»æ‰¾å’ŒpatternåŒ¹é…çš„å†…å®¹ï¼› è¾“å…¥?patternï¼šå‘ä¸Šå¯»æ‰¾å’ŒpatternåŒ¹é…çš„å†…å®¹ï¼› å­—æ¯næˆ–Nï¼šä»£è¡¨å‘å‰æˆ–å‘åŽç»§ç»­å¯»æ‰¾ï¼› å­—æ¯gï¼šè·³åˆ°ç¬¬ä¸€è¡Œï¼› å­—æ¯Gï¼šè·³åˆ°æœ€åŽä¸€è¡Œï¼› è¾“å…¥æ•°å­—å†åŠ å­—æ¯gï¼šåˆ™è·³è½¬åˆ°å¯¹åº”çš„è¡Œï¼› è¾“å…¥!&lt;command&gt;ï¼šå¯ä»¥æ‰§è¡ŒShellå‘½ä»¤ã€‚ å¯¹äºŽé»˜è®¤æœªæä¾›åˆ†é¡µå™¨çš„Gitå‘½ä»¤ï¼Œä¾‹å¦‚ git status å‘½ä»¤ï¼Œå¯é€šè¿‡ä¸‹é¢ä»»ä¸€æ–¹æ³•å¯ç”¨åˆ†é¡µå™¨ï¼š åœ¨ git å’Œå­å‘½ä»¤(å¦‚ï¼šstatus)ä¹‹é—´æ’å…¥å‚æ•°-pæˆ–--paginateï¼Œä¸ºå‘½ä»¤å¯ç”¨å†…å»ºåˆ†é¡µå™¨ã€‚å¦‚ï¼š 1git -p status -è®¾ç½®Gitå˜é‡ï¼Œè®¾ç½®å®Œæ¯•åŽè¿è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œå°†å¯ç”¨å†…å»ºåˆ†é¡µå™¨ã€‚ 1git config --global pager.status true Git å‘½ä»¤çš„åˆ†é¡µå™¨æ”¯æŒå¸¦é¢œè‰²çš„å­—ç¬¦è¾“å‡ºï¼Œå¯¹äºŽå¤ªé•¿çš„è¡Œåˆ™é‡‡ç”¨æˆªæ–­æ–¹å¼å¤„ç†ï¼ˆå¯ç”¨å·¦å³æ–¹å‘é”®æ»šåŠ¨ï¼‰ã€‚ å¦‚æžœä¸ä¹ æƒ¯åˆ†é¡µå™¨çš„é•¿è¡Œæˆªæ–­æ¨¡å¼è€Œå¸Œæœ›é‡‡ç”¨è‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ï¼Œå¯é€šè¿‡ä¸‹é¢ä»»ä¸€æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼š é€šè¿‡è®¾ç½®LESSçŽ¯å¢ƒå˜é‡æ¥å®žçŽ°ã€‚ 1export LESS=FRX -æˆ–è€…é€šè¿‡å®šä¹‰Gité…ç½®å˜é‡æ¥æ”¹å˜åˆ†é¡µå™¨çš„é»˜è®¤è¡Œä¸ºã€‚ 1git config --global core.pager &apos;less -+$LESS -FRX&apos;]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-01ä¹‹-åŸºæœ¬æ¦‚å¿µ]]></title>
    <url>%2Fposts%2F7335ce5b.html</url>
    <content type="text"><![CDATA[è¿›ç¨‹ æ¦‚è¿° è¿›ç¨‹æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºŽæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æž„çš„åŸºç¡€ã€‚ åœ¨æ—©æœŸé¢å‘è¿›ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æž„ä¸­ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„åŸºæœ¬æ‰§è¡Œå®žä½“ï¼›åœ¨å½“ä»£é¢å‘çº¿ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æž„ä¸­ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ã€‚ç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®žä½“ã€‚ ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œç¨‹åºçš„å®žä¾‹ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ï¼Œå¯„å­˜å™¨å’Œå˜é‡çš„å½“å‰å€¼ã€‚ä»Žæ¦‚å¿µä¸Šè¯´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„è™šæ‹ŸCPUã€‚å®žé™…ä¸ŠçœŸæ­£çš„CPUåœ¨å„ä¸ªè¿›ç¨‹é—´æ¥å›žåˆ‡æ¢ã€‚ è¿›ç¨‹çš„å±‚æ¬¡ç»“æž„ è¿›ç¨‹åªæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œä½†æ˜¯å¯ä»¥æœ‰0ä¸ªï¼Œä¸€ä¸ªï¼Œå¤šä¸ªå­è¿›ç¨‹ã€‚ è¿›ç¨‹çš„çŠ¶æ€ è¿è¡Œæ€ï¼šè¯¥æ—¶åˆ»è¿›ç¨‹å®žé™…å ç”¨CPUã€‚ å°±ç»ªæ€ï¼šå¯è¿è¡Œï¼Œä½†å› ä¸ºå…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œè€Œæš‚æ—¶åœæ­¢ã€‚ é˜»å¡žæ€ï¼šé™¤éžæŸç§å¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œå¦åˆ™è¿›ç¨‹ä¸èƒ½è¿è¡Œã€‚ çº¿ç¨‹ çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®žä½“ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä»–æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹ç”¨äºŽæŠŠèµ„æºé›†ä¸­åˆ°ä¸€èµ·ï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯åœ¨CPUä¸Šè¢«è°ƒåº¦æ‰§è¡Œçš„å®žä½“ã€‚ è¿›ç¨‹ï¼šæŒ‡åœ¨ç³»ç»Ÿä¸­èƒ½ç‹¬ç«‹è¿è¡Œå¹¶ä½œä¸ºèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç”±ä¸€ç»„æœºå™¨æŒ‡ä»¤ã€æ•°æ®å’Œå †æ ˆç­‰ç»„æˆçš„ï¼Œæ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„æ´»åŠ¨å®žä½“ã€‚ çº¿ç¨‹ï¼šæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®žä½“ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä»–æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºã€‚ å¤šä¸ªè¿›ç¨‹çš„å†…éƒ¨æ•°æ®å’ŒçŠ¶æ€éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„,è€Œå¤šçº¿ç¨‹æ˜¯å…±äº«ä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æº,æœ‰å¯èƒ½äº’ç›¸å½±å“. çº¿ç¨‹æœ¬èº«çš„æ•°æ®é€šå¸¸åªæœ‰å¯„å­˜å™¨æ•°æ®ï¼Œä»¥åŠä¸€ä¸ªç¨‹åºæ‰§è¡Œæ—¶ä½¿ç”¨çš„å †æ ˆï¼Œæ‰€ä»¥çº¿ç¨‹çš„åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢çš„è´Ÿæ‹…è¦å°ã€‚ åœ¨åŒä¸€è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§è¦æ¯”ä¸åŒè¿›ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§ä½Žå¾—å¤šã€‚è¿™æ˜¯å› ä¸ºä¸ºé˜²æ­¢è¿›ç¨‹ä¹‹é—´å½¼æ­¤å¹²æ‰°å’Œç ´åï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åœ°å€ç©ºé—´å’Œå…¶å®ƒèµ„æºï¼Œé™¤äº†å…±äº«å…¨å±€å˜é‡å¤–ï¼Œä¸å…è®¸å…¶å®ƒè¿›ç¨‹çš„è®¿é—®ã€‚ä½†æ˜¯åŒä¸€è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹å¾€å¾€æ˜¯ä¸ºäº†æé«˜å¹¶å‘æ€§ä»¥åŠè¿›è¡Œç›¸äº’ä¹‹é—´çš„åˆä½œè€Œåˆ›å»ºçš„ï¼Œå®ƒä»¬å…±äº«è¿›ç¨‹çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œå¦‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å®ƒä»¬æ‰€å±žè¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ‰€æœ‰åœ°å€ï¼Œå¦‚ä¸€ä¸ªçº¿ç¨‹çš„å †æ ˆå¯ä»¥è¢«å…¶å®ƒçº¿ç¨‹è¯»ã€å†™ï¼Œç”šè‡³å®Œå…¨æ¸…é™¤ã€‚ çº¿ç¨‹çŠ¶æ€å›¾ çº¿ç¨‹çŠ¶æ€è§£æž &lt;span id=&quot;inline-green&quot;&gt; 1. æ–°å»ºçŠ¶æ€(New): &lt;/span&gt; çº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºåŽï¼Œå°±è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚ä¾‹å¦‚ï¼ŒThread thread = new Thread()ã€‚ &lt;span id=&quot;inline-green&quot;&gt; 2. å°±ç»ªçŠ¶æ€(Runnable): &lt;/span&gt; ä¹Ÿè¢«ç§°ä¸ºâ€œå¯æ‰§è¡ŒçŠ¶æ€â€ï¼Œå¤„äºŽå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ï¼Œéšæ—¶å¯èƒ½è¢«CPUè°ƒåº¦æ‰§è¡Œã€‚ è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•ï¼Œæ­¤çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ å½“å‰çº¿ç¨‹sleep()æ–¹æ³•ç»“æŸï¼Œå…¶ä»–çº¿ç¨‹join()ç»“æŸï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥å®Œæ¯•ï¼ŒæŸä¸ªçº¿ç¨‹æ‹¿åˆ°å¯¹è±¡é”ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿå°†è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ å½“å‰çº¿ç¨‹æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œè°ƒç”¨å½“å‰çº¿ç¨‹çš„yield()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ é”æ± é‡Œçš„çº¿ç¨‹æ‹¿åˆ°å¯¹è±¡é”åŽï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ &lt;span id=&quot;inline-green&quot;&gt; 3. è¿è¡ŒçŠ¶æ€(Running):&lt;/span&gt; çº¿ç¨‹èŽ·å–CPUæƒé™è¿›è¡Œæ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹åªèƒ½ä»Žå°±ç»ªçŠ¶æ€è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ã€‚ &lt;span id=&quot;inline-green&quot;&gt; 4. é˜»å¡žçŠ¶æ€(Blocked): &lt;/span&gt; é˜»å¡žçŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŽŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚é˜»å¡žçš„æƒ…å†µåˆ†ä¸‰ç§ï¼š ç­‰å¾…é˜»å¡ž -- é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„wait()æ–¹æ³•ï¼Œè®©çº¿ç¨‹ç­‰å¾…æŸå·¥ä½œçš„å®Œæˆã€‚ åŒæ­¥é˜»å¡ž -- çº¿ç¨‹åœ¨èŽ·å–synchronizedåŒæ­¥é”å¤±è´¥(å› ä¸ºé”è¢«å…¶å®ƒçº¿ç¨‹æ‰€å ç”¨)ï¼Œå®ƒä¼šè¿›å…¥åŒæ­¥é˜»å¡žçŠ¶æ€ã€‚ å…¶ä»–é˜»å¡ž -- é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„sleep()æˆ–join()æˆ–å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥åˆ°é˜»å¡žçŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ &lt;span id=&quot;inline-green&quot;&gt; 5. æ­»äº¡çŠ¶æ€(Dead): &lt;/span&gt; çº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚çº¿ç¨‹ä¸€æ—¦ç»ˆæ­¢äº†ï¼Œå°±ä¸èƒ½å¤ç”Ÿã€‚åœ¨ä¸€ä¸ªç»ˆæ­¢çš„çº¿ç¨‹ä¸Šè°ƒç”¨start()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºjava.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚ è¯´æ˜Ž è¿™5ç§çŠ¶æ€æ¶‰åŠåˆ°çš„å†…å®¹åŒ…æ‹¬Objectç±», Threadå’Œsynchronizedå…³é”®å­—ã€‚ Objectç±»ï¼Œå®šä¹‰äº†wait(), notify(), notifyAll()ç­‰ä¼‘çœ /å”¤é†’å‡½æ•°ã€‚ Threadç±»ï¼Œå®šä¹‰äº†ä¸€äº›åˆ—çš„çº¿ç¨‹æ“ä½œå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œsleep()ä¼‘çœ å‡½æ•°, interrupt()ä¸­æ–­å‡½æ•°, getName()èŽ·å–çº¿ç¨‹åç§°ç­‰ã€‚ synchronizedï¼Œæ˜¯å…³é”®å­—ï¼›å®ƒåŒºåˆ†ä¸ºsynchronizedä»£ç å—å’Œsynchronizedæ–¹æ³•ã€‚synchronizedçš„ä½œç”¨æ˜¯è®©çº¿ç¨‹èŽ·å–å¯¹è±¡çš„åŒæ­¥é”ã€‚ å‡ ä¸ªæ–¹æ³•çš„æ¯”è¾ƒ &lt;p id=&quot;div-border-left-green&quot;&gt; 1. Thread.sleep(long millis)ï¼Œä¸€å®šæ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥TIMED_WAITINGçŠ¶æ€ï¼Œä½†ä¸é‡Šæ”¾å¯¹è±¡é”ï¼ŒmillisåŽçº¿ç¨‹è‡ªåŠ¨è‹é†’è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ä½œç”¨ï¼šç»™å…¶å®ƒçº¿ç¨‹æ‰§è¡Œæœºä¼šçš„æœ€ä½³æ–¹å¼ã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; 2. Thread.yield()ï¼Œä¸€å®šæ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹æ”¾å¼ƒèŽ·å–çš„CPUæ—¶é—´ç‰‡ï¼Œä½†ä¸é‡Šæ”¾é”èµ„æºï¼Œç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè®©OSå†æ¬¡é€‰æ‹©çº¿ç¨‹ã€‚ä½œç”¨ï¼šè®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹è½®æµæ‰§è¡Œï¼Œä½†å¹¶ä¸ä¿è¯ä¸€å®šä¼šè½®æµæ‰§è¡Œã€‚å®žé™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥ç›®çš„ï¼Œå› ä¸ºè®©æ­¥çš„çº¿ç¨‹è¿˜æœ‰å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚Thread.yield()ä¸ä¼šå¯¼è‡´é˜»å¡žã€‚è¯¥æ–¹æ³•ä¸Žsleep()ç±»ä¼¼ï¼Œåªæ˜¯ä¸èƒ½ç”±ç”¨æˆ·æŒ‡å®šæš‚åœå¤šé•¿æ—¶é—´ã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; 3. t.join()/t.join(long millis)ï¼Œå½“å‰çº¿ç¨‹é‡Œè°ƒç”¨å…¶å®ƒçº¿ç¨‹tçš„joinæ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥WAITING/TIMED_WAITINGçŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šé‡Šæ”¾å·²ç»æŒæœ‰çš„å¯¹è±¡é”ã€‚çº¿ç¨‹tæ‰§è¡Œå®Œæ¯•æˆ–è€…millisæ—¶é—´åˆ°ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; 4. obj.wait()ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾å¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ä¾é notify()/notifyAll()å”¤é†’æˆ–è€…wait(long timeout) timeoutæ—¶é—´åˆ°è‡ªåŠ¨å”¤é†’ã€‚&lt;/p&gt; &lt;p id=&quot;div-border-left-green&quot;&gt; 5. obj.notify()å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©æ˜¯ä»»æ„æ€§çš„ã€‚notifyAll()å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚&lt;/p&gt;]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ‰è¶£çš„SpringBootå¯åŠ¨bannerï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F74450131.html</url>
    <content type="text"><![CDATA[åƒé‡Œé©¬ 123456789101112131415161718192021 _(\_/) ,((((^`\ (((( (6 \ ,((((( , \ ,,,_ ,((((( /"._ ,`, ((((\\ ,... ,(((( / `-.-' ))) ;' `"'"'""(((( ( ((( / ((( \ )) | |(( | . ' |)) \ _ ' `t ,.')( | y;- -,-""'"-.\ \/ ) / ./ ) / `\ \ |./ ( ( / /' || \\ //'| || \\ _//'|| || )) |_/ || \_\ |_/ || `'" \_\ `'" æ–‡å­—å…” 12345678910111213141516171819202122232425262728293031323334353637/*** * ç“¦ç“¦ å * åé½±é¾ å·± äº…ç“¦è»Šå·± * ä¹™é¾é¾ æ¯‹æ—¥ä¸¶ ä¸¶ä¹™å·±æ¯‹æ¯‹ä¸¶ * åé¾ é¦¬é¬¼è»Šç“¦ å·±åç“¦æ¯‹æ¯‹ * é¬¼é¦¬é¾ é¦¬é¾ å å·±å·±æ¯‹è»Šæ¯‹ç“¦ * æ¯‹é¾ é¾ é¾é¾ é¬¼ä¹™ä¸¶ä¸¶ä¹™è»Šä¹™æ¯‹é¬¼è»Šå·± * ä¹™é¾ é¾é¾é¬¼é¾ç“¦ åç“¦æ¯‹ä¹™ç“¦é¾ ç“¦äº… * é¦¬é½±é¾é¦¬é¬¼åä¸¶æ—¥å·±å·±å·±æ¯‹è»Šä¹™ä¸¶ * å·±é½±é¦¬é¬¼è»Šååæ¯‹æ—¥ä¹™å·±å·±ä¹™ä¹™ * è»Šé¦¬é½±é½±æ—¥ä¹™æ¯‹ç“¦å·±ä¹™ç“¦æ—¥äº… * äº…è»Šé½ºé¾–ç“¦ä¹™è»Šé¾–é¾ä¹™ä¹™å * æ—¥é¾ é¾ åäº…è»Šé¾æ¯‹åå * æ—¥æ¯‹å·±äº… å·±å·±åäº…äº… * ä¸¶å·±ååä¹™ ä¸¶ä¸¶ä¸¶ä¸¶ä¸¶ * äº…å·±åé¾é¾–ç“¦ ä¸¶ ä¸¶ ä¹™å * äº…å·±åé¾ é¾–æ¯‹ ä¸¶ä¸¶ ä¸¶å·±é¬¼é¬¼ç“¦äº… * åæ—¥ååæ—¥äº…ä¸¶äº…ä¸¶ ä¸¶åæ—¥æ¯‹é¬¼é¦¬é¦¬è»Šä¹™ * åæ—¥ä¹™åäº…äº…äº…ä¸¶ åä¹™å·±æ¯‹é¬¼é¬¼é¬¼é¾é½ºé¦¬ä¹™ * ä¸¶ç“¦å·±ä¹™ååäº…ä¸¶äº…ä¹™ä¹™ä¹™å·±æ¯‹é¬¼é¬¼é¬¼é¾é½±é½ºé½ºé¬¼å * ä¹™ä¹™åååäº…ä¹™ç“¦ç“¦å·±æ—¥ç“¦æ¯‹é¬¼é¬¼é¾ é½±é½±é¾é¾é½±é½±æ¯‹ä¸¶ * äº…ååååä¹™ç“¦è»Šæ¯‹ç“¦ç“¦æ—¥è»Šé¦¬é¾ é¾é¾é¾é¾é¾é¾ é¾ é¾ é¦¬äº… * ååååå·±æ¯‹è»Šç“¦ç“¦ç“¦ç“¦é¬¼é¦¬é¾ é¾é¾ é¾ é¾é¾ é¾ é¾ é¦¬é¾ è»Š * äº…ååæ—¥æ¯‹ç“¦æ—¥æ—¥ç“¦é¬¼é¬¼é¬¼é¾ é¾ é¦¬é¦¬é¾ é¾é¾é¾ é¦¬é¦¬è»Š * äº…äº…äº…ä¹™ç“¦ç“¦æ¯‹è»Šè»Šè»Šé¦¬é¾é¾ é¬¼é¬¼é¦¬é¾ é¾é¾é¾ é¦¬é¦¬é¬¼ * ä¸¶ä¸¶ä¹™äº…äº…ä¹™è»Šé¬¼é¬¼é¬¼æ¯‹è»Šé¾é¾é¾ é¬¼é¦¬é¦¬é¾ é¾é½±é½±é¾é¦¬é¬¼ * äº…å·±ååå·±åæ—¥é¬¼é¬¼è»Šç“¦æ¯‹é¾ é¾é¾ é¦¬é¦¬é¾ é¾ é¾ é½±é½ºé½ºé½±é¾ é¬¼ * äº…ä¹™ä¹™ä¹™åè»Šé¦¬è»Šæ¯‹é¦¬é½±é½±é¾é¾ é¾ é¾ é¦¬é¾ é¾é½±é¾é¾ é¾ é¬¼ç“¦ * ä¸¶æ¯‹é¾ é¬¼è»Šç“¦è»Šé¦¬é¾ é¾é¾ é¾ é¾é½±é½±é¾ é¦¬é¦¬é¬¼æ¯‹æ—¥ * åä¹™å·±æ—¥å ä¸¶å·±é¬¼é¾é½±é½ºé½±é¾é¦¬é¦¬é¦¬è»Šæ¯‹å·± * ä¸¶åå·±ä¹™äº…ä¸¶ äº…ç“¦é¦¬é¾ é¾é¾ é¾ é¦¬æ¯‹ç“¦ä¹™ * ä¸¶ååä¹™äº…å äº…å·±ç“¦è»Šé¦¬é¾ é¬¼è»Šç“¦ä¹™ * ä¸¶åä¹™ååä¸¶ ä¸¶ä¸¶äº…åç“¦é¬¼è»Šç“¦å·± * ä¸¶äº…äº…ä¸¶ äº…æ—¥ç“¦æ—¥ * ä¸¶ */ ç‹—å¤´1 123456789101112131415161718192021222324252627282930313233343536373839/*** * .,:,,, .::,,,::. * .::::,,;;, .,;;:,,....:i: * :i,.::::,;i:. ....,,:::::::::,.... .;i:,. ......;i. * :;..:::;::::i;,,:::;:,,,,,,,,,,..,.,,:::iri:. .,:irsr:,.;i. * ;;..,::::;;;;ri,,,. ..,,:;s1s1ssrr;,.;r, * :;. ,::;ii;:, . ................... .;iirri;;;,,;i, * ,i. .;ri:. ... ............................ .,,:;:,,,;i: * :s,.;r:... ....................................... .::;::s; * ,1r::. .............,,,.,,:,,........................,;iir; * ,s;........... ..::.,;:,,. ...............,;1s * :i,..,. .,:,,::,. .......... .......;1, * ir,....:rrssr;:, ,,.,::. .r5S9989398G95hr;. ....,.:s, * ;r,..,s9855513XHAG3i .,,,,,,,. ,S931,.,,.;s;s&amp;BHHA8s.,..,..:r: * :r;..rGGh, :SAG;;G@BS:.,,,,,,,,,.r83: hHH1sXMBHHHM3..,,,,.ir. * ,si,.1GS, sBMAAX&amp;MBMB5,,,,,,:,,.:&amp;8 3@HXHBMBHBBH#X,.,,,,,,rr * ;1:,,SH: .A@&amp;&amp;B#&amp;8H#BS,,,,,,,,,.,5XS, 3@MHABM&amp;59M#As..,,,,:,is, * .rr,,,;9&amp;1 hBHHBB&amp;8AMGr,,,,,,,,,,,:h&amp;&amp;9s; r9&amp;BMHBHMB9: . .,,,,;ri. * :1:....:5&amp;XSi;r8BMBHHA9r:,......,,,,:ii19GG88899XHHH&amp;GSr. ...,:rs. * ;s. .:sS8G8GG889hi. ....,,:;:,.:irssrriii:,. ...,,i1, * ;1, ..,....,,isssi;, .,,. ....,.i1, * ;h: i9HHBMBBHAX9: . ...,,,rs, * ,1i.. :A#MBBBBMHB#s ....,,,;si. * .r1,.. ,..;3BMBBBHBB#Bh. .. ....,,,,,i1; * :h;.. .,..;,1XBMMMMBXs,.,, .. :: ,. ....,,,,,,ss. * ih: .. .;;;, ;;:s58A3i,.. ,. ,.:,,. ...,,,,,:,s1, * .s1,.... .,;sh, ,iSAXs;. ,. ,,.i85 ...,,,,,,:i1; * .rh: ... rXG9XBBM#M#MHAX3hss13&amp;&amp;HHXr .....,,,,,,,ih; * .s5: ..... i598X&amp;&amp;A&amp;AAAAAA&amp;XG851r: ........,,,,:,,sh; * . ihr, ... . .. ........,,,,,;11:. * ,s1i. ... ..,,,..,,,.,,.,,.,.. ........,,.,,.;s5i. * .:s1r,...................... ..............;shs, * . .:shr:. .... ..............,ishs. * .,issr;,... ...........................,is1s;. * .,is1si;:,....................,:;ir1sr;, * ..:isssssrrii;::::::;;iirsssssr;:.. * .,::iiirsssssssssrri;;:. */ ç‹—å¤´2 12345678910111213141516171819202122232425262728293031323334353637383940/*** * ii. ;9ABH, * SA391, .r9GG35&amp;G * &amp;#ii13Gh; i3X31i;:,rB1 * iMs,:,i5895, .5G91:,:;:s1:8A * 33::::,,;5G5, ,58Si,,:::,sHX;iH1 * Sr.,:;rs13BBX35hh11511h5Shhh5S3GAXS:.,,::,,1AG3i,GG * .G51S511sr;;iiiishS8G89Shsrrsh59S;.,,,,,..5A85Si,h8 * :SB9s:,............................,,,.,,,SASh53h,1G. * .r18S;..,,,,,,,,,,,,,,,,,,,,,,,,,,,,,....,,.1H315199,rX, * ;S89s,..,,,,,,,,,,,,,,,,,,,,,,,....,,.......,,,;r1ShS8,;Xi * i55s:.........,,,,,,,,,,,,,,,,.,,,......,.....,,....r9&amp;5.:X1 * 59;.....,. .,,,,,,,,,,,... .............,..:1;.:&amp;s * s8,..;53S5S3s. .,,,,,,,.,.. i15S5h1:.........,,,..,,:99 * 93.:39s:rSGB@A; ..,,,,..... .SG3hhh9G&amp;BGi..,,,,,,,,,,,,.,83 * G5.G8 9#@@@@@X. .,,,,,,..... iA9,.S&amp;B##@@Mr...,,,,,,,,..,.;Xh * Gs.X8 S@@@@@@@B:..,,,,,,,,,,. rA1 ,A@@@@@@@@@H:........,,,,,,.iX: * ;9. ,8A#@@@@@@#5,.,,,,,,,,,... 9A. 8@@@@@@@@@@M; ....,,,,,,,,S8 * X3 iS8XAHH8s.,,,,,,,,,,...,..58hH@@@@@@@@@Hs ...,,,,,,,:Gs * r8, ,,,...,,,,,,,,,,..... ,h8XABMMHX3r. .,,,,,,,.rX: * :9, . .:,..,:;;;::,.,,,,,.. .,,. ..,,,,,,.59 * .Si ,:.i8HBMMMMMB&amp;5,.... . .,,,,,.sMr * SS :: h@@@@@@@@@@#; . ... . ..,,,,iM5 * 91 . ;:.,1&amp;@@@@@@MXs. . .,,:,:&amp;S * hS .... .:;,,,i3MMS1;..,..... . . ... ..,:,.99 * ,8; ..... .,:,..,8Ms:;,,,... .,::.83 * s&amp;: .... .sS553B@@HX3s;,. .,;13h. .:::&amp;1 * SXr . ...;s3G99XA&amp;X88Shss11155hi. ,;:h&amp;, * iH8: . .. ,;iiii;,::,,,,,. .;irHA * ,8X5; . ....... ,;iihS8Gi * 1831, .,;irrrrrs&amp;@ * ;5A8r. .:;iiiiirrss1H * :X@H3s....... .,:;iii;iiiiirsrh * r#h:;,...,,.. .,,:;;;;;:::,... .:;;;;;;iiiirrss1 * ,M8 ..,....,.....,,::::::,,... . .,;;;iiiiiirss11h * 8B;.,,,,,,,.,..... . .. .:;;;;iirrsss111h * i@5,:::,,,,,,,,.... . . .:::;;;;;irrrss111111 * 9Bi,:,,,,...... ..r91;;;;;iirrsss1ss1111 */ æ»‘ç¨½ç¬‘è„¸ 12345678910111213141516171819202122232425262728293031323334/*** * .,, .,:;;iiiiiiiii;;:,,. .,, * rGB#HS,.;iirrrrriiiiiiiiiirrrrri;,s&amp;#MAS, * r5s;:r3AH5iiiii;;;;;;;;;;;;;;;;iiirXHGSsiih1, * .;i;;s91;;;;;;::::::::::::;;;;iS5;;;ii: * :rsriii;;r::::::::::::::::::::::;;,;;iiirsi, * .,iri;;::::;;;;;;::,,,,,,,,,,,,,..,,;;;;;;;;iiri,,. * ,9BM&amp;, .,:;;:,,,,,,,,,,,hXA8: ..,,,. * ,;&amp;@@#r:;;;;;::::,,. ,r,,,,,,,,,,iA@@@s,,:::;;;::,,. .;. * :ih1iii;;;;;::::;;;;;;;:,,,,,,,,,,;i55r;;;;;;;;;iiirrrr,.. * .ir;;iiiiiiiiii;;;;::::::,,,,,,,:::::,,:;;;iiiiiiiiiiiiri * iriiiiiiiiiiiiiiii;;;::::::::::::::::;;;iiiiiiiiiiiiiiiir; * ,riii;;;;;;;;;;;;;:::::::::::::::::::::::;;;;;;;;;;;;;;iiir. * iri;;;::::,,,,,,,,,,:::::::::::::::::::::::::,::,,::::;;iir: * .rii;;::::,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,::::;;iri * ,rii;;;::,,,,,,,,,,,,,:::::::::::,:::::,,,,,,,,,,,,,:::;;;iir. * ,rii;;i::,,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,,::i;;iir. * ,rii;;r::,,,,,,,,,,,,,:,:::::,:,:::::::,,,,,,,,,,,,,::;r;;iir. * .rii;;rr,:,,,,,,,,,,,,,,:::::::::::::::,,,,,,,,,,,,,:,si;;iri * ;rii;:1i,,,,,,,,,,,,,,,,,,:::::::::,,,,,,,,,,,,,,,:,ss:;iir: * .rii;;;5r,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,sh:;;iri * ;rii;:;51,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.:hh:;;iir, * irii;::hSr,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,sSs:;;iir: * irii;;:iSSs:.,,,,,,,,,,,,,,,,,,,,,,,,,,,..:135;:;;iir: * ;rii;;:,r535r:...,,,,,,,,,,,,,,,,,,..,;sS35i,;;iirr: * :rrii;;:,;1S3Shs;:,............,:is533Ss:,;;;iiri, * .;rrii;;;:,;rhS393S55hh11hh5S3393Shr:,:;;;iirr: * .;rriii;;;::,:;is1h555555h1si;:,::;;;iirri:. * .:irrrii;;;;;:::,,,,,,,,:::;;;;iiirrr;, * .:irrrriiiiii;;;;;;;;iiiiiirrrr;,. * .,:;iirrrrrrrrrrrrrrrrri;:. * ..,:::;;;;:::,,. */ é”®ç›˜ 1234567891011121314151617/*** * â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” * â”‚Escâ”‚ â”‚ F1â”‚ F2â”‚ F3â”‚ F4â”‚ â”‚ F5â”‚ F6â”‚ F7â”‚ F8â”‚ â”‚ F9â”‚F10â”‚F11â”‚F12â”‚ â”‚P/Sâ”‚S Lâ”‚P/Bâ”‚ â”Œâ” â”Œâ” â”Œâ” * â””â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”˜ â””â”˜ â””â”˜ * â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” * â”‚~ `â”‚! 1â”‚@ 2â”‚# 3â”‚$ 4â”‚% 5â”‚^ 6â”‚&amp; 7â”‚* 8â”‚( 9â”‚) 0â”‚_ -â”‚+ =â”‚ BacSp â”‚ â”‚Insâ”‚Homâ”‚PUpâ”‚ â”‚N Lâ”‚ / â”‚ * â”‚ - â”‚ * â”œâ”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ * â”‚ Tab â”‚ Q â”‚ W â”‚ E â”‚ R â”‚ T â”‚ Y â”‚ U â”‚ I â”‚ O â”‚ P â”‚&#123; [â”‚&#125; ]â”‚ | \ â”‚ â”‚Delâ”‚Endâ”‚PDnâ”‚ â”‚ 7 â”‚ 8 â”‚ 9 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ + â”‚ * â”‚ Caps â”‚ A â”‚ S â”‚ D â”‚ F â”‚ G â”‚ H â”‚ J â”‚ K â”‚ L â”‚: ;â”‚" 'â”‚ Enter â”‚ â”‚ 4 â”‚ 5 â”‚ 6 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â” â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ * â”‚ Shift â”‚ Z â”‚ X â”‚ C â”‚ V â”‚ B â”‚ N â”‚ M â”‚&lt; ,â”‚&gt; .â”‚? /â”‚ Shift â”‚ â”‚ â†‘ â”‚ â”‚ 1 â”‚ 2 â”‚ 3 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â” â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”¤ Eâ”‚â”‚ * â”‚ Ctrlâ”‚ â”‚Alt â”‚ Space â”‚ Altâ”‚ â”‚ â”‚Ctrlâ”‚ â”‚ â† â”‚ â†“ â”‚ â†’ â”‚ â”‚ 0 â”‚ . â”‚â†â”€â”˜â”‚ * â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ */ ä½›ç¥–ä¿ä½‘ 123456789101112131415161718192021222324/*** * _ooOoo_ * o8888888o * 88" . "88 * (| -_- |) * O\ = /O * ____/`---'\____ * . ' \\| |// `. * / \\||| : |||// \ * / _||||| -:- |||||- \ * | | \\\ - /// | | * | \_| ''\---/'' | | * \ .-\__ `-` ___/-. / * ___`. .' /--.--\ `. . __ * ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". * | | : `- \`.;`\ _ /`;.`/ - ` : | | * \ \ `-. \_ __\ /__ _/ .-` / / * ======`-.____`-.___\_____/___.-`____.-'====== * `=---=' * * ............................................. * ä½›ç¥–ä¿ä½‘ æ°¸æ— BUG */ ä½›æ›° 123456789101112/*** * ä½›æ›°: * å†™å­—æ¥¼é‡Œå†™å­—é—´ï¼Œå†™å­—é—´é‡Œç¨‹åºå‘˜ï¼› * ç¨‹åºäººå‘˜å†™ç¨‹åºï¼Œåˆæ‹¿ç¨‹åºæ¢é…’é’±ã€‚ * é…’é†’åªåœ¨ç½‘ä¸Šåï¼Œé…’é†‰è¿˜æ¥ç½‘ä¸‹çœ ï¼› * é…’é†‰é…’é†’æ—¥å¤æ—¥ï¼Œç½‘ä¸Šç½‘ä¸‹å¹´å¤å¹´ã€‚ * ä½†æ„¿è€æ­»ç”µè„‘é—´ï¼Œä¸æ„¿éž èº¬è€æ¿å‰ï¼› * å¥”é©°å®é©¬è´µè€…è¶£ï¼Œå…¬äº¤è‡ªè¡Œç¨‹åºå‘˜ã€‚ * åˆ«äººç¬‘æˆ‘å¿’ç–¯ç™«ï¼Œæˆ‘ç¬‘è‡ªå·±å‘½å¤ªè´±ï¼› * ä¸è§æ»¡è¡—æ¼‚äº®å¦¹ï¼Œå“ªä¸ªå½’å¾—ç¨‹åºå‘˜ï¼Ÿ */ ä½›ç¥–ç˜«ç—ª 1234567891011121314151617181920212223/*** * _ooOoo_ * o8888888o * 88" . "88 * (| -_- |) * O\ = /O * ___/`---'\____ * . ' \\| |// `. * / \\||| : |||// \ * / _||||| -:- |||||- \ * | | \\\ - /// | | * | \_| ''\---/'' | | * \ .-\__ `-` ___/-. / * ___`. .' /--.--\ `. . __ * ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". * | | : `- \`.;`\ _ /`;.`/ - ` : | | * \ \ `-. \_ __\ /__ _/ .-` / / * ======`-.____`-.___\_____/___.-`____.-'====== * `=---=' * ............................................. * ä½›æ›°ï¼šbugæ³›æ»¥ï¼Œæˆ‘å·²ç˜«ç—ªï¼ */ Fuck Bug 12345678910111213/*** * * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–ˆ â–ˆâ–ˆ â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„ â–ˆâ–ˆ â–„â–ˆâ–€ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— * â–“â–ˆâ–ˆ â–’ â–ˆâ–ˆ â–“â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–€ â–€â–ˆ â–ˆâ–ˆâ–„â–ˆâ–’ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• * â–’â–ˆâ–ˆâ–ˆâ–ˆ â–‘â–“â–ˆâ–ˆ â–’â–ˆâ–ˆâ–‘â–’â–“â–ˆ â–„ â–“â–ˆâ–ˆâ–ˆâ–„â–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•— * â–‘â–“â–ˆâ–’ â–‘â–“â–“â–ˆ â–‘â–ˆâ–ˆâ–‘â–’â–“â–“â–„ â–„â–ˆâ–ˆâ–’â–“â–ˆâ–ˆ â–ˆâ–„ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ * â–‘â–’â–ˆâ–‘ â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“ â–’ â–“â–ˆâ–ˆâ–ˆâ–€ â–‘â–’â–ˆâ–ˆâ–’ â–ˆâ–„ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• * â–’ â–‘ â–‘â–’â–“â–’ â–’ â–’ â–‘ â–‘â–’ â–’ â–‘â–’ â–’â–’ â–“â–’ â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• * â–‘ â–‘â–‘â–’â–‘ â–‘ â–‘ â–‘ â–’ â–‘ â–‘â–’ â–’â–‘ * â–‘ â–‘ â–‘â–‘â–‘ â–‘ â–‘ â–‘ â–‘ â–‘â–‘ â–‘ * â–‘ â–‘ â–‘ â–‘ â–‘ */ å“­è„¸ç¥žå…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â” * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚ * â”‚ â”€â”¬â”˜ â””â”¬â”€ â”‚ * â”‚ â”‚ * â”‚ â”€â”´â”€ â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ * ç¥žå…½ä¿ä½‘ * ä»£ç æ— BUG! */ å®³ç¾žç¥žå…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â” * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚ * â”‚ &gt; &lt; â”‚ * â”‚ â”‚ * â”‚ ... âŒ’ ... â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ * ç¥žå…½ä¿ä½‘ * ä»£ç æ— BUG! */ å¢¨é•œç¥žå…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” + + * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â”++ * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚++ + + + * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚+ * â”‚ â”‚+ * â”‚ â”€â”´â”€ â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ + + * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ + + + + * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ + + + + * ç¥žå…½ä¿ä½‘ * ä»£ç æ— BUG! */ è™è  123456789101112131415161718192021/*** * ___====-_ _-====___ * _--^^^###// \\###^^^--_ * _-^#####// ( ) \\#####^-_ * -######// |\^^/| \\######- * _/######// (@::@) \\######\_ * /#######(( \\// ))#######\ * -########\\ (oo) //########- * -#########\\ / VV \ //#########- * -##########\\/ \//##########- * _#/|#####/\###( /\ )###/\#####|\#_ * |/ |#/\#/\#/\/ \#/\#\ | | /#/\#/ \/\#/\#/\#| \| * ` |/ V V ` V \#\| | | |/#/ V ' V V \| ' * ` ` ` ` / | | | | \ ' ' ' ' * ( | | | | ) * __\ | | | | /__ * (vvv(VVV)(VVV)vvv) * ç¥žå…½ä¿ä½‘ * ä»£ç æ— BUG! */ é£žå¤©é¾™ 123456789101112131415161718192021222324/*** * * * __----~~~~~~~~~~~------___ * . . ~~//====...... __--~ ~~ * -. \_|// |||\\ ~~~~~~::::... /~ * ___-==_ _-~o~ \/ ||| \\ _/~~- * __---~~~.==~||\=_ -_--~/_-~|- |\\ \\ _/~ * _-~~ .=~ | \\-_ '-~7 /- / || \ / * .~ .~ | \\ -_ / /- / || \ / * / ____ / | \\ ~-_/ /|- _/ .|| \ / * |~~ ~~|--~~~~--_ \ ~==-/ | \~--===~~ .\ * ' ~-| /| |-~\~~ __--~~ * |-~~-_/ | | ~\_ _-~ /\ * / \ \__ \/~ \__ * _--~ _/ | .-~~____--~-/ ~~==. * ((-&gt;/~ '.|||' -_| ~~-/ , . _|| * -_ ~\ ~~---l__i__i__i--~~_/ * _-~-__ ~) \--______________--~~ * //.-~~~-~_--~- |-------~~~~~~~~ * //.-~~~--\ * ç¥žå…½ä¿ä½‘ * ä»£ç æ— BUG! */ çŒª 123456789101112131415/*** _ * _._ _..._ .-', _.._(`)) * '-. ` ' /-._.-' ',/ * ) \ '. * / _ _ | \ * | a a / | * \ .-. ; * '-('' ).-' ,' ; * '-; | .' * \ \ / * | 7 .__ _.-\ \ * | | | ``/ /` / * /,_| | /,_/ / * /,_/ '`-' */ éª·é«…å¤´ 123456789101112131415161718192021222324/*** ************************************************************** * * * .=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-. * * | ______ | * * | .-" "-. | * * | / \ | * * | _ | | _ | * * | ( \ |, .-. .-. ,| / ) | * * | &gt; "=._ | )(__/ \__)( | _.=" &lt; | * * | (_/"=._"=._ |/ /\ \| _.="_.="\_) | * * | "=._"(_ ^^ _)"_.=" | * * | "=\__|IIIIII|__/=" | * * | _.="| \IIIIII/ |"=._ | * * | _ _.="_.="\ /"=._"=._ _ | * * | ( \_.="_.=" `--------` "=._"=._/ ) | * * | &gt; _.=" "=._ &lt; | * * | (_/ \_) | * * | | * * '-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=' * * * * LASCIATE OGNI SPERANZA, VOI CH'ENTRATE * ************************************************************** */ å¦ˆå¦ˆå†çˆ±æˆ‘ä¸€æ¬¡ 123456789101112131415161718192021222324252627282930313233/*** * ,s555SB@@&amp; * :9H##@@@@@Xi * 1@@@@@@@@@@@@@@8 * ,8@@@@@@@@@B@@@@@@8 * :B@@@@X3hi8Bs;B@@@@@Ah, * ,8i r@@@B: 1S ,M@@@@@@#8; * 1AB35.i: X@@8 . SGhr ,A@@@@@@@@S * 1@h31MX8 18Hhh3i .i3r ,A@@@@@@@@@5 * ;@&amp;i,58r5 rGSS: :B@@@@@@@@@@A * 1#i . 9i hX. .: .5@@@@@@@@@@@1 * sG1, ,G53s. 9#Xi;hS5 3B@@@@@@@B1 * .h8h.,A@@@MXSs, #@H1: 3ssSSX@1 * s ,@@@@@@@@@@@@Xhi, r#@@X1s9M8 .GA981 * ,. rS8H#@@@@@@@@@@#HG51;. .h31i;9@r .8@@@@BS;i; * .19AXXXAB@@@@@@@@@@@@@@#MHXG893hrX#XGGXM@@@@@@@@@@MS * s@@MM@@@hsX#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&amp;, * :GB@#3G@@Brs ,1GM@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@B, * .hM@@@#@@#MX 51 r;iSGAM@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@8 * :3B@@@@@@@@@@@&amp;9@h :Gs .;sSXH@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@: * s&amp;HA#@@@@@@@@@@@@@@M89A;.8S. ,r3@@@@@@@@@@@@@@@@@@@@@@@@@@@r * ,13B@@@@@@@@@@@@@@@@@@@5 5B3 ;. ;@@@@@@@@@@@@@@@@@@@@@@@@@@@i * 5#@@#&amp;@@@@@@@@@@@@@@@@@@9 .39: ;@@@@@@@@@@@@@@@@@@@@@@@@@@@; * 9@@@X:MM@@@@@@@@@@@@@@@#; ;31. H@@@@@@@@@@@@@@@@@@@@@@@@@@: * SH#@B9.rM@@@@@@@@@@@@@B :. 3@@@@@@@@@@@@@@@@@@@@@@@@@@5 * ,:. 9@@@@@@@@@@@#HB5 .M@@@@@@@@@@@@@@@@@@@@@@@@@B * ,ssirhSM@&amp;1;i19911i,. s@@@@@@@@@@@@@@@@@@@@@@@@@@S * ,,,rHAri1h1rh&amp;@#353Sh: 8@@@@@@@@@@@@@@@@@@@@@@@@@#: * .A3hH@#5S553&amp;@@#h i:i9S #@@@@@@@@@@@@@@@@@@@@@@@@@A. * * * åˆçœ‹æºç ï¼Œçœ‹ä½ å¦¹å¦¹å‘€ï¼ */ åˆéŸ³ 12345678910111213141516171819202122232425/*** *_______________#####_______________________ *______________######_____________________ *______________#######____________________ *_____________#__######___________________ *____________##__###_###__________________ *____________##_####___##_________________ *___________##__#####_##________________ *__________##__######_##_______________ *________###___######__###_____________ *_______###___##_####___###___________ *_______###___##___####___###_________ *______###___##__######___###_______ *_____###___##_#######__###______ *____####__###########_####_____ *____####__###############____ *___####__###_#########_####___ *___####__###_###_#####___###___ *___####____#__###___###_____###___ *___####________###____###_____###____ *____###________###_____###_____##_____ *_____###________##______###_____##______ *______###______;##________##______#________ *________#_______##________##______________ */ æ”»åŸŽæ¹¿ 123456789101112131415161718192021/*** * ,%%%%%%%%, * ,%%/\%%%%/\%% * ,%%%\c "" J/%%% * %. %%%%/ o o \%%% * `%%. %%%% _ |%%% * `%% `%%%%(__Y__)%%' * // ;%%%%`\-/%%%' * (( / `%%%%%%%' * \\ .' | * \\ / \ | | * \\/ ) | | * \ /_ | |__ * (___________))))))) æ”»åŸŽæ¹¿ * * _ _ * __ _(_)_ _(_) __ _ _ __ * \ \ / / \ \ / / |/ _` |'_ \ * \ V /| |\ V /| | (_| | | | | * \_/ |_| \_/ |_|\__,_|_| |_| */ æŽ˜é‡‘ 1234567891011121314151617181920212223/*** * https://gold.xitu.io/ * ï¼‘ï¼‘ï¼‘ ï¼‘ * ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ */ çŸ¥ä¹Ž 123456789101112131415161718192021222324/*** * https://www.zhihu.com/ * _____ _____ _____ _____ * /\ \ /\ \ /\ \ /\ \ * /::\____\ /::\ \ /::\ \ /::\ \ * /:::/ / \:::\ \ /::::\ \ /::::\ \ * /:::/ / \:::\ \ /::::::\ \ /::::::\ \ * /:::/ / \:::\ \ /:::/\:::\ \ /:::/\:::\ \ * /:::/____/ \:::\ \ /:::/__\:::\ \ /:::/__\:::\ \ * /::::\ \ /::::\ \ /::::\ \:::\ \ /::::\ \:::\ \ * /::::::\ \ _____ ____ /::::::\ \ /::::::\ \:::\ \ /::::::\ \:::\ \ * /:::/\:::\ \ /\ \ /\ \ /:::/\:::\ \ /:::/\:::\ \:::\____\ /:::/\:::\ \:::\ \ * /:::/ \:::\ /::\____\/::\ \/:::/ \:::\____\/:::/ \:::\ \:::| |/:::/__\:::\ \:::\____\ * \::/ \:::\ /:::/ /\:::\ /:::/ \::/ /\::/ |::::\ /:::|____|\:::\ \:::\ \::/ / * \/____/ \:::\/:::/ / \:::\/:::/ / \/____/ \/____|:::::\/:::/ / \:::\ \:::\ \/____/ * \::::::/ / \::::::/ / |:::::::::/ / \:::\ \:::\ \ * \::::/ / \::::/____/ |::|\::::/ / \:::\ \:::\____\ * /:::/ / \:::\ \ |::| \::/____/ \:::\ \::/ / * /:::/ / \:::\ \ |::| ~| \:::\ \/____/ * /:::/ / \:::\ \ |::| | \:::\ \ * /:::/ / \:::\____\ \::| | \:::\____\ * \::/ / \::/ / \:| | \::/ / * \/____/ \/____/ \|___| \/____/ */ freebuf 1234567891011121314151617181920212223242526272829/*** * http://www.freebuf.com/ * _.._ ,------------. * ,' `. ( We want you! ) * / __) __` \ `-,----------' * ( (`-`(-') ) _.-' * /) \ = / ( * /' |--' . \ * ( ,---| `-.)__` * )( `-.,--' _`-. * '/,' ( Uu", * (_ , `/,-' ) * `.__, : `-'/ /`--' * | `--' | * ` `-._ / * \ ( * /\ . \. freebuf * / |` \ ,-\ * / \| .) / \ * ( ,'|\ ,' : * | \,`.`--"/ &#125; * `,' \ |,' / * / "-._ `-/ | * "-. "-.,'| ; * / _/["---'""] * : / |"- ' * ' | / * ` | */ Alibaba 12345678910111213141516171819202122232425262728293031323334353637/*** * https://campus.alibaba.com/ * `:::::::::::, * `::;:::::::;:::::::, ` * `::;;:::::::@@@@;:::::::` * ,:::::::::::::@ #@':::::` * :::::::::::::::'@@ @;:::: * ::::::::::::'@@@@'``` .+:::` * ::::::::::;@@@#. ,:::, * .::::::::+@#@` :::: * :::::::+@@' :::: * `:::::'@@: `:::. * ,::::@@: ` :::: * ;::::::@ .:::; * :;:::::;@` ` :::; * :::::::::@` @ ;:::: * :::::::::#` @` ,:::: * :::::::::@` +@ @ .::::` * .::::::'@@` `@@' @ ::::, * :::::::++@@@@@@@@@@. ::::; * ;:::::::+, `..` ::::: * ,::::::::', ::::: * :::::::::+, :::::` * :::::::::+@. ,::::.` `, * ::::::;;@+ .::;:: `; * :::::::@@ `:::;: `::`` * ::::::#@ ;:::: .::` * :::::;@ :::::` .;::` * :::::@ `:;::: `::::; * :::::# :::::. `,;::::: * :::::: ` ::::::,.,::::::::::. * ,::::::` .:: ::::::::::::::::;` * ;::::::::,````.,:::::, ::::::::::::::. * :::::::::::::::::: ` `::::::::::` * `::::::::::::, .:::. * `..` */ å°è€é¼  123456789101112131415/*** * http://www.flvcd.com/ * .--, .--, * ( ( \.---./ ) ) * '.__/o o\__.' * &#123;= ^ =&#125; * &gt; - &lt; * / \ * // \\ * //| . |\\ * "'\ /'"_.-~^`'-. * \ _ /--' ` * ___)( )(___ * (((__) (__))) é«˜å±±ä»°æ­¢,æ™¯è¡Œè¡Œæ­¢.è™½ä¸èƒ½è‡³,å¿ƒå‘å¾€ä¹‹ã€‚ */ é¡¶ 12345678910111213141516/*** * é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚é ‚é ‚é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚ é ‚é ‚ * é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚ */ å•èº«ç‹—çš„å‡è§† 123456789101112131415/*** * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–‘â–‘ * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–€â–’â–Œâ–‘ * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–€â–’â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–€â–’â–’â–’â– * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–„â–€â–’â–’â–€â–€â–€â–€â–„â–„â–„â–€â–’â–’â–’â–’â–’â– * â–‘â–‘â–‘â–‘â–‘â–„â–„â–€â–’â–‘â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–’â–’â–„â–ˆâ–’â– * â–‘â–‘â–‘â–„â–€â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–€â–ˆâ–ˆâ–€â–’â–Œ * â–‘â–‘â–â–’â–’â–’â–„â–„â–’â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–’â–’â–’â–’â–€â–„â–’â–’ * â–‘â–‘â–Œâ–‘â–‘â–Œâ–ˆâ–€â–’â–’â–’â–’â–’â–„â–€â–ˆâ–„â–’â–’â–’â–’â–’â–’â–’â–ˆâ–’â– * â–‘â–â–‘â–‘â–‘â–’â–’â–’â–’â–’â–’â–’â–’â–Œâ–ˆâ–ˆâ–€â–’â–’â–‘â–‘â–‘â–’â–’â–’â–€â–„ * â–‘â–Œâ–‘â–’â–„â–ˆâ–ˆâ–„â–’â–’â–’â–’â–’â–’â–’â–’â–’â–‘â–‘â–‘â–‘â–‘â–‘â–’â–’â–’â–’ * â–€â–’â–€â–â–„â–ˆâ–„â–ˆâ–Œâ–„â–‘â–€â–’â–’â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–’â–’â–’ * å•èº«ç‹—å°±è¿™æ ·é»˜é»˜åœ°çœ‹ç€ä½ ï¼Œä¸€å¥è¯ä¹Ÿä¸è¯´ã€‚ */ åŸƒåŠæ³•è€ 1234567891011121314151617181920212223242526272829303132333435/*** * /88888888888888888888888888\ * |88888888888888888888888888/ * |~~____~~~~~~~~~"""""""""| * / \_________/"""""""""""""\ * / | \ \ * / | 88 88 \ \ * / | 88 88 \ \ * / / \ | * / | ________ \ | * \ | \______/ / | * /"\ \ \____________ / | * | |__________\_ | | / / * /""""\ \_------' '-------/ -- * \____/,___________\ -------/ * ------* | \ * || | \ * || | ^ \ * || | | \ \ * || | | \ \ * || | | \ \ * \| / /"""\/ / * ------------- | | / * |\--_ \____/___/ * | |\-_ | * | | \_ | * | | \ | * | | \_ | * | | ----___ | * | | \----------| * / | | ----------""\ * /"\--"--_| | | \ * |_______/ \______________/ ) * \___/ */ è€¶ 123456789101112131415161718192021222324252627282930313233343536/*** * d*#$. * zP"""""$e. $" $o * 4$ '$ $" $ * '$ '$ J$ $F * 'b $k $&gt; $ * $k $r J$ d$ * '$ $ $" $~ * '$ "$ '$E $ * $ $L $" $F ... * $. 4B $ $$$*"""*b * '$ $. $$ $$ $F * "$ R$ $F $" $ * $k ?$ u* dF .$ * ^$. $$" z$ u$$$$e * #$b $E.dW@e$" ?$ * #$ .o$$# d$$$$c ?F * $ .d$$#" . zo$&gt; #$r .uF * $L .u$*" $&amp;$$$k .$$d$$F * $$" ""^"$$$P"$P9$ * JP .o$$$$u:$P $$ * $ ..ue$" "" $" * d$ $F $ * $$ ....udE 4B * #$ """"` $r @$ * ^$L '$ $F * RN 4N $ * *$b d$ * $$k $F * $$b $F * $"" $F * '$ $ * $L $ * '$ $ * $ $ */ å°å¼ç”µè„‘ 1234567891011121314151617181920/*** * ,----------------, ,---------, * ,-----------------------, ," ,"| * ," ,"| ," ," | * +-----------------------+ | ," ," | * | .-----------------. | | +---------+ | * | | | | | | -==----'| | * | | I LOVE DOS! | | | | | | * | | Bad command or | | |/----|`---= | | * | | C:\&gt;_ | | | ,/|==== ooo | ; * | | | | | // |(((( [33]| ," * | `-----------------' |," .;'| |(((( | ," * +-----------------------+ ;; | | |," * /_)______________(_/ //' | +---------+ * ___________________________/___ `, * / oooooooooooooooo .o. oooo /, \,"----------- * / ==ooooooooooooooo==.o. ooo= // ,`\--&#123;)B ," * /_==__==========__==_ooo__ooo=_/' /___________," * */ ä¹¦æœ¬ 123456789101112/*** * .-~~~~~~~~~-._ _.-~~~~~~~~~-. * __.' ~. .~ `.__ * .'// \./ \\`. * .'// | \\`. * .'// .-~"""""""~~~~-._ | _,-~~~~"""""""~-. \\`. * .'//.-" `-. | .-' "-.\\`. * .'//______.============-.. \ | / ..-============.______\\`. * .'______________________________\|/______________________________`. * */ äººç”Ÿ 12345678910111213141516171819202122/** * å‡ºç”Ÿ * || * || * \ / * \/ * é’å¹´ * ï¼ˆå¹´é¾„ = rand(20,25))ï¼‰ ã€Š============== * || || * || || * || ç¥ç¦æ‰€æœ‰å¼€å‘å·¥ä½œè€… || * || æ°¸è¿œå¹´è½» || * || || * \ / || * \/ || *ï¼ˆ 20 &lt;= å¹´é¾„ &lt;= 25ï¼‰ =============== * || * || * \ / * \/ * ç­‰æ­»çŠ¶æ€ */ æ¯”å…‹å¤§é­”çŽ‹ 12345678910111213141516171819202122232425/* _.---..._ ./^ ^-._ ./^C===. ^\. /\ .|' \\ _ ^|.^.| ___.--'_ ( ) . ./ /|| /.---^T\ , | / /||| C' ._`| ._ / __,-/ / /-,|| \ \/ ; /O / _ |) )|, i \./^O\./_,-^/^ ,;-^,' \ |`--/ ..-^^ |_-^ `| \^- /|: i. .-- / '|. i ==' /' |\._ _./`._ // |. ^-ooo.._ _.oo../' | ^-.__./X/ . `| |####b d## |' ^^^^ / | _\#### ###b ^^^^^^^^--. ...--^--^^^^^^^_.d### ###b._ Y _.d##### #####b._ | _.d####### "Piccolo" no. 2 (from Dragonball Z) --- Steven J. Simmons */ Fuck you 123456789101112131415161718192021/* * .::::. * .::::::::. * ::::::::::: FUCK YOU * ..:::::::::::' * '::::::::::::' * .:::::::::: * '::::::::::::::.. * ..::::::::::::. * ``:::::::::::::::: * ::::``:::::::::' .:::. * ::::' ':::::' .::::::::. * .::::' :::: .:::::::'::::. * .:::' ::::: .:::::::::' ':::::. * .::' :::::.:::::::::' ':::::. * .::' ::::::::::::::' ``::::. * ...::: ::::::::::::' ``::. * ```` ':. ':::::::::' ::::.. * '.:::::' ':'````.. */ å›´æ£‹ 12345678910111213141516171819202122232425262728293031323334 // _______________________________________ // / ___________________________________ \// _--""""--_ / /_/_/_/_/_|_|_|_|_|_|_|_|_|_\_\_\_\_\ \// / \ / /_/_/_/_J__L_L_L_|_|_|_J_J_J__L_\_\_\_\ \// /\ /\ / /_/_/_J__L_J__L_L_|_|_|_J_J__L_J__L_\_\_\ \// L ""-____-"" J / /_/_J__L_J__L_J_J__L_|_J__L_L_J__L_J__L_\_\ \// \ / / /_/__L_/__L_J__L_J__L_|_J__L_J__L_J__\_J__\_\ \// \_ _/ / /_J__/_J__/__L_J__|__L_|_J__|__L_J__\__L_\__L_\ \// _--"""""--_" / / F / F J J | F J | F J | F F J \ J \ \// / \ / /--/-J--/--L--|--L-J--J--|--L--L-J--|--J--\--L-\--\ \///\ /\ / /__/__L_J__J___L_J__J__|__|__|__L__L_J___L__L_J__\__\ \//L ""-_____-"" J / / / / F F J J | | | | | F F J J \ \ \ \//\ / / /--/--/--/--J---L--|--|--|--o--|--|--|--J---L--\--\--\--\ \// \_ _/ / /__/__J__J___L__J___L__L__L__|__J__J__J___L__J___L__L__\__\ \// "--___--" / / / F F J F J J F | J F F J F J J \ \ \// / /--/---/--J---L--J---L--|--J---|---L--|--J---L--J---L--\---\--\ \// / /__J___/___L__/___L__J___L__J___|___L__J___L__J___\__J___\___L__\ \// / / F J / J J | J J | F F | F F \ F J \ \// / /---/---L--J---L---L---L--|---|---|---|---|--J---J---J---L--J---\---\ \// / /___/___/___L__J___J___J___|___|___|___|___|___L___L___L__J___\___\___\ \// / / / / / F F F F F | J J J J J \ \ \ \ \// / /___/___J___J___J___J___J____L___L___|___J___J____L___L___L___L___L___\___\ \// / / / F F F | | J F | J F | | J J J \ \ \// / /___J____/___/___J____L___L___|___J____|____L___|___J___J____L___\___\____L___\ \// / / F / J F J J | J | F | F F J F \ J \ \// / /____/___J____L___/____L___|____L___|____|____|___J____|___J____\___J____L___\____\ \// / / / F / J J F J F | J F J F F \ J \ \ \// / /____/____/___J____L____|____L___J____L____|____J____L___J____|____J____L___\____\____\ \// / \///_______________________________________________________________________________________________\//| |//| hs |//|_______________________________________________________________________________________________| å±…ä¸­çš„ä½›ç¥– 1234567891011121314151617181920212223/* _ooOoo_ o8888888o 88" . "88 (| -_- |) O\ = /O ____/`---'\____ .' \\| |// `. / \\||| : |||// \ / _||||| -:- |||||- \ | | \\\ - /// | | | \_| ''\---/'' | | \ .-\__ `-` ___/-. / ___`. .' /--.--\ `. . __ ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". | | : `- \`.;`\ _ /`;.`/ - ` : | | \ \ `-. \_ __\ /__ _/ .-` / /======`-.____`-.___\_____/___.-`____.-'====== `=---='^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ä½›ç¥–ä¿ä½‘ æ°¸æ— BUG*/ windowså›¾æ ‡ 123456789101112131415161718/* __ ,-~Â¨^ ^Â¨-, _, / / ;^-._...,Â¨/ / / / / / / / / / / / / /,.-:''-,_ / / / _,.-:--._ ^ ^:-._ __../ /^ / /Â¨:.._Â¨__.; / / / ^ / / / / / / / / / /_,.--:^-._/ / /^ ^Â¨Â¨-.___.:^ (R) - G33K */ ä¸ƒé¾™ç æ¯”å…‹ 1234567891011121314151617181920212223242526/* /^_.-^ _ --^=_ ./'-^__ _&gt;=\^^==^-. |'/^^_/ /^ \ \.^\\\/\ ,|/| ' /' _____\ `\|.^.| |'/ /_--^^ . ^^-./ /|| |/,--^ , | / /||' ._|/ \ / __,-/ / /-,|| \ '/ ; /O / _ |) )|, i \./^O\./_,-^/^ ,;-^,' \ |`--/ ..-^^ |_-^ `| \^-_,/^Y\ | ^^\ _i. \".--V_/ /| \. ^\._____...--.&gt;^^^^^^-------...._ / i ^--^^ /'|' |\. |./' | ;___...----/^^^^---|. `._\ /^ /' |'_/' \ `| |' ,/' |' \ _|^-.__./'__.^^\ .| ,| _.-^ `\ ,|`_./^^-----^^._ ` ./ / /^ _.-^^/ |' ^ /-^ ./^ /\ `\_ __.-&lt; _,/ ./' |' `\. `i ^^--/._____...--^ . ./ |. `| | / / `| "Piccolo" (from Dragonball Z) --- Steven J. Simmons */ ä¸ƒé¾™ç æ‚Ÿç©º 123456789101112131415161718192021222324252627282930313233/* _ \"-._ _.--"~~"--._ \ " ^. ___ / \.-~_.-~ .-----' /\/"\ /~-._ / / __ _/\-.__\L_.-/\ "-. /.-" \ ( ` \_o&gt;"&lt;o_/ \ .--._\ /' \ \: " :/_/ "` / /\ "\ ~ /~" \ I \/]"-._ _.-"[ ___ \|___/ ./ l \___ ___ .--v~ "v` ( `-.__ __.-' ) ~v" ~v--. .-&#123; | : \_ "~" _/ : | &#125;-. / \ | ~-.,___,.-~ | / \ ] \ | | / [ /\ \| : : |/ /\ / ^._ _K.___,^ ^.___,K_ _.^ \ / / "~/ "\ /" \~" \ \ / / / \ _ : _ / \ \ \ .^--./ / Y___________l___________Y \ \.--^. [ \ / | [/ ] | \ / ] | "v" l________[____/]________j -Row &#125;r" / &#125;------t / \ /`-. / | | Y Y / "-._/ &#125;-----v' | : | 7-. / | |_| | l | / . "-._/ l .[_] : \ : r[]/_. / \_____] "--. "-.____/ "Dragonball Z" ---Row */ è¶…çº§èµ›äºšäºº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134/* MMMMM MMMMMM MMMMMMM MMMMMMMM . MMMMMMMMM HMMMMMMMMMM MMMMMMMMMMMM M MMMMMMMMMMMMM M MMMMMMMMMMMMM M MMMMMMMMMMMMM: oMMMMMMMMMMMMMM .MMMMMMMMMMMMMMo MMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMM. oMMMMMMMMMMMMMMM.M MMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM oMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM: H MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM . MMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMM .MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMMMMMM MM. MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM .MMMMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM .MMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMM.MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM HMMMMMMMMMMMMMMMMMMMMM.MMMMMMMMM.MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM MMM.oMMMMMMM..MMMMMMMMM:MMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMM MM..MMMMMMM...MMMMMMM. MMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM ..MMMMMM...MMMMMM ..MMMMMMMMMMMMMMMMMMM MMMMMMM:M.MMM.M.. MMMMM M..MMMMM...MMMMMMMMMMMMMMMMMM MMM MMMM. .M..MM.M...MMMMMM..MMMMM.. MMMMMMMMMMMMMMMMMMMMMMMMMMMMMM . MMMM..M....M.....:MMM .MMMMMM..MMMMMMM...MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMM.M.. ...M......MM.MMMMM.......MHM.M .MMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMM..MM. . MMM.....MMMMMM.M.....M ..MM..M MMMMMMMMMMMMMMMMMMM .MMMMMHMM. ..MMMM. MMM............o..... . .MMMMMMMMMMMMMMM MMM. M... .........................M..:.MMMMMMMMMMMM oMMM............ .................M.M.MMMMMMMMM .....MM........................ . MMMMMM M.....M.....................o.MM.MMMMMMMM. M........................M.. ...MMMMMMMMMMMMMo :....MMM..............MMM..oMMMMMMM M...MMM.............MMMMMMM .............:MMMMMMMM M..... MMM.....M M M............. ................M ooM.................MM MoMMMMMoooM MMoooM......................MoooooooH..oMM MHooooMoM.....................MMooooooM........M oooooooMoooM......... o........MoooooooM............ Mooooooooooo.......M.........Moooooooo:..............M MooMoooooooooM...M........:Mooooooooooo:..............M M..oooooooooooo .........Mooooooooooooooo..............M M...Mooo:oooooooo.M....ooooooooooooooooooo..M...........M ...oooooMoooooooM..Mooooooooooooo:oooooooM.M...........M. M...ooooooMoo:ooooMoooooooooooooHoooooooooH:M. ...........: M..MoooooooMoooooooooooooooooo:ooooooMooooMoM..............M M..ooooooooooMooooooooooooooHoooooooMooHooooM...............M ...ooooooooooooooooooo:MooooooooooooooMoMoooM................ M...oooooooooooooooooooooooooooooooooooooMooMM................M ...MooooooooooooooooooooooooooooooooooooooooMo ................ ...MooooooooooooooooooooooooooooooooooooooooM M................M M...ooooooooooooooooooooooooooooooooooooooooM ................M ...MoooooooooooooooooooooooooooooooooooooooMM .:............... .....MooooooooooooooooooooooooooooooooooooMoo .............M M...... ooooooooooooooooooooooooooooooooooooM M..............M M........MooooMMM MM MM MMMMMMMMMooooooooM M...............M .........HM M: MM :MMMMMM M M............... M..........M M MoM M M................M M.........:M MoH M M M MooooHoooMM. M M...............M M..........Moooo MMooM oooooMooooooooM M..............H M.........MooooM Mooo : ooooooMooooMoooM M........ . .o.M H.. .....ooooo oooo M MooooooooooooooM M... MMMMMMMMMMM MMMMMMMMMMooooM M oooo . ooooooMooooooooM .MMMMMMMMMMMMMMM MMMMMMMMMMooooH : ooooH oooooooooooooooo MMMMMMMMMMMMMMM MMMMMMMMMMoooo ooooM Moooooooooooooooo .MMMMMMMMMMMMMMM MMMMMMMMMMoooo ooooM MooooooooooooooooM MMMMMMMMMMMMMMM MMMMMMMMMMoooM ooooM ooooooooooooooooo MMMMMMMMMMM:M MMMMMMMMMMoooM MooooM oooooooooooMoooooo MH........... . ......Mooo. MooooM oooooooooooooooooo M............M M.M......oooo MooooM Moooooooooooooooooo: .........M..... M.M.....Moooo MooooM ooooooooooooooooooM .M............ .......MooooH MooooM oooooooooMoooooooooo M..o...M..o....M .o....HMooooM MooooH MooooooooMooooooooooM .:M...M.......M M..M.....MoooM :oooo: .MooooooooHooMoooooooooM M M... ..oM.M M...M.:.Mooo. MMMMooooo oooooooooooMoooooooooooooM ....M. M M:M..o.Moooooooooooooo MooooooooooooooMooooooooooooM .Mo MooooooooooooooMooooooooooooMoMoooooooooooooo Mooooooooooooooo:ooooooooooooooooooooooooooooo ooooooooooooooooMooooooooooMoooooooooooooooooo ooooooooooooooooMoooooooooooMooooooooooooooooHo ooMooooooooooooooMoooooooooooooooooooooooooooMoM MooMoooooooooooooo.ooooooooooooooooooooooooooo:oM MoooooooooooooooooooooooooooooooooooooooooooooooM MoooMooooooooooooooMooooooooooooooooooooooooooooo. MoooMooooooooooooooMoooooooooooooooooooooooooMooooM MooooooooooooooooooMoooooooooooooooooooooooooMoooooM MooooMoooooooooooooMoooooooooooooooooooooooooMoHooooM ooooooMooooooooooooooooooooooooooooooooooooooooMoMoooM MooooooooooooooooooooMooooooooooooooooooooooooooMoooooH: MoooooooMooooooooooooMoooooooooooooooooooooooooooooHoooM MooooooooMoooooooooooMoooooooooooooooooooooooooMoooMooooM Moooooooooooooooooooooooooooooooooooooooooooooo.oooMooooo MoooooooooooooooooooooooooooooooooooooooooooooMoooooooooM MooooooooooooooooooooMoooooooooooooooooooooooooooooooooM MooooooooooooooooooooMHooooooooooooooooooooMoooo:ooooo MMooooooooooooooooooMoMHoooooooooooooooooooooooMooooo MMoooooooooooooooMMooo MMooooooooooooooooooooooooooM MMMoooooooooooooMooooo oooooooooooooooooooooMooooo MooMMoooooooooMoooMMoM ooooHooooooooooooooooMooooM MooooMooooooMooooMoooM MoooooMoooooooooooooMooooo ooooooMMooooooooMooooM MoooooooooMooooooooooooooM HooooooMoooooooMooooM HoooooooHooMooooooooooooo oooMoooooooooHoooM MoooooooooMoooooooooM HooooooooooooHM MooooooooMMoooooooM MMMMMMMMMMMMMM Moooooo:MooooHMM MMMMMMM: ... MMMMMMMMMMMMMM M............M MMMMMMMMM .... M.MM.......... M.............M M ..............MM M.............. MMMMM............MMMM ..MMMMMMMM ....M MMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMM...M .MMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMM :MMMMMMMMMMMMMMMMMMH MMMMMMMMMMMMMMMMMMM By EBEN JÃ©rÃ´me MMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM HMMMMMM */ çš®å¡ä¸˜ 123456789101112131415161718192021222324252627282930313233343536373839404142/*quu..__ $$$b `---.__ "$$b `--. ___.---uuudP `$$b `.__.------.__ __.---' $$$$" . "$b -' `-.-' $$$" .'| ". d$" _.' | `. / ..." .' | `./ ..::-' _.' | / .:::-' .-' .' : ::''\ _.' | .' .-. .-. `. .' | : /'$$| .@"$\ `. .' _.-' .'|$u$$| |$$,$$| | &lt; _.-' | `:$$:' :$$$$$: `. `. .-' : `"--' | `-. \ :#. == .##. `. `. `\ |#: :##: | &gt; &gt; |#' `..'`..' `##' x: / / \ xXX| / ./ \ xXXX'| / ./ /`-. `. / / : `- ..........., | / .' | ``:::::::' . |&lt; `. | ``` | x| \ `.:``. | .' /' xXX| `:`M`M':. | | ; /:' xXXX'| -'MMMMM:' `. .' : /:' |-'MMMM.-' | | .' /' .'MMM.-' `'`' : ,' |MMM&lt; | `' |tbap\ \ :MM.-' \ | .'' \. `. / / .:::::::.. : / | .:::::::::::`. / | .:::------------\ / / .'' &gt;::' / `',: : .' `:.:' */]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxåº”ç”¨åœºæ™¯]]></title>
    <url>%2Fposts%2Fcd76424b.html</url>
    <content type="text"><![CDATA[åå‘ä»£ç† åå‘ä»£ç†ï¼šç®€å•æ¥è¯´å°±æ˜¯çœŸå®žçš„æœåŠ¡å™¨ä¸èƒ½ç›´æŽ¥è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œæ‰€ä»¥éœ€è¦ä¸€å°ä»£ç†æœåŠ¡å™¨ï¼Œè€Œä»£ç†æœåŠ¡å™¨èƒ½è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®çš„åŒæ—¶åˆè·ŸçœŸå®žæœåŠ¡å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œçŽ¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œç«¯å£ä¸åŒè€Œå·²ã€‚ ä¸‹é¢è´´ä¸Šä¸€æ®µç®€å•çš„å®žçŽ°åå‘ä»£ç†çš„ä»£ç ï¼š 123456789server &#123; listen 80; server_name localhost; client_max_body_size 1024M; location / &#123; proxy_pass http://localhost:8080; proxy_set_header Host $host:$server_port; &#125;&#125; ä¿å­˜é…ç½®æ–‡ä»¶åŽå¯åŠ¨Nginxï¼Œè¿™æ ·å½“æˆ‘ä»¬è®¿é—®localhostçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºŽè®¿é—® localhost:8080 äº†ã€‚ è´Ÿè½½å‡è¡¡ è´Ÿè½½å‡è¡¡å…¶æ„æ€å°±æ˜¯åˆ†æ‘Šåˆ°å¤šä¸ªæ“ä½œå•å…ƒä¸Šè¿›è¡Œæ‰§è¡Œï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ã€FTPæœåŠ¡å™¨ã€ä¼ä¸šå…³é”®åº”ç”¨æœåŠ¡å™¨å’Œå…¶ä»–å…³é”®ä»»åŠ¡æœåŠ¡å™¨ç­‰ï¼Œä»Žè€Œå…±åŒå®Œæˆå·¥ä½œä»»åŠ¡ã€‚ ç®€å•è€Œè¨€å°±æ˜¯å½“æœ‰2å°æˆ–ä»¥ä¸ŠæœåŠ¡å™¨æ—¶ï¼Œæ ¹æ®è§„åˆ™éšæœºçš„å°†è¯·æ±‚åˆ†å‘åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸€èˆ¬éƒ½éœ€è¦åŒæ—¶é…ç½®åå‘ä»£ç†ï¼Œé€šè¿‡åå‘ä»£ç†è·³è½¬åˆ°è´Ÿè½½å‡è¡¡ã€‚è€ŒNginxç›®å‰æ”¯æŒè‡ªå¸¦3ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿˜æœ‰2ç§å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ç­–ç•¥ã€‚ RR(é»˜è®¤) æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åŽç«¯æœåŠ¡å™¨ï¼Œå¦‚æžœåŽç«¯æœåŠ¡å™¨downæŽ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ 12345678910111213upstream test &#123; server localhost:8080; server localhost:8081; &#125; server &#123; listen 81; server_name localhost; client_max_body_size 1024M; location / &#123; proxy_pass http://test; proxy_set_header Host $host:$server_port; &#125; &#125; è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç : 1234upstream test &#123; server localhost:8080; server localhost:8081; &#125; æƒé‡ æŒ‡å®šè½®è¯¢å‡ çŽ‡ï¼Œweightå’Œè®¿é—®æ¯”çŽ‡æˆæ­£æ¯”ï¼Œç”¨äºŽåŽç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚ 1234upstream test &#123; server localhost:8080 weight=9; server localhost:8081 weight=1; &#125; é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰1æ¬¡ä¼šè®¿é—®åˆ°8081ï¼Œè€Œæœ‰9æ¬¡ä¼šè®¿é—®åˆ°8080ã€‚ ip_hashï¼ˆsessionä¿æŒï¼‰ ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™(é‡‡ç”¨äº†sessionä¿å­˜æ•°æ®)ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†sessionä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨iphashäº†ï¼Œiphashçš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æžœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ 12345upstream test &#123; ip_hash; server localhost:8080; server localhost:8081; &#125; fair(ç¬¬ä¸‰æ–¹) æŒ‰åŽç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ 12345upstream backend &#123; fair; server localhost:8080; server localhost:8081;&#125; url_hash(ç¬¬ä¸‰æ–¹) æŒ‰è®¿é—®urlçš„hashç»“æžœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåŽç«¯æœåŠ¡å™¨ï¼ŒåŽç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³• 123456upstream backend &#123; hash $request_uri; hash_method crc32; server localhost:8080; server localhost:8081; &#125; HTTPæœåŠ¡å™¨ Nginxæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé™æ€èµ„æºçš„æœåŠ¡å™¨ï¼Œå½“åªæœ‰é™æ€èµ„æºçš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨Nginxæ¥åšæœåŠ¡å™¨ï¼ŒåŒæ—¶çŽ°åœ¨ä¹Ÿå¾ˆæµè¡ŒåŠ¨é™åˆ†ç¦»ï¼Œå°±å¯ä»¥é€šè¿‡Nginxæ¥å®žçŽ°ï¼Œé¦–å…ˆçœ‹çœ‹Nginxåšé™æ€èµ„æºæœåŠ¡å™¨ã€‚ 123456789server &#123; listen 80; server_name localhost; client_max_body_size 1024M; location / &#123; root E:/wwwroot; index index.html; &#125; &#125; è¿™æ ·å¦‚æžœè®¿é—®å°±ä¼šé»˜è®¤è®¿é—®åˆ°Eç›˜wwwrootç›®å½•ä¸‹é¢çš„index.htmlï¼Œå¦‚æžœä¸€ä¸ªç½‘ç«™åªæ˜¯é™æ€é¡µé¢çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®žçŽ°éƒ¨ç½²ã€‚ åŠ¨é™åˆ†ç¦» åŠ¨é™åˆ†ç¦»æ˜¯è®©åŠ¨æ€ç½‘ç«™é‡Œçš„åŠ¨æ€ç½‘é¡µæ ¹æ®ä¸€å®šè§„åˆ™æŠŠä¸å˜çš„èµ„æºå’Œç»å¸¸å˜çš„èµ„æºåŒºåˆ†å¼€æ¥ï¼ŒåŠ¨é™èµ„æºåšå¥½äº†æ‹†åˆ†ä»¥åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®é™æ€èµ„æºçš„ç‰¹ç‚¹å°†å…¶åšç¼“å­˜æ“ä½œï¼Œè¿™å°±æ˜¯ç½‘ç«™é™æ€åŒ–å¤„ç†çš„æ ¸å¿ƒæ€è·¯ã€‚ 123456789101112131415161718192021222324upstream test&#123; server localhost:8080; server localhost:8081; &#125; server &#123; listen 80; server_name localhost; location / &#123; root e:/wwwroot; index index.html; &#125; # æ‰€æœ‰é™æ€è¯·æ±‚éƒ½ç”±nginxå¤„ç†ï¼Œå­˜æ”¾ç›®å½•ä¸ºhtml location ~ .(gif|jpg|jpeg|png|bmp|swf|css|js)$ &#123; root e:/wwwroot; &#125; # æ‰€æœ‰åŠ¨æ€è¯·æ±‚éƒ½è½¬å‘ç»™tomcatå¤„ç† location ~ .(jsp|do)$ &#123; proxy_pass http://test; &#125; error_page 500 502 503 504 /50x.html; location = /50x.html &#123; root e:/wwwroot; &#125; &#125; è¿™æ ·å°±å¯ä»¥å°†HTMLä»¥åŠå›¾ç‰‡å’Œcssä»¥åŠjsæ”¾åˆ°wwwrootç›®å½•ä¸‹ï¼Œè€Œtomcatåªè´Ÿè´£å¤„ç†jspå’Œè¯·æ±‚ï¼Œä¾‹å¦‚å½“åŽç¼€ä¸ºgifçš„æ—¶å€™ï¼ŒNginxé»˜è®¤ä¼šä»ŽwwwrootèŽ·å–åˆ°å½“å‰è¯·æ±‚çš„åŠ¨æ€å›¾æ–‡ä»¶è¿”å›žï¼Œå½“ç„¶è¿™é‡Œçš„é™æ€æ–‡ä»¶è·ŸNginxæ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åŽé€šè¿‡åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡é…ç½®è¿‡åŽ»å°±å¥½äº† Nginx é…ç½®æ–‡ä»¶ç»“æž„ 12345678910111213141516171819202122232425... #å…¨å±€å—events &#123; #eventså— ...&#125;http #httpå—&#123; ... #httpå…¨å±€å— server #serverå— &#123; ... #serverå…¨å±€å— location [PATTERN] #locationå— &#123; ... &#125; location [PATTERN] &#123; ... &#125; &#125; server &#123; ... &#125; ... #httpå…¨å±€å—&#125; å…¨å±€å—ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚eventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸Žç”¨æˆ·çš„ç½‘ç»œè¿žæŽ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿žæŽ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡åž‹å¤„ç†è¿žæŽ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æŽ¥å—å¤šä¸ªç½‘è·¯è¿žæŽ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿žæŽ¥åºåˆ—åŒ–ç­‰ã€‚httpå—ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œmime-typeå®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿žæŽ¥è¯·æ±‚æ•°ç­‰ã€‚serverå—ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚locationå—ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚ é™„ä¸Šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½œä¸ºå‚è€ƒç†è§£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556########### æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚##################user administrator administrators; #é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚#worker_processes 2; #å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1#pid /nginx/pid/nginx.pid; #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€error_log log/error.log debug; #åˆ¶å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emergevents &#123; accept_mutex on; #è®¾ç½®ç½‘è·¯è¿žæŽ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤çŽ°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon multi_accept on; #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æŽ¥å—å¤šä¸ªç½‘ç»œè¿žæŽ¥ï¼Œé»˜è®¤ä¸ºoff #use epoll; #äº‹ä»¶é©±åŠ¨æ¨¡åž‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport worker_connections 1024; #æœ€å¤§è¿žæŽ¥æ•°ï¼Œé»˜è®¤ä¸º512&#125;http &#123; include mime.types; #æ–‡ä»¶æ‰©å±•åä¸Žæ–‡ä»¶ç±»åž‹æ˜ å°„è¡¨ default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»åž‹ï¼Œé»˜è®¤ä¸ºtext/plain #access_log off; #å–æ¶ˆæœåŠ¡æ—¥å¿— log_format myFormat &apos;$remote_addrâ€“$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for&apos;; #è‡ªå®šä¹‰æ ¼å¼ access_log log/access.log myFormat; #combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼ sendfile on; #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚ sendfile_max_chunk 100k; #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºŽè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚ keepalive_timeout 65; #è¿žæŽ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚ upstream mysvr &#123; server 127.0.0.1:7878; server 192.168.10.121:3333 backup; #çƒ­å¤‡ &#125; error_page 404 https://www.baidu.com; #é”™è¯¯é¡µ server &#123; keepalive_requests 120; #å•è¿žæŽ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚ listen 4545; #ç›‘å¬ç«¯å£ server_name 127.0.0.1; #ç›‘å¬åœ°å€ location ~*^.+$ &#123; #è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚ #root path; #æ ¹ç›®å½• #index vv.txt; #è®¾ç½®é»˜è®¤é¡µ proxy_pass http://mysvr; #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ deny 127.0.0.1; #æ‹’ç»çš„ip allow 172.18.5.54; #å…è®¸çš„ip &#125; &#125;&#125; ä¸Šé¢æ˜¯nginxçš„åŸºæœ¬é…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š $remote_addr ä¸Ž$http_x_forwarded_for ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›$remote_user ï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›$time_local ï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸Žæ—¶åŒºï¼›$request ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸Žhttpåè®®ï¼›$status ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼›$body_bytes_s ent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›$http_referer ï¼šç”¨æ¥è®°å½•ä»Žé‚£ä¸ªé¡µé¢é“¾æŽ¥è®¿é—®è¿‡æ¥çš„ï¼›$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›æƒŠç¾¤çŽ°è±¡ï¼šä¸€ä¸ªç½‘è·¯è¿žæŽ¥åˆ°æ¥ï¼Œå¤šä¸ªç¡çœ çš„è¿›ç¨‹è¢«åŒæ—¶å«é†’ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½èŽ·å¾—é“¾æŽ¥ï¼Œè¿™æ ·ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šæ€]]></title>
    <url>%2Fposts%2F7b7480f6.html</url>
    <content type="text"><![CDATA[å®šä¹‰ å¯¹äºŽåŒä¸€ä¸ªç±»åž‹çš„ä¸åŒå®žä¾‹å¯¹è±¡ï¼ŒåŒä¸€ä¸ªè¡Œä¸ºå…·å¤‡ä¸åŒçš„è¡¨çŽ°å½¢å¼ã€‚ ä½œç”¨ æ¶ˆé™¤åŒä¸€ç±»åž‹ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼› ä½¿å¾—ä¸åŒå¯¹è±¡å¯¹äºŽåŒä¸€è¡Œä¸ºå…·å¤‡å¤šç§è¡¨çŽ°å½¢å¼ï¼› åŽŸç† å˜é‡çš„é™æ€ç±»åž‹ &amp; åŠ¨æ€ç±»åž‹ å˜é‡çš„é™æ€ç±»åž‹ = å¼•ç”¨ç±»åž‹ = ç¼–è¯‘æ—¶å˜é‡ ï¼šä¸ä¼šè¢«æ”¹å˜ã€åœ¨ç¼–è¯‘å™¨å¯çŸ¥ å˜é‡çš„åŠ¨æ€ç±»åž‹ = å®žä¾‹å¯¹è±¡ç±»åž‹ = è¿è¡Œæ—¶å˜é‡ ï¼šä¼šå˜åŒ–ã€åœ¨è¿è¡ŒæœŸæ‰å¯çŸ¥ å¦‚ä¸‹ç¤ºä¾‹ï¼š 1234567891011121314151617181920public class Test &#123; // Humanæ˜¯ Manä¸ŽHumançš„çˆ¶ç±» static abstract class Human &#123; &#125; static class Man extends Human &#123; &#125; static class Woman extends Human &#123; &#125; // æ‰§è¡Œä»£ç public static void main(String[] args) &#123; Human man = new Man(); // å˜é‡mançš„é™æ€ç±»åž‹ = å¼•ç”¨ç±»åž‹ = ç¼–è¯‘æ—¶å˜é‡ = Humanï¼šä¸ä¼šè¢«æ”¹å˜ã€åœ¨ç¼–è¯‘å™¨å¯çŸ¥ // å˜é‡mançš„åŠ¨æ€ç±»åž‹ = å®žä¾‹å¯¹è±¡ç±»åž‹ = è¿è¡Œæ—¶å˜é‡ = Man ï¼šä¼šå˜åŒ–ã€åœ¨è¿è¡ŒæœŸæ‰å¯çŸ¥ &#125; &#125; å®žçŽ°åŽŸç† é€šè¿‡å°† å­ç±»å¯¹è±¡å®žä¾‹ èµ‹å€¼ç»™ çˆ¶ç±»å¼•ç”¨å˜é‡ï¼Œä½¿å¾—ç¼–è¯‘æ—¶çš„é™æ€å˜é‡ ä¸Ž è¿è¡Œæ—¶çš„åŠ¨æ€å˜é‡ä¸ä¸€æ ·ï¼Œåœ¨è°ƒç”¨æ–¹æ³• / å˜é‡æ—¶ï¼Œå¤šæ€å°±å‘ç”Ÿäº†ã€‚ åº”ç”¨ç¤ºä¾‹ï¼š 123456// è®¾ Bç±»æ˜¯Aç±»çš„å­ç±»A b = new B(); //ç¼–è¯‘æ—¶å˜é‡ = A b ã€è¿è¡Œæ—¶å˜é‡ = new B()b.name; // è°ƒç”¨äº†çˆ¶ç±»Açš„æˆå‘˜å˜é‡name b.move(); // è°ƒç”¨çš„æ˜¯å­ç±»Bé‡å†™åŽçš„2ä¸ªæ–¹æ³•moveï¼ˆï¼‰ã€contentï¼ˆï¼‰b.content(); ç»“è®ºï¼šå› å°† å­ç±»å¯¹è±¡å¼•ç”¨ èµ‹å€¼ç»™ çˆ¶ç±»å¯¹è±¡å˜é‡ï¼Œå³A a = new B()ï¼Œå³ ç¼–è¯‘æ—¶å˜é‡å’Œè¿è¡Œæ—¶å˜é‡ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¤šæ€å‘ç”Ÿ å®žçŽ°è¿‡ç¨‹ï¼ˆç›´æŽ¥æŒ‡é’ˆè®¿é—®ï¼‰ JVM é€šè¿‡ å¼•ç”¨ç±»åž‹ï¼ˆreferenceï¼Œå³Açš„å¼•ç”¨ï¼‰æŸ¥è¯¢Javaæ ˆä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼Œå¾—åˆ°å †ä¸­çš„å¯¹è±¡ç±»åž‹çš„æ•°æ®åœ°å€ï¼› æ ¹æ®åœ°å€ï¼Œä»Žè€Œæ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„å¯¹è±¡ç±»åž‹æ•°æ®ï¼ˆBçš„å¯¹è±¡ç±»åž‹æ•°æ®ï¼‰ï¼› æŸ¥è¯¢å¯¹è±¡ç±»åž‹æ•°æ®ä¸­çš„æ–¹å‘è¡¨å®šä½åˆ°å®žé™…ç±»(Bç±»)çš„æ–¹æ³•ï¼Œä»Žè€Œè¿è¡Œã€‚ å¯¹äºŽA a = new B() æ•°æ®å­˜å‚¨æ–¹å¼ å¯¹äºŽ A aï¼šä½œä¸ºå¼•ç”¨ç±»åž‹æ•°æ®ï¼Œå­˜å‚¨åœ¨JVMæ ˆçš„æœ¬åœ°å˜é‡è¡¨ä¸­ï¼› å¯¹äºŽ new B()ï¼š ä½œä¸ºç¤ºä¾‹å¯¹è±¡æ•°æ®å­˜å‚¨åœ¨å †ä¸­ï¼› Bçš„å¯¹è±¡å®žä¾‹æ•°æ®ï¼ˆæŽ¥å£ã€æ–¹æ³•ã€å¯¹è±¡ç±»åž‹ç­‰ï¼‰çš„åœ°å€å­˜å‚¨åœ¨å †ä¸­ï¼› Bçš„å¯¹è±¡ç±»åž‹æ•°æ®ï¼ˆå¯¹è±¡å®žä¾‹æ•°æ®çš„åœ°å€æ‰€æ‰§è¡Œçš„æ•°æ®ï¼‰å­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œåœ¨æ–¹æ³•åŒºä¸­ï¼Œå¯¹è±¡ç±»åž‹æ•°æ®ä¸­æœ‰1ä¸ªæŒ‡å‘è¯¥ç±»æ–¹æ³•çš„æ–¹å‘è¡¨ï¼› å¼•ç”¨ç±»åž‹è®¿é—®å®žçŽ°æ–¹å¼ Javaç¨‹åºé€šè¿‡ æ ˆä¸Šçš„å¼•ç”¨ç±»åž‹æ•°æ®ï¼ˆreferenceï¼‰ æ¥è®¿é—®Javaå †ä¸Šçš„å¯¹è±¡ã€‚ ç”±äºŽå¼•ç”¨ç±»åž‹æ•°æ®ï¼ˆreferenceï¼‰åœ¨ Javaè™šæ‹Ÿæœºä¸­åªè§„å®šäº†ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ²¡å®šä¹‰è¯¥å¼•ç”¨åº”è¯¥é€šè¿‡ä½•ç§æ–¹å¼åŽ»å®šä½ã€è®¿é—®å †ä¸­çš„å¯¹è±¡çš„å…·ä½“ä½ç½®æ‰€ä»¥å¯¹è±¡è®¿é—®æ–¹å¼ å–å†³äºŽ è™šæ‹Ÿæœºå®žçŽ°ã€‚ç›®å‰ä¸»æµçš„å¯¹è±¡è®¿é—®æ–¹å¼æœ‰ä¸¤ç§ï¼š å¥æŸ„è®¿é—® ç›´æŽ¥æŒ‡é’ˆè®¿é—® å¤šæ€å®žçŽ°æ–¹å¼ æ–¹æ³•é‡è½½(Overload) å®šä¹‰ åŒä¸€ä¸ªç±»ä¸­å…·å¤‡å¤šä¸ªé‡åçš„æ–¹æ³•ã€‚ ç‰¹ç‚¹ æ–¹æ³•åå­—å¿…é¡»ç›¸åŒï¼› å‚æ•°åˆ—è¡¨å¿…é¡»ä¸åŒï¼šä¸ªæ•°ä¸åŒï¼›ä¸ªæ•°ä¸åŒä½†å¯¹åº”å‚æ•°ç±»åž‹ä¸åŒï¼› è¿”å›žç±»åž‹/è®¿é—®ä¿®é¥°ç¬¦å¯åŒå¯ä¸åŒï¼› å¯å£°æ˜Žæ–°çš„æˆ–æ›´å¹¿çš„æ£€æŸ¥å¼‚å¸¸ï¼› èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªç±»æˆ–å­ç±»ä¸­è¢«é‡è½½ï¼› åº”ç”¨åœºæ™¯ é’ˆå¯¹åŒä¸€ç±»çš„å¯¹è±¡ï¼Œå¯¹äºŽä¸åŒæ¡ä»¶åŒä¸€è¡Œä¸ºçš„ä¸åŒè¡¨çŽ°ï¼› åŽŸç† é™æ€åˆ†æ´¾ï¼Œå‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package main.java.com.study.polymorphic;/** * @author: whb * @description: æ–¹æ³•é‡è½½æµ‹è¯• */public class OverloadTest &#123; /** * ç±»å®šä¹‰ */ static abstract class Human &#123; &#125; /** * ç»§æ‰¿è‡ªæŠ½è±¡ç±»Human */ static class Man extends Human &#123; &#125; static class Woman extends Man &#123; &#125; /** * å®šä¹‰çš„é‡è½½æ–¹æ³•ï¼ˆæ–¹æ³•åç›¸åŒï¼Œä½†å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆæ­¤å¤„æ˜¯ç±»åž‹ä¸åŒï¼‰ï¼‰ * * @param guy */ public void sayHello(Human guy) &#123; System.out.println("hello,guy!"); &#125; public void sayHello(Man guy) &#123; System.out.println("hello gentleman!"); &#125; public void sayHello(Woman guy) &#123; System.out.println("hello lady!"); &#125; public static void main(String[] args) &#123; Human man = new Man(); Man woman = new Woman(); OverloadTest test = new OverloadTest(); test.sayHello(man); test.sayHello(woman); &#125;&#125; æ‰§è¡Œç»“æžœï¼š 12hello,guy!hello gentleman! ç»“æžœè§£æžï¼š æ–¹æ³•é‡è½½ï¼ˆOverLoadï¼‰çš„åŽŸç† = é™æ€åˆ†æ´¾ = æ ¹æ® å˜é‡çš„é™æ€ç±»åž‹ ç¡®å®šæ‰§è¡Œï¼ˆé‡è½½ï¼‰å“ªä¸ªæ–¹æ³•; æ‰€ä»¥ä¸Šè¿°çš„æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ˜¯æ ¹æ®å˜é‡ï¼ˆmanã€womanï¼‰çš„é™æ€ç±»åž‹ï¼ˆHumanã€Manï¼‰ç¡®å®šé‡è½½sayHello()ä¸­å‚æ•°ä¸ºHuman guyã€Man guyçš„æ–¹æ³•,å³sayHello(Human guy)ã€sayHello(Man guy) ; æ–¹æ³•é‡å†™(Override) å®šä¹‰ å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•çš„å®žçŽ°ã€‚ ç‰¹ç‚¹ è¿”å›žå€¼ã€å‡½æ•°åã€å½¢å‚éƒ½ä¸èƒ½æ”¹å˜ï¼Œå³å¤–å£³ä¸å˜ï¼Œé‡å†™å†…åœ¨å®žçŽ°ï¼› ä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼šæž„é€ æ–¹æ³•ï¼›ä¸èƒ½ç»§æ‰¿/ä¸å…·å¤‡è®¿é—®æƒé™çš„æ–¹æ³•(å¦‚private)ï¼›å£°æ˜Žä¸ºfinalã€staticçš„æ–¹æ³•ï¼› å­ç±»æ–¹æ³•ä¸èƒ½ç¼©å°çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™ï¼› å­ç±»æ–¹æ³•ä¸èƒ½æ¯”çˆ¶ç±»æ–¹æ³•æŠ›å‡ºæ›´å¹¿çš„å¼‚å¸¸ï¼› åŽŸç† åŠ¨æ€åˆ†æ´¾ï¼Œå‘ç”Ÿåœ¨è¿è¡Œé˜¶æ®µã€‚ ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.polymorphic;/** * @author: whb * @description: æ–¹æ³•é‡å†™æµ‹è¯•ç±» */public class OverrideTest &#123; // æµ‹è¯•ä»£ç  public static void main(String[] args) &#123; // æƒ…å†µ1 Human man = new Man(); man.sayHello(); // æƒ…å†µ2 man = new Woman(); man.sayHello(); &#125; /** * å®šä¹‰çˆ¶ç±» */ static class Human &#123; public void sayHello() &#123; System.out.println("Human say hello"); &#125; &#125; /** * ç»§æ‰¿ç±»Human å¹¶ é‡å†™sayHello() */ static class Man extends Human &#123; @Override public void sayHello() &#123; System.out.println("man say hello"); &#125; &#125; static class Woman extends Human &#123; @Override public void sayHello() &#123; System.out.println("woman say hello"); &#125; &#125;&#125; æ‰§è¡Œç»“æžœ 12man say hellowoman say hello ç»“æžœåˆ†æž æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰ = åŠ¨æ€åˆ†æ´¾ = æ ¹æ® å˜é‡çš„åŠ¨æ€ç±»åž‹ ç¡®å®šæ‰§è¡Œï¼ˆé‡å†™ï¼‰å“ªä¸ªæ–¹æ³•; å¯¹äºŽæƒ…å†µ1ï¼šæ ¹æ®å˜é‡ï¼ˆManï¼‰çš„åŠ¨æ€ç±»åž‹ï¼ˆmanï¼‰ç¡®å®šè°ƒç”¨manä¸­çš„é‡å†™æ–¹æ³•sayHello(); å¯¹äºŽæƒ…å†µ2ï¼šæ ¹æ®å˜é‡ï¼ˆManï¼‰çš„åŠ¨æ€ç±»åž‹ï¼ˆwomanï¼‰ç¡®å®šè°ƒç”¨womanä¸­çš„é‡å†™æ–¹æ³•sayHello(); æ–¹æ³•é‡è½½ã€æ–¹æ³•é‡å†™å¯¹æ¯”]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows-å¸¸è§é—®é¢˜åŠå®žç”¨æŠ€å·§ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2Fe5866ae9.html</url>
    <content type="text"><![CDATA[å¿«é€Ÿæå–æŸä¸€æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶åç§° åœ¨éœ€è¦èŽ·å–æ–‡ä»¶åçš„æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªtxtæ ¼å¼çš„è®°äº‹æœ¬æ–‡ä»¶ã€‚åœ¨è®°äº‹æœ¬æ–‡ä»¶ä¸­è¾“å…¥ï¼šDIR . /B &gt;LIST.TXTå°†æ­¤è®°äº‹æœ¬æ–‡ä»¶åŽè¾åï¼Œç”±txtæ”¹ä¸ºbatã€‚ä¼šå¼¹å‡ºé‡å‘½åå¯¹è¯æ¡†ï¼Œå•å‡»â€œæ˜¯â€ã€‚åŒå‡»æ–‡ä»¶â€œæ–°å»ºæ–‡æœ¬æ–‡æ¡£.batâ€å³å¯ç”Ÿæˆlist.txtæ–‡ä»¶ã€‚æ‰“å¼€txtæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°å½“å‰æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶ååˆ—è¡¨ã€‚ ä¸€é”®èŽ·å–æ–°ç”µè„‘ç¡¬ä»¶ä¿¡æ¯ batè„šæœ¬å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110@echo offcolor 0atitle ç¡¬ä»¶æ£€æµ‹ mode con cols=90sc config winmgmt start= auto &gt;nul 2&lt;&amp;1net start winmgmt 2&gt;1nulsetlocal ENABLEDELAYEDEXPANSIONecho ä¸»ç‰ˆ:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic BASEBOARD get Manufacturer^,Product^,Version^,SerialNumber /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo åˆ¶é€ å•† = %%b if &quot;!tee!&quot; == &quot;4&quot; echo åž‹ å· = %%b if &quot;!tee!&quot; == &quot;5&quot; echo åºåˆ—å· = %%b if &quot;!tee!&quot; == &quot;6&quot; echo ç‰ˆ æœ¬ = %%b)set tee=0echo BIOS:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic bios get CurrentLanguage^,Manufacturer^,SMBIOSBIOSVersion^,SMBIOSMajorVersion^,SMBIOSMinorVersion^,ReleaseDate /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo å½“å‰è¯­è¨€ = %%b if &quot;!tee!&quot; == &quot;4&quot; echo åˆ¶é€ å•† = %%b if &quot;!tee!&quot; == &quot;5&quot; echo å‘è¡Œæ—¥æœŸ = %%b if &quot;!tee!&quot; == &quot;6&quot; echo ç‰ˆ æœ¬ = %%b if &quot;!tee!&quot; == &quot;7&quot; echo SMBIOSMajorVersion = %%b if &quot;!tee!&quot; == &quot;8&quot; echo SMBIOSMinorVersion = %%b )set tee=0echo.echo CPU:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic cpu get name^,ExtClock^,CpuStatus^,Description /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo CPUä¸ªæ•° = %%b if &quot;!tee!&quot; == &quot;4&quot; echo å¤„ç†å™¨ç‰ˆæœ¬ = %%b if &quot;!tee!&quot; == &quot;5&quot; echo å¤– é¢‘ = %%b if &quot;!tee!&quot; == &quot;6&quot; echo åç§°åŠä¸»é¢‘çŽ‡ = %%b)set tee=0echo.echo æ˜¾ç¤ºå™¨:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic DESKTOPMONITOR get name^,ScreenWidth^,ScreenHeight^,PNPDeviceID /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo ç±» åž‹ = %%b if &quot;!tee!&quot; == &quot;4&quot; echo å…¶ä»–ä¿¡æ¯ = %%b if &quot;!tee!&quot; == &quot;5&quot; echo å±å¹•é«˜ = %%b if &quot;!tee!&quot; == &quot;6&quot; echo å±å¹•å®½ = %%b)set tee=0echo.echo ç¡¬ ç›˜:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic DISKDRIVE get model^,interfacetype^,size^,totalsectors^,partitions /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo æŽ¥å£ç±»åž‹ = %%b if &quot;!tee!&quot; == &quot;4&quot; echo ç¡¬ç›˜åž‹å· = %%b if &quot;!tee!&quot; == &quot;5&quot; echo åˆ†åŒºæ•° = %%b if &quot;!tee!&quot; == &quot;6&quot; echo å®¹ é‡ = %%b if &quot;!tee!&quot; == &quot;7&quot; echo æ€»æ‰‡åŒº = %%b)echo åˆ†åŒºä¿¡æ¯:wmic LOGICALDISK where mediatype=&apos;12&apos; get description,deviceid,filesystem,size,freespaceset tee=0echo.echo ç½‘ å¡:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic NICCONFIG where &quot;index=&apos;1&apos;&quot; get ipaddress^,macaddress^,description /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo ç½‘å¡ç±»åž‹ = %%b if &quot;!tee!&quot; == &quot;4&quot; echo ç½‘å¡IP = %%b if &quot;!tee!&quot; == &quot;5&quot; echo ç½‘å¡MAC = %%b)set tee=0echo.echo æ‰“å°æœº:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic PRINTER get caption /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo æ‰“å°æœºåå­— = %%b)set tee=0echo.echo å£° å¡:for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;wmic SOUNDDEV get name^,deviceid /value&apos;) do ( set /a tee+=1 if &quot;!tee!&quot; == &quot;3&quot; echo å…¶ä»–ä¿¡æ¯ = %%b if &quot;!tee!&quot; == &quot;4&quot; echo åž‹ å· = %%b)set tee=0echo.echo å†… å­˜: for /f &quot;tokens=1,* delims==&quot; %%a in (&apos;systeminfo^|find &quot;å†…å­˜&quot;&apos;) do ( echo %%a 4534 %%b )echo.echo æ˜¾ å¡:del /f &quot;%TEMP%\temp.txt&quot; 2&gt;nuldxdiag /t %TEMP%\temp.txt:æ˜¾å¡rem è¿™é‡Œéœ€è¦30ç§’å·¦å³!if EXIST &quot;%TEMP%\temp.txt&quot; ( for /f &quot;tokens=1,2,* delims=:&quot; %%a in (&apos;findstr /c:&quot; Card name:&quot; /c:&quot;Display Memory:&quot; /c:&quot;Current Mode:&quot; &quot;%TEMP%\temp.txt&quot;&apos;) do ( set /a tee+=1 if !tee! == 1 echo æ˜¾å¡åž‹å·: %%b if !tee! == 2 echo æ˜¾å­˜å¤§å°: %%b if !tee! == 3 echo å½“å‰è®¾ç½®: %%b) ) else ( ping /n 2 127.1&gt;nul goto æ˜¾å¡)set /p var=éœ€è¦é¢å¤–ä¿¡æ¯å—(y/n): if /i %var% == y notepad &quot;%TEMP%\temp.txt&quot;del /f &quot;%TEMP%\temp.txt&quot; 2&gt;nulpause åªéœ€è¦æ–°å»ºä¸€ä¸ªtxtï¼Œå¤åˆ¶ä¸Šé¢ä»£ç åŽä¿®æ”¹åŽç¼€åä¸ºbat(æœ¬æ¥ä¸ºtxt),ç„¶åŽå³é”®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå°±å¯ä»¥äº†ã€‚ æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„ç«¯å£ 1netstat -nbaov]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLä¸­çš„å‡½æ•°æ€»ç»“]]></title>
    <url>%2Fposts%2F578ec873.html</url>
    <content type="text"><![CDATA[CONCAT()å‡½æ•° CONCATï¼ˆï¼‰å‡½æ•°ç”¨äºŽå°†å¤šä¸ªå­—ç¬¦ä¸²è¿žæŽ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ä½¿ç”¨æ•°æ®è¡¨sys_userä½œä¸ºç¤ºä¾‹ï¼Œsqlå¦‚ä¸‹ï¼š SELECT user_id as id,zwxm as name FROM sys_user LIMIT 1; è¿”å›žç»“æžœå¦‚ä¸‹ï¼š 12345+----+--------+| id | name |+----+--------+| 1 | å¼ ä¸‰ |+----+--------+ 1ã€è¯­æ³•åŠä½¿ç”¨ç‰¹ç‚¹ï¼š CONCAT(str1,str2,â€¦) è¿”å›žç»“æžœä¸ºè¿žæŽ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºNULL ï¼Œåˆ™è¿”å›žå€¼ä¸º NULLã€‚å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ 2ã€ä½¿ç”¨ç¤ºä¾‹ï¼š SELECT CONCAT(user_id, â€˜ï¼Œâ€™, zwxm) AS con FROM sys_user LIMIT 1; è¿”å›žç»“æžœå¦‚ä¸‹ï¼š 12345+----------+| con |+----------+| 1,å¼ ä¸‰ |+----------+ SELECT CONCAT(â€˜Myâ€™, NULL, â€˜QLâ€™); è¿”å›žç»“æžœå¦‚ä¸‹ï¼š 12345+--------------------------+| CONCAT(&apos;My&apos;, NULL, &apos;QL&apos;) |+--------------------------+| NULL |+--------------------------+ CONCAT_WS()å‡½æ•° ä½¿ç”¨è¯­æ³•ä¸ºï¼šÂ· CONCAT_WS(separator,str1,str2,â€¦) Â· CONCAT_WS() ä»£è¡¨ CONCAT With Separator ï¼Œæ˜¯CONCAT()çš„ç‰¹æ®Šå½¢å¼ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…¶å®ƒå‚æ•°çš„åˆ†éš”ç¬¦ã€‚åˆ†éš”ç¬¦çš„ä½ç½®æ”¾åœ¨è¦è¿žæŽ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´ã€‚åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå‚æ•°ã€‚å¦‚æžœåˆ†éš”ç¬¦ä¸º NULLï¼Œåˆ™ç»“æžœä¸º NULLã€‚å‡½æ•°ä¼šå¿½ç•¥ä»»ä½•åˆ†éš”ç¬¦å‚æ•°åŽçš„ NULL å€¼ã€‚ä½†æ˜¯CONCAT_WS()ä¸ä¼šå¿½ç•¥ä»»ä½•ç©ºå­—ç¬¦ä¸²ã€‚ (ç„¶è€Œä¼šå¿½ç•¥æ‰€æœ‰çš„ NULLï¼‰ã€‚ ç¤ºä¾‹1ï¼š SELECT CONCAT_WS('_',user_id,zwxm) AS con_ws FROM sys_user LIMIT 1; è¿”å›žç»“æžœï¼š 12345+----------+| con_ws |+----------+| 1_å¼ ä¸‰ |+----------+ ç¤ºä¾‹2ï¼š SELECT CONCAT_WS(',','First name',NULL,'Last Name'); è¿”å›žç»“æžœï¼š 12345+----------------------------------------------+| CONCAT_WS(&apos;,&apos;,&apos;First name&apos;,NULL,&apos;Last Name&apos;) |+----------------------------------------------+| First name,Last Name |+----------------------------------------------+ GROUP_CONCAT()å‡½æ•° è¯­æ³•å¦‚ä¸‹ï¼š group_concat([DISTINCT] è¦è¿žæŽ¥çš„å­—æ®µ [Order BY ASC/DESC æŽ’åºå­—æ®µ] [Separator 'åˆ†éš”ç¬¦']) åŸºæœ¬æŸ¥è¯¢ï¼š 123456789101112mysql&gt; select * from test; +------+------+ | id| name | +------+------+ |1 | 10 | |1 | 20 | |1 | 20 | |2 | 20 | |3 | 200 | |3 | 500 | +------+------+ 6 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš”(é»˜è®¤) 123456789mysql&gt; select id,group_concat(name) from test group by id; +------+--------------------+ | id | group_concat(name) | +------+--------------------+ |1 | 10,20,20 | |2 | 20 | |3 | 200,500 | +------+--------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œåˆ†å·åˆ†éš” 123456789mysql&gt; select id,group_concat(name separator &apos;;&apos;) from test group by id; +------+----------------------------------+ | id | group_concat(name separator &apos;;&apos;) | +------+----------------------------------+ |1 | 10;20;20 | |2 | 20 | |3 | 200;500 | +------+----------------------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠåŽ»å†—ä½™çš„nameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš” 123456789mysql&gt; select id,group_concat(distinct name) from test group by id; +------+-----------------------------+ | id | group_concat(distinct name) | +------+-----------------------------+ |1 | 10,20 | |2 | 20 | |3 | 200,500 | +------+-----------------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš”ï¼Œä»¥nameæŽ’å€’åº 123456789mysql&gt; select id,group_concat(name order by name desc) from test group by id; +------+---------------------------------------+ | id | group_concat(name order by name desc) | +------+---------------------------------------+ |1 | 20,20,10 | |2 | 20 | |3 | 500,200 | +------+---------------------------------------+ 3 rows in set (0.00 sec) ä½¿ç”¨group_concat_max_lenç³»ç»Ÿå˜é‡ï¼Œä½ å¯ä»¥è®¾ç½®å…è®¸çš„æœ€å¤§é•¿åº¦ã€‚ ç¨‹åºä¸­è¿›è¡Œè¿™é¡¹æ“ä½œçš„è¯­æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­ val æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼š SET [SESSION | GLOBAL] group_concat_max_len = val; è‹¥å·²ç»è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œ åˆ™ç»“æžœè¢«æˆªè‡³è¿™ä¸ªæœ€å¤§é•¿åº¦ã€‚ å°†çŽ¯å¢ƒå˜é‡group_concat_max_len å¢žå¤§ã€‚é»˜è®¤æ˜¯1024.æˆ‘å°±è®¾ç½®äº†sessionçº§çš„çŽ¯å¢ƒå˜é‡å°†å…¶å˜ä¸º2048ï¼ˆä¸å¤Ÿç”¨å†åŠ å¤§ï¼‰]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-å¸¸è§é—®é¢˜åŠå®žç”¨æŠ€å·§ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F22401d2a.html</url>
    <content type="text"><![CDATA[è™šæ‹Ÿæœºå®‰è£…linuxæç¤ºintel VT-xå¤„äºŽç¦ç”¨çŠ¶æ€ é—®é¢˜æè¿° æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è™šæ‹Ÿæœºå¯åŠ¨linuxçš„æ—¶å€™ç»å¸¸ä¼šç¢°åˆ°ä¸‹é¢è¿™ä¸ªæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š å·²å°†è¯¥è™šæ‹Ÿæœºé…ç½®ä¸ºä½¿ç”¨ 64 ä½å®¢æˆ·æœºæ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œæ— æ³•æ‰§è¡Œ 64 ä½æ“ä½œã€‚æ­¤ä¸»æœºæ”¯æŒ Intel VT-xï¼Œä½† Intel VT-x å¤„äºŽç¦ç”¨çŠ¶æ€ã€‚ å¦‚æžœå·²åœ¨ BIOS/å›ºä»¶è®¾ç½®ä¸­ç¦ç”¨ Intel VT-xï¼Œæˆ–ä¸»æœºè‡ªæ›´æ”¹æ­¤è®¾ç½®åŽä»Žæœªé‡æ–°å¯åŠ¨ï¼Œåˆ™ Intel VT-x å¯èƒ½è¢«ç¦ç”¨ã€‚ ç¡®è®¤ BIOS/å›ºä»¶è®¾ç½®ä¸­å¯ç”¨äº† Intel VT-x å¹¶ç¦ç”¨äº†â€œå¯ä¿¡æ‰§è¡Œâ€ã€‚å¦‚æžœè¿™ä¸¤é¡¹ BIOS/å›ºä»¶è®¾ç½®æœ‰ä¸€é¡¹å·²æ›´æ”¹ï¼Œè¯·é‡æ–°å¯åŠ¨ä¸»æœºã€‚å¦‚æžœæ‚¨åœ¨å®‰è£… VMware Workstation ä¹‹åŽä»Žæœªé‡æ–°å¯åŠ¨ä¸»æœºï¼Œè¯·é‡æ–°å¯åŠ¨ã€‚å°†ä¸»æœºçš„ BIOS/å›ºä»¶æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ã€‚ è§£å†³åŠžæ³• é‡å¯ç”µè„‘ï¼Œè¿›å…¥biosï¼ˆä¸€èˆ¬æ˜¯F10ï¼‰ï¼Œé€‰æ‹©Configurationé€‰é¡¹ï¼Œé€‰æ‹©Intel Virtual Technologyå¹¶å›žè½¦ ï¼Œé€‰æ‹©enable. ä¿å­˜é€€å‡ºOKã€‚ nginxæ—¥å¿—æ–‡ä»¶åˆ é™¤åŽç©ºé—´ä¸é‡Šæ”¾ é—®é¢˜æè¿° å› nginxæ—¥å¿—è¿‡å¤§ï¼Œå æ»¡å­˜å‚¨ç©ºé—´ï¼Œæƒ³åˆ é™¤æ—¥å¿—å‡å°‘ç©ºé—´ï¼Œä½†æ˜¯åˆ é™¤æ—¥å¿—åŽå‘çŽ°ç©ºé—´è¿˜æ˜¯æ²¡æœ‰å‡å°‘ã€‚ æœªé‡Šæ”¾ç£ç›˜ç©ºé—´åŽŸå›  åœ¨Linuxæˆ–è€…Unixç³»ç»Ÿä¸­ï¼Œé€šè¿‡rmæˆ–è€…æ–‡ä»¶ç®¡ç†å™¨åˆ é™¤æ–‡ä»¶å°†ä¼šä»Žæ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æž„ä¸Šè§£é™¤é“¾æŽ¥(unlink)ã€‚ç„¶è€Œå¦‚æžœæ–‡ä»¶æ˜¯è¢«æ‰“å¼€çš„ï¼ˆæœ‰ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ï¼‰ï¼Œé‚£ä¹ˆè¿›ç¨‹å°†ä»ç„¶å¯ä»¥è¯»å–è¯¥æ–‡ä»¶ï¼Œç£ç›˜ç©ºé—´ä¹Ÿä¸€ç›´è¢«å ç”¨ã€‚è€Œæˆ‘åˆ é™¤çš„æ˜¯nginxçš„logæ–‡ä»¶ï¼Œåˆ é™¤çš„æ—¶å€™æ–‡ä»¶åº”è¯¥æ­£åœ¨è¢«ä½¿ç”¨ã€‚ è§£å†³åŠžæ³• é‡å¯nginxæœåŠ¡ï¼Œæˆ–è€…ç”¨&gt;/opt/nginx/logs/nginx.logæ¸…ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æŽ¥åˆ é™¤ã€‚ ç»™æŒ‡å®šç”¨æˆ·æˆ–å…¨éƒ¨ç”¨æˆ·ï¼ˆå·²ç™»å½•ï¼‰å‘é€æ¶ˆæ¯ ç»™æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯ é¦–å…ˆï¼Œå¯ä½¿ç”¨wæˆ–whoå‘½ä»¤æŸ¥çœ‹å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼› ç„¶åŽï¼Œä½¿ç”¨writeå‘½ä»¤å°†ä¿¡æ¯å‘é€åˆ°ç”¨æˆ·çš„ç»ˆç«¯ä¸Šï¼Œç”¨æ³•æ­¥éª¤å¦‚ä¸‹ï¼š write + shhç™»é™†ç”¨æˆ·å+ttyname(ä¾‹å¦‚pts/1)ENTERè¾“å…¥ä¿¡æ¯ï¼ˆæ‰€è¦å‘é€çš„æ¶ˆæ¯ï¼Œä¸­æ–‡å¯èƒ½ä¼šä¹±ç ï¼‰ã€‚EOFCTRL+Dç»“æŸ &lt;i class=&quot;fa fa-pencil fa-2x&quot;&gt;&lt;/i&gt;å®žä¾‹ï¼š 123root# write root pts/1I&apos;ll come by at 12:00 to look at your problem.root# ç„¶åŽä½¿ç”¨rootè´¦å·ç™»å½•ï¼Œä¸”ttyå·ä¸ºpts/1çš„ç™»å½•ç”¨æˆ·ç»ˆç«¯ä¼šæ”¶åˆ°å¦‚ä¸‹æ¶ˆæ¯ï¼š 123Message from root@cs2c.com.cn on pts/3 at 10:20 ...I&apos;ll come by at 12:00 to look at you problem.EOF ç»™å½“å‰ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ ç»™å½“å‰ç™»å½•æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œä½¿ç”¨wallï¼ˆwrite allçš„ç¼©å†™ï¼‰ &lt;i class=&quot;fa fa-pencil fa-2x&quot;&gt;&lt;/i&gt;å®žä¾‹å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œä½ å¯ä»¥é€šè¿‡whoå‘½ä»¤æŸ¥çœ‹ç™»å½•åˆ°è¯¥æœºå™¨çš„æ‰€æœ‰ç”¨æˆ·ã€‚æ¯”å¦‚ï¼š 12345# whoroot pts/0 Sep 13 04:28 (10.56.226.25)root pts/1 Sep 13 22:32 (10.140.1.37)root pts/2 Sep 13 23:31 (10.140.2.70)root pts/3 Sep 13 23:56 (10.140.2.70) æ‰§è¡Œwhoå‘½ä»¤ï¼Œå°±ä¼šè¿”å›žä¸Šé¢çš„ç»“æžœã€‚è¡¨ç¤ºæœ‰ä¸‰ä¸ªç”¨æˆ·ç™»å½•åˆ°è¯¥æœºå™¨ï¼Œæœ‰ä¸ªç”¨æˆ·æœ‰ä¸¤ä¸ªç™»å½•Consoleã€‚ å…¶æ¬¡ï¼Œå¹¿æ’­æ¶ˆæ¯ 123#wall &apos;I will use this host. If somebody is using it, pls let me know. Thanks a lot.&apos;Broadcast message from root (pts/3) (Fri Jun 13 23:57:13 2008):I will use this host. If somebody is using it, pls let me know. Thanks a lot æ‰§è¡Œwallå‘½ä»¤ï¼Œæ‰€æœ‰ç™»å½•åˆ°è¯¥æœºå™¨çš„æŽ§åˆ¶å°(console)ç•Œé¢ä¸Šéƒ½ä¼šæ”¶åˆ°å¦‚ä¸Šæ‰€ç¤ºçš„æ¶ˆæ¯ã€‚ LINUXç³»ç»Ÿè½¯ä»¶å®‰è£…å’Œå¸è½½çš„å¸¸è§æ–¹æ³• rpmåŒ…å¸è½½ï¼šrpm -e XXX.rpm (å¦‚æžœæƒ³å¿½ç•¥ä¾èµ–ï¼Œå¯åŠ ä¸Šâ€“nodeps)ã€‚yum remove xxx.rpm è¿™ç§æ–¹æ³•éžå¸¸ä¸å»ºè®®ä½¿ç”¨ï¼Œå¸è½½è¿‡ç¨‹ä¼šå°†å¾…å¸è½½çš„è½¯ä»¶åŒ…æ‰€ä¾èµ–çš„è½¯ä»¶åŒ…ä¸€å¹¶å¸è½½æŽ‰ï¼Œå¾ˆå®¹æ˜“é€ æˆç³»ç»Ÿç¼ºå°‘æŸäº›åŒ…è€Œå´©æºƒç­‰é—®é¢˜ã€‚æºç åŒ…å¸è½½ï¼šcdå‘½ä»¤è¿›å…¥ç¼–è¯‘åŽçš„è½¯ä»¶ç›®å½•ï¼Œå³å®‰è£…æ—¶çš„ç›®å½•ï¼Œæ‰§è¡Œmake uninstallå‘½ä»¤å³å¯ï¼›æˆ–è€…ç›´æŽ¥åˆ é™¤å®‰è£…ç›®å½•ã€‚ å¦‚ä½•ä¿®æ”¹LINUXçš„IPåœ°å€ã€ç½‘å…³å’Œä¸»æœºå 1ã€ä¿®æ”¹IPåœ°å€ã€ç½‘å…³ï¼šç¼–è¾‘/etc/sysconfig/network-scripts/ifcfg-eth0ï¼Œä¿®æ”¹é‡Œé¢IPADDRå’ŒGATEWAYå†…å®¹ï¼Œæ²¡æœ‰è¿™ä¸¤è¡Œï¼Œåˆ™æ·»åŠ å³å¯ï¼Œæ·»åŠ æ—¶ç¡®ä¿BOOTPROTO=staticï¼Œé™æ€åœ°å€ï¼Œå¦‚IPADDR=192.168.1.100 GATEWAY=192.168.1.1ã€‚2ã€ä¿®æ”¹ä¸»æœºåç§°ï¼šç¼–è¾‘/etc/sysconfig/networkï¼Œä¿®æ”¹é‡Œé¢çš„HOSTNAMEå†…å®¹ï¼Œå¦‚è®¾ç½®ä¸»æœºåç§°ä¸ºmysqlï¼Œåˆ™ï¼šHOSTNAME=mysqlå³å¯ï¼› å¦‚ä½•æŸ¥çœ‹å½“å‰çš„LinuxæœåŠ¡å™¨çš„è¿è¡Œçº§åˆ« ä½¿ç”¨ who -r æˆ–è€… runlevel å‘½ä»¤ã€‚ å¦‚ä½•æŸ¥çœ‹Linuxçš„é»˜è®¤ç½‘å…³ ç”¨ route -n æˆ–è€… netstat -nr å‘½ä»¤ã€‚ å¦‚ä½•åœ¨/usrç›®å½•ä¸‹æ‰¾å‡ºå¤§å°è¶…è¿‡10MBçš„æ–‡ä»¶ find /usr -size +10M å¦‚ä½•åœ¨/homeç›®å½•ä¸‹æ‰¾å‡º120å¤©ä¹‹å‰è¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶ find /home -mtime +120 å¦‚ä½•åœ¨/varç›®å½•ä¸‹æ‰¾å‡º90å¤©ä¹‹å†…æœªè¢«è®¿é—®è¿‡çš„æ–‡ä»¶ find /var \! -atime -90 æŸ¥çœ‹å„ç³»ç»Ÿç”¨æˆ·çš„è¿›ç¨‹ï¼ˆLWPï¼‰æ•° 1ps h -Led -o user | sort | uniq -c | sort -n é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨ ps å‘½ä»¤å¹¶ä¸èƒ½æ˜¾ç¤ºå‡ºæ‰€æœ‰çš„è¿›ç¨‹ã€‚å› ä¸º Linux çŽ¯å¢ƒä¸‹æ‰§è¡Œå¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å°†ä»¥ä¸€ä¸ªè½»é‡çº§è¿›ç¨‹ï¼ˆlight-weight process ã€ŽLWPã€ï¼‰çš„å½¢å¼æ‰§è¡Œï¼Œè€Œ ps å‘½ä»¤å¦‚æžœä¸å¸¦ -L é€‰é¡¹å°†æ— æ³•æŸ¥çœ‹ LWPã€‚ ç¡®å®šæŸç”¨æˆ·çš„è¿›ç¨‹ï¼ˆLWPï¼‰æ•°çš„åˆ†å¸ƒæƒ…å†µ 1ps -o nlwp,pid,lwp,args -u username | sort -n å…¶ä¸­ username ä¸ºç³»ç»Ÿç”¨æˆ·åã€‚ å¸¸ç”¨æ—¥å¿—æŸ¥è¯¢å‘½ä»¤ æŸ¥çœ‹å®žæ—¶æ—¥å¿— 1tail -f info.log åˆ†é¡µæŸ¥çœ‹æ‰€æœ‰æ—¥å¿— 1cat info.log | more åˆ†é¡µæŸ¥çœ‹å‰Nè¡Œæ—¥å¿— 1tail -n 1000 info.log | more æ£€ç´¢æ—¥å¿—ï¼Œå¹¶æ˜¾ç¤ºè¯¥æ—¥å¿—çš„å‰åŽNè¡Œè®°å½• 1cat info.log | grep -n -B10 -A10 &quot;å…³é”®å­—&quot; æŸ¥çœ‹æ—¥å¿—ï¼Œä»Žç¬¬1000è¡Œå¼€å§‹ï¼Œæ˜¾ç¤º500è¡Œ 1cat info.log |tail -n+1000|head -n 500 æŸ¥çœ‹æ—¥å¿—ï¼Œæ˜¾ç¤º1350è¡Œåˆ°1400è¡Œ 1cat info.log | head -n 1400 | tail -n +1350 åˆ é™¤åŒ…æ‹¬å…³é”®è¯çš„è¡Œ 1sed -i &apos;/å…³é”®è¯/d&apos; info.log grepæŸ¥çœ‹æ‰“å°åŒ¹é…çš„ä¸‹å‡ è¡Œæˆ–å‰åŽå‡ è¡Œ å‰è¨€ å¹³æ—¶å·¥ä½œä¸­æ€»ä¼šç¢°åˆ°æŽ’æŸ¥é”™è¯¯æƒ³è¦çœ‹XXæ—¥å¿—é‡Œé¢çš„æŸä¸ªå…³é”®è¯ï¼Œä½†æ˜¯è¿™ä¸ªå…³é”®è¯å‰åŽåˆæœ‰å¾ˆå¤šå…¶ä»–ä¿¡æ¯ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„ï¼Œè¿™æ—¶å€™æ€Žä¹ˆåŠžå‘¢ï¼Ÿ å®žçŽ° ä¸€èˆ¬æ˜¯é€šè¿‡grepæ¥å®žçŽ°ã€‚å‡è®¾è¦çœ‹A.logé‡Œé¢â€œABCâ€å…³é”®è¯ä¸Šä¸‹100è¡Œï¼Œä¸€èˆ¬æ‰§è¡Œå‘½ä»¤ï¼š 1grep -C 100 &apos;ABC&apos; A.log å°†ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼š 1grep -C 100 &apos;ABC&apos; A.log &gt; /opt/error.log æƒ³åŒ¹é…æ¨¡å¼çš„ä¸Šä¸‹å‡ è¡Œï¼Œgrepä¹Ÿå¯ä»¥å®žçŽ° 1234567grep -5 &apos;parttern&apos; inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰åŽ5è¡Œgrep -C 5 &apos;parttern&apos; inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰åŽ5è¡Œgrep -A 5 &apos;parttern&apos; inputfile //æ‰“å°åŒ¹é…è¡Œçš„åŽ5è¡Œgrep -B 5 &apos;parttern&apos; inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰5è¡Œ æŸ¥æ‰¾æœ€åŽåˆ›å»ºæ—¶é—´æ˜¯3å¤©å‰ï¼ŒåŽç¼€æ˜¯*.logçš„æ–‡ä»¶å¹¶åˆ é™¤ 1find / -name â€œ*.logâ€ -ctime +3 -exec rm -f &#123;&#125; \ å°†æŸç›®å½•ä¸‹å¤§äºŽ100kçš„æ–‡ä»¶ç§»åŠ¨è‡³/tmpä¸‹ 1for i in `find /test -type f -size +100k`;do cd /test &amp;&amp; mv $i /tmp;done å°†æ•°æ®åº“å¤‡ä»½å¹¶æ‰“åŒ…è‡³è¿œç¨‹æœåŠ¡å™¨192.168.1.1 /backupç›®å½•ä¸‹ 123456789mount 192.168.1.1:/backup /mntcd /mnt/usr/local/mysql/bin/mysqldump -hlocalhost -uroot test &gt;test.sqltar czf test.sql.tar.gz test.sqlrm -f test.sql é˜²ç«å¢™é…ç½®è„šæœ¬ï¼Œåªå…è®¸è¿œç¨‹ä¸»æœºè®¿é—®æœ¬æœºçš„80ç«¯å£ 12345678910111213iptables -P INPUT ACCEPTiptables -P OUTPUT ACCEPTiptables -P FORWARD ACCEPTiptables -Fiptables -Xiptables -A INPUT -i eth0 -p tcp â€“dport 80 -j ACCEPTiptables -P INPUT DROP è„šæœ¬ç»Ÿè®¡nginxæ—¥å¿—ï¼Œå¾—åˆ°è®¿é—®ipæœ€å¤šçš„å‰10ä¸ª(nginxæ—¥å¿—è·¯å¾„ï¼š/home/logs/nginx/default/access.log 1awk â€˜&#123;a[$1]++&#125;END&#123;for (j in a) print a[j],j&#125;â€™ /home/logs/nginx/default/access.log|sort -nr|head -10 æŸ¥çœ‹æœ€æ¶ˆè€—CPUã€å†…å­˜çš„è¿›ç¨‹ CPUå ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k3|head -10 å†…å­˜æ¶ˆè€—æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k4|head -10 è™šæ‹Ÿå†…å­˜ä½¿ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k5|head -10 å‚æ•°è¯´æ˜Ž ps auxw uï¼šä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼æ¥æ˜¾ç¤ºç¨‹åºçŠ¶å†µ xï¼šæ˜¾ç¤ºæ‰€æœ‰ç¨‹åºï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ† wï¼šé‡‡ç”¨å®½é˜”çš„æ ¼å¼æ¥æ˜¾ç¤ºç¨‹åºçŠ¶å†µ ps auxw|head -1 è¾“å‡ºè¡¨å¤´ sort -rn -k5 -næ˜¯æŒ‰ç…§æ•°å­—å¤§å°æŽ’åºï¼Œ-ræ˜¯ä»¥ç›¸åé¡ºåºï¼Œ-kæ˜¯æŒ‡å®šéœ€è¦æŽ’åºçš„æ ä½ linuxç£ç›˜ç©ºé—´æ»¡äº†åŽæ€Žä¹ˆåŽ»åˆ¤å®šå“ªä¸ªåœ°æ–¹å äº†å¤šå¤§çš„ç©ºé—´å¹¶å›žæ”¶ ä½¿ç”¨df -hæŸ¥çœ‹ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µã€‚ä½¿ç”¨du -s /* | sort -nrå‘½ä»¤æŸ¥çœ‹é‚£ä¸ªç›®å½•å ç”¨ç©ºé—´å¤§ã€‚ç„¶åŽé‚£ä¸ªç›®å½•å ç”¨å¤šå†é€šè¿‡du -s /root/* | sort -nr ä¸€å±‚å±‚æŽ’æŸ¥ï¼Œæ‰¾åˆ°å ç”¨æ–‡ä»¶å¤šçš„åœ°æ–¹ã€‚ä½¿ç”¨du -h â€“max-depth=1æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹å¤§å°æƒ…å†µã€‚æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦è¢«è¿›ç¨‹å ç”¨ã€‚å¦‚æžœé€šè¿‡ä»¥ä¸Šæ–¹æ³•æ²¡æœ‰æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ lsof | grep deleted å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¯å¦åˆ é™¤æŽ‰çš„æ–‡ä»¶ä»ç„¶è¢«è¿›ç¨‹å ç”¨è€Œæ²¡æœ‰è¿›è¡Œå®žé™…åˆ é™¤ã€‚ LinuxæœåŠ¡å™¨å¿˜è®°rootå¯†ç æ€Žä¹ˆåŠž é‡å¯æˆ–è€…å¼€æœºæ—¶ï¼Œåœ¨å€’æ•°3ç§’çš„ç•Œé¢æŒ‰ä¸‹ä»»æ„é”®ã€‚ è¯¥ç•Œé¢æœ‰å¦‚ä¸‹æç¤º(e ç¼–è¾‘ a æ›´æ”¹å†…æ ¸é€‰é¡¹ c å‘½ä»¤è¡Œ b å¯åŠ¨)ï¼Œæ‰€ä»¥æˆ‘ä»¬æŒ‰ä¸‹&quot;e&quot;ç¼–è¾‘ã€‚ ä¸Šä¸‹é”®é€‰ä¸­ç¬¬äºŒè¡Œå†æŒ‰ä¸‹&quot;e&quot;ç¼–è¾‘ è¡Œæœ«åŠ ä¸Š&quot;singal,s,S,1&quot;å…¶ä¸­ä¸€é¡¹ï¼Œç„¶åŽå›žè½¦ã€‚ æŒ‰&quot;b&quot;,å¯åŠ¨ã€‚ å¯åŠ¨ä¹‹åŽå°±å¯ä»¥ç”¨passwdå‘½ä»¤é‡ç½®rootå‘½ä»¤ã€‚ ç”¨shellè„šæœ¬è¾“å‡ºå¸¦é¢œè‰²å­—ä½“ è¯­æ³• shellè„šæœ¬ä¸­echoæ˜¾ç¤ºå†…å®¹å¸¦é¢œè‰²æ˜¾ç¤º,echoæ˜¾ç¤ºå¸¦é¢œè‰²ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°-eï¼Œå¦‚ä¸‹ï¼š 1echo -e &quot;\033[41;36m something here \033[0m&quot; å…¶ä¸­41çš„ä½ç½®ä»£è¡¨åº•è‰²ï¼Œ 36çš„ä½ç½®æ˜¯ä»£è¡¨å­—çš„é¢œè‰² è‰²å€¼å¯¹åº” 1ã€å­—èƒŒæ™¯é¢œè‰²å’Œæ–‡å­—é¢œè‰²ä¹‹é—´æ˜¯è‹±æ–‡çš„&quot;&quot;; 2ã€æ–‡å­—é¢œè‰²åŽé¢æœ‰ä¸ªm; 3ã€å­—ç¬¦ä¸²å‰åŽå¯ä»¥æ²¡æœ‰ç©ºæ ¼ï¼Œå¦‚æžœæœ‰çš„è¯ï¼Œè¾“å‡ºä¹Ÿæ˜¯åŒæ ·æœ‰ç©ºæ ¼; ä¸‹é¢æ˜¯ç›¸åº”çš„å­—å’ŒèƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥è‡ªå·±æ¥å°è¯•æ‰¾å‡ºä¸åŒé¢œè‰²æ­é… 1234567echo -e â€œ\033[31m çº¢è‰²å­— \033[0mâ€echo -e â€œ\033[34m é»„è‰²å­— \033[0mâ€echo -e â€œ\033[41;33m çº¢åº•é»„å­— \033[0mâ€echo -e â€œ\033[41;37m çº¢åº•ç™½å­— \033[0mâ€ å­—é¢œè‰²ï¼š30â€”â€“37 12345678echo -e â€œ\033[30m é»‘è‰²å­— \033[0mâ€ echo -e â€œ\033[31m çº¢è‰²å­— \033[0mâ€ echo -e â€œ\033[32m ç»¿è‰²å­— \033[0mâ€ echo -e â€œ\033[33m é»„è‰²å­— \033[0mâ€ echo -e â€œ\033[34m è“è‰²å­— \033[0mâ€ echo -e â€œ\033[35m ç´«è‰²å­— \033[0mâ€ echo -e â€œ\033[36m å¤©è“å­— \033[0mâ€ echo -e â€œ\033[37m ç™½è‰²å­— \033[0mâ€ å­—èƒŒæ™¯é¢œè‰²èŒƒå›´ï¼š40â€”â€“47 12345678echo -e â€œ\033[40;37m é»‘åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[41;37m çº¢åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[42;37m ç»¿åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[43;37m é»„åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[44;37m è“åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[45;37m ç´«åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[46;37m å¤©è“åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[47;30m ç™½åº•é»‘å­— \033[0mâ€ æŽ§åˆ¶é€‰é¡¹è¯´æ˜Ž 12345678910111213141516171819\33[0m å…³é—­æ‰€æœ‰å±žæ€§ \33[1m è®¾ç½®é«˜äº®åº¦ \33[4m ä¸‹åˆ’çº¿ \33[5m é—ªçƒ \33[7m åæ˜¾ \33[8m æ¶ˆéš \33[30m â€” \33[37m è®¾ç½®å‰æ™¯è‰² \33[40m â€” \33[47m è®¾ç½®èƒŒæ™¯è‰² \33[nA å…‰æ ‡ä¸Šç§»nè¡Œ \33[nB å…‰æ ‡ä¸‹ç§»nè¡Œ \33[nC å…‰æ ‡å³ç§»nè¡Œ \33[nD å…‰æ ‡å·¦ç§»nè¡Œ \33[y;xHè®¾ç½®å…‰æ ‡ä½ç½® \33[2J æ¸…å± \33[K æ¸…é™¤ä»Žå…‰æ ‡åˆ°è¡Œå°¾çš„å†…å®¹ \33[s ä¿å­˜å…‰æ ‡ä½ç½® \33[u æ¢å¤å…‰æ ‡ä½ç½® \33[?25l éšè—å…‰æ ‡ \33[?25h æ˜¾ç¤ºå…‰æ ‡ å®žä¾‹ï¼šäº”é¢œå…­è‰²çš„shellè„šæœ¬ 123456789101112131415161718192021222324252627282930#!/bin/bash clearecho -e &quot;\033[1m Hello World&quot; # bold effectecho -e &quot;\033[5m Blink&quot; # blink effectecho -e &quot;\033[0m Hello World&quot; # back to noraml echo -e &quot;\033[31m Hello World&quot; # Red colorecho -e &quot;\033[32m Hello World&quot; # Green colorecho -e &quot;\033[33m Hello World&quot; # See remaing on screenecho -e &quot;\033[34m Hello World&quot;echo -e &quot;\033[35m Hello World&quot;echo -e &quot;\033[36m Hello World&quot; echo -e -n &quot;\033[0m&quot; # back to noramlecho -e &quot;\033[41m Hello World&quot;echo -e &quot;\033[42m Hello World&quot;echo -e &quot;\033[43m Hello World&quot;echo -e &quot;\033[44m Hello World&quot;echo -e &quot;\033[45m Hello World&quot;echo -e &quot;\033[46m Hello World&quot; echo -e &quot;\033[0m Hello World&quot; é‡å¯å‘½ä»¤ rebootshutdown -r now ç«‹åˆ»é‡å¯(rootç”¨æˆ·ä½¿ç”¨)shutdown -r 10 è¿‡10åˆ†é’Ÿè‡ªåŠ¨é‡å¯(rootç”¨æˆ·ä½¿ç”¨)shutdown -r 20:35 åœ¨æ—¶é—´ä¸º20:35æ—¶å€™é‡å¯(rootç”¨æˆ·ä½¿ç”¨)å¦‚æžœæ˜¯é€šè¿‡shutdownå‘½ä»¤è®¾ç½®é‡å¯çš„è¯ï¼Œå¯ä»¥ç”¨shutdown -cå‘½ä»¤å–æ¶ˆé‡å¯ å…³æœºå‘½ä»¤ halt ç«‹åˆ»å…³æœºpoweroff ç«‹åˆ»å…³æœºshutdown -h now ç«‹åˆ»å…³æœº(rootç”¨æˆ·ä½¿ç”¨)shutdown -h 10 10åˆ†é’ŸåŽè‡ªåŠ¨å…³æœºå¦‚æžœæ˜¯é€šè¿‡shutdownå‘½ä»¤è®¾ç½®å…³æœºçš„è¯ï¼Œå¯ä»¥ç”¨shutdown -cå‘½ä»¤å–æ¶ˆé‡å¯ æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç½‘å¡ 1watch cat /proc/net/dev é‡å¯ç½‘å¡æ–¹æ³• å…¨éƒ¨ç½‘å¡é‡å¯ é‡å¯ç½‘å¡ä½¿è®¾å®šç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart å•ä¸ªç½‘å¡é‡å¯ å…³é—­ç½‘å¡ ifdown eth0 å¼€å¯ç½‘å¡ ifup eth0 ç¦ç”¨ç½‘å¡ 123vi /etc/sysconfig/network-scripts/ifcfg-eth1onboot=NO ä¿®æ”¹IP åŠ¨æ€ è®¾å®šä¸€ä¸ªç½‘å¡IPï¼š 1ifconfig eth1 192.168.1.10 netmask 255.255.255.0 é‡å¯ç½‘å¡ä½¿è®¾å®šç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart é™æ€ ç¼–è¾‘æ–‡ä»¶ /etc/network/interfaces 1sudo vi /etc/network/interfaces å¹¶ç”¨ä¸‹é¢çš„è¡Œæ¥æ›¿æ¢æœ‰å…³eth0çš„è¡Œï¼š 12345678# The primary network interfaceauto eth0iface eth0 inet staticaddress 192.168.2.1gateway 192.168.2.254netmask 255.255.255.0#network 192.168.2.0#broadcast 192.168.2.255 å°†eth0çš„IPåˆ†é…æ–¹å¼ä¿®æ”¹ä¸ºé™æ€åˆ†é…(static)åŽï¼Œä¸ºå…¶åˆ¶å®šIPã€ç½‘å…³ã€å­ç½‘æŽ©ç ç­‰ä¿¡æ¯ã€‚ å°†ä¸Šé¢çš„Ubuntu IPåœ°å€ç­‰ä¿¡æ¯æ¢æˆä½ è‡ªå·±å°±å¯ä»¥äº†ã€‚ ç”¨ä¸‹é¢çš„å‘½ä»¤ä½¿ç½‘ç»œè®¾ç½®ç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart æ“ä½œé˜²ç«å¢™(serviceæ–¹å¼) æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ 1service iptables status å¼€å¯é˜²ç«å¢™ 1service iptables start å…³é—­é˜²ç«å¢™ 1service iptables stop æŸ¥æ‰¾å¤§æ–‡ä»¶ æœç´¢å½“å‰ç›®å½•ä¸‹ï¼Œè¶…è¿‡100Må¤§å°çš„æ–‡ä»¶ 1find . -type f -size +100M æŸ¥çœ‹è¶…è¿‡100Må¤§å°çš„æ–‡ä»¶åŠå…¶ç›¸å…³ä¿¡æ¯ 1find . -type f -size +800M -print0 | xargs -0 ls -l æŸ¥æ‰¾è¶…è¿‡100Må¤§å°æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºæŸ¥æ‰¾å‡ºæ¥æ–‡ä»¶çš„å…·ä½“å¤§å° 1find . -type f -size +100M -print0 | xargs -0 du -h æŸ¥æ‰¾è¶…è¿‡100Må¤§å°æ–‡ä»¶å¹¶å¯¹æŸ¥æ‰¾ç»“æžœæŒ‰ç…§æ–‡ä»¶å¤§å°åšä¸€ä¸ªæŽ’åº 1find . -type f -size +800M -print0 | xargs -0 du -h | sort -nr æŸ¥æ‰¾Linuxä¸‹çš„å¤§ç›®å½• 1du -h --max-depth=1]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java Stringå¸¸è§é—®é¢˜]]></title>
    <url>%2Fposts%2Fd0a49d51.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹ä¸€æ®µä»£ç å—ï¼š 123456789public String gets1() &#123; return "" + System.currentTimeMillis();&#125;public String gets2() &#123; return String.valueOf(System.currentTimeMillis());&#125;public String gets3() &#123; return new String("") + System.currentTimeMillis();&#125; è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯è¾“å‡ºå½“å‰æ—¶é—´æˆ³stringç±»åž‹çš„æ•°æ®ï¼Œä½†ä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿåç¼–è¯‘çœ‹ä¸‹ä¸‰ä¸ªæ–¹æ³•çš„ç»†èŠ‚ï¼š 12345678910111213141516171819202122232425262728293031public java.lang.String gets1();Code: 0: new #2 // class java/lang/StringBuilder 3: dup 4: invokespecial #3 // Method java/lang/StringBuilder."&lt;init&gt;":()V 7: ldc #4 // String 9: invokevirtual #5 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 12: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 15: invokevirtual #7 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder; 18: invokevirtual #8 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 21: areturn' public java.lang.String gets2();Code: 0: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 3: invokestatic #9 // Method java/lang/String.valueOf:(J)Ljava/lang/String; 6: areturnpublic java.lang.String gets3();Code: 0: new #2 // class java/lang/StringBuilder 3: dup 4: invokespecial #3 // Method java/lang/StringBuilder."&lt;init&gt;":()V 7: new #10 // class java/lang/String 10: dup 11: ldc #4 // String 13: invokespecial #11 // Method java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V 16: invokevirtual #5 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 19: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 22: invokevirtual #7 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder; 25: invokevirtual #8 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 28: areturn æ–¹æ³•1ï¼š&quot;&quot;+System.currentTimeMillis()æ˜¯é€šè¿‡StringBuilderçš„appendæ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªç©ºå­—ç¬¦ä¸²åŠå½“å‰æ—¶é—´æˆ³ï¼Œç„¶åŽé€šè¿‡toStringæ–¹æ³•ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„Stringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringBuilderå’Œä¸€ä¸ªStringå¯¹è±¡ã€‚ æ–¹æ³•2ï¼šString.valueOf(System.currentTimeMillis())ç›´æŽ¥èŽ·å–å½“å‰æ—¶é—´æˆ³ï¼Œç„¶åŽåˆ›å»ºäº†ä¸€ä¸ªStringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringå¯¹è±¡ã€‚ æ–¹æ³•3ï¼šnew String(&quot;&quot;) + System.currentTimeMillis()åˆ™æœ€éº»çƒ¦ï¼Œå…ˆåˆ›å»ºäº†StringBuilderå¯¹è±¡ï¼Œç„¶åŽæ–°å»ºäº†ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„Stringå¯¹è±¡ï¼Œé€šè¿‡appendæ–¹æ³•æ·»åŠ è¿›åŽ»ï¼Œæœ€åŽtoStringåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringBuilderå¯¹è±¡å’Œä¸¤ä¸ªStringå¯¹è±¡ã€‚ ä»Žä¸Šé¢çš„åˆ†æžä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œå¾ˆæ˜Žæ˜¾æ–¹æ³•2æ˜¯æœ€ä¼˜çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨æ·±å…¥Stringä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹JVMçš„ç»„æˆã€‚ å †ï¼šJVMè¿è¡Œä¸­ç”³è¯·çš„å¯¹è±¡å­˜æ”¾çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯æ‰€è¯´çš„æ–°ç”Ÿä»£+è€å¹´ä»£ã€‚ è™šæ‹Ÿæœºæ ˆï¼šæ¯ä¸ªæ–¹æ³•åœ¨è¢«è°ƒç”¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œç”¨äºŽå­˜å‚¨ä¸´æ—¶çš„éåŽ†ã€æ–¹æ³•ç­‰ä¿¡æ¯ã€‚è°ƒç”¨ç›¸å½“äºŽè¿›æ ˆï¼Œè¿”å›žç»“æžœåˆ™ç›¸å½“äºŽå‡ºæ ˆï¼Œå¼‚å¸¸è¾“å‡ºçš„æ ˆä¿¡æ¯å°±æ˜¯ä»Žè¿™é‡Œæ¥çš„ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼šä¹Ÿæ˜¯æ–¹æ³•è°ƒç”¨ï¼Œåªæ˜¯è°ƒç”¨çš„æ–¹æ³•æ˜¯æœ¬åœ°nativeæ–¹æ³•ã€‚ æ–¹æ³•åŒºï¼šå­˜å‚¨çš„ç±»çš„ç»“æž„ä¿¡æ¯ï¼Œé™æ€å˜é‡ç­‰ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯æ°¸ç”Ÿä»£ï¼Œå‘ç”ŸFULL GCçš„åœ°æ–¹ï¼ˆJava8ä¸­ä»¥å…ƒç©ºé—´ä»£æ›¿äº†æ°¸ç”Ÿä»£è¿™ä¸ªæ¦‚å¿µï¼‰ã€‚ å¸¸é‡æ± ï¼šæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥å­˜æ”¾å„ç§ç”Ÿæˆçš„å­—é¢é‡ï¼Œä¾‹å¦‚å®šä¹‰çš„ä¸€ä¸ªStringç±»åž‹çš„æ•°æ®ï¼ˆJava7ä¸­æŠŠå¸¸é‡æ± ç§»åˆ°äº†å †ä¸­ï¼‰ 0. Stringçš„ç‰¹æ€§ 1ã€Stringç±»æ˜¯finalçš„ï¼Œä¸å¯è¢«ç»§æ‰¿ã€‚ 2ã€Stringç±»æ˜¯çš„æœ¬è´¨æ˜¯å­—ç¬¦æ•°ç»„char[], å¹¶ä¸”å…¶å€¼ä¸å¯æ”¹å˜ã€‚ 3ã€Javaè¿è¡Œæ—¶ä¼šç»´æŠ¤ä¸€ä¸ªString Poolï¼ˆStringæ± ï¼‰ï¼ŒJavaDocç¿»è¯‘å¾ˆæ¨¡ç³Šâ€œå­—ç¬¦ä¸²ç¼“å†²åŒºâ€ã€‚Stringæ± ç”¨æ¥å­˜æ”¾è¿è¡Œæ—¶ä¸­äº§ç”Ÿçš„å„ç§å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ± ä¸­çš„å­—ç¬¦ä¸²çš„å†…å®¹ä¸é‡å¤ã€‚è€Œä¸€èˆ¬å¯¹è±¡ä¸å­˜åœ¨è¿™ä¸ªç¼“å†²æ± ï¼Œå¹¶ä¸”åˆ›å»ºçš„å¯¹è±¡ä»…ä»…å­˜åœ¨äºŽæ–¹æ³•çš„å †æ ˆåŒºã€‚ 1. åˆ›å»ºå­—ç¬¦ä¸² åˆ›å»ºå­—ç¬¦ä¸²ä¸€èˆ¬å°±ä¸¤ç§æ–¹æ³•ï¼š 123String s1="hello";String s2=new String("hello"); ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªStringç±»åž‹çš„å¼•ç”¨s1ï¼Œç„¶åŽåœ¨å¸¸é‡æ± ä¸­å¯»æ‰¾ï¼Œå¦‚æžœå¸¸é‡æ± ä¸­å­˜åœ¨helloçš„å­—ç¬¦ä¸²æ•°æ®ï¼Œåˆ™ç›´æŽ¥æŠŠs1æŒ‡å‘å¸¸é‡æ± ä¸­helloçš„åœ°å€ï¼› å¦åˆ™å°±ä¼šåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºhelloè¿™ä¸ªå­—ç¬¦ä¸²æ•°æ®ï¼Œç„¶åŽæŠŠs1æŒ‡å‘æ–°åˆ›å»ºçš„helloåœ°å€ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªStringç±»åž‹çš„å¼•ç”¨s2ï¼Œç„¶åŽåœ¨å¸¸é‡æ± ä¸­å¯»æ‰¾ï¼Œå¦‚æžœå¸¸é‡æ± ä¸­å­˜åœ¨è¯¥æ•°æ®ï¼Œåˆ™åœ¨å †ä¸­å¤åˆ¶æ‹·è´è¯¥æ•°æ®ï¼Œç„¶åŽæŠŠs2æŒ‡å‘å †ä¸­æ–°å»ºçš„åœ°å€ï¼› å¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼Œç„¶åŽè¿›è¡Œæ‹·è´ä¸€ä»½åˆ°å †ä¸­ï¼Œs2æŒ‡å‘å †ä¸­çš„åœ°å€ã€‚ é€šè¿‡newåˆ›å»ºçš„stringä¸€å®šä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä»½æ•°æ®ï¼ŒåŒæ—¶å¸¸é‡æ± è‚¯å®šæœ‰ä¸€ä¸ªå€¼çš„å¤‡ä»½æ“ä½œï¼›è€Œå•ç‹¬çš„å­—ç¬¦ä¸²åˆ™æ˜¯ç›´æŽ¥æŒ‡å‘å¸¸é‡æ± ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æ›´å¥½äº›ï¼Œå…·ä½“å¯çœ‹å¦‚ä¸‹çš„å›¾è§£ï¼š 2. å­—ç¬¦ä¸² + æ“ä½œ 1234567891011String s1="helloworld";String s2="hello" + "world";String s3=new String("hello") + "world";System.out.println(s1 == s2); // trueSystem.out.println(s2 == s3); // falseSystem.out.println(s1 == s3); // false ä»£ç ä¸­&quot;hello&quot; + &quot;world&quot;åœ¨ç¼–è¯‘æœŸå·²ç»çŸ¥é“äº†æ•°æ®æƒ…å†µï¼ˆä½¿ç”¨javacç¼–è¯‘æŸ¥çœ‹classæ–‡ä»¶ä¼šå‘çŽ°s1å’Œs2æ˜¯ä¸€è‡´çš„ï¼‰ï¼ŒJVMä¼šè‡ªåŠ¨ä¼˜åŒ–ä½¿å¾—s1å’Œs2æ˜¯ä¸€æ ·çš„ï¼Œs3ç”±äºŽæœ‰newæ“ä½œï¼Œæ‰€ä»¥éœ€è¦StringBuilderçš„appendå®Œæˆï¼Œå…·ä½“å¯çœ‹å¦‚ä¸‹å›¾è§£: 3. å­—ç¬¦ä¸²å˜é‡ + æ“ä½œ 123456789String s1="hello";String s2="world";String s3="helloworld";String s4=s1 + s2;System.out.println(s3 == s4); // false è¿™é‡Œçš„æ ·ä¾‹å’Œä¸Šä¸€ä¸ªæ ·ä¾‹å­˜åœ¨ä¸€äº›å·®åˆ«ï¼Œè¿™é‡Œçš„s4æ˜¯ç”±s1 + s2èŽ·å¾—çš„ï¼Œåœ¨ç¼–è¯‘æœŸæ— æ³•æ„ŸçŸ¥åˆ°å…¶å®žé™…å€¼ï¼Œåœ¨è¿è¡ŒæœŸæ—¶ä¼šåˆ©ç”¨StringBuilderçš„appendå‰©ä¸‹ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ‰€ä»¥s3æŒ‡å‘çš„æ˜¯å¸¸é‡æ± ï¼Œè€Œs4æŒ‡å‘çš„å †ï¼Œä¸¤è€…è‡ªç„¶æ˜¯ä¸ä¸€æ ·çš„ã€‚ 1s4 = new StringBuilder()).append(s1).append(s2).toString(); 5. å¸¦finalçš„å­—ç¬¦ä¸²å˜é‡ + æ“ä½œ 12345678910111213final String s1="hello";String s2="world";String s3="helloworld";String s4=s1 + "world";String s5=s1 + s2;System.out.println(s3 == s4); // trueSystem.out.println(s3 == s5); // false ä½¿ç”¨javacåç¼–è¯‘ä¹‹åŽçš„classæ–‡ä»¶å¦‚ä¸‹ï¼š 1234567891011String var1 = "world";String var2 = "helloworld";String var3 = "helloworld";String var4 = "hello" + var1;System.out.println(var2 == var3);System.out.println(var2 == var4); æ·»åŠ äº†finalå…³é”®å­—ä¿®é¥°çš„å˜é‡åœ¨ç¼–è¯‘æœŸä¼šè¢«å¯¹åº”çš„å­—ç¬¦ä¸²ç›´æŽ¥æ›¿æ¢æŽ‰ï¼Œç›¸å½“äºŽå­—ç¬¦ä¸²æ•°æ®ï¼Œè€ŒåŒ…å«äº†å­—ç¬¦ä¸²å˜é‡çš„+æ“ä½œåˆ™ä¾æ—§æ˜¯ä½¿ç”¨äº†StringBuilderã€‚ 5. intern()æ–¹æ³• String.internæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼ŒèŽ·å–çš„æ˜¯å½“å‰å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± çš„æ•°æ®ï¼Œå¦‚æžœå¸¸é‡æ± å­˜åœ¨è¯¥æ•°æ®åˆ™ç›´æŽ¥è¿”å›žï¼Œå¦‚æžœä¸å­˜åœ¨åˆ™æŠŠè¯¥æ•°æ®æ·»åŠ åˆ°å¸¸é‡æ± ä¸­åŽè¿”å›žï¼Œæ‰€ä»¥æœ‰**String s1 = &quot;abc&quot; å’Œ String s2 = s1.intern() ä¸­çš„s1 == s2å’ŒString s1=&quot;world&quot; å’Œ String s2=new String(&quot;world&quot;) ä¸­ s1.intern() == s2.intern()**1 6. æ€»ç»“ String æœ¬èº«æ˜¯finalç±»åž‹çš„ç±»ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨ä¸­éœ€è¦é¢‘ç¹çš„åšå­—ç¬¦ä¸²åˆå¹¶æ“ä½œæ—¶ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨StringBuilderï¼ˆå¦‚éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨åˆ™ä½¿ç”¨StringBufferï¼‰ï¼Œé™ä½Žæ— è°“çš„å­—ç¬¦ä¸²åˆ›å»ºæ“ä½œï¼Œåœ¨ä¿è¯å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæé«˜æ•ˆçŽ‡ï¼]]></content>
      <categories>
        <category>Java</category>
        <category>é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¼‚å¸¸å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fe60072fb.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯å¼‚å¸¸ å¼‚å¸¸æœ¬è´¨ä¸Šæ˜¯ç¨‹åºä¸Šçš„é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯åŒ…æ‹¬ç¨‹åºé€»è¾‘é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯ã€‚é”™è¯¯åœ¨ç¨‹åºä¸­åˆæœ‰è¿è¡Œæ—¶å¼‚å¸¸å’Œç¼–è¯‘æ—¶å¼‚å¸¸ã€‚ ç¼–è¯‘å¼‚å¸¸åœ¨ç¼–è¯‘æœŸé—´å‡ºé”™æœ‰ç¼–è¯‘å™¨å¸®åŠ©é”™ï¼Œç„¶è€Œè¿è¡ŒæœŸé—´çš„é”™è¯¯ç¼–è¯‘å™¨åˆ™éž­é•¿èŽ«åŠäº†ï¼Œå¹¶ä¸”è¿è¡ŒæœŸé—´çš„é”™è¯¯å¾€å¾€æ˜¯éš¾ä»¥é¢„æ–™çš„ï¼Œä½†æ˜¯å¦‚æžœä¸å¤„ç†è¿™äº›å¼‚å¸¸åˆ™ä¼šç›´æŽ¥å¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤åœ¨è¿è¡ŒæœŸé—´å‡ºçŽ°é”™è¯¯åº”è¯¥å¦‚ä½•æ¥è¡¥æ•‘æ˜µï¼ŸJavaæä¾›äº†å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†è¿™äº›é”™è¯¯ã€‚ å¼‚å¸¸åˆ†ç±» åœ¨Javaä¸­çš„å¼‚å¸¸è¢«å½“åšå¯¹è±¡æ¥å¤„ç†ï¼Œæ ¹ç±»ä¸ºjava.lang.Throwableç±»ï¼Œåœ¨Javaä¸­å®šä¹‰äº†å¾ˆå¤šå¼‚å¸¸ç±»ï¼ˆå¦‚OutOfMemoryErrorã€NullPointerExceptionã€IndexOutOfBoundsExceptionç­‰ï¼‰ï¼Œè¿™äº›å¼‚å¸¸ç±»åˆ†ä¸ºä¸¤å¤§ç±»ï¼šErrorå’ŒExceptionã€‚ Error Erroræ˜¯æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œæ¯”å¦‚OutOfMemoryErrorï¼Œä¸€èˆ¬å‘ç”Ÿè¿™ç§å¼‚å¸¸ï¼ŒJVMä¼šè‡ªåŠ¨ç»ˆæ­¢ç¨‹åºï¼Œå› æ­¤ç¼–å†™ç¨‹åºæ—¶ä¸éœ€è¦å…³å¿ƒè¿™ç±»å¼‚å¸¸ã€‚ Exception Exceptionï¼Œæ˜¯ç»å¸¸è§åˆ°çš„ä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œæ¯”å¦‚NullPointerExceptionï¼Œè¿™äº›å¼‚å¸¸æ˜¯å¯ä»¥å¤„ç†çš„ã€‚ Exceptionç±»çš„å¼‚å¸¸åŒ…æ‹¬checked exceptionå’Œunchecked exceptionï¼ˆunchecked exceptionä¹Ÿç§°è¿è¡Œæ—¶å¼‚å¸¸RuntimeExceptionï¼Œå½“ç„¶è¿™é‡Œçš„è¿è¡Œæ—¶å¼‚å¸¸å¹¶ä¸æ˜¯å‰é¢æ‰€è¯´çš„è¿è¡ŒæœŸé—´çš„å¼‚å¸¸ï¼Œåªæ˜¯Javaä¸­ç”¨è¿è¡Œæ—¶å¼‚å¸¸è¿™ä¸ªæœ¯è¯­æ¥è¡¨ç¤ºï¼ŒExceptionç±»çš„å¼‚å¸¸éƒ½æ˜¯åœ¨è¿è¡ŒæœŸé—´å‘ç”Ÿçš„ï¼‰ã€‚ unchecked exceptionï¼ˆéžæ£€æŸ¥å¼‚å¸¸ï¼‰ï¼Œä¹Ÿç§°è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼Œæ¯”å¦‚å¸¸è§çš„NullPointerExceptionã€IndexOutOfBoundsExceptionã€‚å¯¹äºŽè¿è¡Œæ—¶å¼‚å¸¸ï¼Œjavaç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»è¿›è¡Œå¼‚å¸¸æ•èŽ·å¤„ç†æˆ–è€…æŠ›å‡ºå£°æ˜Žï¼Œç”±ç¨‹åºå‘˜è‡ªè¡Œå†³å®šã€‚ checked exceptionï¼ˆæ£€æŸ¥å¼‚å¸¸ï¼‰ï¼Œä¹Ÿç§°éžè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ä»¥å¤–çš„å¼‚å¸¸å°±æ˜¯éžè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œjavaç¼–è¯‘å™¨å¼ºåˆ¶ç¨‹åºå‘˜å¿…é¡»è¿›è¡Œæ•èŽ·å¤„ç†ï¼Œæ¯”å¦‚å¸¸è§çš„IOExeptionå’ŒSQLExceptionã€‚å¯¹äºŽéžè¿è¡Œæ—¶å¼‚å¸¸å¦‚æžœä¸è¿›è¡Œæ•èŽ·æˆ–è€…æŠ›å‡ºå£°æ˜Žå¤„ç†ï¼Œç¼–è¯‘éƒ½ä¸ä¼šé€šè¿‡ã€‚ åœ¨Javaä¸­ï¼Œæ‰€æœ‰å¼‚å¸¸ç±»çš„çˆ¶ç±»æ˜¯Throwableç±»ï¼ŒErrorç±»æ˜¯errorç±»åž‹å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒExceptionç±»æ˜¯exceptionç±»åž‹å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒRuntimeExceptionç±»æ˜¯æ‰€æœ‰è¿è¡Œæ—¶å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒRuntimeExceptionä»¥å¤–çš„å¹¶ä¸”ç»§æ‰¿Exceptionçš„ç±»æ˜¯éžè¿è¡Œæ—¶å¼‚å¸¸ã€‚ å…¸åž‹çš„RuntimeExceptionåŒ…æ‹¬NullPointerExceptionã€IndexOutOfBoundsExceptionã€IllegalArgumentExceptionç­‰ã€‚ å…¸åž‹çš„éžRuntimeExceptionåŒ…æ‹¬IOExceptionã€SQLExceptionç­‰ã€‚ Javaä¸­å¦‚ä½•å¤„ç†å¼‚å¸¸ åœ¨Javaä¸­å¦‚æžœéœ€è¦å¤„ç†å¼‚å¸¸ï¼Œå¿…é¡»å…ˆå¯¹å¼‚å¸¸è¿›è¡Œæ•èŽ·ï¼Œç„¶åŽå†å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå¤„ç†ã€‚ å¦‚ä½•å¯¹å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç è¿›è¡Œå¼‚å¸¸æ•èŽ·å’Œå¤„ç†å‘¢ï¼Ÿä½¿ç”¨tryå’Œcatchå…³é”®å­—å³å¯ã€‚ æ•èŽ·å¼‚å¸¸ 12345678910111213try &#123; File file = new File("d:/a.txt"); if(!file.exists()) file.createNewFile();&#125; catch (IOException e) &#123;// TODO: handle exception&#125; åœ¨tryä¸­å‘ç”Ÿçš„å¼‚å¸¸ï¼Œå°†äº¤ç”±catchè¿›è¡Œå¤„ç†ã€‚ æŠ›å‡ºå¼‚å¸¸ 123456789101112131415161718192021222324252627public class Main &#123; public static void main(String[] args) &#123; try &#123; createFile(); &#125; catch (Exception e) &#123; // TODO: handle exception &#125; &#125; public static void createFile() throws IOException&#123; File file = new File("d:/a.txt"); if(!file.exists()) file.createNewFile(); &#125;&#125; åœ¨createFile()ä¸­å¹¶æ²¡æœ‰å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯ç”¨throwså…³é”®å­—å£°æ˜ŽæŠ›å‡ºå¼‚å¸¸ï¼Œå³å‘ŠçŸ¥è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…æ­¤æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºIOExceptionã€‚é‚£ä¹ˆåœ¨mainæ–¹æ³•ä¸­è°ƒç”¨createFileæ–¹æ³•çš„æ—¶å€™ï¼Œé‡‡ç”¨try...catchå—è¿›è¡Œäº†å¼‚å¸¸æ•èŽ·å¤„ç†ã€‚ throwå…³é”®å­—æ‰‹åŠ¨æ¥æŠ›å‡ºå¼‚å¸¸ 1234567891011121314151617181920212223242526272829public class Main &#123; public static void main(String[] args) &#123; try &#123; int[] data = new int[]&#123;1,2,3&#125;; System.out.println(getDataByIndex(-1,data)); &#125; catch (Exception e) &#123; System.out.println(e.getMessage()); &#125; &#125; public static int getDataByIndex(int index,int[] data) &#123; if(index&lt;0||index&gt;=data.length) throw new ArrayIndexOutOfBoundsException("æ•°ç»„ä¸‹æ ‡è¶Šç•Œ"); return data[index]; &#125;&#125; ç„¶åŽåœ¨catchå—ä¸­è¿›è¡Œæ•èŽ·ã€‚ åœ¨Javaä¸­è¿›è¡Œå¼‚å¸¸å¤„ç†çš„è¯ï¼Œå¯¹äºŽå¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„ä»£ç ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§æ–¹æ³•æ¥è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼š1ï¼‰å¯¹ä»£ç å—ç”¨try..catchè¿›è¡Œå¼‚å¸¸æ•èŽ·å¤„ç†ï¼›2ï¼‰åœ¨è¯¥ä»£ç çš„æ–¹æ³•ä½“å¤–ç”¨throwsè¿›è¡ŒæŠ›å‡ºå£°æ˜Žï¼Œå‘ŠçŸ¥æ­¤æ–¹æ³•çš„è°ƒç”¨è€…è¿™æ®µä»£ç å¯èƒ½ä¼šå‡ºçŽ°è¿™äº›å¼‚å¸¸ï¼Œéœ€è¦è°¨æ…Žå¤„ç†ã€‚æ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼šå¦‚æžœå£°æ˜ŽæŠ›å‡ºçš„å¼‚å¸¸æ˜¯éžè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºåœ°ç”¨try..catchå—è¿›è¡Œæ•èŽ·æˆ–è€…ç»§ç»­å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æžœå£°æ˜ŽæŠ›å‡ºçš„å¼‚å¸¸æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥é€‰æ‹©åœ°è¿›è¡Œå¼‚å¸¸æ•èŽ·å¤„ç†ã€‚3ï¼‰åœ¨ä»£ç å—ç”¨throwæ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œæ­¤æ—¶ä¹Ÿæœ‰ä¸¤ç§æƒ…å†µï¼Œè·Ÿ2ï¼‰ä¸­çš„ç±»ä¼¼ï¼šå¦‚æžœæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡æ˜¯éžè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºåœ°ç”¨try..catchå—è¿›è¡Œæ•èŽ·æˆ–è€…ç»§ç»­å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æžœæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥é€‰æ‹©åœ°è¿›è¡Œå¼‚å¸¸æ•èŽ·å¤„ç†ã€‚ï¼ˆå¦‚æžœæœ€ç»ˆå°†å¼‚å¸¸æŠ›ç»™mainæ–¹æ³•ï¼Œåˆ™ç›¸å½“äºŽäº¤ç»™jvmè‡ªåŠ¨å¤„ç†ï¼Œæ­¤æ—¶jvmä¼šç®€å•åœ°æ‰“å°å¼‚å¸¸ä¿¡æ¯ï¼‰ä¸€ä¸ªæ–¹æ³•æ‰€èƒ½æ•æ‰çš„å¼‚å¸¸ï¼Œä¸€å®šæ˜¯Javaä»£ç åœ¨æŸå¤„æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ç®€å•åœ°è¯´ï¼Œå¼‚å¸¸æ€»æ˜¯å…ˆè¢«æŠ›å‡ºï¼ŒåŽè¢«æ•æ‰çš„ã€‚ ç†è§£try,catch,finally,throws,throwäº”ä¸ªå…³é”®å­— try,catch,finally tryå…³é”®å­—ç”¨æ¥åŒ…å›´å¯èƒ½ä¼šå‡ºçŽ°å¼‚å¸¸çš„é€»è¾‘ä»£ç ï¼Œå®ƒå•ç‹¬æ— æ³•ä½¿ç”¨ï¼Œå¿…é¡»é…åˆcatchæˆ–è€…finallyä½¿ç”¨ã€‚Javaç¼–è¯‘å™¨å…è®¸çš„ç»„åˆä½¿ç”¨å½¢å¼åªæœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š try...catch...; try....finally......; try....catch...finally... å½“ç„¶catchå—å¯ä»¥æœ‰å¤šä¸ªï¼Œæ³¨æ„tryå—åªèƒ½æœ‰ä¸€ä¸ª,finallyå—æ˜¯å¯é€‰çš„ï¼ˆä½†æ˜¯æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªfinallyå—ï¼‰ã€‚ ä¸‰ä¸ªå—æ‰§è¡Œçš„é¡ºåºä¸ºtryâ€”&gt;catchâ€”&gt;finallyã€‚ å½“ç„¶å¦‚æžœæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™catchå—ä¸ä¼šæ‰§è¡Œã€‚ä½†æ˜¯finallyå—æ— è®ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹éƒ½æ˜¯ä¼šæ‰§è¡Œçš„ï¼ˆè¿™ç‚¹è¦éžå¸¸æ³¨æ„ï¼Œå› æ­¤éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½ä¼šå°†é‡Šæ”¾èµ„æºçš„æ“ä½œæ”¾åœ¨finallyå—ä¸­è¿›è¡Œï¼‰ã€‚ åœ¨æœ‰å¤šä¸ªcatchå—çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§catchå—çš„å…ˆåŽé¡ºåºè¿›è¡ŒåŒ¹é…çš„ï¼Œä¸€æ—¦å¼‚å¸¸ç±»åž‹è¢«ä¸€ä¸ªcatchå—åŒ¹é…ï¼Œåˆ™ä¸ä¼šä¸ŽåŽé¢çš„catchå—è¿›è¡ŒåŒ¹é…ã€‚ åœ¨ä½¿ç”¨try..catch..finallyå—çš„æ—¶å€™ï¼Œæ³¨æ„åƒä¸‡ä¸è¦åœ¨finallyå—ä¸­ä½¿ç”¨returnï¼Œå› ä¸ºfinallyä¸­çš„returnä¼šè¦†ç›–å·²æœ‰çš„è¿”å›žå€¼ã€‚ 1234567891011121314151617181920212223242526272829303132public String openFile() &#123; try &#123; FileInputStream inputStream = new FileInputStream("d:/a.txt"); int ch = inputStream.read(); System.out.println("aaa"); return "step1"; &#125; catch (FileNotFoundException e) &#123; System.out.println("file not found"); return "step2"; &#125;catch (IOException e) &#123; System.out.println("io exception"); return "step3"; &#125;finally&#123; System.out.println("finally block"); return "finally"; &#125;&#125; è¿™é‡Œfinallyä¸­çš„è¿”å›žå€¼å›žå§catché‡Œé¢çš„è¿”å›žå€¼ç»™è¦†ç›–ï¼Œä¹Ÿä¼šæŠŠtryä¸­çš„returnè¦†ç›–æŽ‰ã€‚ä»Žè°ƒè¯•ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œtryä¸­å°±ç®—æœ‰returnï¼Œä¹Ÿä¼šæ‰§è¡Œfinallyä¸­ã€‚ æ€»ç»“ï¼š try å—ï¼šç”¨äºŽæ•èŽ·å¼‚å¸¸ã€‚å…¶åŽå¯æŽ¥é›¶ä¸ªæˆ–å¤šä¸ªcatchå—ï¼Œå¦‚æžœæ²¡æœ‰catchå—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ªfinallyå—ã€‚catch å—ï¼šç”¨äºŽå¤„ç†tryæ•èŽ·åˆ°çš„å¼‚å¸¸ã€‚finally å—ï¼šæ— è®ºæ˜¯å¦æ•èŽ·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinallyå—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨tryå—æˆ–catchå—ä¸­é‡åˆ°returnè¯­å¥æ—¶ï¼Œfinallyè¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›žä¹‹å‰è¢«æ‰§è¡Œã€‚åœ¨ä»¥ä¸‹4ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œfinallyå—ä¸ä¼šè¢«æ‰§è¡Œï¼š1ï¼‰åœ¨finallyè¯­å¥å—ä¸­å‘ç”Ÿäº†å¼‚å¸¸ã€‚2ï¼‰åœ¨å‰é¢çš„ä»£ç ä¸­ç”¨äº†System.exit()é€€å‡ºç¨‹åºã€‚3ï¼‰ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚4ï¼‰å…³é—­CPUã€‚ throwså’Œthowå…³é”®å­— throwså‡ºçŽ°åœ¨æ–¹æ³•çš„å£°æ˜Žä¸­ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œç„¶åŽäº¤ç»™ä¸Šå±‚è°ƒç”¨å®ƒçš„æ–¹æ³•ç¨‹åºå¤„ç†ï¼Œå…è®¸throwsåŽé¢è·Ÿç€å¤šä¸ªå¼‚å¸¸ç±»åž‹ï¼› throwä¸€èˆ¬ä¼šç”¨äºŽç¨‹åºå‡ºçŽ°æŸç§é€»è¾‘æ—¶ç¨‹åºå‘˜ä¸»åŠ¨æŠ›å‡ºæŸç§ç‰¹å®šç±»åž‹çš„å¼‚å¸¸ã€‚throwåªä¼šå‡ºçŽ°åœ¨æ–¹æ³•ä½“ä¸­ï¼Œå½“æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸æƒ…å†µæ—¶ï¼Œå°†å¼‚å¸¸ä¿¡æ¯å°è£…ä¸ºå¼‚å¸¸å¯¹è±¡ï¼Œç„¶åŽthrowå‡ºåŽ»ã€‚throwå…³é”®å­—çš„ä¸€ä¸ªéžå¸¸é‡è¦çš„ä½œç”¨å°±æ˜¯å¼‚å¸¸ç±»åž‹çš„è½¬æ¢ã€‚ throwsè¡¨ç¤ºå‡ºçŽ°å¼‚å¸¸çš„ä¸€ç§å¯èƒ½æ€§ï¼Œå¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™äº›å¼‚å¸¸ï¼›throwåˆ™æ˜¯æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰§è¡Œthrowåˆ™ä¸€å®šæŠ›å‡ºäº†æŸç§å¼‚å¸¸å¯¹è±¡ã€‚ä¸¤è€…éƒ½æ˜¯æ¶ˆæžå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼ˆè¿™é‡Œçš„æ¶ˆæžå¹¶ä¸æ˜¯è¯´è¿™ç§æ–¹å¼ä¸å¥½ï¼‰ï¼Œåªæ˜¯æŠ›å‡ºæˆ–è€…å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä¸ä¼šç”±æ–¹æ³•åŽ»å¤„ç†å¼‚å¸¸ï¼ŒçœŸæ­£çš„å¤„ç†å¼‚å¸¸ç”±æ­¤æ–¹æ³•çš„ä¸Šå±‚è°ƒç”¨å¤„ç†ã€‚ å¼‚å¸¸å¤„ç†å»ºè®® åªåœ¨å¿…è¦ä½¿ç”¨å¼‚å¸¸çš„åœ°æ–¹æ‰ä½¿ç”¨å¼‚å¸¸ï¼Œä¸è¦ç”¨å¼‚å¸¸åŽ»æŽ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚è°¨æ…Žåœ°ä½¿ç”¨å¼‚å¸¸ï¼šå¼‚å¸¸æ•èŽ·çš„ä»£ä»·éžå¸¸é«˜æ˜‚ï¼Œå¼‚å¸¸ä½¿ç”¨è¿‡å¤šä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å¦‚æžœåœ¨ç¨‹åºä¸­èƒ½å¤Ÿç”¨ifè¯­å¥å’ŒBooleanå˜é‡æ¥è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼Œé‚£ä¹ˆå°½é‡å‡å°‘å¼‚å¸¸çš„ä½¿ç”¨ï¼Œä»Žè€Œé¿å…ä¸å¿…è¦çš„å¼‚å¸¸æ•èŽ·å’Œå¤„ç†ã€‚åˆ‡å¿Œä½¿ç”¨ç©ºcatchå—åœ¨æ•èŽ·äº†å¼‚å¸¸ä¹‹åŽä»€ä¹ˆéƒ½ä¸åšï¼Œç›¸å½“äºŽå¿½ç•¥äº†è¿™ä¸ªå¼‚å¸¸ã€‚åƒä¸‡ä¸è¦ä½¿ç”¨ç©ºçš„catchå—ï¼Œç©ºçš„catchå—æ„å‘³ç€ä½ åœ¨ç¨‹åºä¸­éšè—äº†é”™è¯¯å’Œå¼‚å¸¸ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½å¯¼è‡´ç¨‹åºå‡ºçŽ°ä¸å¯æŽ§çš„æ‰§è¡Œç»“æžœã€‚å¦‚æžœä½ éžå¸¸è‚¯å®šæ•èŽ·åˆ°çš„å¼‚å¸¸ä¸ä¼šä»¥ä»»ä½•æ–¹å¼å¯¹ç¨‹åºé€ æˆå½±å“ï¼Œæœ€å¥½ç”¨Logæ—¥å¿—å°†è¯¥å¼‚å¸¸è¿›è¡Œè®°å½•ï¼Œä»¥ä¾¿æ—¥åŽæ–¹ä¾¿æ›´æ–°å’Œç»´æŠ¤ã€‚æ£€æŸ¥å¼‚å¸¸å’Œéžæ£€æŸ¥å¼‚å¸¸çš„é€‰æ‹©ä¸€æ—¦å†³å®šæŠ›å‡ºå¼‚å¸¸ï¼Œå°±è¦å†³å®šæŠ›å‡ºä»€ä¹ˆå¼‚å¸¸ã€‚è¿™é‡Œé¢çš„ä¸»è¦é—®é¢˜å°±æ˜¯æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸è¿˜æ˜¯éžæ£€æŸ¥å¼‚å¸¸ã€‚æ£€æŸ¥å¼‚å¸¸å¯¼è‡´äº†å¤ªå¤šçš„tryâ€¦catchä»£ç ï¼Œå¯èƒ½æœ‰å¾ˆå¤šæ£€æŸ¥å¼‚å¸¸å¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯æ— æ³•åˆç†åœ°è¿›è¡Œå¤„ç†çš„ï¼Œæ¯”å¦‚SQLExceptionï¼Œè€Œå¼€å‘äººå‘˜å´ä¸å¾—ä¸åŽ»è¿›è¡Œtryâ€¦catchï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç»å¸¸å‡ºçŽ°è¿™æ ·ä¸€ç§æƒ…å†µï¼šé€»è¾‘ä»£ç åªæœ‰å¾ˆå°‘çš„å‡ è¡Œï¼Œè€Œè¿›è¡Œå¼‚å¸¸æ•èŽ·å’Œå¤„ç†çš„ä»£ç å´æœ‰å¾ˆå¤šè¡Œã€‚è¿™æ ·ä¸ä»…å¯¼è‡´é€»è¾‘ä»£ç é˜…è¯»èµ·æ¥æ™¦æ¶©éš¾æ‡‚ï¼Œè€Œä¸”é™ä½Žäº†ç¨‹åºçš„æ€§èƒ½ã€‚å»ºè®®å°½é‡é¿å…æ£€æŸ¥å¼‚å¸¸çš„ä½¿ç”¨ï¼Œå¦‚æžœç¡®å®žè¯¥å¼‚å¸¸æƒ…å†µçš„å‡ºçŽ°å¾ˆæ™®éï¼Œéœ€è¦æé†’è°ƒç”¨è€…æ³¨æ„å¤„ç†çš„è¯ï¼Œå°±ä½¿ç”¨æ£€æŸ¥å¼‚å¸¸ï¼›å¦åˆ™ä½¿ç”¨éžæ£€æŸ¥å¼‚å¸¸ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°½é‡å°†æ£€æŸ¥å¼‚å¸¸è½¬å˜ä¸ºéžæ£€æŸ¥å¼‚å¸¸äº¤ç»™ä¸Šå±‚å¤„ç†ã€‚æ³¨æ„catchå—çš„é¡ºåºï¼Œä¸è¦æŠŠä¸Šå±‚ç±»çš„å¼‚å¸¸æ”¾åœ¨æœ€å‰é¢çš„catchå—ã€‚ä¸è¦å°†æä¾›ç»™ç”¨æˆ·çœ‹çš„ä¿¡æ¯æ”¾åœ¨å¼‚å¸¸ä¿¡æ¯é‡Œã€‚é¿å…å¤šæ¬¡åœ¨æ—¥å¿—ä¿¡æ¯ä¸­è®°å½•åŒä¸€ä¸ªå¼‚å¸¸åªåœ¨å¼‚å¸¸æœ€å¼€å§‹å‘ç”Ÿçš„åœ°æ–¹è¿›è¡Œæ—¥å¿—ä¿¡æ¯è®°å½•ã€‚å¾ˆå¤šæƒ…å†µä¸‹å¼‚å¸¸éƒ½æ˜¯å±‚å±‚å‘ä¸Šè·‘å‡ºçš„ï¼Œå¦‚æžœåœ¨æ¯æ¬¡å‘ä¸ŠæŠ›å‡ºçš„æ—¶å€™ï¼Œéƒ½Logåˆ°æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œåˆ™ä¼šå¯¼è‡´æ— ä»ŽæŸ¥æ‰¾å¼‚å¸¸å‘ç”Ÿçš„æ ¹æºã€‚å¼‚å¸¸å¤„ç†å°½é‡æ”¾åœ¨é«˜å±‚è¿›è¡Œå°½é‡å°†å¼‚å¸¸ç»Ÿä¸€æŠ›ç»™ä¸Šå±‚è°ƒç”¨è€…ï¼Œç”±ä¸Šå±‚è°ƒç”¨è€…ç»Ÿä¸€ä¹‹æ—¶å¦‚ä½•è¿›è¡Œå¤„ç†ã€‚å¦‚æžœåœ¨æ¯ä¸ªå‡ºçŽ°å¼‚å¸¸çš„åœ°æ–¹éƒ½ç›´æŽ¥è¿›è¡Œå¤„ç†ï¼Œä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸å¤„ç†æµç¨‹æ··ä¹±ï¼Œä¸åˆ©äºŽåŽæœŸç»´æŠ¤å’Œå¼‚å¸¸é”™è¯¯æŽ’æŸ¥ã€‚ç”±ä¸Šå±‚ç»Ÿä¸€è¿›è¡Œå¤„ç†ä¼šä½¿å¾—æ•´ä¸ªç¨‹åºçš„æµç¨‹æ¸…æ™°æ˜“æ‡‚ã€‚åœ¨finallyä¸­é‡Šæ”¾èµ„æºå¦‚æžœæœ‰ä½¿ç”¨æ–‡ä»¶è¯»å–ã€ç½‘ç»œæ“ä½œä»¥åŠæ•°æ®åº“æ“ä½œç­‰ï¼Œè®°å¾—åœ¨finallyä¸­é‡Šæ”¾èµ„æºã€‚è¿™æ ·ä¸ä»…ä¼šä½¿å¾—ç¨‹åºå ç”¨æ›´å°‘çš„èµ„æºï¼Œä¹Ÿä¼šé¿å…ä¸å¿…è¦çš„ç”±äºŽèµ„æºæœªé‡Šæ”¾è€Œå‘ç”Ÿçš„å¼‚å¸¸æƒ…å†µã€‚é¿å…è¿‡å¤§çš„tryå—ï¼Œä¸è¦æŠŠä¸ä¼šå‡ºçŽ°å¼‚å¸¸çš„ä»£ç æ”¾åˆ°tryå—é‡Œé¢ï¼Œå°½é‡ä¿æŒä¸€ä¸ªtryå—å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªå¼‚å¸¸ã€‚ç»†åŒ–å¼‚å¸¸çš„ç±»åž‹ï¼Œä¸è¦ä¸ç®¡ä»€ä¹ˆç±»åž‹çš„å¼‚å¸¸éƒ½å†™æˆExcetpionã€‚catchå—å°½é‡ä¿æŒä¸€ä¸ªå—æ•èŽ·ä¸€ç±»å¼‚å¸¸ï¼Œä¸è¦å¿½ç•¥æ•èŽ·çš„å¼‚å¸¸ï¼Œæ•èŽ·åˆ°åŽè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆè½¬è¯‘ï¼Œè¦ä¹ˆé‡æ–°æŠ›å‡ºæ–°ç±»åž‹çš„å¼‚å¸¸ã€‚ä¸è¦æŠŠè‡ªå·±èƒ½å¤„ç†çš„å¼‚å¸¸æŠ›ç»™åˆ«äººã€‚ä¸è¦ç”¨try...catchå‚ä¸ŽæŽ§åˆ¶ç¨‹åºæµç¨‹ï¼Œå¼‚å¸¸æŽ§åˆ¶çš„æ ¹æœ¬ç›®çš„æ˜¯å¤„ç†ç¨‹åºçš„éžæ­£å¸¸æƒ…å†µã€‚ Throwableç±»ä¸­çš„å¸¸ç”¨æ–¹æ³• catchå…³é”®å­—åŽé¢æ‹¬å·ä¸­çš„Exceptionç±»åž‹çš„å‚æ•°eã€‚Exceptionå°±æ˜¯tryä»£ç å—ä¼ é€’ç»™catchä»£ç å—çš„å˜é‡ç±»åž‹ï¼Œeå°±æ˜¯å˜é‡åã€‚catchä»£ç å—ä¸­è¯­å¥&quot;e.getMessage();&quot;ç”¨äºŽè¾“å‡ºé”™è¯¯æ€§è´¨ã€‚é€šå¸¸å¼‚å¸¸å¤„ç†å¸¸ç”¨3ä¸ªå‡½æ•°æ¥èŽ·å–å¼‚å¸¸çš„æœ‰å…³ä¿¡æ¯: getCause()ï¼šè¿”å›žæŠ›å‡ºå¼‚å¸¸çš„åŽŸå› ã€‚å¦‚æžœ cause ä¸å­˜åœ¨æˆ–æœªçŸ¥ï¼Œåˆ™è¿”å›ž nullã€‚ getMeage()ï¼šè¿”å›žå¼‚å¸¸çš„æ¶ˆæ¯ä¿¡æ¯ã€‚ printStackTrace()ï¼šå¯¹è±¡çš„å †æ ˆè·Ÿè¸ªè¾“å‡ºè‡³é”™è¯¯è¾“å‡ºæµï¼Œä½œä¸ºå­—æ®µ System.err çš„å€¼ã€‚ æœ‰æ—¶ä¸ºäº†ç®€å•ä¼šå¿½ç•¥æŽ‰catchè¯­å¥åŽçš„ä»£ç ï¼Œè¿™æ ·try-catchè¯­å¥å°±æˆäº†ä¸€ç§æ‘†è®¾ï¼Œä¸€æ—¦ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºçŽ°äº†å¼‚å¸¸ï¼Œå°±ä¼šå¿½ç•¥å¤„ç†å¼‚å¸¸ï¼Œè€Œé”™è¯¯å‘ç”Ÿçš„åŽŸå› å¾ˆéš¾æŸ¥æ‰¾ã€‚ Javaå¸¸è§å¼‚å¸¸ runtimeExceptionå­ç±» java.lang.ArrayIndexOutOfBoundsException æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚å½“å¯¹æ•°ç»„çš„ç´¢å¼•å€¼ä¸ºè´Ÿæ•°æˆ–å¤§äºŽç­‰äºŽæ•°ç»„å¤§å°æ—¶æŠ›å‡ºã€‚ java.lang.ArithmeticException ç®—æœ¯æ¡ä»¶å¼‚å¸¸ã€‚è­¬å¦‚ï¼šæ•´æ•°é™¤é›¶ç­‰ã€‚ java.lang.NullPointerException ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾åœ¨è¦æ±‚ä½¿ç”¨å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨äº†nullæ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è­¬å¦‚ï¼šè°ƒç”¨nullå¯¹è±¡çš„å®žä¾‹æ–¹æ³•ã€è®¿é—®nullå¯¹è±¡çš„å±žæ€§ã€è®¡ç®—nullå¯¹è±¡çš„é•¿åº¦ã€ä½¿ç”¨throwè¯­å¥æŠ›å‡ºnullç­‰ç­‰ java.lang.ClassNotFoundException æ‰¾ä¸åˆ°ç±»å¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾æ ¹æ®å­—ç¬¦ä¸²å½¢å¼çš„ç±»åæž„é€ ç±»ï¼Œè€Œåœ¨éåŽ†CLASSPAHä¹‹åŽæ‰¾ä¸åˆ°å¯¹åº”åç§°çš„classæ–‡ä»¶æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ java.lang.NegativeArraySizeException æ•°ç»„é•¿åº¦ä¸ºè´Ÿå¼‚å¸¸ java.lang.ArrayStoreException æ•°ç»„ä¸­åŒ…å«ä¸å…¼å®¹çš„å€¼æŠ›å‡ºçš„å¼‚å¸¸ java.lang.SecurityException å®‰å…¨æ€§å¼‚å¸¸ java.lang.IllegalArgumentException éžæ³•å‚æ•°å¼‚å¸¸ IOException IOExceptionï¼šæ“ä½œè¾“å…¥æµå’Œè¾“å‡ºæµæ—¶å¯èƒ½å‡ºçŽ°çš„å¼‚å¸¸ã€‚ EOFExceptionï¼šæ–‡ä»¶å·²ç»“æŸå¼‚å¸¸ FileNotFoundExceptionï¼šæ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸ å…¶ä»–å¼‚å¸¸ ClassCastExceptionï¼šç±»åž‹è½¬æ¢å¼‚å¸¸ç±» ArrayStoreExceptionï¼šæ•°ç»„ä¸­åŒ…å«ä¸å…¼å®¹çš„å€¼æŠ›å‡ºçš„å¼‚å¸¸ SQLExceptionï¼šæ“ä½œæ•°æ®åº“å¼‚å¸¸ç±» NoSuchFieldExceptionï¼šå­—æ®µæœªæ‰¾åˆ°å¼‚å¸¸ NoSuchMethodExceptionï¼šæ–¹æ³•æœªæ‰¾åˆ°æŠ›å‡ºçš„å¼‚å¸¸ NumberFormatExceptionï¼šå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æŠ›å‡ºçš„å¼‚å¸¸ StringIndexOutOfBoundsExceptionï¼šå­—ç¬¦ä¸²ç´¢å¼•è¶…å‡ºèŒƒå›´æŠ›å‡ºçš„å¼‚å¸¸ IllegalAccessExceptionï¼šä¸å…è®¸è®¿é—®æŸç±»å¼‚å¸¸ InstantiationExceptionï¼šå½“åº”ç”¨ç¨‹åºè¯•å›¾ä½¿ç”¨Classç±»ä¸­çš„newInstance()æ–¹æ³•åˆ›å»ºä¸€ä¸ªç±»çš„å®žä¾‹ï¼Œè€ŒæŒ‡å®šçš„ç±»å¯¹è±¡æ— æ³•è¢«å®žä¾‹åŒ–æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ è‡ªå®šä¹‰å¼‚å¸¸ ä½¿ç”¨Javaå†…ç½®çš„å¼‚å¸¸ç±»å¯ä»¥æè¿°åœ¨ç¼–ç¨‹æ—¶å‡ºçŽ°çš„å¤§éƒ¨åˆ†å¼‚å¸¸æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ã€‚ç”¨æˆ·è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œåªéœ€ç»§æ‰¿Exceptionç±»å³å¯ã€‚ åœ¨ç¨‹åºä¸­ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå¤§ä½“å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚ ï¼ˆ1ï¼‰åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»ã€‚ ï¼ˆ2ï¼‰åœ¨æ–¹æ³•ä¸­é€šè¿‡throwå…³é”®å­—æŠ›å‡ºå¼‚å¸¸å¯¹è±¡ã€‚ ï¼ˆ3ï¼‰å¦‚æžœåœ¨å½“å‰æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ä¸­å¤„ç†å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨try-catchè¯­å¥æ•èŽ·å¹¶å¤„ç†ï¼›å¦åˆ™åœ¨æ–¹æ³•çš„å£°æ˜Žå¤„é€šè¿‡throwså…³é”®å­—æŒ‡æ˜Žè¦æŠ›å‡ºç»™æ–¹æ³•è°ƒç”¨è€…çš„å¼‚å¸¸ï¼Œç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ ï¼ˆ4ï¼‰åœ¨å‡ºçŽ°å¼‚å¸¸æ–¹æ³•çš„è°ƒç”¨è€…ä¸­æ•èŽ·å¹¶å¤„ç†å¼‚å¸¸ã€‚]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdown è¯­æ³•ç”»æµç¨‹å›¾]]></title>
    <url>%2Fposts%2F711ce00.html</url>
    <content type="text"><![CDATA[æ·»åŠ æ”¯æŒ Hexo é»˜è®¤æ˜¯ä¸æ”¯æŒæµç¨‹å›¾çš„ Markdown è¯­æ³•çš„ï¼Œéœ€è¦æ·»åŠ æ”¯æŒï¼š 1npm install --save hexo-filter-flowchart æ¼”ç¤º ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾ è¯­æ³•å¦‚ä¸‹ï¼š 12345678910Â·Â·Â·flow #ç”±äºŽæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `st=&gt;start: å¼€å§‹e=&gt;end: ç»“æŸop=&gt;operation: æˆ‘çš„æ“ä½œcond=&gt;condition: ç¡®è®¤ï¼Ÿst-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;opÂ·Â·Â· æ•ˆæžœå¦‚ä¸‹ï¼š &lt;div id=&quot;flowchart-0&quot; class=&quot;flow-chart&quot;&gt;&lt;/div&gt; ä¸€ä¸ªç¨å¤æ‚çš„æµç¨‹å›¾ è¯­æ³•å¦‚ä¸‹ï¼š 12345678910111213Â·Â·Â·flow #ç”±äºŽæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `st=&gt;start: Start:&gt;http://www.google.com[blank]e=&gt;end:&gt;http://www.google.comop1=&gt;operation: My Operationsub1=&gt;subroutine: My Subroutinecond=&gt;condition: Yesor No?:&gt;http://www.google.comio=&gt;inputoutput: catch something...st-&gt;op1-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op1Â·Â·Â· æ•ˆæžœå¦‚ä¸‹ï¼š &lt;div id=&quot;flowchart-1&quot; class=&quot;flow-chart&quot;&gt;&lt;/div&gt; è¯­æ³•è¯¦è§£ Hexoä¸­çš„æµç¨‹å›¾æ˜¯ä¾èµ–äºŽflowchart.js å®žçŽ°çš„ã€‚ ä»¥ä¸Šé¢é‚£ä¸ªç¨å¤æ‚çš„æµç¨‹å›¾ä¸ºä¾‹ï¼š 1234567891011121314Â·Â·Â·flow #ç”±äºŽæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `//å®šä¹‰éƒ¨åˆ†st=&gt;start: Start:&gt;http://www.google.com[blank]e=&gt;end:&gt;http://www.google.comop1=&gt;operation: My Operationsub1=&gt;subroutine: My Subroutinecond=&gt;condition: Yes or No?:&gt;http://www.google.comio=&gt;inputoutput: catch something...//åˆ¤æ–­å’Œä½ç½®æŽ§åˆ¶st-&gt;op1-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op1Â·Â·Â· ä¾‹å¦‚è¿™ä¸€å¥ï¼š st=&gt;start: Start|past:&gt;http://www.google.com[blank] å…¶ä¸­ï¼Œstæ˜¯å˜é‡åï¼Œstartæ˜¯æŒ‡æ“ä½œæ¨¡å—åï¼Œå†’å·åŽé¢å°±æ˜¯å†…å®¹äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ** å†’å·åŽè¦åŠ ç©ºæ ¼æ‰èƒ½è¯†åˆ« ** æ“ä½œæ¨¡å—è¯­æ³• æ“ä½œæ¨¡å— è¯´æ˜Ž start å¼€å§‹ end ç»“æŸ operation æ™®é€šæ“ä½œå— condition åˆ¤æ–­å— subroutine å­ä»»åŠ¡å— inputoutput è¾“å…¥è¾“å‡ºå— åˆ¤æ–­å’Œä½ç½®æŽ§åˆ¶ æµç¨‹æŽ§åˆ¶ st-&gt;op1-&gt;e -&gt; ä½œä¸ºæŽ§åˆ¶æµç¨‹çš„æ“ä½œç¬¦ï¼Œå°±æ˜¯æŒ‡å‘ä¸‹ä¸€æ­¥è¦æ“ä½œçš„ã€‚ æ¯ä¸€æ¡éƒ½ç®—æ˜¯ä¸€æ¡æµç¨‹ ä½ ä¹Ÿå¯ä»¥æ–­å¼€å†™ï¼Œæ€Žä¹ˆæ–¹ä¾¿æ€Žä¹ˆæ¥ï¼Œå¦‚ï¼šä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸€æ ·çš„ã€‚ åˆ†ç€å†™ st-&gt;op1 op1-&gt;e åˆç€å†™ st-&gt;op1-&gt;e åˆ¤æ–­ cond(yes)-&gt;io-&gt;e #yesçš„æ—¶å€™åˆ°ioï¼Œå†åˆ°e ä½ç½®æŒ‡å®š cond(no)-&gt;sub1(right)-&gt;op1 #noçš„æ—¶å€™åˆ°åˆ° sub1ï¼Œå†ä»Žsub1çš„å³ä¾§åˆ°op1 è¿˜å¯ä»¥è¿™æ · cond1(no,right) ```&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js&quot;&gt;&lt;/script&gt;{% raw %}st=>start: å¼€å§‹ e=>end: ç»“æŸ op=>operation: æˆ‘çš„æ“ä½œ cond=>condition: ç¡®è®¤ï¼Ÿ st->op->cond cond(yes)->e cond(no)->op{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-0", options);{% endraw %}{% raw %}st=>start: Start:>http://www.google.com[blank] e=>end:>http://www.google.com op1=>operation: My Operation sub1=>subroutine: My Subroutine cond=>condition: Yes or No?:>http://www.google.com io=>inputoutput: catch something... st->op1->cond cond(yes)->io->e cond(no)->sub1(right)->op1{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-1-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-1", options);{% endraw %}]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdownè¯­æ³•ç³–]]></title>
    <url>%2Fposts%2F43883629.html</url>
    <content type="text"><![CDATA[å‰è¨€ Markdown æ˜¯ä¸€ç§è½»é‡çº§çš„æ ‡è®°è¯­è¨€ï¼Œå…¶ç”¨ç®€å•çš„æ ‡è®°è¯­æ³•ä¾¿å¯è¾¾åˆ°æŽ’ç‰ˆçš„ç›®çš„ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬æ›´åŠ ä¸“æ³¨äºŽå†…å®¹çš„ç¼–å†™ï¼Œè€Œä¸éœ€è¿‡å¤šå…³æ³¨æŽ’ç‰ˆã€‚ æœ¬æ–‡ä¸»è¦æ•´ç†äº† Markdown ä¸­çš„å¸¸ç”¨çš„æ ‡è®°è¯­æ³•ï¼Œä»¥ä¾¿è‡ªå·±ä¸Žä»–äººä»¥åŽæŸ¥ç”¨ã€‚ ä¼˜ç‚¹ çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥å…¼å®¹æ€§æžå¼ºï¼Œå¯ä»¥ç”¨æ‰€æœ‰æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ã€‚ è®©ä½ ä¸“æ³¨äºŽæ–‡å­—è€Œä¸æ˜¯æŽ’ç‰ˆã€‚ æ ¼å¼è½¬æ¢æ–¹ä¾¿ï¼ŒMarkdown çš„æ–‡æœ¬ä½ å¯ä»¥è½»æ¾è½¬æ¢ä¸º htmlã€ç”µå­ä¹¦ç­‰ã€‚ Markdown çš„æ ‡è®°è¯­æ³•æœ‰æžå¥½çš„å¯è¯»æ€§ã€‚ ç¼ºç‚¹ éœ€è¦è®°ä¸€äº›è¯­æ³•ï¼ˆå½“ç„¶ï¼Œæ˜¯å¾ˆç®€å•ã€‚äº”åˆ†é’Ÿå­¦ä¼šï¼‰ã€‚ æœ‰äº›å¹³å°ä¸æ”¯æŒMarkdownç¼–è¾‘æ¨¡å¼ã€‚ åŸºæœ¬è¯­æ³• æ ‡é¢˜ åœ¨æƒ³è¦è®¾ç½®ä¸ºæ ‡é¢˜çš„æ–‡å­—å‰é¢åŠ #æ¥è¡¨ç¤ºï¼Œä¸€ä¸ª#æ˜¯ä¸€çº§æ ‡é¢˜ï¼ŒäºŒä¸ª#æ˜¯äºŒçº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æŽ¨ã€‚æ”¯æŒå…­çº§æ ‡é¢˜ã€‚ æ³¨ï¼š#ä¸Žæ–‡å­—ä¹‹é—´è¦æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ ç¤ºä¾‹ï¼š 123456# è¿™æ˜¯ä¸€çº§æ ‡é¢˜## è¿™æ˜¯äºŒçº§æ ‡é¢˜### è¿™æ˜¯ä¸‰çº§æ ‡é¢˜#### è¿™æ˜¯å››çº§æ ‡é¢˜##### è¿™æ˜¯äº”çº§æ ‡é¢˜###### è¿™æ˜¯å…­çº§æ ‡é¢˜ æ•ˆæžœå¦‚ä¸‹ï¼š å­—ä½“ æ˜Ÿå·æˆ–è€…ä¸‹åˆ’çº¿éƒ½å¯ä»¥ï¼Œå•æ˜¯æ–œä½“ï¼ŒåŒæ˜¯ç²—ä½“ï¼Œç¬¦å·å¯ä»¥è·¨è¡Œï¼Œç¬¦å·å¯åŠ ç©ºæ ¼ã€‚ åŠ ç²— è¦åŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“ è¦å€¾æ–œçš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸€ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“åŠ ç²— è¦å€¾æ–œå’ŒåŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸‰ä¸ª*å·åŒ…èµ·æ¥ åˆ é™¤çº¿ è¦åŠ åˆ é™¤çº¿çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª~~å·åŒ…èµ·æ¥ ç¤ºä¾‹ï¼š 1234**è¿™æ˜¯åŠ ç²—çš„æ–‡å­—***è¿™æ˜¯å€¾æ–œçš„æ–‡å­—*`***è¿™æ˜¯æ–œä½“åŠ ç²—çš„æ–‡å­—***~~è¿™æ˜¯åŠ åˆ é™¤çº¿çš„æ–‡å­—~~ æ•ˆæžœå¦‚ä¸‹ï¼š å¼•ç”¨ åœ¨å¼•ç”¨çš„æ–‡å­—å‰åŠ &gt;å³å¯ã€‚å¼•ç”¨ä¹Ÿå¯ä»¥åµŒå¥—ï¼Œå¦‚åŠ ä¸¤ä¸ª&gt;&gt;ä¸‰ä¸ª&gt;&gt;&gt; nä¸ª... è²Œä¼¼å¯ä»¥ä¸€ç›´åŠ ä¸‹åŽ»ï¼Œä½†æ²¡ç¥žé©¬åµç”¨ã€‚ ç¤ºä¾‹ï¼š 123&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹ æ•ˆæžœå¦‚ä¸‹ï¼š åˆ†å‰²çº¿ ä¸‰ä¸ªæˆ–è€…ä¸‰ä¸ªä»¥ä¸Šçš„ - æˆ–è€… * éƒ½å¯ä»¥ã€‚ ç¤ºä¾‹ï¼š 1234-------******** æ•ˆæžœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ˜¾ç¤ºæ•ˆæžœæ˜¯ä¸€æ ·çš„ã€‚ å›¾ç‰‡ è¯­æ³•ï¼š 1234![å›¾ç‰‡alt](å›¾ç‰‡åœ°å€ ''å›¾ç‰‡title'')å›¾ç‰‡altå°±æ˜¯æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸‹é¢çš„æ–‡å­—ï¼Œç›¸å½“äºŽå¯¹å›¾ç‰‡å†…å®¹çš„è§£é‡Šã€‚å›¾ç‰‡titleæ˜¯å›¾ç‰‡çš„æ ‡é¢˜ï¼Œå½“é¼ æ ‡ç§»åˆ°å›¾ç‰‡ä¸Šæ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚titleå¯åŠ å¯ä¸åŠ  ç¤ºä¾‹ï¼š 1![ä¸€è„¸æ‡µé€¼](https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1558179968948&amp;di=1c8a7432843fdaafb91e9cbffacd1557&amp;imgtype=0&amp;src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201608%2F02%2F20160802213915_x23St.thumb.700_0.jpeg "ä¸€è„¸æ‡µé€¼") æ•ˆæžœå¦‚ä¸‹ï¼š è¶…é“¾æŽ¥ è¯­æ³•ï¼š 12[è¶…é“¾æŽ¥å](è¶…é“¾æŽ¥åœ°å€ "è¶…é“¾æŽ¥title")titleå¯åŠ å¯ä¸åŠ  ç¤ºä¾‹ï¼š 12[ç®€ä¹¦](http://jianshu.com)[ç™¾åº¦](http://baidu.com) æ•ˆæžœå¦‚ä¸‹ï¼š ç®€ä¹¦ ç™¾åº¦ æ³¨ï¼šMarkdownæœ¬èº«è¯­æ³•ä¸æ”¯æŒé“¾æŽ¥åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€ï¼Œå¦‚æžœæƒ³è¦åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€çš„è¯å¯ä»¥ç”¨htmlè¯­è¨€çš„aæ ‡ç­¾ä»£æ›¿ã€‚ 1234&lt;a href="è¶…é“¾æŽ¥åœ°å€" target="_blank"&gt;è¶…é“¾æŽ¥å&lt;/a&gt;ç¤ºä¾‹&lt;a href="https://www.jianshu.com/u/1f5ac0cf6a8b" target="_blank"&gt;ç®€ä¹¦&lt;/a&gt; ç´¢å¼•è¶…é“¾æŽ¥ ç¤ºä¾‹ï¼š 12[ç™¾åº¦][1][1]:http://www.baidu.com æ•ˆæžœå¦‚ä¸‹ï¼š [ç™¾åº¦][1] [1]:http://www.baidu.com è‡ªåŠ¨é“¾æŽ¥ è¯­æ³•ï¼šä½¿ç”¨å°–æ‹¬å·ã€‚ ç¤ºä¾‹ï¼š 12&lt;http://www.baidu.com&gt;&lt;1111111@qq.com&gt; æ•ˆæžœå¦‚ä¸‹ï¼š http://www.baidu.com 1111111@qq.com åˆ—è¡¨ æ— åºåˆ—è¡¨ è¯­æ³•ï¼š æ— åºåˆ—è¡¨ç”¨ - + * ä»»ä½•ä¸€ç§éƒ½å¯ä»¥ã€‚ 12345- åˆ—è¡¨å†…å®¹+ åˆ—è¡¨å†…å®¹* åˆ—è¡¨å†…å®¹æ³¨æ„ï¼š- + * è·Ÿå†…å®¹ä¹‹é—´éƒ½è¦æœ‰ä¸€ä¸ªç©ºæ ¼ æ•ˆæžœå¦‚ä¸‹ï¼š åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ æœ‰åºåˆ—è¡¨ è¯­æ³•ï¼š æ•°å­—åŠ ç‚¹ã€‚ 123451. åˆ—è¡¨å†…å®¹2. åˆ—è¡¨å†…å®¹3. åˆ—è¡¨å†…å®¹æ³¨æ„ï¼šåºå·è·Ÿå†…å®¹ä¹‹é—´è¦æœ‰ç©ºæ ¼ æ•ˆæžœå¦‚ä¸‹ï¼š åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åµŒå¥—åˆ—è¡¨ è¯­æ³•ï¼š ä¸Šä¸€çº§å’Œä¸‹ä¸€çº§ä¹‹é—´æ•²ä¸‰ä¸ªç©ºæ ¼å³å¯ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ æ³¨æ„ï¼šåœ¨ä½¿ç”¨åˆ—è¡¨æ—¶ï¼Œåªè¦æ˜¯æ•°å­—åŽé¢åŠ ä¸Šè‹±æ–‡çš„ç‚¹ï¼Œå°±ä¼šæ— æ„é—´äº§ç”Ÿåˆ—è¡¨ï¼Œæ¯”å¦‚2019.5.18 è¿™æ—¶å€™æƒ³è¡¨è¾¾çš„æ˜¯æ—¥æœŸï¼Œæœ‰äº›è½¯ä»¶æŠŠå®ƒè¢«è¯¯è®¤ä¸ºæ˜¯åˆ—è¡¨ã€‚è§£å†³æ–¹å¼ï¼šåœ¨æ¯ä¸ªç‚¹å‰é¢åŠ ä¸Š\å°±å¯ä»¥äº†ã€‚å¦‚æ‰€ç¤ºï¼š ç¤ºä¾‹ï¼š 12019\.5\.18 æ•ˆæžœå¦‚ä¸‹ï¼š 2019.5.18 è¡¨æ ¼ Markdownè¡¨æ ¼ è¯­æ³•ï¼š 1234567891011|è¡¨å¤´|è¡¨å¤´|è¡¨å¤´||---|:---:|---:||å†…å®¹|å†…å®¹|å†…å®¹||å†…å®¹|å†…å®¹|å†…å®¹|ç¬¬äºŒè¡Œåˆ†å‰²è¡¨å¤´å’Œå†…å®¹ã€‚- æœ‰ä¸€ä¸ªå°±è¡Œï¼Œä¸ºäº†å¯¹é½ï¼Œå¤šåŠ äº†å‡ ä¸ªæ–‡å­—é»˜è®¤å±…å·¦-ä¸¤è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…ä¸­-å³è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…å³æ³¨ï¼šåŽŸç”Ÿçš„è¯­æ³•ä¸¤è¾¹éƒ½è¦ç”¨ | åŒ…èµ·æ¥ã€‚æ­¤å¤„çœç•¥ ç¤ºä¾‹1ï¼š 12345| æ³•å· | æœ¬é¢† | æŽ’è¡Œ || :--------: | :-----: | :----: || æ‚Ÿç©º | 72å˜ | å¤§å¸ˆå…„|| æ‚Ÿèƒ½ | 36å˜ | äºŒå¸ˆå“¥|| æ‚Ÿå‡€ | 18å˜ | ä¸‰å¸ˆå¼Ÿ| æ•ˆæžœå¦‚ä¸‹ï¼š æ³•å· æœ¬é¢† æŽ’è¡Œ æ‚Ÿç©º 72å˜ å¤§å¸ˆå…„ æ‚Ÿèƒ½ 36å˜ äºŒå¸ˆå“¥ æ‚Ÿå‡€ 18å˜ ä¸‰å¸ˆå¼Ÿ ç¤ºä¾‹2ï¼š 1234567891011121314151617181920212223242526272829è¡¨å¤´1 | è¡¨å¤´2------------- | -------------Content Cell | Content CellContent Cell | Content Cell| è¡¨å¤´1 | è¡¨å¤´2|| ------------- | ------------- || Content Cell | Content Cell || Content Cell | Content Cell || åå­— | æè¿° || ------------- | ----------- || Help | Display the help window.|| Close | Closes a window |è¡¨æ ¼ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æ™®é€šæ–‡æœ¬çš„åˆ é™¤çº¿ï¼Œæ–œä½“ç­‰æ•ˆæžœ| åå­— | æè¿° || ------------- | ----------- || Help | ~~Display the~~ help window.|| Close | _Closes_ a window |è¡¨æ ¼å¯ä»¥æŒ‡å®šå¯¹é½æ–¹å¼| å·¦å¯¹é½ | å±…ä¸­ | å³å¯¹é½ || :------------ |:---------------:| -----:|| col 3 is | some wordy text | $1600 || col 2 is | centered | $12 || zebra stripes | are neat | $1 | æ•ˆæžœå¦‚ä¸‹ï¼š è¡¨å¤´1 è¡¨å¤´2 Content Cell Content Cell Content Cell Content Cell è¡¨å¤´1 è¡¨å¤´2 Content Cell Content Cell Content Cell Content Cell åå­— æè¿° Help Display the help window. Close Closes a window åå­— æè¿° Help Display the help window. Close Closes a window å·¦å¯¹é½ å±…ä¸­ å³å¯¹é½ col 3 is some wordy text $1600 col 2 is centered $12 zebra stripes are neat $1 HTMLè¡¨æ ¼ è¯­æ³•ï¼š 1234567891011121314151617181920&lt;table&gt; &lt;tr&gt; &lt;th&gt;é¡¹ç›®1&lt;/th&gt; &lt;th&gt;é¡¹ç›®2&lt;/th&gt; &lt;th&gt;é¡¹ç›®3&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;a1&lt;/td&gt; &lt;td colspan="2"&gt;a2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td rowspan="2"&gt;b1&lt;/td&gt; &lt;td&gt;b2&lt;/td&gt; &lt;td&gt;b3&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;c2&lt;/td&gt; &lt;td&gt;c3&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt; æ•ˆæžœï¼š é¡¹ç›®1 é¡¹ç›®2 é¡¹ç›®3 a1 a2 b1 b2 b3 c2 c3 éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨markdownä¸­ä½¿ç”¨htmlä»£ç æ¥å®žçŽ°è¡¨æ ¼çš„æ•ˆæžœï¼Œéœ€è¦åœ¨è¡¨æ ¼çš„å¤–é¢å¥—ä¸Šï¼š 1&lt;escape&gt;&lt;/escape&gt; ï¼ˆè½¬ä¹‰ï¼‰ï¼Œé˜²æ­¢markdownç›´æŽ¥å°†ä»£ç ä¸­çš„è¡Œè¿›è¡Œè½¬ä¹‰æˆå›žè½¦ï¼Œä¸ç„¶ä¼šå‡ºçŽ°è¡¨æ ¼å‰ç©ºäº†ä¸€å¤§å—ç©ºç™½ã€‚ ä½†åŒæ—¶ï¼Œå¼•å…¥htmlä¼šä½¿å¾—markdownçš„æ˜“è¯»æ˜“å†™çš„ç‰¹æ€§é™ä½Žã€‚é™¤éžå¿…è¦ï¼Œè¿˜æ˜¯æŽ¨èä½¿ç”¨markdownæœ¬èº«çš„è¡¨æ ¼è¯­æ³•ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ä½¿ç”¨htmlè¡¨æ ¼çš„æ—¶å€™ï¼Œå·æ‡’ä¸ç”¨æ‰“è¿™æ®µè¡¨æ ¼å‘¢ï¼Ÿ http://www.tablesgenerator.com/ å®‰åˆ©è¿™ä¸ªç½‘ç«™ï¼Œå®ƒå¯ä»¥å®žçŽ°ä½ çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬åˆå¹¶å•å…ƒæ ¼ç­‰ã€‚ ä»£ç  å•è¡Œä»£ç  è¯­æ³•ï¼š ä»£ç ä¹‹é—´åˆ†åˆ«ç”¨ä¸€ä¸ªåå¼•å·åŒ…èµ·æ¥ã€‚ 1`ä»£ç å†…å®¹` ç¤ºä¾‹ï¼š 1`create database hero;` æ•ˆæžœå¦‚ä¸‹ï¼š create database hero; ä»£ç å— è¯­æ³•ï¼š ä»£ç ä¹‹é—´åˆ†åˆ«ç”¨ä¸‰ä¸ªåå¼•å·åŒ…èµ·æ¥ï¼Œä¸”ä¸¤è¾¹çš„åå¼•å·å•ç‹¬å ä¸€è¡Œã€‚ 12345(```) ä»£ç ... ä»£ç ... ä»£ç ...(```) æ³¨ï¼šä¸ºäº†é˜²æ­¢è½¬è¯‘ï¼Œå‰åŽä¸‰ä¸ªåå¼•å·å¤„åŠ äº†å°æ‹¬å·ï¼Œå®žé™…æ˜¯æ²¡æœ‰çš„ã€‚è¿™é‡Œåªæ˜¯ç”¨æ¥æ¼”ç¤ºï¼Œå®žé™…ä¸­åŽ»æŽ‰ä¸¤è¾¹å°æ‹¬å·å³å¯ã€‚ ç¤ºä¾‹ï¼š 123456(```) function fun()&#123; echo "è¿™æ˜¯ä¸€å¥éžå¸¸ç‰›é€¼çš„ä»£ç "; &#125; fun();(```) æ•ˆæžœå¦‚ä¸‹ï¼š 1234function fun()&#123; echo "è¿™æ˜¯ä¸€å¥éžå¸¸ç‰›é€¼çš„ä»£ç ";&#125;fun(); æ³¨é‡Š è¯­æ³•ï¼šç”¨htmlçš„æ³¨é‡Š 1&lt;!-- ç”¨htmlçš„æ³¨é‡Š --&gt; è½¬ä¹‰å­—ç¬¦ Markdownä¸­çš„è½¬ä¹‰å­—ç¬¦ä¸º\ï¼Œè½¬ä¹‰çš„æœ‰ï¼š 123456789101112\\ åæ–œæ \` åå¼•å·\* æ˜Ÿå·\_ ä¸‹åˆ’çº¿\&#123;\&#125; å¤§æ‹¬å·\[\] ä¸­æ‹¬å·\(\) å°æ‹¬å·\# äº•å·\+ åŠ å·\- å‡å·\. è‹±æ–‡å¥å·\! æ„Ÿå¹å· æ•ˆæžœå¦‚ä¸‹ï¼š \ åæ–œæ  ` åå¼•å· * æ˜Ÿå· _ ä¸‹åˆ’çº¿ {} å¤§æ‹¬å· [] ä¸­æ‹¬å· () å°æ‹¬å· # äº•å· + åŠ å· - å‡å· . è‹±æ–‡å¥å· ! æ„Ÿå¹å· å…¶ä»–ç‰¹æ®Šå­—ç¬¦ ç¤ºä¾‹ï¼š 1234567891011&amp;#10084&amp;#10003&amp;#9728&amp;#9733&amp;#9730&amp;#9775&amp;#9762&amp;#9742&amp;#8734&amp;#10052&amp;#9835 æ•ˆæžœå¦‚ä¸‹ï¼š &amp;#10084 &amp;#10003 &amp;#9728 &amp;#9733 &amp;#9730 &amp;#9775 &amp;#9762 &amp;#9742 &amp;#8734 &amp;#10052 &amp;#9835 æƒ³çŸ¥é“å­—ç¬¦å¯¹åº”çš„Unicodeç ï¼Œå¯ä»¥çœ‹è¿™ä¸ªç½‘ç«™ï¼šhttps://unicode-table.com/cn/ æµç¨‹å›¾ æ•ˆæžœå¦‚ä¸‹ï¼š &lt;div id=&quot;flowchart-0&quot; class=&quot;flow-chart&quot;&gt;&lt;/div&gt; æ®µè½ä¸Žæ¢è¡Œ Markdownä¸­æ®µè½æŒ‡è¿žç»­çš„ä¸€æ®µæ–‡å­—ï¼Œç¼–å†™æ—¶æ®µè½ä¹‹é—´è‡³å°‘ä¸€ä¸ªç©ºè¡Œéš”å¼€ï¼Œæ®µè½å†…å¤šä¸ªç©ºæ ¼è¢«è§†ä¸ºä¸€ä¸ªç©ºæ ¼ï¼Œæ®µé¦–ä¸æ”¯æŒç¼©è¿›ã€‚ å¦‚ä½•æƒ³è¦åœ¨æ˜¾ç¤ºæ—¶æ˜¾ç¤ºå¤šä¸ªç©ºè¡Œï¼Œå¯ä»¥æ’å…¥å®žçŽ°ï¼Œæ³¨æ„çš„æ˜¯ï¼Œæ’å…¥çš„åº”ä¸Žå‰åŽçš„æ®µè½ä¸­é—´è‡³å°‘ç©ºä¸€è¡Œã€‚ æ®µè½ç¼©è¿›ï¼ˆç©ºæ ¼ï¼‰ ç¤ºä¾‹ï¼š 1234åŠæ–¹å¤§çš„ç©ºç™½&amp;ensp;æˆ–&amp;#8194;çœ‹ï¼Œé£žç¢Ÿå…¨æ–¹å¤§çš„ç©ºç™½&amp;emsp;æˆ–&amp;#8195;çœ‹ï¼Œé£žç¢Ÿä¸æ–­è¡Œçš„ç©ºç™½æ ¼&amp;nbsp;æˆ–&amp;#160;çœ‹ï¼Œé£žç¢Ÿ&amp;emsp;&amp;emsp;æ®µè½ä»Žæ­¤å¼€å§‹ã€‚ æ•ˆæžœå¦‚ä¸‹ï¼š åŠæ–¹å¤§çš„ç©ºç™½ æˆ– çœ‹ï¼Œé£žç¢Ÿ å…¨æ–¹å¤§çš„ç©ºç™½ æˆ– çœ‹ï¼Œé£žç¢Ÿ ä¸æ–­è¡Œçš„ç©ºç™½æ ¼ æˆ– çœ‹ï¼Œé£žç¢Ÿ æ®µè½ä»Žæ­¤å¼€å§‹ã€‚ å­—ä½“ã€å­—å·ã€é¢œè‰²ã€èƒŒæ™¯è‰² ç¤ºä¾‹ï¼š 1234567&lt;font face=&quot;é»‘ä½“&quot;&gt;æˆ‘æ˜¯é»‘ä½“å­—&lt;/font&gt;&lt;font face=&quot;å¾®è½¯é›…é»‘&quot;&gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘&lt;/font&gt;&lt;font face=&quot;STCAIYUN&quot;&gt;æˆ‘æ˜¯åŽæ–‡å½©äº‘&lt;/font&gt;&lt;font color=#0099ff size=12 face=&quot;é»‘ä½“&quot;&gt;é»‘ä½“&lt;/font&gt;&lt;font color=#00ffff size=3&gt;null&lt;/font&gt;&lt;font color=gray size=5&gt;gray&lt;/font&gt;&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#FF4500&gt;è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šOrangeRedï¼Œ åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼š#FF4500ï¼Œ rgb(255, 69, 0)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; æ•ˆæžœå¦‚ä¸‹ï¼š &lt;font face=&quot;é»‘ä½“&quot;&gt;æˆ‘æ˜¯é»‘ä½“å­—&lt;/font&gt; &lt;font face=&quot;å¾®è½¯é›…é»‘&quot;&gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘&lt;/font&gt; &lt;font face=&quot;STCAIYUN&quot;&gt;æˆ‘æ˜¯åŽæ–‡å½©äº‘&lt;/font&gt; &lt;font color=#0099ff size=12 face=&quot;é»‘ä½“&quot;&gt;é»‘ä½“&lt;/font&gt; &lt;font color=#00ffff size=3&gt;null&lt;/font&gt; &lt;font color=gray size=5&gt;gray&lt;/font&gt; &lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#FF4500&gt;è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šOrangeRedï¼Œ åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼š#FF4500ï¼Œ rgb(255, 69, 0)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; å¿«æ·é”® åŠŸèƒ½ å¿«æ·é”® åŠ ç²— Ctrl + B æ–œä½“ Ctrl + I å¼•ç”¨ Ctrl + Q æ’å…¥é“¾æŽ¥ Ctrl + L æ’å…¥ä»£ç  Ctrl + K æ’å…¥å›¾ç‰‡ Ctrl + G æå‡æ ‡é¢˜ Ctrl + H æœ‰åºåˆ—è¡¨ Ctrl + O æ— åºåˆ—è¡¨ Ctrl + U æ¨ªçº¿ Ctrl + R æ’¤é”€ Ctrl + Z é‡åš Ctrl + Y GitHubç‰¹æœ‰ç‰¹æ€§ å¤é€‰æ¡†åˆ—è¡¨ åœ¨åˆ—è¡¨ç¬¦å·åŽé¢åŠ ä¸Š[]æˆ–è€…[x]ä»£è¡¨é€‰ä¸­æˆ–è€…æœªé€‰ä¸­æƒ…å†µã€‚ ç¤ºä¾‹ï¼š 1234567+ [x] C+ [x] C+++ [x] Java+ [x] Qt+ [x] Android+ [ ] C#+ [ ] .NET æ•ˆæžœå¦‚ä¸‹ï¼š [x] C [x] C++ [x] Java [x] Qt [x] Android [ ] C# [ ] .NET emojiè¡¨æƒ…ç¬¦å· emojiè¡¨æƒ…ä½¿ç”¨:EMOJICODE:çš„æ ¼å¼ï¼Œè¯¦ç»†åˆ—è¡¨å¯è§ï¼š https://www.webpagefx.com/tools/emoji-cheat-sheet/ å½“ç„¶çŽ°åœ¨å¾ˆå¤šmarkdownå·¥å…·æˆ–è€…ç½‘ç«™éƒ½ä¸æ”¯æŒã€‚ ä¸‹é¢åˆ—å‡ºå‡ ä¸ªå¹³å°çš„å¯¹æ¯”ï¼š å·¥å…·/ç½‘ç«™ emoji ç®€ä¹¦ å¦ github æ˜¯ æœ‰é“äº‘ç¬”è®° å¦ &lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js&quot;&gt;&lt;/script&gt;&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js&quot;&gt;&lt;/script&gt;st=>start: å¼€å§‹ op=>operation: My Operation cond=>condition: Yes or No? e=>end st->op->cond cond(yes)->e cond(no)->op{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-0", options);]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkdownPadå‘ç”ŸHTMLæ¸²æŸ“ç»„ä»¶å‡ºé”™]]></title>
    <url>%2Fposts%2Fe13690e.html</url>
    <content type="text"><![CDATA[åœ¨å®‰è£…ç ´è§£MarkdownPadä¹‹åŽï¼Œæ–°å»ºä¸€ä¸ªæ–‡æ¡£å‡†å¤‡ç»ƒä¹ ä¸‹MarkdownPadçš„ä½¿ç”¨ï¼Œç»“æžœï¼Œå¾ˆä¸å¹¸åœ°å‡ºçŽ°äº†ä¸‹é¢çš„é”™è¯¯ï¼š æ ¹æ®å®ƒçš„æç¤ºè·³è½¬åˆ°å®˜ç½‘ä¸ŠæŸ¥çœ‹äº†ä¸€ç•ªï¼Œè¡¨ç¤ºå¾ˆæ‡µé€¼.... æœ€ç»ˆè¿˜æ˜¯å€ŸåŠ©å¼ºå¤§çš„ç™¾åº¦æœåˆ°å…¶ä»–å°ä¼™ä¼´ä¹Ÿé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼ŒçŽ°å°†è§£å†³æ–¹æ¡ˆæ€»ç»“å¦‚ä¸‹ã€‚ ä¸‹è½½è¿™ä¸ªä¸œä¸œï¼š Awesomium 1.6.6 SDK ä¸‹è½½å®ŒæˆåŽåŒå‡»exeå®‰è£…æ–‡ä»¶å¼€å§‹å®‰è£…ï¼Œç‚¹å‡»Nextï¼š å‹¾é€‰**â€œI accept the terms in the License Agreementâ€ï¼Œç‚¹å‡»Next** å‹¾é€‰**&quot;Yes,remove the older version.&quot;ï¼Œç‚¹å‡»Next** å®‰è£…è·¯å¾„å¯ä»¥ä½¿ç”¨é»˜è®¤çš„å®‰è£…è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ›´æ”¹å®‰è£…è·¯å¾„ï¼Œç„¶åŽé€‰æ‹©Typicalæ ‡å‡†å¥—é¤ ç‚¹å‡»Installå¼€å§‹å®‰è£… å®‰è£…å®ŒæˆFinsh ç„¶åŽé‡å¯MarkdownPadï¼Œé—®é¢˜è§£å†³ã€‚]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkdownPadæ­£ç‰ˆç ´è§£ä¸Žæ±‰åŒ–]]></title>
    <url>%2Fposts%2F19a65e9.html</url>
    <content type="text"><![CDATA[ä¸‹è½½ å…ˆåŽ»å®˜ç½‘ï¼šhttp://markdownpad.com/ ä¸‹è½½MarkdownPadï¼Œå¦‚ä¸‹å›¾ï¼š å®‰è£… å®‰è£…è¿‡ç¨‹å¾ˆç®€å•ï¼Œä¸€è·¯NexTä¸‹åŽ»ï¼Œå¯ä½¿ç”¨é»˜è®¤çš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®‰è£…ç›®å½•ï¼Œè¿™é‡Œä¸åšæˆªå›¾å±•ç¤ºã€‚ æ±‰åŒ– å®‰è£…å®ŒæˆåŽï¼Œå¯åŠ¨MarkdownPadï¼Œåœ¨å·¥å…·æ ä¸Šé¢ç‚¹å‡»Tools-Optionsï¼Œå¦‚ä¸‹å›¾ï¼š åœ¨æ‰“å¼€çš„é¡µé¢ä¸‹æ–¹æœ‰ä¸ªlanguagesçš„é€‰é¡¹ï¼Œç‚¹å‡»Englishçš„é€‰é¡¹å¡å¼¹å‡ºé€‰æ‹©çª—ï¼Œé€‰ä¸­æ–‡ï¼Œç‚¹å‡»save and closeæŒ‰é’®åŽå°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡æ•ˆæžœï¼Œå¹¶å¼¹çª—**&quot;éœ€è¦é‡æ–°å¯åŠ¨ MarkdownPad&quot;**çš„æç¤ºã€‚å¦‚ä¸‹å›¾ï¼š ç ´è§£ æ³¨å†Œç  1GBPduHjWfJU1mZqcPM3BikjYKF6xKhlKIys3i1MU2eJHqWGImDHzWdD6xhMNLGVpbP2M5SN6bnxn2kSE8qHqNY5QaaRxmO3YSMHxlv2EYpjdwLcPwfeTG7kUdnhKE0vVy4RidP6Y2wZ0q74f47fzsZo45JE2hfQBFi2O9Jldjp1mW8HUpTtLA2a5/sQytXJUQl/QKO0jUQY4pa5CCx20sV1ClOTZtAGngSOJtIOFXK599sBr5aIEFyH0K7H4BoNMiiDMnxt1rD8Vb/ikJdhGMMQr0R4B+L3nWU97eaVPTRKfWGDE8/eAgKzpGwrQQoDh+nzX1xoVQ8NAuH+s4UcSeQ== é‚®ç®±åœ°å€ Soar360@live.com ä½¿ç”¨æ–¹å¼ ç‚¹å‡»å¸®åŠ©-ä¸“ä¸šç‰ˆæ¿€æ´»åœ¨å¼¹å‡ºçš„å°çª—å£è¾“å…¥é‚®ç®±Soar360@live.com æŽˆæƒå¯†é’¥ç²˜è´´ä¸Šé¢çš„æ³¨å†Œç .ç‚¹å‡»ç¡®å®šå°±æ¿€æ´»ã€‚ çŽ°åœ¨æ˜¯2019å¹´5æœˆ18æ—¥ï¼Œç›®å‰ä¾ç„¶æœ‰æ•ˆã€‚]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
</search>
