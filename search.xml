<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -åˆ†å¸ƒå¼é”]]></title>
    <url>%2Fposts%2F12dd52e3.html</url>
    <content type="text"><![CDATA[å‰è¨€ å¤šçº¿ç¨‹æƒ…å†µä¸‹å¯¹å…±äº«èµ„æºçš„æ“ä½œéœ€è¦åŠ é”ï¼Œé¿å…æ•°æ®è¢«å†™ä¹±ï¼Œåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œè¿™ä¸ªé—®é¢˜ä¹Ÿæ˜¯å­˜åœ¨çš„ï¼Œæ­¤æ—¶å°±éœ€è¦ä¸€ä¸ªåˆ†å¸ƒå¼é”æœåŠ¡ã€‚ åˆ†å¸ƒå¼é”çš„ç‰¹ç‚¹ åˆ†å¸ƒå¼é”ä¸€èˆ¬è¦æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼šæ’ä»–æ€§ï¼šä»»æ„æ—¶åˆ»ï¼Œåªèƒ½æœ‰ä¸€ä¸ªclientèƒ½è·å–åˆ°é”ï¼›å®¹é”™æ€§ï¼šåˆ†å¸ƒå¼é”æœåŠ¡ä¸€èˆ¬è¦æ»¡è¶³APï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åˆ†å¸ƒå¼é”æœåŠ¡é›†ç¾¤èŠ‚ç‚¹å¤§éƒ¨åˆ†å­˜æ´»ï¼Œclientå°±å¯ä»¥è¿›è¡ŒåŠ é”è§£é”æ“ä½œï¼›é¿å…æ­»é”ï¼šåˆ†å¸ƒå¼é”ä¸€å®šèƒ½å¾—åˆ°é‡Šæ”¾ï¼Œå³ä½¿clientåœ¨é‡Šæ”¾ä¹‹å‰å´©æºƒæˆ–è€…ç½‘ç»œä¸å¯è¾¾è€Œæ²¡æœ‰ä¸»åŠ¨è§£é”ï¼Œä¹Ÿèƒ½ä¿è¯åç»­clientèƒ½åŠ é”ã€‚é™¤äº†ä»¥ä¸Šç‰¹ç‚¹ä¹‹å¤–ï¼Œåˆ†å¸ƒå¼é”æœ€å¥½ä¹Ÿèƒ½æ»¡è¶³å¯é‡å…¥ã€é«˜æ€§èƒ½ã€é˜»å¡é”ç‰¹æ€§ï¼ˆAQSè¿™ç§ï¼Œèƒ½å¤ŸåŠæ—¶ä»é˜»å¡çŠ¶æ€å”¤é†’ï¼‰ç­‰ã€‚ åˆ†å¸ƒå¼é”æ–¹æ¡ˆ åˆ†å¸ƒå¼é”ä¸€èˆ¬æœ‰ä¸‰ç§å®ç°æ–¹å¼ï¼šåŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é”ï¼›åŸºäºRedisçš„åˆ†å¸ƒå¼é”ï¼›åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é” åŸºäºæ•°æ®åº“çš„åˆ†å¸ƒå¼é” åœ¨æ•°æ®åº“æ–°å»ºä¸€å¼ è¡¨ç”¨äºæ§åˆ¶å¹¶å‘æ§åˆ¶ï¼Œè¡¨ç»“æ„å¯ä»¥å¦‚ä¸‹æ‰€ç¤ºï¼š 12345678CREATE TABLE `lock_table` ( `id` int(11) unsigned NOT NULL COMMENT 'ä¸»é”®', `key_id` bigint(20) NOT NULL COMMENT 'åˆ†å¸ƒå¼key', `memo` varchar(50) NOT NULL DEFAULT '' COMMENT 'å¯è®°å½•æ“ä½œå†…å®¹', `update_time` datetime NOT NULL COMMENT 'æ›´æ–°æ—¶é—´', PRIMARY kEY (`id`,'key_id'), UNIQUE KEY `key_id` (`key_id`) USING BETREE) ENGINE=InnoDB DEFAULT CHARSET=utf8 key_idä½œä¸ºåˆ†å¸ƒå¼keyç”¨æ¥å¹¶å‘æ§åˆ¶ï¼Œmemoå¯ç”¨æ¥è®°å½•ä¸€äº›æ“ä½œå†…å®¹ï¼ˆæ¯”å¦‚memoå¯ç”¨æ¥æ”¯æŒé‡å…¥ç‰¹æ€§ï¼Œæ ‡è®°ä¸‹å½“å‰åŠ é”çš„clientå’ŒåŠ é”æ¬¡æ•°ï¼‰ã€‚ å°†key_idè®¾ç½®ä¸ºå”¯ä¸€ç´¢å¼•ï¼Œä¿è¯äº†é’ˆå¯¹åŒä¸€ä¸ªkey_idåªæœ‰ä¸€ä¸ªåŠ é”ï¼ˆæ•°æ®æ’å…¥ï¼‰èƒ½æˆåŠŸã€‚æ­¤æ—¶lockå’Œunlockä¼ªä»£ç å¦‚ä¸‹ï¼š 123456789def lock : exec sql: insert into lock_table(key_id, memo, update_time) values (key_id, memo, NOW()) if result == true : return true else : return false def unlock : exec sql: delete from lock_table where key_id = 'key_id' and momo = 'memo' æ³¨æ„ï¼Œä¼ªä»£ç ä¸­çš„lockæ“ä½œæ˜¯éé˜»å¡é”ï¼Œä¹Ÿå°±æ˜¯tryLockï¼Œå¦‚æœæƒ³å®ç°é˜»å¡ï¼ˆæˆ–è€…é˜»å¡è¶…æ—¶ï¼‰åŠ é”ï¼Œåªéœ€è¦åå¤æ‰§è¡Œlockä¼ªä»£ç ç›´åˆ°åŠ é”æˆåŠŸä¸ºæ­¢å³å¯ã€‚ åŸºäºDBçš„åˆ†å¸ƒå¼é”å…¶å®æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å¦‚æœåŠ é”æˆåŠŸåï¼Œclientç«¯å®•æœºæˆ–è€…ç”±äºç½‘ç»œåŸå› å¯¼è‡´æ²¡æœ‰è§£é”ï¼Œé‚£ä¹ˆå…¶ä»–clientå°±æ— æ³•å¯¹è¯¥key_idè¿›è¡ŒåŠ é”å¹¶ä¸”æ— æ³•é‡Šæ”¾äº†ã€‚ä¸ºäº†èƒ½å¤Ÿè®©é”å¤±æ•ˆï¼Œéœ€è¦åœ¨åº”ç”¨å±‚åŠ ä¸Šå®šæ—¶ä»»åŠ¡ï¼Œå»åˆ é™¤è¿‡æœŸè¿˜æœªè§£é”çš„è®°å½•ï¼Œæ¯”å¦‚åˆ é™¤2åˆ†é’Ÿå‰æœªè§£é”çš„ä¼ªä»£ç å¦‚ä¸‹ï¼š 12def clear_timeout_lock : exec sql: delete from lock_table where update_time &lt; ADDTIME(NOW(), '-00:02:00') å› ä¸ºå•å®ä¾‹DBçš„TPSä¸€èˆ¬ä¸ºå‡ ç™¾ï¼Œæ‰€ä»¥åŸºäºDBçš„åˆ†å¸ƒå¼æ€§èƒ½ä¸Šé™ä¸€èˆ¬ä¹Ÿæ˜¯1kä»¥ä¸‹ï¼Œä¸€èˆ¬åœ¨å¹¶å‘é‡ä¸å¤§çš„åœºæ™¯ä¸‹è¯¥åˆ†å¸ƒå¼é”æ˜¯æ»¡è¶³éœ€æ±‚çš„ï¼Œä¸ä¼šå‡ºç°æ€§èƒ½é—®é¢˜ã€‚ ä¸è¿‡DBä½œä¸ºåˆ†å¸ƒå¼é”æœåŠ¡éœ€è¦è€ƒè™‘å•ç‚¹é—®é¢˜ï¼Œå¯¹äºåˆ†å¸ƒå¼ç³»ç»Ÿæ¥è¯´æ˜¯ä¸å…è®¸å‡ºç°å•ç‚¹çš„ï¼Œä¸€èˆ¬é€šè¿‡æ•°æ®åº“çš„åŒæ­¥å¤åˆ¶ï¼Œä»¥åŠä½¿ç”¨vipåˆ‡æ¢Masterå°±èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ã€‚ ä»¥ä¸ŠDBåˆ†å¸ƒå¼é”æ˜¯é€šè¿‡insertæ¥å®ç°çš„ï¼Œå¦‚æœåŠ é”çš„æ•°æ®å·²ç»åœ¨æ•°æ®åº“ä¸­å­˜åœ¨ï¼Œé‚£ä¹ˆç”¨select xxx where key_id = xxx for udpateæ–¹å¼æ¥åšä¹Ÿæ˜¯å¯ä»¥çš„ã€‚ ç¼ºç‚¹ 1ã€è¿™æŠŠé”å¼ºä¾èµ–æ•°æ®åº“çš„å¯ç”¨æ€§ï¼Œæ•°æ®åº“æ˜¯ä¸€ä¸ªå•ç‚¹ï¼Œä¸€æ—¦æ•°æ®åº“æŒ‚æ‰ï¼Œä¼šå¯¼è‡´ä¸šåŠ¡ç³»ç»Ÿä¸å¯ç”¨ã€‚2ã€è¿™æŠŠé”æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Œä¸€æ—¦è§£é”æ“ä½œå¤±è´¥ï¼Œå°±ä¼šå¯¼è‡´é”è®°å½•ä¸€ç›´åœ¨æ•°æ®åº“ä¸­ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•å†è·å¾—åˆ°é”ã€‚3ã€è¿™æŠŠé”åªèƒ½æ˜¯éé˜»å¡çš„ï¼Œå› ä¸ºæ•°æ®çš„insertæ“ä½œï¼Œä¸€æ—¦æ’å…¥å¤±è´¥å°±ä¼šç›´æ¥æŠ¥é”™ã€‚æ²¡æœ‰è·å¾—é”çš„çº¿ç¨‹å¹¶ä¸ä¼šè¿›å…¥æ’é˜Ÿé˜Ÿåˆ—ï¼Œè¦æƒ³å†æ¬¡è·å¾—é”å°±è¦å†æ¬¡è§¦å‘è·å¾—é”æ“ä½œã€‚4ã€è¿™æŠŠé”æ˜¯éé‡å…¥çš„ï¼ŒåŒä¸€ä¸ªçº¿ç¨‹åœ¨æ²¡æœ‰é‡Šæ”¾é”ä¹‹å‰æ— æ³•å†æ¬¡è·å¾—è¯¥é”ã€‚å› ä¸ºæ•°æ®ä¸­åº“æ•°æ®å·²ç»å­˜åœ¨äº†ã€‚ ç¼ºé™·è§£å†³æ–¹æ¡ˆ æ•°æ®åº“æ˜¯å•ç‚¹ï¼Ÿæä¸¤ä¸ªæ•°æ®åº“ï¼Œæ•°æ®å®ç°åŒå‘åŒæ­¥ã€‚ä¸€æ—¦æŒ‚æ‰å¿«é€Ÿåˆ‡æ¢åˆ°å¤‡åº“ä¸Šã€‚æ²¡æœ‰å¤±æ•ˆæ—¶é—´ï¼Ÿåªè¦åšä¸€ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œæ¯éš”ä¸€å®šæ—¶é—´æŠŠæ•°æ®åº“ä¸­çš„è¶…æ—¶æ•°æ®æ¸…ç†ä¸€éã€‚éé˜»å¡çš„ï¼Ÿæä¸€ä¸ªwhileå¾ªç¯ï¼Œç›´åˆ°insertæˆåŠŸå†è¿”å›æˆåŠŸã€‚éé‡å…¥çš„ï¼Ÿåœ¨æ•°æ®åº“è¡¨ä¸­åŠ ä¸ªå­—æ®µï¼Œè®°å½•å½“å‰è·å¾—é”çš„æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯ï¼Œé‚£ä¹ˆä¸‹æ¬¡å†è·å–é”çš„æ—¶å€™å…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œå¦‚æœå½“å‰æœºå™¨çš„ä¸»æœºä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åœ¨æ•°æ®åº“å¯ä»¥æŸ¥åˆ°çš„è¯ï¼Œç›´æ¥æŠŠé”åˆ†é…ç»™ä»–å°±å¯ä»¥äº†ã€‚ åŸºäºRedisçš„åˆ†å¸ƒå¼é” åŸç† åŸºäºredisçš„é”æ˜¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤å¯¹èµ„æºè¿›è¡ŒåŠ é”ï¼š 1set key_id key_value NX PX expireTime å…¶ä¸­ï¼Œset nxå‘½ä»¤åªä¼šåœ¨keyä¸å­˜åœ¨æ—¶ç»™keyè¿›è¡Œèµ‹å€¼ï¼Œpxç”¨æ¥è®¾ç½®keyè¿‡æœŸæ—¶é—´ï¼Œkey_valueä¸€èˆ¬æ˜¯éšæœºå€¼ï¼Œç”¨æ¥ä¿è¯é‡Šæ”¾é”çš„å®‰å…¨æ€§ï¼ˆé‡Šæ”¾æ—¶ä¼šåˆ¤æ–­æ˜¯å¦æ˜¯ä¹‹å‰è®¾ç½®è¿‡çš„éšæœºå€¼ï¼Œåªæœ‰æ˜¯æ‰é‡Šæ”¾é”ï¼‰ã€‚ç”±äºèµ„æºè®¾ç½®äº†è¿‡æœŸæ—¶é—´ï¼Œä¸€å®šæ—¶é—´åé”ä¼šè‡ªåŠ¨é‡Šæ”¾ã€‚ set nxä¿è¯å¹¶å‘åŠ é”æ—¶åªæœ‰ä¸€ä¸ªclientèƒ½è®¾ç½®æˆåŠŸï¼ˆrediså†…éƒ¨æ˜¯å•çº¿ç¨‹ï¼Œå¹¶ä¸”æ•°æ®å­˜åœ¨å†…å­˜ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´rediså†…éƒ¨æ‰§è¡Œå‘½ä»¤æ˜¯ä¸ä¼šæœ‰å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜çš„ï¼‰ã€‚ Javaå®ç° mavenä¾èµ– é¦–å…ˆé€šè¿‡Mavenå¼•å…¥Jediså¼€æºç»„ä»¶ï¼Œåœ¨pom.xmlæ–‡ä»¶åŠ å…¥ä¸‹é¢çš„ä»£ç ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;redis.clients&lt;/groupId&gt; &lt;artifactId&gt;jedis&lt;/artifactId&gt; &lt;version&gt;2.9.0&lt;/version&gt;&lt;/dependency&gt; åŠ é”ä»£ç  123456789101112131415161718192021222324public class RedisLock { private static final String LOCK_SUCCESS = "OK"; private static final String SET_IF_NOT_EXIST = "NX"; private static final String SET_WITH_EXPIRE_TIME = "PX"; /** * å°è¯•è·å–åˆ†å¸ƒå¼é” * @param jedis Rediså®¢æˆ·ç«¯ * @param lockKey é” * @param requestId è¯·æ±‚æ ‡è¯† * @param expireTime è¶…æœŸæ—¶é—´ * @return æ˜¯å¦è·å–æˆåŠŸ */ public static boolean tryGetDistributedLock(Jedis jedis, String lockKey, String requestId, int expireTime) { String result = jedis.set(lockKey, requestId, SET_IF_NOT_EXIST, SET_WITH_EXPIRE_TIME, expireTime); if (LOCK_SUCCESS.equals(result)) { return true; } return false; }} ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒåŠ é”çš„æ ¸å¿ƒä»£ç åªæœ‰ä¸€è¡Œï¼š 1jedis.set(String key, String value, String nxxx, String expx, int time) è¿™ä¸ªset()æ–¹æ³•ä¸€å…±æœ‰äº”ä¸ªå½¢å‚ï¼š åŸºäºZooKeeperçš„åˆ†å¸ƒå¼é” document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[HTTPåè®®ä¸­çš„é•¿çŸ­è¿æ¥å’Œé•¿çŸ­è½®è¯¢]]></title>
    <url>%2Fposts%2F4cb9c115.html</url>
    <content type="text"><![CDATA[å‰è¨€ ç›¸ä¿¡å¾ˆå¤šäººåœ¨çœ‹HTTPåè®®ç›¸å…³çš„æ–‡ç« æ—¶ï¼Œéƒ½èƒ½çœ‹åˆ°è¿™ä¹ˆä¸€å¥è¯ï¼šHTTP1.0åè®®ä¸æ”¯æŒé•¿è¿æ¥ï¼Œä»HTTP1.1åè®®ä»¥åï¼Œè¿æ¥é»˜è®¤éƒ½æ˜¯é•¿è¿æ¥ã€‚ é‚£æ€æ ·ç®—æ˜¯æŠŠHTTPå˜æˆé•¿è¿æ¥ï¼Ÿæ˜¯ä¸æ˜¯åªè¦è®¾ç½®Connectionä¸ºkeep-aliveå°±å¯ä»¥äº†ï¼Ÿ å¦‚æœæ˜¯çš„è¯ï¼Œéƒ½è¯´HTTP1.1é»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œè€Œè§‚å¯Ÿå¹³æ—¶å¼€å‘çš„Webåº”ç”¨çš„HTTPå¤´éƒ¨ï¼ŒConnectionä¹Ÿç¡®å®æ˜¯keep-aliveï¼Œé‚£å°±æ˜¯è¯´æˆ‘ä»¬å¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨çš„é•¿è¿æ¥ï¼Œä½†æ˜¯é•¿è¿æ¥ä¸æ˜¯ä¸€èˆ¬ç”¨äºäº¤äº’æ¯”è¾ƒé¢‘ç¹çš„åº”ç”¨å—ï¼Ÿåƒæ™®é€šçš„Webåº”ç”¨ï¼Œæ¯”å¦‚ä¸ªäººåšå®¢è¿™ç§ï¼Œé•¿è¿æ¥æœ‰ä»€ä¹ˆç”¨ï¼Ÿ å¦‚æœæœ‰ç”¨é‚£ç”¨å¤„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬åˆä¸æ˜¯å®¢æˆ·ç«¯ä¸æœåŠ¡å™¨äº¤äº’é¢‘ç¹çš„é‚£ç§åº”ç”¨ï¼ˆæ¯•ç«Ÿä½ æ‰“å¼€ç½‘é¡µè‚¯å®šè¦åŠå¤©æ‰æ‰“å¼€å¦å¤–ä¸€ä¸ªå§ï¼‰ï¼Œå¦‚æœæ²¡ç”¨çš„è¯ï¼Œé‚£åˆ°åº•åº”ä¸åº”è¯¥æŠŠConnectionä¸ºkeep-aliveè¿™ä¸ªheaderå€¼ç»™æ”¹æ‰ï¼Œä»è€Œæ”¹æˆçŸ­è¿æ¥ï¼Ÿ é•¿çŸ­è¿æ¥ HTTPåè®®æ²¡æœ‰é•¿çŸ­è¿æ¥ä¸€è¯´ï¼ŒHTTPåè®®æ˜¯åŸºäºè¯·æ±‚/å“åº”æ¨¡å¼çš„ï¼Œå› æ­¤åªè¦æœåŠ¡ç«¯ç»™äº†å“åº”ï¼Œæœ¬æ¬¡HTTPè¿æ¥å°±ç»“æŸäº†ï¼Œæˆ–è€…æ›´å‡†ç¡®çš„è¯´ï¼Œæ˜¯æœ¬æ¬¡HTTPè¯·æ±‚å°±ç»“æŸäº†ï¼Œæ ¹æœ¬æ²¡æœ‰é•¿è¿æ¥è¿™ä¸€è¯´ã€‚é‚£ä¹ˆè‡ªç„¶ä¹Ÿå°±æ²¡æœ‰çŸ­è¿æ¥è¿™ä¸€è¯´äº†ã€‚ ä¹‹æ‰€ä»¥è¯´HTTPåˆ†ä¸ºé•¿è¿æ¥å’ŒçŸ­è¿æ¥ï¼Œå…¶å®æœ¬è´¨ä¸Šæ˜¯è¯´çš„TCPè¿æ¥ã€‚TCPè¿æ¥æ˜¯ä¸€ä¸ªåŒå‘çš„é€šé“ï¼Œå®ƒæ˜¯å¯ä»¥ä¿æŒä¸€æ®µæ—¶é—´ä¸å…³é—­çš„ï¼Œå› æ­¤TCPè¿æ¥æ‰æœ‰çœŸæ­£çš„é•¿è¿æ¥å’ŒçŸ­è¿æ¥è¿™ä¸€è¯´ã€‚ HTTPåè®®è¯´åˆ°åº•æ˜¯åº”ç”¨å±‚çš„åè®®ï¼Œè€ŒTCPæ‰æ˜¯çœŸæ­£çš„ä¼ è¾“å±‚åè®®ï¼Œåªæœ‰è´Ÿè´£ä¼ è¾“çš„è¿™ä¸€å±‚æ‰éœ€è¦å»ºç«‹è¿æ¥ã€‚ ç–‘é—®è§£ç­” æ˜¯ä¸æ˜¯åªè¦è®¾ç½®Connectionä¸ºkeep-aliveå°±ç®—æ˜¯é•¿è¿æ¥äº†ï¼Ÿ å½“ç„¶æ˜¯çš„ï¼Œä½†è¦æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯éƒ½è®¾ç½®ã€‚ å¹³æ—¶ç”¨çš„æ˜¯ä¸æ˜¯é•¿è¿æ¥ï¼Ÿ è¿™ä¸ªä¹Ÿæ¯«æ— ç–‘é—®æ˜¯çš„ã€‚ï¼ˆç°åœ¨ç”¨çš„åŸºæœ¬ä¸Šéƒ½æ˜¯HTTP1.1åè®®ï¼ŒåŸºæœ¬ä¸ŠConnectionéƒ½æ˜¯keep-aliveã€‚è€Œä¸”HTTPåè®®æ–‡æ¡£ä¸Šä¹Ÿæåˆ°äº†ï¼ŒHTTP1.1é»˜è®¤æ˜¯é•¿è¿æ¥ï¼Œä¹Ÿå°±æ˜¯é»˜è®¤Connectionçš„å€¼å°±æ˜¯keep-aliveï¼‰ã€‚ æ™®é€šçš„Webåº”ç”¨ï¼ˆæ¯”å¦‚ä¸ªäººåšå®¢ï¼‰ç”¨é•¿è¿æ¥æœ‰å•¥å¥½å¤„ï¼Ÿéœ€ä¸éœ€è¦å…³æ‰é•¿è¿æ¥è€Œä½¿ç”¨çŸ­è¿æ¥ï¼Ÿ åˆšæ‰å·²ç»è¯´äº†é•¿è¿æ¥æ˜¯æŒ‡çš„TCPè¿æ¥ï¼Œé•¿è¿æ¥çš„ç›®çš„ä¹Ÿæ˜¯ä¸ºäº†å¤ç”¨ï¼ˆå¤ç”¨TCPè¿æ¥ï¼‰ã€‚åœ¨é•¿è¿æ¥æƒ…å†µä¸‹ï¼Œå¤šä¸ªHTTPè¯·æ±‚å¯ä»¥å¤ç”¨åŒä¸€ä¸ªTCPè¿æ¥ï¼Œè¿™å°±èŠ‚çœäº†å¾ˆå¤šTCPè¿æ¥å»ºç«‹å’Œæ–­å¼€çš„æ¶ˆè€—ã€‚ æ¯”å¦‚ä½ è¯·æ±‚åšå®¢çš„ä¸€ä¸ªç½‘é¡µï¼Œè¿™ä¸ªç½‘é¡µé‡Œè‚¯å®šè¿˜åŒ…å«äº†CSSã€JSç­‰ç­‰ä¸€ç³»åˆ—èµ„æºï¼Œå¦‚æœæ˜¯çŸ­è¿æ¥ï¼ˆä¹Ÿå°±æ˜¯æ¯æ¬¡éƒ½è¦é‡æ–°å»ºç«‹TCPè¿æ¥ï¼‰çš„è¯ï¼Œé‚£ä½ æ¯æ‰“å¼€ä¸€ä¸ªç½‘é¡µï¼ŒåŸºæœ¬è¦å»ºç«‹å‡ ä¸ªç”šè‡³å‡ åä¸ªTCPè¿æ¥ï¼Œè¿™æµªè´¹äº†å¾ˆå¤šèµ„æºã€‚ ä½†å¦‚æœæ˜¯é•¿è¿æ¥çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¹ˆå¤šæ¬¡HTTPè¯·æ±‚ï¼ˆè¿™äº›è¯·æ±‚åŒ…æ‹¬è¯·æ±‚ç½‘é¡µå†…å®¹ï¼ŒCSSæ–‡ä»¶ï¼ŒJSæ–‡ä»¶ï¼Œå›¾ç‰‡ç­‰ç­‰ï¼‰ï¼Œå…¶å®ä½¿ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªTCPè¿æ¥ï¼Œå¾ˆæ˜¾ç„¶æ˜¯å¯ä»¥èŠ‚çœå¾ˆå¤šæ¶ˆè€—çš„ã€‚ æœ€åé•¿è¿æ¥å¹¶ä¸æ˜¯æ°¸ä¹…è¿æ¥çš„ã€‚å¦‚æœä¸€æ®µæ—¶é—´å†…ï¼ˆå…·ä½“çš„æ—¶é—´é•¿çŸ­ï¼Œæ˜¯å¯ä»¥åœ¨headerå½“ä¸­è¿›è¡Œè®¾ç½®çš„ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„è¶…æ—¶æ—¶é—´ï¼‰ï¼Œè¿™ä¸ªè¿æ¥æ²¡æœ‰HTTPè¯·æ±‚å‘å‡ºçš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸ªé•¿è¿æ¥å°±ä¼šè¢«æ–­æ‰ã€‚ é•¿çŸ­è½®è¯¢ é•¿è½®è¯¢ ä»‹ç» httpé•¿è½®è¯¢æ˜¯serverç«¯æ”¶åˆ°è¯·æ±‚åå¦‚æœæœ‰æ•°æ®ï¼Œç«‹åˆ»å“åº”è¯·æ±‚ï¼› å¦‚æœæ²¡æœ‰æ•°æ®å°±ä¼šåœç•™ä¸€æ®µæ—¶é—´ï¼Œè¿™æ®µæ—¶é—´å†…ï¼Œå¦‚æœ server è¯·æ±‚çš„æ•°æ®åˆ°è¾¾ï¼ˆå¦‚æŸ¥è¯¢æ•°æ®åº“æˆ–æ•°æ®çš„é€»è¾‘å¤„ç†å®Œæˆï¼‰ï¼Œå°±ä¼šç«‹åˆ»å“åº”ï¼› å¦‚æœè¿™æ®µæ—¶é—´è¿‡åï¼Œè¿˜æ²¡æœ‰æ•°æ®åˆ°è¾¾ï¼Œåˆ™ä»¥ç©ºæ•°æ®çš„å½¢å¼å“åº”httpè¯·æ±‚ï¼› è‹¥æµè§ˆå™¨æ”¶åˆ°çš„æ•°æ®ä¸ºç©ºï¼Œä¼šå†æ¬¡å‘é€åŒæ ·çš„httpè¯·æ±‚åˆ°serverï¼› ç¼ºç‚¹ server æ²¡æœ‰æ•°æ®åˆ°è¾¾æ—¶ï¼Œhttpè¿æ¥ä¼šåœç•™ä¸€æ®µæ—¶é—´ï¼Œè¿™ä¼šé€ æˆæœåŠ¡å™¨èµ„æºæµªè´¹ã€‚ çŸ­è½®è¯¢ ä»‹ç» http çŸ­è½®è¯¢æ˜¯ server æ”¶åˆ°è¯·æ±‚ä¸ç®¡æ˜¯å¦æœ‰æ•°æ®åˆ°è¾¾éƒ½ç›´æ¥å“åº”httpè¯·æ±‚ï¼› å¦‚æœæµè§ˆå™¨æ”¶åˆ°çš„æ•°æ®ä¸ºç©ºï¼Œåˆ™éš”ä¸€æ®µæ—¶é—´ï¼Œæµè§ˆå™¨åˆä¼šå‘é€ç›¸åŒçš„httpè¯·æ±‚åˆ°server ä»¥è·å–æ•°æ®å“åº”ï¼› ç¼ºç‚¹ æ¶ˆæ¯äº¤äº’çš„å®æ—¶æ€§è¾ƒä½ï¼ˆserverç«¯åˆ°æµè§ˆå™¨ç«¯çš„æ•°æ®åé¦ˆæ•ˆç‡ä½ï¼‰ã€‚ é•¿çŸ­è½®è¯¢çš„å¼‚åŒ ç›¸åŒç‚¹ å½“server çš„æ•°æ®ä¸å¯è¾¾æ—¶ï¼ŒåŸºäºhttpé•¿è½®è¯¢å’ŒçŸ­è½®è¯¢ çš„httpè¯·æ±‚ï¼Œéƒ½ä¼šåœç•™ä¸€æ®µæ—¶é—´ã€‚ ä¸åŒç‚¹ httpé•¿è½®è¯¢æ˜¯åœ¨æœåŠ¡å™¨ç«¯çš„åœç•™ï¼›è€Œhttp çŸ­è½®è¯¢æ˜¯åœ¨æµè§ˆå™¨ç«¯çš„åœç•™ã€‚ æ€§èƒ½æ€»ç»“ ä¸ç®¡æ˜¯é•¿è½®è¯¢è¿˜æ˜¯çŸ­è½®è¯¢ï¼Œéƒ½ä¸å¤ªé€‚ç”¨äºå®¢æˆ·ç«¯æ•°é‡å¤ªå¤šçš„æƒ…å†µï¼Œå› ä¸ºæ¯ä¸ªæœåŠ¡å™¨æ‰€èƒ½æ‰¿è½½çš„TCPè¿æ¥æ•°æ˜¯æœ‰ä¸Šé™çš„ï¼Œè¿™ç§è½®è¯¢å¾ˆå®¹æ˜“æŠŠè¿æ¥æ•°é¡¶æ»¡ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Dubboæ¥å£æµ‹è¯•å·¥å…·]]></title>
    <url>%2Fposts%2Faea42d14.html</url>
    <content type="text"><![CDATA[å‰è¨€ è¿‘å‡ å¹´éšç€å¾®æœåŠ¡åŒ–é¡¹ç›®çš„å´›èµ·ï¼Œé€æ¸æˆä¸ºè®¸å¤šä¸­å¤§å‹åˆ†å¸ƒå¼ç³»ç»Ÿæ¶æ„çš„ä¸»æµæ–¹å¼ï¼Œè€ŒRPCåœ¨è¿™å…¶ä¸­æ‰®æ¼”ç€é‡è¦çš„è§’è‰²ã€‚å¸‚é¢ä¸Šæµè¡Œçš„RPCæ¡†æ¶å¦‚Dubboã€Thriftã€Hessionã€gRPCç­‰ã€‚ æœ¬äººæ‰€åœ¨çš„å…¬å¸ä¸€ç›´ä½¿ç”¨Dubboï¼Œåœ¨ä½¿ç”¨Dubboè¿›è¡Œå¼€å‘æ—¶ï¼Œæƒ³è¦å¿«é€ŸçŸ¥é“æŸäº›dubboæ¥å£çš„å“åº”ç»“æœï¼Œä½†ä¸æƒ³å¯åŠ¨é¡¹ç›®ï¼ˆå› ä¸ºè¿™äº›é¡¹ç›®ä¸ä¸€å®šæ˜¯ä½ è´Ÿè´£çš„ï¼Œä¸ä¼šéƒ¨ç½²è€Œä¸”æå…¶ç¬¨é‡ï¼‰ï¼Œä¹Ÿä¸æƒ³æ–°å»ºä¸€ä¸ªdubboå®¢æˆ·ç«¯é¡¹ç›®ï¼ˆè´¹äº‹ä¸”å åœ°æ–¹ï¼‰ï¼Œä¹Ÿä¸æƒ³å¼€telnetå®¢æˆ·ç«¯è¿æ¥å£ï¼ˆéº»çƒ¦ä¸”æœ‰é™åˆ¶ï¼‰ã€‚ å› Dubboæ”¯æŒdubboã€rmiã€hessianã€httpã€webserviceã€thriftã€redisç­‰å¤šç§åè®®ï¼ŒDubboæ¥å£å¤§éƒ¨åˆ†éƒ½æ˜¯ä½¿ç”¨Dubboåè®®ï¼Œè€ŒDubboåè®®åº•å±‚çš„é»˜è®¤é€šè®¯æ˜¯ç”¨nettyã€‚æ‰€ä»¥ç”¨Nettyå†™ä¸€ä¸ªDubboæ¥å£æµ‹è¯•çš„æ”¶å‘å®¢æˆ·ç«¯ï¼Œè½¬å‘è¯·æ±‚åˆ°å„ç§ç³»ç»Ÿçš„æ¥å£ï¼Œç„¶åæŠŠå“åº”å±•ç¤ºåˆ°ç»Ÿä¸€é¡µé¢ã€‚è¿™æ ·å°±å¯ä»¥å®ç°ä¸€å¤„è¾“å…¥ï¼Œåˆ°å¤„è°ƒç”¨ï¼Œé¿å…äº†è°ƒè¯•ä¸€ä¸ªæ¥å£å°±è¦å†™ä¸€ä¸ªControllerï¼Œæˆ–è€…å†™ä¸€ä¸ªDubboå®¢æˆ·ç«¯æˆ–è€…æ³›åŒ–æ”¹é€ è¿™ä¹ˆéº»çƒ¦äº†ã€‚ åœ¨ä»‹ç»è¯¥æµ‹è¯•å·¥å…·ä¹‹å‰ï¼Œå…ˆå›é¡¾ä¸‹RPCã€Dubboç­‰çš„ç›¸å…³çŸ¥è¯†ã€‚ RPCä»‹ç» ä»€ä¹ˆæ˜¯RPC RPCï¼ˆRemote Procedure Callï¼‰â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸¤å°æœåŠ¡å™¨Aï¼ŒBï¼Œä¸€ä¸ªåº”ç”¨éƒ¨ç½²åœ¨AæœåŠ¡å™¨ä¸Šï¼Œæƒ³è¦è°ƒç”¨BæœåŠ¡å™¨ä¸Šåº”ç”¨æä¾›çš„æ–¹æ³•ï¼Œç”±äºä¸åœ¨ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œä¸èƒ½ç›´æ¥è°ƒç”¨ï¼Œéœ€è¦é€šè¿‡ç½‘ç»œæ¥è¡¨è¾¾è°ƒç”¨çš„è¯­ä¹‰å’Œä¼ è¾¾è°ƒç”¨çš„æ•°æ®ã€‚ RPCåè®®å‡å®šæŸäº›ä¼ è¾“åè®®çš„å­˜åœ¨ï¼Œå¦‚TCPæˆ–UDPï¼Œä¸ºé€šä¿¡ç¨‹åºä¹‹é—´æºå¸¦ä¿¡æ¯æ•°æ®ã€‚åœ¨OSIç½‘ç»œé€šä¿¡æ¨¡å‹ä¸­ï¼ŒRPCè·¨è¶Šäº†ä¼ è¾“å±‚å’Œåº”ç”¨å±‚ã€‚RPCä½¿å¾—å¼€å‘åŒ…æ‹¬ç½‘ç»œåˆ†å¸ƒå¼å¤šç¨‹åºåœ¨å†…çš„åº”ç”¨ç¨‹åºæ›´åŠ å®¹æ˜“ã€‚ç°åœ¨ä¸šç•Œæœ‰å¾ˆå¤šå¼€æºçš„ä¼˜ç§€ RPC æ¡†æ¶ï¼Œä¾‹å¦‚ Spring Cloudã€Dubboã€Thrift ç­‰ã€‚ RPCç»“æ„ RPC è¿™ä¸ªæ¦‚å¿µæœ¯è¯­åœ¨ä¸Šä¸–çºª 80 å¹´ä»£ç”± Bruce Jay Nelson æå‡ºï¼ŒNelson çš„è®ºæ–‡ä¸­æŒ‡å‡ºå®ç° RPC çš„ç¨‹åºåŒ…æ‹¬ 5 ä¸ªéƒ¨åˆ†ï¼š User User-stub RPCRuntime Server-stub Server è¿™é‡Œ user å°±æ˜¯ client ç«¯ï¼Œå½“ user æƒ³å‘èµ·ä¸€ä¸ªè¿œç¨‹è°ƒç”¨æ—¶ï¼Œå®ƒå®é™…æ˜¯é€šè¿‡æœ¬åœ°è°ƒç”¨ user-stubã€‚ user-stub è´Ÿè´£å°†è°ƒç”¨çš„æ¥å£ã€æ–¹æ³•å’Œå‚æ•°é€šè¿‡çº¦å®šçš„åè®®è§„èŒƒè¿›è¡Œç¼–ç å¹¶é€šè¿‡æœ¬åœ°çš„ RPCRuntime å®ä¾‹ä¼ è¾“åˆ°è¿œç«¯çš„å®ä¾‹ã€‚ è¿œç«¯ RPCRuntime å®ä¾‹æ”¶åˆ°è¯·æ±‚åäº¤ç»™ server-stub è¿›è¡Œè§£ç åå‘èµ·æœ¬åœ°ç«¯è°ƒç”¨ï¼Œè°ƒç”¨ç»“æœå†è¿”å›ç»™ user ç«¯ã€‚ ä»¥ä¸Šæ˜¯ç²—ç²’åº¦çš„ RPC å®ç°æ¦‚å¿µç»“æ„ï¼Œæ¥ä¸‹æ¥è¿›ä¸€æ­¥ç»†åŒ–å®ƒåº”è¯¥ç”±å“ªäº›ç»„ä»¶æ„æˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ RPC æœåŠ¡æ–¹é€šè¿‡ RpcServer å»å¯¼å‡ºï¼ˆexportï¼‰è¿œç¨‹æ¥å£æ–¹æ³•ï¼Œè€Œå®¢æˆ·æ–¹é€šè¿‡ RpcClient å»å¼•å…¥ï¼ˆimportï¼‰è¿œç¨‹æ¥å£æ–¹æ³•ã€‚å®¢æˆ·æ–¹åƒè°ƒç”¨æœ¬åœ°æ–¹æ³•ä¸€æ ·å»è°ƒç”¨è¿œç¨‹æ¥å£æ–¹æ³•ï¼ŒRPC æ¡†æ¶æä¾›æ¥å£çš„ä»£ç†å®ç°ï¼Œå®é™…çš„è°ƒç”¨å°†å§”æ‰˜ç»™ä»£ç†RpcProxy ã€‚ä»£ç†å°è£…è°ƒç”¨ä¿¡æ¯å¹¶å°†è°ƒç”¨è½¬äº¤ç»™RpcInvoker å»å®é™…æ‰§è¡Œã€‚åœ¨å®¢æˆ·ç«¯çš„RpcInvoker é€šè¿‡è¿æ¥å™¨RpcConnector å»ç»´æŒä¸æœåŠ¡ç«¯çš„é€šé“RpcChannelï¼Œå¹¶ä½¿ç”¨RpcProtocol æ‰§è¡Œåè®®ç¼–ç ï¼ˆencodeï¼‰å¹¶å°†ç¼–ç åçš„è¯·æ±‚æ¶ˆæ¯é€šè¿‡é€šé“å‘é€ç»™æœåŠ¡æ–¹ã€‚ RPC æœåŠ¡ç«¯æ¥æ”¶å™¨ RpcAcceptor æ¥æ”¶å®¢æˆ·ç«¯çš„è°ƒç”¨è¯·æ±‚ï¼ŒåŒæ ·ä½¿ç”¨RpcProtocol æ‰§è¡Œåè®®è§£ç ï¼ˆdecodeï¼‰ã€‚è§£ç åçš„è°ƒç”¨ä¿¡æ¯ä¼ é€’ç»™RpcProcessor å»æ§åˆ¶å¤„ç†è°ƒç”¨è¿‡ç¨‹ï¼Œæœ€åå†å§”æ‰˜è°ƒç”¨ç»™RpcInvoker å»å®é™…æ‰§è¡Œå¹¶è¿”å›è°ƒç”¨ç»“æœã€‚å¦‚ä¸‹æ˜¯å„ä¸ªéƒ¨åˆ†çš„è¯¦ç»†èŒè´£ï¼š RpcServerè´Ÿè´£å¯¼å‡ºï¼ˆexportï¼‰è¿œç¨‹æ¥å£RpcClientè´Ÿè´£å¯¼å…¥ï¼ˆimportï¼‰è¿œç¨‹æ¥å£çš„ä»£ç†å®ç°RpcProxyè¿œç¨‹æ¥å£çš„ä»£ç†å®ç°RpcInvokerå®¢æˆ·æ–¹å®ç°ï¼šè´Ÿè´£ç¼–ç è°ƒç”¨ä¿¡æ¯å’Œå‘é€è°ƒç”¨è¯·æ±‚åˆ°æœåŠ¡æ–¹å¹¶ç­‰å¾…è°ƒç”¨ç»“æœè¿”å›æœåŠ¡æ–¹å®ç°ï¼šè´Ÿè´£è°ƒç”¨æœåŠ¡ç«¯æ¥å£çš„å…·ä½“å®ç°å¹¶è¿”å›è°ƒç”¨ç»“æœRpcProtocolè´Ÿè´£åè®®ç¼–/è§£ç RpcConnectorè´Ÿè´£ç»´æŒå®¢æˆ·æ–¹å’ŒæœåŠ¡æ–¹çš„è¿æ¥é€šé“å’Œå‘é€æ•°æ®åˆ°æœåŠ¡æ–¹RpcAcceptorè´Ÿè´£æ¥æ”¶å®¢æˆ·æ–¹è¯·æ±‚å¹¶è¿”å›è¯·æ±‚ç»“æœRpcProcessorè´Ÿè´£åœ¨æœåŠ¡æ–¹æ§åˆ¶è°ƒç”¨è¿‡ç¨‹ï¼ŒåŒ…æ‹¬ç®¡ç†è°ƒç”¨çº¿ç¨‹æ± ã€è¶…æ—¶æ—¶é—´ç­‰RpcChannelæ•°æ®ä¼ è¾“é€šé“ RPCå·¥ä½œåŸç† RPCçš„è®¾è®¡ç”±Clientï¼ŒClient stubï¼ŒNetwork ï¼ŒServer stubï¼ŒServeræ„æˆã€‚ å…¶ä¸­Clientå°±æ˜¯ç”¨æ¥è°ƒç”¨æœåŠ¡çš„ï¼›Cient stubæ˜¯ç”¨æ¥æŠŠè°ƒç”¨çš„æ–¹æ³•å’Œå‚æ•°åºåˆ—åŒ–çš„ï¼ˆå› ä¸ºè¦åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»è¦æŠŠå¯¹è±¡è½¬å˜æˆå­—èŠ‚ï¼‰ï¼›Networkç”¨æ¥ä¼ è¾“è¿™äº›ä¿¡æ¯åˆ°Server stubï¼›Server stubç”¨æ¥æŠŠè¿™äº›ä¿¡æ¯ååºåˆ—åŒ–çš„ï¼›Serverå°±æ˜¯æœåŠ¡çš„æä¾›è€…ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯Serveræä¾›çš„æ–¹æ³•ã€‚ Clientåƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¼¼çš„è°ƒç”¨è¿œç¨‹æœåŠ¡ï¼›Client stubæ¥æ”¶åˆ°è°ƒç”¨åï¼Œå°†æ–¹æ³•ã€å‚æ•°åºåˆ—åŒ–ï¼›å®¢æˆ·ç«¯é€šè¿‡socketså°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯ï¼›Server stub æ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ï¼ˆå°†æ¶ˆæ¯å¯¹è±¡ååºåˆ—åŒ–ï¼‰ï¼›Server stub æ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡ï¼›æœ¬åœ°æœåŠ¡æ‰§è¡Œ(å¯¹äºæœåŠ¡ç«¯æ¥è¯´æ˜¯æœ¬åœ°æ‰§è¡Œ)å¹¶å°†ç»“æœè¿”å›ç»™Server stubï¼›Server stubå°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯ï¼ˆå°†ç»“æœæ¶ˆæ¯å¯¹è±¡åºåˆ—åŒ–ï¼‰ï¼›æœåŠ¡ç«¯é€šè¿‡socketså°†æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯ï¼›Client stubæ¥æ”¶åˆ°ç»“æœæ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼ˆå°†ç»“æœæ¶ˆæ¯å‘åºåˆ—åŒ–ï¼‰ï¼›å®¢æˆ·ç«¯å¾—åˆ°æœ€ç»ˆç»“æœã€‚ RPC è°ƒç”¨åˆ†ä»¥ä¸‹ä¸¤ç§ï¼š åŒæ­¥è°ƒç”¨ï¼šå®¢æˆ·æ–¹ç­‰å¾…è°ƒç”¨æ‰§è¡Œå®Œæˆå¹¶è¿”å›ç»“æœã€‚ å¼‚æ­¥è°ƒç”¨ï¼šå®¢æˆ·æ–¹è°ƒç”¨åä¸ç”¨ç­‰å¾…æ‰§è¡Œç»“æœè¿”å›ï¼Œä½†ä¾ç„¶å¯ä»¥é€šè¿‡å›è°ƒé€šçŸ¥ç­‰æ–¹å¼è·å–è¿”å›ç»“æœã€‚è‹¥å®¢æˆ·æ–¹ä¸å…³å¿ƒè°ƒç”¨è¿”å›ç»“æœï¼Œåˆ™å˜æˆå•å‘å¼‚æ­¥è°ƒç”¨ï¼Œå•å‘è°ƒç”¨ä¸ç”¨è¿”å›ç»“æœã€‚ å¼‚æ­¥å’ŒåŒæ­¥çš„åŒºåˆ†åœ¨äºæ˜¯å¦ç­‰å¾…æœåŠ¡ç«¯æ‰§è¡Œå®Œæˆå¹¶è¿”å›ç»“æœã€‚ Dubboä»‹ç» æ¶æ„ èŠ‚ç‚¹è§’è‰² èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³» æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ ç”Ÿæ€ç³»ç»Ÿ é›†ç¾¤å®¹é”™ åœ¨é›†ç¾¤è°ƒç”¨å¤±è´¥æ—¶ï¼ŒDubbo æä¾›äº†å¤šç§å®¹é”™æ–¹æ¡ˆï¼Œç¼ºçœä¸º failover é‡è¯•ã€‚ èŠ‚ç‚¹å…³ç³» è¿™é‡Œçš„ Invoker æ˜¯ Provider çš„ä¸€ä¸ªå¯è°ƒç”¨ Service çš„æŠ½è±¡ï¼ŒInvoker å°è£…äº† Provider åœ°å€åŠ Service æ¥å£ä¿¡æ¯ï¼› DirectoryÂ·è¡¨å¤šä¸ª Invokerï¼Œå¯ä»¥æŠŠå®ƒçœ‹æˆ List&lt;Invoker&gt; ï¼Œä½†ä¸ List ä¸åŒçš„æ˜¯ï¼Œå®ƒçš„å€¼å¯èƒ½æ˜¯åŠ¨æ€å˜åŒ–çš„ï¼Œæ¯”å¦‚æ³¨å†Œä¸­å¿ƒæ¨é€å˜æ›´ï¼› Cluster å°† Directory ä¸­çš„å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invokerï¼Œå¯¹ä¸Šå±‚é€æ˜ï¼Œä¼ªè£…è¿‡ç¨‹åŒ…å«äº†å®¹é”™é€»è¾‘ï¼Œè°ƒç”¨å¤±è´¥åï¼Œé‡è¯•å¦ä¸€ä¸ªï¼› Router è´Ÿè´£ä»å¤šä¸ª Invoker ä¸­æŒ‰è·¯ç”±è§„åˆ™é€‰å‡ºå­é›†ï¼Œæ¯”å¦‚è¯»å†™åˆ†ç¦»ï¼Œåº”ç”¨éš”ç¦»ç­‰ï¼› LoadBalance è´Ÿè´£ä»å¤šä¸ª Invoker ä¸­é€‰å‡ºå…·ä½“çš„ä¸€ä¸ªç”¨äºæœ¬æ¬¡è°ƒç”¨ï¼Œé€‰çš„è¿‡ç¨‹åŒ…å«äº†è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œè°ƒç”¨å¤±è´¥åï¼Œéœ€è¦é‡é€‰ã€‚ å®¹é”™æ¨¡å¼ Failover Cluster å¤±è´¥è‡ªåŠ¨åˆ‡æ¢ï¼Œå½“å‡ºç°å¤±è´¥ï¼Œé‡è¯•å…¶å®ƒæœåŠ¡å™¨ã€‚é€šå¸¸ç”¨äºè¯»æ“ä½œï¼Œä½†é‡è¯•ä¼šå¸¦æ¥æ›´é•¿å»¶è¿Ÿã€‚å¯é€šè¿‡ retries="2" æ¥è®¾ç½®é‡è¯•æ¬¡æ•°(ä¸å«ç¬¬ä¸€æ¬¡)ã€‚ é‡è¯•æ¬¡æ•°é…ç½®å¦‚ä¸‹ï¼š 1&lt;dubbo:service retries="2" /&gt; æˆ– 1&lt;dubbo:reference retries="2" /&gt; æˆ– 123&lt;dubbo:reference&gt; &lt;dubbo:method name="findFoo" retries="2" /&gt;&lt;/dubbo:reference&gt; Failfast Cluster å¿«é€Ÿå¤±è´¥ï¼Œåªå‘èµ·ä¸€æ¬¡è°ƒç”¨ï¼Œå¤±è´¥ç«‹å³æŠ¥é”™ã€‚é€šå¸¸ç”¨äºéå¹‚ç­‰æ€§çš„å†™æ“ä½œï¼Œæ¯”å¦‚æ–°å¢è®°å½•ã€‚ Failsafe Cluster å¤±è´¥å®‰å…¨ï¼Œå‡ºç°å¼‚å¸¸æ—¶ï¼Œç›´æ¥å¿½ç•¥ã€‚é€šå¸¸ç”¨äºå†™å…¥å®¡è®¡æ—¥å¿—ç­‰æ“ä½œã€‚ Failback Cluster å¤±è´¥è‡ªåŠ¨æ¢å¤ï¼Œåå°è®°å½•å¤±è´¥è¯·æ±‚ï¼Œå®šæ—¶é‡å‘ã€‚é€šå¸¸ç”¨äºæ¶ˆæ¯é€šçŸ¥æ“ä½œã€‚ Forking Cluster å¹¶è¡Œè°ƒç”¨å¤šä¸ªæœåŠ¡å™¨ï¼Œåªè¦ä¸€ä¸ªæˆåŠŸå³è¿”å›ã€‚é€šå¸¸ç”¨äºå®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¯»æ“ä½œï¼Œä½†éœ€è¦æµªè´¹æ›´å¤šæœåŠ¡èµ„æºã€‚å¯é€šè¿‡ forks="2" æ¥è®¾ç½®æœ€å¤§å¹¶è¡Œæ•°ã€‚ Broadcast Cluster å¹¿æ’­è°ƒç”¨æ‰€æœ‰æä¾›è€…ï¼Œé€ä¸ªè°ƒç”¨ï¼Œä»»æ„ä¸€å°æŠ¥é”™åˆ™æŠ¥é”™ã€‚é€šå¸¸ç”¨äºé€šçŸ¥æ‰€æœ‰æä¾›è€…æ›´æ–°ç¼“å­˜æˆ–æ—¥å¿—ç­‰æœ¬åœ°èµ„æºä¿¡æ¯ã€‚ è´Ÿè½½å‡è¡¡ åœ¨é›†ç¾¤è´Ÿè½½å‡è¡¡æ—¶ï¼ŒDubbo æä¾›äº†å¤šç§å‡è¡¡ç­–ç•¥ï¼Œç¼ºçœä¸º random éšæœºè°ƒç”¨ã€‚ Random LoadBalance éšæœºï¼ŒæŒ‰æƒé‡è®¾ç½®éšæœºæ¦‚ç‡ã€‚ åœ¨ä¸€ä¸ªæˆªé¢ä¸Šç¢°æ’çš„æ¦‚ç‡é«˜ï¼Œä½†è°ƒç”¨é‡è¶Šå¤§åˆ†å¸ƒè¶Šå‡åŒ€ï¼Œè€Œä¸”æŒ‰æ¦‚ç‡ä½¿ç”¨æƒé‡åä¹Ÿæ¯”è¾ƒå‡åŒ€ï¼Œæœ‰åˆ©äºåŠ¨æ€è°ƒæ•´æä¾›è€…æƒé‡ã€‚ RoundRobin LoadBalance è½®è¯¢ï¼ŒæŒ‰å…¬çº¦åçš„æƒé‡è®¾ç½®è½®è¯¢æ¯”ç‡ã€‚ å­˜åœ¨æ…¢çš„æä¾›è€…ç´¯ç§¯è¯·æ±‚çš„é—®é¢˜ï¼Œæ¯”å¦‚ï¼šç¬¬äºŒå°æœºå™¨å¾ˆæ…¢ï¼Œä½†æ²¡æŒ‚ï¼Œå½“è¯·æ±‚è°ƒåˆ°ç¬¬äºŒå°æ—¶å°±å¡åœ¨é‚£ï¼Œä¹…è€Œä¹…ä¹‹ï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¡åœ¨è°ƒåˆ°ç¬¬äºŒå°ä¸Šã€‚ LeastActive LoadBalance æœ€å°‘æ´»è·ƒè°ƒç”¨æ•°ï¼Œç›¸åŒæ´»è·ƒæ•°çš„éšæœºï¼Œæ´»è·ƒæ•°æŒ‡è°ƒç”¨å‰åè®¡æ•°å·®ã€‚ ä½¿æ…¢çš„æä¾›è€…æ”¶åˆ°æ›´å°‘è¯·æ±‚ï¼Œå› ä¸ºè¶Šæ…¢çš„æä¾›è€…çš„è°ƒç”¨å‰åè®¡æ•°å·®ä¼šè¶Šå¤§ã€‚ ConsistentHash LoadBalance ä¸€è‡´æ€§ Hashï¼Œç›¸åŒå‚æ•°çš„è¯·æ±‚æ€»æ˜¯å‘åˆ°åŒä¸€æä¾›è€…ã€‚ å½“æŸä¸€å°æä¾›è€…æŒ‚æ—¶ï¼ŒåŸæœ¬å‘å¾€è¯¥æä¾›è€…çš„è¯·æ±‚ï¼ŒåŸºäºè™šæ‹ŸèŠ‚ç‚¹ï¼Œå¹³æ‘Šåˆ°å…¶å®ƒæä¾›è€…ï¼Œä¸ä¼šå¼•èµ·å‰§çƒˆå˜åŠ¨ã€‚ ç¼ºçœåªå¯¹ç¬¬ä¸€ä¸ªå‚æ•° Hashï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key="hash.arguments" value="0,1" /&gt;ã€‚ ç¼ºçœç”¨ 160 ä»½è™šæ‹ŸèŠ‚ç‚¹ï¼Œå¦‚æœè¦ä¿®æ”¹ï¼Œè¯·é…ç½® &lt;dubbo:parameter key="hash.nodes" value="320" /&gt;ã€‚ çº¿ç¨‹æ¨¡å‹ å¦‚æœäº‹ä»¶å¤„ç†çš„é€»è¾‘èƒ½è¿…é€Ÿå®Œæˆï¼Œå¹¶ä¸”ä¸ä¼šå‘èµ·æ–°çš„ IO è¯·æ±‚ï¼Œæ¯”å¦‚åªæ˜¯åœ¨å†…å­˜ä¸­è®°ä¸ªæ ‡è¯†ï¼Œåˆ™ç›´æ¥åœ¨ IO çº¿ç¨‹ä¸Šå¤„ç†æ›´å¿«ï¼Œå› ä¸ºå‡å°‘äº†çº¿ç¨‹æ± è°ƒåº¦ã€‚ ä½†å¦‚æœäº‹ä»¶å¤„ç†é€»è¾‘è¾ƒæ…¢ï¼Œæˆ–è€…éœ€è¦å‘èµ·æ–°çš„ IO è¯·æ±‚ï¼Œæ¯”å¦‚éœ€è¦æŸ¥è¯¢æ•°æ®åº“ï¼Œåˆ™å¿…é¡»æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œå¦åˆ™ IO çº¿ç¨‹é˜»å¡ï¼Œå°†å¯¼è‡´ä¸èƒ½æ¥æ”¶å…¶å®ƒè¯·æ±‚ã€‚ å¦‚æœç”¨ IO çº¿ç¨‹å¤„ç†äº‹ä»¶ï¼Œåˆåœ¨äº‹ä»¶å¤„ç†è¿‡ç¨‹ä¸­å‘èµ·æ–°çš„ IO è¯·æ±‚ï¼Œæ¯”å¦‚åœ¨è¿æ¥äº‹ä»¶ä¸­å‘èµ·ç™»å½•è¯·æ±‚ï¼Œä¼šæŠ¥â€œå¯èƒ½å¼•å‘æ­»é”â€å¼‚å¸¸ï¼Œä½†ä¸ä¼šçœŸæ­»é”ã€‚ å› æ­¤ï¼Œéœ€è¦é€šè¿‡ä¸åŒçš„æ´¾å‘ç­–ç•¥å’Œä¸åŒçš„çº¿ç¨‹æ± é…ç½®çš„ç»„åˆæ¥åº”å¯¹ä¸åŒçš„åœºæ™¯: 1&lt;dubbo:protocol name="dubbo" dispatcher="all" threadpool="fixed" threads="100" /&gt; Dispatcher all â–„ï¸»â”»â•â”³ä¸€ æ‰€æœ‰æ¶ˆæ¯éƒ½æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼ŒåŒ…æ‹¬è¯·æ±‚ï¼Œå“åº”ï¼Œè¿æ¥äº‹ä»¶ï¼Œæ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰ã€‚direct â–„ï¸»â”»â•â”³ä¸€ æ‰€æœ‰æ¶ˆæ¯éƒ½ä¸æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œå…¨éƒ¨åœ¨ IO çº¿ç¨‹ä¸Šç›´æ¥æ‰§è¡Œã€‚message â–„ï¸»â”»â•â”³ä¸€ åªæœ‰è¯·æ±‚å“åº”æ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œå…¶å®ƒè¿æ¥æ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰æ¶ˆæ¯ï¼Œç›´æ¥åœ¨ IO çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚execution â–„ï¸»â”»â•â”³ä¸€ åªè¯·æ±‚æ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ï¼Œä¸å«å“åº”ï¼Œå“åº”å’Œå…¶å®ƒè¿æ¥æ–­å¼€äº‹ä»¶ï¼Œå¿ƒè·³ç­‰æ¶ˆæ¯ï¼Œç›´æ¥åœ¨ IO çº¿ç¨‹ä¸Šæ‰§è¡Œã€‚connection â–„ï¸»â”»â•â”³ä¸€ åœ¨ IO çº¿ç¨‹ä¸Šï¼Œå°†è¿æ¥æ–­å¼€äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ï¼Œæœ‰åºé€ä¸ªæ‰§è¡Œï¼Œå…¶å®ƒæ¶ˆæ¯æ´¾å‘åˆ°çº¿ç¨‹æ± ã€‚ ThreadPool fixed â–„ï¸»â”»â•â”³ä¸€ å›ºå®šå¤§å°çº¿ç¨‹æ± ï¼Œå¯åŠ¨æ—¶å»ºç«‹çº¿ç¨‹ï¼Œä¸å…³é—­ï¼Œä¸€ç›´æŒæœ‰ã€‚(ç¼ºçœ)cached â–„ï¸»â”»â•â”³ä¸€ ç¼“å­˜çº¿ç¨‹æ± ï¼Œç©ºé—²ä¸€åˆ†é’Ÿè‡ªåŠ¨åˆ é™¤ï¼Œéœ€è¦æ—¶é‡å»ºã€‚limited â–„ï¸»â”»â•â”³ä¸€ å¯ä¼¸ç¼©çº¿ç¨‹æ± ï¼Œä½†æ± ä¸­çš„çº¿ç¨‹æ•°åªä¼šå¢é•¿ä¸ä¼šæ”¶ç¼©ã€‚åªå¢é•¿ä¸æ”¶ç¼©çš„ç›®çš„æ˜¯ä¸ºäº†é¿å…æ”¶ç¼©æ—¶çªç„¶æ¥äº†å¤§æµé‡å¼•èµ·çš„æ€§èƒ½é—®é¢˜ã€‚eager â–„ï¸»â”»â•â”³ä¸€ ä¼˜å…ˆåˆ›å»ºWorkerçº¿ç¨‹æ± ã€‚åœ¨ä»»åŠ¡æ•°é‡å¤§äºcorePoolSizeä½†æ˜¯å°äºmaximumPoolSizeæ—¶ï¼Œä¼˜å…ˆåˆ›å»ºWorkeræ¥å¤„ç†ä»»åŠ¡ã€‚å½“ä»»åŠ¡æ•°é‡å¤§äºmaximumPoolSizeæ—¶ï¼Œå°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚é˜»å¡é˜Ÿåˆ—å……æ»¡æ—¶æŠ›å‡ºRejectedExecutionExceptionã€‚(ç›¸æ¯”äºcached:cachedåœ¨ä»»åŠ¡æ•°é‡è¶…è¿‡maximumPoolSizeæ—¶ç›´æ¥æŠ›å‡ºå¼‚å¸¸è€Œä¸æ˜¯å°†ä»»åŠ¡æ”¾å…¥é˜»å¡é˜Ÿåˆ—) dubbo:// ä»ä¸Šé¢çš„Dubboç”Ÿæ€ç³»ç»Ÿä¸­å¯ä»¥çœ‹åˆ°Dubboæ”¯æŒå¤šç§åè®®ï¼Œç¼ºçœåè®®æ˜¯dubboåè®®ï¼Œå³é‡‡ç”¨å•ä¸€é•¿è¿æ¥å’Œ NIO å¼‚æ­¥é€šè®¯ï¼Œé€‚åˆäºå°æ•°æ®é‡å¤§å¹¶å‘çš„æœåŠ¡è°ƒç”¨ï¼Œä»¥åŠæœåŠ¡æ¶ˆè´¹è€…æœºå™¨æ•°è¿œå¤§äºæœåŠ¡æä¾›è€…æœºå™¨æ•°çš„æƒ…å†µã€‚Dubbo ç¼ºçœåè®®ä¸é€‚åˆä¼ é€å¤§æ•°æ®é‡çš„æœåŠ¡ï¼Œæ¯”å¦‚ä¼ æ–‡ä»¶ï¼Œä¼ è§†é¢‘ç­‰ï¼Œé™¤éè¯·æ±‚é‡å¾ˆä½ã€‚ ç‰¹æ€§ ç¼ºçœåè®®ï¼Œä½¿ç”¨åŸºäº mina 1.1.7 å’Œ hessian 3.2.1 çš„ tbremoting äº¤äº’ã€‚ è¿æ¥ä¸ªæ•°ï¼šå•è¿æ¥ è¿æ¥æ–¹å¼ï¼šé•¿è¿æ¥ ä¼ è¾“åè®®ï¼šTCP ä¼ è¾“æ–¹å¼ï¼šNIO å¼‚æ­¥ä¼ è¾“ åºåˆ—åŒ–ï¼šHessian äºŒè¿›åˆ¶åºåˆ—åŒ– é€‚ç”¨èŒƒå›´ï¼šä¼ å…¥ä¼ å‡ºå‚æ•°æ•°æ®åŒ…è¾ƒå°ï¼ˆå»ºè®®å°äº100Kï¼‰ï¼Œæ¶ˆè´¹è€…æ¯”æä¾›è€…ä¸ªæ•°å¤šï¼Œå•ä¸€æ¶ˆè´¹è€…æ— æ³•å‹æ»¡æä¾›è€…ï¼Œå°½é‡ä¸è¦ç”¨ dubbo åè®®ä¼ è¾“å¤§æ–‡ä»¶æˆ–è¶…å¤§å­—ç¬¦ä¸²ã€‚ é€‚ç”¨åœºæ™¯ï¼šå¸¸è§„è¿œç¨‹æœåŠ¡æ–¹æ³•è°ƒç”¨ zookeeper æ³¨å†Œä¸­å¿ƒ æµç¨‹è¯´æ˜ æœåŠ¡æä¾›è€…å¯åŠ¨æ—¶: å‘ /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ï¼›æœåŠ¡æ¶ˆè´¹è€…å¯åŠ¨æ—¶: è®¢é˜… /dubbo/com.foo.BarService/providers ç›®å½•ä¸‹çš„æä¾›è€… URL åœ°å€ã€‚å¹¶å‘ /dubbo/com.foo.BarService/consumers ç›®å½•ä¸‹å†™å…¥è‡ªå·±çš„ URL åœ°å€ï¼›ç›‘æ§ä¸­å¿ƒå¯åŠ¨æ—¶: è®¢é˜… /dubbo/com.foo.BarService ç›®å½•ä¸‹çš„æ‰€æœ‰æä¾›è€…å’Œæ¶ˆè´¹è€… URL åœ°å€ã€‚ æ”¯æŒåŠŸèƒ½ å½“æä¾›è€…å‡ºç°æ–­ç”µç­‰å¼‚å¸¸åœæœºæ—¶ï¼Œæ³¨å†Œä¸­å¿ƒèƒ½è‡ªåŠ¨åˆ é™¤æä¾›è€…ä¿¡æ¯ï¼›å½“æ³¨å†Œä¸­å¿ƒé‡å¯æ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ï¼›å½“ä¼šè¯è¿‡æœŸæ—¶ï¼Œèƒ½è‡ªåŠ¨æ¢å¤æ³¨å†Œæ•°æ®ï¼Œä»¥åŠè®¢é˜…è¯·æ±‚ï¼›å½“è®¾ç½® &lt;dubbo:registry check="false" /&gt; æ—¶ï¼Œè®°å½•å¤±è´¥æ³¨å†Œå’Œè®¢é˜…è¯·æ±‚ï¼Œåå°å®šæ—¶é‡è¯•ï¼›å¯é€šè¿‡ &lt;dubbo:registry username="admin" password="1234" /&gt; è®¾ç½® zookeeper ç™»å½•ä¿¡æ¯ï¼›å¯é€šè¿‡ &lt;dubbo:registry group="dubbo" /&gt; è®¾ç½® zookeeper çš„æ ¹èŠ‚ç‚¹ï¼Œä¸è®¾ç½®å°†ä½¿ç”¨æ— æ ¹æ ‘ï¼›æ”¯æŒ * å·é€šé…ç¬¦ &lt;dubbo:reference group="*" version="*" /&gt;ï¼Œå¯è®¢é˜…æœåŠ¡çš„æ‰€æœ‰åˆ†ç»„å’Œæ‰€æœ‰ç‰ˆæœ¬çš„æä¾›è€…ã€‚ æ¡†æ¶è®¾è®¡ æ•´ä½“è®¾è®¡ å›¾ä¾‹è¯´æ˜ï¼š å›¾ä¸­å·¦è¾¹æ·¡è“èƒŒæ™¯çš„ä¸ºæœåŠ¡æ¶ˆè´¹æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œå³è¾¹æ·¡ç»¿è‰²èƒŒæ™¯çš„ä¸ºæœåŠ¡æä¾›æ–¹ä½¿ç”¨çš„æ¥å£ï¼Œä½äºä¸­è½´çº¿ä¸Šçš„ä¸ºåŒæ–¹éƒ½ç”¨åˆ°çš„æ¥å£ã€‚ å›¾ä¸­ä»ä¸‹è‡³ä¸Šåˆ†ä¸ºåå±‚ï¼Œå„å±‚å‡ä¸ºå•å‘ä¾èµ–ï¼Œå³è¾¹çš„é»‘è‰²ç®­å¤´ä»£è¡¨å±‚ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ¯ä¸€å±‚éƒ½å¯ä»¥å‰¥ç¦»ä¸Šå±‚è¢«å¤ç”¨ï¼Œå…¶ä¸­ï¼ŒService å’Œ Config å±‚ä¸º APIï¼Œå…¶å®ƒå„å±‚å‡ä¸º SPIã€‚ å›¾ä¸­ç»¿è‰²å°å—çš„ä¸ºæ‰©å±•æ¥å£ï¼Œè“è‰²å°å—ä¸ºå®ç°ç±»ï¼Œå›¾ä¸­åªæ˜¾ç¤ºç”¨äºå…³è”å„å±‚çš„å®ç°ç±»ã€‚ å›¾ä¸­è“è‰²è™šçº¿ä¸ºåˆå§‹åŒ–è¿‡ç¨‹ï¼Œå³å¯åŠ¨æ—¶ç»„è£…é“¾ï¼Œçº¢è‰²å®çº¿ä¸ºæ–¹æ³•è°ƒç”¨è¿‡ç¨‹ï¼Œå³è¿è¡Œæ—¶è°ƒæ—¶é“¾ï¼Œç´«è‰²ä¸‰è§’ç®­å¤´ä¸ºç»§æ‰¿ï¼Œå¯ä»¥æŠŠå­ç±»çœ‹ä½œçˆ¶ç±»çš„åŒä¸€ä¸ªèŠ‚ç‚¹ï¼Œçº¿ä¸Šçš„æ–‡å­—ä¸ºè°ƒç”¨çš„æ–¹æ³•ã€‚ å„å±‚è¯´æ˜ config é…ç½®å±‚ï¼šå¯¹å¤–é…ç½®æ¥å£ï¼Œä»¥ ServiceConfig, ReferenceConfig ä¸ºä¸­å¿ƒï¼Œå¯ä»¥ç›´æ¥åˆå§‹åŒ–é…ç½®ç±»ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ spring è§£æé…ç½®ç”Ÿæˆé…ç½®ç±»ã€‚proxy æœåŠ¡ä»£ç†å±‚ï¼šæœåŠ¡æ¥å£é€æ˜ä»£ç†ï¼Œç”ŸæˆæœåŠ¡çš„å®¢æˆ·ç«¯ Stub å’ŒæœåŠ¡å™¨ç«¯ Skeleton, ä»¥ ServiceProxy ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º ProxyFactoryã€‚registry æ³¨å†Œä¸­å¿ƒå±‚ï¼šå°è£…æœåŠ¡åœ°å€çš„æ³¨å†Œä¸å‘ç°ï¼Œä»¥æœåŠ¡ URL ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º RegistryFactory, Registry, RegistryServiceã€‚cluster è·¯ç”±å±‚ï¼šå°è£…å¤šä¸ªæä¾›è€…çš„è·¯ç”±åŠè´Ÿè½½å‡è¡¡ï¼Œå¹¶æ¡¥æ¥æ³¨å†Œä¸­å¿ƒï¼Œä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Cluster, Directory, Router, LoadBalanceã€‚monitor ç›‘æ§å±‚ï¼šRPC è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ç›‘æ§ï¼Œä»¥ Statistics ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º MonitorFactory, Monitor, MonitorServiceã€‚protocol è¿œç¨‹è°ƒç”¨å±‚ï¼šå°è£… RPC è°ƒç”¨ï¼Œä»¥ Invocation, Result ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Protocol, Invoker, Exporterã€‚exchange ä¿¡æ¯äº¤æ¢å±‚ï¼šå°è£…è¯·æ±‚å“åº”æ¨¡å¼ï¼ŒåŒæ­¥è½¬å¼‚æ­¥ï¼Œä»¥ Request, Response ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Exchanger, ExchangeChannel, ExchangeClient, ExchangeServerã€‚transport ç½‘ç»œä¼ è¾“å±‚ï¼šæŠ½è±¡ mina å’Œ netty ä¸ºç»Ÿä¸€æ¥å£ï¼Œä»¥ Message ä¸ºä¸­å¿ƒï¼Œæ‰©å±•æ¥å£ä¸º Channel, Transporter, Client, Server, Codecã€‚serialize æ•°æ®åºåˆ—åŒ–å±‚ï¼šå¯å¤ç”¨çš„ä¸€äº›å·¥å…·ï¼Œæ‰©å±•æ¥å£ä¸º Serialization, ObjectInput, ObjectOutput, ThreadPoolã€‚ å…³ç³»è¯´æ˜ åœ¨ RPC ä¸­ï¼ŒProtocol æ˜¯æ ¸å¿ƒå±‚ï¼Œä¹Ÿå°±æ˜¯åªè¦æœ‰ Protocol + Invoker + Exporter å°±å¯ä»¥å®Œæˆéé€æ˜çš„ RPC è°ƒç”¨ï¼Œç„¶ååœ¨ Invoker çš„ä¸»è¿‡ç¨‹ä¸Š Filter æ‹¦æˆªç‚¹ã€‚å›¾ä¸­çš„ Consumer å’Œ Provider æ˜¯æŠ½è±¡æ¦‚å¿µï¼Œåªæ˜¯æƒ³è®©çœ‹å›¾è€…æ›´ç›´è§‚çš„äº†è§£å“ªäº›ç±»åˆ†å±äºå®¢æˆ·ç«¯ä¸æœåŠ¡å™¨ç«¯ï¼Œä¸ç”¨ Client å’Œ Server çš„åŸå› æ˜¯ Dubbo åœ¨å¾ˆå¤šåœºæ™¯ä¸‹éƒ½ä½¿ç”¨ Provider, Consumer, Registry, Monitor åˆ’åˆ†é€»è¾‘æ‹“æ™®èŠ‚ç‚¹ï¼Œä¿æŒç»Ÿä¸€æ¦‚å¿µã€‚Cluster æ˜¯å¤–å›´æ¦‚å¿µï¼Œæ‰€ä»¥ Cluster çš„ç›®çš„æ˜¯å°†å¤šä¸ª Invoker ä¼ªè£…æˆä¸€ä¸ª Invokerï¼Œè¿™æ ·å…¶å®ƒäººåªè¦å…³æ³¨ Protocol å±‚ Invoker å³å¯ï¼ŒåŠ ä¸Š Cluster æˆ–è€…å»æ‰ Cluster å¯¹å…¶å®ƒå±‚éƒ½ä¸ä¼šé€ æˆå½±å“ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªæä¾›è€…æ—¶ï¼Œæ˜¯ä¸éœ€è¦ Cluster çš„ã€‚Proxy å±‚å°è£…äº†æ‰€æœ‰æ¥å£çš„é€æ˜åŒ–ä»£ç†ï¼Œè€Œåœ¨å…¶å®ƒå±‚éƒ½ä»¥ Invoker ä¸ºä¸­å¿ƒï¼Œåªæœ‰åˆ°äº†æš´éœ²ç»™ç”¨æˆ·ä½¿ç”¨æ—¶ï¼Œæ‰ç”¨ Proxy å°† Invoker è½¬æˆæ¥å£ï¼Œæˆ–å°†æ¥å£å®ç°è½¬æˆ Invokerï¼Œä¹Ÿå°±æ˜¯å»æ‰ Proxy å±‚ RPC æ˜¯å¯ä»¥ Run çš„ï¼Œåªæ˜¯ä¸é‚£ä¹ˆé€æ˜ï¼Œä¸é‚£ä¹ˆçœ‹èµ·æ¥åƒè°ƒæœ¬åœ°æœåŠ¡ä¸€æ ·è°ƒè¿œç¨‹æœåŠ¡ã€‚Remoting å®ç°æ˜¯ Dubbo åè®®çš„å®ç°ï¼Œå¦‚æœä½ é€‰æ‹© RMI åè®®ï¼Œæ•´ä¸ª Remoting éƒ½ä¸ä¼šç”¨ä¸Šï¼ŒRemoting å†…éƒ¨å†åˆ’ä¸º Transport ä¼ è¾“å±‚å’Œ Exchange ä¿¡æ¯äº¤æ¢å±‚ï¼ŒTransport å±‚åªè´Ÿè´£å•å‘æ¶ˆæ¯ä¼ è¾“ï¼Œæ˜¯å¯¹ Mina, Netty, Grizzly çš„æŠ½è±¡ï¼Œå®ƒä¹Ÿå¯ä»¥æ‰©å±• UDP ä¼ è¾“ï¼Œè€Œ Exchange å±‚æ˜¯åœ¨ä¼ è¾“å±‚ä¹‹ä¸Šå°è£…äº† Request-Response è¯­ä¹‰ã€‚Registry å’Œ Monitor å®é™…ä¸Šä¸ç®—ä¸€å±‚ï¼Œè€Œæ˜¯ä¸€ä¸ªç‹¬ç«‹çš„èŠ‚ç‚¹ï¼Œåªæ˜¯ä¸ºäº†å…¨å±€æ¦‚è§ˆï¼Œç”¨å±‚çš„æ–¹å¼ç”»åœ¨ä¸€èµ·ã€‚ ä¾èµ–å…³ç³» å›¾ä¾‹è¯´æ˜ï¼š å›¾ä¸­å°æ–¹å— Protocol, Cluster, Proxy, Service, Container, Registry, Monitor ä»£è¡¨å±‚æˆ–æ¨¡å—ï¼Œè“è‰²çš„è¡¨ç¤ºä¸ä¸šåŠ¡æœ‰äº¤äº’ï¼Œç»¿è‰²çš„è¡¨ç¤ºåªå¯¹ Dubbo å†…éƒ¨äº¤äº’ã€‚ å›¾ä¸­èƒŒæ™¯æ–¹å— Consumer, Provider, Registry, Monitor ä»£è¡¨éƒ¨ç½²é€»è¾‘æ‹“æ‰‘èŠ‚ç‚¹ã€‚ å›¾ä¸­è“è‰²è™šçº¿ä¸ºåˆå§‹åŒ–æ—¶è°ƒç”¨ï¼Œçº¢è‰²è™šçº¿ä¸ºè¿è¡Œæ—¶å¼‚æ­¥è°ƒç”¨ï¼Œçº¢è‰²å®çº¿ä¸ºè¿è¡Œæ—¶åŒæ­¥è°ƒç”¨ã€‚ å›¾ä¸­åªåŒ…å« RPC çš„å±‚ï¼Œä¸åŒ…å« Remoting çš„å±‚ï¼ŒRemoting æ•´ä½“éƒ½éšå«åœ¨ Protocol ä¸­ã€‚ è°ƒç”¨é“¾ é¢†åŸŸæ¨¡å‹ åœ¨ Dubbo çš„æ ¸å¿ƒé¢†åŸŸæ¨¡å‹ä¸­ï¼š Protocol æ˜¯æœåŠ¡åŸŸï¼Œå®ƒæ˜¯ Invoker æš´éœ²å’Œå¼•ç”¨çš„ä¸»åŠŸèƒ½å…¥å£ï¼Œå®ƒè´Ÿè´£ Invoker çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€‚ Invoker æ˜¯å®ä½“åŸŸï¼Œå®ƒæ˜¯ Dubbo çš„æ ¸å¿ƒæ¨¡å‹ï¼Œå…¶å®ƒæ¨¡å‹éƒ½å‘å®ƒé æ‰°ï¼Œæˆ–è½¬æ¢æˆå®ƒï¼Œå®ƒä»£è¡¨ä¸€ä¸ªå¯æ‰§è¡Œä½“ï¼Œå¯å‘å®ƒå‘èµ· invoke è°ƒç”¨ï¼Œå®ƒæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªæœ¬åœ°çš„å®ç°ï¼Œä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªè¿œç¨‹çš„å®ç°ï¼Œä¹Ÿå¯èƒ½ä¸€ä¸ªé›†ç¾¤å®ç°ã€‚ Invocation æ˜¯ä¼šè¯åŸŸï¼Œå®ƒæŒæœ‰è°ƒç”¨è¿‡ç¨‹ä¸­çš„å˜é‡ï¼Œæ¯”å¦‚æ–¹æ³•åï¼Œå‚æ•°ç­‰ã€‚ Dubboæ¥å£æµ‹è¯•å·¥å…· æ•´ä½“è®¾è®¡ é¦–å…ˆç¡®å®šé¡¹ç›®çš„æ€»ä½“åŠŸèƒ½ã€‚æˆ‘ä»¬è¦çš„åŠŸèƒ½å¾ˆç®€å•ï¼Œè¾“å…¥ â”ˆâ”â•â˜† è½¬å‘ â”ˆâ”â•â˜† å±•ç¤ºã€‚ è¾“å…¥éƒ¨åˆ† RPCï¼ˆRemote Procedure Callï¼‰â€”è¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œå®ƒæ˜¯ä¸€ç§é€šè¿‡ç½‘ç»œä»è¿œç¨‹è®¡ç®—æœºç¨‹åºä¸Šè¯·æ±‚æœåŠ¡ï¼Œè€Œä¸éœ€è¦äº†è§£åº•å±‚ç½‘ç»œæŠ€æœ¯çš„åè®®ã€‚æ—¢ç„¶æ˜¯è¿œç¨‹è°ƒç”¨ï¼Œé‚£ä¹ˆå¿…å®šå­˜åœ¨ä¸€ä¸ªæœåŠ¡ç«¯ï¼Œä¹Ÿå°±æ˜¯ç”Ÿäº§è€…ã€‚çŸ¥é“æœ‰æœåŠ¡ç«¯è¿˜ä¸å¤Ÿï¼Œè¿˜å¾—çŸ¥é“æœåŠ¡ç«¯çš„IPå’Œç«¯å£ï¼Œå› ä¸ºè®¡ç®—æœºç½‘ç»œéƒ½æ˜¯é€šè¿‡Socketï¼ˆå¥—æ¥å­—ï¼‰æ¥è¿›è¡Œé€šè®¯çš„ã€‚é‚£ä¹ˆæ€æ ·çŸ¥é“æœåŠ¡ç«¯çš„IPå’Œç«¯å£çš„å‘¢ï¼Ÿ Dubboå¯ä»¥ä½¿ç”¨Zookeeperã€Redisç­‰ä½œä¸ºæ³¨å†Œä¸­å¿ƒã€‚ä»¥Zookeeperä¸ºä¾‹ï¼Œå®ƒä¼šæŠŠIPã€ç«¯å£ã€æ¥å£ã€æ–¹æ³•è¿™äº›æ‹¼æ¥æˆUrlï¼Œç„¶åå†™åˆ°Zookeeperçš„/dubbo/xxx/providers èŠ‚ç‚¹ä¸Šã€‚ RPCæ¡†æ¶ä¸ä¸€å®šéœ€è¦ä½¿ç”¨æ³¨å†Œä¸­å¿ƒï¼Œä½†æœ‰äº†å®ƒå¯ä»¥åšå¾ˆå¤šä¸œè¥¿ã€‚æˆ‘ä»¬å·²ç»çŸ¥é“äº†æœåŠ¡ç«¯çš„IPå’Œç«¯å£ï¼Œè¿˜éœ€è¦ä¸€ç§åè®®ï¼Œä½ å¯ä»¥ç†è§£ä¸ºä¸€ç§æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯éƒ½èƒ½å¬åˆ°çš„è¯­è¨€ï¼Œä¹Ÿå°±æ˜¯æ¥å£ã€‚è€Œæ¥å£ä¼šåŒ…å«æ¥å£åç§°ã€æ–¹æ³•åç§°è¿˜æœ‰å‚æ•°è¿™äº›ä¸œè¥¿ã€‚ å›æƒ³ä¸€ä¸‹Dubbo Consumerçš„ä½¿ç”¨æ–¹æ³•ã€‚ 1ã€é…ç½®zookeeperåœ°å€ã€‚ 2ã€å¼•ç”¨APIçš„jaråŒ… 3ã€è¾“å…¥æ¥å£ã€æ–¹æ³•ã€å‚æ•°ç­‰ã€‚ è¾“å…¥éƒ¨åˆ†è·ŸDubboä¿æŒä¸€è‡´ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæ¥å£æµ‹è¯•å·¥å…·å°±å¯ä»¥ä¸æ”¹å˜ç”¨æˆ·ä¹ æƒ¯çš„å‰æä¸‹å……å½“ä¸€ä¸ªæ³›åŒ–Dubboå®¢æˆ·ç«¯ã€‚ è½¬å‘éƒ¨åˆ† 1ã€è·å–Providerçš„IPå’ŒPortã€‚ å‰é¢å·²ç»æåˆ°ï¼Œå¯ä»¥é€šè¿‡æ³¨å†Œä¸­å¿ƒæ‹¿åˆ°æœåŠ¡å™¨çš„IPå’Œåœ°å€ï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„æœåŠ¡å‘ç°ã€‚Providerä¼šæŠŠè‡ªèº«çš„ä¸€ç³»åˆ—å‚æ•°æ‹¼æ¥æˆurlï¼Œç„¶åå­˜æ”¾åˆ°zookeeperçš„providerèŠ‚ç‚¹ä¸Šã€‚æ‰€ä»¥åªéœ€è¦ä»Zookeeperè·å–Providerçš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œç¨ä½œè§£æå°±èƒ½å¾—åˆ°Provideråˆ—è¡¨ï¼Œä»è€Œå¾—åˆ°IPå’ŒPortã€‚ 2ã€è¿æ¥Providerã€‚ Consumerå’ŒProvideré»˜è®¤ä½¿ç”¨Nettyä½œä¸ºé€šä¿¡æ¡†æ¶ï¼ŒProvideræš´éœ²æœåŠ¡çš„æ—¶å€™ä¼šå¯åŠ¨ä¸€ä¸ªNetty Serverï¼ŒProvideråœ¨åˆå§‹åŒ–interfaceçš„æ—¶å€™ï¼Œé™¤äº†ä¼šå‘zookeeperæ³¨å†Œï¼Œè¿˜ä¼šé€šè¿‡exportæ–¹æ³•åœ¨æœ¬åœ°å¯åŠ¨NettyæœåŠ¡å™¨ï¼Œç›‘å¬æš´éœ²çš„ç«¯å£ï¼Œç­‰å¾…è¿æ¥å»ºç«‹ã€‚è€ŒConsumeråˆ™ä¼šå¯åŠ¨ä¸€ä¸ªNettyå®¢æˆ·ç«¯å’ŒProviderå»ºç«‹å•ä¸€é•¿è¿æ¥æ¥æ”¶å‘æ•°æ®ã€‚æ‰€ä»¥æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªNetty Clientï¼Œç„¶åè¿æ¥ä¸ŠProviderçš„Netty Serverã€‚ 3ã€æ”¶å‘æ•°æ® è¿æ¥ä¸ŠProvideråï¼Œä¸‹ä¸€æ­¥å°±å¯ä»¥æ”¶å‘æ•°æ®äº†ã€‚Nettyè¿æ¥å»ºç«‹åä¼šè¿”å›ä¸€ä¸ªChannelï¼Œè¿™å°±æ˜¯æ•°æ®ä¼ è¾“çš„ç®¡é“ã€‚è°ƒç”¨writeæ–¹æ³•å°±å¯ä»¥å†™å…¥æ•°æ®ï¼Œæ¨é€åˆ°æœåŠ¡å™¨äº†ã€‚ å‰é¢è¾“å…¥éƒ¨åˆ†æåˆ°æ¥å£ã€æ–¹æ³•ã€å‚æ•°ï¼ŒæŠŠè¿™äº›ä¿¡æ¯å°è£…æˆè§„å®šæ ¼å¼çš„æ•°æ®åŒ…ï¼Œç„¶åç¼–ç ï¼Œç»è¿‡ç½‘ç»œä¼ è¾“ï¼Œç„¶åæœåŠ¡ç«¯è§£ç ï¼Œç„¶ååˆ†ç¦»å‡ºæ¥å£ç±»ã€æ–¹æ³•ã€å‚æ•°ï¼ŒæœåŠ¡ç«¯å°±å¯ä»¥é€šè¿‡åå°„æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•äº†ã€‚ 4ã€å“åº”ã€‚ è¯·æ±‚åŒ…å‘é€å‡ºå»äº†ï¼Œæˆ‘ä»¬å¾—æ‹¿åˆ°å“åº”ï¼Œä¸ç„¶åé¢å°±æ²¡æ³•å±•ç¤ºã€‚æ€æ ·çŸ¥é“å“åº”æŠ¥æ–‡å¯¹åº”å“ªä¸ªå‘é€æŠ¥æ–‡å‘¢ï¼Ÿ Dubboåœ¨RequeståŒ…ä¸­å°è£…äº†ä¸€ä¸ªmIdçš„æµæ°´å·ï¼Œé€šè¿‡å®ƒå°±å¯ä»¥è·Ÿè¸ªå‘é€çš„åŒ…ã€‚ æµæ°´å·åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿå¹‚ç­‰å»é‡ã€é¡ºåºé‡æ•´ã€å¼‚æ­¥è°ƒç”¨è·Ÿè¸ªç­‰èµ·ç€é‡è¦çš„ä½œç”¨ã€‚åœ¨å°è£…æ•°æ®åŒ…çš„æ—¶å€™ï¼Œå¯ä»¥æŠŠæµæ°´å·è®°å½•ä¸‹æ¥ã€‚ç„¶åå¯ä»¥é˜»å¡ç­‰å¾…è¿™ä¸ªæµæ°´å·æ•°æ®åŒ…çš„å“åº”ã€‚ å¯ä»¥å¾€Pipelineé‡Œæ·»åŠ ä¸€ä¸ªè‡ªå®šä¹‰ChannelHandlerï¼Œç”¨æ¥ç›‘å¬æ•°æ®æ¥æ”¶äº‹ä»¶ã€‚å½“æœåŠ¡ç«¯æ‰§è¡Œå®Œæ–¹æ³•è°ƒç”¨ï¼ŒæŠŠæ•°æ®åŒ…è¿”è¿˜å›æ¥ã€‚ç¼–ç ã€ç½‘ç»œä¼ è¾“ã€åˆ°å®¢æˆ·ç«¯è§£ç ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°è¿™ä¸ªæµæ°´å·äº†ï¼Œç„¶åä¿®æ”¹è¿™ä¸ªæµæ°´å·çš„ç­‰å¾…çŠ¶æ€ï¼Œç»“æŸé˜»å¡ï¼Œè¿™æ ·å°±å¯ä»¥æŠŠæ•°æ®è¿”å›å‰ç«¯é¡µé¢å±•ç¤ºäº†ã€‚ å±•ç¤ºéƒ¨åˆ† ç¤ºéƒ¨åˆ†æ¯”è¾ƒç®€å•ï¼Œç›´æ¥æŠŠRpcResultå¯¹è±¡è½¬æ¢ä¸€ä¸‹å°±å¯ä»¥è¾“å‡ºåˆ°é¡µé¢äº†ã€‚ åŠŸèƒ½ç‰¹æ€§ æç®€æ¨¡å¼ï¼šé€šè¿‡dubboæä¾›çš„telnetåè®®æ”¶å‘æ•°æ®ã€‚ æ™®é€šæ¨¡å¼ï¼šé€šè¿‡å°è£…nettyå®¢æˆ·ç«¯æ”¶å‘æ•°æ®ã€‚ ç”¨ä¾‹æ¨¡å¼ï¼šé€šè¿‡ç¼“å­˜æ•°æ®ï¼Œæ–¹ä¾¿ä¸‹ä¸€æ¬¡æ“ä½œï¼Œä¾èµ–æ™®é€šæ¨¡å¼ã€‚ ä¾èµ–åˆ—è¡¨ï¼šé€šè¿‡åˆ†æpomæ–‡ä»¶ï¼Œå±•ç¤ºå·²ç»åŠ è½½çš„jaråŒ…ã€‚ ä¾èµ–ç¼–è¾‘ï¼šå¯ä»¥ç›´æ¥ç¼–è¾‘pomæ–‡ä»¶ï¼Œæ–°å¢ä¿®æ”¹ä¾èµ–jarã€‚ æ³¨å†Œä¸­å¿ƒï¼šå¯ä»¥æ·»åŠ æˆ–åˆ é™¤zookeeperæ³¨å†Œä¸­å¿ƒã€‚ ç³»ç»Ÿé…ç½®ï¼šå¯ä»¥æ¸…ç©ºjaræˆ–è€…é‡æ–°åŠ è½½jarã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Dubbo</category>
      </categories>
      <tags>
        <tag>Dubbo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[çº¿ä¸Šé—®é¢˜æ’æŸ¥æ€»ç»“ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F4a0297a6.html</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨çº¿ä¸Šï¼Œæˆ‘ä»¬å¯èƒ½ç»å¸¸ä¼šç¢°åˆ°ç¨‹åºå¡æ­»æˆ–è€…æ‰§è¡Œå¾ˆæ…¢ç­‰æƒ…å†µï¼Œè¿™æ—¶æˆ‘ä»¬è¿«åˆ‡å¸Œæœ›çŸ¥é“æ˜¯ä»£ç å“ªé‡Œçš„é—®é¢˜ï¼Œä»£ç è¿è¡Œåˆ°äº†å“ªé‡Œï¼Œæ˜¯å“ªä¸€æ­¥å¾ˆæ…¢ï¼Œæ˜¯å¦è¿›å…¥äº†æ­»å¾ªç¯ï¼Œæ˜¯å¦æœ‰ä»£ç å‡ºç°äº†çº¿ç¨‹ä¸å®‰å…¨çš„æƒ…å†µï¼Œæ˜¯å¦æœ‰æŸäº›è¿æ¥æ•°æˆ–è€…æ‰“å¼€çš„æ–‡ä»¶æ•°å¤ªå¤šç­‰ç­‰é—®é¢˜ã€‚æ­¤æ—¶å°±éœ€è¦é€šè¿‡åˆ†ææ¡ˆå‘æ—¶çš„çº¿ç¨‹å †æ ˆä¿¡æ¯ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚ è¦æƒ³å¿«é€Ÿåˆ†æã€å®šä½é—®é¢˜ï¼Œé€šå¸¸æˆ‘ä»¬éœ€è¦å€ŸåŠ©ä¸€ç‚¹å…¶ä»–å·¥å…·ï¼Œæ¯”å¦‚ï¼šjstatã€jstackã€jmapã€jhatã€jconsoleã€jprofileç­‰ç­‰ã€‚ è€Œå®šä½é—®é¢˜çš„æ­¥éª¤æ— å¤–ä¹å‡ æ­¥ï¼š ps -ef | gre java è·å–javaè¿›ç¨‹pidtop pid æŸ¥çœ‹cpuè€—CPUè¿›ç¨‹top -Hp pid æˆ–è€… ps -mp pid -o THREAD,tid,time æŸ¥çœ‹è¯¥è¿›ç¨‹æ‰€æœ‰çº¿ç¨‹çš„è¿è¡Œæƒ…å†µï¼Œæ‰¾åˆ°å ç”¨ CPU è¿‡é«˜çš„çº¿ç¨‹ pidprintf "%x\n" pid æ‰“å°å‡º pid çš„ 16 è¿›åˆ¶å€¼ï¼ˆjstack å‘½ä»¤ç»“æœä¸­çš„çº¿ç¨‹ ID ä¸º nidï¼Œä¸”ç”¨ 16 è¿›åˆ¶è¡¨ç¤ºï¼‰jstack -l pid | grep nid å‘½ä»¤æŸ¥çœ‹çº¿ç¨‹å¿«ç…§ï¼Œæ ¹æ®ä¸Šä¸€æ­¥å¾—åˆ°çš„ 16 è¿›åˆ¶å€¼æ‰¾åˆ°å…·ä½“çš„çº¿ç¨‹ï¼Œå°±èƒ½çŸ¥é“è¿™ä¸ªè¿›ç¨‹åœ¨æ‰§è¡Œä»€ä¹ˆä»£ç äº† ä¸Šé¢å‡ æ­¥æ˜¯å¸¸ç”¨å®šä½é—®é¢˜çš„æ­¥éª¤ï¼Œæœ‰çš„å…¬å¸ï¼ˆæ¯”å¦‚æˆ‘ä»¬å…¬å¸ï¼‰è‡ªå·±å†™äº†ç›‘æ§è„šæœ¬ï¼Œåœ¨å‡ºç°é—®é¢˜çš„æ—¶å€™ï¼Œä¼šè‡ªåŠ¨dumpçº¿ç¨‹å †æ ˆã€å†…å­˜ä½¿ç”¨æƒ…å†µã€cpuè´Ÿè½½æƒ…å†µã€åƒåœ¾å›æ”¶æƒ…å†µç­‰ã€‚ä¸‹é¢å°±ä»¥æˆ‘é‡åˆ°çš„ä¸€ä¸ªçº¿ä¸Šé—®é¢˜ä¸¾ä¾‹è®²è§£ï¼š ä¸Šé¢çš„æˆªå›¾å°±æ˜¯å½“æ—¶å‡ºé—®é¢˜æ—¶è„šæœ¬è‡ªåŠ¨è¾“å‡ºçš„æ—¥å¿—ï¼Œå…¶ä¸­30669_*æ—¶ä»¥å½“æ—¶çš„çº¿ç¨‹IDä¸ºå‰ç¼€ï¼Œä¸‹é¢å°±é’ˆå¯¹å„ä¸ªæ—¥å¿—ï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰å†…å®¹å±•å¼€å­¦ä¹ ã€‚ loadavg.log é¦–å…ˆçœ‹ä¸€ä¸‹loadavg.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š loadavgæ˜¯ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼Œå³åœ¨ç‰¹å®šæ—¶é—´é—´éš”å†…è¿è¡Œé˜Ÿåˆ—ä¸­çš„å¹³å‡è¿›ç¨‹æ•°ã€‚ å‰ä¸‰ä¸ªæ˜¯1ã€5ã€15åˆ†é’Ÿå†…çš„å¹³å‡è¿›ç¨‹æ•°ã€‚ç¬¬å››ä¸ªçš„åˆ†å­æ˜¯æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°ï¼Œåˆ†æ¯æ˜¯è¿›ç¨‹æ€»æ•°ã€‚æœ€åä¸€ä¸ªæ˜¯æœ€è¿‘è¿è¡Œçš„è¿›ç¨‹IDå·ã€‚ ä¸€èˆ¬æ¥è¯´æ¯ä¸ªCPUçš„å½“å‰æ´»åŠ¨è¿›ç¨‹æ•°ä¸å¤§äº3é‚£ä¹ˆç³»ç»Ÿçš„æ€§èƒ½å°±æ˜¯è‰¯å¥½çš„ã€‚å¦‚æœæ¯ä¸ªCPUçš„ä»»åŠ¡æ•°å¤§äº5ï¼Œé‚£ä¹ˆå°±è¡¨æ˜æœºå™¨çš„æ€§èƒ½æœ‰ä¸¥é‡é—®é¢˜ã€‚ ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œå‡è®¾ç³»ç»Ÿæœ‰8ä¸ªCPUï¼Œåˆ™æ¯ä¸ªCPUåœ¨1åˆ†é’Ÿå†…çš„è¿›ç¨‹æ•°ä¸ºï¼š1.16/8=0.145 å¦‚æœæˆ‘ä»¬æƒ³æŸ¥çœ‹ç³»ç»Ÿå¹³å‡è´Ÿè½½ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤ï¼š cat /proc/loadavg uptime tload top.log ä¸‹é¢çœ‹ä¸‹30669_top.logå’Œ30669_top10_thread.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š 30669_top.logèµ„æºå ç”¨æœ€é«˜çš„è¿›ç¨‹æƒ…å†µã€‚ 30669_top10_thread.logæ˜¯èµ„æºå ç”¨å‰10çš„è¿›ç¨‹æƒ…å†µã€‚ å†…å®¹è§£è¯» 123456789top - 15:48:34 up 60 days, 18:06, 1 user, load average: 1.45, 0.47, 0.20Tasks: 1 total, 0 running, 1 sleeping, 0 stopped, 0 zombie%Cpu(s): 96.7 us, 0.0 sy, 0.0 ni, 3.3 id, 0.0 wa, 0.0 hi, 0.0 si, 0.0 stKiB Mem : 4046212 total, 127012 free, 1575164 used, 2344036 buff/cacheKiB Swap: 4194300 total, 4171260 free, 23040 used. 1984224 avail Mem PID USER PR NI VIRT RES SHR S %CPU %MEM TIME+ COMMAND30669 www 20 0 3769288 1.4g 14732 S 193.3 37.0 9:55.30 java180.0 146.7 200.0 ç¬¬ä¸€è¡Œtopæ˜¯ç³»ç»Ÿè¿è¡Œæ—¶é—´å’Œå¹³å‡è´Ÿè½½ï¼ŒåŒuptimeå‘½ä»¤çš„æ‰§è¡Œç»“æœ15:48:34 ğŸ‘‰ å½“å‰æ—¶é—´up 60 days, 18:06 ğŸ‘‰ ç³»ç»Ÿè¿è¡Œæ—¶é—´1 user ğŸ‘‰ å½“å‰ç™»å½•ç”¨æˆ·æ•°load average: 1.45, 0.47, 0.20 ğŸ‘‰ ç³»ç»Ÿè´Ÿè½½ï¼Œä¸‰ä¸ªæ•°å€¼åˆ†åˆ«ä¸º 1åˆ†é’Ÿã€5åˆ†é’Ÿã€15åˆ†é’Ÿå‰åˆ°ç°åœ¨çš„å¹³å‡å€¼ã€‚ç¬¬äºŒè¡ŒTasksæ˜¯ä»»åŠ¡ä¿¡æ¯1 total ğŸ‘‰ è¿›ç¨‹æ€»æ•°0 running ğŸ‘‰ æ­£åœ¨è¿è¡Œçš„è¿›ç¨‹æ•°1 sleeping ğŸ‘‰ ç¡çœ çš„è¿›ç¨‹æ•°0 stopped ğŸ‘‰ åœæ­¢çš„è¿›ç¨‹æ•°0 zombie ğŸ‘‰ åƒµå°¸è¿›ç¨‹æ•°ç¬¬ä¸‰è¡Œ%Cpu(s)æ˜¯CPUä¿¡æ¯96.7 us ğŸ‘‰ ç”¨æˆ·ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0 sy ğŸ‘‰ å†…æ ¸ç©ºé—´å ç”¨CPUç™¾åˆ†æ¯”0.0 ni ğŸ‘‰ ç”¨æˆ·è¿›ç¨‹ç©ºé—´å†…æ”¹å˜è¿‡ä¼˜å…ˆçº§çš„è¿›ç¨‹å ç”¨CPUç™¾åˆ†æ¯”3.3 id ğŸ‘‰ ç©ºé—²CPUç™¾åˆ†æ¯”0.0 wa ğŸ‘‰ ç­‰å¾…è¾“å…¥è¾“å‡ºçš„CPUæ—¶é—´ç™¾åˆ†æ¯”0.0 hi ğŸ‘‰ ç¡¬ä»¶CPUä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0 si ğŸ‘‰ è½¯ä¸­æ–­å ç”¨ç™¾åˆ†æ¯”0.0 st ğŸ‘‰ è™šæ‹Ÿæœºï¼ˆè™šæ‹ŸåŒ–æŠ€æœ¯ï¼‰å ç”¨ç™¾åˆ†æ¯”ç¬¬å››è¡ŒKiB Memæ˜¯ç‰©ç†å†…å­˜ä¿¡æ¯4046212 total ğŸ‘‰ ç‰©ç†å†…å­˜æ€»é‡127012 free ğŸ‘‰ ç©ºé—²ç‰©ç†å†…å­˜æ€»é‡1575164 used ğŸ‘‰ å·²ä½¿ç”¨ç‰©ç†å†…å­˜æ€»é‡2344036 buff/cache ğŸ‘‰ ç”¨æˆ·å†…æ ¸ç¼“å­˜çš„å†…å­˜æ€»é‡ç¬¬äº”è¡ŒKiB Swapæ˜¯äº¤æ¢åŒºå†…å­˜ä¿¡æ¯4194300 total ğŸ‘‰ äº¤æ¢åŒºæ€»é‡4171260 free ğŸ‘‰ ç©ºé—²äº¤æ¢åŒºæ€»é‡23040 used ğŸ‘‰ å·²ä½¿ç”¨äº¤æ¢åŒºæ€»é‡1984224 avail Mem ğŸ‘‰ ç¼“å†²çš„äº¤æ¢åŒºæ€»é‡,å†…å­˜ä¸­çš„å†…å®¹è¢«æ¢å‡ºåˆ°äº¤æ¢åŒºï¼Œè€Œååˆè¢«æ¢å…¥åˆ°å†…å­˜ï¼Œä½†ä½¿ç”¨è¿‡çš„äº¤æ¢åŒºå°šæœªè¢«è¦†ç›–ï¼Œè¯¥æ•°å€¼å³ä¸ºè¿™äº›å†…å®¹å·²å­˜åœ¨äºå†…å­˜ä¸­çš„äº¤æ¢åŒºçš„å¤§å°,ç›¸åº”çš„å†…å­˜å†æ¬¡è¢«æ¢å‡ºæ—¶å¯ä¸å¿…å†å¯¹äº¤æ¢åŒºå†™å…¥ã€‚ç¬¬å…­è¡Œæ˜¯ç©ºè¡Œç¬¬ä¸ƒè¡Œä»¥åçš„å†…å®¹æ˜¯å„è¿›ç¨‹ï¼ˆä»»åŠ¡ï¼‰çš„çŠ¶æ€ä¿¡æ¯PID ğŸ‘‰ è¿›ç¨‹IDï¼Œè¿›ç¨‹çš„å”¯ä¸€æ ‡è¯†ç¬¦USER ğŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„å®é™…ç”¨æˆ·åPR ğŸ‘‰ è¿›ç¨‹çš„è°ƒåº¦ä¼˜å…ˆçº§ã€‚è¿™ä¸ªå­—æ®µçš„ä¸€äº›å€¼æ˜¯rtï¼Œæ„å‘³ç€è¿›ç¨‹åœ¨å®æ—¶è¿è¡Œä¸­ã€‚NI ğŸ‘‰ è¿›ç¨‹çš„niceå€¼ï¼ˆä¼˜å…ˆçº§ï¼‰ã€‚è¶Šå°çš„å€¼æ„å‘³ç€è¶Šé«˜çš„ä¼˜å…ˆçº§ã€‚è´Ÿå€¼è¡¨ç¤ºé«˜ä¼˜å…ˆçº§ï¼Œæ­£å€¼è¡¨ç¤ºä½ä¼˜å…ˆçº§ã€‚VIRT ğŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ã€‚è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜æ€»é‡ï¼Œå•ä½kbã€‚VIRT = SWAP + RESRES ğŸ‘‰ é©»ç•™å†…å­˜å¤§å°ã€‚é©»ç•™å†…å­˜æ˜¯ä»»åŠ¡ä½¿ç”¨çš„éäº¤æ¢ç‰©ç†å†…å­˜å¤§å°ã€‚è¿›ç¨‹ä½¿ç”¨çš„ã€æœªè¢«æ¢å‡ºçš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbã€‚RES = CODE + DATASHR ğŸ‘‰ SHR æ˜¯è¿›ç¨‹ä½¿ç”¨çš„å…±äº«å†…å­˜å¤§å°ï¼Œå•ä½kbS ğŸ‘‰ æ˜¯è¿›ç¨‹çš„çŠ¶æ€ï¼Œæœ‰ä»¥ä¸‹å‡ ä¸ªå€¼ï¼šD ğŸ‘‰ ä¸å¯ä¸­æ–­çš„ç¡çœ æ€ã€‚R ğŸ‘‰ è¿è¡Œæ€S ğŸ‘‰ ç¡çœ æ€T ğŸ‘‰ è¢«è·Ÿè¸ªæˆ–å·²åœæ­¢Z ğŸ‘‰ åƒµå°¸æ€%CPU ğŸ‘‰ è‡ªä»ä¸Šä¸€æ¬¡æ›´æ–°æ—¶åˆ°ç°åœ¨ä»»åŠ¡æ‰€ä½¿ç”¨çš„CPUæ—¶é—´ç™¾åˆ†æ¯”ã€‚%MEM ğŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„å¯ç”¨ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”ã€‚TIME+ ğŸ‘‰ ä»»åŠ¡å¯åŠ¨ååˆ°ç°åœ¨æ‰€ä½¿ç”¨çš„å…¨éƒ¨CPUæ—¶é—´ï¼Œç²¾ç¡®åˆ°ç™¾åˆ†ä¹‹ä¸€ç§’ã€‚COMMAND ğŸ‘‰ è¿è¡Œè¿›ç¨‹æ‰€ä½¿ç”¨çš„å‘½ä»¤ã€‚è¿›ç¨‹åç§°ï¼ˆå‘½ä»¤å/å‘½ä»¤è¡Œï¼‰å…¶ä»–éé‡è¦åˆ—PPID ğŸ‘‰ çˆ¶è¿›ç¨‹IDRUSER ğŸ‘‰ çœŸå®ç”¨æˆ·åUID ğŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„ç”¨æˆ·IDGROUP ğŸ‘‰ è¿›ç¨‹æ‰€æœ‰è€…çš„ç»„åTTY ğŸ‘‰ å¯åŠ¨è¿›ç¨‹çš„ç»ˆç«¯åã€‚ä¸æ˜¯ä»ç»ˆç«¯å¯åŠ¨çš„è¿›ç¨‹åˆ™æ˜¾ç¤ºä¸º?P ğŸ‘‰ æœ€åä½¿ç”¨çš„CPUï¼Œä»…åœ¨å¤šCPUç¯å¢ƒä¸‹æœ‰æ„ä¹‰TIME ğŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„CPUæ—¶é—´æ€»è®¡ï¼Œå•ä½ç§’SWAP ğŸ‘‰ è¿›ç¨‹ä½¿ç”¨çš„è™šæ‹Ÿå†…å­˜ä¸­ï¼Œè¢«æ¢å‡ºçš„å¤§å°ï¼Œå•ä½kbCODE ğŸ‘‰ å¯æ‰§è¡Œä»£ç å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbDATA ğŸ‘‰ å¯æ‰§è¡Œä»£ç ä»¥å¤–çš„éƒ¨åˆ†ï¼ˆæ•°æ®æ®µ+æ ˆï¼‰å ç”¨çš„ç‰©ç†å†…å­˜å¤§å°ï¼Œå•ä½kbnFLT ğŸ‘‰ é¡µé¢é”™è¯¯æ¬¡æ•°nDRT ğŸ‘‰ æœ€åä¸€æ¬¡å†™å…¥åˆ°ç°åœ¨ï¼Œè¢«ä¿®æ”¹è¿‡çš„é¡µé¢æ•°WCHAN ğŸ‘‰ è‹¥è¯¥è¿›ç¨‹åœ¨ç¡çœ ï¼Œåˆ™æ˜¾ç¤ºç¡çœ ä¸­çš„ç³»ç»Ÿå‡½æ•°åFlags ğŸ‘‰ ä»»åŠ¡æ ‡å¿— topå­¦ä¹  topå‘½ä»¤æ˜¯ç”¨æ¥ç›‘æ§Linuxç³»ç»ŸçŠ¶å†µï¼Œæ¯”å¦‚cpuã€å†…å­˜çš„ä½¿ç”¨ã€‚ è¯­æ³• 1top [-] [d] [p] [q] [c] [C] [S] [s] [n] å‚æ•°è§£æ d ğŸ‘‰ æŒ‡å®šæ¯ä¸¤æ¬¡å±å¹•ä¿¡æ¯åˆ·æ–°ä¹‹é—´çš„æ—¶é—´é—´éš”ã€‚å½“ç„¶ç”¨æˆ·å¯ä»¥ä½¿ç”¨säº¤äº’å‘½ä»¤æ¥æ”¹å˜ã€‚p ğŸ‘‰ é€šè¿‡æŒ‡å®šç›‘æ§è¿›ç¨‹IDæ¥ä»…ä»…ç›‘æ§æŸä¸ªè¿›ç¨‹çš„çŠ¶æ€ã€‚q ğŸ‘‰ è¯¥é€‰é¡¹å°†ä½¿topæ²¡æœ‰ä»»ä½•å»¶è¿Ÿçš„è¿›è¡Œåˆ·æ–°ã€‚å¦‚æœè°ƒç”¨ç¨‹åºæœ‰è¶…çº§ç”¨æˆ·æƒé™ï¼Œé‚£ä¹ˆtopå°†ä»¥å°½å¯èƒ½é«˜çš„ä¼˜å…ˆçº§è¿è¡Œã€‚S ğŸ‘‰ æŒ‡å®šç´¯è®¡æ¨¡å¼ã€‚s ğŸ‘‰ ä½¿topå‘½ä»¤åœ¨å®‰å…¨æ¨¡å¼ä¸­è¿è¡Œã€‚è¿™å°†å»é™¤äº¤äº’å‘½ä»¤æ‰€å¸¦æ¥çš„æ½œåœ¨å±é™©ã€‚i ğŸ‘‰ ä½¿topä¸æ˜¾ç¤ºä»»ä½•é—²ç½®æˆ–è€…åƒµæ­»è¿›ç¨‹ã€‚c ğŸ‘‰ æ˜¾ç¤ºæ•´ä¸ªå‘½ä»¤è¡Œè€Œä¸åªæ˜¯æ˜¾ç¤ºå‘½ä»¤åã€‚ å¸¸ç”¨äº¤äº’å‘½ä»¤ Ctrl+L ğŸ‘‰ æ“¦é™¤å¹¶ä¸”é‡å†™å±å¹•ã€‚hæˆ–è€…? ğŸ‘‰ æ˜¾ç¤ºå¸®åŠ©ç”»é¢ï¼Œç»™å‡ºä¸€äº›ç®€çŸ­çš„å‘½ä»¤æ€»ç»“è¯´æ˜ã€‚k ğŸ‘‰ ç»ˆæ­¢ä¸€ä¸ªè¿›ç¨‹ã€‚ç³»ç»Ÿå°†æç¤ºç”¨æˆ·è¾“å…¥éœ€è¦ç»ˆæ­¢çš„è¿›ç¨‹PIDï¼Œä»¥åŠéœ€è¦å‘é€ç»™è¯¥è¿›ç¨‹ä»€ä¹ˆæ ·çš„ä¿¡å·ã€‚ä¸€èˆ¬çš„ç»ˆæ­¢è¿›ç¨‹å¯ä»¥ä½¿ç”¨15ä¿¡å·ï¼›å¦‚æœä¸èƒ½æ­£å¸¸ç»“æŸé‚£å°±ä½¿ç”¨ä¿¡å·9å¼ºåˆ¶ç»“æŸè¯¥è¿›ç¨‹ã€‚é»˜è®¤å€¼æ˜¯ä¿¡å·15ã€‚åœ¨å®‰å…¨æ¨¡å¼ä¸­æ­¤å‘½ä»¤è¢«å±è”½ã€‚i ğŸ‘‰ å¿½ç•¥é—²ç½®å’Œåƒµæ­»è¿›ç¨‹ã€‚è¿™æ˜¯ä¸€ä¸ªå¼€å…³å¼å‘½ä»¤ã€‚q ğŸ‘‰ é€€å‡ºç¨‹åºã€‚r ğŸ‘‰ é‡æ–°å®‰æ’ä¸€ä¸ªè¿›ç¨‹çš„ä¼˜å…ˆçº§åˆ«ã€‚ç³»ç»Ÿæç¤ºç”¨æˆ·è¾“å…¥éœ€è¦æ”¹å˜çš„è¿›ç¨‹PIDä»¥åŠéœ€è¦è®¾ç½®çš„è¿›ç¨‹ä¼˜å…ˆçº§å€¼ã€‚è¾“å…¥ä¸€ä¸ªæ­£å€¼å°†ä½¿ä¼˜å…ˆçº§é™ä½ï¼Œåä¹‹åˆ™å¯ä»¥ä½¿è¯¥è¿›ç¨‹æ‹¥æœ‰æ›´é«˜çš„ä¼˜å…ˆæƒã€‚é»˜è®¤å€¼æ˜¯10ã€‚s ğŸ‘‰ æ”¹å˜ä¸¤æ¬¡åˆ·æ–°ä¹‹é—´çš„å»¶è¿Ÿæ—¶é—´ã€‚ç³»ç»Ÿå°†æç¤ºç”¨æˆ·è¾“å…¥æ–°çš„æ—¶é—´ï¼Œå•ä½ä¸ºsã€‚å¦‚æœæœ‰å°æ•°ï¼Œå°±æ¢ç®—æˆm sã€‚è¾“å…¥0å€¼åˆ™ç³»ç»Ÿå°†ä¸æ–­åˆ·æ–°ï¼Œé»˜è®¤å€¼æ˜¯5 sã€‚éœ€è¦æ³¨æ„çš„æ˜¯å¦‚æœè®¾ç½®å¤ªå°çš„æ—¶é—´ï¼Œå¾ˆå¯èƒ½ä¼šå¼•èµ·ä¸æ–­åˆ·æ–°ï¼Œä»è€Œæ ¹æœ¬æ¥ä¸åŠçœ‹æ¸…æ˜¾ç¤ºçš„æƒ…å†µï¼Œè€Œä¸”ç³»ç»Ÿè´Ÿè½½ä¹Ÿä¼šå¤§å¤§å¢åŠ ã€‚fæˆ–è€…F ğŸ‘‰ ä»å½“å‰æ˜¾ç¤ºä¸­æ·»åŠ æˆ–è€…åˆ é™¤é¡¹ç›®ã€‚oæˆ–è€…O ğŸ‘‰ æ”¹å˜æ˜¾ç¤ºé¡¹ç›®çš„é¡ºåºã€‚l ğŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå¹³å‡è´Ÿè½½å’Œå¯åŠ¨æ—¶é—´ä¿¡æ¯ã€‚m ğŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå†…å­˜ä¿¡æ¯ã€‚t ğŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºè¿›ç¨‹å’ŒCPUçŠ¶æ€ä¿¡æ¯ã€‚c ğŸ‘‰ åˆ‡æ¢æ˜¾ç¤ºå‘½ä»¤åç§°å’Œå®Œæ•´å‘½ä»¤è¡Œã€‚M ğŸ‘‰ æ ¹æ®é©»ç•™å†…å­˜å¤§å°è¿›è¡Œæ’åºã€‚P ğŸ‘‰ æ ¹æ®CPUä½¿ç”¨ç™¾åˆ†æ¯”å¤§å°è¿›è¡Œæ’åºã€‚T ğŸ‘‰ æ ¹æ®æ—¶é—´/ç´¯è®¡æ—¶é—´è¿›è¡Œæ’åºã€‚W ğŸ‘‰ å°†å½“å‰è®¾ç½®å†™å…¥~/.toprcæ–‡ä»¶ä¸­ã€‚è¿™æ˜¯å†™topé…ç½®æ–‡ä»¶çš„æ¨èæ–¹æ³•ã€‚Shift+M ğŸ‘‰ å¯æŒ‰å†…å­˜å ç”¨æƒ…å†µè¿›è¡Œæ’åºã€‚Enter/space ğŸ‘‰ åˆ·æ–°è§†å›¾A ğŸ‘‰ åœ¨å…¨å±æ¨¡å¼å’Œå¤šçª—å£é€‰æ‹©æ¨¡å¼ä¹‹é—´åˆ‡æ¢d ğŸ‘‰ è®¾ç½®åˆ·æ–°çš„æ—¶é—´é—´éš”E ğŸ‘‰ åˆ‡æ¢å†…å­˜å’Œäº¤æ¢åŒºå•ä½H ğŸ‘‰ å¼€å¯/å…³é—­çº¿ç¨‹æ¨¡å¼ï¼Œä»¥çº¿ç¨‹çš„æ–¹å¼å±•ç¤ºZ ğŸ‘‰ æ”¹å˜é¢œè‰²é…ç½® ä½¿ç”¨ç¤ºä¾‹ 1234567top //æ¯éš”5ç§’æ˜¾å¼æ‰€æœ‰è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -d 2 //æ¯éš”2ç§’æ˜¾å¼æ‰€æœ‰è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -c //æ¯éš”5ç§’æ˜¾å¼è¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µï¼Œå¹¶æ˜¾ç¤ºè¿›ç¨‹çš„å‘½ä»¤è¡Œå‚æ•°(é»˜è®¤åªæœ‰è¿›ç¨‹å)top -p 12345 -p 6789 //æ¯éš”5ç§’æ˜¾ç¤ºpidæ˜¯12345å’Œpidæ˜¯6789çš„ä¸¤ä¸ªè¿›ç¨‹çš„èµ„æºå ç”¨æƒ…å†µtop -d 2 -c -p 123456 //æ¯éš”2ç§’æ˜¾ç¤ºpidæ˜¯12345çš„è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µï¼Œå¹¶æ˜¾å¼è¯¥è¿›ç¨‹å¯åŠ¨çš„å‘½ä»¤è¡Œå‚æ•°ps -eLf | grep java | wc -l //ç›‘æ§javaçº¿ç¨‹æ•°netstat -n | grep tcp | grep ä¾¦å¬ç«¯å£ | wc -l //ç›‘æ§ç½‘ç»œå®¢æˆ·è¿æ¥æ•° threadcount.log æ¥ç€çœ‹ä¸‹30669_threadcount.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—çš„å†…å®¹æ˜¯30669è¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ•°é‡ã€‚ ç»Ÿè®¡ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•° ä¸‹é¢å­¦ä¹ ä¸‹å¦‚ä½•ç»Ÿè®¡ä¸€ä¸ªè¿›ç¨‹ä¸­çš„çº¿ç¨‹æ•°ã€‚ proc ä¼ªæ–‡ä»¶ç³»ç»Ÿï¼Œå®ƒé©»ç•™åœ¨ /proc ç›®å½•ï¼Œè¿™æ˜¯æœ€ç®€å•çš„æ–¹æ³•æ¥æŸ¥çœ‹ä»»ä½•æ´»åŠ¨è¿›ç¨‹çš„çº¿ç¨‹æ•°ã€‚ /proc ç›®å½•ä»¥å¯è¯»æ–‡æœ¬æ–‡ä»¶å½¢å¼è¾“å‡ºï¼Œæä¾›ç°æœ‰è¿›ç¨‹å’Œç³»ç»Ÿç¡¬ä»¶ç›¸å…³çš„ä¿¡æ¯å¦‚ CPUã€ä¸­æ–­ã€å†…å­˜ã€ç£ç›˜ç­‰ç­‰ã€‚ 12345cat/proc/&lt;pid&gt;/statusæˆ–è€… ls /proc/&lt;pid&gt;/task|wc ä¸Šé¢çš„å‘½ä»¤å°†æ˜¾ç¤ºè¿›ç¨‹ &lt;pid&gt; çš„è¯¦ç»†ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¿‡ç¨‹çŠ¶æ€ï¼ˆä¾‹å¦‚, sleeping, running)ï¼Œçˆ¶è¿›ç¨‹ PIDï¼ŒUIDï¼ŒGIDï¼Œä½¿ç”¨çš„æ–‡ä»¶æè¿°ç¬¦çš„æ•°é‡ï¼Œä»¥åŠä¸Šä¸‹æ–‡åˆ‡æ¢çš„æ•°é‡ã€‚è¾“å‡ºä¹ŸåŒ…æ‹¬è¿›ç¨‹åˆ›å»ºçš„æ€»çº¿ç¨‹æ•°ã€‚ ç¤ºä¾‹å¦‚ä¸‹ï¼› é¦–å…ˆä½¿ç”¨topå‘½ä»¤æŸ¥ä¸€ä¸‹å½“å‰å ç”¨èµ„æºæœ€å¤šçš„è¿›ç¨‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œå½“å‰13985æ˜¯å ç”¨èµ„æºæœ€å¤šï¼Œæ¥ä¸‹æ¥å°±çœ‹ä¸€ä¸‹13985è¿›ç¨‹ä¸‹çš„çº¿ç¨‹æ•°ï¼Œå¦‚ä¸‹å›¾ï¼š tcp.log æ¥ç€å†çœ‹ä¸‹30669_tcp.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—å†…å®¹æ˜¯ç»Ÿè®¡æ¡ˆå‘æ—¶TCPçš„è¿æ¥æ•°ï¼Œä¸‹é¢å­¦ä¹ ä¸‹å¦‚ä½•è·å–TCPè¿æ¥æ•°ã€‚ æ–¹æ³•ä¸€ 1ss -ant | awk 'NR&gt;1 {a[$1]++} END {for (b in a) print b,a[b]}' æ–¹æ³•äºŒ 1netstat -an | awk '/^tcp/ {a[$NF]++} END {for (b in a) print b,a[b]}' æ–¹æ³•ä¸‰ 1netstat -nat|awk '{print $6}'|sort|uniq -c|sort -rn æ–¹æ³•å›› 1cat /proc/net/snmp è¾“å‡ºå†…å®¹ä¸­çš„å„é¡¹å‚æ•°çš„æ„ä¹‰ï¼Œè¯·å‚è€ƒ http://perthcharles.github.io/2015/11/10/wiki-netstat-proc/ lsof.log æ¥ç€å†çœ‹ä¸‹30669_lsof.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¿™ä¸ªæ–‡ä»¶çš„å†…å®¹ç©¶ç«Ÿæ˜¯ä»€ä¹ˆå«ä¹‰ï¼Œå…¶å®æˆ‘ä¹Ÿä¸çŸ¥é“ğŸ˜‚ï¼Œæ¨æµ‹å¯èƒ½æ˜¯ç»Ÿè®¡çš„æ‰“å¼€çš„æ–‡ä»¶æ•°æˆ–è€…æ‰“å¼€çš„æ–‡ä»¶å¤§å°ã€‚ lsof å‘½ä»¤è¯¦è§£ ç®€ä»‹ lsof(list open files)æ˜¯ä¸€ä¸ªåˆ—å‡ºå½“å‰ç³»ç»Ÿæ‰“å¼€æ–‡ä»¶çš„å·¥å…·ã€‚ åœ¨linuxç¯å¢ƒä¸‹ï¼Œä»»ä½•äº‹ç‰©éƒ½ä»¥æ–‡ä»¶çš„å½¢å¼å­˜åœ¨ï¼Œé€šè¿‡æ–‡ä»¶ä¸ä»…ä»…å¯ä»¥è®¿é—®å¸¸è§„æ•°æ®ï¼Œè¿˜å¯ä»¥è®¿é—®ç½‘ç»œè¿æ¥å’Œç¡¬ä»¶ã€‚æ‰€ä»¥å¦‚ä¼ è¾“æ§åˆ¶åè®® (TCP) å’Œç”¨æˆ·æ•°æ®æŠ¥åè®® (UDP) å¥—æ¥å­—ç­‰ï¼Œç³»ç»Ÿåœ¨åå°éƒ½ä¸ºè¯¥åº”ç”¨ç¨‹åºåˆ†é…äº†ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œæ— è®ºè¿™ä¸ªæ–‡ä»¶çš„æœ¬è´¨å¦‚ä½•ï¼Œè¯¥æ–‡ä»¶æè¿°ç¬¦ä¸ºåº”ç”¨ç¨‹åºä¸åŸºç¡€æ“ä½œç³»ç»Ÿä¹‹é—´çš„äº¤äº’æä¾›äº†é€šç”¨æ¥å£ã€‚å› ä¸ºåº”ç”¨ç¨‹åºæ‰“å¼€æ–‡ä»¶çš„æè¿°ç¬¦åˆ—è¡¨æä¾›äº†å¤§é‡å…³äºè¿™ä¸ªåº”ç”¨ç¨‹åºæœ¬èº«çš„ä¿¡æ¯ï¼Œå› æ­¤é€šè¿‡lsofå·¥å…·èƒ½å¤ŸæŸ¥çœ‹è¿™ä¸ªåˆ—è¡¨å¯¹ç³»ç»Ÿç›‘æµ‹ä»¥åŠæ’é”™å°†æ˜¯å¾ˆæœ‰å¸®åŠ©çš„ã€‚ è¾“å‡ºä¿¡æ¯è§£æ åœ¨ç»ˆç«¯ä¸‹è¾“å…¥lsofå³å¯æ˜¾ç¤ºç³»ç»Ÿæ‰“å¼€çš„æ–‡ä»¶ï¼Œå› ä¸º lsof éœ€è¦è®¿é—®æ ¸å¿ƒå†…å­˜å’Œå„ç§æ–‡ä»¶ï¼Œæ‰€ä»¥å¿…é¡»ä»¥ root ç”¨æˆ·çš„èº«ä»½è¿è¡Œå®ƒæ‰èƒ½å¤Ÿå……åˆ†åœ°å‘æŒ¥å…¶åŠŸèƒ½ã€‚ æ¯è¡Œæ˜¾ç¤ºä¸€ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼Œè‹¥ä¸æŒ‡å®šæ¡ä»¶é»˜è®¤å°†æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹æ‰“å¼€çš„æ‰€æœ‰æ–‡ä»¶ã€‚lsofè¾“å‡ºå„åˆ—ä¿¡æ¯çš„æ„ä¹‰å¦‚ä¸‹ï¼š COMMANDï¼šè¿›ç¨‹çš„åç§°PIDï¼šè¿›ç¨‹æ ‡è¯†ç¬¦USERï¼šè¿›ç¨‹æ‰€æœ‰è€…FDï¼šæ–‡ä»¶æè¿°ç¬¦ï¼Œåº”ç”¨ç¨‹åºé€šè¿‡æ–‡ä»¶æè¿°ç¬¦è¯†åˆ«è¯¥æ–‡ä»¶ã€‚å¦‚cwdã€txtç­‰ TYPEï¼šæ–‡ä»¶ç±»å‹ï¼Œå¦‚DIRã€REGç­‰DEVICEï¼šæŒ‡å®šç£ç›˜çš„åç§°SIZEï¼šæ–‡ä»¶çš„å¤§å°NODEï¼šç´¢å¼•èŠ‚ç‚¹ï¼ˆæ–‡ä»¶åœ¨ç£ç›˜ä¸Šçš„æ ‡è¯†ï¼‰NAMEï¼šæ‰“å¼€æ–‡ä»¶çš„ç¡®åˆ‡åç§°FD åˆ—ä¸­çš„æ–‡ä»¶æè¿°ç¬¦cwd å€¼è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„å½“å‰å·¥ä½œç›®å½•ï¼Œè¿™æ˜¯è¯¥åº”ç”¨ç¨‹åºå¯åŠ¨çš„ç›®å½•ï¼Œé™¤éå®ƒæœ¬èº«å¯¹è¿™ä¸ªç›®å½•è¿›è¡Œæ›´æ”¹,txt ç±»å‹çš„æ–‡ä»¶æ˜¯ç¨‹åºä»£ç ï¼Œå¦‚åº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ–‡ä»¶æœ¬èº«æˆ–å…±äº«åº“ï¼Œå¦‚ä¸Šåˆ—è¡¨ä¸­æ˜¾ç¤ºçš„ /sbin/init ç¨‹åºã€‚å…¶æ¬¡æ•°å€¼è¡¨ç¤ºåº”ç”¨ç¨‹åºçš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¿™æ˜¯æ‰“å¼€è¯¥æ–‡ä»¶æ—¶è¿”å›çš„ä¸€ä¸ªæ•´æ•°ã€‚å¦‚ä¸Šçš„æœ€åä¸€è¡Œæ–‡ä»¶/dev/initctlï¼Œå…¶æ–‡ä»¶æè¿°ç¬¦ä¸º 10ã€‚u è¡¨ç¤ºè¯¥æ–‡ä»¶è¢«æ‰“å¼€å¹¶å¤„äºè¯»å–/å†™å…¥æ¨¡å¼ï¼Œè€Œä¸æ˜¯åªè¯» Â® æˆ–åªå†™ (w) æ¨¡å¼ã€‚åŒæ—¶è¿˜æœ‰å¤§å†™ çš„W è¡¨ç¤ºè¯¥åº”ç”¨ç¨‹åºå…·æœ‰å¯¹æ•´ä¸ªæ–‡ä»¶çš„å†™é”ã€‚è¯¥æ–‡ä»¶æè¿°ç¬¦ç”¨äºç¡®ä¿æ¯æ¬¡åªèƒ½æ‰“å¼€ä¸€ä¸ªåº”ç”¨ç¨‹åºå®ä¾‹ã€‚åˆå§‹æ‰“å¼€æ¯ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œéƒ½å…·æœ‰ä¸‰ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œä» 0 åˆ° 2ï¼Œåˆ†åˆ«è¡¨ç¤ºæ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯æµã€‚æ‰€ä»¥å¤§å¤šæ•°åº”ç”¨ç¨‹åºæ‰€æ‰“å¼€çš„æ–‡ä»¶çš„ FD éƒ½æ˜¯ä» 3 å¼€å§‹ã€‚ä¸ FD åˆ—ç›¸æ¯”ï¼ŒType åˆ—åˆ™æ¯”è¾ƒç›´è§‚ã€‚æ–‡ä»¶å’Œç›®å½•åˆ†åˆ«ç§°ä¸º REG å’Œ DIRã€‚è€ŒCHR å’Œ BLKï¼Œåˆ†åˆ«è¡¨ç¤ºå­—ç¬¦å’Œå—è®¾å¤‡ï¼›æˆ–è€… UNIXã€FIFO å’Œ IPv4ï¼Œåˆ†åˆ«è¡¨ç¤º UNIX åŸŸå¥—æ¥å­—ã€å…ˆè¿›å…ˆå‡º (FIFO) é˜Ÿåˆ—å’Œç½‘é™…åè®® (IP) å¥—æ¥å­—ã€‚ è¯­æ³•æ ¼å¼ 1lsof ï¼»optionsï¼½ filename histolive.log æ¥ç€å†æ¥çœ‹30669_histolive.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š è¯¥æ—¥å¿—è®°å½•äº†æ¡ˆå‘æ—¶heapä¸­çš„æ‰€æœ‰å¯¹è±¡æƒ…å†µï¼ŒåŒ…æ‹¬å¯¹è±¡çš„æ•°é‡ã€æ‰€å ç©ºé—´å¤§å°ã€ç±»åã€‚ æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š 1jmap -histo[:live] pid è¾“å‡ºè¯´æ˜ï¼š instancesåˆ—ï¼šè¡¨ç¤ºå½“å‰ç±»æœ‰å¤šå°‘ä¸ªå®ä¾‹ã€‚bytesåˆ—ï¼šè¯´æ˜å½“å‰ç±»çš„å®ä¾‹æ€»å…±å ç”¨äº†å¤šå°‘ä¸ªå­—èŠ‚class nameåˆ—ï¼šè¡¨ç¤ºçš„å°±æ˜¯å½“å‰ç±»çš„åç§°ï¼Œclass name è§£è¯»ï¼šBä»£è¡¨byteCä»£è¡¨charDä»£è¡¨doubleFä»£è¡¨floatIä»£è¡¨intJä»£è¡¨longZä»£è¡¨booleanå‰è¾¹æœ‰[ä»£è¡¨æ•°ç»„ï¼Œ[I å°±ç›¸å½“äºint[]å¯¹è±¡ç”¨[L+ç±»åè¡¨ç¤º heap.log æ¥ç€å†æ¥çœ‹30669_heap.logçš„å†…å®¹ï¼Œå› å†…å®¹è¿‡é•¿ï¼Œæˆªå–ä¸»è¦å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šé¢çš„å†…å®¹ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨å‘½ä»¤jmap -heap pid æ‰“å°jvmå†…å­˜æ•´ä½“ä½¿ç”¨æƒ…å†µï¼Œå¯ä»¥è§‚å¯Ÿåˆ°New Generationï¼ˆEden Spaceï¼ŒFrom Spaceï¼ŒTo Spaceï¼‰,tenured generation,Perm Generationçš„å†…å­˜ä½¿ç”¨æƒ…å†µã€‚ ä»å›¾ä¸­å†…å®¹å¯ä»¥çœ‹å‡ºæ–°ç”ŸåŒºå’Œè€å¹´åŒºçš„å†…å­˜ä½¿ç”¨ç‡å‡ ä¹è¾¾åˆ°äº†100%ï¼Œç”±æ­¤å¯ä»¥æ¨æ–­é€ æˆè¿™æ¬¡äº‹æ•…çš„åŸå› æ˜¯åˆ›å»ºçš„å¯¹è±¡è¿‡å¤šï¼Œå†ç»“åˆä¸Šé¢äº†è§£è¿‡çš„30669_histolive.logï¼Œå°±èƒ½æ‰¾åˆ°æ˜¯å“ªäº›å¯¹è±¡åˆ›å»ºè¿‡å¤šã€‚å†ç»“åˆåé¢è¦è®²çš„çº¿ç¨‹å †æ ˆä¿¡æ¯å®šä½åˆ°å…·ä½“è°ƒç”¨çš„ä»£ç æ®µã€‚ gc.logã€gccapacity.log æ¥ç€å†æ¥çœ‹30669_gc.logçš„å†…å®¹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸Šå›¾å†…å®¹æ˜¯æ˜¾ç¤ºå †å†…å­˜çš„å„ä¸ªå æ¯”ï¼Œå¯é€šè¿‡å¦‚ä¸‹å‘½ä»¤æŸ¥çœ‹ï¼š 1jstat -gcutil &lt;pid&gt; ç°åœ¨è§£é‡Šä¸‹è¾“å‡ºå†…å®¹æ¯ä¸ªé¡¹çš„å«ä¹‰ï¼š S0 ğŸ‘‰ å¹¸å­˜1åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹S1 ğŸ‘‰ å¹¸å­˜2åŒºå½“å‰ä½¿ç”¨æ¯”ä¾‹E ğŸ‘‰ ä¼Šç”¸å›­åŒºä½¿ç”¨æ¯”ä¾‹O ğŸ‘‰ è€å¹´ä»£ä½¿ç”¨æ¯”ä¾‹M ğŸ‘‰ å…ƒæ•°æ®åŒºä½¿ç”¨æ¯”ä¾‹CCS ğŸ‘‰ å‹ç¼©ä½¿ç”¨æ¯”ä¾‹YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°YGCT ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´FGC ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGCT ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´GCT ğŸ‘‰ åƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´ 30669_gccapacity.logçš„å†…å®¹å¦‚ä¸‹å›¾ï¼š è¾“å‡ºå„é¡¹å«ä¹‰å¦‚ä¸‹ï¼š NGCMN ğŸ‘‰ æ–°ç”Ÿä»£æœ€å°å®¹é‡NGCMX ğŸ‘‰ æ–°ç”Ÿä»£æœ€å¤§å®¹é‡NGC ğŸ‘‰ å½“å‰æ–°ç”Ÿä»£å®¹é‡S0C ğŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°S1C ğŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°EC ğŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°OGCMN ğŸ‘‰ è€å¹´ä»£æœ€å°å®¹é‡OGCMX ğŸ‘‰ è€å¹´ä»£æœ€å¤§å®¹é‡OGC ğŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°OC ğŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°MCMN ğŸ‘‰ æœ€å°å…ƒæ•°æ®å®¹é‡MCMX ğŸ‘‰ æœ€å¤§å…ƒæ•°æ®å®¹é‡MC ğŸ‘‰ å½“å‰å…ƒæ•°æ®ç©ºé—´å¤§å°CCSMN ğŸ‘‰ æœ€å°å‹ç¼©ç±»ç©ºé—´å¤§å°CCSMX ğŸ‘‰ æœ€å¤§å‹ç¼©ç±»ç©ºé—´å¤§å°CCSC ğŸ‘‰ å½“å‰å‹ç¼©ç±»ç©ºé—´å¤§å°YGC ğŸ‘‰ å¹´è½»ä»£gcæ¬¡æ•°FGC ğŸ‘‰ è€å¹´ä»£GCæ¬¡æ•° jstat jstatæ˜¯JDKè‡ªå¸¦çš„ä¸€ä¸ªè½»é‡çº§å°å·¥å…·ã€‚å…¨ç§° Java Virtual Machine statistics monitoring toolï¼Œå®ƒä½äºjavaçš„binç›®å½•ä¸‹ï¼Œä¸»è¦åˆ©ç”¨JVMå†…å»ºçš„æŒ‡ä»¤å¯¹Javaåº”ç”¨ç¨‹åºçš„èµ„æºå’Œæ€§èƒ½è¿›è¡Œå®æ—¶çš„å‘½ä»¤è¡Œçš„ç›‘æ§ï¼ŒåŒ…æ‹¬äº†å¯¹Heap sizeå’Œåƒåœ¾å›æ”¶çŠ¶å†µçš„ç›‘æ§ã€‚ è¯­æ³•æ ¼å¼ 1jstat -&lt;option&gt; [-t] [-h&lt;lines&gt;] &lt;vmid&gt; [&lt;interval&gt; [&lt;count&gt;]] è¯­æ³•æ ¼å¼ä¸­çš„optionæ˜¯ã€Œå‘½ä»¤é€‰é¡¹ã€ï¼Œintervalæ˜¯ã€Œé—´éš”æ—¶é—´/æ¯«ç§’ã€ï¼Œcount æ˜¯ã€ŒæŸ¥è¯¢æ¬¡æ•°ã€ã€‚ jstatæ”¯æŒçš„optioné€šè¿‡jstat -optionè¿›è¡ŒæŸ¥çœ‹ï¼Œå¦‚ä¸‹å›¾ï¼š ä¸‹é¢ä»¥jdk1.8ä¸ºä¾‹äº†è§£ä¸‹jstatå‘½ä»¤æŸ¥çœ‹jvmçš„GCæƒ…å†µã€‚ ç±»åŠ è½½ç»Ÿè®¡ Loaded ğŸ‘‰ åŠ è½½classçš„æ•°é‡Bytes ğŸ‘‰ æ‰€å ç”¨ç©ºé—´å¤§å°Unloaded ğŸ‘‰ æœªåŠ è½½æ•°é‡Bytes ğŸ‘‰ æœªåŠ è½½å ç”¨ç©ºé—´Time ğŸ‘‰ æ—¶é—´ ç¼–è¯‘ç»Ÿè®¡ Compiled ğŸ‘‰ ç¼–è¯‘æ•°é‡ã€‚Failed ğŸ‘‰ å¤±è´¥æ•°é‡Invalid ğŸ‘‰ ä¸å¯ç”¨æ•°é‡Time ğŸ‘‰ æ—¶é—´FailedType ğŸ‘‰ å¤±è´¥ç±»å‹FailedMethod ğŸ‘‰ å¤±è´¥çš„æ–¹æ³• åƒåœ¾å›æ”¶ç»Ÿè®¡ S0C ğŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„å¤§å°S1C ğŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°S0U ğŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°S1U ğŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°EC ğŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°EU ğŸ‘‰ ä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°OC ğŸ‘‰ è€å¹´ä»£å¤§å°OU ğŸ‘‰ è€å¹´ä»£ä½¿ç”¨å¤§å°MC ğŸ‘‰ æ–¹æ³•åŒºå¤§å°MU ğŸ‘‰ æ–¹æ³•åŒºä½¿ç”¨å¤§å°CCSC ğŸ‘‰ å‹ç¼©ç±»ç©ºé—´å¤§å°CCSU ğŸ‘‰ å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°YGCT ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´FGC ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGCT ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´GCT ğŸ‘‰ åƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´ å †å†…å­˜ç»Ÿè®¡ è¾“å‡ºå„é¡¹æ„ä¹‰å‚è€ƒ30669_gccapacity.logã€‚ æ–°ç”Ÿä»£åƒåœ¾å›æ”¶ç»Ÿè®¡ S0C ğŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºå¤§å°S1C ğŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„å¤§å°S0U ğŸ‘‰ ç¬¬ä¸€ä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°S1U ğŸ‘‰ ç¬¬äºŒä¸ªå¹¸å­˜åŒºçš„ä½¿ç”¨å¤§å°TT ğŸ‘‰ å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æ¬¡æ•°MTT ğŸ‘‰ å¯¹è±¡åœ¨æ–°ç”Ÿä»£å­˜æ´»çš„æœ€å¤§æ¬¡æ•°DSS ğŸ‘‰ æœŸæœ›çš„å¹¸å­˜åŒºå¤§å°EC ğŸ‘‰ ä¼Šç”¸å›­åŒºçš„å¤§å°EU ğŸ‘‰ ä¼Šç”¸å›­åŒºçš„ä½¿ç”¨å¤§å°YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°YGCT ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´ æ–°ç”Ÿä»£å†…å­˜ç»Ÿè®¡ NGCMN ğŸ‘‰ æ–°ç”Ÿä»£æœ€å°å®¹é‡NGCMX ğŸ‘‰ æ–°ç”Ÿä»£æœ€å¤§å®¹é‡NGC ğŸ‘‰ å½“å‰æ–°ç”Ÿä»£å®¹é‡S0CMX ğŸ‘‰ æœ€å¤§å¹¸å­˜1åŒºå¤§å°S0C ğŸ‘‰ å½“å‰å¹¸å­˜1åŒºå¤§å°S1CMX ğŸ‘‰ æœ€å¤§å¹¸å­˜2åŒºå¤§å°S1C ğŸ‘‰ å½“å‰å¹¸å­˜2åŒºå¤§å°ECMX ğŸ‘‰ æœ€å¤§ä¼Šç”¸å›­åŒºå¤§å°EC ğŸ‘‰ å½“å‰ä¼Šç”¸å›­åŒºå¤§å°YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGC ğŸ‘‰ è€å¹´ä»£å›æ”¶æ¬¡æ•° è€å¹´ä»£åƒåœ¾å›æ”¶ç»Ÿè®¡ MC ğŸ‘‰ æ–¹æ³•åŒºå¤§å°MU ğŸ‘‰ æ–¹æ³•åŒºä½¿ç”¨å¤§å°CCSC ğŸ‘‰ å‹ç¼©ç±»ç©ºé—´å¤§å°CCSU ğŸ‘‰ å‹ç¼©ç±»ç©ºé—´ä½¿ç”¨å¤§å°OC ğŸ‘‰ è€å¹´ä»£å¤§å°OU ğŸ‘‰ è€å¹´ä»£ä½¿ç”¨å¤§å°YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGC ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGCT ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´GCT ğŸ‘‰ åƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´ è€å¹´ä»£å†…å­˜ç»Ÿè®¡ OGCMN ğŸ‘‰ è€å¹´ä»£æœ€å°å®¹é‡OGCMX ğŸ‘‰ è€å¹´ä»£æœ€å¤§å®¹é‡OGC ğŸ‘‰ å½“å‰è€å¹´ä»£å¤§å°OC ğŸ‘‰ è€å¹´ä»£å¤§å°YGC ğŸ‘‰ å¹´è½»ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGC ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¬¡æ•°FGCT ğŸ‘‰ è€å¹´ä»£åƒåœ¾å›æ”¶æ¶ˆè€—æ—¶é—´GCT ğŸ‘‰ åƒåœ¾å›æ”¶æ¶ˆè€—æ€»æ—¶é—´ å †å†…å­˜å æ¯” å‚è€ƒ30669_gc.logå†…å®¹åŠè§£æã€‚ jvmç¼–è¯‘æ–¹æ³•ç»Ÿè®¡ Compiled ğŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„æ•°é‡Size ğŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„å­—èŠ‚ç æ•°é‡Type ğŸ‘‰ æœ€è¿‘ç¼–è¯‘æ–¹æ³•çš„ç¼–è¯‘ç±»å‹ã€‚Method ğŸ‘‰ æ–¹æ³•åæ ‡è¯†ã€‚ stack.log æœ€åæ¥çœ‹ä¸‹30669_1_stack.logã€30669_2_stack.logå’Œ30669_3_stack.logçš„æ–‡ä»¶å†…å®¹ï¼Œå› å†…å®¹è¿‡é•¿ï¼Œæš‚å…ˆæˆªå–éƒ¨åˆ†å†…å®¹å±•ç¤ºï¼Œå¦‚ä¸‹å›¾ï¼š Thread Dump ç®€ä»‹ Thread Dumpæ˜¯éå¸¸æœ‰ç”¨çš„è¯Šæ–­Javaåº”ç”¨é—®é¢˜çš„å·¥å…·ã€‚æ¯ä¸€ä¸ªJavaè™šæ‹Ÿæœºéƒ½æœ‰åŠæ—¶ç”Ÿæˆæ‰€æœ‰çº¿ç¨‹åœ¨æŸä¸€ç‚¹çŠ¶æ€çš„thread-dumpçš„èƒ½åŠ›ï¼Œè™½ç„¶å„ä¸ª Javaè™šæ‹Ÿæœºæ‰“å°çš„thread dumpç•¥æœ‰ä¸åŒï¼Œä½†æ˜¯å¤§å¤šéƒ½æä¾›äº†å½“å‰æ´»åŠ¨çº¿ç¨‹çš„å¿«ç…§ï¼ŒåŠJVMä¸­æ‰€æœ‰Javaçº¿ç¨‹çš„å †æ ˆè·Ÿè¸ªä¿¡æ¯ï¼Œå †æ ˆä¿¡æ¯ä¸€èˆ¬åŒ…å«å®Œæ•´çš„ç±»ååŠæ‰€æ‰§è¡Œçš„æ–¹æ³•ï¼Œå¦‚æœå¯èƒ½çš„è¯è¿˜æœ‰æºä»£ç çš„è¡Œæ•°ã€‚ åœ¨å®é™…è¿è¡Œä¸­ï¼Œå¾€å¾€ä¸€æ¬¡ dumpçš„ä¿¡æ¯ï¼Œè¿˜ä¸è¶³ä»¥ç¡®è®¤é—®é¢˜ã€‚å»ºè®®äº§ç”Ÿä¸‰æ¬¡ dumpä¿¡æ¯ï¼ˆæ‰€ä»¥å°±åƒè¿™æ¬¡çš„æ¡ˆä¾‹ä¼šdumpä¸‰æ¬¡stack,æ¯æ¬¡é—´éš”3ç§’ï¼‰ï¼Œå¦‚æœæ¯æ¬¡ dumpéƒ½æŒ‡å‘åŒä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬æ‰ç¡®å®šé—®é¢˜çš„å…¸å‹æ€§ã€‚ä¹Ÿå°±æ˜¯å¤šè¿›è¡Œå‡ æ¬¡çº¿ç¨‹å¿«ç…§ï¼Œè§‚å¯Ÿå˜åŒ–ï¼ŒæŸ¥çœ‹é—®é¢˜æ‰€åœ¨ã€‚ ç‰¹ç‚¹ èƒ½åœ¨å„ç§æ“ä½œç³»ç»Ÿä¸‹ä½¿ç”¨ èƒ½åœ¨å„ç§Javaåº”ç”¨æœåŠ¡å™¨ä¸‹ä½¿ç”¨ å¯ä»¥åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹ä½¿ç”¨è€Œä¸å½±å“ç³»ç»Ÿçš„æ€§èƒ½ å¯ä»¥å°†é—®é¢˜ç›´æ¥å®šä½åˆ°åº”ç”¨ç¨‹åºçš„ä»£ç è¡Œä¸Š èƒ½è¯Šæ–­çš„é—®é¢˜ æŸ¥æ‰¾å†…å­˜æ³„éœ²ï¼Œå¸¸è§çš„æ˜¯ç¨‹åºé‡Œloadå¤§é‡çš„æ•°æ®åˆ°ç¼“å­˜ï¼› å‘ç°æ­»é”çº¿ç¨‹ï¼› å¦‚ä½•æŠ“å–Thread Dump JDKè‡ªå¸¦å‘½ä»¤è¡Œå·¥å…·è·å–PIDï¼Œå†è·å–ThreadDump: jps æˆ–&nbsp;ps â€“ef|grepjava (è·å–PID) 2.&nbsp;jstack [-l ]&lt;pid&gt; | tee -a jstack.log &nbsp;(è·å–ThreadDump) Thread Dumpç»“æ„ ä¸€ä¸ªå…¸å‹çš„thread dumpæ–‡ä»¶ä¸»è¦ç”±ä¸€ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š ä¸Šå›¾å°†JVMä¸Šçš„çº¿ç¨‹å †æ ˆä¿¡æ¯å’Œçº¿ç¨‹ä¿¡æ¯åšäº†è¯¦ç»†çš„æ‹†è§£ã€‚ 1printf "%x\n" 20696 ç¬¬ä¸€éƒ¨åˆ†ï¼šFull thread dump identifier è¿™ä¸€éƒ¨åˆ†æ˜¯å†…å®¹æœ€å¼€å§‹çš„éƒ¨åˆ†ï¼Œå±•ç¤ºäº†å¿«ç…§æ–‡ä»¶çš„ç”Ÿæˆæ—¶é—´å’ŒJVMçš„ç‰ˆæœ¬ä¿¡æ¯ã€‚ 122019-09-28 15:48:28Full thread dump Java HotSpot(TM) 64-Bit Server VM (25.131-b11 mixed mode): ç¬¬äºŒéƒ¨åˆ†ï¼šJava EE middleware, third party &amp; custom application Threads è¿™æ˜¯æ•´ä¸ªæ–‡ä»¶çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé‡Œé¢å±•ç¤ºäº†JavaEEå®¹å™¨ï¼ˆå¦‚tomcatã€resinç­‰ï¼‰ã€è‡ªå·±çš„ç¨‹åºä¸­æ‰€ä½¿ç”¨çš„çº¿ç¨‹ä¿¡æ¯ã€‚è¿™ä¸€éƒ¨åˆ†è¯¦ç»†çš„å«ä¹‰åé¢å†ä»‹ç»ã€‚ 12345678"Thread-3" #26 daemon prio=9 os_prio=0 tid=0x00007f1ff40ae000 nid=0x77f5 waiting on condition [0x00007f1ff1bfa000] java.lang.Thread.State: WAITING (parking) at sun.misc.Unsafe.park(Native Method) - parking to wait for &lt;0x00000000c14fed38&gt; (a java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject) at java.util.concurrent.locks.LockSupport.park(LockSupport.java:175) at java.util.concurrent.locks.AbstractQueuedSynchronizer$ConditionObject.await(AbstractQueuedSynchronizer.java:2039) at java.util.concurrent.LinkedBlockingQueue.take(LinkedBlockingQueue.java:442) at org.LatencyUtils.PauseDetector$PauseDetectorThread.run(PauseDetector.java:85) Thread-3 çº¿ç¨‹åç§°ï¼Œå½“ä½¿ç”¨java.lang.Threadç±»ç”Ÿæˆä¸€ä¸ªçº¿ç¨‹æ—¶ï¼Œå°†è¢«å‘½åä¸ºThre-(Number)ï¼Œè‹¥java.util.concurrent.ThreadFactoryç±»ï¼Œå°†ä¼šè¢«å‘½åä¸ºpool-(Number)-thread-(Number)daemon çº¿ç¨‹ç±»å‹ï¼Œçº¿ç¨‹åˆ†ä¸ºå®ˆæŠ¤çº¿ç¨‹ (daemon) å’Œéå®ˆæŠ¤çº¿ç¨‹ (non-daemon) ä¸¤ç§ï¼Œé€šå¸¸éƒ½æ˜¯å®ˆæŠ¤çº¿ç¨‹ï¼›prio=9 çº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤ä¸º5ï¼Œæ•°å­—è¶Šå¤§ä¼˜å…ˆçº§è¶Šé«˜ï¼›os_prio=0 æ“ä½œç³»ç»Ÿçº¿ç¨‹ä¼˜å…ˆçº§tid=0x00007f1ff40ae000 JVMçº¿ç¨‹çš„idï¼ŒJVMå†…éƒ¨çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œé€šè¿‡ java.lang.Thread.getId()è·å–ï¼Œé€šå¸¸ç”¨è‡ªå¢çš„æ–¹å¼å®ç°ï¼›nid=0x77f5 ç³»ç»Ÿçº¿ç¨‹idï¼Œå¯¹åº”çš„ç³»ç»Ÿçº¿ç¨‹idï¼ˆNative Thread ID)ï¼Œå¯ä»¥é€šè¿‡ top å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹ï¼Œæ˜¯åå…­è¿›åˆ¶çš„å½¢å¼ï¼›waiting on condition ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ï¼Œè¿™é‡Œæ˜¯ç³»ç»Ÿçš„çº¿ç¨‹çŠ¶æ€ï¼Œå…·ä½“çš„å«ä¹‰è§ä¸‹é¢ ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ éƒ¨åˆ†ï¼›0x00007f1ff1bfa000 èµ·å§‹æ ˆåœ°å€ï¼Œçº¿ç¨‹å †æ ˆè°ƒç”¨çš„å…¶å®å†…å­˜åœ°å€ï¼›java.lang.Thread.State: WAITING (parking) JVMçº¿ç¨‹çŠ¶æ€ï¼Œè¿™é‡Œæ ‡æ˜äº†çº¿ç¨‹åœ¨ä»£ç çº§åˆ«çš„çŠ¶æ€ï¼Œè¯¦ç»†çš„å†…å®¹è§ä¸‹é¢çš„ JVMçº¿ç¨‹è¿è¡ŒçŠ¶æ€ éƒ¨åˆ†ã€‚ ç¬¬ä¸‰éƒ¨åˆ†ï¼šHotSpot VM Thread è¿™ä¸€éƒ¨åˆ†å±•ç¤ºäº†JVMå†…éƒ¨çº¿ç¨‹çš„ä¿¡æ¯ï¼Œç”¨äºæ‰§è¡Œå†…éƒ¨çš„åŸç”Ÿæ“ä½œã€‚ä¸‹é¢å¸¸è§çš„å‡ ç§å†…ç½®çº¿ç¨‹ï¼š Attach Listener è¯¥çº¿ç¨‹è´Ÿè´£æ¥æ”¶å¤–éƒ¨å‘½ä»¤ï¼Œæ‰§è¡Œè¯¥å‘½ä»¤å¹¶æŠŠç»“æœè¿”å›ç»™è°ƒç”¨è€…ï¼Œæ­¤ç§ç±»å‹çš„çº¿ç¨‹é€šå¸¸åœ¨æ¡Œé¢ç¨‹åºä¸­å‡ºç°ã€‚ 12"Attach Listener" #62 daemon prio=9 os_prio=0 tid=0x00007f2014008800 nid=0x7868 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE DestroyJavaVM æ‰§è¡Œmain()çš„çº¿ç¨‹åœ¨æ‰§è¡Œå®Œä¹‹åè°ƒç”¨JNIä¸­çš„ jni_DestroyJavaVM() æ–¹æ³•ä¼šå”¤èµ·DestroyJavaVM çº¿ç¨‹ã€‚åœ¨JBosså¯åŠ¨ä¹‹åï¼Œä¹Ÿä¼šå”¤èµ·DestroyJavaVMçº¿ç¨‹ï¼Œå¤„äºç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…å…¶å®ƒçº¿ç¨‹ï¼ˆjavaçº¿ç¨‹å’Œnativeçº¿ç¨‹ï¼‰é€€å‡ºæ—¶é€šçŸ¥å®ƒå¸è½½JVMã€‚ 12"DestroyJavaVM" #83 prio=5 os_prio=0 tid=0x00007f203c009000 nid=0x77cf waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE Service Thread ç”¨äºå¯åŠ¨æœåŠ¡çš„çº¿ç¨‹ã€‚ 123456789101112"Service Thread" #7 daemon prio=9 os_prio=0 tid=0x00007f203c152800 nid=0x77d9 runnable [0x00007f2025ffd000] java.lang.Thread.State: RUNNABLE at java.lang.Class.getDeclaredFields0(Native Method) at java.lang.Class.privateGetDeclaredFields(Class.java:2583) at java.lang.Class.getDeclaredField(Class.java:2068) at sun.management.GarbageCollectionNotifInfoCompositeData$1.run(GarbageCollectionNotifInfoCompositeData.java:69) at sun.management.GarbageCollectionNotifInfoCompositeData$1.run(GarbageCollectionNotifInfoCompositeData.java:65) at java.security.AccessController.doPrivileged(Native Method) at sun.management.GarbageCollectionNotifInfoCompositeData.getCompositeTypeByBuilder(GarbageCollectionNotifInfoCompositeData.java:65) at sun.management.GarbageCollectionNotifInfoCompositeData.getCompositeData(GarbageCollectionNotifInfoCompositeData.java:116) at sun.management.GarbageCollectionNotifInfoCompositeData.toCompositeData(GarbageCollectionNotifInfoCompositeData.java:61) at sun.management.GarbageCollectorImpl.createGCNotification(GarbageCollectorImpl.java:141) CompilerThread ç”¨æ¥è°ƒç”¨JITingï¼Œå®æ—¶ç¼–è¯‘è£…å¸CLASSã€‚é€šå¸¸JVMä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™éƒ¨åˆ†å·¥ä½œï¼Œçº¿ç¨‹åç§°åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ï¼Œæ¯”å¦‚CompilerThread1ã€‚ 12345"C1 CompilerThread1" #6 daemon prio=9 os_prio=0 tid=0x00007f203c13d800 nid=0x77d8 waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE"C2 CompilerThread0" #5 daemon prio=9 os_prio=0 tid=0x00007f203c13a800 nid=0x77d7 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE Signal Dispatcher Attach Listenerçº¿ç¨‹çš„èŒè´£æ˜¯æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤ï¼Œå½“å‘½ä»¤æ¥æ”¶æˆåŠŸåï¼Œä¼šäº¤ç»™signal dispather çº¿ç¨‹å»è¿›è¡Œåˆ†å‘åˆ°å„ä¸ªä¸åŒçš„æ¨¡å—å¤„ç†å‘½ä»¤ï¼Œå¹¶ä¸”è¿”å›å¤„ç†ç»“æœã€‚ signal dispatherçº¿ç¨‹ä¹Ÿæ˜¯åœ¨ç¬¬ä¸€æ¬¡æ¥æ”¶å¤–éƒ¨jvmå‘½ä»¤æ—¶ï¼Œè¿›è¡Œåˆå§‹åŒ–å·¥ä½œã€‚ 12"Signal Dispatcher" #4 daemon prio=9 os_prio=0 tid=0x00007f203c139000 nid=0x77d6 runnable [0x0000000000000000] java.lang.Thread.State: RUNNABLE Finalizer è¿™ä¸ªçº¿ç¨‹ä¹Ÿæ˜¯åœ¨mainçº¿ç¨‹ä¹‹ååˆ›å»ºçš„ï¼Œå…¶ä¼˜å…ˆçº§ä¸º10ï¼Œä¸»è¦ç”¨äºåœ¨åƒåœ¾æ”¶é›†å‰ï¼Œè°ƒç”¨å¯¹è±¡çš„finalize()æ–¹æ³•ï¼› å…³äºFinalizerçº¿ç¨‹çš„å‡ ç‚¹ï¼š ï¼ˆ1ï¼‰åªæœ‰å½“å¼€å§‹ä¸€è½®åƒåœ¾æ”¶é›†æ—¶ï¼Œæ‰ä¼šå¼€å§‹è°ƒç”¨finalize()æ–¹æ³•ï¼›å› æ­¤å¹¶ä¸æ˜¯æ‰€æœ‰å¯¹è±¡çš„finalize()æ–¹æ³•éƒ½ä¼šè¢«æ‰§è¡Œï¼› ï¼ˆ2ï¼‰è¯¥çº¿ç¨‹ä¹Ÿæ˜¯daemonçº¿ç¨‹ï¼Œå› æ­¤å¦‚æœè™šæ‹Ÿæœºä¸­æ²¡æœ‰å…¶ä»–édaemonçº¿ç¨‹ï¼Œä¸ç®¡è¯¥çº¿ç¨‹æœ‰æ²¡æœ‰æ‰§è¡Œå®Œfinalize()æ–¹æ³•ï¼ŒJVMä¹Ÿä¼šé€€å‡ºï¼› ï¼ˆ3ï¼‰JVMåœ¨åƒåœ¾æ”¶é›†æ—¶ä¼šå°†å¤±å»å¼•ç”¨çš„å¯¹è±¡åŒ…è£…æˆFinalizerå¯¹è±¡ï¼ˆReferenceçš„å®ç°ï¼‰ï¼Œå¹¶æ”¾å…¥ReferenceQueueï¼Œç”±Finalizerçº¿ç¨‹æ¥å¤„ç†ï¼›æœ€åå°†è¯¥Finalizerå¯¹è±¡çš„å¼•ç”¨ç½®ä¸ºnullï¼Œç”±åƒåœ¾æ”¶é›†å™¨æ¥å›æ”¶ï¼› ï¼ˆ4ï¼‰JVMä¸ºä»€ä¹ˆè¦å•ç‹¬ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œfinalize()æ–¹æ³•å‘¢ï¼Ÿ å¦‚æœJVMçš„åƒåœ¾æ”¶é›†çº¿ç¨‹è‡ªå·±æ¥åšï¼Œå¾ˆæœ‰å¯èƒ½ç”±äºåœ¨finalize()æ–¹æ³•ä¸­è¯¯æ“ä½œå¯¼è‡´GCçº¿ç¨‹åœæ­¢æˆ–ä¸å¯æ§ï¼Œè¿™å¯¹GCçº¿ç¨‹æ¥è¯´æ˜¯ä¸€ç§ç¾éš¾ã€‚ 1234567"Finalizer" #3 daemon prio=8 os_prio=0 tid=0x00007f203c106000 nid=0x77d5 in Object.wait() [0x00007f202c41b000] java.lang.Thread.State: WAITING (on object monitor) at java.lang.Object.wait(Native Method) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:143) - locked &lt;0x00000000c022a288&gt; (a java.lang.ref.ReferenceQueue$Lock) at java.lang.ref.ReferenceQueue.remove(ReferenceQueue.java:164) at java.lang.ref.Finalizer$FinalizerThread.run(Finalizer.java:209) Reference Handler JVMåœ¨åˆ›å»ºmainçº¿ç¨‹åå°±åˆ›å»ºReference Handlerçº¿ç¨‹ï¼Œå…¶ä¼˜å…ˆçº§æœ€é«˜ï¼Œä¸º10ï¼Œå®ƒä¸»è¦ç”¨äºå¤„ç†å¼•ç”¨å¯¹è±¡æœ¬èº«ï¼ˆè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨ï¼‰çš„åƒåœ¾å›æ”¶é—®é¢˜ ã€‚ 1234567"Reference Handler" #2 daemon prio=10 os_prio=0 tid=0x00007f203c101800 nid=0x77d4 in Object.wait() [0x00007f202c51c000] java.lang.Thread.State: BLOCKED (on object monitor) at java.lang.Object.wait(Native Method) at java.lang.Object.wait(Object.java:502) at java.lang.ref.Reference.tryHandlePending(Reference.java:191) - locked &lt;0x00000000c00e5800&gt; (a java.lang.ref.Reference$Lock) at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:153) VM Thread JVMä¸­çº¿ç¨‹çš„æ¯ä½“ï¼Œæ ¹æ®HotSpotæºç ä¸­å…³äºvmThread.hppé‡Œé¢çš„æ³¨é‡Šï¼Œå®ƒæ˜¯ä¸€ä¸ªå•ä¾‹çš„å¯¹è±¡ï¼ˆæœ€åŸå§‹çš„çº¿ç¨‹ï¼‰ä¼šäº§ç”Ÿæˆ–è§¦å‘æ‰€æœ‰å…¶ä»–çš„çº¿ç¨‹ï¼Œè¿™ä¸ªå•ä¾‹çš„VMçº¿ç¨‹æ˜¯ä¼šè¢«å…¶ä»–çº¿ç¨‹æ‰€ä½¿ç”¨æ¥åšä¸€äº›VMæ“ä½œï¼ˆå¦‚æ¸…æ‰«åƒåœ¾ç­‰ï¼‰ã€‚ åœ¨ VM Thread çš„ç»“æ„ä½“é‡Œæœ‰ä¸€ä¸ªVMOperationQueueåˆ—é˜Ÿï¼Œæ‰€æœ‰çš„VMçº¿ç¨‹æ“ä½œ(vm_operation)éƒ½ä¼šè¢«ä¿å­˜åˆ°è¿™ä¸ªåˆ—é˜Ÿå½“ä¸­ï¼ŒVMThread æœ¬èº«å°±æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œå®ƒçš„çº¿ç¨‹è´Ÿè´£æ‰§è¡Œä¸€ä¸ªè‡ªè½®è¯¢çš„loopå‡½æ•°(å…·ä½“å¯ä»¥å‚è€ƒï¼šVMThread.cppé‡Œé¢çš„void VMThread::loop()) ï¼Œè¯¥loopå‡½æ•°ä»VMOperationQueueåˆ—é˜Ÿä¸­æŒ‰ç…§ä¼˜å…ˆçº§å–å‡ºå½“å‰éœ€è¦æ‰§è¡Œçš„æ“ä½œå¯¹è±¡(VM_Operation)ï¼Œå¹¶ä¸”è°ƒç”¨VM_Operation-&gt;evaluateå‡½æ•°å»æ‰§è¡Œè¯¥æ“ä½œç±»å‹æœ¬èº«çš„ä¸šåŠ¡é€»è¾‘ã€‚ VMæ“ä½œç±»å‹è¢«å®šä¹‰åœ¨vm_operations.hppæ–‡ä»¶å†…ï¼Œåˆ—ä¸¾å‡ ä¸ªï¼šThreadStopã€ThreadDumpã€PrintThreadsã€GenCollectFullã€GenCollectFullConcurrentã€CMS_Initial_Markã€CMS_Final_Remarkâ€¦.. æœ‰å…´è¶£çš„åŒå­¦ï¼Œå¯ä»¥è‡ªå·±å»æŸ¥çœ‹æºæ–‡ä»¶ã€‚ 1"VM Thread" os_prio=0 tid=0x00007f203c0fa000 nid=0x77d3 runnable ç¬¬å››éƒ¨åˆ†ï¼šHotSpot GC Thread VMä¸­ç”¨äºè¿›è¡Œèµ„æºå›æ”¶çš„çº¿ç¨‹ï¼ŒåŒ…æ‹¬ä»¥ä¸‹å‡ ç§ç±»å‹çš„çº¿ç¨‹ï¼š VM Periodic Task Thread è¯¥çº¿ç¨‹æ˜¯JVMå‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„çº¿ç¨‹ï¼Œå®ƒç”±WatcherThreadåˆ›å»ºï¼Œæ˜¯ä¸€ä¸ªå•ä¾‹å¯¹è±¡ã€‚è¯¥çº¿ç¨‹åœ¨JVMå†…ä½¿ç”¨å¾—æ¯”è¾ƒé¢‘ç¹ï¼Œæ¯”å¦‚ï¼šå®šæœŸçš„å†…å­˜ç›‘æ§ã€JVMè¿è¡ŒçŠ¶å†µç›‘æ§ã€‚ 1"VM Periodic Task Thread" os_prio=0 tid=0x00007f203c155800 nid=0x77da waiting on condition å¯ä»¥ä½¿ç”¨jstat å‘½ä»¤æŸ¥çœ‹GCçš„æƒ…å†µï¼Œæ¯”å¦‚æŸ¥çœ‹æŸä¸ªè¿›ç¨‹æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨å¯ä»¥ä½¿ç”¨å‘½ä»¤ jstat -gcutil &lt;pid&gt; 250 7 å‚æ•°ä¸­pidæ˜¯è¿›ç¨‹idï¼Œåé¢çš„250å’Œ7è¡¨ç¤ºæ¯250æ¯«ç§’æ‰“å°ä¸€æ¬¡ï¼Œæ€»å…±æ‰“å°7æ¬¡ã€‚ è¿™å¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨nativeåº“æˆ–è€…ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚ GC task thread#0 (ParallelGC) åƒåœ¾å›æ”¶çº¿ç¨‹ï¼Œè¯¥çº¿ç¨‹ä¼šè´Ÿè´£è¿›è¡Œåƒåœ¾å›æ”¶ã€‚é€šå¸¸JVMä¼šå¯åŠ¨å¤šä¸ªçº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªå·¥ä½œï¼Œçº¿ç¨‹åç§°ä¸­#åé¢çš„æ•°å­—ä¹Ÿä¼šç´¯åŠ ã€‚ 123"GC task thread#0 (ParallelGC)" os_prio=0 tid=0x00007f203c01e000 nid=0x77d1 runnable "GC task thread#1 (ParallelGC)" os_prio=0 tid=0x00007f203c020000 nid=0x77d2 runnable Gang worker#0 (Parallel GC Threads) å¦‚æœåœ¨JVMä¸­å¢åŠ äº† -XX:+UseConcMarkSweepGC å‚æ•°å°†ä¼šå¯ç”¨CMS ï¼ˆConcurrent Mark-Sweepï¼‰GC Threadæ–¹å¼ï¼ŒåŸæ¥åƒåœ¾å›æ”¶çº¿ç¨‹GC task thread#0 (ParallelGC) è¢«æ›¿æ¢ä¸º Gang worker#0 (Parallel GC Threads)ã€‚Gang worker æ˜¯JVMç”¨äºå¹´è½»ä»£åƒåœ¾å›æ”¶(minor gc)çš„çº¿ç¨‹ã€‚ 123"Gang worker#0 (Parallel GC Threads)" prio=10 tid=0x00007fbea801b800 nid=0x5e4 runnable "Gang worker#1 (Parallel GC Threads)" prio=10 tid=0x00007fbea801d800 nid=0x5e7 runnable Concurrent Mark-Sweep GC Thread å¹¶å‘æ ‡è®°æ¸…é™¤åƒåœ¾å›æ”¶å™¨ï¼ˆå°±æ˜¯é€šå¸¸æ‰€è¯´çš„CMS GCï¼‰çº¿ç¨‹ï¼Œ è¯¥çº¿ç¨‹ä¸»è¦é’ˆå¯¹äºå¹´è€ä»£åƒåœ¾å›æ”¶ã€‚ 1"Concurrent Mark-Sweep GC Thread" prio=10 tid=0x00007fbea8073800 nid=0x5e8 runnable Surrogate Locker Thread (Concurrent GC) æ­¤çº¿ç¨‹ä¸»è¦é…åˆCMSåƒåœ¾å›æ”¶å™¨æ¥ä½¿ç”¨ï¼Œæ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£å¤„ç†GCè¿‡ç¨‹ä¸­Javaå±‚çš„Referenceï¼ˆæŒ‡è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ç­‰ç­‰ï¼‰ä¸jvm å†…éƒ¨å±‚é¢çš„å¯¹è±¡çŠ¶æ€åŒæ­¥ã€‚ 12"Surrogate Locker Thread (Concurrent GC)" daemon prio=10 tid=0x00007fbea8158800 nid=0x5ee waiting on condition [0x0000000000000000] java.lang.Thread.State: RUNNABLE è¿™é‡Œä»¥ WeakHashMap ä¸ºä¾‹è¿›è¡Œè¯´æ˜ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªå…³é”®ç‚¹ï¼š WeakHashMapå’ŒHashMapä¸€æ ·ï¼Œå†…éƒ¨æœ‰ä¸€ä¸ªEntry[]æ•°ç»„; WeakHashMapçš„Entryæ¯”è¾ƒç‰¹æ®Šï¼Œå®ƒçš„ç»§æ‰¿ä½“ç³»ç»“æ„ä¸ºEntry-&gt;WeakReference-&gt;Reference; Reference é‡Œé¢æœ‰ä¸€ä¸ªå…¨å±€é”å¯¹è±¡ï¼šLockï¼Œå®ƒä¹Ÿè¢«ç§°ä¸ºpending_lockï¼Œæ³¨æ„ï¼šå®ƒæ˜¯é™æ€å¯¹è±¡ï¼› Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å˜é‡ï¼špendingï¼› Reference é‡Œé¢æœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ï¼šReferenceHandlerçš„çº¿ç¨‹ï¼Œå®ƒåœ¨staticå—é‡Œé¢è¢«åˆå§‹åŒ–å¹¶ä¸”å¯åŠ¨ï¼Œå¯åŠ¨å®Œæˆåå¤„äºwaitçŠ¶æ€ï¼Œå®ƒåœ¨ä¸€ä¸ªLockåŒæ­¥é”æ¨¡å—ä¸­ç­‰å¾…ï¼› WeakHashMapé‡Œé¢è¿˜å®ä¾‹åŒ–äº†ä¸€ä¸ªReferenceQueueé˜Ÿåˆ—ï¼› å‡è®¾ï¼ŒWeakHashMapå¯¹è±¡é‡Œé¢å·²ç»ä¿å­˜äº†å¾ˆå¤šå¯¹è±¡çš„å¼•ç”¨ï¼ŒJVM åœ¨è¿›è¡ŒCMS GCçš„æ—¶å€™ä¼šåˆ›å»ºä¸€ä¸ªConcurrentMarkSweepThreadï¼ˆç®€ç§°CMSTï¼‰çº¿ç¨‹å»è¿›è¡ŒGCã€‚ConcurrentMarkSweepThreadçº¿ç¨‹è¢«åˆ›å»ºçš„åŒæ—¶ä¼šåˆ›å»ºä¸€ä¸ªSurrogateLockerThreadï¼ˆç®€ç§°SLTï¼‰çº¿ç¨‹å¹¶ä¸”å¯åŠ¨å®ƒï¼ŒSLTå¯åŠ¨ä¹‹åï¼Œå¤„äºç­‰å¾…é˜¶æ®µã€‚ CMSTå¼€å§‹GCæ—¶ï¼Œä¼šå‘ä¸€ä¸ªæ¶ˆæ¯ç»™SLTè®©å®ƒå»è·å–Javaå±‚Referenceå¯¹è±¡çš„å…¨å±€é”ï¼šLockã€‚ç›´åˆ°CMS GCå®Œæ¯•ä¹‹åï¼ŒJVM ä¼šå°†WeakHashMapä¸­æ‰€æœ‰è¢«å›æ”¶çš„å¯¹è±¡æ‰€å±çš„WeakReferenceå®¹å™¨å¯¹è±¡æ”¾å…¥åˆ°Reference çš„pendingå±æ€§å½“ä¸­ï¼ˆæ¯æ¬¡GCå®Œæ¯•ä¹‹åï¼Œpendingå±æ€§åŸºæœ¬ä¸Šéƒ½ä¸ä¼šä¸ºnulläº†ï¼‰ï¼Œç„¶åé€šçŸ¥SLTé‡Šæ”¾å¹¶ä¸”notifyå…¨å±€é”:Lockã€‚æ­¤æ—¶æ¿€æ´»äº†ReferenceHandlerçº¿ç¨‹çš„runæ–¹æ³•ï¼Œä½¿å…¶è„±ç¦»waitçŠ¶æ€ï¼Œå¼€å§‹å·¥ä½œäº†ã€‚ ReferenceHandlerè¿™ä¸ªçº¿ç¨‹ä¼šå°†pendingä¸­çš„æ‰€æœ‰WeakReferenceå¯¹è±¡éƒ½ç§»åŠ¨åˆ°å®ƒä»¬å„è‡ªçš„åˆ—é˜Ÿå½“ä¸­ï¼Œæ¯”å¦‚å½“å‰è¿™ä¸ªWeakReferenceå±äºæŸä¸ªWeakHashMapå¯¹è±¡ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šè¢«æ”¾å…¥ç›¸åº”çš„ReferenceQueueåˆ—é˜Ÿé‡Œé¢ï¼ˆè¯¥åˆ—é˜Ÿæ˜¯é“¾è¡¨ç»“æ„ï¼‰ã€‚ å½“æˆ‘ä»¬ä¸‹æ¬¡ä»WeakHashMapå¯¹è±¡é‡Œé¢getã€putæ•°æ®æˆ–è€…è°ƒç”¨sizeæ–¹æ³•çš„æ—¶å€™ï¼ŒWeakHashMapå°±ä¼šå°†ReferenceQueueåˆ—é˜Ÿä¸­çš„WeakReferenceä¾ä¾pollå‡ºæ¥å»å’ŒEntry[]æ•°æ®åšæ¯”è¾ƒï¼Œå¦‚æœå‘ç°ç›¸åŒçš„ï¼Œåˆ™è¯´æ˜è¿™ä¸ªEntryæ‰€ä¿å­˜çš„å¯¹è±¡å·²ç»è¢«GCæ‰äº†ï¼Œé‚£ä¹ˆå°†Entry[]å†…çš„Entryå¯¹è±¡å‰”é™¤æ‰ã€‚ ç¬¬äº”éƒ¨åˆ†ï¼šJNI global references count è¿™ä¸€éƒ¨åˆ†ä¸»è¦å›æ”¶é‚£äº›åœ¨nativeä»£ç ä¸Šè¢«å¼•ç”¨ï¼Œä½†åœ¨javaä»£ç ä¸­å´æ²¡æœ‰å­˜æ´»å¿…è¦çš„å¼•ç”¨ï¼Œå¯¹äºé˜²æ­¢å› ä¸ºåº”ç”¨ä»£ç ä¸­ç›´æ¥ä½¿ç”¨nativeåº“æˆ–ç¬¬ä¸‰æ–¹çš„ä¸€äº›ç›‘æ§å·¥å…·çš„å†…å­˜æ³„æ¼æœ‰éå¸¸å¤§çš„å¸®åŠ©ã€‚ 1JNI global references: 1652 ç³»ç»Ÿçº¿ç¨‹çŠ¶æ€ &lt;a id="jumpOne"&gt;&lt;/a&gt; ç³»ç»Ÿçº¿ç¨‹æœ‰å¦‚ä¸‹çŠ¶æ€ï¼š deadlock(é‡ç‚¹å…³æ³¨) æ­»é”çº¿ç¨‹ï¼Œä¸€èˆ¬æŒ‡å¤šä¸ªçº¿ç¨‹è°ƒç”¨æœŸé—´è¿›å…¥äº†ç›¸äº’èµ„æºå ç”¨ï¼Œå¯¼è‡´ä¸€ç›´ç­‰å¾…æ— æ³•é‡Šæ”¾çš„æƒ…å†µã€‚ runnable ä¸€èˆ¬æŒ‡è¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡ŒçŠ¶æ€ä¸­ï¼Œè¯¥çº¿ç¨‹å ç”¨äº†èµ„æºï¼Œæ­£åœ¨å¤„ç†æŸä¸ªæ“ä½œï¼Œå¦‚é€šè¿‡SQLè¯­å¥æŸ¥è¯¢æ•°æ®åº“ã€å¯¹æŸä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥ç­‰ã€‚ blocked(é‡ç‚¹å…³æ³¨) çº¿ç¨‹æ­£å¤„äºé˜»å¡çŠ¶æ€ï¼ŒæŒ‡å½“å‰çº¿ç¨‹æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€éœ€è¦çš„èµ„æºé•¿æ—¶é—´ç­‰å¾…å´ä¸€ç›´æœªèƒ½è·å–åˆ°ï¼Œè¢«å®¹å™¨çš„çº¿ç¨‹ç®¡ç†å™¨æ ‡è¯†ä¸ºé˜»å¡çŠ¶æ€ï¼Œå¯ä»¥ç†è§£ä¸ºç­‰å¾…èµ„æºè¶…æ—¶çš„çº¿ç¨‹ã€‚ waiting on condition(é‡ç‚¹å…³æ³¨) çº¿ç¨‹æ­£å¤„äºç­‰å¾…èµ„æºæˆ–ç­‰å¾…æŸä¸ªæ¡ä»¶çš„å‘ç”Ÿï¼Œå…·ä½“çš„åŸå› éœ€è¦ç»“åˆå †æ ˆä¿¡æ¯è¿›è¡Œåˆ†æã€‚ å¦‚æœå †æ ˆä¿¡æ¯æ˜ç¡®æ˜¯åº”ç”¨ä»£ç ï¼Œåˆ™è¯æ˜è¯¥çº¿ç¨‹æ­£åœ¨ç­‰å¾…èµ„æºï¼Œä¸€èˆ¬æ˜¯å¤§é‡è¯»å–æŸç§èµ„æºä¸”è¯¥èµ„æºé‡‡ç”¨äº†èµ„æºé”çš„æƒ…å†µä¸‹ï¼Œçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç­‰å¾…èµ„æºçš„è¯»å–ï¼Œæˆ–è€…æ­£åœ¨ç­‰å¾…å…¶ä»–çº¿ç¨‹çš„æ‰§è¡Œç­‰ã€‚ å¦‚æœå‘ç°æœ‰å¤§é‡çš„çº¿ç¨‹éƒ½æ­£å¤„äºè¿™ç§çŠ¶æ€ï¼Œå¹¶ä¸”å †æ ˆä¿¡æ¯ä¸­å¾—çŸ¥æ­£ç­‰å¾…ç½‘ç»œè¯»å†™ï¼Œè¿™æ˜¯å› ä¸ºç½‘ç»œé˜»å¡å¯¼è‡´çº¿ç¨‹æ— æ³•æ‰§è¡Œï¼Œå¾ˆæœ‰å¯èƒ½æ˜¯ä¸€ä¸ªç½‘ç»œç“¶é¢ˆçš„å¾å…†ï¼š ç½‘ç»œéå¸¸ç¹å¿™ï¼Œå‡ ä¹æ¶ˆè€—äº†æ‰€æœ‰çš„å¸¦å®½ï¼Œä»ç„¶æœ‰å¤§é‡æ•°æ®ç­‰å¾…ç½‘ç»œè¯»å†™ï¼› ç½‘ç»œå¯èƒ½æ˜¯ç©ºé—²çš„ï¼Œä½†ç”±äºè·¯ç”±æˆ–é˜²ç«å¢™ç­‰åŸå› ï¼Œå¯¼è‡´åŒ…æ— æ³•æ­£å¸¸åˆ°è¾¾ï¼› æ‰€ä»¥ä¸€å®šè¦ç»“åˆç³»ç»Ÿçš„ä¸€äº›æ€§èƒ½è§‚å¯Ÿå·¥å…·è¿›è¡Œç»¼åˆåˆ†æï¼Œæ¯”å¦‚netstatç»Ÿè®¡å•ä½æ—¶é—´çš„å‘é€åŒ…çš„æ•°é‡ï¼Œçœ‹æ˜¯å¦å¾ˆæ˜æ˜¾è¶…è¿‡äº†æ‰€åœ¨ç½‘ç»œå¸¦å®½çš„é™åˆ¶ï¼›è§‚å¯ŸCPUçš„åˆ©ç”¨ç‡ï¼Œçœ‹ç³»ç»Ÿæ€çš„CPUæ—¶é—´æ˜¯å¦æ˜æ˜¾å¤§äºç”¨æˆ·æ€çš„CPUæ—¶é—´ã€‚è¿™äº›éƒ½æŒ‡å‘ç”±äºç½‘ç»œå¸¦å®½æ‰€é™å¯¼è‡´çš„ç½‘ç»œç“¶é¢ˆã€‚ è¿˜æœ‰ä¸€ç§å¸¸è§çš„æƒ…å†µæ˜¯è¯¥çº¿ç¨‹åœ¨ sleepï¼Œç­‰å¾… sleep çš„æ—¶é—´åˆ°äº†ï¼Œå°†è¢«å”¤é†’ã€‚ waiting for monitor entry æˆ– in Object.wait() Monitor æ˜¯Javaä¸­ç”¨ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„äº’æ–¥ä¸åä½œçš„ä¸»è¦æ‰‹æ®µï¼Œå®ƒå¯ä»¥çœ‹æˆæ˜¯å¯¹è±¡æˆ–è€…classçš„é”ï¼Œæ¯ä¸ªå¯¹è±¡éƒ½æœ‰ï¼Œä¹Ÿä»…æœ‰ä¸€ä¸ª Monitorã€‚ è°ƒç”¨ä¿®é¥°ï¼š locked &lt;åœ°å€&gt; ç›®æ ‡ï¼šæ³¨æ„ä¸´ç•ŒåŒºå¯¹è±¡é”å¯é‡å…¥ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºRUNNABLE; waitting to lock &lt;åœ°å€&gt; ç›®æ ‡ï¼šè¿˜æ²¡æœ‰è·å¾—é”ï¼Œè¿›å…¥åŒºç­‰å¾…ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºBLOCKED; waitting on &lt;åœ°å€&gt; ç›®æ ‡ï¼šè·å¾—é”äº†ï¼Œç­‰å¾…åŒºç­‰å¾…ï¼Œçº¿ç¨‹çŠ¶æ€ä¸ºWAITTING,TIMED_WAITTING; parking to wait for &lt;åœ°å€&gt; ç›®æ ‡ï¼šçº¿ç¨‹åŸè¯­ï¼ŒéšcurrentåŒ…å‡ºç°ï¼Œä¸synchronizedä½“ç³»ä¸åŒ; ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸ªMonitoråœ¨æŸä¸ªæ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‹¥æœ‰ï¼Œè¯¥çº¿ç¨‹å°±æ˜¯ Active Threadï¼Œè€Œå…¶ä»–çº¿ç¨‹éƒ½æ˜¯ Waiting Threadï¼Œåˆ†åˆ«åœ¨ä¸¤ä¸ªé˜Ÿåˆ— Entry Setå’ŒWait Seté‡Œé¢ç­‰å¾…ã€‚ å…¶ä¸­åœ¨ Entry Set ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ waiting for monitor entryï¼Œåœ¨ Wait Set ä¸­ç­‰å¾…çš„çº¿ç¨‹çŠ¶æ€æ˜¯ in Object.wait()ã€‚ Entry Seté‡Œé¢çš„çº¿ç¨‹ã€‚ æŠŠè¢« synchronized ä¿æŠ¤èµ·æ¥çš„ä»£ç æ®µä¸ºä¸´ç•ŒåŒºï¼Œä»£ç å¦‚ä¸‹ï¼š 123synchronized(obj) {} å½“ä¸€ä¸ªçº¿ç¨‹ç”³è¯·è¿›å…¥ä¸´ç•ŒåŒºæ—¶ï¼Œå®ƒå°±è¿›å…¥äº† Entry Set é˜Ÿåˆ—ä¸­ï¼Œè¿™æ—¶å€™æœ‰ä¸¤ç§å¯èƒ½æ€§ï¼š è¯¥Monitorä¸è¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼ŒEntry Seté‡Œé¢ä¹Ÿæ²¡æœ‰å…¶ä»–ç­‰å¾…çš„çº¿ç¨‹ã€‚æœ¬çº¿ç¨‹å³æˆä¸ºç›¸åº”ç±»æˆ–è€…å¯¹è±¡çš„Monitorçš„Ownerï¼Œæ‰§è¡Œä¸´ç•ŒåŒºé‡Œé¢çš„ä»£ç ï¼›æ­¤æ—¶åœ¨Thread Dumpä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº Runnable çŠ¶æ€ã€‚ è¯¥Monitorè¢«å…¶ä»–çº¿ç¨‹æ‹¥æœ‰ï¼Œæœ¬çº¿ç¨‹åœ¨ Entry Set é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚æ­¤æ—¶åœ¨Thread Dumpä¸­æ˜¾ç¤ºçº¿ç¨‹å¤„äº waiting for monity entry çŠ¶æ€ã€‚ ä¸´ç•ŒåŒºçš„è®¾ç½®æ˜¯ä¸ºäº†ä¿è¯å…¶å†…éƒ¨çš„ä»£ç æ‰§è¡Œçš„åŸå­æ€§å’Œå®Œæ•´æ€§ï¼Œä½†å› ä¸ºä¸´ç•ŒåŒºåœ¨ä»»ä½•æ—¶é—´åªå…è®¸çº¿ç¨‹ä¸²è¡Œé€šè¿‡ï¼Œè¿™å’Œæˆ‘ä»¬ä½¿ç”¨å¤šçº¿ç¨‹çš„åˆè¡·æ˜¯ç›¸åçš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­å¤§é‡ä½¿ç”¨synchronizedï¼Œæˆ–è€…ä¸é€‚å½“çš„ä½¿ç”¨å®ƒï¼Œä¼šé€ æˆå¤§é‡çº¿ç¨‹åœ¨ä¸´ç•ŒåŒºçš„å…¥å£ç­‰å¾…ï¼Œé€ æˆç³»ç»Ÿçš„æ€§èƒ½å¤§å¹…ä¸‹é™ã€‚å¦‚æœåœ¨Thread Dumpä¸­å‘ç°è¿™ä¸ªæƒ…å†µï¼Œåº”è¯¥å®¡è§†æºç å¹¶å¯¹å…¶è¿›è¡Œæ”¹è¿›ã€‚ Wait Seté‡Œé¢çš„çº¿ç¨‹ å½“çº¿ç¨‹è·å¾—äº†Monitorï¼Œè¿›å…¥äº†ä¸´ç•ŒåŒºä¹‹åï¼Œå¦‚æœå‘ç°çº¿ç¨‹ç»§ç»­è¿è¡Œçš„æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå®ƒåˆ™è°ƒç”¨å¯¹è±¡ï¼ˆé€šå¸¸æ˜¯è¢«synchronizedçš„å¯¹è±¡ï¼‰çš„wait()æ–¹æ³•ï¼Œæ”¾å¼ƒMonitorï¼Œè¿›å…¥ Wait Seté˜Ÿåˆ—ã€‚åªæœ‰å½“åˆ«çš„çº¿ç¨‹åœ¨è¯¥å¯¹è±¡ä¸Šè°ƒç”¨äº† notify()æˆ–è€…notifyAll()æ–¹æ³•ï¼ŒWait Seté˜Ÿåˆ—ä¸­çš„çº¿ç¨‹æ‰å¾—åˆ°æœºä¼šå»ç«äº‰ï¼Œä½†æ˜¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹è·å¾—å¯¹è±¡çš„Monitorï¼Œæ¢å¤åˆ°è¿è¡Œæ€ã€‚Wait Setä¸­çš„çº¿ç¨‹åœ¨Thread Dumpä¸­æ˜¾ç¤ºçš„çŠ¶æ€ä¸º in Object.wait()ã€‚ æ€»ç»“ é€šå¸¸æ¥è¯´ï¼Œå½“CPUå¾ˆå¿™çš„æ—¶å€™å…³æ³¨ Runnable çŠ¶æ€çš„çº¿ç¨‹ï¼Œåä¹‹åˆ™å…³æ³¨ waiting for monitor entry çŠ¶æ€çš„çº¿ç¨‹ã€‚ JVMçº¿ç¨‹è¿è¡ŒçŠ¶æ€ &lt;a id="jumpTwo"&gt;&lt;/a&gt; çº¿ç¨‹åœ¨ä¸€å®šæ¡ä»¶ä¸‹ï¼ŒçŠ¶æ€ä¼šå‘ç”Ÿå˜åŒ–ã€‚çº¿ç¨‹ä¸€å…±æœ‰ä»¥ä¸‹å‡ ç§çŠ¶æ€ï¼š æ–°å»ºçŠ¶æ€(New)ï¼šçº¿ç¨‹åˆšåˆšè¢«åˆ›å»ºï¼Œä½†æ˜¯è¿˜æ²¡æœ‰è°ƒç”¨start()æ–¹æ³•ï¼Œjstackå‘½ä»¤ä¸ä¼šåˆ—å‡ºå¤„äºæ­¤çŠ¶æ€çš„çº¿ç¨‹ä¿¡æ¯ã€‚ å°±ç»ªçŠ¶æ€(Runnable)ï¼šçº¿ç¨‹å¯¹è±¡åˆ›å»ºåï¼Œå…¶ä»–çº¿ç¨‹è°ƒç”¨äº†è¯¥å¯¹è±¡çš„start()æ–¹æ³•ã€‚è¯¥çŠ¶æ€çš„çº¿ç¨‹ä½äºâ€œå¯è¿è¡Œçº¿ç¨‹æ± â€ä¸­ï¼Œå˜å¾—å¯è¿è¡Œï¼Œåªç­‰å¾…è·å–CPUçš„ä½¿ç”¨æƒã€‚å³åœ¨å°±ç»ªçŠ¶æ€çš„è¿›ç¨‹é™¤CPUä¹‹å¤–ï¼Œå…¶å®ƒçš„è¿è¡Œæ‰€éœ€èµ„æºéƒ½å·²å…¨éƒ¨è·å¾—ã€‚ è¿è¡ŒçŠ¶æ€(Running)ï¼šå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹è·å–äº†CPUï¼Œæ‰§è¡Œç¨‹åºä»£ç ã€‚ é˜»å¡çŠ¶æ€(Blocked)ï¼šé˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚ WAITING (on object monitor) ç­‰å¾…é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œwait()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ä¼šé‡Šæ”¾å ç”¨çš„æ‰€æœ‰èµ„æºï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œç­‰å¾…æ± â€ä¸­ã€‚è¿›å…¥è¿™ä¸ªçŠ¶æ€åï¼Œæ˜¯ä¸èƒ½è‡ªåŠ¨å”¤é†’çš„ï¼Œå¿…é¡»ä¾é å…¶ä»–çº¿ç¨‹è°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ï¼Œ BLOCKED (on object monitor) åŒæ­¥é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹åœ¨è·å–å¯¹è±¡çš„åŒæ­¥é”æ—¶ï¼Œè‹¥è¯¥åŒæ­¥é”è¢«åˆ«çš„çº¿ç¨‹å ç”¨ï¼Œåˆ™JVMä¼šæŠŠè¯¥çº¿ç¨‹æ”¾å…¥â€œé”æ± â€ä¸­ã€‚ TIMED_WAITING(sleeping) å…¶ä»–é˜»å¡ï¼šè¿è¡Œçš„çº¿ç¨‹æ‰§è¡Œsleep()æˆ–join()æ–¹æ³•ï¼Œæˆ–è€…å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼ŒJVMä¼šæŠŠè¯¥çº¿ç¨‹ç½®ä¸ºé˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ æ­»äº¡çŠ¶æ€(Dead)ï¼šçº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚ å®é™…ä¸Šjvmçº¿ç¨‹æ ˆä¸­ï¼Œå‡ ä¹æ˜¯ä¸ä¼šå‡ºç°NEW,RUNNING,DEAD è¿™äº›çŠ¶æ€ï¼Œå…¶ä¸­Runnableå°±ç®—æ˜¯æ­£åœ¨è¿è¡Œäº†ã€‚ å¤„äºWAITING, BLOCKED, TIMED_WAITINGçš„æ˜¯ä¸æ¶ˆè€—CPUçš„ã€‚ å¤„äºRunnableçŠ¶æ€çš„çº¿ç¨‹ï¼Œæ˜¯å¦æ¶ˆè€—cpuè¦çœ‹å…·ä½“çš„ä¸Šä¸‹æ–‡æƒ…å†µï¼š å¦‚æœæ˜¯çº¯Javaè¿ç®—ä»£ç ï¼Œ åˆ™æ¶ˆè€—CPUï¼› å¦‚æœæ˜¯ç½‘ç»œIO,å¾ˆå°‘æ¶ˆè€—CPU,è¿™ç‚¹åœ¨åˆ†å¸ƒå¼ç¨‹åºä¸­ç»å¸¸ç¢°åˆ° ï¼› å¦‚æœæ˜¯æœ¬åœ°ä»£ç ï¼Œç»“åˆæœ¬åœ°ä»£ç çš„æ€§è´¨åˆ¤æ–­(å¯ä»¥é€šè¿‡pstack/gstackè·å–æœ¬åœ°çº¿ç¨‹å †æ ˆ) å¦‚æœæ˜¯çº¯è¿ç®—ä»£ç ï¼Œåˆ™æ¶ˆè€—CPUï¼› å¦‚æœè¢«æŒ‚èµ·ï¼Œåˆ™ä¸æ¶ˆè€—CPUï¼› å¦‚æœæ˜¯IO,åˆ™ä¸æ€ä¹ˆæ¶ˆè€—CPUï¼› document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ZookeeperçŸ¥è¯†ç‚¹]]></title>
    <url>%2Fposts%2Ff9f2d4de.html</url>
    <content type="text"><![CDATA[ç®€ä»‹ ZooKeeperæ˜¯ä¸€ä¸ªå…¸å‹çš„åˆ†å¸ƒå¼æ•°æ®ä¸€è‡´æ€§çš„è§£å†³æ–¹æ¡ˆã€‚åˆ†å¸ƒå¼åº”ç”¨ç¨‹åºå¯ä»¥åŸºäºå®ƒå®ç°è¯¸å¦‚ æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚ZooKeeperå¯ä»¥ä¿è¯å¦‚ä¸‹åˆ†å¸ƒå¼ä¸€è‡´æ€§ç‰¹æ€§ï¼š é¡ºåºä¸€è‡´æ€§ï¼šä»åŒä¸€ä¸ªå®¢æˆ·ç«¯å‘èµ·çš„äº‹åŠ¡è¯·æ±‚ï¼Œæœ€ç»ˆå°†ä¼šä¸¥æ ¼æŒ‰ç…§å…¶å‘èµ·é¡ºåºè¢«åº”ç”¨åˆ°ZooKeeperä¸­ã€‚ åŸå­æ€§ï¼šæ‰€æœ‰äº‹åŠ¡è¯·æ±‚çš„ç»“æœåœ¨é›†ç¾¤ä¸­æ‰€æœ‰æœºå™¨ä¸Šçš„åº”ç”¨æƒ…å†µæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¦ä¹ˆæ•´ä¸ªé›†ç¾¤éƒ½æˆåŠŸåº”ç”¨äº†æŸä¸€ä¸ªäº‹åŠ¡ï¼Œè¦ä¹ˆéƒ½æ²¡æœ‰åº”ç”¨ï¼Œä¸€å®šä¸ä¼šå‡ºç°é›†ç¾¤ä¸­éƒ¨åˆ†æœºå™¨åº”ç”¨äº†è¯¥äº‹åŠ¡ï¼Œè€Œå¦å¤–ä¸€éƒ¨åˆ†æ²¡æœ‰åº”ç”¨çš„æƒ…å†µã€‚ å•ä¸€è§†å›¾ï¼šæ— è®ºå®¢æˆ·ç«¯è¿æ¥çš„æ˜¯å“ªä¸ªZooKeeperæœåŠ¡å™¨ï¼Œå…¶çœ‹åˆ°çš„æœåŠ¡ç«¯æ•°æ®æ¨¡å‹éƒ½æ˜¯ä¸€è‡´çš„ã€‚ å¯é æ€§ï¼šä¸€æ—¦æœåŠ¡ç«¯æˆåŠŸåœ°åº”ç”¨äº†ä¸€ä¸ªäº‹åŠ¡ï¼Œå¹¶å®Œæˆå¯¹å®¢æˆ·ç«¯çš„å“åº”ï¼Œé‚£ä¹ˆè¯¥äº‹åŠ¡æ‰€å¼•èµ·çš„æœåŠ¡ç«¯çŠ¶æ€å˜æ›´å°†ä¼šè¢«ä¸€ç›´ä¿ç•™ä¸‹æ¥ï¼Œé™¤éæœ‰å¦ä¸€ä¸ªäº‹åŠ¡åˆå¯¹å…¶è¿›è¡Œäº†å˜æ›´ã€‚ å®æ—¶æ€§ï¼šé€šå¸¸äººä»¬çœ‹åˆ°å®æ—¶æ€§çš„ç¬¬ä¸€ååº”æ˜¯ï¼Œä¸€æ—¦ä¸€ä¸ªäº‹åŠ¡è¢«æˆåŠŸåº”ç”¨ï¼Œé‚£ä¹ˆå®¢æˆ·ç«¯èƒ½å¤Ÿç«‹å³ä»æœåŠ¡ç«¯ä¸Šè¯»å–åˆ°è¿™ä¸ªäº‹åŠ¡å˜æ›´åçš„æœ€æ–°æ•°æ®çŠ¶æ€ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒZooKeeperä»…ä»…ä¿è¯åœ¨ä¸€å®šçš„æ—¶é—´æ®µå†…ï¼Œå®¢æˆ·ç«¯æœ€ç»ˆä¸€å®šèƒ½å¤Ÿä»æœåŠ¡ç«¯ä¸Šè¯»å–åˆ°æœ€æ–°çš„æ•°æ®çŠ¶æ€ã€‚ Zookeeperè§’è‰² åœ¨ZooKeeperä¸­ï¼Œæœ‰ä¸‰ç§è§’è‰²ï¼š Leader Follower Observer ä¸€ä¸ªZooKeeperé›†ç¾¤åŒä¸€æ—¶åˆ»åªä¼šæœ‰ä¸€ä¸ªLeaderï¼Œå…¶ä»–éƒ½æ˜¯Followeræˆ–Observerã€‚ ZooKeeperé…ç½®å¾ˆç®€å•ï¼Œæ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶(zoo.cfg)éƒ½æ˜¯ä¸€æ ·çš„ï¼Œåªæœ‰myidæ–‡ä»¶ä¸ä¸€æ ·ã€‚myidçš„å€¼å¿…é¡»æ˜¯zoo.cfgä¸­server.{æ•°å€¼}çš„{æ•°å€¼}éƒ¨åˆ†ã€‚ zoo.cfgæ–‡ä»¶å†…å®¹ç¤ºä¾‹ï¼š 12345678910111213141516171819202122maxClientCnxns=0# The number of milliseconds of each ticktickTime=2000# The number of ticks that the initial# synchronization phase can takeinitLimit=10# The number of ticks that can pass between# sending a request and getting an acknowledgementsyncLimit=5# the directory where the snapshot is stored.dataDir=/var/lib/zookeeper/data# the port at which the clients will connectclientPort=2181# the directory where the transaction logs are stored.dataLogDir=/var/lib/zookeeper/logsserver.1=192.168.20.101:2888:3888server.2=192.168.20.102:2888:3888server.3=192.168.20.103:2888:3888server.4=192.168.20.104:2888:3888server.5=192.168.20.105:2888:3888minSessionTimeout=4000maxSessionTimeout=100000 åœ¨è£…æœ‰ZooKeeperçš„æœºå™¨çš„ç»ˆç«¯æ‰§è¡Œ zookeeper-server status å¯ä»¥çœ‹å½“å‰èŠ‚ç‚¹çš„ZooKeeperæ˜¯ä»€ä¹ˆè§’è‰²ï¼ˆLeader or Followerï¼‰ã€‚ 12345678[root@node-20-103 ~]# zookeeper-server statusJMX enabled by defaultUsing config: /etc/zookeeper/conf/zoo.cfgMode: follower[root@node-20-104 ~]# zookeeper-server statusJMX enabled by defaultUsing config: /etc/zookeeper/conf/zoo.cfgMode: leader å¦‚ä¸Šï¼Œnode-20-104æ˜¯Leaderï¼Œnode-20-103æ˜¯followerã€‚ ZooKeeperé»˜è®¤åªæœ‰Leaderå’ŒFollowerä¸¤ç§è§’è‰²ï¼Œæ²¡æœ‰Observerè§’è‰²ã€‚ ä¸ºäº†ä½¿ç”¨Observeræ¨¡å¼ï¼Œåœ¨ä»»ä½•æƒ³å˜æˆObserverçš„èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ï¼špeerType=observer å¹¶åœ¨æ‰€æœ‰serverçš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®æˆobserveræ¨¡å¼çš„serverçš„é‚£è¡Œé…ç½®è¿½åŠ :observerï¼Œä¾‹å¦‚ï¼š 1server.1:localhost:2888:3888:observer ZooKeeperé›†ç¾¤çš„æ‰€æœ‰æœºå™¨é€šè¿‡ä¸€ä¸ªLeaderé€‰ä¸¾è¿‡ç¨‹æ¥é€‰å®šä¸€å°è¢«ç§°ä¸ºã€Leaderã€çš„æœºå™¨ï¼ŒLeaderæœåŠ¡å™¨ä¸ºå®¢æˆ·ç«¯æä¾›è¯»å’Œå†™æœåŠ¡ã€‚ Followerå’ŒObserveréƒ½èƒ½æä¾›è¯»æœåŠ¡ï¼Œä¸èƒ½æä¾›å†™æœåŠ¡ã€‚ä¸¤è€…å”¯ä¸€çš„åŒºåˆ«åœ¨äºï¼ŒObserveræœºå™¨ä¸å‚ä¸Leaderé€‰ä¸¾è¿‡ç¨‹ï¼Œä¹Ÿä¸å‚ä¸å†™æ“ä½œçš„ã€è¿‡åŠå†™æˆåŠŸã€ç­–ç•¥ï¼Œå› æ­¤Observerå¯ä»¥åœ¨ä¸å½±å“å†™æ€§èƒ½çš„æƒ…å†µä¸‹æå‡é›†ç¾¤çš„è¯»æ€§èƒ½ã€‚ ä¼šè¯Session åœ¨ZooKeeperä¸­ï¼Œä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥æ˜¯æŒ‡å®¢æˆ·ç«¯å’ŒZooKeeperæœåŠ¡å™¨ä¹‹é—´çš„TCPé•¿è¿æ¥ã€‚ZooKeeperå¯¹å¤–çš„æœåŠ¡ç«¯å£é»˜è®¤æ˜¯2181ï¼Œå®¢æˆ·ç«¯å¯åŠ¨æ—¶ï¼Œé¦–å…ˆä¼šä¸æœåŠ¡å™¨å»ºç«‹ä¸€ä¸ªTCPè¿æ¥ï¼Œä»ç¬¬ä¸€æ¬¡è¿æ¥å»ºç«‹å¼€å§‹ï¼Œå®¢æˆ·ç«¯ä¼šè¯çš„ç”Ÿå‘½å‘¨æœŸä¹Ÿå¼€å§‹äº†ï¼Œé€šè¿‡è¿™ä¸ªè¿æ¥ï¼Œå®¢æˆ·ç«¯èƒ½å¤Ÿé€šè¿‡å¿ƒè·³æ£€æµ‹å’ŒæœåŠ¡å™¨ä¿æŒæœ‰æ•ˆçš„ä¼šè¯ï¼Œä¹Ÿèƒ½å¤Ÿå‘ZooKeeperæœåŠ¡å™¨å‘é€è¯·æ±‚å¹¶æ¥å—å“åº”ï¼ŒåŒæ—¶è¿˜èƒ½é€šè¿‡è¯¥è¿æ¥æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„Watchäº‹ä»¶é€šçŸ¥ã€‚Sessionçš„SessionTimeoutå€¼ç”¨æ¥è®¾ç½®ä¸€ä¸ªå®¢æˆ·ç«¯ä¼šè¯çš„è¶…æ—¶æ—¶é—´ã€‚å½“ç”±äºæœåŠ¡å™¨å‹åŠ›å¤ªå¤§ã€ç½‘ç»œæ•…éšœæˆ–æ˜¯å®¢æˆ·ç«¯ä¸»åŠ¨æ–­å¼€è¿æ¥ç­‰å„ç§åŸå› å¯¼è‡´å®¢æˆ·ç«¯è¿æ¥æ–­å¼€æ—¶ï¼Œåªè¦åœ¨SessionTimeoutè§„å®šçš„æ—¶é—´å†…èƒ½å¤Ÿé‡æ–°è¿æ¥ä¸Šé›†ç¾¤ä¸­ä»»æ„ä¸€å°æœåŠ¡å™¨ï¼Œé‚£ä¹ˆä¹‹å‰åˆ›å»ºçš„ä¼šè¯ä»ç„¶æœ‰æ•ˆã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Zookeeper</category>
      </categories>
      <tags>
        <tag>Zookeeper</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLé—®é¢˜æ’æŸ¥SQL]]></title>
    <url>%2Fposts%2F81d4f14b.html</url>
    <content type="text"><![CDATA[æŸ¥çœ‹å½“å‰åº”ç”¨è¿æ¥ï¼Œè¿æ¥æ•°çªå¢æ’æŸ¥ 1select user,SUBSTRING_INDEX(host,':',1) as ip , count(*) as count,db from information_schema.processlist where host not in ('localhost') and user not in ('replicater') group by ip order by count; æŸ¥çœ‹è¡¨æ‰€å±åŠå¤§æ¦‚è¡Œæ•°ï¼Œä¸€èˆ¬åŠ å­—æ®µç´¢å¼•æ—¶åšå‚è€ƒ 1select TABLE_SCHEMA,TABLE_NAME,TABLE_ROWS from information_schema.tables where TABLE_NAME='è¡¨å'; æŸ¥çœ‹è¡¨ç¢ç‰‡ï¼Œæ˜¯å¦éœ€è¦æ•´ç†è¡¨é‡Šæ”¾ç‰©ç†ç©ºé—´ 1select table_name,table_rows,concat(round(DATA_LENGTH/1024/1024, 2), 'MB') as size,DATA_FREE/1024/1024 AS data_free_MB from information_schema.TABLES where table_schema='åº“å' order by DATA_LENGTH desc; å½“å‰æœ‰æ²¡æœ‰é” 1select * from information_schema.innodb_locks; å½“å‰é”å µå¡æƒ…å†µ 1select * from information_schema.innodb_lock_waits; å½“å‰é”ç­‰å¾…è¯¦ç»†ä¿¡æ¯ 1select it.trx_mysql_thread_id, il.lock_id, il.lock_table, il.lock_mode, il.lock_type, it.trx_state, pl.USER||'@'||pl.HOST as user_host, pl.db, pl.command, pl.info, it.trx_started, it.trx_wait_started, now()-trx_wait_started as wait_seconds, il.lock_index, it.trx_weight, it.trx_rows_locked, it.trx_rows_modified from information_schema.INNODB_TRX it,information_schema.innodb_locks il,information_schema.processlist pl where it.trx_id = il.lock_trx_id and it.trx_mysql_thread_id = pl.id\G æœ€è¿‘ä¸€æ¬¡æ­»é”ã€æœªæäº¤äº‹ç‰©ã€CHECKPIONTã€BUFFER POOLç­‰ 1show engine innodb status\G è¿‡æ»¤æ— ç”¨çº¿ç¨‹ä¿¡æ¯å¯ç”¨pager 1pager grep -v Sleep;show processlist; æŸ¥çœ‹å½“å‰è¿è¡Œçš„è¯¦ç»†SQL 1SELECT * FROM INFORMATION_SCHEMA.PROCESSLIST WHERE info is not null\G æŸ¥çœ‹æŸæ¡sqlå„é˜¶æ®µæ‰§è¡Œæ—¶é—´ï¼Œå¯å¼€å¯profilingåŠŸèƒ½ 1set global profiling=on; æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯ 1select user,host,authentication_string from mysql.user group by user; æŸ¥çœ‹å“ªäº›sqlæ‰§è¡Œæœ€å¤šæ¬¡ 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_ROWS_EXAMINED,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY COUNT_STAR desc LIMIT 1; å“ªä¸ªSQLæ‰«æçš„è¡Œæ•°æœ€å¤š(IOæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,AVG_TIMER_WAIT,SUM_ROWS_SENT,SUM_ROWS_EXAMINED,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_ROWS_EXAMINED desc LIMIT 1\G å“ªä¸ªSQLä½¿ç”¨çš„ä¸´æ—¶è¡¨æœ€å¤š 1SELECT SCHEMA_NAME,DIGEST_TEXT,SUM_CREATED_TMP_DISK_TABLES,SUM_CREATED_TMP_TABLES,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_CREATED_TMP_DISK_TABLES desc LIMIT 1\G å“ªä¸ªSQLè¿”å›çš„ç»“æœé›†æœ€å¤š(netæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_ROWS_SENT,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_ROWS_SENT desc LIMIT 1\G å“ªä¸ªSQLæ’åºæ•°æœ€å¤š(CPUæ¶ˆè€—) 1SELECT SCHEMA_NAME,DIGEST_TEXT,COUNT_STAR,SUM_ROWS_SENT,SUM_SORT_ROWS,FIRST_SEEN,LAST_SEEN FROM performance_schema.events_statements_summary_by_digest where SCHEMA_NAME is not null and SCHEMA_NAME !='information_schema' ORDER BY SUM_SORT_ROWS desc LIMIT 1\G document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[DevOpsåˆè¯†]]></title>
    <url>%2Fposts%2F230bf701.html</url>
    <content type="text"><![CDATA[èƒŒæ™¯ DevOpsçš„å‡ºç°æœ‰å…¶å¿…ç„¶æ€§ã€‚åœ¨è½¯ä»¶å¼€å‘ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œé‡åˆ°äº†ä¸¤æ¬¡ç“¶é¢ˆã€‚ ç¬¬ä¸€æ¬¡ç“¶é¢ˆæ˜¯åœ¨éœ€æ±‚é˜¶æ®µå’Œå¼€å‘é˜¶æ®µä¹‹é—´ï¼Œé’ˆå¯¹ä¸æ–­å˜åŒ–çš„éœ€æ±‚ï¼Œå¯¹è½¯ä»¶å¼€å‘è€…æå‡ºäº†é«˜è¦æ±‚ï¼Œåæ¥å‡ºç°äº†æ•æ·æ–¹æ³•è®ºï¼Œå¼ºè°ƒé€‚åº”éœ€æ±‚ã€å¿«é€Ÿè¿­ä»£ã€æŒç»­äº¤ä»˜ã€‚ ç¬¬äºŒä¸ªç“¶é¢ˆæ˜¯åœ¨å¼€å‘é˜¶æ®µå’Œæ„å»ºéƒ¨ç½²é˜¶æ®µä¹‹é—´ï¼Œå¤§é‡å®Œæˆçš„å¼€å‘ä»»åŠ¡å¯èƒ½é˜»å¡åœ¨éƒ¨ç½²é˜¶æ®µï¼Œå½±å“äº¤ä»˜ï¼Œäºæ˜¯æœ‰äº†DevOpsã€‚ æ¦‚å¿µ DevOpsä¸€è¯çš„æ¥è‡ªäºDevelopmentå’ŒOperationsçš„ç»„åˆï¼Œçªå‡ºé‡è§†è½¯ä»¶å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜çš„æ²Ÿé€šåˆä½œï¼Œé€šè¿‡è‡ªåŠ¨åŒ–æµç¨‹æ¥ä½¿å¾—è½¯ä»¶æ„å»ºã€æµ‹è¯•ã€å‘å¸ƒæ›´åŠ å¿«æ·ã€é¢‘ç¹å’Œå¯é ã€‚ DevOpsæ˜¯ä¸ºäº†å¡«è¡¥å¼€å‘ç«¯å’Œè¿ç»´ç«¯ä¹‹é—´çš„ä¿¡æ¯é¸¿æ²Ÿï¼Œæ”¹å–„å›¢é˜Ÿä¹‹é—´çš„åä½œå…³ç³»ã€‚ä¸è¿‡éœ€è¦æ¾„æ¸…çš„ä¸€ç‚¹æ˜¯ï¼Œä»å¼€å‘åˆ°è¿ç»´ï¼Œä¸­é—´è¿˜æœ‰æµ‹è¯•ç¯èŠ‚ã€‚DevOpså…¶å®åŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šå¼€å‘ã€æµ‹è¯•å’Œè¿ç»´ã€‚ æ¢å¥è¯è¯´ï¼ŒDevOpså¸Œæœ›åšåˆ°çš„æ˜¯è½¯ä»¶äº§å“äº¤ä»˜è¿‡ç¨‹ä¸­ITå·¥å…·é“¾çš„æ‰“é€šï¼Œä½¿å¾—å„ä¸ªå›¢é˜Ÿå‡å°‘æ—¶é—´æŸè€—ï¼Œæ›´åŠ é«˜æ•ˆåœ°ååŒå·¥ä½œã€‚ä¸“å®¶ä»¬æ€»ç»“å‡ºäº†ä¸‹é¢è¿™ä¸ªDevOpsèƒ½åŠ›å›¾ï¼Œè‰¯å¥½çš„é—­ç¯å¯ä»¥å¤§å¤§å¢åŠ æ•´ä½“çš„äº§å‡ºã€‚ æŒç»­é›†æˆ æŒç»­é›†æˆå¼ºè°ƒå¼€å‘äººå‘˜æäº¤äº†æ–°ä»£ç ä¹‹åï¼Œç«‹åˆ»è¿›è¡Œæ„å»ºã€ï¼ˆå•å…ƒï¼‰æµ‹è¯•ã€‚æ ¹æ®æµ‹è¯•ç»“æœï¼Œå¯ä»¥ç¡®å®šæ–°ä»£ç å’ŒåŸæœ‰ä»£ç èƒ½å¦æ­£ç¡®åœ°é›†æˆåœ¨ä¸€èµ·ã€‚ æŒç»­äº¤ä»˜ æŒç»­äº¤ä»˜åœ¨æŒç»­é›†æˆçš„åŸºç¡€ä¸Šï¼Œå°†é›†æˆåçš„ä»£ç éƒ¨ç½²åˆ°æ›´è´´è¿‘çœŸå®è¿è¡Œç¯å¢ƒçš„ã€Œç±»ç”Ÿäº§ç¯å¢ƒã€ï¼ˆproduction-like environmentsï¼‰ä¸­ã€‚æ¯”å¦‚ï¼Œæˆ‘ä»¬å®Œæˆå•å…ƒæµ‹è¯•åï¼Œå¯ä»¥æŠŠä»£ç éƒ¨ç½²åˆ°è¿æ¥æ•°æ®åº“çš„ Staging ç¯å¢ƒä¸­æ›´å¤šçš„æµ‹è¯•ã€‚å¦‚æœä»£ç æ²¡æœ‰é—®é¢˜ï¼Œå¯ä»¥ç»§ç»­æ‰‹åŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚ æŒç»­éƒ¨ç½² æŒç»­éƒ¨ç½²åˆ™æ˜¯åœ¨æŒç»­äº¤ä»˜çš„åŸºç¡€ä¸Šï¼ŒæŠŠéƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒçš„è¿‡ç¨‹è‡ªåŠ¨åŒ–ã€‚ å‡ ä¸ªå…³é”®é—®é¢˜ å¥½å¤„æ˜¯ä»€ä¹ˆï¼Ÿ DevOpsçš„ä¸€ä¸ªå·¨å¤§å¥½å¤„å°±æ˜¯å¯ä»¥é«˜æ•ˆäº¤ä»˜ï¼Œè¿™ä¹Ÿæ­£å¥½æ˜¯å®ƒçš„åˆè¡·ã€‚ Puppetå’ŒDevOps Research and Assessment (DORA) ä¸»åŠäº†2016å¹´DevOpsè°ƒæŸ¥æŠ¥å‘Šï¼Œæ ¹æ®å…¨çƒ4600ä½å„ITå…¬å¸çš„æŠ€æœ¯å·¥ä½œè€…çš„æäº¤æ•°æ®ç»Ÿè®¡ï¼Œå¾—å‡ºé«˜æ•ˆå…¬å¸å¹³å‡æ¯å¹´å¯ä»¥å®Œæˆ1460æ¬¡éƒ¨ç½²ã€‚ ä¸ä½æ•ˆç»„ç»‡ç›¸æ¯”ï¼Œé«˜æ•ˆç»„ç»‡çš„éƒ¨ç½²é¢‘ç¹200å€ï¼Œäº§å“æŠ•å…¥ä½¿ç”¨é€Ÿåº¦å¿«2555å€ï¼ŒæœåŠ¡æ¢å¤é€Ÿåº¦å¿«24å€ã€‚åœ¨å·¥ä½œå†…å®¹çš„æ—¶é—´åˆ†é…ä¸Šï¼Œä½æ•ˆè€…è¦å¤šèŠ±22%çš„æ—¶é—´ç”¨åœ¨ä¸ºè§„åˆ’å¥½æˆ–è€…é‡å¤å·¥ä½œä¸Šï¼Œè€Œé«˜æ•ˆè€…å´å¯ä»¥å¤šèŠ±29%çš„æ—¶é—´ç”¨åœ¨æ–°çš„å·¥ä½œä¸Šã€‚æ‰€ä»¥è¿™é‡Œçš„é«˜æ•ˆä¸ä»…ä»…æŒ‡å…¬å¸äº§å‡ºçš„æ•ˆç‡æé«˜ï¼Œè¿˜æŒ‡å‘˜å·¥çš„å·¥ä½œè´¨é‡å¾—åˆ°æå‡ã€‚ å¦å¤–ä¸€ä¸ªå¥½å¤„å°±æ˜¯ä¼šæ”¹å–„å…¬å¸ç»„ç»‡æ–‡åŒ–ã€æé«˜å‘˜å·¥çš„å‚ä¸æ„Ÿã€‚ å‘˜å·¥ä»¬å˜å¾—æ›´é«˜æ•ˆï¼Œä¹Ÿæ›´æœ‰æ»¡è¶³å’Œæˆå°±æ„Ÿï¼›è°ƒæŸ¥æ˜¾ç¤ºé«˜æ•ˆå‘˜å·¥çš„é›‡å‘˜å‡€æ¨èå€¼ï¼ˆeNPS:employee Net Promoter Scoreï¼‰æ›´é«˜ï¼Œå³å¯¹å…¬å¸æ›´åŠ è®¤åŒã€‚ å¿«é€Ÿéƒ¨ç½²åŒæ—¶æé«˜ITç¨³å®šæ€§ï¼Œè¿™ä¸çŸ›ç›¾å—ï¼Ÿ å¿«é€Ÿçš„éƒ¨ç½²å…¶å®å¯ä»¥å¸®åŠ©æ›´å¿«åœ°å‘ç°é—®é¢˜ï¼Œäº§å“è¢«æ›´å¿«åœ°äº¤ä»˜åˆ°ç”¨æˆ·æ‰‹ä¸­ï¼Œå›¢é˜Ÿå¯ä»¥æ›´å¿«åœ°å¾—åˆ°ç”¨æˆ·çš„åé¦ˆï¼Œä»è€Œè¿›è¡Œæ›´å¿«åœ°å“åº”ã€‚è€Œä¸”ï¼ŒDevOpså°æ­¥å¿«è·‘çš„å½¢å¼å¸¦æ¥çš„å˜åŒ–æ˜¯æ¯”è¾ƒå°çš„ï¼Œå‡ºç°é—®é¢˜çš„åå·®æ¯æ¬¡éƒ½ä¸ä¼šå¤ªå¤§ï¼Œä¿®å¤èµ·æ¥ä¹Ÿä¼šç›¸å¯¹å®¹æ˜“ä¸€äº›ã€‚ ä¸‰åŸåˆ™ åŸºç¡€è®¾æ–½å³ä»£ç ï¼ˆInfrastructure as Codeï¼‰ DeveOpsçš„åŸºç¡€æ˜¯å°†é‡å¤çš„äº‹æƒ…ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬æˆ–è½¯ä»¶æ¥å®ç°ï¼Œä¾‹å¦‚Dockerï¼ˆå®¹å™¨åŒ–ï¼‰ã€Jenkinsï¼ˆæŒç»­é›†æˆï¼‰ã€Puppetï¼ˆåŸºç¡€æ¶æ„æ„å»ºï¼‰ã€Vagrantï¼ˆè™šæ‹ŸåŒ–å¹³å°ï¼‰ç­‰ã€‚ æŒç»­äº¤ä»˜ï¼ˆContinuous Deliveryï¼‰ æŒç»­äº¤ä»˜æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒå‘å¸ƒå¯é çš„è½¯ä»¶å¹¶äº¤ä»˜ç»™ç”¨æˆ·ä½¿ç”¨ã€‚è€ŒæŒç»­éƒ¨ç½²åˆ™ä¸ä¸€å®šäº¤ä»˜ç»™ç”¨æˆ·ä½¿ç”¨ã€‚ æ¶‰åŠåˆ°2ä¸ªæ—¶é—´ï¼ŒTTRï¼ˆTime to Repairï¼‰ä¿®å¤æ—¶é—´ï¼ŒTTMï¼ˆTime To Marketingï¼‰äº§å“ä¸Šçº¿æ—¶é—´ã€‚è¦åšåˆ°é«˜æ•ˆäº¤ä»˜å¯é çš„è½¯ä»¶ï¼Œéœ€è¦å°½å¯èƒ½çš„å‡å°‘è¿™2ä¸ªæ—¶é—´ã€‚ éƒ¨ç½²å¯ä»¥æœ‰å¤šç§æ–¹å¼ï¼Œæ¯”å¦‚è“ç»¿éƒ¨ç½²ã€é‡‘ä¸é›€éƒ¨ç½²ç­‰ã€‚ ååŒå·¥ä½œï¼ˆCulture of Collaborationï¼‰ å¼€å‘è€…å’Œè¿ç»´äººå‘˜å¿…é¡»å®šæœŸè¿›è¡Œå¯†åˆ‡çš„åˆä½œã€‚å¼€å‘åº”è¯¥æŠŠè¿ç»´è§’è‰²ç†è§£æˆè½¯ä»¶çš„å¦ä¸€ä¸ªç”¨æˆ·ç¾¤ä½“ã€‚åä½œæœ‰å‡ ä¸ªçš„å»ºè®®ï¼š è‡ªåŠ¨åŒ–ï¼ˆå‡å°‘ä¸å¿…è¦çš„åä½œï¼‰ï¼› å°èŒƒå›´ï¼ˆæ¯æ¬¡ä¿®æ”¹çš„å†…å®¹ä¸å®œè¿‡å¤šï¼Œå‡å°‘å‘å¸ƒçš„é£é™©ï¼‰ï¼› ç»Ÿä¸€ä¿¡æ¯é›†æ•£åœ°ï¼ˆå¦‚wikiï¼Œè®©åŒæ–¹èƒ½å¤Ÿå…±äº«ä¿¡æ¯ï¼‰ï¼› æ ‡å‡†åŒ–åä½œå·¥å…·ï¼ˆæ¯”å¦‚jenkinsï¼‰ã€‚ æ€ä¹ˆå®ç°DevOps ç¡¬æ€§è¦æ±‚ï¼šå·¥å…·ä¸Šçš„å‡†å¤‡ ä»£ç ç®¡ç†ï¼ˆSCMï¼‰ï¼šGitHubã€GitLabã€BitBucketã€SubVersionæ„å»ºå·¥å…·ï¼šAntã€Gradleã€mavenè‡ªåŠ¨éƒ¨ç½²ï¼šCapistranoã€CodeDeployæŒç»­é›†æˆï¼ˆCIï¼‰ï¼šBambooã€Hudsonã€Jenkinsé…ç½®ç®¡ç†ï¼šAnsibleã€Chefã€Puppetã€SaltStackã€ScriptRock GuardRailå®¹å™¨ï¼šDockerã€LXCã€ç¬¬ä¸‰æ–¹å‚å•†å¦‚AWSç¼–æ’ï¼šKubernetesã€Coreã€Apache Mesosã€DC/OSæœåŠ¡æ³¨å†Œä¸å‘ç°ï¼šZookeeperã€etcdã€Consulè„šæœ¬è¯­è¨€ï¼špythonã€rubyã€shellæ—¥å¿—ç®¡ç†ï¼šELKã€Logentriesç³»ç»Ÿç›‘æ§ï¼šDatadogã€Graphiteã€Icingaã€Nagiosã€zabbixæ€§èƒ½ç›‘æ§ï¼šAppDynamicsã€New Relicã€Splunkå‹åŠ›æµ‹è¯•ï¼šJMeterã€Blaze Meterã€loader.ioé¢„è­¦ï¼šPagerDutyã€pingdomã€å‚å•†è‡ªå¸¦å¦‚AWS SNSHTTPåŠ é€Ÿå™¨ï¼šVarnishæ¶ˆæ¯æ€»çº¿ï¼šActiveMQã€SQSåº”ç”¨æœåŠ¡å™¨ï¼šTomcatã€JBossWebæœåŠ¡å™¨ï¼šApacheã€Nginxã€IISæ•°æ®åº“ï¼šMySQLã€Oracleã€PostgreSQLç­‰å…³ç³»å‹æ•°æ®åº“ï¼›cassandraã€mongoDBã€redisç­‰NoSQLæ•°æ®åº“é¡¹ç›®ç®¡ç†ï¼ˆPMï¼‰ï¼šJiraã€Asanaã€Taigaã€Trelloã€Basecampã€Pivotal Tracker åœ¨å·¥å…·çš„é€‰æ‹©ä¸Šï¼Œéœ€è¦ç»“åˆå…¬å¸ä¸šåŠ¡éœ€æ±‚å’ŒæŠ€æœ¯å›¢é˜Ÿæƒ…å†µè€Œå®šã€‚ è½¯æ€§éœ€æ±‚ï¼šæ–‡åŒ–å’Œäºº DevOpsæˆåŠŸä¸å¦ï¼Œå…¬å¸ç»„ç»‡æ˜¯å¦åˆ©äºåä½œæ˜¯å…³é”®ã€‚å¼€å‘äººå‘˜å’Œè¿ç»´äººå‘˜å¯ä»¥è‰¯å¥½æ²Ÿé€šäº’ç›¸å­¦ä¹ ï¼Œä»è€Œæ‹¥æœ‰é«˜ç”Ÿäº§åŠ›ã€‚å¹¶ä¸”åä½œä¹Ÿå­˜åœ¨äºä¸šåŠ¡äººå‘˜ä¸å¼€å‘äººå‘˜ä¹‹é—´ã€‚ å‡ºå¸­äº†2016å¹´ä¼¦æ•¦ä¼ä¸šçº§DevOpså³°ä¼šçš„ITVå…¬å¸åœ¨2012å¹´å°±å¼€å§‹è½åœ°DevOpsï¼Œå…¶é€šç”¨å¹³å°ä¸»ç®¡Clarkåœ¨æ¥å—äº†InfoQçš„é‡‡è®¿ï¼Œåœ¨è°ˆåŠæˆåŠŸæ—¶è¡¨ç¤ºï¼Œä¸šåŠ¡äººå‘˜éå¸¸æ¸…æ¥šä»–ä»¬å¸Œæœ›åœ¨æœ€å°åŒ–å¯è¡Œäº§å“ä¸­å®ç°ä»€ä¹ˆï¼Œå·¥ç¨‹å¸ˆä»¬å°±æŒ‰éœ€äº¤ä»˜ï¼Œä¸åšå¤šä½™å·¥ä½œã€‚ è¿™æ ·ï¼Œå·¥ç¨‹å¸ˆä»¬ä½¿ç”¨é€šç”¨çš„å¹³å°ï¼ˆå³æ‰“é€šçš„å·¥å…·é“¾ï¼‰å¾—åˆ°æ›´å¥½çš„ä¸€è‡´æ€§å’Œæ›´é«˜çš„è´¨é‡ã€‚æ­¤å¤–ï¼ŒDevOpså¯¹å·¥ç¨‹å¸ˆä¸ªäººçš„è¦æ±‚ä¹Ÿæé«˜äº†ï¼Œå¾ˆå¤šä¸“å®¶ä¹Ÿè®¤ä¸ºæ‹›å‹Ÿåˆ°ä¼˜ç§€çš„äººæ‰ä¹Ÿæ˜¯ä¸€ä¸ªæŒ‘æˆ˜ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>DevOps</category>
      </categories>
      <tags>
        <tag>DevOps</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -åˆ†å¸ƒå¼äº‹åŠ¡]]></title>
    <url>%2Fposts%2F464cb56d.html</url>
    <content type="text"><![CDATA[äº‹åŠ¡å®šä¹‰ äº‹åŠ¡æä¾›ä¸€ç§æœºåˆ¶å°†ä¸€ä¸ªæ´»åŠ¨æ¶‰åŠçš„æ‰€æœ‰æ“ä½œçº³å…¥åˆ°ä¸€ä¸ªä¸å¯åˆ†å‰²çš„æ‰§è¡Œå•å…ƒï¼Œç»„æˆäº‹åŠ¡çš„æ‰€æœ‰æ“ä½œåªæœ‰åœ¨æ‰€æœ‰æ“ä½œå‡èƒ½æ­£å¸¸æ‰§è¡Œçš„æƒ…å†µä¸‹æ–¹èƒ½æäº¤ï¼Œåªè¦å…¶ä¸­ä»»ä¸€æ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œéƒ½å°†å¯¼è‡´æ•´ä¸ªäº‹åŠ¡çš„å›æ»šã€‚ç®€å•åœ°è¯´ï¼Œäº‹åŠ¡æä¾›ä¸€ç§â€œè¦ä¹ˆä»€ä¹ˆéƒ½ä¸åšï¼Œè¦ä¹ˆåšå…¨å¥—ï¼ˆAll or Nothingï¼‰â€æœºåˆ¶ã€‚ æ•°æ®åº“äº‹åŠ¡ç‰¹æ€§ï¼ˆACIDï¼‰ A:åŸå­æ€§(Atomicity) ä¸€ä¸ªäº‹åŠ¡(transaction)ä¸­çš„æ‰€æœ‰æ“ä½œï¼Œè¦ä¹ˆå…¨éƒ¨å®Œæˆï¼Œè¦ä¹ˆå…¨éƒ¨ä¸å®Œæˆï¼Œä¸ä¼šç»“æŸåœ¨ä¸­é—´æŸä¸ªç¯èŠ‚ã€‚äº‹åŠ¡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¼šè¢«å›æ»šï¼ˆRollbackï¼‰åˆ°äº‹åŠ¡å¼€å§‹å‰çš„çŠ¶æ€ï¼Œå°±åƒè¿™ä¸ªäº‹åŠ¡ä»æ¥æ²¡æœ‰æ‰§è¡Œè¿‡ä¸€æ ·ã€‚ ä¾‹å¦‚ï¼šé“¶è¡Œè½¬è´¦ï¼Œä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š ï¼ˆ1ï¼‰ä»Aè´¦æˆ·å–100å…ƒ ï¼ˆ2ï¼‰å­˜å…¥100å…ƒè‡³Bè´¦æˆ·ã€‚ è¿™ä¸¤æ­¥è¦ä¹ˆä¸€èµ·å®Œæˆï¼Œè¦ä¹ˆä¸€èµ·ä¸å®Œæˆï¼Œå¦‚æœåªå®Œæˆç¬¬ä¸€æ­¥ï¼Œç¬¬äºŒæ­¥å¤±è´¥ï¼Œé’±ä¼šè«åå…¶å¦™å°‘äº†100å…ƒã€‚ C:ä¸€è‡´æ€§(Consistency) äº‹åŠ¡çš„ä¸€è‡´æ€§æŒ‡çš„æ˜¯åœ¨ä¸€ä¸ªäº‹åŠ¡æ‰§è¡Œä¹‹å‰å’Œæ‰§è¡Œä¹‹åæ•°æ®åº“éƒ½å¿…é¡»å¤„äºä¸€è‡´æ€§çŠ¶æ€ã€‚å¦‚æœäº‹åŠ¡æˆåŠŸåœ°å®Œæˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­æ‰€æœ‰å˜åŒ–å°†æ­£ç¡®åœ°åº”ç”¨ï¼Œç³»ç»Ÿå¤„äºæœ‰æ•ˆçŠ¶æ€ã€‚å¦‚æœåœ¨äº‹åŠ¡ä¸­å‡ºç°é”™è¯¯ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­çš„æ‰€æœ‰å˜åŒ–å°†è‡ªåŠ¨åœ°å›æ»šï¼Œç³»ç»Ÿè¿”å›åˆ°åŸå§‹çŠ¶æ€ã€‚ ä¾‹å¦‚ï¼šç°æœ‰å®Œæ•´æ€§çº¦æŸA+B=100ï¼Œå¦‚æœä¸€ä¸ªäº‹åŠ¡æ”¹å˜äº†Aï¼Œé‚£ä¹ˆå¿…é¡»å¾—æ”¹å˜Bï¼Œä½¿å¾—äº‹åŠ¡ç»“æŸåä¾ç„¶æ»¡è¶³A+B=100ï¼Œå¦åˆ™äº‹åŠ¡å¤±è´¥ã€‚ I:éš”ç¦»æ€§(Isolation) æŒ‡çš„æ˜¯åœ¨å¹¶å‘ç¯å¢ƒä¸­ï¼Œå½“ä¸åŒçš„äº‹åŠ¡åŒæ—¶æ“çºµç›¸åŒçš„æ•°æ®æ—¶ï¼Œæ¯ä¸ªäº‹åŠ¡éƒ½æœ‰å„è‡ªçš„å®Œæ•´æ•°æ®ç©ºé—´ã€‚ç”±å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹å¿…é¡»ä¸ä»»ä½•å…¶ä»–å¹¶å‘äº‹åŠ¡æ‰€åšçš„ä¿®æ”¹éš”ç¦»ã€‚äº‹åŠ¡æŸ¥çœ‹æ•°æ®æ›´æ–°æ—¶ï¼Œæ•°æ®æ‰€å¤„çš„çŠ¶æ€è¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹å‰çš„çŠ¶æ€ï¼Œè¦ä¹ˆæ˜¯å¦ä¸€äº‹åŠ¡ä¿®æ”¹å®ƒä¹‹åçš„çŠ¶æ€ï¼Œäº‹åŠ¡ä¸ä¼šæŸ¥çœ‹åˆ°ä¸­é—´çŠ¶æ€çš„æ•°æ®ã€‚ ä¾‹å¦‚ï¼šç°æœ‰æœ‰ä¸ªäº¤æ˜“æ˜¯ä»Aè´¦æˆ·è½¬100å…ƒè‡³Bè´¦æˆ·ï¼Œåœ¨è¿™ä¸ªäº¤æ˜“äº‹åŠ¡è¿˜æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼Œå¦‚æœæ­¤æ—¶BæŸ¥è¯¢è‡ªå·±çš„è´¦æˆ·ï¼Œæ˜¯çœ‹ä¸åˆ°æ–°å¢åŠ çš„100å…ƒçš„ã€‚ D:æŒä¹…æ€§(Durability) äº‹åŠ¡å¤„ç†ç»“æŸåï¼Œå¯¹æ•°æ®çš„ä¿®æ”¹å°±æ˜¯æ°¸ä¹…çš„ï¼Œå³ä¾¿ç³»ç»Ÿæ•…éšœä¹Ÿä¸ä¼šä¸¢å¤±ã€‚å³ä½¿å‘ç”Ÿç³»ç»Ÿå´©æºƒï¼Œé‡æ–°å¯åŠ¨æ•°æ®åº“ç³»ç»Ÿåï¼Œæ•°æ®åº“è¿˜èƒ½æ¢å¤åˆ°äº‹åŠ¡æˆåŠŸç»“æŸæ—¶çš„çŠ¶æ€ã€‚ æ‰“ä¸ªæ¯”æ–¹ï¼Œä½ ä¹°ä¸œè¥¿çš„æ—¶å€™éœ€è¦è®°å½•åœ¨è´¦æœ¬ä¸Šï¼Œå³ä½¿è€æ¿å¿˜è®°äº†é‚£ä¹Ÿæœ‰æ®å¯æŸ¥ã€‚ æ•°æ®åº“äº‹åŠ¡å®ç°åŸç† ä»¥MySQLçš„InnoDBä¸ºä¾‹ï¼Œäº‹åŠ¡çš„ACIDæ˜¯é€šè¿‡InnoDBæ—¥å¿—å’Œé”æ¥ä¿è¯ã€‚ äº‹åŠ¡çš„éš”ç¦»æ€§æ˜¯é€šè¿‡æ•°æ®åº“é”çš„æœºåˆ¶å®ç°çš„ï¼ŒæŒä¹…æ€§é€šè¿‡redo logï¼ˆé‡åšæ—¥å¿—ï¼‰æ¥å®ç°ï¼ŒåŸå­æ€§å’Œä¸€è‡´æ€§é€šè¿‡Undo logæ¥å®ç°ã€‚ UndoLogçš„åŸç†å¾ˆç®€å•ï¼Œä¸ºäº†æ»¡è¶³äº‹åŠ¡çš„åŸå­æ€§ï¼Œåœ¨æ“ä½œä»»ä½•æ•°æ®ä¹‹å‰ï¼Œé¦–å…ˆå°†æ•°æ®å¤‡ä»½åˆ°ä¸€ä¸ªåœ°æ–¹ï¼ˆè¿™ä¸ªå­˜å‚¨æ•°æ®å¤‡ä»½çš„åœ°æ–¹ç§°ä¸ºUndoLogï¼‰ã€‚ç„¶åè¿›è¡Œæ•°æ®çš„ä¿®æ”¹ã€‚å¦‚æœå‡ºç°äº†é”™è¯¯æˆ–è€…ç”¨æˆ·æ‰§è¡Œäº†ROLLBACKè¯­å¥ï¼Œç³»ç»Ÿå¯ä»¥åˆ©ç”¨Undo Logä¸­çš„å¤‡ä»½å°†æ•°æ®æ¢å¤åˆ°äº‹åŠ¡å¼€å§‹ä¹‹å‰çš„çŠ¶æ€ã€‚ å’ŒUndo Logç›¸åï¼ŒRedoLogè®°å½•çš„æ˜¯æ–°æ•°æ®çš„å¤‡ä»½ã€‚åœ¨äº‹åŠ¡æäº¤å‰ï¼Œåªè¦å°†RedoLogæŒä¹…åŒ–å³å¯ï¼Œä¸éœ€è¦å°†æ•°æ®æŒä¹…åŒ–ã€‚å½“ç³»ç»Ÿå´©æºƒæ—¶ï¼Œè™½ç„¶æ•°æ®æ²¡æœ‰æŒä¹…åŒ–ï¼Œä½†æ˜¯RedoLogå·²ç»æŒä¹…åŒ–ã€‚ç³»ç»Ÿå¯ä»¥æ ¹æ®RedoLogçš„å†…å®¹ï¼Œå°†æ‰€æœ‰æ•°æ®æ¢å¤åˆ°æœ€æ–°çš„çŠ¶æ€ã€‚ ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡ ç®€å•è€Œè¨€ï¼Œå°±æ˜¯ä¸šåŠ¡ä¸Šæœ‰ä¸€ç»„æ•°æ®æ“ä½œï¼Œéœ€è¦å¦‚æœå…¶ä¸­æœ‰ä»»ä½•ä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œæ•´ç»„æ“ä½œå…¨éƒ¨ä¸æ‰§è¡Œå¹¶æ¢å¤åˆ°æœªæ‰§è¡ŒçŠ¶æ€ï¼Œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚ åœ¨ä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ—¶éœ€è¦æ³¨æ„ï¼Œå°½å¯èƒ½çŸ­çš„ä¿æŒäº‹åŠ¡ï¼Œä¿®æ”¹å¤šä¸ªä¸åŒè¡¨çš„æ•°æ®çš„å†—é•¿äº‹åŠ¡ä¼šä¸¥é‡å¦¨ç¢ç³»ç»Ÿä¸­çš„æ‰€æœ‰å…¶ä»–ç”¨æˆ·ï¼Œè¿™å¾ˆæœ‰å¯èƒ½å¯¼è‡´ä¸€äº›æ€§èƒ½é—®é¢˜ã€‚ åˆ†å¸ƒå¼ç†è®º CAPç†è®º ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ï¼šåˆ†å¸ƒå¼æ•°æ®åº“çš„æ•°æ®ä¿æŒä¸€è‡´ã€‚ å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ï¼šä»»ä½•ä¸€ä¸ªèŠ‚ç‚¹æŒ‚äº†ï¼Œå…¶ä»–èŠ‚ç‚¹å¯ä»¥ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ã€‚ åˆ†åŒºå®¹é”™æ€§ï¼ˆç½‘ç»œåˆ†åŒºï¼‰Partition toleranceï¼šä¸€ä¸ªæ•°æ®åº“æ‰€åœ¨çš„æœºå™¨åäº†ï¼Œå¦‚ç¡¬ç›˜åäº†ï¼Œæ•°æ®ä¸¢å¤±äº†ï¼Œå¯ä»¥æ–°å¢ä¸€å°æœºå™¨ï¼Œç„¶åä»å…¶ä»–æ­£å¸¸çš„æœºå™¨æŠŠå¤‡ä»½çš„æ•°æ®åŒæ­¥è¿‡æ¥ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰å’Œåˆ†åŒºå®¹å¿æ€§ï¼ˆPartition Toleranceï¼‰3 ä¸ªè¦ç´ æœ€å¤šåªèƒ½åŒæ—¶æ»¡è¶³ä¸¤ä¸ªï¼Œä¸å¯å…¼å¾—ã€‚å…¶ä¸­ï¼Œåˆ†åŒºå®¹å¿æ€§åˆæ˜¯ä¸å¯æˆ–ç¼ºçš„ã€‚ CA(æ”¾å¼ƒP)ï¼šå°†æ‰€æœ‰çš„æ•°æ®æ”¾åœ¨ä¸€ä¸ªèŠ‚ç‚¹ã€‚æ»¡è¶³ä¸€è‡´æ€§ã€å¯ç”¨æ€§ã€‚æ¯”å¦‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ã€‚ AP(æ”¾å¼ƒC)ï¼šæ”¾å¼ƒå¼ºä¸€è‡´æ€§ï¼Œç”¨æœ€ç»ˆä¸€è‡´æ€§æ¥ä¿è¯ã€‚æ¯”å¦‚Zookeeperã€‚ CP(æ”¾å¼ƒA)ï¼šä¸€æ—¦ç³»ç»Ÿé‡åˆ°æ•…éšœï¼Œå—åˆ°å½±å“çš„æœåŠ¡å™¨éœ€è¦ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œåœ¨æ¢å¤æœŸé—´æ— æ³•å¯¹å¤–æä¾›æœåŠ¡ã€‚æ¯”å¦‚Redisç­‰ã€‚ CAPç†è®ºä¸¾ä¾‹ï¼š æœ‰3å°æœºå™¨åˆ†åˆ«æœ‰3ä¸ªæ•°æ®åº“åˆ†åˆ«æœ‰ä¸¤å¼ è¡¨,æ•°æ®éƒ½æ˜¯ä¸€æ ·çš„ Machine1-db1-tbl_personã€tbl_order Machine2-db2-tbl_personã€tbl_order Machine3-db3-tbl_personã€tbl_order 1ï¼‰å½“å‘machine1çš„db1çš„è¡¨tbl_personã€tbl_orderæ’å…¥æ•°æ•°æ®æ—¶ï¼ŒåŒæ—¶è¦æŠŠæ’å…¥çš„æ•°æ®åŒæ­¥åˆ°machine2ã€machine3ï¼Œè¿™å°±æ˜¯ä¸€è‡´æ€§ã€‚ 2ï¼‰å½“å…¶ä¸­çš„ä¸€å°æœºå™¨å®•æœºäº†ï¼Œå¯ä»¥ç»§ç»­å¯¹å¤–æä¾›æœåŠ¡ï¼ŒæŠŠå®•æœºçš„æœºå™¨é‡æ–°å¯åŠ¨èµ·æ¥å¯ä»¥ç»§ç»­æœåŠ¡ï¼Œè¿™å°±æ˜¯å¯ç”¨æ€§ã€‚ 3ï¼‰å½“machine1çš„æœºå™¨åäº†ï¼Œæ•°æ®å…¨éƒ¨ä¸¢å¤±äº†ï¼Œä¸ä¼šæœ‰ä»»ä½•é—®é¢˜ï¼Œå› ä¸ºmachine2å’Œmachine3ä¸Šè¿˜æœ‰æ•°æ®ï¼Œé‡æ–°åŠ ä¸€å°æœºå™¨machine4ï¼ŒæŠŠmachine2å’Œmachine3å…¶ä¸­ä¸€å°æœºå™¨çš„å¤‡ä»½æ•°æ®åŒæ­¥è¿‡æ¥å°±å¯ä»¥äº†ï¼Œè¿™å°±æ˜¯åˆ†åŒºå®¹é”™æ€§ã€‚ ä¸ºä»€ä¹ˆä¸‰ä¸ªä¸èƒ½åŒæ—¶æ»¡è¶³? è™½ç„¶ CAP ç†è®ºå®šä¹‰æ˜¯ä¸‰ä¸ªè¦ç´ ä¸­åªèƒ½å–ä¸¤ä¸ªï¼Œä½†æ”¾åˆ°åˆ†å¸ƒå¼ç¯å¢ƒä¸‹æ¥æ€è€ƒï¼Œä¼šå‘ç°å¿…é¡»é€‰æ‹© Pï¼ˆåˆ†åŒºå®¹å¿ï¼‰è¦ç´ ï¼Œå› ä¸ºç½‘ç»œæœ¬èº«æ— æ³•åšåˆ° 100% å¯é ï¼Œæœ‰å¯èƒ½å‡ºæ•…éšœï¼Œæ‰€ä»¥åˆ†åŒºæ˜¯ä¸€ä¸ªå¿…ç„¶çš„ç°è±¡ã€‚ å¦‚æœé€‰æ‹©äº† CAï¼ˆä¸€è‡´æ€§ + å¯ç”¨æ€§ï¼‰ è€Œæ”¾å¼ƒäº† Pï¼ˆåˆ†åŒºå®¹å¿æ€§ï¼‰ï¼Œé‚£ä¹ˆå½“å‘ç”Ÿåˆ†åŒºç°è±¡æ—¶ï¼Œä¸ºäº†ä¿è¯ Cï¼ˆä¸€è‡´æ€§ï¼‰ï¼Œç³»ç»Ÿéœ€è¦ç¦æ­¢å†™å…¥ï¼Œå½“æœ‰å†™å…¥è¯·æ±‚æ—¶ï¼Œç³»ç»Ÿè¿”å› errorï¼ˆä¾‹å¦‚ï¼Œå½“å‰ç³»ç»Ÿä¸å…è®¸å†™å…¥ï¼‰ï¼Œè¿™åˆå’Œ A(å¯ç”¨æ€§) å†²çªäº†ï¼Œå› ä¸º Aï¼ˆå¯ç”¨æ€§ï¼‰è¦æ±‚è¿”å› no error å’Œ no timeoutã€‚ å› æ­¤ï¼Œåˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºä¸Šä¸å¯èƒ½é€‰æ‹© CA ï¼ˆä¸€è‡´æ€§ + å¯ç”¨æ€§ï¼‰æ¶æ„ï¼Œåªèƒ½é€‰æ‹© CPï¼ˆä¸€è‡´æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰ æˆ–è€… AP ï¼ˆå¯ç”¨æ€§ + åˆ†åŒºå®¹å¿æ€§ï¼‰æ¶æ„ï¼Œåœ¨ä¸€è‡´æ€§å’Œå¯ç”¨æ€§åšæŠ˜ä¸­é€‰æ‹©ã€‚ ä¸»è¦è§£é‡Šä¸€ä¸‹ä¸ºä»€ä¹ˆåœ¨æ»¡è¶³åˆ†åŒºå®¹é”™æ€§çš„æ¡ä»¶ä¸‹ï¼Œå¯ç”¨æ€§ä¸ä¸€è‡´æ€§ä¸èƒ½åŒæ—¶æ»¡è¶³ã€‚ ä¸€è‡´æ€§è¦æ±‚æ‰€æœ‰èŠ‚ç‚¹æ•°æ®éƒ½ä¸€è‡´æ—¶å†å“åº”å®¢æˆ·ç«¯è¯·æ±‚ï¼Œé‚£ä¹ˆä¸€æ—¦å‘ç”ŸèŠ‚ç‚¹å®•æœºæˆ–è€…ç½‘ç»œéš”ç¦»ï¼Œå°±éœ€è¦ç­‰å¾…èŠ‚ç‚¹æ¢å¤æˆ–è€…ç½‘ç»œæ¢å¤æˆ–è€…é›†ç¾¤é‡æ–°è°ƒæ•´èŠ‚ç‚¹æ•°ç›®ç­‰ç­‰ï¼Œæ‰èƒ½æ»¡è¶³ä¸€è‡´æ€§ï¼›åœ¨è¿™æ®µæ—¶é—´ï¼ŒæœåŠ¡æ˜¯ä¸å¯ç”¨çš„ã€‚ç›¸åå¦‚æœæƒ³è¦åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼ŒæœåŠ¡ç»§ç»­å¯ç”¨ï¼Œä¾¿éœ€è¦ç‰ºç‰²ä¸€è‡´æ€§ã€‚ é¡ºä¾¿ä¸€æï¼ŒCAPç†è®ºä¸­æ˜¯å¿½ç•¥ç½‘ç»œå»¶è¿Ÿï¼Œä¹Ÿå°±æ˜¯å½“äº‹åŠ¡æäº¤æ—¶ï¼Œä»èŠ‚ç‚¹Aå¤åˆ¶åˆ°èŠ‚ç‚¹Bï¼Œä½†æ˜¯åœ¨ç°å®ä¸­è¿™ä¸ªæ˜¯æ˜æ˜¾ä¸å¯èƒ½çš„ï¼Œæ‰€ä»¥æ€»ä¼šæœ‰ä¸€å®šçš„æ—¶é—´æ˜¯ä¸ä¸€è‡´ã€‚åŒæ—¶CAPä¸­é€‰æ‹©ä¸¤ä¸ªï¼Œæ¯”å¦‚ä½ é€‰æ‹©äº†CPï¼Œå¹¶ä¸æ˜¯å«ä½ æ”¾å¼ƒAã€‚å› ä¸ºPå‡ºç°çš„æ¦‚ç‡å®åœ¨æ˜¯å¤ªå°äº†ï¼Œå¤§éƒ¨åˆ†çš„æ—¶é—´ä½ ä»ç„¶éœ€è¦ä¿è¯CAã€‚å°±ç®—åˆ†åŒºå‡ºç°äº†ä½ ä¹Ÿè¦ä¸ºåæ¥çš„Aåšå‡†å¤‡ï¼Œæ¯”å¦‚é€šè¿‡ä¸€äº›æ—¥å¿—çš„æ‰‹æ®µï¼Œæ˜¯å…¶ä»–æœºå™¨å›å¤è‡³å¯ç”¨ã€‚ CAPç†è®ºå‘Šè¯‰æˆ‘ä»¬åˆ†å¸ƒå¼ç³»ç»Ÿåªèƒ½é€‰æ‹©APæˆ–è€…CPï¼Œä½†å®é™…ä¸Šå¹¶ä¸æ˜¯è¯´æ•´ä¸ªç³»ç»Ÿåªèƒ½é€‰æ‹©APæˆ–è€…CPï¼Œåœ¨ CAP ç†è®ºè½åœ°å®è·µæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ç³»ç»Ÿå†…çš„æ•°æ®æŒ‰ç…§ä¸åŒçš„åº”ç”¨åœºæ™¯å’Œè¦æ±‚è¿›è¡Œåˆ†ç±»ï¼Œæ¯ç±»æ•°æ®é€‰æ‹©ä¸åŒçš„ç­–ç•¥ï¼ˆCP è¿˜æ˜¯ APï¼‰ï¼Œè€Œä¸æ˜¯ç›´æ¥é™å®šæ•´ä¸ªç³»ç»Ÿæ‰€æœ‰æ•°æ®éƒ½æ˜¯åŒä¸€ç­–ç•¥ã€‚ å¦å¤–ï¼Œåªèƒ½é€‰æ‹©CPæˆ–è€…APæ˜¯æŒ‡ç³»ç»Ÿå‘ç”Ÿåˆ†åŒºç°è±¡æ—¶æ— æ³•åŒæ—¶ä¿è¯Cï¼ˆä¸€è‡´æ€§ï¼‰å’ŒAï¼ˆå¯ç”¨æ€§ï¼‰ï¼Œä½†ä¸æ˜¯æ„å‘³ç€ä»€ä¹ˆéƒ½ä¸åšï¼Œå½“åˆ†åŒºæ•…éšœè§£å†³åï¼Œç³»ç»Ÿè¿˜æ˜¯è¦ä¿æŒä¿è¯CAã€‚ BASEç†è®º BASE æ˜¯ Basically Available(åŸºæœ¬å¯ç”¨)ã€Soft state(è½¯çŠ¶æ€)å’Œ Eventually consistent (æœ€ç»ˆä¸€è‡´æ€§)ä¸‰ä¸ªçŸ­è¯­çš„ç¼©å†™ã€‚æ˜¯å¯¹CAPä¸­APçš„ä¸€ä¸ªæ‰©å±• åŸºæœ¬å¯ç”¨:åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨å‡ºç°æ•…éšœæ—¶ï¼Œå…è®¸æŸå¤±éƒ¨åˆ†å¯ç”¨åŠŸèƒ½ï¼Œä¿è¯æ ¸å¿ƒåŠŸèƒ½å¯ç”¨ã€‚æ¯”å¦‚æœåŠ¡é™çº§ã€é¡µé¢é™çº§ã€‚ è½¯çŠ¶æ€:å…è®¸ç³»ç»Ÿä¸­å­˜åœ¨ä¸­é—´çŠ¶æ€ï¼Œè¿™ä¸ªçŠ¶æ€ä¸å½±å“ç³»ç»Ÿå¯ç”¨æ€§ã€‚ è¿™é‡Œçš„ä¸­é—´çŠ¶æ€æ˜¯æŒ‡ä¸åŒçš„data replicationä¹‹é—´çš„æ•°æ®æ›´æ–°å¯ä»¥å‡ºç°å»¶æ—¶çš„æœ€ç»ˆä¸€è‡´æ€§ã€‚ å¦‚CAPç†è®ºé‡Œé¢çš„ç¤ºä¾‹ï¼Œå½“å‘machine1çš„db1çš„è¡¨tbl_personã€tbl_orderæ’å…¥æ•°æ•°æ®æ—¶ï¼ŒåŒæ—¶è¦æŠŠæ’å…¥çš„æ•°æ®åŒæ­¥åˆ°machine2ã€machine3ï¼Œå½“machine3çš„ç½‘ç»œæœ‰é—®é¢˜æ—¶ï¼ŒåŒæ­¥å¤±è´¥ï¼Œä½†æ˜¯è¿‡ä¸€ä¼šç½‘ç»œæ¢å¤äº†å°±åŒæ­¥æˆåŠŸäº†ï¼Œè¿™ä¸ªåŒæ­¥å¤±è´¥çš„çŠ¶æ€å°±ç§°ä¸ºè½¯çŠ¶æ€ï¼Œå› ä¸ºæœ€ç»ˆè¿˜æ˜¯åŒæ­¥æˆåŠŸäº†ã€‚ æœ€ç»ˆä¸€è‡´:æœ€ç»ˆä¸€è‡´æ˜¯æŒ‡ç»è¿‡ä¸€æ®µæ—¶é—´åï¼Œæ‰€æœ‰èŠ‚ç‚¹æ•°æ®éƒ½å°†ä¼šè¾¾åˆ°ä¸€è‡´ã€‚ BASEè§£å†³äº†CAPä¸­ç†è®ºæ²¡æœ‰ç½‘ç»œå»¶è¿Ÿï¼Œåœ¨BASEä¸­ç”¨è½¯çŠ¶æ€å’Œæœ€ç»ˆä¸€è‡´ï¼Œä¿è¯äº†å»¶è¿Ÿåçš„ä¸€è‡´æ€§ã€‚BASEå’Œ ACID æ˜¯ç›¸åçš„ï¼Œå®ƒå®Œå…¨ä¸åŒäºACIDçš„å¼ºä¸€è‡´æ€§æ¨¡å‹ï¼Œè€Œæ˜¯é€šè¿‡ç‰ºç‰²å¼ºä¸€è‡´æ€§æ¥è·å¾—å¯ç”¨æ€§ï¼Œå¹¶å…è®¸æ•°æ®åœ¨ä¸€æ®µæ—¶é—´å†…æ˜¯ä¸ä¸€è‡´çš„ï¼Œä½†æœ€ç»ˆè¾¾åˆ°ä¸€è‡´çŠ¶æ€ã€‚ æ•°æ®ä¸€è‡´æ€§æ¨¡å‹ æ•°æ®çš„ä¸€è‡´æ€§æ¨¡å‹å¯ä»¥åˆ†æˆä»¥ä¸‹ 3 ç±»ï¼š å¼ºä¸€è‡´æ€§ï¼šæ•°æ®æ›´æ–°æˆåŠŸåï¼Œä»»æ„æ—¶åˆ»æ‰€æœ‰å‰¯æœ¬ä¸­çš„æ•°æ®éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä¸€èˆ¬é‡‡ç”¨åŒæ­¥çš„æ–¹å¼å®ç°ã€‚ å¼±ä¸€è‡´æ€§ï¼šæ•°æ®æ›´æ–°æˆåŠŸåï¼Œç³»ç»Ÿä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¯»åˆ°æœ€æ–°å†™å…¥çš„å€¼ï¼Œä¹Ÿä¸æ‰¿è¯ºå…·ä½“å¤šä¹…ä¹‹åå¯ä»¥è¯»åˆ°ã€‚ æœ€ç»ˆä¸€è‡´æ€§ï¼šå¼±ä¸€è‡´æ€§çš„ä¸€ç§å½¢å¼ï¼Œæ•°æ®æ›´æ–°æˆåŠŸåï¼Œç³»ç»Ÿä¸æ‰¿è¯ºç«‹å³å¯ä»¥è¿”å›æœ€æ–°å†™å…¥çš„å€¼ï¼Œä½†æ˜¯ä¿è¯æœ€ç»ˆä¼šè¿”å›ä¸Šä¸€æ¬¡æ›´æ–°æ“ä½œçš„å€¼ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡ ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼äº‹åŠ¡ åˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯æŒ‡äº‹åŠ¡çš„å‚ä¸è€…ã€æ”¯æŒäº‹åŠ¡çš„æœåŠ¡å™¨ã€èµ„æºæœåŠ¡å™¨ä»¥åŠäº‹åŠ¡ç®¡ç†å™¨åˆ†åˆ«ä½äºä¸åŒçš„åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸åŒèŠ‚ç‚¹ä¹‹ä¸Šã€‚ç®€å•çš„è¯´ï¼Œå°±æ˜¯ä¸€æ¬¡å¤§çš„æ“ä½œç”±ä¸åŒçš„å°æ“ä½œç»„æˆï¼Œè¿™äº›å°çš„æ“ä½œåˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä¸”å±äºä¸åŒçš„åº”ç”¨ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡éœ€è¦ä¿è¯è¿™äº›å°æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ã€‚æœ¬è´¨ä¸Šæ¥è¯´ï¼Œåˆ†å¸ƒå¼äº‹åŠ¡å°±æ˜¯ä¸ºäº†ä¿è¯ä¸åŒæ•°æ®åº“çš„æ•°æ®ä¸€è‡´æ€§ã€‚ ä¸¾ä¸ªäº’è”ç½‘å¸¸ç”¨çš„äº¤æ˜“ä¸šåŠ¡ä¸ºä¾‹ï¼š ä¸Šå›¾ä¸­åŒ…å«äº†åº“å­˜å’Œè®¢å•ä¸¤ä¸ªç‹¬ç«‹çš„å¾®æœåŠ¡ï¼Œæ¯ä¸ªå¾®æœåŠ¡ç»´æŠ¤äº†è‡ªå·±çš„æ•°æ®åº“ã€‚åœ¨äº¤æ˜“ç³»ç»Ÿçš„ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œä¸€ä¸ªå•†å“åœ¨ä¸‹å•ä¹‹å‰éœ€è¦å…ˆè°ƒç”¨åº“å­˜æœåŠ¡ï¼Œè¿›è¡Œæ‰£é™¤åº“å­˜ï¼Œå†è°ƒç”¨è®¢å•æœåŠ¡ï¼Œåˆ›å»ºè®¢å•è®°å½•ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå¤šä¸ªæ•°æ®åº“ä¹‹é—´çš„æ•°æ®æ›´æ–°æ²¡æœ‰ä¿è¯äº‹åŠ¡ï¼Œå°†ä¼šå¯¼è‡´å‡ºç°å­ç³»ç»Ÿæ•°æ®ä¸ä¸€è‡´ï¼Œä¸šåŠ¡å‡ºç°é—®é¢˜ã€‚ åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆ 2PC 2PC = Two Phase commit äºŒé˜¶æ®µæäº¤ï¼ˆRDBMSï¼ˆå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼‰ç»å¸¸å°±æ˜¯è¿™ç§æœºåˆ¶ï¼Œä¿è¯å¼ºä¸€è‡´æ€§ï¼‰ã€‚ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹è™½ç„¶å¯ä»¥çŸ¥æ™“è‡ªå·±çš„æ“ä½œæ—¶æˆåŠŸæˆ–è€…å¤±è´¥ï¼Œå´æ— æ³•çŸ¥é“å…¶ä»–èŠ‚ç‚¹çš„æ“ä½œçš„æˆåŠŸæˆ–å¤±è´¥ã€‚å½“ä¸€ä¸ªäº‹åŠ¡è·¨è¶Šå¤šä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¸ºäº†ä¿æŒäº‹åŠ¡çš„ACIDç‰¹æ€§ï¼Œéœ€è¦å¼•å…¥ä¸€ä¸ªä½œä¸ºåè°ƒè€…çš„ç»„ä»¶æ¥ç»Ÿä¸€æŒæ§æ‰€æœ‰èŠ‚ç‚¹ï¼ˆç§°ä½œå‚ä¸è€…ï¼‰çš„æ“ä½œç»“æœå¹¶æœ€ç»ˆæŒ‡ç¤ºè¿™äº›èŠ‚ç‚¹æ˜¯å¦è¦æŠŠæ“ä½œç»“æœè¿›è¡ŒçœŸæ­£çš„æäº¤ã€‚ ç®—æ³•æ€è·¯ å‚ä¸è€…å°†æ“ä½œæˆè´¥é€šçŸ¥åè°ƒè€…ï¼Œå†ç”±åè°ƒè€…æ ¹æ®æ‰€æœ‰å‚ä¸è€…çš„åé¦ˆæƒ…æŠ¥å†³å®šå„å‚ä¸è€…æ˜¯å¦è¦æäº¤æ“ä½œè¿˜æ˜¯ä¸­æ­¢æ“ä½œã€‚ æ ¸å¿ƒæ€æƒ³ å¯¹æ¯ä¸€ä¸ªäº‹åŠ¡éƒ½é‡‡ç”¨å…ˆå°è¯•åæäº¤çš„å¤„ç†æ–¹å¼ï¼Œå¤„ç†åæ‰€æœ‰çš„è¯»æ“ä½œéƒ½è¦èƒ½è·å¾—æœ€æ–°çš„æ•°æ®ï¼Œå› æ­¤ä¹Ÿå¯ä»¥å°†äºŒé˜¶æ®µæäº¤çœ‹ä½œæ˜¯ä¸€ä¸ªå¼ºä¸€è‡´æ€§ç®—æ³•ã€‚ å¤„ç†æµç¨‹ &lt;font color="green"&gt;é˜¶æ®µ1ï¼šæäº¤äº‹åŠ¡è¯·æ±‚ï¼ˆæŠ•ç¥¨é˜¶æ®µï¼‰è¯¢é—®æ˜¯å¦å¯ä»¥æäº¤äº‹åŠ¡&lt;/font&gt; è¿›ä¸€æ­¥å°†å‡†å¤‡é˜¶æ®µåˆ†ä¸ºä»¥ä¸‹ä¸‰ä¸ªæ­¥éª¤ï¼š 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œæäº¤æ“ä½œ(vote)ï¼Œå¹¶å¼€å§‹ç­‰å¾…å„å‚ä¸è€…èŠ‚ç‚¹çš„å“åº”ã€‚ 2ï¼‰å‚ä¸è€…èŠ‚ç‚¹æ‰§è¡Œè¯¢é—®å‘èµ·ä¸ºæ­¢çš„æ‰€æœ‰äº‹åŠ¡æ“ä½œï¼Œå¹¶å°†Undoä¿¡æ¯å’ŒRedoä¿¡æ¯å†™å…¥æ—¥å¿—ã€‚ï¼ˆæ³¨æ„ï¼šè‹¥æˆåŠŸè¿™é‡Œå…¶å®æ¯ä¸ªå‚ä¸è€…å·²ç»æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼‰ 3ï¼‰å„å‚ä¸è€…èŠ‚ç‚¹å“åº”åè°ƒè€…èŠ‚ç‚¹å‘èµ·çš„è¯¢é—®ã€‚å¦‚æœå‚ä¸è€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®é™…æ‰§è¡ŒæˆåŠŸï¼Œåˆ™å®ƒè¿”å›ä¸€ä¸ª"åŒæ„"æ¶ˆæ¯ï¼›å¦‚æœå‚ä¸è€…èŠ‚ç‚¹çš„äº‹åŠ¡æ“ä½œå®é™…æ‰§è¡Œå¤±è´¥ï¼Œåˆ™å®ƒè¿”å›ä¸€ä¸ª"ä¸­æ­¢"æ¶ˆæ¯ã€‚ &lt;font color="green"&gt;é˜¶æ®µ2ï¼šæ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆcommitã€rollbackï¼‰ çœŸæ­£çš„æäº¤äº‹åŠ¡&lt;/font&gt; å¦‚æœåè°ƒè€…æ”¶åˆ°äº†å‚ä¸è€…çš„å¤±è´¥æ¶ˆæ¯æˆ–è€…è¶…æ—¶ï¼Œç›´æ¥ç»™æ¯ä¸ªå‚ä¸è€…å‘é€å›æ»š(Rollback)æ¶ˆæ¯ï¼› å¦åˆ™ï¼Œå‘é€æäº¤(Commit)æ¶ˆæ¯ï¼›å‚ä¸è€…æ ¹æ®åè°ƒè€…çš„æŒ‡ä»¤æ‰§è¡Œæäº¤æˆ–è€…å›æ»šæ“ä½œï¼Œé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡å¤„ç†è¿‡ç¨‹ä¸­ä½¿ç”¨çš„é”èµ„æºã€‚(æ³¨æ„:å¿…é¡»åœ¨æœ€åé˜¶æ®µé‡Šæ”¾é”èµ„æº)ã€‚ &lt;font color="blue"&gt;å½“åè°ƒè€…èŠ‚ç‚¹ä»æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹è·å¾—çš„å“åº”æ¶ˆæ¯éƒ½ä¸º"åŒæ„"æ—¶:&lt;/font&gt; 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º"æ­£å¼æäº¤(commit)"çš„è¯·æ±‚ã€‚ 2ï¼‰å‚ä¸è€…èŠ‚ç‚¹æ­£å¼å®Œæˆæ“ä½œï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚ 3ï¼‰å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹åé¦ˆack(åº”ç­”)"å®Œæˆ"æ¶ˆæ¯ã€‚ 4ï¼‰åè°ƒè€…èŠ‚ç‚¹æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹åé¦ˆçš„ackåº”ç­”"å®Œæˆ"æ¶ˆæ¯åï¼Œå®Œæˆäº‹åŠ¡ã€‚ &lt;font color="blue"&gt;å¦‚æœä»»ä¸€å‚ä¸è€…èŠ‚ç‚¹åœ¨ç¬¬ä¸€é˜¶æ®µè¿”å›çš„å“åº”æ¶ˆæ¯ä¸º"ä¸­æ­¢"ï¼Œæˆ–è€… åè°ƒè€…èŠ‚ç‚¹åœ¨ç¬¬ä¸€é˜¶æ®µçš„è¯¢é—®è¶…æ—¶ä¹‹å‰æ— æ³•è·å–æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹çš„å“åº”æ¶ˆæ¯æ—¶ï¼š&lt;/font&gt; 1ï¼‰åè°ƒè€…èŠ‚ç‚¹å‘æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹å‘å‡º"å›æ»šæ“ä½œ(rollback)"çš„è¯·æ±‚ã€‚ 2ï¼‰å‚ä¸è€…èŠ‚ç‚¹åˆ©ç”¨ä¹‹å‰å†™å…¥çš„Undoä¿¡æ¯æ‰§è¡Œå›æ»šï¼Œå¹¶é‡Šæ”¾åœ¨æ•´ä¸ªäº‹åŠ¡æœŸé—´å†…å ç”¨çš„èµ„æºã€‚ 3ï¼‰å‚ä¸è€…èŠ‚ç‚¹å‘åè°ƒè€…èŠ‚ç‚¹å‘é€"å›æ»šå®Œæˆ"æ¶ˆæ¯ã€‚ 4ï¼‰åè°ƒè€…èŠ‚ç‚¹æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…èŠ‚ç‚¹åé¦ˆçš„"å›æ»šå®Œæˆ"æ¶ˆæ¯åï¼Œå–æ¶ˆäº‹åŠ¡ã€‚ &lt;font color="red"&gt;ä¸ç®¡æœ€åç»“æœå¦‚ä½•ï¼Œç¬¬äºŒé˜¶æ®µéƒ½ä¼šç»“æŸå½“å‰äº‹åŠ¡ã€‚&lt;/font&gt; å­˜åœ¨çš„é—®é¢˜ 1ã€åŒæ­¥é˜»å¡é—®é¢˜ã€‚æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæ‰€æœ‰å‚ä¸èŠ‚ç‚¹éƒ½æ˜¯äº‹åŠ¡é˜»å¡å‹çš„ã€‚å½“å‚ä¸è€…å æœ‰å…¬å…±èµ„æºæ—¶ï¼Œå…¶ä»–ç¬¬ä¸‰æ–¹èŠ‚ç‚¹è®¿é—®å…¬å…±èµ„æºä¸å¾—ä¸å¤„äºé˜»å¡çŠ¶æ€ã€‚ 2ã€å•ç‚¹æ•…éšœã€‚ç”±äºåè°ƒè€…çš„é‡è¦æ€§ï¼Œä¸€æ—¦åè°ƒè€…å‘ç”Ÿæ•…éšœã€‚å‚ä¸è€…ä¼šä¸€ç›´é˜»å¡ä¸‹å»ã€‚å°¤å…¶åœ¨ç¬¬äºŒé˜¶æ®µï¼Œåè°ƒè€…å‘ç”Ÿæ•…éšœï¼Œé‚£ä¹ˆæ‰€æœ‰çš„å‚ä¸è€…è¿˜éƒ½å¤„äºé”å®šäº‹åŠ¡èµ„æºçš„çŠ¶æ€ä¸­ï¼Œè€Œæ— æ³•ç»§ç»­å®Œæˆäº‹åŠ¡æ“ä½œã€‚ï¼ˆå¦‚æœæ˜¯åè°ƒè€…æŒ‚æ‰ï¼Œå¯ä»¥é‡æ–°é€‰ä¸¾ä¸€ä¸ªåè°ƒè€…ï¼Œä½†æ˜¯æ— æ³•è§£å†³å› ä¸ºåè°ƒè€…å®•æœºå¯¼è‡´çš„å‚ä¸è€…å¤„äºé˜»å¡çŠ¶æ€çš„é—®é¢˜ï¼‰ 3ã€æ•°æ®ä¸ä¸€è‡´ã€‚åœ¨äºŒé˜¶æ®µæäº¤çš„é˜¶æ®µäºŒä¸­ï¼Œå½“åè°ƒè€…å‘å‚ä¸è€…å‘é€commitè¯·æ±‚ä¹‹åï¼Œå‘ç”Ÿäº†å±€éƒ¨ç½‘ç»œå¼‚å¸¸æˆ–è€…åœ¨å‘é€commitè¯·æ±‚è¿‡ç¨‹ä¸­åè°ƒè€…å‘ç”Ÿäº†æ•…éšœï¼Œè¿™ä¼šå¯¼è‡´åªæœ‰ä¸€éƒ¨åˆ†å‚ä¸è€…æ¥å—åˆ°äº†commitè¯·æ±‚ã€‚è€Œåœ¨è¿™éƒ¨åˆ†å‚ä¸è€…æ¥åˆ°commitè¯·æ±‚ä¹‹åå°±ä¼šæ‰§è¡Œcommitæ“ä½œã€‚ä½†æ˜¯å…¶ä»–æœªæ¥åˆ°commitè¯·æ±‚çš„æœºå™¨åˆ™æ— æ³•æ‰§è¡Œäº‹åŠ¡æäº¤ã€‚äºæ˜¯æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿä¾¿å‡ºç°äº†æ•°æ®ä¸ä¸€è‡´æ€§çš„ç°è±¡ã€‚ 4ã€äºŒé˜¶æ®µæ— æ³•è§£å†³çš„é—®é¢˜ï¼šåè°ƒè€…å†å‘å‡ºcommitæ¶ˆæ¯ä¹‹åå®•æœºï¼Œè€Œå”¯ä¸€æ¥æ”¶åˆ°è¿™æ¡æ¶ˆæ¯çš„å‚ä¸è€…åŒæ—¶ä¹Ÿå®•æœºäº†ã€‚é‚£ä¹ˆå³ä½¿åè°ƒè€…é€šè¿‡é€‰ä¸¾åè®®äº§ç”Ÿäº†æ–°çš„åè°ƒè€…ï¼Œè¿™æ¡äº‹åŠ¡çš„çŠ¶æ€ä¹Ÿæ˜¯ä¸ç¡®å®šçš„ï¼Œæ²¡äººçŸ¥é“äº‹åŠ¡æ˜¯å¦è¢«å·²ç»æäº¤ã€‚ &lt;font color="red"&gt;éœ€è¦æ³¨æ„çš„æ˜¯ï¼šåœ¨å…¨å±€äº‹åŠ¡å†³å®šå›æ»šæ—¶ï¼Œç›´æ¥é€ä¸ªå‘é€rollbackè¯·æ±‚å³å¯ï¼Œä¸å¿…åˆ†é˜¶æ®µã€‚&lt;/font&gt; 2PCæœºåˆ¶éœ€è¦RMæä¾›åº•å±‚æ”¯æŒï¼ˆä¸€èˆ¬æ˜¯å…¼å®¹XAï¼‰ã€‚å¦‚æœä½¿ç”¨Javaï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å¼€æºè½¯ä»¶ atomikos æˆ–è€…JOTMæ¥å¿«é€Ÿå®ç°ï¼Œä¸¤è€…éƒ½æ”¯æŒspringäº‹åŠ¡æ•´åˆã€‚ 3PC 3PC = Three Phase commit ä¸‰é˜¶æ®µæäº¤ ç”±äºäºŒé˜¶æ®µæäº¤å­˜åœ¨ç€è¯¸å¦‚åŒæ­¥é˜»å¡ã€å•ç‚¹é—®é¢˜ã€è„‘è£‚ç­‰ç¼ºé™·ï¼Œæ‰€ä»¥ï¼Œåœ¨äºŒé˜¶æ®µæäº¤çš„åŸºç¡€ä¸Šåšäº†æ”¹è¿›ï¼Œæå‡ºäº†ä¸‰é˜¶æ®µæäº¤ã€‚ ä¸ä¸¤é˜¶æ®µæäº¤ä¸åŒçš„æ˜¯ï¼Œä¸‰é˜¶æ®µæäº¤æœ‰ä¸¤ä¸ªæ”¹åŠ¨ç‚¹ï¼š 1ã€å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚åŒæ—¶åœ¨åè°ƒè€…å’Œå‚ä¸è€…ä¸­éƒ½å¼•å…¥è¶…æ—¶æœºåˆ¶ã€‚ 2ã€å°†äºŒé˜¶æ®µçš„å‡†å¤‡é˜¶æ®µæ‹†åˆ†ä¸º2ä¸ªé˜¶æ®µï¼Œæ’å…¥äº†ä¸€ä¸ªpreCommité˜¶æ®µï¼Œä½¿å¾—åŸå…ˆåœ¨äºŒé˜¶æ®µæäº¤ä¸­ï¼Œå‚ä¸è€…åœ¨å‡†å¤‡ä¹‹åï¼Œç”±äºåè°ƒè€…å‘ç”Ÿå´©æºƒæˆ–é”™è¯¯ï¼Œè€Œå¯¼è‡´å‚ä¸è€…å¤„äºæ— æ³•çŸ¥æ™“æ˜¯å¦æäº¤æˆ–è€…ä¸­æ­¢çš„â€œä¸ç¡®å®šçŠ¶æ€â€æ‰€äº§ç”Ÿçš„å¯èƒ½ç›¸å½“é•¿çš„å»¶æ—¶çš„é—®é¢˜å¾—ä»¥è§£å†³ã€‚ä¿è¯äº†åœ¨æœ€åæäº¤é˜¶æ®µä¹‹å‰å„å‚ä¸èŠ‚ç‚¹çš„çŠ¶æ€æ˜¯ä¸€è‡´çš„ã€‚ å¤„ç†æµç¨‹ &lt;font color="green"&gt;é˜¶æ®µ1ï¼šCanCommité˜¶æ®µï¼Œæ˜¯å¦æäº¤-è¯¢é—®æ˜¯å¦å¯ä»¥åšäº‹åŠ¡æäº¤&lt;/font&gt; äº‹åŠ¡è¯¢é—®ï¼šåè°ƒè€…å‘å‚ä¸è€…å‘é€CanCommitè¯·æ±‚ã€‚è¯¢é—®æ˜¯å¦å¯ä»¥æ‰§è¡Œäº‹åŠ¡æäº¤æ“ä½œã€‚ç„¶åå¼€å§‹ç­‰å¾…å‚ä¸è€…çš„å“åº”ã€‚ å“åº”åé¦ˆï¼šå‚ä¸è€…æ¥åˆ°CanCommitè¯·æ±‚ä¹‹åï¼Œæ­£å¸¸æƒ…å†µä¸‹ï¼Œå¦‚æœå…¶è‡ªèº«è®¤ä¸ºå¯ä»¥é¡ºåˆ©æ‰§è¡Œäº‹åŠ¡ï¼Œåˆ™è¿”å›Yeså“åº”ï¼Œå¹¶è¿›å…¥é¢„å¤‡çŠ¶æ€ã€‚å¦åˆ™åé¦ˆNoã€‚ &lt;font color="green"&gt;é˜¶æ®µ2ï¼šPreCommité˜¶æ®µï¼Œé¢„å…ˆæäº¤-é¢„å…ˆæäº¤äº‹åŠ¡&lt;/font&gt; &lt;font color="blue"&gt;å‡å¦‚åè°ƒè€…ä»æ‰€æœ‰çš„å‚ä¸è€…è·å¾—çš„åé¦ˆéƒ½æ˜¯Yeså“åº”ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œäº‹åŠ¡çš„é¢„æ‰§è¡Œã€‚&lt;/font&gt; å‘é€é¢„æäº¤è¯·æ±‚ï¼šåè°ƒè€…å‘å‚ä¸è€…å‘é€PreCommitè¯·æ±‚ï¼Œå¹¶è¿›å…¥Preparedé˜¶æ®µã€‚ äº‹åŠ¡é¢„æäº¤ï¼šå‚ä¸è€…æ¥æ”¶åˆ°PreCommitè¯·æ±‚åï¼Œä¼šæ‰§è¡Œäº‹åŠ¡æ“ä½œï¼Œå¹¶å°†undoå’Œredoä¿¡æ¯è®°å½•åˆ°äº‹åŠ¡æ—¥å¿—ä¸­ã€‚ å“åº”åé¦ˆï¼šå¦‚æœå‚ä¸è€…æˆåŠŸçš„æ‰§è¡Œäº†äº‹åŠ¡æ“ä½œï¼Œåˆ™è¿”å›ACKå“åº”ï¼ŒåŒæ—¶å¼€å§‹ç­‰å¾…æœ€ç»ˆæŒ‡ä»¤ã€‚ &lt;font color="blue"&gt;å‡å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚ä¸è€…å‘åè°ƒè€…å‘é€äº†Noå“åº”ï¼Œæˆ–è€…ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œåè°ƒè€…éƒ½æ²¡æœ‰æ¥åˆ°å‚ä¸è€…çš„å“åº”ï¼Œé‚£ä¹ˆå°±æ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚&lt;/font&gt; 1.å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚ã€‚ 2.ä¸­æ–­äº‹åŠ¡ï¼šå‚ä¸è€…æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„abortè¯·æ±‚ä¹‹åï¼ˆæˆ–è¶…æ—¶ä¹‹åï¼Œä»æœªæ”¶åˆ°åè°ƒè€…çš„è¯·æ±‚ï¼‰ï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚ &lt;font color="green"&gt;é˜¶æ®µ3ï¼šdoCommité˜¶æ®µï¼Œæ‰§è¡Œäº‹åŠ¡æäº¤ï¼ˆcommitã€rollbackï¼‰çœŸæ­£çš„æäº¤äº‹åŠ¡æ‰§è¡Œæäº¤&lt;/font&gt; å‘é€æäº¤è¯·æ±‚ï¼šåè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼Œé‚£ä¹ˆä»–å°†ä»é¢„æäº¤çŠ¶æ€è¿›å…¥åˆ°æäº¤çŠ¶æ€ã€‚å¹¶å‘æ‰€æœ‰å‚ä¸è€…å‘é€doCommitè¯·æ±‚ã€‚ äº‹åŠ¡æäº¤ï¼šå‚ä¸è€…æ¥æ”¶åˆ°doCommitè¯·æ±‚ä¹‹åï¼Œæ‰§è¡Œæ­£å¼çš„äº‹åŠ¡æäº¤ã€‚å¹¶åœ¨å®Œæˆäº‹åŠ¡æäº¤ä¹‹åé‡Šæ”¾æ‰€æœ‰äº‹åŠ¡èµ„æºã€‚ å“åº”åé¦ˆï¼šäº‹åŠ¡æäº¤å®Œä¹‹åï¼Œå‘åè°ƒè€…å‘é€Ackå“åº”ã€‚ å®Œæˆäº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„ackå“åº”ä¹‹åï¼Œå®Œæˆäº‹åŠ¡ã€‚ &lt;font color="blue"&gt;ä¸­æ–­äº‹åŠ¡ åè°ƒè€…æ²¡æœ‰æ¥æ”¶åˆ°å‚ä¸è€…å‘é€çš„ACKå“åº”ï¼ˆå¯èƒ½æ˜¯æ¥å—è€…å‘é€çš„ä¸æ˜¯ACKå“åº”ï¼Œä¹Ÿå¯èƒ½å“åº”è¶…æ—¶ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ‰§è¡Œä¸­æ–­äº‹åŠ¡ã€‚&lt;/font&gt; å‘é€ä¸­æ–­è¯·æ±‚ï¼šåè°ƒè€…å‘æ‰€æœ‰å‚ä¸è€…å‘é€abortè¯·æ±‚ã€‚ äº‹åŠ¡å›æ»šï¼šå‚ä¸è€…æ¥æ”¶åˆ°abortè¯·æ±‚ä¹‹åï¼Œåˆ©ç”¨å…¶åœ¨é˜¶æ®µäºŒè®°å½•çš„undoä¿¡æ¯æ¥æ‰§è¡Œäº‹åŠ¡çš„å›æ»šæ“ä½œï¼Œå¹¶åœ¨å®Œæˆå›æ»šä¹‹åé‡Šæ”¾æ‰€æœ‰çš„äº‹åŠ¡èµ„æºã€‚ åé¦ˆç»“æœï¼šå‚ä¸è€…å®Œæˆäº‹åŠ¡å›æ»šä¹‹åï¼Œå‘åè°ƒè€…å‘é€ACKæ¶ˆæ¯ã€‚ ä¸­æ–­äº‹åŠ¡ï¼šåè°ƒè€…æ¥æ”¶åˆ°å‚ä¸è€…åé¦ˆçš„ACKæ¶ˆæ¯ä¹‹åï¼Œæ‰§è¡Œäº‹åŠ¡çš„ä¸­æ–­ã€‚ &lt;p id="div-border-left-red"&gt;åœ¨doCommité˜¶æ®µï¼Œå¦‚æœå‚ä¸è€…æ— æ³•åŠæ—¶æ¥æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„doCommitæˆ–è€…rebortè¯·æ±‚æ—¶ï¼Œä¼šåœ¨ç­‰å¾…è¶…æ—¶ä¹‹åï¼Œä¼šç»§ç»­è¿›è¡Œäº‹åŠ¡çš„æäº¤ã€‚ï¼ˆå…¶å®è¿™ä¸ªåº”è¯¥æ˜¯åŸºäºæ¦‚ç‡æ¥å†³å®šçš„ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œè¯´æ˜å‚ä¸è€…åœ¨ç¬¬äºŒé˜¶æ®µå·²ç»æ”¶åˆ°äº†PreCommitè¯·æ±‚ï¼Œé‚£ä¹ˆåè°ƒè€…äº§ç”ŸPreCommitè¯·æ±‚çš„å‰ææ¡ä»¶æ˜¯ä»–åœ¨ç¬¬äºŒé˜¶æ®µå¼€å§‹ä¹‹å‰ï¼Œæ”¶åˆ°æ‰€æœ‰å‚ä¸è€…çš„CanCommitå“åº”éƒ½æ˜¯Yesã€‚ï¼ˆä¸€æ—¦å‚ä¸è€…æ”¶åˆ°äº†PreCommitï¼Œæ„å‘³ä»–çŸ¥é“å¤§å®¶å…¶å®éƒ½åŒæ„ä¿®æ”¹äº†ï¼‰æ‰€ä»¥ï¼Œä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼Œå½“è¿›å…¥ç¬¬ä¸‰é˜¶æ®µæ—¶ï¼Œç”±äºç½‘ç»œè¶…æ—¶ç­‰åŸå› ï¼Œè™½ç„¶å‚ä¸è€…æ²¡æœ‰æ”¶åˆ°commitæˆ–è€…abortå“åº”ï¼Œä½†æ˜¯ä»–æœ‰ç†ç”±ç›¸ä¿¡ï¼šæˆåŠŸæäº¤çš„å‡ ç‡å¾ˆå¤§ã€‚ï¼‰&lt;/p&gt; 2PCä¸3PCçš„åŒºåˆ« ç›¸å¯¹äº2PCï¼Œ3PCä¸»è¦è§£å†³çš„å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå¹¶å‡å°‘é˜»å¡ï¼Œå› ä¸ºä¸€æ—¦å‚ä¸è€…æ— æ³•åŠæ—¶æ”¶åˆ°æ¥è‡ªåè°ƒè€…çš„ä¿¡æ¯ä¹‹åï¼Œä»–ä¼šé»˜è®¤æ‰§è¡Œcommitã€‚è€Œä¸ä¼šä¸€ç›´æŒæœ‰äº‹åŠ¡èµ„æºå¹¶å¤„äºé˜»å¡çŠ¶æ€ã€‚ä½†æ˜¯è¿™ç§æœºåˆ¶ä¹Ÿä¼šå¯¼è‡´æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå› ä¸ºï¼Œç”±äºç½‘ç»œåŸå› ï¼Œåè°ƒè€…å‘é€çš„abortå“åº”æ²¡æœ‰åŠæ—¶è¢«å‚ä¸è€…æ¥æ”¶åˆ°ï¼Œé‚£ä¹ˆå‚ä¸è€…åœ¨ç­‰å¾…è¶…æ—¶ä¹‹åæ‰§è¡Œäº†commitæ“ä½œã€‚è¿™æ ·å°±å’Œå…¶ä»–æ¥åˆ°abortå‘½ä»¤å¹¶æ‰§è¡Œå›æ»šçš„å‚ä¸è€…ä¹‹é—´å­˜åœ¨æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚ ç›®å‰ä¸¤é˜¶æ®µæäº¤ã€ä¸‰é˜¶æ®µæäº¤å­˜åœ¨å¦‚ä¸‹çš„å±€é™æ€§ï¼Œå¹¶ä¸é€‚åˆåœ¨å¾®æœåŠ¡æ¶æ„ä½“ç³»ä¸‹ä½¿ç”¨ï¼š æ‰€æœ‰çš„æ“ä½œå¿…é¡»æ˜¯äº‹åŠ¡æ€§èµ„æºï¼ˆæ¯”å¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€EJBç»„ä»¶ç­‰ï¼‰ï¼Œå­˜åœ¨ä½¿ç”¨å±€é™æ€§ï¼ˆå¾®æœåŠ¡æ¶æ„ä¸‹å¤šæ•°ä½¿ç”¨HTTPåè®®ï¼‰ï¼Œæ¯”è¾ƒé€‚åˆä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼› ç”±äºæ˜¯å¼ºä¸€è‡´æ€§ï¼Œèµ„æºéœ€è¦åœ¨äº‹åŠ¡å†…éƒ¨ç­‰å¾…ï¼Œæ€§èƒ½å½±å“è¾ƒå¤§ï¼Œååç‡ä¸é«˜ï¼Œä¸é€‚åˆé«˜å¹¶å‘ä¸é«˜æ€§èƒ½çš„ä¸šåŠ¡åœºæ™¯ï¼› TCCäº‹åŠ¡ TCCäº‹åŠ¡æœºåˆ¶ç›¸å¯¹äºä¼ ç»Ÿäº‹åŠ¡æœºåˆ¶ï¼ˆX/Open XAï¼‰ï¼Œå…¶ç‰¹å¾åœ¨äºå®ƒä¸ä¾èµ–èµ„æºç®¡ç†å™¨(RM)å¯¹XAçš„æ”¯æŒï¼Œè€Œæ˜¯é€šè¿‡å¯¹ï¼ˆç”±ä¸šåŠ¡ç³»ç»Ÿæä¾›çš„ï¼‰ä¸šåŠ¡é€»è¾‘çš„è°ƒåº¦æ¥å®ç°åˆ†å¸ƒå¼äº‹åŠ¡ã€‚ è§£å†³äº†XAçš„å‡ ä¸ªç¼ºç‚¹: è§£å†³äº†åè°ƒè€…å•ç‚¹ï¼Œç”±ä¸»ä¸šåŠ¡æ–¹å‘èµ·å¹¶å®Œæˆè¿™ä¸ªä¸šåŠ¡æ´»åŠ¨ã€‚ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨ä¹Ÿå˜æˆå¤šç‚¹ï¼Œå¼•å…¥é›†ç¾¤ã€‚ åŒæ­¥é˜»å¡:å¼•å…¥è¶…æ—¶ï¼Œè¶…æ—¶åè¿›è¡Œè¡¥å¿ï¼Œå¹¶ä¸”ä¸ä¼šé”å®šæ•´ä¸ªèµ„æºï¼Œå°†èµ„æºè½¬æ¢ä¸ºä¸šåŠ¡é€»è¾‘å½¢å¼ï¼Œç²’åº¦å˜å°ã€‚ æ•°æ®ä¸€è‡´æ€§ï¼Œæœ‰äº†è¡¥å¿æœºåˆ¶ä¹‹åï¼Œç”±ä¸šåŠ¡æ´»åŠ¨ç®¡ç†å™¨æ§åˆ¶ä¸€è‡´æ€§ ã€‚ &lt;p id="div-border-left-red"&gt;ä¸€ä¸ªå®Œæ•´çš„TCCä¸šåŠ¡ç”±ä¸€ä¸ªä¸»ä¸šåŠ¡æœåŠ¡å’Œè‹¥å¹²ä¸ªä»ä¸šåŠ¡æœåŠ¡ç»„æˆï¼Œä¸»ä¸šåŠ¡æœåŠ¡å‘èµ·å¹¶å®Œæˆæ•´ä¸ªä¸šåŠ¡æ´»åŠ¨ï¼ŒTCCæ¨¡å¼è¦æ±‚ä»æœåŠ¡æä¾›ä¸‰ä¸ªæ¥å£ï¼šTryã€Confirmã€Cancelã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt;Tryï¼šå®Œæˆæ‰€æœ‰ä¸šåŠ¡æ£€æŸ¥ï¼Œé¢„ç•™å¿…é¡»ä¸šåŠ¡èµ„æºã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt;Confirmï¼šçœŸæ­£æ‰§è¡Œä¸šåŠ¡ï¼Œä¸ä½œä»»ä½•ä¸šåŠ¡æ£€æŸ¥ï¼›åªä½¿ç”¨Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼›Confirmæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt;Cancelï¼šé‡Šæ”¾Tryé˜¶æ®µé¢„ç•™çš„ä¸šåŠ¡èµ„æºï¼›Cancelæ“ä½œæ»¡è¶³å¹‚ç­‰æ€§ã€‚&lt;/p&gt; æ•´ä¸ªTCCä¸šåŠ¡åˆ†æˆä¸¤ä¸ªé˜¶æ®µå®Œæˆï¼š &lt;span id="inline-blue"&gt;ç¬¬ä¸€é˜¶æ®µï¼š&lt;/span&gt; ä¸»ä¸šåŠ¡æœåŠ¡åˆ†åˆ«è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡çš„tryæ“ä½œï¼Œå¹¶åœ¨æ´»åŠ¨ç®¡ç†å™¨ä¸­ç™»è®°æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡ã€‚å½“æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„tryæ“ä½œéƒ½è°ƒç”¨æˆåŠŸæˆ–è€…æŸä¸ªä»ä¸šåŠ¡æœåŠ¡çš„tryæ“ä½œå¤±è´¥ï¼Œè¿›å…¥ç¬¬äºŒé˜¶æ®µã€‚ &lt;span id="inline-blue"&gt;ç¬¬äºŒé˜¶æ®µï¼š&lt;/span&gt; æ´»åŠ¨ç®¡ç†å™¨æ ¹æ®ç¬¬ä¸€é˜¶æ®µçš„æ‰§è¡Œç»“æœæ¥æ‰§è¡Œconfirmæˆ–cancelæ“ä½œã€‚å¦‚æœç¬¬ä¸€é˜¶æ®µæ‰€æœ‰tryæ“ä½œéƒ½æˆåŠŸï¼Œåˆ™æ´»åŠ¨ç®¡ç†å™¨è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡æ´»åŠ¨çš„confirmæ“ä½œã€‚å¦åˆ™è°ƒç”¨æ‰€æœ‰ä»ä¸šåŠ¡æœåŠ¡çš„cancelæ“ä½œã€‚ &lt;span id="inline-purple"&gt;ä¸2PCæ¯”è¾ƒï¼š&lt;/span&gt; ä½äºä¸šåŠ¡æœåŠ¡å±‚è€Œéèµ„æºå±‚ã€‚ æ²¡æœ‰å•ç‹¬çš„å‡†å¤‡ï¼ˆprepareï¼‰é˜¶æ®µï¼ŒTryæ“ä½œå…¼å¤‡èµ„æºæ“ä½œä¸å‡†å¤‡èƒ½åŠ›ã€‚ Tryæ“ä½œå¯ä»¥çµæ´»é€‰æ‹©ä¸šåŠ¡èµ„æºçš„é”å®šç²’åº¦ã€‚ å¼€å‘æˆæœ¬è¾ƒé«˜ã€‚ &lt;span id="inline-green"&gt;ç¼ºç‚¹ï¼š&lt;/span&gt; Canfirmå’ŒCancelçš„å¹‚ç­‰æ€§å¾ˆéš¾ä¿è¯ã€‚ è¿™ç§æ–¹å¼ç¼ºç‚¹æ¯”è¾ƒå¤šï¼Œé€šå¸¸åœ¨å¤æ‚åœºæ™¯ä¸‹æ˜¯ä¸æ¨èä½¿ç”¨çš„ï¼Œé™¤éæ˜¯éå¸¸ç®€å•çš„åœºæ™¯ï¼Œéå¸¸å®¹æ˜“æä¾›å›æ»šCancelï¼Œè€Œä¸”ä¾èµ–çš„æœåŠ¡ä¹Ÿéå¸¸å°‘çš„æƒ…å†µã€‚ è¿™ç§å®ç°æ–¹å¼ä¼šé€ æˆä»£ç é‡åºå¤§ï¼Œè€¦åˆæ€§é«˜ã€‚è€Œä¸”éå¸¸æœ‰å±€é™æ€§ï¼Œå› ä¸ºæœ‰å¾ˆå¤šçš„ä¸šåŠ¡æ˜¯æ— æ³•å¾ˆç®€å•çš„å®ç°å›æ»šçš„ï¼Œå¦‚æœä¸²è¡Œçš„æœåŠ¡å¾ˆå¤šï¼Œå›æ»šçš„æˆæœ¬å®åœ¨å¤ªé«˜ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨ï¼ˆå¼‚æ­¥ç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ï¼‰ æœ¬åœ°æ¶ˆæ¯è¡¨çš„æ–¹æ¡ˆæœ€åˆæ˜¯ç”±ebayæå‡ºï¼Œæ ¸å¿ƒæ€è·¯æ˜¯å°†åˆ†å¸ƒå¼äº‹åŠ¡æ‹†åˆ†æˆæœ¬åœ°äº‹åŠ¡è¿›è¡Œå¤„ç†ã€‚é€šè¿‡åœ¨äº‹åŠ¡ä¸»åŠ¨å‘èµ·æ–¹é¢å¤–æ–°å»ºäº‹åŠ¡æ¶ˆæ¯è¡¨ï¼Œäº‹åŠ¡å‘èµ·æ–¹å¤„ç†ä¸šåŠ¡å’Œè®°å½•äº‹åŠ¡æ¶ˆæ¯åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å®Œæˆï¼Œè½®è¯¢äº‹åŠ¡æ¶ˆæ¯è¡¨çš„æ•°æ®å‘é€äº‹åŠ¡æ¶ˆæ¯ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºæ¶ˆæ¯ä¸­é—´ä»¶æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯è¡¨ä¸­çš„äº‹åŠ¡ã€‚ ç®€å•æ¥è¯´å°±æ˜¯ï¼šæœ¬åœ°æ¶ˆæ¯è¡¨ä¸ä¸šåŠ¡æ•°æ®è¡¨å¤„äºåŒä¸€ä¸ªæ•°æ®åº“ä¸­ï¼Œè¿™æ ·å°±èƒ½åˆ©ç”¨æœ¬åœ°äº‹åŠ¡æ¥ä¿è¯åœ¨å¯¹è¿™ä¸¤ä¸ªè¡¨çš„æ“ä½œæ»¡è¶³äº‹åŠ¡ç‰¹æ€§ï¼Œå¹¶ä¸”ä½¿ç”¨äº†æ¶ˆæ¯é˜Ÿåˆ—æ¥ä¿è¯æœ€ç»ˆä¸€è‡´æ€§ã€‚ å¤„ç†æµç¨‹ æŠŠåˆ†å¸ƒå¼äº‹åŠ¡æœ€å…ˆå¼€å§‹å¤„ç†çš„äº‹åŠ¡æ–¹æˆä¸ºäº‹åŠ¡ä¸»åŠ¨æ–¹ï¼Œåœ¨äº‹åŠ¡ä¸»åŠ¨æ–¹ä¹‹åå¤„ç†çš„ä¸šåŠ¡å†…çš„å…¶ä»–äº‹åŠ¡æˆä¸ºäº‹åŠ¡è¢«åŠ¨æ–¹ã€‚æµç¨‹å¦‚ä¸‹å›¾ï¼š äº‹åŠ¡ä¸»åŠ¨æ–¹å¤„ç†æœ¬åœ°äº‹åŠ¡ã€‚ äº‹åŠ¡ä¸»åŠ¨å‘åœ¨æœ¬åœ°äº‹åŠ¡ä¸­å¤„ç†ä¸šåŠ¡æ›´æ–°æ“ä½œå’Œå†™æ¶ˆæ¯è¡¨æ“ä½œã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­æ“ä½œ1ã€2ï¼‰ äº‹åŠ¡ä¸»åŠ¨æ–¹é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å¤„ç†äº‹åŠ¡é€šçŸ¥äº‹åŠ¡å¾…æ¶ˆæ¯ã€‚ æ¶ˆæ¯ä¸­é—´ä»¶å¯ä»¥åŸºäºKafkaã€RocketMQæ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹æ³•ä¸»åŠ¨å†™æ¶ˆæ¯åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œäº‹åŠ¡æ¶ˆè´¹æ–¹æ¶ˆè´¹å¹¶å¤„ç†æ¶ˆæ¯é˜Ÿåˆ—ä¸­çš„æ¶ˆæ¯ã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­æ“ä½œ3ã€4ã€5ï¼‰ äº‹åŠ¡è¢«åŠ¨æ–¹é€šè¿‡æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œé€šçŸ¥äº‹åŠ¡ä¸»åŠ¨æ–¹äº‹åŠ¡å·²å¤„ç†çš„æ¶ˆæ¯ã€‚ï¼ˆå¦‚ä¸Šå›¾ä¸­6ã€7ã€8ï¼‰ ä¸ºäº†æ•°æ®çš„ä¸€è‡´æ€§ï¼Œå½“å¤„ç†é”™è¯¯éœ€è¦é‡è¯•ï¼Œäº‹åŠ¡å‘é€æ–¹å’Œäº‹åŠ¡æ¥æ”¶æ–¹ç›¸å…³ä¸šåŠ¡å¤„ç†éœ€è¦æ”¯æŒå¹‚ç­‰ã€‚å…·ä½“ä¿å­˜ä¸€è‡´æ€§çš„å®¹é”™å¤„ç†å¦‚ä¸‹ï¼š 1ã€å½“æ­¥éª¤1å¤„ç†å‡ºé”™ï¼Œäº‹åŠ¡å›æ»šï¼Œç›¸å½“äºä»€ä¹ˆéƒ½æ²¡å‘ç”Ÿã€‚ 2ã€å½“æ­¥éª¤2ã€æ­¥éª¤3å¤„ç†å‡ºé”™ï¼Œç”±äºæœªå¤„ç†çš„äº‹åŠ¡æ¶ˆæ¯è¿˜æ˜¯ä¿å­˜åœ¨äº‹åŠ¡å‘é€æ–¹ï¼Œäº‹åŠ¡å‘é€æ–¹å¯ä»¥å®šæ—¶è½®è¯¢ä¸ºè¶…æ—¶æ¶ˆæ¯æ•°æ®ï¼Œå†æ¬¡å‘é€çš„æ¶ˆæ¯ä¸­é—´ä»¶è¿›è¡Œå¤„ç†ã€‚äº‹åŠ¡è¢«åŠ¨æ–¹æ¶ˆè´¹äº‹åŠ¡æ¶ˆæ¯é‡è¯•å¤„ç†ã€‚ 3ã€å¦‚æœæ˜¯ä¸šåŠ¡ä¸Šçš„å¤±è´¥ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹å¯ä»¥å‘æ¶ˆæ¯ç»™äº‹åŠ¡ä¸»åŠ¨æ–¹è¿›è¡Œå›æ»šã€‚ 4ã€å¦‚æœå¤šä¸ªäº‹åŠ¡è¢«åŠ¨æ–¹å·²ç»æ¶ˆè´¹æ¶ˆæ¯ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹éœ€è¦å›æ»šäº‹åŠ¡æ—¶éœ€è¦é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å›æ»šã€‚ ä¼˜ç‚¹ ä»åº”ç”¨è®¾è®¡å¼€å‘çš„è§’åº¦å®ç°äº†æ¶ˆæ¯æ•°æ®çš„å¯é æ€§ï¼Œæ¶ˆæ¯æ•°æ®çš„å¯é æ€§ä¸ä¾èµ–äºæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå¼±åŒ–äº†å¯¹MQä¸­é—´ä»¶ç‰¹æ€§çš„ä¾èµ–ã€‚ æ–¹æ¡ˆè½»é‡ï¼Œå®¹æ˜“å®ç°ã€‚ ç¼ºç‚¹ ä¸å…·ä½“çš„ä¸šåŠ¡åœºæ™¯ç»‘å®šï¼Œè€¦åˆæ€§å¼ºï¼Œä¸å¯å…¬ç”¨ã€‚ æ¶ˆæ¯æ•°æ®ä¸ä¸šåŠ¡æ•°æ®åŒåº“ï¼Œå ç”¨ä¸šåŠ¡ç³»ç»Ÿèµ„æºã€‚ ä¸šåŠ¡ç³»ç»Ÿåœ¨ä½¿ç”¨å…³ç³»å‹æ•°æ®åº“çš„æƒ…å†µä¸‹ï¼Œæ¶ˆæ¯æœåŠ¡æ€§èƒ½ä¼šå—åˆ°å…³ç³»å‹æ•°æ®åº“å¹¶å‘æ€§èƒ½çš„å±€é™ã€‚ ç»“åˆMQå®ç°çš„å¯é æ¶ˆæ¯æœ€ç»ˆä¸€è‡´æ€§ åŸºäºMQçš„åˆ†å¸ƒå¼äº‹åŠ¡æ–¹æ¡ˆå…¶å®æ˜¯å¯¹æœ¬åœ°æ¶ˆæ¯è¡¨çš„å°è£…ï¼Œå°†æœ¬åœ°æ¶ˆæ¯è¡¨åŸºäºMQ å†…éƒ¨ï¼Œå…¶ä»–æ–¹é¢çš„åè®®åŸºæœ¬ä¸æœ¬åœ°æ¶ˆæ¯è¡¨ä¸€è‡´ã€‚ å¤„ç†æµç¨‹ ä»¥é˜¿é‡Œçš„ RocketMQ ä¸­é—´ä»¶ä¸ºä¾‹ï¼Œåœ¨æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆä¸­ï¼Œä¿è¯äº‹åŠ¡ä¸»åŠ¨æ–¹å‘å†™ä¸šåŠ¡è¡¨æ•°æ®å’Œå†™æ¶ˆæ¯è¡¨æ•°æ®çš„ä¸€è‡´æ€§æ˜¯åŸºäºæ•°æ®åº“äº‹åŠ¡ï¼ŒRocketMQçš„äº‹åŠ¡æ¶ˆæ¯ç›¸å¯¹äºæ™®é€šMQï¼Œç›¸å¯¹äºæä¾›äº†2PCçš„æäº¤æ¥å£ï¼Œæ–¹æ¡ˆå¦‚ä¸‹ï¼š &lt;span id="inline-blue"&gt;æ­£å¸¸æƒ…å†µâ€”â€”äº‹åŠ¡ä¸»åŠ¨æ–¹å‘æ¶ˆæ¯&lt;/span&gt; è¿™ç§æƒ…å†µä¸‹ï¼Œäº‹åŠ¡ä¸»åŠ¨æ–¹æœåŠ¡æ­£å¸¸ï¼Œæ²¡æœ‰å‘ç”Ÿæ•…éšœï¼Œå‘æ¶ˆæ¯æµç¨‹å¦‚ä¸‹ï¼š 1ã€å‘é€æ–¹å‘ MQæœåŠ¡ç«¯(MQ Server)å‘é€halfæ¶ˆæ¯ã€‚ 2ã€MQ Server å°†æ¶ˆæ¯æŒä¹…åŒ–æˆåŠŸä¹‹åï¼Œå‘å‘é€æ–¹ ACK ç¡®è®¤æ¶ˆæ¯å·²ç»å‘é€æˆåŠŸã€‚ 3ã€å‘é€æ–¹å¼€å§‹æ‰§è¡Œæœ¬åœ°äº‹åŠ¡é€»è¾‘ã€‚ 4ã€å‘é€æ–¹æ ¹æ®æœ¬åœ°äº‹åŠ¡æ‰§è¡Œç»“æœå‘ MQ Server æäº¤äºŒæ¬¡ç¡®è®¤ï¼ˆcommit æˆ–æ˜¯ rollbackï¼‰ã€‚ 5ã€MQ Server æ”¶åˆ° commit çŠ¶æ€åˆ™å°†åŠæ¶ˆæ¯æ ‡è®°ä¸ºå¯æŠ•é€’ï¼Œè®¢é˜…æ–¹æœ€ç»ˆå°†æ”¶åˆ°è¯¥æ¶ˆæ¯ï¼›MQ Server æ”¶åˆ° rollback çŠ¶æ€åˆ™åˆ é™¤åŠæ¶ˆæ¯ï¼Œè®¢é˜…æ–¹å°†ä¸ä¼šæ¥å—è¯¥æ¶ˆæ¯ã€‚ &lt;span id="inline-blue"&gt;å¼‚å¸¸æƒ…å†µâ€”â€”äº‹åŠ¡ä¸»åŠ¨æ–¹æ¶ˆæ¯æ¢å¤&lt;/span&gt; åœ¨æ–­ç½‘æˆ–è€…åº”ç”¨é‡å¯ç­‰å¼‚å¸¸æƒ…å†µä¸‹ï¼Œå‘é€æ–¹æäº¤çš„äºŒæ¬¡ç¡®è®¤è¶…æ—¶æœªåˆ°è¾¾ MQ Serverï¼Œæ­¤æ—¶å¤„ç†é€»è¾‘å¦‚ä¸‹ï¼š 5ã€MQ Server å¯¹è¯¥æ¶ˆæ¯å‘èµ·æ¶ˆæ¯å›æŸ¥ã€‚ 6ã€å‘é€æ–¹æ”¶åˆ°æ¶ˆæ¯å›æŸ¥åï¼Œéœ€è¦æ£€æŸ¥å¯¹åº”æ¶ˆæ¯çš„æœ¬åœ°äº‹åŠ¡æ‰§è¡Œçš„æœ€ç»ˆç»“æœã€‚ 7ã€å‘é€æ–¹æ ¹æ®æ£€æŸ¥å¾—åˆ°çš„æœ¬åœ°äº‹åŠ¡çš„æœ€ç»ˆçŠ¶æ€å†æ¬¡æäº¤äºŒæ¬¡ç¡®è®¤ã€‚ 8ã€MQ ServeråŸºäºcommit / rollback å¯¹æ¶ˆæ¯è¿›è¡ŒæŠ•é€’æˆ–è€…åˆ é™¤ã€‚ MQåˆ†å¸ƒå¼äº‹åŠ¡ äº‹åŠ¡ä¸»åŠ¨æ–¹åŸºäºMQé€šä¿¡é€šçŸ¥äº‹åŠ¡è¢«åŠ¨æ–¹å¤„ç†äº‹åŠ¡ï¼Œäº‹åŠ¡è¢«åŠ¨æ–¹åŸºäºMQè¿”å›å¤„ç†ç»“æœã€‚ å¦‚æœäº‹åŠ¡è¢«åŠ¨æ–¹æ¶ˆè´¹æ¶ˆæ¯å¼‚å¸¸ï¼Œéœ€è¦ä¸æ–­é‡è¯•ï¼Œä¸šåŠ¡å¤„ç†é€»è¾‘éœ€è¦ä¿è¯å¹‚ç­‰ã€‚ å¦‚æœæ˜¯äº‹åŠ¡è¢«åŠ¨æ–¹ä¸šåŠ¡ä¸Šçš„å¤„ç†å¤±è´¥ï¼Œå¯ä»¥é€šè¿‡MQé€šçŸ¥äº‹åŠ¡ä¸»åŠ¨æ–¹è¿›è¡Œè¡¥å¿æˆ–è€…äº‹åŠ¡å›æ»šã€‚ ä¼˜ç‚¹ æ¶ˆæ¯æ•°æ®ç‹¬ç«‹å­˜å‚¨ ï¼Œé™ä½ä¸šåŠ¡ç³»ç»Ÿä¸æ¶ˆæ¯ç³»ç»Ÿä¹‹é—´çš„è€¦åˆã€‚ ååé‡ç”±äºä½¿ç”¨æœ¬åœ°æ¶ˆæ¯è¡¨æ–¹æ¡ˆã€‚ ç¼ºç‚¹ ä¸€æ¬¡æ¶ˆæ¯å‘é€éœ€è¦ä¸¤æ¬¡ç½‘ç»œè¯·æ±‚(halfæ¶ˆæ¯ã€commit/rollbackæ¶ˆæ¯)ã€‚ ä¸šåŠ¡å¤„ç†æœåŠ¡éœ€è¦å®ç°æ¶ˆæ¯çŠ¶æ€å›æŸ¥æ¥å£ã€‚ å°½æœ€å¤§åŠªåŠ›é€šçŸ¥ è¿™ç§æ–¹æ¡ˆä¸»è¦ç”¨åœ¨ä¸ç¬¬ä¸‰æ–¹ç³»ç»Ÿé€šè®¯æ—¶ï¼Œæ¯”å¦‚ï¼šè°ƒç”¨å¾®ä¿¡æˆ–æ”¯ä»˜å®æ”¯ä»˜åçš„æ”¯ä»˜ç»“æœé€šçŸ¥ã€‚è¿™ç§æ–¹æ¡ˆä¹Ÿæ˜¯ç»“åˆMQè¿›è¡Œå®ç°ï¼Œä¾‹å¦‚ï¼šé€šè¿‡MQå‘é€httpè¯·æ±‚ï¼Œè®¾ç½®æœ€å¤§é€šçŸ¥æ¬¡æ•°ã€‚è¾¾åˆ°é€šçŸ¥æ¬¡æ•°åå³ä¸å†é€šçŸ¥ã€‚ å¤„ç†æµç¨‹ ä¸šåŠ¡æ´»åŠ¨çš„ä¸»åŠ¨æ–¹ï¼Œåœ¨å®Œæˆä¸šåŠ¡å¤„ç†ä¹‹åï¼Œå‘ä¸šåŠ¡æ´»åŠ¨çš„è¢«åŠ¨æ–¹å‘é€æ¶ˆæ¯ï¼Œå…è®¸æ¶ˆæ¯ä¸¢å¤±ã€‚ ä¸»åŠ¨æ–¹å¯ä»¥è®¾ç½®æ—¶é—´é˜¶æ¢¯å‹é€šçŸ¥è§„åˆ™ï¼Œåœ¨é€šçŸ¥å¤±è´¥åæŒ‰è§„åˆ™é‡å¤é€šçŸ¥ï¼Œç›´åˆ°é€šçŸ¥Næ¬¡åä¸å†é€šçŸ¥ã€‚ ä¸»åŠ¨æ–¹æä¾›æ ¡å¯¹æŸ¥è¯¢æ¥å£ç»™è¢«åŠ¨æ–¹æŒ‰éœ€æ ¡å¯¹æŸ¥è¯¢ï¼Œç”¨äºæ¢å¤ä¸¢å¤±çš„ä¸šåŠ¡æ¶ˆæ¯ã€‚ ä¸šåŠ¡æ´»åŠ¨çš„è¢«åŠ¨æ–¹å¦‚æœæ­£å¸¸æ¥æ”¶äº†æ•°æ®ï¼Œå°±æ­£å¸¸è¿”å›å“åº”ï¼Œå¹¶ç»“æŸäº‹åŠ¡ã€‚ å¦‚æœè¢«åŠ¨æ–¹æ²¡æœ‰æ­£å¸¸æ¥æ”¶ï¼Œæ ¹æ®å®šæ—¶ç­–ç•¥ï¼Œå‘ä¸šåŠ¡æ´»åŠ¨ä¸»åŠ¨æ–¹æŸ¥è¯¢ï¼Œæ¢å¤ä¸¢å¤±çš„ä¸šåŠ¡æ¶ˆæ¯ æ–¹æ¡ˆç‰¹ç‚¹ ç”¨åˆ°çš„æœåŠ¡æ¨¡å¼ï¼šå¯æŸ¥è¯¢æ“ä½œã€å¹‚ç­‰æ“ä½œã€‚ è¢«åŠ¨æ–¹çš„å¤„ç†ç»“æœä¸å½±å“ä¸»åŠ¨æ–¹çš„å¤„ç†ç»“æœï¼› é€‚ç”¨äºå¯¹ä¸šåŠ¡æœ€ç»ˆä¸€è‡´æ€§çš„æ—¶é—´æ•æ„Ÿåº¦ä½çš„ç³»ç»Ÿï¼› é€‚åˆè·¨ä¼ä¸šçš„ç³»ç»Ÿé—´çš„æ“ä½œï¼Œæˆ–è€…ä¼ä¸šå†…éƒ¨æ¯”è¾ƒç‹¬ç«‹çš„ç³»ç»Ÿé—´çš„æ“ä½œï¼Œæ¯”å¦‚é“¶è¡Œé€šçŸ¥ã€å•†æˆ·é€šçŸ¥ç­‰ï¼› Sagaäº‹åŠ¡â€”â€”æœ€ç»ˆä¸€è‡´æ€§ ç®€ä»‹ Sagaäº‹åŠ¡æºäº1987å¹´æ™®æ—æ–¯é¡¿å¤§å­¦çš„Hectoå’ŒKennethå‘è¡¨çš„å¦‚ä½•å¤„ç†long lived transactionï¼ˆé•¿æ´»äº‹åŠ¡ï¼‰è®ºæ–‡ï¼ŒSagaäº‹åŠ¡æ ¸å¿ƒæ€æƒ³æ˜¯å°†é•¿äº‹åŠ¡æ‹†åˆ†ä¸ºå¤šä¸ªæœ¬åœ°çŸ­äº‹åŠ¡ï¼Œç”±Sagaäº‹åŠ¡åè°ƒå™¨åè°ƒï¼Œå¦‚æœæ­£å¸¸ç»“æŸé‚£å°±æ­£å¸¸å®Œæˆï¼Œå¦‚æœæŸä¸ªæ­¥éª¤å¤±è´¥ï¼Œåˆ™æ ¹æ®ç›¸åé¡ºåºä¸€æ¬¡è°ƒç”¨è¡¥å¿æ“ä½œã€‚ Sagaäº‹åŠ¡åŸºæœ¬åè®® æ¯ä¸ªSagaäº‹åŠ¡ç”±ä¸€ç³»åˆ—å¹‚ç­‰çš„æœ‰åºå­äº‹åŠ¡(sub-transaction) Ti ç»„æˆã€‚ æ¯ä¸ªTi éƒ½æœ‰å¯¹åº”çš„å¹‚ç­‰è¡¥å¿åŠ¨ä½œCiï¼Œè¡¥å¿åŠ¨ä½œç”¨äºæ’¤é”€Tié€ æˆçš„ç»“æœã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå’ŒTCCç›¸æ¯”ï¼ŒSagaæ²¡æœ‰â€œé¢„ç•™â€åŠ¨ä½œï¼Œå®ƒçš„Tiå°±æ˜¯ç›´æ¥æäº¤åˆ°åº“ã€‚ Sagaäº‹åŠ¡æ‰§è¡Œé¡ºåº ä¸‹é¢ä»¥ä¸‹å•æµç¨‹ä¸ºä¾‹ï¼Œæ•´ä¸ªæ“ä½œåŒ…æ‹¬ï¼šåˆ›å»ºè®¢å•ã€æ‰£å‡åº“å­˜ã€æ”¯ä»˜ã€å¢åŠ ç§¯åˆ† Sagaçš„æ‰§è¡Œé¡ºåºæœ‰ä¸¤ç§ï¼š &lt;span id="inline-blue"&gt;äº‹åŠ¡æ­£å¸¸æ‰§è¡Œå®Œæˆ&lt;/span&gt; &lt;p id="div-border-left-red"&gt;T1, T2, T3, ..., Tnï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜(T1)ï¼Œåˆ›å»ºè®¢å•(T2)ï¼Œæ”¯ä»˜(T3)ï¼Œä¾æ¬¡æœ‰åºå®Œæˆæ•´ä¸ªäº‹åŠ¡ã€‚&lt;/p&gt; &lt;span id="inline-blue"&gt;äº‹åŠ¡å›æ»š&lt;/span&gt; &lt;p id="div-border-left-red"&gt;T1, T2, ..., Tj, Cj,..., C2, C1ï¼Œå…¶ä¸­0 &lt; j &lt; nï¼Œä¾‹å¦‚ï¼šæ‰£å‡åº“å­˜(T1)ï¼Œåˆ›å»ºè®¢å•(T2)ï¼Œæ”¯ä»˜(T3ï¼Œæ”¯ä»˜å¤±è´¥)ï¼Œæ”¯ä»˜å›æ»š(C3)ï¼Œè®¢å•å›æ»š(C2)ï¼Œæ¢å¤åº“å­˜(C1)ã€‚&lt;/p&gt; Sagaæ¢å¤ç­–ç•¥ï¼š å‘å‰æ¢å¤(forward recovery) å¯¹åº”äºä¸Šé¢ç¬¬ä¸€ç§æ‰§è¡Œé¡ºåºï¼Œé€‚ç”¨äºå¿…é¡»è¦æˆåŠŸçš„åœºæ™¯ï¼Œå‘ç”Ÿå¤±è´¥è¿›è¡Œé‡è¯•ï¼Œæ‰§è¡Œé¡ºåºæ˜¯ç±»ä¼¼äºè¿™æ ·çš„ï¼šT1, T2, ..., Tj(å¤±è´¥), Tj(é‡è¯•),..., Tnï¼Œå…¶ä¸­jæ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡(sub-transaction)ã€‚è¯¥æƒ…å†µä¸‹ä¸éœ€è¦Ciã€‚ å‘åæ¢å¤(backward recovery) å¯¹åº”äºä¸Šé¢æåˆ°çš„ç¬¬äºŒç§æ‰§è¡Œé¡ºåºï¼Œå…¶ä¸­jæ˜¯å‘ç”Ÿé”™è¯¯çš„å­äº‹åŠ¡(sub-transaction)ï¼Œè¿™ç§åšæ³•çš„æ•ˆæœæ˜¯æ’¤é”€æ‰ä¹‹å‰æ‰€æœ‰æˆåŠŸçš„å­äº‹åŠ¡ï¼Œä½¿å¾—æ•´ä¸ªSagaçš„æ‰§è¡Œç»“æœæ’¤é”€ã€‚ Sagaäº‹åŠ¡å®ç°æ–¹å¼ 1ã€å‘½ä»¤åè°ƒ(Order Orchestrator)ï¼šä¸­å¤®åè°ƒå™¨è´Ÿè´£é›†ä¸­å¤„ç†äº‹ä»¶çš„å†³ç­–å’Œä¸šåŠ¡é€»è¾‘æ’åºã€‚ ä¸­å¤®åè°ƒå™¨ï¼ˆOrchestratorï¼Œç®€ç§°OSOï¼‰ä»¥å‘½ä»¤/å›å¤çš„æ–¹å¼ä¸æ¯é¡¹æœåŠ¡è¿›è¡Œé€šä¿¡ï¼Œå…¨æƒè´Ÿè´£å‘Šè¯‰æ¯ä¸ªå‚ä¸è€…è¯¥åšä»€ä¹ˆä»¥åŠä»€ä¹ˆæ—¶å€™è¯¥åšä»€ä¹ˆã€‚ ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š 1ã€äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘è¯·æ±‚OSOæœåŠ¡å¼€å¯è®¢å•äº‹åŠ¡ã€‚ 2ã€OSOå‘åº“å­˜æœåŠ¡è¯·æ±‚æ‰£å‡åº“å­˜ï¼Œåº“å­˜æœåŠ¡å›å¤å¤„ç†ç»“æœã€‚ 3ã€OSOå‘è®¢å•æœåŠ¡è¯·æ±‚åˆ›å»ºè®¢å•ï¼Œè®¢å•æœåŠ¡å›å¤åˆ›å»ºç»“æœã€‚ 4ã€OSOå‘æ”¯ä»˜æœåŠ¡è¯·æ±‚æ”¯ä»˜ï¼Œæ”¯ä»˜æœåŠ¡å›å¤å¤„ç†ç»“æœã€‚ 5ã€ä¸»ä¸šåŠ¡é€»è¾‘æ¥æ”¶å¹¶å¤„ç†OSOäº‹åŠ¡å¤„ç†ç»“æœå›å¤ã€‚ ä¸­å¤®åè°ƒå™¨å¿…é¡»äº‹å…ˆçŸ¥é“æ‰§è¡Œæ•´ä¸ªè®¢å•äº‹åŠ¡æ‰€éœ€çš„æµç¨‹(ä¾‹å¦‚é€šè¿‡è¯»å–é…ç½®)ã€‚å¦‚æœæœ‰ä»»ä½•å¤±è´¥ï¼Œå®ƒè¿˜è´Ÿè´£é€šè¿‡å‘æ¯ä¸ªå‚ä¸è€…å‘é€å‘½ä»¤æ¥æ’¤é”€ä¹‹å‰çš„æ“ä½œæ¥åè°ƒåˆ†å¸ƒå¼çš„å›æ»šã€‚åŸºäºä¸­å¤®åè°ƒå™¨åè°ƒä¸€åˆ‡æ—¶ï¼Œå›æ»šè¦å®¹æ˜“å¾—å¤šï¼Œå› ä¸ºåè°ƒå™¨é»˜è®¤æ˜¯æ‰§è¡Œæ­£å‘æµç¨‹ï¼Œå›æ»šæ—¶åªè¦æ‰§è¡Œåå‘æµç¨‹å³å¯ã€‚ 2ã€äº‹ä»¶ç¼–æ’ (Event Choreography0ï¼šæ²¡æœ‰ä¸­å¤®åè°ƒå™¨ï¼ˆæ²¡æœ‰å•ç‚¹é£é™©ï¼‰æ—¶ï¼Œæ¯ä¸ªæœåŠ¡äº§ç”Ÿå¹¶è§‚å¯Ÿå…¶ä»–æœåŠ¡çš„äº‹ä»¶ï¼Œå¹¶å†³å®šæ˜¯å¦åº”é‡‡å–è¡ŒåŠ¨ã€‚ åœ¨äº‹ä»¶ç¼–æ’æ–¹æ³•ä¸­ï¼Œç¬¬ä¸€ä¸ªæœåŠ¡æ‰§è¡Œä¸€ä¸ªäº‹åŠ¡ï¼Œç„¶åå‘å¸ƒä¸€ä¸ªäº‹ä»¶ã€‚è¯¥äº‹ä»¶è¢«ä¸€ä¸ªæˆ–å¤šä¸ªæœåŠ¡è¿›è¡Œç›‘å¬ï¼Œè¿™äº›æœåŠ¡å†æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶å‘å¸ƒï¼ˆæˆ–ä¸å‘å¸ƒï¼‰æ–°çš„äº‹ä»¶ã€‚ å½“æœ€åä¸€ä¸ªæœåŠ¡æ‰§è¡Œæœ¬åœ°äº‹åŠ¡å¹¶ä¸”ä¸å‘å¸ƒä»»ä½•äº‹ä»¶æ—¶ï¼Œæ„å‘³ç€åˆ†å¸ƒå¼äº‹åŠ¡ç»“æŸï¼Œæˆ–è€…å®ƒå‘å¸ƒçš„äº‹ä»¶æ²¡æœ‰è¢«ä»»ä½•Sagaå‚ä¸è€…å¬åˆ°éƒ½æ„å‘³ç€äº‹åŠ¡ç»“æŸã€‚ ä»¥ç”µå•†è®¢å•çš„ä¾‹å­ä¸ºä¾‹ï¼š 1ã€äº‹åŠ¡å‘èµ·æ–¹çš„ä¸»ä¸šåŠ¡é€»è¾‘å‘å¸ƒå¼€å§‹è®¢å•äº‹ä»¶ã€‚ 2ã€åº“å­˜æœåŠ¡ç›‘å¬å¼€å§‹è®¢å•äº‹ä»¶ï¼Œæ‰£å‡åº“å­˜ï¼Œå¹¶å‘å¸ƒåº“å­˜å·²æ‰£å‡äº‹ä»¶ã€‚ 3ã€è®¢å•æœåŠ¡ç›‘å¬åº“å­˜å·²æ‰£å‡äº‹ä»¶ï¼Œåˆ›å»ºè®¢å•ï¼Œå¹¶å‘å¸ƒè®¢å•å·²åˆ›å»ºäº‹ä»¶ã€‚ 4ã€æ”¯ä»˜æœåŠ¡ç›‘å¬è®¢å•å·²åˆ›å»ºäº‹ä»¶ï¼Œè¿›è¡Œæ”¯ä»˜ï¼Œå¹¶å‘å¸ƒè®¢å•å·²æ”¯ä»˜äº‹ä»¶ã€‚ 5ã€ä¸»ä¸šåŠ¡é€»è¾‘ç›‘å¬è®¢å•å·²æ”¯ä»˜äº‹ä»¶å¹¶å¤„ç†ã€‚ äº‹ä»¶/ç¼–æ’æ˜¯å®ç°Sagaæ¨¡å¼çš„è‡ªç„¶æ–¹å¼ï¼Œå®ƒå¾ˆç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œä¸éœ€è¦å¤ªå¤šçš„ä»£ç æ¥æ„å»ºã€‚å¦‚æœäº‹åŠ¡æ¶‰åŠ2è‡³4ä¸ªæ­¥éª¤ï¼Œåˆ™å¯èƒ½æ˜¯éå¸¸åˆé€‚çš„ã€‚ å‘½ä»¤åè°ƒè®¾è®¡çš„ä¼˜ç‚¹ 1ã€æœåŠ¡ä¹‹é—´å…³ç³»ç®€å•ï¼Œé¿å…æœåŠ¡ä¹‹é—´çš„å¾ªç¯ä¾èµ–å…³ç³»ï¼Œå› ä¸ºSagaåè°ƒå™¨ä¼šè°ƒç”¨Sagaå‚ä¸è€…ï¼Œä½†å‚ä¸è€…ä¸ä¼šè°ƒç”¨åè°ƒå™¨ 2ã€ç¨‹åºå¼€å‘ç®€å•ï¼Œåªéœ€è¦æ‰§è¡Œå‘½ä»¤/å›å¤(å…¶å®å›å¤æ¶ˆæ¯ä¹Ÿæ˜¯ä¸€ç§äº‹ä»¶æ¶ˆæ¯)ï¼Œé™ä½å‚ä¸è€…çš„å¤æ‚æ€§ã€‚ 3ã€æ˜“ç»´æŠ¤æ‰©å±•ï¼Œåœ¨æ·»åŠ æ–°æ­¥éª¤æ—¶ï¼Œäº‹åŠ¡å¤æ‚æ€§ä¿æŒçº¿æ€§ï¼Œå›æ»šæ›´å®¹æ˜“ç®¡ç†ï¼Œæ›´å®¹æ˜“å®æ–½å’Œæµ‹è¯• å‘½ä»¤åè°ƒè®¾è®¡çš„ç¼ºç‚¹ 1ã€ä¸­å¤®åè°ƒå™¨å®¹æ˜“å¤„ç†é€»è¾‘å®¹æ˜“è¿‡äºå¤æ‚ï¼Œå¯¼è‡´éš¾ä»¥ç»´æŠ¤ã€‚ 2ã€å­˜åœ¨åè°ƒå™¨å•ç‚¹æ•…éšœé£é™©ã€‚ äº‹ä»¶/ç¼–æ’è®¾è®¡çš„ä¼˜ç‚¹ 1ã€é¿å…ä¸­å¤®åè°ƒå™¨å•ç‚¹æ•…éšœé£é™©ã€‚ 2ã€å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå°‘æœåŠ¡å¼€å‘ç®€å•ï¼Œå®¹æ˜“å®ç°ã€‚ äº‹ä»¶/ç¼–æ’è®¾è®¡çš„ç¼ºç‚¹ 1ã€æœåŠ¡ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–çš„é£é™©ã€‚ 2ã€å½“æ¶‰åŠçš„æ­¥éª¤è¾ƒå¤šï¼ŒæœåŠ¡é—´å…³ç³»æ··ä¹±ï¼Œéš¾ä»¥è¿½è¸ªè°ƒæµ‹ã€‚ å€¼å¾—è¡¥å……çš„æ˜¯ï¼Œç”±äºSagaæ¨¡å‹ä¸­æ²¡æœ‰Prepareé˜¶æ®µï¼Œå› æ­¤äº‹åŠ¡é—´ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œå½“å¤šä¸ªSagaäº‹åŠ¡æ“ä½œåŒä¸€èµ„æºæ—¶ï¼Œå°±ä¼šäº§ç”Ÿæ›´æ–°ä¸¢å¤±ã€è„æ•°æ®è¯»å–ç­‰é—®é¢˜ï¼Œè¿™æ—¶éœ€è¦åœ¨ä¸šåŠ¡å±‚æ§åˆ¶å¹¶å‘ï¼Œä¾‹å¦‚ï¼šåœ¨åº”ç”¨å±‚é¢åŠ é”ï¼Œæˆ–è€…åº”ç”¨å±‚é¢é¢„å…ˆå†»ç»“èµ„æºã€‚ åˆ†å¸ƒå¼äº‹åŠ¡è§£å†³æ–¹æ¡ˆæ¯”è¾ƒ 2PC/3PC ä¾èµ–äºæ•°æ®åº“ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„æä¾›å¼ºä¸€è‡´æ€§å’Œå¼ºäº‹åŠ¡æ€§ï¼Œä½†ç›¸å¯¹æ¥è¯´å»¶è¿Ÿæ¯”è¾ƒé«˜ï¼Œæ¯”è¾ƒé€‚åˆä¼ ç»Ÿçš„å•ä½“åº”ç”¨ï¼Œåœ¨åŒä¸€ä¸ªæ–¹æ³•ä¸­å­˜åœ¨è·¨åº“æ“ä½œçš„æƒ…å†µï¼Œä¸é€‚åˆé«˜å¹¶å‘å’Œé«˜æ€§èƒ½è¦æ±‚çš„åœºæ™¯ã€‚ TCC é€‚ç”¨äºæ‰§è¡Œæ—¶é—´ç¡®å®šä¸”è¾ƒçŸ­ï¼Œå®æ—¶æ€§è¦æ±‚é«˜ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§è¦æ±‚é«˜ï¼Œæ¯”å¦‚äº’è”ç½‘é‡‘èä¼ä¸šæœ€æ ¸å¿ƒçš„ä¸‰ä¸ªæœåŠ¡ï¼šäº¤æ˜“ã€æ”¯ä»˜ã€è´¦åŠ¡ã€‚ æœ¬åœ°æ¶ˆæ¯è¡¨/MQäº‹åŠ¡ éƒ½é€‚ç”¨äºäº‹åŠ¡ä¸­å‚ä¸æ–¹æ”¯æŒæ“ä½œå¹‚ç­‰ï¼Œå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜ï¼Œä¸šåŠ¡ä¸Šèƒ½å®¹å¿æ•°æ®ä¸ä¸€è‡´åˆ°ä¸€ä¸ªäººå·¥æ£€æŸ¥å‘¨æœŸï¼Œäº‹åŠ¡æ¶‰åŠçš„å‚ä¸æ–¹ã€å‚ä¸ç¯èŠ‚è¾ƒå°‘ï¼Œä¸šåŠ¡ä¸Šæœ‰å¯¹è´¦/æ ¡éªŒç³»ç»Ÿå…œåº•ã€‚ Sagaäº‹åŠ¡ ç”±äºSagaäº‹åŠ¡ä¸èƒ½ä¿è¯éš”ç¦»æ€§ï¼Œéœ€è¦åœ¨ä¸šåŠ¡å±‚æ§åˆ¶å¹¶å‘ï¼Œé€‚åˆäºä¸šåŠ¡åœºæ™¯äº‹åŠ¡å¹¶å‘æ“ä½œåŒä¸€èµ„æºè¾ƒå°‘çš„æƒ…å†µã€‚ Sagaç›¸æ¯”ç¼ºå°‘é¢„æäº¤åŠ¨ä½œï¼Œå¯¼è‡´è¡¥å¿åŠ¨ä½œçš„å®ç°æ¯”è¾ƒéº»çƒ¦ï¼Œä¾‹å¦‚ä¸šåŠ¡æ˜¯å‘é€çŸ­ä¿¡ï¼Œè¡¥å¿åŠ¨ä½œåˆ™å¾—å†å‘é€ä¸€æ¬¡çŸ­ä¿¡è¯´æ˜æ’¤é”€ï¼Œç”¨æˆ·ä½“éªŒæ¯”è¾ƒå·®ã€‚Sagaäº‹åŠ¡è¾ƒé€‚ç”¨äºè¡¥å¿åŠ¨ä½œå®¹æ˜“å¤„ç†çš„åœºæ™¯ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -é™æµç®—æ³•]]></title>
    <url>%2Fposts%2F6e0ef647.html</url>
    <content type="text"><![CDATA[é™æµçš„ä½œç”¨ ç”±äºAPIæ¥å£æ— æ³•æ§åˆ¶è°ƒç”¨æ–¹çš„è¡Œä¸ºï¼Œå› æ­¤å½“é‡åˆ°ç¬æ—¶è¯·æ±‚é‡æ¿€å¢æ—¶ï¼Œä¼šå¯¼è‡´æ¥å£å ç”¨è¿‡å¤šæœåŠ¡å™¨èµ„æºï¼Œä½¿å¾—å…¶ä»–è¯·æ±‚å“åº”é€Ÿåº¦é™ä½æˆ–æ˜¯è¶…æ—¶ï¼Œæ›´æœ‰ç”šè€…å¯èƒ½å¯¼è‡´æœåŠ¡å™¨å®•æœºã€‚ é™æµ(Rate limiting)æŒ‡å¯¹åº”ç”¨æœåŠ¡çš„è¯·æ±‚è¿›è¡Œé™åˆ¶ï¼Œä¾‹å¦‚æŸä¸€æ¥å£çš„è¯·æ±‚é™åˆ¶ä¸º100ä¸ªæ¯ç§’,å¯¹è¶…è¿‡é™åˆ¶çš„è¯·æ±‚åˆ™è¿›è¡Œå¿«é€Ÿå¤±è´¥æˆ–ä¸¢å¼ƒã€‚ é™æµå¯ä»¥åº”å¯¹ï¼š çƒ­ç‚¹ä¸šåŠ¡å¸¦æ¥çš„çªå‘è¯·æ±‚ï¼› è°ƒç”¨æ–¹bugå¯¼è‡´çš„çªå‘è¯·æ±‚ï¼› æ¶æ„æ”»å‡»è¯·æ±‚ã€‚ å› æ­¤ï¼Œå¯¹äºå…¬å¼€çš„æ¥å£æœ€å¥½é‡‡å–é™æµæªæ–½ã€‚ ä¸ºä»€ä¹ˆè¦åˆ†å¸ƒå¼é™æµ ä½†çº¿ä¸Šä¸šåŠ¡å‡ºäºå„ç§åŸå› è€ƒè™‘ï¼Œå¤šæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿï¼Œå•èŠ‚ç‚¹çš„é™æµä»…èƒ½ä¿æŠ¤è‡ªèº«èŠ‚ç‚¹ï¼Œä½†æ— æ³•ä¿æŠ¤åº”ç”¨ä¾èµ–çš„å„ç§æœåŠ¡ï¼Œå¹¶ä¸”åœ¨è¿›è¡ŒèŠ‚ç‚¹æ‰©å®¹ã€ç¼©å®¹æ—¶ä¹Ÿæ— æ³•å‡†ç¡®æ§åˆ¶æ•´ä¸ªæœåŠ¡çš„è¯·æ±‚é™åˆ¶ã€‚ è€Œå¦‚æœå®ç°äº†åˆ†å¸ƒå¼é™æµï¼Œé‚£ä¹ˆå°±å¯ä»¥æ–¹ä¾¿åœ°æ§åˆ¶æ•´ä¸ªæœåŠ¡é›†ç¾¤çš„è¯·æ±‚é™åˆ¶ï¼Œä¸”ç”±äºæ•´ä¸ªé›†ç¾¤çš„è¯·æ±‚æ•°é‡å¾—åˆ°äº†é™åˆ¶ï¼Œå› æ­¤æœåŠ¡ä¾èµ–çš„å„ç§èµ„æºä¹Ÿå¾—åˆ°äº†é™æµçš„ä¿æŠ¤ã€‚ é™æµç®—æ³•åˆ†ç±» 1ã€è®¡æ•°å™¨ç®—æ³•ï¼ˆå›ºå®šæ—¶é—´çª—å£ï¼‰ï¼› 2ã€æ»‘åŠ¨æ—¶é—´çª—å£ï¼› 3ã€ä»¤ç‰Œæ¡¶ç®—æ³•ï¼› 4ã€æ¼æ¡¶ç®—æ³•ï¼› è®¡æ•°å™¨ç®—æ³• ç®—æ³•è§£è¯» è®¡æ•°å™¨ç®—æ³•æ˜¯é™æµç®—æ³•é‡Œæœ€ç®€å•ä¹Ÿæ˜¯æœ€å®¹æ˜“å®ç°çš„ä¸€ç§ç®—æ³•ã€‚è®¡æ•°å™¨å°±æ˜¯ç»Ÿè®¡è®°å½•å•ä½æ—¶é—´å†…è¿›å…¥ç³»ç»Ÿæˆ–è€…æŸä¸€æ¥å£çš„è¯·æ±‚æ¬¡æ•°ï¼Œåœ¨é™å®šçš„æ¬¡æ•°å†…çš„è¯·æ±‚åˆ™æ­£å¸¸æ¥æ”¶å¤„ç†ï¼Œè¶…è¿‡æ¬¡æ•°çš„è¯·æ±‚åˆ™æ‹’ç»æ‰ï¼Œæˆ–è€…æ”¹ä¸ºå¼‚æ­¥å¤„ç†ã€‚ æ¯”å¦‚è§„å®šï¼Œå¯¹äºAæ¥å£1åˆ†é’Ÿçš„è®¿é—®æ¬¡æ•°ä¸èƒ½è¶…è¿‡100ä¸ªã€‚é‚£ä¹ˆå¯ä»¥è¿™ä¹ˆåšï¼šåœ¨ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œè®¾ç½®ä¸€ä¸ªè®¡æ•°å™¨counterï¼Œæ¯å½“ä¸€ä¸ªè¯·æ±‚è¿‡æ¥çš„æ—¶å€™ï¼Œcounterå°±åŠ 1ï¼Œå¦‚æœcounterçš„å€¼å¤§äº100å¹¶ä¸”è¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´è¿˜åœ¨1åˆ†é’Ÿä¹‹å†…ï¼Œé‚£ä¹ˆè¯´æ˜è¯·æ±‚æ•°è¿‡å¤šï¼›å¦‚æœè¯¥è¯·æ±‚ä¸ç¬¬ä¸€ä¸ªè¯·æ±‚çš„é—´éš”æ—¶é—´å¤§äº1åˆ†é’Ÿï¼Œä¸”counterçš„å€¼è¿˜åœ¨é™æµèŒƒå›´å†…ï¼Œé‚£ä¹ˆå°±é‡ç½® counterï¼Œå…·ä½“ç®—æ³•çš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ç®—æ³•ç¤ºä¾‹ ä½¿ç”¨ AomicInteger æ¥è¿›è¡Œç»Ÿè®¡å½“å‰æ­£åœ¨å¹¶å‘æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡åŸŸå€¼å°±ç›´æ¥æ‹’ç»è¯·æ±‚ï¼Œæç¤ºç³»ç»Ÿç¹å¿™... 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;import java.util.concurrent.atomic.AtomicInteger;/** * @author: whb * @description: è®¡æ•°å™¨é™æµç®—æ³• * ä½¿ç”¨ AomicInteger æ¥è¿›è¡Œç»Ÿè®¡å½“å‰æ­£åœ¨å¹¶å‘æ‰§è¡Œçš„æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡åŸŸå€¼å°±ç›´æ¥æ‹’ç»è¯·æ±‚ï¼Œæç¤ºç³»ç»Ÿç¹å¿™ */public class CounterLimiter { /** * è®¡æ•°å™¨é™æµç®—æ³•ï¼ˆæ¯”è¾ƒæš´åŠ›/è¶…å‡ºç›´æ¥æ‹’ç»ï¼‰ * Atomicï¼Œé™åˆ¶æ€»æ•° */ private static final AtomicInteger atomic = new AtomicInteger(0); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµ */ private void atomicLimiter() { // æœ€å¤§æ”¯æŒ 3 å€‹ if (atomic.get() &gt;= 3) { System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - " + "æ‹’çµ•..."); } else { try { atomic.incrementAndGet(); //å¤„ç†æ ¸å¿ƒé€»è¾‘ System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - " + "é€šè¿‡..."); TimeUnit.SECONDS.sleep(1); } catch (InterruptedException e) { e.printStackTrace(); } finally { atomic.decrementAndGet(); } } } /** * æµ‹è¯•é™æµ * * @throws InterruptedException */ public void testAtomicLimiter() throws InterruptedException { for (int i = 0; i &lt; 5; i++) { threadPoolExecutor.execute(this::atomicLimiter); } TimeUnit.SECONDS.sleep(5); } /** * mainæ–¹æ³•è°ƒç”¨ */ public static void main(String[] args) throws InterruptedException { CounterLimiter counterLimiter = new CounterLimiter(); counterLimiter.testAtomicLimiter(); }} è¿è¡Œç»“æœ è®¡æ•°å™¨ç®—æ³•è™½ç„¶ç®€å•ï¼Œä½†æ¯”è¾ƒç²—æ”¾ï¼Œå­˜åœ¨ä¸€ä¸ªååˆ†è‡´å‘½çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸´ç•Œé—®é¢˜ï¼Œå¦‚ä¸‹å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œå‡è®¾æœ‰ä¸€ä¸ªæ¶æ„ç”¨æˆ·ï¼Œä»–åœ¨0:59æ—¶ï¼Œç¬é—´å‘é€äº†100ä¸ªè¯·æ±‚ï¼Œå¹¶ä¸”1:00åˆç¬é—´å‘é€äº†100ä¸ªè¯·æ±‚ï¼Œé‚£ä¹ˆå…¶å®è¿™ä¸ªç”¨æˆ·åœ¨ 1ç§’é‡Œé¢ï¼Œç¬é—´å‘é€äº†200ä¸ªè¯·æ±‚ã€‚æˆ‘ä»¬åˆšæ‰è§„å®šçš„æ˜¯1åˆ†é’Ÿæœ€å¤š100ä¸ªè¯·æ±‚ï¼Œä¹Ÿå°±æ˜¯æ¯ç§’é’Ÿæœ€å¤š1.7ä¸ªè¯·æ±‚ï¼Œç”¨æˆ·é€šè¿‡åœ¨æ—¶é—´çª—å£çš„é‡ç½®èŠ‚ç‚¹å¤„çªå‘è¯·æ±‚ï¼Œå¯ä»¥ç¬é—´è¶…è¿‡æˆ‘ä»¬çš„é€Ÿç‡é™åˆ¶ã€‚ç”¨æˆ·æœ‰å¯èƒ½é€šè¿‡ç®—æ³•çš„è¿™ä¸ªæ¼æ´ï¼Œç¬é—´å‹å®æˆ‘ä»¬çš„åº”ç”¨ã€‚ å…¶å®è¿™ä¸ªé—®é¢˜çš„æœ¬è´¨å°±æ˜¯ç»Ÿè®¡çš„ç²¾åº¦å¤ªä½ï¼Œé‚£å¦‚ä½•é™ä½ä¸´ç•Œé—®é¢˜çš„å½±å“ï¼Ÿçœ‹ä¸‹é¢çš„æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ã€‚ æ»‘åŠ¨æ—¶é—´çª—å£ ç®—æ³•è§£è¯» æ»‘åŠ¨çª—å£ï¼Œåˆç§°rolling windowï¼Œè·ŸTCPä¸­çš„æ»‘åŠ¨çª—å£åç§°ä¸€è‡´ï¼Œä½†è¦åŒºåˆ†å¼€æ¥ã€‚å…ˆç”¨ä¸€å¼ å›¾è§£é‡Šä¸‹æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ï¼š å¦‚ä¸Šå›¾ï¼Œæ•´ä¸ªçº¢è‰²çš„çŸ©å½¢æ¡†è¡¨ç¤ºä¸€ä¸ªæ—¶é—´çª—å£ï¼Œåœ¨è®¡æ•°å™¨ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬è§„å®šä¸€ä¸ªæ—¶é—´çª—å£å°±æ˜¯ä¸€åˆ†é’Ÿã€‚åœ¨æ»‘åŠ¨æ—¶é—´çª—å£ç®—æ³•ä¸­æˆ‘ä»¬å°†æ»‘åŠ¨çª—å£ åˆ’æˆäº†6æ ¼ï¼Œæ‰€ä»¥æ¯æ ¼ä»£è¡¨çš„æ˜¯10ç§’é’Ÿã€‚æ¯è¿‡10ç§’é’Ÿï¼Œæ—¶é—´çª—å£å°±ä¼šå¾€å³æ»‘åŠ¨ä¸€æ ¼ã€‚æ¯ä¸€ä¸ªæ ¼å­éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„è®¡æ•°å™¨counterï¼Œæ¯”å¦‚å½“ä¸€ä¸ªè¯·æ±‚ åœ¨0:35ç§’çš„æ—¶å€™åˆ°è¾¾ï¼Œé‚£ä¹ˆ0:30~0:39å¯¹åº”çš„counterå°±ä¼šåŠ 1ã€‚ é‚£ä¹ˆæ»‘åŠ¨çª—å£æ€ä¹ˆè§£å†³åˆšæ‰çš„ä¸´ç•Œé—®é¢˜çš„å‘¢ï¼Ÿçœ‹ä¸Šå›¾ï¼Œ0:59åˆ°è¾¾çš„100ä¸ªè¯·æ±‚ä¼šè½åœ¨ç°è‰²çš„æ ¼å­ä¸­ï¼Œè€Œ1:00åˆ°è¾¾çš„è¯·æ±‚ä¼šè½åœ¨çº¢è‰²çš„æ ¼å­ä¸­ã€‚å½“æ—¶é—´åˆ°è¾¾1:00æ—¶ï¼Œçª—å£ä¼šå¾€å³ç§»åŠ¨ä¸€æ ¼ï¼Œé‚£ä¹ˆæ­¤æ—¶æ—¶é—´çª—å£å†…çš„æ€»è¯·æ±‚æ•°é‡ä¸€å…±æ˜¯200ä¸ªï¼Œè¶…è¿‡äº†é™å®šçš„100ä¸ªï¼Œæ‰€ä»¥æ­¤æ—¶èƒ½å¤Ÿæ£€æµ‹å‡ºæ¥è§¦å‘äº†é™æµã€‚ å†å›é¡¾ä¸€ä¸‹åˆšæ‰çš„è®¡æ•°å™¨ç®—æ³•ï¼Œå¯ä»¥å‘ç°ï¼Œè®¡æ•°å™¨ç®—æ³•å…¶å®å°±æ˜¯æ»‘åŠ¨çª—å£ç®—æ³•ã€‚åªæ˜¯å®ƒæ²¡æœ‰å¯¹æ—¶é—´çª—å£åšè¿›ä¸€æ­¥åœ°åˆ’åˆ†ï¼Œæ‰€ä»¥åªæœ‰1æ ¼ã€‚ ç”±æ­¤å¯è§ï¼Œå½“æ»‘åŠ¨çª—å£çš„æ ¼å­åˆ’åˆ†çš„è¶Šå¤šï¼Œé‚£ä¹ˆæ»‘åŠ¨çª—å£çš„æ»šåŠ¨å°±è¶Šå¹³æ»‘ï¼Œé™æµçš„ç»Ÿè®¡å°±ä¼šè¶Šç²¾ç¡®ã€‚ ç®—æ³•ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141package com.springboot.whb.study.currentLimiting;/** * @author: whb * @description: æ»‘åŠ¨æ—¶é—´çª—å£é™æµç®—æ³• */import java.util.Iterator;import java.util.Random;import java.util.concurrent.ConcurrentLinkedQueue;import java.util.stream.IntStream;public class TimeWindowLimited { /** * ç¼“å­˜è¯·æ±‚çš„é˜Ÿåˆ— */ private ConcurrentLinkedQueue&lt;Long&gt; queue = new ConcurrentLinkedQueue&lt;&gt;(); /** * æ»‘åŠ¨æ—¶é—´çª—å£å¤§å° */ private int seconds; /** * æœ€å¤§å¯æ¥å—è¯·æ±‚ */ private int max; public TimeWindowLimited(int max, int timeWindowOfSeconds) { this.seconds = timeWindowOfSeconds; this.max = max; new Thread(() -&gt; { for (; ; ) { clean(); try { Thread.sleep(10); } catch (InterruptedException e) { Thread.currentThread().interrupt(); } } }).start(); } /** * è·å–ä»¤ç‰Œï¼Œå¹¶ä¸”æ·»åŠ æ—¶é—´ */ public void take() { long start = System.currentTimeMillis(); try { int size = sizeOfValid(); if (size &gt; max - 1) { System.err.println(" é˜Ÿåˆ—å·²æ»¡ï¼Œé˜Ÿåˆ—å®¹é‡:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); throw new IllegalStateException("full"); } synchronized (queue) { if (sizeOfValid() &gt; max - 1) { System.err.println(" é˜Ÿåˆ—å·²æ»¡: in synchronized,size:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); throw new IllegalStateException("full"); } this.queue.offer(System.currentTimeMillis()); } System.out.println(" queue: d,size:" + queue.size() + ",max:" + max + ",queue:" + printQueue()); } finally { System.out.println("è€—æ—¶:" + (System.currentTimeMillis() - start) + " ms"); } } /** * æ‰“å°é˜Ÿåˆ—å†…å®¹ * * @return */ private String printQueue() { Iterator&lt;Long&gt; it = queue.iterator(); StringBuilder sb = new StringBuilder(); while (it.hasNext()) { Long t = it.next(); sb.append(" ").append(t); } return sb.toString(); } /** * æœ‰æ•ˆè¯·æ±‚ * * @return */ public int sizeOfValid() { Iterator&lt;Long&gt; it = queue.iterator(); Long ms = System.currentTimeMillis() - seconds * 1000; int count = 0; while (it.hasNext()) { long t = it.next(); if (t &gt; ms) { count++; } } return count; } /** * æ¸…ç† */ public void clean() { Long c = System.currentTimeMillis() - seconds * 1000; Long tl = null; System.out.println("peek: " + queue.peek() + "c:" + c); while ((tl = queue.peek()) != null &amp;&amp; tl &lt; c) { System.out.println("peek: t:" + tl); queue.poll(); } } public static void main(String[] args) { final TimeWindowLimited timeWindow = new TimeWindowLimited(200, 2); IntStream.range(0, 100).forEach((i) -&gt; { new Thread(() -&gt; { for (; ; ) { System.out.println("before take i:" + i); try { Thread.sleep(new Random().nextInt(20) * 100); } catch (InterruptedException e) { e.printStackTrace(); } try { timeWindow.take(); System.out.println("some option, i:" + i); } catch (Exception e) { System.err.println(" take i:" + i + ", encounter error:" + e.getMessage()); try { Thread.sleep(10L); } catch (InterruptedException e1) { e1.printStackTrace(); } continue; } System.out.println("after take i:" + i); } }).start(); }); }} è¿è¡Œç»“æœ æ¼æ¡¶ç®—æ³• ç®—æ³•è§£è¯» æ¼æ¡¶ç®—æ³•ï¼ˆLeaky Bucketï¼‰ï¼šä¸»è¦ç›®çš„æ˜¯æ§åˆ¶æ•°æ®æ³¨å…¥åˆ°ç½‘ç»œçš„é€Ÿç‡ï¼Œå¹³æ»‘ç½‘ç»œä¸Šçš„çªå‘æµé‡ï¼Œæ•°æ®å¯ä»¥ä»¥ä»»æ„é€Ÿåº¦æµå…¥åˆ°æ¼æ¡¶ä¸­ã€‚æ¼æ¡¶ç®—æ³•æä¾›äº†ä¸€ç§æœºåˆ¶ï¼Œé€šè¿‡å®ƒï¼Œçªå‘æµé‡å¯ä»¥è¢«æ•´å½¢ä»¥ä¾¿ä¸ºç½‘ç»œæä¾›ä¸€ä¸ªç¨³å®šçš„æµé‡ã€‚ æ¼æ¡¶å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¸¦æœ‰å¸¸é‡æœåŠ¡æ—¶é—´çš„å•æœåŠ¡å™¨é˜Ÿåˆ—ï¼Œå¦‚æœæ¼æ¡¶ä¸ºç©ºï¼Œåˆ™ä¸éœ€è¦æµå‡ºæ°´æ»´ï¼Œå¦‚æœæ¼æ¡¶ï¼ˆåŒ…ç¼“å­˜ï¼‰æº¢å‡ºï¼Œé‚£ä¹ˆæ°´æ»´ä¼šè¢«æº¢å‡ºä¸¢å¼ƒã€‚ ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æè¿°å°±æ˜¯æ³¨æ°´æ¼æ°´è¿‡ç¨‹ï¼Œå¾€æ¡¶ä¸­ä»¥ä¸€å®šé€Ÿç‡æµå‡ºæ°´ï¼Œä»¥ä»»æ„é€Ÿç‡æµå…¥æ°´ï¼Œå½“æ°´è¶…è¿‡æ¡¶æµé‡åˆ™ä¸¢å¼ƒï¼Œå› ä¸ºæ¡¶å®¹é‡æ˜¯ä¸å˜çš„ï¼Œä¿è¯äº†æ•´ä½“çš„é€Ÿç‡ã€‚ ç®—æ³•ç¤ºä¾‹ æ¼æ¡¶ç®—æ³•å¯ä»¥é€šè¿‡ ä¿¡å·é‡ï¼ˆSemaphoreï¼‰ çš„æ–¹å¼å®ç°ï¼Œå¾ˆå¥½çš„è¾¾åˆ°å‰Šå³°çš„ç›®çš„ï¼Œå¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼Œé˜Ÿåˆ—ä¸­ä»»åŠ¡å­˜æ´»ä¸ªæ•°å°±å¦‚åŒæ˜¯æ°´æ¡¶æœ€å¤šèƒ½ç››è£…çš„æ°´é‡ï¼Œå½“è¶…å‡ºè¿™ä¸ªé˜€å€¼å°±ä¼šä¸¢å¼ƒä»»åŠ¡.... 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.Semaphore;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æ¼æ¡¶é™æµç®—æ³• */public class LeakyBucket { /** * ä¿¡å·é‡ï¼Œç”¨æ¥è¾¾åˆ°å‰Šå³°çš„ç›®çš„ï¼Œå¹³æ»‘æµé‡ */ private static final Semaphore semaphore = new Semaphore(3); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµç®—æ³• */ private void semaphoreLimiter() { // é˜Ÿåˆ—ä¸­å…è®¸å­˜æ´»çš„ä»»åŠ¡ä¸ªæ•°ä¸èƒ½è¶…è¿‡ 5 ä¸ª if (semaphore.getQueueLength() &gt; 5) { System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - æ‹’çµ•..."); } else { try { semaphore.acquire(); System.out.println(LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - é€šè¿‡..."); //å¤„ç†æ ¸å¿ƒé€»è¾‘ TimeUnit.SECONDS.sleep(2); } catch (InterruptedException e) { e.printStackTrace(); } finally { semaphore.release(); } } } /** * æµ‹è¯•é™æµç®—æ³• * * @throws InterruptedException */ public void testSemaphore() throws InterruptedException { for (int i = 0; i &lt; 10; i++) { threadPoolExecutor.execute(this::semaphoreLimiter); } TimeUnit.SECONDS.sleep(5); } /** * mainæ–¹æ³•ä¸­æ‰§è¡Œæµ‹è¯•æ–¹æ³• * * @param args * @throws InterruptedException */ public static void main(String[] args) throws InterruptedException { LeakyBucket leakyBucket = new LeakyBucket(); leakyBucket.testSemaphore(); }} è¿è¡Œç»“æœ ä¸€å…± 10 ä¸ªçº¿ç¨‹åŒæ—¶è¯·æ±‚ï¼Œåˆå§‹ä¿¡å·é‡ä¸º3ï¼Œè¡¨ç¤ºæœ€å¤šå¯ä»¥åŒæ—¶å¤„ç† 3 ä¸ªä»»åŠ¡ï¼Œè¶…å‡ºè¿›å…¥ç¼“å†²åŒºæ’é˜Ÿç­‰å¾…ï¼Œå½“ç¼“å†²åŒºæ»¡äº†ååˆ™æ‹’ç»æ¥æ”¶æ–°çš„è¯·æ±‚... ä»¤ç‰Œæ¡¶ç®—æ³• ç®—æ³•è§£è¯» ä»¤ç‰Œæ¡¶ç®—æ³•æ˜¯æ¯”è¾ƒå¸¸è§çš„é™æµç®—æ³•ä¹‹ä¸€ï¼Œå¤§æ¦‚æè¿°å¦‚ä¸‹ï¼š æ‰€æœ‰çš„è¯·æ±‚åœ¨å¤„ç†ä¹‹å‰éƒ½éœ€è¦æ‹¿åˆ°ä¸€ä¸ªå¯ç”¨çš„ä»¤ç‰Œæ‰ä¼šè¢«å¤„ç†ï¼› æ ¹æ®é™æµå¤§å°ï¼Œè®¾ç½®æŒ‰ç…§ä¸€å®šçš„é€Ÿç‡å¾€æ¡¶é‡Œæ·»åŠ ä»¤ç‰Œï¼› æ¡¶è®¾ç½®æœ€å¤§çš„æ”¾ç½®ä»¤ç‰Œé™åˆ¶ï¼Œå½“æ¡¶æ»¡æ—¶ã€æ–°æ·»åŠ çš„ä»¤ç‰Œå°±è¢«ä¸¢å¼ƒæˆ–è€…æ‹’ç»ï¼› è¯·æ±‚è¾¾åˆ°åé¦–å…ˆè¦è·å–ä»¤ç‰Œæ¡¶ä¸­çš„ä»¤ç‰Œï¼Œæ‹¿ç€ä»¤ç‰Œæ‰å¯ä»¥è¿›è¡Œå…¶ä»–çš„ä¸šåŠ¡é€»è¾‘ï¼Œå¤„ç†å®Œä¸šåŠ¡é€»è¾‘ä¹‹åï¼Œå°†ä»¤ç‰Œç›´æ¥åˆ é™¤ï¼› ä»¤ç‰Œæ¡¶æœ‰æœ€ä½é™é¢ï¼Œå½“æ¡¶ä¸­çš„ä»¤ç‰Œè¾¾åˆ°æœ€ä½é™é¢çš„æ—¶å€™ï¼Œè¯·æ±‚å¤„ç†å®Œä¹‹åå°†ä¸ä¼šåˆ é™¤ä»¤ç‰Œï¼Œä»¥æ­¤ä¿è¯è¶³å¤Ÿçš„é™æµï¼› ç®—æ³•ç¤ºä¾‹ åœ¨Google Guavaä¸­æä¾›äº†ä¸€ä¸ªRateLimiter å·¥å…·ç±»ï¼Œå°±æ˜¯åŸºäºä»¤ç‰Œæ¡¶ç®—æ³•å®ç°å¹³æ»‘çªå‘çš„é™æµç­–ç•¥. ä»¤ç‰Œæ¡¶çš„å¥½å¤„æ˜¯å¯ä»¥æ–¹ä¾¿çš„æ”¹å˜é€Ÿåº¦ï¼Œä¸€æ—¦éœ€è¦æé«˜é€Ÿç‡ï¼Œåˆ™æŒ‰éœ€æé«˜æ”¾å…¥æ¡¶ä¸­çš„ä»¤ç‰Œçš„é€Ÿç‡ã€‚ä¸€èˆ¬ä¼šå®šæ—¶(æ¯”å¦‚1000æ¯«ç§’)å¾€æ¡¶ä¸­å¢åŠ ä¸€å®šæ•°é‡çš„ä»¤ç‰Œ, æœ‰äº›å˜ç§ç®—æ³•åˆ™å¯ä»¥å®æ—¶çš„è®¡ç®—åº”è¯¥å¢åŠ çš„ä»¤ç‰Œçš„æ•°é‡ã€‚ åœ¨ç¤ºä¾‹ä»£ç ä¸­ä¸ºæ¯ç§’ä¸­äº§ç”Ÿ 2 ä¸ªä»¤ç‰Œï¼Œæ„å‘³ç€æ¯500æ¯«ç§’ä¼šäº§ç”Ÿä¸€ä¸ªä»¤ç‰Œã€‚ limiter.acquire(num) è¡¨ç¤ºæ¶ˆè´¹å¤šå°‘ä¸ªä»¤ç‰Œã€‚å½“æ¡¶ä¸­æœ‰è¶³å¤Ÿçš„ä»¤ç‰Œæ—¶ï¼Œåˆ™ç›´æ¥è¿”å›0ï¼Œå¦åˆ™é˜»å¡ï¼Œç›´åˆ°æœ‰å¯ç”¨çš„ä»¤ç‰Œæ•°æ‰è¿”å›ï¼Œè¿”å›çš„å€¼ä¸ºé˜»å¡çš„æ—¶é—´ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package com.springboot.whb.study.currentLimiting;import com.google.common.base.Joiner;import com.google.common.util.concurrent.RateLimiter;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.time.LocalDateTime;import java.util.concurrent.*;/** * @author: whb * @description: è°·æ­Œä»¤ç‰Œæ¡¶ç®—æ³•æµ‹è¯• */public class TokenBucket { /** * æ¯ç§’ç”Ÿæˆ2ä¸ªä»¤ç‰Œ */ private static final RateLimiter limiter = RateLimiter.create(2); /** * çº¿ç¨‹æ±  */ public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); /** * é™æµ */ private void rateLimiter() { // é»˜è®¤å°±æ˜¯ 1 final double acquire = limiter.acquire(1); System.out.println("å½“å‰æ—¶é—´ - " + LocalDateTime.now() + " - " + Thread.currentThread().getName() + " - é˜»å¡ - " + acquire + " é€šè¿‡..."); } /** * é™æµç®—æ³•æµ‹è¯•æ¥å£ * * @throws InterruptedException */ public void testRateLimiter() throws InterruptedException { for (int i = 0; i &lt; 5; i++) { threadPoolExecutor.execute(this::rateLimiter); } TimeUnit.SECONDS.sleep(5); } /** * mainæ–¹æ³•ä¸­è°ƒç”¨ * * @param args * @throws InterruptedException */ public static void main(String[] args) throws InterruptedException { TokenBucket rateLimiterTest = new TokenBucket(); rateLimiterTest.testRateLimiter(); }} è¿è¡Œç»“æœ é€šè¿‡æ§åˆ¶å°çš„è¾“å‡ºå¯ä»¥å¾ˆç›´è§‚çš„çœ‹å‡ºæ¯ä¸ªä»¤ç‰Œäº§ç”Ÿæ—¶é—´é—´éš”å¤§çº¦åœ¨ 500 æ¯«ç§’å·¦å³ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mybatis-0å€¼é—®é¢˜]]></title>
    <url>%2Fposts%2F9dd16667.html</url>
    <content type="text"><![CDATA[å‰è¨€ åœ¨ä½¿ç”¨Mybatisçš„æ—¶å€™ï¼Œæ›¾é‡åˆ°è¿‡ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œå½“ä½¿ç”¨&lt;if test="status != null and status != ''"&gt;åˆ¤ç©ºæ“ä½œæ—¶ï¼Œå¦‚æœstatusä¸º0çš„æ—¶å€™ï¼Œè¯¥åˆ¤æ–­æ¡ä»¶çš„å€¼ä¸ºfalseï¼Œä¹Ÿå°±æ˜¯è¯´Mybatisæ­¤æ—¶æŠŠ0ä½œä¸ºnullæ¥è¿›è¡Œåˆ¤æ–­çš„ã€‚ é‡åˆ°è¿™ä¸ªé—®é¢˜çš„æ—¶å€™ï¼Œç¿»çœ‹Mybatisçš„æºç ï¼Œå‘ç°å…¶åœ¨ExpressionEvaluator.javaç±»çš„evaluateBooleanæ–¹æ³•å¤„è¿”å›äº†falseã€‚ åœºæ™¯åˆ†æ æ•°æ®åº“å­—æ®µ 1`pay_status` int(11) NOT NULL DEFAULT '0' COMMENT 'æ”¯ä»˜çŠ¶æ€ 0-æœªæ”¯ä»˜ 1-å·²æ”¯ä»˜', æŒ‰ç…§ä¸€èˆ¬çš„é€»è¾‘æ¥çœ‹ï¼ŒæŸ¥è¯¢è¯­å¥éœ€è¦å†™æˆè¿™æ ·çš„å½¢å¼ï¼š 1234select * from order_pay pay WHERE pay.deal_id = 1&lt;if test="payStatus != null and payStatus != ''"&gt; and pay.pay_status = #{payStatus}&lt;/if&gt; å½“æŸ¥è¯¢å‚æ•°ä¸ä¼ é€’æœªæ”¯ä»˜æˆ–è€…å·²æ”¯ä»˜æ¡ä»¶æ—¶ï¼Œå°±éœ€è¦æŸ¥è¯¢payStatusä¸º0å’Œ1çš„å…¨éƒ¨ç»“æœï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰æ¡ä»¶and pay.pay_status = #{payStatus}ï¼Œä½†äº‹å®å°±çº ç»“äº†ï¼Œå½“payStatusä¼ é€’çš„å‚æ•°ä¸º1æ—¶ï¼Œifæ¡ä»¶çš„ç»“æœä¸ºtrueï¼Œä¹Ÿå°±æ˜¯è¯´sqlè¯­å¥å˜æˆäº†select * from order_pay pay WHERE pay.deal_id = 1 and pay.pay_status=1ï¼ŒæŸ¥è¯¢ç»“æœæ­£å¸¸ï¼Œä½†å¦‚æœpayStatusä¸º0æ­¤æ—¶ï¼Œsqlè¯­å¥å˜æˆäº†select * from order_pay pay WHERE pay.deal_id = 1ï¼Œä¸é¢„æœŸç»“æœselect * from order_pay pay WHERE pay.deal_id = 1 and pay.pay_status=0æ˜¾ç„¶æ˜¯ä¸ç¬¦çš„ï¼ Mybatisè‡ªä½œä¸»å¼ çš„æŠŠpayStatusä¸º0çš„æ¡ä»¶å½“åšäº†ifçš„falseç»“æœï¼ è§£å†³åŠæ³• æ–¹æ³•ä¸€ payStatusæ˜¯Integerç±»å‹çš„ï¼ŒæŠŠpayStatus != '' å»æ‰å°±å¯ä»¥äº†ã€‚ é‚£ä¹ˆç°åœ¨é‡æ–°æ¥çœ‹ï¼Œå…ˆå‰çš„åšæ³•æœ¬æ¥å°±æœ‰é—®é¢˜ï¼Œintegerç±»å‹çš„ï¼Œå¹²å˜›è¦ç”¨payStatus!=''æ¥è¿›è¡Œåˆ¤æ–­ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸å¯¹çš„ï¼Œä»åŸåˆ™ä¸Šæ¥è®²ï¼Œ&lt;if test="payStatus != null and payStatus != ''"&gt;è¯¥åˆ¤æ–­æ¡ä»¶åªèƒ½æ¥åˆ¤æ–­payStatusä¸ºstringç±»å‹çš„ï¼Œä¸èƒ½ç”¨æ¥åˆ¤æ–­integerç±»å‹ã€‚ ä½†ç”±æ­¤å¼•å‘ä¸€ä¸ªç–‘é—®ï¼š&lt;if test="payStatus != null and payStatus != ''"&gt;åˆ¤æ–­ä¸æ˜¯ä¸ºç©ºï¼Œå¯¹äºIntegerç±»å‹å°±æ˜¯åœ¨åˆ¤æ–­ä¸ä¸º0ä¹ˆï¼Ÿ æ–¹æ³•äºŒ å¯¹ä¼ é€’å‚æ•°æ‹¦æˆª 12345678910public static int parseStringToInt(Object parameter, int defualtValue) { try { if ((parameter == null) || (parameter.equals(""))) { return defualtValue; } return Integer.parseInt(parameter.toString()); } catch (Exception ex) { } return 0;} 1vo.addParams("status", StrUtil.parseStringToInt(vo.getParams("status"), -1)); ä¹Ÿå°±æ˜¯è¯´åœ¨æŸ¥è¯¢æ‰€æœ‰æ”¯ä»˜çŠ¶æ€çš„è®¢å•æ—¶ï¼ŒæŠŠpayStatusçš„å€¼è½¬æ¢ä¸º-1ã€‚ é‡æ„Mybatisçš„æŸ¥è¯¢è¯­å¥ 1234select * from order_pay pay WHERE pay.deal_id = 1&lt;if test="payStatus != -1"&gt; and pay.pay_status = #{payStatus}&lt;/if&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -åˆ†å¸ƒå¼å…¨å±€å”¯ä¸€ID]]></title>
    <url>%2Fposts%2Fa8c8e58f.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€ID åœ¨å¤æ‚åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå¾€å¾€éœ€è¦å¯¹å¤§é‡çš„æ•°æ®å’Œæ¶ˆæ¯è¿›è¡Œå”¯ä¸€æ ‡è¯†ã€‚ å¦‚åœ¨é‡‘èã€ç”µå•†ã€æ”¯ä»˜ã€ç­‰äº§å“çš„ç³»ç»Ÿä¸­ï¼Œæ•°æ®æ—¥æ¸å¢é•¿ï¼Œå¯¹æ•°æ®åˆ†åº“åˆ†è¡¨åéœ€è¦æœ‰ä¸€ä¸ªå”¯ä¸€IDæ¥æ ‡è¯†ä¸€æ¡æ•°æ®æˆ–æ¶ˆæ¯ï¼Œæ•°æ®åº“çš„è‡ªå¢IDæ˜¾ç„¶ä¸èƒ½æ»¡è¶³éœ€æ±‚ï¼Œæ­¤æ—¶ä¸€ä¸ªèƒ½å¤Ÿç”Ÿæˆå…¨å±€å”¯ä¸€IDçš„ç³»ç»Ÿæ˜¯éå¸¸å¿…è¦çš„ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€IDçš„ç‰¹ç‚¹ å…¨å±€å”¯ä¸€æ€§ï¼šä¸èƒ½å‡ºç°é‡å¤çš„IDå·ï¼Œæ—¢ç„¶æ˜¯å”¯ä¸€æ ‡è¯†ï¼Œè¿™æ˜¯æœ€åŸºæœ¬çš„è¦æ±‚ã€‚ è¶‹åŠ¿é€’å¢ï¼šåœ¨MySQL InnoDBå¼•æ“ä¸­ä½¿ç”¨çš„æ˜¯èšé›†ç´¢å¼•ï¼Œç”±äºå¤šæ•°RDBMSä½¿ç”¨B-treeçš„æ•°æ®ç»“æ„æ¥å­˜å‚¨ç´¢å¼•æ•°æ®ï¼Œåœ¨ä¸»é”®çš„é€‰æ‹©ä¸Šé¢æˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨æœ‰åºçš„ä¸»é”®ä¿è¯å†™å…¥æ€§èƒ½ã€‚ å•è°ƒé€’å¢ï¼šä¿è¯ä¸‹ä¸€ä¸ªIDä¸€å®šå¤§äºä¸Šä¸€ä¸ªIDï¼Œä¾‹å¦‚äº‹åŠ¡ç‰ˆæœ¬å·ã€IMå¢é‡æ¶ˆæ¯ã€æ’åºç­‰ç‰¹æ®Šéœ€æ±‚ã€‚ ä¿¡æ¯å®‰å…¨ï¼šå¦‚æœIDæ˜¯è¿ç»­çš„ï¼Œæ¶æ„ç”¨æˆ·çš„æ‰’å–å·¥ä½œå°±éå¸¸å®¹æ˜“åšäº†ï¼Œç›´æ¥æŒ‰ç…§é¡ºåºä¸‹è½½æŒ‡å®šURLå³å¯ï¼›å¦‚æœæ˜¯è®¢å•å·å°±æ›´å±é™©äº†ã€‚æ‰€ä»¥åœ¨ä¸€äº›åº”ç”¨åœºæ™¯ä¸‹ï¼Œä¼šéœ€è¦IDæ— è§„åˆ™ã€ä¸è§„åˆ™ã€‚ åŒæ—¶é™¤äº†å¯¹IDå·ç è‡ªèº«çš„è¦æ±‚ï¼Œä¸šåŠ¡è¿˜å¯¹IDå·ç”Ÿæˆç³»ç»Ÿçš„å¯ç”¨æ€§è¦æ±‚æé«˜ï¼Œæƒ³è±¡ä¸€ä¸‹ï¼Œå¦‚æœIDç”Ÿæˆç³»ç»Ÿç˜«ç—ªï¼Œè¿™å°±ä¼šå¸¦æ¥ä¸€åœºç¾éš¾ã€‚ ç”±æ­¤æ€»ç»“ä¸‹ä¸€ä¸ªIDç”Ÿæˆç³»ç»Ÿåº”è¯¥åšåˆ°å¦‚ä¸‹å‡ ç‚¹ï¼š å¹³å‡å»¶è¿Ÿå’ŒTP999å»¶è¿Ÿéƒ½è¦å°½å¯èƒ½ä½ï¼› å¯ç”¨æ€§5ä¸ª9ï¼› é«˜QPSã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿå”¯ä¸€IDå®ç°æ–¹æ¡ˆ UUID UUIDæ˜¯æŒ‡åœ¨ä¸€å°æœºå™¨åœ¨åŒä¸€æ—¶é—´ä¸­ç”Ÿæˆçš„æ•°å­—åœ¨æ‰€æœ‰æœºå™¨ä¸­éƒ½æ˜¯å”¯ä¸€çš„ã€‚æŒ‰ç…§å¼€æ”¾è½¯ä»¶åŸºé‡‘ä¼š(OSF)åˆ¶å®šçš„æ ‡å‡†è®¡ç®—ï¼Œç”¨åˆ°äº†ä»¥å¤ªç½‘å¡åœ°å€ã€çº³ç§’çº§æ—¶é—´ã€èŠ¯ç‰‡IDç å’Œè®¸å¤šå¯èƒ½çš„æ•°å­— UUIDç”±ä»¥ä¸‹å‡ éƒ¨åˆ†çš„ç»„åˆï¼š ï¼ˆ1ï¼‰å½“å‰æ—¥æœŸå’Œæ—¶é—´ã€‚ ï¼ˆ2ï¼‰æ—¶é’Ÿåºåˆ—ã€‚ ï¼ˆ3ï¼‰å…¨å±€å”¯ä¸€çš„IEEEæœºå™¨è¯†åˆ«å·ï¼Œå¦‚æœæœ‰ç½‘å¡ï¼Œä»ç½‘å¡MACåœ°å€è·å¾—ï¼Œæ²¡æœ‰ç½‘å¡ä»¥å…¶ä»–æ–¹å¼è·å¾—ã€‚ æ ‡å‡†çš„UUIDæ ¼å¼ä¸ºï¼šxxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx (8-4-4-4-12)ï¼Œä»¥è¿å­—å·åˆ†ä¸ºäº”æ®µå½¢å¼çš„36ä¸ªå­—ç¬¦ï¼Œç¤ºä¾‹ï¼š550e8400-e29b-41d4-a716-446655440000 Javaæ ‡å‡†ç±»åº“ä¸­å·²ç»æä¾›äº†UUIDçš„APIã€‚ 1UUID.randomUUID(); ä¼˜ç‚¹ æ€§èƒ½éå¸¸é«˜ï¼šæœ¬åœ°ç”Ÿæˆï¼Œæ²¡æœ‰ç½‘ç»œæ¶ˆè€—ã€‚ ç¼ºç‚¹ ä¸æ˜“å­˜å‚¨ï¼šUUIDå¤ªé•¿ï¼Œ16å­—èŠ‚128ä½ï¼Œé€šå¸¸ä»¥36é•¿åº¦çš„å­—ç¬¦ä¸²è¡¨ç¤ºï¼Œå¾ˆå¤šåœºæ™¯ä¸é€‚ç”¨ã€‚ ä¿¡æ¯ä¸å®‰å…¨ï¼šåŸºäºMACåœ°å€ç”ŸæˆUUIDçš„ç®—æ³•å¯èƒ½ä¼šé€ æˆMACåœ°å€æ³„éœ²ï¼Œè¿™ä¸ªæ¼æ´æ›¾è¢«ç”¨äºå¯»æ‰¾æ¢…ä¸½èç—…æ¯’çš„åˆ¶ä½œè€…ä½ç½®ã€‚ IDä½œä¸ºä¸»é”®æ—¶åœ¨ç‰¹å®šçš„ç¯å¢ƒä¼šå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œæ¯”å¦‚åšDBä¸»é”®çš„åœºæ™¯ä¸‹ï¼ŒUUIDå°±éå¸¸ä¸é€‚ç”¨ã€‚ Twitterçš„snowflake snowflake æ˜¯ Twitter å¼€æºçš„åˆ†å¸ƒå¼IDç”Ÿæˆç®—æ³•ï¼Œæ˜¯ä¸€ç§åˆ’åˆ†å‘½åç©ºé—´æ¥ç”ŸæˆIDçš„ä¸€ç§ç®—æ³•ï¼Œç»“æœæ˜¯ä¸€ä¸ªlongå‹çš„IDã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šæŠŠ64-bitåˆ†åˆ«åˆ’åˆ†æˆå¤šæ®µã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š 1ä½æ ‡è¯†ç¬¦ï¼šå§‹ç»ˆæ˜¯0ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0ã€‚ 41ä½æ—¶é—´æˆ³ï¼š41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª )å¾—åˆ°çš„å€¼ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ã€‚ 10ä½æœºå™¨æ ‡è¯†ç ï¼šå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæœºå™¨åˆ†æœºæˆ¿ï¼ˆIDCï¼‰éƒ¨ç½²ï¼Œè¿™10ä½å¯ä»¥ç”± 5ä½æœºæˆ¿ID + 5ä½æœºå™¨ID ç»„æˆã€‚ 12ä½åºåˆ—ï¼šæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå· ä¼˜ç‚¹ æ¯«ç§’æ•°åœ¨é«˜ä½ï¼Œè‡ªå¢åºåˆ—åœ¨ä½ä½ï¼Œæ•´ä¸ªIDéƒ½æ˜¯è¶‹åŠ¿é€’å¢çš„ã€‚ ä¸ä¾èµ–æ•°æ®åº“ç­‰ç¬¬ä¸‰æ–¹ç³»ç»Ÿï¼Œä»¥æœåŠ¡çš„æ–¹å¼éƒ¨ç½²ï¼Œç¨³å®šæ€§æ›´é«˜ï¼Œç”ŸæˆIDçš„æ€§èƒ½ä¹Ÿæ˜¯éå¸¸é«˜çš„ã€‚ å¯ä»¥æ ¹æ®è‡ªèº«ä¸šåŠ¡ç‰¹æ€§åˆ†é…bitä½ï¼Œéå¸¸çµæ´»ã€‚ ç¼ºç‚¹ å¼ºä¾èµ–æœºå™¨çš„æ—¶é’Ÿï¼Œå¦‚æœæœåŠ¡å™¨æ—¶é’Ÿå›æ‹¨ï¼Œä¼šå¯¼è‡´é‡å¤IDç”Ÿæˆã€‚ åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸Šï¼Œæ¯ä¸ªæœåŠ¡å™¨çš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œæœ‰æ—¶ä¼šå‡ºç°ä¸æ˜¯å…¨å±€é€’å¢çš„æƒ…å†µã€‚ snowflake Javaå®ç° 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146/** * Twitter_Snowflake&lt;br&gt; * SnowFlakeçš„ç»“æ„å¦‚ä¸‹(æ¯éƒ¨åˆ†ç”¨-åˆ†å¼€):&lt;br&gt; * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt; * 1ä½æ ‡è¯†ï¼Œç”±äºlongåŸºæœ¬ç±»å‹åœ¨Javaä¸­æ˜¯å¸¦ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯0ï¼Œè´Ÿæ•°æ˜¯1ï¼Œæ‰€ä»¥idä¸€èˆ¬æ˜¯æ­£æ•°ï¼Œæœ€é«˜ä½æ˜¯0&lt;br&gt; * 41ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼ï¼ˆå½“å‰æ—¶é—´æˆª - å¼€å§‹æ—¶é—´æˆª) * å¾—åˆ°çš„å€¼ï¼‰ï¼Œè¿™é‡Œçš„çš„å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯æˆ‘ä»¬çš„idç”Ÿæˆå™¨å¼€å§‹ä½¿ç”¨çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šçš„ï¼ˆå¦‚ä¸‹ä¸‹é¢ç¨‹åºIdWorkerç±»çš„startTimeå±æ€§ï¼‰ã€‚ * 41ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨69å¹´ï¼Œå¹´T = (1L &lt;&lt; 41) / (1000L * 60 * 60 * 24 * 365) = 69&lt;br&gt; * 10ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨1024ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬5ä½datacenterIdå’Œ5ä½workerId&lt;br&gt; * 12ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ4096ä¸ªIDåºå·&lt;br&gt; * åŠ èµ·æ¥åˆšå¥½64ä½ï¼Œä¸ºä¸€ä¸ªLongå‹ã€‚&lt;br&gt; * SnowFlakeçš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”ŸIDç¢°æ’(ç”±æ•°æ®ä¸­å¿ƒIDå’Œæœºå™¨IDä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒé«˜ï¼Œ * ç»æµ‹è¯•ï¼ŒSnowFlakeæ¯ç§’èƒ½å¤Ÿäº§ç”Ÿ26ä¸‡IDå·¦å³ã€‚ */public class SnowflakeIdWorker { // ==============================Fields=========================================== /** å¼€å§‹æ—¶é—´æˆª (2015-01-01) */ private final long twepoch = 1420041600000L; /** æœºå™¨idæ‰€å çš„ä½æ•° */ private final long workerIdBits = 5L; /** æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */ private final long datacenterIdBits = 5L; /** æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */ private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); /** æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31 */ private final long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits); /** åºåˆ—åœ¨idä¸­å çš„ä½æ•° */ private final long sequenceBits = 12L; /** æœºå™¨IDå‘å·¦ç§»12ä½ */ private final long workerIdShift = sequenceBits; /** æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */ private final long datacenterIdShift = sequenceBits + workerIdBits; /** æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; /** ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); /** å·¥ä½œæœºå™¨ID(0~31) */ private long workerId; /** æ•°æ®ä¸­å¿ƒID(0~31) */ private long datacenterId; /** æ¯«ç§’å†…åºåˆ—(0~4095) */ private long sequence = 0L; /** ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */ private long lastTimestamp = -1L; //==============================Constructors===================================== /** * æ„é€ å‡½æ•° * @param workerId å·¥ä½œID (0~31) * @param datacenterId æ•°æ®ä¸­å¿ƒID (0~31) */ public SnowflakeIdWorker(long workerId, long datacenterId) { if (workerId &gt; maxWorkerId || workerId &lt; 0) { throw new IllegalArgumentException(String.format("worker Id can't be greater than %d or less than 0", maxWorkerId)); } if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) { throw new IllegalArgumentException(String.format("datacenter Id can't be greater than %d or less than 0", maxDatacenterId)); } this.workerId = workerId; this.datacenterId = datacenterId; } // ==============================Methods========================================== /** * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„) * @return SnowflakeId */ public synchronized long nextId() { long timestamp = timeGen(); //å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸ if (timestamp &lt; lastTimestamp) { throw new RuntimeException( String.format("Clock moved backwards. Refusing to generate id for %d milliseconds", lastTimestamp - timestamp)); } //å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) { sequence = (sequence + 1) &amp; sequenceMask; //æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == 0) { //é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); } } //æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® else { sequence = 0L; } //ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª lastTimestamp = timestamp; //ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) // | (datacenterId &lt;&lt; datacenterIdShift) // | (workerId &lt;&lt; workerIdShift) // | sequence; } /** * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³ * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª * @return å½“å‰æ—¶é—´æˆ³ */ protected long tilNextMillis(long lastTimestamp) { long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) { timestamp = timeGen(); } return timestamp; } /** * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ * @return å½“å‰æ—¶é—´(æ¯«ç§’) */ protected long timeGen() { return System.currentTimeMillis(); } //==============================Test============================================= /** æµ‹è¯• */ public static void main(String[] args) { SnowflakeIdWorker idWorker = new SnowflakeIdWorker(0, 0); for (int i = 0; i &lt; 1000; i++) { long id = idWorker.nextId(); System.out.println(Long.toBinaryString(id)); System.out.println(id); } }} æ•°æ®åº“è‡ªå¢IDï¼ˆFlickerï¼‰ ä¸»è¦æ€è·¯æ˜¯é‡‡ç”¨æ•°æ®åº“è‡ªå¢ID + replace_intoå®ç°å”¯ä¸€IDçš„è·å–ã€‚ 123456create table t_global_id( id bigint(20) unsigned not null auto_increment, stub char(1) not null default '', primary key (id), unique key stub (stub)) engine=MyISAM; 123# æ¯æ¬¡ä¸šåŠ¡å¯ä»¥ä½¿ç”¨ä»¥ä¸‹SQLè¯»å†™MySQLå¾—åˆ°IDå·replace into t_golbal_id(stub) values('a');select last_insert_id(); replace intoè·ŸinsertåŠŸèƒ½ç±»ä¼¼ï¼Œä¸åŒç‚¹åœ¨äºï¼šreplace intoé¦–å…ˆå°è¯•æ’å…¥æ•°æ®åˆ—è¡¨ä¸­ï¼Œå¦‚æœå‘ç°è¡¨ä¸­å·²ç»æœ‰æ­¤è¡Œæ•°æ®ï¼ˆæ ¹æ®ä¸»é”®æˆ–å”¯ä¸€ç´¢å¼•åˆ¤æ–­ï¼‰åˆ™å…ˆåˆ é™¤ï¼Œå†æ’å…¥ã€‚å¦åˆ™ç›´æ¥æ’å…¥æ–°æ•°æ®ã€‚ å½“ç„¶ä¸ºäº†é¿å…æ•°æ®åº“çš„å•ç‚¹æ•…éšœï¼Œæœ€å°‘éœ€è¦ä¸¤ä¸ªæ•°æ®åº“å®ä¾‹ï¼Œé€šè¿‡åŒºåˆ†auto_incrementçš„èµ·å§‹å€¼å’Œæ­¥é•¿æ¥ç”Ÿæˆå¥‡å¶æ•°çš„IDã€‚ æ¯”å¦‚æœ‰ä¸¤å°æœºå™¨ã€‚è®¾ç½®æ­¥é•¿stepä¸º2ï¼ŒServer1çš„åˆå§‹å€¼ä¸º1ï¼ˆ1ï¼Œ3ï¼Œ5ï¼Œ7ï¼Œ9ï¼Œ11â€¦ï¼‰ã€Server2çš„åˆå§‹å€¼ä¸º2ï¼ˆ2ï¼Œ4ï¼Œ6ï¼Œ8ï¼Œ10â€¦ï¼‰å¦‚ä¸‹æ‰€ç¤ºï¼Œä¸ºäº†å®ç°ä¸Šè¿°æ–¹æ¡ˆåˆ†åˆ«è®¾ç½®ä¸¤å°æœºå™¨å¯¹åº”çš„å‚æ•°ï¼ŒServer1ä»1å¼€å§‹å‘å·ï¼ŒServer2ä»2å¼€å§‹å‘å·ï¼Œä¸¤å°æœºå™¨æ¯æ¬¡å‘å·ä¹‹åéƒ½é€’å¢2ã€‚å¦‚ä¸‹ï¼š 1234567Server1ï¼šauto-increment-increment = 2auto-increment-offset = 1Server2ï¼šauto-increment-increment = 2auto-increment-offset = 2 ä¼˜ç‚¹ ç®€å•ã€‚å……åˆ†å€ŸåŠ©æ•°æ®åº“çš„è‡ªå¢IDæœºåˆ¶ï¼Œå¯é æ€§é«˜ï¼Œç”Ÿæˆæœ‰åºçš„IDã€‚ ç¼ºç‚¹ IDç”Ÿæˆä¾èµ–æ•°æ®åº“å•æœºçš„è¯»å†™æ€§èƒ½ã€‚ ä¾èµ–æ•°æ®åº“ï¼Œå½“æ•°æ®åº“å¼‚å¸¸æ—¶æ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚ å¯¹äºMySQLçš„æ€§èƒ½é—®é¢˜ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ¡ˆè§£å†³ï¼š åœ¨åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬å¯ä»¥éƒ¨ç½²Nå°æ•°æ®åº“å®ä¾‹ï¼Œæ¯å°è®¾ç½®æˆä¸åŒçš„åˆå§‹å€¼ï¼Œè‡ªå¢æ­¥é•¿ä¸ºæœºå™¨çš„å°æ•°ã€‚æ¯å°çš„åˆå§‹å€¼åˆ†åˆ«ä¸º1,2,3...Nï¼Œæ­¥é•¿ä¸ºNã€‚ è¿™ç§æ–¹æ¡ˆè™½ç„¶è§£å†³äº†æ€§èƒ½é—®é¢˜ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨å¾ˆå¤§çš„å±€é™æ€§ï¼š ç³»ç»Ÿæ°´å¹³æ‰©å®¹å›°éš¾ï¼šç³»ç»Ÿå®šä¹‰å¥½æ­¥é•¿ä¹‹åï¼Œå¢åŠ æœºå™¨ä¹‹åè°ƒæ•´æ­¥é•¿å›°éš¾ã€‚å¦‚æœè¦æ·»åŠ æœºå™¨æ€ä¹ˆåŠï¼Ÿå‡è®¾ç°åœ¨åªæœ‰ä¸€å°æœºå™¨å‘å·æ˜¯1,2,3,4,5ï¼ˆæ­¥é•¿æ˜¯1ï¼‰ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æ‰©å®¹æœºå™¨ä¸€å°ã€‚å¯ä»¥è¿™æ ·åšï¼šæŠŠç¬¬äºŒå°æœºå™¨çš„åˆå§‹å€¼è®¾ç½®å¾—æ¯”ç¬¬ä¸€å°è¶…è¿‡å¾ˆå¤šï¼Œæ¯”å¦‚14ï¼ˆå‡è®¾åœ¨æ‰©å®¹æ—¶é—´ä¹‹å†…ç¬¬ä¸€å°ä¸å¯èƒ½å‘åˆ°14ï¼‰ï¼ŒåŒæ—¶è®¾ç½®æ­¥é•¿ä¸º2ï¼Œé‚£ä¹ˆè¿™å°æœºå™¨ä¸‹å‘çš„å·ç éƒ½æ˜¯14ä»¥åçš„å¶æ•°ã€‚ç„¶åæ‘˜æ‰ç¬¬ä¸€å°ï¼ŒæŠŠIDå€¼ä¿ç•™ä¸ºå¥‡æ•°ï¼Œæ¯”å¦‚7ï¼Œç„¶åä¿®æ”¹ç¬¬ä¸€å°çš„æ­¥é•¿ä¸º2ã€‚è®©å®ƒç¬¦åˆæˆ‘ä»¬å®šä¹‰çš„å·æ®µæ ‡å‡†ï¼Œå¯¹äºè¿™ä¸ªä¾‹å­æ¥è¯´å°±æ˜¯è®©ç¬¬ä¸€å°ä»¥ååªèƒ½äº§ç”Ÿå¥‡æ•°ã€‚æ‰©å®¹æ–¹æ¡ˆçœ‹èµ·æ¥å¤æ‚å—ï¼Ÿè²Œä¼¼è¿˜å¥½ï¼Œç°åœ¨æƒ³è±¡ä¸€ä¸‹å¦‚æœæˆ‘ä»¬çº¿ä¸Šæœ‰100å°æœºå™¨ï¼Œè¿™ä¸ªæ—¶å€™è¦æ‰©å®¹è¯¥æ€ä¹ˆåšï¼Ÿç®€ç›´æ˜¯å™©æ¢¦ã€‚ æ•°æ®åº“å‹åŠ›å¤§ï¼šæ¯æ¬¡è·å–ä¸€ä¸ªIDéƒ½å¿…é¡»è¯»å†™ä¸€æ¬¡æ•°æ®åº“ã€‚å½“ç„¶å¯¹äºè¿™ç§é—®é¢˜ï¼Œä¹Ÿæœ‰ç›¸åº”çš„è§£å†³æ–¹æ¡ˆï¼Œå°±æ˜¯æ¯æ¬¡è·å–IDæ—¶éƒ½æ‰¹é‡è·å–ä¸€ä¸ªåŒºé—´çš„å·æ®µåˆ°å†…å­˜ä¸­ï¼Œç”¨å®Œä¹‹åå†æ¥è·å–ã€‚æ•°æ®åº“çš„æ€§èƒ½æé«˜äº†å‡ ä¸ªé‡çº§ã€‚ ç¾å›¢çš„Leaf-segment Leaf-segment åœ¨ä½¿ç”¨æ•°æ®åº“çš„æ–¹æ¡ˆä¸Šåšäº†ä¼˜åŒ–ï¼Œåˆ©ç”¨proxy serveræ‰¹é‡è·å–ï¼Œæ¯æ¬¡è·å–ä¸€æ®µIDs(stepå†³å®šå¤§å°)ï¼Œç„¶åæŠŠè¿™æ®µIDsä½œä¸ºidæ± ç¼“å­˜èµ·æ¥ä½¿ç”¨ã€‚ç”¨å®Œä¹‹åå†å»æ•°æ®åº“è·å–æ–°çš„å·æ®µï¼Œä»è€Œå¤§å¤§çš„å‡è½»æ•°æ®åº“çš„å‹åŠ›ã€‚è§£å†³äº†åŸæ–¹æ¡ˆæ¯æ¬¡è·å–IDéƒ½å¾—è¯»å†™ä¸€æ¬¡æ•°æ®åº“ï¼Œé€ æˆæ•°æ®åº“å‹åŠ›å¤§çš„é—®é¢˜ã€‚Leaf-segmentçš„æ€»ä½“æ¶æ„å¦‚ä¸‹ï¼š ä¼˜ç‚¹ LeafæœåŠ¡å¯ä»¥å¾ˆæ–¹ä¾¿çš„çº¿æ€§æ‰©å±•ï¼Œæ€§èƒ½å®Œå…¨èƒ½å¤Ÿæ”¯æ’‘å¤§å¤šæ•°ä¸šåŠ¡åœºæ™¯ã€‚ IDå·ç æ˜¯è¶‹åŠ¿é€’å¢çš„8byteçš„64ä½æ•°å­—ï¼Œæ»¡è¶³ä¸Šè¿°æ•°æ®åº“å­˜å‚¨çš„ä¸»é”®è¦æ±‚ã€‚ å®¹ç¾æ€§é«˜ï¼šLeafæœåŠ¡å†…éƒ¨æœ‰å·æ®µç¼“å­˜ï¼Œå³ä½¿DBå®•æœºï¼ŒçŸ­æ—¶é—´å†…Leafä»èƒ½æ­£å¸¸å¯¹å¤–æä¾›æœåŠ¡ã€‚ å¯ä»¥è‡ªå®šä¹‰max_idçš„å¤§å°ï¼Œéå¸¸æ–¹ä¾¿ä¸šåŠ¡ä»åŸæœ‰çš„IDæ–¹å¼ä¸Šè¿ç§»è¿‡æ¥ã€‚ ç¼ºç‚¹ IDå·ç ä¸å¤Ÿéšæœºï¼Œèƒ½å¤Ÿæ³„éœ²å‘å·æ•°é‡çš„ä¿¡æ¯ï¼Œä¸å¤ªå®‰å…¨ã€‚ TP999æ•°æ®æ³¢åŠ¨å¤§ï¼Œå½“å·æ®µä½¿ç”¨å®Œä¹‹åè¿˜æ˜¯ä¼šhangåœ¨æ›´æ–°æ•°æ®åº“çš„I/Oä¸Šï¼Œtg999æ•°æ®ä¼šå‡ºç°å¶å°”çš„å°–åˆºã€‚ DBå®•æœºä¼šé€ æˆæ•´ä¸ªç³»ç»Ÿä¸å¯ç”¨ã€‚ Leaf-segment å2ç‚¹ç¼ºç‚¹ï¼ŒLeaf-segmentåšäº†åŒbufferä¼˜åŒ–ï¼Œä»¥åŠâ€œä¸€ä¸»ä¸¤ä»â€çš„é«˜å¯ç”¨å®¹ç¾ã€‚ ç¾å›¢çš„Leaf-snowflake Leaf-snowflake æ–¹æ¡ˆå®Œå…¨æ²¿ç”¨snowflakeæ–¹æ¡ˆçš„bitä½è®¾è®¡ï¼Œå³æ˜¯1+41+10+12çš„æ–¹å¼ç»„è£…IDå·ã€‚ç›¸æ¯” snowflakeï¼ŒLeaf-snowflakeåšäº†ä»¥ä¸‹2ç‚¹ä¼˜åŒ–ï¼š ä½¿ç”¨ZookeeperæŒä¹…é¡ºåºèŠ‚ç‚¹çš„ç‰¹æ€§è‡ªåŠ¨å¯¹snowflakeèŠ‚ç‚¹é…ç½®wokerIDï¼Œä¸€å®šç¨‹åº¦çš„æé«˜ç³»ç»Ÿçš„ä¼¸ç¼©æ€§å’Œå®¹é”™æ€§ã€‚ è§£å†³æ—¶é’Ÿå›æ‹¨ä¼šå¯èƒ½å¯¼è‡´ç”Ÿæˆé‡å¤çš„IDå·çš„é—®é¢˜ã€‚ Leaf-snowflakeæ˜¯æŒ‰ç…§ä¸‹é¢å‡ ä¸ªæ­¥éª¤å¯åŠ¨çš„ï¼š å¯åŠ¨Leaf-snowflakeæœåŠ¡ï¼Œè¿æ¥Zookeeperï¼Œåœ¨leaf_foreverçˆ¶èŠ‚ç‚¹ä¸‹æ£€æŸ¥è‡ªå·±æ˜¯å¦å·²ç»æ³¨å†Œè¿‡ï¼ˆæ˜¯å¦æœ‰è¯¥é¡ºåºå­èŠ‚ç‚¹ï¼‰ã€‚ å¦‚æœæœ‰æ³¨å†Œè¿‡ç›´æ¥å–å›è‡ªå·±çš„workerIDï¼ˆzké¡ºåºèŠ‚ç‚¹ç”Ÿæˆçš„intç±»å‹IDå·ï¼‰ï¼Œå¯åŠ¨æœåŠ¡ã€‚ å¦‚æœæ²¡æœ‰æ³¨å†Œè¿‡ï¼Œå°±åœ¨è¯¥çˆ¶èŠ‚ç‚¹ä¸‹é¢åˆ›å»ºä¸€ä¸ªæŒä¹…é¡ºåºèŠ‚ç‚¹ï¼Œåˆ›å»ºæˆåŠŸåå–å›é¡ºåºå·å½“åšè‡ªå·±çš„workerIDå·ï¼Œå¯åŠ¨æœåŠ¡ã€‚ å¾®ä¿¡çš„åºåˆ—å·ç”Ÿæˆå™¨seqsvr seqsvr æ˜¯å¾®ä¿¡çš„ä¸€ä¸ªé«˜å¯ç”¨ã€é«˜å¯é çš„åºåˆ—å·ç”Ÿæˆå™¨ï¼Œåˆ©ç”¨ç”Ÿæˆçš„åºåˆ—å·ï¼Œå®ç°ç»ˆç«¯ä¸åå°çš„æ•°æ®å¢é‡åŒæ­¥æœºåˆ¶ã€‚è¿™å¥—åŒæ­¥æœºåˆ¶ä»ç„¶åœ¨æ¶ˆæ¯æ”¶å‘ã€æœ‹å‹åœˆé€šçŸ¥ã€å¥½å‹æ•°æ®æ›´æ–°ç­‰éœ€è¦æ•°æ®åŒæ­¥çš„åœ°æ–¹å‘æŒ¥ç€æ ¸å¿ƒçš„ä½œç”¨ã€‚seqsvrçš„æ¶æ„å¯ä»¥åˆ†ä¸ºä¸¤å±‚ï¼Œå³StoreSvrå’ŒAllocSvrï¼ˆå­˜å‚¨å±‚å’Œç¼“å­˜ä¸­é—´å±‚ï¼‰ã€‚æ¶æ„å¦‚ä¸‹å›¾ï¼š ä»å‚ç›´æ–¹å‘çœ‹ï¼ŒAllocSvrè´Ÿè´£ç›´æ¥ä¸ºå®¢æˆ·ç«¯åˆ†é…sequenceï¼Œè€ŒStoreSvråˆ™è´Ÿè´£å½“å‰æœ€å¤§sequence numçš„å¯é å­˜å‚¨ï¼ˆé€šè¿‡NRWå®ç°ï¼‰ã€‚è¿™ä¸ªè§’åº¦çœ‹æ¥ï¼Œå’Œç¾å›¢ç‚¹è¯„çš„Leaf-segmentæ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚ä¸»è¦åŒºåˆ«åœ¨äºä¸¤ç‚¹ï¼Œç¬¬ä¸€æ˜¯seqsvräº§ç”Ÿçš„sequenceæ˜¯åœ¨UIDï¼ˆç”¨æˆ·IDï¼‰ä¹‹ä¸‹çš„idï¼Œæ¢è¨€ä¹‹â€”â€”UID + sequence = å…¨å±€IDï¼›ç¬¬äºŒç‚¹æ˜¯seqsvrä½¿ç”¨äº†NRWå®ç°äº†æ•°æ®å­˜å‚¨çš„å¼ºä¸€è‡´æ€§ã€‚ ä»æ°´å¹³æ–¹å‘çœ‹ï¼Œseqsvrä½¿ç”¨UIDè¿›è¡Œäº†æ°´å¹³åˆ‡åˆ†ï¼Œå®ç°äº†è´Ÿè½½å‡è¡¡ã€‚å¯¹å•ä¸€çš„ä¸€ä¸ªsetåˆ†æå¯çŸ¥ï¼ŒAllocSvrå¯ä»¥å®Œå…¨ä»¥è¿è¡Œåœ¨å†…å­˜ä¸­ï¼Œè€Œä¸ç”¨å®ç°æŒä¹…åŒ–ã€‚å› ä¸ºæœ€æ¶åŠ£çš„æƒ…å†µå°±æ˜¯ï¼ŒAllocSvrä¸­ä¸€éƒ¨åˆ†idè¿˜æ²¡æœ‰è¢«æ¶ˆè´¹çš„æƒ…å†µä¸‹å®•æœºäº†ï¼Œé‡å¯ä¹‹ååˆé‡æ–°ç”³è¯·äº†ä¸€æ®µidï¼Œæ‰€ä»¥æœ‰ä¸€éƒ¨åˆ†idè¢«è·³è¿‡äº†ã€‚ç„¶è€Œï¼Œå¾®ä¿¡çš„sequence numæœ‰64ä½ï¼Œè€Œä¸”æ˜¯ä½äºUIDä¹‹ä¸‹çš„ï¼Œæ‰€ä»¥è·³è¿‡ä¸€æ®µidå®Œå…¨å¯ä»¥æ¥å—ã€‚ æ‰€ä»¥ï¼Œseqsvrçš„ä¸»è¦å‹åŠ›è¿˜æ˜¯åœ¨StoreSvrï¼Œå³ä½¿è¿›è¡Œäº†Setåˆ‡åˆ†ï¼ŒNRWå­˜å‚¨æ¨¡å¼ä¾ç„¶è¿˜æ˜¯è¦åœ¨ååé‡ä¸Šä»˜å‡ºä»£ä»·ã€‚å¤§æ¦‚æ˜¯ç»è¿‡äº†è¿›ä¸€æ­¥çš„å®éªŒï¼Œseqsvrè¿›è¡Œäº†è¿›ä¸€æ­¥çš„ä¼˜åŒ–â€”â€”åˆ†æ®µå·å…±äº«å­˜å‚¨ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œmax_seqå°±æ˜¯å½“å‰çš„æœ€å¤§åºåˆ—å·ã€‚ä¸€ç»„ç”¨æˆ·å…±äº«ä¸€ä¸ªmax_seqï¼Œåˆ†ç»„çš„æ–¹å¼ä¾ç„¶æ˜¯ä½¿ç”¨UIDè¿›è¡Œåˆ‡åˆ†ã€‚è¿™æ ·ä¸€æ¥ï¼Œseqsvrä¸­StoreSvrçš„å‹åŠ›å˜å¾—æ›´å°äº†ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœå¤§å®¶çš„æ“ä½œé¢‘ç‡æ˜¯å‡ç­‰çš„ï¼Œé‚£ä¹ˆStoreSvrçš„å†™å…¥å‹åŠ›é™ä¸ºåˆ‡åˆ†ä¹‹å‰çš„1 / Nï¼ˆNä¸ºåˆ†ç»„å†…éƒ¨ç”¨æˆ·çš„æ•°ç›®ï¼‰ã€‚è€Œä¸”StoreSvrå¯¹æ•°æ®çš„è½½å…¥å‹åŠ›ä¹Ÿé™ä½ä¸º1 / Nã€‚ Redisç”Ÿæˆå”¯ä¸€ID Rediså®ç°äº†ä¸€ä¸ªåŸå­æ“ä½œINCRå’ŒINCRBYå®ç°é€’å¢çš„æ“ä½œã€‚å½“ä½¿ç”¨æ•°æ®åº“æ€§èƒ½ä¸å¤Ÿæ—¶ï¼Œå¯ä»¥é‡‡ç”¨Redisæ¥ä»£æ›¿ï¼ŒåŒæ—¶ä½¿ç”¨Redisé›†ç¾¤æ¥æé«˜ååé‡ã€‚ å¯ä»¥åˆå§‹åŒ–æ¯å°Redisçš„åˆå§‹å€¼ä¸º1,2,3,4,5ï¼Œç„¶åæ­¥é•¿ä¸º5ã€‚å„ä¸ªRedisç”Ÿæˆçš„IDä¸ºï¼š 12345Aï¼š1ï¼Œ6ï¼Œ11ï¼Œ16ï¼Œ21Bï¼š2ï¼Œ7ï¼Œ12ï¼Œ17ï¼Œ22Cï¼š3ï¼Œ8ï¼Œ13ï¼Œ18ï¼Œ23Dï¼š4ï¼Œ9ï¼Œ14ï¼Œ19ï¼Œ24Eï¼š5ï¼Œ10ï¼Œ15ï¼Œ20ï¼Œ25 ä¼˜ç‚¹ ä¸ä¾èµ–äºæ•°æ®åº“ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸”æ€§èƒ½ä¼˜äºæ•°æ®åº“ã€‚ æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ©ã€‚ ç¼ºç‚¹ å¦‚æœç³»ç»Ÿä¸­æ²¡æœ‰Redisï¼Œè¿˜éœ€è¦å¼•å…¥æ–°çš„ç»„ä»¶ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ã€‚ éœ€è¦ç¼–ç å’Œé…ç½®çš„å·¥ä½œé‡æ¯”è¾ƒå¤§ã€‚è¿™ä¸ªéƒ½ä¸æ˜¯æœ€å¤§çš„é—®é¢˜ã€‚ Zookeeperç”Ÿæˆå”¯ä¸€ID zookeeperä¸»è¦é€šè¿‡å…¶znodeæ•°æ®ç‰ˆæœ¬æ¥ç”Ÿæˆåºåˆ—å·ï¼Œå¯ä»¥ç”Ÿæˆ32ä½å’Œ64ä½çš„æ•°æ®ç‰ˆæœ¬å·ï¼Œå®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªç‰ˆæœ¬å·æ¥ä½œä¸ºå”¯ä¸€çš„åºåˆ—å·ã€‚ å¾ˆå°‘ä¼šä½¿ç”¨zookeeperæ¥ç”Ÿæˆå”¯ä¸€IDã€‚ä¸»è¦æ˜¯ç”±äºéœ€è¦ä¾èµ–zookeeperï¼Œå¹¶ä¸”æ˜¯å¤šæ­¥è°ƒç”¨APIï¼Œå¦‚æœåœ¨ç«äº‰è¾ƒå¤§çš„æƒ…å†µä¸‹ï¼Œéœ€è¦è€ƒè™‘ä½¿ç”¨åˆ†å¸ƒå¼é”ã€‚å› æ­¤ï¼Œæ€§èƒ½åœ¨é«˜å¹¶å‘çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œä¹Ÿä¸ç”šç†æƒ³ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java-NIO]]></title>
    <url>%2Fposts%2F66138958.html</url>
    <content type="text"><![CDATA[åŸºçŸ³--Path Path æ—¢å¯ä»¥è¡¨ç¤ºä¸€ä¸ªç›®å½•ï¼Œä¹Ÿå¯ä»¥è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶ï¼Œå°±åƒ File é‚£æ ·â€”â€”å½“ç„¶äº†ï¼ŒPath å°±æ˜¯ç”¨æ¥å–ä»£ File çš„ã€‚ 1ï¼‰å¯ä»¥é€šè¿‡ Paths.get() åˆ›å»ºä¸€ä¸ª Path å¯¹è±¡ï¼Œæ­¤æ—¶ Path å¹¶æ²¡æœ‰çœŸæ­£åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºï¼›å‚æ•°æ—¢å¯ä»¥æ˜¯ä¸€ä¸ªæ–‡ä»¶åï¼Œä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç›®å½•åï¼›ç»å¯¹è·¯å¾„æˆ–è€…ç›¸å¯¹è·¯å¾„å‡å¯ã€‚2ï¼‰å¯ä»¥é€šè¿‡ Files.notExists() ç¡®è®¤ Pathï¼ˆç›®å½•æˆ–è€…æ–‡ä»¶ï¼‰ æ˜¯å¦å·²ç»å­˜åœ¨ã€‚3ï¼‰å¯ä»¥é€šè¿‡ Files.createDirectory() åˆ›å»ºç›®å½•ï¼Œæ­¤æ—¶ç›®å½•å·²ç»åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºæˆåŠŸï¼Œå¯é€šè¿‡èµ„æºç®¡ç†å™¨æŸ¥çœ‹åˆ°ã€‚4ï¼‰å¯ä»¥é€šè¿‡ Files.createFile() åˆ›å»ºæ–‡ä»¶ï¼Œæ­¤æ—¶æ–‡ä»¶å·²ç»åœ¨ç‰©ç†ç£ç›˜ä¸Šåˆ›å»ºæˆåŠŸï¼Œå¯é€šè¿‡èµ„æºç®¡ç†å™¨æŸ¥çœ‹åˆ°ã€‚5ï¼‰å¯ä»¥é€šè¿‡ toAbsolutePath() æŸ¥çœ‹ Path çš„ç»å¯¹è·¯å¾„ã€‚6ï¼‰å¯ä»¥é€šè¿‡ resolve() å°† Path è¿æ¥èµ·æ¥ï¼Œå‚æ•°å¯ä»¥æ˜¯ä¸€ä¸ªæ–°çš„ Path å¯¹è±¡ï¼Œä¹Ÿå¯ä»¥æ˜¯å¯¹åº”çš„å­—ç¬¦ä¸²ã€‚ å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.nio;import java.io.IOException;import java.nio.file.Files;import java.nio.file.Path;import java.nio.file.Paths;/** * @author: whb * @description: NIOåŸºçŸ³Pathæµ‹è¯•ç±» */public class PathTest { public static void main(String[] args) { // ç›¸å¯¹è·¯å¾„ Path dir = Paths.get("nioTest"); // è¾“å‡º dir çš„ç»å¯¹è·¯å¾„ System.out.println(dir.toAbsolutePath()); if (Files.notExists(dir)) { try { // å¦‚æœç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºç›®å½• Files.createDirectory(dir); } catch (IOException e1) { e1.printStackTrace(); } } // è¿™æ—¶å€™ nioTest.txt æ–‡ä»¶å¹¶æœªåˆ›å»º // é€šè¿‡ resolve æ–¹æ³•æŠŠ dir å’Œ nioTest.txt é“¾æ¥èµ·æ¥ Path file = dir.resolve("nioTest.txt"); // è¾“å‡º file çš„ç»å¯¹è·¯å¾„ System.out.println(file.toAbsolutePath()); if (Files.notExists(file)) { try { // å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºæ–‡ä»¶ Files.createFile(file); } catch (IOException e) { e.printStackTrace(); } } }} å¦‚æœè¦å°† File è½¬æ¢ä¸º Pathï¼Œå¯ä»¥é€šè¿‡ File ç±»çš„ toPath() æ–¹æ³•å®Œæˆã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12File file = new File("nioTest.txt");Path path = file.toPath(); å¦‚æœè¦å°† Path è½¬æ¢ä¸º Fileï¼Œå¯ä»¥é€šè¿‡ Path ç±»çš„ toFile() æ–¹æ³•å®Œæˆã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12Path path = Paths.get("nioTest.txt");File file = path.toFile(); å¤„ç†ç›®å½• NIO 2.0 æ–°å¢çš„ java.nio.file.DirectoryStream&lt;T&gt; æ¥å£å¯ä»¥éå¸¸æ–¹ä¾¿åœ°æŸ¥æ‰¾ç›®å½•ä¸­çš„ï¼ˆç¬¦åˆæŸç§è§„åˆ™çš„ï¼‰æ–‡ä»¶ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬è¦æŸ¥æ‰¾ nioTest ç›®å½•ä¸‹çš„ txt åç¼€çš„æ–‡ä»¶ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910// ç›¸å¯¹è·¯å¾„Path parentDir = Paths.get("nioTest");try (DirectoryStream&lt;Path&gt; stream = Files.newDirectoryStream(parentDir, "*.txt")) { for (Path entry : stream) { System.out.println(entry.getFileName()); }} catch (IOException e) { e.printStackTrace();} 1ï¼‰Files.newDirectoryStream(Path dir, String glob) ä¼šè¿”å›ä¸€ä¸ªè¿‡æ»¤åçš„ DirectoryStreamï¼ˆ ç›®å½•æµï¼‰ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºç›®å½•ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¸º glob è¡¨è¾¾å¼ï¼Œæ¯”å¦‚ *.txt è¡¨ç¤ºæ‰€æœ‰ txt åç¼€çš„æ–‡ä»¶ã€‚2ï¼‰ç”±äº DirectoryStream ç»§æ‰¿äº† Closeable æ¥å£ï¼Œæ‰€ä»¥å®ƒå¯ä»¥é…åˆ try-with-resources è¯­æ³•å†™å‡ºæ›´å®‰å…¨çš„ä»£ç ï¼Œç›®å½•æµä¼šè‡ªåŠ¨è°ƒç”¨ close æ–¹æ³•å…³é—­æµï¼Œé‡Šæ”¾ä¸æµç›¸å…³çš„èµ„æºï¼Œä¸éœ€è¦å†é€šè¿‡ finally è¿›è¡Œä¸»åŠ¨å…³é—­ã€‚3ï¼‰DirectoryStream è¢«ç§°ä¸ºç›®å½•æµï¼Œå…è®¸æ–¹ä¾¿åœ°ä½¿ç”¨ for-each ç»“æ„æ¥éå†ç›®å½•ã€‚ å¤„ç†ç›®å½•æ ‘ ç›®å½•æ ‘æ„å‘³ç€ä¸€ä¸ªç›®å½•é‡Œæ—¢æœ‰æ–‡ä»¶ä¹Ÿæœ‰å­ç›®å½•ï¼Œä¹Ÿå¯èƒ½éƒ½æ²¡æœ‰ï¼Œä¹Ÿå¯èƒ½æœ‰å…¶ä¸€ã€‚NIO 2.0 å¯ä»¥å¾ˆæ–¹ä¾¿åœ°éå†ä¸€é¢—ç›®å½•æ ‘ï¼Œå¹¶æ“ä½œç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼›è¿™å…¶ä¸­å…³é”®çš„ä¸€ä¸ªæ–¹æ³•å°±æ˜¯ Files ç±»çš„ walkFileTreeï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š 12345678public static Path walkFileTree(Path start, FileVisitor&lt;? super Path&gt; visitor) throws IOException{ return walkFileTree(start, EnumSet.noneOf(FileVisitOption.class), Integer.MAX_VALUE, visitor);} ç¬¬äºŒä¸ªå‚æ•° FileVisitor è¢«ç§°ä¸ºæ–‡ä»¶è®¿é—®å™¨æ¥å£ï¼Œå®ƒå®ç°èµ·æ¥éå¸¸å¤æ‚ï¼Œè¦å®ç° 5 ä¸ªæ–¹æ³•ï¼Œä½†å¹¸å¥½ JDK çš„è®¾è®¡è€…æä¾›äº†ä¸€ä¸ªé»˜è®¤çš„å®ç°ç±» SimpleFileVisitorï¼Œå¦‚æœæˆ‘ä»¬åªæƒ³ä»ç›®å½•æ ‘ä¸­æ‰¾åˆ° txt åç¼€çš„æ–‡ä»¶ï¼Œå¯ä»¥è¿™æ ·åšï¼š 123456789101112131415// ç›¸å¯¹è·¯å¾„dir = Paths.get("nioTest");try { Files.walkFileTree(dir, new SimpleFileVisitor&lt;Path&gt;() { @Override public FileVisitResult visitFile(Path file, BasicFileAttributes attrs) { if (file.toString().endsWith(".txt")) { System.out.println(file.getFileName()); } return FileVisitResult.CONTINUE; } });} catch (IOException e) { e.printStackTrace();} é€šè¿‡åˆ›å»ºåŒ¿åå†…éƒ¨ç±»æ¥é‡å†™ SimpleFileVisitor çš„ visitFile æ–¹æ³•ï¼Œå¦‚æœåç¼€åä¸º txt å°±æ‰“å°å‡ºæ¥ã€‚ æ–‡ä»¶çš„åˆ é™¤ã€å¤åˆ¶ã€ç§»åŠ¨ åˆ é™¤æ–‡ä»¶ åˆ é™¤ä¸€ä¸ªæ–‡ä»¶éå¸¸ç®€å•ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 12Files.delete(file);Files.deleteIfExists(file); ä½¿ç”¨ Files.delete() åˆ é™¤æ–‡ä»¶ä¹‹å‰æœ€å¥½ä½¿ç”¨ Files.exists() åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ï¼Œå¦åˆ™ä¼šæŠ›å‡º NoSuchFileExceptionï¼›Files.deleteIfExists() åˆ™ä¸ç”¨ã€‚ å¤åˆ¶æ–‡ä»¶ å¤åˆ¶æ–‡ä»¶ä¹Ÿä¸å¤æ‚ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123Path source = Paths.get("nioTest.txt");Path target = Paths.get("nioTest1.txt");Files.copy(source, target); ç§»åŠ¨æ–‡ä»¶ ç§»åŠ¨æ–‡ä»¶å’Œå¤åˆ¶æ–‡ä»¶éå¸¸ç›¸ä¼¼ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š 123Path source = Paths.get("nioTest.txt");Path target = Paths.get("nioTest2.txt");Files.move(source, target); å¿«é€Ÿè¯»å†™æ–‡ä»¶ NIO 2.0 æä¾›äº†å¸¦æœ‰ç¼“å†²åŒºçš„è¯»å†™è¾…åŠ©æ–¹æ³•ï¼Œé€šè¿‡ Files.newBufferedWriter() è·å–ä¸€ä¸ªæ–‡ä»¶ç¼“å†²è¾“å…¥æµï¼Œå¹¶é€šè¿‡ write() æ–¹æ³•å†™å…¥æ•°æ®ï¼›ç„¶åé€šè¿‡ Files.newBufferedReader() è·å–ä¸€ä¸ªæ–‡ä»¶ç¼“å†²è¾“å‡ºæµï¼Œé€šè¿‡ readLine() æ–¹æ³•è¯»å‡ºæ•°æ®ã€‚ä»£ç ç¤ºä¾‹å¦‚ä¸‹ã€‚ 1234567891011121314151617Path file = Paths.get("nioPathTest.txt");try (BufferedWriter writer = Files.newBufferedWriter(file, StandardCharsets.UTF_8)) { writer.write("å­¦ä¹ NIOï¼Œå®ç°æ–‡ä»¶çš„å¿«é€Ÿè¯»å†™");} catch (Exception e) { e.printStackTrace();}try (BufferedReader reader = Files.newBufferedReader(file, StandardCharsets.UTF_8)) { String line; while ((line = reader.readLine()) != null) { System.out.println(line); }} catch (Exception e) { e.printStackTrace();} å¼‚æ­¥I/Oæ“ä½œ å¼‚æ­¥ I/O æ“ä½œå¯ä»¥å……åˆ†åˆ©ç”¨å¤šæ ¸ CPU çš„ç‰¹ç‚¹ï¼Œä¸éœ€è¦å†åƒä»¥å‰é‚£æ ·å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥å¯¹ I/O è¿›è¡Œå¤„ç†ï¼Œå…å¾—é˜»å¡äº†ä¸»çº¿ç¨‹çš„å…¶ä»–æ“ä½œã€‚ å¼‚æ­¥ I/O æ“ä½œçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯å‘èµ·éé˜»å¡æ–¹å¼çš„ I/O æ“ä½œï¼Œå½“ I/O æ“ä½œå®Œæˆæ—¶é€šçŸ¥ã€‚å¯ä»¥åˆ†ä¸ºä¸¤ç§å½¢å¼ï¼šFuture å’Œ Callbackã€‚ å¦‚æœå¸Œæœ›ä¸»çº¿ç¨‹å‘èµ· I/O æ“ä½œå¹¶è½®å¾ªç­‰å¾…ç»“æœæ—¶ï¼Œä¸€èˆ¬ä½¿ç”¨ Future çš„å½¢å¼ï¼›è€Œ Callback çš„åŸºæœ¬æ€æƒ³æ˜¯ä¸»çº¿ç¨‹æ´¾å‡ºä¸€ä¸ªä¾¦æŸ¥å‘˜ï¼ˆCompletionHandlerï¼‰åˆ°ç‹¬ç«‹çš„çº¿ç¨‹ä¸­æ‰§è¡Œ I/O æ“ä½œï¼Œæ“ä½œå®Œæˆåï¼Œä¼šè§¦å‘ä¾¦æŸ¥å‘˜çš„ completed æˆ–è€… failed æ–¹æ³•ã€‚ Future ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 1234567891011public static void main(String[] args) throws IOException, InterruptedException, ExecutionException { Path file = Paths.get("nio.txt"); AsynchronousFileChannel channel = AsynchronousFileChannel.open(file); Future&lt;Integer&gt; result = channel.read(ByteBuffer.allocate(100_000), 0); while (!result.isDone()) { System.out.println("ä¸»çº¿ç¨‹ç»§ç»­åšäº‹æƒ…"); } Integer bytesRead = result.get(); System.out.println(bytesRead);} 1ï¼‰é€šè¿‡ AsynchronousFileChannel.open() æ‰“å¼€ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ channelã€‚2ï¼‰ç”¨ Future æ¥ä¿å­˜ä»é€šé“ä¸­è¯»å–çš„ç»“æœã€‚3ï¼‰é€šè¿‡ isDone() è½®å¾ªåˆ¤æ–­å¼‚æ­¥ I/O æ“ä½œæ˜¯å¦å®Œæˆï¼Œå¦‚æœæ²¡æœ‰å®Œæˆçš„è¯ï¼Œä¸»çº¿ç¨‹å¯ä»¥ç»§ç»­åšè‡ªå·±çš„äº‹æƒ…ã€‚ Callback ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415public static void main(String[] args) throws IOException, InterruptedException, ExecutionException { Path file = Paths.get("nio2.txt"); AsynchronousFileChannel channel = AsynchronousFileChannel.open(file); channel.read(ByteBuffer.allocate(100_000), 0, null, new CompletionHandler&lt;Integer, ByteBuffer&gt;() { public void completed(Integer result, ByteBuffer attachment) { System.out.println(result); } public void failed(Throwable exc, ByteBuffer attachment) { System.out.println(exc.getMessage()); } }); System.out.println("ä¸»çº¿ç¨‹ç»§ç»­åšäº‹æƒ…");} 1ï¼‰é€šè¿‡ AsynchronousFileChannel.open() æ‰“å¼€ä¸€ä¸ªå¼‚æ­¥æ–‡ä»¶é€šé“ channelã€‚2ï¼‰åœ¨ read æ–¹æ³•ä¸­ä½¿ç”¨åŒ¿åå†…éƒ¨ç±»çš„å½¢å¼å¯ç”¨ CompletionHandlerï¼Œç„¶åå®ç° CompletionHandler çš„ä¸¤ä¸ªç›‘å¬æ–¹æ³•ï¼Œcompleted çš„æ—¶å€™æ‰“å°ç»“æœï¼Œfailed çš„æ—¶å€™æ‰“å°å¼‚å¸¸ä¿¡æ¯ã€‚ ä¸ç®¡æ˜¯ Future å½¢å¼è¿˜æ˜¯ Callback å½¢å¼ï¼Œæ€»ä¹‹å¼‚æ­¥ I/O æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ï¼Œå¯ä»¥ä¿è¯åœ¨å¤„ç†å¤§æ–‡ä»¶æ—¶æ€§èƒ½ä¸å—åˆ°æ˜¾è‘—çš„å½±å“ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>NIO</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ¬åœ°ä»£ç ä¸Šä¼ åˆ°GitHub]]></title>
    <url>%2Fposts%2Fceff156c.html</url>
    <content type="text"><![CDATA[é¦–å…ˆä½ éœ€è¦ä¸€ä¸ªgithubè´¦å·ï¼Œæ‰€æœ‰è¿˜æ²¡æœ‰çš„è¯å…ˆå»æ³¨å†Œå§ï¼ https://github.com/ æˆ‘ä»¬ä½¿ç”¨gitéœ€è¦å…ˆå®‰è£…gitå·¥å…·ï¼Œè¿™é‡Œç»™å‡ºä¸‹è½½åœ°å€ï¼Œä¸‹è½½åä¸€è·¯ç›´æ¥å®‰è£…å³å¯ï¼š https://git-for-windows.github.io/ è¿›å…¥Githubé¦–é¡µï¼Œç‚¹å‡»New repositoryæ–°å»ºä¸€ä¸ªé¡¹ç›® å¡«å†™ç›¸åº”ä¿¡æ¯åç‚¹å‡»createå³å¯ Repository name: ä»“åº“åç§° Description(å¯é€‰): ä»“åº“æè¿°ä»‹ç» Public,&nbsp;Private&nbsp;: ä»“åº“æƒé™ï¼ˆå…¬å¼€å…±äº«ï¼Œç§æœ‰æˆ–æŒ‡å®šåˆä½œè€…ï¼‰ Initialize this repository with a README: æ·»åŠ ä¸€ä¸ªREADME.md gitignore: ä¸éœ€è¦è¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„ä»“åº“ç±»å‹ï¼Œå¯¹åº”ç”Ÿæˆæ–‡ä»¶.gitignore license: è¯ä¹¦ç±»å‹ï¼Œå¯¹åº”ç”Ÿæˆæ–‡ä»¶LICENSE ç‚¹å‡»Clone or dowloadä¼šå‡ºç°ä¸€ä¸ªåœ°å€ï¼Œcopyè¿™ä¸ªåœ°å€å¤‡ç”¨ã€‚ æ¥ä¸‹æ¥å°±åˆ°æœ¬åœ°æ“ä½œäº†ï¼Œé¦–å…ˆé¼ æ ‡å³é”®ï¼Œå¦‚æœä½ ä¹‹å‰å®‰è£…gitæˆåŠŸçš„è¯ï¼Œå³é”®ä¼šå‡ºç°ä¸¤ä¸ªæ–°é€‰é¡¹ï¼Œåˆ†åˆ«ä¸ºGit Gui Here,Git Bash Here,è¿™é‡Œæˆ‘ä»¬é€‰æ‹©Git Bash Hereï¼Œè¿›å…¥å¦‚ä¸‹ç•Œé¢ï¼š æ¥ä¸‹æ¥è¾“å…¥å¦‚ä¸‹ä»£ç ï¼ˆå…³é”®æ­¥éª¤ï¼‰ï¼ŒæŠŠgithubä¸Šé¢çš„ä»“åº“å…‹éš†åˆ°æœ¬åœ° 1git clone https://github.com/whb1990/blogSourceCode.git åœ°å€æ¢æˆä½ è‡ªå·±çš„ã€‚ è¿™ä¸ªæ­¥éª¤ä»¥åä½ çš„æœ¬åœ°é¡¹ç›®æ–‡ä»¶å¤¹ä¸‹é¢å°±ä¼šå¤šå‡ºä¸ªæ–‡ä»¶å¤¹ï¼Œè¯¥æ–‡ä»¶å¤¹åå³ä¸ºä½ githubä¸Šé¢çš„é¡¹ç›®åï¼Œå¦‚å›¾æˆ‘å¤šå‡ºäº†ä¸ªblogSourceCodeæ–‡ä»¶å¤¹ï¼Œæˆ‘ä»¬æŠŠæœ¬åœ°éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶éƒ½å¤åˆ¶åˆ°è¯¥æ–‡ä»¶å¤¹ä¸‹ï¼š æ¥ç€ç»§ç»­è¾“å…¥å‘½ä»¤ cd blogSourceCodeï¼Œè¿›å…¥ blogSourceCode æ–‡ä»¶å¤¹ æ¥ä¸‹æ¥ä¾æ¬¡è¾“å…¥ä»¥ä¸‹ä»£ç å³å¯å®Œæˆå…¶ä»–å‰©ä½™æ“ä½œï¼š git add . &nbsp; &nbsp; &nbsp; &nbsp;ï¼ˆæ³¨ï¼šåˆ«å¿˜è®°åé¢çš„.ï¼Œæ­¤æ“ä½œæ˜¯æŠŠblogSourceCodeæ–‡ä»¶å¤¹ä¸‹é¢çš„æ–‡ä»¶éƒ½æ·»åŠ è¿›æ¥ï¼‰ æ‰§è¡Œå®Œè¯¥å‘½ä»¤å¯ä»¥çœ‹åˆ°æœ‰å¦‚ä¸‹æç¤ºä¿¡æ¯ï¼š è¿™ä¸ªæç¤ºçš„å¤§è‡´æ„æ€å°±æ˜¯ï¼š 1234567æ‚¨å·²ç»åœ¨å½“å‰å­˜å‚¨åº“ä¸­æ·»åŠ äº†å¦ä¸€ä¸ªGitå­˜å‚¨åº“ã€‚å¤–éƒ¨å­˜å‚¨åº“çš„å…‹éš†å°†ä¸åŒ…å«åµŒå…¥å­˜å‚¨åº“çš„å†…å®¹ï¼Œä¹Ÿä¸çŸ¥é“å¦‚ä½•è·å–å®ƒã€‚å¦‚æœè¦æ·»åŠ å­æ¨¡å—ï¼Œè¯·ä½¿ç”¨ï¼š git submodule add &lt;url&gt; themes/nextå¦‚æœé”™è¯¯åœ°æ·»åŠ äº†æ­¤è·¯å¾„ï¼Œåˆ™å¯ä»¥ä½¿ç”¨ git rm --cached themes/next å› ä¸ºè¿™ä¸ªé¡¹ç›®æ˜¯æˆ‘ç”¨Hexoæ­å»ºçš„ä¸ªäººåšå®¢ï¼Œç”¨åˆ°äº†Nextä¸»é¢˜(å¦ä¸€ä¸ªGitå­˜å‚¨åº“)ï¼Œä¸Šé¢çš„æç¤ºä¹Ÿå‘Šè¯‰äº†æˆ‘ä»¬è¯¥æ€ä¹ˆåšï¼Œå…¶å®é™¤äº†ä¸Šé¢ä¸¤ç§æ–¹å¼ï¼Œè¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯ç›´æ¥åˆ é™¤ä½ è¦åŒ…å«çš„å­åº“ç›®å½•ä¸‹çš„.gitæ–‡ä»¶å¤¹å³å¯ã€‚ git commit &nbsp;-m &nbsp;"æäº¤ä¿¡æ¯" &nbsp;ï¼ˆæ³¨ï¼šâ€œæäº¤ä¿¡æ¯â€é‡Œé¢æ¢æˆä½ éœ€è¦ï¼Œå¦‚â€œfirst commitâ€ï¼‰ git push -u origin master &nbsp; ï¼ˆæ³¨ï¼šæ­¤æ“ä½œç›®çš„æ˜¯æŠŠæœ¬åœ°ä»“åº“pushåˆ°githubä¸Šé¢ï¼Œæ­¤æ­¥éª¤éœ€è¦ä½ è¾“å…¥å¸å·å’Œå¯†ç ï¼‰ å»GitHubä¸Šçœ‹ä¸‹ä¸Šä¼ åçš„ä»£ç  é—®é¢˜è§£å†³ï¼š åœ¨ä¸Šä¼ ä»£ç åˆ°GitHubçš„æ—¶å€™ï¼Œæç¤ºå¦‚ä¸‹é”™è¯¯ï¼š åŸå› æ˜¯æ¨é€çš„æ–‡ä»¶å¤ªå¤§ã€‚æˆ‘è¿™æ¬¡æ¨é€çš„å†…å®¹è¶…è¿‡çš„1Gï¼Œæ‰€ä»¥æŠ¥é”™äº†ã€‚ æ–¹æ³•ä¸€ï¼š ä¿®æ”¹æäº¤ç¼“å­˜å¤§å°ä¸º5000Mï¼Œæˆ–è€…æ›´å¤§çš„æ•°å­— 1git config --global http.postBuffer 5242880000 --globalé…ç½®å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¦‚æœéœ€è¦å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œåˆ™ç”¨--system æˆ–è€…åœ¨å…‹éš†/åˆ›å»ºç‰ˆæœ¬åº“ç”Ÿæˆçš„ .gitç›®å½•ä¸‹é¢ä¿®æ”¹ç”Ÿæˆçš„configæ–‡ä»¶å¢åŠ å¦‚ä¸‹ï¼š 12[http] postBuffer = 524288000 æ–¹æ³•äºŒï¼š é…ç½®gitçš„æœ€ä½é€Ÿåº¦å’Œæœ€ä½é€Ÿåº¦æ—¶é—´ï¼š 12git config --global http.lowSpeedLimit 0git config --global http.lowSpeedTime 999999 å•ä½ ç§’ --globalé…ç½®å¯¹å½“å‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œå¦‚æœéœ€è¦å¯¹æ‰€æœ‰ç”¨æˆ·ç”Ÿæ•ˆï¼Œåˆ™ç”¨--system æˆ‘æ˜¯é€‰æ‹©çš„æ–¹æ³•ä¸€ï¼Œè§£å†³æ•ˆæœå¦‚ä¸‹ï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>Git</tag>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexo live2dæ’ä»¶æ•ˆæœé¢„è§ˆ]]></title>
    <url>%2Fposts%2Ffcf4ee5f.html</url>
    <content type="text"><![CDATA[Epsilon2.1 Gantzert_Felixander haru miku ni-j nico nietzche nipsilon nito shizuku tsumiki wanko z16 hibiki koharu haruto Unitychan tororo hijiki document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -Sessionä¸¢å¤±åŠè§£å†³]]></title>
    <url>%2Fposts%2F223e2ff2.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯Sessionä¸¢å¤± Sessionæ˜¯ä¸ºäº†å°†åŒä¸€ä¸ªç”¨æˆ·çš„å¤šæ¬¡è®¿é—®åœ¨ç³»ç»Ÿä¸­è¢«è¯†åˆ«ä¸ºâ€œåŒä¸€ä¸ªç”¨æˆ·â€è€Œäº§ç”Ÿçš„æ¦‚å¿µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜å¯ä»¥åŸºäºå®ƒæ¥å‡å°‘é‡å¤å¾€DBæˆ–è€…è¿œç¨‹æœåŠ¡å¤„è·å–ä¸è¯¥ç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ï¼Œä»¥èµ·åˆ°æå‡æ€§èƒ½çš„ä½œç”¨ã€‚ åœ¨åšäº†è´Ÿè½½å‡è¡¡çš„åœºæ™¯ä¸­ï¼Œå¦‚æœé€‰æ‹©çš„è´Ÿè½½ç­–ç•¥æ˜¯hashç­–ç•¥ï¼Œé‚£ä¹ˆä¼šä½¿å¾—Sessionäº§ç”Ÿä¸€ä¸ªå‰¯ä½œç”¨ï¼šç”¨æˆ·ä¸€æ—¦ç”±äºæŸç§åŸå› ä»åŸå…ˆè®¿é—®æœåŠ¡å™¨Aå˜æˆè®¿é—®æœåŠ¡å™¨Bï¼Œå°±ä¼šå‡ºç°â€œç™»é™†çŠ¶æ€ä¸¢å¤±â€ã€â€œç¼“å­˜ç©¿é€â€ç­‰é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆhashç­–ç•¥ä¼šå‡ºç°è¿™ä¸ªé—®é¢˜å‘¢ï¼Ÿé¦–å…ˆæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹hashæ˜¯å¦‚ä½•è¿›è¡Œçš„ã€‚hashç­–ç•¥å°±æ˜¯ä¸‹å›¾è¿™æ ·çš„ä¸€ä¸ªæ•£åˆ—å‡½æ•°ã€‚åœ¨å‡½æ•°ä¸å˜çš„æƒ…å†µä¸‹ï¼ŒAæ°¸è¿œå¯¹åº”01ï¼ŒBå¯¹åº”04ï¼ŒCå¯¹åº”08ã€‚ ä»¥nginxä¸­çš„ip_hashç­–ç•¥æ¥ä¸¾ä¸ªä¾‹å­ã€‚æ­£å¸¸æƒ…å†µä¸‹ç”¨æˆ·çš„ipä¸ä¼šåœ¨çŸ­æ—¶é—´å†…å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥å½“ä½¿ç”¨ip_hashç­–ç•¥è¿›è¡Œè´Ÿè½½å‡è¡¡æ—¶ï¼Œæ„å‘³ç€æœŸæœ›åŒä¸€ä¸ªç”¨æˆ·èƒ½å¤Ÿä¸€ç›´è®¿é—®åˆ°åŒä¸€å°æœåŠ¡å™¨ä¸Šï¼Œå°±åƒä¸‹å›¾è¿™æ ·ã€‚ å¦‚æ­¤ä¸€æ¥ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨è¿™ä¸€å°æœåŠ¡å™¨ä¸Šå°†è¿™ä¸ªç”¨æˆ·ç›¸å…³çš„ä¿¡æ¯ç¼“å­˜åœ¨è¿›ç¨‹å†…ï¼Œè¿™æ—¶ï¼Œå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯ä¹‹é—´çš„ç›¸å½“äºå»ºç«‹äº†ä¸€ä¸ªä¿¡ä»»ï¼Œç›¸äº’è®¤è¯†ã€‚è¿™ä¸ªä¿¡ä»»å°±æ˜¯ã€ŒSessionã€ã€‚ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬åŠ äº†ä¸€å°æœåŠ¡å™¨ä¹‹åï¼Œäº‹æƒ…å°±å‘ç”Ÿå˜åŒ–äº†ã€‚ è¿™ä¸ªæ—¶å€™åŸå…ˆçš„é¢„æœŸå°±è¢«ç ´åäº†ã€‚å› ä¸ºç”¨æˆ·ä¸åºå·0èŠ‚ç‚¹çš„é“¾æ¥å˜æˆäº†ä¸åºå·3çš„é“¾æ¥ï¼Œæ‰€ä»¥äº§ç”Ÿäº†Sessionä¸¢å¤±é—®é¢˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨åºå·0èŠ‚ç‚¹ä¸Šåšçš„è¿›ç¨‹å†…ç¼“å­˜éƒ½æ— æ•ˆäº†ï¼Œè€Œåœ¨åºå·3èŠ‚ç‚¹ä¸Šåˆæ²¡æœ‰ç”¨æˆ·ç›¸å…³çš„ä»»ä½•ç¼“å­˜ï¼Œå¯¼è‡´å¤§é‡æ•°æ®éœ€è¦ä»ä¸‹æ¸¸çš„DBæˆ–è€…è¿œç¨‹æœåŠ¡å¤„è·å–ã€‚è¦çŸ¥é“ï¼Œä¸€æ—¦æ¶‰åŠåˆ°ç½‘ç»œé€šä¿¡ï¼Œæ€§èƒ½å¿…ç„¶æ˜æ˜¾ä¸‹é™ï¼ŒI/Oã€åºåˆ—åŒ–éƒ½æ˜¯è€—æ—¶çš„å·¥ä½œã€‚æ›´é‡è¦çš„æ˜¯ï¼Œä¸€æ—¦åŒæ—¶æœ‰å¤§é‡ç”¨æˆ·äº§ç”Ÿè¿™ä¸ªæƒ…å†µï¼Œç”±äºåç«¯çš„DBå’Œè¿œç¨‹æœåŠ¡ç¬æ—¶æ— æ³•æ‰¿è½½æ¿€å¢çš„é«˜å¯†åº¦è¯·æ±‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®ƒæŒ‚èµ·ã€‚è¿™è¿˜æ²¡å®Œï¼Œå¦‚æœå½“å‰ç¨‹åºæ²¡æœ‰ä¸€äº›æ•…éšœéš”ç¦»æˆ–è€…é™çº§ç­–ç•¥ï¼Œè¿˜ä¼šè¿›ä¸€æ­¥äº§ç”Ÿè´è¶æ•ˆåº”ï¼Œå¯¼è‡´æ•´ä¸ªå¤§ç³»ç»Ÿå“åº”ç¼“æ…¢ã€‚ nginxæ˜¯å¦‚ä½•è§£å†³çš„ é€šè¿‡åœ¨nginxä¸­å¼•å…¥nginx-sticky-moduleæ¨¡å—å¯ä»¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è§£å†³çš„æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œå½“clientç¬¬ä¸€æ¬¡è¿›å…¥åˆ°nginxåŒ¹é…èŠ‚ç‚¹çš„æ—¶å€™ï¼Œåœ¨ç»™å®ƒåˆ†é…ä¸€ä¸ªèŠ‚ç‚¹çš„åŒæ—¶ï¼Œä¼šå°†è¿™ä¸ªèŠ‚ç‚¹çš„å”¯ä¸€æ ‡è¯†è¿›è¡Œmd5åå†™å…¥åˆ°cookieä¸­ä¸€å¹¶è¿”å›ï¼Œå¦‚æœä¸‹æ¬¡å†å‘èµ·è¯·æ±‚çš„æ—¶å€™å‘ç°å¸¦æœ‰è¿™ä¸ªcookieå€¼ï¼Œå°±ç›´æ¥è½¬å‘åˆ°è¯¥å€¼æ‰€å¯¹åº”çš„èŠ‚ç‚¹ä¸Šå»ã€‚è¿™ä¸ªæœºåˆ¶è¢«ä¸“ä¸šçš„ç§°ä¹‹ä¸ºã€ŒSessionä¿æŒã€ã€‚ è™½ç„¶å¯ä»¥åˆ©ç”¨cookieæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä½†æ˜¯cookieä¹Ÿæœ‰ä¸€ä¸ªæ½œåœ¨çš„é—®é¢˜ï¼Œå¦‚æœå®¢æˆ·ç«¯æœªå¼€å¯cookieåŠŸèƒ½ï¼Œè¿™ä¸ªæœºåˆ¶å°±å¤±æ•ˆäº†ã€‚ä¸è¿‡å¥½åœ¨ç›®å‰ä¸»æµæµè§ˆå™¨éƒ½æ˜¯é»˜è®¤æ‰“å¼€cookieçš„ã€‚ å…¶ä»–è§£å†³æ–¹æ¡ˆ Sessionå¤åˆ¶ è¿™æ˜¯æœ€ç®€å•ç²—æš´çš„æ–¹å¼ã€‚æ ¹æ®ä¸Šé¢çš„æ¡ˆä¾‹æ¥çœ‹ï¼Œå¯¼è‡´é—®é¢˜çš„åŸå› æ˜¯èŠ‚ç‚¹3æ²¡æœ‰ç”¨æˆ·çš„Sessionã€‚é‚£ä¹ˆå¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œåœ¨èŠ‚ç‚¹3è¿è¡Œä¹‹å‰æŠŠSessionç›¸å…³çš„Cacheæ•°æ®å¤åˆ¶è¿‡å»ï¼Œå¹¶ä¸”åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´æŒç»­ä¿è¯æ•°æ®çš„åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ¯ä¸€å°èŠ‚ç‚¹ä¸Šéƒ½å­˜åœ¨æ¯ä¸ªç”¨æˆ·çš„Sessionæ•°æ®ã€‚ å®ç°çš„æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œç‰¹åˆ«æ˜¯ä¸åŒçš„å®¿ä¸»ç¨‹åºéƒ½æˆ–å¤šæˆ–å°‘æä¾›äº†ä¸€äº›åˆ‡å…¥ç‚¹ï¼Œç”šè‡³æ˜¯æ‹¿æ¥å³ç”¨çš„æ–¹æ¡ˆï¼Œå¦‚Tomcatçš„Delta Managerå’ŒBackup Managerã€Tomcatå’ŒIISçš„Filteræœºåˆ¶ç­‰ç­‰ã€‚æ­¤ç±»æ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ ä¼˜ç‚¹ï¼šå¤©ç„¶é«˜å¯ç”¨ï¼Œä¸€éƒ¨åˆ†èŠ‚ç‚¹å®•æœºæ²¡äº‹ã€‚å› ä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šå­˜æ”¾ç€æ‰€æœ‰å·²è¿æ¥ç”¨æˆ·çš„ä¼šè¯ä¿¡æ¯ã€‚ ç¼ºç‚¹ï¼šå› ä¸ºæ¯å°è®¡ç®—æœºçš„å†…å­˜æ˜¯æœ‰ä¸Šé™çš„ï¼Œä»…é€‚ç”¨äºä¼šè¯ç›¸å…³çš„æ•°æ®å¤§å°è¾ƒå°çš„åœºæ™¯ã€‚å¹¶ä¸”ï¼Œç”±äºå¤šä¸ªèŠ‚ç‚¹ä¹‹é—´éœ€è¦åŒæ­¥æ•°æ®ï¼Œéœ€è¦é¢å¤–è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ä¸æ­¤åŒæ—¶ï¼Œéšç€èŠ‚ç‚¹è¶Šå¤šï¼ŒæŸè€—è¶Šå¤§ï¼ˆå»¶è¿Ÿã€å¸¦å®½ç­‰ï¼‰ï¼Œæœ‰å¹¿æ’­é£æš´é£é™©ã€‚ Sessionå…±äº« é€šè¿‡å°†sessionä¿¡æ¯å­˜æ”¾åˆ°å…¨å±€å…±äº«çš„å­˜å‚¨ä»‹è´¨ä¸­æ¥è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœï¼Œå¦‚æ•°æ®åº“ã€è¿œç¨‹ç¼“å­˜ç­‰ï¼Œè¿™æ˜¯ä¸€ç§ä¸­å¿ƒåŒ–æ€æƒ³çš„è§£å†³æ–¹æ¡ˆã€‚ æ­¤ç±»æ–¹æ¡ˆçš„ç‰¹ç‚¹æ˜¯ï¼š ä¼˜ç‚¹ï¼šä¸ç®¡èŠ‚ç‚¹æ€ä¹ˆå¢åŠ å’Œå‡å°‘ï¼Œ100%ä¸ä¼šäº§ç”Ÿä¼šè¯ä¸¢å¤±ã€‚ ç¼ºç‚¹ï¼šæ¯æ¬¡è¯»å†™è¯·æ±‚éƒ½éœ€è¦å¢åŠ é¢å¤–å…±äº«å‚¨å­˜è°ƒç”¨ï¼Œå¢åŠ äº†ç½‘ç»œI/Oã€åºåˆ—åŒ–ç­‰æ“ä½œï¼Œæ€§èƒ½æ˜æ˜¾ä¸‹é™ã€‚å¦å¤–ï¼Œç”¨ä½œå…±äº«çš„å­˜å‚¨ä»‹è´¨é™¤äº†å¢åŠ äº†é¢å¤–çš„ç»´æŠ¤æˆæœ¬å¤–ï¼Œè¿˜éœ€è¦è§£å†³å•ç‚¹é—®é¢˜ï¼Œä»¥å…äº§ç”Ÿç³»ç»Ÿæ€§é£é™©ã€‚ ä¸‰ç§æ–¹æ¡ˆå¯¹æ¯” åˆ†åˆ«ç”¨ä¸€å¥è¯æ¦‚æ‹¬ä¸€ä¸‹è¿™3ä¸ªæ–¹æ¡ˆï¼š Session ä¿æŒï¼šåŸæ¥åœ¨å“ªè¿˜æ˜¯å»å“ªã€‚ Session å¤åˆ¶ï¼šä¸ç®¡åœ¨å“ªéƒ½æœ‰ä¸€æ ·çš„æ•°æ®ã€‚ Session å…±äº«ï¼šæ‰€æœ‰èŠ‚ç‚¹å…±ç”¨ä¸€ä»½æ•°æ®ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -è´Ÿè½½å‡è¡¡]]></title>
    <url>%2Fposts%2F95c2b1da.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åˆ†å¸ƒå¼ç³»ç»Ÿçš„å…³é”®æ˜¯åšå†—ä½™ï¼Œè®©è¿™äº›å†—ä½™èƒ½å‘æŒ¥é«˜å¯ç”¨ä½œç”¨çš„å°±æ˜¯è´Ÿè½½å‡è¡¡ã€‚è´Ÿè½½å‡è¡¡çš„ä½œç”¨æ˜¯ä¸€ä¸ªâ€œè¿æ¥è€…â€ï¼Œè®©ä¸Šä¸‹æ¸¸ä¹‹é—´ä»¥æœŸæœ›çš„æ–¹å¼â€œè¿æ¥â€èµ·æ¥ã€‚æ‰€ä»¥ï¼Œæœ‰å¿…è¦å…ˆäº†è§£ä¸€ä¸‹è¿™äº›ä¸Šä¸‹æ¸¸çš„å…¨è²Œï¼Œå¹¶ä¸”ä»ä¸­æ‰¾åˆ°åšè´Ÿè½½å‡è¡¡çš„åœ°æ–¹ã€‚ åˆ†å¸ƒå¼ç³»ç»Ÿæœ‰å„å¼å„æ ·çš„æ¶æ„æ–¹å¼ï¼Œä¸è¿‡æœ¬è´¨ä¸Šéƒ½æ˜¯ä¸Šå›¾è¿™æ ·çš„ä¸€ä¸ªåˆ†å±‚æ¶æ„ã€‚å›¾ä¸­çº¢ç‚¹æ ‡è®°å‡ºçš„åœ°æ–¹å°±æ˜¯éœ€è¦åšè´Ÿè½½å‡è¡¡çš„åœ°æ–¹ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œå°±æ˜¯æ¯ä¸¤å±‚ä¹‹é—´çš„è¿æ¥å¤„ã€‚è¿™äº›è¿æ¥å¤„åœ¨å®é™…åšè´Ÿè½½å‡è¡¡çš„æ—¶å€™ï¼Œéœ€è¦ç»“åˆæ‰€å¤„çš„ç½‘ç»œå±‚æ¬¡ã€‚å› ä¸ºåœ¨ä¸åŒçš„ç½‘ç»œå±‚æ¬¡æœ‰ä¸åŒçš„åšæ³•ã€‚å¦‚ä¸‹å›¾ã€‚ ä¸€èˆ¬ä¸»æµçš„å››å±‚è´Ÿè½½å‡è¡¡å’Œä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œå‰è€…æŒ‡çš„å°±æ˜¯ä¼ è¾“å±‚ï¼Œä¸»è¦æ¶‰åŠçš„åè®®æ˜¯TCPã€UDPç­‰ï¼Œåè€…æŒ‡çš„åº”ç”¨å±‚ï¼Œä¸»è¦æ¶‰åŠçš„åè®®æ˜¯Httpã€Httpså’ŒFTPç­‰ã€‚ ç”¨æ¥å®ç°è´Ÿè½½å‡è¡¡çš„è§£å†³æ–¹æ¡ˆæœ‰å¾ˆå¤šï¼Œåˆ†ä¸ºåŸºäºç¡¬ä»¶æˆ–è€…åŸºäºè½¯ä»¶çš„ï¼Œæ¯”è¾ƒæˆç†Ÿçš„è¯¸å¦‚ï¼šF5ï¼ˆæ”¯æŒå››å±‚ã€ä¸ƒå±‚ï¼‰ã€LVSï¼ˆæ”¯æŒå››å±‚ï¼‰ã€Nginxï¼ˆæ”¯æŒä¸ƒå±‚ï¼‰ç­‰ç­‰ã€‚ å¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ è½®è¯¢ è¿™æ˜¯æœ€å¸¸ç”¨ä¹Ÿæœ€ç®€å•ç­–ç•¥ï¼Œå¹³å‡åˆ†é…ï¼Œäººäººéƒ½æœ‰ã€ä¸€äººä¸€æ¬¡ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234567891011int globalIndex = 0; try{ return servers[globalIndex];}finally{ globalIndex++; if (globalIndex == 3) globalIndex = 0;} åŠ æƒè½®è¯¢ åœ¨è½®è¯¢çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€ä¸ªæƒé‡çš„æ¦‚å¿µã€‚æƒé‡æ˜¯ä¸€ä¸ªæ³›åŒ–åçš„æ¦‚å¿µï¼Œå¯ä»¥ç”¨ä»»æ„æ–¹å¼æ¥ä½“ç°ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªèƒ½è€…å¤šåŠ³æ€æƒ³ã€‚æ¯”å¦‚ï¼Œå¯ä»¥æ ¹æ®å®¿ä¸»çš„æ€§èƒ½å·®å¼‚é…ç½®ä¸åŒçš„æƒé‡ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234567891011121314151617int matchedIndex = -1;int total = 0;for (int i = 0; i &lt; servers.Length; i++){ //æ¯æ¬¡å¾ªç¯çš„æ—¶å€™åšè‡ªå¢ï¼ˆæ­¥é•¿=æƒé‡å€¼ï¼‰ servers[i].cur_weight += servers[i].weight; //å°†æ¯ä¸ªèŠ‚ç‚¹çš„æƒé‡å€¼ç´¯åŠ åˆ°æ±‡æ€»å€¼ä¸­ total += servers[i].weight; //å¦‚æœ å½“å‰èŠ‚ç‚¹çš„è‡ªå¢æ•° &gt; å½“å‰å¾…è¿”å›èŠ‚ç‚¹çš„è‡ªå¢æ•°ï¼Œåˆ™è¦†ç›–ã€‚ if (matchedIndex == -1 || servers[matchedIndex].cur_weight &lt; servers[i].cur_weight) { matchedIndex = i; }}servers[matchedIndex].cur_weight -= total;//â‘£è¢«é€‰å–çš„èŠ‚ç‚¹å‡å»â‘¡çš„æ±‡æ€»å€¼ï¼Œä»¥é™ä½ä¸‹ä¸€æ¬¡è¢«é€‰ä¸¾æ—¶çš„åˆå§‹æƒé‡å€¼ã€‚return servers[matchedIndex]; è¿™æ®µä»£ç çš„è¿‡ç¨‹å¦‚ä¸‹å›¾çš„è¡¨æ ¼ã€‚"()"ä¸­çš„æ•°å­—å°±æ˜¯è‡ªå¢æ•°ï¼Œä»£ç ä¸­çš„cur_weightã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼ŒåŠ æƒè½®è¯¢æœ¬èº«è¿˜æœ‰ä¸åŒçš„å®ç°æ–¹å¼ï¼Œè™½è¯´æœ€ç»ˆçš„æ¯”ä¾‹éƒ½æ˜¯2ï¼š1ï¼š2ã€‚ä½†æ˜¯åœ¨è¯·æ±‚é€è¾¾çš„å…ˆåé¡ºåºä¸Šå¯ä»¥æ‰€æœ‰ä¸åŒã€‚æ¯”å¦‚ã€Œ5-4ï¼Œ3ï¼Œ2-1ã€å’Œä¸Šé¢çš„æ¡ˆä¾‹ç›¸æ¯”ï¼Œæœ€ç»ˆæ¯”ä¾‹æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯æ•ˆæœä¸åŒã€‚ã€Œ5-4ï¼Œ3ï¼Œ2-1ã€æ›´å®¹æ˜“äº§ç”Ÿå¹¶å‘é—®é¢˜ï¼Œå¯¼è‡´æœåŠ¡ç«¯æ‹¥å¡ï¼Œä¸”è¿™ä¸ªé—®é¢˜éšç€æƒé‡æ•°å­—è¶Šå¤§è¶Šä¸¥é‡ã€‚ä¾‹å­ï¼š10ï¼š5ï¼š3çš„ç»“æœæ˜¯ã€Œ18-17-16-15-14-13-12-11-10-9ï¼Œ8-7-6-5-4ï¼Œ3-2-1ã€ æœ€å°‘è¿æ¥æ•° è¿™æ˜¯ä¸€ç§æ ¹æ®å®æ—¶çš„è´Ÿè½½æƒ…å†µï¼Œè¿›è¡ŒåŠ¨æ€è´Ÿè½½å‡è¡¡çš„æ–¹å¼ã€‚ç»´æŠ¤å¥½æ´»åŠ¨ä¸­çš„è¿æ¥æ•°é‡ï¼Œç„¶åå–æœ€å°çš„è¿”å›å³å¯ã€‚å¤§è‡´çš„ä»£ç å¦‚ä¸‹ã€‚ 1234var matchedServer = servers.orderBy(e =&gt; e.active_conns).first();matchedServer.active_conns += 1;return matchedServer;//åœ¨è¿æ¥å…³é—­æ—¶è¿˜éœ€å¯¹active_connsåšå‡1çš„åŠ¨ä½œã€‚ æœ€å¿«å“åº” è¿™ä¹Ÿæ˜¯ä¸€ç§åŠ¨æ€è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œå®ƒçš„æœ¬è´¨æ˜¯æ ¹æ®æ¯ä¸ªèŠ‚ç‚¹å¯¹è¿‡å»ä¸€æ®µæ—¶é—´å†…çš„å“åº”æƒ…å†µæ¥åˆ†é…ï¼Œå“åº”è¶Šå¿«åˆ†é…çš„è¶Šå¤šã€‚å…·ä½“çš„è¿ä½œæ–¹å¼ä¹Ÿæœ‰å¾ˆå¤šï¼Œä¸Šå›¾çš„è¿™ç§å¯ä»¥ç†è§£ä¸ºï¼Œå°†æœ€è¿‘ä¸€æ®µæ—¶é—´çš„è¯·æ±‚è€—æ—¶çš„å¹³å‡å€¼è®°å½•ä¸‹æ¥ï¼Œç»“åˆå‰é¢çš„ã€ŒåŠ æƒè½®è¯¢ã€æ¥å¤„ç†ï¼Œæ‰€ä»¥ç­‰ä»·äº2ï¼š1ï¼š3çš„åŠ æƒè½®è¯¢ã€‚ Hashæ³• hashæ³•çš„è´Ÿè½½å‡è¡¡ä¸ä¹‹å‰çš„å‡ ç§ä¸åŒåœ¨äºï¼Œå®ƒçš„ç»“æœæ˜¯ç”±å®¢æˆ·ç«¯å†³å®šçš„ã€‚é€šè¿‡å®¢æˆ·ç«¯å¸¦æ¥çš„æŸä¸ªæ ‡è¯†ç»è¿‡ä¸€ä¸ªæ ‡å‡†åŒ–çš„æ•£åˆ—å‡½æ•°è¿›è¡Œæ‰“æ•£åˆ†æ‘Šã€‚ å¸¸ç”¨è´Ÿè½½å‡è¡¡ç­–ç•¥ä¼˜ç¼ºç‚¹å’Œé€‚ç”¨åœºæ™¯ å¥åº·æ¢æµ‹ä¿éšœé«˜å¯ç”¨ ä¸ç®¡æ˜¯ä»€ä¹ˆæ ·çš„ç­–ç•¥ï¼Œéš¾å…ä¼šé‡åˆ°æœºå™¨æ•…éšœæˆ–è€…ç¨‹åºæ•…éšœçš„æƒ…å†µã€‚æ‰€ä»¥è¦ç¡®ä¿è´Ÿè½½å‡è¡¡èƒ½æ›´å¥½çš„èµ·åˆ°æ•ˆæœï¼Œè¿˜éœ€è¦ç»“åˆä¸€äº›ã€Œå¥åº·æ¢æµ‹ã€æœºåˆ¶ã€‚å®šæ—¶çš„å»æ¢æµ‹æœåŠ¡ç«¯æ˜¯ä¸æ˜¯è¿˜èƒ½è¿ä¸Šï¼Œå“åº”æ˜¯ä¸æ˜¯è¶…å‡ºé¢„æœŸçš„æ…¢ã€‚å¦‚æœèŠ‚ç‚¹å±äºâ€œä¸å¯ç”¨â€çš„çŠ¶æ€çš„è¯ï¼Œéœ€è¦å°†è¿™ä¸ªèŠ‚ç‚¹ä¸´æ—¶ä»å¾…é€‰å–åˆ—è¡¨ä¸­ç§»é™¤ï¼Œä»¥æé«˜å¯ç”¨æ€§ã€‚ä¸€èˆ¬å¸¸ç”¨çš„ã€Œå¥åº·æ¢æµ‹ã€æ–¹å¼æœ‰3ç§ã€‚ HTTPæ¢æµ‹ ä½¿ç”¨Get/Postçš„æ–¹å¼è¯·æ±‚æœåŠ¡ç«¯çš„æŸä¸ªå›ºå®šçš„URLï¼Œåˆ¤æ–­è¿”å›çš„å†…å®¹æ˜¯å¦ç¬¦åˆé¢„æœŸã€‚ä¸€èˆ¬ä½¿ç”¨HttpçŠ¶æ€ç ã€responseä¸­çš„å†…å®¹æ¥åˆ¤æ–­ã€‚ TCPæ¢æµ‹ åŸºäºTcpçš„ä¸‰æ¬¡æ¡æ‰‹æœºåˆ¶æ¥æ¢æµ‹æŒ‡å®šçš„IP + ç«¯å£ã€‚æœ€ä½³å®è·µå¯ä»¥å€Ÿé‰´é˜¿é‡Œäº‘çš„SLBæœºåˆ¶ï¼Œå¦‚ä¸‹å›¾ã€‚ UDPæ¢æµ‹ å¯èƒ½æœ‰éƒ¨åˆ†åº”ç”¨ä½¿ç”¨çš„UDPåè®®ã€‚åœ¨æ­¤åè®®ä¸‹å¯ä»¥é€šè¿‡æŠ¥æ–‡æ¥è¿›è¡Œæ¢æµ‹æŒ‡å®šçš„IP + ç«¯å£ã€‚æœ€ä½³å®è·µåŒæ ·å¯ä»¥å€Ÿé‰´é˜¿é‡Œäº‘çš„SLBæœºåˆ¶ï¼Œå¦‚ä¸‹å›¾ã€‚ ç»“æœçš„åˆ¤å®šæ–¹å¼æ˜¯ï¼šåœ¨æœåŠ¡ç«¯æ²¡æœ‰è¿”å›ä»»ä½•ä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œé»˜è®¤æ­£å¸¸çŠ¶æ€ã€‚å¦åˆ™ä¼šè¿”å›ä¸€ä¸ªICMPçš„æŠ¥é”™ä¿¡æ¯ã€‚ å®æ–½è´Ÿè½½å‡è¡¡ ç¡¬ä»¶è´Ÿè½½å‡è¡¡ ç¡¬ä»¶è¿™å—åæ°”æœ€å¤§çš„è¿˜å±F5ã€‚æ­¤ç±»ç¡¬ä»¶è´Ÿè½½å‡è¡¡å™¨çš„ç‰¹ç‚¹æ˜¯â€œå£•â€ï¼Œæ¯•ç«Ÿæ˜¯çº¯å•†ä¸šåŒ–çš„ä¸œè¥¿ï¼ŒæŠ•å…¥çš„èµ„æºå’Œç²¾åŠ›è‡ªç„¶æ˜¯ä¼—å¤šå¼€æºè½¯ä»¶è´Ÿè½½å‡è¡¡æ‰€æ— æ³•æ¯”æ‹Ÿçš„ï¼Œæ‰€ä»¥åŠŸèƒ½éå¸¸å¼ºå¤§ã€‚åŒ…å«è®¿é—®åŠ é€Ÿã€å‹ç¼©ã€å®‰å…¨ç­‰ç­‰è´Ÿè½½å‡è¡¡ä¹‹å¤–çš„è®¸å¤šé™„åŠ åŠŸèƒ½ã€‚ å¦‚æœç”¨F5ç»„ç½‘çš„è¯ï¼Œæœ‰ä¸¤ç§ç»“æ„ï¼Œä¸²è¡Œç»“æ„å’Œå¹¶è¡Œç»“æ„ï¼Œä¹Ÿç§°ä¸ºç›´è¿æ¨¡å¼å’Œæ—è·¯æ¨¡å¼ã€‚å‰è€…çš„ä¼˜åŠ¿åœ¨å¯¹ç¡¬ä»¶äº§ç”Ÿå‹åŠ›è¾ƒå°ã€ä¸”å¤©ç„¶å®‰å…¨æ€§é«˜ï¼Œè€Œåè€…å¯¹åŸç½‘ç»œæ¶æ„çš„æ”¹åŠ¨è¾ƒå°ã€ä¸”æ‰©å±•æ€§è¾ƒå¥½ã€‚å¤§å®¶åœ¨å®é™…çš„ä½¿ç”¨ä¸­ç»“åˆè‡ªèº«æƒ…å†µæ¥éƒ¨ç½²ã€‚ è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼ˆL7ï¼‰ é’ˆå¯¹Webåº”ç”¨çš„L7è´Ÿè½½å‡è¡¡ï¼Œæ¯”è¾ƒä¸»æµçš„äº§å“æ˜¯2ä¸ªNginxã€HAProxyã€‚åœ¨L7åšè´Ÿè½½å‡è¡¡ï¼Œæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯çµæ´»ï¼Œè¯·æ±‚çš„URLã€Headeréƒ½æ˜¯å¯ä»¥å»æŒæ§çš„ï¼Œæ‰€ä»¥å¯ä»¥åˆ©ç”¨å…¶ä¸­çš„ä»»ä½•ä¿¡æ¯ä¸ºè´Ÿè½½å‡è¡¡ç­–ç•¥æ‰€ç”¨ã€‚å®é™…æ“ä½œä¸­ä¸»è¦åš2æ­¥ï¼š åœ¨å…¬ç½‘çš„åŸŸåè§£æä¸­ï¼Œé…ç½®è§£æåˆ°ã€Œåå‘ä»£ç†ã€ã€‚è®°å½•ç±»å‹æ˜¯ã€ŒAã€ï¼Œè®°å½•å€¼æ˜¯ã€Œåå‘ä»£ç†ã€çš„IPã€‚ é…ç½®çœŸå®æä¾›æœåŠ¡çš„Webåº”ç”¨IPå’Œç«¯å£ï¼Œå’Œè´Ÿè½½å‡è¡¡å‡è¡¡ç­–ç•¥ã€‚ä¸Šå›¾ä¸­çš„é…ç½®æ˜¯Nginxä¸­çš„ç¤ºä¾‹ï¼Œè´Ÿè½½å‡è¡¡ç­–ç•¥çš„ç¼ºçœå€¼æ˜¯è½®è¯¢ã€‚ è½¯ä»¶è´Ÿè½½å‡è¡¡ï¼ˆL4ï¼‰ å½“Webåº”ç”¨æ‰€ä¾èµ–çš„TCPåè®®çš„æœåŠ¡éœ€è¦æ¨ªå‘æ‰©å±•ï¼Œæˆ–è€…éœ€è¦åšæ•°æ®åº“ã€åˆ†å¸ƒå¼ç¼“å­˜çš„å¤šä¸»ã€ä¸»ä»é›†ç¾¤æ—¶ï¼Œé‚£ä¹ˆå°±éœ€è¦ä¸€ä¸ªæ”¯æŒL4çš„è´Ÿè½½å‡è¡¡è½¯ä»¶ã€‚è¿™é‡Œæœ€çŸ¥åçš„å°±å±LVSäº†ï¼Œå®ƒæ˜¯å†…æ ¸æ€çš„ç¨‹åºï¼Œæ‰€ä»¥ç›¸æ¯”ç”¨Nginxã€HAProxyæ¥åšL4çš„è´Ÿè½½å‡è¡¡ï¼Œåœ¨æ€§èƒ½ã€èµ„æºçš„æ¶ˆè€—ä¸Šä¼šæ›´ä¼˜ä¸€äº›ã€‚å®é™…è¿ç”¨ä¸­çš„æ“ä½œæ­¥éª¤ä¸»è¦ä¹Ÿæ˜¯2æ­¥ï¼š åœ¨LVSä¸­æ·»åŠ ä¸€ä¸ªIPè™šæ‹ŸæœåŠ¡ï¼ˆIPVSï¼‰ï¼Œå¹¶æŒ‡å®šå®ƒçš„IPã€ç«¯å£å’Œè´Ÿè½½å‡è¡¡ç­–ç•¥ã€‚ å°†IPè™šæ‹ŸæœåŠ¡å…³è”åˆ°çœŸå®çš„æœåŠ¡ä¸Šï¼Œå¹¶æŒ‡å®šæ¨¡å¼å’Œæƒé‡çš„ä¿¡æ¯ã€‚ï¼ˆåšL4çš„è´Ÿè½½å‡è¡¡å¯ä»¥ä½¿ç”¨NATæˆ–è€…FULLNATæ¨¡å¼ï¼‰ LVSçš„æ¨¡å¼ä¸€å…±æœ‰å››ç§ï¼Œé™¤äº†NATå’ŒFULLNATï¼ˆNATçš„å¢å¼ºç‰ˆï¼‰æ¨¡å¼å¤–ï¼Œå®ƒçš„TUNæ¨¡å¼å¯ä»¥åœ¨L3åšè´Ÿè½½å‡è¡¡ï¼ŒDRæ¨¡å¼å¯ä»¥åœ¨L2åšè´Ÿè½½å‡è¡¡ï¼Œåˆ°è¿™ä¸ªå±‚é¢å…¶å®å°±å’Œåšç¡¬ä»¶åŒå¤„äºä¸€ä¸ªå±‚æ¬¡äº†ã€‚å¹¶ä¸”ï¼Œéšç€å±‚æ¬¡çš„æ·±å…¥ï¼Œè™½ç„¶å¯¹åŠŸèƒ½æ€§ä¸Šæœ‰æ‰€å¼±åŒ–ï¼Œä½†æ˜¯å¦‚æœä¸è€ƒè™‘ç«¯å£çš„è¯ï¼Œå•ä»IPå±‚é¢çš„è´Ÿè½½å‡è¡¡æ¥è¯´ï¼Œç”¨DRæ¨¡å¼åšï¼Œåˆ™å¯¹æ•°æ®åŒ…çš„åŠ å·¥ä»‹å…¥åº¦ä¼šé™åˆ°æœ€ä½ï¼Œå› æ­¤ä¹Ÿæ˜¯é€šè¿‡è½¯ä»¶åšè´Ÿè½½å‡è¡¡èƒ½å¤Ÿè¾¾åˆ°çš„æ€§èƒ½æè‡´ã€‚ å¦å¤–ï¼ŒLVSä¸­è¿ç”¨çš„è™šæ‹ŸIPæ¦‚å¿µï¼Œæœ¬è´¨ä¸Šå’ŒNginxä¸­çš„â€œserverâ€æ¦‚å¿µä¸€æ ·ï¼Œå®šä¹‰äº†ä¸€ä¸ªç»Ÿä¸€å…¥å£ï¼Œä½œç”¨ä¸Šå¹¶æ²¡æœ‰å·®åˆ«ã€‚å°†Nginxä¸­çš„upstreamå…³è”åˆ°serverï¼Œå°±å¦‚LVSæ“ä½œæ­¥éª¤ç¬¬2ç‚¹ä¸­çš„å…³è”ä¸€èˆ¬ã€‚ ä¼˜ç¼ºç‚¹ ä¸åŒçš„è§£å†³æ–¹æ¡ˆæœ‰ä¸åŒçš„ä¾§é‡ç‚¹ã€‚å› æ­¤åœ¨å•ä¸ªè§£å†³æ–¹æ¡ˆå·²ç»æ— æ³•æ»¡è¶³çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥ç»„åˆä½¿ç”¨ï¼Œå„å°½æ‰€é•¿ã€‚ æ¨èæ–¹æ¡ˆ è´Ÿè½½å‡è¡¡è¿™ä¸ªé¢†åŸŸè¿˜æ˜¯ä»¥é«˜å¯ç”¨å’Œæ€§èƒ½ä¸º2ä¸ªæœ€é‡è¦å› ç´ ï¼Œä¸‹é¢æ˜¯æ¨èçš„ä¸€ç§ç»„åˆæ–¹å¼ï¼Œä¹Ÿæ˜¯åœ¨ç³»ç»Ÿé‡çº§è¾¾åˆ°æ¯å°æ—¶ä¸Šäº¿PVä¹‹åæœ€è¢«å¹¿æ³›ä½¿ç”¨çš„ä¸€ç§ã€‚ç†è®ºä¸Šï¼Œåˆ©ç”¨ç¬¬ä¸€æ­¥DNSçš„åŸŸåè§£ææ‰€å¸¦çš„è´Ÿè½½å‡è¡¡æ•ˆæœï¼Œåªè¦å¤åˆ¶å¤šå¥—LVSä¸»å¤‡å‡ºæ¥ï¼Œç»‘ä¸Šå¤šä¸ªä¸åŒçš„è™šIPï¼Œå¯ä»¥åšåˆ°æ— é™æ¨ªå‘æ‰©å±•ï¼Œä»¥æ”¯æ’‘ä¸æ–­å¢é•¿çš„æµé‡ã€‚ ç”¨åˆ°çš„3ä¸ªè½¯ä»¶ç›®å‰éƒ½æ˜¯å¼€æºäº§å“ï¼ŒLVS+Keepalivedè´Ÿè´£åšNginxçš„è´Ÿè½½å‡è¡¡ï¼Œè€ŒNginxè´Ÿè´£åˆ†å‘åˆ°å®é™…çš„è¯·æ±‚åˆ°Httpå’ŒTcpåè®®çš„åº”ç”¨ä¸Šã€‚ å…³äºLVSçš„æ¨¡å¼é€‰æ‹©ï¼Œå¦‚æœåœ¨åŒç½‘æ®µå†…çš„è¯ä¼˜å…ˆä½¿ç”¨DRæ¨¡å¼è¿›è¡ŒL2è½¬å‘ï¼Œæ€§èƒ½æœ€å¥½ã€‚å¦åˆ™ä½¿ç”¨TUNæ¨¡å¼è¿›è¡ŒL3åˆ†å‘ã€‚ä¸æ­¤åŒæ—¶ï¼Œåœ¨L4ã€L7çš„åˆ†å‘ä¸Šä½¿ç”¨Nginxæ¥åšï¼Œå¯ä»¥å‘æŒ¥å…¶çµæ´»æ˜“æ‰©å±•çš„ç‰¹ç‚¹ä»¥åŠå…¶å®ƒçš„ä¸€äº›é¢å¤–ç‰¹æ€§å¦‚ç¼“å­˜ç­‰ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
        <tag>é«˜å¯ç”¨</tag>
        <tag>è´Ÿè½½å‡è¡¡</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC-å‡çº§ç‰ˆ]]></title>
    <url>%2Fposts%2Fa6a74f01.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° æ‰‹å†™RPC-ç®€æ˜“ç‰ˆ ï¼Œå®ç°äº†ä¸€ä¸ªå¾ˆç®€å•çš„RPCè°ƒç”¨ç¤ºä¾‹ï¼Œå…¶ä¸­è¿˜å­˜åœ¨å¾ˆå¤šé—®é¢˜åŠå¯ä¼˜åŒ–çš„ç‚¹ï¼Œ è¿™æ¬¡åšä¸ªå‡çº§ï¼Œå®Œå…¨é‡å†™ä¹‹å‰çš„ä»£ç ï¼Œä½¿å¾—ä»£ç é€»è¾‘æ›´åŠ è§„èŒƒï¼ŒåŒæ—¶å¼•å…¥Zookeeperè¾…åŠ©å®ŒæˆæœåŠ¡æ²»ç†ã€‚åœ¨ä»£ç å±•ç¤ºå‰ï¼Œå…ˆä»‹ç»ä¸‹Zookeeperã€æœåŠ¡æ²»ç†ç­‰æ¦‚å¿µã€‚ Zookeeper ZooKeeperï¼ˆç®€ç§°zkï¼‰æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼ã€å¼€æºçš„åº”ç”¨åè°ƒæœåŠ¡ï¼Œåˆ©ç”¨å’ŒPaxosç±»ä¼¼çš„ZABé€‰ä¸¾ç®—æ³•å®ç°åˆ†å¸ƒå¼ä¸€è‡´æ€§æœåŠ¡ã€‚æœ‰ç±»ä¼¼äºUnixæ–‡ä»¶ç›®å½•çš„èŠ‚ç‚¹ä¿¡æ¯ï¼ŒåŒæ—¶å¯ä»¥é’ˆå¯¹èŠ‚ç‚¹çš„å˜æ›´æ·»åŠ watcherç›‘å¬ä»¥èƒ½å¤ŸåŠæ—¶æ„ŸçŸ¥åˆ°èŠ‚ç‚¹ä¿¡æ¯å˜æ›´ã€‚å¯æä¾›çš„åŠŸèƒ½ä¾‹å¦‚æ•°æ®å‘å¸ƒ/è®¢é˜…ã€è´Ÿè½½å‡è¡¡ã€å‘½åæœåŠ¡ã€åˆ†å¸ƒå¼åè°ƒ/é€šçŸ¥ã€é›†ç¾¤ç®¡ç†ã€Masteré€‰ä¸¾ã€åˆ†å¸ƒå¼é”å’Œåˆ†å¸ƒå¼é˜Ÿåˆ—ç­‰åŠŸèƒ½ã€‚å¦‚ä¸‹å›¾å°±æ˜¯DUBBOå­˜å‚¨åœ¨ZooKeeperçš„èŠ‚ç‚¹æ•°æ®æƒ…å†µï¼š åœ¨æœ¬åœ°å¯åŠ¨æœåŠ¡åé€šè¿‡zkå®¢æˆ·ç«¯è¿æ¥åä¹Ÿå¯é€šè¿‡å‘½ä»¤æŸ¥çœ‹èŠ‚ç‚¹ä¿¡æ¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ZooKeeperåŒ…å«äº†4ç§ä¸åŒå«ä¹‰çš„åŠŸèƒ½èŠ‚ç‚¹ï¼Œåœ¨æ¯æ¬¡åˆ›å»ºèŠ‚ç‚¹ä¹‹å‰éƒ½éœ€è¦æ˜ç¡®å£°æ˜èŠ‚ç‚¹ç±»å‹: ç±»å‹ å®šä¹‰ æè¿° PERSISTENT æŒä¹…åŒ–ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ PERSISTENT_SEQUENTIAL æŒä¹…åŒ–é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹ä¾æ—§å­˜åœ¨ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· EPHEMERAL ä¸´æ—¶ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ EPHEMERAL_SEQUENTIAL ä¸´æ—¶é¡ºåºç¼–å·ç›®å½•èŠ‚ç‚¹ å®¢æˆ·ç«¯ä¸zookeeperæ–­å¼€è¿æ¥åï¼Œè¯¥èŠ‚ç‚¹è¢«åˆ é™¤ï¼Œåªæ˜¯Zookeeperç»™è¯¥èŠ‚ç‚¹åç§°è¿›è¡Œé¡ºåºç¼–å· ZooKeeperä½¿ç”¨ä¹‹å‰éœ€è¦å…ˆè¿›è¡Œå®‰è£…ï¼Œåå¼€å¯æœåŠ¡ç«¯çš„æœåŠ¡ï¼Œ æˆ‘ä»¬çš„æœåŠ¡ä½œä¸ºå®¢æˆ·ç«¯è¿æ¥ZooKeeperä»¥ä¾¿äºåç»­çš„æ“ä½œã€‚å…·ä½“å¯å‚è€ƒå®˜ç½‘æ–‡æ¡£Zookeeper3.5.5 å®˜æ–¹æ–‡æ¡£ï¼Œåœ¨å®é™…çš„javaé¡¹ç›®å¼€å‘ä¸­ä¹Ÿæ˜¯å¯ä»¥é€šè¿‡mavenå¼•å…¥ZkClientæˆ–è€…Curatorå¼€æºçš„å®¢æˆ·ç«¯ï¼Œåœ¨æœ¬æ–‡å­¦ä¹ ç¬”è®°ä¸­æ˜¯ä½¿ç”¨çš„Curatorï¼Œå› ä¸ºå…¶å·²ç»å°è£…äº†åŸå§‹çš„èŠ‚ç‚¹æ³¨å†Œã€æ•°æ®è·å–ã€æ·»åŠ watcherç­‰åŠŸèƒ½ã€‚å…·ä½“mavenå¼•å…¥çš„ç‰ˆæœ¬å¦‚ä¸‹ï¼š 12345678910&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-framework&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.apache.curator&lt;/groupId&gt; &lt;artifactId&gt;curator-recipes&lt;/artifactId&gt; &lt;version&gt;4.2.0&lt;/version&gt;&lt;/dependency&gt; æœåŠ¡æ²»ç† æœåŠ¡æ²»ç†ä¹Ÿå°±æ˜¯é’ˆå¯¹æœåŠ¡è¿›è¡Œç®¡ç†çš„æªæ–½ï¼Œä¾‹å¦‚ æœåŠ¡å‘ç°ã€ æœåŠ¡æš´éœ²ã€ è´Ÿè½½å‡è¡¡ã€ å¿«é€Ÿä¸Šä¸‹çº¿ç­‰éƒ½æ˜¯æœåŠ¡æ²»ç†çš„å…·ä½“ä½“ç°ã€‚ æœåŠ¡å‘ç°ï¼šä»æœåŠ¡ç®¡ç†ä¸­å¿ƒè·å–åˆ°éœ€è¦çš„æœåŠ¡ç›¸å…³ä¿¡æ¯ï¼Œä¾‹å¦‚å¯ä»¥ä»zkä¸­è·å–ç›¸å…³æœåŠ¡çš„æœºå™¨ä¿¡æ¯ï¼Œç„¶åå°±å¯ä»¥å’Œå…·ä½“æœºå™¨ç›´è¿å®Œæˆç›¸å…³åŠŸèƒ½ã€‚ æœåŠ¡æš´éœ²ï¼šæœåŠ¡æä¾›æ–¹å¯ä»¥æä¾›ä»€ä¹ˆæ ·å­çš„åŠŸèƒ½ï¼Œç»è¿‡æœåŠ¡æš´éœ²æš´éœ²å‡ºå»ï¼Œå…¶ä»–ä½¿ç”¨æ–¹å°±å¯ä»¥é€šè¿‡æœåŠ¡å‘ç°å‘ç°å…·ä½“çš„æœåŠ¡æä¾›æ–¹ä¿¡æ¯ã€‚ è´Ÿè½½å‡è¡¡ï¼šä¸€èˆ¬é’ˆå¯¹çš„æ˜¯æœåŠ¡æä¾›æ–¹ï¼Œé¿å…å¤§é‡è¯·æ±‚åŒæ—¶æ‰“åˆ°ä¸€å°æœºå™¨ä¸Šï¼Œé‡‡ç”¨éšæœºã€è½®è¯¢ç­‰æªæ–½è®©è¯·æ±‚å‡åˆ†åˆ°å„ä¸ªæœºå™¨ä¸Šï¼Œæä¾›æœåŠ¡æ•ˆç‡ï¼Œ é™æµï¼Œ ç°åº¦ç­‰ä¹Ÿéƒ½æ˜¯ç±»ä¼¼çš„æ“ä½œï¼Œé€šè¿‡åŠ¨æ€è·¯ç”±ã€è½¯è´Ÿè½½çš„å½¢å¼å¤„ç†åˆ†å‘è¯·æ±‚ã€‚ å¿«é€Ÿä¸Šçº¿ä¸‹ï¼šä»¥å¾€éœ€è¦ä¸Šä¸‹çº¿å¯èƒ½éœ€è¦æ€æ‰æœºå™¨ä¸Šçš„è¿›ç¨‹ï¼Œç°åœ¨åªéœ€è¦è®©è¯¥æœåŠ¡åœæ­¢æš´éœ²å³å¯ï¼Œå®ç°æœåŠ¡çš„çµæ´»ä¸Šä¸‹çº¿ã€‚ æ•°æ®å¤„ç†æµç¨‹ æœåŠ¡ç«¯ï¼šæœåŠ¡çš„æä¾›æ–¹ï¼Œæ¥å—ç½‘ç»œä¼ è¾“çš„è¯·æ±‚æ•°æ®ã€é€šè¿‡ç½‘ç»œæŠŠåº”ç­”æ•°æ®å‘é€ç»™å®¢æˆ·ç«¯; å®¢æˆ·ç«¯ï¼šæœåŠ¡çš„è°ƒç”¨æ–¹ï¼Œä½¿ç”¨æœ¬åœ°ä»£ç†ï¼Œé€šè¿‡ç½‘ç»œæŠŠè¯·æ±‚æ•°æ®å‘é€å‡ºå»ï¼Œæ¥å—æœåŠ¡ç«¯è¿”å›çš„åº”ç­”æ•°æ®. æ‰€æœ‰çš„æ•°æ®ä¼ è¾“éƒ½æ˜¯æŒ‰ç…§ä¸Šé¢å›¾ç‰‡è¯´çš„æµç¨‹æ¥çš„ï¼Œå¦‚æœéœ€è¦æ·»åŠ è‡ªå®šä¹‰çš„åºåˆ—åŒ–å·¥å…·ï¼Œåˆ™éœ€è¦åœ¨æŠŠæ•°æ®æäº¤åˆ°socketçš„è¾“å‡ºæµç¼“å†²åŒºä¹‹å‰æŒ‰ç…§åºåˆ—åŒ–å·¥å…·å®Œæˆåºåˆ—åŒ–æ“ä½œï¼Œååºåˆ—åŒ–åˆ™è¿›è¡Œåå‘æ“ä½œå³å¯ã€‚ RPC V2ç‰ˆæœ¬ æ–‡ä»¶å¤¹ç›®å½•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š balanceæ–‡ä»¶å¤¹ï¼šè´Ÿè½½å‡è¡¡æœ‰å…³ï¼› configæ–‡ä»¶å¤¹ï¼šç½‘ç»œå¥—æ¥å­—ä¼ è¾“çš„æ•°æ®æ¨¡å‹ä»¥åŠæœåŠ¡æš´éœ²ã€æœåŠ¡å‘ç°çš„æ•°æ®æ¨¡å‹ï¼› coreæ–‡ä»¶å¤¹ï¼šæ ¸å¿ƒæ–‡ä»¶å¤¹ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„è¯·æ±‚å¤„ç†ã€ä»£ç†ç”Ÿæˆç­‰ï¼› demoæ–‡ä»¶å¤¹ï¼šæµ‹è¯•ä½¿ç”¨ï¼› domainæ–‡ä»¶å¤¹ï¼šæ¨¡å‹ã€æšä¸¾å¸¸é‡ï¼› io.protocolæ–‡ä»¶å¤¹ï¼šç›®å‰æ˜¯åªæœ‰å…·ä½“çš„è¯·æ±‚å¯¹è±¡å’Œç½‘ç»œioçš„å°è£…ï¼› registeræ–‡ä»¶å¤¹ï¼šæœåŠ¡æ³¨å†Œä½¿ç”¨ï¼Œå®ç°äº†ä½¿ç”¨zkè¿›è¡ŒæœåŠ¡æ³¨å†Œå’ŒæœåŠ¡å‘ç°çš„æ“ä½œï¼› serializeæ–‡ä»¶å¤¹ï¼šåºåˆ—åŒ–ã€ååºåˆ—åŒ–ï¼Œå®ç°äº†Javaå’ŒHessianä¸¤ç§ã€‚ æœåŠ¡æ³¨å†Œ&amp;æœåŠ¡å‘ç° ServiceRegisterï¼š 123456789101112131415161718192021222324252627282930package com.springboot.whb.study.rpc.rpc_v2.register;import com.springboot.whb.study.rpc.rpc_v2.config.BasicConfig;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import java.net.InetSocketAddress;/** * @author: whb * @description: æœåŠ¡æ³¨å†Œ */public interface ServiceRegister { /** * æœåŠ¡æ³¨å†Œ * * @param config */ void register(BasicConfig config); /** * æœåŠ¡å‘ç°ï¼Œä»æ³¨å†Œä¸­å¿ƒè·å–å¯ç”¨çš„æœåŠ¡æä¾›æ–¹ä¿¡æ¯ * * @param request * @param nodeType * @return */ InetSocketAddress discovery(RpcRequest request, ServiceType nodeType);} ZkServiceRegister é»˜è®¤ä½¿ç”¨äº†CuratorFrameworkå®¢æˆ·ç«¯å®Œæˆzkæ•°æ®çš„æ“ä½œ. 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149package com.springboot.whb.study.rpc.rpc_v2.register;import com.springboot.whb.study.rpc.rpc_v2.balance.DefaultLoadBalance;import com.springboot.whb.study.rpc.rpc_v2.balance.LoadBalance;import com.springboot.whb.study.rpc.rpc_v2.config.BasicConfig;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.extern.slf4j.Slf4j;import org.apache.curator.RetryPolicy;import org.apache.curator.framework.CuratorFramework;import org.apache.curator.framework.CuratorFrameworkFactory;import org.apache.curator.retry.ExponentialBackoffRetry;import org.apache.zookeeper.CreateMode;import java.net.InetSocketAddress;import java.util.List;/** * @author: whb * @description: ZookeeperæœåŠ¡æ³¨å†Œå®ç°ç±» */@Slf4jpublic class ZkServiceRegister implements ServiceRegister { private CuratorFramework client; private static final String ROOT_PATH = "whb/demo-rpc"; private LoadBalance loadBalance = new DefaultLoadBalance(); public ZkServiceRegister() { //é‡è¯•ç­–ç•¥ RetryPolicy policy = new ExponentialBackoffRetry(1000, 3); this.client = CuratorFrameworkFactory .builder() .connectString("127.0.0.1:2181") .sessionTimeoutMs(50000) .retryPolicy(policy) .namespace(ROOT_PATH) .build(); // ä¸šåŠ¡çš„æ ¹è·¯å¾„æ˜¯ /whb/demo-rpc ,å…¶ä»–çš„éƒ½ä¼šé»˜è®¤æŒ‚è½½åœ¨è¿™é‡Œ this.client.start(); System.out.println("zkå¯åŠ¨æ­£å¸¸"); } /** * æœåŠ¡æ³¨å†Œ * * @param config */ @Override public void register(BasicConfig config) { String interfacePath = "/" + config.getInterfaceName(); try { if (this.client.checkExists().forPath(interfacePath) == null) { // åˆ›å»º æœåŠ¡çš„æ°¸ä¹…èŠ‚ç‚¹ this.client.create() .creatingParentsIfNeeded() .withMode(CreateMode.PERSISTENT) .forPath(interfacePath); } config.getMethods().forEach(method -&gt; { String methodPath = null; try { ServiceType serviceType = config.getType(); if (serviceType == ServiceType.PROVIDER) { // æœåŠ¡æä¾›æ–¹ï¼Œéœ€è¦æš´éœ²è‡ªèº«çš„ipã€portä¿¡æ¯ï¼Œè€Œæ¶ˆè´¹ç«¯åˆ™ä¸éœ€è¦ String address = getServiceAddress(config); methodPath = String.format("%s/%s/%s/%s", interfacePath, serviceType.getType(), method.getMethodName(), address); } else { methodPath = String.format("%s/%s/%s", interfacePath, serviceType.getType(), method.getMethodName()); } log.info("zk path: [" + ROOT_PATH + methodPath + "]"); // åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹ï¼ŒèŠ‚ç‚¹åŒ…å«äº†æœåŠ¡æä¾›æ®µçš„ä¿¡æ¯ this.client.create() .creatingParentsIfNeeded() .withMode(CreateMode.EPHEMERAL) .forPath(methodPath, "0".getBytes()); } catch (Exception e) { log.error("åˆ›å»ºä¸´æ—¶èŠ‚ç‚¹[" + methodPath + "]å¤±è´¥ï¼Œerror:{}", e); } }); } catch (Exception e) { log.error("åˆ›å»ºæœåŠ¡èŠ‚ç‚¹å¤±è´¥ï¼Œerror:{}", e); } } /** * æœåŠ¡å‘ç° * * @param request * @param nodeType * @return */ @Override public InetSocketAddress discovery(RpcRequest request, ServiceType nodeType) { String path = String.format("/%s/%s/%s", request.getClassName(), nodeType.getType(), request.getMethodName()); try { List&lt;String&gt; addressList = this.client.getChildren().forPath(path); // é‡‡ç”¨è´Ÿè½½å‡è¡¡çš„æ–¹å¼è·å–æœåŠ¡æä¾›æ–¹ä¿¡æ¯,ä¸è¿‡å¹¶æ²¡æœ‰æ·»åŠ watcherç›‘å¬æ¨¡å¼ String address = loadBalance.balance(addressList); if (address == null) { return null; } return parseAddress(address); } catch (Exception e) { log.error("æœåŠ¡å‘ç°æ¥å£å¼‚å¸¸ï¼Œerror:{}", e); } return null; } /** * è·å–æœåŠ¡åœ°å€ * * @param config * @return */ private String getServiceAddress(BasicConfig config) { String hostInfo = new StringBuilder() .append(config.getHost()) .append(":") .append(config.getPort()) .toString(); return hostInfo; } /** * å°è£…ç«¯å£ * * @param address * @return */ private InetSocketAddress parseAddress(String address) { String[] result = address.split(":"); return new InetSocketAddress(result[0], Integer.valueOf(result[1])); } /** * è®¾ç½®è´Ÿè½½å‡è¡¡ç­–ç•¥ * * @param loadBalance */ public void setLoadBalance(LoadBalance loadBalance) { this.loadBalance = loadBalance; }} è´Ÿè½½å‡è¡¡ LoadBalance 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;/** * @author: whb * @description: è´Ÿè½½å‡è¡¡æ¥å£å®šä¹‰ */public interface LoadBalance { /** * è´Ÿè½½å‡è¡¡ * * @param addressList * @return */ String balance(List&lt;String&gt; addressList);} AbstractLoadBalance 1234567891011121314151617181920212223242526272829package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;/** * @author: whb * @description: æŠ½è±¡è´Ÿè½½å‡è¡¡ */public abstract class AbstractLoadBalance implements LoadBalance { @Override public String balance(List&lt;String&gt; addressList) { if (addressList == null || addressList.isEmpty()) { return null; } if (addressList.size() == 1) { return addressList.get(0); } return doLoad(addressList); } /** * æŠ½è±¡æ¥å£ï¼Œè®©å­ç±»å»å®ç° * * @param addressList * @return */ abstract String doLoad(List&lt;String&gt; addressList);} DefaultLoadBalance 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.balance;import java.util.List;import java.util.Random;/** * @author: whb * @description: é»˜è®¤è´Ÿè½½å‡è¡¡--éšæœºè´Ÿè½½å‡è¡¡ */public class DefaultLoadBalance extends AbstractLoadBalance { @Override String doLoad(List&lt;String&gt; addressList) { //éšæœº Random random = new Random(); return addressList.get(random.nextInt(addressList.size())); }} æ¶ˆæ¯åè®® MessageProtocol 12345678910111213141516171819202122232425262728293031323334353637383940414243444546package com.springboot.whb.study.rpc.rpc_v2.io.protocol;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.core.RpcResponse;import java.io.InputStream;import java.io.OutputStream;/** * @author: whb * @description: è¯·æ±‚ã€åº”ç­” è§£æå’Œåè§£æï¼ŒåŒ…å«äº†åºåˆ—åŒ–ä»¥åŠååºåˆ—åŒ–æ“ä½œ */public interface MessageProtocol { /** * æœåŠ¡ç«¯è§£æä»ç½‘ç»œä¼ è¾“çš„æ•°æ®ï¼Œè½¬å˜æˆrequestå¯¹è±¡ * * @param inputStream * @return */ RpcRequest serviceToRequest(InputStream inputStream); /** * æœåŠ¡ç«¯æŠŠè®¡ç®—çš„ç»“æœåŒ…è£…å¥½ï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›ç»™å®¢æˆ·ç«¯ * * @param response * @param outputStream * @param &lt;T&gt; */ &lt;T&gt; void serviceGetResponse(RpcResponse&lt;T&gt; response, OutputStream outputStream); /** * å®¢æˆ·ç«¯æŠŠè¯·æ±‚æ‹¼æ¥å¥½ï¼Œé€šè¿‡è¾“å‡ºæµå‘é€åˆ°æœåŠ¡ç«¯ * * @param request * @param outputStream */ void clientToRequest(RpcRequest request, OutputStream outputStream); /** * å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ç»“æœï¼Œè½¬å˜æˆresponseå¯¹è±¡ * * @param inputStream */ &lt;T&gt; RpcResponse&lt;T&gt; clientGetResponse(InputStream inputStream);} DefaultMessageProtocol 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188package com.springboot.whb.study.rpc.rpc_v2.io.protocol;import com.springboot.whb.study.rpc.rpc_v2.core.RpcRequest;import com.springboot.whb.study.rpc.rpc_v2.core.RpcResponse;import com.springboot.whb.study.rpc.rpc_v2.serialize.HessianSerialize;import com.springboot.whb.study.rpc.rpc_v2.serialize.SerializeProtocol;import lombok.extern.slf4j.Slf4j;import java.io.ByteArrayOutputStream;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.util.Arrays;/** * @author: whb * @description: å¥—æ¥å­—çš„ioæµå’ŒæœåŠ¡ç«¯ã€å®¢æˆ·ç«¯çš„æ•°æ®ä¼ è¾“ */@Slf4jpublic class DefaultMessageProtocol implements MessageProtocol { /** * åºåˆ—åŒ–åè®® */ private SerializeProtocol serializeProtocol; public DefaultMessageProtocol() { this.serializeProtocol = new HessianSerialize(); //this.serializeProtocol = new JavaInnerSerialize(); } public void setSerializeProtocol(SerializeProtocol serializeProtocol) { // å¯æ›¿æ¢åºåˆ—åŒ–åè®® this.serializeProtocol = serializeProtocol; } /** * æœåŠ¡ç«¯è§£æä»ç½‘ç»œä¼ è¾“çš„æ•°æ®ï¼Œè½¬å˜æˆrequestå¯¹è±¡ * * @param inputStream * @return */ @Override public RpcRequest serviceToRequest(InputStream inputStream) { try { // 2ã€bytes -&gt; request ååºåˆ—åŒ– byte[] bytes = readBytes(inputStream); System.out.println("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–å‡ºobj:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–å‡ºobj length:" + bytes.length); RpcRequest request = serializeProtocol.deserialize(RpcRequest.class, bytes); return request; } catch (Exception e) { log.error("[2]æœåŠ¡ç«¯ååºåˆ—åŒ–ä»ç½‘ç»œä¼ è¾“çš„æ•°æ®è½¬å˜æˆrequestå¯¹è±¡å¤±è´¥ï¼Œerror:{}", e); } return null; } /** * æœåŠ¡ç«¯æŠŠè®¡ç®—çš„ç»“æœåŒ…è£…å¥½ï¼Œé€šè¿‡è¾“å‡ºæµè¿”å›ç»™å®¢æˆ·ç«¯ * * @param response * @param outputStream * @param &lt;T&gt; */ @Override public &lt;T&gt; void serviceGetResponse(RpcResponse&lt;T&gt; response, OutputStream outputStream) { try { // 3ã€æŠŠresponse åºåˆ—åŒ–æˆbytes ä¼ ç»™å®¢æˆ·ç«¯ byte[] bytes = serializeProtocol.serialize(RpcResponse.class, response); System.out.println("[3]æœåŠ¡ç«¯åºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[3]æœåŠ¡ç«¯åºåˆ—åŒ–å‡ºbytes length:" + bytes.length); outputStream.write(bytes); } catch (Exception e) { log.error("[3]æœåŠ¡ç«¯åºåˆ—åŒ–è®¡ç®—çš„ç»“æœå‡ºè¾“ç»™å®¢æˆ·ç«¯å¤±è´¥ï¼Œerror:{}", e); } } /** * å®¢æˆ·ç«¯æŠŠè¯·æ±‚æ‹¼æ¥å¥½ï¼Œé€šè¿‡è¾“å‡ºæµå‘é€åˆ°æœåŠ¡ç«¯ * * @param request * @param outputStream */ @Override public void clientToRequest(RpcRequest request, OutputStream outputStream) { try { // 1ã€å…ˆæŠŠè¿™ä¸ªrequest -&gt; bytes åºåˆ—åŒ–æ‰ byte[] bytes = serializeProtocol.serialize(RpcRequest.class, request); System.out.println("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–å‡ºbytes length:" + bytes.length); outputStream.write(bytes); } catch (IOException e) { log.error("[1]å®¢æˆ·ç«¯åºåˆ—åŒ–è¯·æ±‚å‚æ•°å¤±è´¥ï¼Œerror:{}", e); } } /** * å®¢æˆ·ç«¯æ¥æ”¶åˆ°æœåŠ¡ç«¯å“åº”çš„ç»“æœï¼Œè½¬å˜æˆresponseå¯¹è±¡ * * @param inputStream */ @Override public &lt;T&gt; RpcResponse&lt;T&gt; clientGetResponse(InputStream inputStream) { try { // 4ã€bytes ååºåˆ—åŒ–æˆresponse byte[] bytes = readBytes(inputStream); System.out.println("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–å‡ºbytes:[" + new String(bytes) + "], length:" + bytes.length); //System.out.println("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–å‡ºbytes length:" + bytes.length); RpcResponse response = serializeProtocol.deserialize(RpcResponse.class, bytes); return response; } catch (Exception e) { log.error("[4]å®¢æˆ·ç«¯ååºåˆ—åŒ–è®¡ç®—ç»“æœå¤±è´¥ï¼Œerror:{}", e); } return null; } /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„ * * @param inputStream * @return * @throws IOException */ private byte[] readBytes(InputStream inputStream) throws IOException { if (inputStream == null) { throw new RuntimeException("è¾“å…¥æµä¸ºç©º"); } return inputStreamToByteArr2(inputStream); } /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•1 * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr1(InputStream inputStream) throws IOException { // æœ‰ä¸ªå‰ææ˜¯æ•°æ®æœ€å¤§æ˜¯1024ï¼Œå¹¶æ²¡æœ‰è¿­ä»£è¯»å–æ•°æ® byte[] bytes = new byte[1024]; int count = inputStream.read(bytes, 0, 1024); return Arrays.copyOf(bytes, count); } /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•2 * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr2(InputStream inputStream) throws IOException { ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); int bufesize = 1024; while (true) { byte[] data = new byte[bufesize]; int count = inputStream.read(data, 0, bufesize); byteArrayOutputStream.write(data, 0, count); if (count &lt; bufesize) { break; } } return byteArrayOutputStream.toByteArray(); } /** * æµè½¬äºŒè¿›åˆ¶æ•°ç»„æ–¹æ³•3ï¼Œè°ƒç”¨è¯¥æ–¹æ³•ä¹‹åä¼šé˜»å¡åœ¨readï¼Œå¯é€šè¿‡jstackæŸ¥çœ‹ç›¸å…³ä¿¡æ¯ * * @param inputStream * @return * @throws IOException */ private byte[] inputStreamToByteArr3(InputStream inputStream) throws IOException { ByteArrayOutputStream byteArrayOutputStream = new ByteArrayOutputStream(); int bufesize = 1024; byte[] buff = new byte[bufesize]; int rc = 0; while ((rc = inputStream.read(buff, 0, bufesize)) &gt; 0) { byteArrayOutputStream.write(buff, 0, rc); buff = new byte[bufesize]; } byte[] bytes = byteArrayOutputStream.toByteArray(); return bytes; }} æ•°æ®ä¼ è¾“æ¨¡å‹ ArgumentConfig 12345678910111213141516171819202122232425package com.springboot.whb.study.rpc.rpc_v2.config;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: å‚æ•°é…ç½® */@Datapublic class ArgumentConfig implements Serializable { private static final long serialVersionUID = 1L; /** * ç¬¬å‡ ä¸ªå‚æ•° */ private int index; /** * å‚æ•°ç±»å‹ */ private String type;} BasicConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package com.springboot.whb.study.rpc.rpc_v2.config;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import java.util.List;/** * @author: whb * @description: åŸºç¡€é…ç½® */@Datapublic class BasicConfig { /** * åœ°å€ */ private String host; /** * ç«¯å£å· */ private int port; /** * æœåŠ¡æä¾›æ–¹è¿˜æ˜¯æœåŠ¡æ¶ˆè´¹æ–¹ */ private ServiceType type; /** * æ¥å£å */ private String interfaceName; /** * æ¥å£ç±» */ private Class&lt;?&gt; interfaceClass; /** * æ–¹æ³•é›†åˆ */ private List&lt;MethodConfig&gt; methods; /** * åˆ†ç»„ */ private String group; /** * é»˜è®¤ç‰ˆæœ¬å·æ˜¯default */ private String version = "default";} ClientConfig 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.springboot.whb.study.rpc.rpc_v2.config;import com.springboot.whb.study.rpc.rpc_v2.core.ProxyInstance;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import java.io.Serializable;import java.lang.reflect.Proxy;/** * @author: whb * @description: å®¢æˆ·ç«¯é…ç½® */@Datapublic class ClientConfig&lt;T&gt; extends BasicConfig implements Serializable { private static final long serialVersionUID = 1L; private T proxy; /** * åå°„åŒ…è£…æˆå®¢æˆ·ç«¯å‚æ•°é…ç½®å¯¹è±¡ * * @param interfaceClass * @param invocationHandler * @param &lt;T&gt; * @return */ public static &lt;T&gt; ClientConfig&lt;T&gt; convert(Class&lt;T&gt; interfaceClass, ProxyInstance invocationHandler) { ClientConfig&lt;T&gt; config = new ClientConfig&lt;&gt;(); config.setVersion("default"); config.setInterfaceClass(interfaceClass); config.setInterfaceName(interfaceClass.getName()); config.setMethods(MethodConfig.convert(interfaceClass.getMethods())); config.setType(ServiceType.CONSUMER); Object proxy = Proxy.newProxyInstance(ClientConfig.class.getClassLoader(), new Class&lt;?&gt;[]{interfaceClass}, invocationHandler); config.setProxy((T) proxy); return config; }} MethodConfig 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.springboot.whb.study.rpc.rpc_v2.config;import lombok.Data;import java.io.Serializable;import java.lang.reflect.Method;import java.lang.reflect.Parameter;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: æ–¹æ³•é…ç½® */@Datapublic class MethodConfig implements Serializable { private static final long serialVersionUID = 1L; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private List&lt;ArgumentConfig&gt; argumentConfigs; /** * æ˜¯å¦éœ€è¦è¿”å› */ private Boolean isReturn; /** * è¿”å›å€¼ç±»å‹ */ private Class&lt;?&gt; returnType; /** * æ–¹æ³•æ•°ç»„è½¬æ–¹æ³•é…ç½®é›†åˆ * * @param methods * @return */ public static List&lt;MethodConfig&gt; convert(Method[] methods) { List&lt;MethodConfig&gt; methodConfigList = new ArrayList&lt;&gt;(methods.length); MethodConfig methodConfig = null; for (Method method : methods) { methodConfig = new MethodConfig(); methodConfig.setMethodName(method.getName()); Class&lt;?&gt; returnType = method.getReturnType(); String returnName = returnType.getName(); if ("void".equals(returnName)) { methodConfig.setIsReturn(false); } else { methodConfig.setIsReturn(true); } methodConfig.setReturnType(returnType); methodConfig.setArgumentConfigs(convert(method.getParameters())); methodConfigList.add(methodConfig); } return methodConfigList; } /** * å‚æ•°æ•°ç»„è½¬å‚æ•°é…ç½®é›†åˆ * * @param parameters * @return */ private static List&lt;ArgumentConfig&gt; convert(Parameter[] parameters) { List&lt;ArgumentConfig&gt; argumentConfigs = new ArrayList&lt;&gt;(parameters.length); int start = 0; ArgumentConfig argumentConfig = null; for (Parameter parameter : parameters) { argumentConfig = new ArgumentConfig(); argumentConfig.setIndex(start); argumentConfig.setType(parameter.getType().getName()); argumentConfigs.add(argumentConfig); start += 1; } return argumentConfigs; }} ServiceConfig 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556package com.springboot.whb.study.rpc.rpc_v2.config;import com.alibaba.fastjson.JSON;import com.springboot.whb.study.rpc.rpc_v2.core.RpcService;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.Serializable;import java.net.InetAddress;import java.net.UnknownHostException;/** * @author: whb * @description: æœåŠ¡æ–¹é…ç½® */@Data@Slf4jpublic class ServiceConfig&lt;T&gt; extends BasicConfig implements Serializable { private static final long serialVersionUID = 1L; private T ref; /** * ç»Ÿè®¡è°ƒç”¨æ¬¡æ•°ä½¿ç”¨ */ private int count; @Override public String toString() { return JSON.toJSONString(this); } public static &lt;T&gt; ServiceConfig&lt;T&gt; convert(String interfaceName, Class&lt;T&gt; interfaceClass, T ref, RpcService rpcService) { ServiceConfig&lt;T&gt; serviceConfig = new ServiceConfig&lt;&gt;(); serviceConfig.setRef(ref); serviceConfig.setInterfaceName(interfaceName); serviceConfig.setInterfaceClass(interfaceClass); serviceConfig.setCount(0); serviceConfig.setMethods(MethodConfig.convert(interfaceClass.getMethods())); serviceConfig.setPort(rpcService.getPort()); serviceConfig.setType(ServiceType.PROVIDER); try { InetAddress addr = InetAddress.getLocalHost(); serviceConfig.setHost(addr.getHostAddress()); } catch (UnknownHostException e) { log.error("æœåŠ¡æ–¹è·å–æœ¬æœºåœ°å€å¤±è´¥ï¼Œerror:{}", e); } return serviceConfig; }} æšä¸¾å¸¸é‡ ServiceType 123456789101112131415161718192021222324252627package com.springboot.whb.study.rpc.rpc_v2.domain;/** * @author: whb * @description: æœåŠ¡ç±»å‹æšä¸¾å¸¸é‡ */public enum ServiceType { /** * æœåŠ¡æä¾›è€… */ PROVIDER("provider"), /** * æœåŠ¡æ¶ˆè´¹è€… */ CONSUMER("consumer"); private String type; ServiceType(String type) { this.type = type; } public String getType() { return type; }} åºåˆ—åŒ–ã€ååºåˆ—åŒ– SerializeProtocol 123456789101112131415161718package com.springboot.whb.study.rpc.rpc_v2.serialize;/** * @author: whb * @description: åºåˆ—åŒ–åè®®æ¥å£ */public interface SerializeProtocol { /** * åºåˆ—åŒ– */ &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t); /** * ååºåˆ—åŒ– */ &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes);} JavaInnerSerialize 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889package com.springboot.whb.study.rpc.rpc_v2.serialize;import lombok.extern.slf4j.Slf4j;import java.io.*;/** * @author: whb * @description: Javaåºåˆ—åŒ– */@Slf4jpublic class JavaInnerSerialize implements SerializeProtocol { /** * åºåˆ—åŒ– * * @param clazz * @param t * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t) { ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); ObjectOutputStream objectOutputStream = null; try { objectOutputStream = new ObjectOutputStream(outputStream); objectOutputStream.writeObject(t); objectOutputStream.flush(); byte[] bytes = outputStream.toByteArray(); return bytes; } catch (Exception e) { log.error("Java åºåˆ—åŒ–å¤±è´¥ï¼Œerror:{}", e); } finally { if (outputStream != null) { try { outputStream.close(); } catch (IOException e) { log.error("Java åºåˆ—åŒ–å…³é—­äºŒè¿›åˆ¶è¾“å‡ºæµå¤±è´¥,error:{}", e); } } if (objectOutputStream != null) { try { objectOutputStream.close(); } catch (IOException e) { log.error("Java åºåˆ—åŒ–å…³é—­å¯¹è±¡æµå¤±è´¥ï¼Œerror:{}", e); } } } return null; } /** * ååºåˆ—åŒ– * * @param clazz * @param bytes * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes) { ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes); ObjectInputStream objectInputStream = null; try { objectInputStream = new ObjectInputStream(inputStream); T obj = (T) objectInputStream.readObject(); return obj; } catch (Exception e) { log.error("Java ååºåˆ—åŒ–å¤±è´¥ï¼Œerror:{}", e); } finally { if (inputStream != null) { try { inputStream.close(); } catch (IOException e) { log.error("Java ååºåˆ—åŒ–å…³é—­äºŒè¿›åˆ¶è¾“å…¥æµå¤±è´¥ï¼Œerror:{}", e); } } if (objectInputStream != null) { try { objectInputStream.close(); } catch (IOException e) { log.error("Java ååºåˆ—åŒ–å…³é—­å¯¹è±¡è¾“å…¥æµå¤±è´¥ï¼Œerror:{}", e); } } } return null; }} HessianSerialize 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687package com.springboot.whb.study.rpc.rpc_v2.serialize;import com.alibaba.com.caucho.hessian.io.Hessian2Input;import com.alibaba.com.caucho.hessian.io.Hessian2Output;import lombok.extern.slf4j.Slf4j;import java.io.ByteArrayInputStream;import java.io.ByteArrayOutputStream;import java.io.IOException;/** * @author: whb * @description: HessianäºŒè¿›åˆ¶åºåˆ—åŒ– */@Slf4jpublic class HessianSerialize implements SerializeProtocol { /** * åºåˆ—åŒ– * * @param clazz * @param t * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; byte[] serialize(Class&lt;T&gt; clazz, T t) { ByteArrayOutputStream outputStream = new ByteArrayOutputStream(); Hessian2Output hessian2Output = new Hessian2Output(outputStream); try { //éªŒè¯è¿‡ï¼Œä¸€å®šéœ€è¦åœ¨flushä¹‹å‰å…³é—­æ‰hessian2Outputï¼Œå¦åˆ™è·å–çš„byteså­—æ®µä¿¡æ¯ä¸ºç©º hessian2Output.writeObject(t); } catch (IOException e) { throw new RuntimeException(e.getMessage()); } finally { try { hessian2Output.close(); } catch (IOException e) { log.error("Hessian äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå…³é—­æµå¤±è´¥ï¼Œerror:{}", e); } } try { outputStream.flush(); byte[] bytes = outputStream.toByteArray(); return bytes; } catch (IOException e) { throw new RuntimeException(e.getMessage()); } finally { try { outputStream.close(); } catch (IOException e) { log.error("Hessian äºŒè¿›åˆ¶åºåˆ—åŒ–ï¼Œå…³é—­è¾“å‡ºæµå¤±è´¥ï¼Œerror:{}", e); } } } /** * ååºåˆ—åŒ– * * @param clazz * @param bytes * @param &lt;T&gt; * @return */ @Override public &lt;T&gt; T deserialize(Class&lt;T&gt; clazz, byte[] bytes) { ByteArrayInputStream inputStream = new ByteArrayInputStream(bytes); Hessian2Input hessian2Input = new Hessian2Input(inputStream); try { T t = (T) hessian2Input.readObject(); return t; } catch (IOException e) { throw new RuntimeException(e.getMessage()); } finally { try { hessian2Input.close(); } catch (IOException e) { log.error("Hessian ååºåˆ—åŒ–ï¼Œæµå…³é—­å¤±è´¥ï¼Œerror:{}", e); } try { inputStream.close(); } catch (IOException e) { log.error("Hessian ååºåˆ—åŒ–ï¼Œè¾“å…¥æµå…³é—­å¤±è´¥ï¼Œerror:{}", e); } } }} è¯·æ±‚ã€å“åº”å¯¹è±¡ RpcRequest 1234567891011121314151617181920212223242526272829303132333435363738394041package com.springboot.whb.study.rpc.rpc_v2.core;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: RPCè¯·æ±‚å¯¹è±¡ */@Datapublic class RpcRequest implements Serializable { private static final long serialVersionUID = 1L; /** * ç±»å */ private String className; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private Object[] arguments; /** * å‚æ•°ç±»å‹ */ private Class&lt;?&gt;[] parameterTypes; @Override public String toString() { return JSON.toJSONString(this); }} RpcResponse 123456789101112131415161718192021222324252627282930313233343536package com.springboot.whb.study.rpc.rpc_v2.core;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.Serializable;/** * @author: whb * @description: RPCå“åº”å¯¹è±¡ */@Datapublic class RpcResponse&lt;T&gt; implements Serializable { private static final long serialVersionUID = 1L; /** * å“åº”ç»“æœ */ private T result; /** * æ˜¯å¦å‡ºé”™ */ private Boolean isError; /** * é”™è¯¯ä¿¡æ¯ */ private String errorMsg; @Override public String toString() { return JSON.toJSONString(this); }} æœåŠ¡ç«¯å¤„ç† ServiceConnection 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778package com.springboot.whb.study.rpc.rpc_v2.core;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.net.ServerSocket;import java.net.Socket;/** * @author: whb * @description: æœåŠ¡è¿æ¥ */@Slf4j@Datapublic class ServiceConnection implements Runnable { /** * ç«¯å£å· */ private int port; /** * æœåŠ¡å…³é—­æ ‡è®°ä½ */ private volatile boolean flag = true; /** * æœåŠ¡ç«¯å¥—æ¥å­— */ private ServerSocket serverSocket; /** * æœåŠ¡å¤„ç†å™¨ */ private ServiceHandler serviceHandler; /** * åˆå§‹åŒ– * * @param port * @param serviceHandler */ public void init(int port, ServiceHandler serviceHandler) { try { this.port = port; this.serverSocket = new ServerSocket(this.port); } catch (IOException e) { throw new RuntimeException("å¯åŠ¨å¤±è´¥ï¼š" + e.getMessage()); } this.serviceHandler = serviceHandler; log.info("æœåŠ¡å¯åŠ¨äº†..."); } @Override public void run() { while (flag) { try { Socket socket = serverSocket.accept(); serviceHandler.handler(socket); } catch (IOException e) { try { Thread.sleep(100); } catch (InterruptedException e1) { log.error("æœåŠ¡å¤„ç†å¼‚å¸¸ï¼Œerror:{}", e); } } } } /** * å…³é—­è¿æ¥ */ public void destory() { log.info("æœåŠ¡ç«¯å¥—æ¥å­—å…³é—­..."); this.flag = false; }} ServiceHandler 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.springboot.whb.study.rpc.rpc_v2.core;import com.google.common.util.concurrent.ThreadFactoryBuilder;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import lombok.Data;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.Socket;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadFactory;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æœåŠ¡ç«¯å¤„ç†å™¨ */@Slf4j@Datapublic class ServiceHandler { /** * çº¿ç¨‹æ±  */ private ThreadPoolExecutor executor = null; /** * æœåŠ¡æ¥å£ */ private RpcService rpcService; /** * æ¶ˆæ¯åè®® */ private MessageProtocol messageProtocol; public ServiceHandler(RpcService rpcService) { this.rpcService = rpcService; //åˆ›å»ºçº¿ç¨‹çš„çº¿ç¨‹å·¥å‚ ThreadFactory commonThreadName = new ThreadFactoryBuilder() .setNameFormat("Parse-Task-%d") .build(); //æ„é€ çº¿ç¨‹æ±  this.executor = new ThreadPoolExecutor( 10, 10, 2, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;&gt;(200), commonThreadName, (Runnable r, ThreadPoolExecutor executor) -&gt; { SocketTask socketTask = (SocketTask) r; Socket socket = socketTask.getSocket(); if (socket != null) { try { //æ— æ³•åŠæ—¶å¤„ç†å’Œå“åº”å°±å¿«é€Ÿæ‹’ç»æ‰ socket.close(); log.info("reject socket:" + socketTask + ", and closed."); } catch (IOException e) { log.error("socketå…³é—­å¤±è´¥ï¼Œerror:{}", e); } } } ); } /** * æœåŠ¡å¤„ç†ï¼šæ¥æ”¶åˆ°æ–°çš„å¥—æ¥å­—ï¼ŒåŒ…è£…æˆä¸ºä¸€ä¸ªrunnableæäº¤ç»™çº¿ç¨‹å»æ‰§è¡Œ * * @param socket */ public void handler(Socket socket) { this.executor.execute(new SocketTask(socket)); } class SocketTask implements Runnable { private Socket socket; public SocketTask(Socket socket) { this.socket = socket; } public Socket getSocket() { return socket; } @Override public void run() { try { InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); // è·å–å®¢æˆ·ç«¯è¯·æ±‚æ•°æ®ï¼Œç»Ÿä¸€åŒ…è£…æˆRpcRequest RpcRequest request = messageProtocol.serviceToRequest(inputStream); RpcResponse response = rpcService.invoke(request); log.info("request:[" + request + "],response:[" + response + "]"); // åå°„è°ƒç”¨ï¼Œå¾—åˆ°å…·ä½“çš„è¿”å›å€¼ messageProtocol.serviceGetResponse(response, outputStream); } catch (Exception e) { log.error("æœåŠ¡ç«¯å¤„ç†å‡ºç°å¼‚å¸¸ï¼Œerror:{}", e); } finally { if (socket != null) { try { socket.close(); } catch (IOException e) { log.error("socketå…³é—­å¤±è´¥ï¼Œerror:{}", e); } } } } }} RpcService 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158package com.springboot.whb.study.rpc.rpc_v2.core;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v2.config.ServiceConfig;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.DefaultMessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.register.ServiceRegister;import com.springboot.whb.study.rpc.rpc_v2.register.ZkServiceRegister;import lombok.Data;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: RPCæœåŠ¡ */@Slf4j@Datapublic class RpcService { /** * k æ˜¯æ¥å£å…¨åç§° * v æ˜¯å¯¹åº”çš„å¯¹è±¡åŒ…å«çš„è¯¦ç»†ä¿¡æ¯ */ private Map&lt;String, ServiceConfig&gt; serviceConfigMap = new HashMap&lt;&gt;(); /** * ç«¯å£å· */ private int port; /** * æœåŠ¡æ³¨å†Œ */ private ServiceRegister serviceRegister; /** * è¿æ¥å™¨è¿˜æœªæŠ½è±¡å¤„ç†ï¼Œä½¿ç”¨çš„è¿˜æ˜¯BIOæ¨¡å‹ */ private ServiceConnection serviceConnection; /** * æœåŠ¡å¤„ç†å™¨ */ private ServiceHandler serviceHandler; /** * çº¿ç¨‹æ±  */ ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("service-thread-pool-", "%s")).build()); public RpcService(int port) { this.port = port; this.serviceHandler = new ServiceHandler(this); this.serviceHandler.setMessageProtocol(new DefaultMessageProtocol()); this.serviceRegister = new ZkServiceRegister(); } /** * è®¾ç½®æ¶ˆæ¯åè®® * * @param messageProtocol */ public void setMessageProtocol(MessageProtocol messageProtocol) { if (this.serviceHandler == null) { throw new RuntimeException("å¥—æ¥å­—å¤„ç†å™¨æ— æ•ˆ"); } this.serviceHandler.setMessageProtocol(messageProtocol); } /** * æ·»åŠ æœåŠ¡æ¥å£ * * @param interfaceClass * @param ref * @param &lt;T&gt; */ public &lt;T&gt; void addService(Class&lt;T&gt; interfaceClass, T ref) { String interfaceName = interfaceClass.getName(); ServiceConfig&lt;T&gt; serviceConfig = ServiceConfig.convert(interfaceName, interfaceClass, ref, this); serviceConfigMap.put(interfaceName, serviceConfig); } /** * æ³¨å†ŒæœåŠ¡ */ private void register() { //æœåŠ¡æ³¨å†Œï¼Œåœ¨ç½‘ç»œç›‘å¬å¯åŠ¨ä¹‹å‰å°±éœ€è¦å®Œæˆ serviceConfigMap.values().forEach(serviceRegister::register); } /** * æœåŠ¡å¯åŠ¨ */ public void start() { this.register(); log.info("æœåŠ¡æ³¨å†Œå®Œæˆ"); this.serviceConnection = new ServiceConnection(); this.serviceConnection.init(port, serviceHandler); threadPoolExecutor.execute(serviceConnection); //ä¼˜é›…å…³é—­ Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; { RpcService.this.destroy(); })); } /** * é€šè¿‡åå°„æ‰§è¡Œï¼Œæ‰§è¡Œç»“æœå°è£…RpcResponse * * @param request * @param &lt;K&gt; * @param &lt;V&gt; * @return */ public &lt;K, V&gt; RpcResponse invoke(RpcRequest request) { if (request == null) { RpcResponse&lt;V&gt; response = new RpcResponse&lt;&gt;(); response.setResult(null); response.setIsError(true); response.setErrorMsg("æœªçŸ¥å¼‚å¸¸"); return response; } String className = request.getClassName(); //æš‚æ—¶ä¸è€ƒè™‘æ²¡æœ‰å¯¹åº”çš„serviceConfigçš„æƒ…å†µ ServiceConfig&lt;K&gt; serviceConfig = serviceConfigMap.get(className); K ref = serviceConfig.getRef(); try { Method method = ref.getClass().getMethod(request.getMethodName(), request.getParameterTypes()); V result = (V) method.invoke(ref, request.getArguments()); RpcResponse&lt;V&gt; response = new RpcResponse&lt;&gt;(); response.setResult(result); response.setIsError(false); response.setErrorMsg(""); return response; } catch (Exception e) { } return null; } /** * å…³é—­æœåŠ¡ */ public void destroy() { this.serviceConnection.destory(); log.info("æœåŠ¡ç«¯å…³é—­äº†"); }} å®¢æˆ·ç«¯å¤„ç† ä»£ç†å¯¹è±¡ProxyInstance 1234567891011121314151617181920212223242526272829303132333435363738394041424344package com.springboot.whb.study.rpc.rpc_v2.core;import lombok.extern.slf4j.Slf4j;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.net.InetSocketAddress;/** * @author: whb * @description: å®¢æˆ·ç«¯ä»£ç†å¯¹è±¡ */@Slf4jpublic class ProxyInstance implements InvocationHandler { /** * RPCè°ƒç”¨æ–¹ */ private RpcClient rpcClient; private Class clazz; public ProxyInstance(RpcClient client, Class clazz) { this.rpcClient = client; this.clazz = clazz; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { RpcRequest request = new RpcRequest(); request.setClassName(clazz.getName()); request.setMethodName(method.getName()); request.setArguments(args); request.setParameterTypes(method.getParameterTypes()); //è·å–æœåŠ¡æä¾›æ–¹ä¿¡æ¯ InetSocketAddress address = rpcClient.discovery(request); log.info("[" + Thread.currentThread().getName() + "] discovery service: " + address); //å‘èµ·ç½‘ç»œè¯·æ±‚ï¼Œå¾—åˆ°è¯·æ±‚æ•°æ® RpcResponse response = rpcClient.invoke(request, address); return response.getResult(); }} ClientHandler 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package com.springboot.whb.study.rpc.rpc_v2.core;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.MessageProtocol;import lombok.extern.slf4j.Slf4j;import java.io.IOException;import java.io.InputStream;import java.io.OutputStream;import java.net.InetSocketAddress;import java.net.Socket;/** * @author: whb * @description: å®¢æˆ·ç«¯å¤„ç†å™¨ */@Slf4jpublic class ClientHandler { private RpcClient rpcClient; private MessageProtocol messageProtocol; public ClientHandler(RpcClient rpcClient) { this.rpcClient = rpcClient; } public void setMessageProtocol(MessageProtocol messageProtocol) { this.messageProtocol = messageProtocol; } public &lt;T&gt; RpcResponse&lt;T&gt; invoke(RpcRequest request, InetSocketAddress address) { RpcResponse&lt;T&gt; response = new RpcResponse&lt;&gt;(); Socket socket = getSocketInstance(address); if (socket == null) { // å¥—æ¥å­—é“¾æ¥å¤±è´¥ response.setIsError(true); response.setErrorMsg("å¥—æ¥å­—é“¾æ¥å¤±è´¥"); return response; } try { InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); messageProtocol.clientToRequest(request, outputStream); response = messageProtocol.clientGetResponse(inputStream); } catch (IOException e) { log.error("å®¢æˆ·ç«¯å¤„ç†å¼‚å¸¸ï¼Œerror:{}", e); } finally { if (socket != null) { try { socket.close(); } catch (IOException e) { log.error("å®¢æˆ·ç«¯å…³é—­å¥—æ¥å­—å¤±è´¥ï¼Œerror:{}", e); } } } return response; } /** * è·å–å¯¹è±¡å®ä¾‹ * * @param address * @return */ private Socket getSocketInstance(InetSocketAddress address) { try { return new Socket(address.getHostString(), address.getPort()); } catch (IOException e) { log.error("å®¢æˆ·ç«¯è·å–å¥—æ¥å­—å¤±è´¥ï¼Œerror:{}", e); } return null; }} RpcClient 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101package com.springboot.whb.study.rpc.rpc_v2.core;import com.springboot.whb.study.rpc.rpc_v2.config.ClientConfig;import com.springboot.whb.study.rpc.rpc_v2.domain.ServiceType;import com.springboot.whb.study.rpc.rpc_v2.io.protocol.DefaultMessageProtocol;import com.springboot.whb.study.rpc.rpc_v2.register.ServiceRegister;import com.springboot.whb.study.rpc.rpc_v2.register.ZkServiceRegister;import java.net.InetSocketAddress;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: RPCå®¢æˆ·ç«¯ */public class RpcClient { /** * k æ˜¯æ¥å£çš„å…¨åç§° * v æ˜¯å¯¹åº”çš„å¯¹è±¡åŒ…å«çš„è¯¦ç»†ä¿¡æ¯ */ private Map&lt;String, ClientConfig&gt; clientConfigMap = new HashMap&lt;&gt;(); /** * æœåŠ¡æ³¨å†Œ */ private ServiceRegister serviceRegister; /** * å®¢æˆ·ç«¯å¤„ç†å™¨ */ private ClientHandler clientHandler; public RpcClient() { this.serviceRegister = new ZkServiceRegister(); this.clientHandler = new ClientHandler(this); // è®¾ç½®é»˜è®¤çš„æ¶ˆæ¯å¤„ç†åè®® this.clientHandler.setMessageProtocol(new DefaultMessageProtocol()); } /** * è®¢é˜…æœåŠ¡ * * @param clazz * @param &lt;T&gt; */ public &lt;T&gt; void subscribe(Class&lt;T&gt; clazz) { String interfaceName = clazz.getName(); ProxyInstance invocationHandler = new ProxyInstance(this, clazz); ClientConfig&lt;T&gt; clientConfig = ClientConfig.convert(clazz, invocationHandler); clientConfigMap.put(interfaceName, clientConfig); } /** * æœåŠ¡æ³¨å†Œ */ private void register() { // æœåŠ¡æ³¨å†Œï¼Œåœ¨ç½‘ç»œç›‘å¬å¯åŠ¨ä¹‹å‰å°±éœ€è¦å®Œæˆ clientConfigMap.values().forEach(serviceRegister::register); } /** * æœåŠ¡å¯åŠ¨ */ public void start() { this.register(); } /** * æœåŠ¡å‘ç° * * @param request * @return */ public InetSocketAddress discovery(RpcRequest request) { return serviceRegister.discovery(request, ServiceType.PROVIDER); } /** * åå°„è°ƒç”¨ * * @param request * @param address * @return */ public RpcResponse invoke(RpcRequest request, InetSocketAddress address) { return this.clientHandler.invoke(request, address); } /** * è·å–å¯¹è±¡å®ä¾‹ * * @param clazz * @param &lt;T&gt; * @return */ public &lt;T&gt; T getInstance(Class&lt;T&gt; clazz) { return (T) (clientConfigMap.get(clazz.getName()).getProxy()); }} æµ‹è¯• æµ‹è¯•æ¥å£å®šä¹‰Calculate 1234567891011121314151617181920212223242526package com.springboot.whb.study.rpc.rpc_v2.demo;/** * @author: whb * @description: æµ‹è¯•æ¥å£å®šä¹‰ */public interface Calculate&lt;T&gt; { /** * æ±‚å’Œ * * @param a * @param b * @return */ T add(T a, T b); /** * æ±‚å·® * * @param a * @param b * @return */ T sub(T a, T b);} æµ‹è¯•æ¥å£å®ç°ç±»SimpleCalculate 12345678910111213141516171819202122232425262728package com.springboot.whb.study.rpc.rpc_v2.demo;import java.util.Random;/** * @author: whb * @description: æµ‹è¯•æ¥å£å®ç°ç±» */public class SimpleCalculate implements Calculate&lt;Integer&gt; { @Override public Integer add(Integer a, Integer b) { long start = System.currentTimeMillis(); try { Thread.sleep(new Random().nextInt(1000)); } catch (InterruptedException e) { e.printStackTrace(); } int c = a + b; System.out.println(Thread.currentThread().getName() + " è€—æ—¶:" + (System.currentTimeMillis() - start)); return c; } @Override public Integer sub(Integer a, Integer b) { return a - b; }} æµ‹è¯•-æœåŠ¡ç«¯Service 12345678910111213141516package com.springboot.whb.study.rpc.rpc_v2.demo;import com.springboot.whb.study.rpc.rpc_v2.core.RpcService;/** * @author: whb * @description: æµ‹è¯•æœåŠ¡ç«¯ */public class Service { public static void main(String[] args) { RpcService rpcService = new RpcService(10001); rpcService.addService(Calculate.class, new SimpleCalculate()); rpcService.start(); }} æµ‹è¯•-å®¢æˆ·ç«¯Client 1234567891011121314151617181920212223242526272829303132333435363738package com.springboot.whb.study.rpc.rpc_v2.demo;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v2.core.RpcClient;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.util.Random;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æµ‹è¯•å®¢æˆ·ç«¯ */public class Client { public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); public static void main(String[] args) { RpcClient rpcClient = new RpcClient(); rpcClient.subscribe(Calculate.class); rpcClient.start(); Calculate&lt;Integer&gt; calculateProxy = rpcClient.getInstance(Calculate.class); for (int i = 0; i &lt; 200; i++) { threadPoolExecutor.execute(() -&gt; { long start = System.currentTimeMillis(); int s1 = new Random().nextInt(100); int s2 = new Random().nextInt(100); int s3 = calculateProxy.add(s1, s2); System.out.println("[" + Thread.currentThread().getName() + "]a: " + s1 + ", b:" + s2 + ", c=" + s3 + ", è€—æ—¶:" + (System.currentTimeMillis() - start)); }); } }} æµ‹è¯•ç»“æœ zookeeper æœåŠ¡ç«¯ å®¢æˆ·ç«¯ æ€»ç»“ v2ç‰ˆæœ¬ç›¸æ¯”v1ç‰ˆæœ¬ä¿®æ”¹äº†æ•´ä¸ªä»£ç ç»“æ„ï¼Œä½¿å¾—ç»“æ„èƒ½å¤Ÿæ›´åŠ æ˜ç¡®ï¼Œå¼•å…¥zookeeperä½œä¸ºæœåŠ¡æ²»ç†åŠŸèƒ½ï¼Œå¤§è‡´ä»‹ç»äº†zookeeperçš„ç‰¹ç‚¹ä»¥åŠåŠŸèƒ½ï¼Œç»™æœåŠ¡æ³¨å†Œã€æœåŠ¡å‘ç°ã€åºåˆ—åŒ–åè®®ç­‰å‡ç•™ä¸‹äº†å£å­ï¼Œä»¥ä¾¿å®ç°è‡ªå®šä¹‰çš„åè®®ï¼Œv1çš„ioæ¨¡å‹æ˜¯BIOï¼Œv2å¹¶æ²¡æœ‰å˜åŒ–ï¼Œåªæ˜¯ç”±å•çº¿ç¨‹æ”¹é€ æˆå¤šçº¿ç¨‹ã€‚ æ•´ä½“è€Œè¨€ç¬¦åˆä¸€ä¸ªç®€å•çš„rpcæ¡†æ¶ï¼Œä¾æ—§è¿˜æ˜¯æœ‰å¾ˆå¤šç‚¹å¯ä»¥å®Œå–„ã€ä¼˜åŒ–çš„ç‚¹ï¼Œå¦‚ï¼š ioæ¨¡å‹è¿˜æ˜¯æ²¡æœ‰æ›¿æ¢ï¼Œåé¢è€ƒè™‘ç›´æ¥æ•´ä½“æ¥å…¥nettyï¼› ä¸åº”è¯¥æ¯æ¬¡å®æ—¶ä»zkè·å–èŠ‚ç‚¹ä¿¡æ¯ï¼Œåº”è¯¥å…ˆè®¾ç½®ä¸€ä¸ªæœ¬åœ°ç¼“å­˜ï¼Œå†åˆ©ç”¨zookeeperçš„watcheråŠŸèƒ½ï¼Œå¼€å¯ä¸€ä¸ªå¼‚æ­¥çº¿ç¨‹å»ç›‘å¬æ›´æ–°æœ¬åœ°ç¼“å­˜ï¼Œé™ä½å’Œzkäº¤äº’å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼› æ²¡æœ‰å¿«é€Ÿå¤±è´¥ã€é‡è¯•çš„åŠŸèƒ½ï¼Œå®¢è§‚æƒ…å†µä¸‹å­˜åœ¨ç½‘ç»œæŠ–åŠ¨çš„é—®é¢˜ï¼Œé‡è¯•å°±å¯ä»¥äº†ã€‚ æ•´ä½“çš„å„ç§åè®®çº¦å®šå¹¶æ²¡æœ‰æ˜ç¡®è§„èŒƒï¼Œæ¯”è¾ƒæ··ä¹±ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ·»åŠ éŸ³ä¹æ’­æ”¾å™¨]]></title>
    <url>%2Fposts%2Fdb828ee7.html</url>
    <content type="text"><![CDATA[å†™åœ¨å‰é¢ ä¸ºåšå®¢æ·»åŠ éŸ³ä¹æ’­æ”¾å™¨åŠŸèƒ½ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šç§æ–¹å¼ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ’ä»¶å¯ä»¥ç”¨ï¼Œæ¯”å¦‚aplayerã€dplayerç­‰ç­‰ã€‚éƒ¨ç½²æ–¹å¼æ—¢å¯ä»¥ä½¿ç”¨hexoæ’ä»¶ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æå–distæ–‡ä»¶çš„æ–¹å¼ã€‚ æœ¬äººä¸ºè‡ªå·±çš„æ’­æ”¾é€‰æ‹©çš„aplayeræ’­æ”¾å™¨ï¼Œä¸€å¼€å§‹æ˜¯ä½¿ç”¨hexoæ’ä»¶çš„æ–¹å¼ï¼Œä½†æ˜¯éƒ¨ç½²çš„æ—¶å€™ä¸€ç›´æŠ¥æ ‡ç­¾è§£æçš„é”™è¯¯ï¼ŒæŸ¥äº†å¥½ä¹…ä¹Ÿæ²¡æŸ¥åˆ°åŸå› ï¼Œæ— å¥ˆï¼Œæ”¾å¼ƒä½¿ç”¨æ’ä»¶çš„æ–¹å¼ï¼Œæ”¹ä¸ºä½¿ç”¨æå–aplayerçš„distæ–‡ä»¶çš„æ–¹å¼ã€‚ ä¸‹è½½aplayer è®¿é—®aplayeræºç ï¼šGitHub Aplayer ï¼Œå°†æ–‡ä»¶ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹åå°†distæ–‡ä»¶å¤¹å¤åˆ¶åˆ° /themes/next/source æ–‡ä»¶å¤¹ä¸‹ã€‚ åˆ›å»ºæ ·å¼ æ–°å»ºmusic.js åœ¨/themes/next/source/distæ–‡ä»¶å¤¹ä¸­æ–°å»ºmusic.jsæ–‡ä»¶ï¼Œå°†ä¸‹é¢ä»£ç æ·»åŠ è¿›å»ï¼š 12345678910111213141516171819202122const ap = new APlayer({ container: document.getElementById('aplayer'), autoplay: false, loop: 'all', volume: 0.7, listFolded: true, listMaxHeight: 60, audio: [ { name: 'name1', artist: 'artist1', url: 'url1.mp3', cover: 'cover1.jpg', }, { name: 'name2', artist: 'artist2', url: 'url2.mp3', cover: 'cover2.jpg', } ]}); å‚æ•°ä¿®æ”¹ ä¸Šé¢ä»£ç ä¸ºä½ åœ¨hexoä¸Šç”Ÿæˆaplayeræ’­æ”¾å™¨çš„æ ·å¼ï¼Œå‚æ•°ä¿®æ”¹å‚è€ƒ å®˜æ–¹ä¸­æ–‡æ–‡æ¡£ ã€‚ ä¿®æ”¹aplayeræ ·å¼ &lt;span id="inline-blue"&gt; æ™®é€šæ¨¡å¼ï¼š&lt;/span&gt; 123456789const ap = new APlayer({ container: document.getElementById('aplayer'), audio: [{ name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg' }]}); &lt;span id="inline-green"&gt; æ•ˆæœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id="inline-blue"&gt; æ’­æ”¾åˆ—è¡¨æ¨¡å¼ï¼š&lt;/span&gt; 123456789101112131415161718192021222324const ap = new APlayer({ container: document.getElementById('player'), listFolded: false,//åˆ—è¡¨é»˜è®¤æŠ˜å  listMaxHeight: 90,//åˆ—è¡¨æœ€å¤§é«˜åº¦ lrcType: 3, //æ­¤ä¸ºæ­Œè¯æ ¼å¼ï¼Œæ²¡æœ‰æ­Œè¯å¯ä»¥ç›´æ¥åˆ æ‰è¿™ä¸€è¡Œ audio: [ { name: 'name1', artist: 'artist1', url: 'url1.mp3', cover: 'cover1.jpg', lrc: 'lrc1.lrc', theme: '#ebd0c2' }, { name: 'name2', artist: 'artist2', url: 'url2.mp3', cover: 'cover2.jpg', lrc: 'lrc2.lrc', theme: '#46718b' } ]}); &lt;span id="inline-green"&gt; æ•ˆæœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id="inline-blue"&gt; å¸åº•æ¨¡å¼ï¼š&lt;/span&gt; 12345678910const ap = new APlayer({ container: document.getElementById('player'), fixed: true, audio: [{ name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg', }]}); &lt;span id="inline-green"&gt; æ•ˆæœå¦‚ä¸‹ï¼š&lt;/span&gt; &lt;span id="inline-blue"&gt; è¿·ä½ åº•æ¨¡å¼ï¼š&lt;/span&gt; 12345678910const ap = new APlayer({ container: document.getElementById('player'), mini: true, audio: [{ name: 'name', artist: 'artist', url: 'url.mp3', cover: 'cover.jpg', }]}); &lt;span id="inline-purple"&gt; é™„ä¸Šæˆ‘çš„å‚æ•°ï¼š&lt;/span&gt; 1234567891011121314151617181920212223242526272829303132const ap = new APlayer({ container: document.getElementById('aplayer'), //æ’­æ”¾å™¨å®¹å™¨å…ƒç´  listFolded: false, //åˆ—è¡¨é»˜è®¤æŠ˜å  listMaxHeight: 90, //åˆ—è¡¨æœ€å¤§é«˜åº¦ //lrcType: 3, //æ­¤ä¸ºæ­Œè¯æ ¼å¼ï¼Œæ²¡æœ‰æ­Œè¯å¯ä»¥ç›´æ¥åˆ æ‰è¿™ä¸€è¡Œ mini: false, //è¿·ä½ æ¨¡å¼ autoplay: true, //è‡ªåŠ¨æ’­æ”¾ theme: '#FADFA3', //ä¸»é¢˜è‰² loop: 'all', //éŸ³é¢‘å¾ªç¯æ’­æ”¾, å¯é€‰å€¼: 'all'å…¨éƒ¨å¾ªç¯, 'one'å•æ›²å¾ªç¯, 'none'ä¸å¾ªç¯ order: 'list', //éŸ³é¢‘å¾ªç¯é¡ºåº, å¯é€‰å€¼: 'list'åˆ—è¡¨å¾ªç¯, 'random'éšæœºå¾ªç¯ preload: 'auto', //é¢„åŠ è½½ï¼Œå¯é€‰å€¼: 'none', 'metadata', 'auto' volume: 0.7, //é»˜è®¤éŸ³é‡ï¼Œè¯·æ³¨æ„æ’­æ”¾å™¨ä¼šè®°å¿†ç”¨æˆ·è®¾ç½®ï¼Œç”¨æˆ·æ‰‹åŠ¨è®¾ç½®éŸ³é‡åé»˜è®¤éŸ³é‡å³å¤±æ•ˆ mutex: false, //äº’æ–¥ï¼Œé˜»æ­¢å¤šä¸ªæ’­æ”¾å™¨åŒæ—¶æ’­æ”¾ï¼Œå½“å‰æ’­æ”¾å™¨æ’­æ”¾æ—¶æš‚åœå…¶ä»–æ’­æ”¾å™¨ audio: [ //éŸ³é¢‘ä¿¡æ¯ { name: 'å¤§é±¼', //éŸ³é¢‘åç§° artist: 'å‘¨æ·±ã€éƒ­æ²', //éŸ³é¢‘è‰ºæœ¯å®¶ url: '"http://lc-tguve1gk.cn-n1.lcfile.com/47b5548df9c80bba84f4/%E5%91%A8%E6%B7%B1%E3%80%81%E9%83%AD%E6%B2%81%20-%20%E5%A4%A7%E9%B1%BC%20%282017%E4%B8%AD%E5%9B%BD%E6%96%B0%E6%AD%8C%E5%A3%B0%E7%AC%AC%E4%BA%8C%E5%AD%A3%E7%AC%AC%E5%8D%81%E6%9C%9F%E7%8E%B0%E5%9C%BA%E4%BC%B4%E5%A5%8F%29.mp3', //éŸ³é¢‘é“¾æ¥ cover: 'http://lc-tguve1gk.cn-n1.lcfile.com/a9fff99abbddc8757d4b/%E5%A4%A7%E9%B1%BC.jpg', //éŸ³é¢‘å°é¢ //lrc: 'lrc1.lrc', //æ­Œè¯ theme: '#ebd0c2' //åˆ‡æ¢åˆ°æ­¤éŸ³é¢‘æ—¶çš„ä¸»é¢˜è‰²ï¼Œæ¯”ä¸Šé¢çš„ theme ä¼˜å…ˆçº§é«˜ }, { name: 'Something just like this', artist: 'Alex Goot _ Madilyn Bailey', url: 'http://lc-tguve1gk.cn-n1.lcfile.com/f3bee3260fa207648d34/Alex%20Goot%20_%20Madilyn%20Bailey%20-%20Something%20Just%20Like%20This.mp3', cover: 'http://lc-tguve1gk.cn-n1.lcfile.com/d21b8e3392433807b1e2/Something%20just%20like%20this.jpg', //lrc: 'lrc2.lrc', theme: '#46718b' } ]}); éƒ¨ç½² aplayerçš„æ ·å¼è®¾ç½®å¥½ä¹‹åå°±å¯ä»¥æŠŠaplayeræ”¾åœ¨è‡ªå·±æƒ³è¦æ”¾ç½®çš„ä½ç½®ä¸Šï¼Œæ”¾ç½®ä»£ç å¦‚ä¸‹ï¼š 1234&lt;link rel="stylesheet" href="/dist/APlayer.min.css"&gt;&lt;div id="aplayer"&gt;&lt;/div&gt;&lt;script type="text/javascript" src="/dist/APlayer.min.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="/dist/music.js"&gt;&lt;/script&gt; å°†æ”¾ç½®ä»£ç æ”¾åœ¨ä¸åŒçš„/themes/next/layout/xxx.swigæ–‡ä»¶å†…ä¼šæœ‰ä¸åŒçš„æ•ˆæœã€‚ æ¯ä¸ªäººä½¿ç”¨çš„ä¸»é¢˜ä¸ä¸€æ ·ï¼Œè¦æ ¹æ®è‡ªå·±çš„ä¸»é¢˜å»è°ƒè¯•ã€‚ä¾‹å¦‚æˆ‘ç”¨çš„æ˜¯next-mistä¸»é¢˜ï¼Œä¸”å–œæ¬¢æ”¾ç½®åœ¨ä¾§è¾¹æ ã€‚é‚£ä¹ˆåœ¨/themes/next/layout/_marcoæ–‡ä»¶å¤¹ä¸‹æ‰¾åˆ°sidebar.swigæ–‡ä»¶ã€‚ å¦‚æœè¦æ”¾ç½®åœ¨ä¾§è¾¹æ çš„å‹é“¾ä¸‹é¢,é‚£ä¹ˆåœ¨sidebar.swigä¸­æ‰¾åˆ°if theme.linksï¼Œå°†æ”¾ç½®ä»£ç æ·»åŠ åˆ°endifä¹‹åã€‚å¦‚ä¸‹å›¾ï¼š å¦‚è¦æ”¾ç½®åˆ°RSSä¸‹å°±åœ¨sidebar.swigä¸­æœç´¢if theme.rssï¼Œä¹Ÿæ˜¯æ·»åŠ åˆ°endifä¹‹åã€‚ æˆ‘æ˜¯é€‰æ‹©æ”¾åœ¨äº†å‹é“¾ä¸‹æ–¹ï¼Œå¦‚ä¸‹å›¾ï¼š æœ€ç»ˆæ•ˆæœå¦‚ä¸‹å›¾ï¼š åˆ¶ä½œéŸ³ä¹/å›¾ç‰‡å¤–é“¾ æ­£å¦‚ä¹‹å‰ä¸ºåšå®¢æ·»åŠ è¯„è®ºåŠç»Ÿè®¡åŠŸèƒ½çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†LeanCloudï¼Œåˆ¶ä½œéŸ³ä¹/å›¾ç‰‡çš„å¤–é“¾åŒæ ·ä¹Ÿå¯ä»¥ä½¿ç”¨å®ƒã€‚ æ³¨å†Œã€ç™»é™†çš„æ­¥éª¤åœ¨ä¹‹å‰çš„æ–‡ç« é‡Œå·²ç»æç»˜è¿‡äº†ï¼Œè¿™é‡Œä¸å†è¯¦è¿°ï¼Œæˆ‘ä»¬ç›´æ¥æ­¥å…¥æ­£é¢˜ã€‚ åˆ°ä½ åˆ›å»ºçš„åº”ç”¨é‡Œé¢å»ï¼Œç‚¹å‡»å­˜å‚¨ï¼Œå¦‚ä¸‹å›¾ã€‚ç‚¹å‡»_Fileï¼Œç‚¹å‡»ä¸Šä¼ ï¼Œæ‰¾åˆ°ä½ ä¸‹è½½å¥½çš„éŸ³ä¹æ–‡ä»¶å’ŒéŸ³ä¹å›¾ç‰‡ä¸Šä¼ ä¸Šå»å°±è¡Œäº†ã€‚ ä¸Šä¼ ä¹‹ååˆ·æ–°é¡µé¢ï¼Œå°†åˆ—è¡¨å‘åæ‹‰ï¼Œå°±å¯ä»¥çœ‹åˆ°å¯¹åº”çš„éŸ³ä¹å’Œå›¾ç‰‡çš„urlè¿æ¥äº†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[åˆ†å¸ƒå¼å­¦ä¹ -ä¸€è‡´æ€§Hashç®—æ³•]]></title>
    <url>%2Fposts%2F302399c9.html</url>
    <content type="text"><![CDATA[ç¤ºä¾‹å¼•å…¥ æ¯”å¦‚ç°åœ¨æœ‰ N ä¸ª Redis æœåŠ¡å™¨ï¼Œä¸è€ƒè™‘ä½¿ç”¨Redis Clusterçš„æƒ…å†µä¸‹ï¼Œé‚£ä¹ˆå¦‚ä½•å°†ä¸€ä¸ªå¯¹è±¡ object æ˜ å°„åˆ° N ä¸ª Redis ä¸Šå‘¢ï¼Ÿ ä½ å¾ˆå¯èƒ½ä¼šé‡‡ç”¨ç±»ä¼¼ä¸‹é¢çš„é€šç”¨æ–¹æ³•è®¡ç®— object çš„ hash å€¼ï¼Œç„¶åå‡åŒ€çš„æ˜ å°„åˆ°åˆ° N ä¸ª cacheï¼š æ±‚ä½™ç®—æ³•: hash(object) % N è¿™ç§é€šç”¨çš„è®¡ç®—æ–¹æ³•æœ‰ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ ä¸€ä¸ª redis æœåŠ¡å™¨ x å®• æ‰äº†ï¼Œè¿™æ ·æ‰€æœ‰æ˜ å°„åˆ° redis x çš„å¯¹è±¡éƒ½ä¼šå¤±æ•ˆã€‚æ€ä¹ˆåŠï¼Ÿéœ€è¦æŠŠ redis x ä» redisé›†ç¾¤ä¸­ç§»é™¤ï¼Œè¿™æ—¶å€™ redisæœåŠ¡å™¨ æ˜¯ N-1 å°ï¼Œé‚£ä¹ˆå¯¹åº”æ˜ å°„å…¬å¼å˜æˆäº† hash(object)%(N-1) ï¼› è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ç”±äºè®¿é—®é‡å¢å¤šï¼Œéœ€è¦æ·»åŠ  redis ï¼Œè¿™æ—¶å€™ redis æ˜¯ N+1 å°ï¼Œæ˜ å°„å…¬å¼å˜æˆäº† hash(object)%(N+1) ï¼› 1 å’Œ 2 æ„å‘³ç€çªç„¶ä¹‹é—´å‡ ä¹æ‰€æœ‰çš„ redisç¼“å­˜éƒ½å¤±æ•ˆäº†ã€‚å¯¹äºæœåŠ¡å™¨è€Œè¨€ï¼Œè¿™æ˜¯ä¸€åœºç¾éš¾ï¼Œæ‰€æœ‰çš„è®¿é—®éƒ½ä¼šç›´æ¥å†²å‘åç«¯æœåŠ¡å™¨ï¼Œå¯¹åç«¯æœåŠ¡å™¨é€ æˆå‹åŠ›ï¼Œç”šè‡³æ˜¯åç«¯æœåŠ¡å™¨ç˜«ç—ªã€‚ å¦‚ä½•è§£å†³ä¸Šé¢çš„é—®é¢˜å‘¢ï¼Ÿä¸€è‡´æ€§hashç®—æ³•å°±æ´¾ä¸Šç”¨åœºäº†ã€‚ ä¸€è‡´æ€§Hashç®—æ³• ä¸€è‡´æ€§Hashç”¨äºåˆ†å¸ƒå¼ç¼“å­˜ç³»ç»Ÿï¼Œå°†Keyå€¼æ˜ å°„åˆ°å…·ä½“æœºå™¨Ipä¸Šï¼Œå¹¶ä¸”å¢åŠ å’Œåˆ é™¤1å°æœºå™¨çš„æ•°æ®ç§»åŠ¨é‡è¾ƒå°ã€‚ ä¸€è‡´æ€§Hashç®—æ³•ä¹Ÿæ˜¯ä½¿ç”¨å–æ¨¡çš„æ–¹æ³•ï¼Œåªæ˜¯ï¼Œåˆšæ‰æè¿°çš„å–æ¨¡æ³•æ˜¯å¯¹æœåŠ¡å™¨çš„æ•°é‡è¿›è¡Œå–æ¨¡ï¼Œè€Œä¸€è‡´æ€§Hashç®—æ³•æ˜¯å¯¹2^32å–æ¨¡ã€‚ ç®€å•æ¥è¯´ï¼Œä¸€è‡´æ€§Hashç®—æ³•å°†æ•´ä¸ªå“ˆå¸Œå€¼ç©ºé—´ç»„ç»‡æˆä¸€ä¸ªè™šæ‹Ÿçš„åœ†ç¯ï¼Œå¦‚å‡è®¾æŸå“ˆå¸Œå‡½æ•°Hçš„å€¼ç©ºé—´ä¸º0-2^32-1ï¼ˆå³å“ˆå¸Œå€¼æ˜¯ä¸€ä¸ª32ä½æ— ç¬¦å·æ•´å½¢ï¼‰ï¼Œæ•´ä¸ªå“ˆå¸Œç¯å¦‚ä¸‹ï¼š æ•´ä¸ªç©ºé—´æŒ‰é¡ºæ—¶é’ˆæ–¹å‘ç»„ç»‡ï¼Œåœ†ç¯çš„æ­£ä¸Šæ–¹çš„ç‚¹ä»£è¡¨0ï¼Œ0ç‚¹å³ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨1ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ2ã€3ã€4ã€5ã€6â€¦â€¦ç›´åˆ°2^32-1ï¼Œä¹Ÿå°±æ˜¯è¯´0ç‚¹å·¦ä¾§çš„ç¬¬ä¸€ä¸ªç‚¹ä»£è¡¨2^32-1ï¼Œ 0å’Œ2^32-1åœ¨é›¶ç‚¹ä¸­æ–¹å‘é‡åˆï¼ŒæŠŠè¿™ä¸ªç”±2^32ä¸ªç‚¹ç»„æˆçš„åœ†ç¯ç§°ä¸ºHashç¯ã€‚ ä»¥ä¸Šé¢çš„åœºæ™¯ä¸ºä¾‹ï¼Œå‡è®¾æœ‰4å°ç¼“å­˜æœåŠ¡å™¨ï¼Œnode1ã€node2ã€node3ï¼Œnode4ï¼Œé‚£ä¹ˆï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œè¿™4å°æœåŠ¡å™¨è‚¯å®šæœ‰è‡ªå·±çš„IPåœ°å€æˆ–ä¸»æœºåï¼Œç”¨å®ƒä»¬å„è‡ªçš„IPåœ°å€æˆ–ä¸»æœºåä½œä¸ºå…³é”®å­—è¿›è¡Œå“ˆå¸Œè®¡ç®—ï¼Œä½¿ç”¨å“ˆå¸Œåçš„ç»“æœå¯¹2^32å–æ¨¡ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å…¬å¼ï¼š hashï¼ˆnode1çš„IPåœ°å€ï¼‰ % 2^32 é€šè¿‡ä¸Šé¢å…¬å¼ç®—å‡ºçš„ç»“æœä¸€å®šèƒ½å¾—åˆ°ä¸€ä¸ª0åˆ°2^32-1ä¹‹é—´çš„æ•´æ•°ï¼Œå°±ç”¨å¾—å‡ºçš„æ•´æ•°ï¼Œä»£è¡¨æœåŠ¡å™¨node1ï¼Œæ—¢ç„¶è¿™ä¸ªæ•´æ•°è‚¯å®šå¤„äº0åˆ°2^32-1ä¹‹é—´ï¼Œé‚£ä¹ˆï¼Œä¸Šå›¾ä¸­çš„hashç¯ä¸Šå¿…å®šæœ‰ä¸€ä¸ªç‚¹ä¸è¿™ä¸ªæ•´æ•°å¯¹åº”ï¼Œä¹Ÿå°±æ˜¯æœåŠ¡å™¨node1ï¼Œé‚£ä¹ˆï¼ŒæœåŠ¡å™¨node1å°±å¯ä»¥æ˜ å°„åˆ°è¿™ä¸ªç¯ä¸Šäº†ï¼Œå…¶ä»–æœåŠ¡å™¨ä¾æ¬¡ç±»æ¨å³å¯å¾—åˆ°ç›¸åº”çš„ä½ç½®ï¼Œå¦‚ä¸‹å›¾ï¼š æ¥ä¸‹æ¥ä½¿ç”¨å¦‚ä¸‹ç®—æ³•å®šä½æ•°æ®è®¿é—®åˆ°ç›¸åº”æœåŠ¡å™¨ï¼š å°†æ•°æ®keyä½¿ç”¨ç›¸åŒçš„å‡½æ•°Hashè®¡ç®—å‡ºå“ˆå¸Œå€¼ï¼Œå¹¶ç¡®å®šæ­¤æ•°æ®åœ¨ç¯ä¸Šçš„ä½ç½®ï¼Œä»æ­¤ä½ç½®æ²¿ç¯é¡ºæ—¶é’ˆâ€œè¡Œèµ°â€ï¼Œé‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨å°±æ˜¯è¯¥æ•°æ®åº”è¯¥æ˜ å°„åˆ°çš„æœåŠ¡å™¨ã€‚ ä¾‹å¦‚æˆ‘ä»¬æœ‰Object Aã€Object Bã€Object Cã€Object Då››ä¸ªæ•°æ®å¯¹è±¡ï¼Œç»è¿‡å“ˆå¸Œè®¡ç®—åï¼Œåœ¨ç¯ç©ºé—´ä¸Šçš„ä½ç½®å¦‚ä¸‹ï¼š æ ¹æ®ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ï¼Œæ•°æ®Aä¼šè¢«å®šä¸ºåˆ°Node Aä¸Šï¼ŒBè¢«å®šä¸ºåˆ°Node Bä¸Šï¼ŒCè¢«å®šä¸ºåˆ°Node Cä¸Šï¼ŒDè¢«å®šä¸ºåˆ°Node Dä¸Šã€‚ ä¸€è‡´æ€§hashç®—æ³•çš„å®¹é”™æ€§å’Œæ‰©å±•æ€§ ç°åœ¨å‡è®¾Node Cä¸å¹¸å®•æœºï¼Œå¯ä»¥çœ‹åˆ°æ­¤æ—¶å¯¹è±¡Aã€Bã€Dä¸ä¼šå—åˆ°å½±å“ï¼Œåªæœ‰Cå¯¹è±¡è¢«é‡å®šä½åˆ°Node Dã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœä¸€å°æœåŠ¡å™¨ä¸å¯ç”¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ­¤æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒä¸ä¼šå—åˆ°å½±å“ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä¸‹é¢è€ƒè™‘å¦å¤–ä¸€ç§æƒ…å†µï¼Œå¦‚æœåœ¨ç³»ç»Ÿä¸­å¢åŠ ä¸€å°æœåŠ¡å™¨Node Xï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š æ­¤æ—¶å¯¹è±¡Object Aã€Bã€Dä¸å—å½±å“ï¼Œåªæœ‰å¯¹è±¡Céœ€è¦é‡å®šä½åˆ°æ–°çš„Node X ã€‚ ä¸€èˆ¬çš„ï¼Œåœ¨ä¸€è‡´æ€§å“ˆå¸Œç®—æ³•ä¸­ï¼Œå¦‚æœå¢åŠ ä¸€å°æœåŠ¡å™¨ï¼Œåˆ™å—å½±å“çš„æ•°æ®ä»…ä»…æ˜¯æ–°æœåŠ¡å™¨åˆ°å…¶ç¯ç©ºé—´ä¸­å‰ä¸€å°æœåŠ¡å™¨ï¼ˆå³æ²¿ç€é€†æ—¶é’ˆæ–¹å‘è¡Œèµ°é‡åˆ°çš„ç¬¬ä¸€å°æœåŠ¡å™¨ï¼‰ä¹‹é—´æ•°æ®ï¼Œå…¶å®ƒæ•°æ®ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œä¸€è‡´æ€§å“ˆå¸Œç®—æ³•å¯¹äºèŠ‚ç‚¹çš„å¢å‡éƒ½åªéœ€é‡å®šä½ç¯ç©ºé—´ä¸­çš„ä¸€å°éƒ¨åˆ†æ•°æ®ï¼Œå…·æœ‰è¾ƒå¥½çš„å®¹é”™æ€§å’Œå¯æ‰©å±•æ€§ã€‚ Hashç¯çš„æ•°æ®å€¾æ–œé—®é¢˜ ä¸€è‡´æ€§Hashç®—æ³•åœ¨æœåŠ¡èŠ‚ç‚¹å¤ªå°‘æ—¶ï¼Œå®¹æ˜“å› ä¸ºèŠ‚ç‚¹åˆ†éƒ¨ä¸å‡åŒ€è€Œé€ æˆæ•°æ®å€¾æ–œï¼ˆè¢«ç¼“å­˜çš„å¯¹è±¡å¤§éƒ¨åˆ†é›†ä¸­ç¼“å­˜åœ¨æŸä¸€å°æœåŠ¡å™¨ä¸Šï¼‰é—®é¢˜ï¼Œä¾‹å¦‚ç³»ç»Ÿä¸­åªæœ‰ä¸¤å°æœåŠ¡å™¨ï¼Œå…¶ç¯åˆ†å¸ƒå¦‚ä¸‹ï¼š æ­¤æ—¶å¿…ç„¶é€ æˆå¤§é‡æ•°æ®é›†ä¸­åˆ°Node Aä¸Šï¼Œè€Œåªæœ‰æå°‘é‡ä¼šå®šä½åˆ°Node Bä¸Šã€‚ä¸ºäº†è§£å†³è¿™ç§æ•°æ®å€¾æ–œé—®é¢˜ï¼Œä¸€è‡´æ€§Hashç®—æ³•å¼•å…¥äº†è™šæ‹ŸèŠ‚ç‚¹æœºåˆ¶ï¼Œå³å¯¹æ¯ä¸€ä¸ªæœåŠ¡èŠ‚ç‚¹è®¡ç®—å¤šä¸ªå“ˆå¸Œï¼Œæ¯ä¸ªè®¡ç®—ç»“æœä½ç½®éƒ½æ”¾ç½®ä¸€ä¸ªæ­¤æœåŠ¡èŠ‚ç‚¹ï¼Œç§°ä¸ºè™šæ‹ŸèŠ‚ç‚¹ã€‚å…·ä½“åšæ³•å¯ä»¥åœ¨æœåŠ¡å™¨IPæˆ–ä¸»æœºåçš„åé¢å¢åŠ ç¼–å·æ¥å®ç°ã€‚ ä¾‹å¦‚ä¸Šé¢çš„æƒ…å†µï¼Œå¯ä»¥ä¸ºæ¯å°æœåŠ¡å™¨è®¡ç®—ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼Œäºæ˜¯å¯ä»¥åˆ†åˆ«è®¡ç®— â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ã€â€œNode B#1â€ã€â€œNode B#2â€ã€â€œNode B#3â€çš„å“ˆå¸Œå€¼ï¼Œäºæ˜¯å½¢æˆå…­ä¸ªè™šæ‹ŸèŠ‚ç‚¹ï¼š åŒæ—¶æ•°æ®å®šä½ç®—æ³•ä¸å˜ï¼Œåªæ˜¯å¤šäº†ä¸€æ­¥è™šæ‹ŸèŠ‚ç‚¹åˆ°å®é™…èŠ‚ç‚¹çš„æ˜ å°„ï¼Œä¾‹å¦‚å®šä½åˆ°â€œNode A#1â€ã€â€œNode A#2â€ã€â€œNode A#3â€ä¸‰ä¸ªè™šæ‹ŸèŠ‚ç‚¹çš„æ•°æ®å‡å®šä½åˆ°Node Aä¸Šã€‚è¿™æ ·å°±è§£å†³äº†æœåŠ¡èŠ‚ç‚¹å°‘æ—¶æ•°æ®å€¾æ–œçš„é—®é¢˜ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œé€šå¸¸å°†è™šæ‹ŸèŠ‚ç‚¹æ•°è®¾ç½®ä¸º32ç”šè‡³æ›´å¤§ï¼Œå› æ­¤å³ä½¿å¾ˆå°‘çš„æœåŠ¡èŠ‚ç‚¹ä¹Ÿèƒ½åšåˆ°ç›¸å¯¹å‡åŒ€çš„æ•°æ®åˆ†å¸ƒã€‚ ä¸€è‡´æ€§Hashç®—æ³•çš„Javaå®ç° HashUtilså·¥å…·ç±» 1234567891011121314151617181920212223242526272829303132package com.springboot.whb.study.consistentHashing;/** * @author: whb * @description: Hashå·¥å…·ç±» */public class HashUtils { /** * ä½¿ç”¨FNV1_32_HASHç®—æ³•è®¡ç®—æœåŠ¡å™¨çš„Hashå€¼ * * @param str * @return */ public static int getHash(String str) { final int p = 16777619; int hash = (int) 2166136261L; for (int i = 0; i &lt; str.length(); i++) { hash = (hash ^ str.charAt(i)) * p; } hash += hash &lt;&lt; 13; hash ^= hash &gt;&gt; 7; hash += hash &lt;&lt; 3; hash ^= hash &gt;&gt; 17; hash += hash &lt;&lt; 5; // å¦‚æœç®—å‡ºæ¥çš„å€¼ä¸ºè´Ÿæ•°åˆ™å–å…¶ç»å¯¹å€¼ if (hash &lt; 0) { hash = Math.abs(hash); } return hash; }} ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹ å…·ä½“ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263package com.springboot.whb.study.consistentHashing;import java.util.SortedMap;import java.util.TreeMap;/** * @author: whb * @description: ä¸€è‡´æ€§Hashç®—æ³•--ä¸å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„å®ç° */public class ConsistentHashingWithoutVirtualNode { /** * å¾…æ·»åŠ åˆ°Hashç¯çš„æœåŠ¡å™¨ */ private static String[] servers = {"127.0.0.1:7000", "127.0.0.1:7001", "127.0.0.1:7002", "127.0.0.1:7003", "127.0.0.1:7004"}; /** * keyè¡¨ç¤ºæœåŠ¡å™¨çš„Hashå€¼ï¼Œvalueè¡¨ç¤ºæœåŠ¡å™¨ */ private static SortedMap&lt;Integer, String&gt; sortedMap = new TreeMap&lt;&gt;(); /** * åˆå§‹åŒ–ï¼Œå°†æ‰€æœ‰æœåŠ¡å™¨æ”¾å…¥sortedMap */ static { for (int i = 0; i &lt; servers.length; i++) { int hash = HashUtils.getHash(servers[i]); System.out.println("[" + servers[i] + "]åŠ å…¥é›†åˆä¸­, å…¶Hashå€¼ä¸ºï¼š" + hash); sortedMap.put(hash, servers[i]); } System.out.println(); } /** * å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹ * * @param key * @return */ private static String getServer(String key) { //å¾—åˆ°è¯¥keyçš„hashå€¼ int hash = HashUtils.getHash(key); //å¾—åˆ°å¤§äºè¯¥Hashå€¼çš„æ‰€æœ‰Map SortedMap&lt;Integer, String&gt; subMap = sortedMap.tailMap(hash); if (subMap.isEmpty()) { //å¦‚æœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªnodeå¼€å§‹ Integer i = sortedMap.firstKey(); //è¿”å›å¯¹åº”çš„æœåŠ¡å™¨ return sortedMap.get(i); } else { //ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡å»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹ Integer i = subMap.firstKey(); //è¿”å›å¯¹åº”çš„æœåŠ¡å™¨ return subMap.get(i); } } public static void main(String[] args) { String[] keys = {"æ–—å¸", "æ–—åœ£", "æ–—å°Š", "æ–—å®—", "æ–—çš‡", "æ–—ç‹", "æ–—çµ", "å¤§æ–—å¸ˆ", "æ–—å¸ˆ", "æ–—è€…"}; for (String key : keys) { System.out.println("[" + key + "]çš„hashå€¼ä¸ºï¼š" + HashUtils.getHash(key) + ", è¢«è·¯ç”±åˆ°ç»“ç‚¹[" + getServer(key) + "]"); } }} æµ‹è¯•ç»“æœ å¸¦è™šæ‹ŸèŠ‚ç‚¹ å…·ä½“ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114package com.springboot.whb.study.consistentHashing;import com.springboot.whb.study.common.util.StringUtils;import java.util.LinkedList;import java.util.List;import java.util.SortedMap;import java.util.TreeMap;/** * @author: whb * @description: ä¸€è‡´æ€§Hashç®—æ³•--å¸¦è™šæ‹ŸèŠ‚ç‚¹çš„å®ç° */public class ConsistentHashingWithVirtualNode { /** * å¾…æ·»åŠ åˆ°Hashç¯çš„æœåŠ¡å™¨ */ private static String[] servers = {"127.0.0.1:7000", "127.0.0.1:7001", "127.0.0.1:7002", "127.0.0.1:7003", "127.0.0.1:7004"}; /** * çœŸå®èŠ‚ç‚¹åˆ—è¡¨ï¼Œè€ƒè™‘åˆ°æœåŠ¡å™¨çš„ä¸Šçº¿ã€ä¸‹çº¿ï¼Œå³æ·»åŠ ã€åˆ é™¤çš„åœºæ™¯ä¼šæ¯”è¾ƒé¢‘ç¹ */ private static List&lt;String&gt; realNodes = new LinkedList&lt;&gt;(); /** * è™šæ‹ŸèŠ‚ç‚¹ï¼ŒKeyè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„Hashå€¼ï¼Œvalueè¡¨ç¤ºè™šæ‹ŸèŠ‚ç‚¹çš„åç§° */ private static SortedMap&lt;Integer, String&gt; virtualNodes = new TreeMap&lt;&gt;(); /** * è™šæ‹ŸèŠ‚ç‚¹çš„æ•°ç›® */ private static final int VIRTUAL_NODES = 5; /** * åˆå§‹åŒ–ï¼ŒåŠ å…¥çœŸå®èŠ‚ç‚¹åŠè™šæ‹ŸèŠ‚ç‚¹ */ static { //å…ˆå°†åŸå§‹çš„æœåŠ¡å™¨æ·»åŠ åˆ°çœŸå®èŠ‚ç‚¹åˆ—è¡¨ for (int i = 0; i &lt; servers.length; i++) { realNodes.add(servers[i]); } //æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ï¼Œéå†çœŸå®èŠ‚ç‚¹åˆ—è¡¨ for (String str : realNodes) { for (int i = 0; i &lt; VIRTUAL_NODES; i++) { String virtualNodeName = str + "&amp;&amp;VN" + String.valueOf(i); setServer(virtualNodeName); } } System.out.println(); } /** * æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ * * @param virtualNodeName */ private static void setServer(String virtualNodeName) { setServer(virtualNodeName, null); } /** * æ·»åŠ è™šæ‹ŸèŠ‚ç‚¹ * * @param virtualNodeName * @param hash */ private static void setServer(String virtualNodeName, Integer hash) { hash = hash != null ? HashUtils.getHash(hash.toString()) : HashUtils.getHash(virtualNodeName); if (StringUtils.isBlank(virtualNodes.get(hash))) { virtualNodes.put(hash, virtualNodeName); System.out.println("è™šæ‹ŸèŠ‚ç‚¹[" + virtualNodeName + "]è¢«æ·»åŠ , hashå€¼ä¸ºï¼š" + hash); } else { //è§£å†³Hashç¢°æ’ setServer(virtualNodeName, hash); } } /** * å¾—åˆ°åº”å½“è·¯ç”±åˆ°çš„ç»“ç‚¹ * * @param key * @return */ private static String getServer(String key) { //å¾—åˆ°è¯¥keyçš„hashå€¼ int hash = HashUtils.getHash(key); // å¾—åˆ°å¤§äºè¯¥Hashå€¼çš„æ‰€æœ‰Map SortedMap&lt;Integer, String&gt; subMap = virtualNodes.tailMap(hash); String virtualNode; if (subMap.isEmpty()) { //å¦‚æœæ²¡æœ‰æ¯”è¯¥keyçš„hashå€¼å¤§çš„ï¼Œåˆ™ä»ç¬¬ä¸€ä¸ªnodeå¼€å§‹ Integer i = virtualNodes.firstKey(); //è¿”å›å¯¹åº”çš„æœåŠ¡å™¨ virtualNode = virtualNodes.get(i); } else { //ç¬¬ä¸€ä¸ªKeyå°±æ˜¯é¡ºæ—¶é’ˆè¿‡å»ç¦»nodeæœ€è¿‘çš„é‚£ä¸ªç»“ç‚¹ Integer i = subMap.firstKey(); //è¿”å›å¯¹åº”çš„æœåŠ¡å™¨ virtualNode = subMap.get(i); } return virtualNode; } public static void main(String[] args) { String[] keys = {"æ–—å¸", "æ–—åœ£", "æ–—å°Š", "æ–—å®—", "æ–—çš‡", "æ–—ç‹", "æ–—çµ", "å¤§æ–—å¸ˆ", "æ–—å¸ˆ", "æ–—è€…"}; for (String key : keys) { String server = getServer(key); String realServer = server.split("&amp;&amp;VN")[0]; System.out.println("[" + key + "]çš„hashå€¼ä¸º" + HashUtils.getHash(key) + ", è¢«è·¯ç”±åˆ°è™šæ‹Ÿç»“ç‚¹[" + server + "]ï¼Œè¢«è·¯ç”±åˆ°çœŸå®èŠ‚ç‚¹[" + realServer + "]"); } }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>åˆ†å¸ƒå¼</category>
      </categories>
      <tags>
        <tag>åˆ†å¸ƒå¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC-NIOå­¦ä¹ ]]></title>
    <url>%2Fposts%2Fe4966bd.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° NIOæ˜¯Java1.4æ¨å‡ºçš„ä¸€ç§å…¨æ–°çš„IOæ¨¡å‹ï¼Œå…¨ç§°æ˜¯java non-blocking IOï¼Œæä¾›ByteBufferç­‰ç¼“å­˜çš„å®¹å™¨ï¼Œè¾¾åˆ°éé˜»å¡å¼çš„é«˜ä¼¸ç¼©æ€§ç½‘ç»œã€‚ IOæ¨¡å‹ IOæ¨¡å‹æ˜¯æœºå™¨è¿›è¡ŒIOå…·ä½“æ“ä½œæ–¹æ³•çš„ä¸€ç§æŠ½è±¡ï¼Œæ¯ç§IOæ¨¡å‹éƒ½æœ‰å„è‡ªçš„ä¼˜ç¼ºç‚¹ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯è¦å®Œæˆå„æ¨¡å‹çš„å®é™…å¼€å‘éœ€è¦æ“ä½œç³»ç»Ÿçš„æ”¯æŒï¼Œåœ¨æ²¡æœ‰pollã€epollå‡ºæ¥ä¹‹å‰ï¼Œjavaè¿›è¡Œéé˜»å¡å¼çš„è¯»å†™æ“ä½œå¾ˆå¤æ‚ï¼Œè€Œå½“ä¸Šè¿°åŠŸèƒ½å‡ºç°ä¹‹åï¼Œjavaæ‰åœ¨åŸºäºè¯¥åŠŸèƒ½ä¸Šæ·»åŠ äº†nioæ¨¡å—ï¼ŒåŒ…åæ˜¯java.nioï¼Œç°åœ¨åœ¨ç±»Linuxæ˜¯åŸºäºepollå®ç°çš„ï¼Œç±»Unixï¼ˆåŒ…å«Macï¼‰æ˜¯åŸºäºkqueue å®ç°çš„ã€‚ Buffer æ˜¯ä¸€ç§ç¼“å†²æ•°æ®çš„å®¹å™¨ï¼Œå¯ä»¥å­˜å‚¨å„ç§åŸºæœ¬ç±»å‹çš„æ•°æ®ã€‚çº¿ç¨‹ä¸å®‰å…¨ï¼Œæ•°æ®ç»“æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç±»ä¼¼äºä¸€ä¸ªæ•°ç»„ï¼Œå…¶ä¸­capacityä¸ºç¼“å†²æ•°ç»„çš„é•¿åº¦ï¼Œä¸ºå›ºå®šçš„å€¼ï¼› postionè¡¨ç¤ºä¸‹ä¸€ä¸ªéœ€è¦æ“ä½œçš„ä½ç½®ï¼› limitä¸ºä¸‹ä¸€ä¸ªä¸å¯æ“ä½œçš„ä½ç½®ï¼› å„ç§æ•°æ®çš„å¤§å°å…³ç³»æ˜¯0&lt;=position&lt;=limit&lt;=capacity put å†™å…¥æ•°æ®ï¼Œæ¯æ¬¡å†™å…¥æ•°æ®çš„åœ°æ–¹éƒ½æ˜¯postionï¼Œå°±ä¼šä½¿å¾—postionçš„å€¼å˜å¤§ï¼Œå½“ç›´åˆ°å¡«å……çš„æ•°æ®é•¿åº¦è¶…è¿‡äº†æ•°ç»„çš„é•¿åº¦ï¼Œä¼šæŠ›å‡ºBufferOverflowExceptionå¼‚å¸¸ï¼› get è¯»å–æ•°æ® æ¯æ¬¡ä¹Ÿä¼šè¿›è¡Œpostion+1æ“ä½œ,è¿™é‡Œéœ€è¦æ³¨æ„åˆ°æ¯æ¬¡è¯»å–æ•°æ®ä¹‹å‰å¿…é¡»è¿›è¡Œclearæ“ä½œè¦ä¸ç„¶ä¼šå‡ºç°æ•°æ®é”™è¯¯çš„é—®é¢˜ï¼Œå¦‚ä¸‹ä½¿ç”¨ä¾‹å­ï¼š é”™è¯¯ç¤ºä¾‹ æ­£ç¡®ç¤ºä¾‹ clear() æ¸…ç©ºç¼“å†²åŒºçš„æ•°æ®ï¼Œå®é™…ä¸Šæ˜¯å‡æ¸…é™¤ï¼Œåªæ˜¯å°†postionç½®ä½0ï¼Œlimitç½®ä½capacityï¼› æºç å¦‚ä¸‹ï¼š 123456public final Buffer clear() { position = 0; limit = capacity; mark = -1; return this;} allocate(int n) ç”³è¯·ç¼“å†²åŒºï¼Œå¤§å°ç”±å‚æ•°å†³å®š; wrap(byte[] byets) åŒæ ·æ˜¯ç”³è¯·ç¼“å†²åŒºï¼Œä¼ å…¥çš„å‚æ•°å´æ˜¯byte[],ç›¸å½“äºè®¾ç½®çš„ç¼“å†²åŒºå¤§å°æ˜¯byteæ•°ç»„çš„é•¿åº¦ï¼Œç„¶ååˆå§‹åŒ–è®¾ç½®äº†è¯¥ç¼“å†²å®¹å™¨çš„å€¼; flip() åˆ‡æ¢åˆ°è¯»æ¨¡å¼ï¼Œä¿®æ”¹limitä¸ºpostionï¼Œpositionä¸º0; hasRemaining() æŸ¥çœ‹æ˜¯å¦è¿˜æœ‰æ•°æ®å¯è¯» return position &lt; limit; ä¸€èˆ¬çš„ä½¿ç”¨å¥—è·¯éƒ½æ˜¯: 12345678ByteBuffer byteBuffer = ByteBuffer.allocate(10);byteBuffer.clear(); // æ¸…ç©ºbyteBuffer.put("hello".getBytes()); // å†™å…¥æ•°æ®byteBuffer.flip(); // è¯»æ•°æ®ä¹‹å‰çš„å¿…å¤‡æ“ä½œwhile (byteBuffer.hasRemaining()){ // æ•°æ®æ˜¯å¦è¯»å–å®Œæ¯• System.out.print(byteBuffer.get() + "\t" ); // è¯»å–æ•°æ®}System.out.println(); Channel Channelé€šé“ï¼Œå’Œpipelineä¸€ä¸ªæ„æ€ï¼Œç±»ä¼¼äºIOçš„Streamï¼Œåªæ˜¯streamæ˜¯å•å‘ï¼Œè¦ä¹ˆæ˜¯Inputè¦ä¹ˆæ˜¯Outputï¼Œè€ŒChannelæ˜¯åŒå‘çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥é€šè¿‡ä¸€ä¸ªchannelè¿›è¡Œè¯»å†™æ“ä½œäº†ã€‚ä¸è¿‡éœ€è¦æ³¨æ„å¯ä»¥è¯»å†™æ“ä½œå’Œèƒ½ä¸èƒ½è¯»å†™æ“ä½œè¿™æ˜¯ä¸¤å›äº‹ã€‚ Nioçš„channelå…·ä½“å®ç°ä¸»è¦ä¸ºFileChannelã€DatagramChannelã€SocketChannelã€ServerSocketChannelå››ç§ï¼Œåˆ†åˆ«å¯¹åº”çš„æ˜¯æ–‡ä»¶ã€UDPå’ŒTCPçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯ã€‚é‡ç‚¹ä»‹ç»SocketChannleå’ŒServerSocketChannelã€‚ SocketChannel Socketchannel æ˜¯å®¢æˆ·ç«¯ï¼Œè¿æ¥ä¸€ä¸ªåˆ›å»ºå¥½çš„TCPç½‘ç»œå¥—æ¥å­—çš„é€šé“ï¼Œå¯æœ‰ä¸¤ç§åˆ›å»ºæ–¹å¼ æ–°å»ºä¸€ä¸ªsocketchannelï¼Œå¹¶è¿æ¥åˆ°æœåŠ¡å™¨ä¸Š; 123SocketChannel socketChannel = SocketChannel.open();// è¿æ¥åˆ°æœ¬åœ°çš„8081ç«¯å£çš„æœåŠ¡å™¨ä¸ŠsocketChannel.connect(new InetSocketAddress(8081)); æœåŠ¡å™¨æ¥æ”¶åˆ°æ¥è‡ªå®¢æˆ·ç«¯çš„è¯·æ±‚æ¥æ”¶åˆ°çš„ 12345// æœåŠ¡ç«¯æ¥æ”¶åˆ°å®¢æˆ·ç«¯å‘é€çš„ä¿¡æ¯ï¼Œé€šè¿‡accpetå³å¯è·å–å¯¹åº”çš„socketChannelSocketChannel socketChannel = serverSocketChannel.accept();// å…³é—­socketChannelï¼Œç”±äºå…¶ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæœ€å¥½æ˜¯æ”¾åœ¨finallyé‡Œé¢ï¼Œå¹¶ä¸”åšå¥½ç©ºåˆ¤æ–­ä»¥åŠå¼‚å¸¸æ•è·socketChannel.close(); ç”±ä¸Šå›¾æ‰€ç¤ºï¼Œéœ€è¦ä»channelè¯»æ•°æ®ï¼Œä»¥åŠå‘å¤–å‘é€æ•°æ®éƒ½éœ€è¦ä½¿ç”¨bufferä½œä¸ºç¼“å†²å®¹å™¨ 12345678910111213141516171819// è¯»æ•°æ®ByteBuffer byteBuffer = ByteBuffer.allocate(1024);// read æ–¹æ³•ä¼šè¿”å›è¯»å–äº†å¤šå°‘æ•°æ®åˆ°bufferä¸­ï¼Œè¿”å›-1è¡¨ç¤ºæ•°æ®ä»¥åŠè¯»å–å®Œæ¯•ï¼Œå¯ä»¥å…³é—­é€šé“äº†int count = socketChannel.read(byteBuffer);// å†™æ•°æ®String message = "Hello World!";// ç›´æ¥è°ƒç”¨writeæ–¹æ³•å†™å…¥ç›¸å…³çš„bytebufferæ•°ç»„socketChannel.write(message.getBytes());// å†™æ•°æ®æ–¹æ³•2String message = "Hello World!";ByteBuffer byteBuffer = ByteBuffer.allocate(1024);byteBuffer.clear();byetBuffer.put(message.getBytes());byetBuffer.flip();while(byteBuffer.hasRemaing()){ socketChannel.write(byetBuffer);} ç”±äºå…¶ä¸ºå¼‚æ­¥æ¨¡å¼ï¼Œåœ¨å…¶è°ƒç”¨connect()æ–¹æ³•çš„æ—¶å€™æ˜¯ç«‹å³è¿”å›ç»“æœï¼Œè¿æ¥æˆåŠŸè¿”å›trueï¼Œè¿æ¥ä¸æˆåŠŸè¿”å›falseï¼Œå¹¶ç»§ç»­è¿›è¡Œè¿æ¥ï¼ˆæœåŠ¡è‡ªä¸»æ“ä½œï¼‰ï¼Œå­˜åœ¨è¿˜æœªå»ºç«‹è¿æ¥å°±è¿”å›äº†ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨æœåŠ¡ç«¯æ•°æ®çš„æ—¶å€™å†è°ƒç”¨finishConnect()ç¡®ä¿é“¾æ¥çš„å»ºç«‹: 12345678SocketChannel socketChannel = SocketChannel.open();socketChannel.configureBlocking (false); // ä¸€å®šè¦è®¾ç½®è¯¥å†…å®¹socketChannel.connect(new InetSocketAddress(8081)); while(!socketChannel.finishConnect()){ ..... // æ—¥å¿—æ‰“å°ç­‰æ“ä½œï¼Œç›´åˆ°è¿æ¥æˆåŠŸ}// è¿™æ˜¯é˜»å¡æ¨¡å¼çš„// è¿æ¥æˆåŠŸï¼Œå¯ä»¥è¿›è¡Œè¯»å†™æ“ä½œäº† å¯ä»¥é€šè¿‡æ–¹æ³•isConnectionPending()çš„è¿”å›å€¼ç¡®è®¤æ˜¯å¦å¤„äºè¿æ¥ä¸­ã€‚ ServerSocketChannel ServerSocketChannel æ˜¯åº”ç”¨åœ¨æœåŠ¡ç«¯çš„ï¼Œå’ŒSocketchannelç›¸å¯¹åº”ï¼Œä¸»è¦æ˜¯ç”¨æ¥ç›‘å¬æ–°æ¥çš„TCPè¯·æ±‚çš„ä¸€ä¸ªé€šé“ã€‚ç»‘å®šçš„æœ¬åœ°ç«¯å£ï¼ŒIPæ˜¯æœ¬æœºIPã€‚åˆ›å»ºæ–¹å¼å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142ServerSocketChannel serverSocketChannel = ServerSocketChannel.open();serverSocketChannel.socket().bind(new InetSocketAddress(8081));// é€šè¿‡å¯¹è¯¥channelæŒæœ‰çš„socketè¿›è¡Œç»‘å®šç«¯å£æ“ä½œ// ä¹‹å‰å¾ˆå¥‡æ€ªä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ªç›´æ¥è°ƒç”¨socket().bindä¸ä¼šæœ‰ç©ºæŒ‡é’ˆä¹ˆï¼Ÿè‚¯å®šä¸ä¼šæœ‰è¿™ä¸ªé”™è¯¯çš„// åœ¨è°ƒç”¨socket()ï¼Œå¦‚æœå‘ç°å…¶å†…ç½®çš„socketä¸ºnullï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªsocketçš„é€‚é…å‚æ•°æ›¿æ¢nullclass ServerSocketChannelImpl extends ServerSocketChannel implements SelChImpl { private static NativeDispatcher nd; private final FileDescriptor fd; private int fdVal; private volatile long thread = 0L; private final Object lock = new Object(); private final Object stateLock = new Object(); private static final int ST_UNINITIALIZED = -1; private static final int ST_INUSE = 0; private static final int ST_KILLED = 1; private int state = -1; private InetSocketAddress localAddress; private boolean isReuseAddress; ServerSocket socket; // è¿™ä¸ªå°±æ˜¯è°ƒç”¨socketå–å¾—çš„æ•°æ® public ServerSocket socket() { Object var1 = this.stateLock; synchronized (this.stateLock) { if (this.socket == null) { this.socket = ServerSocketAdaptor.create(this); } return this.socket; } }}public class ServerSocketAdaptor extends ServerSocket { private final ServerSocketChannelImpl ssc; private volatile int timeout = 0; public static ServerSocket create(ServerSocketChannelImpl var0) { try { return new ServerSocketAdaptor(var0); } catch (IOException var2) { throw new Error(var2); } }} Selector selector æ˜¯nioä¸­èƒ½å¤Ÿç®¡ç†å¤šä¸ªchannelé€šé“å¹¶æ„ŸçŸ¥å„ä¸ªé€šé“çš„è¯»å†™çŠ¶æ€çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥ä½¿ç”¨å•çº¿ç¨‹ç®¡ç†å¤šä¸ªchannelçš„ä»è€ŒåŒæ—¶å¤„ç†å¤šä¸ªç½‘ç»œè¯·æ±‚ã€‚selectorå’Œchannelæ˜¯é€šè¿‡selectorkeyç»‘å®šçš„ 12345678// åˆ›å»ºä¸€ä¸ªselectorSelector selector = Selector.open();// åˆ›å»ºserversocketChannelå¹¶ç»‘å®šç«¯å£ServerSocketChannel serverSocketChannel ..... // è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ServerSocketChannel.configureBlocking(false); // registerç»‘å®šselectorå’Œchannelåˆ°ä¸€ä¸ªå¯¹è±¡SelectionKeyä¸­SelectionKey key = channel.register(selector,Selectionkey.OP_READ); æ³¨æ„register()æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¿™æ˜¯ä¸€ä¸ªâ€œinteresté›†åˆâ€ï¼Œæ„æ€æ˜¯åœ¨é€šè¿‡Selectorç›‘å¬Channelæ—¶å¯¹ä»€ä¹ˆäº‹ä»¶æ„Ÿå…´è¶£ã€‚å¯ä»¥ç›‘å¬å››ç§ä¸åŒç±»å‹çš„äº‹ä»¶ï¼š Selectionkey.Connect å¯ä»¥è¿æ¥ ï¼ˆå®¢æˆ·ç«¯æ¥æ”¶åˆ°å¯è¿æ¥åˆ°è¯·æ±‚ï¼‰; Selectionkey.Accept å¯ä»¥æ¥å— ï¼ˆæœåŠ¡ç«¯æ¥åˆ°å®¢æˆ·ç«¯è¿æ¥çš„è¯·æ±‚ï¼‰; Selectionkey.Read å¯ä»¥è¯»å–æ•°æ®; Selectionkey.Write å¯ä»¥å†™å…¥æ•°æ®; SelectionKey ç»‘å®šchannelå’Œselectorçš„å¯¹è±¡ï¼Œè¿˜åŒ…å«æœ‰readé›†åˆå’Œinteresté›†åˆ(æ„Ÿå…´è¶£ï¼Œåœ¨registerè®¾ç½®çš„å€¼),è¿˜å¯ä»¥é€šè¿‡attachment()æ–¹æ³•ç»‘å®šä¸€äº›å…¶ä»–æ•°æ®ã€‚é…å¥—çš„è¿˜æœ‰åˆ¤æ–­å…¶çŠ¶æ€çš„æ–¹æ³• 123456public class SelectionKeyImpl extends AbstractSelectionKey { final SelChImpl channel; public final SelectorImpl selector; private int index; private volatile int interestOps; private int readyOps; é€‰æ‹©é€šé“ selectorä»å·²ç»æ³¨å†Œå¥½çš„channelä¸­è·å–å·²ç»å‡†å¤‡å°±ç»ªçš„é€šé“è¿›è¡Œæ“ä½œï¼Œä»¥ä¸‹ä¸‰ç§æ˜¯è·å–é€šé“çš„æ–¹æ³•: int select() // é˜»å¡æ¨¡å¼ï¼Œè‡³å°‘æœ‰ä¸€ä¸ªå‡†å¤‡å°±ç»ªçš„é€šé“æ‰è¿”å› int select(long timeout) // åŠ å…¥è¶…æ—¶è®¾ç½® int selectNow() // ä¼šç«‹å³è¿”å›ï¼Œè¿”å›å½“å‰å°±ç»ªçš„é€šé“ä¸ªæ•° selectedKeys()è·å–å½“å‰å°±ç»ªçš„é€šé“é›†åˆ close() å…³é—­å½“å‰çš„selectorï¼Œä½¿å¾—ç»‘å®šçš„keyå…¨éƒ¨ä¸å¯ç”¨ï¼Œä½†æ˜¯é€šé“æœ¬èº«è¿˜æ˜¯å¯ä»¥æ­£å¸¸ä½¿ç”¨çš„ 12345678910111213141516171819int count = selector.select();Iterator it = selector.selectedKeys().iterator();while (it.hasNext()){ SelectionKey selectionKey = (SelectionKey)it.next(); it.remove(); // å¤„ç†å®Œæˆä¸€ä¸ªkeyå°±ç§»é™¤æ‰ï¼Œæ— éœ€å†æ¬¡å¤„ç† if(selectionKey.isAcceptable()){ ServerSocketChannel serverSocketChannel = (ServerSocketChannel) selectionKey.channel(); SocketChannel socketChannel = serverSocketChannel.accept(); socketChannel.configureBlocking(false); socketChannel.register(selector, SelectionKey.OP_READ); } if(selectionKey.isReadable()){ SocketChannel socketChannel = (SocketChannel) selectionKey.channel(); createProcessor(socketChannel); socketChannel.register(selector, SelectionKey.OP_WRITE); selectionKey.cancel(); // å½“å‰keyå–æ¶ˆæ‰äº†ï¼Œä½†æ˜¯é€šé“ä¾æ—§å¯ç”¨ }} DatagramChannel æ”¶å‘UTPåŒ…çš„é€šé“ï¼Œé€‚ç”¨äºUTPåè®®ï¼Œå‘é€å’Œè¯»å–çš„æ˜¯ç”¨æˆ·æ•°æ®æŠ¥ 123456DatagramChannel channel = DatagramChannel.open();channel.socket().bind(new InetSocketAddress(10002));// å»ºç«‹äº†ä¸€ä¸ªæœ¬åœ°10002ç«¯å£çš„UTPæœåŠ¡ç«¯channel.connect(new InetSocketAddress(10002));// è¿æ¥ä¸€ä¸ªIPé»˜è®¤ä¸ºæœ¬æœºï¼Œç«¯å£ä¸º10002æœåŠ¡// è¯»å†™å’Œä¼ ç»Ÿçš„readã€writeç±»ä¼¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>RPC</category>
        <category>NIO</category>
      </categories>
      <tags>
        <tag>NIO</tag>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[RedisçŸ¥è¯†ç‚¹å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fb1cc4593.html</url>
    <content type="text"><![CDATA[redis ç®€ä»‹ Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªKey-Valueç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼Œæ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚ å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¯ç”¨äºç¼“å­˜ã€äº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ã€é«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚ è¯¥æ•°æ®åº“ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é˜Ÿåˆ—ã€é›†åˆç»“æ„ç›´æ¥å­˜å–ï¼ŒåŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚ redisçš„åº”ç”¨åœºæ™¯æœ‰å“ªäº› 1ã€ä¼šè¯ç¼“å­˜ï¼ˆæœ€å¸¸ç”¨ï¼‰2ã€æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¯”å¦‚æ”¯ä»˜3ã€æ´»åŠ¨æ’è¡Œæ¦œæˆ–è®¡æ•°4ã€å‘å¸ƒã€è®¢é˜…æ¶ˆæ¯ï¼ˆæ¶ˆæ¯é€šçŸ¥ï¼‰5ã€å•†å“åˆ—è¡¨ã€è¯„è®ºåˆ—è¡¨ç­‰ ä¸ºä»€ä¹ˆè¦ç”¨ redis è€Œä¸ç”¨ map/guava åšç¼“å­˜ ç¼“å­˜åˆ†ä¸ºæœ¬åœ°ç¼“å­˜å’Œåˆ†å¸ƒå¼ç¼“å­˜ã€‚ ä»¥javaä¸ºä¾‹ï¼Œä½¿ç”¨è‡ªå¸¦çš„mapæˆ–è€…guavaå®ç°çš„æ˜¯æœ¬åœ°ç¼“å­˜ï¼Œæœ€ä¸»è¦çš„ç‰¹ç‚¹æ˜¯è½»é‡ä»¥åŠå¿«é€Ÿï¼Œç”Ÿå‘½å‘¨æœŸéšç€ jvm çš„é”€æ¯è€Œç»“æŸï¼Œå¹¶ä¸”åœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå®ä¾‹éƒ½éœ€è¦å„è‡ªä¿å­˜ä¸€ä»½ç¼“å­˜ï¼Œç¼“å­˜ä¸å…·æœ‰ä¸€è‡´æ€§ã€‚ ä½¿ç”¨ redis æˆ– memcached ä¹‹ç±»çš„ç§°ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼Œåœ¨å¤šå®ä¾‹çš„æƒ…å†µä¸‹ï¼Œå„å®ä¾‹å…±ç”¨ä¸€ä»½ç¼“å­˜æ•°æ®ï¼Œç¼“å­˜å…·æœ‰ä¸€è‡´æ€§ã€‚ç¼ºç‚¹æ˜¯éœ€è¦ä¿æŒ redis æˆ– memcachedæœåŠ¡çš„é«˜å¯ç”¨ï¼Œæ•´ä¸ªç¨‹åºæ¶æ„ä¸Šè¾ƒä¸ºå¤æ‚ã€‚ redis å’Œ memcached çš„åŒºåˆ« redisæ”¯æŒæ›´ä¸°å¯Œçš„æ•°æ®ç±»å‹ï¼ˆæ”¯æŒæ›´å¤æ‚çš„åº”ç”¨åœºæ™¯ï¼‰ï¼šRedisä¸ä»…ä»…æ”¯æŒç®€å•çš„k/vç±»å‹çš„æ•°æ®ï¼ŒåŒæ—¶è¿˜æä¾›listï¼Œsetï¼Œzsetï¼Œhashç­‰æ•°æ®ç»“æ„çš„å­˜å‚¨ã€‚memcachedæ”¯æŒç®€å•çš„æ•°æ®ç±»å‹ï¼ŒStringã€‚Redisæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–ï¼Œå¯ä»¥å°†å†…å­˜ä¸­çš„æ•°æ®ä¿æŒåœ¨ç£ç›˜ä¸­ï¼Œé‡å¯çš„æ—¶å€™å¯ä»¥å†æ¬¡åŠ è½½è¿›è¡Œä½¿ç”¨,è€ŒMemecachedæŠŠæ•°æ®å…¨éƒ¨å­˜åœ¨å†…å­˜ä¹‹ä¸­ã€‚é›†ç¾¤æ¨¡å¼ï¼šmemcachedæ²¡æœ‰åŸç”Ÿçš„é›†ç¾¤æ¨¡å¼ï¼Œéœ€è¦ä¾é å®¢æˆ·ç«¯æ¥å®ç°å¾€é›†ç¾¤ä¸­åˆ†ç‰‡å†™å…¥æ•°æ®ï¼›ä½†æ˜¯redisç›®å‰æ˜¯åŸç”Ÿæ”¯æŒclusteræ¨¡å¼çš„ï¼Œrediså®˜æ–¹å°±æ˜¯æ”¯æŒredis clusteré›†ç¾¤æ¨¡å¼çš„ï¼Œæ¯”memcachedæ¥è¯´è¦æ›´å¥½ã€‚Memcachedæ˜¯å¤šçº¿ç¨‹ï¼Œéé˜»å¡IOå¤ç”¨çš„ç½‘ç»œæ¨¡å‹ï¼›Redisä½¿ç”¨å•çº¿ç¨‹çš„(é¿å…äº†é¢‘ç¹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢)å¤šè·¯ IO å¤ç”¨æ¨¡å‹ã€‚ redis åˆ é™¤è¿‡æœŸæ•°æ® å®šæœŸåˆ é™¤ï¼šredisé»˜è®¤æ˜¯æ¯éš” 100ms å°±éšæœºæŠ½å–ä¸€äº›è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyï¼Œæ£€æŸ¥å…¶æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸå°±åˆ é™¤ã€‚æ³¨æ„è¿™é‡Œæ˜¯éšæœºæŠ½å–çš„ã€‚ä¸ºä»€ä¹ˆè¦éšæœºå‘¢ï¼Ÿä½ æƒ³ä¸€æƒ³å‡å¦‚ redis å­˜äº†å‡ åä¸‡ä¸ª key ï¼Œæ¯éš”100mså°±éå†æ‰€æœ‰çš„è®¾ç½®è¿‡æœŸæ—¶é—´çš„ key çš„è¯ï¼Œå°±ä¼šç»™ CPU å¸¦æ¥å¾ˆå¤§çš„è´Ÿè½½ï¼ æƒ°æ€§åˆ é™¤ï¼šå®šæœŸåˆ é™¤å¯èƒ½ä¼šå¯¼è‡´å¾ˆå¤šè¿‡æœŸ key åˆ°äº†æ—¶é—´å¹¶æ²¡æœ‰è¢«åˆ é™¤æ‰ã€‚æ‰€ä»¥å°±æœ‰äº†æƒ°æ€§åˆ é™¤ã€‚å‡å¦‚ä½ çš„è¿‡æœŸ keyï¼Œé å®šæœŸåˆ é™¤æ²¡æœ‰è¢«åˆ é™¤æ‰ï¼Œè¿˜åœç•™åœ¨å†…å­˜é‡Œï¼Œé™¤éä½ çš„ç³»ç»Ÿå»æŸ¥ä¸€ä¸‹é‚£ä¸ª keyï¼Œæ‰ä¼šè¢«redisç»™åˆ é™¤æ‰ã€‚è¿™å°±æ˜¯æ‰€è°“çš„æƒ°æ€§åˆ é™¤ï¼Œä¹Ÿæ˜¯å¤Ÿæ‡’çš„å“ˆï¼ redis å†…å­˜æ·˜æ±°æœºåˆ¶ Redis æä¾› 6 ç§æ•°æ®æ·˜æ±°ç­–ç•¥ï¼š volatile-lruï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„æ•°æ®æ·˜æ±°ã€‚volatile-ttlï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­æŒ‘é€‰å°†è¦è¿‡æœŸçš„æ•°æ®æ·˜æ±°ã€‚volatile-randomï¼šä»å·²è®¾ç½®è¿‡æœŸæ—¶é—´çš„æ•°æ®é›†(server.db[i].expires)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚allkeys-lruï¼šå½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œåœ¨é”®ç©ºé—´ä¸­ï¼Œç§»é™¤æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„key(è¿™ä¸ªæ˜¯æœ€å¸¸ç”¨çš„)ã€‚allkeys-randomï¼šä»æ•°æ®é›†(server.db[i].dict)ä¸­ä»»æ„é€‰æ‹©æ•°æ®æ·˜æ±°ã€‚no-envictionï¼šç¦æ­¢é©±é€æ•°æ®ï¼Œä¹Ÿå°±æ˜¯è¯´å½“å†…å­˜ä¸è¶³ä»¥å®¹çº³æ–°å†™å…¥æ•°æ®æ—¶ï¼Œæ–°å†™å…¥æ“ä½œä¼šæŠ¥é”™ã€‚è¿™ä¸ªåº”è¯¥æ²¡äººä½¿ç”¨å§! redisæ·˜æ±°æ•°æ®æ—¶è¿˜ä¼šåŒæ­¥åˆ°aofã€‚ redis æŒä¹…åŒ–æœºåˆ¶ Redis çš„ä¸€ç§æŒä¹…åŒ–æ–¹å¼å«å¿«ç…§(snapshottingï¼ŒRDB)ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯åªè¿½åŠ æ–‡ä»¶(append-only fileï¼ŒAOF)ã€‚ å¿«ç…§(snapshotting)æŒä¹…åŒ–(RDB) Redis å¯ä»¥é€šè¿‡åˆ›å»ºå¿«ç…§æ¥è·å¾—å­˜å‚¨åœ¨å†…å­˜é‡Œé¢çš„æ•°æ®åœ¨æŸä¸ªæ—¶é—´ç‚¹ä¸Šçš„å‰¯æœ¬ã€‚ Redis åˆ›å»ºå¿«ç…§ä¹‹åï¼Œå¯ä»¥å¯¹å¿«ç…§è¿›è¡Œå¤‡ä»½ï¼Œå¯ä»¥å°†å¿«ç…§å¤åˆ¶åˆ°å…¶ä»–æœåŠ¡å™¨ä»è€Œåˆ›å»ºå…·æœ‰ç›¸åŒæ•°æ®çš„æœåŠ¡å™¨å‰¯æœ¬(Redis ä¸»ä»ç»“æ„ï¼Œä¸»è¦ç”¨æ¥æé«˜ Redis æ€§èƒ½)ï¼Œè¿˜å¯ä»¥å°†å¿«ç…§ç•™åœ¨åŸåœ°ä»¥ä¾¿é‡å¯æœåŠ¡å™¨çš„æ—¶å€™ä½¿ç”¨ã€‚ Redisä¼šå•ç‹¬åˆ›å»ºfork()ä¸€ä¸ªå­è¿›ç¨‹ï¼Œå°†å½“å‰çˆ¶è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶åˆ°å­è¿›ç¨‹çš„å†…å­˜ä¸­ï¼Œç„¶åç”±å­è¿›ç¨‹å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ä¸­ï¼ŒæŒä¹…åŒ–çš„è¿‡ç¨‹ç»“æŸäº†ï¼Œå†ç”¨è¿™ä¸ªä¸´æ—¶æ–‡ä»¶æ›¿æ¢ä¸Šæ¬¡çš„å¿«ç…§æ–‡ä»¶ï¼Œç„¶åå­è¿›ç¨‹é€€å‡ºï¼Œå†…å­˜é‡Šæ”¾ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæ¯æ¬¡å¿«ç…§æŒä¹…åŒ–éƒ½ä¼šå°†ä¸»è¿›ç¨‹çš„æ•°æ®åº“æ•°æ®å¤åˆ¶ä¸€éï¼Œå¯¼è‡´å†…å­˜å¼€é”€åŠ å€ï¼Œè‹¥æ­¤æ—¶å†…å­˜ä¸è¶³ï¼Œåˆ™ä¼šé˜»å¡æœåŠ¡å™¨è¿è¡Œï¼Œç›´åˆ°å¤åˆ¶ç»“æŸé‡Šæ”¾å†…å­˜ï¼›éƒ½ä¼šå°†å†…å­˜æ•°æ®å®Œæ•´å†™å…¥ç£ç›˜ä¸€æ¬¡ï¼Œæ‰€ä»¥å¦‚æœæ•°æ®é‡å¤§çš„è¯ï¼Œè€Œä¸”å†™æ“ä½œé¢‘ç¹ï¼Œå¿…ç„¶ä¼šå¼•èµ·å¤§é‡çš„ç£ç›˜I/Oæ“ä½œï¼Œä¸¥é‡å½±å“æ€§èƒ½ï¼Œå¹¶ä¸”æœ€åä¸€æ¬¡æŒä¹…åŒ–åçš„æ•°æ®å¯èƒ½ä¼šä¸¢å¤±ï¼› å¿«ç…§æŒä¹…åŒ–æ˜¯ Redis é»˜è®¤é‡‡ç”¨çš„æŒä¹…åŒ–æ–¹å¼ï¼Œåœ¨ redis.conf é…ç½®æ–‡ä»¶ä¸­é»˜è®¤æœ‰æ­¤ä¸‹é…ç½®ï¼š 12345save 900 1 #åœ¨900ç§’(15åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰1ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 300 10 #åœ¨300ç§’(5åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ save 60 10000 #åœ¨60ç§’(1åˆ†é’Ÿ)ä¹‹åï¼Œå¦‚æœè‡³å°‘æœ‰10000ä¸ªkeyå‘ç”Ÿå˜åŒ–ï¼ŒRediså°±ä¼šè‡ªåŠ¨è§¦å‘BGSAVEå‘½ä»¤åˆ›å»ºå¿«ç…§ã€‚ ä¼˜ç‚¹ï¼š åªæœ‰ä¸€ä¸ªæ–‡ä»¶dump.rdbï¼Œæ–¹ä¾¿æŒä¹…åŒ–ã€‚å®¹ç¾æ€§å¥½ï¼Œä¸€ä¸ªæ–‡ä»¶å¯ä»¥ä¿å­˜åˆ°å®‰å…¨çš„ç£ç›˜ã€‚æ€§èƒ½æœ€å¤§åŒ–ï¼Œforkå­è¿›ç¨‹æ¥å®Œæˆå†™æ“ä½œï¼Œè®©ä¸»è¿›ç¨‹ç»§ç»­å¤„ç†å‘½ä»¤ï¼Œæ‰€ä»¥æ˜¯IOæœ€å¤§åŒ–ã€‚ç›¸å¯¹äºæ•°æ®é›†å¤§æ—¶ï¼Œæ¯”AOFçš„å¯åŠ¨æ•ˆç‡æ›´é«˜ã€‚ ç¼ºç‚¹ï¼š æ•°æ®å®‰å…¨æ€§ä½ï¼Œé€šè¿‡é…ç½®saveå‚æ•°æ¥è¾¾åˆ°å®šæ—¶çš„å†™å¿«ç…§ï¼Œæ¯”å¦‚ æ¯900 ç§’æœ‰1ä¸ªé”®è¢«ä¿®æ”¹å°±è¿›è¡Œä¸€æ¬¡å¿«ç…§ï¼Œæ¯300ç§’è‡³å°‘æœ‰10ä¸ªé”®è¢«ä¿®æ”¹è¿›è¡Œå¿«ç…§ï¼Œæ¯60ç§’æœ‰è‡³å°‘10000ä¸ªé”®è¢«ä¿®æ”¹è¿›è¡Œè®°å½•ã€‚æ‰€ä»¥å¦‚æœå½“æœåŠ¡å™¨è¿˜åœ¨ç­‰å¾…å†™å¿«ç…§æ—¶å‡ºç°äº†å®•æœºï¼Œé‚£ä¹ˆå°†ä¼šä¸¢å¤±æ•°æ®ã€‚forkå­è¿›ç¨‹æ—¶å¯èƒ½å¯¼è‡´æœåŠ¡å™¨åœæœº1ç§’ï¼Œæ•°æ®é›†å¤ªå¤§ã€‚ AOF(append-only file)æŒä¹…åŒ– ä¸å¿«ç…§æŒä¹…åŒ–ç›¸æ¯”ï¼ŒAOF æŒä¹…åŒ–çš„å®æ—¶æ€§æ›´å¥½ï¼Œå› æ­¤å·²æˆä¸ºä¸»æµçš„æŒä¹…åŒ–æ–¹æ¡ˆã€‚ ä»¥æ—¥å¿—çš„å½¢å¼è®°å½•æ¯ä¸ªå†™æ“ä½œï¼ˆè¯»æ“ä½œä¸è®°å½•ï¼‰ï¼Œåªéœ€è¿½åŠ æ–‡ä»¶ä½†ä¸å¯ä»¥æ”¹å†™æ–‡ä»¶ï¼Œrediså¯åŠ¨æ—¶ä¼šæ ¹æ®æ—¥å¿—ä»å¤´åˆ°å°¾å…¨éƒ¨æ‰§è¡Œä¸€éä»¥å®Œæˆæ•°æ®çš„æ¢å¤å·¥ä½œã€‚åŒ…æ‹¬flushDBä¹Ÿä¼šæ‰§è¡Œã€‚ é»˜è®¤æƒ…å†µä¸‹ Redis æ²¡æœ‰å¼€å¯ AOF(append only file)æ–¹å¼çš„æŒä¹…åŒ–ï¼Œå¯ä»¥é€šè¿‡ appendonly å‚æ•°å¼€å¯ï¼š 1appendonly yes å¼€å¯ AOF æŒä¹…åŒ–åæ¯æ‰§è¡Œä¸€æ¡ä¼šæ›´æ”¹ Redis ä¸­çš„æ•°æ®çš„å‘½ä»¤ï¼ŒRedis å°±ä¼šå°†è¯¥å‘½ä»¤å†™å…¥ç¡¬ç›˜ä¸­çš„ AOF æ–‡ä»¶ã€‚ AOF æ–‡ä»¶çš„ä¿å­˜ä½ç½®å’Œ RDB æ–‡ä»¶çš„ä½ç½®ç›¸åŒï¼Œéƒ½æ˜¯é€šè¿‡ dir å‚æ•°è®¾ç½®çš„ï¼Œé»˜è®¤çš„æ–‡ä»¶åæ˜¯ appendonly.aofã€‚ åœ¨ Redis çš„é…ç½®æ–‡ä»¶ä¸­å­˜åœ¨ä¸‰ç§ä¸åŒçš„ AOF æŒä¹…åŒ–æ–¹å¼ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯ï¼š 123appendfsync always #æ¯æ¬¡æœ‰æ•°æ®ä¿®æ”¹å‘ç”Ÿæ—¶éƒ½ä¼šå†™å…¥AOFæ–‡ä»¶,è¿™æ ·ä¼šä¸¥é‡é™ä½Redisçš„é€Ÿåº¦ appendfsync everysec #æ¯ç§’é’ŸåŒæ­¥ä¸€æ¬¡ï¼Œæ˜¾ç¤ºåœ°å°†å¤šä¸ªå†™å‘½ä»¤åŒæ­¥åˆ°ç¡¬ç›˜ appendfsync no #è®©æ“ä½œç³»ç»Ÿå†³å®šä½•æ—¶è¿›è¡ŒåŒæ­¥ ä¸ºäº†å…¼é¡¾æ•°æ®å’Œå†™å…¥æ€§èƒ½ï¼Œç”¨æˆ·å¯ä»¥è€ƒè™‘ appendfsync everysec é€‰é¡¹ ï¼Œè®© Redis æ¯ç§’åŒæ­¥ä¸€æ¬¡ AOF æ–‡ä»¶ï¼ŒRedis æ€§èƒ½å‡ ä¹æ²¡å—åˆ°ä»»ä½•å½±å“ã€‚ è€Œä¸”è¿™æ ·å³ä½¿å‡ºç°ç³»ç»Ÿå´©æºƒï¼Œç”¨æˆ·æœ€å¤šåªä¼šä¸¢å¤±ä¸€ç§’ä¹‹å†…äº§ç”Ÿçš„æ•°æ®ã€‚å½“ç¡¬ç›˜å¿™äºæ‰§è¡Œå†™å…¥æ“ä½œçš„æ—¶å€™ï¼ŒRedis è¿˜ä¼šä¼˜é›…çš„æ”¾æ…¢è‡ªå·±çš„é€Ÿåº¦ä»¥ä¾¿é€‚åº”ç¡¬ç›˜çš„æœ€å¤§å†™å…¥é€Ÿåº¦ã€‚ ä¼˜ç‚¹ï¼š æ•°æ®å®‰å…¨ï¼ŒaofæŒä¹…åŒ–å¯ä»¥é…ç½®appendfsyncå±æ€§ï¼Œæœ‰alwaysï¼Œæ¯è¿›è¡Œä¸€æ¬¡å‘½ä»¤æ“ä½œå°±è®°å½•åˆ°aofæ–‡ä»¶ä¸­ä¸€æ¬¡ï¼›everySecï¼Œå°±æ˜¯æ¯ç§’å†…è¿›è¡Œä¸€æ¬¡æ–‡ä»¶çš„å†™æ“ä½œï¼›noå°±æ˜¯ä¸è¿›è¡Œaofæ–‡ä»¶çš„å†™æ“ä½œã€‚é€šè¿‡appendæ¨¡å¼å†™æ–‡ä»¶ï¼Œå³ä½¿ä¸­é€”æœåŠ¡å™¨å®•æœºï¼Œå¯ä»¥é€šè¿‡redis-check-aofå·¥å…·è§£å†³æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚AOFæœºåˆ¶çš„rewriteæ¨¡å¼ï¼Œç”¨æ¥å°†è¿‡å¤§çš„aofæ–‡ä»¶ç¼©å°ï¼Œå®ç°åŸç†æ˜¯å°†æ‰€æœ‰çš„set é€šè¿‡ä¸€å¥set å‘½ä»¤æ€»ç»“ï¼Œæ‰€æœ‰çš„SADDå‘½ä»¤ç”¨æ€»ç»“ä¸ºä¸€å¥ï¼Œè¿™æ ·æ¯ç§å‘½ä»¤éƒ½æ¦‚æ‹¬ä¸ºä¸€å¥æ¥æ‰§è¡Œï¼Œå°±å¯ä»¥å‡å°‘aofæ–‡ä»¶çš„å¤§å°äº†ã€‚ï¼ˆæ³¨æ„ï¼Œåœ¨é‡å†™çš„è¿‡ç¨‹ä¸­ï¼Œæ˜¯åˆ›å»ºå­è¿›ç¨‹æ¥å®Œæˆé‡å†™æ“ä½œï¼Œä¸»è¿›ç¨‹æ¯ä¸ªå‘½ä»¤éƒ½ä¼šåœ¨AOFç¼“å†²åŒºå’ŒAOFé‡å†™ç¼“å†²åŒºè¿›è¡Œä¿å­˜ï¼Œè¿™æ ·æ—§ç‰ˆaofæ–‡ä»¶å¯ä»¥å®ç°æ•°æ®æœ€æ–°ï¼Œå½“æ›´æ–°å®Œåå°†é‡å†™ç¼“å†²åŒºä¸­çš„æ•°æ®å†™å…¥æ–°çš„aofæ–‡ä»¶ä¸­ç„¶åå°±å¯ä»¥å°†æ–°çš„æ–‡ä»¶æ›¿æ¢æ‰æ—§ç‰ˆçš„æ–‡ä»¶ã€‚é»˜è®¤è§¦å‘æ˜¯å½“aofæ–‡ä»¶å¤§å°æ˜¯ä¸Šæ¬¡é‡å†™åå¤§å°çš„ä¸€å€ä¸”æ–‡ä»¶å¤§äº64Mæ—¶è§¦å‘ã€‚) ç¼ºç‚¹ï¼š æ–‡ä»¶ä¼šæ¯”RDBå½¢å¼çš„æ–‡ä»¶å¤§ã€‚æ•°æ®é›†å¤§çš„æ—¶å€™ï¼Œæ¯”rdbå¯åŠ¨æ•ˆç‡ä½ã€‚ æ€»ç»“ å½“ä¸¤ç§æ–¹å¼åŒæ—¶å¼€å¯æ—¶ï¼Œæ•°æ®æ¢å¤redisä¼šä¼˜å…ˆé€‰æ‹©AOFæ¢å¤ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåªè¦ä½¿ç”¨é»˜è®¤å¼€å¯çš„RDBå³å¯ï¼Œå› ä¸ºç›¸å¯¹äºAOFï¼ŒRDBä¾¿äºè¿›è¡Œæ•°æ®åº“å¤‡ä»½ï¼Œå¹¶ä¸”æ¢å¤æ•°æ®é›†çš„é€Ÿåº¦ä¹Ÿè¦å¿«å¾ˆå¤šã€‚ å¼€å¯æŒä¹…åŒ–ç¼“å­˜æœºåˆ¶ï¼Œå¯¹æ€§èƒ½ä¼šæœ‰ä¸€å®šçš„å½±å“ï¼Œç‰¹åˆ«æ˜¯å½“è®¾ç½®çš„å†…å­˜æ»¡äº†çš„æ—¶å€™ï¼Œæ›´æ˜¯ä¸‹é™åˆ°å‡ ç™¾reqs/sã€‚æ‰€ä»¥å¦‚æœåªæ˜¯ç”¨æ¥åšç¼“å­˜çš„è¯ï¼Œå¯ä»¥å…³æ‰æŒä¹…åŒ–ã€‚ Redis 4.0 å¯¹äºæŒä¹…åŒ–æœºåˆ¶çš„ä¼˜åŒ– Redis 4.0 å¼€å§‹æ”¯æŒ RDB å’Œ AOF çš„æ··åˆæŒä¹…åŒ–(é»˜è®¤å…³é—­ï¼Œå¯ä»¥é€šè¿‡é…ç½®é¡¹ aof-use-rdb-preamble å¼€å¯)ã€‚ å¦‚æœæŠŠæ··åˆæŒä¹…åŒ–æ‰“å¼€ï¼ŒAOF é‡å†™çš„æ—¶å€™å°±ç›´æ¥æŠŠ RDB çš„å†…å®¹å†™åˆ° AOF æ–‡ä»¶å¼€å¤´ã€‚ è¿™æ ·åšçš„å¥½å¤„æ˜¯å¯ä»¥ç»“åˆ RDB å’Œ AOF çš„ä¼˜ç‚¹, å¿«é€ŸåŠ è½½åŒæ—¶é¿å…ä¸¢å¤±è¿‡å¤šçš„æ•°æ®ã€‚ å½“ç„¶ç¼ºç‚¹ä¹Ÿæ˜¯æœ‰çš„ï¼ŒAOF é‡Œé¢çš„ RDB éƒ¨åˆ†æ˜¯å‹ç¼©æ ¼å¼ä¸å†æ˜¯ AOF æ ¼å¼ï¼Œå¯è¯»æ€§è¾ƒå·®ã€‚ Sentinel ï¼ˆå“¨å…µï¼‰åŸç† å“¨å…µçš„åŠŸèƒ½ ç›‘æ§ï¼ˆMonitoringï¼‰ï¼šå“¨å…µä¼šä¸æ–­åœ°æ£€æŸ¥ä¸»èŠ‚ç‚¹å’Œä»èŠ‚ç‚¹æ˜¯å¦è¿ä½œæ­£å¸¸ã€‚ è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼ˆAutomatic failoverï¼‰ï¼šå½“ä¸»èŠ‚ç‚¹ä¸èƒ½æ­£å¸¸å·¥ä½œæ—¶ï¼Œå“¨å…µä¼šå¼€å§‹è‡ªåŠ¨æ•…éšœè½¬ç§»æ“ä½œï¼Œå®ƒä¼šå°†å¤±æ•ˆä¸»èŠ‚ç‚¹çš„å…¶ä¸­ä¸€ä¸ªä»èŠ‚ç‚¹å‡çº§ä¸ºæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œå¹¶è®©å…¶ä»–ä»èŠ‚ç‚¹æ”¹ä¸ºå¤åˆ¶æ–°çš„ä¸»èŠ‚ç‚¹ã€‚ é…ç½®æä¾›è€…ï¼ˆConfiguration providerï¼‰ï¼šå®¢æˆ·ç«¯åœ¨åˆå§‹åŒ–æ—¶ï¼Œé€šè¿‡è¿æ¥å“¨å…µæ¥è·å¾—å½“å‰ Redis æœåŠ¡çš„ä¸»èŠ‚ç‚¹åœ°å€ã€‚ é€šçŸ¥ï¼ˆNotificationï¼‰ï¼šå“¨å…µå¯ä»¥å°†æ•…éšœè½¬ç§»çš„ç»“æœå‘é€ç»™å®¢æˆ·ç«¯ã€‚ å“¨å…µç³»ç»Ÿä¸­çš„ä¸»ä»èŠ‚ç‚¹ï¼Œä¸æ™®é€šçš„ä¸»ä»èŠ‚ç‚¹å¹¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Œæ•…éšœå‘ç°å’Œè½¬ç§»æ˜¯ç”±å“¨å…µæ¥æ§åˆ¶å’Œå®Œæˆçš„ã€‚ å“¨å…µèŠ‚ç‚¹æœ¬è´¨ä¸Šæ˜¯ Redis èŠ‚ç‚¹ã€‚ æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ï¼Œåªéœ€è¦é…ç½®ç›‘æ§ä¸»èŠ‚ç‚¹ï¼Œä¾¿å¯ä»¥è‡ªåŠ¨å‘ç°å…¶ä»–çš„å“¨å…µèŠ‚ç‚¹å’Œä»èŠ‚ç‚¹ã€‚ åœ¨å“¨å…µèŠ‚ç‚¹å¯åŠ¨å’Œæ•…éšœè½¬ç§»é˜¶æ®µï¼Œå„ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ä¼šè¢«é‡å†™(config rewrite)ã€‚ å“¨å…µçš„åŸç† å®šæ—¶ä»»åŠ¡ æ¯ä¸ªå“¨å…µèŠ‚ç‚¹ç»´æŠ¤äº† 3 ä¸ªå®šæ—¶ä»»åŠ¡ï¼Œå®šæ—¶ä»»åŠ¡çš„åŠŸèƒ½åˆ†åˆ«å¦‚ä¸‹ï¼š é€šè¿‡å‘ä¸»ä»èŠ‚ç‚¹å‘é€ info å‘½ä»¤è·å–æœ€æ–°çš„ä¸»ä»ç»“æ„ã€‚é€šè¿‡å‘å¸ƒè®¢é˜…åŠŸèƒ½è·å–å…¶ä»–å“¨å…µèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚é€šè¿‡å‘å…¶ä»–èŠ‚ç‚¹å‘é€ ping å‘½ä»¤è¿›è¡Œå¿ƒè·³æ£€æµ‹ï¼Œåˆ¤æ–­æ˜¯å¦ä¸‹çº¿ã€‚ ä¸»è§‚ä¸‹çº¿ åœ¨å¿ƒè·³æ£€æµ‹çš„å®šæ—¶ä»»åŠ¡ä¸­ï¼Œå¦‚æœå…¶ä»–èŠ‚ç‚¹è¶…è¿‡ä¸€å®šæ—¶é—´æ²¡æœ‰å›å¤ï¼Œå“¨å…µèŠ‚ç‚¹å°±ä¼šå°†å…¶è¿›è¡Œä¸»è§‚ä¸‹çº¿ã€‚ é¡¾åæ€ä¹‰ï¼Œä¸»è§‚ä¸‹çº¿çš„æ„æ€æ˜¯ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹â€œä¸»è§‚åœ°â€åˆ¤æ–­ä¸‹çº¿ï¼›ä¸ä¸»è§‚ä¸‹çº¿ç›¸å¯¹åº”çš„æ˜¯å®¢è§‚ä¸‹çº¿ã€‚ å®¢è§‚ä¸‹çº¿ å“¨å…µèŠ‚ç‚¹åœ¨å¯¹ä¸»èŠ‚ç‚¹è¿›è¡Œä¸»è§‚ä¸‹çº¿åï¼Œä¼šé€šè¿‡ sentinelis-master-down-by-addr å‘½ä»¤è¯¢é—®å…¶ä»–å“¨å…µèŠ‚ç‚¹è¯¥ä¸»èŠ‚ç‚¹çš„çŠ¶æ€ã€‚ å¦‚æœåˆ¤æ–­ä¸»èŠ‚ç‚¹ä¸‹çº¿çš„å“¨å…µæ•°é‡è¾¾åˆ°ä¸€å®šæ•°å€¼ï¼Œåˆ™å¯¹è¯¥ä¸»èŠ‚ç‚¹è¿›è¡Œå®¢è§‚ä¸‹çº¿ã€‚ éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯ï¼Œå®¢è§‚ä¸‹çº¿æ˜¯ä¸»èŠ‚ç‚¹æ‰æœ‰çš„æ¦‚å¿µï¼›å¦‚æœä»èŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼Œè¢«å“¨å…µä¸»è§‚ä¸‹çº¿åï¼Œä¸ä¼šå†æœ‰åç»­çš„å®¢è§‚ä¸‹çº¿å’Œæ•…éšœè½¬ç§»æ“ä½œã€‚ é€‰ä¸¾é¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ å½“ä¸»èŠ‚ç‚¹è¢«åˆ¤æ–­å®¢è§‚ä¸‹çº¿ä»¥åï¼Œå„ä¸ªå“¨å…µèŠ‚ç‚¹ä¼šè¿›è¡Œåå•†ï¼Œé€‰ä¸¾å‡ºä¸€ä¸ªé¢†å¯¼è€…å“¨å…µèŠ‚ç‚¹ï¼Œå¹¶ç”±è¯¥é¢†å¯¼è€…èŠ‚ç‚¹å¯¹å…¶è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œã€‚ ç›‘è§†è¯¥ä¸»èŠ‚ç‚¹çš„æ‰€æœ‰å“¨å…µéƒ½æœ‰å¯èƒ½è¢«é€‰ä¸ºé¢†å¯¼è€…ï¼Œé€‰ä¸¾ä½¿ç”¨çš„ç®—æ³•æ˜¯ Raft ç®—æ³•ã€‚ Raft ç®—æ³•çš„åŸºæœ¬æ€è·¯æ˜¯å…ˆåˆ°å…ˆå¾—ï¼šå³åœ¨ä¸€è½®é€‰ä¸¾ä¸­ï¼Œå“¨å…µ A å‘ B å‘é€æˆä¸ºé¢†å¯¼è€…çš„ç”³è¯·ï¼Œå¦‚æœ B æ²¡æœ‰åŒæ„è¿‡å…¶ä»–å“¨å…µï¼Œåˆ™ä¼šåŒæ„ A æˆä¸ºé¢†å¯¼è€…ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œè°å…ˆå®Œæˆå®¢è§‚ä¸‹çº¿ï¼Œä¸€èˆ¬å°±èƒ½æˆä¸ºé¢†å¯¼è€…ã€‚ æ•…éšœè½¬ç§» é€‰ä¸¾å‡ºçš„é¢†å¯¼è€…å“¨å…µï¼Œå¼€å§‹è¿›è¡Œæ•…éšœè½¬ç§»æ“ä½œï¼Œè¯¥æ“ä½œå¤§ä½“å¯ä»¥åˆ†ä¸º 3 ä¸ªæ­¥éª¤ï¼š åœ¨ä»èŠ‚ç‚¹ä¸­é€‰æ‹©æ–°çš„ä¸»èŠ‚ç‚¹ï¼š é€‰æ‹©çš„åŸåˆ™æ˜¯ï¼Œé¦–å…ˆè¿‡æ»¤æ‰ä¸å¥åº·çš„ä»èŠ‚ç‚¹ï¼Œç„¶åé€‰æ‹©ä¼˜å…ˆçº§æœ€é«˜çš„ä»èŠ‚ç‚¹(ç”± slave-priority æŒ‡å®š)ã€‚ å¦‚æœä¼˜å…ˆçº§æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹©å¤åˆ¶åç§»é‡æœ€å¤§çš„ä»èŠ‚ç‚¹ï¼›å¦‚æœä»æ— æ³•åŒºåˆ†ï¼Œåˆ™é€‰æ‹© runid æœ€å°çš„ä»èŠ‚ç‚¹ã€‚ æ›´æ–°ä¸»ä»çŠ¶æ€: é€šè¿‡ slaveof no one å‘½ä»¤ï¼Œè®©é€‰å‡ºæ¥çš„ä»èŠ‚ç‚¹æˆä¸ºä¸»èŠ‚ç‚¹ï¼›å¹¶é€šè¿‡ slaveof å‘½ä»¤è®©å…¶ä»–èŠ‚ç‚¹æˆä¸ºå…¶ä»èŠ‚ç‚¹ã€‚ Sentinel è¢«æˆæƒåï¼Œå®ƒå°†ä¼šè·å¾—å®•æ‰çš„ master çš„ä¸€ä»½æœ€æ–°é…ç½®ç‰ˆæœ¬å· (config-epoch)ï¼Œå½“ failover æ‰§è¡Œç»“æŸä»¥åï¼Œè¿™ä¸ªç‰ˆæœ¬å·å°†ä¼šè¢«ç”¨äºæœ€æ–°çš„é…ç½®ï¼Œé€šè¿‡å¹¿æ’­å½¢å¼é€šçŸ¥å…¶å®ƒ Sentinelï¼Œå…¶å®ƒçš„ Sentinel åˆ™æ›´æ–°å¯¹åº” master çš„é…ç½®ã€‚ redisçš„å¹¶å‘ç«äº‰keyé—®é¢˜ é—®é¢˜æè¿° åŒæ—¶æœ‰å¤šä¸ªå­ç³»ç»Ÿå»setä¸€ä¸ªkeyã€‚è¿™ä¸ªæ—¶å€™è¦æ³¨æ„ä»€ä¹ˆå‘¢ï¼Ÿ ç™¾åº¦ä¸€ä¸‹åŸºæœ¬éƒ½æ˜¯æ¨èç”¨ Redis äº‹åŠ¡æœºåˆ¶ã€‚ä½†æ˜¯å¹¶ä¸æ¨èä½¿ç”¨ Redis çš„äº‹åŠ¡æœºåˆ¶ã€‚å› ä¸ºç”Ÿäº§ç¯å¢ƒï¼ŒåŸºæœ¬éƒ½æ˜¯ Redis é›†ç¾¤ç¯å¢ƒï¼Œåšäº†æ•°æ®åˆ†ç‰‡æ“ä½œã€‚ä¸€ä¸ªäº‹åŠ¡ä¸­æœ‰æ¶‰åŠåˆ°å¤šä¸ª Key æ“ä½œçš„æ—¶å€™ï¼Œè¿™å¤šä¸ª Key ä¸ä¸€å®šéƒ½å­˜å‚¨åœ¨åŒä¸€ä¸ª redis-server ä¸Šã€‚å› æ­¤ï¼ŒRedis çš„äº‹åŠ¡æœºåˆ¶ï¼Œååˆ†é¸¡è‚‹ã€‚ è§£å†³æ–¹æ¡ˆ å¦‚æœå¯¹è¿™ä¸ª Key æ“ä½œï¼Œä¸è¦æ±‚é¡ºåº è¿™ç§æƒ…å†µä¸‹ï¼Œå‡†å¤‡ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Œå¤§å®¶å»æŠ¢é”ï¼ŒæŠ¢åˆ°é”å°±åšsetæ“ä½œå³å¯ï¼Œæ¯”è¾ƒç®€å•ã€‚ å¦‚æœå¯¹è¿™ä¸ªkeyæ“ä½œï¼Œè¦æ±‚é¡ºåº å‡è®¾æœ‰ä¸€ä¸ªkey1,ç³»ç»ŸAéœ€è¦å°†key1è®¾ç½®ä¸ºvalueA,ç³»ç»ŸBéœ€è¦å°†key1è®¾ç½®ä¸ºvalueB,ç³»ç»ŸCéœ€è¦å°†key1è®¾ç½®ä¸ºvalueC. æœŸæœ›æŒ‰ç…§key1çš„valueå€¼æŒ‰ç…§ valueAâ€“&gt;valueBâ€“&gt;valueCçš„é¡ºåºå˜åŒ–ã€‚è¿™æ—¶åœ¨æ•°æ®å†™å…¥æ•°æ®åº“çš„æ—¶å€™ï¼Œéœ€è¦ä¿å­˜ä¸€ä¸ªæ—¶é—´æˆ³ã€‚å‡è®¾æ—¶é—´æˆ³å¦‚ä¸‹ï¼š 12345ç³»ç»ŸA key 1 {valueA 3:00}ç³»ç»ŸB key 1 {valueB 3:05}ç³»ç»ŸC key 1 {valueC 3:10} é‚£ä¹ˆï¼Œå‡è®¾è¿™ä¼šç³»ç»ŸBå…ˆæŠ¢åˆ°é”ï¼Œå°†key1è®¾ç½®ä¸º{valueB 3:05}ã€‚æ¥ä¸‹æ¥ç³»ç»ŸAæŠ¢åˆ°é”ï¼Œå‘ç°è‡ªå·±çš„valueAçš„æ—¶é—´æˆ³æ—©äºç¼“å­˜ä¸­çš„æ—¶é—´æˆ³ï¼Œé‚£å°±ä¸åšsetæ“ä½œäº†ã€‚ä»¥æ­¤ç±»æ¨ã€‚ å…¶ä»–æ–¹æ³•ï¼Œæ¯”å¦‚åˆ©ç”¨é˜Ÿåˆ—ï¼Œå°†setæ–¹æ³•å˜æˆä¸²è¡Œè®¿é—®ä¹Ÿå¯ä»¥ã€‚ ç¼“å­˜é›ªå´© ç®€ä»‹ ç¼“å­˜åŒä¸€æ—¶é—´å¤§é¢ç§¯çš„å¤±æ•ˆï¼Œæ‰€ä»¥ï¼Œåé¢çš„è¯·æ±‚éƒ½ä¼šè½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚ é€šä¿—æ¥è¯´å°±æ˜¯ï¼šç”±äºåŸæœ‰ç¼“å­˜å¤±æ•ˆï¼ˆæˆ–è€…æ•°æ®æœªåŠ è½½åˆ°ç¼“å­˜ä¸­ï¼‰ï¼Œæ–°ç¼“å­˜æœªåˆ°æœŸé—´ï¼ˆç¼“å­˜æ­£å¸¸ä»Redisä¸­è·å–ï¼‰æ‰€æœ‰åŸæœ¬åº”è¯¥è®¿é—®ç¼“å­˜çš„è¯·æ±‚éƒ½å»æŸ¥è¯¢æ•°æ®åº“äº†ï¼Œè€Œå¯¹æ•°æ®åº“CPUå’Œå†…å­˜é€ æˆå·¨å¤§å‹åŠ›ï¼Œä¸¥é‡çš„ä¼šé€ æˆæ•°æ®åº“å®•æœºï¼Œé€ æˆç³»ç»Ÿçš„å´©æºƒã€‚ æ­£å¸¸è®¿é—®å¦‚ä¸‹ï¼š ç¼“å­˜å¤±æ•ˆçš„æ—¶å€™å¦‚ä¸‹å›¾ï¼š è§£å†³åŠæ³• äº‹å‰ï¼šå°½é‡ä¿è¯æ•´ä¸ª Redis é›†ç¾¤çš„é«˜å¯ç”¨æ€§ï¼Œå‘ç°æœºå™¨å®•æœºå°½å¿«è¡¥ä¸Šã€‚é€‰æ‹©åˆé€‚çš„å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚äº‹ä¸­ï¼šæœ¬åœ° Ehcache ç¼“å­˜ + Hystrix é™æµ&amp;é™çº§ï¼Œé¿å… æ•°æ®åº“ å´©æ‰ã€‚äº‹åï¼šåˆ©ç”¨ Redis æŒä¹…åŒ–æœºåˆ¶ä¿å­˜çš„æ•°æ®å°½å¿«æ¢å¤ç¼“å­˜ã€‚åŠ é”è®¡æ•°ï¼ˆå³é™åˆ¶å¹¶å‘çš„æ•°é‡ï¼Œå¯ä»¥ç”¨semphoreï¼‰æˆ–è€…èµ·ä¸€å®šæ•°é‡çš„é˜Ÿåˆ—æ¥é¿å…ç¼“å­˜å¤±æ•ˆæ—¶å¤§é‡è¯·æ±‚å¹¶å‘åˆ°æ•°æ®åº“ã€‚ä½†è¿™ç§æ–¹å¼ä¼šé™ä½ååé‡ã€‚åˆ†æç”¨æˆ·è¡Œä¸ºï¼Œç„¶åå¤±æ•ˆæ—¶é—´å‡åŒ€åˆ†å¸ƒã€‚æˆ–è€…åœ¨å¤±æ•ˆæ—¶é—´çš„åŸºç¡€ä¸Šå†åŠ 1~5åˆ†é’Ÿçš„éšæœºæ•°ã€‚å¦‚æœæ˜¯æŸå°ç¼“å­˜æœåŠ¡å™¨å®•æœºï¼Œåˆ™è€ƒè™‘åšä¸»å¤‡ã€‚ ç¼“å­˜ç©¿é€ ç®€ä»‹ ä¸€èˆ¬æ˜¯é»‘å®¢æ•…æ„å»è¯·æ±‚ç¼“å­˜ä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œå¯¼è‡´æ‰€æœ‰çš„è¯·æ±‚éƒ½è½åˆ°æ•°æ®åº“ä¸Šï¼Œé€ æˆæ•°æ®åº“çŸ­æ—¶é—´å†…æ‰¿å—å¤§é‡è¯·æ±‚è€Œå´©æ‰ã€‚ è§£å†³åŠæ³• æœ€å¸¸è§çš„åˆ™æ˜¯é‡‡ç”¨å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå°†æ‰€æœ‰å¯èƒ½å­˜åœ¨çš„æ•°æ®å“ˆå¸Œåˆ°ä¸€ä¸ªè¶³å¤Ÿå¤§çš„ bitmap ä¸­ã€‚ä¸€ä¸ªä¸€å®šä¸å­˜åœ¨çš„æ•°æ®ä¼šè¢«è¿™ä¸ª bitmap æ‹¦æˆªæ‰ï¼Œä»è€Œé¿å…äº†å¯¹åº•å±‚å­˜å‚¨ç³»ç»Ÿçš„æŸ¥è¯¢å‹åŠ›ã€‚ä¹Ÿæœ‰ä¸€ä¸ªæ›´ä¸ºç®€å•ç²—æš´çš„æ–¹æ³•ï¼Œå¦‚æœä¸€ä¸ªæŸ¥è¯¢è¿”å›çš„æ•°æ®ä¸ºç©º(ä¸ç®¡æ˜¯æ•°æ®ä¸å­˜åœ¨ï¼Œè¿˜æ˜¯ç³»ç»Ÿæ•…éšœ)ï¼Œä»ç„¶æŠŠè¿™ä¸ªç©ºç»“æœè¿›è¡Œç¼“å­˜ï¼Œä½†å®ƒçš„è¿‡æœŸæ—¶é—´ä¼šå¾ˆçŸ­ï¼Œæœ€é•¿ä¸è¶…è¿‡äº”åˆ†é’Ÿã€‚ ç¼“å­˜å¹¶å‘ ç®€ä»‹ å¦‚æœç½‘ç«™å¹¶å‘è®¿é—®é«˜ï¼Œä¸€ä¸ªç¼“å­˜å¦‚æœå¤±æ•ˆï¼Œå¯èƒ½å‡ºç°å¤šä¸ªè¿›ç¨‹åŒæ—¶æŸ¥è¯¢DBï¼ŒåŒæ—¶è®¾ç½®ç¼“å­˜çš„æƒ…å†µï¼Œå¦‚æœå¹¶å‘ç¡®å®å¾ˆå¤§ï¼Œè¿™ä¹Ÿå¯èƒ½é€ æˆDBå‹åŠ›è¿‡å¤§ï¼Œè¿˜æœ‰ç¼“å­˜é¢‘ç¹æ›´æ–°çš„é—®é¢˜ã€‚ è§£å†³åŠæ³• å¯¹ç¼“å­˜æŸ¥è¯¢åŠ é”ï¼Œå¦‚æœKEYä¸å­˜åœ¨ï¼Œå°±åŠ é”ï¼Œç„¶åæŸ¥DBå…¥ç¼“å­˜ï¼Œç„¶åè§£é”ï¼›å…¶ä»–è¿›ç¨‹å¦‚æœå‘ç°æœ‰é”å°±ç­‰å¾…ï¼Œç„¶åç­‰è§£é”åè¿”å›æ•°æ®æˆ–è€…è¿›å…¥DBæŸ¥è¯¢ã€‚ ç¼“å­˜é¢„çƒ­ ç®€ä»‹ ç¼“å­˜é¢„çƒ­å°±æ˜¯ç³»ç»Ÿä¸Šçº¿åï¼Œå°†ç›¸å…³çš„ç¼“å­˜æ•°æ®ç›´æ¥åŠ è½½åˆ°ç¼“å­˜ç³»ç»Ÿã€‚è¿™æ ·å°±å¯ä»¥é¿å…åœ¨ç”¨æˆ·è¯·æ±‚çš„æ—¶å€™ï¼Œå…ˆæŸ¥è¯¢æ•°æ®åº“ï¼Œç„¶åå†å°†æ•°æ®ç¼“å­˜çš„é—®é¢˜ï¼ç”¨æˆ·ç›´æ¥æŸ¥è¯¢äº‹å…ˆè¢«é¢„çƒ­çš„ç¼“å­˜æ•°æ®ï¼ è§£å†³åŠæ³• ç›´æ¥å†™ä¸ªç¼“å­˜åˆ·æ–°é¡µé¢ï¼Œä¸Šçº¿æ—¶æ‰‹å·¥æ“ä½œä¸‹ï¼›æ•°æ®é‡ä¸å¤§ï¼Œå¯ä»¥åœ¨é¡¹ç›®å¯åŠ¨çš„æ—¶å€™è‡ªåŠ¨è¿›è¡ŒåŠ è½½ï¼›å®šæ—¶åˆ·æ–°ç¼“å­˜ï¼› Rediså¸¸è§æ€§èƒ½é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ Masteræœ€å¥½ä¸è¦åšä»»ä½•æŒä¹…åŒ–å·¥ä½œï¼Œå¦‚RDBå†…å­˜å¿«ç…§å’ŒAOFæ—¥å¿—æ–‡ä»¶ å¦‚æœæ•°æ®æ¯”è¾ƒé‡è¦ï¼ŒæŸä¸ªSlaveå¼€å¯AOFå¤‡ä»½æ•°æ®ï¼Œç­–ç•¥è®¾ç½®ä¸ºæ¯ç§’åŒæ­¥ä¸€æ¬¡ ä¸ºäº†ä¸»ä»å¤åˆ¶çš„é€Ÿåº¦å’Œè¿æ¥çš„ç¨³å®šæ€§ï¼ŒMasterå’ŒSlaveæœ€å¥½åœ¨åŒä¸€ä¸ªå±€åŸŸç½‘å†… å°½é‡é¿å…åœ¨å‹åŠ›å¾ˆå¤§çš„ä¸»åº“ä¸Šå¢åŠ ä»åº“ ä¸»ä»å¤åˆ¶ä¸è¦ç”¨å›¾çŠ¶ç»“æ„ï¼Œç”¨å•å‘é“¾è¡¨ç»“æ„æ›´ä¸ºç¨³å®šï¼Œå³ï¼šMaster &lt;- Slave1 &lt;- Slave2 &lt;- Slave3... è¿™æ ·çš„ç»“æ„æ–¹ä¾¿è§£å†³å•ç‚¹æ•…éšœé—®é¢˜ï¼Œå®ç°Slaveå¯¹Masterçš„æ›¿æ¢ã€‚å¦‚æœMasteræŒ‚äº†ï¼Œå¯ä»¥ç«‹åˆ»å¯ç”¨Slave1åšMasterï¼Œå…¶ä»–ä¸å˜ã€‚ Redis ä¸»ä»å¤åˆ¶ åŸç† ä»æœåŠ¡å™¨è¿æ¥ä¸»æœåŠ¡å™¨ï¼Œå‘é€SYNCï¼ˆåŒæ­¥ï¼‰å‘½ä»¤ï¼›ä¸»æœåŠ¡å™¨æ¥æ”¶åˆ°SYNCå‘½ååï¼Œå¼€å§‹æ‰§è¡ŒBGSAVEå‘½ä»¤ç”ŸæˆRDBæ–‡ä»¶å¹¶ä½¿ç”¨ç¼“å†²åŒºè®°å½•æ­¤åæ‰§è¡Œçš„æ‰€æœ‰å†™å‘½ä»¤ï¼›ä¸»æœåŠ¡å™¨BGSAVEæ‰§è¡Œå®Œåï¼Œå‘æ‰€æœ‰ä»æœåŠ¡å™¨å‘é€å¿«ç…§æ–‡ä»¶ï¼Œå¹¶åœ¨å‘é€æœŸé—´ç»§ç»­è®°å½•è¢«æ‰§è¡Œçš„å†™å‘½ä»¤ï¼›ä»æœåŠ¡å™¨æ”¶åˆ°å¿«ç…§æ–‡ä»¶åä¸¢å¼ƒæ‰€æœ‰æ—§æ•°æ®ï¼Œè½½å…¥æ”¶åˆ°çš„å¿«ç…§ï¼›ä¸»æœåŠ¡å™¨å¿«ç…§å‘é€å®Œæ¯•åå¼€å§‹å‘ä»æœåŠ¡å™¨å‘é€ç¼“å†²åŒºä¸­çš„å†™å‘½ä»¤ï¼›ä»æœåŠ¡å™¨å®Œæˆå¯¹å¿«ç…§çš„è½½å…¥ï¼Œå¼€å§‹æ¥æ”¶å‘½ä»¤è¯·æ±‚ï¼Œå¹¶æ‰§è¡Œæ¥è‡ªä¸»æœåŠ¡å™¨ç¼“å†²åŒºçš„å†™å‘½ä»¤ï¼›ï¼ˆä»æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆï¼‰ä¸»æœåŠ¡å™¨æ¯æ‰§è¡Œä¸€ä¸ªå†™å‘½ä»¤å°±ä¼šå‘ä»æœåŠ¡å™¨å‘é€ç›¸åŒçš„å†™å‘½ä»¤ï¼Œä»æœåŠ¡å™¨æ¥æ”¶å¹¶æ‰§è¡Œæ”¶åˆ°çš„å†™å‘½ä»¤ï¼ˆä»æœåŠ¡å™¨åˆå§‹åŒ–å®Œæˆåçš„æ“ä½œï¼‰ã€‚ ä¼˜ç‚¹ æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»æœºä¼šè‡ªåŠ¨å°†æ•°æ®åŒæ­¥åˆ°ä»æœºï¼Œå¯ä»¥è¿›è¡Œè¯»å†™åˆ†ç¦»ï¼›ä¸ºäº†åˆ†è½½Masterçš„è¯»æ“ä½œå‹åŠ›ï¼ŒSlaveæœåŠ¡å™¨å¯ä»¥ä¸ºå®¢æˆ·ç«¯æä¾›åªè¯»æ“ä½œçš„æœåŠ¡ï¼Œå†™æœåŠ¡ä»ç„¶å¿…é¡»ç”±Masteræ¥å®Œæˆï¼›SlaveåŒæ ·å¯ä»¥æ¥å—å…¶å®ƒSlavesçš„è¿æ¥å’ŒåŒæ­¥è¯·æ±‚ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆçš„åˆ†è½½Masterçš„åŒæ­¥å‹åŠ›ï¼›Master Serveræ˜¯ä»¥éé˜»å¡çš„æ–¹å¼ä¸ºSlavesæä¾›æœåŠ¡ã€‚æ‰€ä»¥åœ¨Master-SlaveåŒæ­¥æœŸé—´ï¼Œå®¢æˆ·ç«¯ä»ç„¶å¯ä»¥æäº¤æŸ¥è¯¢æˆ–ä¿®æ”¹è¯·æ±‚ï¼›Slave ServeråŒæ ·æ˜¯ä»¥éé˜»å¡çš„æ–¹å¼å®Œæˆæ•°æ®åŒæ­¥ã€‚åœ¨åŒæ­¥æœŸé—´ï¼Œå¦‚æœæœ‰å®¢æˆ·ç«¯æäº¤æŸ¥è¯¢è¯·æ±‚ï¼ŒRedisåˆ™è¿”å›åŒæ­¥ä¹‹å‰çš„æ•°æ®ã€‚ ç¼ºç‚¹ Redisä¸å…·å¤‡è‡ªåŠ¨å®¹é”™å’Œæ¢å¤åŠŸèƒ½ï¼Œä¸»æœºä»æœºçš„å®•æœºéƒ½ä¼šå¯¼è‡´å‰ç«¯éƒ¨åˆ†è¯»å†™è¯·æ±‚å¤±è´¥ï¼Œéœ€è¦ç­‰å¾…æœºå™¨é‡å¯æˆ–è€…æ‰‹åŠ¨åˆ‡æ¢å‰ç«¯çš„IPæ‰èƒ½æ¢å¤ã€‚ä¸»æœºå®•æœºï¼Œå®•æœºå‰æœ‰éƒ¨åˆ†æ•°æ®æœªèƒ½åŠæ—¶åŒæ­¥åˆ°ä»æœºï¼Œåˆ‡æ¢IPåè¿˜ä¼šå¼•å…¥æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œé™ä½äº†ç³»ç»Ÿçš„å¯ç”¨æ€§ã€‚Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ Redis å“¨å…µæ¨¡å¼ å·¥ä½œæ–¹å¼ æ¯ä¸ªSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä»¥æ¯ç§’é’Ÿä¸€æ¬¡çš„é¢‘ç‡å‘æ•´ä¸ªé›†ç¾¤ä¸­çš„Masterä¸»æœåŠ¡å™¨ï¼ŒSlaveä»æœåŠ¡å™¨ä»¥åŠå…¶ä»–Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ä¸€ä¸ª PING å‘½ä»¤ã€‚å¦‚æœä¸€ä¸ªå®ä¾‹ï¼ˆinstanceï¼‰è·ç¦»æœ€åä¸€æ¬¡æœ‰æ•ˆå›å¤ PING å‘½ä»¤çš„æ—¶é—´è¶…è¿‡ down-after-milliseconds é€‰é¡¹æ‰€æŒ‡å®šçš„å€¼ï¼Œ åˆ™è¿™ä¸ªå®ä¾‹ä¼šè¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰å¦‚æœä¸€ä¸ªMasterä¸»æœåŠ¡å™¨è¢«æ ‡è®°ä¸ºä¸»è§‚ä¸‹çº¿ï¼ˆSDOWNï¼‰ï¼Œåˆ™æ­£åœ¨ç›‘è§†è¿™ä¸ªMasterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹è¦ä»¥æ¯ç§’ä¸€æ¬¡çš„é¢‘ç‡ç¡®è®¤Masterä¸»æœåŠ¡å™¨çš„ç¡®è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€å½“æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ï¼ˆå¤§äºç­‰äºé…ç½®æ–‡ä»¶æŒ‡å®šçš„å€¼ï¼‰åœ¨æŒ‡å®šçš„æ—¶é—´èŒƒå›´å†…ç¡®è®¤Masterä¸»æœåŠ¡å™¨è¿›å…¥äº†ä¸»è§‚ä¸‹çº¿çŠ¶æ€ï¼ˆSDOWNï¼‰ï¼Œ åˆ™Masterä¸»æœåŠ¡å™¨ä¼šè¢«æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰åœ¨ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œ æ¯ä¸ª Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹ä¼šä»¥æ¯ 10 ç§’ä¸€æ¬¡çš„é¢‘ç‡å‘é›†ç¾¤ä¸­çš„æ‰€æœ‰Masterä¸»æœåŠ¡å™¨ã€Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤ã€‚å½“Masterä¸»æœåŠ¡å™¨è¢« Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹æ ‡è®°ä¸ºå®¢è§‚ä¸‹çº¿ï¼ˆODOWNï¼‰æ—¶ï¼ŒSentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘ä¸‹çº¿çš„ Masterä¸»æœåŠ¡å™¨çš„æ‰€æœ‰ Slaveä»æœåŠ¡å™¨å‘é€ INFO å‘½ä»¤çš„é¢‘ç‡ä¼šä» 10 ç§’ä¸€æ¬¡æ”¹ä¸ºæ¯ç§’ä¸€æ¬¡ã€‚è‹¥æ²¡æœ‰è¶³å¤Ÿæ•°é‡çš„ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹åŒæ„ Masterä¸»æœåŠ¡å™¨ä¸‹çº¿ï¼Œ Masterä¸»æœåŠ¡å™¨çš„å®¢è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚è‹¥ Masterä¸»æœåŠ¡å™¨é‡æ–°å‘ Sentinelï¼ˆå“¨å…µï¼‰è¿›ç¨‹å‘é€ PING å‘½ä»¤è¿”å›æœ‰æ•ˆå›å¤ï¼ŒMasterä¸»æœåŠ¡å™¨çš„ä¸»è§‚ä¸‹çº¿çŠ¶æ€å°±ä¼šè¢«ç§»é™¤ã€‚ ä¼˜ç‚¹ å“¨å…µæ¨¡å¼æ˜¯åŸºäºä¸»ä»æ¨¡å¼çš„ï¼Œæ‰€æœ‰ä¸»ä»çš„ä¼˜ç‚¹ï¼Œå“¨å…µæ¨¡å¼éƒ½å…·æœ‰ã€‚ä¸»ä»å¯ä»¥è‡ªåŠ¨åˆ‡æ¢ï¼Œç³»ç»Ÿæ›´å¥å£®ï¼Œå¯ç”¨æ€§æ›´é«˜ã€‚ ç¼ºç‚¹ Redisè¾ƒéš¾æ”¯æŒåœ¨çº¿æ‰©å®¹ï¼Œåœ¨é›†ç¾¤å®¹é‡è¾¾åˆ°ä¸Šé™æ—¶åœ¨çº¿æ‰©å®¹ä¼šå˜å¾—å¾ˆå¤æ‚ã€‚ Redis Clusteré›†ç¾¤æ¨¡å¼ redis3ä»¥åï¼ŒèŠ‚ç‚¹ä¹‹é—´æä¾›äº†å®Œæ•´çš„shardingï¼ˆåˆ†ç‰‡ï¼‰ã€replicationï¼ˆä¸»å¤‡æ„ŸçŸ¥èƒ½åŠ›ï¼‰ã€failoverï¼ˆæ•…éšœè½¬ç§»ï¼‰çš„ç‰¹æ€§ã€‚ é…ç½®ä¸€è‡´æ€§ æ¯ä¸ªèŠ‚ç‚¹ï¼ˆNodeï¼‰å†…éƒ¨éƒ½ä¿å­˜äº†é›†ç¾¤çš„é…ç½®ä¿¡æ¯ï¼Œå­˜å‚¨åœ¨clusterStateä¸­ï¼Œé€šè¿‡å¼•å…¥è‡ªå¢çš„epochå˜é‡æ¥ä½¿å¾—é›†ç¾¤é…ç½®åœ¨å„ä¸ªèŠ‚ç‚¹é—´ä¿æŒä¸€è‡´ã€‚ shardingæ•°æ®åˆ†ç‰‡ å°†æ‰€æœ‰æ•°æ®åˆ’åˆ†ä¸º16384ä¸ªåˆ†ç‰‡ï¼ˆslotï¼‰ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä¼šå¯¹åº”ä¸€éƒ¨åˆ†slotï¼Œæ¯ä¸ªkeyéƒ½ä¼šæ ¹æ®åˆ†å¸ƒç®—æ³•æ˜ å°„åˆ°16384ä¸ªslotä¸­çš„ä¸€ä¸ªï¼Œåˆ†å¸ƒç®—æ³•ä¸ºslotId=crc16(key)%16384 å½“ä¸€ä¸ªclientè®¿é—®çš„keyä¸åœ¨å¯¹åº”èŠ‚ç‚¹çš„slotsä¸­ï¼Œredisä¼šè¿”å›ç»™clientä¸€ä¸ªmovedå‘½ä»¤ï¼Œå‘ŠçŸ¥å…¶æ­£ç¡®çš„è·¯ç”±ä¿¡æ¯ä»è€Œé‡æ–°å‘èµ·è¯·æ±‚ã€‚clientä¼šæ ¹æ®æ¯æ¬¡è¯·æ±‚æ¥ç¼“å­˜æœ¬åœ°çš„è·¯ç”±ç¼“å­˜ä¿¡æ¯ï¼Œä»¥ä¾¿ä¸‹æ¬¡è¯·æ±‚ç›´æ¥èƒ½å¤Ÿè·¯ç”±åˆ°æ­£ç¡®çš„èŠ‚ç‚¹ã€‚ åˆ†ç‰‡è¿ç§» åˆ†ç‰‡è¿ç§»çš„è§¦å‘å’Œè¿‡ç¨‹æ§åˆ¶ç”±å¤–éƒ¨ç³»ç»Ÿå®Œæˆï¼Œredisåªæä¾›è¿ç§»è¿‡ç¨‹ä¸­éœ€è¦çš„åŸè¯­æ”¯æŒã€‚ ä¸»è¦åŒ…å«ä¸¤ç§ï¼šä¸€ç§æ˜¯èŠ‚ç‚¹è¿ç§»çŠ¶æ€è®¾ç½®ï¼Œå³è¿ç§»å‰æ ‡è®°æºã€ç›®æ ‡èŠ‚ç‚¹ï¼›å¦ä¸€ç§æ˜¯keyè¿ç§»çš„åŸå­åŒ–å‘½ä»¤ã€‚ failoveræ•…éšœè½¬ç§» æ•…éšœå‘ç° èŠ‚ç‚¹é—´ä¸¤ä¸¤é€šè¿‡TCPä¿æŒè¿æ¥ï¼Œå‘¨æœŸæ€§è¿›è¡ŒPINGã€PONGäº¤äº’ï¼Œè‹¥å¯¹æ–¹çš„PONGç›¸åº”è¶…æ—¶æœªæ”¶åˆ°ï¼Œåˆ™å°†å…¶ç½®ä¸ºPFAILçŠ¶æ€ï¼Œå¹¶ä¼ æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚ æ•…éšœç¡®è®¤ å½“é›†ç¾¤ä¸­æœ‰ä¸€åŠä»¥ä¸Šçš„èŠ‚ç‚¹å¯¹æŸä¸€ä¸ªPFAILçŠ¶æ€è¿›è¡Œäº†ç¡®è®¤ï¼Œåˆ™å°†èµ·æ”¹ä¸ºFAILçŠ¶æ€ï¼Œç¡®è®¤å…¶æ•…éšœã€‚ slaveé€‰ä¸¾ å½“æœ‰ä¸€ä¸ªmasteræŒ‚æ‰äº†ï¼Œåˆ™å…¶slaveé‡æ–°ç«é€‰å‡ºä¸€ä¸ªæ–°çš„masterã€‚ä¸»è¦æ ¹æ®å„ä¸ªslaveæœ€åä¸€æ¬¡åŒæ­¥masterä¿¡æ¯çš„æ—¶é—´ï¼Œè¶Šæ–°è¡¨ç¤ºslaveçš„æ•°æ®è¶Šæ–°ï¼Œç«é€‰çš„ä¼˜å…ˆçº§è¶Šé«˜ï¼Œå°±æ›´æœ‰å¯èƒ½é€‰ä¸­ã€‚ç«é€‰æˆåŠŸä¹‹åå°†æ¶ˆæ¯ä¼ æ’­ç»™å…¶ä»–èŠ‚ç‚¹ã€‚ é›†ç¾¤ä¸å¯ç”¨çš„æƒ…å†µ é›†ç¾¤ä¸­ä»»æ„masteræŒ‚æ‰ï¼Œä¸”å½“å‰masteræ²¡æœ‰slaveã€‚ é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°ä»¥ä¸ŠmasteræŒ‚æ‰ã€‚ Redis-Clusteré‡‡ç”¨æ— ä¸­å¿ƒç»“æ„çš„ç‰¹ç‚¹ æ‰€æœ‰çš„redisèŠ‚ç‚¹å½¼æ­¤äº’è”(PING-PONGæœºåˆ¶),å†…éƒ¨ä½¿ç”¨äºŒè¿›åˆ¶åè®®ä¼˜åŒ–ä¼ è¾“é€Ÿåº¦å’Œå¸¦å®½ã€‚ èŠ‚ç‚¹çš„failæ˜¯é€šè¿‡é›†ç¾¤ä¸­è¶…è¿‡åŠæ•°çš„èŠ‚ç‚¹æ£€æµ‹å¤±æ•ˆæ—¶æ‰ç”Ÿæ•ˆã€‚ å®¢æˆ·ç«¯ä¸redisèŠ‚ç‚¹ç›´è¿,ä¸éœ€è¦ä¸­é—´ä»£ç†å±‚.å®¢æˆ·ç«¯ä¸éœ€è¦è¿æ¥é›†ç¾¤æ‰€æœ‰èŠ‚ç‚¹,è¿æ¥é›†ç¾¤ä¸­ä»»ä½•ä¸€ä¸ªå¯ç”¨èŠ‚ç‚¹å³å¯ã€‚ Pipelineæœ‰ä»€ä¹ˆå¥½å¤„ï¼Œä¸ºä»€ä¹ˆè¦ç”¨pipeline å¯ä»¥å°†å¤šæ¬¡IOå¾€è¿”çš„æ—¶é—´ç¼©å‡ä¸ºä¸€æ¬¡ï¼Œå‰ææ˜¯pipelineæ‰§è¡Œçš„æŒ‡ä»¤ä¹‹é—´æ²¡æœ‰å› æœç›¸å…³æ€§ã€‚ ä½¿ç”¨redis-benchmarkè¿›è¡Œå‹æµ‹çš„æ—¶å€™å¯ä»¥å‘ç°å½±å“redisçš„QPSå³°å€¼çš„ä¸€ä¸ªé‡è¦å› ç´ æ˜¯pipelineæ‰¹æ¬¡æŒ‡ä»¤çš„æ•°ç›®ã€‚ å¦‚æœæœ‰å¤§é‡çš„keyéœ€è¦è®¾ç½®åŒä¸€æ—¶é—´è¿‡æœŸéœ€è¦æ³¨æ„ä»€ä¹ˆ å¦‚æœå¤§é‡çš„keyè¿‡æœŸæ—¶é—´è®¾ç½®çš„è¿‡äºé›†ä¸­ï¼Œåˆ°è¿‡æœŸçš„é‚£ä¸ªæ—¶é—´ç‚¹ï¼Œrediså¯èƒ½ä¼šå‡ºç°çŸ­æš‚çš„å¡é¡¿ç°è±¡ã€‚ä¸€èˆ¬éœ€è¦åœ¨æ—¶é—´ä¸ŠåŠ ä¸€ä¸ªéšæœºå€¼ï¼Œä½¿å¾—è¿‡æœŸæ—¶é—´åˆ†æ•£ä¸€äº›ã€‚ Rediså¼‚æ­¥é˜Ÿåˆ— åŸç† ä¸€èˆ¬ä½¿ç”¨listç»“æ„ä½œä¸ºé˜Ÿåˆ—ï¼Œrpushç”Ÿäº§æ¶ˆæ¯ï¼Œlpopæ¶ˆè´¹æ¶ˆæ¯ã€‚å½“lpopæ²¡æœ‰æ¶ˆæ¯çš„æ—¶å€™ï¼Œè¦é€‚å½“sleepä¸€ä¼šå†é‡è¯•ã€‚ å¯ä¸å¯ä»¥ä¸ç”¨sleep listæœ‰ä¸ªæŒ‡ä»¤å«blpopï¼Œåœ¨æ²¡æœ‰æ¶ˆæ¯æ—¶ï¼Œå®ƒä¼šé˜»å¡ä½ç›´åˆ°æ¶ˆæ¯åˆ°æ¥ã€‚ èƒ½ä¸èƒ½ç”Ÿäº§ä¸€æ¬¡æ¶ˆè´¹å¤šæ¬¡ ä½¿ç”¨pub/subä¸»é¢˜è®¢é˜…è€…æ¨¡å¼ï¼Œå¯ä»¥å®ç°1:Nçš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚ pub/subæœ‰ä»€ä¹ˆç¼ºç‚¹ åœ¨æ¶ˆè´¹è€…ä¸‹çº¿çš„æƒ…å†µä¸‹ï¼Œç”Ÿäº§çš„æ¶ˆæ¯ä¼šä¸¢å¤±ï¼Œå¾—ä½¿ç”¨ä¸“ä¸šçš„æ¶ˆæ¯é˜Ÿåˆ—å¦‚rabbitmqç­‰ã€‚ rediså¦‚ä½•å®ç°å»¶æ—¶é˜Ÿåˆ— ä½¿ç”¨sortedsetï¼Œæ‹¿æ—¶é—´æˆ³ä½œä¸ºscoreï¼Œæ¶ˆæ¯å†…å®¹ä½œä¸ºkeyè°ƒç”¨zaddæ¥ç”Ÿäº§æ¶ˆæ¯ï¼Œæ¶ˆè´¹è€…ç”¨zrangebyscoreæŒ‡ä»¤è·å–Nç§’ä¹‹å‰çš„æ•°æ®è½®è¯¢è¿›è¡Œå¤„ç†ã€‚ å‡å¦‚Redisé‡Œé¢æœ‰1äº¿ä¸ªkeyï¼Œå…¶ä¸­æœ‰10wä¸ªkeyæ˜¯ä»¥æŸä¸ªå›ºå®šçš„å·²çŸ¥çš„å‰ç¼€å¼€å¤´çš„ï¼Œå¦‚æœå°†å®ƒä»¬å…¨éƒ¨æ‰¾å‡ºæ¥ ä½¿ç”¨keysæŒ‡ä»¤å¯ä»¥æ‰«å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ã€‚ å¦‚æœè¿™ä¸ªredisæ­£åœ¨ç»™çº¿ä¸Šçš„ä¸šåŠ¡æä¾›æœåŠ¡ï¼Œé‚£ä½¿ç”¨keysæŒ‡ä»¤ä¼šæœ‰ä»€ä¹ˆé—®é¢˜ redisçš„å•çº¿ç¨‹çš„ã€‚keysæŒ‡ä»¤ä¼šå¯¼è‡´çº¿ç¨‹é˜»å¡ä¸€æ®µæ—¶é—´ï¼Œçº¿ä¸ŠæœåŠ¡ä¼šåœé¡¿ï¼Œç›´åˆ°æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼ŒæœåŠ¡æ‰èƒ½æ¢å¤ã€‚è¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨scanæŒ‡ä»¤ï¼ŒscanæŒ‡ä»¤å¯ä»¥æ— é˜»å¡çš„æå–å‡ºæŒ‡å®šæ¨¡å¼çš„keyåˆ—è¡¨ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€å®šçš„é‡å¤æ¦‚ç‡ï¼Œåœ¨å®¢æˆ·ç«¯åšä¸€æ¬¡å»é‡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯æ•´ä½“æ‰€èŠ±è´¹çš„æ—¶é—´ä¼šæ¯”ç›´æ¥ç”¨keysæŒ‡ä»¤é•¿ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ‰‹å†™RPC--ç®€æ˜“ç‰ˆ]]></title>
    <url>%2Fposts%2Fabff3a44.html</url>
    <content type="text"><![CDATA[ä¹‹å‰åœ¨ç½‘ä¸Šçœ‹å¾ˆå¤šå…¬å¸åœ¨é¢è¯•çš„æ—¶å€™éƒ½ä¼šé—®åˆ°Dubboç­‰ä¸€äº›RPCæ¡†æ¶ï¼Œæ›´æœ‰ç”šè€…ç›´æ¥è¦æ±‚é¢è¯•è€…æ‰‹å†™PRCï¼Œä»Šå¤©å°±æ¥æ’©ä¸‹RPCã€‚ ä»€ä¹ˆæ˜¯RPC RPCï¼ˆRemote Procedure Callï¼‰ï¼Œè¿œç¨‹è¿‡ç¨‹è°ƒç”¨ï¼Œæ„æ€æ˜¯å¯ä»¥åœ¨ä¸€å°æœºå™¨ä¸Šè°ƒç”¨è¿œç¨‹çš„æœåŠ¡ã€‚åœ¨éåˆ†å¸ƒå¼ç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬çš„ç¨‹åºè°ƒç”¨æœåŠ¡éƒ½æ˜¯æœ¬åœ°è°ƒç”¨ï¼Œä½†æ˜¯éšç€åˆ†å¸ƒå¼ç»“æ„çš„æ™®éï¼Œè¶Šæ¥è¶Šå¤šçš„åº”ç”¨éœ€è¦è§£è€¦ï¼Œå°†ä¸åŒçš„ç‹¬ç«‹åŠŸèƒ½éƒ¨ç½²å‘å¸ƒæˆä¸åŒçš„æœåŠ¡ä¾›å®¢æˆ·ç«¯è°ƒç”¨ï¼ŒRPCå°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜çš„ã€‚RPCæ˜¯ä¸€ç§è§„èŒƒï¼Œå’ŒTCPã€UDPéƒ½æ²¡æœ‰å…³ç³»ï¼ŒRPCå¯ä»¥é‡‡ç”¨TCPåè®®å®Œæˆæ•°æ®ä¼ è¾“ï¼Œç”šè‡³å¯ä»¥ä½¿ç”¨HTTPåº”ç”¨åè®®ã€‚RPCæ˜¯Cç«¯æ¨¡å¼ï¼ŒåŒ…å«äº†æœåŠ¡ç«¯ï¼ˆæœåŠ¡æä¾›æ–¹ï¼‰ã€å®¢æˆ·ç«¯ï¼ˆæœåŠ¡ä½¿ç”¨æ–¹ï¼‰ï¼Œé‡‡ç”¨ç‰¹å®šçš„ç½‘ç»œä¼ è¾“åè®®ï¼ŒæŠŠæ•°æ®æŒ‰ç…§ç‰¹å®šçš„åè®®åŒ…è£…åè¿›è¡Œä¼ è¾“æ“ä½œç­‰æ“ä½œã€‚ RPCåŸç† é¦–å…ˆï¼Œæˆ‘ä»¬å¿ƒé‡Œå¸¦ç€è¿™æ ·çš„é—®é¢˜ï¼šè¦æ€ä¹ˆæ ·å»è°ƒç”¨è¿œç¨‹çš„æœåŠ¡å‘¢ï¼Ÿ â‘ è‚¯å®šè¦çŸ¥é“IPå’Œç«¯å£å§ï¼ˆç¡®å®šå”¯ä¸€ä¸€ä¸ªè¿›ç¨‹ï¼‰ï¼› â‘¡è‚¯å®šè¦çŸ¥é“è°ƒç”¨ä»€ä¹ˆæœåŠ¡å§ï¼ˆæ–¹æ³•åå’Œå‚æ•°ï¼‰ï¼› â‘¢è°ƒç”¨æœåŠ¡åå¯èƒ½éœ€è¦ç»“æœå§ã€‚ è¿™ä¸‰ç‚¹åˆæ€ä¹ˆå®ç°å‘¢ï¼Ÿ RPCçš„è®¾è®¡ç”±Clientï¼ŒClient stubï¼ŒNetworkï¼ŒServer stubï¼ŒServeræ„æˆã€‚ å…¶ä¸­Clientå°±æ˜¯ç”¨æ¥è°ƒç”¨æœåŠ¡çš„ï¼ŒCient stubæ˜¯ç”¨æ¥æŠŠè°ƒç”¨çš„æ–¹æ³•å’Œå‚æ•°åºåˆ—åŒ–çš„ï¼ˆå› ä¸ºè¦åœ¨ç½‘ç»œä¸­ä¼ è¾“ï¼Œå¿…é¡»è¦æŠŠå¯¹è±¡è½¬å˜æˆå­—èŠ‚ï¼‰ï¼Œç½‘ç»œç”¨æ¥ä¼ è¾“è¿™äº›ä¿¡æ¯åˆ°æœåŠ¡å™¨å­˜æ ¹ï¼ŒæœåŠ¡å™¨å­˜æ ¹ç”¨æ¥æŠŠè¿™äº›ä¿¡æ¯ååºåˆ—åŒ–çš„ï¼ŒæœåŠ¡å™¨å°±æ˜¯æœåŠ¡çš„æä¾›è€…ï¼Œæœ€ç»ˆè°ƒç”¨çš„å°±æ˜¯æœåŠ¡å™¨æä¾›çš„æ–¹æ³•ã€‚ RPCçš„ç»“æ„å¦‚ä¸‹å›¾ï¼š å›¾ä¸­1-10åºå·çš„å«ä¹‰å¦‚ä¸‹ï¼š å®¢æˆ·ç«¯åƒè°ƒç”¨æœ¬åœ°æœåŠ¡ä¼¼çš„è°ƒç”¨è¿œç¨‹æœåŠ¡; å®¢æˆ·ç«¯stubæ¥æ”¶åˆ°è°ƒç”¨åï¼Œå°†ç±»åï¼Œæ–¹æ³•åï¼Œå‚æ•°åˆ—è¡¨åºåˆ—åŒ–; å®¢æˆ·ç«¯é€šè¿‡æ’åº§å°†æ¶ˆæ¯å‘é€åˆ°æœåŠ¡ç«¯; Server stubæ”¶åˆ°æ¶ˆæ¯åè¿›è¡Œè§£ç ï¼ˆå°†æ¶ˆæ¯å¯¹è±¡ååºåˆ—åŒ–ï¼‰; æœåŠ¡å™¨å­˜æ ¹æ ¹æ®è§£ç ç»“æœè°ƒç”¨æœ¬åœ°çš„æœåŠ¡; æœ¬åœ°æœåŠ¡æ‰§è¡Œï¼ˆå¯¹äºæœåŠ¡ç«¯æ¥è¯´æ˜¯æœ¬åœ°æ‰§è¡Œï¼‰å¹¶å°†ç»“æœè¿”å›ç»™æœåŠ¡å™¨å­˜æ ¹; æœåŠ¡å™¨å­˜æ ¹å°†è¿”å›ç»“æœæ‰“åŒ…æˆæ¶ˆæ¯ï¼ˆå°†ç»“æœæ¶ˆæ¯å¯¹è±¡åºåˆ—åŒ–ï¼‰; æœåŠ¡ç«¯é€šè¿‡æ’åº§å°†æ¶ˆæ¯å‘é€åˆ°å®¢æˆ·ç«¯; å®¢æˆ·ç«¯stubæ¥æ”¶åˆ°ç»“æœæ¶ˆæ¯ï¼Œå¹¶è¿›è¡Œè§£ç ï¼ˆå°†ç»“æœæ¶ˆæ¯å‘åºåˆ—åŒ–ï¼‰; å®¢æˆ·ç«¯å¾—åˆ°æœ€ç»ˆç»“æœã€‚ è¿™å°±æ˜¯ä¸€ä¸ªå®ŒæˆPRCè°ƒç”¨è¿‡ç¨‹ï¼Œå¯¹ä½¿ç”¨æ–¹è€Œè¨€å°±åªæš´éœ²äº†æœ¬åœ°ä»£ç†å¯¹è±¡ï¼Œå‰©ä¸‹çš„æ•°æ®è§£æã€è¿è¾“ç­‰éƒ½è¢«åŒ…è£…äº†ï¼Œä»æœåŠ¡æä¾›æ–¹çš„è§’åº¦çœ‹è¿˜æœ‰æœåŠ¡æš´éœ²ï¼Œå¦‚ä¸‹æ˜¯Dubboçš„æ¶æ„å›¾ï¼š ç®€æ˜“RPCå®ç° é¡¹ç›®ç›®å½• MethodParameterå¯¹è±¡ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package com.springboot.whb.study.rpc.rpc_v1;import com.alibaba.fastjson.JSON;import lombok.Data;import java.io.InputStream;import java.io.ObjectInputStream;/** * @author: whb * @description: è¯·æ±‚å¯¹è±¡ */@Datapublic class MethodParameter { /** * ç±»å */ private String className; /** * æ–¹æ³•å */ private String methodName; /** * å‚æ•° */ private Object[] arguments; /** * å‚æ•°ç±»å‹ */ private Class&lt;?&gt;[] parameterTypes; @Override public String toString() { return JSON.toJSONString(this); } /** * ä»è¾“å…¥æµä¸­è¯»å–å‡ºç±»åã€æ–¹æ³•åã€å‚æ•°ç­‰æ•°æ®ç»„è£…æˆä¸€ä¸ªMethodParameter * * @param inputStream * @return */ public static MethodParameter convert(InputStream inputStream) { try { ObjectInputStream input = new ObjectInputStream(inputStream); String className = input.readUTF(); String methodName = input.readUTF(); Class&lt;?&gt;[] parameterTypes = (Class&lt;?&gt;[]) input.readObject(); Object[] arguments = (Object[]) input.readObject(); MethodParameter methodParameter = new MethodParameter(); methodParameter.setClassName(className); methodParameter.setMethodName(methodName); methodParameter.setArguments(arguments); methodParameter.setParameterTypes(parameterTypes); return methodParameter; } catch (Exception e) { throw new RuntimeException("è§£æè¯·æ±‚é”™è¯¯ï¼š{}", e); } }} æœåŠ¡ç«¯-æœåŠ¡æš´éœ² 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253package com.springboot.whb.study.rpc.rpc_v1;import com.springboot.whb.study.rpc.rpc_v1.MethodParameter;import java.lang.reflect.Method;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: æœåŠ¡ç«¯æš´éœ² * æœåŠ¡æš´éœ²å­˜å‚¨åœ¨objectMapå¯¹è±¡ä¸­ï¼Œæ‰€æœ‰å¯å¯¹æä¾›çš„æœåŠ¡éƒ½å¿…é¡»æ·»åŠ åˆ°è¯¥å®¹å™¨ä¸­ï¼Œä»¥ä¾¿äºæ”¶åˆ°ç½‘ç»œæ•°æ®åèƒ½æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œç„¶åé‡‡ç”¨åå°„invokeè°ƒç”¨ï¼Œè¿”å›å¾—åˆ°çš„ç»“æœã€‚ */public class RpcExploreService { private Map&lt;String, Object&gt; objectMap = new HashMap&lt;&gt;(); /** * å¯å¯¹å¤–æä¾›çš„æœåŠ¡ * * @param className * @param object */ public void explore(String className, Object object) { objectMap.put(className, object); } /** * é‡‡ç”¨åå°„è¿›è¡Œè°ƒç”¨ * * @param methodParameter * @return */ public Object invoke(MethodParameter methodParameter) { Object object = objectMap.get(methodParameter.getClassName()); if (object == null) { throw new RuntimeException("æ— å¯¹åº”çš„æ‰§è¡Œç±»ï¼šã€" + methodParameter.getClassName() + "ã€‘"); } Method method = null; try { method = object.getClass().getMethod(methodParameter.getMethodName(), methodParameter.getParameterTypes()); } catch (NoSuchMethodException e) { throw new RuntimeException("æ‰§è¡Œç±»ï¼šã€" + methodParameter.getClassName() + "ã€‘æ— å¯¹åº”çš„æ‰§è¡Œæ–¹æ³•ï¼šã€" + methodParameter.getMethodName() + "ã€‘"); } try { Object result = method.invoke(object, methodParameter.getArguments()); System.out.println(methodParameter); return result; } catch (Exception e) { throw new RuntimeException("invokeæ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼š" + e.getMessage()); } }} æœåŠ¡ç«¯-ç½‘ç»œæ•°æ®å¤„ç† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394package com.springboot.whb.study.rpc.rpc_v1;import com.google.common.base.Joiner;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.io.IOException;import java.io.InputStream;import java.io.ObjectOutputStream;import java.io.OutputStream;import java.net.ServerSocket;import java.net.Socket;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: æœåŠ¡ç«¯-ç½‘ç»œæ•°æ®å¤„ç† * ç®€å•çš„BIOæ¨¡å‹ï¼Œå¼€å¯äº†ä¸€ä¸ªServerSocketåï¼Œæ¥æ”¶åˆ°æ•°æ®åå°±å°†å¥—æ¥å­—ä¸¢ç»™ä¸€ä¸ªæ–°çš„çº¿ç¨‹å¤„ç†ï¼ŒServerSocketRunnableæ¥æ”¶ä¸€ä¸ªsocketä¹‹åï¼Œ * è§£æå‡ºMethodParameterè¯·æ±‚å¯¹è±¡ï¼Œç„¶åè°ƒç”¨æœåŠ¡æš´éœ²çš„Invokeæ–¹æ³•ï¼Œå†å†™å›socketä¼ è¾“ç»™å®¢æˆ·ç«¯ã€‚ */public class IOService implements Runnable { private int port; private ServerSocket serverSocket; private RpcExploreService rpcExploreService; ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("thread-pool-", "%s")).build()); private volatile boolean flag; public IOService(RpcExploreService rpcExploreService, int port) throws IOException { this.rpcExploreService = rpcExploreService; this.port = port; this.serverSocket = new ServerSocket(port); this.flag = true; System.out.println("******æœåŠ¡ç«¯å¯åŠ¨äº†********"); //ä¼˜é›…å…³é—­ Runtime.getRuntime().addShutdownHook(new Thread(() -&gt; { flag = false; System.out.println("+++++æœåŠ¡ç«¯å…³é—­äº†+++++"); })); } @Override public void run() { while (true) { Socket socket = null; try { socket = serverSocket.accept(); } catch (IOException e) { } if (socket == null) { continue; } threadPoolExecutor.execute(new ServerSocketRunnable(socket)); } } class ServerSocketRunnable implements Runnable { private Socket socket; public ServerSocketRunnable(Socket socket) { this.socket = socket; } @Override public void run() { try { InputStream inputStream = socket.getInputStream(); OutputStream outputStream = socket.getOutputStream(); MethodParameter methodParameter = MethodParameter.convert(inputStream); Object result = rpcExploreService.invoke(methodParameter); ObjectOutputStream output = new ObjectOutputStream(outputStream); output.writeObject(result); } catch (Exception e) { e.printStackTrace(); } finally { if (socket != null) { try { socket.close(); } catch (Exception e) { e.printStackTrace(); } } } } }} å®¢æˆ·ç«¯-æœåŠ¡è®¢é˜… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667package com.springboot.whb.study.rpc.rpc_v1;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;import java.util.HashMap;import java.util.Map;/** * @author: whb * @description: å®¢æˆ·ç«¯-æœåŠ¡è®¢é˜… * æœåŠ¡ä½¿ç”¨æ–¹éœ€è¦ä½¿ç”¨registerè¿›è¡ŒæœåŠ¡çš„æ³¨å†Œï¼Œä¼šç”Ÿæˆå¯¹åº”çš„æœ¬åœ°ä»£ç†å¯¹è±¡ï¼Œåç»­åªéœ€è¦é€šè¿‡æœ¬åœ°ä»£ç†å¯¹è±¡ã€‚ */public class RpcUsedService { private Map&lt;String, Object&gt; proxyObejctMap = new HashMap&lt;&gt;(); private Map&lt;String, Class&gt; classMap = new HashMap&lt;&gt;(); private IOClient ioClient; public void setIoClient(IOClient ioClient) { this.ioClient = ioClient; } /** * æœåŠ¡æ³¨å†Œ * * @param clazz */ public void register(Class clazz) { String className = clazz.getName(); classMap.put(className, clazz); if (!clazz.isInterface()) { throw new RuntimeException("æš‚æ—¶åªæ”¯æŒæ¥å£ç±»å‹çš„"); } try { RpcInvocationHandler handler = new RpcInvocationHandler(); handler.setClazz(clazz); Object proxyInstance = Proxy.newProxyInstance(clazz.getClassLoader(), new Class&lt;?&gt;[]{clazz}, handler); proxyObejctMap.put(className, proxyInstance); } catch (Exception e) { e.printStackTrace(); } } public &lt;T&gt; T get(Class&lt;T&gt; clazz) { String className = clazz.getName(); return (T) proxyObejctMap.get(className); } class RpcInvocationHandler implements InvocationHandler { private Class clazz; public void setClazz(Class clazz) { this.clazz = clazz; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { MethodParameter methodParameter = new MethodParameter(); methodParameter.setClassName(clazz.getName()); methodParameter.setMethodName(method.getName()); methodParameter.setArguments(args); methodParameter.setParameterTypes(method.getParameterTypes()); return ioClient.invoke(methodParameter); } }} å®¢æˆ·ç«¯-ç½‘ç»œå¤„ç† 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.springboot.whb.study.rpc.rpc_v1;import java.io.*;import java.net.Socket;/** * @author: whb * @description: å®¢æˆ·ç«¯-ç½‘ç»œå¤„ç† * ä»£ç†å¯¹è±¡è¢«è°ƒç”¨åç”Ÿæˆä¸€ä¸ªMethodParameterå¯¹è±¡ï¼Œé€šè¿‡æ­¤IOClientæŠŠæ•°æ®ä¼ è¾“åˆ°æœåŠ¡ç«¯ï¼Œå¹¶ä¸”è¿”å›å¯¹åº”çš„æ•°æ®ã€‚ */public class IOClient { private String ip; private int port; public IOClient(String ip, int port) { this.ip = ip; this.port = port; } public Object invoke(MethodParameter methodParameter) { Socket socket = null; try { socket = new Socket(ip, port); OutputStream outputStream = socket.getOutputStream(); ObjectOutputStream output = new ObjectOutputStream(outputStream); output.writeUTF(methodParameter.getClassName()); output.writeUTF(methodParameter.getMethodName()); output.writeObject(methodParameter.getParameterTypes()); output.writeObject(methodParameter.getArguments()); InputStream inputStream = socket.getInputStream(); ObjectInputStream input = new ObjectInputStream(inputStream); return input.readObject(); } catch (Exception e) { System.out.println(e.getMessage()); } finally { if (socket != null) { try { socket.close(); } catch (IOException e) { throw new RuntimeException("socketå…³é—­å¤±è´¥"); } } } return null; }} å®è·µ-æœåŠ¡ç«¯ 1234567891011121314151617181920212223package com.springboot.whb.study.rpc.rpc_v1;import com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorldImpl;/** * @author: whb * @description: æœåŠ¡ç«¯ */public class Service { public static void main(String[] args) { RpcExploreService rpcExploreService = new RpcExploreService(); //ä¼ å…¥çš„å­—ç¬¦ä¸²æ˜¯æ¥å£çš„å…¨åç§° rpcExploreService.explore("com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorld", new HelloWorldImpl()); try { //å¼€å¯11111ç«¯å£ç›‘å¬æœåŠ¡ Runnable ioService = new IOService(rpcExploreService, 11111); new Thread(ioService).start(); } catch (Exception e) { } }} å®è·µ-å®¢æˆ·ç«¯ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.springboot.whb.study.rpc.rpc_v1;import com.google.common.base.Joiner;import com.springboot.whb.study.rpc.rpc_v1.expore.HelloWorld;import org.apache.commons.lang3.concurrent.BasicThreadFactory;import java.util.Random;import java.util.concurrent.ArrayBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: å®¢æˆ·ç«¯ */public class Client { public static final ThreadPoolExecutor threadPoolExecutor = new ThreadPoolExecutor(10, 100, 60, TimeUnit.SECONDS, new ArrayBlockingQueue&lt;Runnable&gt;(1000), new BasicThreadFactory.Builder().namingPattern(Joiner.on("-").join("client-thread-pool-", "%s")).build()); public static void main(String[] args) { RpcUsedService rpcUsedService = new RpcUsedService(); rpcUsedService.register(HelloWorld.class); try { IOClient ioClient = new IOClient("127.0.0.1", 11111); //ç½‘ç»œå¥—æ¥å­—è¿æ¥ åŒä¸Šæ˜¯10001ç«¯å£ rpcUsedService.setIoClient(ioClient); HelloWorld helloWorld = rpcUsedService.get(HelloWorld.class); //ç”Ÿæˆçš„æœ¬åœ°ä»£ç†å¯¹è±¡ proxy for (int i = 0; i &lt; 100; i++) { threadPoolExecutor.execute(() -&gt; { long start = System.currentTimeMillis(); int a = new Random().nextInt(100); int b = new Random().nextInt(100); int c = helloWorld.add(a, b); // .add æ“ä½œå°±æ˜¯å±è”½äº†æ‰€æœ‰çš„ç»†èŠ‚ï¼Œæä¾›ç»™å®¢æˆ·ç«¯ä½¿ç”¨çš„æ–¹æ³• System.out.println("a: " + a + ", b:" + b + ", c=" + c + ", è€—æ—¶:" + (System.currentTimeMillis() - start)); }); } } catch (Exception e) { throw new RuntimeException("å®¢æˆ·ç«¯æ‰§è¡Œå‡ºé”™:{}", e); } finally { threadPoolExecutor.shutdown(); } }} æœåŠ¡æ¥å£ 12345678910package com.springboot.whb.study.rpc.rpc_v1.expore;/** * @author: whb * @description: æ¥å£å®šä¹‰ */public interface HelloWorld { int add(int a, int b);} æœåŠ¡æ¥å£å®ç° 123456789101112131415161718192021222324package com.springboot.whb.study.rpc.rpc_v1.expore;import java.util.Random;/** * @author: whb * @description: æ¥å£å®ç°ç±» */public class HelloWorldImpl implements HelloWorld { @Override public int add(int a, int b) { long start = System.currentTimeMillis(); try { Thread.sleep(new Random().nextInt(10000)); // æ•…æ„æ·»åŠ äº†è€—æ—¶æ“ä½œï¼Œä»¥ä¾¿äºæ¨¡æ‹ŸçœŸå®çš„è°ƒç”¨æ“ä½œ } catch (InterruptedException e) { e.printStackTrace(); } int c = a + b; System.out.println(Thread.currentThread().getName() + " è€—æ—¶:" + (System.currentTimeMillis() - start)); return c; }} è¿è¡Œæ•ˆæœ æ€»ç»“ è¿™åªæ˜¯ä¸€ä¸ªéå¸¸ç®€å•çš„RPCå®è·µï¼ŒåŒ…å«äº†æœåŠ¡æš´éœ²ã€æœåŠ¡æ³¨å†Œï¼ˆProxyç”Ÿæˆï¼‰ã€BIOæ¨¡å‹è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œjavaé»˜è®¤çš„åºåˆ—åŒ–æ–¹æ³•ï¼Œå¯¹RPCæœ‰ä¸€ä¸ªåˆæ­¥çš„è®¤è¯†å’Œäº†è§£ï¼ŒçŸ¥é“RPCå¿…é¡»åŒ…å«çš„æ¨¡å—ã€‚ ä¸è¿‡è¿˜æ˜¯æœ‰å¾ˆå¤šéœ€è¦ä¼˜åŒ–çš„ç‚¹ä»¥æ”¹è¿›ï¼š IOæ¨¡å‹ï¼šä½¿ç”¨çš„æ˜¯BIOæ¨¡å‹ï¼Œå¯ä»¥æ”¹è¿›æ¢æˆNIOæ¨¡å‹ï¼Œå¼•å…¥netty; æ± åŒ–ï¼šä¸è¦éšæ„æ–°å»ºçº¿ç¨‹ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½åº”æœ‰çº¿ç¨‹æ± ç»Ÿä¸€ç®¡ç†; æœåŠ¡å‘ç°ï¼šæœ¬åœ°æ¨¡æ‹Ÿçš„å°demoï¼Œå¹¶æ²¡æœ‰æœåŠ¡å‘ç°ï¼Œå¯ä»¥é‡‡ç”¨zkç®¡ç†; åºåˆ—åŒ–ï¼šjavaæœ¬èº«è‡ªå¸¦çš„åºåˆ—åŒ–æ•ˆç‡å¾ˆä½ï¼Œå¯ä»¥æ¢æˆHessianï¼ˆDUBBOé»˜è®¤é‡‡ç”¨å…¶ä½œä¸ºåºåˆ—åŒ–å·¥å…·ï¼‰ã€Protobufï¼ˆProtobufæ˜¯ç”±Googleæå‡ºçš„ä¸€ç§æ”¯æŒå¤šè¯­è¨€çš„è·¨å¹³å°çš„åºåˆ—åŒ–æ¡†æ¶ï¼‰ç­‰; è¿˜æœ‰ä¾‹å¦‚æœåŠ¡ç»Ÿè®¡ã€ä¼˜é›…ä¸‹çº¿ã€è´Ÿè½½å‡è¡¡ç­‰ä¹Ÿéƒ½æ˜¯ä¸€ä¸ªæˆç†Ÿçš„RPCæ¡†æ¶å¿…é¡»è¦è€ƒè™‘åˆ°çš„ç‚¹ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>RPC</category>
      </categories>
      <tags>
        <tag>RPC</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ­å»ºåšå®¢å¸¸è§é—®é¢˜]]></title>
    <url>%2Fposts%2F5b526bb.html</url>
    <content type="text"><![CDATA[No Layout:index.html é—®é¢˜æè¿° æœ€è¿‘å¯¹Hexoä»¥åŠNextä¸»é¢˜åšäº†å‡çº§ï¼Œå‡çº§ä¹‹ååœ¨æ‰§è¡Œhexo gç¼–è¯‘æ—¶å‡ºç°äº†No layout:index.htmlçš„é”™è¯¯ï¼Œå¦‚ä¸‹å›¾ï¼š è§£å†³æ€è·¯ æŸ¥çœ‹hexoæ’ä»¶å®‰è£…æƒ…å†µï¼Œå› å†…å®¹è¾ƒå¤šï¼Œåªéƒ¨åˆ†æˆªå›¾ï¼š 1npm ls --depth 0 hexoçš„ä¸€äº›æ’ä»¶æœªå®‰è£… 12npm ERR! peer dep missing: eslint@&gt;= 4.12.1, required by babel-eslint@10.0.3npm ERR! peer dep missing: eslint@&gt;= 4.12.1, required by babel-eslint@10.0.3 é€ä¸€å®‰è£…ç¼ºå¤±çš„æ’ä»¶ 1npm install eslint --save æ‰§è¡Œnpm installåï¼Œæ‰§è¡Œnpm audit fix è®¿é—®Hexoåšå®¢å‡ºç°â€œCannot GET/xxxâ€é”™è¯¯ é—®é¢˜æè¿° åœ¨Hexoåšå®¢ä¸­ï¼Œå‡ºç°Cannot GET/xxxé”™è¯¯ä¾¿æ„å‘³ç€xxxæ–‡ä»¶æœªè¢«æ‰¾åˆ°ã€‚ Cannot GET/xxxé”™è¯¯æœ¬è´¨æ˜¯hexo serverè¿”å›çš„ä¸€ä¸ª404é”™è¯¯ã€‚ è§£å†³æ€è·¯ åˆ¤æ–­publicç›®å½•ä¸‹xxxæ–‡ä»¶æ˜¯å¦å­˜åœ¨ã€‚ å¦‚æœè¯´xxx.htmlä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‰§è¡Œhexo cï¼Œhexo gé‡æ–°ç”Ÿæˆä¸€æ¬¡ï¼Œå›åˆ°æ­¥éª¤1ã€‚ æ­¥éª¤2æ‰§è¡Œå®Œåxxx.htmlä»ä¸å­˜åœ¨ï¼Œæ‰§è¡Œnpm audit fixï¼ŒæŸ¥çœ‹æ˜¯å¦å°‘äº†ä»€ä¹ˆç»„ä»¶ï¼Œé€šè¿‡npm install hexo-xxx-xxx å®‰è£…å³å¯ã€‚ æ­¥éª¤3å®Œæˆä¹‹åï¼Œæ‰§è¡Œhexo cï¼Œhexo gé‡æ–°ç”Ÿæˆé™æ€æ–‡ä»¶ã€‚ ä»ç„¶æœ‰é—®é¢˜ï¼Œè¯·å†å‚è€ƒæ­¤æ–‡ï¼šhttps://www.cnblogs.com/Sroot/p/6305938.html document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“ã€ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜]]></title>
    <url>%2Fposts%2Fe755a8c.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åªè¦ç”¨ç¼“å­˜ï¼Œå°±å¯èƒ½ä¼šæ¶‰åŠåˆ°ç¼“å­˜ä¸æ•°æ®åº“åŒå­˜å‚¨åŒå†™ï¼Œåªè¦æ˜¯åŒå†™ï¼Œå°±ä¸€å®šä¼šæœ‰æ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œå¦‚ä½•ä¿è¯ç¼“å­˜ä¸æ•°æ®åº“çš„åŒå†™ä¸€è‡´æ€§ï¼Ÿ è¯»å†™ä¸²è¡ŒåŒ– ä¸€èˆ¬æ¥è¯´ï¼Œå¦‚æœå…è®¸ç¼“å­˜å¯ä»¥ç¨å¾®è·Ÿæ•°æ®åº“å¶å°”æœ‰ä¸ä¸€è‡´ï¼Œä¹Ÿå°±æ˜¯è¯´ç³»ç»Ÿä¸æ˜¯ä¸¥æ ¼è¦æ±‚ç¼“å­˜+æ•°æ®åº“å¿…é¡»ä¿æŒä¸€è‡´æ€§çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨è¯»å†™è¯·æ±‚ä¸²è¡ŒåŒ–ï¼š å³è¯»è¯·æ±‚å’Œå†™è¯·æ±‚ä¸²åˆ°ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œå»ï¼Œä»è€Œè¾¾åˆ°é˜²æ­¢å¹¶å‘è¯·æ±‚å¯¼è‡´æ•°æ®é”™ä¹±çš„é—®é¢˜ã€‚ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œä¸²è¡ŒåŒ–å¯ä»¥ä¿è¯ä¸€å®šä¸ä¼šå‡ºç°ä¸ä¸€è‡´çš„æƒ…å†µï¼Œä½†æ˜¯å®ƒä¹Ÿä¼šå¯¼è‡´ç³»ç»Ÿçš„ååé‡å¤§å¹…åº¦é™ä½ã€‚ ä»£ç å®ç°å¤§è‡´å¦‚ä¸‹ï¼ˆç½‘ä¸Šæ‰¾çš„ï¼‰ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * è¯·æ±‚å¼‚æ­¥å¤„ç†çš„serviceå®ç° * @author Administrator * */@Service("requestAsyncProcessService") public class RequestAsyncProcessServiceImpl implements RequestAsyncProcessService { @Override public void process(Request request) { try { // å…ˆåšè¯»è¯·æ±‚çš„å»é‡ RequestQueue requestQueue = RequestQueue.getInstance(); Map&lt;Integer, Boolean&gt; flagMap = requestQueue.getFlagMap(); if(request instanceof ProductInventoryDBUpdateRequest) { // å¦‚æœæ˜¯ä¸€ä¸ªæ›´æ–°æ•°æ®åº“çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±å°†é‚£ä¸ªproductIdå¯¹åº”çš„æ ‡è¯†è®¾ç½®ä¸ºtrue flagMap.put(request.getProductId(), true); } else if(request instanceof ProductInventoryCacheRefreshRequest) { Boolean flag = flagMap.get(request.getProductId()); // å¦‚æœflagæ˜¯null if(flag == null) { flagMap.put(request.getProductId(), false); } // å¦‚æœæ˜¯ç¼“å­˜åˆ·æ–°çš„è¯·æ±‚ï¼Œé‚£ä¹ˆå°±åˆ¤æ–­ï¼Œå¦‚æœæ ‡è¯†ä¸ä¸ºç©ºï¼Œè€Œä¸”æ˜¯trueï¼Œå°±è¯´æ˜ä¹‹å‰æœ‰ä¸€ä¸ªè¿™ä¸ªå•†å“çš„æ•°æ®åº“æ›´æ–°è¯·æ±‚ if(flag != null &amp;&amp; flag) { flagMap.put(request.getProductId(), false); } // å¦‚æœæ˜¯ç¼“å­˜åˆ·æ–°çš„è¯·æ±‚ï¼Œè€Œä¸”å‘ç°æ ‡è¯†ä¸ä¸ºç©ºï¼Œä½†æ˜¯æ ‡è¯†æ˜¯false // è¯´æ˜å‰é¢å·²ç»æœ‰ä¸€ä¸ªæ•°æ®åº“æ›´æ–°è¯·æ±‚+ä¸€ä¸ªç¼“å­˜åˆ·æ–°è¯·æ±‚äº†ï¼Œå¤§å®¶æƒ³ä¸€æƒ³ if(flag != null &amp;&amp; !flag) { // å¯¹äºè¿™ç§è¯»è¯·æ±‚ï¼Œç›´æ¥å°±è¿‡æ»¤æ‰ï¼Œä¸è¦æ”¾åˆ°åé¢çš„å†…å­˜é˜Ÿåˆ—é‡Œé¢å»äº† return; } } // åšè¯·æ±‚çš„è·¯ç”±ï¼Œæ ¹æ®æ¯ä¸ªè¯·æ±‚çš„å•†å“idï¼Œè·¯ç”±åˆ°å¯¹åº”çš„å†…å­˜é˜Ÿåˆ—ä¸­å» ArrayBlockingQueue&lt;Request&gt; queue = getRoutingQueue(request.getProductId()); // å°†è¯·æ±‚æ”¾å…¥å¯¹åº”çš„é˜Ÿåˆ—ä¸­ï¼Œå®Œæˆè·¯ç”±æ“ä½œ queue.put(request); } catch (Exception e) { e.printStackTrace(); } } /** * è·å–è·¯ç”±åˆ°çš„å†…å­˜é˜Ÿåˆ— * @param productId å•†å“id * @return å†…å­˜é˜Ÿåˆ— */ private ArrayBlockingQueue&lt;Request&gt; getRoutingQueue(Integer productId) { RequestQueue requestQueue = RequestQueue.getInstance(); // å…ˆè·å–productIdçš„hashå€¼ String key = String.valueOf(productId); int h; int hash = (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); // å¯¹hashå€¼å–æ¨¡ï¼Œå°†hashå€¼è·¯ç”±åˆ°æŒ‡å®šçš„å†…å­˜é˜Ÿåˆ—ä¸­ï¼Œæ¯”å¦‚å†…å­˜é˜Ÿåˆ—å¤§å°8 // ç”¨å†…å­˜é˜Ÿåˆ—çš„æ•°é‡å¯¹hashå€¼å–æ¨¡ä¹‹åï¼Œç»“æœä¸€å®šæ˜¯åœ¨0~7ä¹‹é—´ // æ‰€ä»¥ä»»ä½•ä¸€ä¸ªå•†å“idéƒ½ä¼šè¢«å›ºå®šè·¯ç”±åˆ°åŒæ ·çš„ä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­å»çš„ int index = (requestQueue.queueSize() - 1) &amp; hash; System.out.println("===========æ—¥å¿—===========: è·¯ç”±å†…å­˜é˜Ÿåˆ—ï¼Œå•†å“id=" + productId + ", é˜Ÿåˆ—ç´¢å¼•=" + index); return requestQueue.getQueue(index); }} Cache Aside Pattern Cache Aside Pattenï¼šç»å…¸çš„ç¼“å­˜+æ•°æ®åº“è¯»å†™æ¨¡å¼ã€‚ è¯»çš„æ—¶å€™ï¼Œå…ˆè¯»ç¼“å­˜ï¼Œç¼“å­˜æ²¡æœ‰çš„è¯ï¼Œå°±è¯»æ•°æ®åº“ï¼Œç„¶åå–å‡ºæ•°æ®åæ”¾å…¥ç¼“å­˜ï¼ŒåŒæ—¶è¿”å›å“åº”ã€‚æ›´æ–°çš„æ—¶å€™ï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œç„¶åå†æ›´æ–°æ•°æ®åº“ã€‚ ä¸ºä»€ä¹ˆæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè€Œä¸æ˜¯æ›´æ–°ç¼“å­˜ï¼Ÿ ä¹‹æ‰€ä»¥æ›´æ–°çš„æ—¶å€™åªæ˜¯åˆ é™¤ç¼“å­˜ï¼Œå› ä¸ºå¯¹äºä¸€äº›å¤æ‚æœ‰é€»è¾‘çš„ç¼“å­˜æ•°æ®ï¼Œæ¯æ¬¡æ•°æ®å˜æ›´éƒ½æ›´æ–°ä¸€æ¬¡ç¼“å­˜ä¼šé€ æˆé¢å¤–çš„è´Ÿæ‹…ï¼Œåªæ˜¯åˆ é™¤ç¼“å­˜ï¼Œè®©è¯¥æ•°æ®ä¸‹ä¸€æ¬¡è¢«ä½¿ç”¨çš„æ—¶å€™å†å»æ‰§è¡Œè¯»çš„æ“ä½œæ¥é‡æ–°ç¼“å­˜ï¼Œè¿™é‡Œé‡‡ç”¨çš„æ˜¯æ‡’åŠ è½½çš„ç­–ç•¥ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä¸€ä¸ªç¼“å­˜æ¶‰åŠçš„è¡¨çš„å­—æ®µï¼Œåœ¨1åˆ†é’Ÿå†…å°±ä¿®æ”¹äº†20æ¬¡ï¼Œæˆ–è€…æ˜¯100æ¬¡ï¼Œé‚£ä¹ˆç¼“å­˜æ›´æ–°20æ¬¡ï¼Œ100æ¬¡;ä½†æ˜¯è¿™ä¸ªç¼“å­˜åœ¨1åˆ†é’Ÿå†…å°±è¢«è¯»å–äº†1æ¬¡ï¼Œå› æ­¤æ¯æ¬¡æ›´æ–°ç¼“å­˜å°±ä¼šæœ‰å¤§é‡çš„å†·æ•°æ®ï¼Œå¯¹äºç¼“å­˜ç¬¦åˆ28é»„é‡‘æ³•åˆ™ï¼Œ20%çš„æ•°æ®ï¼Œå ç”¨äº†80%çš„è®¿é—®é‡ã€‚ æœ€åˆçº§çš„ç¼“å­˜ä¸ä¸€è‡´é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ é—®é¢˜ï¼š å…ˆä¿®æ”¹æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ã€‚å¦‚æœåˆ é™¤ç¼“å­˜å¤±è´¥äº†ï¼Œé‚£ä¹ˆå¯¼è‡´æ•°æ®åº“ä¸­æ˜¯æ–°æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯æ—§æ•°æ®ï¼Œæ•°æ®å°±ä¼šå‡ºç°ä¸ä¸€è‡´æ€§ã€‚ è§£å†³æ€è·¯ï¼š å…ˆåˆ é™¤ç¼“å­˜ï¼Œå†ä¿®æ”¹æ•°æ®åº“ã€‚å¦‚æœæ•°æ®åº“ä¿®æ”¹å¤±è´¥äº†ï¼Œé‚£ä¹ˆæ•°æ®åº“ä¸­æ˜¯æ—§æ•°æ®ï¼Œç¼“å­˜ä¸­æ˜¯ç©ºçš„ï¼Œé‚£ä¹ˆæ•°æ®å°±ä¸ä¼šä¸ä¸€è‡´ã€‚ å› ä¸ºè¯»çš„æ—¶å€™ç¼“å­˜ä¸­æ²¡æœ‰ï¼Œåˆ™è¯»æ•°æ®åº“ä¸­çš„æ—§æ•°æ®ï¼Œç„¶åå†æ›´æ–°åˆ°ç¼“å­˜ä¸­ã€‚ æ¯”è¾ƒå¤æ‚çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ é—®é¢˜ï¼š æ•°æ®å‘ç”Ÿäº†å˜æ›´ï¼Œå…ˆåˆ é™¤äº†ç¼“å­˜ï¼Œç„¶åè¦å»ä¿®æ”¹æ•°æ®åº“ï¼Œä½†æ˜¯è¿˜æ²¡æ¥å¾—åŠä¿®æ”¹ï¼Œä¸€ä¸ªè¯·æ±‚è¿‡æ¥ï¼Œå»è¯»ç¼“å­˜ï¼Œå‘ç°ç¼“å­˜æ˜¯ç©ºçš„ï¼Œå»æŸ¥è¯¢æ•°æ®åº“ï¼ŒæŸ¥åˆ°äº†ä¿®æ”¹å‰çš„æ—§æ•°æ®ï¼Œæ”¾åˆ°äº†ç¼“å­˜ä¸­ï¼Œ éšåæ•°æ®å˜æ›´çš„ç¨‹åºå®Œæˆäº†æ•°æ®åº“çš„ä¿®æ”¹ï¼Œè¿™æ ·å°±ä¼šé€ æˆæ•°æ®åº“å’Œç¼“å­˜ä¸­çš„æ•°æ®ä¸ä¸€è‡´ã€‚ è§£å†³æ€è·¯ï¼š æ›´æ–°æ•°æ®çš„æ—¶å€™ï¼Œæ ¹æ®æ•°æ®çš„å”¯ä¸€æ ‡è¯†ï¼Œå°†æ“ä½œè·¯ç”±åˆ°ä¸€ä¸ªJVMçš„å†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚è¯»å–æ•°æ®çš„æ—¶å€™ï¼Œå¦‚æœå‘ç°æ•°æ®ä¸åœ¨ç¼“å­˜ä¸­ï¼Œé‚£ä¹ˆå°†é‡æ–°è¯»å–æ•°æ®+æ›´æ–°ç¼“å­˜çš„æ“ä½œï¼Œæ ¹æ®å”¯ä¸€æ ‡è¯†è·¯ç”±ä¹‹åï¼Œä¹Ÿå‘é€åŒä¸€ä¸ªJVMå†…éƒ¨é˜Ÿåˆ—ä¸­ã€‚ ä¸€ä¸ªé˜Ÿåˆ—å¯¹åº”ä¸€ä¸ªå·¥ä½œçº¿ç¨‹ï¼Œæ¯ä¸ªå·¥ä½œçº¿ç¨‹ä¸²è¡Œæ‹¿åˆ°å¯¹åº”çš„æ“ä½œï¼Œç„¶åä¸€æ¡ä¸€æ¡çš„æ‰§è¡Œã€‚è¿™æ ·ï¼Œä¸€ä¸ªæ•°æ®å˜æ›´çš„æ“ä½œï¼Œå…ˆåˆ é™¤ç¼“å­˜ï¼Œå†å»æ›´æ–°æ•°æ®åº“ï¼Œä½†æ˜¯è¿˜æ²¡å®Œæˆæ›´æ–°ï¼Œæ­¤æ—¶ä¸€ä¸ª è¯»è¯·æ±‚è¿‡æ¥ï¼Œè¯»åˆ°äº†ç©ºçš„ç¼“å­˜ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆå°†ç¼“å­˜æ›´æ–°çš„è¯·æ±‚å‘é€çš„é˜Ÿåˆ—ä¸­ï¼Œæ­¤æ—¶ä¼šåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹ï¼Œç„¶ååŒæ­¥ç­‰å¾…ç¼“å­˜æ›´æ–°å®Œæˆã€‚ è¿™æ ·æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼šä¸€ä¸ªé˜Ÿåˆ—ä¸­å¤šä¸ªæ›´æ–°ç¼“å­˜çš„è¯·æ±‚ä¸²åœ¨ä¸€èµ·æ˜¯æ²¡æ„ä¹‰çš„ï¼Œå› æ­¤å¯ä»¥åšè¿‡æ»¤ã€‚å¦‚æœå‘ç°é˜Ÿåˆ—ä¸­å·²ç»æœ‰ä¸€ä¸ªæ›´æ–°ç¼“å­˜çš„è¯·æ±‚ï¼Œé‚£ä¹ˆä¸å†æ”¾æ›´æ–°ç¼“å­˜çš„è¯·æ±‚æ“ä½œè¿›å»ï¼Œç›´æ¥ç­‰å¾…å‰é¢çš„æ›´æ–°æ“ä½œå®Œæˆå³å¯ã€‚ å¾…é‚£ä¸ªé˜Ÿåˆ—å¯¹åº”çš„å·¥ä½œçº¿ç¨‹å®Œæˆäº†ä¸Šä¸€ä¸ªæ“ä½œçš„æ•°æ®åº“çš„ä¿®æ”¹ä¹‹åï¼Œæ‰ä¼šå»æ‰§è¡Œä¸‹ä¸€ä¸ªæ“ä½œï¼Œä¹Ÿå°±æ˜¯ç¼“å­˜æ›´æ–°çš„æ“ä½œï¼Œæ­¤æ—¶ä¼šä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°çš„å€¼ï¼Œç„¶åå†™å…¥ç¼“å­˜ä¸­ã€‚ å¦‚æœè¯·æ±‚è¿˜åœ¨ç­‰å¾…æ—¶é—´èŒƒå›´å†…ï¼Œä¸æ–­è½®è¯¢å‘ç°å¯ä»¥å–åˆ°å€¼äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ï¼›å¦‚æœè¯·æ±‚ç­‰å¾…çš„æ—¶é—´è¶…è¿‡ä¸€å®šæ—¶é•¿ï¼Œé‚£ä¹ˆè¿™ä¸€æ¬¡ç›´æ¥ä»æ•°æ®åº“ä¸­è¯»å–å½“å‰çš„æ—§å€¼ã€‚ é«˜å¹¶å‘åœºæ™¯ä¸‹ï¼Œè¯¥æ–¹æ¡ˆè¦æ³¨æ„å¦‚ä¸‹çš„é—®é¢˜ï¼š è¯»è¯·æ±‚é•¿æ—¶é˜»å¡ ç”±äºè¯»è¯·æ±‚è¿›è¡Œäº†éå¸¸è½»åº¦çš„å¼‚æ­¥åŒ–ï¼Œæ‰€ä»¥ä¸€å®šè¦æ³¨æ„è¯»è¶…æ—¶çš„é—®é¢˜ï¼Œæ¯ä¸ªè¯»è¯·æ±‚å¿…é¡»åœ¨è¶…æ—¶æ—¶é—´èŒƒå›´å†…è¿”å›ã€‚ è¯¥æ–¹æ¡ˆæœ€å¤§çš„é£é™©ç‚¹åœ¨äºï¼Œå¯èƒ½æ•°æ®æ›´æ–°å¾ˆé¢‘ç¹ï¼Œå¯¼è‡´é˜Ÿåˆ—ä¸­ç§¯å‹äº†å¤§é‡æ›´æ–°æ“ä½œåœ¨é‡Œé¢ï¼Œç„¶åè¯»è¯·æ±‚ä¼šå‘ç”Ÿå¤§é‡çš„è¶…æ—¶ï¼Œæœ€åå¯¼è‡´å¤§é‡çš„è¯·æ±‚ç›´æ¥èµ°æ•°æ®åº“ã€‚ æ‰€ä»¥åŠ¡å¿…é€šè¿‡ä¸€äº›æ¨¡æ‹ŸçœŸå®çš„æµ‹è¯•ï¼Œçœ‹çœ‹æ›´æ–°æ•°æ®çš„é¢‘ç‡æ˜¯æ€æ ·çš„ã€‚ å¦å¤–ä¸€ç‚¹ï¼Œå› ä¸ºä¸€ä¸ªé˜Ÿåˆ—ä¸­ï¼Œå¯èƒ½ä¼šç§¯å‹é’ˆå¯¹å¤šä¸ªæ•°æ®é¡¹çš„æ›´æ–°æ“ä½œï¼Œå› æ­¤éœ€è¦æ ¹æ®è‡ªå·±çš„ä¸šåŠ¡æƒ…å†µè¿›è¡Œæµ‹è¯•ï¼Œå¯èƒ½éœ€è¦éƒ¨ç½²å¤šä¸ªæœåŠ¡ï¼Œæ¯ä¸ªæœåŠ¡åˆ†æ‘Šä¸€äº›æ•°æ®çš„æ›´æ–°æ“ä½œã€‚ å¦‚æœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—é‡Œç§¯å‹ 100 ä¸ªå•†å“çš„åº“å­˜ä¿®æ”¹æ“ä½œï¼Œæ¯ä¸ªåº“å­˜ä¿®æ”¹æ“ä½œè¦è€—è´¹ 10ms å»å®Œæˆã€‚é‚£ä¹ˆæœ€åä¸€ä¸ªå•†å“çš„è¯»è¯·æ±‚ï¼Œå¯èƒ½ç­‰å¾… 10*100=1000ms=1s åï¼Œæ‰èƒ½å¾—åˆ°æ•°æ®ï¼Œè¿™ä¸ªæ—¶å€™å°±å¯¼è‡´è¯»è¯·æ±‚çš„é•¿æ—¶é˜»å¡ã€‚ å› æ­¤ï¼Œä¸€å®šè¦æ ¹æ®å®é™…ä¸šåŠ¡ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µï¼Œå»è¿›è¡Œä¸€äº›å‹åŠ›æµ‹è¯•å’Œæ¨¡æ‹Ÿçº¿ä¸Šç¯å¢ƒï¼Œçœ‹é«˜å³°æœŸï¼Œå†…å­˜é˜Ÿåˆ—å¯èƒ½ä¼šç§¯å‹å¤šå°‘æ›´æ–°æ“ä½œï¼Œå¯èƒ½ä¼šå¯¼è‡´æœ€åä¸€ä¸ªæ›´æ–°æ“ä½œå¯¹åº”çš„è¯»è¯·æ±‚ï¼Œä¼š Hang å¤šå°‘æ—¶é—´ã€‚ å¦‚æœè¯»è¯·æ±‚åœ¨ 200ms è¿”å›ï¼Œå“ªæ€•æ˜¯æœ€ç¹å¿™çš„æ—¶å€™ï¼Œç§¯å‹ 10 ä¸ªæ›´æ–°æ“ä½œï¼Œæœ€å¤šç­‰å¾… 200msï¼Œé‚£è¿˜å¯ä»¥çš„ã€‚ å¦‚æœä¸€ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­å¯èƒ½ç§¯å‹çš„æ›´æ–°æ“ä½œç‰¹åˆ«å¤šï¼Œé‚£å°±è¦åŠ æœºå™¨ï¼Œè®©æ¯ä¸ªæœºå™¨ä¸Šéƒ¨ç½²çš„æœåŠ¡å®ä¾‹å¤„ç†æ›´å°‘çš„æ•°æ®ï¼Œé‚£ä¹ˆæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ç§¯å‹çš„æ›´æ–°æ“ä½œå°±ä¼šè¶Šå°‘ã€‚ ä¸€èˆ¬æ¥è¯´ï¼Œæ•°æ®çš„å†™é¢‘ç‡æ˜¯å¾ˆä½çš„ï¼Œå› æ­¤å®é™…ä¸Šæ­£å¸¸æ¥è¯´ï¼Œåœ¨é˜Ÿåˆ—ä¸­ç§¯å‹çš„æ›´æ–°æ“ä½œåº”è¯¥æ˜¯å¾ˆå°‘çš„ã€‚åƒè¿™ç§é’ˆå¯¹è¯»é«˜å¹¶å‘ã€è¯»ç¼“å­˜æ¶æ„çš„é¡¹ç›®ï¼Œä¸€èˆ¬æ¥è¯´å†™è¯·æ±‚æ˜¯éå¸¸å°‘çš„ï¼Œæ¯ç§’çš„ QPS èƒ½åˆ°å‡ ç™¾å°±ä¸é”™äº†ã€‚ å®é™…ç²—ç•¥æµ‹ç®—ä¸€ä¸‹ï¼Œå¦‚æœä¸€ç§’æœ‰ 500 çš„å†™æ“ä½œï¼Œåˆ†æˆ 5 ä¸ªæ—¶é—´ç‰‡ï¼Œæ¯ 200ms å°± 100 ä¸ªå†™æ“ä½œï¼Œæ”¾åˆ° 20 ä¸ªå†…å­˜é˜Ÿåˆ—ä¸­ï¼Œæ¯ä¸ªå†…å­˜é˜Ÿåˆ—ï¼Œå¯èƒ½å°±ç§¯å‹ 5 ä¸ªå†™æ“ä½œã€‚ æ¯ä¸ªå†™æ“ä½œæ€§èƒ½æµ‹è¯•åï¼Œä¸€èˆ¬æ˜¯åœ¨ 20ms å·¦å³å°±å®Œæˆï¼Œé‚£ä¹ˆé’ˆå¯¹æ¯ä¸ªå†…å­˜é˜Ÿåˆ—çš„æ•°æ®çš„è¯»è¯·æ±‚ï¼Œä¹Ÿå°±æœ€å¤š Hang ä¸€ä¼šå„¿ï¼Œ200ms ä»¥å†…è‚¯å®šèƒ½è¿”å›äº†ã€‚ ç»è¿‡ç®€å•çš„æµ‹ç®—ï¼Œå•æœºæ”¯æ’‘çš„å†™ QPS åœ¨å‡ ç™¾æ˜¯æ²¡é—®é¢˜çš„ï¼Œå¦‚æœå†™ QPS æ‰©å¤§äº† 10 å€ï¼Œé‚£ä¹ˆå°±æ‰©å®¹æœºå™¨ï¼Œæ‰©å®¹ 10 å€çš„æœºå™¨ï¼Œæ¯ä¸ªæœºå™¨ 20 ä¸ªé˜Ÿåˆ—ã€‚ è¯»è¯·æ±‚å¹¶å‘é‡è¿‡é«˜ è¿™é‡Œè¿˜å¿…é¡»åšå¥½å‹åŠ›æµ‹è¯•ï¼Œç¡®ä¿æ°å·§ç¢°ä¸Šä¸Šè¿°æƒ…å†µæ—¶ï¼Œè¿˜æœ‰ä¸€ä¸ªé£é™©ï¼Œå°±æ˜¯çªç„¶é—´å¤§é‡è¯»è¯·æ±‚ä¼šåœ¨å‡ åæ¯«ç§’çš„å»¶æ—¶ Hang åœ¨æœåŠ¡ä¸Šï¼Œçœ‹æœåŠ¡èƒ½ä¸èƒ½æ‰›çš„ä½ï¼Œéœ€è¦å¤šå°‘æœºå™¨æ‰èƒ½æ‰›ä½æœ€å¤§çš„æé™æƒ…å†µçš„å³°å€¼ã€‚ ä½†æ˜¯å› ä¸ºå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ•°æ®éƒ½åœ¨åŒä¸€æ—¶é—´æ›´æ–°ï¼Œç¼“å­˜ä¹Ÿä¸ä¼šåŒä¸€æ—¶é—´å¤±æ•ˆï¼Œæ‰€ä»¥æ¯æ¬¡å¯èƒ½ä¹Ÿå°±æ˜¯å°‘æ•°æ•°æ®çš„ç¼“å­˜å¤±æ•ˆäº†ï¼Œç„¶åé‚£äº›æ•°æ®å¯¹åº”çš„è¯»è¯·æ±‚è¿‡æ¥ï¼Œå¹¶å‘é‡åº”è¯¥ä¹Ÿä¸ä¼šç‰¹åˆ«å¤§ã€‚ å¤šæœåŠ¡å®ä¾‹éƒ¨ç½²çš„è¯·æ±‚è·¯ç”± å¯èƒ½è¿™ä¸ªæœåŠ¡éƒ¨ç½²äº†å¤šä¸ªå®ä¾‹ï¼Œé‚£ä¹ˆå¿…é¡»ä¿è¯æ‰§è¡Œæ•°æ®æ›´æ–°æ“ä½œï¼Œä»¥åŠæ‰§è¡Œç¼“å­˜æ›´æ–°æ“ä½œçš„è¯·æ±‚ï¼Œéƒ½é€šè¿‡ Nginx æœåŠ¡å™¨è·¯ç”±åˆ°ç›¸åŒçš„æœåŠ¡å®ä¾‹ä¸Šã€‚ æ¯”å¦‚å¯¹åŒä¸€ä¸ªå•†å“çš„è¯»å†™è¯·æ±‚ï¼Œå…¨éƒ¨è·¯ç”±åˆ°åŒä¸€å°æœºå™¨ä¸Šã€‚å¯ä»¥è‡ªå·±å»åšæœåŠ¡é—´çš„æŒ‰ç…§æŸä¸ªè¯·æ±‚å‚æ•°çš„ Hash è·¯ç”±ï¼Œä¹Ÿå¯ä»¥ç”¨ Nginx çš„ Hash è·¯ç”±åŠŸèƒ½ç­‰ç­‰ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>ç¼“å­˜</category>
        <category>redis</category>
      </categories>
      <tags>
        <tag>ç¼“å­˜</tag>
        <tag>redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“å¸¸ç”¨æ¶æ„æ–¹æ¡ˆ]]></title>
    <url>%2Fposts%2F4c1379b8.html</url>
    <content type="text"><![CDATA[æ•°æ®åº“æ¶æ„åŸåˆ™ é«˜å¯ç”¨ é«˜æ€§èƒ½ ä¸€è‡´æ€§ æ‰©å±•æ€§ å¸¸è§çš„æ¶æ„æ–¹æ¡ˆ ä¸»å¤‡æ¶æ„ è¯¥æ–¹æ¡ˆåªæœ‰ä¸»åº“æä¾›è¯»å†™æœåŠ¡ï¼Œå¤‡åº“å†—ä½™ä½œæ•…éšœè½¬ç§»ã€‚ æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼šjdbc:mysql://vip:3306/xxdb é«˜å¯ç”¨åˆ†æï¼šé«˜å¯ç”¨ï¼Œä¸»åº“æŒ‚äº†ï¼Œkeepaliveï¼ˆä¸€ç§å·¥å…·ï¼‰ä¼šè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡åº“ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡å±‚æ˜¯é€æ˜çš„ï¼Œæ— éœ€ä¿®æ”¹ä»£ç æˆ–é…ç½®ã€‚ é«˜æ€§èƒ½åˆ†æï¼šè¯»å†™éƒ½æ“ä½œä¸»åº“ï¼Œå¾ˆå®¹æ˜“äº§ç”Ÿç“¶é¢ˆã€‚å¤§éƒ¨åˆ†äº’è”ç½‘åº”ç”¨è¯»å¤šå†™å°‘ï¼Œè¯»ä¼šå…ˆæˆä¸ºç“¶é¢ˆï¼Œè¿›è€Œå½±å“å†™æ€§èƒ½ã€‚å¦å¤–ï¼Œå¤‡åº“åªæ˜¯å•çº¯çš„å¤‡ä»½ï¼Œèµ„æºåˆ©ç”¨ç‡åªæœ‰50%ã€‚ ä¸€è‡´æ€§åˆ†æï¼šè¯»å†™éƒ½æ“ä½œä¸»åº“ï¼Œä¸å­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æï¼šæ— æ³•é€šè¿‡åŠ ä»åº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ å¯è½åœ°åˆ†æï¼šä¸¤ç‚¹å½±å“è½åœ°ï¼šç¬¬ä¸€ï¼Œæ€§èƒ½ä¸€èˆ¬ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡å»ºç«‹é«˜æ•ˆçš„ç´¢å¼•å’Œå¼•å…¥ç¼“å­˜æ¥å¢åŠ è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ€§èƒ½ã€‚è¿™ä¹Ÿæ˜¯é€šç”¨çš„æ–¹æ¡ˆã€‚ç¬¬äºŒï¼Œæ‰©å±•æ€§å·®ï¼Œè¿™ç‚¹å¯ä»¥é€šè¿‡åˆ†åº“åˆ†è¡¨æ¥æ‰©å±•ã€‚ åŒä¸»æ¶æ„ è¯¥æ–¹æ¡ˆï¼Œä¸¤ä¸ªä¸»åº“åŒæ—¶æä¾›æœåŠ¡ï¼Œè´Ÿè½½å‡è¡¡ã€‚ æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼šjdbc:mysql://vip:3306/xxdb é«˜å¯ç”¨åˆ†æï¼šé«˜å¯ç”¨ï¼Œä¸€ä¸ªä¸»åº“æŒ‚äº†ï¼Œä¸å½±å“å¦ä¸€å°ä¸»åº“æä¾›æœåŠ¡ã€‚è¿™ä¸ªè¿‡ç¨‹å¯¹ä¸šåŠ¡å±‚æ˜¯é€æ˜çš„ï¼Œæ— éœ€ä¿®æ”¹ä»£ç æˆ–é…ç½®ã€‚ é«˜æ€§èƒ½åˆ†æï¼šè¯»å†™æ€§èƒ½ç›¸æ¯”äºæ–¹æ¡ˆä¸€éƒ½å¾—åˆ°æå‡ï¼Œæå‡ä¸€å€ã€‚ ä¸€è‡´æ€§åˆ†æï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æï¼šå½“ç„¶å¯ä»¥æ‰©å±•æˆä¸‰ä¸»å¾ªç¯ï¼Œä½†ä¸å»ºè®®ï¼ˆä¼šå¤šä¸€å±‚æ•°æ®åŒæ­¥ï¼Œè¿™æ ·åŒæ­¥çš„æ—¶é—´ä¼šæ›´é•¿ï¼‰ã€‚å¦‚æœéå¾—åœ¨æ•°æ®åº“æ¶æ„å±‚é¢æ‰©å±•çš„è¯ï¼Œæ‰©å±•ä¸ºæ–¹æ¡ˆå››ã€‚ å¯è½åœ°åˆ†æï¼šä¸¤ç‚¹å½±å“è½åœ°:ç¬¬ä¸€ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¯è§£å†³é—®é¢˜ã€‚ç¬¬äºŒï¼Œä¸»é”®å†²çªé—®é¢˜ï¼ŒIDç»Ÿä¸€åœ°ç”±åˆ†å¸ƒå¼IDç”ŸæˆæœåŠ¡æ¥ç”Ÿæˆå¯è§£å†³é—®é¢˜ã€‚ ä¸€ä¸»å¤šä» è¯¥æ–¹æ¡ˆé‡‡ç”¨ä¸»ä»æ¶æ„ï¼Œä¸€ä¸»å¤šä»ï¼Œè¯»å†™åˆ†ç¦»ã€‚ æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼š 12345jdbc:mysql://master-ip:3306/xxdb jdbc:mysql://slave1-ip:3306/xxdb jdbc:mysql://slave2-ip:3306/xxdb é«˜å¯ç”¨åˆ†æï¼šä¸»åº“å•ç‚¹ï¼Œä»åº“é«˜å¯ç”¨ã€‚ä¸€æ—¦ä¸»åº“æŒ‚äº†ï¼Œå†™æœåŠ¡ä¹Ÿå°±æ— æ³•æä¾›ã€‚ é«˜æ€§èƒ½åˆ†æï¼šå¤§éƒ¨åˆ†äº’è”ç½‘åº”ç”¨è¯»å¤šå†™å°‘ï¼Œè¯»ä¼šå…ˆæˆä¸ºç“¶é¢ˆï¼Œè¿›è€Œå½±å“æ•´ä½“æ€§èƒ½ã€‚è¯»çš„æ€§èƒ½æé«˜äº†ï¼Œæ•´ä½“æ€§èƒ½ä¹Ÿæé«˜äº†ã€‚å¦å¤–ï¼Œä¸»åº“å¯ä»¥ä¸ç”¨ç´¢å¼•ï¼Œçº¿ä¸Šä»åº“å’Œçº¿ä¸‹ä»åº“ä¹Ÿå¯ä»¥å»ºç«‹ä¸åŒçš„ç´¢å¼•ï¼ˆçº¿ä¸Šä»åº“å¦‚æœæœ‰å¤šä¸ªè¿˜æ˜¯è¦å»ºç«‹ç›¸åŒçš„ç´¢å¼•ï¼Œä¸ç„¶å¾—ä¸å¿å¤±ï¼›çº¿ä¸‹ä»åº“æ˜¯å¹³æ—¶å¼€å‘äººå‘˜æ’æŸ¥çº¿ä¸Šé—®é¢˜æ—¶æŸ¥çš„åº“ï¼Œå¯ä»¥å»ºæ›´å¤šçš„ç´¢å¼•ï¼‰ã€‚ ä¸€è‡´æ€§åˆ†æï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æï¼šå¯ä»¥é€šè¿‡åŠ ä»åº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ï¼ˆå¸¦æ¥çš„é—®é¢˜æ˜¯ï¼Œä»åº“è¶Šå¤šéœ€è¦ä»ä¸»åº“æ‹‰å–binlogæ—¥å¿—çš„ç«¯å°±è¶Šå¤šï¼Œè¿›è€Œå½±å“ä¸»åº“çš„æ€§èƒ½ï¼Œå¹¶ä¸”æ•°æ®åŒæ­¥å®Œæˆçš„æ—¶é—´ä¹Ÿä¼šæ›´é•¿ï¼‰ å¯è½åœ°åˆ†æï¼šä¸¤ç‚¹å½±å“è½åœ°:ç¬¬ä¸€ï¼Œæ•°æ®ä¸€è‡´æ€§é—®é¢˜ï¼Œä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆå¯è§£å†³é—®é¢˜ã€‚ç¬¬äºŒï¼Œä¸»åº“å•ç‚¹é—®é¢˜ï¼Œæš‚æ—¶æ²¡æƒ³åˆ°å¾ˆå¥½çš„è§£å†³æ–¹æ¡ˆã€‚ åŒä¸»+ä¸»ä» æ•°æ®åº“é“¾æ¥å­—ç¬¦ä¸²ï¼š 12345jdbc:mysql://vip:3306/xxdbjdbc:mysql://slave1-ip:3306/xxdbjdbc:mysql://slave2-ip:3306/xxdb é«˜å¯ç”¨åˆ†æï¼šé«˜å¯ç”¨ã€‚ é«˜æ€§èƒ½åˆ†æï¼šé«˜æ€§èƒ½ã€‚ ä¸€è‡´æ€§åˆ†æï¼šå­˜åœ¨æ•°æ®ä¸€è‡´æ€§é—®é¢˜ã€‚ æ‰©å±•æ€§åˆ†æï¼šå¯ä»¥é€šè¿‡åŠ ä»åº“æ¥æ‰©å±•è¯»æ€§èƒ½ï¼Œè¿›è€Œæé«˜æ•´ä½“æ€§èƒ½ã€‚ï¼ˆå¸¦æ¥çš„é—®é¢˜åŒæ–¹æ¡ˆäºŒï¼‰ å¯è½åœ°åˆ†æï¼šåŒæ–¹æ¡ˆäºŒï¼Œä½†æ•°æ®åŒæ­¥åˆå¤šäº†ä¸€å±‚ï¼Œæ•°æ®å»¶è¿Ÿæ›´ä¸¥é‡ã€‚ æ•°æ®ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ ä¸»åº“å’Œä»åº“ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ æ³¨ï¼šå›¾ä¸­åœˆå‡ºçš„æ˜¯æ•°æ®åŒæ­¥çš„åœ°æ–¹ï¼Œæ•°æ®åŒæ­¥ï¼ˆä»åº“ä»ä¸»åº“æ‹‰å–binlogæ—¥å¿—ï¼Œå†æ‰§è¡Œä¸€éï¼‰æ˜¯éœ€è¦æ—¶é—´çš„ï¼Œè¿™ä¸ªåŒæ­¥æ—¶é—´å†…ä¸»åº“å’Œä»åº“çš„æ•°æ®ä¼šå­˜åœ¨ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¦‚æœåŒæ­¥è¿‡ç¨‹ä¸­æœ‰è¯»è¯·æ±‚ï¼Œé‚£ä¹ˆè¯»åˆ°çš„å°±æ˜¯ä»åº“ä¸­çš„è€æ•°æ®ã€‚å¦‚ä¸‹å›¾ã€‚ æ—¢ç„¶çŸ¥é“äº†æ•°æ®ä¸ä¸€è‡´æ€§äº§ç”Ÿçš„åŸå› ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªè§£å†³æ–¹æ¡ˆä¾›å‚è€ƒï¼š ç›´æ¥å¿½ç•¥ï¼Œå¦‚æœä¸šåŠ¡å…è®¸å»¶æ—¶å­˜åœ¨ï¼Œé‚£ä¹ˆå°±ä¸å»ç®¡å®ƒã€‚ å¼ºåˆ¶è¯»ä¸»ï¼Œé‡‡ç”¨ä¸»å¤‡æ¶æ„æ–¹æ¡ˆï¼Œè¯»å†™éƒ½èµ°ä¸»åº“ã€‚ç”¨ç¼“å­˜æ¥æ‰©å±•æ•°æ®åº“è¯»æ€§èƒ½ ã€‚å¦‚æœç¼“å­˜æŒ‚äº†ï¼Œå¯èƒ½ä¼šäº§ç”Ÿé›ªå´©ç°è±¡ï¼Œä¸è¿‡ä¸€èˆ¬åˆ†å¸ƒå¼ç¼“å­˜éƒ½æ˜¯é«˜å¯ç”¨çš„ã€‚ é€‰æ‹©è¯»ä¸»ï¼Œå†™æ“ä½œæ—¶æ ¹æ®åº“+è¡¨+ä¸šåŠ¡ç‰¹å¾ç”Ÿæˆä¸€ä¸ªkeyæ”¾åˆ°Cacheé‡Œå¹¶è®¾ç½®è¶…æ—¶æ—¶é—´ï¼ˆå¤§äºç­‰äºä¸»ä»æ•°æ®åŒæ­¥æ—¶é—´ï¼‰ã€‚è¯»è¯·æ±‚æ—¶ï¼ŒåŒæ ·çš„æ–¹å¼ç”Ÿæˆkeyå…ˆå»æŸ¥Cacheï¼Œå†åˆ¤æ–­æ˜¯å¦å‘½ä¸­ã€‚è‹¥å‘½ä¸­ï¼Œåˆ™è¯»ä¸»åº“ï¼Œå¦åˆ™è¯»ä»åº“ã€‚ä»£ä»·æ˜¯å¤šäº†ä¸€æ¬¡ç¼“å­˜è¯»å†™ï¼ŒåŸºæœ¬å¯ä»¥å¿½ç•¥ã€‚ åŠåŒæ­¥å¤åˆ¶ï¼Œç­‰ä¸»ä»åŒæ­¥å®Œæˆï¼Œå†™è¯·æ±‚æ‰è¿”å›ã€‚å°±æ˜¯å¤§å®¶å¸¸è¯´çš„â€œåŠåŒæ­¥å¤åˆ¶â€semi-syncã€‚è¿™å¯ä»¥åˆ©ç”¨æ•°æ®åº“åŸç”ŸåŠŸèƒ½ï¼Œå®ç°æ¯”è¾ƒç®€å•ã€‚ä»£ä»·æ˜¯å†™è¯·æ±‚æ—¶å»¶å¢é•¿ï¼Œååé‡é™ä½ã€‚ æ•°æ®åº“ä¸­é—´ä»¶ï¼Œå¼•å…¥å¼€æºï¼ˆmycatç­‰ï¼‰æˆ–è‡ªç ”çš„æ•°æ®åº“ä¸­é—´å±‚ã€‚æ€è·¯åŒé€‰æ‹©è¯»ä¸»ã€‚æ•°æ®åº“ä¸­é—´ä»¶çš„æˆæœ¬æ¯”è¾ƒé«˜ï¼Œå¹¶ä¸”è¿˜å¤šå¼•å…¥äº†ä¸€å±‚ã€‚ DBå’Œç¼“å­˜ä¸€è‡´æ€§è§£å†³æ–¹æ¡ˆ å…ˆæ¥çœ‹ä¸€ä¸‹å¸¸ç”¨çš„ç¼“å­˜ä½¿ç”¨æ–¹å¼ï¼š ç¬¬ä¸€æ­¥ï¼šæ·˜æ±°ç¼“å­˜ï¼› ç¬¬äºŒæ­¥ï¼šå†™å…¥æ•°æ®åº“ï¼› ç¬¬ä¸‰æ­¥ï¼šè¯»å–ç¼“å­˜ï¼Ÿè¿”å›ï¼šè¯»å–æ•°æ®åº“ï¼› ç¬¬å››æ­¥ï¼šè¯»å–æ•°æ®åº“åå†™å…¥ç¼“å­˜ã€‚ æ³¨ï¼šå¦‚æœæŒ‰ç…§è¿™ç§æ–¹å¼ï¼Œå›¾ä¸€ï¼Œä¸ä¼šäº§ç”ŸDBå’Œç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ï¼›å›¾äºŒï¼Œä¼šäº§ç”ŸDBå’Œç¼“å­˜ä¸ä¸€è‡´é—®é¢˜ï¼Œå³r2.readå…ˆäºw3.syncæ‰§è¡Œã€‚å¦‚æœä¸åšå¤„ç†ï¼Œç¼“å­˜é‡Œçš„æ•°æ®å¯èƒ½ä¸€ç›´æ˜¯è„æ•°æ®ã€‚è§£å†³æ–¹å¼å¦‚ä¸‹ï¼š &lt;font color="red"&gt;æ³¨ï¼šè®¾ç½®ç¼“å­˜æ—¶ï¼Œä¸€å®šè¦åŠ ä¸Šå¤±æ•ˆæ—¶é—´ï¼Œä»¥é˜²å»¶æ—¶æ·˜æ±°ç¼“å­˜å¤±è´¥çš„æƒ…å†µï¼&lt;/font&gt; MySQLå¤åˆ¶ MySQLä¸»ä»å¤åˆ¶ ç›®çš„ å®ç°æ•°æ®åº“è¯»å†™åˆ†ç¦»ï¼Œå†™æ“ä½œè®¿é—®ä¸»æ•°æ®åº“ï¼Œè¯»æ“ä½œè®¿é—®ä»æ•°æ®åº“ï¼Œä»è€Œä½¿æ•°æ®åº“å…·æœ‰æ›´å¼ºå¤§çš„è®¿é—®è´Ÿè½½èƒ½åŠ›ï¼Œæ”¯æ’‘æ›´å¤šçš„ç”¨æˆ·è®¿é—®ã€‚ åŸç† å½“åº”ç”¨ç¨‹åºå®¢æˆ·ç«¯å‘é€ä¸€æ¡æ›´æ–°å‘½ä»¤åˆ°æ•°æ®åº“çš„æ—¶å€™ï¼Œæ•°æ®åº“ä¼šæŠŠè¿™æ¡æ›´æ–°å‘½ä»¤åŒæ­¥è®°å½•åˆ°Binlogä¸­ï¼Œç„¶åç”±å¦å¤–ä¸€ä¸ªçº¿ç¨‹ä»Binlogä¸­è¯»å–è¿™æ¡æ—¥å¿—ï¼Œç„¶åé€šè¿‡è¿œç¨‹é€šè®¯çš„æ–¹å¼å°†å®ƒå¤åˆ¶åˆ°ä»æœåŠ¡å™¨ä¸Šé¢å»ï¼Œä»æœåŠ¡å™¨è·å¾—è¿™æ¡æ›´æ–°æ—¥å¿—åï¼Œå°†å…¶åŠ å…¥åˆ°è‡ªå·±çš„Relay logä¸­ï¼Œç„¶åç”±å¦å¤–ä¸€ä¸ªSQLæ‰§è¡Œçº¿ç¨‹ä»Relay logä¸­è¯»å–è¿™æ¡æ–°çš„æ—¥å¿—ï¼Œå¹¶æŠŠå®ƒåœ¨æœ¬åœ°çš„æ•°æ®åº“ä¸­é‡æ–°æ‰§è¡Œä¸€éã€‚ è¿™æ ·å½“å®¢æˆ·ç«¯åº”ç”¨ç¨‹åºæ‰§è¡Œä¸€ä¸ªupdateå‘½ä»¤çš„æ—¶å€™ï¼Œè¿™ä¸ªå‘½ä»¤ä¼šåœ¨ä¸»æ•°æ®åº“å’Œä»æ•°æ®åº“ä¸ŠåŒæ­¥æ‰§è¡Œï¼Œä»è€Œå®ç°äº†ä¸»æ•°æ®åº“å‘ä»æ•°æ®åº“çš„å¤åˆ¶ï¼Œè®©ä»æ•°æ®åº“å’Œä¸»æ•°æ®åº“ä¿æŒä¸€æ ·çš„æ•°æ®ã€‚ MySQLä¸€ä¸»å¤šä»å¤åˆ¶ ç›®çš„ MySQLçš„ä¸»ä»å¤åˆ¶æ˜¯ä¸€ç§æ•°æ®åŒæ­¥æœºåˆ¶ï¼Œé™¤äº†å¯ä»¥å°†ä¸€ä¸ªä¸»æ•°æ®åº“ä¸­çš„æ•°æ®åŒæ­¥å¤åˆ¶åˆ°ä¸€ä¸ªä»æ•°æ®åº“ä¸Šï¼Œè¿˜å¯ä»¥å°†ä¸€ä¸ªä¸»æ•°æ®åº“ä¸Šçš„æ•°æ®åŒæ­¥å¤åˆ¶åˆ°å¤šä¸ªä»æ•°æ®åº“ä¸Šï¼Œä¹Ÿå°±æ˜¯æ‰€è°“çš„MySQLçš„ä¸€ä¸»å¤šä»å¤åˆ¶ã€‚ åŸç† å¤šä¸ªä»æ•°æ®åº“å…³è”åˆ°ä¸»æ•°æ®åº“åï¼Œå°†ä¸»æ•°æ®åº“ä¸Šçš„Binlogæ—¥å¿—åŒæ­¥åœ°å¤åˆ¶åˆ°äº†å¤šä¸ªä»æ•°æ®åº“ä¸Šã€‚é€šè¿‡æ‰§è¡Œæ—¥å¿—ï¼Œè®©æ¯ä¸ªä»æ•°æ®åº“çš„æ•°æ®éƒ½å’Œä¸»æ•°æ®åº“ä¸Šçš„æ•°æ®ä¿æŒäº†ä¸€è‡´ã€‚è¿™é‡Œé¢çš„æ•°æ®æ›´æ–°æ“ä½œè¡¨ç¤ºçš„æ˜¯æ‰€æœ‰æ•°æ®åº“çš„æ›´æ–°æ“ä½œï¼Œé™¤äº†ä¸åŒ…æ‹¬SELECTä¹‹ç±»çš„æŸ¥è¯¢è¯»æ“ä½œï¼Œå…¶ä»–çš„INSERTã€DELETEã€UPDATEè¿™æ ·çš„DMLå†™æ“ä½œï¼Œä»¥åŠCREATE TABLEã€DROPT ABLEã€ALTER TABLEç­‰DDLæ“ä½œä¹Ÿéƒ½å¯ä»¥åŒæ­¥å¤åˆ¶åˆ°ä»æ•°æ®åº“ä¸Šå»ã€‚ ä¼˜ç‚¹ ä¸€ä¸»å¤šä»å¤åˆ¶æœ‰å››å¤§ä¼˜ç‚¹ï¼Œåˆ†åˆ«æ˜¯åˆ†æ‘Šè´Ÿè½½ã€ä¸“æœºä¸“ç”¨ã€ä¾¿äºå†·å¤‡å’Œé«˜å¯ç”¨ã€‚ åˆ†æ‘Šè´Ÿè½½ï¼šå°†åªè¯»æ“ä½œåˆ†å¸ƒåœ¨å¤šä¸ªä»æ•°æ®åº“ä¸Šï¼Œä»è€Œå°†è´Ÿè½½åˆ†æ‘Šåˆ°å¤šå°æœåŠ¡å™¨ä¸Šã€‚ ä¸“æœºä¸“ç”¨ï¼šå¯ä»¥é’ˆå¯¹ä¸åŒç±»å‹çš„æŸ¥è¯¢ï¼Œä½¿ç”¨ä¸åŒçš„ä»æœåŠ¡å™¨ã€‚ ä¾¿äºå†·å¤‡ï¼šå³ä½¿æ•°æ®åº“è¿›è¡Œäº†ä¸€ä¸»å¤šä»çš„å¤åˆ¶ï¼Œåœ¨ä¸€äº›æç«¯çš„æƒ…å†µä¸‹ã€‚ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªæ•°æ®ä¸­å¿ƒçš„æ•°æ®éƒ½ä¸¢å¤±ã€‚æ‰€ä»¥é€šå¸¸éœ€è¦å¯¹æ•°æ®åšå†·å¤‡ï¼Œä½†å†·å¤‡æœ‰ä¸€ä¸ªå›°éš¾ç‚¹åœ¨äºï¼Œæ•°æ®åº“å¦‚æœæ­£åœ¨è¿›è¡Œå†™æ“ä½œï¼Œå†·å¤‡çš„æ•°æ®å°±å¯èƒ½ä¸å®Œæ•´ï¼Œæ•°æ®æ–‡ä»¶å¯èƒ½å¤„äºæŸåçŠ¶æ€ã€‚ä½¿ç”¨ä¸€ä¸»å¤šä»çš„å¤åˆ¶å°±å°±å¯ä»¥å®ç°é›¶åœæœºçš„å¤‡ä»½ã€‚åªéœ€è¦å…³é—­æ•°æ®åº“çš„æ•°æ®å¤åˆ¶è¿›ç¨‹ï¼Œæ–‡ä»¶å°±å¤„äºå…³é—­çŠ¶æ€äº†ï¼Œç„¶åè¿›è¡Œæ•°æ®æ–‡ä»¶æ‹·è´ï¼Œæ‹·è´å®Œæˆåå†é‡æ–°æ‰“å¼€æ•°æ®å¤åˆ¶å°±å¯ä»¥äº†ã€‚ é«˜å¯ç”¨ï¼šå¦‚æœä¸€å°æœåŠ¡å™¨å®•æœºäº†ï¼Œåªè¦ä¸å‘è¯·æ±‚ç»™è¿™å°æœåŠ¡å™¨å°±ä¸ä¼šå‡ºé—®é¢˜ã€‚å½“è¿™å°æœåŠ¡å™¨æ¢å¤çš„æ—¶å€™ï¼Œé‡æ–°å‘è¯·æ±‚åˆ°è¿™å°æœåŠ¡å™¨ã€‚æ‰€ä»¥ï¼Œåœ¨ä¸€ä¸»å¤šä»çš„æƒ…å†µä¸‹ï¼ŒæŸä¸€å°ä»æœåŠ¡å™¨å®•æœºä¸å¯ç”¨ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿçš„å½±å“æ˜¯éå¸¸å°çš„ã€‚ MySQLä¸»ä¸»å¤åˆ¶ ç›®çš„ ä¸€ä¸»å¤šä»åªèƒ½å¤Ÿå®ç°ä»æœåŠ¡å™¨ä¸Šçš„è¿™äº›ä¼˜ç‚¹ï¼Œå½“ä¸»æ•°æ®åº“å®•æœºä¸å¯ç”¨çš„æ—¶å€™ï¼Œæ•°æ®ä¾ç„¶æ˜¯ä¸èƒ½å¤Ÿå†™å…¥çš„ï¼Œå› ä¸ºæ•°æ®ä¸èƒ½å¤Ÿå†™å…¥åˆ°ä»æœåŠ¡å™¨ä¸Šé¢å»ï¼Œä»æœåŠ¡å™¨æ˜¯åªè¯»çš„ã€‚ä¸ºäº†è§£å†³ä¸»æœåŠ¡å™¨çš„å¯ç”¨æ€§é—®é¢˜ï¼Œé‡‡ç”¨MySQLçš„ä¸»ä¸»å¤åˆ¶æ–¹æ¡ˆã€‚ åŸç† å½“å®¢æˆ·ç«¯ç¨‹åºå¯¹ä¸»æœåŠ¡å™¨Aè¿›è¡Œæ•°æ®æ›´æ–°æ“ä½œçš„æ—¶å€™ï¼Œä¸»æœåŠ¡å™¨Aä¼šæŠŠæ›´æ–°æ“ä½œå†™å…¥åˆ°Binlogæ—¥å¿—ä¸­ã€‚ç„¶åBinlogä¼šå°†æ•°æ®æ—¥å¿—åŒæ­¥åˆ°ä¸»æœåŠ¡å™¨Bï¼Œå†™å…¥åˆ°ä¸»æœåŠ¡å™¨çš„Relay logä¸­ï¼Œç„¶åæ‰§Relay logï¼Œè·å¾—Relay logä¸­çš„æ›´æ–°æ—¥å¿—ï¼Œæ‰§è¡ŒSQLæ“ä½œå†™å…¥åˆ°æ•°æ®åº“æœåŠ¡å™¨Bçš„æœ¬åœ°æ•°æ®åº“ä¸­ã€‚BæœåŠ¡å™¨ä¸Šçš„æ›´æ–°ä¹ŸåŒæ ·é€šè¿‡Binlogå¤åˆ¶åˆ°äº†æœåŠ¡å™¨Açš„Relay logä¸­ï¼Œç„¶åé€šè¿‡Relay logå°†æ•°æ®æ›´æ–°åˆ°æœåŠ¡å™¨Aä¸­ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼ŒæœåŠ¡å™¨Aæˆ–è€…Bä»»ä½•ä¸€å°æœåŠ¡å™¨æ”¶åˆ°äº†æ•°æ®çš„å†™çš„æ“ä½œéƒ½ä¼šåŒæ­¥æ›´æ–°åˆ°å¦ä¸€å°æœåŠ¡å™¨ï¼Œå®ç°äº†æ•°æ®åº“ä¸»ä¸»å¤åˆ¶ã€‚ä¸»ä¸»å¤åˆ¶å¯ä»¥æé«˜ç³»ç»Ÿçš„å†™å¯ç”¨ï¼Œå®ç°å†™æ“ä½œçš„é«˜å¯ç”¨ã€‚ MySQLä¸»ä¸»å¤åˆ¶å¤±æ•ˆæ¢å¤ æ­£å¸¸æƒ…å†µä¸‹ç”¨æˆ·ä¼šå†™å…¥åˆ°ä¸»æœåŠ¡å™¨Aä¸­ï¼Œç„¶åæ•°æ®ä»Aå¤åˆ¶åˆ°ä¸»æœåŠ¡å™¨Bä¸Šã€‚å½“ä¸»æœåŠ¡å™¨Aå¤±æ•ˆçš„æ—¶å€™ï¼Œå†™æ“ä½œä¼šè¢«å‘é€åˆ°ä¸»æœåŠ¡å™¨Bä¸­å»ï¼Œæ•°æ®ä»BæœåŠ¡å™¨å¤åˆ¶åˆ°AæœåŠ¡å™¨ã€‚ ä¸»ä¸»å¤±æ•ˆç»´æŠ¤è¿‡ç¨‹ï¼š æœ€å¼€å§‹çš„æ—¶å€™ï¼Œæ‰€æœ‰çš„ä¸»æœåŠ¡å™¨éƒ½å¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œå½“ä¸»æœåŠ¡å™¨Aå¤±æ•ˆçš„æ—¶å€™ï¼Œè¿›å…¥æ•…éšœçŠ¶æ€ï¼Œåº”ç”¨ç¨‹åºæ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨Aå¤±æ•ˆï¼Œæ£€æµ‹åˆ°è¿™ä¸ªå¤±æ•ˆå¯èƒ½éœ€è¦å‡ ç§’é’Ÿæˆ–è€…å‡ åˆ†é’Ÿçš„æ—¶é—´ï¼Œç„¶ååº”ç”¨ç¨‹åºéœ€è¦è¿›è¡Œå¤±æ•ˆè½¬ç§»ï¼Œå°†å†™æ“ä½œå‘é€åˆ°å¤‡ä»½ä¸»æœåŠ¡å™¨Bä¸Šé¢å»ï¼Œå°†è¯»æ“ä½œå‘é€åˆ°BæœåŠ¡å™¨å¯¹åº”çš„ä»æœåŠ¡å™¨ä¸Šé¢å»ã€‚ ä¸€æ®µæ—¶é—´åæ•…éšœç»“æŸï¼ŒAæœåŠ¡å™¨éœ€è¦é‡å»ºå¤±æ•ˆæœŸé—´ä¸¢å¤±çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æŠŠè‡ªå·±å½“ä½œä»æœåŠ¡å™¨ä»BæœåŠ¡å™¨ä¸Šé¢å»åŒæ­¥æ•°æ®ã€‚åŒæ­¥å®Œæˆåç³»ç»Ÿæ‰èƒ½æ¢å¤æ­£å¸¸ã€‚è¿™ä¸ªæ—¶å€™BæœåŠ¡å™¨æ˜¯ç”¨æˆ·çš„ä¸»è¦è®¿é—®æœåŠ¡å™¨ï¼ŒAæœåŠ¡å™¨å½“ä½œå¤‡ä»½æœåŠ¡å™¨ã€‚ MySQLå¤åˆ¶æ³¨æ„äº‹é¡¹ ä¸è¦å¯¹ä¸¤ä¸ªæ•°æ®åº“åŒæ—¶è¿›è¡Œæ•°æ®å†™æ“ä½œï¼Œå› ä¸ºè¿™ç§æƒ…å†µä¼šå¯¼è‡´æ•°æ®å†²çªã€‚ å¤åˆ¶åªæ˜¯å¢åŠ äº†æ•°æ®çš„è¯»å¹¶å‘å¤„ç†èƒ½åŠ›ï¼Œå¹¶æ²¡æœ‰å¢åŠ å†™å¹¶å‘çš„èƒ½åŠ›å’Œç³»ç»Ÿå­˜å‚¨èƒ½åŠ›ã€‚ æ›´æ–°æ•°æ®è¡¨çš„ç»“æ„ä¼šå¯¼è‡´å·¨å¤§çš„åŒæ­¥å»¶è¿Ÿã€‚ éœ€è¦æ›´æ–°è¡¨ç»“æ„çš„æ“ä½œï¼Œä¸è¦å†™å…¥åˆ°åˆ°Binlogä¸­ï¼Œè¦å…³é—­æ›´æ–°è¡¨ç»“æ„çš„Binlogã€‚å¦‚æœè¦å¯¹è¡¨ç»“æ„è¿›è¡Œæ›´æ–°ï¼Œåº”è¯¥ç”±è¿ç»´å·¥ç¨‹å¸ˆDBAå¯¹æ‰€æœ‰ä¸»ä»æ•°æ®åº“åˆ†åˆ«æ‰‹å·¥è¿›è¡Œæ•°æ®è¡¨ç»“æ„çš„æ›´æ–°æ“ä½œã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hexoæ­å»ºGitHubåšå®¢(æŒç»­æ›´æ–°)]]></title>
    <url>%2Fposts%2Fd5766023.html</url>
    <content type="text"><![CDATA[å…¥é—¨Hexo ç”±äºå¹³æ—¶è‡ªå·±å–œæ¬¢çœ‹ä¸€äº›æŠ€æœ¯ç±»æ–‡ç« æ•´ç†æˆWordç¬”è®°ï¼Œæ€»æ„Ÿè§‰è¿™ç§æ–¹å¼å¤ªlowï¼Œæƒ³è‡ªå·±æ­å»ºå±äºè‡ªå·±çš„åšå®¢ï¼Œåœ¨ç½‘ä¸ŠæŸ¥é˜…äº†ä¸€ä¸‹ï¼Œå‘ç°Hexoåœ¨GitHubæˆ–è€…æ˜¯ç äº‘ä¸Šæ­å»ºåšå®¢éå¸¸ç»™åŠ›ã€‚ ç„¶åè‡ªå·±ä¹Ÿæ­å»ºäº†åšå®¢ï¼Œè¿™ç¯‡æ–‡ç« å°±è®°å½•äº†æ­å»ºçš„è¿‡ç¨‹åŠä¸€äº›ä¼˜åŒ–ã€‚ ä»€ä¹ˆæ˜¯Hexo Hexo æ˜¯ä¸€ä¸ªå¿«é€Ÿã€ç®€æ´ä¸”é«˜æ•ˆçš„åšå®¢æ¡†æ¶ã€‚Hexo ä½¿ç”¨ Markdown ï¼ˆæˆ–å…¶ä»–æ¸²æŸ“å¼•æ“ï¼‰è§£ææ–‡ç« ï¼Œåœ¨å‡ ç§’å†…ï¼Œå³å¯åˆ©ç”¨é“ä¸½çš„ä¸»é¢˜ç”Ÿæˆé™æ€ç½‘é¡µã€‚å¤§å®¶è¿›å…¥ Hexoå®˜ç½‘ è¿›è¡ŒæŸ¥çœ‹ã€‚ å®‰è£…Hexo å®‰è£… Hexo ç›¸å½“ç®€å•ã€‚ç„¶è€Œåœ¨å®‰è£…å‰ï¼Œæ‚¨å¿…é¡»æ£€æŸ¥ç”µè„‘ä¸­æ˜¯å¦å·²å®‰è£…ä¸‹åˆ—åº”ç”¨ç¨‹åºï¼š Node.js Git cnpm å¦‚æœnpmè¿è¡Œå‡ºé”™å°±å®‰è£…cnpmå›½å†…é•œåƒ æ‰€æœ‰å¿…å¤‡çš„åº”ç”¨ç¨‹åºå®‰è£…å®Œæˆåï¼Œå³å¯ä½¿ç”¨ npmæˆ–è€…cnpm å®‰è£… Hexoã€‚ æ‰“å¼€Git Bash hereï¼Œè¾“å…¥ï¼š 123$ npm install -g hexo-cli æˆ–è€… $ cnpm install -g hexo-cli æ£€æŸ¥æ˜¯å¦å®‰è£…Hexoå®Œæˆ,æŸ¥è¯¢æ˜¯å¦æˆåŠŸï¼Œæ˜¾ç¤ºhexo-cli ç‰ˆæœ¬å°±è¯´æ˜æˆåŠŸäº† 1$ hexo -V å»ºç«™ å®‰è£…ä¸€åˆ‡æ‰€éœ€çš„ç¨‹åºåï¼Œå°±å¯ä»¥å¼€å§‹å»ºç«™äº†ï¼Œå°±æ˜¯åˆ›å»ºæˆ‘ä»¬çš„åšå®¢,å¤§å®¶ä¹Ÿå¯ä»¥è¿›å…¥ å»ºç«™å®˜ç½‘ æŸ¥çœ‹ã€‚ æ–°å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œæ¥ç®¡ç†æˆ‘ä»¬çš„åšå®¢é¡¹ç›®ï¼Œæ‰§è¡Œä¸‹åˆ—å‘½ä»¤ï¼ŒHexo å°†ä¼šåœ¨æŒ‡å®šæ–‡ä»¶å¤¹ä¸­æ–°å»ºæ‰€éœ€è¦çš„æ–‡ä»¶ã€‚ è¿è¡Œå‘½ä»¤ 123$ hexo init &lt;folder&gt;$ cd &lt;folder&gt;$ cnpm install æ³¨ï¼š&lt;folder&gt;æ˜¯è¡¨ç¤ºå»ºç«™çš„åšå®¢é¡¹ç›®å æ‰“å¼€Git Bash hereï¼Œè¾“å…¥ï¼š 1$ hexo init githubBlog è¿›å…¥åˆ›å»ºçš„åšå®¢é¡¹ç›®ä¸‹ï¼Œå®‰è£… 12$ cd githubBlog$ cnpm install å®‰è£…ä¹‹åï¼Œæ•´ä¸ªåšå®¢é¡¹ç›®ç›®å½•å¦‚ä¸‹ï¼š è®¿é—®URL 123$ hexo server æˆ–è€…$ hexo s è®¿é—®URLï¼šhttp://localhost:4000ï¼Œæ•ˆæœå¦‚ä¸‹å›¾ï¼š åˆ°è¿™é‡Œå·²ç»é€šè¿‡Hexoåˆæ­¥åˆ›å»ºåšå®¢äº†ï¼Œä¸‹é¢å†æ¥äº†è§£ä¸€ä¸‹å¦‚ä½•å°†æˆ‘ä»¬çš„åšå®¢æ‰˜ç®¡åˆ°GitHubæœåŠ¡å™¨ä¸Šã€‚ æ‰˜ç®¡åˆ°GitHub GitHubåˆ›å»ºrepositories è¿›å…¥GitHubå®˜ç½‘ä¸­æµè§ˆå™¨è¾“å…¥ https://github.com/ ,å¦‚æœè¿˜æ²¡æœ‰è´¦å·å°±åˆ›å»ºä¸€ä¸ªè´¦å·å°±å¥½äº†ã€‚ç™»å½•è‡ªå·±çš„è´¦å·ã€‚ç›´æ¥new repositories æˆ–è€…è¿›å…¥You repositories åœ¨new repositoriesã€‚ è¿›å…¥åˆ°åˆ›å»º repositories é¡µé¢å,ä¸€å®šè¦æ³¨æ„ï¼Œå°†æ–°å»ºçš„repositoryçš„åå­—ä¸º: You account name.github.ioã€‚å…¶ä»–é»˜è®¤å°±å¥½äº†ã€‚ é…ç½® GitHubçš„Repositoryåˆ›å»ºå¥½åï¼Œåœ¨å›åˆ°æœ¬åœ°çš„Hexoçš„githubBlogé¡¹ç›®ä¸­ï¼Œæ‰¾åˆ°åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹_config.ymlæ‰¾åˆ° deployæ ‡ç­¾ åœ¨è¯¥æ–‡ä»¶ä¸‹é¢æ·»åŠ  æ³¨ï¼šrepository: https://github.com/whb1990/whb1990.github.io æ˜¯è‡ªå·±åˆšåˆšåˆ›å»ºYou account name.github.io çš„repositoryï¼Œåœ¨Clone with HTTPSé‡Œé¢ï¼Œå¤åˆ¶ç²˜è´´å°±å¥½äº†ï¼Œå†’å·åé¢è®°å¾—ç©ºæ ¼ã€‚branch åé¢æ˜¯masterå°±å¥½äº†ã€‚ 1234deploy: #éƒ¨ç½² type: git repository: https://github.com/whb1990/whb1990.github.io.git branch: master åœ¨_config.ymlæ‰¾åˆ°urlè¿›è¡Œä¿®æ”¹ä¸ºï¼š 1url: http://whb1990.github.io #åšå®¢ç½‘å€ éƒ¨ç½² åˆ°è¿™é‡Œå°±å·®ä¸åˆ°äº†ï¼Œæ¥ä¸‹æ¥éœ€è¦æ‰§è¡Œä¸€äº›å‘½ä»¤ï¼Œå°†åšå®¢éƒ¨ç½²åˆ°GitHubä¸Šå»ã€‚ æ‰“å¼€Git Bash Hereè¿›å…¥githubBlog æ ¹ç›®å½•ä¸‹ï¼Œé¦–å…ˆéœ€è¦å®‰è£…ä¸€ä¸‹ hexo-deployer-git ä¸ç„¶å¯èƒ½å‡ºç°é”™è¯¯æ— æ³•éƒ¨ç½²æˆåŠŸã€‚ 1$ cnpm install hexo-deployer-git --save ç„¶ååœ¨æ‰§è¡Œä»¥ä¸‹å‘½ä»¤: 123$ hexo clean$ hexo generate$ hexo deploy æˆ–è€…ç®€å†™ 123$ hexo clean$ hexo g$ hexo d éƒ¨ç½²æˆåŠŸå¦‚ä¸‹æ˜¾ç¤º: æµ‹è¯• æˆ‘ä»¬è¿›è¡Œè®¿é—® https://whb1990.github.io/ å’Œ http://localhost:4000/ ä¸€æ ·çš„é¡µé¢è¯´æ˜æ˜¯å·²ç»æˆåŠŸã€‚ ç«™ç‚¹æ–‡ä»¶é…ç½® åœ¨æ ¹githubBlogç›®å½•ä¸‹_config.ymlæ–‡ä»¶ï¼Œæˆ‘ä»¬æš‚ä¸”ç§°ä¸ºç«™ç‚¹é…ç½®æ–‡ä»¶ï¼Œä»¥ä¾¿ä¸åé¢è®²åˆ°çš„ä¸»é¢˜é…ç½®æ–‡ä»¶(Nextä¸»é¢˜ä¸‹çš„_config.ymlæ–‡ä»¶)è¿›è¡ŒåŒºåˆ†ã€‚ ç½‘ç«™ å‚æ•° æè¿° title ç½‘ç«™æ ‡é¢˜ subtitle ç½‘ç«™å‰¯æ ‡é¢˜ description ç½‘ç«™æè¿° author æ‚¨çš„åå­— language ç½‘ç«™ä½¿ç”¨çš„è¯­è¨€ timezone ç½‘ç«™æ—¶åŒºã€‚Hexo é»˜è®¤ä½¿ç”¨æ‚¨ç”µè„‘çš„æ—¶åŒºã€‚æ—¶åŒºåˆ—è¡¨ã€‚æ¯”å¦‚è¯´ï¼šAmerica/New_York, Japan, å’Œ UTC ã€‚ ç›®å½• å‚æ•° æè¿° source_dir èµ„æºæ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨æ¥å­˜æ”¾å†…å®¹ã€‚ public_dir å…¬å…±æ–‡ä»¶å¤¹ï¼Œè¿™ä¸ªæ–‡ä»¶å¤¹ç”¨äºå­˜æ”¾ç”Ÿæˆçš„ç«™ç‚¹æ–‡ä»¶ã€‚ tag_dir æ ‡ç­¾æ–‡ä»¶å¤¹ archive_dir å½’æ¡£æ–‡ä»¶å¤¹ category_dir åˆ†ç±»æ–‡ä»¶å¤¹ code_dir Include code æ–‡ä»¶å¤¹ i18n_dir å›½é™…åŒ–ï¼ˆi18nï¼‰æ–‡ä»¶å¤¹ skip_render è·³è¿‡æŒ‡å®šæ–‡ä»¶çš„æ¸²æŸ“ï¼Œæ‚¨å¯ä½¿ç”¨ glob æ¥é…ç½®è·¯å¾„ æ–‡ç«  å‚æ•° æè¿° é»˜è®¤å€¼ new_post_name æ–°æ–‡ç« çš„æ–‡ä»¶åç§° :title.md default_layout é¢„è®¾å¸ƒå±€ post auto_spacing åœ¨ä¸­æ–‡å’Œè‹±æ–‡ä¹‹é—´åŠ å…¥ç©ºæ ¼ false titlecase æŠŠæ ‡é¢˜è½¬æ¢ä¸º title case false external_link åœ¨æ–°æ ‡ç­¾ä¸­æ‰“å¼€é“¾æ¥ true filename_case æŠŠæ–‡ä»¶åç§°è½¬æ¢ä¸º (1) å°å†™æˆ– (2) å¤§å†™ 0 render_drafts æ˜¾ç¤ºè‰ç¨¿ false post_asset_folder å¯åŠ¨ Asset æ–‡ä»¶å¤¹ false relative_link æŠŠé“¾æ¥æ”¹ä¸ºä¸æ ¹ç›®å½•çš„ç›¸å¯¹ä½å€ false future æ˜¾ç¤ºæœªæ¥çš„æ–‡ç«  true highlight ä»£ç å—çš„è®¾ç½® åˆ†ç±»&amp;æ ‡ç­¾ å‚æ•° æè¿° é»˜è®¤å€¼ default_category é»˜è®¤åˆ†ç±» uncategorized category_map åˆ†ç±»åˆ«å tag_map æ ‡ç­¾åˆ«å åˆ†é¡µ å‚æ•° æè¿° é»˜è®¤å€¼ per_page æ¯é¡µæ˜¾ç¤ºçš„æ–‡ç« é‡ (0 = å…³é—­åˆ†é¡µåŠŸèƒ½) 10 pagination_dir åˆ†é¡µç›®å½• page å†™ä½œ åˆ›å»ºæ–‡ç«  1$ hexo new [layout] &lt;title&gt; å¦‚ï¼šåˆ›å»ºhello-world 1$ hexo new hello-world å¦‚æœä¸æ·»åŠ titleï¼Œé»˜è®¤å°±æ˜¯æ ‡é¢˜title: hello-worldã€‚ è¿™é‡Œæ³¨æ„ä¸€ä¸‹ï¼Œå¦‚æœåˆ›å»ºå¸¦æœ‰ä¸­æ–‡çš„è·¯å¾„åç§°æ—¶ï¼Œç”Ÿæˆé™æ€é¡µé¢hexo gå¯èƒ½ä¼šæŠ¥é”™ã€‚ 12warning: LF will be replaced by CRLF in xxxxThe file will have its original line endings in your working directory. è¿™æ˜¯ç”±äºåŸå› æ˜¯è·¯å¾„ä¸­å­˜åœ¨ / çš„ç¬¦å·è½¬ä¹‰é—®é¢˜ å¦‚ï¼šåˆ›å»ºæ–‡ç« æ—¶å‘½åä¸ºä¸­æ–‡ï¼Œä¸€èˆ¬éƒ½å‡ºç°è¿™ä¸ªå°é—®é¢˜ã€‚ è§£å†³ åœ¨å‘½ä»¤è¡Œä¸­è¾“å…¥: 1$ git config --global core.autocrlf false ç„¶åé‡æ–°ç”Ÿæˆæ–‡ä»¶éƒ¨ç½²å°±å¥½äº†ã€‚ ç¼–è¾‘æ–‡ç«  åˆ›å»ºçš„æ–‡ç« åœ¨source/_postsç›®å½•ä¸‹ï¼Œæ‰“å¼€æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå®Œå…¨æ”¯æŒMarkdownè¯­æ³•ã€‚ Nextä¸»é¢˜ åœ¨ Hexoä¸»é¢˜å®˜ç½‘ ä¸­æœ‰è®¸å¤šä¸»é¢˜ï¼Œå¤§å®¶å–œæ¬¢ä»€ä¹ˆå°±è¿›è¡Œéƒ¨ç½²å’Œç¼–è¾‘å°±å¥½äº†ï¼Œå¤§è‡´çš„æ€è·¯éƒ½æ˜¯å·®ä¸å¤šçš„ã€‚ æˆ‘é€‰æ‹©çš„ Nextä¸»é¢˜ ï¼Œç½‘ä¸Šå¾ˆå¤šä¹Ÿæ˜¯ç”¨çš„è¿™ä¸ªä¸»é¢˜ã€‚ å®‰è£… åœ¨githubBlogæ ¹ç›®å½•ä¸‹ï¼Œæ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼š 1$ git clone https://github.com/theme-next/hexo-theme-next themes/next ä¸Šé¢çš„å‘½ä»¤æ˜¯cloneæœ€æ–°ç‰ˆæœ¬çš„ä¸»é¢˜ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤cloneæŒ‡å®šç‰ˆæœ¬çš„ä¸»é¢˜ 1$ git clone --branch v7.1.1 https://github.com/theme-next/hexo-theme-next themes/next å®‰è£…å®Œæˆä¹‹åï¼Œåœ¨themesä¸‹å°±ä¼šæœ‰nextç›®å½• åˆ‡æ¢ä¸»é¢˜ åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹æ‰“å¼€_config.ymlæ–‡ä»¶å°†themeè®¾ç½®ä¸ºnextå³å¯ï¼š éƒ¨ç½²ä¹‹åæŸ¥çœ‹æ•ˆæœå¦‚ä¸‹ï¼Œæœ‰ç‚¹ä¸‘ï¼š ä¸»é¢˜é…ç½® ä¸€èˆ¬é…ç½®éƒ½åœ¨theme/next/-config.ymlæ–‡ä»¶ä¸‹é…ç½®ã€‚ ä¿®æ”¹æ•´ä½“å¸ƒå±€ åœ¨theme/next/-config.ymlæ‰¾åˆ°menuçœ‹çœ‹è‡ªå·±åšå®¢æ‰€éœ€çš„åˆ†ç±» 123456789menu: home: / || home #é¦–é¡µ about: /about/ || user #å…³äº tags: /tags/ || tags #æ ‡ç­¾ categories: /categories/ || th #ç›®å½• archives: /archives/ || archive #å½’æ¡£ #schedule: /schedule/ || calendar #æ—¥ç¨‹ sitemap: /sitemap.xml || sitemap #ç«™ç‚¹åœ°å›¾ commonweal: /404/ || heartbeat #å…¬ç›Š404 åœ¨menu_settingså¦‚æœè®¾ç½®icon: falseåˆ™æ— å›¾æ ‡ï¼Œbadges: trueåˆ™æ ‡ç­¾éƒ½ä¼šæ˜¾ç¤ºæ•°å­— 123menu_settings: icons: true badges: false &lt;font color="red"&gt;æ³¨:&lt;/font&gt;è¿™é‡Œéœ€è¦åˆ›å»ºabouté¡µé¢ï¼Œå¾ˆç®€å•ï¼ŒåŒç†åˆ›å»ºæ ‡ç­¾tagsã€å½’æ¡£archivesé¡µé¢ä¸€æ ·çš„æ–¹å¼ï¼Œæ‰€éœ€è¦åˆ›å»ºçš„åç§°è¦ä¸menuç›¸å¯¹åº”ï¼Œä¸¾ä¾‹è¯´æ˜å¦‚ä¸‹ã€‚ 12$ hexo new page about #çœ‹çœ‹menuä¸Šè¿˜æœ‰ä»€ä¹ˆæ ‡ç­¾æ²¡åˆ›å»ºå°±è¡Œåˆ›å»º$ hexo new page tags #åˆ›å»ºæ ‡ç­¾ç­‰ åˆ›å»ºå®Œæˆä¹‹ååœ¨è‡ªå·±é¡¹ç›®æŸ¥æ‰¾ï¼Œå¦‚æˆ‘çš„æ˜¯githubBlog/source/ç›®å½•ä¸‹æŸ¥çœ‹æ–°åˆ›å»ºå¥½çš„ç›¸å…³æ ‡ç­¾é¡µé¢ï¼Œé‡Œé¢åŒ…å«å„è‡ªçš„index.mdæ–‡ä»¶ï¼Œå¤§å®¶å¯ä»¥è‡ªè¡Œç¼–è¾‘äº†ã€‚ Schemesæ–¹æ¡ˆè®¾ç½® 12345# Schemes#scheme: Muse #è¿™æ˜¯ Nexé»˜è®¤ç‰ˆæœ¬ï¼Œé»‘ç™½ä¸»è°ƒï¼Œå¤§é‡ç•™ç™½ #scheme: Mist #Muse çš„ç´§å‡‘ç‰ˆæœ¬ï¼Œæ•´æ´æœ‰åºçš„å•æ å¤–è§‚#scheme: Pisces #åŒæ  Schemeï¼Œå°å®¶ç¢§ç‰ä¼¼çš„æ¸…æ–°scheme: Gemini #åŒå­åº§ï¼Œä¹Ÿæ˜¯åŒæ å½¢å¼ï¼Œå’ŒPiscesç±»ä¼¼ è‡ªå·±å–œæ¬¢ä»€ä¹ˆé£æ ¼è‡ªè¡Œé€‰æ‹©ã€‚ socialè®¾ç½® ä½¿ç”¨æ–¹å¼: Key: permalink || icon Keyè¡¨ç¤ºæ ‡ç­¾æ˜¾ç¤ºï¼Œpermalinkè¡¨ç¤ºURIè¿æ¥ï¼Œiconè¡¨ç¤ºå›¾æ ‡ï¼Œè‡ªå·±æ·»åŠ æ‰€è¦æ˜¾ç¤ºçš„ï¼Œ 12345678910111213141516171819social: GitHub: https://github.com/whb1990 || github E-Mail: mailto:whbsurpass@163.com || envelope QQ: 270028806 || qq å¾®ä¿¡: yan521bo ||weixin #Weibo: https://weibo.com/yourname || weibo #Google: https://plus.google.com/yourname || google #Twitter: https://twitter.com/yourname || twitter #FB Page: https://www.facebook.com/yourname || facebook #VK Group: https://vk.com/yourname || vk #StackOverflow: https://stackoverflow.com/yourname || stack-overflow #YouTube: https://youtube.com/yourname || youtube #Instagram: https://instagram.com/yourname || instagram #Skype: skype:yourname?call|chat || skypesocial_icons: #è®¾ç½®å›¾æ ‡æ˜¯å¦æ˜¾ç¤ºè¿™é‡Œ enable: true #è¡¨ç¤ºå¼€å¯ icons_only: false #åªæ˜¾ç¤ºå›¾ç‰‡ transition: false &lt;font color="red"&gt;æ³¨ï¼š&lt;/font&gt;å›¾æ ‡åº“æ¥æº [https://fontawesome.com/icons?from=io] ï¼Œåœ¨scheme: Piscesè¯¥æ•ˆæœä¸æ˜¾ç¤ºã€‚ avatarå¤´åƒè®¾ç½® 12345678910111213avatar: # In theme directory (source/images): /images/avatar.gif # In site directory (source/uploads): /uploads/avatar.gif # You can also use other linking images. url: /images/avatar.jpg # If true, the avatar would be dispalyed in circle. #åœ†å½¢æ¡† rounded: true # The value of opacity should be choose from 0 to 1 to set the opacity of the avatar. opacity: 1 # If true, the avatar would be rotated with the cursor. #å¤´åƒæ˜¯å¦æ—‹è½¬ rotated: true tocè¾¹æ ä¸­çš„ç›®å½•è®¾ç½® 12345678910toc: #è¾¹æ è®¾ç½® enable: true #æ˜¯å¦å¯ç”¨è¾¹æ  # Automatically add list number to toc. number: true #è‡ªåŠ¨å°†åˆ—è¡¨ç¼–å·æ·»åŠ åˆ°toc # If true, all words will placed on next lines if header width longer then sidebar width. wrap: false #trueæ—¶æ˜¯å½“æ ‡é¢˜å®½åº¦å¾ˆé•¿æ—¶ï¼Œè‡ªåŠ¨æ¢åˆ°ä¸‹ä¸€è¡Œ # If true, all level of TOC in a post will be displayed, rather than the activated part of it. expand_all: false #æŠ˜å  # Maximum heading depth of generated toc. You can set it in one post through `toc_max_depth` in Front-matter. max_depth: 6 #æœ€å¤§æ·±åº¦ Creative Commons 4.0å›½é™…è®¸å¯è®¾ç½® 12# Available: by | by-nc | by-nc-nd | by-nc-sa | by-nd | by-sa | zerocreative_commons: by-nc-sa sidebarä¾§è¾¹æ é…ç½®è¿™é‡Œé€‰æ‹©é»˜è®¤å§ 1234567891011121314151617181920212223sidebar: # Sidebar Position, available values: left | right (only for Pisces | Gemini). position: left #position: right # Manual define the sidebar width. If commented, will be default for: # Muse | Mist: 320 # Pisces | Gemini: 240 width: 240 # Sidebar Display, available values (only for Muse | Mist): # - post expand on posts automatically. Default. # - always expand for all pages automatically. # - hide expand only when click on the sidebar toggle icon. # - remove totally remove sidebar including sidebar toggle. display: post # Sidebar offset from top menubar in pixels (only for Pisces | Gemini). offset: 12 # Enable sidebar on narrow view (only for Muse | Mist). onmobile: true # Click any blank part of the page to close sidebar (only for Muse | Mist). dimmer: false save_scrollé…ç½® 12# Automatically saving scroll position on each post / page in cookies.save_scroll: false #æ˜¯å¦åœ¨Cookieä¸­è‡ªåŠ¨ä¿å­˜æ¯ä¸ªå¸–å­/é¡µé¢ä¸Šçš„æ»šåŠ¨ä½ç½®ã€‚ excerpt_description 12# Automatically excerpt description in homepage as preamble text.excerpt_description: false #æ˜¯å¦è‡ªåŠ¨æ‘˜å½•ä¸»é¡µä¸­çš„æè¿°ä½œä¸ºå‰å¯¼æ–‡æœ¬ã€‚ auto_excerpté…ç½® 123auto_excerpt: enable: true #æ˜¯å¦è‡ªåŠ¨æ‘˜å½•ã€‚ä¸æ¨è length: 150 #è¿™é‡Œæ˜¯è¯´æ–‡ç« å¼€å¤´ç¬¬ä¸€ä¸ªå­—åˆ°ç¬¬150ä¸ªå­—å°±æ˜¾ç¤º"é˜…è¯»å…¨æ–‡" codeblockä»£ç å—é…ç½® 1234567891011121314codeblock: # Code Highlight theme # Available values: normal | night | night eighties | night blue | night bright # See: https://github.com/chriskempson/tomorrow-theme highlight_theme: normal #ä»£ç çªå‡ºæ˜¾ç¤ºä¸»é¢˜ # Manual define the border radius in codeblock, leave it blank for the default value: 1 border_radius: 1 # Add copy button on codeblock copy_button: enable: true # Show text copy result. show_result: true # Available values: default | flat | mac style: flat wechat_subscriberå¾®ä¿¡é…ç½® 1234wechat_subscriber: enabled: true #æ˜¯å¦å¯åŠ¨å¾®ä¿¡è®¢é˜… qcode: /path/to/your/wechatqcode ex. /uploads/wechat-qcode.jpg description: ex. subscribe to my blog by scanning my public wechat account footer åº•éƒ¨è®¾ç½® 12345678910111213141516171819202122232425262728footer: # Specify the date when the site was setup. If not defined, current year will be used. since: 2019 #å»ºç«™å¼€å§‹æ—¶é—´ # Icon between year and copyright info. icon: # Icon name in Font Awesome. See: https://fontawesome.com/v4.7.0/icons/ # `heart` is recommended with animation in red (#ff0000). name: heart #è®¾ç½®å›¾æ ‡ï¼Œæƒ³ä¿®æ”¹å›¾æ ‡ä»https://fontawesome.com/v4.7.0/iconsè·å– # If you want to animate the icon, set it to true. animated: true # Change the color of icon, using Hex Code. color: "#ff0000" # If not defined, `author` from Hexo `_config.yml` will be used. copyright: Â©2019 by ç‹æ´ªåš #ç‰ˆæƒ powered: # Hexo link (Powered by Hexo). enable: true ##æ˜¯å¦æ˜¾ç¤ºHexo link # Version info of Hexo after Hexo link (vX.X.X). version: true #æ˜¯å¦æ˜¾ç¤ºHexoç‰ˆæœ¬ theme: # Theme &amp; scheme info link (Theme - NexT.scheme). enable: true #æ˜¯å¦æ˜¾ç¤ºNexTä¸»é¢˜ # Version info of NexT after scheme info (vX.X.X). version: true #æ˜¯å¦æ˜¾ç¤ºNexTç‰ˆæœ¬ faviconæ ‡ç­¾é¡µå›¾æ ‡ 12345favicon: small: /images/favicon-16x16-next.png #å°å›¾æ ‡ é»˜è®¤çš„NexT medium: /images/favicon-32x32-next.png #ä¸­å›¾æ ‡ é»˜è®¤NexT apple_touch_icon: /images/apple-touch-icon-next.png #è‹¹æœè§¦æ‘¸å›¾æ ‡ safari_pinned_tab: /images/logo.svg #safariå›ºå®šæ ‡ç­¾ Math Equations Render Support æ•°å­¦æ–¹ç¨‹å¼æ¸²æŸ“æ”¯æŒ 12345678math: enable: true #é»˜è®¤ä¸ºfalse per_page: true engine: mathjax #ä¸¤ç§æ–¹å¼ mathjax / katex mathjax: cdn: //cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML #é»˜è®¤ è¿™é‡Œå¤§å®¶æ ¹æ®è‡ªå·±éœ€æ±‚ katex: cdn: //cdn.jsdelivr.net/npm/katex@0.7.1/dist/katex.min.css #é»˜è®¤ 16 .Han Support æ”¯æŒæ±‰å­— è®¾ç½®æ±‰å­—æ”¯æŒï¼ŒæŒ‰ç…§ä»¥ä¸‹æ­¥éª¤ï¼š æ‰“å¼€Git Bash Here,è¿›å…¥theme/nextç›®å½•ä¸‹ 1$ cd themes/next è·å–è¯¥æ±‰å­—æ”¯æŒGit module,æ‰§è¡Œå‘½ä»¤ä»¥ä¸‹å‘½ä»¤è·å¾— 1$ git clone https://github.com/theme-next/theme-next-han source/lib/Han è®¾ç½®æ±‰å­—æ”¯æŒ 1han: true æ›´æ–°update 12$ cd themes/next/source/lib/Han$ git pull fontå­—ä½“è®¾ç½® 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647font: # Use custom fonts families or not. # Depended options: `external` and `family`. enable: true #é»˜è®¤false å¦‚æœè¦è¿›è¡Œå­—ä½“ä¿®æ”¹é‚£ä¹ˆè®¾ç½®ä¸ºtrue # Uri of fonts host, e.g. //fonts.googleapis.com (Default). host: //fonts.lug.ustc.edu.cn # Font options: # `external: true` will load this font family from `host` above. # `family: Times New Roman`. Without any quotes. # `size: x.x`. Use `em` as unit. Default: 1 (16px) # Global font settings used for all elements inside &lt;body&gt;. global: external: true family: Lato size: # Font settings for site title (.site-title). title: external: true family: size: # Font settings for headlines (&lt;h1&gt; to &lt;h6&gt;). headings: external: true family: Roboto Slab size: # Font settings for posts (.post-body). posts: external: true family: # Font settings for &lt;code&gt; and code blocks. codes: external: true family: Roboto Mono # Font settings for Logo. # Fallback to `global` font settings. logo: external: true family: size: æ·»åŠ å›¾æ ‡é“¾æ¥åˆ°GitHub ä¸€èˆ¬åœ¨å³ä¸Šè§’æˆ–è€…å·¦ä¸Šè§’ï¼Œå¦‚é…ç½®å³ä¸Šè§’Fork_me_on_GitHub,æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œ æ‰“å¼€ Fork_me_on_GitHub é“¾æ¥ï¼Œé‡Œé¢æœ‰è®¸å¤šæ ·å¼ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ ·å¼ï¼Œå°†å…¶å¤åˆ¶ä¸‹æ¥ã€‚ æ‰“å¼€è‡ªå·±åšå®¢é¡¹ç›®ä¸­çš„themes/next/layout/_layout.swigæ–‡ä»¶ï¼Œæœç´¢&lt;div class="headband"&gt;&lt;/div&gt; å°†å¤åˆ¶çš„å†…å®¹ç²˜è´´åˆ°&lt;div class="headband"&gt;&lt;/div&gt;ä¸‹é¢ï¼Œå¦‚ä¸‹ï¼š é…ç½®å³ä¸Šè§’çš„Fork_me_on_GitHub: ä¿®æ”¹æ–‡ç« åº•éƒ¨æ ‡ç­¾ åœ¨åšå®¢é¡¹ç›®ä¸­æ‰¾åˆ°/themes/next/layout/_macro/post.swigï¼Œæœç´¢ rel="tag"ï¼Œå°† #å· æ¢æˆ&lt;i class="fa fa-tag"&gt;&lt;/i&gt; åŸå…ˆ#å·çš„æ ·å¼ ä¿®æ”¹ä¸ºå›¾æ ‡çš„æ ·å¼ è®¾ç½®èƒŒæ™¯åŠ¨ç”»æ ·å¼ NexTé‡Œé¢æœ‰å‡ ç§åŠ¨ç”»èƒŒæ™¯æ ·å¼canvas_nestã€three_wavesã€canvas_linesã€canvas_sphereç­‰ canvas_nestå¦‚ä¸‹å›¾æ‰€ç¤º: æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤å®Œæˆ æ‰“å¼€Git Bash Hereè¿›å…¥è‡ªå·±æ–‡ä»¶å¤¹ä¸‹/themes/nextæ–‡ä»¶å¤¹ä¸‹ 1$ cd /themes/next ä¸‹è½½å®‰è£… canvas_nest module æ‰§è¡Œ 1$ git clone https://github.com/theme-next/theme-next-canvas-nest source/lib/canvas-nest åœ¨ /themes/next/source/libæŸ¥çœ‹ä¼šçœ‹åˆ°canvas_nestæ–‡ä»¶å¤¹ åœ¨/themes/next/_config.ymlè®¾ç½® 1canvas_nest: true three_waveså¦‚å›¾æ‰€ç¤º three_waves è®¾ç½®æ­¥éª¤ï¼Œå’Œ canvas_nest æ­¥éª¤æ˜¯ä¸€æ ·çš„ã€‚ ä¸‹è½½å®Œæˆåï¼Œåœ¨/themes/next/_config.ymlè®¾ç½® 12345three_waves: true#ORcanvas_lines: true#ORcanvas_sphere: true canvas_ribbon canvas_ribbonåªé€‚åˆ scheme Pisces è¿™é‡Œä¸æµ‹è¯•äº†ï¼Œå¤§å®¶å¯ä»¥è¿›å…¥ canvas_ribbon å®‰è£…ã€‚ åœ¨ç½‘ç«™åº•éƒ¨æ·»åŠ è®¿é—®é‡ è¿›å…¥ \themes\next\layout\_partials\footer.swig æ–‡ä»¶é¡¶éƒ¨ç¬¬ä¸€è¡Œæ·»åŠ  1&lt;script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"&gt;&lt;/script&gt; æœç´¢ 1{% if theme.footer.powered.enable %} åœ¨è¿™ä¸ªä½ç½®ä¸Šæ·»åŠ ä»¥ä¸‹ä»£ç : 12345&lt;div class="powered-by"&gt;&lt;i class="fa fa-user-md"&gt;&lt;/i&gt;&lt;span id="busuanzi_container_site_uv"&gt; æœ¬ç«™è®¿å®¢æ•°:&lt;span id="busuanzi_value_site_uv"&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt; æ³¨ï¼šè¿™é‡Œçš„idå€¼å¯ä»¥é€‰æ‹©ä¸¤ç§ 12busuanzi_value_site_uv #è¡¨ç¤ºç”¨æˆ·è¿ç»­ç‚¹å‡»nç¯‡æ–‡ç« ï¼Œåªè®°å½•1æ¬¡è®¿å®¢æ•°busuanzi_value_site_pv #è¡¨ç¤ºç”¨æˆ·è¿ç»­ç‚¹å‡»nç¯‡æ–‡ç« ï¼Œè®°å½•+næ¬¡è®¿é—®é‡ è¿™é‡Œå¯¹åº”çš„æ˜¯2ä¸Šçš„idå€¼ ç»™æ¯ç¯‡æ–‡ç« æ·»åŠ ç±»åˆ«å’Œæ ‡ç­¾ åœ¨åˆ›å»ºçš„æ–‡ç« éƒ½åœ¨source/_postç›®å½•ä¸‹æ‰¾åˆ°ï¼Œæ¯ç¯‡æ–‡ç« æ·»åŠ tagsã€categories æ·»åŠ è¿›åº¦æ¡ æ·»åŠ è¿›åº¦æ¡çš„è¯åœ¨æ‰‹æœºæµè§ˆçš„æ—¶å€™ä¸€èˆ¬æƒ…å†µéƒ½æœ‰è‡ªå¸¦çš„è¿›åº¦æ¡äº†ï¼Œä¾‹å¦‚å¾®ä¿¡æµè§ˆã€æµè§ˆå™¨æµè§ˆç­‰ç­‰ï¼Œè¿™æ ·å°±å‡ºç°é‡å¤çš„è¿›åº¦æ¡äº†ï¼Œè¿™é‡Œçœ‹ä¸ªäººæ˜¯å¦æ·»åŠ ã€‚ä½†æ˜¯åœ¨ç”µè„‘æµè§ˆå™¨æµè§ˆå´æ˜¯ä¸é”™çš„ã€‚ æœ¬ä¾‹è®¾ç½®çš„å¦‚ä¸‹pace-theme-center-circleæ˜¾ç¤º æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæˆ–è€…è¿›å…¥è¿™é‡Œ Progressé…ç½® æŸ¥çœ‹å¦‚ä½•é…ç½® æ‰“å¼€Git Bash Hereè¿›å…¥è‡ªå·±æ–‡ä»¶å¤¹ä¸‹/themes/nextæ–‡ä»¶å¤¹ä¸‹ 1$ cd /themes/next ä¸‹è½½å®‰è£… Progress module æ‰§è¡Œ 1$ git clone https://github.com/theme-next/theme-next-pace source/lib/pace åœ¨ /themes/next/source/libæŸ¥çœ‹ä¼šçœ‹åˆ°paceæ–‡ä»¶å¤¹ åœ¨/themes/next/_config.ymlè®¾ç½® 123456pace: enable: true # Themes list: # big-counter | bounce | barber-shop | center-atom | center-circle | center-radar | center-simple # corner-indicator | fill-left | flat-top | flash | loading-bar | mac-osx | material | minimal theme: minimal #ä»»é€‰ä¸€ç§ æ·»åŠ ç«™å†…æœç´¢ ç”±äºå¯èƒ½éœ€è¦å¿«é€ŸæŸ¥æ‰¾ç›¸å…³æ–‡ç« ï¼Œé‚£ä¹ˆå°±éœ€è¦æ·»åŠ ç«™å†…æœç´¢ã€‚ æŒ‰ä»¥ä¸‹æ­¥éª¤è¿›è¡Œæˆ–è€…è¿›å…¥ NexTé…ç½®ç«™å†…æœç´¢ æ–‡æ¡£æŸ¥çœ‹å¦‚ä½•é…ç½® å®‰è£…ç«™å†…æœç´¢æ’ä»¶ 123$ npm install hexo-generator-searchdb --saveæˆ–è€…$ cnpm install hexo-generator-searchdb --save åœ¨æ ¹ç›®å½•ä¸‹çš„_config.ymlæ·»åŠ  123456#è¡¨ç¤ºç«™å†…æœç´¢search: path: search.xml field: post format: html limit: 10000 åœ¨themes/next/_config.ymlæ–‡ä»¶ä¸­æœç´¢local_search,è¿›è¡Œè®¾ç½® 12345local_search: enable: true #è®¾ç½®ä¸ºtrue trigger: auto # auto / manualï¼Œauto è‡ªåŠ¨æœç´¢ã€manualï¼šæŒ‰å›è½¦[enter ]é”®æ‰‹åŠ¨æœç´¢ top_n_per_article: 1 unescape: true æ·»åŠ æ‰“èµ NexTä¸»è¦æä¾›ä¸‰ç§æ‰“èµæ–¹å¼åˆ†åˆ«æ˜¯å¾®ä¿¡ã€æ”¯ä»˜å®ã€æ¯”ç‰¹å¸ åœ¨themes/nextæœç´¢Rewardï¼š 123456reward_settings: # If true, reward would be displayed in every article by default. # You can show or hide reward in a specific article throuth `reward: true | false` in Front-matter. enable: true #å¯ç”¨æ‰“èµ animation: true #å¯ç”¨åŠ¨ç”»æ•ˆæœ comment: æèµ ä½œè€…è¯·ç‚¹å‡»ä¸‹æ–¹çš„â€œæ‰“èµâ€æŒ‰é’® #å†…å®¹ å‹æƒ…é“¾æ¥ 12345678# Blog rolls #å‹æƒ…é“¾æ¥links_icon: linklinks_title: å‹æƒ…é“¾æ¥links_layout: block#links_layout: inlinelinks: Eirunye: http://eirunye.github.io/ #æ‰€éœ€æ·»åŠ çš„å‹æƒ…é“¾æ¥ Titleæ˜¯è¡¨ç¤ºå‹æƒ…é“¾æ¥çš„åšå®¢åç§°æˆ–è€…éšæ„ä½ å–ï¼Œåé¢æ˜¯é“¾æ¥ï¼Œå†’å·åé¢è®°å¾—ç©ºæ ¼ ç¨‹æ™“æ˜: https://www.infoq.cn/profile/1278512 æ·»åŠ é˜…è¯»ç»Ÿè®¡ ç»™æ¯ç¯‡æ–‡ç« è¿›è¡Œæ·»åŠ é˜…è¯»ç»Ÿè®¡ï¼Œæ•ˆæœå¦‚ä¸‹å›¾: è¿›å…¥ leancloud åˆ›å»ºåº”ç”¨ è¿›å…¥è®¾ç½®é¡µé¢è·å–åº”ç”¨Key å°†App IDã€App Key é…ç½®åˆ°next/_config.ymlä¸­leancloud_visitors 1234567leancloud_visitors: enable: true è®¾ç½®ä¸ºtrue é»˜è®¤ä¸ºfalse app_id: #ä½ çš„App IDï¼Œæ³¨æ„å†’å·åé¢ç©ºæ ¼ app_key: #ä½ çš„App Keyï¼Œæ³¨æ„å†’å·åé¢ç©ºæ ¼ Dependencies: https://github.com/theme-next/hexo-leancloud-counter-security #è®¾ç½®ä¾èµ– security: true #å¦‚æœæ‚¨ä¸å…³å¿ƒlcè®¡æ•°å™¨ä¸­çš„å®‰å…¨æ€§å¹¶ä¸”åªæƒ³ç›´æ¥ä½¿ç”¨å®ƒï¼ˆæ²¡æœ‰hexo-leancloud-counter-securityæ’ä»¶ï¼‰ï¼Œè¯·å°†`security`è®¾ç½®ä¸º`false`ã€‚ betterPerformance: true#æ›´å¥½çš„æ€§èƒ½ åœ¨leancloudå­˜å‚¨çš„ä½ç½®åˆ›å»ºClass,å¿…é¡»å‘½åä¸ºCounter æŸ¥çœ‹åå°ç»Ÿè®¡æ•°æ® æ·»åŠ è¯„è®º æˆ‘çš„åšå®¢é€‰æ‹©çš„æ˜¯Valineã€‚ åœ¨next/_config.ymlæœç´¢Valine,è¿›å…¥ Valine å®˜ç½‘ï¼Œä¹Ÿæ˜¯ leancloud å®˜ç½‘ï¼Œè¿›å…¥leancloud æ§åˆ¶å°,æ²¡æœ‰è´¦å·å¯†ç å°±è¿›è¡Œè®¾ç½®ã€‚ åˆ›å»ºåº”ç”¨ å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„åˆ›å»ºåº”ç”¨ã€‚ è¿›å…¥è®¾ç½®é¡µé¢è·å–åº”ç”¨key å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„è¿›å…¥è®¾ç½®é¡µé¢è·å–åº”ç”¨keyã€‚ åœ¨next/_config.ymlè¿›è¡Œé…ç½®ã€‚ 1234567891011valine: enable: true # è®¾ç½®ä¸ºtrueï¼Œé»˜è®¤ä¸ºfalse appid: # å°†åº”ç”¨keyçš„App IDè®¾ç½®åœ¨è¿™é‡Œ appkey: # å°†åº”ç”¨keyçš„App Keyè®¾ç½®åœ¨è¿™é‡Œ notify: true# é‚®ç®±é€šçŸ¥ , https://github.com/xCss/Valine/wikiï¼Œé»˜è®¤ä¸ºfalse verify: true# éªŒè¯ç  é»˜è®¤ä¸ºfalse placeholder: Just go go ^_^ # åˆå§‹åŒ–è¯„è®ºæ˜¾ç¤ºï¼Œæ ¹æ®è‡ªå·±ä¿®æ”¹ï¼Œè¿™é‡Œé»˜è®¤ï¼Œ avatar: wavatar # å¤´åƒé£æ ¼ï¼Œé»˜è®¤ä¸ºmmï¼Œå¯è¿›å…¥ç½‘å€ï¼šhttps://valine.js.org/visitor.htmlæŸ¥çœ‹å¤´åƒè®¾ç½®ï¼Œè¿™é‡Œæœ‰è®¸å¤šå¤´åƒé£æ ¼ï¼Œè¿›è¡Œè®¾ç½® guest_info: nick,mail,link # è‡ªå®šä¹‰è¯„è®ºæ ‡é¢˜ pageSize: 10 # åˆ†é¡µå¤§å°ï¼Œ10é¡µå°±è‡ªåŠ¨åˆ†é¡µ visitor: true # æ˜¯å¦å…è®¸æ¸¸å®¢è¯„è®º ï¼Œè¿›å…¥å®˜ç½‘æŸ¥çœ‹è®¾ç½®ï¼šhttps://valine.js.org/visitor.html æ˜¾ç¤ºç»“æœ è¿™æ ·å°±å®Œæˆäº†valineè¯„è®ºçš„é…ç½®äº†ï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥è¿›è¡Œè¯„è®ºäº†ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨åå°æŸ¥çœ‹è¯„è®ºä¿¡æ¯ã€‚ åœ¨åå°æŸ¥çœ‹è¯„è®ºæ•°æ® åœ¨valineåå°ï¼Œå­˜å‚¨ä½ç½®ä¸­çš„æ•°æ®é‡Œé¢åˆ›å»ºClassï¼Œåç§°å¿…é¡»ä¸ºå‘½åä¸ºComment å‚è€ƒä¸Šé¢ æ·»åŠ é˜…è¯»ç»Ÿè®¡ çš„åˆ›å»ºClassã€‚ &lt;font color="red"&gt;æ³¨ï¼š&lt;/font&gt;é€‰æ‹©valineè¯„è®ºç³»ç»Ÿæ˜¯å› ä¸ºæ”¯æŒå›½å†…ç½‘ç»œï¼Œä¸éœ€è¦è¿æ¥å¤–ç½‘ï¼ˆç¿»å¢™ï¼‰å°±å¯ä»¥è¿›è¡Œæ˜¾ç¤ºè¯„è®ºç³»ç»Ÿï¼Œè€Œä¸”å¾ˆå¥½ç®¡ç†ï¼Œé¡µé¢ç®€å•ã€‚ æ·»åŠ RSS æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³•ï¼š åˆ‡æ¢åˆ°ä½ çš„blogæ ¹ç›®å½•ä¸‹ï¼Œç„¶åå®‰è£… Hexo æ’ä»¶ï¼š(è¿™ä¸ªæ’ä»¶ä¼šæ”¾åœ¨node_modulesè¿™ä¸ªæ–‡ä»¶å¤¹é‡Œ) 1$ cnpm install --save hexo-generator-feed ç„¶ååœ¨æ ¹ç›®å½•çš„ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlä¸‹è¿›è¡Œé…ç½® 12## Plugins: http://hexo.io/plugins/plugins: hexo-generate-feed # RSSè®¢é˜… ç„¶åæ‰“å¼€nextä¸»é¢˜æ–‡ä»¶å¤¹é‡Œé¢çš„_config.yml,åœ¨é‡Œé¢é…ç½®ä¸ºå¦‚ä¸‹ï¼š 1234# Set rss to false to disable feed link.# Leave rss as empty to use site's feed link.# Set rss to specific value if you have burned your feed already.rss: /atom.xml ç‚¹å‡»å‡ºç°æ¡ƒå¿ƒæ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• æ‰“å¼€æµè§ˆå™¨ï¼Œè¾“å…¥ï¼š http://7u2ss1.com1.z0.glb.clouddn.com/love.js ç„¶åå°†é‡Œé¢çš„ä»£ç copyä¸€ä¸‹ï¼Œæ–°å»ºlove.jsæ–‡ä»¶å¹¶ä¸”å°†ä»£ç å¤åˆ¶è¿›å»ï¼Œç„¶åä¿å­˜ã€‚ å°†love.jsæ–‡ä»¶æ”¾åˆ°è·¯å¾„/themes/next/source/js/srcé‡Œé¢ï¼Œç„¶åæ‰“å¼€\themes\next\layout\_layout.swigæ–‡ä»¶,åœ¨æœ«å°¾ï¼ˆåœ¨å‰é¢å¼•ç”¨ä¼šå‡ºç°æ‰¾ä¸åˆ°çš„bugï¼‰æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 12&lt;!-- é¡µé¢ç‚¹å‡»å°çº¢å¿ƒ --&gt;&lt;script type="text/javascript" src="/js/src/love.js"&gt;&lt;/script&gt; ä¿®æ”¹æ–‡ç« å†…é“¾æ¥æ–‡æœ¬æ ·å¼ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• ä¿®æ”¹æ–‡ä»¶ themes\next\source\css\_common\components\post\post.stylï¼Œåœ¨æœ«å°¾æ·»åŠ å¦‚ä¸‹cssæ ·å¼ï¼š 1234567891011// æ–‡ç« å†…é“¾æ¥æ–‡æœ¬æ ·å¼.post-body p a{ color: #0593d3; border-bottom: none; border-bottom: 1px solid #0593d3; &amp;:hover { color: #fc6423; border-bottom: none; border-bottom: 1px solid #fc6423; }} å…¶ä¸­é€‰æ‹©.post-body æ˜¯ä¸ºäº†ä¸å½±å“æ ‡é¢˜ï¼Œé€‰æ‹© p æ˜¯ä¸ºäº†ä¸å½±å“é¦–é¡µâ€œé˜…è¯»å…¨æ–‡â€çš„æ˜¾ç¤ºæ ·å¼,é¢œè‰²å¯ä»¥è‡ªå·±å®šä¹‰ã€‚ åœ¨æ¯ç¯‡æ–‡ç« æœ«å°¾ç»Ÿä¸€æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®° æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨è·¯å¾„ \themes\next\layout\_macro ä¸­æ–°å»º passage-end-tag.swig æ–‡ä»¶,å¹¶æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼š 12345&lt;div&gt; {% if not is_index %} &lt;div style="text-align:center;color: #ccc;font-size:14px;"&gt;-------------æœ¬æ–‡ç»“æŸ&lt;i class="fa fa-paw"&gt;&lt;/i&gt;æ„Ÿè°¢æ‚¨çš„é˜…è¯»-------------&lt;/div&gt; {% endif %}&lt;/div&gt; æ¥ç€æ‰“å¼€\themes\next\layout\_macro\post.swigæ–‡ä»¶ï¼Œåœ¨post-body ä¹‹åï¼Œ post-footer ä¹‹å‰æ·»åŠ å¦‚ä¸‹ç”»çº¢è‰²éƒ¨åˆ†ä»£ç ï¼ˆpost-footerä¹‹å‰ä¸¤ä¸ªDIVï¼‰ï¼š 12345&lt;div&gt; {% if not is_index %} {% include 'passage-end-tag.swig' %} {% endif %}&lt;/div&gt; ç„¶åæ‰“å¼€ä¸»é¢˜é…ç½®æ–‡ä»¶ï¼ˆ_config.yml),åœ¨æœ«å°¾æ·»åŠ ï¼š 123# æ–‡ç« æœ«å°¾æ·»åŠ â€œæœ¬æ–‡ç»“æŸâ€æ ‡è®°passage_end_tag: enabled: true ä¿®æ”¹``ä»£ç å—è‡ªå®šä¹‰æ ·å¼ æ•ˆæœå¦‚ä¸‹ï¼š å®ç°æ–¹æ³• æ‰“å¼€\themes\next\source\css\_custom\custom.styl,å‘é‡Œé¢åŠ å…¥ï¼š(é¢œè‰²å¯ä»¥è‡ªå·±å®šä¹‰) 123456789101112131415// Custom styles.code { color: #ff7600; background: #fbf7f8; margin: 2px;}// å¤§ä»£ç å—çš„è‡ªå®šä¹‰æ ·å¼.highlight, pre { margin: 5px 0; padding: 5px; border-radius: 3px;}.highlight, code, pre { border: 1px solid #d6d6d6;} ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• æ‰“å¼€\themes\next\source\css\_custom\custom.styl,å‘é‡Œé¢åŠ å…¥ï¼š 12345678// ä¸»é¡µæ–‡ç« æ·»åŠ é˜´å½±æ•ˆæœ .post { margin-top: 60px; margin-bottom: 60px; padding: 25px; -webkit-box-shadow: 0 0 5px rgba(202, 203, 203, .5); -moz-box-shadow: 0 0 5px rgba(202, 203, 204, .5); } æ·»åŠ çƒ­åº¦ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• nextä¸»é¢˜é›†æˆleanCloudï¼Œæ‰“å¼€/themes/next/layout/_macro/post.swig,åœ¨ç”»çº¢çº¿çš„åŒºåŸŸæ·»åŠ â„ƒï¼š ç„¶åæ‰“å¼€ï¼Œ/themes/next/languages/zh-Hans.yml,å°†ç”»çº¢æ¡†çš„æ”¹ä¸ºçƒ­åº¦å°±å¯ä»¥äº†: ç½‘ç«™åº•éƒ¨å­—æ•°ç»Ÿè®¡ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åˆ‡æ¢åˆ°æ ¹ç›®å½•ä¸‹ï¼Œç„¶åè¿è¡Œå¦‚ä¸‹ä»£ç  1$ cnpm install hexo-wordcount --save ç„¶ååœ¨/themes/next/layout/_partials/footer.swigæ–‡ä»¶å°¾éƒ¨åŠ ä¸Šï¼š 1234&lt;div class="theme-info"&gt; &lt;div class="powered-by"&gt;&lt;/div&gt; &lt;span class="post-count"&gt;ç«™ç‚¹æ€»å­—æ•°{{ totalcount(site) }}å­—&lt;/span&gt;&lt;/div&gt; æ·»åŠ  README.md æ–‡ä»¶ æ¯ä¸ªé¡¹ç›®ä¸‹ä¸€èˆ¬éƒ½æœ‰ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œä½†æ˜¯ä½¿ç”¨ hexo éƒ¨ç½²åˆ°ä»“åº“åï¼Œé¡¹ç›®ä¸‹æ˜¯æ²¡æœ‰ README.md æ–‡ä»¶çš„ã€‚ åœ¨ Hexo ç›®å½•ä¸‹çš„ source æ ¹ç›®å½•ä¸‹æ·»åŠ ä¸€ä¸ª README.md æ–‡ä»¶ï¼Œä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ _config.ymlï¼Œå°† skip_render å‚æ•°çš„å€¼è®¾ç½®ä¸º 1skip_render: README.md ä¿å­˜é€€å‡ºå³å¯ã€‚å†æ¬¡ä½¿ç”¨ hexo d å‘½ä»¤éƒ¨ç½²åšå®¢çš„æ—¶å€™å°±ä¸ä¼šåœ¨æ¸²æŸ“ README.md è¿™ä¸ªæ–‡ä»¶äº†ã€‚ å®ç°ç»Ÿè®¡åŠŸèƒ½ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨æ ¹ç›®å½•ä¸‹å®‰è£… hexo-wordcount,è¿è¡Œï¼š 1$ cnpm install hexo-wordcount --save ç„¶ååœ¨ä¸»é¢˜çš„é…ç½®æ–‡ä»¶ä¸­ï¼Œé…ç½®å¦‚ä¸‹ï¼š 12345678# Post wordcount display settings# Dependencies: https://github.com/willin/hexo-wordcountpost_wordcount: item_text: true wordcount: true #å­—æ•°ç»Ÿè®¡ min2read: true #é˜…è¯»æ—¶é•¿é¢„è®¡ totalcount: true #æ€»å­—æ•°ç»Ÿè®¡ separated_meta: true æ·»åŠ é¡¶éƒ¨åŠ è½½æ¡ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• æ‰“å¼€/themes/next/layout/_partials/head.swigæ–‡ä»¶ï¼Œæ·»åŠ çº¢æ¡†ä¸Šçš„ä»£ç  12&lt;script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"&gt;&lt;/script&gt;&lt;link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet"&gt; ä½†æ˜¯ï¼Œé»˜è®¤çš„æ˜¯ç²‰è‰²çš„ï¼Œè¦æ”¹å˜é¢œè‰²å¯ä»¥åœ¨/themes/next/layout/_partials/head.swigæ–‡ä»¶ä¸­æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆæ¥åœ¨åˆšæ‰linkçš„åé¢ï¼‰ 12345678910111213&lt;style&gt; .pace .pace-progress { background: #1E92FB; /*è¿›åº¦æ¡é¢œè‰²*/ height: 3px; } .pace .pace-progress-inner { box-shadow: 0 0 10px #1E92FB, 0 0 5px #1E92FB; /*é˜´å½±é¢œè‰²*/ } .pace .pace-activity { border-top-color: #1E92FB; /*ä¸Šè¾¹æ¡†é¢œè‰²*/ border-left-color: #1E92FB; /*å·¦è¾¹æ¡†é¢œè‰²*/ }&lt;/style&gt; åœ¨æ–‡ç« åº•éƒ¨å¢åŠ ç‰ˆæƒä¿¡æ¯ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ç›®å½• next/layout/_macro/ä¸‹æ·»åŠ  my-copyright.swigï¼š 1234567891011121314151617181920212223242526272829303132{% if page.copyright %}&lt;div class="my_post_copyright"&gt; &lt;script src="//cdn.bootcss.com/clipboard.js/1.5.10/clipboard.min.js"&gt;&lt;/script&gt; &lt;!-- JSåº“ sweetalert å¯ä¿®æ”¹è·¯å¾„ --&gt; &lt;script src="https://cdn.bootcss.com/jquery/2.0.0/jquery.min.js"&gt;&lt;/script&gt; &lt;script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"&gt;&lt;/script&gt; &lt;p&gt;&lt;span&gt;æœ¬æ–‡æ ‡é¢˜:&lt;/span&gt;&lt;a href="{{ url_for(page.path) }}"&gt;{{ page.title }}&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;æ–‡ç« ä½œè€…:&lt;/span&gt;&lt;a href="/" title="è®¿é—® {{ theme.author }} çš„ä¸ªäººåšå®¢"&gt;{{ theme.author }}&lt;/a&gt;&lt;/p&gt; &lt;p&gt;&lt;span&gt;å‘å¸ƒæ—¶é—´:&lt;/span&gt;{{ page.date.format("YYYYå¹´MMæœˆDDæ—¥ - HH:MM") }}&lt;/p&gt; &lt;p&gt;&lt;span&gt;æœ€åæ›´æ–°:&lt;/span&gt;{{ page.updated.format("YYYYå¹´MMæœˆDDæ—¥ - HH:MM") }}&lt;/p&gt; &lt;p&gt;&lt;span&gt;åŸå§‹é“¾æ¥:&lt;/span&gt;&lt;a href="{{ url_for(page.path) }}" title="{{ page.title }}"&gt;{{ page.permalink }}&lt;/a&gt; &lt;span class="copy-path" title="ç‚¹å‡»å¤åˆ¶æ–‡ç« é“¾æ¥"&gt;&lt;i class="fa fa-clipboard" data-clipboard-text="{{ page.permalink }}" aria-label="å¤åˆ¶æˆåŠŸï¼"&gt;&lt;/i&gt;&lt;/span&gt; &lt;/p&gt; &lt;!-- &lt;p&gt;&lt;span&gt;è®¸å¯åè®®:&lt;/span&gt;&lt;i class="fa fa-creative-commons"&gt;&lt;/i&gt; &lt;a rel="license" href="https://creativecommons.org/licenses/by-nc-nd/4.0/" target="_blank" title="Attribution-NonCommercial-NoDerivatives 4.0 International (CC BY-NC-ND 4.0)"&gt;ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç¦æ­¢æ¼”ç» 4.0 å›½é™…&lt;/a&gt; è½¬è½½è¯·ä¿ç•™åŸæ–‡é“¾æ¥åŠä½œè€…ã€‚&lt;/p&gt; --&gt; &lt;/div&gt;&lt;script&gt; var clipboard = new Clipboard('.fa-clipboard'); $(".fa-clipboard").click(function(){ clipboard.on('success', function(){ swal({ title: "", text: 'å¤åˆ¶æˆåŠŸ', icon: "success", showConfirmButton: true }); }); }); &lt;/script&gt;{% endif %} åœ¨ç›®å½•next/source/css/_common/components/post/ä¸‹æ·»åŠ my-post-copyright.stylï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445.my_post_copyright { width: 85%; max-width: 45em; margin: 2.8em auto 0; padding: 0.5em 1.0em; border: 1px solid #d3d3d3; font-size: 0.93rem; line-height: 1.6em; word-break: break-all; background: rgba(255,255,255,0.4);}.my_post_copyright p{margin:0;}.my_post_copyright span { display: inline-block; width: 5.2em; color: #b5b5b5; font-weight: bold;}.my_post_copyright .raw { margin-left: 1em; width: 5em;}.my_post_copyright a { color: #808080; border-bottom:0;}.my_post_copyright a:hover { color: #a3d2a3; text-decoration: underline;}.my_post_copyright:hover .fa-clipboard { color: #000;}.my_post_copyright .post-url:hover { font-weight: normal;}.my_post_copyright .copy-path { margin-left: 1em; width: 1em; +mobile(){display:none;}}.my_post_copyright .copy-path:hover { color: #808080; cursor: pointer;} ä¿®æ”¹next/layout/_macro/post.swigï¼Œåœ¨ä»£ç  12345&lt;div&gt; {% if not is_index %} {% include 'wechat-subscriber.swig' %} {% endif %}&lt;/div&gt; ä¹‹å‰æ·»åŠ å¢åŠ å¦‚ä¸‹ä»£ç ï¼š 12345&lt;div&gt; {% if not is_index %} {% include 'my-copyright.swig' %} {% endif %}&lt;/div&gt; å¦‚ä¸‹å›¾ï¼š ä¿®æ”¹next/source/css/_common/components/post/post.stylæ–‡ä»¶ï¼Œåœ¨æœ€åä¸€è¡Œå¢åŠ ä»£ç ï¼š 1@import "my-post-copyright" ä¿å­˜é‡æ–°ç”Ÿæˆå³å¯ã€‚å¦‚æœè¦åœ¨è¯¥åšæ–‡ä¸‹é¢å¢åŠ ç‰ˆæƒä¿¡æ¯çš„æ˜¾ç¤ºï¼Œéœ€è¦åœ¨ Markdown ä¸­å¢åŠ copyright: trueçš„è®¾ç½®ï¼Œç±»ä¼¼ï¼š 123456789101112---title: Javaå¹¶å‘-ReentrantLockcopyright: truedate: 2019-08-26 14:59:12updated:tags: - Java - J.U.Ccategories: - Java - J.U.C--- å¦‚æœä½ è§‰å¾—æ¯æ¬¡éƒ½è¦è¾“å…¥copyright: trueå¾ˆéº»çƒ¦çš„è¯,é‚£ä¹ˆåœ¨/scaffolds/post.mdæ–‡ä»¶ä¸­æ·»åŠ ï¼š 1copyright: true è¿™æ ·æ¯æ¬¡hexo new "ä½ çš„å†…å®¹"ä¹‹åï¼Œç”Ÿæˆçš„mdæ–‡ä»¶ä¼šè‡ªåŠ¨æŠŠcopyright:trueåŠ åˆ°é‡Œé¢å»ã€‚ éšè—ç½‘é¡µåº•éƒ¨powered By Hexo / å¼ºåŠ›é©±åŠ¨ æ‰“å¼€themes/next/layout/_partials/footer.swig,éšè—æˆ–åˆ é™¤å¦‚ä¸‹ä»£ç ï¼Œå¦‚ä¸‹å›¾ï¼š ä¿®æ”¹æ‰“èµå­—ä½“ä¸é—ªåŠ¨ ä¿®æ”¹æ–‡ä»¶next/source/css/_common/components/post/post-reward.stylï¼Œç„¶åæ³¨é‡Šå…¶ä¸­çš„å‡½æ•°wechat:hoverå’Œalipay:hoverï¼Œå¦‚ä¸‹ï¼š 123456789101112/* æ³¨é‡Šæ–‡å­—é—ªåŠ¨å‡½æ•° #wechat:hover p{ animation: roll 0.1s infinite linear; -webkit-animation: roll 0.1s infinite linear; -moz-animation: roll 0.1s infinite linear;} #alipay:hover p{ animation: roll 0.1s infinite linear; -webkit-animation: roll 0.1s infinite linear; -moz-animation: roll 0.1s infinite linear;}*/ æ–‡ç« åŠ å¯†è®¿é—® æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• æ‰“å¼€themes/next/layout/_partials/head/head.swigæ–‡ä»¶,åœ¨ä»¥ä¸‹ä½ç½®æ’å…¥è¿™æ ·ä¸€æ®µä»£ç ï¼š 12345678910&lt;script&gt; (function(){ if('{{ page.password }}'){ if (prompt('è¯·è¾“å…¥æ–‡ç« å¯†ç ') !== '{{ page.password }}'){ alert('å¯†ç é”™è¯¯ï¼'); history.back(); } } })();&lt;/script&gt; ç„¶ååœ¨æ–‡ç« ä¸Šå†™æˆç±»ä¼¼è¿™æ ·ï¼š æ·»åŠ é¼ æ ‡ç‚¹å‡»æ˜¾ç¤ºå­—ä½“æ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ /themes/next/source/js ä¸‹æ–°å»ºæ–‡ä»¶ click_show_text.jsï¼Œåœ¨ click_show_text.js æ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233var a_idx = 0;jQuery(document).ready(function($) { $("body").click(function(e) { var a = new Array ("å¯Œå¼º", "æ°‘ä¸»", "æ–‡æ˜", "å’Œè°", "è‡ªç”±", "å¹³ç­‰", "å…¬æ­£", "æ³•æ²»", "çˆ±å›½", "æ•¬ä¸š", "è¯šä¿¡", "å‹å–„"); var $i = $("&lt;span/&gt;").text(a[a_idx]); a_idx = (a_idx + 1) % a.length; var x = e.pageX, y = e.pageY; $i.css({ "z-index": 5, "top": y - 20, "left": x, "position": "absolute", "font-weight": "bold", "color": "#FF0000" }); $("body").append($i); $i.animate({ "top": y - 180, "opacity": 0 }, 3000, function() { $i.remove(); }); }); setTimeout('delay()', 2000);});function delay() { $(".buryit").removeAttr("onclick");} å…¶ä¸­çš„ç¤¾ä¼šä¸»ä¹‰æ ¸å¿ƒä»·å€¼è§‚å¯ä»¥æ ¹æ®ä½ è‡ªå·±çš„åˆ›æ„æ›¿æ¢ä¸ºå…¶ä»–æ–‡å­—ï¼Œç„¶ååœ¨ \themes\next\layout\_layout.swing æ–‡ä»¶æœ«å°¾æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 12&lt;!--å•å‡»æ˜¾ç¤ºæ–‡å­—--&gt;&lt;script type="text/javascript" src="/js/click_show_text.js"&gt;&lt;/script&gt; æ·»åŠ é¼ æ ‡ç‚¹å‡»çƒŸèŠ±çˆ†ç‚¸æ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª fireworks.js çš„æ–‡ä»¶ï¼Œé‡Œé¢å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 1"use strict";function updateCoords(e){pointerX=(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top}function setParticuleDirection(e){var t=anime.random(0,360)*Math.PI/180,a=anime.random(50,180),n=[-1,1][anime.random(0,1)]*a;return{x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)}}function createParticule(e,t){var a={};return a.x=e,a.y=t,a.color=colors[anime.random(0,colors.length-1)],a.radius=anime.random(16,32),a.endPos=setParticuleDirection(a),a.draw=function(){ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle=a.color,ctx.fill()},a}function createCircle(e,t){var a={};return a.x=e,a.y=t,a.color="#F00",a.radius=0.1,a.alpha=0.5,a.lineWidth=6,a.draw=function(){ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=1},a}function renderParticule(e){for(var t=0;t&lt;e.animatables.length;t++){e.animatables[t].target.draw()}}function animateParticules(e,t){for(var a=createCircle(e,t),n=[],i=0;i&lt;numberOfParticules;i++){n.push(createParticule(e,t))}anime.timeline().add({targets:n,x:function(e){return e.endPos.x},y:function(e){return e.endPos.y},radius:0.1,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule}).add({targets:a,radius:anime.random(80,160),lineWidth:0,alpha:{value:0,easing:"linear",duration:anime.random(600,800)},duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule,offset:0})}function debounce(e,t){var a;return function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t)}}var canvasEl=document.querySelector(".fireworks");if(canvasEl){var ctx=canvasEl.getContext("2d"),numberOfParticules=30,pointerX=0,pointerY=0,tap="mousedown",colors=["#FF1461","#18FF92","#5A87FF","#FBF38C"],setCanvasSize=debounce(function(){canvasEl.width=2*window.innerWidth,canvasEl.height=2*window.innerHeight,canvasEl.style.width=window.innerWidth+"px",canvasEl.style.height=window.innerHeight+"px",canvasEl.getContext("2d").scale(2,2)},500),render=anime({duration:1/0,update:function(){ctx.clearRect(0,0,canvasEl.width,canvasEl.height)}});document.addEventListener(tap,function(e){"sidebar"!==e.target.id&amp;&amp;"toggle-sidebar"!==e.target.id&amp;&amp;"A"!==e.target.nodeName&amp;&amp;"IMG"!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))},!1),setCanvasSize(),window.addEventListener("resize",setCanvasSize,!1)}"use strict";function updateCoords(e){pointerX=(e.clientX||e.touches[0].clientX)-canvasEl.getBoundingClientRect().left,pointerY=e.clientY||e.touches[0].clientY-canvasEl.getBoundingClientRect().top}function setParticuleDirection(e){var t=anime.random(0,360)*Math.PI/180,a=anime.random(50,180),n=[-1,1][anime.random(0,1)]*a;return{x:e.x+n*Math.cos(t),y:e.y+n*Math.sin(t)}}function createParticule(e,t){var a={};return a.x=e,a.y=t,a.color=colors[anime.random(0,colors.length-1)],a.radius=anime.random(16,32),a.endPos=setParticuleDirection(a),a.draw=function(){ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.fillStyle=a.color,ctx.fill()},a}function createCircle(e,t){var a={};return a.x=e,a.y=t,a.color="#F00",a.radius=0.1,a.alpha=0.5,a.lineWidth=6,a.draw=function(){ctx.globalAlpha=a.alpha,ctx.beginPath(),ctx.arc(a.x,a.y,a.radius,0,2*Math.PI,!0),ctx.lineWidth=a.lineWidth,ctx.strokeStyle=a.color,ctx.stroke(),ctx.globalAlpha=1},a}function renderParticule(e){for(var t=0;t&lt;e.animatables.length;t++){e.animatables[t].target.draw()}}function animateParticules(e,t){for(var a=createCircle(e,t),n=[],i=0;i&lt;numberOfParticules;i++){n.push(createParticule(e,t))}anime.timeline().add({targets:n,x:function(e){return e.endPos.x},y:function(e){return e.endPos.y},radius:0.1,duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule}).add({targets:a,radius:anime.random(80,160),lineWidth:0,alpha:{value:0,easing:"linear",duration:anime.random(600,800)},duration:anime.random(1200,1800),easing:"easeOutExpo",update:renderParticule,offset:0})}function debounce(e,t){var a;return function(){var n=this,i=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(n,i)},t)}}var canvasEl=document.querySelector(".fireworks");if(canvasEl){var ctx=canvasEl.getContext("2d"),numberOfParticules=30,pointerX=0,pointerY=0,tap="mousedown",colors=["#FF1461","#18FF92","#5A87FF","#FBF38C"],setCanvasSize=debounce(function(){canvasEl.width=2*window.innerWidth,canvasEl.height=2*window.innerHeight,canvasEl.style.width=window.innerWidth+"px",canvasEl.style.height=window.innerHeight+"px",canvasEl.getContext("2d").scale(2,2)},500),render=anime({duration:1/0,update:function(){ctx.clearRect(0,0,canvasEl.width,canvasEl.height)}});document.addEventListener(tap,function(e){"sidebar"!==e.target.id&amp;&amp;"toggle-sidebar"!==e.target.id&amp;&amp;"A"!==e.target.nodeName&amp;&amp;"IMG"!==e.target.nodeName&amp;&amp;(render.play(),updateCoords(e),animateParticules(pointerX,pointerY))},!1),setCanvasSize(),window.addEventListener("resize",setCanvasSize,!1)}; ç„¶ååœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123&lt;canvas class="fireworks" style="position: fixed;left: 0;top: 0;z-index: 1; pointer-events: none;" &gt;&lt;/canvas&gt; &lt;script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="/js/fireworks.js"&gt;&lt;/script&gt; è‡ªå®šä¹‰é¼ æ ‡æŒ‡é’ˆæ ·å¼ åœ¨ \themes\next\source\css\_custom\custom.styl æ–‡ä»¶ body æ ·å¼é‡Œå†™å…¥å¦‚ä¸‹ä»£ç ï¼š 12345/*è‡ªå®šä¹‰é¼ æ ‡æ ·å¼*/body { cursor: url("/images/mouse.cur"),auto; background-color: @theme_background;} é¼ æ ‡æŒ‡é’ˆå¯ä»¥ç”¨ Axialis CursorWorkshop è¿™ä¸ªè½¯ä»¶è‡ªå·±åˆ¶ä½œï¼Œä¸åŒä¸»é¢˜å…·ä½“æ”¾çš„æ–‡ä»¶æœ‰æ‰€ä¸åŒï¼Œç¡®ä¿åœ¨åšå®¢ä¸»ä½“ body çš„ CSS æ–‡ä»¶ä¸­å³å¯ï¼Œå…¶ä¸­çš„é¼ æ ‡æŒ‡é’ˆé“¾æ¥å¯æ›¿æ¢æˆè‡ªå·±çš„ï¼Œé¦–å…ˆå°è¯•åŠ è½½mouse.cur ï¼Œå¦‚æœè¯¥æ–‡ä»¶ä¸å­˜åœ¨æˆ–ç”±äºå…¶ä»–åŸå› æ— æ•ˆï¼Œé‚£ä¹ˆ auto ä¼šè¢«ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è‡ªåŠ¨é»˜è®¤æ•ˆæœï¼Œå›¾ç‰‡æ ¼å¼ä¸º.icoã€.aniã€.curï¼Œå»ºè®®ä½¿ç”¨.curï¼Œå¦‚æœä½¿ç”¨.aniæˆ–è€…å…¶ä»–æ ¼å¼æ— æ•ˆï¼ŒåŸå› æ˜¯æµè§ˆå™¨å…¼å®¹é—®é¢˜ã€‚ æ·»åŠ å½©è‰²æ»šåŠ¨å˜æ¢å­—ä½“ åœ¨ä½ æƒ³è¦æ·»åŠ å½©è‰²æ»šåŠ¨å˜æ¢å­—ä½“çš„åœ°æ–¹å†™å…¥ä»¥ä¸‹ä»£ç å³å¯ï¼Œå…¶ä¸­æ–‡å­—å¯è‡ªè¡Œæ›´æ”¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142&lt;div id="binft"&gt;&lt;/div&gt; &lt;script&gt; var binft = function (r) { function t() { return b[Math.floor(Math.random() * b.length)] } function e() { return String.fromCharCode(94 * Math.random() + 33) } function n(r) { for (var n = document.createDocumentFragment(), i = 0; r &gt; i; i++) { var l = document.createElement("span"); l.textContent = e(), l.style.color = t(), n.appendChild(l) } return n } function i() { var t = o[c.skillI]; c.step ? c.step-- : (c.step = g, c.prefixP &lt; l.length ? (c.prefixP &gt;= 0 &amp;&amp; (c.text += l[c.prefixP]), c.prefixP++) : "forward" === c.direction ? c.skillP &lt; t.length ? (c.text += t[c.skillP], c.skillP++) : c.delay ? c.delay-- : (c.direction = "backward", c.delay = a) : c.skillP &gt; 0 ? (c.text = c.text.slice(0, -1), c.skillP--) : (c.skillI = (c.skillI + 1) % o.length, c.direction = "forward")), r.textContent = c.text, r.appendChild(n(c.prefixP &lt; l.length ? Math.min(s, s + c.prefixP) : Math.min(s, t.length - c.skillP))), setTimeout(i, d) } var l = "", o = ["é’é’é™µä¸ŠæŸï¼Œç£Šç£Šæ¶§ä¸­çŸ³ã€‚", "äººç”Ÿå¤©åœ°é—´ï¼Œå¿½å¦‚è¿œè¡Œå®¢ã€‚","æ–—é…’ç›¸å¨±ä¹ï¼ŒèŠåšä¸ä¸ºè–„ã€‚", "é©±è½¦ç­–é©½é©¬ï¼Œæ¸¸æˆå®›ä¸æ´›ã€‚","æ´›ä¸­ä½•éƒéƒï¼Œå† å¸¦è‡ªç›¸ç´¢ã€‚","é•¿è¡¢ç½—å¤¹å··ï¼Œç‹ä¾¯å¤šç¬¬å®…ã€‚","ä¸¤å®«é¥ç›¸æœ›ï¼ŒåŒé˜™ç™¾ä½™å°ºã€‚","æå®´å¨±å¿ƒæ„ï¼Œæˆšæˆšä½•æ‰€è¿«ï¼Ÿ"].map(function (r) { return r + "" }), a = 2, g = 1, s = 5, d = 75, b = ["rgb(110,64,170)", "rgb(150,61,179)", "rgb(191,60,175)", "rgb(228,65,157)", "rgb(254,75,131)", "rgb(255,94,99)", "rgb(255,120,71)", "rgb(251,150,51)", "rgb(226,183,47)", "rgb(198,214,60)", "rgb(175,240,91)", "rgb(127,246,88)", "rgb(82,246,103)", "rgb(48,239,130)", "rgb(29,223,163)", "rgb(26,199,194)", "rgb(35,171,216)", "rgb(54,140,225)", "rgb(76,110,219)", "rgb(96,84,200)"], c = { text: "", prefixP: -s, skillI: 0, skillP: 0, direction: "forward", delay: a, step: g }; i() }; binft(document.getElementById('binft')); &lt;/script&gt; æˆ‘æ˜¯æ”¾åœ¨äº†ä¾§è¾¹æ å¤´åƒçš„ä¸‹è¾¹ï¼Œæè¿°çš„ä½ç½®\themes\next\layout\_macro\sidebar.swingï¼š æµè§ˆå™¨ç½‘é¡µæ ‡é¢˜æ¶æ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ç›®å½• \themes\next\source\js ä¸‹æ–°å»ºä¸€ä¸ª FunnyTitle.js æ–‡ä»¶ï¼Œåœ¨é‡Œé¢å¡«å†™å¦‚ä¸‹ä»£ç ï¼š 1234567891011121314151617&lt;!--æµè§ˆå™¨æç¬‘æ ‡é¢˜--&gt; var OriginTitle = document.title; var titleTime; document.addEventListener('visibilitychange', function () { if (document.hidden) { $('[rel="icon"]').attr('href', "/img/trhx2.png"); document.title = 'ãƒ½(â—-`Ğ”Â´-)ãƒä½ ä¸‘ä½ å°±èµ°ï¼'; clearTimeout(titleTime); } else { $('[rel="icon"]').attr('href', "/img/trhx2.png"); document.title = 'ãƒ¾(Åâˆ€Å3)ãƒä½ å¸…å°±å›æ¥ï¼' + OriginTitle; titleTime = setTimeout(function () { document.title = OriginTitle; }, 2000); } }); ç„¶ååœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12&lt;!--æµè§ˆå™¨æç¬‘æ ‡é¢˜--&gt;&lt;script type="text/javascript" src="\js\FunnyTitle.js"&gt;&lt;/script&gt; å†æ¬¡éƒ¨ç½²åšå®¢åå°±å¯ä»¥çœ‹è§æ ‡é¢˜æç¬‘çš„æ•ˆæœäº†ã€‚ æ·»åŠ ç½‘ç«™é›ªèŠ±é£˜è½æ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª snow.js æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142/*æ ·å¼ä¸€*/(function($){ $.fn.snow = function(options){ var $flake = $('&lt;div id="snowbox" /&gt;').css({'position': 'absolute','z-index':'9999', 'top': '-50px'}).html('&amp;#10052;'), documentHeight = $(document).height(), documentWidth = $(document).width(), defaults = { minSize : 10, maxSize : 20, newOn : 1000, flakeColor : "#AFDAEF" /* æ­¤å¤„å¯ä»¥å®šä¹‰é›ªèŠ±é¢œè‰²ï¼Œè‹¥è¦ç™½è‰²å¯ä»¥æ”¹ä¸º#FFFFFF */ }, options = $.extend({}, defaults, options); var interval= setInterval( function(){ var startPositionLeft = Math.random() * documentWidth - 100, startOpacity = 0.5 + Math.random(), sizeFlake = options.minSize + Math.random() * options.maxSize, endPositionTop = documentHeight - 200, endPositionLeft = startPositionLeft - 500 + Math.random() * 500, durationFall = documentHeight * 10 + Math.random() * 5000; $flake.clone().appendTo('body').css({ left: startPositionLeft, opacity: startOpacity, 'font-size': sizeFlake, color: options.flakeColor }).animate({ top: endPositionTop, left: endPositionLeft, opacity: 0.2 },durationFall,'linear',function(){ $(this).remove() }); }, options.newOn); };})(jQuery);$(function(){ $.fn.snow({ minSize: 5, /* å®šä¹‰é›ªèŠ±æœ€å°å°ºå¯¸ */ maxSize: 50,/* å®šä¹‰é›ªèŠ±æœ€å¤§å°ºå¯¸ */ newOn: 300 /* å®šä¹‰å¯†é›†ç¨‹åº¦ï¼Œæ•°å­—è¶Šå°è¶Šå¯†é›† */ });}); 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128/*æ ·å¼äºŒ*//* æ§åˆ¶ä¸‹é›ª */function snowFall(snow) { /* å¯é…ç½®å±æ€§ */ snow = snow || {}; this.maxFlake = snow.maxFlake || 200; /* æœ€å¤šç‰‡æ•° */ this.flakeSize = snow.flakeSize || 10; /* é›ªèŠ±å½¢çŠ¶ */ this.fallSpeed = snow.fallSpeed || 1; /* å è½é€Ÿåº¦ */}/* å…¼å®¹å†™æ³• */requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame || window.oRequestAnimationFrame || function(callback) { setTimeout(callback, 1000 / 60); };cancelAnimationFrame = window.cancelAnimationFrame || window.mozCancelAnimationFrame || window.webkitCancelAnimationFrame || window.msCancelAnimationFrame || window.oCancelAnimationFrame;/* å¼€å§‹ä¸‹é›ª */snowFall.prototype.start = function(){ /* åˆ›å»ºç”»å¸ƒ */ snowCanvas.apply(this); /* åˆ›å»ºé›ªèŠ±å½¢çŠ¶ */ createFlakes.apply(this); /* ç”»é›ª */ drawSnow.apply(this)}/* åˆ›å»ºç”»å¸ƒ */function snowCanvas() { /* æ·»åŠ Domç»“ç‚¹ */ var snowcanvas = document.createElement("canvas"); snowcanvas.id = "snowfall"; snowcanvas.width = window.innerWidth; snowcanvas.height = document.body.clientHeight; snowcanvas.setAttribute("style", "position:absolute; top: 0; left: 0; z-index: 1; pointer-events: none;"); document.getElementsByTagName("body")[0].appendChild(snowcanvas); this.canvas = snowcanvas; this.ctx = snowcanvas.getContext("2d"); /* çª—å£å¤§å°æ”¹å˜çš„å¤„ç† */ window.onresize = function() { snowcanvas.width = window.innerWidth; /* snowcanvas.height = window.innerHeight */ }}/* é›ªè¿åŠ¨å¯¹è±¡ */function flakeMove(canvasWidth, canvasHeight, flakeSize, fallSpeed) { this.x = Math.floor(Math.random() * canvasWidth); /* xåæ ‡ */ this.y = Math.floor(Math.random() * canvasHeight); /* yåæ ‡ */ this.size = Math.random() * flakeSize + 2; /* å½¢çŠ¶ */ this.maxSize = flakeSize; /* æœ€å¤§å½¢çŠ¶ */ this.speed = Math.random() * 1 + fallSpeed; /* å è½é€Ÿåº¦ */ this.fallSpeed = fallSpeed; /* å è½é€Ÿåº¦ */ this.velY = this.speed; /* Yæ–¹å‘é€Ÿåº¦ */ this.velX = 0; /* Xæ–¹å‘é€Ÿåº¦ */ this.stepSize = Math.random() / 30; /* æ­¥é•¿ */ this.step = 0 /* æ­¥æ•° */}flakeMove.prototype.update = function() { var x = this.x, y = this.y; /* å·¦å³æ‘†åŠ¨(ä½™å¼¦) */ this.velX *= 0.98; if (this.velY &lt;= this.speed) { this.velY = this.speed } this.velX += Math.cos(this.step += .05) * this.stepSize; this.y += this.velY; this.x += this.velX; /* é£å‡ºè¾¹ç•Œçš„å¤„ç† */ if (this.x &gt;= canvas.width || this.x &lt;= 0 || this.y &gt;= canvas.height || this.y &lt;= 0) { this.reset(canvas.width, canvas.height) }};/* é£å‡ºè¾¹ç•Œ-æ”¾ç½®æœ€é¡¶ç«¯ç»§ç»­å è½ */flakeMove.prototype.reset = function(width, height) { this.x = Math.floor(Math.random() * width); this.y = 0; this.size = Math.random() * this.maxSize + 2; this.speed = Math.random() * 1 + this.fallSpeed; this.velY = this.speed; this.velX = 0;};// æ¸²æŸ“é›ªèŠ±-éšæœºå½¢çŠ¶ï¼ˆæ­¤å¤„å¯ä¿®æ”¹é›ªèŠ±é¢œè‰²ï¼ï¼ï¼ï¼‰flakeMove.prototype.render = function(ctx) { var snowFlake = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size); snowFlake.addColorStop(0, "rgba(255, 255, 255, 0.9)"); /* æ­¤å¤„æ˜¯é›ªèŠ±é¢œè‰²ï¼Œé»˜è®¤æ˜¯ç™½è‰² */ snowFlake.addColorStop(.5, "rgba(255, 255, 255, 0.5)"); /* è‹¥è¦æ”¹ä¸ºå…¶ä»–é¢œè‰²ï¼Œè¯·è‡ªè¡ŒæŸ¥ */ snowFlake.addColorStop(1, "rgba(255, 255, 255, 0)"); /* æ‰¾16è¿›åˆ¶çš„RGB é¢œè‰²ä»£ç ã€‚ */ ctx.save(); ctx.fillStyle = snowFlake; ctx.beginPath(); ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2); ctx.fill(); ctx.restore();};/* åˆ›å»ºé›ªèŠ±-å®šä¹‰å½¢çŠ¶ */function createFlakes() { var maxFlake = this.maxFlake, flakes = this.flakes = [], canvas = this.canvas; for (var i = 0; i &lt; maxFlake; i++) { flakes.push(new flakeMove(canvas.width, canvas.height, this.flakeSize, this.fallSpeed)) }}/* ç”»é›ª */function drawSnow() { var maxFlake = this.maxFlake, flakes = this.flakes; ctx = this.ctx, canvas = this.canvas, that = this; /* æ¸…ç©ºé›ªèŠ± */ ctx.clearRect(0, 0, canvas.width, canvas.height); for (var e = 0; e &lt; maxFlake; e++) { flakes[e].update(); flakes[e].render(ctx); } /* ä¸€å¸§ä¸€å¸§çš„ç”» */ this.loop = requestAnimationFrame(function() { drawSnow.apply(that); });}/* è°ƒç”¨åŠæ§åˆ¶æ–¹æ³• */var snow = new snowFall({maxFlake:60});snow.start(); ç„¶ååœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12&lt;!-- é›ªèŠ±ç‰¹æ•ˆ --&gt;&lt;script type="text/javascript" src="\js\snow.js"&gt;&lt;/script&gt; å¦‚æœæ²¡æ•ˆæœï¼Œè¯·ç¡®è®¤ç½‘é¡µæ˜¯å¦å·²è½½å…¥JQureyï¼Œå¦‚æœæ²¡æœ‰è¯·åœ¨ä¸‹é›ªä»£ç ä¹‹å‰å¼•å…¥JQå³å¯ï¼š 12&lt;script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" src="http://libs.baidu.com/jquery/1.8.3/jquery.min.js"&gt;&lt;/script&gt; æ·»åŠ èƒŒæ™¯åŠ¨æ€å½©å¸¦æ•ˆæœ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 12345&lt;!-- æ ·å¼ä¸€ï¼ˆé¼ æ ‡ç‚¹å‡»æ›´æ¢æ ·å¼ï¼‰ --&gt;&lt;script src="https://g.joyinshare.com/hc/ribbon.min.js" type="text/javascript"&gt;&lt;/script&gt;&lt;!-- æ ·å¼äºŒï¼ˆé£˜åŠ¨çš„å½©å¸¦ï¼‰ --&gt;&lt;script src="https://g.joyinshare.com/hc/piao.js" type="text/javascript"&gt;&lt;/script&gt; æ·»åŠ èƒŒæ™¯ä»£ç é›¨ç‰¹æ•ˆ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• åœ¨ \themes\next\source\js ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª DigitalRain.js æ–‡ä»¶ï¼Œç²˜è´´ä»¥ä¸‹ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657window.onload = function(){ //è·å–ç”»å¸ƒå¯¹è±¡ var canvas = document.getElementById("canvas"); //è·å–ç”»å¸ƒçš„ä¸Šä¸‹æ–‡ var context =canvas.getContext("2d"); var s = window.screen; var W = canvas.width = s.width; var H = canvas.height; //è·å–æµè§ˆå™¨å±å¹•çš„å®½åº¦å’Œé«˜åº¦ //var W = window.innerWidth; //var H = window.innerHeight; //è®¾ç½®canvasçš„å®½åº¦å’Œé«˜åº¦ canvas.width = W; canvas.height = H; //æ¯ä¸ªæ–‡å­—çš„å­—ä½“å¤§å° var fontSize = 12; //è®¡ç®—åˆ— var colunms = Math.floor(W /fontSize); //è®°å½•æ¯åˆ—æ–‡å­—çš„yè½´åæ ‡ var drops = []; //ç»™æ¯ä¸€ä¸ªæ–‡å­—åˆå§‹åŒ–ä¸€ä¸ªèµ·å§‹ç‚¹çš„ä½ç½® for(var i=0;i&lt;colunms;i++){ drops.push(0); } //è¿åŠ¨çš„æ–‡å­— var str ="WELCOME TO WWW.ITRHX.COM"; //4:fillText(str,x,y);åŸç†å°±æ˜¯å»æ›´æ”¹yçš„åæ ‡ä½ç½® //ç»˜ç”»çš„å‡½æ•° function draw(){ context.fillStyle = "rgba(238,238,238,.08)";//é®ç›–å±‚ context.fillRect(0,0,W,H); //ç»™å­—ä½“è®¾ç½®æ ·å¼ context.font = "600 "+fontSize+"px Georgia"; //ç»™å­—ä½“æ·»åŠ é¢œè‰² context.fillStyle = ["#33B5E5", "#0099CC", "#AA66CC", "#9933CC", "#99CC00", "#669900", "#FFBB33", "#FF8800", "#FF4444", "#CC0000"][parseInt(Math.random() * 10)];//randColor();å¯ä»¥rgb,hsl, æ ‡å‡†è‰²ï¼Œåå…­è¿›åˆ¶é¢œè‰² //å†™å…¥ç”»å¸ƒä¸­ for(var i=0;i&lt;colunms;i++){ var index = Math.floor(Math.random() * str.length); var x = i*fontSize; var y = drops[i] *fontSize; context.fillText(str[index],x,y); //å¦‚æœè¦æ”¹å˜æ—¶é—´ï¼Œè‚¯å®šå°±æ˜¯æ”¹å˜æ¯æ¬¡ä»–çš„èµ·ç‚¹ if(y &gt;= canvas.height &amp;&amp; Math.random() &gt; 0.99){ drops[i] = 0; } drops[i]++; } }; function randColor(){//éšæœºé¢œè‰² var r = Math.floor(Math.random() * 256); var g = Math.floor(Math.random() * 256); var b = Math.floor(Math.random() * 256); return "rgb("+r+","+g+","+b+")"; } draw(); setInterval(draw,35);}; ç„¶ååœ¨ \themes\next\source\css\_custom\custom.styl ä¸­å†™å…¥æ ·å¼ï¼š 12345678910canvas { position: fixed; right: 0px; bottom: 0px; min-width: 100%; min-height: 100%; height: auto; width: auto; z-index: -1;} åœ¨ \themes\next\layout\layout.swing æ–‡ä»¶ä¸­å†™å…¥ä»¥ä¸‹ä»£ç ï¼š 123&lt;!-- ä»£ç é›¨ --&gt; &lt;canvas id="canvas" width="1440" height="900" &gt;&lt;/canvas&gt; &lt;script type="text/javascript" src="/js/DigitalRain.js"&gt;&lt;/script&gt; ä»£ç å—å¤åˆ¶åŠŸèƒ½ æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• ä¸‹è½½ clipboard.js clipboard.js clipboard.min.js æ¨è ä¿å­˜æ–‡ä»¶clipboard.js / clipboard.min.js åˆ°è·¯å¾„\themes\next\source\js\srcä¸‹ã€‚ ä½¿ç”¨clipboard.js ä¹Ÿæ˜¯åœ¨ \themes\next\source\js\src ç›®å½•ä¸‹ï¼Œåˆ›å»ºclipboard-use.jsï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516/*é¡µé¢è½½å…¥å®Œæˆåï¼Œåˆ›å»ºå¤åˆ¶æŒ‰é’®*/!function (e, t, a) { /* code */ var initCopyCode = function(){ var copyHtml = ''; copyHtml += '&lt;button class="btn-copy" data-clipboard-snippet=""&gt;'; copyHtml += ' &lt;i class="fa fa-globe"&gt;&lt;/i&gt;&lt;span&gt;copy&lt;/span&gt;'; copyHtml += '&lt;/button&gt;'; $(".highlight .code pre").before(copyHtml); new ClipboardJS('.btn-copy', { target: function(trigger) { return trigger.nextElementSibling; } }); } initCopyCode(); åœ¨\themes\next\source\css\_custom\custom.stylæ ·å¼æ–‡ä»¶ä¸­æ·»åŠ ä¸‹é¢ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536//ä»£ç å—å¤åˆ¶æŒ‰é’®.highlight{ //æ–¹ä¾¿copyä»£ç æŒ‰é’®ï¼ˆbtn-copyï¼‰çš„å®šä½ position: relative;}.btn-copy { display: inline-block; cursor: pointer; background-color: #eee; background-image: linear-gradient(#fcfcfc,#eee); border: 1px solid #d5d5d5; border-radius: 3px; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none; -webkit-appearance: none; font-size: 13px; font-weight: 700; line-height: 20px; color: #333; -webkit-transition: opacity .3s ease-in-out; -o-transition: opacity .3s ease-in-out; transition: opacity .3s ease-in-out; padding: 2px 6px; position: absolute; right: 5px; top: 5px; opacity: 0;}.btn-copy span { margin-left: 5px;}.highlight:hover .btn-copy{ opacity: 1;} å¼•ç”¨ åœ¨\themes\next\layout\_layout.swigæ–‡ä»¶ä¸­ï¼Œæ·»åŠ å¼•ç”¨ï¼ˆæ³¨ï¼šåœ¨ swig æœ«å°¾æˆ– body ç»“æŸæ ‡ç­¾ï¼ˆ&lt;/body&gt;ï¼‰ä¹‹å‰æ·»åŠ ï¼‰ï¼š 123&lt;!-- ä»£ç å—å¤åˆ¶åŠŸèƒ½ --&gt; &lt;script type="text/javascript" src="/js/src/clipboard.min.js"&gt;&lt;/script&gt; &lt;script type="text/javascript" src="/js/src/clipboard-use.js"&gt;&lt;/script&gt; Hexoæ–‡ç« ä¸­å›¾ç‰‡ç‚¹å‡»å®ç°å…¨å±æŸ¥çœ‹ ä½¿ç”¨å›¾ç‰‡æµè§ˆæ”¾å¤§åŠŸèƒ½fancyboxæ’ä»¶ã€‚ åˆ‡æ¢åˆ°libç›®å½• 1$ cd next/source/lib ä¸‹è½½æ’ä»¶ 1$ git clone https://github.com/theme-next/theme-next-fancybox3 fancybox æ›´æ”¹ä¸»é¢˜é…ç½®æ–‡ä»¶ 1fancybox: true 3DåŠ¨æ€æ ‡ç­¾äº‘ å®‰è£…æ ‡ç­¾äº‘hexo-tag-cloudæ’ä»¶ 1$ cnpm install hexo-tag-cloud@^2.* --save é…ç½®sidebar.swigæ–‡ä»¶ æ‰“å¼€next/layout/_macro/sidebar.swigï¼Œè¾“å…¥ï¼š 1234567891011{% if site.tags.length &gt; 1 %}&lt;script type="text/javascript" charset="utf-8" src="/js/tagcloud.js"&gt;&lt;/script&gt;&lt;script type="text/javascript" charset="utf-8" src="/js/tagcanvas.js"&gt;&lt;/script&gt;&lt;div class="widget-wrap"&gt; &lt;div id="myCanvasContainer" class="widget tagcloud"&gt; &lt;canvas width="250" height="250" id="resCanvas" style="width=100%"&gt; {{ list_tags() }} &lt;/canvas&gt; &lt;/div&gt;&lt;/div&gt;{% endif %} æ ¹æ®è‡ªå·±çš„éœ€è¦æ”¾åœ¨åˆé€‚çš„ä½ç½®ã€‚é‡æ–°hexo sä¸€ä¸‹ï¼Œå°±å¯ä»¥å‡ºç°åˆšåˆšé‚£ä¸ª3dæ ‡ç­¾äº‘äº†! æ·»åŠ å¡é€šäººç‰© æ•ˆæœå¦‚ä¸‹å›¾ï¼š å®ç°æ–¹æ³• ä¸‹è½½ live2d 1$ cnpm install --save hexo-helper-live2d ä¸‹è½½æ¨¡å‹ 1$ cnpm install live2d-widget-model-z16 æ›´å¤šæ¨¡å‹é€‰æ‹©è¯· ç‚¹å‡»æ­¤å¤„ï¼Œ å„ä¸ªæ¨¡å‹çš„é¢„è§ˆè¯· ç‚¹å‡»æ­¤å¤„ ä¿®æ”¹ç«™ç‚¹é…ç½®æ–‡ä»¶ 12345678910111213141516171819202122232425262728293031323334#æ·»åŠ èŒå® ï¼Œä»¥ä¸‹ä»»é€‰ä¸€ä¸ª#live2d-widget-model-chitose#live2d-widget-model-epsilon2_1#live2d-widget-model-gf#live2d-widget-model-haru/01 (use npm install --save live2d-widget-model-haru)#live2d-widget-model-haru/02 (use npm install --save live2d-widget-model-haru)#live2d-widget-model-haruto#live2d-widget-model-hibiki#live2d-widget-model-hijiki#live2d-widget-model-izumi#live2d-widget-model-koharu#live2d-widget-model-miku#live2d-widget-model-ni-j#live2d-widget-model-nico#live2d-widget-model-nietzsche#live2d-widget-model-nipsilon#live2d-widget-model-nito#live2d-widget-model-shizuku#live2d-widget-model-tororo#live2d-widget-model-tsumiki#live2d-widget-model-unitychan#live2d-widget-model-wanko#live2d-widget-model-z16live2d: enable: true scriptFrom: local model: use: live2d-widget-model-z16 display: position: right #æ¨¡å‹ä½ç½® width: 140 #æ¨¡å‹å®½åº¦ height: 260 #æ¨¡å‹é«˜åº¦ mobile: show: false #æ˜¯å¦åœ¨æ‰‹æœºç«¯æ˜¾ç¤º å¡é€šäººç‰©å‡çº§ç‰ˆ æ•ˆæœå¦‚ä¸‹å›¾ï¼š èƒ½è¯´è¯ã€èƒ½æ¢è£…ã€èƒ½ç©æ¸¸æˆã€èƒ½æ‹ç…§ã€è¿˜èƒ½è‡ªå®šä¹‰ã€‚ å®ç°æ–¹æ³• ä¸‹è½½ å¼ ä¹¦æ¨µ å¤§ç¥çš„é¡¹ç›®ï¼Œè§£å‹åˆ°æœ¬åœ°åšå®¢ç›®å½•çš„themes/next/sourceä¸‹ï¼Œä¿®æ”¹autoload.jsæ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š å°† 1234const live2d_path = "https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget/";æ”¹ä¸ºconst live2d_path = "/live2d-widget/"; åœ¨/themes/next/layout/_layout.swingä¸­,æ–°å¢å¦‚ä¸‹å†…å®¹ï¼š 1&lt;script src="/live2d-widget/autoload.js"&gt;&lt;/script&gt; åœ¨ä¸»é¢˜é…ç½®æ–‡ä»¶ ä¸­,æ–°å¢å¦‚ä¸‹å†…å®¹ï¼š 12live2d: enable: true æƒ³ä¿®æ”¹çœ‹æ¿å¨˜å¤§å°ã€ä½ç½®ã€æ ¼å¼ã€æ–‡æœ¬å†…å®¹ç­‰ï¼Œå¯æŸ¥çœ‹å¹¶ä¿®æ”¹ waifu-tips.js ã€ waifu-tips.json å’Œ waifu.cssã€‚ æ‰©å±•çœ‹æ¿å¨˜æ¨¡å‹ ç”±äºå®˜æ–¹çš„çœ‹æ¿å¨˜æ¨¡å‹æ¯”è¾ƒå°‘ï¼Œå¯æ‰‹åŠ¨æ·»åŠ æ¨¡å‹ã€‚ æŠŠ githubæ¨¡å‹ ä¸‹è½½åˆ°æœ¬åœ°ï¼Œè§£å‹åå°†assetsç›®å½•æ‹·è´åˆ°åšå®¢æ ¹ç›®å½•ä¸­çš„live2d_modelsï¼ˆè‡ªå·±æ–°å»ºï¼Œæ–‡ä»¶åä¸å¯æ”¹ï¼‰é‡Œï¼Œå†ä¿®æ”¹_config.yml é‡Œçš„ live2dä¸­model.useå³å¯ï¼ˆæ”¹ä¸ºlive2d_modelsä¸­çš„æ¨¡å‹åå­—å°±è¡Œï¼‰ã€‚ å»æ‰é¡¶éƒ¨é»‘çº¿ æ‰“å¼€themes\next\source\css\_custom\custom.stylæ·»åŠ ä»¥ä¸‹ä»£ç ï¼š 1.headband {display:none;} ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’ æ–¹æ³•ä¸€ åœ¨/themes/next/source/css/_variables/custom.stylæ–‡ä»¶ç§æ·»åŠ å¦‚ä¸‹ä»£ç ï¼ˆä»¥Geminié£æ ¼ä¸ºä¾‹ï¼‰ï¼š 123456789101112131415// ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’// Variables of Gemini scheme// =================================================@import "Pisces.styl";// Settings for some of the most global styles.// --------------------------------------------------$body-bg-color = #eee// Borders.// --------------------------------------------------$box-shadow-inner = 0 2px 2px 0 rgba(0,0,0,.12), 0 3px 1px -2px rgba(0,0,0,.06), 0 1px 5px 0 rgba(0,0,0,.12)$box-shadow = 0 2px 2px 0 rgba(0,0,0,.12), 0 3px 1px -2px rgba(0,0,0,.06), 0 1px 5px 0 rgba(0,0,0,.12), 0 -1px .5px 0 rgba(0,0,0,.09)$border-radius-inner = initial$border-radius = initial$border-radius-inner = 15px 15px 15px 15px;$border-radius = 15px; æ–¹æ³•äºŒ åœ¨\themes\next\source\css\_variables\Gemini.stylæ–‡ä»¶ä¸­ç›´æ¥æ·»åŠ ï¼š 123// ä¿®æ”¹ä¸»é¢˜é¡µé¢å¸ƒå±€ä¸ºåœ†è§’$border-radius-inner = 15px 15px 15px 15px;$border-radius = 15px; æ•ˆæœå¦‚ä¸‹å›¾ï¼š è‡ªé€‚åº”èƒŒæ™¯å›¾ç‰‡ åœ¨ç«™ç‚¹é…ç½®æ–‡ä»¶å¤¹/themes/next/source/images/æ”¾å…¥ä½ çš„èƒŒæ™¯å›¾ç‰‡; ç„¶åä¿®æ”¹ä¸»é¢˜æ–‡ä»¶å¤¹themes/source/css/_custom/custom.stylï¼Œåœ¨custom.stylå¼€å¤´åŠ å…¥å¦‚ä¸‹çš„ä»£ç : 12345678910111213141516body { background: url(/images/background.jpg); background-repeat: no-repeat; background-attachment: fixed; background-position: 50% 50%; background-size: cover; -webkit-background-size: cover; -o-background-size: cover; -moz-background-size: cover; -ms-background-size: cover; /*è¿™æ˜¯è®¾ç½®åº•éƒ¨æ–‡å­—, çœ‹ä¸ªäººéœ€è¦ä¿®æ”¹*/ #footer &gt; div &gt; div { color: #eee; }} é˜²æ­¢æ¯æ¬¡heox clean åCNAMEæ–‡ä»¶è¢«åˆ é™¤ å…ˆæŠŠgithubä¸­çš„CNAMEæ–‡ä»¶å¤åˆ¶ä¸€ä»½åˆ°æœ¬åœ°public å†å®‰è£…æ’ä»¶ 1cnpm install hexo-generator-cname --save æ ¹ç›®å½•_config.ymlä¸­æ·»åŠ  12Plugins:- hexo-generator-cname å¹¶ä¿®æ”¹ 1url: yoursite.com å»é™¤valineçš„Powered By ä¿®æ”¹\themes\next\layout\_third-party\comments\valine.swigæ–‡ä»¶ 123456789101112new Valine({...pageSize:'{{ theme.valine.pageSize }}' || 10,});//æ–°å¢ä»¥ä¸‹ä»£ç å³å¯ï¼Œå¯ä»¥ç§»é™¤.infoä¸‹æ‰€æœ‰å­èŠ‚ç‚¹ã€‚var infoEle = document.querySelector('#comments .info');if (infoEle &amp;&amp; infoEle.childNodes &amp;&amp; infoEle.childNodes.length &gt; 0){ infoEle.childNodes.forEach(function(item) { item.parentNode.removeChild(item); });} å¢åŠ è¯äº‘ å¢åŠ ä¹‹å‰çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š æ–¹æ³•æ¯”è¾ƒç®€å•ï¼ŒåŠ ä¸ªjsè„šæœ¬å°±å¥½äº†ï¼Œå°±åŠ åœ¨æ ‡ç­¾çš„é‚£ä¸ªé¡µé¢å¥½äº†ã€‚ æ‰“å¼€themes\next\layout\page.swig æ‰¾åˆ° 1{% if page.type === "tags" %} å°†ä¸‹é¢è¿™æ®µä»£ç : 123456789101112131415161718&lt;div class="tag-cloud"&gt; &lt;div class="tag-cloud-title"&gt; {% set visibleTags = 0 %} {% for tag in site.tags %} {% if tag.length %} {% set visibleTags += 1 %} {% endif %} {% endfor %} {{ _p('counter.tag_cloud', visibleTags) }} &lt;/div&gt; &lt;div class="tag-cloud-tags"&gt; {% if not theme.tagcloud %} {{ tagcloud({min_font: 12, max_font: 30, amount: 200, color: true, start_color: '#ccc', end_color: '#111'}) }} {% else %} {{ tagcloud({min_font: 13, max_font: 31, amount: 1000, color: true, start_color: '#9733EE', end_color: '#FF512F'}) }} {% endif %} &lt;/div&gt;&lt;/div&gt; æ¢æˆä¸‹é¢è¿™æ®µä»£ç ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253&lt;div class="tag-cloud"&gt;&nbsp; &lt;!-- &lt;div class="tag-cloud-title"&gt;&nbsp; &nbsp; &nbsp; {{ _p('counter.tag_cloud', site.tags.length) }}&nbsp; &lt;/div&gt; --&gt;&nbsp; &lt;div class="tag-cloud-tags" id="tags"&gt;&nbsp; &nbsp; {{ tagcloud({min_font: 16, max_font: 16, amount: 300, color: true, start_color: '#fff', end_color: '#fff'}) }}&nbsp; &lt;/div&gt;&lt;/div&gt;&lt;br&gt;&lt;script type="text/javascript"&gt;&nbsp; &nbsp;var alltags=document.getElementById('tags');&nbsp; &nbsp;var tags=alltags.getElementsByTagName('a');&nbsp; &nbsp;for (var i = tags.length - 1; i &gt;= 0; i--) {&nbsp; &nbsp; &nbsp;var r=Math.floor(Math.random()*75+130);&nbsp; &nbsp; &nbsp;var g=Math.floor(Math.random()*75+100);&nbsp; &nbsp; &nbsp;var b=Math.floor(Math.random()*75+80);&nbsp; &nbsp; &nbsp;tags[i].style.background = "rgb("+r+","+g+","+b+")";&nbsp; &nbsp;}&lt;/script&gt;&lt;style type="text/css"&gt;&nbsp; &nbsp; div#posts.posts-expand .tag-cloud a{&nbsp; &nbsp;background-color: #f5f7f1;&nbsp; &nbsp;border-radius: 6px;&nbsp; &nbsp;padding-left: 10px;&nbsp; &nbsp;padding-right: 10px;&nbsp; &nbsp;margin-top: 18px;&nbsp;}&nbsp;.tag-cloud a{&nbsp; &nbsp;background-color: #f5f7f1;&nbsp; &nbsp;border-radius: 4px;&nbsp; &nbsp;padding-right: 5px;&nbsp; &nbsp;padding-left: 5px;&nbsp; &nbsp;margin-right: 5px;&nbsp; &nbsp;margin-left: 0px;&nbsp; &nbsp;margin-top: 8px;&nbsp; &nbsp;margin-bottom: 0px;&nbsp;}&nbsp;.tag-cloud a:before{&nbsp; &nbsp; &nbsp; content: "ğŸ“œ";&nbsp;}&nbsp;.tag-cloud-tags{&nbsp; &nbsp;text-align: left;&nbsp; &nbsp;counter-reset: tags;&nbsp;}&lt;/style&gt; æ•ˆæœå¦‚ä¸‹å›¾ï¼š ä»£ç å—Mac Panelç‰¹æ•ˆ å…ˆä¸Šæ•ˆæœå›¾ï¼š èƒ½è®¾ç½®é˜´å½±æ•ˆæœå’Œå®ç°æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ï¼Œä¸è¿‡æ–‡æœ¬åªå­˜åœ¨æµè§ˆå™¨é¡µé¢ä¸Šï¼Œä¸ä¼šçœŸæ­£ä¿å­˜ã€‚ å®ç°æ­¥éª¤ å¼•å…¥JS è¿™é‡Œéœ€è¦æ–°å»ºä¸¤ä¸ªjsæ–‡ä»¶events.jså’Œcodeblock.jsï¼Œè·¯å¾„ä½äº/themes/next/scripts/åŒ…ä¸‹ã€‚ events.jsä»£ç ï¼š 1234567// mac Panelæ•ˆæœä»£ç å—ç›¸å…³var exec = require('child_process').exec;// new åè‡ªåŠ¨æ‰“å¼€ç¼–è¾‘å™¨hexo.on('new', function(data){ exec('open -a MacDown ' + data.path);}); codeblock.jsä»£ç ï¼š 12345678910111213141516171819202122// mac Panelæ•ˆæœä»£ç å—ç›¸å…³var attributes = [ 'autocomplete="off"', 'autocorrect="off"', 'autocapitalize="off"', 'spellcheck="false"', 'contenteditable="true"']var attributesStr = attributes.join(' ')hexo.extend.filter.register('after_post_render', function (data) { while (/&lt;figure class="highlight ([a-zA-Z]+)"&gt;.*?&lt;\/figure&gt;/.test(data.content)) { data.content = data.content.replace(/&lt;figure class="highlight ([a-zA-Z]+)"&gt;.*?&lt;\/figure&gt;/, function () { var language = RegExp.$1 || 'plain' var lastMatch = RegExp.lastMatch lastMatch = lastMatch.replace(/&lt;figure class="highlight /, '&lt;figure class="iseeu highlight /') return '&lt;div class="highlight-wrap"' + attributesStr + 'data-rel="' + language.toUpperCase() + '"&gt;' + lastMatch + '&lt;/div&gt;' }) } return data}) å¼•å…¥CSS åœ¨/themes/next/source/css/_common/components/highlight/ç›®å½•ä¸‹æ–°å»ºmacPanel.stylæ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657// mac Panelæ•ˆæœä»£ç å—ç›¸å…³.highlight-wrap[data-rel] { position: relative; overflow: hidden; border-radius: 5px; //box-shadow: 0 10px 30px 0px rgba(0, 0, 0, 0.4); box-shadow:18px 18px 15px 0px rgba(0,0,0,.4) margin: 35px 0; ::-webkit-scrollbar { height: 10px; } ::-webkit-scrollbar-track { -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.3); border-radius: 10px; } ::-webkit-scrollbar-thumb { border-radius: 10px; -webkit-box-shadow: inset 0 0 6px rgba(0, 0, 0, 0.5); } &amp;::before { color: white; content: attr(data-rel); height: 38px; line-height: 38px; //background: #21252b; background: #108414de; color: #fff; font-size: 16px; //position: absolute; top: 0; left: 0; width: 100%; //font-family: 'Source Sans Pro', sans-serif; font-weight: bold; padding: 0px 80px; text-indent: 15px; float: left; } &amp;::after { content: ' '; position: absolute; -webkit-border-radius: 50%; border-radius: 50%; background: #fc625d; width: 12px; height: 12px; top: 0; left: 20px; margin-top: 13px; -webkit-box-shadow: 20px 0px #fdbc40, 40px 0px #35cd4b; box-shadow: 20px 0px #fdbc40, 40px 0px #35cd4b; z-index: 3; }} æ­¤cssæ˜¯æ ¹æ®æˆ‘æœ¬åœ°çš„æ ·å¼åšè¿‡è°ƒæ•´ï¼Œæ³¨é‡Šçš„ä»£ç ä¸ºåŸæœ‰çš„ï¼Œæ ¹æ®éœ€è¦è°ƒæ•´æ ·å¼å³å¯ã€‚ é…ç½®å¼•ç”¨ åœ¨/themes/next/source/css/_common/components/highlight/highlight.stylæ–‡ä»¶ä¸­å¼•å…¥åˆšæ‰æ–°å»ºçš„macPanel.stylï¼š 1@require "macPanel" é…ç½®åœ¨æ–‡ä»¶çš„é¡¶éƒ¨ä½ç½®å³å¯ã€‚ åˆ°æ­¤Mac Panelå·²é…ç½®å®Œæˆï¼Œæ ¹æ®éœ€è¦å¯è°ƒæ•´ä¸»é¢˜é…ç½®æ–‡ä»¶ä¸­çš„highlight_themeé€‰é¡¹ï¼Œé€‰æ‹©è‡ªå·±å–œæ¬¢çš„æ ·å¼ã€‚ å¯èƒ½é‡åˆ°çš„é—®é¢˜ å¦‚æœåœ¨é…ç½®å®Œæ¯•åï¼Œhexoå¯åŠ¨æŠ¥é”™ï¼Œå¯å°†ç«™ç‚¹é…ç½®æ–‡ä»¶é‡Œçš„highlightå±æ€§auto_detectæ”¹æˆfalseï¼š 123456highlight: enable: true line_number: true- auto_detect: true+ auto_detect: false tab_replace: å¦‚æœè¿˜æ˜¯æœ‰é—®é¢˜ï¼Œå¯ä»”ç»†æ£€æŸ¥ä¸€ä¸‹åˆšæ‰æ–°å»ºçš„æ–‡ä»¶ã€ä¿®æ”¹çš„é…ç½®æ–‡ä»¶ï¼Œæœ‰ä»€ä¹ˆåœ°æ–¹é…ç½®é”™äº†ï¼Œæˆ–è€…æ˜¯è¯­æ³•ä¸Šçš„é”™è¯¯,ä¿®æ”¹åé‡æ–°å¯åŠ¨å³å¯çœ‹åˆ°æ•ˆæœã€‚ ä¸ºæ–‡ç« ç”Ÿæˆæ°¸ä¹…é“¾æ¥ hexoé»˜è®¤çš„æ–‡ç« é“¾æ¥å½¢å¼ä¸ºyear/:month/:day/:titleï¼Œæ˜¯æŒ‰ç…§å¹´ã€æœˆã€æ—¥ã€æ ‡é¢˜æ¥ç”Ÿæˆçš„ã€‚å½“æŠŠæ–‡ç« æºæ–‡ä»¶åæ”¹æ‰ä¹‹åï¼Œé“¾æ¥ä¹Ÿä¼šæ”¹å˜ï¼Œè¿™å¾ˆä¸å‹å¥½ã€‚å¹¶ä¸”å¦‚æœæ–‡ç« æ ‡é¢˜æ˜¯ä¸­æ–‡çš„ï¼Œé‚£ä¹ˆè¯¥è·¯å¾„å°±ä¼šå‡ºç°ä¸­æ–‡å­—ç¬¦ã€‚åœ¨è·¯å¾„ä¸­å‡ºç°äº†ä¸­æ–‡å­—ç¬¦å¾ˆå®¹æ˜“å¼•å‘å„ç§é—®é¢˜ï¼Œè€Œä¸”ä¹Ÿä¸åˆ©äºseoï¼Œå› ä¸ºè·¯å¾„åŒ…å«äº†å¹´æœˆæ—¥ä¸‰ä¸ªå±‚çº§ï¼Œå±‚çº§å¤ªæ·±ä¸åˆ©äºç™¾åº¦èœ˜è››æŠ“å–ã€‚ è§£å†³åŠæ³•å°±æ˜¯åˆ©ç”¨å…¶å®ƒçš„æ’ä»¶æ¥ç”Ÿæˆå”¯ä¸€çš„è·¯å¾„ï¼Œè¿™æ ·å°±ç®—æ–‡ä»¶æ ‡é¢˜éšæ„ä¿®æ”¹ï¼Œè€Œä¸ä¼šå¯¼è‡´åŸæœ¬çš„é“¾æ¥å¤±æ•ˆè€Œé€ æˆç«™ç‚¹ä¸‹å­˜åœ¨å¤§é‡çš„æ­»é“¾ã€‚ å®‰è£…æ’ä»¶ 1cnpm install hexo-abbrlink --save &lt;font color="red"&gt;æ³¨æ„ï¼šæ‰§è¡Œæ­¤å‘½ä»¤å¯èƒ½ä¼šä¸æˆåŠŸï¼Œæç¤ºä½ ç¼ºå°‘ç›¸åº”çš„ä¾èµ–ï¼Œæ¯”å¦‚babel-eslintã€mini-css-extract-pluginã€webpack-cliâ€¦ä½¿ç”¨npmå‘½ä»¤å®‰è£…å³å¯ã€‚&lt;/font&gt;æ¯”å¦‚ï¼š 1npm install eslint@4.x babel-eslint@8 --save-dev é…ç½® ä¿®æ”¹æ ¹ç›®å½•ç«™ç‚¹é…ç½®æ–‡ä»¶config.ymlï¼Œæ”¹ä¸ºï¼š 1234permalink: posts/:abbrlink.html # æ­¤å¤„å¯ä»¥è‡ªå·±è®¾ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ /:abbrlinkabbrlink: alg: crc32 #ç®—æ³•ï¼š crc16(default) and crc32 rep: hex #è¿›åˆ¶ï¼š dec(default) and hex è¿™é‡Œå°†é¡µé¢éƒ½æ·»åŠ äº† .html çš„åç¼€ï¼Œç”¨æ¥ä¼ªè£…æˆé™æ€é¡µé¢(è™½è¯´Hexoçš„é¡µé¢æœ¬èº«å°±æ˜¯é™æ€é¡µé¢)ï¼Œè¿™æ ·å¯ä»¥ç›´æ¥ä»è·¯å¾„å°±çŸ¥é“è¿™æ˜¯ä¸ªé™æ€é¡µé¢ï¼Œæ–¹ä¾¿seoã€‚ ç”Ÿæˆçš„é“¾æ¥å°†ä¼šæ˜¯è¿™æ ·çš„(å®˜æ–¹æ ·ä¾‹)ï¼š 12345678910crc16 &amp; hexhttps://post.zz173.com/posts/66c8.htmlcrc16 &amp; dechttps://post.zz173.com/posts/65535.htmlcrc32 &amp; hexhttps://post.zz173.com/posts/8ddf18fb.htmlcrc32 &amp; dechttps://post.zz173.com/posts/1690090958.html ç”Ÿæˆå®Œåï¼ŒåŸmdæ–‡ä»¶çš„Front-matter å†…ä¼šå¢åŠ abbrlink å­—æ®µï¼Œå€¼ä¸ºç”Ÿæˆçš„ID ã€‚è¿™ä¸ªå­—æ®µç¡®ä¿äº†åœ¨æˆ‘ä»¬ä¿®æ”¹äº†Front-matter å†…çš„åšå®¢æ ‡é¢˜titleæˆ–åˆ›å»ºæ—¥æœŸdateå­—æ®µä¹‹åè€Œä¸ä¼šæ”¹å˜é“¾æ¥åœ°å€ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ThreadLocal]]></title>
    <url>%2Fposts%2F94ca0535.html</url>
    <content type="text"><![CDATA[ç®€ä»‹ ThreadLocalå¹¶éæ˜¯ä¸€ä¸ªçº¿ç¨‹çš„æœ¬åœ°å®ç°ç‰ˆæœ¬ï¼Œå®ƒå¹¶ä¸æ˜¯ä¸€ä¸ªThreadï¼Œè€Œæ˜¯threadlocalvariable(çº¿ç¨‹å±€éƒ¨å˜é‡)ã€‚ çº¿ç¨‹å±€éƒ¨å˜é‡(ThreadLocal)çš„åŠŸç”¨å°±æ˜¯ä¸ºæ¯ä¸€ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹éƒ½æä¾›ä¸€ä¸ªå˜é‡å€¼çš„å‰¯æœ¬ï¼Œæ˜¯Javaä¸­ä¸€ç§è¾ƒä¸ºç‰¹æ®Šçš„çº¿ç¨‹ç»‘å®šæœºåˆ¶ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬ï¼Œè€Œä¸ä¼šå’Œå…¶å®ƒçº¿ç¨‹çš„å‰¯æœ¬å†²çªã€‚ ä»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¿æŒä¸€ä¸ªå¯¹å…¶çº¿ç¨‹å±€éƒ¨å˜é‡å‰¯æœ¬çš„éšå¼å¼•ç”¨ï¼Œåªè¦çº¿ç¨‹æ˜¯æ´»åŠ¨çš„å¹¶ä¸” ThreadLocal å®ä¾‹æ˜¯å¯è®¿é—®çš„ï¼›åœ¨çº¿ç¨‹æ¶ˆå¤±ä¹‹åï¼Œå…¶çº¿ç¨‹å±€éƒ¨å®ä¾‹çš„æ‰€æœ‰å‰¯æœ¬éƒ½ä¼šè¢«åƒåœ¾å›æ”¶ï¼ˆé™¤éå­˜åœ¨å¯¹è¿™äº›å‰¯æœ¬çš„å…¶ä»–å¼•ç”¨ï¼‰ã€‚ é€šè¿‡ThreadLocalå­˜å–çš„æ•°æ®ï¼Œæ€»æ˜¯ä¸å½“å‰çº¿ç¨‹ç›¸å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒJVM ä¸ºæ¯ä¸ªè¿è¡Œçš„çº¿ç¨‹ï¼Œç»‘å®šäº†ç§æœ‰çš„æœ¬åœ°å®ä¾‹å­˜å–ç©ºé—´ï¼Œä»è€Œä¸ºå¤šçº¿ç¨‹ç¯å¢ƒå¸¸å‡ºç°çš„å¹¶å‘è®¿é—®é—®é¢˜æä¾›äº†ä¸€ç§éš”ç¦»æœºåˆ¶ã€‚ ThreadLocalæ˜¯å¦‚ä½•åšåˆ°ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹ç»´æŠ¤å˜é‡çš„å‰¯æœ¬çš„å‘¢ï¼Ÿ å®ç°æ€è·¯å¾ˆç®€å•ï¼Œåœ¨ThreadLocalç±»ä¸­æœ‰ä¸€ä¸ªMapï¼Œç”¨äºå­˜å‚¨æ¯ä¸€ä¸ªçº¿ç¨‹çš„å˜é‡çš„å‰¯æœ¬ã€‚ æ¦‚æ‹¬èµ·æ¥è¯´ï¼Œå¯¹äºå¤šçº¿ç¨‹èµ„æºå…±äº«çš„é—®é¢˜ï¼ŒåŒæ­¥æœºåˆ¶é‡‡ç”¨äº†â€œä»¥æ—¶é—´æ¢ç©ºé—´â€çš„æ–¹å¼ï¼Œè€ŒThreadLocalé‡‡ç”¨äº†â€œä»¥ç©ºé—´æ¢æ—¶é—´â€çš„æ–¹å¼ã€‚å‰è€…ä»…æä¾›ä¸€ä»½å˜é‡ï¼Œè®©ä¸åŒçš„çº¿ç¨‹æ’é˜Ÿè®¿é—®ï¼Œè€Œåè€…ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æä¾›äº†ä¸€ä»½å˜é‡ï¼Œå› æ­¤å¯ä»¥åŒæ—¶è®¿é—®è€Œäº’ä¸å½±å“ã€‚ å†…éƒ¨ç»“æ„ å®ç°åŸç† ä»ä¸Šé¢ThreadLocalç±»å›¾ç»“æ„å¯çŸ¥ï¼ŒThreadç±»ä¸­æœ‰ä¸¤ä¸ªå˜é‡threadLocalså’ŒinheritableThreadLocalsï¼ŒäºŒè€…éƒ½æ˜¯ThreadLocalå†…éƒ¨ç±»ThreadLocalMapç±»å‹çš„å˜é‡ã€‚ é€šè¿‡æŸ¥çœ‹å†…éƒ¨ç±»ThreadLocalMapå¯ä»¥å‘ç°å®é™…ä¸Šå®ƒç±»ä¼¼äºä¸€ä¸ªHashMapã€‚åœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªçº¿ç¨‹ä¸­çš„è¿™ä¸¤ä¸ªå˜é‡éƒ½ä¸ºnullï¼Œåªæœ‰å½“çº¿ç¨‹ç¬¬ä¸€æ¬¡è°ƒç”¨ThreadLocalçš„setæˆ–è€…getæ–¹æ³•çš„æ—¶å€™æ‰ä¼šåˆ›å»ºä»–ä»¬ã€‚ æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å˜é‡ä¸æ˜¯å­˜æ”¾åœ¨ThreadLocalå®ä¾‹ä¸­ï¼Œè€Œæ˜¯æ”¾åœ¨è°ƒç”¨çº¿ç¨‹çš„ThreadLocalså˜é‡é‡Œé¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒThreadLocalç±»å‹çš„æœ¬åœ°å˜é‡æ˜¯å­˜æ”¾åœ¨å…·ä½“çš„çº¿ç¨‹ç©ºé—´ä¸Šï¼Œå…¶æœ¬èº«ç›¸å½“äºä¸€ä¸ªè£…è½½æœ¬åœ°å˜é‡çš„å·¥å…·å£³ï¼Œé€šè¿‡setæ–¹æ³•å°†valueæ·»åŠ åˆ°è°ƒç”¨çº¿ç¨‹çš„threadLocalsä¸­ï¼Œå½“è°ƒç”¨çº¿ç¨‹è°ƒç”¨getæ–¹æ³•æ—¶å€™èƒ½å¤Ÿä»å®ƒçš„threadLocalsä¸­å–å‡ºå˜é‡ã€‚å¦‚æœè°ƒç”¨çº¿ç¨‹ä¸€ç›´ä¸ç»ˆæ­¢ï¼Œé‚£ä¹ˆè¿™ä¸ªæœ¬åœ°å˜é‡å°†ä¼šä¸€ç›´å­˜æ”¾åœ¨ä»–çš„threadLocalsä¸­ï¼Œæ‰€ä»¥ä¸ä½¿ç”¨æœ¬åœ°å˜é‡çš„æ—¶å€™éœ€è¦è°ƒç”¨removeæ–¹æ³•å°†threadLocalsä¸­åˆ é™¤ä¸ç”¨çš„æœ¬åœ°å˜é‡ã€‚ æ ¸å¿ƒAPI ThreadLocalç±»æä¾›å¦‚ä¸‹å‡ ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼š 123public T get()public void set(T value)public void remove() setæ–¹æ³• 12345678910111213141516171819public void set(T value) { //è·å–å½“å‰çº¿ç¨‹ï¼ˆè°ƒç”¨è€…çº¿ç¨‹ï¼‰ Thread t = Thread.currentThread(); //ä»¥å½“å‰çº¿ç¨‹ä½œä¸ºkeyå€¼ï¼Œå»æŸ¥æ‰¾å¯¹åº”çš„çº¿ç¨‹å˜é‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„map ThreadLocalMap map = getMap(t); //å¦‚æœmapä¸ä¸ºnullï¼Œå°±ç›´æ¥æ·»åŠ æœ¬åœ°å˜é‡ï¼Œkeyä¸ºå½“å‰çº¿ç¨‹ï¼Œå€¼ä¸ºæ·»åŠ çš„æœ¬åœ°å˜é‡å€¼ if (map != null) map.set(this, value); //å¦‚æœmapä¸ºnullï¼Œè¯´æ˜é¦–æ¬¡æ·»åŠ ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºå‡ºå¯¹åº”çš„map else createMap(t, value);}/** *è·å–çº¿ç¨‹è‡ªå·±çš„å˜é‡threadLocalsï¼Œå¹¶ç»‘å®šåˆ°å½“å‰è°ƒç”¨çº¿ç¨‹çš„æˆå‘˜å˜é‡threadLocalsä¸Š */ThreadLocalMap getMap(Thread t) { return t.threadLocals;} å¦‚æœè°ƒç”¨getMapæ–¹æ³•è¿”å›å€¼ä¸ä¸ºnullï¼Œå°±ç›´æ¥å°†valueå€¼è®¾ç½®åˆ°threadLocalsä¸­ï¼ˆkeyä¸ºå½“å‰çº¿ç¨‹å¼•ç”¨ï¼Œå€¼ä¸ºæœ¬åœ°å˜é‡ï¼‰ï¼› å¦‚æœgetMapæ–¹æ³•è¿”å›nullè¯´æ˜æ˜¯ç¬¬ä¸€æ¬¡è°ƒç”¨setæ–¹æ³•ï¼ˆå‰é¢è¯´åˆ°è¿‡ï¼ŒthreadLocalsé»˜è®¤å€¼ä¸ºnullï¼Œåªæœ‰è°ƒç”¨setæ–¹æ³•çš„æ—¶å€™æ‰ä¼šåˆ›å»ºmapï¼‰ï¼Œè¿™ä¸ªæ—¶å€™å°±éœ€è¦è°ƒç”¨createMapæ–¹æ³•åˆ›å»ºthreadLocals; 123void createMap(Thread t, T firstValue) { t.threadLocals = new ThreadLocalMap(this, firstValue);} createMapæ–¹æ³•ä¸ä»…åˆ›å»ºäº†threadLocalsï¼ŒåŒæ—¶ä¹Ÿå°†è¦æ·»åŠ çš„æœ¬åœ°å˜é‡å€¼æ·»åŠ åˆ°äº†threadLocalsä¸­ã€‚ getæ–¹æ³• 123456789101112131415161718192021222324252627282930313233public T get() { //è·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); //è·å–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡ ThreadLocalMap map = getMap(t); //å¦‚æœthreadLocalså˜é‡ä¸ä¸ºnullï¼Œå°±å¯ä»¥åœ¨mapä¸­æŸ¥æ‰¾åˆ°æœ¬åœ°å˜é‡çš„å€¼ if (map != null) { ThreadLocalMap.Entry e = map.getEntry(this); if (e != null) { @SuppressWarnings("unchecked") T result = (T)e.value; return result; } } //æ‰§è¡Œåˆ°æ­¤å¤„ï¼ŒthreadLocalsä¸ºnullï¼Œè°ƒç”¨è¯¥æ›´æ”¹åˆå§‹åŒ–å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡ return setInitialValue();}private T setInitialValue() { //protected T initialValue() {return null;} T value = initialValue(); //è·å–å½“å‰çº¿ç¨‹ Thread t = Thread.currentThread(); //ä»¥å½“å‰çº¿ç¨‹ä½œä¸ºkeyå€¼ï¼Œå»æŸ¥æ‰¾å¯¹åº”çš„çº¿ç¨‹å˜é‡ï¼Œæ‰¾åˆ°å¯¹åº”çš„map ThreadLocalMap map = getMap(t); //å¦‚æœmapä¸ä¸ºnullï¼Œå°±ç›´æ¥æ·»åŠ æœ¬åœ°å˜é‡ï¼Œkeyä¸ºå½“å‰çº¿ç¨‹ï¼Œå€¼ä¸ºæ·»åŠ çš„æœ¬åœ°å˜é‡å€¼ if (map != null) map.set(this, value); //å¦‚æœmapä¸ºnullï¼Œè¯´æ˜é¦–æ¬¡æ·»åŠ ï¼Œéœ€è¦é¦–å…ˆåˆ›å»ºå‡ºå¯¹åº”çš„map else createMap(t, value); return value;} åœ¨getæ–¹æ³•çš„å®ç°ä¸­ï¼Œé¦–å…ˆè·å–å½“å‰è°ƒç”¨è€…çº¿ç¨‹ï¼Œå¦‚æœå½“å‰çº¿ç¨‹çš„threadLocalsä¸ä¸ºnullï¼Œå°±ç›´æ¥è¿”å›å½“å‰çº¿ç¨‹ç»‘å®šçš„æœ¬åœ°å˜é‡å€¼ï¼Œå¦åˆ™æ‰§è¡ŒsetInitialValueæ–¹æ³•åˆå§‹åŒ–threadLocalså˜é‡ã€‚ åœ¨setInitialValueæ–¹æ³•ä¸­ï¼Œç±»ä¼¼äºsetæ–¹æ³•çš„å®ç°ï¼Œéƒ½æ˜¯åˆ¤æ–­å½“å‰çº¿ç¨‹çš„threadLocalså˜é‡æ˜¯å¦ä¸ºnullï¼Œæ˜¯åˆ™æ·»åŠ æœ¬åœ°å˜é‡ï¼ˆè¿™ä¸ªæ—¶å€™ç”±äºæ˜¯åˆå§‹åŒ–ï¼Œæ‰€ä»¥æ·»åŠ çš„å€¼ä¸ºnullï¼‰ï¼Œå¦åˆ™åˆ›å»ºthreadLocalså˜é‡ï¼ŒåŒæ ·æ·»åŠ çš„å€¼ä¸ºnullã€‚ removeæ–¹æ³• 1234567public void remove() { //è·å–å½“å‰çº¿ç¨‹ç»‘å®šçš„threadLocals ThreadLocalMap m = getMap(Thread.currentThread()); //å¦‚æœmapä¸ä¸ºnullï¼Œå°±ç§»é™¤å½“å‰çº¿ç¨‹ä¸­æŒ‡å®šThreadLocalå®ä¾‹çš„æœ¬åœ°å˜é‡ if (m != null) m.remove(this); } removeæ–¹æ³•åˆ¤æ–­è¯¥å½“å‰çº¿ç¨‹å¯¹åº”çš„threadLocalså˜é‡æ˜¯å¦ä¸ºnullï¼Œä¸ä¸ºnullå°±ç›´æ¥åˆ é™¤å½“å‰çº¿ç¨‹ä¸­æŒ‡å®šçš„threadLocalså˜é‡ã€‚ ThreadLocalMap ThreadLocalMapæ˜¯ThreadLocalçš„å†…éƒ¨ç±»ï¼Œæ²¡æœ‰å®ç°Mapæ¥å£ï¼Œç”¨ç‹¬ç«‹çš„æ–¹å¼å®ç°äº†Mapçš„åŠŸèƒ½ï¼Œå…¶å†…éƒ¨çš„Entryä¹Ÿç‹¬ç«‹å®ç°ã€‚ 123456789101112131415161718192021222324252627282930/** * æ˜¯ç»§æ‰¿è‡ªWeakReferenceçš„ä¸€ä¸ªç±»ï¼Œè¯¥ç±»ä¸­å®é™…å­˜æ”¾çš„keyæ˜¯ * æŒ‡å‘ThreadLocalçš„å¼±å¼•ç”¨å’Œä¸ä¹‹å¯¹åº”çš„valueå€¼(è¯¥valueå€¼ * å°±æ˜¯é€šè¿‡ThreadLocalçš„setæ–¹æ³•ä¼ é€’è¿‡æ¥çš„å€¼) * ç”±äºæ˜¯å¼±å¼•ç”¨ï¼Œå½“getæ–¹æ³•è¿”å›nullçš„æ—¶å€™æ„å‘³ç€å‘èƒ½å¼•ç”¨ */static class Entry extends WeakReference&lt;ThreadLocal&lt;?&gt;&gt; { /** valueå°±æ˜¯å’ŒThreadLocalç»‘å®šçš„ */ Object value; //kï¼šThreadLocalçš„å¼•ç”¨ï¼Œè¢«ä¼ é€’ç»™WeakReferenceçš„æ„é€ æ–¹æ³• Entry(ThreadLocal&lt;?&gt; k, Object v) { super(k); value = v; }}//WeakReferenceæ„é€ æ–¹æ³•(public class WeakReference&lt;T&gt; extends Reference&lt;T&gt; )public WeakReference(T referent) { super(referent); //referentï¼šThreadLocalçš„å¼•ç”¨}//Referenceæ„é€ æ–¹æ³• Reference(T referent) { this(referent, null);//referentï¼šThreadLocalçš„å¼•ç”¨}Reference(T referent, ReferenceQueue&lt;? super T&gt; queue) { this.referent = referent; this.queue = (queue == null) ? ReferenceQueue.NULL : queue;} ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå½“å‰ThreadLocalçš„å¼•ç”¨kè¢«ä¼ é€’ç»™WeakReferenceçš„æ„é€ å‡½æ•°ï¼Œæ‰€ä»¥ThreadLocalMapä¸­çš„keyä¸ºThreadLocalçš„å¼±å¼•ç”¨ã€‚å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨ThreadLocalçš„setæ–¹æ³•è®¾ç½®å˜é‡çš„æ—¶å€™ï¼Œå½“å‰çº¿ç¨‹çš„ThreadLocalMapå°±ä¼šå­˜æ”¾ä¸€ä¸ªè®°å½•ï¼Œè¿™ä¸ªè®°å½•çš„keyå€¼ä¸ºThreadLocalçš„å¼±å¼•ç”¨ï¼Œvalueå°±æ˜¯é€šè¿‡setè®¾ç½®çš„å€¼ã€‚å¦‚æœå½“å‰çº¿ç¨‹ä¸€ç›´å­˜åœ¨ä¸”æ²¡æœ‰è°ƒç”¨è¯¥ThreadLocalçš„removeæ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªæ—¶å€™åˆ«çš„åœ°æ–¹è¿˜æœ‰å¯¹ThreadLocalçš„å¼•ç”¨ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹ä¸­çš„ThreadLocalMapä¸­ä¼šå­˜åœ¨å¯¹ThreadLocalå˜é‡çš„å¼•ç”¨å’Œvalueå¯¹è±¡çš„å¼•ç”¨ï¼Œæ˜¯ä¸ä¼šé‡Šæ”¾çš„ï¼Œå°±ä¼šé€ æˆå†…å­˜æ³„æ¼ã€‚ è€ƒè™‘è¿™ä¸ªThreadLocalå˜é‡æ²¡æœ‰å…¶ä»–å¼ºä¾èµ–ï¼Œå¦‚æœå½“å‰çº¿ç¨‹è¿˜å­˜åœ¨ï¼Œç”±äºçº¿ç¨‹çš„ThreadLocalMapé‡Œé¢çš„keyæ˜¯å¼±å¼•ç”¨ï¼Œæ‰€ä»¥å½“å‰çº¿ç¨‹çš„ThreadLocalMapé‡Œé¢çš„ThreadLocalå˜é‡çš„å¼±å¼•ç”¨åœ¨gcçš„æ—¶å€™å°±è¢«å›æ”¶ï¼Œä½†æ˜¯å¯¹åº”çš„valueè¿˜æ˜¯å­˜åœ¨çš„è¿™å°±å¯èƒ½é€ æˆå†…å­˜æ³„æ¼(å› ä¸ºè¿™ä¸ªæ—¶å€™ThreadLocalMapä¼šå­˜åœ¨keyä¸ºnullä½†æ˜¯valueä¸ä¸ºnullçš„entryé¡¹)ã€‚ æ€»ç»“ï¼šTHreadLocalMapä¸­çš„Entryçš„keyä½¿ç”¨çš„æ˜¯ThreadLocalå¯¹è±¡çš„å¼±å¼•ç”¨ï¼Œåœ¨æ²¡æœ‰å…¶ä»–åœ°æ–¹å¯¹ThreadLocaä¾èµ–ï¼ŒThreadLocalMapä¸­çš„ThreadLocalå¯¹è±¡å°±ä¼šè¢«å›æ”¶æ‰ï¼Œä½†æ˜¯å¯¹åº”çš„ä¸ä¼šè¢«å›æ”¶ï¼Œè¿™ä¸ªæ—¶å€™Mapä¸­å°±å¯èƒ½å­˜åœ¨keyä¸ºnullä½†æ˜¯valueä¸ä¸ºnullçš„é¡¹ï¼Œè¿™éœ€è¦å®é™…çš„æ—¶å€™ä½¿ç”¨å®Œæ¯•åŠæ—¶è°ƒç”¨removeæ–¹æ³•é¿å…å†…å­˜æ³„æ¼ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«]]></title>
    <url>%2Fposts%2F8b544b71.html</url>
    <content type="text"><![CDATA[å‰è¨€ Redisæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäºé”®å€¼å¯¹(Key-Value)ç±»å‹çš„å†…å­˜æ•°æ®åº“ï¼ŒRedisçš„Valueå¯ä»¥ç”±Stringï¼Œhashï¼Œlistï¼Œsetï¼Œzsetï¼ŒBitmapsï¼ŒHyperLogLogç­‰å¤šç§æ•°æ®ç»“æ„å’Œç®—æ³•ç»„æˆã€‚æ•´ä¸ªæ•°æ®åº“ç»Ÿç»ŸåŠ è½½åœ¨å†…å­˜å½“ä¸­è¿›è¡Œæ“ä½œï¼Œå®šæœŸé€šè¿‡å¼‚æ­¥æ“ä½œæŠŠæ•°æ®åº“æ•°æ®flushåˆ°ç¡¬ç›˜ä¸Šè¿›è¡Œä¿å­˜ã€‚å› ä¸ºæ˜¯çº¯å†…å­˜æ“ä½œï¼ŒRedisçš„æ€§èƒ½éå¸¸å‡ºè‰²ï¼Œæ¯ç§’å¯ä»¥å¤„ç†è¶…è¿‡ 10ä¸‡æ¬¡è¯»å†™æ“ä½œï¼Œæ˜¯å·²çŸ¥æ€§èƒ½æœ€å¿«çš„Key-Value DBã€‚å¯ç”¨äºç¼“å­˜ã€äº‹ä»¶å‘å¸ƒæˆ–è®¢é˜…ã€é«˜é€Ÿé˜Ÿåˆ—ç­‰åœºæ™¯ã€‚è¯¥æ•°æ®åº“ä½¿ç”¨ANSI Cè¯­è¨€ç¼–å†™ï¼Œæ”¯æŒç½‘ç»œï¼Œæä¾›å­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é˜Ÿåˆ—ã€é›†åˆç»“æ„ç›´æ¥å­˜å–ï¼ŒåŸºäºå†…å­˜ï¼Œå¯æŒä¹…åŒ–ã€‚Redis å†…ç½®äº† å¤åˆ¶ï¼ˆreplicationï¼‰ï¼ŒLUAè„šæœ¬ï¼ˆLua scriptingï¼‰ï¼Œ LRUé©±åŠ¨äº‹ä»¶ï¼ˆLRU evictionï¼‰ï¼Œäº‹åŠ¡ï¼ˆtransactionsï¼‰ å’Œä¸åŒçº§åˆ«çš„ ç£ç›˜æŒä¹…åŒ–ï¼ˆpersistenceï¼‰ï¼Œ å¹¶é€šè¿‡ Rediså“¨å…µï¼ˆSentinelï¼‰å’Œè‡ªåŠ¨ åˆ†åŒºï¼ˆClusterï¼‰æä¾›é«˜å¯ç”¨æ€§ï¼ˆhigh availabilityï¼‰ã€‚ å®˜æ–¹ç»™å‡ºçš„æ€§èƒ½å¯ä»¥è¾¾åˆ°10W+qpsï¼Œé‚£ä¹ˆRedisåˆ°åº•å¿«åœ¨å“ªå‘¢ï¼Ÿ å¼€å‘è¯­è¨€ ç°åœ¨æˆ‘ä»¬éƒ½ç”¨é«˜çº§è¯­è¨€æ¥ç¼–ç¨‹ï¼Œæ¯”å¦‚Javaã€pythonç­‰ã€‚ä¹Ÿè®¸ä½ ä¼šè§‰å¾—Cè¯­è¨€å¾ˆå¤è€ï¼Œä½†æ˜¯å®ƒçœŸçš„å¾ˆæœ‰ç”¨ï¼Œæ¯•ç«Ÿunixç³»ç»Ÿå°±æ˜¯ç”¨Cå®ç°çš„ï¼Œæ‰€ä»¥Cè¯­è¨€æ˜¯éå¸¸è´´è¿‘æ“ä½œç³»ç»Ÿçš„è¯­è¨€ã€‚Rediså°±æ˜¯ç”¨Cè¯­è¨€å¼€å‘çš„ï¼Œæ‰€ä»¥æ‰§è¡Œä¼šæ¯”è¾ƒå¿«ã€‚ çº¯å†…å­˜è®¿é—® Rediså°†æ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œéæ•°æ®åŒæ­¥æ­£å¸¸å·¥ä½œä¸­ï¼Œæ˜¯ä¸éœ€è¦ä»ç£ç›˜è¯»å–æ•°æ®çš„ï¼Œ0æ¬¡IOã€‚å†…å­˜å“åº”æ—¶é—´å¤§çº¦ä¸º100çº³ç§’ï¼Œè¿™æ˜¯Redisé€Ÿåº¦å¿«çš„é‡è¦åŸºç¡€ã€‚ å•çº¿ç¨‹ ç¬¬ä¸€ï¼Œå•çº¿ç¨‹ç®€åŒ–ç®—æ³•çš„å®ç°ï¼Œå¹¶å‘çš„æ•°æ®ç»“æ„å®ç°ä¸ä½†å›°éš¾ä¸”æµ‹è¯•ä¹Ÿéº»çƒ¦ã€‚ ç¬¬äºŒï¼Œå•çº¿ç¨‹é¿å…äº†çº¿ç¨‹åˆ‡æ¢ä»¥åŠåŠ é”é‡Šæ”¾é”å¸¦æ¥çš„æ¶ˆè€—ï¼Œå¯¹äºæœåŠ¡ç«¯å¼€å‘æ¥è¯´ï¼Œé”å’Œçº¿ç¨‹åˆ‡æ¢é€šå¸¸æ˜¯æ€§èƒ½æ€æ‰‹ã€‚ å½“ç„¶äº†ï¼Œå•çº¿ç¨‹ä¹Ÿä¼šæœ‰å®ƒçš„ç¼ºç‚¹ï¼Œä¹Ÿæ˜¯Redisçš„å™©æ¢¦ï¼šé˜»å¡ã€‚å¦‚æœæ‰§è¡Œä¸€ä¸ªå‘½ä»¤è¿‡é•¿ï¼Œé‚£ä¹ˆä¼šé€ æˆå…¶ä»–å‘½ä»¤çš„é˜»å¡ï¼Œå¯¹äºRedisæ˜¯ååˆ†è‡´å‘½çš„ï¼Œæ‰€ä»¥Redisæ˜¯é¢å‘å¿«é€Ÿæ‰§è¡Œåœºæ™¯çš„æ•°æ®åº“ã€‚ é™¤äº†Redisä¹‹å¤–ï¼ŒNode.jsä¹Ÿæ˜¯å•çº¿ç¨‹ï¼ŒNginxä¹Ÿæ˜¯å•çº¿ç¨‹ï¼Œä½†ä»–ä»¬éƒ½æ˜¯æœåŠ¡å™¨é«˜æ€§èƒ½çš„å…¸èŒƒã€‚ éé˜»å¡å¤šè·¯I/Oå¤ç”¨æœºåˆ¶ å…ˆè¯´ä¸€ä¸‹ä¼ ç»Ÿçš„é˜»å¡I/Oæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š å½“ä½¿ç”¨readæˆ–è€…writeå¯¹æŸä¸€æ–‡ä»¶æè¿°ç¬¦ï¼ˆFile Descriptor FDï¼‰è¿›è¡Œè¯»å†™çš„æ—¶å€™ï¼Œå¦‚æœæ•°æ®æ²¡æœ‰æ”¶åˆ°ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè¢«æŒ‚èµ·ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®ã€‚é˜»å¡æ¨¡å‹è™½ç„¶æ˜“äºç†è§£ï¼Œä½†æ˜¯åœ¨éœ€è¦å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯ä»»åŠ¡çš„æ—¶å€™ï¼Œä¸ä¼šä½¿ç”¨é˜»å¡æ¨¡å‹ã€‚ I/Oå¤šè·¯å¤ç”¨å®é™…ä¸Šæ˜¯æŒ‡å¤šä¸ªè¿æ¥çš„**ç®¡ç†å¯ä»¥åœ¨åŒä¸€è¿›ç¨‹ã€‚**å¤šè·¯æ˜¯æŒ‡ç½‘ç»œè¿æ¥ï¼Œå¤ç”¨åªæ˜¯åŒä¸€ä¸ªçº¿ç¨‹ã€‚åœ¨ç½‘ç»œæœåŠ¡ä¸­ï¼ŒI/Oå¤šè·¯å¤ç”¨èµ·çš„ä½œç”¨æ˜¯ä¸€æ¬¡æ€§æŠŠå¤šä¸ªè¿æ¥çš„äº‹ä»¶é€šçŸ¥ä¸šåŠ¡ä»£ç å¤„ç†ï¼Œå¤„ç†çš„æ–¹å¼ç”±ä¸šåŠ¡ä»£ç æ¥å†³å®šã€‚åœ¨I/Oå¤šè·¯å¤ç”¨æ¨¡å‹ä¸­ï¼Œæœ€é‡è¦çš„å‡½æ•°è°ƒç”¨å°±æ˜¯I/O å¤šè·¯å¤ç”¨å‡½æ•°ï¼Œè¯¥æ–¹æ³•èƒ½åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰çš„è¯»å†™æƒ…å†µï¼Œå½“å…¶ä¸­çš„æŸäº›fdå¯è¯»/å†™æ—¶ï¼Œè¯¥æ–¹æ³•å°±ä¼šè¿”å›å¯è¯»/å†™çš„fdä¸ªæ•°ã€‚ Redisä½¿ç”¨epollä½œä¸ºI/Oå¤šè·¯å¤ç”¨æŠ€æœ¯çš„å®ç°ï¼Œå†åŠ ä¸ŠRedisè‡ªèº«çš„äº‹ä»¶å¤„ç†æ¨¡å‹å°†epollçš„readã€writeã€closeç­‰éƒ½è½¬æ¢æˆäº‹ä»¶ï¼Œä¸åœ¨ç½‘ç»œI/Oä¸Šæµªè´¹è¿‡å¤šçš„æ—¶é—´ã€‚å®ç°å¯¹å¤šä¸ªFDè¯»å†™çš„ç›‘æ§ï¼Œæé«˜æ€§èƒ½ã€‚ ä¸¾ä¸ªä¾‹å­:æ¯”å¦‚ä¸€ä¸ªtcpæœåŠ¡å™¨å¤„ç†20ä¸ªå®¢æˆ·ç«¯socketã€‚ Aæ–¹æ¡ˆï¼šé¡ºåºå¤„ç†ï¼Œå¦‚æœç¬¬ä¸€ä¸ªsocketå› ä¸ºç½‘å¡è¯»æ•°æ®å¤„ç†æ…¢äº†ï¼Œä¸€é˜»å¡ï¼Œåé¢éƒ½ç©è›‹å»ã€‚ Bæ–¹æ¡ˆï¼šæ¯ä¸ªsocketè¯·æ±‚éƒ½åˆ›å»ºä¸€ä¸ªåˆ†èº«å­è¿›ç¨‹æ¥å¤„ç†ï¼Œä¸è¯´æ¯ä¸ªè¿›ç¨‹æ¶ˆè€—å¤§é‡ç³»ç»Ÿèµ„æºï¼Œå…‰æ˜¯è¿›ç¨‹åˆ‡æ¢å°±å¤Ÿæ“ä½œç³»ç»Ÿç´¯çš„äº†ã€‚ Cæ–¹æ¡ˆ**ï¼ˆI/Oå¤ç”¨æ¨¡å‹ï¼Œepollï¼‰ï¼šå°†ç”¨æˆ·socketå¯¹åº”çš„fdæ³¨å†Œè¿›epollï¼ˆå®é™…ä¸ŠæœåŠ¡å™¨å’Œæ“ä½œç³»ç»Ÿä¹‹é—´ä¼ é€’çš„ä¸æ˜¯socketçš„fdè€Œæ˜¯fd_setçš„æ•°æ®ç»“æ„ï¼‰ï¼Œç„¶åepollåªå‘Šè¯‰å“ªäº›éœ€è¦è¯»/å†™çš„socketï¼Œåªéœ€è¦å¤„ç†é‚£äº›æ´»è·ƒçš„ã€æœ‰å˜åŒ–çš„socket fdçš„å°±å¥½äº†ã€‚è¿™æ ·ï¼Œæ•´ä¸ªè¿‡ç¨‹åªåœ¨è°ƒç”¨epollçš„æ—¶å€™æ‰ä¼šé˜»å¡ï¼Œæ”¶å‘å®¢æˆ·æ¶ˆæ¯æ˜¯ä¸ä¼šé˜»å¡çš„ã€‚** document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Redis - å¸¸ç”¨æ•°æ®ç±»å‹åŠå‘½ä»¤]]></title>
    <url>%2Fposts%2F2853eeb9.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Redisä¸­å­˜å‚¨æ•°æ®æ˜¯é€šè¿‡key-valueæ ¼å¼å­˜å‚¨æ•°æ®çš„ï¼Œå…¶ä¸­valueå¯ä»¥å®šä¹‰äº”ç§æ•°æ®ç±»å‹ï¼š Stringï¼ˆå­—ç¬¦ç±»å‹ï¼‰ Hashï¼ˆæ•£åˆ—ç±»å‹ï¼‰ Listï¼ˆåˆ—è¡¨ç±»å‹ï¼‰ Setï¼ˆé›†åˆç±»å‹ï¼‰ SortedSetï¼ˆæœ‰åºé›†åˆç±»å‹ï¼Œç®€ç§°zsetï¼‰ æ³¨æ„ï¼šåœ¨redisä¸­çš„å‘½ä»¤è¯­å¥ä¸­ï¼Œå‘½ä»¤æ˜¯å¿½ç•¥å¤§å°å†™çš„ï¼Œè€Œkeyæ˜¯ä¸å¿½ç•¥å¤§å°å†™çš„ã€‚ Stringç±»å‹ èµ‹å€¼ è¯­æ³•ï¼šset key value 12127.0.0.1:6379&gt; set k1 v1OK å–å€¼ è¯­æ³•ï¼šget key 12127.0.0.1:6379&gt; get k1"v1" å–å€¼å¹¶èµ‹å€¼ è¯­æ³•ï¼šgetset key value 1234127.0.0.1:6379&gt; getset k1 v2"v1"127.0.0.1:6379&gt; get k1"v2" é€’å¢æ•°å­— è¯­æ³•ï¼šINCR key 123456127.0.0.1:6379&gt; incr num(integer) 1127.0.0.1:6379&gt; incr num(integer) 2127.0.0.1:6379&gt; incr num(integer) 3 å¢åŠ æŒ‡å®šçš„æ•´æ•° è¯­æ³•ï¼šINCRBY key increment 123456127.0.0.1:6379&gt; incrby num 2(integer) 5127.0.0.1:6379&gt; incrby num 2(integer) 7127.0.0.1:6379&gt; incrby num 2(integer) 9 é€’å‡æ•°å€¼ è¯­æ³•ï¼šDECR key 1234 127.0.0.1:6379&gt; decr num(integer) 9127.0.0.1:6379&gt; decr num(integer) 8 å‡å°‘æŒ‡å®šçš„æ•´æ•° è¯­æ³•ï¼šDECRBY key decrement 12345678127.0.0.1:6379&gt; decr num(integer) 6127.0.0.1:6379&gt; decr num(integer) 5127.0.0.1:6379&gt; decrby num 3(integer) 2127.0.0.1:6379&gt; decrby num 3(integer) -1 ä»…å½“ä¸å­˜åœ¨æ—¶èµ‹å€¼ è¯­æ³•ï¼šsetnx key value 12345678redis&gt; EXISTS k1 # k1 ä¸å­˜åœ¨(integer) 0redis&gt; SETNX k1 "v1" # k1è®¾ç½®æˆåŠŸ(integer) 1redis&gt; SETNX k1 "v2" # å°è¯•è¦†ç›– k1ï¼Œå¤±è´¥(integer) 0redis&gt; GET k1 # æ²¡æœ‰è¢«è¦†ç›–"v1" å‘å°¾éƒ¨è¿½åŠ å€¼ APPENDå‘½ä»¤ï¼Œå‘é”®å€¼çš„æœ«å°¾è¿½åŠ valueã€‚å¦‚æœé”®ä¸å­˜åœ¨åˆ™å°†è¯¥é”®çš„å€¼è®¾ç½®ä¸ºvalueï¼Œå³ç›¸å½“äº SET key valueã€‚è¿”å›å€¼æ˜¯è¿½åŠ åå­—ç¬¦ä¸²çš„æ€»é•¿åº¦ã€‚ è¯­æ³•ï¼šAPPEND key value 123456127.0.0.1:6379&gt; set str helloOK127.0.0.1:6379&gt; append str " world!"(integer) 12127.0.0.1:6379&gt; get str "hello world!" è·å–å­—ç¬¦ä¸²é•¿åº¦ STRLENå‘½ä»¤ï¼Œè¿”å›é”®å€¼çš„é•¿åº¦ï¼Œå¦‚æœé”®ä¸å­˜åœ¨åˆ™è¿”å›0ã€‚ è¯­æ³•ï¼šSTRLEN key 123456127.0.0.1:6379&gt; strlen str (integer) 0127.0.0.1:6379&gt; set str helloOK127.0.0.1:6379&gt; strlen str (integer) 5 åŒæ—¶è®¾ç½®/è·å–å¤šä¸ªé”®å€¼ è¯­æ³•ï¼š MSET key value [key value â€¦] MGET key [key â€¦] 1234567127.0.0.1:6379&gt; mset k1 v1 k2 v2 k3 v3OK127.0.0.1:6379&gt; get k1"v1"127.0.0.1:6379&gt; mget k1 k31) "v1"2) "v3" Hashç±»å‹ hashå«æ•£åˆ—ç±»å‹ï¼Œå®ƒæä¾›äº†å­—æ®µå’Œå­—æ®µå€¼çš„æ˜ å°„ã€‚å­—æ®µå€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¸æ”¯æŒæ•£åˆ—ç±»å‹ã€é›†åˆç±»å‹ç­‰å…¶å®ƒç±»å‹ã€‚å¦‚ä¸‹ï¼š èµ‹å€¼ HSETå‘½ä»¤ä¸åŒºåˆ†æ’å…¥å’Œæ›´æ–°æ“ä½œï¼Œå½“æ‰§è¡Œæ’å…¥æ“ä½œæ—¶HSETå‘½ä»¤è¿”å›1ï¼Œå½“æ‰§è¡Œæ›´æ–°æ“ä½œæ—¶0ã€‚ ä¸€æ¬¡åªèƒ½è®¾ç½®ä¸€ä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHSET key field value 12127.0.0.1:6379&gt; hset user username zhangsan (integer) 1 ä¸€æ¬¡å¯ä»¥è®¾ç½®å¤šä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHMSET key field value [field value ...] 12127.0.0.1:6379&gt; hmset user age 20 username lisi OK å½“å€¼ä¸å­˜åœ¨æ‰èµ‹å€¼ å½“å­—æ®µä¸å­˜åœ¨æ—¶èµ‹å€¼ï¼Œç±»ä¼¼HSETï¼ŒåŒºåˆ«åœ¨äºå¦‚æœå­—æ®µå­˜åœ¨ï¼Œè¯¥å‘½ä»¤ä¸æ‰§è¡Œä»»ä½•æ“ä½œ è¯­æ³•ï¼šHSETNX key field value 12127.0.0.1:6379&gt; hsetnx user age 30 (integer) 0 å¦‚æœuserä¸­æ²¡æœ‰ageå­—æ®µåˆ™è®¾ç½®ageå€¼ä¸º30ï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œ å–å€¼ ä¸€æ¬¡åªèƒ½è·å–ä¸€ä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHGET key field 12127.0.0.1:6379&gt; hget user username"lisiâ€œ ä¸€æ¬¡å¯ä»¥è·å–å¤šä¸ªå­—æ®µå€¼ è¯­æ³•ï¼šHMGET key field [field ...] 123127.0.0.1:6379&gt; hmget user age username1) "20"2) "lisi" è·å–æ‰€æœ‰å­—æ®µå€¼ è¯­æ³•ï¼šHGETALL key 12345127.0.0.1:6379&gt; hgetall user1) "age"2) "20"3) "username"4) "lisi" åˆ é™¤å­—æ®µ å¯ä»¥åˆ é™¤ä¸€ä¸ªæˆ–å¤šä¸ªå­—æ®µï¼Œè¿”å›å€¼æ˜¯è¢«åˆ é™¤çš„å­—æ®µä¸ªæ•° è¯­æ³•ï¼šHDEL key field [field ...] 123456127.0.0.1:6379&gt; hdel user age(integer) 1127.0.0.1:6379&gt; hdel user age name(integer) 0127.0.0.1:6379&gt; hdel user age username(integer) 1 å¢åŠ æ•°å­— è¯­æ³•ï¼šHINCRBY key field increment 123456#å°†ç”¨æˆ·çš„å¹´é¾„åŠ 2127.0.0.1:6379&gt; hincrby user age 2 (integer) 22#è·å–ç”¨æˆ·çš„å¹´é¾„127.0.0.1:6379&gt; hget user age "22" åˆ¤æ–­å­—æ®µæ˜¯å¦å­˜åœ¨ è¯­æ³•ï¼šHEXISTS key field 123456#æŸ¥çœ‹userä¸­æ˜¯å¦æœ‰ageå­—æ®µ127.0.0.1:6379&gt; hexists user age (integer) 1#æŸ¥çœ‹userä¸­æ˜¯å¦æœ‰nameå­—æ®µ127.0.0.1:6379&gt; hexists user name (integer) 0 åªè·å–å­—æ®µåæˆ–å­—æ®µå€¼ è¯­æ³•ï¼š 12HKEYS keyHVALS key 12345678127.0.0.1:6379&gt; hmset user age 20 name lisi OK127.0.0.1:6379&gt; hkeys user1) "age"2) "name"127.0.0.1:6379&gt; hvals user1) "20"2) "lisi" è·å–å­—æ®µæ•°é‡ è¯­æ³•ï¼šHLEN key 12127.0.0.1:6379&gt; hlen user(integer) 2 è·å–æ‰€æœ‰å­—æ®µ ä½œç”¨ï¼šè·å¾—hashçš„æ‰€æœ‰ä¿¡æ¯ï¼ŒåŒ…æ‹¬keyå’Œvalue è¯­æ³•ï¼šhgetall key Listç±»å‹ Redisçš„åˆ—è¡¨ç±»å‹ï¼ˆlistï¼‰å¯ä»¥å­˜å‚¨ä¸€ä¸ªæœ‰åºçš„å­—ç¬¦ä¸²åˆ—è¡¨ï¼Œå¸¸ç”¨çš„æ“ä½œæ˜¯å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ ï¼Œæˆ–è€…è·å¾—åˆ—è¡¨çš„æŸä¸€ä¸ªç‰‡æ®µã€‚ åˆ—è¡¨ç±»å‹å†…éƒ¨æ˜¯ä½¿ç”¨**åŒå‘é“¾è¡¨ï¼ˆdouble linked listï¼‰**å®ç°çš„ï¼Œæ‰€ä»¥å‘åˆ—è¡¨ä¸¤ç«¯æ·»åŠ å…ƒç´ çš„æ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè·å–è¶Šæ¥è¿‘ä¸¤ç«¯çš„å…ƒç´ é€Ÿåº¦å°±è¶Šå¿«ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯ä¸€ä¸ªæœ‰å‡ åƒä¸‡ä¸ªå…ƒç´ çš„åˆ—è¡¨ï¼Œè·å–å¤´éƒ¨æˆ–å°¾éƒ¨çš„10æ¡è®°å½•ä¹Ÿæ˜¯æå¿«çš„ã€‚ å‘åˆ—è¡¨å·¦è¾¹å¢åŠ å…ƒç´  è¯­æ³•ï¼šLPUSH key value [value ...] 12127.0.0.1:6379&gt; lpush list:1 1 2 3(integer) 3 å‘åˆ—è¡¨å³è¾¹å¢åŠ å…ƒç´  è¯­æ³•ï¼šRPUSH key value [value ...] 12127.0.0.1:6379&gt; rpush list:1 4 5 6(integer) 6 æŸ¥çœ‹åˆ—è¡¨ è¯­æ³•ï¼šLRANGE key start stop LRANGEå‘½ä»¤æ˜¯åˆ—è¡¨ç±»å‹æœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œè·å–åˆ—è¡¨ä¸­çš„æŸä¸€ç‰‡æ®µï¼Œå°†è¿”å›startã€stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ï¼Œç´¢å¼•ä»0å¼€å§‹ã€‚ç´¢å¼•å¯ä»¥æ˜¯è´Ÿæ•°ï¼Œå¦‚ï¼šâ€œ-1â€ä»£è¡¨æœ€åè¾¹çš„ä¸€ä¸ªå…ƒç´ ã€‚ 1234127.0.0.1:6379&gt; lrange list:1 0 21) "3"2) "2"3) "1" ä»åˆ—è¡¨ä¸¤ç«¯å¼¹å‡ºå…ƒç´  LPOPå‘½ä»¤ä»åˆ—è¡¨å·¦è¾¹å¼¹å‡ºä¸€ä¸ªå…ƒç´ ï¼Œä¼šåˆ†ä¸¤æ­¥å®Œæˆï¼š ç¬¬ä¸€æ­¥æ˜¯å°†åˆ—è¡¨å·¦è¾¹çš„å…ƒç´ ä»åˆ—è¡¨ä¸­ç§»é™¤ ç¬¬äºŒæ­¥æ˜¯è¿”å›è¢«ç§»é™¤çš„å…ƒç´ å€¼ã€‚ è¯­æ³•ï¼š 123LPOP keyRPOP key 1234127.0.0.1:6379&gt; lpop list:1"3"127.0.0.1:6379&gt; rpop list:1"6" è·å–åˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•° è¯­æ³•ï¼šLLEN key 12127.0.0.1:6379&gt; llen list:1(integer) 4 åˆ é™¤åˆ—è¡¨ä¸­æŒ‡å®šä¸ªæ•°çš„å€¼ LREMå‘½ä»¤ä¼šåˆ é™¤åˆ—è¡¨ä¸­å‰countä¸ªå€¼ä¸ºvalueçš„å…ƒç´ ï¼Œè¿”å›å®é™…åˆ é™¤çš„å…ƒç´ ä¸ªæ•°ã€‚æ ¹æ®countå€¼çš„ä¸åŒï¼Œè¯¥å‘½ä»¤çš„æ‰§è¡Œæ–¹å¼ä¼šæœ‰æ‰€ä¸åŒï¼š å½“count&gt;0æ—¶ï¼Œ LREMä¼šä»åˆ—è¡¨å·¦è¾¹å¼€å§‹åˆ é™¤ã€‚ å½“count&lt;0æ—¶ï¼Œ LREMä¼šä»åˆ—è¡¨åè¾¹å¼€å§‹åˆ é™¤ã€‚ å½“count=0æ—¶ï¼Œ LREMåˆ é™¤æ‰€æœ‰å€¼ä¸ºvalueçš„å…ƒç´ ã€‚ è¯­æ³•ï¼šLREM key count value è·å¾—æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ è¯­æ³•ï¼šLINDEX key index 12127.0.0.1:6379&gt; lindex list:1 2"4" è®¾ç½®æŒ‡å®šç´¢å¼•çš„å…ƒç´ å€¼ è¯­æ³•ï¼šLSET key index value 1234567127.0.0.1:6379&gt; lset list:1 2 2OK127.0.0.1:6379&gt; lrange list:1 0 -11) "2"2) "1"3) "2"4) "5" åªä¿ç•™åˆ—è¡¨æŒ‡å®šç‰‡æ®µ, æŒ‡å®šèŒƒå›´å’ŒLRANGEä¸€è‡´ è¯­æ³•ï¼šLTRIM key start stop 1234567891011127.0.0.1:6379&gt; lrange list:1 0 -11) "2"2) "1"3) "2"4) "5"127.0.0.1:6379&gt; ltrim list:1 0 2OK127.0.0.1:6379&gt; lrange list:1 0 -11) "2"2) "1"3) "2" å‘åˆ—è¡¨ä¸­æ’å…¥å…ƒç´  è¯¥å‘½ä»¤é¦–å…ˆä¼šåœ¨åˆ—è¡¨ä¸­ä»å·¦åˆ°å³æŸ¥æ‰¾å€¼ä¸ºpivotçš„å…ƒç´ ï¼Œç„¶åæ ¹æ®ç¬¬äºŒä¸ªå‚æ•°æ˜¯BEFOREè¿˜æ˜¯AFTERæ¥å†³å®šå°†valueæ’å…¥åˆ°è¯¥å…ƒç´ çš„å‰é¢è¿˜æ˜¯åé¢ã€‚ è¯­æ³•ï¼šLINSERT key BEFORE|AFTER pivot value 1234567891011127.0.0.1:6379&gt; lrange list 0 -11) "3"2) "2"3) "1"127.0.0.1:6379&gt; linsert list after 3 4(integer) 4127.0.0.1:6379&gt; lrange list 0 -11) "3"2) "4"3) "2"4) "1" å°†å…ƒç´ ä»ä¸€ä¸ªåˆ—è¡¨è½¬ç§»åˆ°å¦ä¸€ä¸ªåˆ—è¡¨ä¸­ è¯­æ³•ï¼šRPOPLPUSH source destination 12345678127.0.0.1:6379&gt; rpoplpush list newlist "1"127.0.0.1:6379&gt; lrange newlist 0 -11) "1"127.0.0.1:6379&gt; lrange list 0 -11) "3"2) "4"3) "2" Setç±»å‹ setç±»å‹å³é›†åˆç±»å‹ï¼Œå…¶ä¸­çš„æ•°æ®æ˜¯ä¸é‡å¤ä¸”æ²¡æœ‰é¡ºåºã€‚ é›†åˆç±»å‹å’Œåˆ—è¡¨ç±»å‹çš„å¯¹æ¯”ï¼š é›†åˆç±»å‹çš„å¸¸ç”¨æ“ä½œæ˜¯å‘é›†åˆä¸­åŠ å…¥æˆ–åˆ é™¤å…ƒç´ ã€åˆ¤æ–­æŸä¸ªå…ƒç´ æ˜¯å¦å­˜åœ¨ç­‰ï¼Œç”±äºé›†åˆç±»å‹çš„Rediså†…éƒ¨æ˜¯ä½¿ç”¨å€¼ä¸ºç©ºçš„æ•£åˆ—è¡¨å®ç°ï¼Œæ‰€æœ‰è¿™äº›æ“ä½œçš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸º0(1)ã€‚Redisè¿˜æä¾›äº†å¤šä¸ªé›†åˆä¹‹é—´çš„äº¤é›†ã€å¹¶é›†ã€å·®é›†çš„è¿ç®—ã€‚ å¢åŠ /åˆ é™¤å…ƒç´  è¯­æ³•ï¼šSADD key member [member ...] 1234127.0.0.1:6379&gt; sadd set a b c(integer) 3127.0.0.1:6379&gt; sadd set a(integer) 0 è¯­æ³•ï¼šSREM key member [member ...] 12127.0.0.1:6379&gt; srem set c d(integer) 1 è·å¾—é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´  è¯­æ³•ï¼šSMEMBERS key 123127.0.0.1:6379&gt; smembers set1) "b"2) "aâ€ åˆ¤æ–­å…ƒç´ æ˜¯å¦åœ¨é›†åˆä¸­ è¯­æ³•ï¼šSISMEMBER key member 1234127.0.0.1:6379&gt; sismember set a(integer) 1127.0.0.1:6379&gt; sismember set h(integer) 0 é›†åˆè¿ç®—å‘½ä»¤ é›†åˆçš„å·®é›†è¿ç®— A-B : å±äºAå¹¶ä¸”ä¸å±äºBçš„å…ƒç´ æ„æˆçš„é›†åˆã€‚ è¯­æ³•ï¼šSDIFF key [key ...] 12345678127.0.0.1:6379&gt; sadd setA 1 2 3(integer) 3127.0.0.1:6379&gt; sadd setB 2 3 4(integer) 3127.0.0.1:6379&gt; sdiff setA setB 1) "1"127.0.0.1:6379&gt; sdiff setB setA 1) "4" é›†åˆçš„äº¤é›†è¿ç®— A âˆ© B : å±äºAä¸”å±äºBçš„å…ƒç´ æ„æˆçš„é›†åˆã€‚ è¯­æ³•ï¼šSINTER key [key ...] 123127.0.0.1:6379&gt; sinter setA setB 1) "2"2) "3" é›†åˆçš„å¹¶é›†è¿ç®— A âˆª B : å±äºAæˆ–è€…å±äºBçš„å…ƒç´ æ„æˆçš„é›†åˆ è¯­æ³•ï¼šSUNION key [key ...] 12345127.0.0.1:6379&gt; sunion setA setB1) "1"2) "2"3) "3"4) "4" è·å¾—é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•° è¯­æ³•ï¼šSCARD key 123456127.0.0.1:6379&gt; smembers setA 1) "1"2) "2"3) "3"127.0.0.1:6379&gt; scard setA (integer) 3 ä»é›†åˆä¸­å¼¹å‡ºä¸€ä¸ªå…ƒç´  æ³¨æ„ï¼šç”±äºé›†åˆæ˜¯æ— åºçš„ï¼Œæ‰€æœ‰SPOPå‘½ä»¤ä¼šä»é›†åˆä¸­éšæœºé€‰æ‹©ä¸€ä¸ªå…ƒç´ å¼¹å‡º è¯­æ³•ï¼šSPOP key 12127.0.0.1:6379&gt; spop setA "1" ZSetç±»å‹ åœ¨é›†åˆç±»å‹çš„åŸºç¡€ä¸Šï¼Œæœ‰åºé›†åˆç±»å‹ä¸ºé›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ éƒ½å…³è”ä¸€ä¸ªåˆ†æ•°ï¼Œè¿™ä½¿å¾—æˆ‘ä»¬ä¸ä»…å¯ä»¥å®Œæˆæ’å…¥ã€åˆ é™¤å’Œåˆ¤æ–­å…ƒç´ æ˜¯å¦å­˜åœ¨åœ¨é›†åˆä¸­ï¼Œè¿˜èƒ½å¤Ÿè·å¾—åˆ†æ•°æœ€é«˜æˆ–æœ€ä½çš„å‰Nä¸ªå…ƒç´ ã€è·å–æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ç­‰ä¸åˆ†æ•°æœ‰å…³çš„æ“ä½œã€‚ åœ¨æŸäº›æ–¹é¢æœ‰åºé›†åˆå’Œåˆ—è¡¨ç±»å‹æœ‰äº›ç›¸ä¼¼ï¼š äºŒè€…éƒ½æ˜¯æœ‰åºçš„ã€‚ äºŒè€…éƒ½å¯ä»¥è·å¾—æŸä¸€èŒƒå›´çš„å…ƒç´ ã€‚ ä½†æ˜¯ï¼ŒäºŒè€…æœ‰ç€å¾ˆå¤§åŒºåˆ«ï¼š åˆ—è¡¨ç±»å‹æ˜¯é€šè¿‡é“¾è¡¨å®ç°çš„ï¼Œè·å–é è¿‘ä¸¤ç«¯çš„æ•°æ®é€Ÿåº¦æå¿«ï¼Œè€Œå½“å…ƒç´ å¢å¤šåï¼Œè®¿é—®ä¸­é—´æ•°æ®çš„é€Ÿåº¦ä¼šå˜æ…¢ã€‚ æœ‰åºé›†åˆç±»å‹ä½¿ç”¨æ•£åˆ—è¡¨å®ç°ï¼Œæ‰€ä»¥å³ä½¿è¯»å–ä½äºä¸­é—´éƒ¨åˆ†çš„æ•°æ®ä¹Ÿå¾ˆå¿«ã€‚ åˆ—è¡¨ä¸­ä¸èƒ½ç®€å•çš„è°ƒæ•´æŸä¸ªå…ƒç´ çš„ä½ç½®ï¼Œä½†æ˜¯æœ‰åºé›†åˆå¯ä»¥ï¼ˆé€šè¿‡æ›´æ”¹åˆ†æ•°å®ç°ï¼‰ æœ‰åºé›†åˆè¦æ¯”åˆ—è¡¨ç±»å‹æ›´è€—å†…å­˜ã€‚ å¢åŠ å…ƒç´  å‘æœ‰åºé›†åˆä¸­åŠ å…¥ä¸€ä¸ªå…ƒç´ å’Œè¯¥å…ƒç´ çš„åˆ†æ•°ï¼Œå¦‚æœè¯¥å…ƒç´ å·²ç»å­˜åœ¨åˆ™ä¼šç”¨æ–°çš„åˆ†æ•°æ›¿æ¢åŸæœ‰çš„åˆ†æ•°ã€‚è¿”å›å€¼æ˜¯æ–°åŠ å…¥åˆ°é›†åˆä¸­çš„å…ƒç´ ä¸ªæ•°ï¼Œä¸åŒ…å«ä¹‹å‰å·²ç»å­˜åœ¨çš„å…ƒç´ ã€‚ è¯­æ³•ï¼šZADD key score member [score member ...] 1234127.0.0.1:6379&gt; zadd scoreboard 80 zhangsan 89 lisi 94 wangwu (integer) 3127.0.0.1:6379&gt; zadd scoreboard 97 lisi (integer) 0 è·å¾—æ’ååœ¨æŸä¸ªèŒƒå›´çš„å…ƒç´ åˆ—è¡¨ æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å°åˆ°å¤§çš„é¡ºåºè¿”å›ç´¢å¼•ä»startåˆ°stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ è¯­æ³•ï¼šZRANGE key start stop [WITHSCORES] 1234127.0.0.1:6379&gt; zrange scoreboard 0 21) "zhangsan"2) "wangwu"3) "lisiâ€œ æŒ‰ç…§å…ƒç´ åˆ†æ•°ä»å¤§åˆ°å°çš„é¡ºåºè¿”å›ç´¢å¼•ä»startåˆ°stopä¹‹é—´çš„æ‰€æœ‰å…ƒç´ ï¼ˆåŒ…å«ä¸¤ç«¯çš„å…ƒç´ ï¼‰ è¯­æ³•ï¼šZREVRANGE key start stop [WITHSCORES] 1234127.0.0.1:6379&gt; zrevrange scoreboard 0 21) "lisi"2) "wangwu"3) "zhangsan" å¦‚æœéœ€è¦è·å¾—å…ƒç´ çš„åˆ†æ•°çš„å¯ä»¥åœ¨å‘½ä»¤å°¾éƒ¨åŠ ä¸ŠWITHSCORESå‚æ•° 12345127.0.0.1:6379&gt; zrange scoreboard 0 1 WITHSCORES1) "zhangsan"2) "80"3) "wangwu"4) "94" è·å–å…ƒç´ çš„åˆ†æ•° è¯­æ³•ï¼šZSCORE key member 12127.0.0.1:6379&gt; zscore scoreboard lisi "97" åˆ é™¤å…ƒç´  ç§»é™¤æœ‰åºé›†keyä¸­çš„ä¸€ä¸ªæˆ–å¤šä¸ªæˆå‘˜ï¼Œä¸å­˜åœ¨çš„æˆå‘˜å°†è¢«å¿½ç•¥ã€‚å½“keyå­˜åœ¨ä½†ä¸æ˜¯æœ‰åºé›†ç±»å‹æ—¶ï¼Œè¿”å›ä¸€ä¸ªé”™è¯¯ã€‚ è¯­æ³•ï¼šZREM key member [member ...] 12127.0.0.1:6379&gt; zrem scoreboard lisi(integer) 1 è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´çš„å…ƒç´  è¯­æ³•ï¼šZRANGEBYSCORE key min max [WITHSCORES] [LIMIT offset count] 12345127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 90 97 WITHSCORES1) "wangwu"2) "94"127.0.0.1:6379&gt; ZRANGEBYSCORE scoreboard 70 100 limit 1 21) "wangwu" å¢åŠ æŸä¸ªå…ƒç´ çš„åˆ†æ•° è¿”å›å€¼æ˜¯æ›´æ”¹åçš„åˆ†æ•° è¯­æ³•ï¼šZINCRBY key increment member 12127.0.0.1:6379&gt; ZINCRBY scoreboard 4 lisi "101" è·å¾—é›†åˆä¸­å…ƒç´ çš„æ•°é‡ è¯­æ³•ï¼šZCARD key 12127.0.0.1:6379&gt; ZCARD scoreboard(integer) 3 è·å¾—æŒ‡å®šåˆ†æ•°èŒƒå›´å†…çš„å…ƒç´ ä¸ªæ•° è¯­æ³•ï¼šZCOUNT key min max 12127.0.0.1:6379&gt; ZCOUNT scoreboard 80 90(integer) 1 æŒ‰ç…§æ’åèŒƒå›´åˆ é™¤å…ƒç´  è¯­æ³•ï¼šZREMRANGEBYRANK key start stop 1234127.0.0.1:6379&gt; ZREMRANGEBYRANK scoreboard 0 1(integer) 2 127.0.0.1:6379&gt; ZRANGE scoreboard 0 -11) "lisi" æŒ‰ç…§åˆ†æ•°èŒƒå›´åˆ é™¤å…ƒç´  è¯­æ³•ï¼šZREMRANGEBYSCORE key min max 1234127.0.0.1:6379&gt; zadd scoreboard 84 zhangsan (integer) 1127.0.0.1:6379&gt; ZREMRANGEBYSCORE scoreboard 80 100(integer) 1 è·å–å…ƒç´ çš„æ’å ä»å°åˆ°å¤§ è¯­æ³•ï¼šZRANK key member 12127.0.0.1:6379&gt; ZRANK scoreboard lisi (integer) 0 ä»å¤§åˆ°å° è¯­æ³•ï¼šZREVRANK key member 12127.0.0.1:6379&gt; ZREVRANK scoreboard zhangsan (nil) é€šç”¨å‘½ä»¤ keys ä½œç”¨ï¼šè¿”å›æ»¡è¶³ç»™å®špattern çš„æ‰€æœ‰key è¯­æ³•ï¼škeys pattern 123456127.0.0.1:6379&gt; keys mylist*1) "mylist"2) "mylist5"3) "mylist6"4) "mylist7"5) "mylist8" del ä½œç”¨ï¼šåˆ é™¤æŒ‡å®šçš„key è¯­æ³•ï¼šDEL key 12127.0.0.1:6379&gt; del test(integer) 1 exists ä½œç”¨ï¼šç¡®è®¤ä¸€ä¸ªkey æ˜¯å¦å­˜åœ¨ è¯­æ³•ï¼šexists key ç¤ºä¾‹ï¼šä»ç»“æœæ¥çœ‹ï¼Œæ•°æ®åº“ä¸­ä¸å­˜åœ¨HongWan è¿™ä¸ªkeyï¼Œä½†æ˜¯age è¿™ä¸ªkey æ˜¯å­˜åœ¨çš„ 1234127.0.0.1:6379&gt; exists HongWan(integer) 0127.0.0.1:6379&gt; exists age(integer) 1 expire ä½œç”¨ï¼šè®¾ç½®ç”Ÿå­˜æ—¶é—´ï¼Œåˆ°æœŸåæ•°æ®é”€æ¯ã€‚ EXPIRE key seconds è®¾ç½®keyçš„ç”Ÿå­˜æ—¶é—´ï¼ˆå•ä½ï¼šç§’ï¼‰keyåœ¨å¤šå°‘ç§’åä¼šè‡ªåŠ¨åˆ é™¤ TTL key æŸ¥çœ‹keyç”Ÿäºçš„ç”Ÿå­˜æ—¶é—´ PERSIST key æ¸…é™¤ç”Ÿå­˜æ—¶é—´ PEXPIRE key milliseconds ç”Ÿå­˜æ—¶é—´è®¾ç½®å•ä½ä¸ºï¼šæ¯«ç§’ 123456789101112127.0.0.1:6379&gt; set test 1 è®¾ç½®testçš„å€¼ä¸º1OK127.0.0.1:6379&gt; get test è·å–testçš„å€¼"1"127.0.0.1:6379&gt; EXPIRE test 5 è®¾ç½®testçš„ç”Ÿå­˜æ—¶é—´ä¸º5ç§’(integer) 1127.0.0.1:6379&gt; TTL test æŸ¥çœ‹testçš„ç”Ÿäºç”Ÿæˆæ—¶é—´è¿˜æœ‰1ç§’åˆ é™¤(integer) 1127.0.0.1:6379&gt; TTL test(integer) -2127.0.0.1:6379&gt; get test è·å–testçš„å€¼ï¼Œå·²ç»åˆ é™¤(nil) rename ä½œç”¨ï¼šé‡å‘½åkey è¯­æ³•ï¼šrename oldkey newkey 123456127.0.0.1:6379&gt; keys *1) "age"127.0.0.1:6379&gt; rename age age_newOK127.0.0.1:6379&gt; keys *1) "age_new" type ä½œç”¨ï¼šæ˜¾ç¤ºæŒ‡å®škeyçš„æ•°æ®ç±»å‹ è¯­æ³•ï¼štype key 123456127.0.0.1:6379&gt; type addrstring127.0.0.1:6379&gt; type myzset2zset127.0.0.1:6379&gt; type mylistlist document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Redis</category>
      </categories>
      <tags>
        <tag>Redis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[é˜¿é‡Œå·´å·´è¿æ¥æ± DruidDataSourceçš„ä¸€ä¸ªbug]]></title>
    <url>%2Fposts%2Fd2af9ee0.html</url>
    <content type="text"><![CDATA[é—®é¢˜ ä½¿ç”¨é˜¿é‡Œå·´å·´çš„æ•°æ®åº“è¿æ¥æ± Druidï¼Œå½“åº”ç”¨ç¨‹åºè¿æ¥æ•°æ®åº“ï¼Œè€æ˜¯æŠ¥é”™ï¼šcaused by wait mills 5000,active 0,maxactive 20 è¿æ¥æ•°æ®åº“è¶…æ—¶ï¼Œä½†æ˜¯ä½¿ç”¨å•ç‹¬çš„jdbcè¿æ¥å´æ˜¯å¯ä»¥è¿æ¥çš„ã€‚ è§£å†³ ç»è¿‡åå¤æµ‹è¯•ï¼Œå‘ç°é—®é¢˜æ‰€åœ¨ï¼ŒåŸæ¥æ˜¯è¿æ¥æ± å‚æ•°&lt;property name="validationQuery" value="select 1"&gt;é…ç½®é”™è¯¯ã€‚è™½ç„¶æ˜¯é…ç½®é”™è¯¯ï¼Œä½†æ˜¯è¿æ¥æ± ç‰ˆæœ¬æ˜¯1.0.10ï¼Œå¤ªæ—§ï¼Œ å¯¼è‡´æ²¡æœ‰æŠŠçœŸæ­£çš„æŠ¥é”™æç¤ºå‡ºæ¥ora-00923 æœªæ‰¾åˆ°è¦æ±‚çš„å…³é”®å­—fromï¼Œè€Œæ˜¯æŠ¥è¿™ä¸ªé”™ï¼šcaused by wait mills 5000,active 0,maxactive 20ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæœ¬æ¥æ˜¯å› ä¸ºé…ç½®é”™è¯¯å¯¼è‡´çš„ï¼Œ ä½†æ˜¯å› ä¸ºé˜¿é‡Œå·´å·´è¿æ¥æ± DruidDataSourceçš„bugï¼ŒæŠŠè¿™ä¸ªé”™è¯¯éšè—èµ·æ¥äº†ï¼Œä¸€ç›´æ²¡æœ‰æŠŠçœŸæ­£çš„é”™è¯¯æŠ¥å‡ºæ¥ã€‚ æ€»ç»“ å°†Druidç‰ˆæœ¬å‡çº§åˆ°æœ€æ–°çš„ç¨³å®šç‰ˆæœ¬ï¼ŒDruidDataSourceé…ç½®æˆå¦‚ä¸‹ï¼š 123456789&lt;property name="minIdle" value="1" /&gt;&lt;property name="validationQuery" value="SELECT 1 FROM DUAL" /&gt;&lt;property name="testOnBorrow" value="true" /&gt;&lt;property name="poolPreparedStatements" value="true" /&gt;&lt;property name="initialSize" value=1 /&gt; å‚æ•°è¯´æ˜ validationQuery SQLæŸ¥è¯¢,ç”¨æ¥éªŒè¯ä»è¿æ¥æ± å–å‡ºçš„è¿æ¥,åœ¨å°†è¿æ¥è¿”å›ç»™è°ƒç”¨è€…ä¹‹å‰.å¦‚æœæŒ‡å®š, åˆ™æŸ¥è¯¢å¿…é¡»æ˜¯ä¸€ä¸ªSQL SELECTå¹¶ä¸”å¿…é¡»è¿”å›è‡³å°‘ä¸€è¡Œè®°å½•ã€‚ testOnBorrow true--æŒ‡æ˜æ˜¯å¦åœ¨ä»æ± ä¸­å–å‡ºè¿æ¥å‰è¿›è¡Œæ£€éªŒ,å¦‚æœæ£€éªŒå¤±è´¥, åˆ™ä»æ± ä¸­å»é™¤è¿æ¥å¹¶å°è¯•å–å‡ºå¦ä¸€ä¸ªã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåå¦‚æœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸² ã€‚ testOnReturn false--æŒ‡æ˜æ˜¯å¦åœ¨å½’è¿˜åˆ°æ± ä¸­å‰è¿›è¡Œæ£€éªŒã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåå¦‚æœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸² ã€‚ testWhileIdle false--æŒ‡æ˜è¿æ¥æ˜¯å¦è¢«ç©ºé—²è¿æ¥å›æ”¶å™¨(å¦‚æœæœ‰)è¿›è¡Œæ£€éªŒ.å¦‚æœæ£€æµ‹å¤±è´¥, åˆ™è¿æ¥å°†è¢«ä»æ± ä¸­å»é™¤ã€‚ æ³¨æ„: è®¾ç½®ä¸ºtrueåå¦‚æœè¦ç”Ÿæ•ˆ,validationQueryå‚æ•°å¿…é¡»è®¾ç½®ä¸ºéç©ºå­—ç¬¦ä¸² timeBetweenEvictionRunsMillis -1--åœ¨ç©ºé—²è¿æ¥å›æ”¶å™¨çº¿ç¨‹è¿è¡ŒæœŸé—´ä¼‘çœ çš„æ—¶é—´å€¼,ä»¥æ¯«ç§’ä¸ºå•ä½. å¦‚æœè®¾ç½®ä¸ºéæ­£æ•°,åˆ™ä¸è¿è¡Œç©ºé—²è¿æ¥å›æ”¶å™¨çº¿ç¨‹ã€‚ numTestsPerEvictionRun 3--åœ¨æ¯æ¬¡ç©ºé—²è¿æ¥å›æ”¶å™¨çº¿ç¨‹(å¦‚æœæœ‰)è¿è¡Œæ—¶æ£€æŸ¥çš„è¿æ¥æ•°é‡ ã€‚ minEvictableIdleTimeMillis 1000 * 60 * 30--è¿æ¥åœ¨æ± ä¸­ä¿æŒç©ºé—²è€Œä¸è¢«ç©ºé—²è¿æ¥å›æ”¶å™¨çº¿ç¨‹(å¦‚æœæœ‰)å›æ”¶çš„æœ€å°æ—¶é—´å€¼ï¼Œå•ä½æ¯«ç§’ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>druid</category>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>druid</tag>
        <tag>mysql</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Mybatiså¼‚å¸¸There is no getter for property named 'XXX' in class]]></title>
    <url>%2Fposts%2F53121faf.html</url>
    <content type="text"><![CDATA[åœ¨é›†æˆMybatisçš„é¡¹ç›®ä¸­å®šä¹‰æ¥å£å¹¶å®ç°æ˜ å°„SQLæ—¶ï¼Œé‡åˆ°è¿‡ä¸€ä¸ªå¾ˆå¥‡æ€ªçš„é—®é¢˜ï¼Œå¦‚ä¸‹ï¼š å®šä¹‰æ¥å£ï¼š 1UserCouponBo getUserCouponInfoById(Long userCouponId); ç„¶åå¯¹åº”çš„sqlçš„xmlå¦‚ä¸‹ï¼š 12345678&lt;select id="selectUserCouponInfoById" parameterType="java.lang.Long" resultMap="baseResultMap"&gt; select amount,receive_time from user_coupon &lt;where&gt; &lt;if test="userCouponId != null"&gt; id = #{userCouponId,jdbcType=BIGINT} &lt;/if&gt; &lt;/where&gt;&lt;/select&gt; ä¸Šé¢çš„æ¥å£å°±æ˜¯é€šè¿‡idæŸ¥è¯¢æŒ‡å®šçš„ä¼˜æƒ åˆ¸ä¿¡æ¯ï¼Œä¸ªäººæ„Ÿè§‰è¯¥sqlå†™çš„ä¸å¤Ÿä¼˜é›…ã€‚å°±æ˜¯è¿™ä¸ªæ¥å£ï¼ŒæŠ¥é”™ï¼šThere is no gettery for property...!!! è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ åŸå› æ˜¯åœ¨ifé‡Œé¢ç”¨äº†Mybatisçš„å†…ç½®å¯¹è±¡ï¼Œ&lt;if test="id != null"&gt;ï¼ŒMybatisé»˜è®¤é‡‡ç”¨OGNLè§£æå‚æ•°ï¼Œæ‰€ä»¥ä¼šè‡ªåŠ¨é‡‡ç”¨å¯¹è±¡æ ‘çš„å½¢å¼å–long.xxxå€¼ï¼Œå¦‚æœæ²¡åœ¨æ–¹æ³•ä¸­å®šä¹‰ï¼Œåˆ™ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ è§£å†³æ–¹æ¡ˆä¸€ï¼šæŠŠ#{xxx}ä¿®æ”¹ä¸º#{_parameter}å³å¯ 12345678&lt;select id="selectUserCouponInfoById" parameterType="java.lang.Long" resultMap="baseResultMap"&gt; select amount,receive_time from user_coupon &lt;where&gt; &lt;if test="_parameter != null"&gt; id = #{_parameter} &lt;/if&gt; &lt;/where&gt;&lt;/select&gt; è§£å†³è§£å†³æ–¹æ¡ˆäºŒï¼šåœ¨æ–¹æ³•ä¸­æå‰å®šä¹‰ã€‚ 1UserCouponBo getUserCouponInfoById(@Param("userCouponId") Long userCouponId); ç»™userCouponIdåŠ @Paramæ³¨è§£ï¼Œå®šä¹‰ä¸€ä¸‹å°±å¯ä»¥äº†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Mybatis</category>
      </categories>
      <tags>
        <tag>Mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ReentrantReadWriteLock]]></title>
    <url>%2Fposts%2Fb29432a8.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ReadWriteLockï¼Œé¡¾åæ€ä¹‰ï¼Œæ˜¯è¯»å†™é”ã€‚å®ƒç»´æŠ¤äº†ä¸€å¯¹ç›¸å…³çš„é” â€” â€” â€œè¯»å–é”â€å’Œâ€œå†™å…¥é”â€ï¼Œä¸€ä¸ªç”¨äºè¯»å–æ“ä½œï¼Œå¦ä¸€ä¸ªç”¨äºå†™å…¥æ“ä½œã€‚ â€œè¯»å–é”â€ç”¨äºåªè¯»æ“ä½œï¼Œå®ƒæ˜¯â€œå…±äº«é”â€ï¼Œèƒ½åŒæ—¶è¢«å¤šä¸ªçº¿ç¨‹è·å–ã€‚ â€œå†™å…¥é”â€ç”¨äºå†™å…¥æ“ä½œï¼Œå®ƒæ˜¯â€œç‹¬å é”â€ï¼Œå†™å…¥é”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”è·å–ã€‚ &lt;font color="red"&gt;æ³¨æ„ï¼šä¸èƒ½åŒæ—¶å­˜åœ¨è¯»å–é”å’Œå†™å…¥é”ï¼&lt;/font&gt; ReadWriteLockæ˜¯ä¸€ä¸ªæ¥å£ã€‚ReentrantReadWriteLockæ˜¯å®ƒçš„å®ç°ç±»ï¼ŒReentrantReadWriteLockåŒ…æ‹¬å­ç±»ReadLockå’ŒWriteLockã€‚ è¯»å†™é”åº•å±‚ä¹Ÿæ˜¯é€šè¿‡AQSæ¡†æ¶å®ç°çš„ï¼Œé€šè¿‡ä¹‹å‰çš„æ–‡ç« å¯çŸ¥ï¼Œå¦‚æœä½¿ç”¨AQSæ¡†æ¶ï¼Œåœ¨è¿™ä¸ªç±»å†…éƒ¨å¿…å®šæœ‰ä¸€ä¸ªAQSæ¡†æ¶çš„å­ç±»ï¼ŒAQSå­ç±»æ— éå°±æ˜¯å®ç°å¦‚ä¸‹å‡ ç‚¹ï¼š ç¬¬ä¸€ç‚¹ï¼šå¯¹å…±äº«èµ„æºstateè¿›è¡Œæ“ä½œ ç¬¬äºŒç‚¹ï¼šå¦‚æœæ˜¯ç‹¬å æ¨¡å¼ä¸‹å¯¹èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œé‚£ä¹ˆå¿…é¡»å®ç°tryAcquire()æ–¹æ³•å’ŒtryRelease()æ–¹æ³•ã€‚ ç¬¬ä¸‰ç‚¹ï¼šå¦‚æœæ˜¯å…±äº«æ¨¡å¼ä¸‹å¯¹èµ„æºçš„è·å–å’Œé‡Šæ”¾ï¼Œé‚£ä¹ˆå¿…é¡»å®ç°tryAcquireShared()æ–¹æ³•å’ŒtryReleaseShared()æ–¹æ³•ã€‚ è€Œè¯»å†™é”ReentrantReadWriteLockå³åŒ…å«ç‹¬å æ¨¡å¼ä¸‹èµ„æºçš„è·å–å’Œé‡Šæ”¾(å†™é”)ï¼Œä¹ŸåŒ…å«å…±äº«æ¨¡å¼ä¸‹èµ„æºçš„è·å–å’Œé‡Šæ”¾(è¯»é”)ï¼Œæ‰€ä»¥éœ€è¦ä¸Šé¢çš„å››ä¸ªæ–¹æ³•éƒ½éœ€è¦å®ç°ã€‚ ç”¨stateä¸€ä¸ªæ•´å½¢å˜é‡æ€æ ·å»ç»´æŠ¤è¯»å’Œå†™ä¸¤ç§çŠ¶æ€ å…±äº«èµ„æºstateæ˜¯ä¸€ä¸ªæ•´å½¢å˜é‡ï¼Œåœ¨è¯»å†™é”ä¸­åˆå¿…é¡»ç»´æŠ¤è¯»å’Œå†™ä¸¤ç§çŠ¶æ€ï¼Œæ‰€ä»¥åªèƒ½æŒ‰ä½æŠŠstateåˆ†å‰²æˆä¸¤ä¸ªéƒ¨åˆ†ï¼Œä¸€ä¸ªæ•´å½¢æœ‰32ä½ï¼Œé«˜16ä½ä»£è¡¨è¯»ï¼Œä½16ä½ä»£è¡¨å†™ã€‚å¦‚å›¾æ‰€ç¤ºï¼š ![img][link1] 123456789101112//è¯»çŠ¶æ€å ç”¨ä½æ•°static final int SHARED_SHIFT = 16;//æ¯ä¸€æ¬¡å¢åŠ çš„è¯»çŠ¶æ€ï¼š(1&lt;&lt;16),å› ä¸ºè¯»çŠ¶æ€æ˜¯stateçš„é«˜16ä½static final int SHARED_UNIT = (1 &lt;&lt; SHARED_SHIFT);//è¯»çŠ¶æ€æˆ–å†™çŠ¶æ€æœ€å¤§çš„æ•°é‡static final int MAX_COUNT = (1 &lt;&lt; SHARED_SHIFT) - 1;//ç”¨æ¥è®¡ç®—å†™çš„åŒæ­¥çŠ¶æ€static final int EXCLUSIVE_MASK = (1 &lt;&lt; SHARED_SHIFT) - 1;//è®¡ç®—è¯»é”çš„æ•°é‡static int sharedCount(int c) { return c &gt;&gt;&gt; SHARED_SHIFT; }//è®¡ç®—å†™é”çš„æ•°é‡static int exclusiveCount(int c) { return c &amp; EXCLUSIVE_MASK; } è¯»æ“ä½œï¼Œå› ä¸ºé«˜16ä½ä¸ºè¯»æ“ä½œï¼Œè¦æƒ³è·å–è¯»çš„æ•°é‡ï¼Œåªéœ€å°†stateæ— ç¬¦å·å³ç§»16ä½å³å¯ï¼šstate&gt;&gt;&gt;16ã€‚è¯»æœ€å¤§çš„æ•°é‡ï¼š65535(äºŒè¿›åˆ¶è¡¨ç¤ºï¼š11111111110000000000000000) å†™æ“ä½œï¼Œå› ä¸ºä½16ä½ä¸ºå†™æ“ä½œï¼Œè¦å‘è·å–å†™æ•°é‡ï¼Œåªéœ€è¦æŠŠstateçš„é«˜16ä½æŠ¹å»å°±å¯ä»¥äº†ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°â€œæŒ‰ä½ä¸â€æ“ä½œï¼šstate&amp;1111111111111111ã€‚å†™æœ€å¤§çš„æ•°é‡ï¼š65535(äºŒè¿›åˆ¶è¡¨ç¤ºï¼š00000000000000001111111111111111) å…±äº«é” 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public static class ReadLock implements Lock, java.io.Serializable { private static final long serialVersionUID = -5992448646407690164L; // ReentrantReadWriteLockçš„AQSå¯¹è±¡ private final Sync sync; protected ReadLock(ReentrantReadWriteLock lock) { sync = lock.sync; } // è·å–â€œå…±äº«é”â€ public void lock() { sync.acquireShared(1); } // å¦‚æœçº¿ç¨‹æ˜¯ä¸­æ–­çŠ¶æ€ï¼Œåˆ™æŠ›å‡ºä¸€åœºï¼Œå¦åˆ™å°è¯•è·å–å…±äº«é”ã€‚ public void lockInterruptibly() throws InterruptedException { sync.acquireSharedInterruptibly(1); } // å°è¯•è·å–â€œå…±äº«é”â€ public boolean tryLock() { return sync.tryReadLock(); } // åœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œå°è¯•è·å–â€œå…±äº«é”â€ public boolean tryLock(long timeout, TimeUnit unit) throws InterruptedException { return sync.tryAcquireSharedNanos(1, unit.toNanos(timeout)); } // é‡Šæ”¾â€œå…±äº«é”â€ public void unlock() { sync.releaseShared(1); } // æ–°å»ºæ¡ä»¶ public Condition newCondition() { throw new UnsupportedOperationException(); } public String toString() { int r = sync.getReadLockCount(); return super.toString() + "[Read locks = " + r + "]"; }} ReadLockä¸­çš„syncæ˜¯ä¸€ä¸ªSyncå¯¹è±¡ï¼ŒSyncç»§æ‰¿äºAQSç±»ï¼Œå³Syncå°±æ˜¯ä¸€ä¸ªé”ã€‚ReentrantReadWriteLockä¸­ä¹Ÿæœ‰ä¸€ä¸ªSyncå¯¹è±¡ï¼Œè€Œä¸”ReadLockä¸­çš„syncå’ŒReentrantReadWriteLockä¸­çš„syncæ˜¯å¯¹åº”å…³ç³»ã€‚å³ReentrantReadWriteLockå’ŒReadLockå…±äº«åŒä¸€ä¸ªAQSå¯¹è±¡ï¼Œå…±äº«åŒä¸€æŠŠé”ã€‚ è·å–å…±äº«é” è·å–å…±äº«é”çš„æ€æƒ³(å³lockå‡½æ•°çš„æ­¥éª¤)ï¼Œæ˜¯å…ˆé€šè¿‡tryAcquireShared()å°è¯•è·å–å…±äº«é”ã€‚å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å°è¯•å¤±è´¥çš„è¯ï¼Œåˆ™é€šè¿‡doAcquireShared()ä¸æ–­çš„å¾ªç¯å¹¶å°è¯•è·å–é”ï¼Œè‹¥æœ‰éœ€è¦ï¼Œåˆ™é˜»å¡ç­‰å¾…ã€‚doAcquireShared()åœ¨å¾ªç¯ä¸­æ¯æ¬¡å°è¯•è·å–é”æ—¶ï¼Œéƒ½æ˜¯é€šè¿‡tryAcquireShared()æ¥è¿›è¡Œå°è¯•çš„ã€‚ä¸‹é¢çœ‹çœ‹â€œè·å–å…±äº«é”â€çš„è¯¦ç»†æµç¨‹ã€‚ lock() 123public void lock() { sync.acquireShared(1);} acquireShared() Syncç»§æ‰¿äºAQSï¼ŒacquireShared()å®šä¹‰åœ¨AQSä¸­ã€‚æºç å¦‚ä¸‹ï¼š 1234public final void acquireShared(int arg) { if (tryAcquireShared(arg) &lt; 0) doAcquireShared(arg);} acquireShared()é¦–å…ˆä¼šé€šè¿‡tryAcquireShared()æ¥å°è¯•è·å–é”ã€‚ å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™ä¸å†åšä»»ä½•åŠ¨ä½œ(å› ä¸ºå·²ç»æˆåŠŸè·å–åˆ°é”äº†)ã€‚ å°è¯•å¤±è´¥çš„è¯ï¼Œåˆ™é€šè¿‡doAcquireShared()æ¥è·å–é”ã€‚doAcquireShared()ä¼šè·å–åˆ°é”äº†æ‰è¿”å›ã€‚ tryAcquireShared() 123456789101112131415161718192021222324252627282930313233343536protected final int tryAcquireShared(int unused) { Thread current = Thread.currentThread(); // è·å–â€œé”â€çš„çŠ¶æ€ int c = getState(); // å¦‚æœâ€œé”â€æ˜¯â€œäº’æ–¥é”â€ï¼Œå¹¶ä¸”è·å–é”çš„çº¿ç¨‹ä¸æ˜¯currentçº¿ç¨‹ï¼›åˆ™è¿”å›-1ã€‚ if (exclusiveCount(c) != 0 &amp;&amp; getExclusiveOwnerThread() != current) return -1; // è·å–â€œè¯»å–é”â€çš„å…±äº«è®¡æ•° int r = sharedCount(c); // å¦‚æœâ€œä¸éœ€è¦é˜»å¡ç­‰å¾…â€ï¼Œå¹¶ä¸”â€œè¯»å–é”â€çš„å…±äº«è®¡æ•°å°äºMAX_COUNTï¼› // åˆ™é€šè¿‡CASå‡½æ•°æ›´æ–°â€œé”çš„çŠ¶æ€â€ï¼Œå°†â€œè¯»å–é”â€çš„å…±äº«è®¡æ•°+1ã€‚ if (!readerShouldBlock() &amp;&amp; r &lt; MAX_COUNT &amp;&amp; compareAndSetState(c, c + SHARED_UNIT)) { // ç¬¬1æ¬¡è·å–â€œè¯»å–é”â€ã€‚ if (r == 0) { firstReader = current; firstReaderHoldCount = 1; // å¦‚æœæƒ³è¦è·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªè·å–é”(firstReader)çš„çº¿ç¨‹ } else if (firstReader == current) { firstReaderHoldCount++; } else { // HoldCounteræ˜¯ç”¨æ¥ç»Ÿè®¡è¯¥çº¿ç¨‹è·å–â€œè¯»å–é”â€çš„æ¬¡æ•°ã€‚ HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) cachedHoldCounter = rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); // å°†è¯¥çº¿ç¨‹è·å–â€œè¯»å–é”â€çš„æ¬¡æ•°+1ã€‚ rh.count++; } return 1; } return fullTryAcquireShared(current);} tryAcquireShared()çš„ä½œç”¨æ˜¯å°è¯•è·å–â€œå…±äº«é”â€ã€‚ å¦‚æœåœ¨å°è¯•è·å–é”æ—¶ï¼Œâ€œä¸éœ€è¦é˜»å¡ç­‰å¾…â€å¹¶ä¸”â€œè¯»å–é”çš„å…±äº«è®¡æ•°å°äºMAX_COUNTâ€ï¼Œåˆ™ç›´æ¥é€šè¿‡CASå‡½æ•°æ›´æ–°â€œè¯»å–é”çš„å…±äº«è®¡æ•°â€ï¼Œä»¥åŠå°†â€œå½“å‰çº¿ç¨‹è·å–è¯»å–é”çš„æ¬¡æ•°+1â€ã€‚ å¦åˆ™ï¼Œé€šè¿‡fullTryAcquireShared()è·å–è¯»å–é”ã€‚ fullTryAcquireShared() 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758final int fullTryAcquireShared(Thread current) { HoldCounter rh = null; for (;;) { // è·å–â€œé”â€çš„çŠ¶æ€ int c = getState(); // å¦‚æœâ€œé”â€æ˜¯â€œäº’æ–¥é”â€ï¼Œå¹¶ä¸”è·å–é”çš„çº¿ç¨‹ä¸æ˜¯currentçº¿ç¨‹ï¼›åˆ™è¿”å›-1ã€‚ if (exclusiveCount(c) != 0) { if (getExclusiveOwnerThread() != current) return -1; // å¦‚æœâ€œéœ€è¦é˜»å¡ç­‰å¾…â€ã€‚ // (01) å½“â€œéœ€è¦é˜»å¡ç­‰å¾…â€çš„çº¿ç¨‹æ˜¯ç¬¬1ä¸ªè·å–é”çš„çº¿ç¨‹çš„è¯ï¼Œåˆ™ç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚ // (02) å½“â€œéœ€è¦é˜»å¡ç­‰å¾…â€çš„çº¿ç¨‹è·å–é”çš„æ¬¡æ•°=0æ—¶ï¼Œåˆ™è¿”å›-1ã€‚ } else if (readerShouldBlock()) { // å¦‚æœæƒ³è¦è·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªè·å–é”(firstReader)çš„çº¿ç¨‹ if (firstReader == current) { } else { if (rh == null) { rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) { rh = readHolds.get(); if (rh.count == 0) readHolds.remove(); } } // å¦‚æœå½“å‰çº¿ç¨‹è·å–é”çš„è®¡æ•°=0,åˆ™è¿”å›-1ã€‚ if (rh.count == 0) return -1; } } // å¦‚æœâ€œä¸éœ€è¦é˜»å¡ç­‰å¾…â€ï¼Œåˆ™è·å–â€œè¯»å–é”â€çš„å…±äº«ç»Ÿè®¡æ•°ï¼› // å¦‚æœå…±äº«ç»Ÿè®¡æ•°è¶…è¿‡MAX_COUNTï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ if (sharedCount(c) == MAX_COUNT) throw new Error("Maximum lock count exceeded"); // å°†çº¿ç¨‹è·å–â€œè¯»å–é”â€çš„æ¬¡æ•°+1ã€‚ if (compareAndSetState(c, c + SHARED_UNIT)) { // å¦‚æœæ˜¯ç¬¬1æ¬¡è·å–â€œè¯»å–é”â€ï¼Œåˆ™æ›´æ–°firstReaderå’ŒfirstReaderHoldCountã€‚ if (sharedCount(c) == 0) { firstReader = current; firstReaderHoldCount = 1; // å¦‚æœæƒ³è¦è·å–é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªè·å–é”(firstReader)çš„çº¿ç¨‹ï¼Œ // åˆ™å°†firstReaderHoldCount+1ã€‚ } else if (firstReader == current) { firstReaderHoldCount++; } else { if (rh == null) rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) rh = readHolds.get(); else if (rh.count == 0) readHolds.set(rh); // æ›´æ–°çº¿ç¨‹çš„è·å–â€œè¯»å–é”â€çš„å…±äº«è®¡æ•° rh.count++; cachedHoldCounter = rh; // cache for release } return 1; } }} fullTryAcquireShared()ä¼šæ ¹æ®â€œæ˜¯å¦éœ€è¦é˜»å¡ç­‰å¾…â€ï¼Œâ€œè¯»å–é”çš„å…±äº«è®¡æ•°æ˜¯å¦è¶…è¿‡é™åˆ¶â€ç­‰ç­‰è¿›è¡Œå¤„ç†ã€‚å¦‚æœä¸éœ€è¦é˜»å¡ç­‰å¾…ï¼Œå¹¶ä¸”é”çš„å…±äº«è®¡æ•°æ²¡æœ‰è¶…è¿‡é™åˆ¶ï¼Œåˆ™é€šè¿‡CASå°è¯•è·å–é”ï¼Œå¹¶è¿”å›1ã€‚ doAcquireShared() 1234567891011121314151617181920212223242526272829303132private void doAcquireShared(int arg) { // addWaiter(Node.SHARED)çš„ä½œç”¨æ˜¯ï¼Œåˆ›å»ºâ€œå½“å‰çº¿ç¨‹â€å¯¹åº”çš„ç»“ç‚¹ï¼Œå¹¶å°†è¯¥çº¿ç¨‹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ final Node node = addWaiter(Node.SHARED); boolean failed = true; try { boolean interrupted = false; for (;;) { // è·å–â€œnodeâ€çš„å‰ä¸€ç»“ç‚¹ final Node p = node.predecessor(); // å¦‚æœâ€œå½“å‰çº¿ç¨‹â€æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™å°è¯•è·å–å…±äº«é”ã€‚ if (p == head) { int r = tryAcquireShared(arg); if (r &gt;= 0) { setHeadAndPropagate(node, r); p.next = null; // help GC if (interrupted) selfInterrupt(); failed = false; return; } } // å¦‚æœâ€œå½“å‰çº¿ç¨‹â€ä¸æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™é€šè¿‡shouldParkAfterFailedAcquire()åˆ¤æ–­æ˜¯å¦éœ€è¦ç­‰å¾…ï¼Œ // éœ€è¦çš„è¯ï¼Œåˆ™é€šè¿‡parkAndCheckInterrupt()è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚è‹¥é˜»å¡ç­‰å¾…è¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹è¢«ä¸­æ–­è¿‡ï¼Œåˆ™è®¾ç½®interruptedä¸ºtrueã€‚ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) interrupted = true; } } finally { if (failed) cancelAcquire(node); }} doAcquireShared()çš„ä½œç”¨æ˜¯è·å–å…±äº«é”ã€‚ å®ƒä¼šé¦–å…ˆåˆ›å»ºçº¿ç¨‹å¯¹åº”çš„åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹ï¼Œç„¶åå°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚åŒæ­¥é˜Ÿåˆ—æ˜¯ç®¡ç†è·å–é”çš„ç­‰å¾…çº¿ç¨‹çš„é˜Ÿåˆ—ã€‚ å¦‚æœâ€œå½“å‰çº¿ç¨‹â€æ˜¯åŒæ­¥é˜Ÿåˆ—çš„è¡¨å¤´ï¼Œåˆ™å°è¯•è·å–å…±äº«é”ï¼›å¦åˆ™ï¼Œåˆ™éœ€è¦é€šè¿‡shouldParkAfterFailedAcquire()åˆ¤æ–­æ˜¯å¦é˜»å¡ç­‰å¾…ï¼Œéœ€è¦çš„è¯ï¼Œåˆ™é€šè¿‡parkAndCheckInterrupt()è¿›è¡Œé˜»å¡ç­‰å¾…ã€‚ doAcquireShared()ä¼šé€šè¿‡forå¾ªç¯ï¼Œä¸æ–­çš„è¿›è¡Œä¸Šé¢çš„æ“ä½œï¼›ç›®çš„å°±æ˜¯è·å–å…±äº«é”ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šdoAcquireShared()åœ¨æ¯ä¸€æ¬¡å°è¯•è·å–é”æ—¶ï¼Œæ˜¯é€šè¿‡tryAcquireShared()æ¥æ‰§è¡Œçš„ï¼ é‡Šæ”¾å…±äº«é” é‡Šæ”¾å…±äº«é”çš„æ€æƒ³ï¼Œæ˜¯å…ˆé€šè¿‡tryReleaseShared()å°è¯•é‡Šæ”¾å…±äº«é”ã€‚å°è¯•æˆåŠŸçš„è¯ï¼Œåˆ™é€šè¿‡doReleaseShared()å”¤é†’â€œå…¶ä»–ç­‰å¾…è·å–å…±äº«é”çš„çº¿ç¨‹â€ï¼Œå¹¶è¿”å›trueï¼›å¦åˆ™çš„è¯ï¼Œè¿”å›flaseã€‚ unlock() 123public void unlock() { sync.releaseShared(1);} è¯¥å‡½æ•°å®é™…ä¸Šè°ƒç”¨releaseShared(1)é‡Šæ”¾å…±äº«é”ã€‚ releaseShared() 1234567public final boolean releaseShared(int arg) { if (tryReleaseShared(arg)) { doReleaseShared(); return true; } return false;} releaseShared()çš„ç›®çš„æ˜¯è®©å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„å…±äº«é”ã€‚ å®ƒé¦–å…ˆä¼šé€šè¿‡tryReleaseShared()å»å°è¯•é‡Šæ”¾å…±äº«é”ã€‚å°è¯•æˆåŠŸï¼Œåˆ™ç›´æ¥è¿”å›ï¼›å°è¯•å¤±è´¥ï¼Œåˆ™é€šè¿‡doReleaseShared()å»é‡Šæ”¾å…±äº«é”ã€‚ tryReleaseShared() 123456789101112131415161718192021222324252627282930313233343536protected final boolean tryReleaseShared(int unused) { // è·å–å½“å‰çº¿ç¨‹ï¼Œå³é‡Šæ”¾å…±äº«é”çš„çº¿ç¨‹ã€‚ Thread current = Thread.currentThread(); // å¦‚æœæƒ³è¦é‡Šæ”¾é”çš„çº¿ç¨‹(current)æ˜¯ç¬¬1ä¸ªè·å–é”(firstReader)çš„çº¿ç¨‹ï¼Œ // å¹¶ä¸”â€œç¬¬1ä¸ªè·å–é”çš„çº¿ç¨‹è·å–é”çš„æ¬¡æ•°â€=1ï¼Œåˆ™è®¾ç½®firstReaderä¸ºnullï¼› // å¦åˆ™ï¼Œå°†â€œç¬¬1ä¸ªè·å–é”çš„çº¿ç¨‹çš„è·å–æ¬¡æ•°â€-1ã€‚ if (firstReader == current) { // assert firstReaderHoldCount &gt; 0; if (firstReaderHoldCount == 1) firstReader = null; else firstReaderHoldCount--; // è·å–rhå¯¹è±¡ï¼Œå¹¶æ›´æ–°â€œå½“å‰çº¿ç¨‹è·å–é”çš„ä¿¡æ¯â€ã€‚ } else { HoldCounter rh = cachedHoldCounter; if (rh == null || rh.tid != current.getId()) rh = readHolds.get(); int count = rh.count; if (count &lt;= 1) { readHolds.remove(); if (count &lt;= 0) throw unmatchedUnlockException(); } --rh.count; } for (;;) { // è·å–é”çš„çŠ¶æ€ int c = getState(); // å°†é”çš„è·å–æ¬¡æ•°-1ã€‚ int nextc = c - SHARED_UNIT; // é€šè¿‡CASæ›´æ–°é”çš„çŠ¶æ€ã€‚ if (compareAndSetState(c, nextc)) return nextc == 0; }} tryReleaseShared()çš„ä½œç”¨æ˜¯å°è¯•é‡Šæ”¾å…±äº«é”ã€‚ doReleaseShared() 1234567891011121314151617181920212223242526private void doReleaseShared() { for (;;) { // è·å–CLHé˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ Node h = head; // å¦‚æœå¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹ä¸ç­‰äºtailèŠ‚ç‚¹ã€‚ if (h != null &amp;&amp; h != tail) { // è·å–å¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çš„çŠ¶æ€ int ws = h.waitStatus; // å¦‚æœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯SIGNALçŠ¶æ€ï¼Œåˆ™æ„å‘³ç€â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€éœ€è¦è¢«unparkå”¤é†’ã€‚ if (ws == Node.SIGNAL) { // è®¾ç½®â€œå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çŠ¶æ€â€ä¸ºç©ºçŠ¶æ€ã€‚å¤±è´¥çš„è¯ï¼Œåˆ™ç»§ç»­å¾ªç¯ã€‚ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // å”¤é†’â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€ã€‚ unparkSuccessor(h); } // å¦‚æœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯ç©ºçŠ¶æ€ï¼Œåˆ™è®¾ç½®â€œæ–‡ä»¶ç‚¹å¯¹åº”çš„çº¿ç¨‹æ‰€æ‹¥æœ‰çš„å…±äº«é”â€ä¸ºå…¶å®ƒçº¿ç¨‹è·å–é”çš„ç©ºçŠ¶æ€ã€‚ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS } // å¦‚æœå¤´èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç»§ç»­å¾ªç¯ã€‚å¦åˆ™ï¼Œé€€å‡ºå¾ªç¯ã€‚ if (h == head) // loop if head changed break; }} doReleaseShared()ä¼šé‡Šæ”¾â€œå…±äº«é”â€ã€‚å®ƒä¼šä»å‰å¾€åçš„éå†åŒæ­¥é˜Ÿåˆ—ï¼Œä¾æ¬¡â€œå”¤é†’â€ç„¶åâ€œæ‰§è¡Œâ€é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ï¼›æœ€ç»ˆçš„ç›®çš„æ˜¯è®©è¿™äº›çº¿ç¨‹é‡Šæ”¾å®ƒä»¬æ‰€æŒæœ‰çš„é”ã€‚ å…¬å¹³/éå…¬å¹³å…±äº«é” å’Œäº’æ–¥é”ReentrantLockä¸€æ ·ï¼ŒReadLockä¹Ÿåˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ã€‚ å…¬å¹³é”å’Œéå…¬å¹³é”çš„åŒºåˆ«ï¼Œä½“ç°åœ¨åˆ¤æ–­æ˜¯å¦éœ€è¦é˜»å¡çš„å‡½æ•°readerShouldBlock()æ˜¯ä¸åŒçš„ã€‚ å…¬å¹³é”çš„readerShouldBlock()çš„æºç å¦‚ä¸‹ï¼š 123final boolean readerShouldBlock() { return hasQueuedPredecessors();} åœ¨å…¬å¹³å…±äº«é”ä¸­ï¼Œå¦‚æœåœ¨å½“å‰çº¿ç¨‹çš„å‰é¢æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…è·å–å…±äº«é”ï¼Œåˆ™è¿”å›trueï¼›å¦åˆ™ï¼Œè¿”å›falseã€‚ éå…¬å¹³é”çš„readerShouldBlock()çš„æºç å¦‚ä¸‹ï¼š 123final boolean readerShouldBlock() { return apparentlyFirstQueuedIsExclusive();} åœ¨éå…¬å¹³å…±äº«é”ä¸­ï¼Œå®ƒä¼šæ— è§†å½“å‰çº¿ç¨‹çš„å‰é¢æ˜¯å¦æœ‰å…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…è·å–å…±äº«é”ã€‚åªè¦è¯¥éå…¬å¹³å…±äº«é”å¯¹åº”çš„çº¿ç¨‹ä¸ä¸ºnullï¼Œåˆ™è¿”å›trueã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ·±å…¥ç†è§£Springä¸­çš„æ³¨è§£]]></title>
    <url>%2Fposts%2Ff989cad5.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Springä¸­çš„æ³¨è§£å¤§æ¦‚å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£ï¼Œæˆ–è€…è¯´beanå·¥å‚ç›¸å…³çš„æ³¨è§£ï¼› Springmvcç›¸å…³çš„æ³¨è§£ã€‚ Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£æœ‰ï¼š @Required, @Autowired, @PostConstruct, @PreDestory, è¿˜æœ‰Spring3.0å¼€å§‹æ”¯æŒçš„JSR-330æ ‡å‡†javax.inject.*ä¸­çš„æ³¨è§£ï¼š @Inject, @Named, @Qualifer, @Provider, @Scope, @Singletonã€‚ Springmvcç›¸å…³çš„æ³¨è§£æœ‰ï¼š @Controller, @RequestMapping, @RequestParam, @ResponseBody ç­‰ç­‰ã€‚ è¦ç†è§£Springä¸­çš„æ³¨è§£ï¼Œå…ˆè¦ç†è§£Javaä¸­çš„æ³¨è§£ã€‚ Javaä¸­çš„æ³¨è§£ @Override Jdk1.5å¼€å§‹å¼•å…¥æ³¨è§£ï¼Œæœ€ç†Ÿæ‚‰å¸¸è§çš„åº”è¯¥æ˜¯@Overrideï¼Œå®ƒçš„å®šä¹‰å¦‚ä¸‹ï¼š 12345678910111213141516171819/** * Indicates that a method declaration is intended to override a * method declaration in a supertype. If a method is annotated with * this annotation type compilers are required to generate an error * message unless at least one of the following conditions hold: * The method does override or implement a method declared in a * supertype. * The method has a signature that is override-equivalent to that of * any public method declared in Object. * * @author Peter von der Ah&amp;eacute; * @author Joshua Bloch * @jls 9.6.1.4 @Override * @since 1.5 */@Target(ElementType.METHOD)@Retention(RetentionPolicy.SOURCE)public @interface Override {} ä»æ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼Œ@Overrideçš„ä½œç”¨æ˜¯ï¼Œæç¤ºç¼–è¯‘å™¨ï¼Œä½¿ç”¨äº†@Overrideæ³¨è§£çš„æ–¹æ³•å¿…é¡»overrideçˆ¶ç±»æˆ–è€…java.lang.Objectä¸­çš„ä¸€ä¸ªåŒåæ–¹æ³•ã€‚æˆ‘ä»¬çœ‹åˆ°@Overrideçš„å®šä¹‰ä¸­ä½¿ç”¨åˆ°äº† @Target, @Retentionï¼Œå®ƒä»¬å°±æ˜¯æ‰€è°“çš„â€œå…ƒæ³¨è§£â€â€”â€”å°±æ˜¯å®šä¹‰æ³¨è§£çš„æ³¨è§£ï¼Œæˆ–è€…è¯´æ³¨è§£æ³¨è§£çš„æ³¨è§£ã€‚ @Retention çœ‹ä¸‹@Retentionæ³¨è§£å®šä¹‰ï¼š 12345678910111213141516/** * Indicates how long annotations with the annotated type are to * be retained. If no Retention annotation is present on * an annotation type declaration, the retention policy defaults to * RetentionPolicy.CLASS. */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Retention { /** * Returns the retention policy. * @return the retention policy */ RetentionPolicy value();} @Retentionç”¨äºæç¤ºæ³¨è§£è¢«ä¿ç•™å¤šé•¿æ—¶é—´ï¼Œæœ‰ä¸‰ç§å–å€¼ï¼š 12345678910111213141516171819public enum RetentionPolicy { /** * Annotations are to be discarded by the compiler. */ SOURCE, /** * Annotations are to be recorded in the class file by the compiler * but need not be retained by the VM at run time. This is the default * behavior. */ CLASS, /** * Annotations are to be recorded in the class file by the compiler and * retained by the VM at run time, so they may be read reflectively. * * @see java.lang.reflect.AnnotatedElement */ RUNTIME} RetentionPolicy.SOURCE ä¿ç•™åœ¨æºç çº§åˆ«ï¼Œè¢«ç¼–è¯‘å™¨æŠ›å¼ƒ(@Overrideå°±æ˜¯æ­¤ç±»)ï¼› RetentionPolicy.CLASSè¢«ç¼–è¯‘å™¨ä¿ç•™åœ¨ç¼–è¯‘åçš„ç±»æ–‡ä»¶çº§åˆ«ï¼Œä½†æ˜¯è¢«è™šæ‹Ÿæœºä¸¢å¼ƒï¼› RetentionPolicy.RUNTIMEä¿ç•™è‡³è¿è¡Œæ—¶ï¼Œå¯ä»¥è¢«åå°„è¯»å–ã€‚ @Target 1234567891011121314151617181920212223package java.lang.annotation;/** * Indicates the contexts in which an annotation type is applicable. The * declaration contexts and type contexts in which an annotation type may be * applicable are specified in JLS 9.6.4.1, and denoted in source code by enum * constants of java.lang.annotation.ElementType * @since 1.5 * @jls 9.6.4.1 @Target * @jls 9.7.4 Where Annotations May Appear */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Target { /** * Returns an array of the kinds of elements an annotation type * can be applied to. * @return an array of the kinds of elements an annotation type * can be applied to */ ElementType[] value();} @Targetç”¨äºæç¤ºè¯¥æ³¨è§£ä½¿ç”¨çš„åœ°æ–¹ï¼Œå–å€¼æœ‰ï¼š 12345678910111213141516171819202122232425262728public enum ElementType { /** Class, interface (including annotation type), or enum declaration */ TYPE, /** Field declaration (includes enum constants) */ FIELD, /** Method declaration */ METHOD, /** Formal parameter declaration */ PARAMETER, /** Constructor declaration */ CONSTRUCTOR, /** Local variable declaration */ LOCAL_VARIABLE, /** Annotation type declaration */ ANNOTATION_TYPE, /** Package declaration */ PACKAGE, /** * Type parameter declaration * @since 1.8 */ TYPE_PARAMETER, /** * Use of a type * @since 1.8 */ TYPE_USE} åˆ†åˆ«è¡¨ç¤ºè¯¥æ³¨è§£å¯ä»¥è¢«ä½¿ç”¨çš„åœ°æ–¹ï¼š ç±»,æ¥å£,æ³¨è§£,enum; å±æ€§åŸŸï¼› 3ï¼‰æ–¹æ³•ï¼› 4ï¼‰å‚æ•°ï¼› 5ï¼‰æ„é€ å‡½æ•°ï¼› 6ï¼‰å±€éƒ¨å˜é‡ï¼› 7ï¼‰æ³¨è§£ç±»å‹ï¼› 8ï¼‰åŒ…ã€‚ æ‰€ä»¥ï¼š 1234@Target(ElementType.METHOD)@Retention(RetentionPolicy.SOURCE)public @interface Override {} è¡¨ç¤º @Override åªèƒ½ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œä¿ç•™åœ¨æºç çº§åˆ«ï¼Œè¢«ç¼–è¯‘å™¨å¤„ç†ï¼Œç„¶åæŠ›å¼ƒæ‰ã€‚ @Documented 12345678910111213/** * Indicates that annotations with a type are to be documented by javadoc * and similar tools by default. This type should be used to annotate the * declarations of types whose annotations affect the use of annotated * elements by their clients. If a type declaration is annotated with * Documented, its annotations become part of the public API * of the annotated elements. */@Documented@Retention(RetentionPolicy.RUNTIME)@Target(ElementType.ANNOTATION_TYPE)public @interface Documented {} è¡¨ç¤ºæ³¨è§£æ˜¯å¦èƒ½è¢« javadoc å¤„ç†å¹¶ä¿ç•™åœ¨æ–‡æ¡£ä¸­ã€‚ ä½¿ç”¨ å…ƒæ³¨è§£ æ¥è‡ªå®šä¹‰æ³¨è§£ å’Œ å¤„ç†è‡ªå®šä¹‰æ³¨è§£ æœ‰äº†å…ƒæ³¨è§£ï¼Œå°±å¯ä»¥ä½¿ç”¨å®ƒæ¥è‡ªå®šä¹‰æˆ‘ä»¬éœ€è¦çš„æ³¨è§£ã€‚ç»“åˆè‡ªå®šä¹‰æ³¨è§£å’ŒAOPæˆ–è€…è¿‡æ»¤å™¨ï¼Œååˆ†å¼ºå¤§ã€‚æ¯”å¦‚å¯ä»¥ä½¿ç”¨æ³¨è§£æ¥å®ç°æƒé™çš„ç»†ç²’åº¦çš„æ§åˆ¶â€”â€”åœ¨ç±»æˆ–è€…æ–¹æ³•ä¸Šä½¿ç”¨æƒé™æ³¨è§£ï¼Œç„¶ååœ¨AOPæˆ–è€…è¿‡æ»¤å™¨ä¸­è¿›è¡Œæ‹¦æˆªå¤„ç†ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…³äºç™»å½•çš„æƒé™çš„æ³¨è§£çš„å®ç°ï¼š 12345678/** * ä¸éœ€è¦ç™»å½•æ³¨è§£ */@Target({ ElementType.METHOD, ElementType.TYPE })@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface NoLogin {} è‡ªå®šä¹‰äº†ä¸€ä¸ªæ³¨è§£ @NoLogin, å¯ä»¥è¢«ç”¨äº æ–¹æ³• å’Œ ç±» ä¸Šï¼Œæ³¨è§£ä¸€ç›´ä¿ç•™åˆ°è¿è¡ŒæœŸï¼Œå¯ä»¥è¢«åå°„è¯»å–åˆ°ã€‚è¯¥æ³¨è§£çš„å«ä¹‰æ˜¯ï¼šè¢« @NoLogin æ³¨è§£çš„ç±»æˆ–è€…æ–¹æ³•ï¼Œå³ä½¿ç”¨æˆ·æ²¡æœ‰ç™»å½•ï¼Œä¹Ÿæ˜¯å¯ä»¥è®¿é—®çš„ã€‚ä¸‹é¢å°±æ˜¯å¯¹æ³¨è§£è¿›è¡Œå¤„ç†äº†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * æ£€æŸ¥ç™»å½•æ‹¦æˆªå™¨ * å¦‚ä¸éœ€è¦æ£€æŸ¥ç™»å½•å¯åœ¨æ–¹æ³•æˆ–è€…controllerä¸ŠåŠ ä¸Š@NoLogin */public class CheckLoginInterceptor implements HandlerInterceptor { private static final Logger logger = Logger.getLogger(CheckLoginInterceptor.class); @Override public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception { if (!(handler instanceof HandlerMethod)) { logger.warn("å½“å‰æ“ä½œhandlerä¸ä¸ºHandlerMethod=" + handler.getClass().getName() + ",req=" + request.getQueryString()); return true; } HandlerMethod handlerMethod = (HandlerMethod) handler; String methodName = handlerMethod.getMethod().getName(); // åˆ¤æ–­æ˜¯å¦éœ€è¦æ£€æŸ¥ç™»å½• NoLogin noLogin = handlerMethod.getMethod().getAnnotation(NoLogin.class); if (null != noLogin) { if (logger.isDebugEnabled()) { logger.debug("å½“å‰æ“ä½œmethodName=" + methodName + "ä¸éœ€è¦æ£€æŸ¥ç™»å½•æƒ…å†µ"); } return true; } noLogin = handlerMethod.getMethod().getDeclaringClass().getAnnotation(NoLogin.class); if (null != noLogin) { if (logger.isDebugEnabled()) { logger.debug("å½“å‰æ“ä½œmethodName=" + methodName + "ä¸éœ€è¦æ£€æŸ¥ç™»å½•æƒ…å†µ"); } return true; } if (null == request.getSession().getAttribute(CommonConstants.SESSION_KEY_USER)) { logger.warn("å½“å‰æ“ä½œ" + methodName + "ç”¨æˆ·æœªç™»å½•,ip=" + request.getRemoteAddr()); response.getWriter().write(JsonConvertor.convertFailResult(ErrorCodeEnum.NOT_LOGIN).toString()); // è¿”å›é”™è¯¯ä¿¡æ¯ return false; } return true; } @Override public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) throws Exception { } @Override public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) throws Exception { }} ä¸Šé¢æˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªç™»å½•æ‹¦æˆªå™¨ï¼Œé¦–å…ˆä½¿ç”¨åå°„æ¥åˆ¤æ–­æ–¹æ³•ä¸Šæ˜¯å¦è¢« @NoLogin æ³¨è§£ï¼š NoLogin noLogin = handlerMethod.getMethod().getAnnotation(NoLogin.class); ç„¶ååˆ¤æ–­ç±»æ˜¯å¦è¢« @NoLoginæ³¨è§£ï¼š noLogin = handlerMethod.getMethod().getDeclaringClass().getAnnotation(NoLogin.class); å¦‚æœè¢«æ³¨è§£äº†ï¼Œå°±è¿”å› trueï¼Œå¦‚æœæ²¡æœ‰è¢«æ³¨è§£ï¼Œå°±åˆ¤æ–­æ˜¯å¦å·²ç»ç™»å½•ï¼Œæ²¡æœ‰ç™»å½•åˆ™è¿”å›é”™è¯¯ä¿¡æ¯ç»™å‰å°å’Œfalse. è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä½¿ç”¨ æ³¨è§£ å’Œ è¿‡æ»¤å™¨ æ¥è¿›è¡Œæƒé™å¤„ç†çš„ä¾‹å­ã€‚æ‰©å±•å¼€æ¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨æ³¨è§£ï¼Œæ¥è¡¨ç¤ºæŸæ–¹æ³•æˆ–è€…ç±»ï¼Œåªèƒ½è¢«å…·æœ‰æŸç§è§’è‰²ï¼Œæˆ–è€…å…·æœ‰æŸç§æƒé™çš„ç”¨æˆ·æ‰€è®¿é—®ï¼Œç„¶ååœ¨è¿‡æ»¤å™¨ä¸­è¿›è¡Œåˆ¤æ–­å¤„ç†ã€‚ Springçš„beanå®¹å™¨ç›¸å…³çš„æ³¨è§£ @Autowired æ˜¯æˆ‘ä»¬ä½¿ç”¨å¾—æœ€å¤šçš„æ³¨è§£ï¼Œå…¶å®å°±æ˜¯ autowire=byType å°±æ˜¯æ ¹æ®ç±»å‹çš„è‡ªåŠ¨æ³¨å…¥ä¾èµ–ï¼ˆåŸºäºæ³¨è§£çš„ä¾èµ–æ³¨å…¥ï¼‰ï¼Œå¯ä»¥è¢«ä½¿ç”¨åœ¨å±æ€§åŸŸï¼Œæ–¹æ³•ï¼Œæ„é€ å‡½æ•°ä¸Šã€‚ @Qualifier å°±æ˜¯ autowire=byName, @Autowiredæ³¨è§£åˆ¤æ–­å¤šä¸ªbeanç±»å‹ç›¸åŒæ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ @Qualifier("xxBean") æ¥æŒ‡å®šä¾èµ–çš„beançš„idï¼š 123456@Controller@RequestMapping("/user")public class HelloController { @Autowired @Qualifier("userService") private UserService userService; @Resource å±äºJSR-250æ ‡å‡†ï¼Œç”¨äºå±æ€§åŸŸå’Œæ–¹æ³•ä¸Šã€‚ä¹Ÿæ˜¯ byName ç±»å‹çš„ä¾èµ–æ³¨å…¥ã€‚ä½¿ç”¨æ–¹å¼ï¼š@Resource(name="xxBean"). ä¸å¸¦å‚æ•°çš„ @Resource é»˜è®¤å€¼ç±»åé¦–å­—æ¯å°å†™ã€‚ JSR-330æ ‡å‡†javax.inject.*ä¸­çš„æ³¨è§£(@Inject, @Named, @Qualifier, @Provider, @Scope, @Singleton)ã€‚@Injectå°±ç›¸å½“äº@Autowired, @Named å°±ç›¸å½“äº @Qualifier, å¦å¤– @Named ç”¨åœ¨ç±»ä¸Šè¿˜æœ‰ @Componentçš„åŠŸèƒ½ã€‚ @Component, @Controller, @Service, @Repository, è¿™å‡ ä¸ªæ³¨è§£ä¸åŒäºä¸Šé¢çš„æ³¨è§£ï¼Œä¸Šé¢çš„æ³¨è§£éƒ½æ˜¯å°†è¢«ä¾èµ–çš„beanæ³¨å…¥è¿›æ¥ï¼Œè€Œè¿™å‡ ä¸ªæ³¨è§£çš„ä½œç”¨éƒ½æ˜¯ç”Ÿäº§bean, è¿™äº›æ³¨è§£éƒ½æ˜¯æ³¨è§£åœ¨ç±»ä¸Šï¼Œå°†ç±»æ³¨è§£æˆspringçš„beanå·¥å‚ä¸­ä¸€ä¸ªä¸€ä¸ªçš„beanã€‚@Controller, @Service, @RepositoryåŸºæœ¬å°±æ˜¯è¯­ä¹‰æ›´åŠ ç»†åŒ–çš„@Componentã€‚ @PostConstruct å’Œ @PreDestroy ä¸æ˜¯ç”¨äºä¾èµ–æ³¨å…¥ï¼Œè€Œæ˜¯bean çš„ç”Ÿå‘½å‘¨æœŸã€‚ç±»ä¼¼äº init-method(InitializeingBean)å’Œdestory-method(DisposableBean)ã€‚ Springä¸­æ³¨è§£çš„å¤„ç† springä¸­æ³¨è§£çš„å¤„ç†åŸºæœ¬éƒ½æ˜¯é€šè¿‡å®ç°æ¥å£ BeanPostProcessor æ¥è¿›è¡Œçš„ï¼š 1234public interface BeanPostProcessor { Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException; Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException;} ç›¸å…³çš„å¤„ç†ç±»æœ‰ï¼š AutowiredAnnotationBeanPostProcessorï¼Œ CommonAnnotationBeanPostProcessorï¼Œ PersistenceAnnotationBeanPostProcessorï¼Œ RequiredAnnotationBeanPostProcessorã€‚ è¿™äº›å¤„ç†ç±»ï¼Œå¯ä»¥é€šè¿‡ &lt;context:annotation-config/&gt; é…ç½® éšå¼çš„é…ç½®è¿›springå®¹å™¨ã€‚è¿™äº›éƒ½æ˜¯ä¾èµ–æ³¨å…¥çš„å¤„ç†ï¼Œè¿˜æœ‰ç”Ÿäº§beançš„æ³¨è§£(@Componentï¼Œ @Controller, @Service, @Repository)çš„å¤„ç†ï¼š &lt;context:component-scan base-package="net.aazj.service,net.aazj.aop" /&gt; è¿™äº›éƒ½æ˜¯é€šè¿‡æŒ‡å®šæ‰«æçš„åŸºåŒ…è·¯å¾„æ¥è¿›è¡Œçš„ï¼Œå°†ä»–ä»¬æ‰«æè¿›springçš„beanå®¹å™¨ã€‚æ³¨æ„ &lt;context:component-scan/&gt; ä¹Ÿä¼šé»˜è®¤å°† AutowiredAnnotationBeanPostProcessorï¼ŒCommonAnnotationBeanPostProcessor é…ç½®è¿›æ¥ã€‚æ‰€ä»¥&lt;context:annotation-config/&gt;æ˜¯å¯ä»¥çœç•¥çš„ã€‚å¦å¤–&lt;context:component-scan/&gt;ä¹Ÿå¯ä»¥æ‰«æ@Aspecté£æ ¼çš„AOPæ³¨è§£ï¼Œä½†æ˜¯éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­åŠ å…¥ &lt;aop:aspectj-autoproxy/&gt;è¿›è¡Œé…åˆã€‚ Springæ³¨è§£å’ŒJSR-330æ ‡å‡†æ³¨è§£çš„åŒºåˆ« document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Spring</category>
      </categories>
      <tags>
        <tag>Spring</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-ReentrantLock]]></title>
    <url>%2Fposts%2Ffd3ef277.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° åœ¨Jdk5.0ä¹‹å‰ï¼Œåè°ƒå¯¹å…±äº«å¯¹è±¡çš„è®¿é—®å¯ä»¥ä½¿ç”¨çš„æœºåˆ¶åªæœ‰synchronizedå’Œvolatileã€‚synchronizedå…³é”®å­—å®ç°äº†å†…ç½®é”ï¼Œè€Œvolatileå…³é”®å­—ä¿è¯äº†å¤šçº¿ç¨‹çš„å†…å­˜å¯è§æ€§ã€‚åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œè¿™äº›æœºåˆ¶éƒ½èƒ½å¾ˆå¥½åœ°å®Œæˆå·¥ä½œï¼Œä½†å´æ— æ³•å®ç°ä¸€äº›æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œæ— æ³•ä¸­æ–­ä¸€ä¸ªæ­£åœ¨ç­‰å¾…è·å–é”çš„çº¿ç¨‹ï¼Œæ— æ³•å®ç°é™å®šæ—¶é—´çš„è·å–é”æœºåˆ¶ï¼Œæ— æ³•å®ç°éé˜»å¡ç»“æ„çš„åŠ é”è§„åˆ™ç­‰ã€‚è€Œè¿™äº›æ›´çµæ´»çš„åŠ é”æœºåˆ¶é€šå¸¸éƒ½èƒ½å¤Ÿæä¾›æ›´å¥½çš„æ´»è·ƒæ€§æˆ–æ€§èƒ½ã€‚å› æ­¤ï¼Œåœ¨Jdk5.0ä¸­å¢åŠ äº†ä¸€ç§æ–°çš„æœºåˆ¶ï¼šReentrantLockã€‚ ReentrantLockç±»å®ç°äº†Lockæ¥å£ï¼Œå¹¶æä¾›äº†ä¸synchronizedç›¸åŒçš„äº’æ–¥æ€§å’Œå†…å­˜å¯è§æ€§ï¼Œå®ƒçš„åº•å±‚æ˜¯é€šè¿‡AQSæ¥å®ç°å¤šçº¿ç¨‹åŒæ­¥çš„ã€‚ä¸å†…ç½®é”ç›¸æ¯”ReentrantLockä¸ä»…æä¾›äº†æ›´ä¸°å¯Œçš„åŠ é”æœºåˆ¶ï¼Œè€Œä¸”åœ¨æ€§èƒ½ä¸Šä¹Ÿä¸é€Šè‰²äºå†…ç½®é”(åœ¨ä»¥å‰çš„ç‰ˆæœ¬ä¸­ç”šè‡³ä¼˜äºå†…ç½®é”)ã€‚ synchronizedå…³é”®å­— Javaæä¾›äº†å†…ç½®é”æ¥æ”¯æŒå¤šçº¿ç¨‹çš„åŒæ­¥ï¼ŒJVMæ ¹æ®synchronizedå…³é”®å­—æ¥æ ‡è¯†åŒæ­¥ä»£ç å—ã€‚ å½“çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨è·å–é”ï¼Œé€€å‡ºåŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚ä¸€ä¸ªçº¿ç¨‹è·å¾—é”åå…¶ä»–çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ã€‚ æ¯ä¸ªJavaå¯¹è±¡éƒ½å¯ä»¥ç”¨åšä¸€ä¸ªå®ç°åŒæ­¥çš„é”ï¼Œsynchronizedå…³é”®å­—å¯ä»¥ç”¨æ¥ä¿®é¥°å¯¹è±¡æ–¹æ³•ï¼Œé™æ€æ–¹æ³•å’Œä»£ç å—ã€‚ å½“ä¿®é¥°å¯¹è±¡æ–¹æ³•å’Œé™æ€æ–¹æ³•æ—¶é”åˆ†åˆ«æ˜¯æ–¹æ³•æ‰€åœ¨çš„å¯¹è±¡å’ŒClasså¯¹è±¡ï¼Œå½“ä¿®é¥°ä»£ç å—æ—¶éœ€æä¾›é¢å¤–çš„å¯¹è±¡ä½œä¸ºé”ã€‚ æ¯ä¸ªJavaå¯¹è±¡ä¹‹æ‰€ä»¥å¯ä»¥ä½œä¸ºé”ï¼Œæ˜¯å› ä¸ºåœ¨å¯¹è±¡å¤´ä¸­å…³è”äº†ä¸€ä¸ªmonitorå¯¹è±¡(ç®¡ç¨‹)ã€‚çº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ä¼šè‡ªåŠ¨æŒæœ‰monitorå¯¹è±¡ï¼Œé€€å‡ºæ—¶ä¼šè‡ªåŠ¨é‡Šæ”¾monitorå¯¹è±¡ï¼Œå½“monitorå¯¹è±¡è¢«æŒæœ‰æ—¶å…¶ä»–çº¿ç¨‹å°†ä¼šè¢«é˜»å¡ã€‚å½“ç„¶è¿™äº›åŒæ­¥æ“ä½œéƒ½ç”±JVMåº•å±‚å¸®ä½ å®ç°äº†ï¼Œä½†ä»¥synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•å’Œä»£ç å—åœ¨åº•å±‚å®ç°ä¸Šè¿˜æ˜¯æœ‰äº›åŒºåˆ«çš„ã€‚ synchronizedå…³é”®å­—ä¿®é¥°çš„æ–¹æ³•æ˜¯éšå¼åŒæ­¥çš„ï¼Œå³æ— éœ€é€šè¿‡å­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çš„ï¼ŒJVMå¯ä»¥æ ¹æ®æ–¹æ³•è¡¨ä¸­çš„ACC_SYNCHRONIZEDè®¿é—®æ ‡å¿—æ¥åŒºåˆ†ä¸€ä¸ªæ–¹æ³•æ˜¯å¦æ˜¯åŒæ­¥æ–¹æ³•ï¼› è€Œsynchronizedå…³é”®å­—ä¿®é¥°çš„ä»£ç å—æ˜¯æ˜¾å¼åŒæ­¥çš„ï¼Œå®ƒæ˜¯é€šè¿‡monitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤æ¥æ§åˆ¶çº¿ç¨‹å¯¹ç®¡ç¨‹çš„æŒæœ‰å’Œé‡Šæ”¾ã€‚ monitorå¯¹è±¡å†…éƒ¨æŒæœ‰_countå­—æ®µï¼Œ_countç­‰äº0è¡¨ç¤ºç®¡ç¨‹æœªè¢«æŒæœ‰ï¼Œ_countå¤§äº0è¡¨ç¤ºç®¡ç¨‹å·²è¢«æŒæœ‰ï¼Œæ¯æ¬¡æŒæœ‰çº¿ç¨‹é‡å…¥æ—¶_countéƒ½ä¼šåŠ 1ï¼Œæ¯æ¬¡æŒæœ‰çº¿ç¨‹é€€å‡ºæ—¶_countéƒ½ä¼šå‡1ï¼Œè¿™å°±æ˜¯å†…ç½®é”é‡å…¥æ€§çš„å®ç°åŸç†ã€‚ å¦å¤–ï¼Œmonitorå¯¹è±¡å†…éƒ¨è¿˜æœ‰ä¸¤æ¡é˜Ÿåˆ—_EntryListå’Œ_WaitSetï¼Œå¯¹åº”ç€AQSçš„åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ï¼Œå½“çº¿ç¨‹è·å–é”å¤±è´¥æ—¶ä¼šåˆ°_EntryListä¸­é˜»å¡ï¼Œå½“è°ƒç”¨é”å¯¹è±¡çš„waitæ–¹æ³•æ—¶çº¿ç¨‹å°†ä¼šè¿›å…¥_WaitSetä¸­ç­‰å¾…ï¼Œè¿™æ˜¯å†…ç½®é”çš„çº¿ç¨‹åŒæ­¥å’Œæ¡ä»¶ç­‰å¾…çš„å®ç°åŸç†ã€‚ ReentrantLockå’ŒSynchronizedçš„å¯¹æ¯” synchronizedå…³é”®å­—æ˜¯Javaæä¾›çš„å†…ç½®é”æœºåˆ¶ï¼Œå…¶åŒæ­¥æ“ä½œç”±åº•å±‚JVMå®ç°ï¼Œè€ŒReentrantLockæ˜¯java.util.concurrentåŒ…æä¾›çš„æ˜¾å¼é”ï¼Œå…¶åŒæ­¥æ“ä½œç”±AQSåŒæ­¥å™¨æä¾›æ”¯æŒã€‚ ReentrantLockåœ¨åŠ é”å’Œå†…å­˜ä¸Šæä¾›çš„è¯­ä¹‰ä¸å†…ç½®é”ç›¸åŒï¼Œæ­¤å¤–å®ƒè¿˜æä¾›äº†ä¸€äº›å…¶ä»–åŠŸèƒ½ï¼ŒåŒ…æ‹¬å®šæ—¶çš„é”ç­‰å¾…ï¼Œå¯ä¸­æ–­çš„é”ç­‰å¾…ï¼Œå…¬å¹³é”ï¼Œä»¥åŠå®ç°éå—ç»“æ„çš„åŠ é”ã€‚ åœ¨æ—©æœŸçš„JDKç‰ˆæœ¬ä¸­ReentrantLockåœ¨æ€§èƒ½ä¸Šè¿˜å æœ‰ä¸€å®šçš„ä¼˜åŠ¿ï¼Œæ—¢ç„¶ReentrantLockæ‹¥æœ‰è¿™ä¹ˆå¤šä¼˜åŠ¿ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨synchronizedå…³é”®å­—å‘¢ï¼Ÿäº‹å®ä¸Šç¡®å®æœ‰è®¸å¤šäººä½¿ç”¨ReentrantLockæ¥æ›¿ä»£synchronizedå…³é”®å­—çš„åŠ é”æ“ä½œã€‚ä½†æ˜¯å†…ç½®é”ä»ç„¶æœ‰å®ƒç‰¹æœ‰çš„ä¼˜åŠ¿ï¼Œå†…ç½®é”ä¸ºè®¸å¤šå¼€å‘äººå‘˜æ‰€ç†Ÿæ‚‰ï¼Œä½¿ç”¨æ–¹å¼ä¹Ÿæ›´åŠ çš„ç®€æ´ç´§å‡‘ï¼Œå› ä¸ºæ˜¾å¼é”å¿…é¡»æ‰‹åŠ¨åœ¨finallyå—ä¸­è°ƒç”¨unlockï¼Œæ‰€ä»¥ä½¿ç”¨å†…ç½®é”ç›¸å¯¹æ¥è¯´ä¼šæ›´åŠ å®‰å…¨äº›ã€‚åŒæ—¶æœªæ¥æ›´åŠ å¯èƒ½ä¼šå»æå‡synchronizedè€Œä¸æ˜¯ReentrantLockçš„æ€§èƒ½ã€‚å› ä¸ºsynchronizedæ˜¯JVMçš„å†…ç½®å±æ€§ï¼Œå®ƒèƒ½æ‰§è¡Œä¸€äº›ä¼˜åŒ–ï¼Œä¾‹å¦‚å¯¹çº¿ç¨‹å°é—­çš„é”å¯¹è±¡çš„é”æ¶ˆé™¤ä¼˜åŒ–ï¼Œé€šè¿‡å¢åŠ é”çš„ç²’åº¦æ¥æ¶ˆé™¤å†…ç½®é”çš„åŒæ­¥ï¼Œè€Œå¦‚æœé€šè¿‡åŸºäºç±»åº“çš„é”æ¥å®ç°è¿™äº›åŠŸèƒ½ï¼Œåˆ™å¯èƒ½æ€§ä¸å¤§ã€‚æ‰€ä»¥å½“éœ€è¦ä¸€äº›é«˜çº§åŠŸèƒ½æ—¶æ‰åº”è¯¥ä½¿ç”¨ReentrantLockï¼Œè¿™äº›åŠŸèƒ½åŒ…æ‹¬ï¼šå¯å®šæ—¶çš„ï¼Œå¯è½®è¯¢çš„ä¸å¯ä¸­æ–­çš„é”è·å–æ“ä½œï¼Œå…¬å¹³é˜Ÿåˆ—ï¼Œä»¥åŠéå—ç»“æ„çš„é”ã€‚å¦åˆ™ï¼Œè¿˜æ˜¯åº”è¯¥ä¼˜å…ˆä½¿ç”¨synchronizedã€‚ è·å–é”å’Œé‡Šæ”¾é” é¦–å…ˆé€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£ä¸‹ReentrantLockçš„ç”¨æ³•ï¼šå¦‚æœæœ‰ä¸€ä¸ªå…±äº«å˜é‡countï¼Œæœ‰10ä¸ªçº¿ç¨‹å¯¹å®ƒè¿›è¡Œç´¯åŠ ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹ç´¯åŠ 1000æ¬¡ï¼Œè¿™æ®µä»£ç æ€æ ·è®¾è®¡å‘¢ï¼Ÿ æœ‰å¾ˆå¤šç§åŠæ³•ï¼Œå¯ä»¥åˆ©ç”¨synchronizedå…³é”®å­—ï¼Œä¹Ÿå¯ä»¥åˆ©ç”¨åŸå­ç±»AtomicInteger,é‚£æˆ‘ä»¬åˆ©ç”¨ReentrantLockæ€æ ·å¤„ç†çš„ï¼Ÿ 123456789101112131415161718192021222324252627282930package main.java.com.study.lock;/** * @author: whb * @description: ReentrantLockæµ‹è¯•ç±» */public class ReentrantLockTest { private static int count = 0; //é»˜è®¤æ˜¯è·å–ä¸€ä¸ªéå…¬å¹³é” private static ReentrantLock lock = new ReentrantLock(); public static void main(String[] args) throws InterruptedException { for (int i = 0; i &lt; 10; i++) { new Thread(() -&gt; { try { //æ‰§è¡Œå‰å…ˆåŠ é” lock.lock(); for (int j = 0; j &lt; 1000; j++) { count++; } } finally { //æœ€åé‡Šæ”¾é” lock.unlock(); } }).start(); } Thread.sleep(5000); System.out.println("count=" + count); }} ä»¥ä¸‹æ˜¯è·å–é”å’Œé‡Šæ”¾é”è¿™ä¸¤ä¸ªæ“ä½œçš„APIã€‚ 12345678//è·å–é”çš„æ“ä½œpublic void lock() { sync.lock();}//é‡Šæ”¾é”çš„æ“ä½œpublic void unlock() { sync.release(1);} é”çš„è·å–å’Œé‡Šæ”¾çš„æºç å¹¶æ²¡æœ‰æ›´å¤šçš„é€»è¾‘ï¼Œè€Œæ ¸å¿ƒçš„é€»è¾‘åˆ†åˆ«å§”æ‰˜ç»™Syncå¯¹è±¡çš„lockæ–¹æ³•å’Œreleaseæ–¹æ³•ã€‚é‚£ä¹ˆSyncåˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿåœ¨AQSçš„æ–‡ç« ä¸­æåˆ°è¿‡ï¼Œåœ¨å¹¶å‘åŒ…ä¸­é”çš„åº•å±‚å®ç°éƒ½æ˜¯é€šè¿‡AQSæ¡†æ¶å®ç°çš„ã€‚ å¦‚æœæƒ³å®ç°ç‹¬å é”ï¼Œå­ç±»åªéœ€è¦å®ç°å¦‚ä¸‹æ–¹æ³•ï¼š 1ï¼šè·å–é”ï¼štryAcquire() 2ï¼šé‡Šæ”¾é”ï¼štryRelease() å¦‚æœæƒ³å®ç°å…±äº«é”ï¼š 1: è·å–é”ï¼štryAcquireShared() 2: é‡Šæ”¾é”ï¼štryReleaseShared() Syncå°±æ˜¯AQSçš„å­ç±»,å¹¶ä¸”æ˜¯ç‹¬å é”æ¨¡å¼ã€‚ åœ¨ReentrantLockä¸­æœ‰ä¸¤ç§æ¨¡å¼ï¼šä¸€ç§æ˜¯éå…¬å¹³æ¨¡å¼è·å–é”ï¼Œå¦ä¸€ç§æ˜¯å…¬å¹³æ¨¡å¼è·å–é”ã€‚é»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³çš„ã€‚ 1234567891011121314151617181920212223242526272829303132public class ReentrantLock implements Lock, java.io.Serializable { private final Sync sync; abstract static class Sync extends AbstractQueuedSynchronizer { abstract void lock(); } //å®ç°éå…¬å¹³é”çš„åŒæ­¥å™¨ static final class NonfairSync extends Sync { final void lock() { ... } } //å®ç°å…¬å¹³é”çš„åŒæ­¥å™¨ static final class FairSync extends Sync { final void lock() { ... } } //é»˜è®¤æ„é€ å™¨ï¼šéå…¬å¹³é” public ReentrantLock() { sync = new NonfairSync(); } //å¸¦å‚æ„é€ å™¨ï¼šfair=trueè¡¨ç¤ºæ˜¯å…¬å¹³æ¨¡å¼è·å–é”;fair=falseè¡¨ç¤ºæ˜¯éå…¬å¹³æ¨¡å¼è·å–é” public ReentrantLock(boolean fair) { sync = fair ? new FairSync() : new NonfairSync(); }} è°ƒç”¨é»˜è®¤æ— å‚æ„é€ å™¨ä¼šå°†NonfairSyncå®ä¾‹èµ‹å€¼ç»™syncï¼Œæ­¤æ—¶é”æ˜¯éå…¬å¹³é”ã€‚æœ‰å‚æ„é€ å™¨å…è®¸é€šè¿‡å‚æ•°æ¥æŒ‡å®šæ˜¯å°†FairSyncå®ä¾‹è¿˜æ˜¯NonfairSyncå®ä¾‹èµ‹å€¼ç»™syncã€‚NonfairSyncå’ŒFairSyncéƒ½æ˜¯ç»§æ‰¿è‡ªSyncç±»å¹¶é‡å†™äº†lock()æ–¹æ³•ï¼Œæ‰€ä»¥å…¬å¹³é”å’Œéå…¬å¹³é”åœ¨è·å–é”çš„æ–¹å¼ä¸Šæœ‰äº›åŒºåˆ«ã€‚ å†æ¥çœ‹çœ‹é‡Šæ”¾é”çš„æ“ä½œï¼Œæ¯æ¬¡è°ƒç”¨unlock()æ–¹æ³•éƒ½åªæ˜¯å»æ‰§è¡Œsync.release(1)æ“ä½œï¼Œè¿™æ­¥æ“ä½œä¼šè°ƒç”¨AbstractQueuedSynchronizerç±»çš„release()æ–¹æ³•ï¼Œä¸‹é¢çœ‹ä¸€ä¸‹ï¼š 123456789101112131415//é‡Šæ”¾é”çš„æ“ä½œ(ç‹¬å æ¨¡å¼)public final boolean release(int arg) { //å°è¯•é‡Šæ”¾é” if (tryRelease(arg)) { //è·å–headç»“ç‚¹ Node h = head; //å¦‚æœheadç»“ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”ç­‰å¾…çŠ¶æ€ä¸ç­‰äº0å°±å»å”¤é†’åç»§ç»“ç‚¹ if (h != null &amp;&amp; h.waitStatus != 0) { //å”¤é†’åç»§ç»“ç‚¹ unparkSuccessor(h); } return true; } return false;} è¿™ä¸ªreleaseæ–¹æ³•æ˜¯AQSæä¾›çš„é‡Šæ”¾é”æ“ä½œçš„APIï¼Œå®ƒé¦–å…ˆä¼šå»è°ƒç”¨tryReleaseæ–¹æ³•å»å°è¯•è·å–é”ï¼ŒtryReleaseæ–¹æ³•æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„å®ç°é€»è¾‘åœ¨å­ç±»Syncé‡Œé¢ã€‚ 123456789101112131415161718//å°è¯•é‡Šæ”¾é”protected final boolean tryRelease(int releases) { int c = getState() - releases; //å¦‚æœæŒæœ‰é”çš„çº¿ç¨‹ä¸æ˜¯å½“å‰çº¿ç¨‹å°±æŠ›å‡ºå¼‚å¸¸ if (Thread.currentThread() != getExclusiveOwnerThread()) { throw new IllegalMonitorStateException(); } boolean free = false; //å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜é”è¢«é‡Šæ”¾ if (c == 0) { //è®¾ç½®é”è¢«é‡Šæ”¾çš„æ ‡å¿—ä¸ºçœŸ free = true; //è®¾ç½®å ç”¨çº¿ç¨‹ä¸ºç©º setExclusiveOwnerThread(null); } setState(c); return free;} è¿™ä¸ªtryReleaseæ–¹æ³•é¦–å…ˆä¼šè·å–å½“å‰åŒæ­¥çŠ¶æ€ï¼Œå¹¶å°†å½“å‰åŒæ­¥çŠ¶æ€å‡å»ä¼ å…¥çš„å‚æ•°å€¼å¾—åˆ°æ–°çš„åŒæ­¥çŠ¶æ€ï¼Œç„¶ååˆ¤æ–­æ–°çš„åŒæ­¥çŠ¶æ€æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœç­‰äº0åˆ™è¡¨æ˜å½“å‰é”è¢«é‡Šæ”¾ï¼Œç„¶åå…ˆå°†é”çš„é‡Šæ”¾çŠ¶æ€ç½®ä¸ºçœŸï¼Œå†å°†å½“å‰å æœ‰é”çš„çº¿ç¨‹æ¸…ç©ºï¼Œæœ€åè°ƒç”¨setStateæ–¹æ³•è®¾ç½®æ–°çš„åŒæ­¥çŠ¶æ€å¹¶è¿”å›é”çš„é‡Šæ”¾çŠ¶æ€ã€‚ å…¬å¹³é”/éå…¬å¹³é” ReentrantLockæ˜¯å…¬å¹³é”è¿˜æ˜¯éå…¬å¹³é”æ˜¯åŸºäºsyncæŒ‡å‘çš„æ˜¯å“ªä¸ªå…·ä½“å®ä¾‹ã€‚åœ¨æ„é€ æ—¶ä¼šä¸ºæˆå‘˜å˜é‡syncèµ‹å€¼ï¼Œå¦‚æœèµ‹å€¼ä¸ºNonfairSyncå®ä¾‹åˆ™è¡¨æ˜æ˜¯éå…¬å¹³é”ï¼Œå¦‚æœèµ‹å€¼ä¸ºFairSyncå®ä¾‹åˆ™è¡¨æ˜ä¸ºå…¬å¹³é”ã€‚å¦‚æœæ˜¯å…¬å¹³é”ï¼Œçº¿ç¨‹å°†æŒ‰ç…§å®ƒä»¬å‘å‡ºè¯·æ±‚çš„é¡ºåºæ¥è·å¾—é”ï¼Œä½†åœ¨éå…¬å¹³é”ä¸Šï¼Œåˆ™å…è®¸æ’é˜Ÿè¡Œä¸ºï¼šå½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚éå…¬å¹³çš„é”æ—¶ï¼Œå¦‚æœåœ¨å‘å‡ºè¯·æ±‚çš„åŒæ—¶è¯¥é”çš„çŠ¶æ€å˜ä¸ºå¯ç”¨ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°†è·³è¿‡é˜Ÿåˆ—ä¸­æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ç›´æ¥è·å¾—è¿™ä¸ªé”ã€‚ éå…¬å¹³é” 12345678910111213141516171819202122232425//éå…¬å¹³åŒæ­¥å™¨static final class NonfairSync extends Sync { //å®ç°çˆ¶ç±»çš„æŠ½è±¡è·å–é”çš„æ–¹æ³• final void lock() { //ä½¿ç”¨CASæ–¹å¼è®¾ç½®åŒæ­¥çŠ¶æ€ if (compareAndSetState(0, 1)) { //å¦‚æœè®¾ç½®æˆåŠŸåˆ™è¡¨æ˜é”æ²¡è¢«å ç”¨ setExclusiveOwnerThread(Thread.currentThread()); } else { //å¦åˆ™è¡¨æ˜é”å·²ç»è¢«å ç”¨, è°ƒç”¨acquireè®©çº¿ç¨‹å»åŒæ­¥é˜Ÿåˆ—æ’é˜Ÿè·å– acquire(1); } } //å°è¯•è·å–é”çš„æ–¹æ³• protected final boolean tryAcquire(int acquires) { return nonfairTryAcquire(acquires); }}//ä»¥ä¸å¯ä¸­æ–­æ¨¡å¼è·å–é”(ç‹¬å æ¨¡å¼)public final void acquire(int arg) { if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) { selfInterrupt(); }} å¯ä»¥çœ‹åˆ°åœ¨éå…¬å¹³é”çš„lockæ–¹æ³•ä¸­ï¼Œçº¿ç¨‹ç¬¬ä¸€æ­¥å°±ä¼šä»¥CASæ–¹å¼å°†åŒæ­¥çŠ¶æ€çš„å€¼ä»0æ”¹ä¸º1ã€‚å…¶å®è¿™æ­¥æ“ä½œå°±ç­‰äºå»å°è¯•è·å–é”ï¼Œå¦‚æœæ›´æ”¹æˆåŠŸåˆ™è¡¨æ˜çº¿ç¨‹åˆšæ¥å°±è·å–äº†é”ï¼Œè€Œä¸å¿…å†å»åŒæ­¥é˜Ÿåˆ—é‡Œé¢æ’é˜Ÿäº†ã€‚å¦‚æœæ›´æ”¹å¤±è´¥åˆ™è¡¨æ˜çº¿ç¨‹åˆšæ¥æ—¶é”è¿˜æœªè¢«é‡Šæ”¾ï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±è°ƒç”¨acquireæ–¹æ³•ã€‚è¿™ä¸ªacquireæ–¹æ³•æ˜¯ç»§æ‰¿è‡ªAbstractQueuedSynchronizerçš„æ–¹æ³•ï¼šçº¿ç¨‹è¿›å…¥acquireæ–¹æ³•åé¦–å…ˆå»è°ƒç”¨tryAcquireæ–¹æ³•å°è¯•å»è·å–é”ï¼Œç”±äºNonfairSyncè¦†ç›–äº†tryAcquireæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸­è°ƒç”¨äº†çˆ¶ç±»Syncçš„nonfairTryAcquireæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè°ƒç”¨åˆ°nonfairTryAcquireæ–¹æ³•å»å°è¯•è·å–é”ã€‚ä¸‹é¢çœ‹çœ‹è¿™ä¸ªæ–¹æ³•å…·ä½“åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627//éå…¬å¹³çš„è·å–é”final boolean nonfairTryAcquire(int acquires) { //è·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); //è·å–å½“å‰åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜é”æ²¡æœ‰è¢«å ç”¨ if (c == 0) { //ä½¿ç”¨CASæ›´æ–°åŒæ­¥çŠ¶æ€ if (compareAndSetState(0, acquires)) { //è®¾ç½®ç›®å‰å ç”¨é”çš„çº¿ç¨‹ setExclusiveOwnerThread(current); return true; } //å¦åˆ™çš„è¯å°±åˆ¤æ–­æŒæœ‰é”çš„æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ }else if (current == getExclusiveOwnerThread()) { //å¦‚æœé”æ˜¯è¢«å½“å‰çº¿ç¨‹æŒæœ‰çš„, å°±ç›´æ¥ä¿®æ”¹å½“å‰åŒæ­¥çŠ¶æ€ int nextc = c + acquires; if (nextc &lt; 0) { throw new Error("Maximum lock count exceeded"); } setState(nextc); return true; } //å¦‚æœæŒæœ‰é”çš„ä¸æ˜¯å½“å‰çº¿ç¨‹åˆ™è¿”å›å¤±è´¥æ ‡å¿— return false;} nonfairTryAcquireæ–¹æ³•æ˜¯Syncçš„æ–¹æ³•ï¼Œå¯ä»¥çœ‹åˆ°çº¿ç¨‹è¿›å…¥æ­¤æ–¹æ³•åé¦–å…ˆå»è·å–åŒæ­¥çŠ¶æ€ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º0å°±ä½¿ç”¨CASæ“ä½œæ›´æ”¹åŒæ­¥çŠ¶æ€ï¼Œå…¶å®è¿™åˆæ˜¯è·å–äº†ä¸€éé”ã€‚å¦‚æœåŒæ­¥çŠ¶æ€ä¸ä¸º0è¡¨æ˜é”è¢«å ç”¨ï¼Œæ­¤æ—¶ä¼šå…ˆå»åˆ¤æ–­æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯å°±å°†åŒæ­¥çŠ¶æ€åŠ 1ï¼Œå¦åˆ™çš„è¯è¿™æ¬¡å°è¯•è·å–é”çš„æ“ä½œå®£å‘Šå¤±è´¥ã€‚äºæ˜¯ä¼šè°ƒç”¨addWaiteræ–¹æ³•å°†çº¿ç¨‹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ã€‚ ç»¼ä¸Šæ¥çœ‹ï¼Œåœ¨éå…¬å¹³é”çš„æ¨¡å¼ä¸‹ä¸€ä¸ªçº¿ç¨‹åœ¨è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹å‰ä¼šå°è¯•è·å–ä¸¤éé”ï¼Œå¦‚æœè·å–æˆåŠŸåˆ™ä¸è¿›å…¥åŒæ­¥é˜Ÿåˆ—æ’é˜Ÿï¼Œå¦åˆ™æ‰è¿›å…¥åŒæ­¥é˜Ÿåˆ—æ’é˜Ÿã€‚ å…¬å¹³é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344//å®ç°å…¬å¹³é”çš„åŒæ­¥å™¨static final class FairSync extends Sync { //å®ç°çˆ¶ç±»çš„æŠ½è±¡è·å–é”çš„æ–¹æ³• final void lock() { //è°ƒç”¨acquireè®©çº¿ç¨‹å»åŒæ­¥é˜Ÿåˆ—æ’é˜Ÿè·å– acquire(1); } //å°è¯•è·å–é”çš„æ–¹æ³• protected final boolean tryAcquire(int acquires) { //è·å–å½“å‰çº¿ç¨‹ final Thread current = Thread.currentThread(); //è·å–å½“å‰åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æœåŒæ­¥çŠ¶æ€0åˆ™è¡¨ç¤ºé”æ²¡è¢«å ç”¨ if (c == 0) { //åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰å‰é©±ç»“ç‚¹ if (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(0, acquires)) { //å¦‚æœæ²¡æœ‰å‰é©±ç»“ç‚¹ä¸”è®¾ç½®åŒæ­¥çŠ¶æ€æˆåŠŸå°±è¡¨ç¤ºè·å–é”æˆåŠŸ setExclusiveOwnerThread(current); return true; } //å¦åˆ™åˆ¤æ–­æ˜¯å¦æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é” }else if (current == getExclusiveOwnerThread()) { //å¦‚æœæ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”å°±ç›´æ¥ä¿®æ”¹åŒæ­¥çŠ¶æ€ int nextc = c + acquires; if (nextc &lt; 0) { throw new Error("Maximum lock count exceeded"); } setState(nextc); return true; } //å¦‚æœä¸æ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”åˆ™è·å–å¤±è´¥ return false; }}//åˆ¤æ–­æ˜¯å¦æœ‰å‰é©±ç»“ç‚¹public final boolean hasQueuedPredecessors() { Node t = tail; Node h = head; Node s; return h != t &amp;&amp; ((s = h.next) == null || s.thread != Thread.currentThread());} è°ƒç”¨å…¬å¹³é”çš„lockæ–¹æ³•æ—¶ä¼šç›´æ¥è°ƒç”¨acquireæ–¹æ³•ã€‚åŒæ ·çš„ï¼Œacquireæ–¹æ³•é¦–å…ˆä¼šè°ƒç”¨FairSyncé‡å†™çš„tryAcquireæ–¹æ³•æ¥å°è¯•è·å–é”ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ä¹Ÿæ˜¯é¦–å…ˆè·å–åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œå¦‚æœåŒæ­¥çŠ¶æ€ä¸º0åˆ™è¡¨æ˜æ­¤æ—¶é”åˆšå¥½è¢«é‡Šæ”¾ï¼Œè¿™æ—¶å’Œéå…¬å¹³é”ä¸åŒçš„æ˜¯å®ƒä¼šå…ˆå»è°ƒç”¨hasQueuedPredecessorsæ–¹æ³•æŸ¥è¯¢åŒæ­¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰äººåœ¨æ’é˜Ÿï¼Œå¦‚æœæ²¡äººåœ¨æ’é˜Ÿæ‰ä¼šå»ä¿®æ”¹åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œå¯ä»¥çœ‹åˆ°å…¬å¹³é”åœ¨è¿™é‡Œé‡‡å–ç¤¼è®©çš„æ–¹å¼è€Œä¸æ˜¯è‡ªå·±é©¬ä¸Šå»è·å–é”ã€‚é™¤äº†è¿™ä¸€æ­¥å’Œéå…¬å¹³é”ä¸ä¸€æ ·ä¹‹å¤–ï¼Œå…¶ä»–çš„æ“ä½œéƒ½æ˜¯ä¸€æ ·çš„ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼Œå¯ä»¥çœ‹åˆ°å…¬å¹³é”åœ¨è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¹‹å‰åªæ£€æŸ¥äº†ä¸€éé”çš„çŠ¶æ€ï¼Œå³ä½¿æ˜¯å‘ç°äº†é”æ˜¯å¼€çš„ä¹Ÿä¸ä¼šè‡ªå·±é©¬ä¸Šå»è·å–ï¼Œè€Œæ˜¯å…ˆè®©åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å…ˆè·å–ï¼Œæ‰€ä»¥å¯ä»¥ä¿è¯åœ¨å…¬å¹³é”ä¸‹æ‰€æœ‰çº¿ç¨‹è·å–é”çš„é¡ºåºéƒ½æ˜¯å…ˆæ¥ååˆ°çš„ï¼Œè¿™ä¹Ÿä¿è¯äº†è·å–é”çš„å…¬å¹³æ€§ã€‚ é‚£ä¹ˆä¸ºä»€ä¹ˆä¸å¸Œæœ›æ‰€æœ‰é”éƒ½æ˜¯å…¬å¹³çš„å‘¢ï¼Ÿæ¯•ç«Ÿå…¬å¹³æ˜¯ä¸€ç§å¥½çš„è¡Œä¸ºï¼Œè€Œä¸å…¬å¹³æ˜¯ä¸€ç§ä¸å¥½çš„è¡Œä¸ºã€‚ç”±äºçº¿ç¨‹çš„æŒ‚èµ·å’Œå”¤é†’æ“ä½œå­˜åœ¨è¾ƒå¤§çš„å¼€é”€è€Œå½±å“ç³»ç»Ÿæ€§èƒ½ï¼Œç‰¹åˆ«æ˜¯åœ¨ç«äº‰æ¿€çƒˆçš„æƒ…å†µä¸‹å…¬å¹³é”å°†å¯¼è‡´çº¿ç¨‹é¢‘ç¹çš„æŒ‚èµ·å’Œå”¤é†’æ“ä½œï¼Œè€Œéå…¬å¹³é”å¯ä»¥å‡å°‘è¿™æ ·çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨æ€§èƒ½ä¸Šå°†ä¼šä¼˜äºå…¬å¹³é”ã€‚å¦å¤–ï¼Œç”±äºå¤§éƒ¨åˆ†çº¿ç¨‹ä½¿ç”¨é”çš„æ—¶é—´éƒ½æ˜¯éå¸¸çŸ­æš‚çš„ï¼Œè€Œçº¿ç¨‹çš„å”¤é†’æ“ä½œä¼šå­˜åœ¨å»¶æ—¶æƒ…å†µï¼Œæœ‰å¯èƒ½åœ¨Açº¿ç¨‹è¢«å”¤é†’æœŸé—´Bçº¿ç¨‹é©¬ä¸Šè·å–äº†é”å¹¶ä½¿ç”¨å®Œé‡Šæ”¾äº†é”ï¼Œè¿™å°±å¯¼è‡´äº†åŒèµ¢çš„å±€é¢ï¼ŒAçº¿ç¨‹è·å–é”çš„æ—¶åˆ»å¹¶æ²¡æœ‰æ¨è¿Ÿï¼Œä½†Bçº¿ç¨‹æå‰ä½¿ç”¨äº†é”ï¼Œå¹¶ä¸”ååé‡ä¹Ÿè·å¾—äº†æé«˜ã€‚ æ¡ä»¶é˜Ÿåˆ—çš„å®ç°æœºåˆ¶ å†…ç½®æ¡ä»¶é˜Ÿåˆ—å­˜åœ¨ä¸€äº›ç¼ºé™·ï¼Œæ¯ä¸ªå†…ç½®é”éƒ½åªèƒ½æœ‰ä¸€ä¸ªç›¸å…³è”çš„æ¡ä»¶é˜Ÿåˆ—ï¼Œè¿™å¯¼è‡´å¤šä¸ªçº¿ç¨‹å¯èƒ½åœ¨åŒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—ä¸Šç­‰å¾…ä¸åŒçš„æ¡ä»¶è°“è¯ï¼Œé‚£ä¹ˆæ¯æ¬¡è°ƒç”¨notifyAllæ—¶éƒ½ä¼šå°†æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹å”¤é†’ï¼Œå½“çº¿ç¨‹é†’æ¥åå‘ç°å¹¶ä¸æ˜¯è‡ªå·±ç­‰å¾…çš„æ¡ä»¶è°“è¯ï¼Œè½¬è€Œåˆä¼šè¢«æŒ‚èµ·ã€‚è¿™å¯¼è‡´åšäº†å¾ˆå¤šæ— ç”¨çš„çº¿ç¨‹å”¤é†’å’ŒæŒ‚èµ·æ“ä½œï¼Œè€Œè¿™äº›æ“ä½œå°†ä¼šå¤§é‡æµªè´¹ç³»ç»Ÿèµ„æºï¼Œé™ä½ç³»ç»Ÿçš„æ€§èƒ½ã€‚å¦‚æœæƒ³ç¼–å†™ä¸€ä¸ªå¸¦æœ‰å¤šä¸ªæ¡ä»¶è°“è¯çš„å¹¶å‘å¯¹è±¡ï¼Œæˆ–è€…æƒ³è·å¾—é™¤äº†æ¡ä»¶é˜Ÿåˆ—å¯è§æ€§ä¹‹å¤–çš„æ›´å¤šæ§åˆ¶æƒï¼Œå°±éœ€è¦ä½¿ç”¨æ˜¾å¼çš„Lockå’ŒConditionè€Œä¸æ˜¯å†…ç½®é”å’Œæ¡ä»¶é˜Ÿåˆ—ã€‚ä¸€ä¸ªConditionå’Œä¸€ä¸ªLockå…³è”åœ¨ä¸€èµ·ï¼Œå°±åƒä¸€ä¸ªæ¡ä»¶é˜Ÿåˆ—å’Œä¸€ä¸ªå†…ç½®é”ç›¸å…³è”ä¸€æ ·ã€‚è¦åˆ›å»ºä¸€ä¸ªConditionï¼Œå¯ä»¥åœ¨ç›¸å…³è”çš„Lockä¸Šè°ƒç”¨Lock.newConditionæ–¹æ³•ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä½¿ç”¨Conditionçš„ç¤ºä¾‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package main.java.com.study.producerconsumer.v2;import java.util.concurrent.locks.Condition;import java.util.concurrent.locks.Lock;import java.util.concurrent.locks.ReentrantLock;/** * @author: whb * @description: ç¼“å†²åŒº */public class ConditionBuffer { private final Lock lock = new ReentrantLock(); /** * ä¸æ»¡ */ final Condition notFull = lock.newCondition(); /** * ä¸ç©º */ final Condition notEmpty = lock.newCondition(); /** * ç¼“å†²åŒº */ final Object[] items = new Object[100]; int putptr, takeptr, count; //ç”Ÿäº§æ–¹æ³• public void put(Object x) throws InterruptedException { lock.lock(); try { while (count == items.length) { //é˜Ÿåˆ—å·²æ»¡, çº¿ç¨‹åœ¨notFullé˜Ÿåˆ—ä¸Šç­‰å¾… notFull.await(); } items[putptr] = x; if (++putptr == items.length) { putptr = 0; } ++count; //ç”Ÿäº§æˆåŠŸ, å”¤é†’notEmptyé˜Ÿåˆ—çš„ç»“ç‚¹ notEmpty.signal(); } finally { lock.unlock(); } } //æ¶ˆè´¹æ–¹æ³• public Object take() throws InterruptedException { lock.lock(); try { while (count == 0) { //é˜Ÿåˆ—ä¸ºç©º, çº¿ç¨‹åœ¨notEmptyé˜Ÿåˆ—ä¸Šç­‰å¾… notEmpty.await(); } Object x = items[takeptr]; if (++takeptr == items.length) { takeptr = 0; } --count; //æ¶ˆè´¹æˆåŠŸ, å”¤é†’notFullé˜Ÿåˆ—çš„ç»“ç‚¹ notFull.signal(); return x; } finally { lock.unlock(); } }} ä¸€ä¸ªlockå¯¹è±¡å¯ä»¥äº§ç”Ÿå¤šä¸ªæ¡ä»¶é˜Ÿåˆ—ï¼Œè¿™é‡Œäº§ç”Ÿäº†ä¸¤ä¸ªæ¡ä»¶é˜Ÿåˆ—notFullå’ŒnotEmptyã€‚ å½“å®¹å™¨å·²æ»¡æ—¶å†è°ƒç”¨putæ–¹æ³•çš„çº¿ç¨‹éœ€è¦è¿›è¡Œé˜»å¡ï¼Œç­‰å¾…æ¡ä»¶è°“è¯ä¸ºçœŸ(å®¹å™¨ä¸æ»¡)æ‰é†’æ¥ç»§ç»­æ‰§è¡Œï¼› å½“å®¹å™¨ä¸ºç©ºæ—¶å†è°ƒç”¨takeæ–¹æ³•çš„çº¿ç¨‹ä¹Ÿéœ€è¦é˜»å¡ï¼Œç­‰å¾…æ¡ä»¶è°“è¯ä¸ºçœŸ(å®¹å™¨ä¸ç©º)æ‰é†’æ¥ç»§ç»­æ‰§è¡Œã€‚ è¿™ä¸¤ç±»çº¿ç¨‹æ˜¯æ ¹æ®ä¸åŒçš„æ¡ä»¶è°“è¯è¿›è¡Œç­‰å¾…çš„ï¼Œæ‰€ä»¥å®ƒä»¬ä¼šè¿›å…¥ä¸¤ä¸ªä¸åŒçš„æ¡ä»¶é˜Ÿåˆ—ä¸­é˜»å¡ï¼Œç­‰åˆ°åˆé€‚æ—¶æœºå†é€šè¿‡è°ƒç”¨Conditionå¯¹è±¡ä¸Šçš„APIè¿›è¡Œå”¤é†’ã€‚ ä¸‹é¢æ˜¯newConditionæ–¹æ³•çš„å®ç°ä»£ç ã€‚ 1234567891011//åˆ›å»ºæ¡ä»¶é˜Ÿåˆ—public Condition newCondition() { return sync.newCondition();}abstract static class Sync extends AbstractQueuedSynchronizer { //æ–°å»ºConditionå¯¹è±¡ final ConditionObject newCondition() { return new ConditionObject(); }} ReentrantLockä¸Šçš„æ¡ä»¶é˜Ÿåˆ—çš„å®ç°éƒ½æ˜¯åŸºäºAbstractQueuedSynchronizerçš„ï¼Œåœ¨è°ƒç”¨newConditionæ–¹æ³•æ—¶æ‰€è·å¾—çš„Conditionå¯¹è±¡å°±æ˜¯AQSçš„å†…éƒ¨ç±»ConditionObjectçš„å®ä¾‹ã€‚æ‰€æœ‰å¯¹æ¡ä»¶é˜Ÿåˆ—çš„æ“ä½œéƒ½æ˜¯é€šè¿‡è°ƒç”¨ConditionObjectå¯¹å¤–æä¾›çš„APIæ¥å®Œæˆçš„ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-LockSupport]]></title>
    <url>%2Fposts%2F2c562869.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° LockSupportæ˜¯ç”¨æ¥åˆ›å»ºé”å’Œå…¶ä»–åŒæ­¥ç±»çš„åŸºæœ¬çº¿ç¨‹é˜»å¡åŸè¯­ã€‚ æ–¹æ³•åˆ—è¡¨ 12345678910111213141516// è¿”å›æä¾›ç»™æœ€è¿‘ä¸€æ¬¡å°šæœªè§£é™¤é˜»å¡çš„ park æ–¹æ³•è°ƒç”¨çš„ blocker å¯¹è±¡ï¼Œå¦‚æœè¯¥è°ƒç”¨ä¸å—é˜»å¡ï¼Œåˆ™è¿”å› nullã€‚static Object getBlocker(Thread t)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éè®¸å¯å¯ç”¨ã€‚static void park()// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨è®¸å¯å¯ç”¨ä¹‹å‰ç¦ç”¨å½“å‰çº¿ç¨‹ã€‚static void park(Object blocker)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œæœ€å¤šç­‰å¾…æŒ‡å®šçš„ç­‰å¾…æ—¶é—´ï¼Œé™¤éè®¸å¯å¯ç”¨ã€‚static void parkNanos(long nanos)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨è®¸å¯å¯ç”¨å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œå¹¶æœ€å¤šç­‰å¾…æŒ‡å®šçš„ç­‰å¾…æ—¶é—´ã€‚static void parkNanos(Object blocker, long nanos)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨æŒ‡å®šçš„æ—¶é™å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éè®¸å¯å¯ç”¨ã€‚static void parkUntil(long deadline)// ä¸ºäº†çº¿ç¨‹è°ƒåº¦ï¼Œåœ¨æŒ‡å®šçš„æ—¶é™å‰ç¦ç”¨å½“å‰çº¿ç¨‹ï¼Œé™¤éè®¸å¯å¯ç”¨ã€‚static void parkUntil(Object blocker, long deadline)// å¦‚æœç»™å®šçº¿ç¨‹çš„è®¸å¯å°šä¸å¯ç”¨ï¼Œåˆ™ä½¿å…¶å¯ç”¨ã€‚static void unpark(Thread thread) åŸç† LockSupportä¸­çš„park() å’Œ unpark() çš„ä½œç”¨åˆ†åˆ«æ˜¯é˜»å¡çº¿ç¨‹å’Œè§£é™¤é˜»å¡çº¿ç¨‹ï¼Œè€Œä¸”park()å’Œunpark()ä¸ä¼šé‡åˆ°Thread.suspend å’Œ Thread.resumeæ‰€å¯èƒ½å¼•å‘çš„æ­»é” é—®é¢˜ã€‚ å› ä¸ºpark() å’Œ unpark()æœ‰è®¸å¯çš„å­˜åœ¨ï¼Œunpark()ä¸ºçº¿ç¨‹æä¾›â€œè®¸å¯(permit)â€ï¼Œçº¿ç¨‹è°ƒç”¨park()åˆ™ç­‰å¾…â€œè®¸å¯â€ ï¼›è°ƒç”¨ park() çš„çº¿ç¨‹å’Œå¦ä¸€ä¸ªè¯•å›¾å°†å…¶ unpark() çš„çº¿ç¨‹ä¹‹é—´çš„ç«äº‰å°†ä¿æŒæ´»æ€§ã€‚ è¿™ä¸ªæœ‰ç‚¹åƒä¿¡å·é‡ï¼Œå¯æ˜¯è¿™ä¸ªâ€œè®¸å¯â€æ˜¯ä¸èƒ½å åŠ çš„ï¼Œâ€œè®¸å¯â€æ˜¯ä¸€æ¬¡æ€§çš„ã€‚ æ¯”å¦‚ï¼šçº¿ç¨‹Bè¿ç»­è°ƒç”¨äº†ä¸‰æ¬¡unparkå‡½æ•°ï¼Œå½“çº¿ç¨‹Aè°ƒç”¨parkå‡½æ•°å°±ä½¿ç”¨æ‰è¿™ä¸ªâ€œè®¸å¯â€ï¼Œå‡è®¾çº¿ç¨‹Aå†æ¬¡è°ƒç”¨parkï¼Œåˆ™è¿›å…¥ç­‰å¾…çŠ¶æ€ã€‚ æ³¨æ„ã€‚unparkå‡½æ•°èƒ½å¤Ÿå…ˆäºparkè°ƒç”¨ã€‚æ¯”æ–¹çº¿ç¨‹Bè°ƒç”¨unparkå‡½æ•°ï¼Œç»™çº¿ç¨‹Aå‘äº†ä¸€ä¸ªâ€œè®¸å¯â€ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹Aè°ƒç”¨parkæ—¶ã€‚å®ƒå‘ç°å·²ç»æœ‰â€œè®¸å¯â€äº†ã€‚é‚£ä¹ˆå®ƒä¼šç«‹å³å†ç»§ç»­æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹1 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: LockSupportæµ‹è¯•ç±» */public class LockSupportDemoOne { public static void main(String args[]) { Thread thread = Thread.currentThread(); ThreadParkService service = new ThreadParkService(thread); System.out.println(Thread.currentThread().getName() + " start1"); service.start(); try { Thread.sleep(3000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + " center"); LockSupport.park(thread); System.out.println("end"); }}class ThreadParkService extends Thread { private Thread thread; public ThreadParkService(Thread thread) { this.thread = thread; } @Override public void run() { try { Thread.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + " wakup before"); LockSupport.unpark(thread);//è§£é”åçº¿ç¨‹2ç«‹é©¬å°±å¯ä»¥æ‰§è¡Œäº†ã€‚ try { System.out.println("è§£é”åä¼‘æ¯ä¸‰ç§’å“¦"); Thread.sleep(3000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println(Thread.currentThread().getName() + " wakup after"); }} æ‰§è¡Œç»“æœ1 123456main start1 Thread-0 wakup before è§£é”åä¼‘æ¯ä¸‰ç§’å“¦ main center end Thread-0 wakup after ç»“æœè¯´æ˜1 ä¸»çº¿ç¨‹mainå…ˆæ‰“å°äº†è‡ªå·±çš„ä¸œè¥¿ï¼Œä¸»çº¿ç¨‹åˆ°äº†parkæ—¶è¢«é˜»å¡äº†ã€‚çº¿ç¨‹1å¼‚æ­¥æ‰§è¡Œæ‰“å°äº† wakup beforemain centeræ‰“å°åœ¨â€œè§£é”åä¼‘æ¯3så“¦â€è¯´æ˜çº¿ç¨‹1ä¸­çš„unparkå…ˆä¸parkæ‰§è¡Œã€‚çº¿ç¨‹1æ‰§è¡Œäº†unparkäº†ï¼Œè¿™ä¸ªæ—¶å€™ä¸»çº¿ç¨‹ä¸­çš„parkç«‹é©¬è¢«å”¤é†’ï¼Œå¼€å§‹æ‰§è¡Œäº†endã€‚ç„¶åçº¿ç¨‹1ç­‰å¾…äº†3såæ‰§è¡Œäº†wakup afterã€‚ æ€»ç»“1 unparkï¼Œå¯ä»¥åœ¨parkä¹‹å‰æ‰§è¡Œã€‚å®ƒä»¬ä¸€å¯¹ä¸€,ä¸ç®¡ä»€ä¹ˆæ—¶å€™parkåªè¦æœ‰unparkè¿‡ä¸€æ¬¡å°±å¥½äº†ã€‚parkè¢«é˜»å¡åï¼Œunparkæ‰§è¡Œåparkç«‹å³è¢«å”¤é†’ã€‚ä¸waitä¸notifyä¸åŒï¼Œnotifyå”¤é†’waitåï¼Œè¿˜å¿…é¡»ç­‰å¾…notifyä»£ç å—ä¸­çš„ä»£ç æ‰§è¡Œå®Œæ¯•åwaitæ‰èƒ½æ‰§è¡Œã€‚ ä»£ç ç¤ºä¾‹2 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: LockSupportæµ‹è¯•ç¤ºä¾‹ */public class LockSupportDemoTwo { public static void main(String args[]) { Thread thread = Thread.currentThread(); ThreadParkService2 service2 = new ThreadParkService2(thread); System.out.println(Thread.currentThread().getName() + " start2"); service2.start(); System.out.println(" æ¼‚äº®çš„åˆ†å‰²çº¿---"); ThreadParkService service = new ThreadParkService(service2); System.out.println(Thread.currentThread().getName() + " start1"); service.start(); }}class ThreadParkService2 extends Thread { private Thread thread; public ThreadParkService2(Thread thread) { this.thread = thread; } @Override public void run() { System.out.println(Thread.currentThread().getName() + "-çº¿ç¨‹2å¼€å§‹park before"); //é˜»å¡å½“å‰æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸èƒ½é˜»å¡å…¶ä»–çº¿ç¨‹ï¼Œçœ‹æºç å“¦ã€‚é‡Œé¢é˜»å¡æ—¶å¹¶ä¸éœ€è¦ä»»ä½•ä¼ å‚ã€‚ LockSupport.park(this); //è¿™é‡Œå¹¶ä¸ä¼šé˜»å¡threadçº¿ç¨‹ï¼Œé˜»å¡çš„è¿˜æ˜¯å½“å‰çº¿ç¨‹ã€‚threadåªæ˜¯åšä¸€ä¸ªæ ‡è®°æ–¹ä¾¿è¢«é”çš„å¯¹è±¡ã€‚ //LockSupport.park(thread); System.out.println(Thread.currentThread().getName() + "-çº¿ç¨‹2park after"); }} æ‰§è¡Œç»“æœ2 12345678main start2 æ¼‚äº®çš„åˆ†å‰²çº¿â€” Thread-0-çº¿ç¨‹2å¼€å§‹park before main start1 Thread-1 wakup before è§£é”åä¼‘æ¯ä¸‰ç§’å“¦ Thread-0-çº¿ç¨‹2park after Thread-1 wakup after ç»“æœè¯´æ˜2 å…¶å®çœ‹ç»“æœå°±æ˜¯çº¿ç¨‹2é˜»å¡äº†ï¼Œçº¿ç¨‹1å”¤é†’äº†çº¿ç¨‹2.å°±è¿™ä¹ˆç®€å•ã€‚ æ€»ç»“ park()ä¸park(Object obj)æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ park()æ˜¯å¯ä»¥ä¸éœ€è¦å‚æ•°çš„å“¦ï¼Œå°±æ˜¯è¯´åŠ é”æ—¶ï¼Œä¸éœ€è¦æŒ‡å®šå¯¹è±¡ã€‚é‚£ä¹ˆå®ƒæ˜¯æ€ä¹ˆåŠ é”çš„å‘¢ï¼Ÿæºç å¦‚ä¸‹ï¼š 123456public static void park(Object blocker) { Thread t = Thread.currentThread(); setBlocker(t, blocker);//è®°å½•å½“å‰çº¿ç¨‹ç­‰å¾…çš„å¯¹è±¡ï¼ˆé˜»å¡å¯¹è±¡ï¼‰ï¼› UNSAFE.park(false, 0L);//é˜»å¡å½“å‰çº¿ç¨‹ï¼› setBlocker(t, null);//å½“å‰çº¿ç¨‹ç­‰å¾…å¯¹è±¡ç½®ä¸ºnullã€‚} å¯ä»¥çœ‹å‡ºæ¥ï¼Œé˜»å¡çš„æ—¶å€™UNSAFE.park(false, 0L);æ ¹æœ¬ä¸éœ€è¦å¤–é¢çš„å…¥å‚æ•°ã€‚ é‚£ä¹ˆsetBlockeræ˜¯ç”¨æ¥å¹²å—çš„å‘¢ï¼Ÿ å®ƒæ˜¯ç”¨æ¥åšç›‘æ§ç”¨çš„ï¼Œå½“å‰è¢«é˜»å¡çš„å¯¹è±¡æ˜¯é‚£ä¸ªï¼Œå¯ä»¥é€šè¿‡LockSupportä¸­çš„getä¹‹ç±»çš„æ–¹æ³•æ¥è·å–å½“å‰è¢«é˜»å¡çš„å¯¹è±¡ã€‚ UNSAFE.park(false, 0L);é”ä½çš„æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ã€‚ ä»£ç ç¤ºä¾‹2ä¸­çº¿ç¨‹2æœ‰ä¸€ä¸ªå‚æ•°ï¼ŒæŠŠä¸»çº¿ç¨‹ä¼ è¿‡å»äº†ï¼Œ æƒ³ç”¨çº¿ç¨‹2æ¥é˜»å¡ä¸»çº¿ç¨‹ã€‚ mainä¸­ï¼š 123Thread thread = Thread.currentThread(); ThreadParkService2 service2 = new ThreadParkService2(thread); â€¦ çº¿ç¨‹2ä¸­ï¼š 1LockSupport.park(thread); è¿™æ ·æ˜¯ä¸è¡Œçš„ï¼Œå‰é¢è¯´è¿‡parké˜»å¡çš„æ˜¯å½“å‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œå’Œå¤–é¢ä¼ é€’è¿›æ¥çš„å€¼æ— å…³ã€‚æ‰€ä»¥è¿™é‡Œè¢«é˜»å¡çš„è¿˜æ˜¯çº¿ç¨‹2ã€‚ unparkéœ€è¦å¸¦ä¸Šå‚æ•°ï¼Œè¿™æ ·æ‰çŸ¥é“è§£é”é‚£ä¸ªçº¿ç¨‹ã€‚ LockSupport.park é”ä½çš„æ˜¯Thread.currentThread()å½“å‰çº¿ç¨‹ã€‚ Thread.currentThread()ä¸this ç±»ç»§æ‰¿äº†Threadç±»åï¼Œå¯ä»¥ä½¿ç”¨this.getName();è·å–å½“å‰çº¿ç¨‹çš„åç§°ï¼Œä½†æ˜¯Thread.currentThread().getName()ä¹Ÿè·å–çº¿ç¨‹åç§°ã€‚é‚£ä¹ˆå®ƒä»¬æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿ ç»§æ‰¿äº†Threadç±»åä½¿ç”¨this.getName()è·å–çš„å½“å‰å¯¹è±¡çš„çº¿ç¨‹åç§°ï¼Œè€ŒThread.currentThread().getName()è·å–çš„æ˜¯å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹çš„åç§°ã€‚ parkå’Œwaitçš„åŒºåˆ« unparkå¯ä»¥å…ˆäºparkæ‰§è¡Œï¼Œnotifyä¸èƒ½å…ˆäºwaitæ‰§è¡Œï¼Œä¸ç„¶å°±ä¸èƒ½å”¤é†’äº†ã€‚ unparkéœ€è¦æŒ‡å®šå”¤é†’çš„çº¿ç¨‹ï¼Œè€Œnotifyæ˜¯éšæœºå”¤é†’ä¸€ä¸ªwaitã€‚ unparkè§£é”åparkç«‹å³å¯ä»¥æ‰§è¡Œï¼Œnotifyè§£é”åwaitéœ€è¦ç­‰å¾…notifyæ‰€åœ¨çš„synchronizedä»£ç å—æ‰§è¡Œå®Œæ¯•åwaitæ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚ waitå¿…é¡»åœ¨Synchronizeré‡Œé¢æ‰èƒ½æœ‰æ•ˆï¼Œunparkåˆ™ä¸ç”¨ã€‚ waitæ˜¯å¯¹è±¡é”ï¼Œparkåˆ™æ˜¯çº¿ç¨‹é”ã€‚ åº”ç”¨ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.lock.lockSupport;import java.util.concurrent.locks.LockSupport;/** * @author: whb * @description: é˜»å¡åŸè¯­æµ‹è¯• */public class LockSupportTest { /** * ä¸»çº¿ç¨‹ */ private static Thread mainThread; public static void main(String[] args) { ThreadA ta = new ThreadA("ta"); //è·å–ä¸»çº¿ç¨‹ mainThread = Thread.currentThread(); System.out.println(Thread.currentThread().getName() + " start ta"); //å¯åŠ¨çº¿ç¨‹ta ta.start(); System.out.println(Thread.currentThread().getName() + " block"); //ä¸»çº¿ç¨‹é˜»å¡ LockSupport.park(mainThread); System.out.println(Thread.currentThread().getName() + " continue"); } static class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { System.out.println(Thread.currentThread().getName() + " wakeup others."); LockSupport.unpark(mainThread); } }} æ‰§è¡Œç»“æœï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-CountDownLatch]]></title>
    <url>%2Fposts%2Fbbc8910e.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° CountDownLatch(é—­é”)æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·ç±»ï¼Œåˆ©ç”¨å®ƒæˆ‘ä»¬å¯ä»¥æ‹¦æˆªä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ä½¿å…¶åœ¨æŸä¸ªæ¡ä»¶æˆç†Ÿåå†æ‰§è¡Œã€‚ å®ƒçš„å†…éƒ¨æä¾›äº†ä¸€ä¸ªè®¡æ•°å™¨ï¼Œåœ¨æ„é€ é—­é”æ—¶å¿…é¡»æŒ‡å®šè®¡æ•°å™¨çš„åˆå§‹å€¼ï¼Œä¸”è®¡æ•°å™¨çš„åˆå§‹å€¼å¿…é¡»å¤§äº0ã€‚ å¦å¤–å®ƒè¿˜æä¾›äº†ä¸€ä¸ªcountDownæ–¹æ³•æ¥æ“ä½œè®¡æ•°å™¨çš„å€¼ï¼Œæ¯è°ƒç”¨ä¸€æ¬¡countDownæ–¹æ³•è®¡æ•°å™¨éƒ½ä¼šå‡1ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼å‡ä¸º0æ—¶å°±ä»£è¡¨æ¡ä»¶å·²æˆç†Ÿï¼Œæ‰€æœ‰å› è°ƒç”¨awaitæ–¹æ³•è€Œé˜»å¡çš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ è¿™å°±æ˜¯CountDownLatchçš„å†…éƒ¨æœºåˆ¶ï¼Œçœ‹èµ·æ¥å¾ˆç®€å•ï¼Œæ— éå°±æ˜¯é˜»å¡ä¸€éƒ¨åˆ†çº¿ç¨‹è®©å…¶åœ¨è¾¾åˆ°æŸä¸ªæ¡ä»¶ä¹‹åå†æ‰§è¡Œã€‚ä½†æ˜¯CountDownLatchçš„åº”ç”¨åœºæ™¯å´æ¯”è¾ƒå¹¿æ³›ï¼Œåªè¦ä½ è„‘æ´å¤Ÿå¤§åˆ©ç”¨å®ƒå°±å¯ä»¥ç©å‡ºå„ç§èŠ±æ ·ã€‚æœ€å¸¸è§çš„ä¸€ä¸ªåº”ç”¨åœºæ™¯æ˜¯å¼€å¯å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡ŒæŸä¸ªä»»åŠ¡ï¼Œç­‰åˆ°æ‰€æœ‰ä»»åŠ¡éƒ½æ‰§è¡Œå®Œå†ç»Ÿè®¡æ±‡æ€»ç»“æœã€‚ä¸‹å›¾åŠ¨æ€æ¼”ç¤ºäº†é—­é”é˜»å¡çº¿ç¨‹çš„æ•´ä¸ªè¿‡ç¨‹ã€‚ ä¸Šå›¾æ¼”ç¤ºäº†æœ‰5ä¸ªçº¿ç¨‹å› è°ƒç”¨awaitæ–¹æ³•è€Œè¢«é˜»å¡ï¼Œå®ƒä»¬éœ€è¦ç­‰å¾…è®¡æ•°å™¨çš„å€¼å‡ä¸º0æ‰èƒ½ç»§ç»­æ‰§è¡Œã€‚è®¡æ•°å™¨çš„åˆå§‹å€¼åœ¨æ„é€ é—­é”æ—¶è¢«æŒ‡å®šï¼Œåé¢éšç€æ¯æ¬¡countDownæ–¹æ³•çš„è°ƒç”¨è€Œå‡1ã€‚ æ„é€ å™¨ 12345//æ„é€ å™¨public CountDownLatch(int count) { if (count &lt; 0) throw new IllegalArgumentException("count &lt; 0"); this.sync = new Sync(count);} CountDownLatchåªæœ‰ä¸€ä¸ªå¸¦å‚æ„é€ å™¨ï¼Œå¿…é¡»ä¼ å…¥ä¸€ä¸ªå¤§äº0çš„å€¼ä½œä¸ºè®¡æ•°å™¨åˆå§‹å€¼ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚å¯ä»¥çœ‹åˆ°åœ¨æ„é€ æ–¹æ³•ä¸­åªæ˜¯å»newäº†ä¸€ä¸ªSyncå¯¹è±¡å¹¶èµ‹å€¼ç»™æˆå‘˜å˜é‡syncã€‚å’Œå…¶ä»–åŒæ­¥å·¥å…·ç±»ä¸€æ ·ï¼ŒCountDownLatchçš„å®ç°ä¾èµ–äºAQSï¼Œå®ƒæ˜¯AQSå…±äº«æ¨¡å¼ä¸‹çš„ä¸€ä¸ªåº”ç”¨ã€‚CountDownLatchå®ç°äº†ä¸€ä¸ªå†…éƒ¨ç±»Syncå¹¶ç”¨å®ƒå»ç»§æ‰¿AQSï¼Œè¿™æ ·å°±èƒ½ä½¿ç”¨AQSæä¾›çš„å¤§éƒ¨åˆ†æ–¹æ³•äº†ã€‚ ä¸‹é¢æ¥çœ‹ä¸€ä¸‹Syncå†…éƒ¨ç±»çš„ä»£ç ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839//åŒæ­¥å™¨private static final class Sync extends AbstractQueuedSynchronizer { //æ„é€ å™¨ Sync(int count) { setState(count); } //è·å–å½“å‰åŒæ­¥çŠ¶æ€ int getCount() { return getState(); } //å°è¯•è·å–é” //è¿”å›è´Ÿæ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–å¤±è´¥ //è¿”å›é›¶å€¼ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸ, ä½†æ˜¯åç»§çº¿ç¨‹ä¸èƒ½å†è·å–äº† //è¿”å›æ­£æ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸ, å¹¶ä¸”åç»§çº¿ç¨‹åŒæ ·å¯ä»¥è·å–æˆåŠŸ protected int tryAcquireShared(int acquires) { return (getState() == 0) ? 1 : -1; } //å°è¯•é‡Šæ”¾é” protected boolean tryReleaseShared(int releases) { for (;;) { //è·å–åŒæ­¥çŠ¶æ€ int c = getState(); //å¦‚æœåŒæ­¥çŠ¶æ€ä¸º0, åˆ™ä¸èƒ½å†é‡Šæ”¾äº† if (c == 0) { return false; } //å¦åˆ™çš„è¯å°±å°†åŒæ­¥çŠ¶æ€å‡1 int nextc = c-1; //ä½¿ç”¨CASæ–¹å¼æ›´æ–°åŒæ­¥çŠ¶æ€ if (compareAndSetState(c, nextc)) { return nextc == 0; } } }} å¯ä»¥çœ‹åˆ°Syncçš„æ„é€ æ–¹æ³•ä¼šå°†åŒæ­¥çŠ¶æ€çš„å€¼è®¾ç½®ä¸ºä¼ å…¥çš„å‚æ•°å€¼ã€‚ä¹‹åæ¯æ¬¡è°ƒç”¨countDownæ–¹æ³•éƒ½ä¼šå°†åŒæ­¥çŠ¶æ€çš„å€¼å‡1ï¼Œè¿™ä¹Ÿå°±æ˜¯è®¡æ•°å™¨çš„å®ç°åŸç†ã€‚ åœ¨å¹³æ—¶ä½¿ç”¨CountDownLatchå·¥å…·ç±»æ—¶æœ€å¸¸ç”¨çš„ä¸¤ä¸ªæ–¹æ³•å°±æ˜¯awaitæ–¹æ³•å’ŒcountDownæ–¹æ³•ã€‚è°ƒç”¨awaitæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°è®¡æ•°å™¨ä¸º0ï¼Œè°ƒç”¨countDownæ–¹æ³•ä¼šå°†è®¡æ•°å™¨çš„å€¼å‡1ç›´åˆ°å‡ä¸º0ã€‚ é˜»å¡çº¿ç¨‹await 123456789101112131415161718//å¯¼è‡´å½“å‰çº¿ç¨‹ç­‰å¾…, ç›´åˆ°stateå‡å°‘åˆ°0, æˆ–è€…çº¿ç¨‹è¢«æ‰“æ–­public void await() throws InterruptedException { //ä»¥å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼è·å– sync.acquireSharedInterruptibly(1);}//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException { //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //1.å°è¯•å»è·å–é” if (tryAcquireShared(arg) &lt; 0) { //2. å¦‚æœè·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); }} å½“çº¿ç¨‹è°ƒç”¨awaitæ–¹æ³•æ—¶å…¶å®æ˜¯è°ƒç”¨åˆ°äº†AQSçš„acquireSharedInterruptiblyæ–¹æ³•ï¼Œè¯¥æ–¹æ³•æ˜¯ä»¥å“åº”çº¿ç¨‹ä¸­æ–­çš„æ–¹å¼æ¥è·å–é”çš„ã€‚åœ¨acquireSharedInterruptiblyæ–¹æ³•é¦–å…ˆä¼šå»è°ƒç”¨tryAcquireSharedæ–¹æ³•å°è¯•è·å–é”ã€‚Syncé‡Œé¢é‡å†™çš„tryAcquireSharedæ–¹æ³•çš„é€»è¾‘ï¼Œæ–¹æ³•çš„å®ç°é€»è¾‘å¾ˆç®€å•ï¼Œå°±æ˜¯åˆ¤æ–­å½“å‰åŒæ­¥çŠ¶æ€æ˜¯å¦ä¸º0ï¼Œå¦‚æœä¸º0åˆ™è¿”å›1è¡¨æ˜å¯ä»¥è·å–é”ï¼Œå¦åˆ™è¿”å›-1è¡¨ç¤ºä¸èƒ½è·å–é”ã€‚å¦‚æœtryAcquireSharedæ–¹æ³•è¿”å›1åˆ™çº¿ç¨‹èƒ½å¤Ÿä¸å¿…ç­‰å¾…è€Œç»§ç»­æ‰§è¡Œï¼Œå¦‚æœè¿”å›-1é‚£ä¹ˆåç»­å°±ä¼šå»è°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•è®©çº¿ç¨‹è¿›å…¥åˆ°åŒæ­¥é˜Ÿåˆ—é‡Œé¢ç­‰å¾…ã€‚è¿™å°±æ˜¯è°ƒç”¨awaitæ–¹æ³•ä¼šé˜»å¡å½“å‰çº¿ç¨‹çš„åŸç†ã€‚ å”¤é†’çº¿ç¨‹countDown 123456789101112131415//å‡å°‘stateçš„æ–¹æ³•public void countDown() { sync.releaseShared(1);}//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) { //1.å°è¯•å»é‡Šæ”¾é” if (tryReleaseShared(arg)) { //2.å¦‚æœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; } return false;} countDownæ–¹æ³•é‡Œé¢è°ƒç”¨äº†releaseSharedæ–¹æ³•ï¼Œè¯¥æ–¹æ³•åŒæ ·æ˜¯AQSé‡Œé¢çš„æ–¹æ³•ã€‚releaseSharedæ–¹æ³•é‡Œé¢é¦–å…ˆæ˜¯è°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼ŒtryReleaseSharedæ–¹æ³•åœ¨AQSé‡Œé¢æ˜¯ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œå®ƒçš„å…·ä½“å®ç°é€»è¾‘åœ¨å­ç±»Syncç±»é‡Œé¢ï¼Œåœ¨ä¸Šé¢è´´å‡ºçš„Syncç±»ä»£ç é‡Œå¯ä»¥æ‰¾åˆ°è¯¥æ–¹æ³•ã€‚tryReleaseSharedæ–¹æ³•å¦‚æœè¿”å›trueè¡¨ç¤ºé‡Šæ”¾æˆåŠŸï¼Œè¿”å›falseè¡¨ç¤ºé‡Šæ”¾å¤±è´¥ï¼Œåªæœ‰å½“å°†åŒæ­¥çŠ¶æ€å‡1åè¯¥åŒæ­¥çŠ¶æ€æ°å¥½ä¸º0æ—¶æ‰ä¼šè¿”å›trueï¼Œå…¶ä»–æƒ…å†µéƒ½æ˜¯è¿”å›falseã€‚é‚£ä¹ˆå½“tryReleaseSharedè¿”å›trueä¹‹åå°±ä¼šé©¬ä¸Šè°ƒç”¨doReleaseSharedæ–¹æ³•å»å”¤é†’åŒæ­¥é˜Ÿåˆ—çš„æ‰€æœ‰çº¿ç¨‹ã€‚è¿™æ ·å°±è§£é‡Šäº†ä¸ºä»€ä¹ˆæœ€åä¸€æ¬¡è°ƒç”¨countDownæ–¹æ³•å°†è®¡æ•°å™¨å‡ä¸º0åå°±ä¼šå”¤é†’æ‰€æœ‰è¢«é˜»å¡çš„çº¿ç¨‹ã€‚ æ€»ç»“ CountDownLatchæ˜¯é€šè¿‡â€œå…±äº«é”â€å®ç°çš„ã€‚åœ¨åˆ›å»ºCountDownLatchä¸­æ—¶ï¼Œä¼šä¼ é€’ä¸€ä¸ªintç±»å‹å‚æ•°countï¼Œè¯¥å‚æ•°æ˜¯â€œé”è®¡æ•°å™¨â€çš„åˆå§‹çŠ¶æ€ï¼Œè¡¨ç¤ºè¯¥â€œå…±äº«é”â€æœ€å¤šèƒ½è¢«countä¸ªçº¿ç¨‹åŒæ—¶è·å–ã€‚å½“æŸçº¿ç¨‹è°ƒç”¨è¯¥CountDownLatchå¯¹è±¡çš„await()æ–¹æ³•æ—¶ï¼Œè¯¥çº¿ç¨‹ä¼šç­‰å¾…â€œå…±äº«é”â€å¯ç”¨æ—¶ï¼Œæ‰èƒ½è·å–â€œå…±äº«é”â€è¿›è€Œç»§ç»­è¿è¡Œã€‚è€Œâ€œå…±äº«é”â€å¯ç”¨çš„æ¡ä»¶ï¼Œå°±æ˜¯â€œé”è®¡æ•°å™¨â€çš„å€¼ä¸º0ï¼è€Œâ€œé”è®¡æ•°å™¨â€çš„åˆå§‹å€¼ä¸ºcountï¼Œæ¯å½“ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨è¯¥CountDownLatchå¯¹è±¡çš„countDown()æ–¹æ³•æ—¶ï¼Œæ‰å°†â€œé”è®¡æ•°å™¨â€-1ï¼›é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¿…é¡»æœ‰countä¸ªçº¿ç¨‹è°ƒç”¨countDown()ä¹‹åï¼Œâ€œé”è®¡æ•°å™¨â€æ‰ä¸º0ï¼Œè€Œå‰é¢æåˆ°çš„ç­‰å¾…çº¿ç¨‹æ‰èƒ½ç»§ç»­è¿è¡Œï¼ åº”ç”¨ç¤ºä¾‹ åœ¨ç©æ¬¢ä¹æ–—åœ°ä¸»æ—¶å¿…é¡»ç­‰å¾…ä¸‰ä¸ªç©å®¶éƒ½åˆ°é½æ‰å¯ä»¥è¿›è¡Œå‘ç‰Œã€‚ 123456789101112131415161718192021222324252627public class Player extends Thread { private static int count = 1; private final int id = count++; private CountDownLatch latch; public Player(CountDownLatch latch) { this.latch = latch; } @Override public void run() { System.out.println("ã€ç©å®¶" + id + "ã€‘å·²å…¥åœº"); latch.countDown(); } public static void main(String[] args) throws InterruptedException { CountDownLatch latch = new CountDownLatch(3); System.out.println("ç‰Œå±€å¼€å§‹, ç­‰å¾…ç©å®¶å…¥åœº..."); new Player(latch).start(); new Player(latch).start(); new Player(latch).start(); latch.await(); System.out.println("ç©å®¶å·²åˆ°é½, å¼€å§‹å‘ç‰Œ..."); } } è¿è¡Œç»“æœæ˜¾ç¤ºå‘ç‰Œæ“ä½œä¸€å®šæ˜¯åœ¨æ‰€æœ‰ç©å®¶éƒ½å…¥åœºåæ‰è¿›è¡Œã€‚å°†latch.await()æ³¨é‡Šæ‰ï¼Œå¯¹æ¯”ä¸‹çœ‹çœ‹ç»“æœã€‚ å¯ä»¥çœ‹åˆ°åœ¨æ³¨é‡Šæ‰latch.await()è¿™è¡Œä¹‹åï¼Œå°±ä¸èƒ½ä¿è¯åœ¨æ‰€æœ‰ç©å®¶å…¥åœºåæ‰å¼€å§‹å‘ç‰Œäº†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-Semaphore]]></title>
    <url>%2Fposts%2F44092bd5.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° Semaphore(ä¿¡å·é‡)æ˜¯AQSå…±äº«æ¨¡å¼çš„ä¸€ä¸ªåº”ç”¨ï¼Œå¯ä»¥å…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹å…±äº«èµ„æºè¿›è¡Œæ“ä½œï¼Œå¹¶ä¸”å¯ä»¥æœ‰æ•ˆçš„æ§åˆ¶å¹¶å‘æ•°ï¼Œåˆ©ç”¨å®ƒå¯ä»¥å¾ˆå¥½çš„å®ç°æµé‡æ§åˆ¶ã€‚ Semaphoreæä¾›äº†ä¸€ä¸ªè®¸å¯è¯çš„æ¦‚å¿µï¼Œå¯ä»¥æŠŠè¿™ä¸ªè®¸å¯è¯çœ‹ä½œè½¦ç¥¨ï¼Œåªæœ‰æˆåŠŸè·å–è½¦ç¥¨çš„äººæ‰èƒ½å¤Ÿä¸Šè½¦ï¼Œå¹¶ä¸”è½¦ç¥¨æ˜¯æœ‰æ•°é‡çš„ï¼Œä¸å¯èƒ½æ¯«æ— é™åˆ¶çš„å‘ä¸‹å»ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´è½¦è¾†è¶…è½½ã€‚æ‰€ä»¥å½“è½¦ç¥¨å‘å®Œçš„æ—¶å€™(è½¦è¾†æ»¡è½½)ï¼Œå…¶ä»–äººå°±åªèƒ½ç­‰ä¸‹ä¸€è¶Ÿè½¦ã€‚å¦‚æœä¸­é€”æœ‰äººä¸‹è½¦ï¼Œé‚£ä¹ˆä»–çš„ä½ç½®å°†ä¼šç©ºé—²å‡ºæ¥ï¼Œå› æ­¤å¦‚æœè¿™æ—¶å…¶ä»–äººæƒ³è¦ä¸Šè½¦çš„è¯å°±åˆå¯ä»¥è·å¾—è½¦ç¥¨äº†ã€‚ æ„é€ å™¨ 123456789//æ„é€ å™¨1public Semaphore(int permits) { sync = new NonfairSync(permits);}//æ„é€ å™¨2public Semaphore(int permits, boolean fair) { sync = fair ? new FairSync(permits) : new NonfairSync(permits);} Semaphoreæä¾›äº†ä¸¤ä¸ªå¸¦å‚æ„é€ å™¨ï¼Œæ²¡æœ‰æä¾›æ— å‚æ„é€ å™¨ã€‚è¿™ä¸¤ä¸ªæ„é€ å™¨éƒ½å¿…é¡»ä¼ å…¥ä¸€ä¸ªåˆå§‹çš„è®¸å¯è¯æ•°é‡ï¼Œä½¿ç”¨æ„é€ å™¨1æ„é€ å‡ºæ¥çš„ä¿¡å·é‡åœ¨è·å–è®¸å¯è¯æ—¶ä¼šé‡‡ç”¨éå…¬å¹³æ–¹å¼è·å–ï¼Œä½¿ç”¨æ„é€ å™¨2å¯ä»¥é€šè¿‡å‚æ•°æŒ‡å®šè·å–è®¸å¯è¯çš„æ–¹å¼(å…¬å¹³oréå…¬å¹³)ã€‚Semaphoreä¸»è¦å¯¹å¤–æä¾›äº†ä¸¤ç±»APIï¼Œè·å–è®¸å¯è¯å’Œé‡Šæ”¾è®¸å¯è¯ï¼Œé»˜è®¤çš„æ˜¯è·å–å’Œé‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥å‚æ•°æ¥åŒæ—¶è·å–å’Œé‡Šæ”¾å¤šä¸ªè®¸å¯è¯ã€‚ è·å–è®¸å¯è¯ 12345678910111213141516171819//è·å–ä¸€ä¸ªè®¸å¯è¯(å“åº”ä¸­æ–­)public void acquire() throws InterruptedException { sync.acquireSharedInterruptibly(1);}//è·å–ä¸€ä¸ªè®¸å¯è¯(ä¸å“åº”ä¸­æ–­)public void acquireUninterruptibly() { sync.acquireShared(1);}//å°è¯•è·å–è®¸å¯è¯(éå…¬å¹³è·å–)public boolean tryAcquire() { return sync.nonfairTryAcquireShared(1) &gt;= 0;}//å°è¯•è·å–è®¸å¯è¯(å®šæ—¶è·å–)public boolean tryAcquire(long timeout, TimeUnit unit) throws InterruptedException { return sync.tryAcquireSharedNanos(1, unit.toNanos(timeout));} ä¸Šé¢çš„APIæ˜¯Semaphoreæä¾›çš„é»˜è®¤è·å–è®¸å¯è¯æ“ä½œã€‚æ¯æ¬¡åªè·å–ä¸€ä¸ªè®¸å¯è¯ã€‚é™¤äº†ç›´æ¥è·å–è¿˜æä¾›äº†å°è¯•è·å–ï¼Œç›´æ¥è·å–æ“ä½œåœ¨å¤±è´¥ä¹‹åå¯èƒ½ä¼šé˜»å¡çº¿ç¨‹ï¼Œè€Œå°è¯•è·å–åˆ™ä¸ä¼šã€‚å¦å¤–è¿˜éœ€æ³¨æ„çš„æ˜¯tryAcquireæ–¹æ³•æ˜¯ä½¿ç”¨éå…¬å¹³æ–¹å¼å°è¯•è·å–çš„ã€‚å¹³æ—¶æ¯”è¾ƒå¸¸ç”¨åˆ°çš„æ˜¯acquireæ–¹æ³•å»è·å–è®¸å¯è¯ã€‚acquireæ–¹æ³•é‡Œé¢ç›´æ¥å°±æ˜¯è°ƒç”¨sync.acquireSharedInterruptibly(1)ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯AQSé‡Œé¢çš„æ–¹æ³•ï¼Œä¸‹é¢å†æ¥å›é¡¾ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚ 123456789101112//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException { //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //1.å°è¯•å»è·å–é”ï¼Œè·å–æˆåŠŸç›´æ¥è¿”å› if (tryAcquireShared(arg) &lt; 0) { //2. å¦‚æœè·å–å¤±è´¥åˆ™è¿›å…¥è¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); }} acquireSharedInterruptiblyæ–¹æ³•é¦–å…ˆå°±æ˜¯å»è°ƒç”¨tryAcquireSharedæ–¹æ³•å»å°è¯•è·å–ï¼ŒtryAcquireSharedåœ¨AQSé‡Œé¢æ˜¯æŠ½è±¡æ–¹æ³•ï¼ŒFairSyncå’ŒNonfairSyncè¿™ä¸¤ä¸ªæ´¾ç”Ÿç±»å®ç°äº†è¯¥æ–¹æ³•çš„é€»è¾‘ã€‚FairSyncå®ç°çš„æ˜¯å…¬å¹³è·å–çš„é€»è¾‘ï¼Œè€ŒNonfairSyncå®ç°çš„éå…¬å¹³è·å–çš„é€»è¾‘ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859abstract static class Sync extends AbstractQueuedSynchronizer { //éå…¬å¹³æ–¹å¼å°è¯•è·å– final int nonfairTryAcquireShared(int acquires) { for (;;) { //è·å–å¯ç”¨è®¸å¯è¯ int available = getState(); //è·å–å‰©ä½™è®¸å¯è¯ int remaining = available - acquires; //1.å¦‚æœremainingå°äº0åˆ™ç›´æ¥è¿”å›remaining //2.å¦‚æœremainingå¤§äº0åˆ™å…ˆæ›´æ–°åŒæ­¥çŠ¶æ€å†è¿”å›remaining if (remaining &lt; 0 || compareAndSetState(available, remaining)) { return remaining; } } }}//éå…¬å¹³åŒæ­¥å™¨static final class NonfairSync extends Sync { private static final long serialVersionUID = -2694183684443567898L; NonfairSync(int permits) { super(permits); } //å°è¯•è·å–è®¸å¯è¯ protected int tryAcquireShared(int acquires) { return nonfairTryAcquireShared(acquires); }}//å…¬å¹³åŒæ­¥å™¨static final class FairSync extends Sync { private static final long serialVersionUID = 2014338818796000944L; FairSync(int permits) { super(permits); } //å°è¯•è·å–è®¸å¯è¯ protected int tryAcquireShared(int acquires) { for (;;) { //åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—å‰é¢æœ‰æ²¡æœ‰äººæ’é˜Ÿ if (hasQueuedPredecessors()) { //å¦‚æœæœ‰çš„è¯å°±ç›´æ¥è¿”å›-1ï¼Œè¡¨ç¤ºå°è¯•è·å–å¤±è´¥ return -1; } //è·å–å¯ç”¨è®¸å¯è¯ int available = getState(); //è·å–å‰©ä½™è®¸å¯è¯ int remaining = available - acquires; //1.å¦‚æœremainingå°äº0åˆ™ç›´æ¥è¿”å›remaining //2.å¦‚æœremainingå¤§äº0åˆ™å…ˆæ›´æ–°åŒæ­¥çŠ¶æ€å†è¿”å›remaining if (remaining &lt; 0 || compareAndSetState(available, remaining)) { return remaining; } } }} NonfairSyncçš„tryAcquireSharedæ–¹æ³•ç›´æ¥è°ƒç”¨çš„æ˜¯nonfairTryAcquireSharedæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯åœ¨çˆ¶ç±»Syncé‡Œé¢çš„ã€‚éå…¬å¹³è·å–é”çš„é€»è¾‘æ˜¯å…ˆå–å‡ºå½“å‰åŒæ­¥çŠ¶æ€(åŒæ­¥çŠ¶æ€è¡¨ç¤ºè®¸å¯è¯ä¸ªæ•°)ï¼Œå°†å½“å‰åŒæ­¥çŠ¶æ€å‡å»ä¼ å…¥çš„å‚æ•°ï¼Œå¦‚æœç»“æœä¸å°äº0çš„è¯è¯æ˜è¿˜æœ‰å¯ç”¨çš„è®¸å¯è¯ï¼Œé‚£ä¹ˆå°±ç›´æ¥ä½¿ç”¨CASæ“ä½œæ›´æ–°åŒæ­¥çŠ¶æ€çš„å€¼ï¼Œæœ€åä¸ç®¡ç»“æœæ˜¯å¦å°äº0éƒ½ä¼šè¿”å›è¯¥ç»“æœå€¼ã€‚è¿™é‡Œè¦äº†è§£tryAcquireSharedæ–¹æ³•è¿”å›å€¼çš„å«ä¹‰ï¼Œè¿”å›è´Ÿæ•°è¡¨ç¤ºè·å–å¤±è´¥ï¼Œé›¶è¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸä½†åç»­çº¿ç¨‹ä¸èƒ½å†è·å–ï¼Œæ­£æ•°è¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸå¹¶ä¸”åç»­çº¿ç¨‹ä¹Ÿèƒ½å¤Ÿè·å–ã€‚å†æ¥çœ‹çœ‹acquireSharedInterruptiblyæ–¹æ³•çš„ä»£ç ã€‚ 123456789101112131415//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException { //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //1.å°è¯•å»è·å–é” //è´Ÿæ•°ï¼šè¡¨ç¤ºè·å–å¤±è´¥ //é›¶å€¼ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸ, ä½†æ˜¯åç»§çº¿ç¨‹ä¸èƒ½å†è·å–äº† //æ­£æ•°ï¼šè¡¨ç¤ºå½“å‰çº¿ç¨‹è·å–æˆåŠŸ, å¹¶ä¸”åç»§çº¿ç¨‹åŒæ ·å¯ä»¥è·å–æˆåŠŸ if (tryAcquireShared(arg) &lt; 0) { //2. å¦‚æœè·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); }} å¦‚æœè¿”å›çš„remainingå°äº0çš„è¯å°±ä»£è¡¨è·å–å¤±è´¥ï¼Œå› æ­¤tryAcquireShared(arg) &lt; 0å°±ä¸ºtrueï¼Œæ‰€ä»¥æ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯AQSçš„æ–¹æ³•ï¼Œå®ƒä¼šå°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ”¾å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œå¹¶ä¸”æœ‰å¯èƒ½æŒ‚èµ·çº¿ç¨‹ã€‚è¿™ä¹Ÿæ˜¯å½“remainingå°äº0æ—¶çº¿ç¨‹ä¼šæ’é˜Ÿé˜»å¡çš„åŸå› ã€‚è€Œå¦‚æœè¿”å›çš„remaining&gt;=0çš„è¯å°±ä»£è¡¨å½“å‰çº¿ç¨‹è·å–æˆåŠŸï¼Œå› æ­¤tryAcquireShared(arg) &lt; 0å°±ä¸ºflaseï¼Œæ‰€ä»¥å°±ä¸ä¼šå†å»è°ƒç”¨doAcquireSharedInterruptiblyæ–¹æ³•é˜»å¡å½“å‰çº¿ç¨‹äº†ã€‚ä»¥ä¸Šæ˜¯éå…¬å¹³è·å–çš„æ•´ä¸ªé€»è¾‘ï¼Œè€Œå…¬å¹³è·å–æ—¶ä»…ä»…æ˜¯åœ¨æ­¤ä¹‹å‰å…ˆå»è°ƒç”¨hasQueuedPredecessorsæ–¹æ³•åˆ¤æ–­åŒæ­¥é˜Ÿåˆ—æ˜¯å¦æœ‰äººåœ¨æ’é˜Ÿï¼Œå¦‚æœæœ‰çš„è¯å°±ç›´æ¥return -1è¡¨ç¤ºè·å–å¤±è´¥ï¼Œå¦åˆ™æ‰ç»§ç»­æ‰§è¡Œä¸‹é¢å’Œéå…¬å¹³è·å–ä¸€æ ·çš„æ­¥éª¤ã€‚ é‡Šæ”¾è®¸å¯ 1234//é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯public void release() { sync.releaseShared(1);} è°ƒç”¨releaseæ–¹æ³•æ˜¯é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ï¼Œå®ƒçš„æ“ä½œå¾ˆç®€å•ï¼Œå°±è°ƒç”¨äº†AQSçš„releaseSharedæ–¹æ³•ï¼Œä¸‹é¢æ¥çœ‹çœ‹è¿™ä¸ªæ–¹æ³•ã€‚ 12345678910//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) { //1.å°è¯•å»é‡Šæ”¾é” if (tryReleaseShared(arg)) { //2.å¦‚æœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; } return false;} AQSçš„releaseSharedæ–¹æ³•é¦–å…ˆè°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼Œè¿™ä¸ªæ–¹æ³•çš„å®ç°é€»è¾‘åœ¨å­ç±»Syncé‡Œé¢ã€‚Semaphoreé‡å†™äº†tryReleaseShared()ï¼Œå®ƒçš„æºç å¦‚ä¸‹ï¼š 12345678910111213protected final boolean tryReleaseShared(int releases) { for (;;) { // è·å–â€œå¯ä»¥è·å¾—çš„ä¿¡å·é‡çš„è®¸å¯æ•°â€ int current = getState(); // è·å–â€œé‡Šæ”¾releasesä¸ªä¿¡å·é‡è®¸å¯ä¹‹åï¼Œå‰©ä½™çš„ä¿¡å·é‡è®¸å¯æ•°â€ int next = current + releases; if (next &lt; current) // overflow throw new Error("Maximum permit count exceeded"); // è®¾ç½®â€œå¯ä»¥è·å¾—çš„ä¿¡å·é‡çš„è®¸å¯æ•°â€ä¸ºnextã€‚ if (compareAndSetState(current, next)) return true; }} tryReleaseSharedæ–¹æ³•é‡Œé¢é‡‡ç”¨forå¾ªç¯è¿›è¡Œè‡ªæ—‹ï¼Œé¦–å…ˆè·å–åŒæ­¥çŠ¶æ€ï¼Œå°†åŒæ­¥çŠ¶æ€åŠ ä¸Šä¼ å…¥çš„å‚æ•°ï¼Œç„¶åä»¥CASæ–¹å¼æ›´æ–°åŒæ­¥çŠ¶æ€ï¼Œæ›´æ–°æˆåŠŸå°±è¿”å›trueå¹¶è·³å‡ºæ–¹æ³•ï¼Œå¦åˆ™å°±ç»§ç»­å¾ªç¯ç›´åˆ°æˆåŠŸä¸ºæ­¢ã€‚ å¦‚æœtryReleaseShared()å°è¯•é‡Šæ”¾å…±äº«é”å¤±è´¥ï¼Œåˆ™ä¼šè°ƒç”¨doReleaseShared()å»é‡Šæ”¾å…±äº«é”ã€‚doReleaseShared()çš„æºç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526private void doReleaseShared() { for (;;) { // è·å–åŒæ­¥é˜Ÿåˆ—çš„å¤´èŠ‚ç‚¹ Node h = head; // å¦‚æœå¤´èŠ‚ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´èŠ‚ç‚¹ä¸ç­‰äºtailèŠ‚ç‚¹ã€‚ if (h != null &amp;&amp; h != tail) { // è·å–å¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çš„çŠ¶æ€ int ws = h.waitStatus; // å¦‚æœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯SIGNALçŠ¶æ€ï¼Œåˆ™æ„å‘³ç€â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€éœ€è¦è¢«unparkå”¤é†’ã€‚ if (ws == Node.SIGNAL) { // è®¾ç½®â€œå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹çŠ¶æ€â€ä¸ºç©ºçŠ¶æ€ã€‚å¤±è´¥çš„è¯ï¼Œåˆ™ç»§ç»­å¾ªç¯ã€‚ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) continue; // å”¤é†’â€œå¤´èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„çº¿ç¨‹â€ã€‚ unparkSuccessor(h); } // å¦‚æœå¤´èŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹æ˜¯ç©ºçŠ¶æ€ï¼Œåˆ™è®¾ç½®â€œæ–‡ä»¶ç‚¹å¯¹åº”çš„çº¿ç¨‹æ‰€æ‹¥æœ‰çš„å…±äº«é”â€ä¸ºå…¶å®ƒçº¿ç¨‹è·å–é”çš„ç©ºçŠ¶æ€ã€‚ else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) continue; // loop on failed CAS } // å¦‚æœå¤´èŠ‚ç‚¹å‘ç”Ÿå˜åŒ–ï¼Œåˆ™ç»§ç»­å¾ªç¯ã€‚å¦åˆ™ï¼Œé€€å‡ºå¾ªç¯ã€‚ if (h == head) // loop if head changed break; }} doReleaseShared()ä¼šé‡Šæ”¾â€œå…±äº«é”â€ã€‚å®ƒä¼šä»å‰å¾€åçš„éå†åŒæ­¥é˜Ÿåˆ—ï¼Œä¾æ¬¡â€œå”¤é†’â€ç„¶åâ€œæ‰§è¡Œâ€é˜Ÿåˆ—ä¸­æ¯ä¸ªèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ï¼›æœ€ç»ˆçš„ç›®çš„æ˜¯è®©è¿™äº›çº¿ç¨‹é‡Šæ”¾å®ƒä»¬æ‰€æŒæœ‰çš„ä¿¡å·é‡ã€‚ åº”ç”¨ç¤ºä¾‹ åˆ©ç”¨Semaphoreå®ç°æ•°æ®åº“è¿æ¥æ± ã€‚ è¿æ¥æ± ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118package main.java.com.study.lock.semaphore;import java.util.concurrent.Semaphore;import java.util.concurrent.TimeUnit;/** * @author: whb * @description: è¿æ¥æ±  */public class ConnectPool { /** * è¿æ¥æ± å¤§å° */ private int size; /** * è¿æ¥é›†åˆ */ private Connect[] connects; /** * è¿æ¥çŠ¶æ€æ ‡å¿— */ private boolean[] connectFlag; /** * å‰©ä½™å¯ç”¨è¿æ¥æ•° */ private volatile int available; /** * ä¿¡å·é‡ */ private Semaphore semaphore; public ConnectPool(int size) { this.size = size; this.available = size; semaphore = new Semaphore(size, true); connects = new Connect[size]; connectFlag = new boolean[size]; initConnects(); } /** * åˆå§‹åŒ–è¿æ¥ */ private void initConnects() { //ç”ŸæˆæŒ‡å®šæ•°é‡çš„è¿æ¥ for (int i = 0; i &lt; this.size; i++) { connects[i] = new Connect(); } } /** * è·å–è¿æ¥ */ private synchronized Connect getConnect() { for (int i = 0; i &lt; connectFlag.length; i++) { //éå†é›†åˆæ‰¾åˆ°æœªä½¿ç”¨çš„è¿æ¥ if (!connectFlag[i]) { //å°†è¿æ¥è®¾ç½®ä¸ºä½¿ç”¨ä¸­ connectFlag[i] = true; //å¯ç”¨è¿æ¥æ•°å‡ä¸€ available--; System.out.println("ã€" + Thread.currentThread().getName() + "ã€‘å·²è·å–è¿æ¥ï¼Œå‰©ä½™å¯ç”¨è¿æ¥ï¼š" + available); //è¿”å›è¿æ¥ return connects[i]; } } return null; } /** * æ‰“å¼€é“¾æ¥ * * @return */ public Connect openConnect() throws InterruptedException { //è·å–è®¸å¯ semaphore.acquire(); //è·å–è¿æ¥ return getConnect(); } /** * é‡Šæ”¾è¿æ¥ */ public synchronized void release(Connect connect) { for (int i = 0; i &lt; this.size; i++) { if (connect == connects[i]) { //å°†è¿æ¥è®¾ç½®ä¸ºæœªä½¿ç”¨ connectFlag[i] = false; //å¯ç”¨è¿æ¥åŠ ä¸€ available++; System.out.println("ã€" + Thread.currentThread().getName() + "ã€‘å·²é‡Šæ”¾è¿æ¥ï¼Œå‰©ä½™å¯ç”¨è¿æ¥ï¼š" + available); //é‡Šæ”¾è®¸å¯ semaphore.release(); } } }}class Connect { private static int count = 1; private int id = count++; public Connect() { //æ¨¡æ‹Ÿæ‰“å¼€ä¸€ä¸ªè¿æ¥å¾ˆè€—è´¹èµ„æºï¼Œéœ€è¦ç­‰å¾…1ç§’ try { TimeUnit.MILLISECONDS.sleep(1000); } catch (InterruptedException e) { e.printStackTrace(); } System.out.println("è¿æ¥#" + id + "#å·²ä¸æ•°æ®åº“å»ºç«‹é€šé“ï¼"); } @Override public String toString() { return "ã€" + id + "ã€‘"; }} æµ‹è¯•ä»£ç ï¼š 123456789101112131415161718192021222324252627package main.java.com.study.lock.semaphore;/** * @author: whb * @description: æµ‹è¯•è¿æ¥æ±  */public class TestConnectPool extends Thread { private static ConnectPool pool = new ConnectPool(3); @Override public void run() { try { Connect connect = pool.openConnect(); Thread.sleep(100); pool.release(connect); } catch (InterruptedException e) { e.printStackTrace(); } } public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { new TestConnectPool().start(); } }} æ‰§è¡Œç»“æœï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-CyclicBarrier]]></title>
    <url>%2Fposts%2F3a683baa.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ç°å®ç”Ÿæ´»ä¸­ç»å¸¸ä¼šé‡åˆ°è¿™æ ·çš„æƒ…æ™¯ï¼Œåœ¨è¿›è¡ŒæŸä¸ªæ´»åŠ¨å‰éœ€è¦ç­‰å¾…äººå…¨éƒ¨éƒ½é½äº†æ‰å¼€å§‹ã€‚ä¾‹å¦‚åƒé¥­æ—¶è¦ç­‰å…¨å®¶äººéƒ½ä¸Šåº§äº†æ‰åŠ¨ç­·å­ï¼Œæ—…æ¸¸æ—¶è¦ç­‰å…¨éƒ¨äººéƒ½åˆ°é½äº†æ‰å‡ºå‘ï¼Œæ¯”èµ›æ—¶è¦ç­‰è¿åŠ¨å‘˜éƒ½ä¸Šåœºåæ‰å¼€å§‹ã€‚åœ¨J.U.CåŒ…ä¸­æä¾›äº†ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»èƒ½å¤Ÿå¾ˆå¥½çš„æ¨¡æ‹Ÿè¿™ç±»åœºæ™¯ï¼Œå®ƒå°±æ˜¯CyclicBarrierç±»ã€‚åˆ©ç”¨CyclicBarrierç±»å¯ä»¥å®ç°ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå±éšœç‚¹åå†è¿›è¡Œåç»­çš„æ“ä½œã€‚ä¸‹å›¾æ¼”ç¤ºäº†è¿™ä¸€è¿‡ç¨‹ã€‚ æˆå‘˜å˜é‡ åœ¨CyclicBarrierç±»çš„å†…éƒ¨æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨åˆ°è¾¾å±éšœç‚¹çš„æ—¶å€™éƒ½ä¼šè°ƒç”¨awaitæ–¹æ³•å°†è‡ªå·±é˜»å¡ï¼Œæ­¤æ—¶è®¡æ•°å™¨ä¼šå‡1ï¼Œå½“è®¡æ•°å™¨å‡ä¸º0çš„æ—¶å€™æ‰€æœ‰å› è°ƒç”¨awaitæ–¹æ³•è€Œè¢«é˜»å¡çš„çº¿ç¨‹å°†è¢«å”¤é†’ã€‚è¿™å°±æ˜¯å®ç°ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…çš„åŸç†ï¼Œä¸‹é¢çœ‹ä¸‹CyclicBarrieræœ‰å“ªäº›æˆå‘˜å˜é‡ã€‚ 1234567891011121314151617//åŒæ­¥æ“ä½œé”private final ReentrantLock lock = new ReentrantLock();//çº¿ç¨‹æ‹¦æˆªå™¨private final Condition trip = lock.newCondition();//æ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•°private final int parties;//æ¢ä»£å‰æ‰§è¡Œçš„ä»»åŠ¡private final Runnable barrierCommand;//è¡¨ç¤ºæ …æ çš„å½“å‰ä»£private Generation generation = new Generation();//è®¡æ•°å™¨private int count;//é™æ€å†…éƒ¨ç±»Generationprivate static class Generation { boolean broken = false;} CyclicBarrierå†…éƒ¨æ˜¯é€šè¿‡æ¡ä»¶é˜Ÿåˆ—tripæ¥å¯¹çº¿ç¨‹è¿›è¡Œé˜»å¡çš„ï¼Œå¹¶ä¸”å…¶å†…éƒ¨ç»´æŠ¤äº†ä¸¤ä¸ªintå‹çš„å˜é‡partieså’Œcountã€‚ partiesè¡¨ç¤ºæ¯æ¬¡æ‹¦æˆªçš„çº¿ç¨‹æ•°ï¼Œè¯¥å€¼åœ¨æ„é€ æ—¶è¿›è¡Œèµ‹å€¼ã€‚ countæ˜¯å†…éƒ¨è®¡æ•°å™¨ï¼Œå®ƒçš„åˆå§‹å€¼å’Œpartiesç›¸åŒï¼Œä»¥åéšç€æ¯æ¬¡awaitæ–¹æ³•çš„è°ƒç”¨è€Œå‡1ï¼Œç›´åˆ°å‡ä¸º0å°±å°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ã€‚ CyclicBarrieræœ‰ä¸€ä¸ªé™æ€å†…éƒ¨ç±»Generationï¼Œè¯¥ç±»çš„å¯¹è±¡ä»£è¡¨æ …æ çš„å½“å‰ä»£ï¼Œå°±åƒç©æ¸¸æˆæ—¶ä»£è¡¨çš„æœ¬å±€æ¸¸æˆï¼Œåˆ©ç”¨å®ƒå¯ä»¥å®ç°å¾ªç¯ç­‰å¾…ã€‚ barrierCommandè¡¨ç¤ºæ¢ä»£å‰æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå½“countå‡ä¸º0æ—¶è¡¨ç¤ºæœ¬å±€æ¸¸æˆç»“æŸï¼Œéœ€è¦è½¬åˆ°ä¸‹ä¸€å±€ã€‚åœ¨è½¬åˆ°ä¸‹ä¸€å±€æ¸¸æˆä¹‹å‰ä¼šå°†æ‰€æœ‰é˜»å¡çš„çº¿ç¨‹å”¤é†’ï¼Œåœ¨å”¤é†’æ‰€æœ‰çº¿ç¨‹ä¹‹å‰ä½ å¯ä»¥é€šè¿‡æŒ‡å®šbarrierCommandæ¥æ‰§è¡Œè‡ªå·±çš„ä»»åŠ¡ã€‚ æ„é€ å™¨ 123456789101112131415//æ„é€ å™¨1public CyclicBarrier(int parties, Runnable barrierAction) { if (parties &lt;= 0) throw new IllegalArgumentException(); // partiesè¡¨ç¤ºâ€œå¿…é¡»åŒæ—¶åˆ°è¾¾barrierçš„çº¿ç¨‹ä¸ªæ•°â€ã€‚ this.parties = parties; // countè¡¨ç¤ºâ€œå¤„åœ¨ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹ä¸ªæ•°â€ã€‚ this.count = parties; // barrierCommandè¡¨ç¤ºâ€œpartiesä¸ªçº¿ç¨‹åˆ°è¾¾barrieræ—¶ï¼Œä¼šæ‰§è¡Œçš„åŠ¨ä½œâ€ã€‚ this.barrierCommand = barrierAction;}//æ„é€ å™¨2public CyclicBarrier(int parties) { this(parties, null);} CyclicBarrieræœ‰ä¸¤ä¸ªæ„é€ å™¨ï¼Œå…¶ä¸­æ„é€ å™¨1æ˜¯å®ƒçš„æ ¸å¿ƒæ„é€ å™¨ï¼Œåœ¨è¿™é‡Œå¯ä»¥æŒ‡å®šè¦æ‹¦æˆªçš„çº¿ç¨‹æ•°ä»¥åŠç»“æŸæ—¶è¦æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿˜å¯ä»¥çœ‹åˆ°è®¡æ•°å™¨countçš„åˆå§‹å€¼è¢«è®¾ç½®ä¸ºpartiesã€‚ ç­‰å¾…æ–¹æ³• 12345678910111213//éå®šæ—¶ç­‰å¾…public int await() throws InterruptedException, BrokenBarrierException { try { return dowait(false, 0L); } catch (TimeoutException toe) { throw new Error(toe); }}//å®šæ—¶ç­‰å¾…public int await(long timeout, TimeUnit unit) throws InterruptedException, BrokenBarrierException, TimeoutException { return dowait(true, unit.toNanos(timeout));} ä¸ç®¡æ˜¯å®šæ—¶ç­‰å¾…è¿˜æ˜¯éå®šæ—¶ç­‰å¾…ï¼Œå®ƒä»¬éƒ½è°ƒç”¨äº†dowaitæ–¹æ³•ï¼Œåªä¸è¿‡æ˜¯ä¼ å…¥çš„å‚æ•°ä¸åŒè€Œå·²ã€‚ä¸‹é¢çœ‹ä¸‹dowaitæ–¹æ³•éƒ½åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081//æ ¸å¿ƒç­‰å¾…æ–¹æ³•private int dowait(boolean timed, long nanos) throws InterruptedException, BrokenBarrierException, TimeoutException { final ReentrantLock lock = this.lock; //è·å–ç‹¬å é” lock.lock(); try { //ä¿å­˜å½“å‰çš„generation final Generation g = generation; //æ£€æŸ¥å½“å‰æ …æ æ˜¯å¦è¢«æ‰“ç¿» if (g.broken) { throw new BrokenBarrierException(); } //æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­ if (Thread.interrupted()) { //å¦‚æœå½“å‰çº¿ç¨‹è¢«ä¸­æ–­ä¼šåšä»¥ä¸‹ä¸‰ä»¶äº‹ //1.æ‰“ç¿»å½“å‰æ …æ  //2.å”¤é†’æ‹¦æˆªçš„æ‰€æœ‰çº¿ç¨‹ //3.æŠ›å‡ºä¸­æ–­å¼‚å¸¸ breakBarrier(); throw new InterruptedException(); } //æ¯æ¬¡éƒ½å°†è®¡æ•°å™¨çš„å€¼å‡1 int index = --count; //è®¡æ•°å™¨çš„å€¼å‡ä¸º0åˆ™éœ€å”¤é†’æ‰€æœ‰çº¿ç¨‹å¹¶è½¬æ¢åˆ°ä¸‹ä¸€ä»£ if (index == 0) { boolean ranAction = false; try { //å”¤é†’æ‰€æœ‰çº¿ç¨‹å‰å…ˆæ‰§è¡ŒæŒ‡å®šçš„ä»»åŠ¡ final Runnable command = barrierCommand; if (command != null) { command.run(); } ranAction = true; //å”¤é†’æ‰€æœ‰çº¿ç¨‹å¹¶è½¬åˆ°ä¸‹ä¸€ä»£ nextGeneration(); return 0; } finally { //ç¡®ä¿åœ¨ä»»åŠ¡æœªæˆåŠŸæ‰§è¡Œæ—¶èƒ½å°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ if (!ranAction) { breakBarrier(); } } } //å½“å‰çº¿ç¨‹ä¸€ç›´é˜»å¡ï¼Œç›´åˆ°â€œæœ‰partiesä¸ªçº¿ç¨‹åˆ°è¾¾barrierâ€ æˆ– â€œå½“å‰çº¿ç¨‹è¢«ä¸­æ–­â€ æˆ– â€œè¶…æ—¶â€è¿™3è€…ä¹‹ä¸€å‘ç”Ÿï¼Œå½“å‰çº¿ç¨‹æ‰ç»§ç»­æ‰§è¡Œã€‚ for (;;) { try { //æ ¹æ®ä¼ å…¥çš„å‚æ•°æ¥å†³å®šæ˜¯å®šæ—¶ç­‰å¾…è¿˜æ˜¯éå®šæ—¶ç­‰å¾… if (!timed) { trip.await(); }else if (nanos &gt; 0L) { nanos = trip.awaitNanos(nanos); } } catch (InterruptedException ie) { //è‹¥å½“å‰çº¿ç¨‹åœ¨ç­‰å¾…æœŸé—´è¢«ä¸­æ–­åˆ™æ‰“ç¿»æ …æ å”¤é†’å…¶ä»–çº¿ç¨‹ if (g == generation &amp;&amp; ! g.broken) { breakBarrier(); throw ie; } else { //è‹¥åœ¨æ•è·ä¸­æ–­å¼‚å¸¸å‰å·²ç»å®Œæˆåœ¨æ …æ ä¸Šçš„ç­‰å¾…, åˆ™ç›´æ¥è°ƒç”¨ä¸­æ–­æ“ä½œ Thread.currentThread().interrupt(); } } //å¦‚æœçº¿ç¨‹å› ä¸ºæ‰“ç¿»æ …æ æ“ä½œè€Œè¢«å”¤é†’åˆ™æŠ›å‡ºå¼‚å¸¸ if (g.broken) { throw new BrokenBarrierException(); } //å¦‚æœçº¿ç¨‹å› ä¸ºæ¢ä»£æ“ä½œè€Œè¢«å”¤é†’åˆ™è¿”å›è®¡æ•°å™¨çš„å€¼ if (g != generation) { return index; } //å¦‚æœçº¿ç¨‹å› ä¸ºæ—¶é—´åˆ°äº†è€Œè¢«å”¤é†’åˆ™æ‰“ç¿»æ …æ å¹¶æŠ›å‡ºå¼‚å¸¸ if (timed &amp;&amp; nanos &lt;= 0L) { breakBarrier(); throw new TimeoutException(); } } } finally { lock.unlock(); }} åœ¨dowaitæ–¹æ³•ä¸­æ¯æ¬¡éƒ½å°†countå‡1ï¼Œå‡å®Œåç«‹é©¬è¿›è¡Œåˆ¤æ–­çœ‹çœ‹æ˜¯å¦ç­‰äº0ï¼Œå¦‚æœç­‰äº0çš„è¯å°±ä¼šå…ˆå»æ‰§è¡Œä¹‹å‰æŒ‡å®šå¥½çš„ä»»åŠ¡ï¼Œæ‰§è¡Œå®Œä¹‹åå†è°ƒç”¨nextGenerationæ–¹æ³•å°†æ …æ è½¬åˆ°ä¸‹ä¸€ä»£ï¼Œåœ¨è¯¥æ–¹æ³•ä¸­ä¼šå°†æ‰€æœ‰çº¿ç¨‹å”¤é†’ï¼Œå°†è®¡æ•°å™¨çš„å€¼é‡æ–°è®¾ä¸ºpartiesï¼Œæœ€åä¼šé‡æ–°è®¾ç½®æ …æ ä»£æ¬¡ï¼Œåœ¨æ‰§è¡Œå®ŒnextGenerationæ–¹æ³•ä¹‹åå°±æ„å‘³ç€æ¸¸æˆè¿›å…¥ä¸‹ä¸€å±€ã€‚å¦‚æœè®¡æ•°å™¨æ­¤æ—¶è¿˜ä¸ç­‰äº0çš„è¯å°±è¿›å…¥forå¾ªç¯ï¼Œæ ¹æ®å‚æ•°æ¥å†³å®šæ˜¯è°ƒç”¨trip.awaitNanos(nanos)è¿˜æ˜¯trip.await()æ–¹æ³•ï¼Œè¿™ä¸¤æ–¹æ³•å¯¹åº”ç€å®šæ—¶å’Œéå®šæ—¶ç­‰å¾…ã€‚å¦‚æœåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­å½“å‰çº¿ç¨‹è¢«ä¸­æ–­å°±ä¼šæ‰§è¡ŒbreakBarrieræ–¹æ³•ï¼Œè¯¥æ–¹æ³•å«åšæ‰“ç ´æ …æ ï¼Œæ„å‘³ç€æ¸¸æˆåœ¨ä¸­é€”è¢«ææ–­ï¼Œè®¾ç½®generationçš„brokençŠ¶æ€ä¸ºtrueå¹¶å”¤é†’æ‰€æœ‰çº¿ç¨‹ã€‚åŒæ—¶è¿™ä¹Ÿè¯´æ˜åœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹è¢«ä¸­æ–­æ•´ç›˜æ¸¸æˆå°±ç»“æŸï¼Œæ‰€æœ‰ä¹‹å‰è¢«é˜»å¡çš„çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚çº¿ç¨‹é†’æ¥åä¼šæ‰§è¡Œä¸‹é¢ä¸‰ä¸ªåˆ¤æ–­ï¼Œçœ‹çœ‹æ˜¯å¦å› ä¸ºè°ƒç”¨breakBarrieræ–¹æ³•è€Œè¢«å”¤é†’ï¼Œå¦‚æœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ï¼›çœ‹çœ‹æ˜¯å¦æ˜¯æ­£å¸¸çš„æ¢ä»£æ“ä½œè€Œè¢«å”¤é†’ï¼Œå¦‚æœæ˜¯åˆ™è¿”å›è®¡æ•°å™¨çš„å€¼ï¼›çœ‹çœ‹æ˜¯å¦å› ä¸ºè¶…æ—¶è€Œè¢«å”¤é†’ï¼Œå¦‚æœæ˜¯çš„è¯å°±è°ƒç”¨breakBarrieræ‰“ç ´æ …æ å¹¶æŠ›å‡ºå¼‚å¸¸ã€‚è¿™é‡Œè¿˜éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€ä¸ªçº¿ç¨‹å› ä¸ºç­‰å¾…è¶…æ—¶è€Œé€€å‡ºï¼Œé‚£ä¹ˆæ•´ç›˜æ¸¸æˆä¹Ÿä¼šç»“æŸï¼Œå…¶ä»–çº¿ç¨‹éƒ½ä¼šè¢«å”¤é†’ã€‚ä¸‹é¢è´´å‡ºnextGenerationæ–¹æ³•å’ŒbreakBarrieræ–¹æ³•çš„å…·ä½“ä»£ç ã€‚ 12345678910111213141516171819//åˆ‡æ¢æ …æ åˆ°ä¸‹ä¸€ä»£private void nextGeneration() { //å”¤é†’æ¡ä»¶é˜Ÿåˆ—æ‰€æœ‰çº¿ç¨‹ trip.signalAll(); //è®¾ç½®è®¡æ•°å™¨çš„å€¼ä¸ºéœ€è¦æ‹¦æˆªçš„çº¿ç¨‹æ•° count = parties; //é‡æ–°è®¾ç½®æ …æ ä»£æ¬¡ generation = new Generation();}//æ‰“ç¿»å½“å‰æ …æ private void breakBarrier() { //å°†å½“å‰æ …æ çŠ¶æ€è®¾ç½®ä¸ºæ‰“ç¿» generation.broken = true; //è®¾ç½®è®¡æ•°å™¨çš„å€¼ä¸ºéœ€è¦æ‹¦æˆªçš„çº¿ç¨‹æ•° count = parties; //å”¤é†’æ‰€æœ‰çº¿ç¨‹ trip.signalAll();} åº”ç”¨ç¤ºä¾‹ èµ›é©¬:é€šè¿‡åœ¨æ§åˆ¶å°ä¸åœçš„æ‰“å°å„èµ›é©¬çš„å½“å‰è½¨è¿¹ï¼Œä»¥è¾¾åˆ°åŠ¨æ€æ˜¾ç¤ºçš„æ•ˆæœã€‚æ•´åœºæ¯”èµ›æœ‰å¤šä¸ªè½®æ¬¡ï¼Œæ¯ä¸€è½®æ¬¡å„ä¸ªèµ›é©¬éƒ½ä¼šéšæœºèµ°ä¸Šå‡ æ­¥ç„¶åè°ƒç”¨awaitæ–¹æ³•è¿›è¡Œç­‰å¾…ï¼Œå½“æ‰€æœ‰èµ›é©¬èµ°å®Œä¸€è½®çš„æ—¶å€™å°†ä¼šæ‰§è¡Œä»»åŠ¡å°†æ‰€æœ‰èµ›é©¬çš„å½“å‰è½¨è¿¹æ‰“å°åˆ°æ§åˆ¶å°ä¸Šã€‚è¿™æ ·æ¯ä¸€è½®ä¸‹æ¥å„èµ›é©¬çš„è½¨è¿¹éƒ½åœ¨ä¸åœçš„å¢é•¿ï¼Œå½“å…¶ä¸­æŸä¸ªèµ›é©¬çš„è½¨è¿¹æœ€å…ˆå¢é•¿åˆ°æŒ‡å®šçš„å€¼çš„æ—¶å€™å°†ä¼šç»“æŸæ•´åœºæ¯”èµ›ï¼Œè¯¥èµ›é©¬æˆä¸ºæ•´åœºæ¯”èµ›çš„èƒœåˆ©è€…ï¼ç¨‹åºå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283class Horse implements Runnable { private static int counter = 0; private final int id = counter++; private int strides = 0; private static Random rand = new Random(47); private static CyclicBarrier barrier; public Horse(CyclicBarrier b) { barrier = b; } @Override public void run() { try { while(!Thread.interrupted()) { synchronized(this) { //èµ›é©¬æ¯æ¬¡éšæœºè·‘å‡ æ­¥ strides += rand.nextInt(3); } barrier.await(); } } catch(Exception e) { e.printStackTrace(); } } public String tracks() { StringBuilder s = new StringBuilder(); for(int i = 0; i &lt; getStrides(); i++) { s.append("*"); } s.append(id); return s.toString(); } public synchronized int getStrides() { return strides; } public String toString() { return "Horse " + id + " "; } }public class HorseRace implements Runnable { private static final int FINISH_LINE = 75; private static List&lt;Horse&gt; horses = new ArrayList&lt;Horse&gt;(); private static ExecutorService exec = Executors.newCachedThreadPool(); @Override public void run() { StringBuilder s = new StringBuilder(); //æ‰“å°èµ›é“è¾¹ç•Œ for(int i = 0; i &lt; FINISH_LINE; i++) { s.append("="); } System.out.println(s); //æ‰“å°èµ›é©¬è½¨è¿¹ for(Horse horse : horses) { System.out.println(horse.tracks()); } //åˆ¤æ–­æ˜¯å¦ç»“æŸ for(Horse horse : horses) { if(horse.getStrides() &gt;= FINISH_LINE) { System.out.println(horse + "won!"); exec.shutdownNow(); return; } } //ä¼‘æ¯æŒ‡å®šæ—¶é—´å†åˆ°ä¸‹ä¸€è½® try { TimeUnit.MILLISECONDS.sleep(200); } catch(InterruptedException e) { System.out.println("barrier-action sleep interrupted"); } } public static void main(String[] args) { CyclicBarrier barrier = new CyclicBarrier(7, new HorseRace()); for(int i = 0; i &lt; 7; i++) { Horse horse = new Horse(barrier); horses.add(horse); exec.execute(horse); } } } ç¨‹åºçš„è¿è¡Œç»“æœå¦‚ä¸‹ï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Hello World]]></title>
    <url>%2Fposts%2F4a17b156.html</url>
    <content type="text"><![CDATA[Welcome to Hexo! This is your very first post. Check documentation for more info. If you get any problems when using Hexo, you can find the answer in troubleshooting or you can ask me on GitHub. Quick Start Create a new post 1$ hexo new "My New Post" More info: Writing Run server 1$ hexo server More info: Server Generate static files 1$ hexo generate More info: Generating Deploy to remote sites 1$ hexo deploy More info: Deployment document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æä¹‹æ¡ä»¶é˜Ÿåˆ—]]></title>
    <url>%2Fposts%2F68b8bf54.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° é€šè¿‡ä¹‹å‰çš„åˆ†æï¼Œæ·±å…¥äº†è§£äº†AbstractQueuedSynchronizerçš„å†…éƒ¨ç»“æ„å’Œä¸€äº›è®¾è®¡ç†å¿µï¼ŒçŸ¥é“äº†AbstractQueuedSynchronizerå†…éƒ¨ç»´æŠ¤äº†ä¸€ä¸ªåŒæ­¥çŠ¶æ€å’Œä¸¤ä¸ªæ’é˜ŸåŒºï¼Œè¿™ä¸¤ä¸ªæ’é˜ŸåŒºåˆ†åˆ«æ˜¯åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ã€‚ æ‹¿ATMæœºå–æ¬¾ä¸¾ä¾‹ï¼ŒATMæœºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸»è¦çš„æ’é˜ŸåŒºï¼Œå¦‚æœATMæœºæ²¡å¼€æ”¾ï¼Œæ‰€æœ‰æƒ³è¦è¿›å…¥äººéƒ½å¾—åœ¨è¿™é‡Œæ’é˜Ÿã€‚è€Œæ¡ä»¶é˜Ÿåˆ—ä¸»è¦æ˜¯ä¸ºæ¡ä»¶ç­‰å¾…è®¾ç½®çš„ï¼Œæƒ³è±¡ä¸€ä¸‹å¦‚æœä¸€ä¸ªäººé€šè¿‡æ’é˜Ÿç»ˆäºæˆåŠŸè·å–é”è¿›å…¥äº†ATMæœºï¼Œä½†åœ¨å–æ¬¾ä¹‹å‰å‘ç°è‡ªå·±æ²¡å¸¦é“¶è¡Œå¡ï¼Œç¢°åˆ°è¿™ç§æƒ…å†µè™½ç„¶å¾ˆæ— å¥ˆï¼Œä½†æ˜¯å®ƒä¹Ÿå¿…é¡»æ¥å—è¿™ä¸ªäº‹å®ï¼Œè¿™æ—¶å®ƒåªå¥½ä¹–ä¹–çš„å‡ºå»å…ˆå‡†å¤‡å¥½é“¶è¡Œå¡(è¿›å…¥æ¡ä»¶é˜Ÿåˆ—ç­‰å¾…)ï¼Œå½“ç„¶åœ¨å‡ºå»ä¹‹å‰è¿˜å¾—æŠŠé”ç»™é‡Šæ”¾äº†å¥½è®©å…¶ä»–äººèƒ½å¤Ÿè¿›æ¥ï¼Œåœ¨å‡†å¤‡å¥½äº†é“¶è¡Œå¡(æ¡ä»¶æ»¡è¶³)ä¹‹åå®ƒåˆå¾—é‡æ–°å›åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å»æ’é˜Ÿã€‚å½“ç„¶è¿›å…¥æˆ¿é—´çš„äººå¹¶ä¸éƒ½æ˜¯å› ä¸ºæ²¡å¸¦é“¶è¡Œå¡ï¼Œå¯èƒ½è¿˜æœ‰å…¶ä»–ä¸€äº›åŸå› å¿…é¡»ä¸­æ–­æ“ä½œå…ˆå»æ¡ä»¶é˜Ÿåˆ—ä¸­å»æ’é˜Ÿï¼Œæ‰€ä»¥æ¡ä»¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šä¸ªï¼Œä¾ä¸åŒçš„ç­‰å¾…æ¡ä»¶è€Œè®¾ç½®ä¸åŒçš„æ¡ä»¶é˜Ÿåˆ—ã€‚ åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—çš„åŒºåˆ«ï¼š åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ä¸ºheadï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„å¤´ç»“ç‚¹ä¸ºfirstWaiter; åŒæ­¥é˜Ÿåˆ—çš„å°¾ç»“ç‚¹ä¸ºtailï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„å°¾ç»“ç‚¹ä¸ºlastWaiter; åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹æ²¡æœ‰å’Œä»»ä½•çº¿ç¨‹ç»‘å®šï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„firstWaiterç»‘å®šäº†çº¿ç¨‹ã€‚ åŒæ­¥é˜Ÿåˆ—æ˜¯ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—æ˜¯ä¸€æ¡å•å‘é“¾è¡¨ã€‚ Conditionæ¥å£å®šä¹‰äº†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰æ“ä½œï¼ŒAbstractQueuedSynchronizerå†…éƒ¨çš„ConditionObjectç±»å®ç°äº†Conditionæ¥å£ï¼Œä¸‹é¢çœ‹çœ‹Conditionæ¥å£éƒ½å®šä¹‰äº†å“ªäº›æ“ä½œã€‚ 123456789101112131415161718192021222324public interface Condition { //å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… void await() throws InterruptedException; //ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… void awaitUninterruptibly(); //è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(ä¸è¿›è¡Œè‡ªæ—‹) long awaitNanos(long nanosTimeout) throws InterruptedException; //è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(è¿›è¡Œè‡ªæ—‹) boolean await(long time, TimeUnit unit) throws InterruptedException; //è®¾ç½®ç»å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾… boolean awaitUntil(Date deadline) throws InterruptedException; //å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ void signal(); //å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ void signalAll(); } Conditionæ¥å£è™½ç„¶å®šä¹‰äº†è¿™ä¹ˆå¤šæ–¹æ³•ï¼Œä½†æ€»å…±å°±åˆ†ä¸ºä¸¤ç±»ï¼Œä»¥awaitå¼€å¤´çš„æ˜¯çº¿ç¨‹è¿›å…¥æ¡ä»¶é˜Ÿåˆ—ç­‰å¾…çš„æ–¹æ³•ï¼Œä»¥signalå¼€å¤´çš„æ˜¯å°†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹â€œå”¤é†’â€çš„æ–¹æ³•ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè°ƒç”¨signalæ–¹æ³•å¯èƒ½å”¤é†’çº¿ç¨‹ä¹Ÿå¯èƒ½ä¸ä¼šå”¤é†’çº¿ç¨‹ï¼Œä»€ä¹ˆæ—¶å€™ä¼šå”¤é†’çº¿ç¨‹è¿™å¾—çœ‹æƒ…å†µï¼Œä½†æ˜¯è°ƒç”¨signalæ–¹æ³•ä¸€å®šä¼šå°†çº¿ç¨‹ä»æ¡ä»¶é˜Ÿåˆ—ä¸­ç§»åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚ awaitæ–¹æ³•åˆ†ä¸º5ç§ï¼Œåˆ†åˆ«æ˜¯å“åº”çº¿ç¨‹ä¸­æ–­ç­‰å¾…ï¼Œä¸å“åº”çº¿ç¨‹ä¸­æ–­ç­‰å¾…ï¼Œè®¾ç½®ç›¸å¯¹æ—¶é—´ä¸è‡ªæ—‹ç­‰å¾…ï¼Œè®¾ç½®ç›¸å¯¹æ—¶é—´è‡ªæ—‹ç­‰å¾…ï¼Œè®¾ç½®ç»å¯¹æ—¶é—´ç­‰å¾…ï¼› signalæ–¹æ³•åªæœ‰2ç§ï¼Œåˆ†åˆ«æ˜¯åªå”¤é†’æ¡ä»¶é˜Ÿåˆ—å¤´ç»“ç‚¹å’Œå”¤é†’æ¡ä»¶é˜Ÿåˆ—æ‰€æœ‰ç»“ç‚¹çš„æ“ä½œã€‚åŒä¸€ç±»çš„æ–¹æ³•åŸºæœ¬ä¸Šæ˜¯ç›¸é€šçš„ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… 123456789101112131415161718192021222324252627282930313233343536//å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…public final void await() throws InterruptedException { //å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //å°†å½“å‰çº¿ç¨‹åŒ…è£…ç§¤ç»“ç‚¹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); int interruptMode = 0; //çº¿ç¨‹ä¸€ç›´åœ¨whileå¾ªç¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹è¢«å”¤é†’æˆ–è€…çº¿ç¨‹è¢«ä¸­æ–­å¹¶ä¸”è¿›å…¥åŒæ­¥é˜Ÿåˆ—ä¸­ while (!isOnSyncQueue(node)) { //è¿›è¡Œæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ·, çº¿ç¨‹è¢«å”¤é†’çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š //1.åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆ //2.è®¾ç½®åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ //3.å‰é©±ç»“ç‚¹é‡Šæ”¾é”åå”¤é†’å½“å‰ç»“ç‚¹ LockSupport.park(this); //å½“å‰çº¿ç¨‹é†’æ¥åç«‹é©¬æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­, å¦‚æœæ˜¯åˆ™ä»£è¡¨ç»“ç‚¹å–æ¶ˆæ¡ä»¶ç­‰å¾…, æ­¤æ—¶éœ€è¦å°†ç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) { break; } } //çº¿ç¨‹é†’æ¥åå°±ä¼šä»¥ç‹¬å æ¨¡å¼è·å–é”ï¼Œå¦‚æœè·å–æ—¶å‘ç”Ÿäº†ä¸­æ–­ï¼Œå¦‚æœåœ¨è°ƒç”¨await()æ–¹æ³•æ—¶è¢«ä¸­æ–­ï¼Œåˆ™ä¾ç„¶æ˜¯THROW_IE if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) { interruptMode = REINTERRUPT; } //è¿™æ­¥æ“ä½œä¸»è¦ä¸ºé˜²æ­¢çº¿ç¨‹åœ¨signalä¹‹å‰ä¸­æ–­è€Œå¯¼è‡´æ²¡ä¸æ¡ä»¶é˜Ÿåˆ—æ–­ç»è”ç³» if (node.nextWaiter != null) { unlinkCancelledWaiters(); } //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) { reportInterruptAfterWait(interruptMode); }} ä¸Šè¿°ä»£ç æ•´ä¸ªæµç¨‹æ€»ç»“å¦‚ä¸‹ï¼š ç¬¬ä¸€æ­¥ï¼šé¦–å…ˆåˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œå¦‚æœè¢«ä¸­æ–­ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ²¡æœ‰è¢«ä¸­æ–­ï¼Œåˆ™ç»§ç»­ä¸‹é¢çš„æµç¨‹ã€‚ ç¬¬äºŒæ­¥ï¼šé€šè¿‡è°ƒç”¨addConditionWaiter()å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeèŠ‚ç‚¹å­˜æ”¾åˆ°Conditioné˜Ÿåˆ—çš„å°¾éƒ¨ã€‚ ç¬¬ä¸‰æ­¥ï¼šå› ä¸ºå½“å‰çº¿ç¨‹å·²ç»è·å–äº†é”ï¼Œæ‰€ä»¥è°ƒç”¨awaitéœ€è¦é‡Šæ”¾èµ„æºï¼Œæ‰€ä»¥é€šè¿‡è°ƒç”¨fullyRelease()é‡Šæ”¾èµ„æºï¼Œä¹Ÿå°±æ˜¯é‡Šæ”¾é”ï¼Œå› ä¸ºè¿™ä¸ªé”æ˜¯ç‹¬å é”å¹¶ä¸”å¯ä»¥é‡å…¥ï¼Œæ‰€ä»¥è¦å…¨éƒ¨æŠŠèµ„æºé‡Šæ”¾ï¼Œä»fullyå­—é¢ä¸Šä¹Ÿå¯ä»¥ç†è§£ã€‚ ç¬¬å››æ­¥ï¼šé€šè¿‡whileå¾ªç¯åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œå¦‚æœæ²¡æœ‰åœ¨åŒæ­¥é˜Ÿåˆ—ä¸Šï¼Œåˆ™éœ€è¦é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç„¶åè°ƒç”¨checkInterruptWaiting()æ–¹æ³•åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¦‚æœè¢«ä¸­æ–­è¿‡ï¼Œåˆ™è·³å‡ºwhileå¾ªç¯ã€‚ ç¬¬äº”æ­¥ï¼šé€šè¿‡è°ƒç”¨acquireQueued()æ–¹æ³•è·å–èµ„æºï¼Œå¦‚æœåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•æ—¶è¢«ä¸­æ–­ï¼Œåˆ™ä¸­æ–­ç±»å‹å˜æˆREINTERRUPT(ç¨åå¤„ç†ä¸­æ–­)ï¼Œè¿™ä¸ªæ–¹æ³•è¿”å›å€¼åªæ˜¯è®°å½•æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¹¶ä¸ä¼šå“åº”ä¸­æ–­ã€‚ ç¬¬å…­æ­¥ï¼šå¦‚æœæ˜¯å› ä¸ºä¸­æ–­ï¼Œæ­¤æ—¶waitStatus=0,ä½†æ˜¯æ­¤æ—¶å®ƒä»åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ï¼Œæ‰€ä»¥éœ€è¦ä»æ¡ä»¶é˜Ÿåˆ—ä¸­æ¸…é™¤ã€‚ ç¬¬ä¸ƒæ­¥ï¼šå¦‚æœè¢«ä¸­æ–­ï¼Œåˆ™è°ƒç”¨reportInterruptAfterWait()æ–¹æ³•å¤„ç†ä¸åŒçš„ä¸­æ–­ç±»å‹ã€‚ ç¬¬ä¸€æ­¥ï¼šå°†çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ— 1234567891011121314151617private Node addConditionWaiter() { //è·å–æ¡ä»¶é˜Ÿåˆ—å°¾ç»“ç‚¹ Node t = lastWaiter; // å¦‚æœå°¾ç»“ç‚¹è¢«å–æ¶ˆï¼Œåˆ™ä»æ¡ä»¶é˜Ÿåˆ—ä¸­æ¸…é™¤ if (t != null &amp;&amp; t.waitStatus != Node.CONDITION) { unlinkCancelledWaiters(); t = lastWaiter; } //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeç»“ç‚¹ï¼Œå¹¶ä¸”waitStatusçŠ¶æ€æ˜¯CONDITIONã€‚ Node node = new Node(Thread.currentThread(), Node.CONDITION); if (t == null) firstWaiter = node; else t.nextWaiter = node; lastWaiter = node; return node;} å°†å½“å‰çº¿ç¨‹å°è£…æˆNodeèŠ‚ç‚¹ï¼Œç„¶ååŠ å…¥åˆ°Conditionçš„å°¾éƒ¨ï¼Œåœ¨åŠ å…¥ä¹‹å‰éœ€è¦æ£€æŸ¥ä»¥ä¸‹å°¾éƒ¨èŠ‚ç‚¹tæ˜¯å¦è¿˜åœ¨ç­‰å¾…Conditionæ¡ä»¶ï¼Œå¦‚æœè¢«signalæˆ–è€…è¢«ä¸­æ–­ï¼Œåˆ™è°ƒç”¨æ¸…é™¤æ–¹æ³•å°†å°¾èŠ‚ç‚¹ä»Conditioné˜Ÿåˆ—ä¸­æ¸…é™¤æ‰ã€‚ ç¬¬äºŒæ­¥ï¼šå®Œå…¨å°†é”é‡Šæ”¾ 1234567891011121314151617181920212223//å®Œå…¨é‡Šæ”¾é”final int fullyRelease(Node node) { //åˆ¤æ–­èµ„æºæ˜¯å¦é‡Šæ”¾æˆåŠŸ boolean failed = true; try { //è·å–å½“å‰çš„åŒæ­¥çŠ¶æ€ int savedState = getState(); //ä½¿ç”¨å½“å‰çš„åŒæ­¥çŠ¶æ€å»é‡Šæ”¾é” if (release(savedState)) { failed = false; //å¦‚æœé‡Šæ”¾é”æˆåŠŸå°±è¿”å›å½“å‰åŒæ­¥çŠ¶æ€ return savedState; } else { //å¦‚æœé‡Šæ”¾é”å¤±è´¥å°±æŠ›å‡ºè¿è¡Œæ—¶å¼‚å¸¸ throw new IllegalMonitorStateException(); } } finally { //ä¿è¯æ²¡æœ‰æˆåŠŸé‡Šæ”¾é”å°±å°†è¯¥ç»“ç‚¹è®¾ç½®ä¸ºå–æ¶ˆçŠ¶æ€ if (failed) { node.waitStatus = Node.CANCELLED; } }} å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨åï¼Œç´§æ¥ç€å°±è°ƒç”¨fullyReleaseæ–¹æ³•é‡Šæ”¾é”ã€‚æ³¨æ„ï¼Œæ–¹æ³•åä¸ºfullyReleaseä¹Ÿå°±è¿™æ­¥æ“ä½œä¼šå®Œå…¨çš„é‡Šæ”¾é”ï¼Œå› ä¸ºé”æ˜¯å¯é‡å…¥çš„ï¼Œæ‰€ä»¥åœ¨è¿›è¡Œæ¡ä»¶ç­‰å¾…å‰éœ€è¦å°†é”å…¨éƒ¨é‡Šæ”¾äº†ï¼Œä¸ç„¶çš„è¯åˆ«äººå°±è·å–ä¸äº†é”äº†ã€‚å¦‚æœé‡Šæ”¾é”å¤±è´¥çš„è¯å°±ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶å¼‚å¸¸ï¼Œå¦‚æœæˆåŠŸé‡Šæ”¾äº†é”çš„è¯å°±è¿”å›ä¹‹å‰çš„åŒæ­¥çŠ¶æ€ã€‚ ç¬¬ä¸‰æ­¥ï¼šè¿›è¡Œæ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223242526272829303132333435363738//çº¿ç¨‹ä¸€ç›´åœ¨whileå¾ªç¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾…while (!isOnSyncQueue(node)) { //è¿›è¡Œæ¡ä»¶ç­‰å¾…çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ·, çº¿ç¨‹è¢«å”¤é†’çš„æƒ…å†µæœ‰ä»¥ä¸‹å‡ ç§ï¼š //1.åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆ //2.è®¾ç½®åŒæ­¥é˜Ÿåˆ—çš„å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ //3.å‰é©±ç»“ç‚¹é‡Šæ”¾é”åå”¤é†’å½“å‰ç»“ç‚¹ LockSupport.park(this); //å½“å‰çº¿ç¨‹é†’æ¥åç«‹é©¬æ£€æŸ¥æ˜¯å¦è¢«ä¸­æ–­, å¦‚æœæ˜¯åˆ™ä»£è¡¨ç»“ç‚¹å–æ¶ˆæ¡ä»¶ç­‰å¾…, æ­¤æ—¶éœ€è¦å°†ç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) { break; }}//æ£€æŸ¥æ¡ä»¶ç­‰å¾…æ—¶çš„çº¿ç¨‹ä¸­æ–­æƒ…å†µprivate static final int REINTERRUPT = 1;private static final int THROW_IE = -1;private int checkInterruptWhileWaiting(Node node) { //ä¸­æ–­è¯·æ±‚åœ¨signalæ“ä½œä¹‹å‰ï¼šTHROW_IE //ä¸­æ–­è¯·æ±‚åœ¨signalæ“ä½œä¹‹åï¼šREINTERRUPT //æœŸé—´æ²¡æœ‰æ”¶åˆ°ä»»ä½•ä¸­æ–­è¯·æ±‚ï¼š0 return Thread.interrupted() ? (transferAfterCancelledWait(node) ? THROW_IE : REINTERRUPT) : 0;}//å°†å–æ¶ˆæ¡ä»¶ç­‰å¾…çš„ç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­final boolean transferAfterCancelledWait(Node node) { //å¦‚æœè¿™æ­¥CASæ“ä½œæˆåŠŸçš„è¯å°±è¡¨æ˜ä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹å‰ if (compareAndSetWaitStatus(node, Node.CONDITION, 0)) { //çŠ¶æ€ä¿®æ”¹æˆåŠŸåå°±å°†è¯¥ç»“ç‚¹æ”¾å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ enq(node); return true; } //åˆ°è¿™é‡Œè¡¨æ˜CASæ“ä½œå¤±è´¥, è¯´æ˜ä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹å while (!isOnSyncQueue(node)) { //å¦‚æœsinalæ–¹æ³•è¿˜æ²¡æœ‰å°†ç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—, å°±é€šè¿‡è‡ªæ—‹ç­‰å¾…ä¸€ä¸‹ Thread.yield(); } return false;} åœ¨ä»¥ä¸Šä¸¤ä¸ªæ“ä½œå®Œæˆäº†ä¹‹åå°±ä¼šè¿›å…¥whileå¾ªç¯ï¼Œå¯ä»¥çœ‹åˆ°whileå¾ªç¯é‡Œé¢é¦–å…ˆè°ƒç”¨LockSupport.park(this)å°†çº¿ç¨‹æŒ‚èµ·äº†ï¼Œæ‰€ä»¥çº¿ç¨‹å°±ä¼šä¸€ç›´åœ¨è¿™é‡Œé˜»å¡ã€‚åœ¨è°ƒç”¨signalæ–¹æ³•åä»…ä»…åªæ˜¯å°†ç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å»ï¼Œè‡³äºä¼šä¸ä¼šå”¤é†’çº¿ç¨‹éœ€è¦çœ‹æƒ…å†µã€‚å¦‚æœè½¬ç§»ç»“ç‚¹æ—¶å‘ç°åŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±ç»“ç‚¹å·²å–æ¶ˆï¼Œæˆ–è€…æ˜¯æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALå¤±è´¥ï¼Œè¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šç«‹å³å”¤é†’çº¿ç¨‹ï¼Œå¦åˆ™çš„è¯åœ¨signalæ–¹æ³•ç»“æŸæ—¶å°±ä¸ä¼šå»å”¤é†’å·²åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰åˆ°å®ƒçš„å‰é©±ç»“ç‚¹æ¥å”¤é†’ã€‚å½“ç„¶ï¼Œçº¿ç¨‹é˜»å¡åœ¨è¿™é‡Œé™¤äº†å¯ä»¥è°ƒç”¨signalæ–¹æ³•å”¤é†’ä¹‹å¤–ï¼Œçº¿ç¨‹è¿˜å¯ä»¥å“åº”ä¸­æ–­ï¼Œå¦‚æœçº¿ç¨‹åœ¨è¿™é‡Œæ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±ä¼šç»§ç»­å¾€ä¸‹æ‰§è¡Œã€‚å¯ä»¥çœ‹åˆ°çº¿ç¨‹é†’æ¥åä¼šé©¬ä¸Šæ£€æŸ¥æ˜¯å¦æ˜¯ç”±äºä¸­æ–­å”¤é†’çš„è¿˜æ˜¯é€šè¿‡signalæ–¹æ³•å”¤é†’çš„ï¼Œå¦‚æœæ˜¯å› ä¸ºä¸­æ–­å”¤é†’çš„åŒæ ·ä¼šå°†è¿™ä¸ªç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å»ï¼Œåªä¸è¿‡æ˜¯é€šè¿‡è°ƒç”¨transferAfterCancelledWaitæ–¹æ³•æ¥å®ç°çš„ã€‚æœ€åæ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åå°±ä¼šè¿”å›ä¸­æ–­æƒ…å†µå¹¶è·³å‡ºwhileå¾ªç¯ã€‚ ç¬¬å››æ­¥ï¼šç»“ç‚¹ç§»å‡ºæ¡ä»¶é˜Ÿåˆ— 1234567891011121314151617181920212223//çº¿ç¨‹é†’æ¥åå°±ä¼šä»¥ç‹¬å æ¨¡å¼è·å–é”if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) { interruptMode = REINTERRUPT;}//è¿™æ­¥æ“ä½œä¸»è¦ä¸ºé˜²æ­¢çº¿ç¨‹åœ¨signalä¹‹å‰ä¸­æ–­è€Œå¯¼è‡´æ²¡ä¸æ¡ä»¶é˜Ÿåˆ—æ–­ç»è”ç³»if (node.nextWaiter != null) { unlinkCancelledWaiters();}//æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç†if (interruptMode != 0) { reportInterruptAfterWait(interruptMode);}//ç»“æŸæ¡ä»¶ç­‰å¾…åæ ¹æ®ä¸­æ–­æƒ…å†µåšå‡ºç›¸åº”å¤„ç†private void reportInterruptAfterWait(int interruptMode) throws InterruptedException { //å¦‚æœä¸­æ–­æ¨¡å¼æ˜¯THROW_IEå°±æŠ›å‡ºå¼‚å¸¸ if (interruptMode == THROW_IE) { throw new InterruptedException(); //å¦‚æœä¸­æ–­æ¨¡å¼æ˜¯REINTERRUPTå°±è‡ªå·±æŒ‚èµ· } else if (interruptMode == REINTERRUPT) { selfInterrupt(); }} å½“çº¿ç¨‹ç»ˆæ­¢äº†whileå¾ªç¯ä¹Ÿå°±æ˜¯æ¡ä»¶ç­‰å¾…åï¼Œå°±ä¼šå›åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ä¸ç®¡æ˜¯å› ä¸ºè°ƒç”¨signalæ–¹æ³•å›å»çš„è¿˜æ˜¯å› ä¸ºçº¿ç¨‹ä¸­æ–­å¯¼è‡´çš„ï¼Œç»“ç‚¹æœ€ç»ˆéƒ½ä¼šåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚è¿™æ—¶å°±ä¼šè°ƒç”¨acquireQueuedæ–¹æ³•æ‰§è¡Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è·å–é”çš„æ“ä½œã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—å‡ºæ¥ååˆæ˜¯ä¹–ä¹–çš„èµ°ç‹¬å æ¨¡å¼ä¸‹è·å–é”çš„é‚£ä¸€å¥—ï¼Œç­‰è¿™ä¸ªç»“ç‚¹å†æ¬¡è·å¾—é”ä¹‹åï¼Œå°±ä¼šè°ƒç”¨reportInterruptAfterWaitæ–¹æ³•æ¥æ ¹æ®è¿™æœŸé—´çš„ä¸­æ–­æƒ…å†µåšå‡ºç›¸åº”çš„å“åº”ã€‚å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹å‰ï¼ŒinterruptModeå°±ä¸ºTHROW_IEï¼Œå†æ¬¡è·å¾—é”åå°±æŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æœä¸­æ–­å‘ç”Ÿåœ¨signalæ–¹æ³•ä¹‹åï¼ŒinterruptModeå°±ä¸ºREINTERRUPTï¼Œå†æ¬¡è·å¾—é”åå°±é‡æ–°ä¸­æ–­ã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223//ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„æ¡ä»¶ç­‰å¾…public final void awaitUninterruptibly() { //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //å®Œå…¨é‡Šæ”¾é”å¹¶è¿”å›å½“å‰åŒæ­¥çŠ¶æ€ int savedState = fullyRelease(node); boolean interrupted = false; //ç»“ç‚¹ä¸€ç›´åœ¨whileå¾ªç¯é‡Œè¿›è¡Œæ¡ä»¶ç­‰å¾… while (!isOnSyncQueue(node)) { //æ¡ä»¶é˜Ÿåˆ—ä¸­æ‰€æœ‰çš„çº¿ç¨‹éƒ½åœ¨è¿™é‡Œè¢«æŒ‚èµ· LockSupport.park(this); //çº¿ç¨‹é†’æ¥å‘ç°ä¸­æ–­å¹¶ä¸ä¼šé©¬ä¸Šå»å“åº” if (Thread.interrupted()) { interrupted = true; } } if (acquireQueued(node, savedState) || interrupted) { //åœ¨è¿™é‡Œå“åº”æ‰€æœ‰ä¸­æ–­è¯·æ±‚, æ»¡è¶³ä»¥ä¸‹ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€å°±ä¼šå°†è‡ªå·±æŒ‚èµ· //1.çº¿ç¨‹åœ¨æ¡ä»¶ç­‰å¾…æ—¶æ”¶åˆ°ä¸­æ–­è¯·æ±‚ //2.çº¿ç¨‹åœ¨acquireQueuedæ–¹æ³•é‡Œæ”¶åˆ°ä¸­æ–­è¯·æ±‚ selfInterrupt(); }} è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(ä¸è¿›è¡Œè‡ªæ—‹) 123456789101112131415161718192021222324252627282930313233343536373839404142434445//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç›¸å¯¹æ—¶é—´), ä¸è¿›è¡Œè‡ªæ—‹ç­‰å¾…public final long awaitNanos(long nanosTimeout) throws InterruptedException { //å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); long lastTime = System.nanoTime(); int interruptMode = 0; while (!isOnSyncQueue(node)) { //åˆ¤æ–­è¶…æ—¶æ—¶é—´æ˜¯å¦ç”¨å®Œäº† if (nanosTimeout &lt;= 0L) { //å¦‚æœå·²è¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ transferAfterCancelledWait(node); break; } //å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, çº¿ç¨‹åœ¨è¿™æœŸé—´å¯èƒ½è¢«å”¤é†’, ä¹Ÿå¯èƒ½è‡ªå·±é†’æ¥ LockSupport.parkNanos(this, nanosTimeout); //çº¿ç¨‹é†’æ¥åå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) { break; } long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡å»æ¡ä»¶ç­‰å¾…çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; } //çº¿ç¨‹é†’æ¥åå°±ä¼šä»¥ç‹¬å æ¨¡å¼è·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) { interruptMode = REINTERRUPT; } //ç”±äºtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) { unlinkCancelledWaiters(); } //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) { reportInterruptAfterWait(interruptMode); } //è¿”å›å‰©ä½™æ—¶é—´ return nanosTimeout - (System.nanoTime() - lastTime);} è®¾ç½®ç›¸å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾…(è¿›è¡Œè‡ªæ—‹) 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç›¸å¯¹æ—¶é—´), è¿›è¡Œè‡ªæ—‹ç­‰å¾…public final boolean await(long time, TimeUnit unit) throws InterruptedException { if (unit == null) { throw new NullPointerException(); } //è·å–è¶…æ—¶æ—¶é—´çš„æ¯«ç§’æ•° long nanosTimeout = unit.toNanos(time); //å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //å°†å½“å‰çº¿ç¨‹æ·»åŠ æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); //è·å–å½“å‰æ—¶é—´çš„æ¯«ç§’æ•° long lastTime = System.nanoTime(); boolean timedout = false; int interruptMode = 0; while (!isOnSyncQueue(node)) { //å¦‚æœè¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ if (nanosTimeout &lt;= 0L) { timedout = transferAfterCancelledWait(node); break; } //å¦‚æœè¶…æ—¶æ—¶é—´å¤§äºè‡ªæ—‹æ—¶é—´, å°±å°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ if (nanosTimeout &gt;= spinForTimeoutThreshold) { LockSupport.parkNanos(this, nanosTimeout); } //çº¿ç¨‹é†’æ¥åå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) { break; } long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡å»æ¡ä»¶ç­‰å¾…çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; } //çº¿ç¨‹é†’æ¥åå°±ä¼šä»¥ç‹¬å æ¨¡å¼è·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) { interruptMode = REINTERRUPT; } //ç”±äºtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) { unlinkCancelledWaiters(); } //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) { reportInterruptAfterWait(interruptMode); } //è¿”å›æ˜¯å¦è¶…æ—¶æ ‡å¿— return !timedout;} è®¾ç½®ç»å¯¹æ—¶é—´çš„æ¡ä»¶ç­‰å¾… 1234567891011121314151617181920212223242526272829303132333435363738394041//è®¾ç½®å®šæ—¶æ¡ä»¶ç­‰å¾…(ç»å¯¹æ—¶é—´)public final boolean awaitUntil(Date deadline) throws InterruptedException { if (deadline == null) { throw new NullPointerException(); } //è·å–ç»å¯¹æ—¶é—´çš„æ¯«ç§’æ•° long abstime = deadline.getTime(); //å¦‚æœçº¿ç¨‹è¢«ä¸­æ–­åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //å°†å½“å‰çº¿ç¨‹æ·»åŠ åˆ°æ¡ä»¶é˜Ÿåˆ—å°¾éƒ¨ Node node = addConditionWaiter(); //åœ¨è¿›å…¥æ¡ä»¶ç­‰å¾…ä¹‹å‰å…ˆå®Œå…¨é‡Šæ”¾é” int savedState = fullyRelease(node); boolean timedout = false; int interruptMode = 0; while (!isOnSyncQueue(node)) { //å¦‚æœè¶…æ—¶å°±éœ€è¦æ‰§è¡Œå–æ¶ˆæ¡ä»¶ç­‰å¾…æ“ä½œ if (System.currentTimeMillis() &gt; abstime) { timedout = transferAfterCancelledWait(node); break; } //å°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, æœŸé—´çº¿ç¨‹å¯èƒ½è¢«å”¤é†’, ä¹Ÿå¯èƒ½åˆ°äº†ç‚¹è‡ªå·±é†’æ¥ LockSupport.parkUntil(this, abstime); //çº¿ç¨‹é†’æ¥åå…ˆæ£€æŸ¥ä¸­æ–­ä¿¡æ¯ if ((interruptMode = checkInterruptWhileWaiting(node)) != 0) { break; } } //çº¿ç¨‹é†’æ¥åå°±ä¼šä»¥ç‹¬å æ¨¡å¼è·å–é” if (acquireQueued(node, savedState) &amp;&amp; interruptMode != THROW_IE) { interruptMode = REINTERRUPT; } //ç”±äºtransferAfterCancelledWaitæ–¹æ³•æ²¡æœ‰æŠŠnextWaiterç½®ç©º, æ‰€æœ‰è¿™é‡Œè¦å†æ¸…ç†ä¸€é if (node.nextWaiter != null) { unlinkCancelledWaiters(); } //æ ¹æ®ä¸­æ–­æ¨¡å¼è¿›è¡Œå“åº”çš„ä¸­æ–­å¤„ç† if (interruptMode != 0) { reportInterruptAfterWait(interruptMode); } //è¿”å›æ˜¯å¦è¶…æ—¶æ ‡å¿— return !timedout;} å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748//å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ä¸‹ä¸€ä¸ªç»“ç‚¹public final void signal() { //åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦ç‹¬å æ¨¡å¼æŒæœ‰é”ï¼Œå¦‚æœä¸æ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (!isHeldExclusively()) { throw new IllegalMonitorStateException(); } //è·å–æ¡ä»¶é˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªç»“ç‚¹ Node first = firstWaiter; //å¦‚æœæ¡ä»¶é˜Ÿåˆ—ä¸­æœ‰æ’é˜Ÿè€… if (first != null) { //å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹ doSignal(first); }}//å”¤é†’æ¡ä»¶é˜Ÿåˆ—ä¸­çš„å¤´ç»“ç‚¹private void doSignal(Node first) { do { //1.å°†firstWaiterå¼•ç”¨å‘åç§»åŠ¨ä¸€ä½ if ( (firstWaiter = first.nextWaiter) == null) { lastWaiter = null; } //2.å°†å¤´ç»“ç‚¹çš„åç»§ç»“ç‚¹å¼•ç”¨ç½®ç©º first.nextWaiter = null; //3.å°†å¤´ç»“ç‚¹è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—, è½¬ç§»å®Œæˆåæœ‰å¯èƒ½å”¤é†’çº¿ç¨‹ //4.å¦‚æœtransferForSignalæ“ä½œå¤±è´¥å°±å»å”¤é†’ä¸‹ä¸€ä¸ªç»“ç‚¹ } while (!transferForSignal(first) &amp;&amp; (first = firstWaiter) != null);}//å°†æŒ‡å®šç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­final boolean transferForSignal(Node node) { //å°†ç­‰å¾…çŠ¶æ€ä»CONDITIONè®¾ç½®ä¸º0 if (!compareAndSetWaitStatus(node, Node.CONDITION, 0)) { //å¦‚æœæ›´æ–°çŠ¶æ€çš„æ“ä½œå¤±è´¥å°±ç›´æ¥è¿”å›false //å¯èƒ½æ˜¯transferAfterCancelledWaitæ–¹æ³•å…ˆå°†çŠ¶æ€æ”¹å˜äº†, å¯¼è‡´è¿™æ­¥CASæ“ä½œå¤±è´¥ return false; } //å°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ï¼Œè¿”å›å‰é©±ç»“ç‚¹ Node p = enq(node); int ws = p.waitStatus; if (ws &gt; 0 || !compareAndSetWaitStatus(p, ws, Node.SIGNAL)) { //å‡ºç°ä»¥ä¸‹æƒ…å†µå°±ä¼šå”¤é†’å½“å‰çº¿ç¨‹ //1.å‰é©±ç»“ç‚¹æ˜¯å–æ¶ˆçŠ¶æ€ //2.æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALæ“ä½œå¤±è´¥ LockSupport.unpark(node.thread); } return true;} å¯ä»¥çœ‹åˆ°signalæ–¹æ³•æœ€ç»ˆçš„æ ¸å¿ƒå°±æ˜¯å»è°ƒç”¨transferForSignalæ–¹æ³•ï¼Œåœ¨transferForSignalæ–¹æ³•ä¸­é¦–å…ˆä¼šç”¨CASæ“ä½œå°†ç»“ç‚¹çš„çŠ¶æ€ä»CONDITIONè®¾ç½®ä¸º0ï¼Œç„¶åå†è°ƒç”¨enqæ–¹æ³•å°†è¯¥ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚æˆ‘ä»¬å†çœ‹åˆ°æ¥ä¸‹æ¥çš„ifåˆ¤æ–­è¯­å¥ï¼Œè¿™ä¸ªåˆ¤æ–­è¯­å¥ä¸»è¦æ˜¯ç”¨æ¥åˆ¤æ–­ä»€ä¹ˆæ—¶å€™ä¼šå»å”¤é†’çº¿ç¨‹ï¼Œå‡ºç°è¿™ä¸¤ç§æƒ…å†µå°±ä¼šç«‹å³å”¤é†’çº¿ç¨‹ï¼Œä¸€ç§æ˜¯å½“å‘ç°å‰é©±ç»“ç‚¹çš„çŠ¶æ€æ˜¯å–æ¶ˆçŠ¶æ€æ—¶ï¼Œè¿˜æœ‰ä¸€ç§æ˜¯æ›´æ–°å‰é©±ç»“ç‚¹çš„çŠ¶æ€å¤±è´¥æ—¶ã€‚è¿™ä¸¤ç§æƒ…å†µéƒ½ä¼šé©¬ä¸Šå»å”¤é†’çº¿ç¨‹ï¼Œå¦åˆ™çš„è¯å°±ä»…ä»…åªæ˜¯å°†ç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—ä¸­è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­å°±å®Œäº†ï¼Œè€Œä¸ä¼šç«‹é©¬å»å”¤é†’ç»“ç‚¹ä¸­çš„çº¿ç¨‹ã€‚signalAllæ–¹æ³•ä¹Ÿå¤§è‡´ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒæ˜¯å»å¾ªç¯éå†æ¡ä»¶é˜Ÿåˆ—ä¸­çš„æ‰€æœ‰ç»“ç‚¹ï¼Œå¹¶å°†å®ƒä»¬è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œè½¬ç§»ç»“ç‚¹çš„æ–¹æ³•ä¹Ÿè¿˜æ˜¯è°ƒç”¨transferForSignalæ–¹æ³•ã€‚ å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ 1234567891011121314151617181920212223242526272829//å”¤é†’æ¡ä»¶é˜Ÿåˆ—åé¢çš„å…¨éƒ¨ç»“ç‚¹public final void signalAll() { //åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é” if (!isHeldExclusively()) { throw new IllegalMonitorStateException(); } //è·å–æ¡ä»¶é˜Ÿåˆ—å¤´ç»“ç‚¹ Node first = firstWaiter; if (first != null) { //å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹ doSignalAll(first); }}//å”¤é†’æ¡ä»¶é˜Ÿåˆ—çš„æ‰€æœ‰ç»“ç‚¹private void doSignalAll(Node first) { //å…ˆæŠŠå¤´ç»“ç‚¹å’Œå°¾ç»“ç‚¹çš„å¼•ç”¨ç½®ç©º lastWaiter = firstWaiter = null; do { //å…ˆè·å–åç»§ç»“ç‚¹çš„å¼•ç”¨ Node next = first.nextWaiter; //æŠŠå³å°†è½¬ç§»çš„ç»“ç‚¹çš„åç»§å¼•ç”¨ç½®ç©º first.nextWaiter = null; //å°†ç»“ç‚¹ä»æ¡ä»¶é˜Ÿåˆ—è½¬ç§»åˆ°åŒæ­¥é˜Ÿåˆ— transferForSignal(first); //å°†å¼•ç”¨æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ first = next; } while (first != null);} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æä¹‹ç‹¬å æ¨¡å¼]]></title>
    <url>%2Fposts%2Ff8b27f2e.html</url>
    <content type="text"><![CDATA[AQSä¸ºåœ¨ç‹¬å æ¨¡å¼ä¸‹è·å–é”åˆ†åˆ«æä¾›ä¸‰ç§è·å–æ–¹å¼ï¼š ä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–; å“åº”çº¿ç¨‹ä¸­æ–­è·å–; è®¾ç½®è¶…æ—¶æ—¶é—´è·å–ã€‚ è¿™ä¸‰ç§æ–¹å¼æ•´ä½“æ­¥éª¤å¤§è‡´æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†ä¸åŒçš„åœ°æ–¹ï¼š ç¬¬ä¸€ç§åœ¨è·å–æ—¶ä¼šå¿½ç•¥ä¸­æ–­; è€Œç¬¬äºŒç§åˆ™æ˜¯è·å–æ—¶å“åº”ä¸­æ–­; ç¬¬ä¸‰ç§æ˜¯è·å–æ—¶ï¼Œå¦‚æœè¶…æ—¶åˆ™ç«‹å³è¿”å›ã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–é” 123456//ä¸å“åº”ä¸­æ–­æ–¹å¼è·å–(ç‹¬å æ¨¡å¼)public final void acquire(int arg) { if (!tryAcquire(arg) &amp;&amp; acquireQueued(addWaiter(Node.EXCLUSIVE), arg)) { selfInterrupt(); }} acquireæ–¹æ³•æ˜¯è·å–é”çš„åŸºç¡€ï¼Œè¿™ä¸ªæ–¹æ³•ä¼šå¿½ç•¥ä¸­æ–­ï¼Œæ„æ€æ˜¯è¯´å¦‚æœèŠ‚ç‚¹å¯¹åº”çš„çº¿ç¨‹ä¸­æ–­ï¼Œåˆ™acquire()æ–¹æ³•ä¼šå¿½ç•¥ï¼Œåªæœ‰ä»åŒæ­¥é˜Ÿåˆ—ä¸­è¿”å›trueæ‰æœ€ç»ˆè°ƒç”¨selfInterruptæ–¹æ³•å“åº”ä¸­æ–­ã€‚ä»£ç å¾ˆç®€å•ï¼Œä½†æ˜¯å®ƒæŒ‰ç…§é¡ºåºæ‰§è¡Œäº†ä¸‹å›¾æ‰€ç¤ºçš„4ä¸ªæ­¥éª¤ã€‚ ç¬¬ä¸€æ­¥ï¼š!tryAcquire(arg) å°è¯•è·å–èµ„æºstate 1234//å°è¯•è·å–é”ï¼ˆç‹¬å æ¨¡å¼ï¼‰protected boolean tryAcquire(int arg) { throw new UnsupportedOperationException();} è¿™æ—¶å€™æ¥äº†ä¸€ä¸ªäººï¼Œä»–é¦–å…ˆå°è¯•ç€å»æ•²äº†æ•²é—¨ï¼Œå¦‚æœå‘ç°é—¨æ²¡é”(tryAcquire(arg)=true)ï¼Œé‚£å°±ç›´æ¥è¿›å»äº†ã€‚å¦‚æœå‘ç°é—¨é”äº†(tryAcquire(arg)=false)ï¼Œå°±æ‰§è¡Œä¸‹ä¸€æ­¥ã€‚è¿™ä¸ªtryAcquireæ–¹æ³•å†³å®šäº†ä»€ä¹ˆæ—¶å€™é”æ˜¯å¼€ç€çš„ï¼Œä»€ä¹ˆæ—¶å€™é”æ˜¯å…³é—­çš„ã€‚è¿™ä¸ªæ–¹æ³•å¿…é¡»è¦è®©å­ç±»å»è¦†ç›–ï¼Œé‡å†™é‡Œé¢çš„åˆ¤æ–­é€»è¾‘ã€‚ ç¬¬äºŒæ­¥ï¼šaddWaiter(Node.EXCLUSIVE) è·å–èµ„æºå¤±è´¥ï¼Œåˆ™å°è£…æˆNodeç»“ç‚¹åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445//å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹å¹¶æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨private Node addWaiter(Node mode) { //æŒ‡å®šæŒæœ‰é”çš„æ¨¡å¼ Node node = new Node(Thread.currentThread(), mode); //è·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node pred = tail; //å¦‚æœå°¾ç»“ç‚¹ä¸ä¸ºç©º, è¡¨æ˜åŒæ­¥é˜Ÿåˆ—å·²å­˜åœ¨ç»“ç‚¹ if (pred != null) { //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = pred; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ï¼ˆç”±äºæ˜¯å¤šçº¿ç¨‹ï¼Œå¯èƒ½å¹¶å‘ä¿®æ”¹å°¾ç»“ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡CASä¿®æ”¹ï¼‰ if (compareAndSetTail(pred, node)) { //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ pred.next = node; return node; } } //å¦åˆ™è¡¨æ˜åŒæ­¥é˜Ÿåˆ—æ˜¯ç©ºçš„ï¼Œè¿˜æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ– enq(node); return node;}//ç»“ç‚¹å…¥é˜Ÿæ“ä½œprivate Node enq(final Node node) { for (;;) { //è·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node t = tail; //å¦‚æœå°¾ç»“ç‚¹ä¸ºç©ºè¯´æ˜åŒæ­¥é˜Ÿåˆ—è¿˜æ²¡æœ‰åˆå§‹åŒ– if (t == null) { //åˆå§‹åŒ–åŒæ­¥é˜Ÿåˆ—ï¼ˆè°ƒç”¨æ— å‚æ„é€ å™¨åˆ›å»ºä¸€ä¸ªç»“ç‚¹ï¼Œç„¶åé€šè¿‡CASè®¾ç½®headç»“ç‚¹ï¼Œå¦‚æœæˆåŠŸåˆ™å°†å¤´ç»“ç‚¹headèµ‹å€¼ç»™tailç»“ç‚¹ï¼‰ if (compareAndSetHead(new Node())) { tail = head; } } else { //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = t; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(t, node)) { //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ t.next = node; return t; } } }} æ‰§è¡Œåˆ°è¿™ä¸€æ­¥è¡¨æ˜ç¬¬ä¸€æ¬¡è·å–é”å¤±è´¥ï¼Œé‚£ä¹ˆè¿™ä¸ªäººå°±ç»™è‡ªå·±é¢†äº†å—å·ç ç‰Œè¿›å…¥æ’é˜ŸåŒºå»æ’é˜Ÿäº†ï¼Œåœ¨é¢†å·ç ç‰Œçš„æ—¶å€™ä¼šå£°æ˜è‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥å ç”¨æˆ¿é—´(ç‹¬å æ¨¡å¼orå…±äº«æ¨¡å¼)ã€‚æ³¨æ„ï¼Œè¿™æ—¶å€™ä»–å¹¶æ²¡æœ‰åä¸‹æ¥ä¼‘æ¯(å°†è‡ªå·±æŒ‚èµ·)ã€‚ ç¬¬ä¸‰æ­¥ï¼šacquireQueued(addWaiter(Node.EXCLUSIVE), arg) åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è·å–èµ„æºã€‚å…¶å®è¿™ä¸ªæ–¹æ³•éå¸¸çš„å¥½ç†è§£ï¼Œå‰é¢å·²ç»å°è¯•è·å–èµ„æºï¼Œä½†æ˜¯å¤±è´¥äº†ï¼Œå¹¶ä¸”åŠ åˆ°äº†åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œåœ¨ç­‰å¾…ä¸­å¯ä»¥åˆ¤æ–­è‡ªå·±æ˜¯å¦å¯ä»¥ä¼‘æ¯ä»¥ä¸‹ï¼Œå¦‚æœå¯ä»¥ä¼‘æ¯ï¼Œé‚£å°±ç­‰å¾…ç€å…¶ä»–çº¿ç¨‹å”¤é†’è‡ªå·±ï¼Œåœ¨ç»§ç»­è·å–èµ„æºï¼Œç›´åˆ°æˆåŠŸæ‰è¿”å›ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667//ä»¥ä¸å¯ä¸­æ–­æ–¹å¼è·å–é”(ç‹¬å æ¨¡å¼)final boolean acquireQueued(final Node node, int arg) { boolean failed = true; try { //åˆ¤æ–­æ˜¯å¦ä¸­æ–­çš„æ ‡è®° boolean interrupted = false; //è‡ªæ—‹ for (;;) { //è·å–ç»™å®šç»“ç‚¹çš„å‰é©±ç»“ç‚¹çš„å¼•ç”¨ final Node p = node.predecessor(); //å¦‚æœå½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹æ˜¯å¤´ç»“ç‚¹headï¼Œå°±å°è¯•å»è·å–é” if (p == head &amp;&amp; tryAcquire(arg)) { //è¯´æ˜è·å–æˆåŠŸï¼Œå°†ç»™å®šç»“ç‚¹è®¾ç½®ä¸ºheadç»“ç‚¹ setHead(node); //ä¸ºäº†å¸®åŠ©åƒåœ¾æ”¶é›†, å°†ä¸Šä¸€ä¸ªheadç»“ç‚¹çš„åç»§æ¸…ç©º p.next = null; //è®¾ç½®è·å–æˆåŠŸçŠ¶æ€ failed = false; //è¿”å›ä¸­æ–­çš„çŠ¶æ€, æ•´ä¸ªå¾ªç¯æ‰§è¡Œåˆ°è¿™é‡Œæ‰æ˜¯å‡ºå£ return interrupted; } //å¦åˆ™è¯´æ˜é”çš„çŠ¶æ€è¿˜æ˜¯ä¸å¯è·å–, è¿™æ—¶åˆ¤æ–­æ˜¯å¦å¯ä»¥æŒ‚èµ·å½“å‰çº¿ç¨‹ //ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼šå¦‚æœè·å–é”å¤±è´¥ï¼Œåˆ¤æ–­æ˜¯å¦åº”è¯¥ä¼‘æ¯ //ç¬¬äºŒä¸ªæ¡ä»¶ï¼šç¬¬ä¸€ä¸ªæ¡ä»¶ä¸ºtrueï¼Œè¯´æ˜è‡ªå·±å¯ä»¥ä¼‘æ¯äº†åˆ™è°ƒç”¨parkæ–¹æ³•ä¼‘æ¯ //å¦‚æœåˆ¤æ–­ç»“æœä¸ºçœŸåˆ™æŒ‚èµ·å½“å‰çº¿ç¨‹, å¦åˆ™ç»§ç»­å¾ªç¯, åœ¨è¿™æœŸé—´çº¿ç¨‹ä¸å“åº”ä¸­æ–­ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) { interrupted = true; } } } finally { //åœ¨æœ€åç¡®ä¿å¦‚æœè·å–å¤±è´¥å°±å–æ¶ˆè·å– if (failed) { cancelAcquire(node); } }}//åˆ¤æ–­æ˜¯å¦å¯ä»¥å°†å½“å‰ç»“ç‚¹æŒ‚èµ·private static boolean shouldParkAfterFailedAcquire(Node pred, Node node) { //è·å–å‰é©±ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = pred.waitStatus; //å¦‚æœå‰é©±ç»“ç‚¹çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜å‰é©±ç»“ç‚¹ä¼šå”¤é†’å½“å‰ç»“ç‚¹, æ‰€ä»¥å½“å‰ç»“ç‚¹å¯ä»¥å®‰å¿ƒçš„æŒ‚èµ·äº† if (ws == Node.SIGNAL) { return true; } //èŠ‚ç‚¹çŠ¶æ€åªæœ‰CANCEL(-1)æ—¶æ‰å¤§äº0ï¼Œè¯´æ˜è¿™ä¸ªèŠ‚ç‚¹å–æ¶ˆäº†ã€‚é‚£å°±éœ€è¦æŠŠå–æ¶ˆçš„èŠ‚ç‚¹ä»åŒæ­¥é˜Ÿåˆ—ä¸­ç§»é™¤æ‰ if (ws &gt; 0) { //ä¸‹é¢çš„æ“ä½œæ˜¯æ¸…ç†åŒæ­¥é˜Ÿåˆ—ä¸­æ‰€æœ‰å·²å–æ¶ˆçš„å‰é©±ç»“ç‚¹ do { node.prev = pred = pred.prev; } while (pred.waitStatus &gt; 0); pred.next = node; } else { //åˆ°è¿™é‡Œè¡¨ç¤ºå‰é©±ç»“ç‚¹çŠ¶æ€ä¸æ˜¯SIGNALä¹Ÿä¸æ˜¯CANCEL, å¾ˆå¯èƒ½è¿˜æ˜¯ç­‰äº0, è¿™æ ·çš„è¯å‰é©±ç»“ç‚¹å°±ä¸ä¼šå»å”¤é†’å½“å‰ç»“ç‚¹äº† //æ‰€ä»¥å½“å‰ç»“ç‚¹å¿…é¡»è¦ç¡®ä¿å‰é©±ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALæ‰èƒ½å®‰å¿ƒçš„æŒ‚èµ·è‡ªå·± compareAndSetWaitStatus(pred, ws, Node.SIGNAL); } return false;}//æŒ‚èµ·å½“å‰çº¿ç¨‹private final boolean parkAndCheckInterrupt() { //æŒ‚èµ·å½“å‰çº¿ç¨‹ LockSupport.park(this); //è¿”å›å½“å‰çº¿ç¨‹æ˜¯å¦è¢«ä¸­æ–­è¿‡ return Thread.interrupted();} é¢†å®Œå·ç ç‰Œè¿›å…¥æ’é˜ŸåŒºåå°±ä¼šç«‹é©¬æ‰§è¡Œè¿™ä¸ªæ–¹æ³•ï¼Œå½“ä¸€ä¸ªç»“ç‚¹é¦–æ¬¡è¿›å…¥æ’é˜ŸåŒºåæœ‰ä¸¤ç§æƒ…å†µï¼Œä¸€ç§æ˜¯å‘ç°ä»–å‰é¢çš„é‚£ä¸ªäººå·²ç»ç¦»å¼€åº§ä½è¿›å…¥æˆ¿é—´äº†ï¼Œé‚£ä»–å°±ä¸åä¸‹æ¥ä¼‘æ¯äº†ï¼Œä¼šå†æ¬¡å»æ•²ä¸€æ•²é—¨çœ‹çœ‹é‚£å°å­æœ‰æ²¡æœ‰å®Œäº‹ã€‚å¦‚æœé‡Œé¢çš„äººåˆšå¥½å®Œäº‹å‡ºæ¥äº†ï¼Œéƒ½ä¸ç”¨ä»–å«è‡ªå·±å°±ç›´æ¥å†²è¿›å»äº†ã€‚å¦åˆ™ï¼Œå°±è¦è€ƒè™‘åä¸‹æ¥ä¼‘æ¯ä¸€ä¼šå„¿äº†ï¼Œä½†æ˜¯ä»–è¿˜æ˜¯ä¸æ”¾å¿ƒï¼Œå¦‚æœä»–åä¸‹æ¥ç¡ç€åæ²¡äººæé†’ä»–æ€ä¹ˆåŠï¼Ÿä»–å°±åœ¨å‰é¢é‚£äººçš„åº§ä½ä¸Šç•™ä¸€ä¸ªå°çº¸æ¡ï¼Œå¥½è®©ä»é‡Œé¢å‡ºæ¥çš„äººçœ‹åˆ°çº¸æ¡åèƒ½å¤Ÿå”¤é†’ä»–ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“ä»–è¿›å…¥æ’é˜ŸåŒºåå‘ç°å‰é¢è¿˜æœ‰å¥½å‡ ä¸ªäººåœ¨åº§ä½ä¸Šæ’é˜Ÿå‘¢ï¼Œé‚£ä»–å°±å¯ä»¥å®‰å¿ƒçš„åä¸‹æ¥å’ªä¸€ä¼šå„¿äº†ï¼Œä½†åœ¨æ­¤ä¹‹å‰ä»–è¿˜æ˜¯ä¼šåœ¨å‰é¢é‚£äºº(æ­¤æ—¶å·²ç»ç¡ç€äº†)çš„åº§ä½ä¸Šç•™ä¸€ä¸ªçº¸æ¡ï¼Œå¥½è®©è¿™ä¸ªäººåœ¨èµ°ä¹‹å‰èƒ½å¤Ÿå»å”¤é†’è‡ªå·±ã€‚å½“ä¸€åˆ‡äº‹æƒ…åŠå¦¥äº†ä¹‹åï¼Œä»–å°±å®‰å®‰å¿ƒå¿ƒçš„ç¡è§‰äº†ï¼Œæ³¨æ„ï¼Œæˆ‘ä»¬çœ‹åˆ°æ•´ä¸ªforå¾ªç¯å°±åªæœ‰ä¸€ä¸ªå‡ºå£ï¼Œé‚£å°±æ˜¯ç­‰çº¿ç¨‹æˆåŠŸçš„è·å–åˆ°é”ä¹‹åæ‰èƒ½å‡ºå»ï¼Œåœ¨æ²¡æœ‰è·å–åˆ°é”ä¹‹å‰å°±ä¸€ç›´æ˜¯æŒ‚åœ¨forå¾ªç¯çš„parkAndCheckInterrupt()æ–¹æ³•é‡Œå¤´ã€‚çº¿ç¨‹è¢«å”¤é†’åä¹Ÿæ˜¯ä»è¿™ä¸ªåœ°æ–¹ç»§ç»­æ‰§è¡Œforå¾ªç¯ã€‚ ç¬¬å››æ­¥ï¼šselfInterrupt() 1234//å½“å‰çº¿ç¨‹å°†è‡ªå·±ä¸­æ–­private static void selfInterrupt() { Thread.currentThread().interrupt();} ç”±äºä¸Šé¢æ•´ä¸ªçº¿ç¨‹ä¸€ç›´æ˜¯æŒ‚åœ¨forå¾ªç¯çš„parkAndCheckInterrupt()æ–¹æ³•é‡Œå¤´ï¼Œæ²¡æœ‰æˆåŠŸè·å–åˆ°é”ä¹‹å‰ä¸å“åº”ä»»ä½•å½¢å¼çš„çº¿ç¨‹ä¸­æ–­ï¼Œåªæœ‰å½“çº¿ç¨‹æˆåŠŸè·å–åˆ°é”å¹¶ä»forå¾ªç¯å‡ºæ¥åï¼Œä»–æ‰ä¼šæŸ¥çœ‹åœ¨è¿™æœŸé—´æ˜¯å¦æœ‰äººè¦æ±‚ä¸­æ–­çº¿ç¨‹ï¼Œå¦‚æœæ˜¯çš„è¯å†å»è°ƒç”¨selfInterrupt()æ–¹æ³•å°†è‡ªå·±æŒ‚èµ·ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­è·å–é” 123456789 public final void acquireInterruptibly(int arg) throws InterruptedException { //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­è¿‡ï¼Œå¦‚æœè¢«ä¸­æ–­åˆ™ç›´æ¥æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); //å¦‚æœæ²¡æœ‰è¢«ä¸­æ–­è¿‡ï¼Œåˆ™å°è¯•è·å–èµ„æº if (!tryAcquire(arg)) //è¯´æ˜è·å–èµ„æºå¤±è´¥ï¼Œåˆ™éœ€è¦åŠ å…¥åˆ°åŒæ­¥é˜Ÿåˆ—ï¼Œåœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è·å–èµ„æº doAcquireInterruptibly(arg);} 1234567891011121314151617181920212223242526272829//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–é”(ç‹¬å æ¨¡å¼)private void doAcquireInterruptibly(int arg) throws InterruptedException { //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try { for (;;) { //è·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æœpæ˜¯headç»“ç‚¹, é‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å†æ¬¡å°è¯•è·å–é” if (p == head &amp;&amp; tryAcquire(arg)) { setHead(node); p.next = null; // help GC failed = false; //è·å–é”æˆåŠŸåè¿”å› return; } //å¦‚æœæ»¡è¶³æ¡ä»¶å°±æŒ‚èµ·å½“å‰çº¿ç¨‹, æ­¤æ—¶å“åº”ä¸­æ–­å¹¶æŠ›å‡ºå¼‚å¸¸ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) { //çº¿ç¨‹è¢«å”¤é†’åå¦‚æœå‘ç°ä¸­æ–­è¯·æ±‚å°±æŠ›å‡ºå¼‚å¸¸ throw new InterruptedException(); } } } finally { if (failed) { cancelAcquire(node); } }} å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼å’Œä¸å“åº”çº¿ç¨‹ä¸­æ–­æ–¹å¼è·å–é”æµç¨‹ä¸Šå¤§è‡´ä¸Šæ˜¯ç›¸åŒçš„ã€‚å”¯ä¸€çš„ä¸€ç‚¹åŒºåˆ«å°±æ˜¯çº¿ç¨‹ä»parkAndCheckInterruptæ–¹æ³•ä¸­é†’æ¥åä¼šæ£€æŸ¥çº¿ç¨‹æ˜¯å¦ä¸­æ–­ï¼Œå¦‚æœæ˜¯çš„è¯å°±æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ï¼Œè€Œä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–é”æ˜¯åœ¨æ”¶åˆ°ä¸­æ–­è¯·æ±‚ååªæ˜¯è®¾ç½®ä¸€ä¸‹ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸ä¼šç«‹é©¬ç»“æŸå½“å‰è·å–é”çš„æ–¹æ³•ï¼Œä¸€ç›´åˆ°ç»“ç‚¹æˆåŠŸè·å–åˆ°é”ä¹‹åæ‰ä¼šæ ¹æ®ä¸­æ–­çŠ¶æ€å†³å®šæ˜¯å¦å°†è‡ªå·±æŒ‚èµ·ã€‚ è®¾ç½®è¶…æ—¶æ—¶é—´è·å–é” 12345678public final boolean tryAcquireNanos(int arg, long nanosTimeout) throws InterruptedException { ////åˆ¤æ–­æ˜¯å¦è¢«ä¸­æ–­è¿‡ï¼Œå¦‚æœä¸­æ–­è¿‡ç›´æ¥æŠ›å¼‚å¸¸ if (Thread.interrupted()) throw new InterruptedException(); ////å°è¯•è·å–èµ„æºï¼Œå¦‚æœå¤±è´¥æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ï¼Œä»åŒæ­¥é˜Ÿåˆ—ä¸­è·å–èµ„æº return tryAcquire(arg) || doAcquireNanos(arg, nanosTimeout);} 123456789101112131415161718192021222324252627282930313233343536373839404142434445//ä»¥é™å®šè¶…æ—¶æ—¶é—´è·å–é”(ç‹¬å æ¨¡å¼)private boolean doAcquireNanos(int arg, long nanosTimeout) throws InterruptedException { //è·å–ç³»ç»Ÿå½“å‰æ—¶é—´ long lastTime = System.nanoTime(); //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.EXCLUSIVE); boolean failed = true; try { for (;;) { //è·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æœå‰é©±æ˜¯headç»“ç‚¹, é‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å†æ¬¡å°è¯•è·å–é” if (p == head &amp;&amp; tryAcquire(arg)) { //æ›´æ–°headç»“ç‚¹ setHead(node); p.next = null; failed = false; return true; } //è¶…æ—¶æ—¶é—´ç”¨å®Œäº†å°±ç›´æ¥é€€å‡ºå¾ªç¯ if (nanosTimeout &lt;= 0) { return false; } //å¦‚æœè¶…æ—¶æ—¶é—´å¤§äºè‡ªæ—‹æ—¶é—´, é‚£ä¹ˆç­‰åˆ¤æ–­å¯ä»¥æŒ‚èµ·çº¿ç¨‹ä¹‹åå°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) { //å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´, ä¹‹åå†è‡ªå·±é†’æ¥ LockSupport.parkNanos(this, nanosTimeout); } //è·å–ç³»ç»Ÿå½“å‰æ—¶é—´ long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡éƒ½å‡å»è·å–é”çš„æ—¶é—´é—´éš” nanosTimeout -= now - lastTime; //å†æ¬¡æ›´æ–°lastTime lastTime = now; //åœ¨è·å–é”çš„æœŸé—´æ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } } } finally { if (failed) { cancelAcquire(node); } }} è®¾ç½®è¶…æ—¶æ—¶é—´è·å–é¦–å…ˆä¼šå»è·å–ä¸€ä¸‹é”ï¼Œç¬¬ä¸€æ¬¡è·å–é”å¤±è´¥åä¼šæ ¹æ®æƒ…å†µï¼Œå¦‚æœä¼ å…¥çš„è¶…æ—¶æ—¶é—´å¤§äºè‡ªæ—‹æ—¶é—´é‚£ä¹ˆå°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œå¦åˆ™çš„è¯å°±ä¼šè¿›è¡Œè‡ªæ—‹ï¼Œæ¯æ¬¡è·å–é”ä¹‹åéƒ½ä¼šå°†è¶…æ—¶æ—¶é—´å‡å»è·å–ä¸€æ¬¡é”æ‰€ç”¨çš„æ—¶é—´ã€‚ä¸€ç›´åˆ°è¶…æ—¶æ—¶é—´å°äº0ä¹Ÿå°±è¯´æ˜è¶…æ—¶æ—¶é—´ç”¨å®Œäº†ï¼Œé‚£ä¹ˆè¿™æ—¶å°±ä¼šç»“æŸè·å–é”çš„æ“ä½œç„¶åè¿”å›è·å–å¤±è´¥æ ‡å¿—ã€‚æ³¨æ„åœ¨ä»¥è¶…æ—¶æ—¶é—´è·å–é”çš„è¿‡ç¨‹ä¸­æ˜¯å¯ä»¥å“åº”çº¿ç¨‹ä¸­æ–­è¯·æ±‚çš„ã€‚ ç‹¬å æ¨¡å¼ä¸‹é‡Šæ”¾é” 1234567891011121314151617181920212223242526272829303132333435363738394041//é‡Šæ”¾é”çš„æ“ä½œ(ç‹¬å æ¨¡å¼)public final boolean release(int arg) { //å°è¯•é‡Šæ”¾ï¼ˆè¯¥æ–¹æ³•éœ€è¦å­ç±»å»å®ç°ï¼‰ if (tryRelease(arg)) { //å°è¯•æˆåŠŸï¼Œè·å–headç»“ç‚¹ Node h = head; //å¦‚æœheadç»“ç‚¹ä¸ä¸ºç©ºå¹¶ä¸”ç­‰å¾…çŠ¶æ€ä¸ç­‰äº0å°±å»å”¤é†’åç»§ç»“ç‚¹ if (h != null &amp;&amp; h.waitStatus != 0) { //å”¤é†’åç»§ç»“ç‚¹ unparkSuccessor(h); } return true; } return false;}//å”¤é†’åç»§ç»“ç‚¹private void unparkSuccessor(Node node) { //è·å–ç»™å®šç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = node.waitStatus; //å¦‚æœçŠ¶æ€å°äº0ï¼Œé€šè¿‡CASå°†çŠ¶æ€æ›´æ–°ä¸º0ï¼Œå› ä¸ºæ­¤æ—¶ç»™å®šçš„ç»“ç‚¹é‡Šæ”¾èµ„æº if (ws &lt; 0) { compareAndSetWaitStatus(node, ws, 0); } //è·å–ç»™å®šç»“ç‚¹çš„åç»§ç»“ç‚¹ï¼Œå³ä¸‹ä¸€ä¸ªéœ€è¦è¢«å”¤é†’çš„ç»“ç‚¹ Node s = node.next; //åç»§ç»“ç‚¹ä¸ºç©ºæˆ–è€…ç­‰å¾…çŠ¶æ€ä¸ºå–æ¶ˆçŠ¶æ€ if (s == null || s.waitStatus &gt; 0) { s = null; //ä»åå‘å‰éå†é˜Ÿåˆ—æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸æ˜¯å–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ for (Node t = tail; t != null &amp;&amp; t != node; t = t.prev) { if (t.waitStatus &lt;= 0) { s = t; } } } //å”¤é†’ç»™å®šç»“ç‚¹åé¢é¦–ä¸ªä¸æ˜¯å–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ if (s != null) { LockSupport.unpark(s.thread); }} çº¿ç¨‹æŒæœ‰é”è¿›å…¥æˆ¿é—´åå°±ä¼šå»åŠè‡ªå·±çš„äº‹æƒ…ï¼Œç­‰äº‹æƒ…åŠå®Œåå®ƒå°±ä¼šé‡Šæ”¾é”å¹¶ç¦»å¼€æˆ¿é—´ã€‚é€šè¿‡tryReleaseæ–¹æ³•å¯ä»¥æ‹¨åŠ¨å¯†ç é”è¿›è¡Œè§£é”ï¼ŒtryReleaseæ–¹æ³•æ˜¯éœ€è¦è®©å­ç±»å»è¦†ç›–çš„ï¼Œä¸åŒçš„å­ç±»å®ç°çš„è§„åˆ™ä¸ä¸€æ ·ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸åŒçš„å­ç±»è®¾ç½®çš„å¯†ç ä¸ä¸€æ ·ã€‚ åƒåœ¨ReentrantLockå½“ä¸­ï¼Œæˆ¿é—´é‡Œé¢çš„äººæ¯è°ƒç”¨tryReleaseæ–¹æ³•ä¸€æ¬¡ï¼Œstateå°±å‡1ï¼Œç›´åˆ°stateå‡åˆ°0çš„æ—¶å€™å¯†ç é”å°±å¼€äº†ã€‚è¿™ä¸ªè¿‡ç¨‹å°±åƒåœ¨ä¸åœçš„è½¬åŠ¨å¯†ç é”çš„è½¬è½®ï¼Œè€Œæ¯æ¬¡è½¬åŠ¨è½¬è½®æ•°å­—åªæ˜¯å‡å°‘1ã€‚ CountDownLatchå’Œè¿™ä¸ªä¹Ÿæœ‰ç‚¹ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒä¸æ˜¯ä¸€ä¸ªäººåœ¨è½¬ï¼Œè€Œæ˜¯å¤šä¸ªäººæ¯äººéƒ½å»è½¬ä¸€ä¸‹ï¼Œé›†ä¸­å¤§å®¶çš„åŠ›é‡æŠŠé”ç»™å¼€äº†ã€‚ çº¿ç¨‹å‡ºäº†æˆ¿é—´åå®ƒä¼šæ‰¾åˆ°è‡ªå·±åŸå…ˆçš„åº§ä½ï¼Œä¹Ÿå°±æ˜¯æ‰¾åˆ°headç»“ç‚¹ã€‚çœ‹çœ‹åº§ä½ä¸Šæœ‰æ²¡æœ‰äººç»™å®ƒç•™äº†å°çº¸æ¡ï¼Œå¦‚æœæœ‰çš„è¯å®ƒå°±çŸ¥é“æœ‰äººç¡ç€äº†éœ€è¦è®©å®ƒå¸®å¿™å”¤é†’ï¼Œé‚£ä¹ˆå®ƒå°±ä¼šå»å”¤é†’é‚£ä¸ªçº¿ç¨‹ã€‚å¦‚æœæ²¡æœ‰çš„è¯å°±è¡¨æ˜åŒæ­¥é˜Ÿåˆ—ä¸­æš‚æ—¶è¿˜æ²¡æœ‰äººåœ¨ç­‰å¾…ï¼Œä¹Ÿæ²¡æœ‰äººéœ€è¦å®ƒå”¤é†’ï¼Œæ‰€ä»¥å®ƒå°±å¯ä»¥å®‰å¿ƒçš„ç¦»å»äº†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æä¹‹å…±äº«æ¨¡å¼]]></title>
    <url>%2Fposts%2Fedbda32.html</url>
    <content type="text"><![CDATA[AQSä¸ºåœ¨å…±äº«æ¨¡å¼ä¸‹è·å–é”åˆ†åˆ«æä¾›ä¸‰ç§è·å–æ–¹å¼ï¼š ä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–; å“åº”çº¿ç¨‹ä¸­æ–­è·å–; è®¾ç½®è¶…æ—¶æ—¶é—´è·å–ã€‚ è¿™ä¸‰ç§æ–¹å¼æ•´ä½“æ­¥éª¤å¤§è‡´æ˜¯ç›¸åŒçš„ï¼Œåªæœ‰å°‘éƒ¨åˆ†ä¸åŒçš„åœ°æ–¹ï¼š ç¬¬ä¸€ç§æ–¹å¼ï¼Œå¦‚æœå½“å‰çº¿ç¨‹åœ¨è·å–èµ„æºæ—¶è¢«ä¸­æ–­äº†ï¼Œå®ƒä¼šå¿½ç•¥è¿™ä¸ªä¸­æ–­ï¼Œå½“è·å–èµ„æºè¿”å›åæ‰å¯¹ä¸­æ–­è¿›è¡Œå¤„ç†; ç¬¬äºŒç§æ–¹å¼åˆ™ä¸åŒï¼Œå¦‚æœå½“å‰çº¿ç¨‹è·å–èµ„æºæ—¶è¢«ä¸­æ–­ï¼Œå®ƒä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸; ç¬¬ä¸‰ç§æ–¹å¼åœ¨ä¸­æ–­çš„åŸºç¡€ä¸Šæ·»åŠ äº†è¶…æ—¶è¿”å›çš„åŠŸèƒ½ã€‚ ä¸å“åº”çº¿ç¨‹ä¸­æ–­çš„è·å– 12345678910111213141516//ä»¥ä¸å¯ä¸­æ–­æ¨¡å¼è·å–é”(å…±äº«æ¨¡å¼)public final void acquireShared(int arg) { //1.å°è¯•å»è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸï¼Œåˆ™æµç¨‹ç»“æŸ if (tryAcquireShared(arg) &lt; 0) { //2.å¦‚æœè·å–å¤±è´¥å°±è¿›å…¥è¿™ä¸ªæ–¹æ³•ï¼šå°†å½“å‰çº¿ç¨‹åŒ…è£…æˆNodeç»“ç‚¹æ”¾å…¥åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨å¹¶æŒ‰ç…§æ¡ä»¶åˆ¤æ–­æ˜¯å¦æŒ‚èµ·ï¼Œç­‰å¾…è¢«å”¤é†’ doAcquireShared(arg); }}//å°è¯•å»è·å–é”(å…±äº«æ¨¡å¼ï¼Œè¯¥æ–¹æ³•éœ€è¦å­ç±»å»å®ç°ï¼Œè¿”å›å€¼éœ€è¦éµå¾ªä»¥ä¸‹ä¸‰ä¸ªå®šä¹‰)//è´Ÿæ•°ï¼šè¡¨ç¤ºè·å–å¤±è´¥//é›¶å€¼ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹è·å–æˆåŠŸ, ä½†æ˜¯åç»§ç»“ç‚¹ä¸èƒ½å†è·å–äº†//æ­£æ•°ï¼šè¡¨ç¤ºå½“å‰ç»“ç‚¹è·å–æˆåŠŸ, å¹¶ä¸”åç»§ç»“ç‚¹åŒæ ·å¯ä»¥è·å–æˆåŠŸprotected int tryAcquireShared(int arg) { throw new UnsupportedOperationException();} è°ƒç”¨acquireSharedæ–¹æ³•æ˜¯ä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–é”çš„æ–¹å¼ã€‚åœ¨è¯¥æ–¹æ³•ä¸­ï¼Œé¦–å…ˆè°ƒç”¨tryAcquireSharedå»å°è¯•è·å–é”ï¼ŒtryAcquireSharedæ–¹æ³•è¿”å›ä¸€ä¸ªè·å–é”çš„çŠ¶æ€ï¼Œè¿™é‡ŒAQSè§„å®šäº†è¿”å›çŠ¶æ€è‹¥æ˜¯è´Ÿæ•°ä»£è¡¨å½“å‰ç»“ç‚¹è·å–é”å¤±è´¥ï¼Œè‹¥æ˜¯0ä»£è¡¨å½“å‰ç»“ç‚¹è·å–é”æˆåŠŸï¼Œä½†åç»§ç»“ç‚¹ä¸èƒ½å†è·å–äº†ï¼Œè‹¥æ˜¯æ­£æ•°åˆ™ä»£è¡¨å½“å‰ç»“ç‚¹è·å–é”æˆåŠŸï¼Œå¹¶ä¸”è¿™ä¸ªé”åç»­ç»“ç‚¹ä¹ŸåŒæ ·å¯ä»¥è·å–æˆåŠŸã€‚å­ç±»åœ¨å®ç°tryAcquireSharedæ–¹æ³•è·å–é”çš„é€»è¾‘æ—¶ï¼Œè¿”å›å€¼éœ€è¦éµå®ˆè¿™ä¸ªçº¦å®šã€‚å¦‚æœè°ƒç”¨tryAcquireSharedçš„è¿”å›å€¼å°äº0ï¼Œå°±ä»£è¡¨è¿™æ¬¡å°è¯•è·å–é”å¤±è´¥äº†ï¼Œæ¥ä¸‹æ¥å°±è°ƒç”¨doAcquireSharedæ–¹æ³•å°†å½“å‰çº¿ç¨‹æ·»åŠ è¿›åŒæ­¥é˜Ÿåˆ—ã€‚ä¸‹é¢çœ‹ä¸‹doAcquireSharedæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344//åœ¨åŒæ­¥é˜Ÿåˆ—ä¸­è·å–(å…±äº«æ¨¡å¼)private void doAcquireShared(int arg) { //å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆSHAREDå…±äº«æ¨¡å¼çš„ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—ä¸­ final Node node = addWaiter(Node.SHARED); //æ˜¯å¦è·å–å¤±è´¥ boolean failed = true; try { //æ˜¯å¦ä¸­æ–­ boolean interrupted = false; //è‡ªæ—‹ï¼Œåˆ¤æ–­ä»€ä¹ˆæ—¶å€™èƒ½å¤Ÿå°è¯•è·å–èµ„æºï¼Œä»€ä¹ˆæ—¶å€™èƒ½å¤ŸæŒ‚èµ· for (;;) { //è·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); //å¦‚æœå‰é©±ç»“ç‚¹ä¸ºheadç»“ç‚¹å°±å†æ¬¡å°è¯•å»è·å–é” if (p == head) { //å†æ¬¡å°è¯•å»è·å–é”å¹¶è¿”å›è·å–çŠ¶æ€ //r &lt; 0, è¡¨ç¤ºè·å–å¤±è´¥ //r = 0, è¡¨ç¤ºå½“å‰ç»“ç‚¹è·å–æˆåŠŸ, ä½†æ˜¯åç»§ç»“ç‚¹ä¸èƒ½å†è·å–äº† //r &gt; 0, è¡¨ç¤ºå½“å‰ç»“ç‚¹è·å–æˆåŠŸ, å¹¶ä¸”åç»§ç»“ç‚¹åŒæ ·å¯ä»¥è·å–æˆåŠŸ int r = tryAcquireShared(arg); if (r &gt;= 0) { //åˆ°è¿™é‡Œè¯´æ˜å½“å‰ç»“ç‚¹å·²ç»è·å–é”æˆåŠŸäº†, æ­¤æ—¶å®ƒä¼šå°†é”çš„çŠ¶æ€ä¿¡æ¯ä¼ æ’­ç»™åç»§ç»“ç‚¹ setHeadAndPropagate(node, r); //å¸®åŠ©åƒåœ¾å›æ”¶ p.next = null; //å¦‚æœåœ¨çº¿ç¨‹é˜»å¡æœŸé—´æ”¶åˆ°ä¸­æ–­è¯·æ±‚, å°±åœ¨è¿™ä¸€æ­¥å“åº”è¯¥è¯·æ±‚ if (interrupted) { selfInterrupt(); } failed = false; return; } } //æ¯æ¬¡è·å–é”å¤±è´¥åéƒ½ä¼šåˆ¤æ–­æ˜¯å¦å¯ä»¥å°†çº¿ç¨‹æŒ‚èµ·, å¦‚æœå¯ä»¥çš„è¯å°±ä¼šåœ¨parkAndCheckInterruptæ–¹æ³•é‡Œå°†çº¿ç¨‹æŒ‚èµ· if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) { interrupted = true; } } } finally { if (failed) { cancelAcquire(node); } }} è¿›å…¥doAcquireSharedæ–¹æ³•é¦–å…ˆæ˜¯è°ƒç”¨addWaiteræ–¹æ³•å°†å½“å‰çº¿ç¨‹åŒ…è£…æˆç»“ç‚¹æ”¾åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ã€‚è¿™ä¸ªæ·»åŠ ç»“ç‚¹çš„è¿‡ç¨‹è·Ÿç‹¬å æ¨¡å¼æ˜¯ä¸€æ ·çš„ã€‚ ç»“ç‚¹è¿›å…¥åŒæ­¥é˜Ÿåˆ—åï¼Œå¦‚æœå®ƒå‘ç°åœ¨å®ƒå‰é¢çš„ç»“ç‚¹å°±æ˜¯headç»“ç‚¹ï¼Œå› ä¸ºheadç»“ç‚¹çš„çº¿ç¨‹å·²ç»è·å–é”è¿›å…¥æˆ¿é—´é‡Œé¢äº†ï¼Œé‚£ä¹ˆä¸‹ä¸€ä¸ªè·å–é”çš„ç»“ç‚¹å°±è½®åˆ°è‡ªå·±äº†ï¼Œæ‰€ä»¥å½“å‰ç»“ç‚¹å…ˆä¸ä¼šå°†è‡ªå·±æŒ‚èµ·ï¼Œè€Œæ˜¯å†ä¸€æ¬¡å»å°è¯•è·å–é”ï¼Œå¦‚æœå‰é¢é‚£äººåˆšå¥½é‡Šæ”¾é”ç¦»å¼€äº†ï¼Œé‚£ä¹ˆå½“å‰ç»“ç‚¹å°±èƒ½æˆåŠŸè·å¾—é”ï¼Œå¦‚æœå‰é¢é‚£äººè¿˜æ²¡æœ‰é‡Šæ”¾é”ï¼Œé‚£ä¹ˆå°±ä¼šè°ƒç”¨shouldParkAfterFailedAcquireæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œé¢ä¼šå°†headç»“ç‚¹çš„çŠ¶æ€æ”¹ä¸ºSIGNALï¼Œåªæœ‰ä¿è¯å‰é¢ç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNALï¼Œå½“å‰ç»“ç‚¹æ‰èƒ½æ”¾å¿ƒçš„å°†è‡ªå·±æŒ‚èµ·ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½ä¼šåœ¨parkAndCheckInterruptæ–¹æ³•é‡Œé¢è¢«æŒ‚èµ·ã€‚å¦‚æœå½“å‰ç»“ç‚¹æ°å·§æˆåŠŸçš„è·å–äº†é”ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥å°±ä¼šè°ƒç”¨setHeadAndPropagateæ–¹æ³•å°†è‡ªå·±è®¾ç½®ä¸ºheadç»“ç‚¹ï¼Œå¹¶ä¸”å”¤é†’åé¢åŒæ ·æ˜¯å…±äº«æ¨¡å¼çš„ç»“ç‚¹ã€‚ä¸‹é¢çœ‹ä¸‹setHeadAndPropagateæ–¹æ³•å…·ä½“çš„æ“ä½œã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051//è®¾ç½®headç»“ç‚¹å¹¶ä¼ æ’­é”çš„çŠ¶æ€(å…±äº«æ¨¡å¼)private void setHeadAndPropagate(Node node, int propagate) { //è·å–å½“å‰çš„å¤´ç»“ç‚¹ Node h = head; //å°†ç»™å®šçš„æˆåŠŸè·å–èµ„æºçš„ç»“ç‚¹è®¾ç½®ä¸ºheadç»“ç‚¹ setHead(node); //æœ‰5ä¸ªæ¡ä»¶ï¼š //ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼špropagate&gt;0:è¿™ä¸ªå€¼æ˜¯é€šè¿‡è°ƒç”¨tryAcquireShared()è·å–çš„ï¼Œè¡¨ç¤ºå‰©ä½™çš„èµ„æºï¼Œä¸Šé¢è¯´äº†state&gt;0è¡¨ç¤ºè·å–èµ„æºæˆåŠŸï¼Œä¸”è¿˜æœ‰å‰©ä½™çš„èµ„æºã€‚ //ç¬¬äºŒä¸ªæ¡ä»¶ï¼šh==nullï¼šè¡¨ç¤ºè€çš„å¤´ç»“ç‚¹headçš„å¼•ç”¨ä¸ºnullã€‚ //ç¬¬ä¸‰ä¸ªæ¡ä»¶ï¼šh.waitStatus&lt;0ï¼šè€çš„å¤´ç»“ç‚¹headçš„èŠ‚ç‚¹çŠ¶æ€ï¼Œæœ‰ä¸¤ç§å–å€¼å¯èƒ½ï¼šSIGNAL(-1)å’ŒPROPAGATE(-3)ã€‚ //ç¬¬å››ä¸ªæ¡ä»¶ï¼š(h=head)==null //ç¬¬äº”ä¸ªæ¡ä»¶ï¼šh.waitStatus&lt;0ï¼šæ–°è®¾ç½®çš„å¤´ç»“ç‚¹headçš„èŠ‚ç‚¹çŠ¶æ€ï¼Œæœ‰ä¸¤ç§å–å€¼å¯èƒ½ï¼šSIGNAL(-1)å’ŒPROPAGATE(-3)ã€‚ if (propagate &gt; 0 || h == null || h.waitStatus &lt; 0 || (h = head) == null || h.waitStatus &lt; 0) { //è·å–ç»™å®šç»“ç‚¹çš„åç»§ç»“ç‚¹ Node s = node.next; //å¦‚æœç»™å®šç»“ç‚¹çš„åç»§ç»“ç‚¹ä¸ºç©º, æˆ–è€…å®ƒçš„çŠ¶æ€æ˜¯å…±äº«çŠ¶æ€ if (s == null || s.isShared()) { //å”¤é†’åç»§ç»“ç‚¹ doReleaseShared(); } }}//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)private void doReleaseShared() { for (;;) { //è·å–åŒæ­¥é˜Ÿåˆ—çš„headç»“ç‚¹ Node h = head; if (h != null &amp;&amp; h != tail) { //è·å–headç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = h.waitStatus; //å¦‚æœheadç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜åé¢æœ‰äººåœ¨æ’é˜Ÿ if (ws == Node.SIGNAL) { //å…ˆæŠŠheadç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ›´æ–°ä¸º0 if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) { continue; } //å†å»å”¤é†’åç»§ç»“ç‚¹ unparkSuccessor(h); //å¦‚æœheadç»“ç‚¹çš„çŠ¶æ€ä¸º0, è¡¨æ˜æ­¤æ—¶åé¢æ²¡äººåœ¨æ’é˜Ÿ, å°±åªæ˜¯å°†headçŠ¶æ€ä¿®æ”¹ä¸ºPROPAGATE }else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) { continue; } } //åªæœ‰ä¿è¯æœŸé—´headç»“ç‚¹æ²¡è¢«ä¿®æ”¹è¿‡æ‰èƒ½è·³å‡ºå¾ªç¯ if (h == head) { break; } }} è°ƒç”¨setHeadAndPropagateæ–¹æ³•é¦–å…ˆå°†è‡ªå·±è®¾ç½®æˆheadç»“ç‚¹ï¼Œç„¶åå†æ ¹æ®ä¼ å…¥çš„tryAcquireSharedæ–¹æ³•çš„è¿”å›å€¼æ¥å†³å®šæ˜¯å¦è¦å»å”¤é†’åç»§ç»“ç‚¹ã€‚å‰é¢å·²ç»è®²åˆ°å½“è¿”å›å€¼å¤§äº0å°±è¡¨æ˜å½“å‰ç»“ç‚¹æˆåŠŸè·å–äº†é”ï¼Œå¹¶ä¸”åé¢çš„ç»“ç‚¹ä¹Ÿå¯ä»¥æˆåŠŸè·å–é”ã€‚è¿™æ—¶å½“å‰ç»“ç‚¹å°±éœ€è¦å»å”¤é†’åé¢åŒæ ·æ˜¯å…±äº«æ¨¡å¼çš„ç»“ç‚¹ï¼Œæ³¨æ„ï¼Œæ¯æ¬¡å”¤é†’ä»…ä»…åªæ˜¯å”¤é†’åä¸€ä¸ªç»“ç‚¹ï¼Œå¦‚æœåä¸€ä¸ªç»“ç‚¹ä¸æ˜¯å…±äº«æ¨¡å¼çš„è¯ï¼Œå½“å‰ç»“ç‚¹å°±ç›´æ¥è¿›å…¥æˆ¿é—´è€Œä¸ä¼šå†å»å”¤é†’æ›´åé¢çš„ç»“ç‚¹äº†ã€‚å…±äº«æ¨¡å¼ä¸‹å”¤é†’åç»§ç»“ç‚¹çš„æ“ä½œæ˜¯åœ¨doReleaseSharedæ–¹æ³•è¿›è¡Œçš„ï¼Œå…±äº«æ¨¡å¼å’Œç‹¬å æ¨¡å¼çš„å”¤é†’æ“ä½œåŸºæœ¬ä¹Ÿæ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯å»æ‰¾åˆ°è‡ªå·±åº§ä½ä¸Šçš„ç‰Œå­(ç­‰å¾…çŠ¶æ€)ï¼Œå¦‚æœç‰Œå­ä¸Šä¸ºSIGNALè¡¨æ˜åé¢æœ‰äººéœ€è¦è®©å®ƒå¸®å¿™å”¤é†’ï¼Œå¦‚æœç‰Œå­ä¸Šä¸º0åˆ™è¡¨æ˜é˜Ÿåˆ—æ­¤æ—¶å¹¶æ²¡æœ‰äººåœ¨æ’é˜Ÿã€‚åœ¨ç‹¬å æ¨¡å¼ä¸‹æ˜¯å¦‚æœå‘ç°æ²¡äººåœ¨æ’é˜Ÿå°±ç›´æ¥ç¦»å¼€é˜Ÿåˆ—äº†ï¼Œè€Œåœ¨å…±äº«æ¨¡å¼ä¸‹å¦‚æœå‘ç°é˜Ÿåˆ—åé¢æ²¡äººåœ¨æ’é˜Ÿï¼Œå½“å‰ç»“ç‚¹åœ¨ç¦»å¼€å‰ä»ç„¶ä¼šç•™ä¸ªå°çº¸æ¡(å°†ç­‰å¾…çŠ¶æ€è®¾ç½®ä¸ºPROPAGATE)å‘Šè¯‰åæ¥çš„äººè¿™ä¸ªé”çš„å¯è·å–çŠ¶æ€ã€‚é‚£ä¹ˆåé¢æ¥çš„äººåœ¨å°è¯•è·å–é”çš„æ—¶å€™å¯ä»¥æ ¹æ®è¿™ä¸ªçŠ¶æ€æ¥åˆ¤æ–­æ˜¯å¦ç›´æ¥è·å–é”ã€‚ å“åº”çº¿ç¨‹ä¸­æ–­è·å–é” 123456789101112131415161718192021222324252627282930313233343536373839404142//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–é”(å…±äº«æ¨¡å¼)public final void acquireSharedInterruptibly(int arg) throws InterruptedException { //é¦–å…ˆåˆ¤æ–­çº¿ç¨‹æ˜¯å¦ä¸­æ–­, å¦‚æœæ˜¯åˆ™æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } //1.å°è¯•å»è·å–é” if (tryAcquireShared(arg) &lt; 0) { //2. å¦‚æœè·å–å¤±è´¥åˆ™è¿›äººè¯¥æ–¹æ³• doAcquireSharedInterruptibly(arg); }}//ä»¥å¯ä¸­æ–­æ¨¡å¼è·å–(å…±äº«æ¨¡å¼)private void doAcquireSharedInterruptibly(int arg) throws InterruptedException { //å°†å½“å‰ç»“ç‚¹æ’å…¥åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨ final Node node = addWaiter(Node.SHARED); boolean failed = true; try { for (;;) { //è·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); if (p == head) { int r = tryAcquireShared(arg); if (r &gt;= 0) { setHeadAndPropagate(node, r); p.next = null; failed = false; return; } } if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; parkAndCheckInterrupt()) { //å¦‚æœçº¿ç¨‹åœ¨é˜»å¡è¿‡ç¨‹ä¸­æ”¶åˆ°è¿‡ä¸­æ–­è¯·æ±‚, é‚£ä¹ˆå°±ä¼šç«‹é©¬åœ¨è¿™é‡ŒæŠ›å‡ºå¼‚å¸¸ throw new InterruptedException(); } } } finally { if (failed) { cancelAcquire(node); } }} å“åº”çº¿ç¨‹ä¸­æ–­è·å–é”çš„æ–¹å¼å’Œä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–é”çš„æ–¹å¼åœ¨æµç¨‹ä¸ŠåŸºæœ¬æ˜¯ç›¸åŒçš„ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨å“ªé‡Œå“åº”çº¿ç¨‹çš„ä¸­æ–­è¯·æ±‚ã€‚åœ¨ä¸å“åº”çº¿ç¨‹ä¸­æ–­è·å–é”æ—¶ï¼Œçº¿ç¨‹ä»parkAndCheckInterruptæ–¹æ³•ä¸­è¢«å”¤é†’ï¼Œå”¤é†’åå°±ç«‹é©¬è¿”å›æ˜¯å¦æ”¶åˆ°ä¸­æ–­è¯·æ±‚ï¼Œå³ä½¿æ˜¯æ”¶åˆ°äº†ä¸­æ–­è¯·æ±‚ä¹Ÿä¼šç»§ç»­è‡ªæ—‹ç›´åˆ°è·å–é”åæ‰å“åº”ä¸­æ–­è¯·æ±‚å°†è‡ªå·±ç»™æŒ‚èµ·ã€‚è€Œå“åº”çº¿ç¨‹ä¸­æ–­è·å–é”ä¼šåœ¨çº¿ç¨‹è¢«å”¤é†’åç«‹é©¬å“åº”ä¸­æ–­è¯·æ±‚ï¼Œå¦‚æœåœ¨é˜»å¡è¿‡ç¨‹ä¸­æ”¶åˆ°äº†çº¿ç¨‹ä¸­æ–­å°±ä¼šç«‹é©¬æŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚ è®¾ç½®è¶…æ—¶æ—¶é—´è·å–é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//ä»¥é™å®šè¶…æ—¶æ—¶é—´è·å–é”(å…±äº«æ¨¡å¼)public final boolean tryAcquireSharedNanos(int arg, long nanosTimeout) throws InterruptedException { if (Thread.interrupted()) { throw new InterruptedException(); } //1.è°ƒç”¨tryAcquireSharedå°è¯•å»è·å–é” //2.å¦‚æœè·å–å¤±è´¥å°±è°ƒç”¨doAcquireSharedNanos return tryAcquireShared(arg) &gt;= 0 || doAcquireSharedNanos(arg, nanosTimeout);}//ä»¥é™å®šè¶…æ—¶æ—¶é—´è·å–é”(å…±äº«æ¨¡å¼)private boolean doAcquireSharedNanos(int arg, long nanosTimeout) throws InterruptedException { long lastTime = System.nanoTime(); final Node node = addWaiter(Node.SHARED); boolean failed = true; try { for (;;) { //è·å–å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ final Node p = node.predecessor(); if (p == head) { int r = tryAcquireShared(arg); if (r &gt;= 0) { setHeadAndPropagate(node, r); p.next = null; failed = false; return true; } } //å¦‚æœè¶…æ—¶æ—¶é—´ç”¨å®Œäº†å°±ç»“æŸè·å–, å¹¶è¿”å›å¤±è´¥ä¿¡æ¯ if (nanosTimeout &lt;= 0) { return false; } //1.æ£€æŸ¥æ˜¯å¦æ»¡è¶³å°†çº¿ç¨‹æŒ‚èµ·è¦æ±‚(ä¿è¯å‰é©±ç»“ç‚¹çŠ¶æ€ä¸ºSIGNAL) //2.æ£€æŸ¥è¶…æ—¶æ—¶é—´æ˜¯å¦å¤§äºè‡ªæ—‹æ—¶é—´ if (shouldParkAfterFailedAcquire(p, node) &amp;&amp; nanosTimeout &gt; spinForTimeoutThreshold) { //è‹¥æ»¡è¶³ä¸Šé¢ä¸¤ä¸ªæ¡ä»¶å°±å°†å½“å‰çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ LockSupport.parkNanos(this, nanosTimeout); } long now = System.nanoTime(); //è¶…æ—¶æ—¶é—´æ¯æ¬¡å‡å»è·å–é”çš„æ—¶é—´ nanosTimeout -= now - lastTime; lastTime = now; //å¦‚æœåœ¨é˜»å¡æ—¶æ”¶åˆ°ä¸­æ–­è¯·æ±‚å°±ç«‹é©¬æŠ›å‡ºå¼‚å¸¸ if (Thread.interrupted()) { throw new InterruptedException(); } } } finally { if (failed) { cancelAcquire(node); } }} æµç¨‹åŒå‰é¢ä¸¤ç§è·å–é”çš„æ–¹å¼ï¼Œä¸»è¦æ˜¯ç†è§£è¶…æ—¶çš„æœºåˆ¶æ˜¯æ€æ ·çš„ã€‚å¦‚æœç¬¬ä¸€æ¬¡è·å–é”å¤±è´¥ä¼šè°ƒç”¨doAcquireSharedNanosæ–¹æ³•å¹¶ä¼ å…¥è¶…æ—¶æ—¶é—´ï¼Œè¿›å…¥æ–¹æ³•åä¼šæ ¹æ®æƒ…å†µå†æ¬¡å»è·å–é”ï¼Œå¦‚æœå†æ¬¡è·å–å¤±è´¥å°±è¦è€ƒè™‘å°†çº¿ç¨‹æŒ‚èµ·äº†ã€‚è¿™æ—¶ä¼šåˆ¤æ–­è¶…æ—¶æ—¶é—´æ˜¯å¦å¤§äºè‡ªæ—‹æ—¶é—´ï¼Œå¦‚æœæ˜¯çš„è¯å°±ä¼šå°†çº¿ç¨‹æŒ‚èµ·ä¸€æ®µæ—¶é—´ï¼Œå¦åˆ™å°±ç»§ç»­å°è¯•è·å–ï¼Œæ¯æ¬¡è·å–é”ä¹‹åéƒ½ä¼šå°†è¶…æ—¶æ—¶é—´å‡å»è·å–é”çš„æ—¶é—´ï¼Œä¸€ç›´è¿™æ ·å¾ªç¯ç›´åˆ°è¶…æ—¶æ—¶é—´ç”¨å°½ï¼Œå¦‚æœè¿˜æ²¡æœ‰è·å–åˆ°é”çš„è¯å°±ä¼šç»“æŸè·å–å¹¶è¿”å›è·å–å¤±è´¥æ ‡è¯†ã€‚åœ¨æ•´ä¸ªæœŸé—´çº¿ç¨‹æ˜¯å“åº”çº¿ç¨‹ä¸­æ–­çš„ã€‚ å…±äº«æ¨¡å¼ä¸‹é‡Šæ”¾é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)public final boolean releaseShared(int arg) { //1.å°è¯•å»é‡Šæ”¾é” if (tryReleaseShared(arg)) { //2.å¦‚æœé‡Šæ”¾æˆåŠŸå°±å”¤é†’å…¶ä»–çº¿ç¨‹ doReleaseShared(); return true; } return false;}//å°è¯•å»é‡Šæ”¾é”(å…±äº«æ¨¡å¼)protected boolean tryReleaseShared(int arg) { throw new UnsupportedOperationException();}//é‡Šæ”¾é”çš„æ“ä½œ(å…±äº«æ¨¡å¼)private void doReleaseShared() { for (;;) { //è·å–åŒæ­¥é˜Ÿåˆ—çš„headç»“ç‚¹ Node h = head; //åˆ¤æ–­é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰ç»“ç‚¹ if (h != null &amp;&amp; h != tail) { //è·å–headç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ int ws = h.waitStatus; //å¦‚æœheadç»“ç‚¹çš„çŠ¶æ€ä¸ºSIGNAL, è¡¨æ˜åé¢æœ‰äººåœ¨æ’é˜Ÿ if (ws == Node.SIGNAL) { //å…ˆæŠŠheadç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ›´æ–°ä¸º0ï¼ˆæœ‰ä¸¤ä¸ªåœ°æ–¹è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼‰ if (!compareAndSetWaitStatus(h, Node.SIGNAL, 0)) { continue; } //å†å»å”¤é†’åç»§ç»“ç‚¹ unparkSuccessor(h); //å¦‚æœheadç»“ç‚¹çš„çŠ¶æ€ä¸º0, è¡¨æ˜æ­¤æ—¶åé¢æ²¡äººåœ¨æ’é˜Ÿ, å°±åªæ˜¯å°†headçŠ¶æ€ä¿®æ”¹ä¸ºPROPAGATE }else if (ws == 0 &amp;&amp; !compareAndSetWaitStatus(h, 0, Node.PROPAGATE)) { continue; } } //åªæœ‰ä¿è¯æœŸé—´headç»“ç‚¹æ²¡è¢«ä¿®æ”¹è¿‡æ‰èƒ½è·³å‡ºå¾ªç¯ if (h == head) { break; } }} çº¿ç¨‹åœ¨æˆ¿é—´åŠå®Œäº‹ä¹‹åå°±ä¼šè°ƒç”¨releaseSharedæ–¹æ³•é‡Šæ”¾é”ï¼Œé¦–å…ˆè°ƒç”¨tryReleaseSharedæ–¹æ³•å°è¯•é‡Šæ”¾é”ï¼Œè¯¥æ–¹æ³•çš„åˆ¤æ–­é€»è¾‘ç”±å­ç±»å®ç°ã€‚å¦‚æœé‡Šæ”¾æˆåŠŸå°±è°ƒç”¨doReleaseSharedæ–¹æ³•å»å”¤é†’åç»§ç»“ç‚¹ã€‚èµ°å‡ºæˆ¿é—´åå®ƒä¼šæ‰¾åˆ°åŸå…ˆçš„åº§ä½(headç»“ç‚¹)ï¼Œçœ‹çœ‹åº§ä½ä¸Šæ˜¯å¦æœ‰äººç•™äº†å°çº¸æ¡(çŠ¶æ€ä¸ºSIGNAL)ï¼Œå¦‚æœæœ‰å°±å»å”¤é†’åç»§ç»“ç‚¹ã€‚å¦‚æœæ²¡æœ‰(çŠ¶æ€ä¸º0)å°±ä»£è¡¨é˜Ÿåˆ—æ²¡äººåœ¨æ’é˜Ÿï¼Œé‚£ä¹ˆåœ¨ç¦»å¼€ä¹‹å‰å®ƒè¿˜è¦åšæœ€åä¸€ä»¶äº‹æƒ…ï¼Œå°±æ˜¯åœ¨è‡ªå·±åº§ä½ä¸Šç•™ä¸‹å°çº¸æ¡(çŠ¶æ€è®¾ç½®ä¸ºPROPAGATE)ï¼Œå‘Šè¯‰åé¢çš„äººé”çš„è·å–çŠ¶æ€ï¼Œæ•´ä¸ªé‡Šæ”¾é”çš„è¿‡ç¨‹å’Œç‹¬å æ¨¡å¼å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯åœ¨è¿™æœ€åä¸€æ­¥æ“ä½œã€‚ &lt;font color="red"&gt;PSï¼š&lt;/font&gt;ä¸Šé¢è¯´äº†doReleaseShared()çš„ä»£ç æµç¨‹ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸¤å¤„åœ°æ–¹è°ƒç”¨ï¼š ç¬¬ä¸€å¤„è°ƒç”¨çš„åœ°æ–¹ï¼šåˆšåˆšé‡Šæ”¾èµ„æºçš„è€çš„headè°ƒç”¨ï¼Œåœ¨ä»£ç ä¸­å°±æ˜¯releaseShared()æ–¹æ³•ä¸­è°ƒç”¨ã€‚ ç¬¬äºŒå¤„è°ƒç”¨çš„åœ°æ–¹ï¼šåˆšåˆšè®¾ç½®æ–°çš„å¤´ç»“ç‚¹headè°ƒç”¨ï¼Œåœ¨ä»£ç ä¸­å°±æ˜¯setHeadAndPropagate()æ–¹æ³•ä¸­è°ƒç”¨ã€‚ ä¸Šé¢çš„æ–¹æ³•çœ‹åˆ°headèŠ‚ç‚¹çš„çŠ¶æ€è¦ä¹ˆæ˜¯SIGNAL(SIGNALâ€”â€”&gt;0),è¦ä¹ˆæ˜¯0(0â€”â€”&gt;PROPAGATE)ï¼Œè¿™äº›çŠ¶æ€æ€æ ·æ¥çš„ï¼Ÿ çŠ¶æ€ä¸ºSIGNALçš„ç”±æ¥ï¼šå¤´ç»“ç‚¹çš„åç»§èŠ‚ç‚¹è¢«æŒ‚èµ·äº†ï¼ŒæŒ‚èµ·çš„åŒæ—¶ä¼šå°†å®ƒçš„å‰é©±èŠ‚ç‚¹çŠ¶æ€ç½®ä¸ºSIGNALï¼Œä»¥ä¾¿äºè¢«å”¤é†’ã€‚ çŠ¶æ€ä¸º0çš„ç”±æ¥ï¼šè¿™ä¸ªçŠ¶æ€æ˜¯é»˜è®¤çŠ¶æ€ï¼Œåç»§èŠ‚ç‚¹æ²¡æœ‰è¢«æŒ‚èµ·å°±å°è¯•è·å–èµ„æºæˆåŠŸäº†ï¼Œæ­¤æ—¶å¹¶æ²¡æœ‰è°ƒç”¨åˆ¤æ–­æŒ‚èµ·çš„æ–¹æ³•ï¼Œæ‰€ä»¥å¤´ç»“ç‚¹çš„çŠ¶æ€æ²¡æœ‰å˜åŒ–ã€‚ ç¬¬ä¸€ä¸ªåˆ†æçš„é‡ç‚¹ï¼šå¦‚æœåªæœ‰åˆšåˆšé‡Šæ”¾èµ„æºçš„è€çš„headè°ƒç”¨äº†æ­¤æ–¹æ³•ï¼Œè¿™ä¸ªæ—¶å€™æ²¡æœ‰ç«äº‰ï¼Œå¦‚æœå¤´ç»“ç‚¹headçš„waitStatusç­‰äºSIGNALï¼Œåˆ™é¦–å…ˆå°†SIGNALâ€”â€”&gt;0,å¦‚æœæˆåŠŸåˆ™è°ƒç”¨unparkSuccessor()æ–¹æ³•å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å¦‚æœå¤´ç»“ç‚¹headçš„waitStatusç­‰äº0ï¼Œåˆ™å°†0â€”â€”&gt;PROPAGATE,ä¸æˆåŠŸåˆ™ç»§ç»­å¾ªç¯ã€‚ ç¬¬äºŒä¸ªåˆ†æçš„é‡ç‚¹ï¼šå¦‚æœåˆšåˆšé‡Šæ”¾èµ„æºçš„è€headï¼Œå’Œåˆšè·å–èµ„æºè®¾ç½®æ–°çš„å¤´ç»“ç‚¹çš„headåŒæ—¶è°ƒç”¨è¿™ä¸ªæ–¹æ³•ï¼Œé‚£ä¹ˆä¸¤è€…è·å–çš„headå¯èƒ½æœ‰æ‰€ä¸åŒï¼Œå‰è€…è€headè·å–çš„hå¯èƒ½æ˜¯è‡ªå·±ï¼Œä¹Ÿå¯èƒ½æ˜¯æ–°çš„headï¼Œåè€…æ–°headè·å–çš„hä¸€å®šæ˜¯è‡ªå·±ã€‚ä½†æ˜¯ä¸ç®¡headè·å–çš„æ˜¯è€çš„ï¼Œè¿˜æ˜¯æ–°çš„ï¼Œéƒ½èƒ½å¤Ÿé¡ºåˆ©çš„å”¤é†’ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼Œåªä¸è¿‡å¯èƒ½å¤šå”¤é†’ä¸€æ¬¡è€Œå·²ï¼Œè¿™å¹¶ä¸å½±å“ç»“æœã€‚ ç¬¬ä¸‰ä¸ªåˆ†æçš„é‡ç‚¹ï¼šæœ€åä¸ºä»€ä¹ˆä¼šåˆ¤æ–­h==headï¼Ÿå¦‚æœå¤´ç»“ç‚¹headå‘ç”Ÿå˜åŒ–ï¼Œå¯èƒ½å…¶ä»–çº¿ç¨‹è·å–äº†èµ„æºæŠŠheadæ”¹å˜äº†ï¼Œä¸ºäº†ä½¿è‡ªå·±çš„å”¤é†’åŠ¨ä½œä¼ é€’ï¼Œå¿…é¡»é‡è¯•ã€‚ å…¶å®doReleaseShared()æ–¹æ³•å°±æ˜¯èƒ½å¤Ÿä¿è¯å”¤é†’ä¸‹é¢çš„èŠ‚ç‚¹ï¼Œå¹¶ä¸”èƒ½å¤Ÿä¼ é€’ä¸‹å»ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¹¶å‘-AQSæºç åˆ†æä¹‹æ¦‚è¦åˆ†æ]]></title>
    <url>%2Fposts%2F115e562c.html</url>
    <content type="text"><![CDATA[AbstractQueuedSynchronizeræ˜¯åšä»€ä¹ˆçš„ java.util.concurrentè¿™ä¸ªåŒ…ä¸‹æœ‰å¾ˆå¤šç±»ï¼Œæ¯”å¦‚ReentrantLockã€CountDownLatchã€CyclicBarrrierã€Semaphoreç­‰ï¼Œå®ƒä»¬çš„å®ç°ä¸­éƒ½æœ‰ä¸€ä¸ªå†…éƒ¨ç±»Syncï¼Œè¿™ä¸ªç±»ç»§æ‰¿äº†AbstractQueuedSynchronizerï¼ˆç®€ç§°AQSï¼‰ï¼Œæ‰€æœ‰çš„é”æœºåˆ¶çš„å®ç°éƒ½ä¾èµ–äºSyncå†…éƒ¨ç±»ï¼Œä¹Ÿå¯ä»¥è¯´è¿™äº›ç±»çš„å®ç°å°±æ˜¯ä¾èµ–äºAQSã€‚ é‚£ä¹ˆAQSå†…éƒ¨åˆ°åº•å®ç°äº†ä»€ä¹ˆä»¥è‡³äºè¿™äº›ç±»éƒ½è¦ä¾èµ–äºå®ƒå‘¢ï¼Ÿå¯ä»¥è¿™æ ·è¯´ï¼ŒAQSä¸ºè¿™äº›ç±»æä¾›äº†åŸºç¡€è®¾æ–½ï¼Œä¹Ÿå°±æ˜¯æä¾›äº†ä¸€ä¸ªå¯†ç é”ï¼Œè¿™äº›ç±»æ‹¥æœ‰äº†å¯†ç é”ä¹‹åå¯ä»¥è‡ªå·±æ¥è®¾ç½®å¯†ç é”çš„å¯†ç ã€‚æ­¤å¤–ï¼ŒAQSè¿˜æä¾›äº†ä¸€ä¸ªæ’é˜ŸåŒºï¼Œå¹¶ä¸”æä¾›äº†ä¸€ä¸ªçº¿ç¨‹è®­å¯¼å‘˜ï¼Œæˆ‘ä»¬çŸ¥é“çº¿ç¨‹å°±åƒä¸€ä¸ªåŸå§‹çš„é‡è›®äººï¼Œå®ƒä¸æ‡‚å¾—è®²ç¤¼è²Œï¼Œå®ƒåªä¼šæ¨ªå†²ç›´æ’ï¼Œæ‰€ä»¥ä½ å¾—ä¸€æ­¥ä¸€æ­¥å»æ•™å®ƒï¼Œå‘Šè¯‰å®ƒä»€ä¹ˆæ—¶å€™éœ€è¦å»æ’é˜Ÿäº†ï¼Œè¦åˆ°å“ªé‡Œå»æ’é˜Ÿï¼Œæ’é˜Ÿå‰è¦åšäº›ä»€ä¹ˆï¼Œæ’é˜Ÿåè¦åšäº›ä»€ä¹ˆã€‚è¿™äº›æ•™åŒ–å·¥ä½œå…¨éƒ¨éƒ½ç”±AQSå¸®ä½ å®Œæˆäº†ï¼Œä»å®ƒè¿™é‡Œæ•™åŒ–å‡ºæ¥çš„çº¿ç¨‹éƒ½å˜çš„éå¸¸æ–‡æ˜æ‡‚ç¤¼è²Œï¼Œä¸å†æ˜¯åŸå§‹çš„é‡è›®äººï¼Œæ‰€ä»¥ä»¥åæˆ‘ä»¬åªéœ€è¦å’Œè¿™äº›æ–‡æ˜çš„çº¿ç¨‹æ‰“äº¤é“å°±è¡Œäº†ï¼Œåƒä¸‡ä¸è¦å’ŒåŸå§‹çº¿ç¨‹æœ‰è¿‡å¤šçš„æ¥è§¦ï¼ ä¸ºä½•è¯´AQSæä¾›äº†ä¸€æŠŠå¯†ç é” 1234567891011121314151617181920212223//åŒæ­¥é˜Ÿåˆ—çš„å¤´ç»“ç‚¹private transient volatile Node head; //åŒæ­¥é˜Ÿåˆ—çš„å°¾ç»“ç‚¹private transient volatile Node tail;//åŒæ­¥çŠ¶æ€private volatile int state;//è·å–åŒæ­¥çŠ¶æ€protected final int getState() { return state;}//è®¾ç½®åŒæ­¥çŠ¶æ€protected final void setState(int newState) { state = newState;}//ä»¥CASæ–¹å¼è®¾ç½®åŒæ­¥çŠ¶æ€protected final boolean compareAndSetState(int expect, int update) { return unsafe.compareAndSwapInt(this, stateOffset, expect, update);} ä¸Šé¢çš„ä»£ç åˆ—å‡ºäº†AQSçš„æ‰€æœ‰æˆå‘˜å˜é‡ï¼Œå¯ä»¥çœ‹åˆ°AQSçš„æˆå‘˜å˜é‡åªæœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯åŒæ­¥é˜Ÿåˆ—å¤´ç»“ç‚¹å¼•ç”¨ï¼ŒåŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ä»¥åŠåŒæ­¥çŠ¶æ€ã€‚ æ³¨æ„ï¼Œè¿™ä¸‰ä¸ªæˆå‘˜å˜é‡éƒ½ä½¿ç”¨äº†volatileå…³é”®å­—è¿›è¡Œä¿®é¥°ï¼Œè¿™å°±ç¡®ä¿äº†å¤šä¸ªçº¿ç¨‹å¯¹å®ƒçš„ä¿®æ”¹éƒ½æ˜¯å†…å­˜å¯è§çš„ã€‚ æ•´ä¸ªç±»çš„æ ¸å¿ƒå°±æ˜¯è¿™ä¸ªåŒæ­¥çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°åŒæ­¥çŠ¶æ€å…¶å®å°±æ˜¯ä¸€ä¸ªintå‹çš„å˜é‡ï¼Œå¤§å®¶å¯ä»¥æŠŠè¿™ä¸ªåŒæ­¥çŠ¶æ€çœ‹æˆä¸€ä¸ªå¯†ç é”ï¼Œè€Œä¸”è¿˜æ˜¯ä»æˆ¿é—´é‡Œé¢é”èµ·æ¥çš„å¯†ç é”ï¼Œstateå…·ä½“çš„å€¼å°±ç›¸å½“äºå¯†ç æ§åˆ¶ç€å¯†ç é”çš„å¼€åˆã€‚ å½“ç„¶è¿™ä¸ªé”çš„å¯†ç æ˜¯å¤šå°‘å°±ç”±å„ä¸ªå­ç±»æ¥è§„å®šäº†ï¼Œä¾‹å¦‚åœ¨ReentrantLockä¸­ï¼Œstateç­‰äº0è¡¨ç¤ºé”æ˜¯å¼€çš„ï¼Œstateå¤§äº0è¡¨ç¤ºé”æ˜¯é”ç€çš„ï¼Œè€Œåœ¨Semaphoreä¸­ï¼Œstateå¤§äº0è¡¨ç¤ºé”æ˜¯å¼€çš„ï¼Œstateç­‰äº0è¡¨ç¤ºé”æ˜¯é”ç€çš„ã€‚ AQSçš„æ’é˜ŸåŒºæ˜¯æ€æ ·å®ç°çš„ AQSå†…éƒ¨å…¶å®æœ‰ä¸¤ä¸ªæ’é˜ŸåŒºï¼Œä¸€ä¸ªæ˜¯åŒæ­¥é˜Ÿåˆ—ï¼Œä¸€ä¸ªæ˜¯æ¡ä»¶é˜Ÿåˆ—ã€‚ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒåŒæ­¥é˜Ÿåˆ—åªæœ‰ä¸€æ¡ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—å¯ä»¥æœ‰å¤šæ¡ã€‚åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹åˆ†åˆ«æŒæœ‰å‰åç»“ç‚¹çš„å¼•ç”¨ï¼Œè€Œæ¡ä»¶é˜Ÿåˆ—çš„ç»“ç‚¹åªæœ‰ä¸€ä¸ªæŒ‡å‘åç»§ç»“ç‚¹çš„å¼•ç”¨ã€‚å›¾ä¸­Tè¡¨ç¤ºçº¿ç¨‹ï¼Œæ¯ä¸ªç»“ç‚¹åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼Œçº¿ç¨‹åœ¨è·å–é”å¤±è´¥åé¦–å…ˆè¿›å…¥åŒæ­¥é˜Ÿåˆ—æ’é˜Ÿï¼Œè€Œæƒ³è¦è¿›å…¥æ¡ä»¶é˜Ÿåˆ—è¯¥çº¿ç¨‹å¿…é¡»æŒæœ‰é”æ‰è¡Œã€‚æ¥ä¸‹æ¥çœ‹çœ‹é˜Ÿåˆ—ä¸­æ¯ä¸ªç»“ç‚¹çš„ç»“æ„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172//åŒæ­¥é˜Ÿåˆ—çš„ç»“ç‚¹static final class Node { static final Node SHARED = new Node(); //è¡¨ç¤ºå½“å‰çº¿ç¨‹ä»¥å…±äº«æ¨¡å¼æŒæœ‰é” static final Node EXCLUSIVE = null; //è¡¨ç¤ºå½“å‰çº¿ç¨‹ä»¥ç‹¬å æ¨¡å¼æŒæœ‰é” static final int CANCELLED = 1; //è¡¨ç¤ºå½“å‰ç»“ç‚¹å·²ç»å–æ¶ˆè·å–é” static final int SIGNAL = -1; //è¡¨ç¤ºåç»§ç»“ç‚¹çš„çº¿ç¨‹éœ€è¦è¿è¡Œ static final int CONDITION = -2; //è¡¨ç¤ºå½“å‰ç»“ç‚¹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­æ’é˜Ÿ static final int PROPAGATE = -3; //è¡¨ç¤ºåç»§ç»“ç‚¹å¯ä»¥ç›´æ¥è·å–é”(PROPAGATEä¸ºä¸‹ä¸€ä¸ªacquireSharedæ— æ¡ä»¶ä¼ æ’­çš„çŠ¶æ€ï¼Œç”¨äºå…±äº«æ¨¡å¼) volatile int waitStatus; //è¡¨ç¤ºå½“å‰ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ï¼ˆé»˜è®¤å€¼ä¸º0ï¼‰ volatile Node prev; //è¡¨ç¤ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±ç»“ç‚¹ volatile Node next; //è¡¨ç¤ºåŒæ­¥é˜Ÿåˆ—ä¸­çš„åç»§ç»“ç‚¹ volatile Thread thread; //å½“å‰ç»“ç‚¹æŒæœ‰çš„çº¿ç¨‹å¼•ç”¨ Node nextWaiter; //è¡¨ç¤ºæ¡ä»¶é˜Ÿåˆ—ä¸­çš„åç»§ç»“ç‚¹ /** * å½“å‰ç»“ç‚¹çŠ¶æ€æ˜¯å¦æ˜¯å…±äº«æ¨¡å¼ */ final boolean isShared() { return nextWaiter == SHARED; } /** * è¿”å›å½“å‰ç»“ç‚¹çš„å‰é©±ç»“ç‚¹ */ final Node predecessor() throws NullPointerException { Node p = prev; if (p == null) { throw new NullPointerException(); } else { return p; } } /** * ç©ºæ„é€ å‡½æ•°ï¼šä¸»è¦ç”¨äºåˆå§‹åŒ–å¤´ç»“ç‚¹(head)æˆ–è€…åˆ›å»ºå…±äº«æ¨¡å¼ */ Node() {} /** * é»˜è®¤ç”¨è¿™ä¸ªæ„é€ å™¨ï¼ˆä¸»è¦ç”¨äºæŠŠèŠ‚ç‚¹æ·»åŠ åˆ°é˜Ÿåˆ—ä¸­ï¼‰ * * @param thread å½“å‰çº¿ç¨‹ * @param mode ç»“ç‚¹æ¨¡å¼ */ Node(Thread thread, Node mode) { //æ³¨æ„æŒæœ‰æ¨¡å¼æ˜¯èµ‹å€¼ç»™nextWaiter this.nextWaiter = mode; this.thread = thread; } /** * åªåœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­ç”¨åˆ° * * @param thread å½“å‰çº¿ç¨‹ * @param waitStatus ç»“ç‚¹çŠ¶æ€ */ Node(Thread thread, int waitStatus) { this.waitStatus = waitStatus; this.thread = thread; }} Nodeä»£è¡¨åŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—ä¸­çš„ä¸€ä¸ªç»“ç‚¹ï¼Œå®ƒæ˜¯AQSçš„å†…éƒ¨ç±»ã€‚Nodeæœ‰å¾ˆå¤šå±æ€§ï¼Œæ¯”å¦‚æŒæœ‰æ¨¡å¼ï¼Œç­‰å¾…çŠ¶æ€ï¼ŒåŒæ­¥é˜Ÿåˆ—ä¸­çš„å‰é©±å’Œåç»§ï¼Œä»¥åŠæ¡ä»¶é˜Ÿåˆ—ä¸­çš„åç»§å¼•ç”¨ç­‰ç­‰ã€‚å¯ä»¥æŠŠåŒæ­¥é˜Ÿåˆ—å’Œæ¡ä»¶é˜Ÿåˆ—çœ‹æˆæ˜¯æ’é˜ŸåŒºï¼Œæ¯ä¸ªç»“ç‚¹çœ‹æˆæ˜¯æ’é˜ŸåŒºçš„åº§ä½ï¼Œå°†çº¿ç¨‹çœ‹æˆæ˜¯æ’é˜Ÿçš„å®¢äººã€‚å®¢äººåˆšæ¥æ—¶ä¼šå…ˆå»æ•²æ•²é—¨ï¼Œçœ‹çœ‹é”æœ‰æ²¡æœ‰å¼€ï¼Œå¦‚æœé”æ²¡å¼€å®ƒå°±ä¼šå»æ’é˜ŸåŒºé¢†å–ä¸€ä¸ªå·ç ç‰Œï¼Œå£°æ˜è‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥æŒæœ‰é”ï¼Œæœ€åå†åˆ°é˜Ÿåˆ—çš„æœ«å°¾è¿›è¡Œæ’é˜Ÿã€‚ æ€æ ·ç†è§£ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ å‰é¢è®²åˆ°æ¯ä¸ªå®¢äººåœ¨æ’é˜Ÿå‰ä¼šé¢†å–ä¸€ä¸ªå·ç ç‰Œï¼Œå£°æ˜è‡ªå·±æƒ³è¦ä»¥ä»€ä¹ˆæ ·çš„æ–¹å¼æ¥å æœ‰é”ï¼Œå æœ‰é”çš„æ–¹å¼åˆ†ä¸ºç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼ï¼Œé‚£ä¹ˆæ€æ ·æ¥ç†è§£ç‹¬å æ¨¡å¼å’Œå…±äº«æ¨¡å¼å‘¢ï¼Ÿæ‰“ä¸ªæ¯”æ–¹ï¼Œå¤§å®¶è”æƒ³ä¸€ä¸‹å»é£Ÿå ‚åƒé¥­ï¼Œæ­£å¥½æœ‰ä¸€ä¸ªæ¡Œå­ç©ºç€ï¼Œç‹¬å æ¨¡å¼çš„äººæ¯”è¾ƒéœ¸é“ï¼Œè€å­è¦ä¹ˆå°±ä¸åï¼Œåä¸‹æ¥å°±ä¸å…è®¸åˆ«äººåï¼Œè‡ªå·±ä¸€ä¸ªäººç‹¬è‡ªå ç”¨æ•´ä¸ªæ¡Œå­ã€‚å…±äº«æ¨¡å¼çš„äººå°±æ²¡é‚£ä¹ˆè®²ç©¶äº†ï¼Œå½“å®ƒå‘ç°è¿™ä¸ªæ¡Œå­å¯ä»¥ç”¨ï¼Œè‡ªå·±åä¸‹è¿˜ä¸ç®—ï¼Œè¿˜å¾—çƒ­å¿ƒçš„é—®ä¸‹åé¢çš„äººä»‹ä¸ä»‹æ„ä¸€èµ·ï¼Œå¦‚æœåé¢çš„äººä¸ä»‹æ„ä¸€èµ·é‚£å°±ä¸ç”¨å†æ’é˜Ÿäº†ï¼Œ å½“ç„¶å¦‚æœåé¢çš„äººä»‹æ„é‚£å°±åªå¥½ç•™åœ¨é˜Ÿåˆ—é‡Œç»§ç»­æ’é˜Ÿäº†ã€‚ æ€æ ·ç†è§£ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€ æ¯ä¸ªç»“ç‚¹éƒ½æœ‰ä¸€ä¸ªç­‰å¾…çŠ¶æ€ï¼Œè¿™ä¸ªç­‰å¾…çŠ¶æ€åˆ†ä¸ºCANCELLEDï¼ŒSIGNALï¼ŒCONDITIONï¼ŒPROPAGATEå››ç§çŠ¶æ€ã€‚å¯ä»¥å°†è¿™ä¸ªç­‰å¾…çŠ¶æ€çœ‹ä½œæ˜¯æŒ‚åœ¨åº§ä½æ—è¾¹çš„ç‰Œå­ï¼Œæ ‡è¯†å½“å‰åº§ä½ä¸Šçš„äººçš„ç­‰å¾…çŠ¶æ€ã€‚è¿™ä¸ªç‰Œå­çš„çŠ¶æ€ä¸ä»…è‡ªå·±å¯ä»¥ä¿®æ”¹ï¼Œå…¶ä»–äººä¹Ÿå¯ä»¥ä¿®æ”¹ã€‚ä¾‹å¦‚å½“è¿™ä¸ªçº¿ç¨‹åœ¨æ’é˜Ÿè¿‡ç¨‹ä¸­å·²ç»æ‰“ç®—æ”¾å¼ƒäº†ï¼Œå®ƒå°±ä¼šå°†è‡ªå·±åº§ä½ä¸Šçš„ç‰Œå­è®¾ç½®ä¸ºCANCELLEDï¼Œè¿™æ ·å…¶ä»–äººçœ‹åˆ°äº†å°±å¯ä»¥å°†å®ƒæ¸…ç†å‡ºé˜Ÿåˆ—ã€‚è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯ï¼Œå½“çº¿ç¨‹åœ¨åº§ä½ä¸Šè¦ç¡ç€ä¹‹å‰ï¼Œå®ƒæ€•è‡ªå·±ç¡è¿‡äº†å¤´ï¼Œå°±ä¼šå°†å‰é¢ä½ç½®ä¸Šçš„ç‰Œå­æ”¹ä¸ºSIGNALï¼Œå› ä¸ºæ¯ä¸ªäººåœ¨ç¦»å¼€é˜Ÿåˆ—å‰éƒ½ä¼šå›åˆ°è‡ªå·±åº§ä½ä¸Šçœ‹ä¸€çœ¼ï¼Œå¦‚æœçœ‹åˆ°ç‰Œå­ä¸ŠçŠ¶æ€ä¸ºSIGNALï¼Œå®ƒå°±ä¼šå»å”¤é†’ä¸‹ä¸€ä¸ªäººã€‚åªæœ‰ä¿è¯å‰é¢ä½ç½®ä¸Šçš„ç‰Œå­ä¸ºSIGNALï¼Œå½“å‰çº¿ç¨‹æ‰ä¼šå®‰å¿ƒçš„ç¡å»ã€‚CONDITIONçŠ¶æ€è¡¨ç¤ºè¯¥çº¿ç¨‹åœ¨æ¡ä»¶é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼ŒPROPAGATEçŠ¶æ€æé†’åé¢æ¥çš„çº¿ç¨‹å¯ä»¥ç›´æ¥è·å–é”ï¼Œè¿™ä¸ªçŠ¶æ€åªåœ¨å…±äº«æ¨¡å¼ç”¨åˆ°ã€‚ ç»“ç‚¹è¿›å…¥åŒæ­¥é˜Ÿåˆ—æ—¶ä¼šè¿›è¡Œå“ªäº›æ“ä½œ 123456789101112131415161718192021222324//ç»“ç‚¹å…¥é˜Ÿæ“ä½œ, è¿”å›å‰ä¸€ä¸ªç»“ç‚¹private Node enq(final Node node) { for (;;) { //è·å–åŒæ­¥é˜Ÿåˆ—å°¾ç»“ç‚¹å¼•ç”¨ Node t = tail; //å¦‚æœå°¾ç»“ç‚¹ä¸ºç©ºè¯´æ˜åŒæ­¥é˜Ÿåˆ—è¿˜æ²¡æœ‰åˆå§‹åŒ– if (t == null) { //åˆå§‹åŒ–åŒæ­¥é˜Ÿåˆ— if (compareAndSetHead(new Node())) { tail = head; } } else { //1.æŒ‡å‘å½“å‰å°¾ç»“ç‚¹ node.prev = t; //2.è®¾ç½®å½“å‰ç»“ç‚¹ä¸ºå°¾ç»“ç‚¹ if (compareAndSetTail(t, node)) { //3.å°†æ—§çš„å°¾ç»“ç‚¹çš„åç»§æŒ‡å‘æ–°çš„å°¾ç»“ç‚¹ t.next = node; //forå¾ªç¯å”¯ä¸€çš„å‡ºå£ return t; } } }} æ³¨æ„ï¼Œå…¥é˜Ÿæ“ä½œä½¿ç”¨ä¸€ä¸ªæ­»å¾ªç¯ï¼Œåªæœ‰æˆåŠŸå°†ç»“ç‚¹æ·»åŠ åˆ°åŒæ­¥é˜Ÿåˆ—å°¾éƒ¨æ‰ä¼šè¿”å›ï¼Œè¿”å›ç»“æœæ˜¯åŒæ­¥é˜Ÿåˆ—åŸå…ˆçš„å°¾ç»“ç‚¹ã€‚ä¸‹å›¾æ¼”ç¤ºäº†æ•´ä¸ªæ“ä½œè¿‡ç¨‹ã€‚ æ·»åŠ å°¾ç»“ç‚¹çš„é¡ºåºï¼Œåˆ†ä¸ºä¸‰æ­¥ï¼šæŒ‡å‘å°¾ç»“ç‚¹ï¼ŒCASæ›´æ”¹å°¾ç»“ç‚¹ï¼Œå°†æ—§å°¾ç»“ç‚¹çš„åç»§æŒ‡å‘å½“å‰ç»“ç‚¹ã€‚åœ¨å¹¶å‘ç¯å¢ƒä¸­è¿™ä¸‰æ­¥æ“ä½œä¸ä¸€å®šèƒ½ä¿è¯å®Œæˆï¼Œæ‰€ä»¥åœ¨æ¸…ç©ºåŒæ­¥é˜Ÿåˆ—æ‰€æœ‰å·²å–æ¶ˆçš„ç»“ç‚¹è¿™ä¸€æ“ä½œä¸­ï¼Œä¸ºäº†å¯»æ‰¾éå–æ¶ˆçŠ¶æ€çš„ç»“ç‚¹ï¼Œä¸æ˜¯ä»å‰å‘åéå†è€Œæ˜¯ä»åå‘å‰éå†çš„ã€‚è¿˜æœ‰å°±æ˜¯æ¯ä¸ªç»“ç‚¹è¿›å…¥é˜Ÿåˆ—ä¸­æ—¶å®ƒçš„ç­‰å¾…çŠ¶æ€æ˜¯ä¸º0ï¼Œåªæœ‰åç»§ç»“ç‚¹çš„çº¿ç¨‹éœ€è¦æŒ‚èµ·æ—¶æ‰ä¼šå°†å‰é¢ç»“ç‚¹çš„ç­‰å¾…çŠ¶æ€æ”¹ä¸ºSIGNALã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ç”±å‰”é™¤Intellijä¸­Mybatisçš„Mapperè‡ªåŠ¨æ³¨å…¥è­¦å‘Šå¼•å…¥å¯¹æ³¨è§£çš„å­¦ä¹ ]]></title>
    <url>%2Fposts%2F8b9fb30a.html</url>
    <content type="text"><![CDATA[èµ·æº ç›¸ä¿¡ä½¿ç”¨Mybatisçš„å°ä¼™ä»¬ä¸€å®šç»å¸¸ç¼–å†™ç±»ä¼¼å¦‚ä¸‹çš„ä»£ç ï¼š å¯ä»¥çœ‹åˆ° userMapper ä¸‹æœ‰ä¸ªçº¢è‰²è­¦å‘Šã€‚è™½ç„¶ä»£ç æœ¬èº«å¹¶æ²¡æœ‰é—®é¢˜ï¼Œèƒ½æ­£å¸¸è¿è¡Œï¼Œä½†æœ‰ä¸ªè­¦å‘Šæ€»å½’æœ‰ç‚¹æ¶å¿ƒã€‚å…ˆçœ‹ä¸‹è­¦å‘Šä¿¡æ¯ï¼š Spring team recommends: "Always use constructor based dependency injection in your beans. Always use assertions for mandatory dependencies." åŸå›  ä¼—æ‰€å‘¨çŸ¥ï¼ŒIDEAæ˜¯éå¸¸æ™ºèƒ½çš„ï¼Œå®ƒå¯ä»¥ç†è§£Springçš„ä¸Šä¸‹æ–‡ã€‚ç„¶è€Œ UserMapper è¿™ä¸ªæ¥å£æ˜¯Mybatisçš„ï¼ŒIDEAç†è§£ä¸äº†ã€‚ è€Œ @Autowired æ³¨è§£ï¼Œé»˜è®¤æƒ…å†µä¸‹è¦æ±‚ä¾èµ–å¯¹è±¡ï¼ˆä¹Ÿå°±æ˜¯ userMapper ï¼‰å¿…é¡»å­˜åœ¨ã€‚è€ŒIDEAè®¤ä¸ºè¿™ä¸ªå¯¹è±¡çš„å®ä¾‹/ä»£ç†æ˜¯ä¸ªnullï¼Œæ‰€ä»¥å°±å‹å¥½åœ°ç»™ä¸ªæç¤ºã€‚æŒ‰ç…§æç¤ºä¿®æ”¹å¦‚ä¸‹ï¼š 123456private final UserMapper userMapper;@Autowiredpublic UserServiceImpl(UserMapper userMapper) { this.userMapper = userMapper;} æ­¤æ—¶ä»ç„¶å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼š 1Could not autowire. è‡ªåŠ¨æ³¨å…¥ beanï¼Œ springå¸®åŠ©æˆ‘ä»¬å®Œæˆäº†ï¼Œä½†æ˜¯åŒæ—¶Springæä¾›äº†ä¸€äº›æ³¨è§£æ¥æ˜¾å¼çš„æ³¨æ˜beanä¹‹é—´çš„å¼•ç”¨å…³ç³»ï¼Œå…¶ä¸­æœ€ä¸ºç†ŸçŸ¥çš„è‡ªç„¶æ˜¯@Controller,@Service,@Repository,@Componentç­‰ã€‚ è¿™é‡Œå…¶å®ç»™UserMapperæ¥å£åŠ ä¸Š@Repository,@Componentå°±å¯ä»¥è§£å†³ï¼Œé‚£ä¹ˆä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ åŒºåˆ« Springä¸ä½†æ”¯æŒè‡ªå·±å®šä¹‰çš„@Autowiredæ³¨è§£ï¼Œè¿˜æ”¯æŒå‡ ä¸ªç”±JSR-250è§„èŒƒå®šä¹‰çš„æ³¨è§£ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯@Resourceã€@PostConstructä»¥åŠ@PreDestroyã€‚ @Resourceçš„ä½œç”¨ç›¸å½“äº@Autowiredï¼Œåªä¸è¿‡@AutowiredæŒ‰byTypeè‡ªåŠ¨æ³¨å…¥ï¼Œè€Œ@Resourceé»˜è®¤æŒ‰ byNameè‡ªåŠ¨æ³¨å…¥ç½¢äº†ã€‚@Resourceæœ‰ä¸¤ä¸ªå±æ€§æ˜¯æ¯”è¾ƒé‡è¦çš„ï¼Œåˆ†æ˜¯nameå’Œtypeï¼ŒSpringå°†@Resourceæ³¨è§£çš„nameå±æ€§è§£æä¸ºbeançš„åå­—ï¼Œè€Œtypeå±æ€§åˆ™è§£æä¸ºbeançš„ç±»å‹ã€‚æ‰€ä»¥å¦‚æœä½¿ç”¨nameå±æ€§ï¼Œåˆ™ä½¿ç”¨byNameçš„è‡ªåŠ¨æ³¨å…¥ç­–ç•¥ï¼Œè€Œä½¿ç”¨typeå±æ€§æ—¶åˆ™ä½¿ç”¨byTypeè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚å¦‚æœæ—¢ä¸æŒ‡å®šnameä¹Ÿä¸æŒ‡å®štypeå±æ€§ï¼Œè¿™æ—¶å°†é€šè¿‡åå°„æœºåˆ¶ä½¿ç”¨byNameè‡ªåŠ¨æ³¨å…¥ç­–ç•¥ã€‚ @Resourceè£…é…é¡ºåº å¦‚æœåŒæ—¶æŒ‡å®šäº†nameå’Œtypeï¼Œåˆ™ä»Springä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°å”¯ä¸€åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ å¦‚æœæŒ‡å®šäº†nameï¼Œåˆ™ä»ä¸Šä¸‹æ–‡ä¸­æŸ¥æ‰¾åç§°ï¼ˆidï¼‰åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ å¦‚æœæŒ‡å®šäº†typeï¼Œåˆ™ä»ä¸Šä¸‹æ–‡ä¸­æ‰¾åˆ°ç±»å‹åŒ¹é…çš„å”¯ä¸€beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªï¼Œéƒ½ä¼šæŠ›å‡ºå¼‚å¸¸ å¦‚æœæ—¢æ²¡æœ‰æŒ‡å®šnameï¼Œåˆæ²¡æœ‰æŒ‡å®štypeï¼Œåˆ™è‡ªåŠ¨æŒ‰ç…§byNameæ–¹å¼è¿›è¡Œè£…é…ï¼›å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™å›é€€ä¸ºä¸€ä¸ªåŸå§‹ç±»å‹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™è‡ªåŠ¨è£…é…ï¼› @Autowired ä¸@Resourceçš„åŒºåˆ« 1ã€@Autowiredä¸@Resourceéƒ½å¯ä»¥ç”¨æ¥è£…é…bean. éƒ½å¯ä»¥å†™åœ¨å­—æ®µä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Šã€‚ 2ã€@Autowiredé»˜è®¤æŒ‰ç±»å‹è£…é…ï¼ˆè¿™ä¸ªæ³¨è§£æ˜¯å±äºspringçš„ï¼‰ï¼Œé»˜è®¤æƒ…å†µä¸‹å¿…é¡»è¦æ±‚ä¾èµ–å¯¹è±¡å¿…é¡»å­˜åœ¨ï¼Œå¦‚æœè¦å…è®¸nullå€¼ï¼Œå¯ä»¥è®¾ç½®å®ƒçš„requiredå±æ€§ä¸ºfalseï¼Œå¦‚ï¼š@Autowired(required=false) ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä½¿ç”¨åç§°è£…é…å¯ä»¥ç»“åˆ@Qualifieræ³¨è§£è¿›è¡Œä½¿ç”¨ï¼Œå¦‚ä¸‹ï¼š 12@Autowired()@Qualifier("baseDao")privateBaseDao baseDao; 3ã€@Resourceï¼ˆè¿™ä¸ªæ³¨è§£å±äºJ2EEçš„ï¼‰ï¼Œé»˜è®¤æŒ‰ç…§åç§°è¿›è¡Œè£…é…ï¼Œåç§°å¯ä»¥é€šè¿‡nameå±æ€§è¿›è¡ŒæŒ‡å®šï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šnameå±æ€§ï¼Œå½“æ³¨è§£å†™åœ¨å­—æ®µä¸Šæ—¶ï¼Œé»˜è®¤å–å­—æ®µåè¿›è¡Œè£…é…æŸ¥æ‰¾ï¼Œå¦‚æœæ³¨è§£å†™åœ¨setteræ–¹æ³•ä¸Šé»˜è®¤å–å±æ€§åè¿›è¡Œè£…é…ã€‚å½“æ‰¾ä¸åˆ°ä¸åç§°åŒ¹é…çš„beanæ—¶æ‰æŒ‰ç…§ç±»å‹è¿›è¡Œè£…é…ã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœnameå±æ€§ä¸€æ—¦æŒ‡å®šï¼Œå°±åªä¼šæŒ‰ç…§åç§°è¿›è¡Œè£…é…ã€‚ 12@Resource(name="baseDao")privateBaseDao baseDao; æ¨èä½¿ç”¨ï¼š@Resourceæ³¨è§£åœ¨å­—æ®µä¸Šï¼Œè¿™æ ·å°±ä¸ç”¨å†™setteræ–¹æ³•äº†ï¼Œå¹¶ä¸”è¿™ä¸ªæ³¨è§£æ˜¯å±äºJ2EEçš„ï¼Œå‡å°‘äº†ä¸springçš„è€¦åˆã€‚è¿™æ ·ä»£ç çœ‹èµ·å°±æ¯”è¾ƒä¼˜é›…ã€‚ Spring @Qualifieræ³¨è§£ @Autowiredæ˜¯æ ¹æ®ç±»å‹è¿›è¡Œè‡ªåŠ¨è£…é…çš„ã€‚å¦‚æœå½“Springä¸Šä¸‹æ–‡ä¸­å­˜åœ¨ä¸æ­¢ä¸€ä¸ªUserDaoç±»å‹çš„beanæ—¶ï¼Œå°±ä¼šæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸;å¦‚æœSpringä¸Šä¸‹æ–‡ä¸­ä¸å­˜åœ¨UserDaoç±»å‹çš„beanï¼Œä¹Ÿä¼šæŠ›å‡ºBeanCreationExceptionå¼‚å¸¸ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@Qualifieré…åˆ@Autowiredæ¥è§£å†³è¿™äº›é—®é¢˜ã€‚å¦‚ä¸‹ï¼š å¯èƒ½å­˜åœ¨å¤šä¸ªUserDaoå®ä¾‹ 123@Autowired&nbsp;&nbsp;&nbsp;@Qualifier("userServiceImpl")&nbsp;&nbsp;&nbsp;public&nbsp;IUserService&nbsp;userService; æˆ–è€… 1234@Autowired&nbsp;&nbsp;&nbsp;public&nbsp;void&nbsp;setUserDao(@Qualifier("userDao")&nbsp;UserDao&nbsp;userDao)&nbsp;{&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;this.userDao&nbsp;=&nbsp;userDao;&nbsp;&nbsp;&nbsp;} è¿™æ ·Springä¼šæ‰¾åˆ°idä¸ºuserServiceImplå’ŒuserDaoçš„beanè¿›è¡Œè£…é…ã€‚ å¯èƒ½ä¸å­˜åœ¨UserDaoå®ä¾‹ 12@Autowired(required&nbsp;=&nbsp;false)&nbsp;&nbsp;&nbsp;public&nbsp;IUserService&nbsp;userService æ€»ç»“ @Autowired é»˜è®¤æŒ‰typeæ³¨å…¥ @Qualifier("baseDao") ä¸€èˆ¬ä½œä¸º@Autowired()çš„ä¿®é¥°ç”¨ @Resource(name="baseDao") é»˜è®¤æŒ‰nameæ³¨å…¥ï¼Œå¯ä»¥é€šè¿‡nameå’Œtypeå±æ€§è¿›è¡Œé€‰æ‹©æ€§æ³¨å…¥ ä¸€èˆ¬@Autowiredå’Œ@Qualifierä¸€èµ·ç”¨ï¼Œ@Resourceå•ç‹¬ç”¨ã€‚å½“ç„¶æ²¡æœ‰å†²çªçš„è¯@Autowiredä¹Ÿå¯ä»¥å•ç‹¬ç”¨ã€‚ å¸¸ç”¨æ³¨è§£ å£°æ˜Beançš„æ³¨è§£ 1234//å®šä¹‰æ§åˆ¶å±‚Bean,å¦‚Action@Controller@Controller("Beançš„åç§°") 1234//å®šä¹‰ä¸šåŠ¡é€»è¾‘å±‚Bean@Service &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;@Service("Beançš„åç§°") 1234//å®šä¹‰DAOå±‚/æ•°æ®è®¿é—®å±‚Bean@Repository &nbsp;&nbsp;@Repository("Beançš„åç§°") 12//å®šä¹‰Bean, ä¸å¥½å½’ç±»æ—¶ä½¿ç”¨.@Component è‡ªåŠ¨è£…é…Bean 12//é»˜è®¤æŒ‰ç±»å‹åŒ¹é…,è‡ªåŠ¨è£…é…(Srpingæä¾›çš„)ï¼Œå¯ä»¥å†™åœ¨æˆå‘˜å±æ€§ä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Š@Autowired 12//ä¸€å®šè¦æ‰¾åˆ°åŒ¹é…çš„Beanï¼Œå¦åˆ™æŠ›å¼‚å¸¸ã€‚ é»˜è®¤å€¼å°±æ˜¯true@Autowired(required=true) 123//æŒ‰åç§°è£…é…Bean,ä¸@Autowiredç»„åˆä½¿ç”¨ï¼Œè§£å†³æŒ‰ç±»å‹åŒ¹é…æ‰¾åˆ°å¤šä¸ªBeané—®é¢˜ã€‚@Autowired@Qualifier("beançš„åå­—") 123456//JSR-250æä¾›çš„,é»˜è®¤æŒ‰åç§°è£…é…,å½“æ‰¾ä¸åˆ°åç§°åŒ¹é…çš„beanå†æŒ‰ç±»å‹è£…é….å¯ä»¥å†™åœ¨æˆå‘˜å±æ€§ä¸Š,æˆ–å†™åœ¨setteræ–¹æ³•ä¸Š@Resource &nbsp; //å¯ä»¥é€šè¿‡@Resource(name="beanName") æŒ‡å®šè¢«æ³¨å…¥çš„beançš„åç§°, è¦æ˜¯æœªæŒ‡å®šnameå±æ€§, é»˜è®¤ä½¿ç”¨æˆå‘˜å±æ€§çš„å˜é‡å,ä¸€èˆ¬ä¸ç”¨å†™nameå±æ€§.@Resource(name="beanName") 12//æ˜¯JSR-330æä¾›çš„,æŒ‰ç±»å‹è£…é…ï¼ŒåŠŸèƒ½æ¯”@Autowiredå°‘ï¼Œæ²¡æœ‰ä½¿ç”¨çš„å¿…è¦ã€‚@Inject Javaé…ç½®ç±» @Configuration å£°æ˜å½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œç›¸å½“äºxmlå½¢å¼çš„Springé…ç½®ï¼ˆç±»ä¸Šï¼‰ @Bean æ³¨è§£åœ¨æ–¹æ³•ä¸Šï¼Œå£°æ˜å½“å‰æ–¹æ³•çš„è¿”å›å€¼ä¸ºä¸€ä¸ªbeanï¼Œæ›¿ä»£xmlä¸­çš„æ–¹å¼ï¼ˆæ–¹æ³•ä¸Šï¼‰ @Configuration å£°æ˜å½“å‰ç±»ä¸ºé…ç½®ç±»ï¼Œå…¶ä¸­å†…éƒ¨ç»„åˆäº†@Componentæ³¨è§£ï¼Œè¡¨æ˜è¿™ä¸ªç±»æ˜¯ä¸€ä¸ªbeanï¼ˆç±»ä¸Šï¼‰ @ComponentScan ç”¨äºå¯¹Componentè¿›è¡Œæ‰«æï¼Œç›¸å½“äºxmlä¸­çš„ï¼ˆç±»ä¸Šï¼‰ @WishlyConfiguration ä¸º@Configurationä¸@ComponentScançš„ç»„åˆæ³¨è§£ï¼Œå¯ä»¥æ›¿ä»£è¿™ä¸¤ä¸ªæ³¨è§£ åˆ‡é¢ï¼ˆAOPï¼‰ Springæ”¯æŒAspectJçš„æ³¨è§£å¼åˆ‡é¢ç¼–ç¨‹ã€‚ @Aspect å£°æ˜ä¸€ä¸ªåˆ‡é¢ï¼ˆç±»ä¸Šï¼‰ ä½¿ç”¨@Afterã€@Beforeã€@Aroundå®šä¹‰å»ºè¨€ï¼ˆadviceï¼‰ï¼Œå¯ç›´æ¥å°†æ‹¦æˆªè§„åˆ™ï¼ˆåˆ‡ç‚¹ï¼‰ä½œä¸ºå‚æ•°ã€‚ @After åœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @Before åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @Around åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰ä¸ä¹‹åæ‰§è¡Œï¼ˆæ–¹æ³•ä¸Šï¼‰ @PointCut å£°æ˜åˆ‡ç‚¹ åœ¨javaé…ç½®ç±»ä¸­ä½¿ç”¨@EnableAspectJAutoProxyæ³¨è§£å¼€å¯Springå¯¹AspectJä»£ç†çš„æ”¯æŒï¼ˆç±»ä¸Šï¼‰ å®šä¹‰Beançš„ä½œç”¨åŸŸå’Œç”Ÿå‘½è¿‡ç¨‹ 1234567891011121314//è®¾ç½®Springå®¹å™¨å¦‚ä½•æ–°å»ºBeanå®ä¾‹ï¼ˆæ–¹æ³•ä¸Šï¼Œå¾—æœ‰@Beanï¼‰@Scope("prototype")å…¶è®¾ç½®ç±»å‹åŒ…æ‹¬ï¼šSingleton ï¼ˆå•ä¾‹,ä¸€ä¸ªSpringå®¹å™¨ä¸­åªæœ‰ä¸€ä¸ªbeanå®ä¾‹ï¼Œé»˜è®¤æ¨¡å¼ï¼‰,Protetype ï¼ˆæ¯æ¬¡è°ƒç”¨æ–°å»ºä¸€ä¸ªbeanï¼‰,Request ï¼ˆwebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸ªhttp requestæ–°å»ºä¸€ä¸ªbeanï¼‰,Session ï¼ˆwebé¡¹ç›®ä¸­ï¼Œç»™æ¯ä¸ªhttp sessionæ–°å»ºä¸€ä¸ªbeanï¼‰,GlobalSessionï¼ˆç»™æ¯ä¸€ä¸ª global http sessionæ–°å»ºä¸€ä¸ªBeanå®ä¾‹ï¼‰ 12//ç›¸å½“äºinit-method,ä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå½“Beanåˆå§‹åŒ–æ—¶æ‰§è¡Œã€‚@PostConstruct 12//ç›¸å½“äºdestory-methodï¼Œä½¿ç”¨åœ¨æ–¹æ³•ä¸Šï¼Œå½“Beané”€æ¯æ—¶æ‰§è¡Œã€‚@PreDestroy å£°æ˜å¼äº‹åŠ¡ 1@Transactional @Value @Value ä¸ºå±æ€§æ³¨å…¥å€¼ï¼ˆå±æ€§ä¸Šï¼‰æ”¯æŒå¦‚ä¸‹æ–¹å¼çš„æ³¨å…¥ï¼š æ³¨å…¥æ™®é€šå­—ç¬¦ 12@Value("Tom")String name; æ³¨å…¥æ“ä½œç³»ç»Ÿå±æ€§ 12@Value("#{systemProperties['os.name']}")String osName; æ³¨å…¥è¡¨è¾¾å¼ç»“æœ 12@Value("#{T(java.lang.Math).random() * 100}")String randomNumber; æ³¨å…¥å…¶ä»–beanå±æ€§ 12@Value("#{demoClass.name}")String name; æ³¨å…¥æ–‡ä»¶èµ„æº 12@Value("classpath:com/springboot/study/hello/test.txt")String resourceFile; æ³¨å…¥ç½‘ç«™èµ„æº 12@Value("http://www.baiduc.om")Resource url; æ³¨å…¥é…ç½®æ–‡ä»¶ 12@Value("${book.name}")String bookName; ç¯å¢ƒåˆ‡æ¢ @Profile é€šè¿‡è®¾å®šEnvironmentçš„ActiveProfilesæ¥è®¾å®šå½“å‰contextéœ€è¦ä½¿ç”¨çš„é…ç½®ç¯å¢ƒã€‚ï¼ˆç±»æˆ–æ–¹æ³•ä¸Šï¼‰ @Conditional Spring4ä¸­å¯ä»¥ä½¿ç”¨æ­¤æ³¨è§£å®šä¹‰æ¡ä»¶åŒ–çš„beanï¼Œé€šè¿‡å®ç°Conditionæ¥å£ï¼Œå¹¶é‡å†™matchesæ–¹æ³•ï¼Œä»è€Œå†³å®šè¯¥beanæ˜¯å¦è¢«å®ä¾‹åŒ–ã€‚ï¼ˆæ–¹æ³•ä¸Šï¼‰ å¼‚æ­¥ @EnableAsync é…ç½®ç±»ä¸­ï¼Œé€šè¿‡æ­¤æ³¨è§£å¼€å¯å¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒï¼Œå™äº‹æ€§AsyncConfigureræ¥å£ï¼ˆç±»ä¸Šï¼‰ @Async åœ¨å®é™…æ‰§è¡Œçš„beanæ–¹æ³•ä½¿ç”¨è¯¥æ³¨è§£æ¥ç”³æ˜å…¶æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼ˆæ–¹æ³•ä¸Šæˆ–ç±»ä¸Šæ‰€æœ‰çš„æ–¹æ³•éƒ½å°†å¼‚æ­¥ï¼Œéœ€è¦@EnableAsyncå¼€å¯å¼‚æ­¥ä»»åŠ¡ï¼‰ å®šæ—¶ä»»åŠ¡ @EnableScheduling åœ¨é…ç½®ç±»ä¸Šä½¿ç”¨ï¼Œå¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒï¼ˆç±»ä¸Šï¼‰ @Scheduled æ¥ç”³æ˜è¿™æ˜¯ä¸€ä¸ªä»»åŠ¡ï¼ŒåŒ…æ‹¬cron,fixDelay,fixRateç­‰ç±»å‹ï¼ˆæ–¹æ³•ä¸Šï¼Œéœ€å…ˆå¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒï¼‰ @Enable* è¿™äº›æ³¨è§£ä¸»è¦ç”¨æ¥å¼€å¯å¯¹xxxçš„æ”¯æŒã€‚ @EnableAspectJAutoProxy å¼€å¯å¯¹AspectJè‡ªåŠ¨ä»£ç†çš„æ”¯æŒ @EnableAsync å¼€å¯å¼‚æ­¥æ–¹æ³•çš„æ”¯æŒ @EnableScheduling å¼€å¯è®¡åˆ’ä»»åŠ¡çš„æ”¯æŒ @EnableWebMvc å¼€å¯Web MVCçš„é…ç½®æ”¯æŒ @EnableConfigurationProperties å¼€å¯å¯¹@ConfigurationPropertiesæ³¨è§£é…ç½®Beançš„æ”¯æŒ @EnableJpaRepositories å¼€å¯å¯¹SpringData JPA Repositoryçš„æ”¯æŒ @EnableTransactionManagement å¼€å¯æ³¨è§£å¼äº‹åŠ¡çš„æ”¯æŒ @EnableCaching å¼€å¯æ³¨è§£å¼çš„ç¼“å­˜æ”¯æŒ æµ‹è¯• @RunWith è¿è¡Œå™¨ï¼ŒSpringä¸­é€šå¸¸ç”¨äºå¯¹JUnitçš„æ”¯æŒ 1@RunWith(SpringJUnit4ClassRunner.class) @ContextConfiguration ç”¨æ¥åŠ è½½é…ç½®ApplicationContextï¼Œå…¶ä¸­classeså±æ€§ç”¨æ¥åŠ è½½é…ç½®ç±» 1@ContextConfiguration(classes={Test.class}) SpringMVC @EnableWebMvc åœ¨é…ç½®ç±»ä¸­å¼€å¯Web MVCçš„é…ç½®æ”¯æŒï¼Œå¦‚ä¸€äº›ViewResolveræˆ–è€…MessageConverterç­‰ï¼Œè‹¥æ— æ­¤å¥ï¼Œé‡å†™WebMvcConfigurerAdapteræ–¹æ³•ï¼ˆç”¨äºå¯¹SpringMVCçš„é…ç½®ï¼‰ã€‚ @Controller å£°æ˜è¯¥ç±»ä¸ºSpringMVCä¸­çš„Controller @RequestMapping ç”¨äºæ˜ å°„Webè¯·æ±‚ï¼ŒåŒ…æ‹¬è®¿é—®è·¯å¾„å’Œå‚æ•°ï¼ˆç±»æˆ–æ–¹æ³•ä¸Šï¼‰ @ResponseBody æ”¯æŒå°†è¿”å›å€¼æ”¾åœ¨responseå†…ï¼Œè€Œä¸æ˜¯ä¸€ä¸ªé¡µé¢ï¼Œé€šå¸¸ç”¨æˆ·è¿”å›jsonæ•°æ®ï¼ˆè¿”å›å€¼æ—æˆ–æ–¹æ³•ä¸Šï¼‰ @RequestBody å…è®¸requestçš„å‚æ•°åœ¨requestä½“ä¸­ï¼Œè€Œä¸æ˜¯ç›´æ¥è¿æ¥åœ¨åœ°å€åé¢ã€‚ï¼ˆæ”¾åœ¨å‚æ•°å‰ï¼‰ @PathVariable ç”¨äºæ¥æ”¶è·¯å¾„å‚æ•°ï¼Œæ¯”å¦‚@RequestMapping(â€œ/hello/{name}â€)ç”³æ˜çš„è·¯å¾„ï¼Œå°†æ³¨è§£æ”¾åœ¨å‚æ•°å‰ï¼Œå³å¯è·å–è¯¥å€¼ï¼Œé€šå¸¸ä½œä¸ºRestfulçš„æ¥å£å®ç°æ–¹æ³•ã€‚ @RestController è¯¥æ³¨è§£ä¸ºä¸€ä¸ªç»„åˆæ³¨è§£ï¼Œç›¸å½“äº@Controllerå’Œ@ResponseBodyçš„ç»„åˆï¼Œæ³¨è§£åœ¨ç±»ä¸Šï¼Œæ„å‘³ç€ï¼Œè¯¥Controllerçš„æ‰€æœ‰æ–¹æ³•éƒ½é»˜è®¤åŠ ä¸Šäº†@ResponseBodyã€‚ @ControllerAdvice é€šè¿‡è¯¥æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹äºæ§åˆ¶å™¨çš„å…¨å±€é…ç½®æ”¾ç½®åœ¨åŒä¸€ä¸ªä½ç½®ï¼Œæ³¨è§£äº†@Controllerçš„ç±»çš„æ–¹æ³•å¯ä½¿ç”¨@ExceptionHandlerã€@InitBinderã€@ModelAttributeæ³¨è§£åˆ°æ–¹æ³•ä¸Šï¼Œè¿™å¯¹æ‰€æœ‰æ³¨è§£äº† @RequestMappingçš„æ§åˆ¶å™¨å†…çš„æ–¹æ³•æœ‰æ•ˆã€‚ @ExceptionHandler ç”¨äºå…¨å±€å¤„ç†æ§åˆ¶å™¨é‡Œçš„å¼‚å¸¸ @InitBinder ç”¨æ¥è®¾ç½®WebDataBinderï¼ŒWebDataBinderç”¨æ¥è‡ªåŠ¨ç»‘å®šå‰å°è¯·æ±‚å‚æ•°åˆ°Modelä¸­ã€‚ @ModelAttribute æœ¬æ¥çš„ä½œç”¨æ˜¯ç»‘å®šé”®å€¼å¯¹åˆ°Modelé‡Œï¼Œåœ¨@ControllerAdviceä¸­æ˜¯è®©å…¨å±€çš„@RequestMappingéƒ½èƒ½è·å¾—åœ¨æ­¤å¤„è®¾ç½®çš„é”®å€¼å¯¹ã€‚ ä¸ºä»€ä¹ˆå»ºè®®æ„é€ å™¨æ³¨å…¥ æ„é€ å™¨æ³¨å…¥ä¸åŸŸæ³¨å…¥ çƒ­é—¨æ–‡ç«  Why field injection is evil ç»™å‡ºæ€»ç»“ï¼š Field injection: less code to write; unsafe code; more complicated to test; Constructor injection: safe code; more code to write (see the hint to Lombok); easy to test; Spring çš„åšå®¢ä¸ŠæŒ‡å‡º Setter injection versus constructor injection and the use of @Required è§£å†³æ–¹æ¡ˆ ä¹¦å½’æ­£ä¼ ï¼Œè¯´ä¸‹å¦‚ä½•å‰”é™¤Intellijä¸­Mybatisçš„Mapperè‡ªåŠ¨æ³¨å…¥è­¦å‘Šã€‚ æ–¹æ³•1ï¼šä¸º @Autowired æ³¨è§£è®¾ç½®required = false ä½¿ç”¨ @Autowired æ³¨è§£æ—¶ï¼Œè‹¥å¸Œæœ›å…è®¸nullå€¼ï¼Œå¯è®¾ç½®required = falseï¼Œåƒè¿™æ ·ï¼š 12@Autowired(required = false)private UserMapper userMapper; è¿™æ ·å°±ä¸ä¼šæœ‰è­¦å‘Šäº†ã€‚åŸå› å¾ˆå¥½ç†è§£ï¼šIDEAè®¤ä¸ºuserMapperæ˜¯ä¸ªnullï¼Œç»™äº†è­¦å‘Šï¼›åŠ ä¸Šrequired = falseåï¼Œä½¿ç”¨ @Autowired æ³¨è§£ä¸å†å»æ ¡éªŒuserMapperæ˜¯å¦å­˜åœ¨äº†ã€‚ä¹Ÿå°±ä¸ä¼šæœ‰è­¦å‘Šäº†ã€‚ æ–¹æ³•2ï¼šç”¨ @Resource æ›¿æ¢ @Autowired 12@Resourceprivate UserMapper userMapper; æ–¹æ³•3ï¼šåœ¨Mapperæ¥å£ä¸ŠåŠ ä¸Š@Repositoryæ³¨è§£ 123@Repositorypublic interface UserMapper extends Mapper&lt;User&gt; {} è¿™æ ·ä¹Ÿèƒ½è®©ä½ çš„ 12@Autowiredprivate UserMapper userMapper; ä¸å†æŠ¥é”™ã€‚å½“ç„¶ï¼Œå¦‚æœä½ ç”¨@Componentæ›¿æ¢@Repositoryä¹Ÿæ˜¯å¯ä»¥çš„ã€‚åŸç†å¤§è‡´ï¼šIDEAä¸æ˜¯è®¤ä¸º userMapper æ˜¯ä¸ªnullå˜›â€¦åŠ ä¸ª@Repositoryæ³¨è§£éª—ä¸€ä¸‹IDEAå°±OKäº†â€¦â€¦ æ–¹æ³•4ï¼šç”¨Lombok 123456@Service@RequiredArgsConstructor(onConstructor = @__(@Autowired))public class TestService { private final UserMapper userMapper; ...} Lombokç”Ÿæˆçš„ä»£ç æ˜¯è¿™æ ·çš„ï¼š 123456789@Servicepublic class TestService { private final UserMapper userMapper; @Autowired public TestService(final UserMapper userMapper) { this.userMapper = userMapper; } ...} ä½†å¦‚æœè‡ªå·±æ‰‹å†™æˆLombokç”Ÿæˆçš„ä»£ç ï¼ŒIDEAä¾ç„¶ä¼šç»™ä½ æŠ¥è­¦å‘Š ã€‚æˆ‘çŒœï¼Œåº”è¯¥æ˜¯IDEAçš„Lombokæ’ä»¶æŠŠIDEAææ‡µé€¼äº†â€¦æ‰€ä»¥ä¸æç¤ºäº†â€¦ æ–¹æ³•5ï¼šæŠŠIDEAçš„è­¦å‘Šå…³é—­æ‰ ä¸ªäººæ²¡è¯•è¿‡ã€‚ æ–¹æ³•6ï¼šå®‰è£…mybatis plugin æ®è¯´å®‰è£…mybatis pluginå¯ä»¥è§£å†³è¯¥é—®é¢˜ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Spring</category>
        <category>IDEA</category>
      </categories>
      <tags>
        <tag>Spring</tag>
        <tag>IDEA</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[ä¿®æ”¹GitHubé¡¹ç›®è¯­è¨€æ˜¾ç¤ºé—®é¢˜]]></title>
    <url>%2Fposts%2F559b1d56.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° å½“æˆ‘ä»¬ä¸Šä¼ é¡¹ç›®åˆ°GitHubä¸Šï¼Œæœ‰æ—¶å€™é¡¹ç›®æ˜¾ç¤ºçš„è¯­è¨€å¹¶éæ˜¯æˆ‘ä»¬è‡ªå·±é¡¹ç›®æ‰€ç¤ºçš„è¯­è¨€ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬åœ¨å¿«é€Ÿæ£€ç´¢ï¼Œ æˆ–è€…å¤–éƒ¨è®¿é—®è€…è®¿é—®æ—¶ä¸èƒ½å¤Ÿæœç´¢åˆ°æˆ‘ä»¬çš„é¡¹ç›®ï¼Œæ‰€ä»¥ï¼Œæ­¤æ—¶å°±å¾ˆæœ‰å¿…è¦ä¿®æ”¹ä¸‹è¯­è¨€ã€‚ ä¿®æ”¹GitHubè¯­è¨€ 1ã€åœ¨æœ¬åœ°é¡¹ç›®ä¸­æˆ–è€…GitHubé¡¹ç›®ä¸­æ–°å»ºä¸€ä¸ª .gitattributesçš„æ–‡ä»¶ï¼Œè¾“å…¥ä»¥ä¸‹å†…å®¹ï¼š 12345*.yml linguist-language=Java *.html linguist-language=Java *.js linguist-language=Java *.xml linguist-language=Java*.css linguist-language=Java éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œå‡å¦‚æˆ‘ä»¬çš„é¡¹ç›®ä¸­æœ‰å¾ˆå¤šçš„è¯¸å¦‚.htmlã€.jsç­‰æ–‡ä»¶ï¼Œåœ¨GitHubä¸Šä¼šæ˜¾ç¤ºä¸ºHTMLã€JavaScriptï¼Œ æ‰€ä»¥.gitattributesæ–‡ä»¶å†…å®¹çš„æ„æ€å°±æ˜¯å°†å¿½ç•¥.xxä»€ä¹ˆä»€ä¹ˆæ–‡ä»¶ï¼Œç„¶åå°†å…¶è¯­è¨€æ›´æ”¹ä¸ºJavaï¼Œå¦‚æœä½ çš„é¡¹ç›® æ˜¯å…¶ä»–è¯­è¨€ï¼Œè¯¸å¦‚C++ç­‰å°±å°†Javaä¿®æ”¹ä¸ºC++ç­‰ã€‚ å½“ç„¶äº†ï¼Œè¿™æ ·ä¿®æ”¹ä¹Ÿè®¸è¿˜ä¸èƒ½å°†ä½ çš„é¡¹ç›®è¯­è¨€ä¿®æ”¹æˆåŠŸï¼Œæ‰€ä»¥ä½ éœ€è¦å»æŸ¥è¯¢ä½ é¡¹ç›®ä¸­æ‰€æœ‰å°½å¯èƒ½çš„åç¼€åæ–‡ä»¶ å½±å“è¯­è¨€çš„æƒ…å†µè€ƒè™‘ï¼Œè¦æ ¹æ®GitHubç»™ä½ å½“å‰é¡¹ç›®è®¾å®šçš„æ˜¯ä»€ä¹ˆè¯­è¨€ï¼Œå°±ä»ä»€ä¹ˆè¯­è¨€å»è€ƒè™‘å°±å¥½äº†ã€‚ æ‰€ä»¥åœ¨.gitattributesæ–‡ä»¶ä¸­æ·»åŠ å¤šä¸€äº›å±æ€§å°±è§£å†³äº†ã€‚å¦‚ä¸‹ï¼š 123456789*.md linguist-language=Java *.yml linguist-language=Java *.html linguist-language=Java *.js linguist-language=Java *.xml linguist-language=Java*.css linguist-language=Java *.sql linguist-language=Java*.uml linguist-language=Java *.cmd linguist-language=Java document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>GitHub</category>
      </categories>
      <tags>
        <tag>GitHub</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-æœåŠ¡å™¨çŠ¶æ€ã€æ€§èƒ½ç›¸å…³å‘½ä»¤]]></title>
    <url>%2Fposts%2Fc91a35ad.html</url>
    <content type="text"><![CDATA[æœåŠ¡å™¨çŠ¶æ€åˆ†æ æŸ¥çœ‹CPUçš„ä¿¡æ¯ æŸ¥çœ‹ç‰©ç†CPUä¸ªæ•° æŸ¥çœ‹æ¯ä¸ªç‰©ç†CPUçš„æ ¸æ•° é€»è¾‘CPUçš„ä¸ªæ•° é€»è¾‘CPU = ç‰©ç†CPUä¸ªæ•°*æ ¸æ•° æŸ¥çœ‹å†…å­˜ä½¿ç”¨æƒ…å†µ totalï¼šå†…å­˜æ€»æ•° userï¼šå·²ä½¿ç”¨å†…å­˜æ•° freeï¼šç©ºé—²å†…å­˜æ•° sharedï¼šå¤šè¿›ç¨‹å…±äº«å†…å­˜æ•° buffersï¼šç¼“å†²å†…å­˜æ•° cachedï¼šç¼“å­˜å†…å­˜æ•° å¯ç”¨å†…å­˜ = free+buffers+cached å·²ç”¨å†…å­˜ = used-buffers-cached swap äº¤æ¢å†…å­˜æ•°ï¼Œæ­¤é¡¹å¯åˆ¤æ–­å†…å­˜æ˜¯å¦å¤Ÿç”¨çš„æ ‡å‡† æŸ¥çœ‹ç¡¬ç›˜åŠåˆ†åŒºä¿¡æ¯ æ£€æŸ¥æ–‡ä»¶ç³»ç»Ÿçš„ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µ æœåŠ¡å™¨æ€§èƒ½åˆ†æ æŸ¥çœ‹ç¡¬ç›˜I/Oæ€§èƒ½ æŸ¥çœ‹æœåŠ¡å™¨çš„å¹³å‡è´Ÿè½½ ç›‘æ§æœåŠ¡å™¨çš„æ•´ä½“æ€§èƒ½ proces r:ç­‰å¾…è¿è¡Œçš„è¿›ç¨‹æ•° b:éä¸­æ–­ç¡çœ çŠ¶æ€çš„è¿›ç¨‹æ•° w:è¢«äº¤æ¢å‡ºå»çš„å¯è¿è¡Œè¿›ç¨‹æ•° memory swpd:è™šæ‹Ÿå†…å­˜ä½¿ç”¨æƒ…å†µ fres:ç©ºé—²çš„å†…å­˜ buff:ç”¨ä½œç¼“å­˜çš„å†…å­˜æ•°ï¼ˆå•ä½:KBï¼‰ swap si:ä»ç£ç›˜äº¤æ¢åˆ°å†…å­˜çš„äº¤æ¢é¡µæ•°é‡ so:ä»å†…å­˜äº¤æ¢åˆ°ç£ç›˜çš„äº¤æ¢é¡µæ•°é‡ï¼ˆå•ä½:kb/ç§’ï¼‰ io bi:å‘é€åˆ°å—è®¾å¤‡çš„å—æ•° bo:ä»å—è®¾å¤‡æ¥æ”¶åˆ°çš„å—æ•°ï¼ˆå•ä½:å—/ç§’ï¼‰ system in:æ¯ç§’çš„ä¸­æ–­æ•°ï¼ŒåŒ…æ‹¬æ—¶é’Ÿä¸­æ–­ cs:æ¯ç§’çš„ç¯å¢ƒï¼ˆä¸Šä¸‹æ–‡ï¼‰åˆ‡æ¢æ•° cpu us:CPUä½¿ç”¨æ—¶é—´ sy:CPUç³»ç»Ÿä½¿ç”¨æ—¶é—´ id:é—²ç½®æ—¶é—´ï¼ˆå•ä½:ç™¾åˆ†æ¯”ï¼‰ æ ‡å‡†æƒ…å†µä¸‹:rå°äº5,bçº¦ä¸º0 å¦‚æœuser + sys å°äº70 è¡¨ç¤ºç³»ç»Ÿæ€§èƒ½è¾ƒå¥½ï¼›å¦‚æœå¤§äºç­‰äº85ä»¥ä¸Šï¼Œè¡¨ç¤ºæ€§èƒ½æ¯”è¾ƒç³Ÿç³• æŸ¥çœ‹LinuxæœåŠ¡å™¨çš„å…¶ä»–å‚æ•° æŸ¥çœ‹ç³»ç»Ÿå†…æ ¸çš„ç‰ˆæœ¬å· document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLè§„èŒƒ]]></title>
    <url>%2Fposts%2F33a2a570.html</url>
    <content type="text"><![CDATA[æ•°æ®åº“å‘½åè§„èŒƒ æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°å¿…é¡»ä½¿ç”¨å°å†™å­—æ¯å¹¶ç”¨ä¸‹åˆ’çº¿åˆ†å‰²ã€‚ æ‰€æœ‰æ•°æ®åº“å¯¹è±¡åç§°ç¦æ­¢ä½¿ç”¨ MySQL ä¿ç•™å…³é”®å­—ï¼ˆå¦‚æœè¡¨åä¸­åŒ…å«å…³é”®å­—æŸ¥è¯¢æ—¶ï¼Œéœ€è¦å°†å…¶ç”¨å•å¼•å·æ‹¬èµ·æ¥ï¼‰ã€‚ æ•°æ®åº“å¯¹è±¡çš„å‘½åè¦èƒ½åšåˆ°è§åè¯†æ„ï¼Œå¹¶ä¸”æœ€åä¸è¦è¶…è¿‡32 ä¸ªå­—ç¬¦ã€‚ ä¸´æ—¶åº“è¡¨å¿…é¡»ä»¥ tmp_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸä¸ºåç¼€ï¼Œå¤‡ä»½è¡¨å¿…é¡»ä»¥ bak_ ä¸ºå‰ç¼€å¹¶ä»¥æ—¥æœŸ ( æ—¶é—´æˆ³ ) ä¸ºåç¼€ã€‚ æ‰€æœ‰å­˜å‚¨ç›¸åŒæ•°æ®çš„åˆ—åå’Œåˆ—ç±»å‹å¿…é¡»ä¸€è‡´ï¼ˆä¸€èˆ¬ä½œä¸ºå…³è”åˆ—ï¼Œå¦‚æœæŸ¥è¯¢æ—¶å…³è”åˆ—ç±»å‹ä¸ä¸€è‡´ä¼šè‡ªåŠ¨è¿›è¡Œæ•°æ®ç±»å‹éšå¼è½¬æ¢ï¼Œä¼šé€ æˆåˆ—ä¸Šçš„ç´¢å¼•å¤±æ•ˆï¼Œå¯¼è‡´æŸ¥è¯¢æ•ˆç‡é™ä½ï¼‰ã€‚ æ•°æ®åº“åŸºæœ¬è®¾è®¡è§„èŒƒ æ²¡æœ‰ç‰¹æ®Šè¦æ±‚ï¼ˆå³ InnoDB æ— æ³•æ»¡è¶³çš„åŠŸèƒ½å¦‚ï¼šåˆ—å­˜å‚¨ï¼Œå­˜å‚¨ç©ºé—´æ•°æ®ç­‰ï¼‰çš„æƒ…å†µä¸‹ï¼Œæ‰€æœ‰è¡¨å¿…é¡»ä½¿ç”¨ InnoDB å­˜å‚¨å¼•æ“ï¼ˆMySQL5.5 ä¹‹å‰é»˜è®¤ä½¿ç”¨ Myisamï¼Œ5.6 ä»¥åé»˜è®¤çš„ä¸º InnoDBï¼‰InnoDB æ”¯æŒäº‹åŠ¡ï¼Œæ”¯æŒè¡Œçº§é”ï¼Œæ›´å¥½çš„æ¢å¤æ€§ï¼Œé«˜å¹¶å‘ä¸‹æ€§èƒ½æ›´å¥½ã€‚ æ•°æ®åº“å’Œè¡¨çš„å­—ç¬¦é›†ç»Ÿä¸€ä½¿ç”¨ UTF8ï¼Œå…¼å®¹æ€§æ›´å¥½ã€‚ç»Ÿä¸€å­—ç¬¦é›†å¯ä»¥é¿å…ç”±äºå­—ç¬¦é›†è½¬æ¢äº§ç”Ÿçš„ä¹±ç ï¼Œä¸åŒçš„å­—ç¬¦é›†è¿›è¡Œæ¯”è¾ƒå‰éœ€è¦è¿›è¡Œè½¬æ¢ä¼šé€ æˆç´¢å¼•å¤±æ•ˆã€‚ æ‰€æœ‰è¡¨å’Œå­—æ®µéƒ½éœ€è¦æ·»åŠ æ³¨é‡Šï¼Œä½¿ç”¨ comment ä»å¥æ·»åŠ è¡¨å’Œåˆ—çš„å¤‡æ³¨ ä»ä¸€å¼€å§‹å°±è¿›è¡Œæ•°æ®å­—å…¸çš„ç»´æŠ¤ã€‚ å°½é‡æ§åˆ¶å•è¡¨æ•°æ®é‡çš„å¤§å°ï¼Œå»ºè®®æ§åˆ¶åœ¨500ä¸‡ä»¥å†…ï¼Œ500ä¸‡å¹¶ä¸æ˜¯ MySQL æ•°æ®åº“çš„é™åˆ¶ï¼Œè¿‡å¤§ä¼šé€ æˆä¿®æ”¹è¡¨ç»“æ„ã€å¤‡ä»½ã€æ¢å¤éƒ½ä¼šæœ‰å¾ˆå¤§çš„é—®é¢˜ï¼Œå¯ä»¥ç”¨å†å²æ•°æ®å½’æ¡£ï¼ˆåº”ç”¨äºæ—¥å¿—æ•°æ®ï¼‰ï¼Œåˆ†åº“åˆ†è¡¨ï¼ˆåº”ç”¨äºä¸šåŠ¡æ•°æ®ï¼‰ç­‰æ‰‹æ®µæ¥æ§åˆ¶æ•°æ®é‡å¤§å°ã€‚ è°¨æ…ä½¿ç”¨ MySQL åˆ†åŒºè¡¨ã€‚åˆ†åŒºè¡¨åœ¨ç‰©ç†ä¸Šè¡¨ç°ä¸ºå¤šä¸ªæ–‡ä»¶ï¼Œåœ¨é€»è¾‘ä¸Šè¡¨ç°ä¸ºä¸€ä¸ªè¡¨ã€‚è°¨æ…é€‰æ‹©åˆ†åŒºé”®ï¼Œè·¨åˆ†åŒºæŸ¥è¯¢æ•ˆç‡å¯èƒ½æ›´ä½ï¼Œå»ºè®®é‡‡ç”¨ç‰©ç†åˆ†è¡¨çš„æ–¹å¼ç®¡ç†å¤§æ•°æ®ã€‚ å°½é‡åšåˆ°å†·çƒ­æ•°æ®åˆ†ç¦»ï¼Œå‡å°è¡¨çš„å®½åº¦ã€‚MySQL é™åˆ¶æ¯ä¸ªè¡¨æœ€å¤šå­˜å‚¨ 4096 åˆ—ï¼Œå¹¶ä¸”æ¯ä¸€è¡Œæ•°æ®çš„å¤§å°ä¸èƒ½è¶…è¿‡ 65535 å­—èŠ‚ã€‚å‡å°‘ç£ç›˜ IOï¼Œä¿è¯çƒ­æ•°æ®çš„å†…å­˜ç¼“å­˜å‘½ä¸­ç‡ï¼ˆè¡¨è¶Šå®½ï¼ŒæŠŠè¡¨è£…è½½è¿›å†…å­˜ç¼“å†²æ± æ—¶æ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§,ä¹Ÿä¼šæ¶ˆè€—æ›´å¤šçš„ IOï¼‰ æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç¼“å­˜ï¼Œé¿å…è¯»å…¥æ— ç”¨çš„å†·æ•°æ®ï¼›ç»å¸¸ä¸€èµ·ä½¿ç”¨çš„åˆ—æ”¾åˆ°ä¸€ä¸ªè¡¨ä¸­ï¼ˆé¿å…æ›´å¤šçš„å…³è”æ“ä½œï¼‰ ç¦æ­¢åœ¨æ•°æ®åº“ä¸­å­˜å‚¨å›¾ç‰‡ï¼Œæ–‡ä»¶ç­‰å¤§çš„äºŒè¿›åˆ¶æ•°æ®ã€‚é€šå¸¸æ–‡ä»¶å¾ˆå¤§ï¼Œä¼šçŸ­æ—¶é—´å†…é€ æˆæ•°æ®é‡å¿«é€Ÿå¢é•¿ï¼Œæ•°æ®åº“è¿›è¡Œæ•°æ®åº“è¯»å–æ—¶ï¼Œé€šå¸¸ä¼šè¿›è¡Œå¤§é‡çš„éšæœº IO æ“ä½œï¼Œæ–‡ä»¶å¾ˆå¤§æ—¶ï¼ŒIO æ“ä½œå¾ˆè€—æ—¶ã€‚é€šå¸¸å­˜å‚¨äºæ–‡ä»¶æœåŠ¡å™¨ï¼Œæ•°æ®åº“åªå­˜å‚¨æ–‡ä»¶åœ°å€ä¿¡æ¯ã€‚ ç¦æ­¢åœ¨çº¿ä¸Šåšæ•°æ®åº“å‹åŠ›æµ‹è¯•ã€‚ ç¦æ­¢ä»å¼€å‘ç¯å¢ƒï¼Œæµ‹è¯•ç¯å¢ƒç›´æ¥è¿æ¥ç”Ÿäº§ç¯å¢ƒæ•°æ®åº“ã€‚ æ•°æ®åº“å­—æ®µè®¾è®¡è§„èŒƒ ä¼˜å…ˆé€‰æ‹©ç¬¦åˆå­˜å‚¨éœ€è¦çš„æœ€å°çš„æ•°æ®ç±»å‹ åˆ—çš„å­—æ®µè¶Šå¤§ï¼Œå»ºç«‹ç´¢å¼•æ—¶æ‰€éœ€è¦çš„ç©ºé—´ä¹Ÿå°±è¶Šå¤§ï¼Œè¿™æ ·ä¸€é¡µä¸­æ‰€èƒ½å­˜å‚¨çš„ç´¢å¼•èŠ‚ç‚¹çš„æ•°é‡ä¹Ÿå°±è¶Šå°‘ï¼Œåœ¨éå†æ—¶æ‰€éœ€è¦çš„IOæ¬¡æ•°ä¹Ÿå°±è¶Šå¤šï¼Œç´¢å¼•çš„æ€§èƒ½ä¹Ÿå°±è¶Šå·®ã€‚ å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•°å­—ç±»å‹å­˜å‚¨ï¼Œå¦‚ï¼šå°†IPåœ°å€è½¬æ¢æˆæ•´å½¢æ•°æ®ã€‚ MySQL æä¾›äº†ä¸¤ä¸ªæ–¹æ³•æ¥å¤„ç† IP åœ°å€ inet_aton æŠŠipè½¬ä¸ºæ— ç¬¦å·æ•´å‹(4-8ä½) inet_ntoa æŠŠæ•´å‹çš„ipè½¬ä¸ºåœ°å€ æ’å…¥æ•°æ®å‰ï¼Œå…ˆç”¨ inet_aton æŠŠ IP åœ°å€è½¬ä¸ºæ•´å‹ï¼Œå¯ä»¥èŠ‚çœç©ºé—´ã€‚æ˜¾ç¤ºæ•°æ®æ—¶ï¼Œä½¿ç”¨ inet_ntoa æŠŠæ•´å‹çš„ IP åœ°å€è½¬ä¸ºåœ°å€æ˜¾ç¤ºå³å¯ã€‚ å¯¹äºéè´Ÿå‹çš„æ•°æ®ï¼ˆå¦‚è‡ªå¢ IDã€æ•´å‹ IPï¼‰æ¥è¯´ï¼Œè¦ä¼˜å…ˆä½¿ç”¨æ— ç¬¦å·æ•´å‹æ¥å­˜å‚¨,å› ä¸ºæ— ç¬¦å·ç›¸å¯¹äºæœ‰ç¬¦å·å¯ä»¥å¤šå‡ºä¸€å€çš„å­˜å‚¨ç©ºé—´ã€‚ SIGNED INT -2147483648~2147483647 UNSIGNED INT 0~4294967295 VARCHAR(N) ä¸­çš„ N ä»£è¡¨çš„æ˜¯å­—ç¬¦æ•°ï¼Œè€Œä¸æ˜¯å­—èŠ‚æ•°ã€‚ä½¿ç”¨ UTF8 å­˜å‚¨ 255 ä¸ªæ±‰å­— Varchar(255)=765 ä¸ªå­—èŠ‚ã€‚è¿‡å¤§çš„é•¿åº¦ä¼šæ¶ˆè€—æ›´å¤šçš„å†…å­˜ã€‚ é¿å…ä½¿ç”¨ TEXTã€BLOB æ•°æ®ç±»å‹ æœ€å¸¸è§çš„TEXTç±»å‹å¯ä»¥å­˜å‚¨64kçš„æ•°æ®ï¼Œå»ºè®®æŠŠ BLOB æˆ–æ˜¯TEXTåˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ã€‚ MySQL å†…å­˜ä¸´æ—¶è¡¨ä¸æ”¯æŒ TEXTã€BLOB è¿™æ ·çš„å¤§æ•°æ®ç±»å‹ï¼Œå¦‚æœæŸ¥è¯¢ä¸­åŒ…å«è¿™æ ·çš„æ•°æ®ï¼Œåœ¨æ’åºç­‰æ“ä½œæ—¶ï¼Œå°±ä¸èƒ½ä½¿ç”¨å†…å­˜ä¸´æ—¶è¡¨ï¼Œå¿…é¡»ä½¿ç”¨ç£ç›˜ä¸´æ—¶è¡¨è¿›è¡Œã€‚ è€Œä¸”å¯¹äºè¿™ç§æ•°æ®ï¼ŒMySQL è¿˜æ˜¯è¦è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢ï¼Œä¼šä½¿ SQL æ€§èƒ½å˜å¾—å¾ˆå·®ï¼Œä½†æ˜¯ä¸æ˜¯è¯´ä¸€å®šä¸èƒ½ä½¿ç”¨è¿™æ ·çš„æ•°æ®ç±»å‹ã€‚ å¦‚æœä¸€å®šè¦ä½¿ç”¨ï¼Œå»ºè®®æŠŠ BLOB æˆ–æ˜¯ TEXT åˆ—åˆ†ç¦»åˆ°å•ç‹¬çš„æ‰©å±•è¡¨ä¸­ï¼ŒæŸ¥è¯¢æ—¶ä¸€å®šä¸è¦ä½¿ç”¨ select * è€Œåªéœ€è¦å–å‡ºå¿…è¦çš„åˆ—ï¼Œä¸éœ€è¦ TEXT åˆ—çš„æ•°æ®æ—¶ä¸è¦å¯¹è¯¥åˆ—è¿›è¡ŒæŸ¥è¯¢ã€‚ TEXT æˆ– BLOB ç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•,å› ä¸º MySQL å¯¹ç´¢å¼•å­—æ®µé•¿åº¦æ˜¯æœ‰é™åˆ¶çš„ï¼Œæ‰€ä»¥ TEXT ç±»å‹åªèƒ½ä½¿ç”¨å‰ç¼€ç´¢å¼•ï¼Œå¹¶ä¸” TEXT åˆ—ä¸Šæ˜¯ä¸èƒ½æœ‰é»˜è®¤å€¼çš„ã€‚ é¿å…ä½¿ç”¨ ENUM ç±»å‹ ä¿®æ”¹ ENUM å€¼éœ€è¦ä½¿ç”¨ ALTER è¯­å¥ ENUM ç±»å‹çš„ ORDER BY æ“ä½œæ•ˆç‡ä½ï¼Œéœ€è¦é¢å¤–æ“ä½œ ç¦æ­¢ä½¿ç”¨æ•°å€¼ä½œä¸º ENUM çš„æšä¸¾å€¼ å°½å¯èƒ½æŠŠæ‰€æœ‰åˆ—å®šä¹‰ä¸º NOT NULL ç´¢å¼• NULL åˆ—éœ€è¦é¢å¤–çš„ç©ºé—´æ¥ä¿å­˜ï¼Œæ‰€ä»¥è¦å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚è¿›è¡Œæ¯”è¾ƒå’Œè®¡ç®—æ—¶è¦å¯¹ NULL å€¼åšç‰¹åˆ«çš„å¤„ç†ã€‚ ä½¿ç”¨ TIMESTAMPï¼ˆ4 ä¸ªå­—èŠ‚ï¼‰æˆ– DATETIME ç±»å‹ï¼ˆ8 ä¸ªå­—èŠ‚ï¼‰å­˜å‚¨æ—¶é—´ TIMESTAMP å­˜å‚¨çš„æ—¶é—´èŒƒå›´ 1970-01-01 00:00:01 ~ 2038-01-19-03:14:07ã€‚ TIMESTAMP å ç”¨ 4 å­—èŠ‚å’Œ INT ç›¸åŒï¼Œä½†æ¯” INT å¯è¯»æ€§é«˜ï¼Œè¶…å‡º TIMESTAMP å–å€¼èŒƒå›´çš„ä½¿ç”¨ DATETIME ç±»å‹å­˜å‚¨ã€‚ ç»å¸¸ä¼šæœ‰äººç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸå‹çš„æ•°æ®ï¼ˆä¸æ­£ç¡®çš„åšæ³•ï¼‰ï¼š ç¼ºç‚¹ 1ï¼šæ— æ³•ç”¨æ—¥æœŸå‡½æ•°è¿›è¡Œè®¡ç®—å’Œæ¯”è¾ƒã€‚ ç¼ºç‚¹ 2ï¼šç”¨å­—ç¬¦ä¸²å­˜å‚¨æ—¥æœŸè¦å ç”¨æ›´å¤šçš„ç©ºé—´ã€‚ åŒè´¢åŠ¡ç›¸å…³çš„é‡‘é¢ç±»æ•°æ®å¿…é¡»ä½¿ç”¨ decimal ç±»å‹ éç²¾å‡†æµ®ç‚¹ï¼šfloatï¼Œdouble ç²¾å‡†æµ®ç‚¹ï¼šdecimal Decimal ç±»å‹ä¸ºç²¾å‡†æµ®ç‚¹æ•°ï¼Œåœ¨è®¡ç®—æ—¶ä¸ä¼šä¸¢å¤±ç²¾åº¦ã€‚å ç”¨ç©ºé—´ç”±å®šä¹‰çš„å®½åº¦å†³å®šï¼Œæ¯ 4 ä¸ªå­—èŠ‚å¯ä»¥å­˜å‚¨ 9 ä½æ•°å­—ï¼Œå¹¶ä¸”å°æ•°ç‚¹è¦å ç”¨ä¸€ä¸ªå­—èŠ‚ã€‚å¯ç”¨äºå­˜å‚¨æ¯” bigint æ›´å¤§çš„æ•´å‹æ•°æ®ã€‚ ç´¢å¼•è®¾è®¡è§„èŒƒ é™åˆ¶æ¯å¼ è¡¨ä¸Šçš„ç´¢å¼•æ•°é‡ï¼Œå»ºè®®å•å¼ è¡¨ç´¢å¼•ä¸è¶…è¿‡ 5 ä¸ª ç´¢å¼•å¹¶ä¸æ˜¯è¶Šå¤šè¶Šå¥½ï¼ç´¢å¼•å¯ä»¥æé«˜æ•ˆç‡åŒæ ·ä¹Ÿå¯ä»¥é™ä½æ•ˆç‡ï¼›ç´¢å¼•å¯ä»¥å¢åŠ æŸ¥è¯¢æ•ˆç‡ï¼Œä½†åŒæ ·ä¹Ÿä¼šé™ä½æ’å…¥å’Œæ›´æ–°çš„æ•ˆç‡ï¼Œç”šè‡³æœ‰äº›æƒ…å†µä¸‹ä¼šé™ä½æŸ¥è¯¢æ•ˆç‡ã€‚å› ä¸º MySQL ä¼˜åŒ–å™¨åœ¨é€‰æ‹©å¦‚ä½•ä¼˜åŒ–æŸ¥è¯¢æ—¶ï¼Œä¼šæ ¹æ®ç»Ÿä¸€ä¿¡æ¯ï¼Œå¯¹æ¯ä¸€ä¸ªå¯ä»¥ç”¨åˆ°çš„ç´¢å¼•æ¥è¿›è¡Œè¯„ä¼°ï¼Œä»¥ç”Ÿæˆå‡ºä¸€ä¸ªæœ€å¥½çš„æ‰§è¡Œè®¡åˆ’ï¼Œå¦‚æœåŒæ—¶æœ‰å¾ˆå¤šä¸ªç´¢å¼•éƒ½å¯ä»¥ç”¨äºæŸ¥è¯¢ï¼Œå°±ä¼šå¢åŠ  MySQL ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ï¼ŒåŒæ ·ä¼šé™ä½æŸ¥è¯¢æ€§èƒ½ã€‚ ç¦æ­¢ç»™è¡¨ä¸­çš„æ¯ä¸€åˆ—éƒ½å»ºç«‹å•ç‹¬çš„ç´¢å¼• 5.6ç‰ˆæœ¬ä¹‹å‰ï¼Œä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨åˆ°ä¸€ä¸ªè¡¨ä¸­çš„ä¸€ä¸ªç´¢å¼•ï¼Œ5.6 ä»¥åï¼Œè™½ç„¶æœ‰äº†åˆå¹¶ç´¢å¼•çš„ä¼˜åŒ–æ–¹å¼ï¼Œä½†æ˜¯è¿˜æ˜¯è¿œè¿œæ²¡æœ‰ä½¿ç”¨ä¸€ä¸ªè”åˆç´¢å¼•çš„æŸ¥è¯¢æ–¹å¼å¥½ æ¯ä¸ª InnoDB è¡¨å¿…é¡»æœ‰ä¸ªä¸»é”® InnoDB æ˜¯ä¸€ç§ç´¢å¼•ç»„ç»‡è¡¨ï¼šæ•°æ®çš„å­˜å‚¨çš„é€»è¾‘é¡ºåºå’Œç´¢å¼•çš„é¡ºåºæ˜¯ç›¸åŒçš„ã€‚æ¯ä¸ªè¡¨éƒ½å¯ä»¥æœ‰å¤šä¸ªç´¢å¼•ï¼Œä½†æ˜¯è¡¨çš„å­˜å‚¨é¡ºåºåªèƒ½æœ‰ä¸€ç§ InnoDBæ˜¯æŒ‰ç…§ä¸»é”®ç´¢å¼•çš„é¡ºåºæ¥ç»„ç»‡è¡¨çš„ã€‚ ä¸è¦ä½¿ç”¨æ›´æ–°é¢‘ç¹çš„åˆ—ä½œä¸ºä¸»é”®ï¼Œä¸é€‚ç”¨å¤šåˆ—ä¸»é”®ï¼ˆç›¸å½“äºè”åˆç´¢å¼•ï¼‰ ä¸è¦ä½¿ç”¨ UUIDã€MD5ã€HASHã€å­—ç¬¦ä¸²åˆ—ä½œä¸ºä¸»é”®ï¼ˆæ— æ³•ä¿è¯æ•°æ®çš„é¡ºåºå¢é•¿ï¼‰ã€‚ä¸»é”®å»ºè®®ä½¿ç”¨è‡ªå¢ ID å€¼ã€‚ å¦‚ä½•é€‰æ‹©ç´¢å¼•åˆ—çš„é¡ºåº å»ºç«‹ç´¢å¼•çš„ç›®çš„æ˜¯å¸Œæœ›é€šè¿‡ç´¢å¼•è¿›è¡Œæ•°æ®æŸ¥æ‰¾ï¼Œå‡å°‘éšæœº IOï¼Œå¢åŠ æŸ¥è¯¢æ€§èƒ½ ï¼Œç´¢å¼•èƒ½è¿‡æ»¤å‡ºè¶Šå°‘çš„æ•°æ®ï¼Œåˆ™ä»ç£ç›˜ä¸­è¯»å…¥çš„æ•°æ®ä¹Ÿå°±è¶Šå°‘ã€‚ åŒºåˆ†åº¦æœ€é«˜çš„æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆåŒºåˆ†åº¦ = åˆ—ä¸­ä¸åŒå€¼çš„æ•°é‡ / åˆ—çš„æ€»è¡Œæ•°ï¼‰ã€‚ å°½é‡æŠŠå­—æ®µé•¿åº¦å°çš„åˆ—æ”¾åœ¨è”åˆç´¢å¼•çš„æœ€å·¦ä¾§ï¼ˆå› ä¸ºå­—æ®µé•¿åº¦è¶Šå°ï¼Œä¸€é¡µèƒ½å­˜å‚¨çš„æ•°æ®é‡è¶Šå¤§ï¼ŒIO æ€§èƒ½ä¹Ÿå°±è¶Šå¥½ï¼‰ã€‚ ä½¿ç”¨æœ€é¢‘ç¹çš„åˆ—æ”¾åˆ°è”åˆç´¢å¼•çš„å·¦ä¾§ï¼ˆè¿™æ ·å¯ä»¥æ¯”è¾ƒå°‘çš„å»ºç«‹ä¸€äº›ç´¢å¼•ï¼‰ã€‚ é¿å…å»ºç«‹å†—ä½™ç´¢å¼•å’Œé‡å¤ç´¢å¼• å› ä¸ºè¿™æ ·ä¼šå¢åŠ æŸ¥è¯¢ä¼˜åŒ–å™¨ç”Ÿæˆæ‰§è¡Œè®¡åˆ’çš„æ—¶é—´ã€‚ é‡å¤ç´¢å¼•ç¤ºä¾‹ï¼šprimary key(id)ã€index(id)ã€unique index(id) å†—ä½™ç´¢å¼•ç¤ºä¾‹ï¼šindex(a,b,c)ã€index(a,b)ã€index(a) ä¼˜å…ˆè€ƒè™‘è¦†ç›–ç´¢å¼• å¯¹äºé¢‘ç¹çš„æŸ¥è¯¢ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨è¦†ç›–ç´¢å¼•ã€‚ è¦†ç›–ç´¢å¼•ï¼šå°±æ˜¯åŒ…å«äº†æ‰€æœ‰æŸ¥è¯¢å­—æ®µ(where,select,ordery by,group byåŒ…å«çš„å­—æ®µ)çš„ç´¢å¼• è¦†ç›–ç´¢å¼•çš„å¥½å¤„ï¼š é¿å… InnoDB è¡¨è¿›è¡Œç´¢å¼•çš„äºŒæ¬¡æŸ¥è¯¢ã€‚InnoDB æ˜¯ä»¥èšé›†ç´¢å¼•çš„é¡ºåºæ¥å­˜å‚¨çš„ï¼Œå¯¹äº InnoDB æ¥è¯´ï¼ŒäºŒçº§ç´¢å¼•åœ¨å¶å­èŠ‚ç‚¹ä¸­æ‰€ä¿å­˜çš„æ˜¯è¡Œçš„ä¸»é”®ä¿¡æ¯ï¼Œå¦‚æœæ˜¯ç”¨äºŒçº§ç´¢å¼•æŸ¥è¯¢æ•°æ®çš„è¯ï¼Œåœ¨æŸ¥æ‰¾åˆ°ç›¸åº”çš„é”®å€¼åï¼Œè¿˜è¦é€šè¿‡ä¸»é”®è¿›è¡ŒäºŒæ¬¡æŸ¥è¯¢æ‰èƒ½è·å–æˆ‘ä»¬çœŸå®æ‰€éœ€è¦çš„æ•°æ®ã€‚è€Œåœ¨è¦†ç›–ç´¢å¼•ä¸­ï¼ŒäºŒçº§ç´¢å¼•çš„é”®å€¼ä¸­å¯ä»¥è·å–æ‰€æœ‰çš„æ•°æ®ï¼Œé¿å…äº†å¯¹ä¸»é”®çš„äºŒæ¬¡æŸ¥è¯¢ ï¼Œå‡å°‘äº† IO æ“ä½œï¼Œæå‡äº†æŸ¥è¯¢æ•ˆç‡ã€‚ å¯ä»¥æŠŠéšæœº IO å˜æˆé¡ºåº IO åŠ å¿«æŸ¥è¯¢æ•ˆç‡ã€‚ç”±äºè¦†ç›–ç´¢å¼•æ˜¯æŒ‰é”®å€¼çš„é¡ºåºå­˜å‚¨çš„ï¼Œå¯¹äº IO å¯†é›†å‹çš„èŒƒå›´æŸ¥æ‰¾æ¥è¯´ï¼Œå¯¹æ¯”éšæœºä»ç£ç›˜è¯»å–æ¯ä¸€è¡Œçš„æ•°æ® IO è¦å°‘çš„å¤šï¼Œå› æ­¤åˆ©ç”¨è¦†ç›–ç´¢å¼•åœ¨è®¿é—®æ—¶ä¹Ÿå¯ä»¥æŠŠç£ç›˜çš„éšæœºè¯»å–çš„ IO è½¬å˜æˆç´¢å¼•æŸ¥æ‰¾çš„é¡ºåº IOã€‚ æ•°æ®åº“ SQL å¼€å‘è§„èŒƒ å»ºè®®ä½¿ç”¨é¢„ç¼–è¯‘è¯­å¥è¿›è¡Œæ•°æ®åº“æ“ä½œ é¢„ç¼–è¯‘è¯­å¥å¯ä»¥é‡å¤ä½¿ç”¨è¿™äº›è®¡åˆ’ï¼Œå‡å°‘ SQL ç¼–è¯‘æ‰€éœ€è¦çš„æ—¶é—´ï¼Œè¿˜å¯ä»¥è§£å†³åŠ¨æ€ SQL æ‰€å¸¦æ¥çš„ SQL æ³¨å…¥çš„é—®é¢˜ï¼Œ åªä¼ å‚æ•°ï¼Œæ¯”ä¼ é€’ SQL è¯­å¥æ›´é«˜æ•ˆ ç›¸åŒè¯­å¥å¯ä»¥ä¸€æ¬¡è§£æï¼Œå¤šæ¬¡ä½¿ç”¨ï¼Œæé«˜å¤„ç†æ•ˆç‡ã€‚ é¿å…æ•°æ®ç±»å‹çš„éšå¼è½¬æ¢ éšå¼è½¬æ¢ä¼šå¯¼è‡´ç´¢å¼•å¤±æ•ˆã€‚å¦‚ï¼šselect name,phone from customer where id = '111'; å……åˆ†åˆ©ç”¨è¡¨ä¸Šå·²ç»å­˜åœ¨çš„ç´¢å¼• é¿å…ä½¿ç”¨åŒ % å·çš„æŸ¥è¯¢æ¡ä»¶ã€‚å¦‚a like '%123%'ï¼Œï¼ˆå¦‚æœæ— å‰ç½® %ï¼Œåªæœ‰åç½® %ï¼Œæ˜¯å¯ä»¥ç”¨åˆ°åˆ—ä¸Šçš„ç´¢å¼•çš„ï¼‰ ä½¿ç”¨ left join æˆ– not exists æ¥ä¼˜åŒ– not in æ“ä½œ,å› ä¸º not in ä¹Ÿé€šå¸¸ä¼šä½¿ç”¨ç´¢å¼•å¤±æ•ˆã€‚ æ•°æ®åº“è®¾è®¡æ—¶ï¼Œåº”è¯¥è¦å¯¹ä»¥åæ‰©å±•è¿›è¡Œè€ƒè™‘ ç¨‹åºè¿æ¥ä¸åŒçš„æ•°æ®åº“ä½¿ç”¨ä¸åŒçš„è´¦å·ï¼Œè¿›åˆ¶è·¨åº“æŸ¥è¯¢ ç¦æ­¢ä½¿ç”¨ SELECT * å¿…é¡»ä½¿ç”¨ SELECT &lt;å­—æ®µåˆ—è¡¨&gt; æŸ¥è¯¢ æ¶ˆè€—æ›´å¤šçš„ CPU å’Œ IO ä»¥ç½‘ç»œå¸¦å®½èµ„æº æ— æ³•ä½¿ç”¨è¦†ç›–ç´¢å¼• å¯å‡å°‘è¡¨ç»“æ„å˜æ›´å¸¦æ¥çš„å½±å“ ç¦æ­¢ä½¿ç”¨ä¸å«å­—æ®µåˆ—è¡¨çš„ INSERT è¯­å¥ å¦‚ï¼šinsert into values ('a','b','c'); åº”ä½¿ç”¨ï¼šinsert into t(c1,c2,c3) values ('a','b','c'); é¿å…ä½¿ç”¨å­æŸ¥è¯¢ï¼Œå¯ä»¥æŠŠå­æŸ¥è¯¢ä¼˜åŒ–ä¸º JOIN æ“ä½œ é€šå¸¸å­æŸ¥è¯¢åœ¨ in å­å¥ä¸­ï¼Œä¸”å­æŸ¥è¯¢ä¸­ä¸ºç®€å• SQL ( ä¸åŒ…å« unionã€group byã€order byã€limit ä»å¥ ) æ—¶ï¼Œæ‰å¯ä»¥æŠŠå­æŸ¥è¯¢è½¬åŒ–ä¸ºå…³è”æŸ¥è¯¢è¿›è¡Œä¼˜åŒ–ã€‚ å­æŸ¥è¯¢æ€§èƒ½å·®çš„åŸå› ï¼š å­æŸ¥è¯¢çš„ç»“æœé›†æ— æ³•ä½¿ç”¨ç´¢å¼•ï¼Œé€šå¸¸å­æŸ¥è¯¢çš„ç»“æœé›†ä¼šè¢«å­˜å‚¨åˆ°ä¸´æ—¶è¡¨ä¸­ï¼Œä¸è®ºæ˜¯å†…å­˜ä¸´æ—¶è¡¨è¿˜æ˜¯ç£ç›˜ä¸´æ—¶è¡¨éƒ½ä¸ä¼šå­˜åœ¨ç´¢å¼•ï¼Œæ‰€ä»¥æŸ¥è¯¢æ€§èƒ½ä¼šå—åˆ°ä¸€å®šçš„å½±å“ã€‚ ç‰¹åˆ«æ˜¯å¯¹äºè¿”å›ç»“æœé›†æ¯”è¾ƒå¤§çš„å­æŸ¥è¯¢ï¼Œå…¶å¯¹æŸ¥è¯¢æ€§èƒ½çš„å½±å“ä¹Ÿå°±è¶Šå¤§ã€‚ ç”±äºå­æŸ¥è¯¢ä¼šäº§ç”Ÿå¤§é‡çš„ä¸´æ—¶è¡¨ä¹Ÿæ²¡æœ‰ç´¢å¼•ï¼Œæ‰€ä»¥ä¼šæ¶ˆè€—è¿‡å¤šçš„ CPU å’Œ IO èµ„æºï¼Œäº§ç”Ÿå¤§é‡çš„æ…¢æŸ¥è¯¢ã€‚ é¿å…ä½¿ç”¨ JOIN å…³è”å¤ªå¤šçš„è¡¨ å¯¹äº MySQL æ¥è¯´ï¼Œæ˜¯å­˜åœ¨å…³è”ç¼“å­˜çš„ï¼Œç¼“å­˜çš„å¤§å°å¯ä»¥ç”± join_buffer_size å‚æ•°è¿›è¡Œè®¾ç½®ã€‚ åœ¨ MySQL ä¸­ï¼Œå¯¹äºåŒä¸€ä¸ª SQL å¤šå…³è”ï¼ˆjoinï¼‰ä¸€ä¸ªè¡¨ï¼Œå°±ä¼šå¤šåˆ†é…ä¸€ä¸ªå…³è”ç¼“å­˜ï¼Œå¦‚æœåœ¨ä¸€ä¸ª SQL ä¸­å…³è”çš„è¡¨è¶Šå¤šï¼Œæ‰€å ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šå¤§ã€‚ å¦‚æœç¨‹åºä¸­å¤§é‡çš„ä½¿ç”¨äº†å¤šè¡¨å…³è”çš„æ“ä½œï¼ŒåŒæ—¶ join_buffer_size è®¾ç½®çš„ä¹Ÿä¸åˆç†çš„æƒ…å†µä¸‹ï¼Œå°±å®¹æ˜“é€ æˆæœåŠ¡å™¨å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Œå°±ä¼šå½±å“åˆ°æœåŠ¡å™¨æ•°æ®åº“æ€§èƒ½çš„ç¨³å®šæ€§ã€‚ åŒæ—¶å¯¹äºå…³è”æ“ä½œæ¥è¯´ï¼Œä¼šäº§ç”Ÿä¸´æ—¶è¡¨æ“ä½œï¼Œå½±å“æŸ¥è¯¢æ•ˆç‡ MySQL æœ€å¤šå…è®¸å…³è” 61 ä¸ªè¡¨ï¼Œå»ºè®®ä¸è¶…è¿‡ 5 ä¸ªã€‚ å‡å°‘åŒæ•°æ®åº“çš„äº¤äº’æ¬¡æ•° æ•°æ®åº“æ›´é€‚åˆå¤„ç†æ‰¹é‡æ“ä½œ åˆå¹¶å¤šä¸ªç›¸åŒçš„æ“ä½œåˆ°ä¸€èµ·ï¼Œå¯ä»¥æé«˜å¤„ç†æ•ˆç‡ å¯¹åº”åŒä¸€åˆ—è¿›è¡Œ or åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨ in ä»£æ›¿ or In çš„å€¼ä¸è¦è¶…è¿‡ 500 ä¸ªï¼Œ in æ“ä½œå¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç´¢å¼•ï¼Œor å¤§å¤šæ•°æƒ…å†µä¸‹å¾ˆå°‘èƒ½åˆ©ç”¨åˆ°ç´¢å¼•ã€‚ ç¦æ­¢ä½¿ç”¨ order by rand() è¿›è¡Œéšæœºæ’åº ä¼šæŠŠè¡¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„æ•°æ®è£…è½½åˆ°å†…å­˜ä¸­ï¼Œç„¶ååœ¨å†…å­˜ä¸­å¯¹æ‰€æœ‰æ•°æ®æ ¹æ®éšæœºç”Ÿæˆçš„å€¼è¿›è¡Œæ’åºï¼Œå¹¶ä¸”å¯èƒ½ä¼šå¯¹æ¯ä¸€è¡Œéƒ½ç”Ÿæˆä¸€ä¸ªéšæœºå€¼ï¼Œå¦‚æœæ»¡è¶³æ¡ä»¶çš„æ•°æ®é›†éå¸¸å¤§ï¼Œå°±ä¼šæ¶ˆè€—å¤§é‡çš„ CPU å’Œ IO åŠå†…å­˜èµ„æºã€‚ æ¨èåœ¨ç¨‹åºä¸­è·å–ä¸€ä¸ªéšæœºå€¼ï¼Œç„¶åä»æ•°æ®åº“ä¸­è·å–æ•°æ®çš„æ–¹å¼ã€‚ WHEREä»å¥ä¸­ç¦æ­¢å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢å’Œè®¡ç®— å¯¹åˆ—è¿›è¡Œå‡½æ•°è½¬æ¢æˆ–è®¡ç®—æ—¶ä¼šå¯¼è‡´æ— æ³•ä½¿ç”¨ç´¢å¼•ã€‚ åœ¨æ˜æ˜¾ä¸ä¼šæœ‰é‡å¤å€¼æ—¶ä½¿ç”¨ UNION ALL è€Œä¸æ˜¯ UNION UNION ä¼šæŠŠä¸¤ä¸ªç»“æœé›†çš„æ‰€æœ‰æ•°æ®æ”¾åˆ°ä¸´æ—¶è¡¨ä¸­åå†è¿›è¡Œå»é‡æ“ä½œã€‚ UNION ALL ä¸ä¼šå†å¯¹ç»“æœé›†è¿›è¡Œå»é‡æ“ä½œã€‚ æ‹†åˆ†å¤æ‚çš„å¤§ SQL ä¸ºå¤šä¸ªå° SQL å¤§ SQLï¼šé€»è¾‘ä¸Šæ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å ç”¨å¤§é‡ CPU è¿›è¡Œè®¡ç®—çš„SQL ã€‚ MySQLï¼šä¸€ä¸ª SQL åªèƒ½ä½¿ç”¨ä¸€ä¸ª CPU è¿›è¡Œè®¡ç®—ã€‚ SQL æ‹†åˆ†åå¯ä»¥é€šè¿‡å¹¶è¡Œæ‰§è¡Œæ¥æé«˜å¤„ç†æ•ˆç‡ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[OOMå¸¸è§åŸå› åŠè§£å†³]]></title>
    <url>%2Fposts%2Fa5594ffa.html</url>
    <content type="text"><![CDATA[Java heap space å½“å †å†…å­˜ï¼ˆHeap Spaceï¼‰æ²¡æœ‰è¶³å¤Ÿç©ºé—´å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ï¼Œå°±ä¼šæŠ›å‡º java.lang.OutOfMemoryError:Javaheap space é”™è¯¯ï¼ˆæ ¹æ®å®é™…ç”Ÿäº§ç»éªŒï¼Œå¯ä»¥å¯¹ç¨‹åºæ—¥å¿—ä¸­çš„ OutOfMemoryError é…ç½®å…³é”®å­—å‘Šè­¦ï¼Œä¸€ç»å‘ç°ï¼Œç«‹å³å¤„ç†ï¼‰ã€‚ åŸå› åˆ†æ Javaheap space é”™è¯¯äº§ç”Ÿçš„å¸¸è§åŸå› å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š 1ã€è¯·æ±‚åˆ›å»ºä¸€ä¸ªè¶…å¤§å¯¹è±¡ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªå¤§æ•°ç»„ã€‚ 2ã€è¶…å‡ºé¢„æœŸçš„è®¿é—®é‡/æ•°æ®é‡ï¼Œé€šå¸¸æ˜¯ä¸Šæ¸¸ç³»ç»Ÿè¯·æ±‚æµé‡é£™å‡ï¼Œå¸¸è§äºå„ç±»ä¿ƒé”€/ç§’æ€æ´»åŠ¨ï¼Œå¯ä»¥ç»“åˆä¸šåŠ¡æµé‡æŒ‡æ ‡æ’æŸ¥æ˜¯å¦æœ‰å°–çŠ¶å³°å€¼ã€‚ 3ã€è¿‡åº¦ä½¿ç”¨ç»ˆç»“å™¨ï¼ˆFinalizerï¼‰ï¼Œè¯¥å¯¹è±¡æ²¡æœ‰ç«‹å³è¢« GCã€‚ 4ã€å†…å­˜æ³„æ¼ï¼ˆMemory Leakï¼‰ï¼Œå¤§é‡å¯¹è±¡å¼•ç”¨æ²¡æœ‰é‡Šæ”¾ï¼ŒJVM æ— æ³•å¯¹å…¶è‡ªåŠ¨å›æ”¶ï¼Œå¸¸è§äºä½¿ç”¨äº† File ç­‰èµ„æºæ²¡æœ‰å›æ”¶ã€‚ è§£å†³æ–¹æ¡ˆ é’ˆå¯¹å¤§éƒ¨åˆ†æƒ…å†µï¼Œé€šå¸¸åªéœ€è¦é€šè¿‡ -Xmx å‚æ•°è°ƒé«˜ JVM å †å†…å­˜ç©ºé—´å³å¯ã€‚å¦‚æœä»ç„¶æ²¡æœ‰è§£å†³ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹æƒ…å†µåšè¿›ä¸€æ­¥å¤„ç†ï¼š 1ã€å¦‚æœæ˜¯è¶…å¤§å¯¹è±¡ï¼Œå¯ä»¥æ£€æŸ¥å…¶åˆç†æ€§ï¼Œæ¯”å¦‚æ˜¯å¦ä¸€æ¬¡æ€§æŸ¥è¯¢äº†æ•°æ®åº“å…¨éƒ¨ç»“æœï¼Œè€Œæ²¡æœ‰åšç»“æœæ•°é™åˆ¶ã€‚ 2ã€å¦‚æœæ˜¯ä¸šåŠ¡å³°å€¼å‹åŠ›ï¼Œå¯ä»¥è€ƒè™‘å¢åŠ æœºå™¨èµ„æºï¼Œæˆ–è€…åšé™æµé™çº§ã€‚ 3ã€å¦‚æœæ˜¯å†…å­˜æ³„æ¼ï¼Œéœ€è¦æ‰¾åˆ°æŒæœ‰çš„å¯¹è±¡ï¼Œä¿®æ”¹ä»£ç è®¾è®¡ï¼Œæ¯”å¦‚å…³é—­æ²¡æœ‰é‡Šæ”¾çš„è¿æ¥ã€‚ GC overhead limit exceeded å½“ Java è¿›ç¨‹èŠ±è´¹ 98% ä»¥ä¸Šçš„æ—¶é—´æ‰§è¡Œ GCï¼Œä½†åªæ¢å¤äº†ä¸åˆ° 2% çš„å†…å­˜ï¼Œä¸”è¯¥åŠ¨ä½œè¿ç»­é‡å¤äº† 5 æ¬¡ï¼Œå°±ä¼šæŠ›å‡º java.lang.OutOfMemoryError:GC overhead limit exceededé”™è¯¯ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åº”ç”¨ç¨‹åºå·²ç»åŸºæœ¬è€—å°½äº†æ‰€æœ‰å¯ç”¨å†…å­˜ï¼Œ GC ä¹Ÿæ— æ³•å›æ”¶ã€‚ æ­¤ç±»é—®é¢˜çš„åŸå› ä¸è§£å†³æ–¹æ¡ˆè·Ÿ Javaheap space éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒã€‚ Permgen space è¯¥é”™è¯¯è¡¨ç¤ºæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰å·²ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚ åŸå› åˆ†æ æ°¸ä¹…ä»£å­˜å‚¨å¯¹è±¡ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€åŠ è½½/ç¼“å­˜åˆ°å†…å­˜ä¸­çš„ class å®šä¹‰ï¼ŒåŒ…æ‹¬ç±»çš„åç§°ï¼Œå­—æ®µï¼Œæ–¹æ³•å’Œå­—èŠ‚ç ï¼› 2ã€å¸¸é‡æ± ï¼› 3ã€å¯¹è±¡æ•°ç»„/ç±»å‹æ•°ç»„æ‰€å…³è”çš„ classï¼› 4ã€JIT ç¼–è¯‘å™¨ä¼˜åŒ–åçš„ class ä¿¡æ¯ã€‚ PermGen çš„ä½¿ç”¨é‡ä¸åŠ è½½åˆ°å†…å­˜çš„ class çš„æ•°é‡/å¤§å°æ­£ç›¸å…³ã€‚ è§£å†³æ–¹æ¡ˆ æ ¹æ® Permgen space æŠ¥é”™çš„æ—¶æœºï¼Œå¯ä»¥é‡‡ç”¨ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œå¦‚ä¸‹ï¼š 1ã€ç¨‹åºå¯åŠ¨æŠ¥é”™ï¼Œä¿®æ”¹ -XX:MaxPermSize å¯åŠ¨å‚æ•°ï¼Œè°ƒå¤§æ°¸ä¹…ä»£ç©ºé—´ã€‚ 2ã€åº”ç”¨é‡æ–°éƒ¨ç½²æ—¶æŠ¥é”™ï¼Œå¾ˆå¯èƒ½æ˜¯æ²¡æœ‰åº”ç”¨æ²¡æœ‰é‡å¯ï¼Œå¯¼è‡´åŠ è½½äº†å¤šä»½ class ä¿¡æ¯ï¼Œåªéœ€é‡å¯ JVM å³å¯è§£å†³ã€‚ 3ã€è¿è¡Œæ—¶æŠ¥é”™ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½ä¼šåŠ¨æ€åˆ›å»ºå¤§é‡ classï¼Œè€Œè¿™äº› class çš„ç”Ÿå‘½å‘¨æœŸå¾ˆçŸ­æš‚ï¼Œä½†æ˜¯ JVM é»˜è®¤ä¸ä¼šå¸è½½ classï¼Œå¯ä»¥è®¾ç½® -XX:+CMSClassUnloadingEnabled å’Œ -XX:+UseConcMarkSweepGCè¿™ä¸¤ä¸ªå‚æ•°å…è®¸ JVM å¸è½½ classã€‚ å¦‚æœä¸Šè¿°æ–¹æ³•æ— æ³•è§£å†³ï¼Œå¯ä»¥é€šè¿‡ jmap å‘½ä»¤ dump å†…å­˜å¯¹è±¡ jmap-dump:format=b,file=dump.hprof&lt;process-id&gt;ï¼Œç„¶ååˆ©ç”¨ Eclipse MAT https://www.eclipse.org/mat åŠŸèƒ½é€ä¸€åˆ†æå¼€é”€æœ€å¤§çš„ classloader å’Œé‡å¤ classã€‚ Metaspace JDK 1.8 ä½¿ç”¨ Metaspace æ›¿æ¢äº†æ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰ï¼Œè¯¥é”™è¯¯è¡¨ç¤º Metaspace å·²è¢«ç”¨æ»¡ï¼Œé€šå¸¸æ˜¯å› ä¸ºåŠ è½½çš„ class æ•°ç›®å¤ªå¤šæˆ–ä½“ç§¯å¤ªå¤§ã€‚ æ­¤ç±»é—®é¢˜çš„åŸå› ä¸è§£å†³æ–¹æ³•è·Ÿ Permgenspace éå¸¸ç±»ä¼¼ï¼Œå¯ä»¥å‚è€ƒã€‚éœ€è¦ç‰¹åˆ«æ³¨æ„çš„æ˜¯è°ƒæ•´ Metaspace ç©ºé—´å¤§å°çš„å¯åŠ¨å‚æ•°ä¸º -XX:MaxMetaspaceSizeã€‚ Unable to create new native thread æ¯ä¸ª Java çº¿ç¨‹éƒ½éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼Œå½“ JVM å‘åº•å±‚æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹æ—¶ï¼Œå¦‚æœæ²¡æœ‰è¶³å¤Ÿçš„èµ„æºåˆ†é…å°±ä¼šæŠ¥æ­¤ç±»é”™è¯¯ã€‚ åŸå› åˆ†æ JVM å‘ OS è¯·æ±‚åˆ›å»º native çº¿ç¨‹å¤±è´¥ï¼Œå°±ä¼šæŠ›å‡º Unableto create new native threadï¼Œå¸¸è§çš„åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€çº¿ç¨‹æ•°è¶…è¿‡æ“ä½œç³»ç»Ÿæœ€å¤§çº¿ç¨‹æ•° ulimit é™åˆ¶ï¼› 2ã€çº¿ç¨‹æ•°è¶…è¿‡ kernel.pid_maxï¼ˆåªèƒ½é‡å¯ï¼‰ï¼› 3ã€native å†…å­˜ä¸è¶³ï¼› è¯¥é—®é¢˜å‘ç”Ÿçš„å¸¸è§è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ æ­¥ï¼š 1ã€JVM å†…éƒ¨çš„åº”ç”¨ç¨‹åºè¯·æ±‚åˆ›å»ºä¸€ä¸ªæ–°çš„ Java çº¿ç¨‹ï¼› 2ã€JVM native æ–¹æ³•ä»£ç†äº†è¯¥æ¬¡è¯·æ±‚ï¼Œå¹¶å‘æ“ä½œç³»ç»Ÿè¯·æ±‚åˆ›å»ºä¸€ä¸ª native çº¿ç¨‹ï¼› 3ã€æ“ä½œç³»ç»Ÿå°è¯•åˆ›å»ºä¸€ä¸ªæ–°çš„ native çº¿ç¨‹ï¼Œå¹¶ä¸ºå…¶åˆ†é…å†…å­˜ï¼› 4ã€å¦‚æœæ“ä½œç³»ç»Ÿçš„è™šæ‹Ÿå†…å­˜å·²è€—å°½ï¼Œæˆ–æ˜¯å—åˆ° 32 ä½è¿›ç¨‹çš„åœ°å€ç©ºé—´é™åˆ¶ï¼Œæ“ä½œç³»ç»Ÿå°±ä¼šæ‹’ç»æœ¬æ¬¡ native å†…å­˜åˆ†é…ï¼› 5ã€JVM å°†æŠ›å‡º java.lang.OutOfMemoryError:Unable to create new native thread é”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§é…ç½®ï¼Œä¸ºæœºå™¨æä¾›æ›´å¤šçš„å†…å­˜ï¼› 2ã€é™ä½ Java Heap Space å¤§å°ï¼› 3ã€ä¿®å¤åº”ç”¨ç¨‹åºçš„çº¿ç¨‹æ³„æ¼é—®é¢˜ï¼› 4ã€é™åˆ¶çº¿ç¨‹æ± å¤§å°ï¼› 5ã€ä½¿ç”¨ -Xss å‚æ•°å‡å°‘çº¿ç¨‹æ ˆçš„å¤§å°ï¼› 6ã€è°ƒé«˜ OS å±‚é¢çš„çº¿ç¨‹æœ€å¤§æ•°ï¼šæ‰§è¡Œ ulimia-a æŸ¥çœ‹æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ï¼Œä½¿ç”¨ ulimit-u xxx è°ƒæ•´æœ€å¤§çº¿ç¨‹æ•°é™åˆ¶ã€‚ ulimit -a .... çœç•¥éƒ¨åˆ†å†…å®¹ ..... max user processes (-u) 16384 Out of swap space? è¯¥é”™è¯¯è¡¨ç¤ºæ‰€æœ‰å¯ç”¨çš„è™šæ‹Ÿå†…å­˜å·²è¢«è€—å°½ã€‚è™šæ‹Ÿå†…å­˜ï¼ˆVirtual Memoryï¼‰ç”±ç‰©ç†å†…å­˜ï¼ˆPhysical Memoryï¼‰å’Œäº¤æ¢ç©ºé—´ï¼ˆSwap Spaceï¼‰ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“è¿è¡Œæ—¶ç¨‹åºè¯·æ±‚çš„è™šæ‹Ÿå†…å­˜æº¢å‡ºæ—¶å°±ä¼šæŠ¥ Outof swap space?é”™è¯¯ã€‚ åŸå› åˆ†æ è¯¥é”™è¯¯å‡ºç°çš„å¸¸è§åŸå› åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š 1ã€åœ°å€ç©ºé—´ä¸è¶³ï¼› 2ã€ç‰©ç†å†…å­˜å·²è€—å…‰ï¼› 3ã€åº”ç”¨ç¨‹åºçš„æœ¬åœ°å†…å­˜æ³„æ¼ï¼ˆnative leakï¼‰ï¼Œä¾‹å¦‚ä¸æ–­ç”³è¯·æœ¬åœ°å†…å­˜ï¼Œå´ä¸é‡Šæ”¾ã€‚ 4ã€æ‰§è¡Œ jmap-histo:live&lt;pid&gt; å‘½ä»¤ï¼Œå¼ºåˆ¶æ‰§è¡Œ Full GCï¼›å¦‚æœå‡ æ¬¡æ‰§è¡Œåå†…å­˜æ˜æ˜¾ä¸‹é™ï¼Œåˆ™åŸºæœ¬ç¡®è®¤ä¸º Direct ByteBuffer é—®é¢˜ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§åœ°å€ç©ºé—´ä¸º 64 bitï¼› 2ã€ä½¿ç”¨ Arthas æ£€æŸ¥æ˜¯å¦ä¸º Inflater/Deflater è§£å‹ç¼©é—®é¢˜ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™æ˜¾å¼è°ƒç”¨ end æ–¹æ³•ã€‚ 3ã€Direct ByteBuffer é—®é¢˜å¯ä»¥é€šè¿‡å¯åŠ¨å‚æ•° -XX:MaxDirectMemorySize è°ƒä½é˜ˆå€¼ã€‚ 4ã€å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚ Kill process or sacrifice child æœ‰ä¸€ç§å†…æ ¸ä½œä¸šï¼ˆKernel Jobï¼‰åä¸º Out of Memory Killerï¼Œå®ƒä¼šåœ¨å¯ç”¨å†…å­˜æä½çš„æƒ…å†µä¸‹â€œæ€æ­»â€ï¼ˆkillï¼‰æŸäº›è¿›ç¨‹ã€‚OOM Killer ä¼šå¯¹æ‰€æœ‰è¿›ç¨‹è¿›è¡Œæ‰“åˆ†ï¼Œç„¶åå°†è¯„åˆ†è¾ƒä½çš„è¿›ç¨‹â€œæ€æ­»â€ï¼Œå…·ä½“çš„è¯„åˆ†è§„åˆ™å¯ä»¥å‚è€ƒ Surviving the Linux OOM Killerã€‚ ä¸åŒäºå…¶ä»–çš„ OOM é”™è¯¯ï¼Œ Killprocessorsacrifice child é”™è¯¯ä¸æ˜¯ç”± JVM å±‚é¢è§¦å‘çš„ï¼Œè€Œæ˜¯ç”±æ“ä½œç³»ç»Ÿå±‚é¢è§¦å‘çš„ã€‚ åŸå› åˆ†æ é»˜è®¤æƒ…å†µä¸‹ï¼ŒLinux å†…æ ¸å…è®¸è¿›ç¨‹ç”³è¯·çš„å†…å­˜æ€»é‡å¤§äºç³»ç»Ÿå¯ç”¨å†…å­˜ï¼Œé€šè¿‡è¿™ç§â€œé”™å³°å¤ç”¨â€çš„æ–¹å¼å¯ä»¥æ›´æœ‰æ•ˆçš„åˆ©ç”¨ç³»ç»Ÿèµ„æºã€‚ ç„¶è€Œï¼Œè¿™ç§æ–¹å¼ä¹Ÿä¼šæ— å¯é¿å…åœ°å¸¦æ¥ä¸€å®šçš„â€œè¶…å–â€é£é™©ã€‚ä¾‹å¦‚æŸäº›è¿›ç¨‹æŒç»­å ç”¨ç³»ç»Ÿå†…å­˜ï¼Œç„¶åå¯¼è‡´å…¶ä»–è¿›ç¨‹æ²¡æœ‰å¯ç”¨å†…å­˜ã€‚æ­¤æ—¶ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¿€æ´» OOM Killerï¼Œå¯»æ‰¾è¯„åˆ†ä½çš„è¿›ç¨‹ï¼Œå¹¶å°†å…¶â€œæ€æ­»â€ï¼Œé‡Šæ”¾å†…å­˜èµ„æºã€‚ è§£å†³æ–¹æ¡ˆ 1ã€å‡çº§æœåŠ¡å™¨é…ç½®/éš”ç¦»éƒ¨ç½²ï¼Œé¿å…äº‰ç”¨ã€‚ 2ã€OOM Killer è°ƒä¼˜ã€‚ Requested array size exceeds VM limit JVM é™åˆ¶äº†æ•°ç»„çš„æœ€å¤§é•¿åº¦ï¼Œè¯¥é”™è¯¯è¡¨ç¤ºç¨‹åºè¯·æ±‚åˆ›å»ºçš„æ•°ç»„è¶…è¿‡æœ€å¤§é•¿åº¦é™åˆ¶ã€‚ JVM åœ¨ä¸ºæ•°ç»„åˆ†é…å†…å­˜å‰ï¼Œä¼šæ£€æŸ¥è¦åˆ†é…çš„æ•°æ®ç»“æ„åœ¨ç³»ç»Ÿä¸­æ˜¯å¦å¯å¯»å€ï¼Œé€šå¸¸ä¸º Integer.MAX_VALUE-2ã€‚ æ­¤ç±»é—®é¢˜æ¯”è¾ƒç½•è§ï¼Œé€šå¸¸éœ€è¦æ£€æŸ¥ä»£ç ï¼Œç¡®è®¤ä¸šåŠ¡æ˜¯å¦éœ€è¦åˆ›å»ºå¦‚æ­¤å¤§çš„æ•°ç»„ï¼Œæ˜¯å¦å¯ä»¥æ‹†åˆ†ä¸ºå¤šä¸ªå—ï¼Œåˆ†æ‰¹æ‰§è¡Œã€‚ Direct buffer memory Java å…è®¸åº”ç”¨ç¨‹åºé€šè¿‡ Direct ByteBuffer ç›´æ¥è®¿é—®å †å¤–å†…å­˜ï¼Œè®¸å¤šé«˜æ€§èƒ½ç¨‹åºé€šè¿‡ Direct ByteBuffer ç»“åˆå†…å­˜æ˜ å°„æ–‡ä»¶ï¼ˆMemory Mapped Fileï¼‰å®ç°é«˜é€Ÿ IOã€‚ åŸå› åˆ†æ Direct ByteBuffer çš„é»˜è®¤å¤§å°ä¸º 64 MBï¼Œä¸€æ—¦ä½¿ç”¨è¶…å‡ºé™åˆ¶ï¼Œå°±ä¼šæŠ›å‡º Directbuffer memory é”™è¯¯ã€‚ è§£å†³æ–¹æ¡ˆ 1ã€Java åªèƒ½é€šè¿‡ ByteBuffer.allocateDirect æ–¹æ³•ä½¿ç”¨ Direct ByteBufferï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡ Arthas ç­‰åœ¨çº¿è¯Šæ–­å·¥å…·æ‹¦æˆªè¯¥æ–¹æ³•è¿›è¡Œæ’æŸ¥ã€‚ 2ã€æ£€æŸ¥æ˜¯å¦ç›´æ¥æˆ–é—´æ¥ä½¿ç”¨äº† NIOï¼Œå¦‚ nettyï¼Œjetty ç­‰ã€‚ 3ã€é€šè¿‡å¯åŠ¨å‚æ•° -XX:MaxDirectMemorySize è°ƒæ•´ Direct ByteBuffer çš„ä¸Šé™å€¼ã€‚ 4ã€æ£€æŸ¥ JVM å‚æ•°æ˜¯å¦æœ‰ -XX:+DisableExplicitGC é€‰é¡¹ï¼Œå¦‚æœæœ‰å°±å»æ‰ï¼Œå› ä¸ºè¯¥å‚æ•°ä¼šä½¿ System.gc() å¤±æ•ˆã€‚ 5ã€æ£€æŸ¥å †å¤–å†…å­˜ä½¿ç”¨ä»£ç ï¼Œç¡®è®¤æ˜¯å¦å­˜åœ¨å†…å­˜æ³„æ¼ï¼›æˆ–è€…é€šè¿‡åå°„è°ƒç”¨ sun.misc.Cleaner çš„ clean() æ–¹æ³•æ¥ä¸»åŠ¨é‡Šæ”¾è¢« Direct ByteBuffer æŒæœ‰çš„å†…å­˜ç©ºé—´ã€‚ 6ã€å†…å­˜å®¹é‡ç¡®å®ä¸è¶³ï¼Œå‡çº§é…ç½®ã€‚ Tomcatä¸­java.lang.OutOfMemoryError: Java heap spaceå¼‚å¸¸å¤„ç† åŸå› åˆ†æ Heap sizeï¼šJVMå †çš„è®¾ç½®æ˜¯æŒ‡javaç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­JVMå¯ä»¥è°ƒé…ä½¿ç”¨çš„å†…å­˜ç©ºé—´çš„è®¾ç½®ã€‚JVMåœ¨å¯åŠ¨çš„æ—¶å€™ä¼šè‡ªåŠ¨è®¾ç½®Heap sizeçš„å€¼ï¼Œ å…¶åˆå§‹ç©ºé—´(å³-Xms)æ˜¯ç‰©ç†å†…å­˜çš„1/64ï¼Œæœ€å¤§ç©ºé—´(-Xmx)æ˜¯ç‰©ç†å†…å­˜çš„1/4ã€‚ å¯ä»¥åˆ©ç”¨JVMæä¾›çš„-Xmn -Xms -Xmxç­‰é€‰é¡¹è¿›è¡Œè®¾ç½®ã€‚Heap size çš„å¤§å°æ˜¯Young Generation å’ŒTenured Generaionä¹‹å’Œã€‚ æç¤ºï¼šåœ¨JVMä¸­å¦‚æœ98ï¼…çš„æ—¶é—´æ˜¯ç”¨äºGCä¸”å¯ç”¨çš„Heap size ä¸è¶³2ï¼…çš„æ—¶å€™å°†æŠ›å‡ºæ­¤å¼‚å¸¸ä¿¡æ¯ã€‚ Heap Size æœ€å¤§ä¸è¦è¶…è¿‡å¯ç”¨ç‰©ç†å†…å­˜çš„80ï¼…ï¼Œä¸€èˆ¬çš„è¦å°†-Xmså’Œ-Xmxé€‰é¡¹è®¾ç½®ä¸ºç›¸åŒï¼Œè€Œ-Xmnä¸º1/4çš„-Xmxå€¼ã€‚ è§£å†³æ–¹æ¡ˆ æ‰‹åŠ¨è®¾ç½®Heap sizeï¼Œä¿®æ”¹TOMCAT_HOME/bin/catalina.sh åœ¨ 1â€œecho "Using CATALINA_BASE: $CATALINA_BASE"â€ ä¸Šé¢åŠ å…¥ä»¥ä¸‹è¡Œï¼š 1JAVA_OPTS="-server -Xms800m -Xmx800m -XX:MaxNewSize=256m" Tomcatä¸­java.lang.OutOfMemoryError: PermGen spaceå¼‚å¸¸å¤„ç† åŸå› åˆ†æ PermGen spaceçš„å…¨ç§°æ˜¯Permanent Generation space,æ˜¯æŒ‡å†…å­˜çš„æ°¸ä¹…ä¿å­˜åŒºåŸŸ, è¿™å—å†…å­˜ä¸»è¦æ˜¯è¢«JVMå­˜æ”¾Classå’ŒMetaä¿¡æ¯çš„,Classåœ¨è¢«Loaderæ—¶å°±ä¼šè¢«æ”¾åˆ°PermGen spaceä¸­, å®ƒå’Œå­˜æ”¾ç±»å®ä¾‹(Instance)çš„HeapåŒºåŸŸä¸åŒ,GC(Garbage Collection)ä¸ä¼šåœ¨ä¸»ç¨‹åºè¿è¡ŒæœŸå¯¹ PermGen spaceè¿›è¡Œæ¸…ç†ï¼Œæ‰€ä»¥å¦‚æœä½ çš„åº”ç”¨ä¸­æœ‰å¾ˆå¤šCLASSçš„è¯,å°±å¾ˆå¯èƒ½å‡ºç°PermGen spaceé”™è¯¯, è¿™ç§é”™è¯¯å¸¸è§åœ¨webæœåŠ¡å™¨å¯¹JSPè¿›è¡Œpre compileçš„æ—¶å€™ã€‚å¦‚æœä½ çš„WEB APPä¸‹éƒ½ç”¨äº†å¤§é‡çš„ç¬¬ä¸‰æ–¹jar, å…¶å¤§å° è¶…è¿‡äº†jvmé»˜è®¤çš„å¤§å°(4M)é‚£ä¹ˆå°±ä¼šäº§ç”Ÿæ­¤é”™è¯¯ä¿¡æ¯äº†ã€‚ è§£å†³æ–¹æ¡ˆ æ‰‹åŠ¨è®¾ç½®MaxPermSizeå¤§å° ä¿®æ”¹TOMCAT_HOME/bin/catalina.sh,åœ¨ 1â€œecho "Using CATALINA_BASE: $CATALINA_BASE"â€ ä¸Šé¢åŠ å…¥ä»¥ä¸‹è¡Œï¼š 1JAVA_OPTS="-server -XX:PermSize=64M -XX:MaxPermSize=128m å»ºè®®ï¼šå°†ç›¸åŒçš„ç¬¬ä¸‰æ–¹jaræ–‡ä»¶ç§»ç½®åˆ°tomcat/shared/libç›®å½•ä¸‹ï¼Œè¿™æ ·å¯ä»¥è¾¾åˆ°å‡å°‘jar æ–‡æ¡£é‡å¤å ç”¨å†…å­˜çš„ç›®çš„ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - é¢è¯•é¢˜æ€»ç»“]]></title>
    <url>%2Fposts%2F382a766.html</url>
    <content type="text"><![CDATA[Javaé‡Œé¢æ‰€æœ‰çš„ä¸å˜çš„å±æ€§éœ€è¦ç”¨finalä¿®é¥°å— ç­”ï¼šæ²¡å¿…è¦ã€‚ä½ å¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½é€šè¿‡ä»¥ä¸‹æ“ä½œï¼š è®¾ä¸ºéfinalçš„private å˜é‡ï¼Œä¸”åªæœ‰åœ¨æ„é€ å‡½æ•°ä¸­æ‰èƒ½ä¿®æ”¹ã€‚ä¸è®¾setæ–¹æ³•ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå¯å˜å¯¹è±¡ï¼Œä¸è¦æ³„éœ²ä»»ä½•æŒ‡å‘è¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨ã€‚ è®¾ç½®ä¸€ä¸ªå¼•ç”¨å˜é‡ä¸ºfinal åªèƒ½ç¡®ä¿è¿™ä¸ªå˜é‡ä¸ä¼šè¢«èµ‹äºˆä¸€ä¸ªä¸åŒçš„å¼•ç”¨ï¼Œä½†æ˜¯ä½ ä»ç„¶å¯ä»¥æ”¹å˜å¼•ç”¨å˜é‡çš„å±æ€§å€¼ã€‚ Stringçš„subString()å®ç°åŸç† ç­”ï¼šsubstringå–åŸæ¥stringçš„ä¸€éƒ¨åˆ†åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ã€‚è¿™ä¸ªé—®é¢˜ä¸»è¦æƒ³é—®substringå¯èƒ½å¯¼è‡´çš„å†…å­˜æ³„éœ²é£é™©ã€‚ ç›´åˆ°Java1.7ï¼Œ substring æ‹¥æœ‰åŸæ¥çš„å­—ç¬¦æ•°ç»„çš„å¼•ç”¨ï¼Œè¿™æ„å‘³ç€å³ä½¿æ˜¯äº”å­—ç¬¦è¿™ä¹ˆå°çš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä¸€ä¸ª1GBå­—ç¬¦æ•°ç»„æ— æ³•è¢«åƒåœ¾å›æ”¶ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå¼ºå¼•ç”¨ã€‚ è¿™ä¸ªé—®é¢˜åœ¨Java1.7ä¸­å·²ç»è¢«ä¿®å¤ï¼ŒåŸæ¥çš„å­—ç¬¦æ•°ç»„ä¸ä¼šè¢«å¼•ç”¨ï¼Œä½†æ˜¯ä¼šå¯¼è‡´åˆ›å»ºsubstringè€—æ—¶ä¼šæœ‰ç‚¹é•¿ï¼Œä»¥å‰æ—¶é—´å¤æ‚åº¦æ˜¯ O(1), Java 7ä¹‹åæ—¶é—´å¤æ‚åº¦æ˜¯ O(n)ã€‚ Javaä¸­å¦‚ä½•å¤„ç†å†™å­˜å‚¨è¿‡ç¨‹æˆ–è€…è¯»å­˜å‚¨è¿‡ç¨‹æ—¶é‡åˆ°çš„é”™è¯¯ ç­”ï¼š ä¸€ä¸ªå­˜å‚¨è¿‡ç¨‹åº”è¯¥åœ¨æ“ä½œé”™è¯¯æ—¶è¿”å›é”™è¯¯ç ï¼Œä½†æ˜¯å¦‚æœå­˜å‚¨è¿‡ç¨‹æœ¬èº«å‡ºé—®é¢˜ï¼Œæ•è· SQLException æ˜¯å”¯ä¸€é€‰æ‹©ã€‚ å·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ« ç­”ï¼šæŠ½è±¡å·¥åœºæ¨¡å¼æä¾›ä¸€ä¸ªå¤šå±‚çº§çš„æŠ½è±¡ã€‚è€ƒè™‘ä¸åŒçš„å·¥å‚ç»§æ‰¿è‡ªåŒä¸€ä¸ªæŠ½è±¡å·¥å‚ï¼Œä»£è¡¨åŸºäºå·¥å‚çš„ä¸åŒå¯¹è±¡ç»“æ„çš„åˆ›å»ºï¼Œä¾‹å¦‚ï¼Œ AutomobileFactory,UserFactory,RoleFactoryç­‰éƒ½ç»§æ‰¿è‡ª AbstractFactoryã€‚æ¯ä¸€ä¸ªç‹¬ç«‹çš„å·¥å‚ä»£è¡¨é‚£ç§ç±»å‹ç‰©ä½“çš„åˆ›é€ å™¨ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªå·¥å‚æ¨¡å¼å’ŒæŠ½è±¡å·¥å‚æ¨¡å¼çš„UMLå›¾ï¼š ä»€ä¹ˆæ—¶å€™é‡å†™ hashCode()å’Œ equals()æ–¹æ³• ç­”ï¼šå½“éœ€è¦é€šè¿‡ä¸šåŠ¡é€»è¾‘æ ¡éªŒä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼Œè€Œä¸æ˜¯é€šè¿‡ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦æ‰§è¡ŒåŒä¸€åœ°å€ã€‚ä¾‹å¦‚ä¸¤ä¸ªå‘˜å·¥å¯¹è±¡åœ¨ emp_id ç›¸ç­‰çš„æ—¶å€™ç›¸ç­‰ï¼Œå³ä½¿å®ƒä»¬æ˜¯é€šè¿‡ä¸åŒçš„ä»£ç åˆ›å»ºå‡ºæ¥çš„ä¸¤ä¸ªä¸åŒå¯¹è±¡ã€‚ å¦å¤–ï¼Œå¦‚æœä½ ä½¿ç”¨ä¸€ä¸ªå¯¹è±¡ä½œä¸º HashMapçš„keyï¼Œä½ å¿…é¡»é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ã€‚ ä½œä¸ºjava equals-hashcodeçº¦æŸçš„ä¸€éƒ¨åˆ†ï¼Œå½“ä½ é‡å†™equalsçš„æ—¶å€™ï¼Œå¿…é¡»é‡å†™hashcode. å¦åˆ™ä½ ä¸èƒ½åœ¨Setï¼ŒMapè¿™æ ·çš„ç±»é‡Œé¢ä½¿ç”¨ï¼Œå› ä¸ºä»–ä»¬é€šè¿‡equals()æ–¹æ³•æ¥ä¿è¯é€»è¾‘æ­£ç¡®æ€§ã€‚ åŒå¼•å·ç›´æ¥åˆ›å»ºå­—ç¬¦ä¸²å’Œä½¿ç”¨new()åˆ›å»ºå­—ç¬¦ä¸²æœ‰ä»€ä¹ˆåŒºåˆ« ç­”: ä½¿ç”¨new()åˆ›å»ºStringå¯¹è±¡ï¼Œå®ä¾‹è¢«åˆ›å»ºåœ¨å †ä¸­, ä¸ä¼šè¢«æ·»åŠ åˆ°Stringå¸¸é‡æ± ä¸­ï¼Œå½“é€šè¿‡å­—é¢é‡åˆ›å»ºæ—¶ï¼Œä¼šè¢«æ”¾åˆ°å †ä¸­çš„æ°¸ä¹…åŒºçš„Stringå¸¸é‡æ± ä¸­ã€‚ Stringstr = newString("Test") ä¸ä¼šæŠŠstræ”¾åˆ°Stringå¸¸é‡æ± ä¸­ï¼Œéœ€è¦è°ƒç”¨String.intern()æ–¹æ³•ï¼Œæ‰ä¼šæŠŠå®ƒæ”¾åˆ°Stringå¸¸é‡æ± ä¸­ã€‚ å½“ä½¿ç”¨Stringå­—é¢é‡åˆ›å»ºStringå¯¹è±¡æ—¶ï¼Œå¦‚é€šè¿‡String s = "Test", javaä¼šè‡ªåŠ¨æ”¾å…¥Stringå¸¸é‡æ± ä¸­ã€‚ å¦å¤–ï¼Œå¦‚æœæŠŠ"Test"è¿™æ ·çš„Stringå­—é¢é‡ä¼ è¿›å»ï¼Œä¹Ÿä¼šåˆ›å»ºå¦å¤–ä¸€ä¸ªå¯¹è±¡:"Test" åœ¨Stringå¸¸é‡æ± ã€‚ ä»€ä¹ˆæ˜¯ä¸å¯å˜å¯¹è±¡ï¼Œå¦‚ä½•å†™ä¸€ä¸ªä¸å¯å˜ç±» ç­”ï¼šä¸å¯å˜å¯¹è±¡æ˜¯æŒ‡Javaç±»çš„å¯¹è±¡ä¸€å•è¢«åˆ›å»ºï¼Œä¸èƒ½è¢«ä¿®æ”¹ã€‚ä»»ä½•ä¸å¯å˜å¯¹è±¡å¯¹è±¡çš„ä¿®æ”¹åœ¨åˆ›å»ºæ—¶å€™å°±å·²ç»å®Œæˆï¼Œä¾‹å¦‚ï¼ŒJavaä¸­Stringæ˜¯ä¸å¯å˜çš„ã€‚ å¤§å¤šæ•°ä¸å¯å˜ç±»æ˜¯finalçš„, è¿™æ ·å¯ä»¥é˜²æ­¢å› å­ç±»é‡å†™æ–¹æ³•è€Œå¯¼è‡´ä¸å¯å˜å¤±æ•ˆã€‚ ä½ ä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„åŠŸèƒ½é€šè¿‡è®©æˆå‘˜éfinalä½†æ˜¯privateï¼Œä¸”é™¤äº†æ„é€ æ–¹æ³•ä»»ä½•å…¶ä»–æ–¹æ³•æ— æ³•ä¿®æ”¹ã€‚ å¦å¤–ï¼Œè¦ç¡®ä¿æ²¡æœ‰æš´éœ²ä¸å¯å˜å¯¹è±¡çš„å†…éƒ¨ï¼Œå°¤å…¶æ˜¯å®ƒåŒ…å«å¯å˜æˆå‘˜çš„æ—¶å€™ã€‚ åŒæ—¶ï¼Œå½“ä½ ä»å®¢æˆ·ç«¯æ¥æ”¶åˆ°å¯å˜çš„å¯¹è±¡æ—¶ï¼Œä¾‹å¦‚ java.util.Date, ä½¿ç”¨clone() æ–¹æ³• æ¥è·å–ä¸€ä¸ªç‹¬ç«‹çš„æ‹·è´ï¼Œé˜²æ­¢æ¶æ„ä¿®æ”¹å¯å˜å¯¹è±¡å¸¦æ¥çš„é£é™©ã€‚ ç›¸åŒçš„ä¼˜åŒ–éœ€è¦åœ¨è¿”å›ä¸€ä¸ªå¯å˜æˆå‘˜æ—¶æ‰§è¡Œã€‚è¿”å›å¦ä¸€ä¸ªç‹¬ç«‹æ‹·è´ç»™å®¢æˆ·ç«¯ï¼›ä¸è¦è¿”å›å¯å˜å¯¹è±¡çš„åŸå§‹å¼•ç”¨ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>é¢è¯•é¢˜</category>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - é”æœºåˆ¶]]></title>
    <url>%2Fposts%2Fdd749e64.html</url>
    <content type="text"><![CDATA[å…¬å¹³é”/éå…¬å¹³é” å…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”ã€‚ éå…¬å¹³é” æ˜¯æŒ‡å¤šä¸ªçº¿ç¨‹è·å–é”çš„é¡ºåºå¹¶ä¸æ˜¯æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºï¼Œæœ‰å¯èƒ½åç”³è¯·çš„çº¿ç¨‹æ¯”å…ˆç”³è¯·çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚æœ‰å¯èƒ½ï¼Œä¼šé€ æˆä¼˜å…ˆçº§åè½¬æˆ–è€…é¥¥é¥¿ç°è±¡ã€‚ å¯¹äºJava ReentrantLockè€Œè¨€ï¼Œé€šè¿‡æ„é€ å‡½æ•°æŒ‡å®šè¯¥é”æ˜¯å¦æ˜¯å…¬å¹³é”ï¼Œé»˜è®¤æ˜¯éå…¬å¹³é”ã€‚éå…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºååé‡æ¯”å…¬å¹³é”å¤§ã€‚ å¯¹äºSynchronizedè€Œè¨€ï¼Œä¹Ÿæ˜¯ä¸€ç§éå…¬å¹³é”ã€‚ç”±äºå…¶å¹¶ä¸åƒReentrantLockæ˜¯é€šè¿‡AQSçš„æ¥å®ç°çº¿ç¨‹è°ƒåº¦ï¼Œæ‰€ä»¥å¹¶æ²¡æœ‰ä»»ä½•åŠæ³•ä½¿å…¶å˜æˆå…¬å¹³é”ã€‚ å¯é‡å…¥é”/ä¸å¯é‡å…¥é” å¯é‡å…¥é” å¹¿ä¹‰ä¸Šçš„å¯é‡å…¥é”æŒ‡çš„æ˜¯å¯é‡å¤å¯é€’å½’è°ƒç”¨çš„é”ï¼Œåœ¨å¤–å±‚ä½¿ç”¨é”ä¹‹åï¼Œåœ¨å†…å±‚ä»ç„¶å¯ä»¥ä½¿ç”¨ï¼Œå¹¶ä¸”ä¸å‘ç”Ÿæ­»é”ï¼ˆå‰æå¾—æ˜¯åŒä¸€ä¸ªå¯¹è±¡æˆ–è€…classï¼‰ï¼Œè¿™æ ·çš„é”å°±å«åšå¯é‡å…¥é”ã€‚ReentrantLockå’Œsynchronizedéƒ½æ˜¯å¯é‡å…¥é”ã€‚ 1234567synchronized void setA() throws Exception{ Thread.sleep(1000); setB();}synchronized void setB() throws Exception{ Thread.sleep(1000);} ä¸å¯é‡å…¥é” ä¸å¯é‡å…¥é”ï¼Œä¸å¯é‡å…¥é”ç›¸åï¼Œä¸å¯é€’å½’è°ƒç”¨ï¼Œé€’å½’è°ƒç”¨å°±å‘ç”Ÿæ­»é”ã€‚ä¸‹é¢çœ‹ä¸€ä¸ªä½¿ç”¨è‡ªæ—‹é”æ¨¡æ‹Ÿä¸å¯é‡å…¥é”çš„ä¾‹å­ï¼š 123456789101112131415161718192021222324252627282930313233package main.java.com.study.lock;import java.util.concurrent.atomic.AtomicReference;/** * @author: whb * @description: è‡ªæ—‹é”æ¨¡æ‹Ÿä¸å¯é‡å…¥é” */public class UnReentrantLock { private AtomicReference&lt;Thread&gt; owner = new AtomicReference&lt;&gt;(); /** * åŠ é” */ public void lock() { Thread current = Thread.currentThread(); //ç»å…¸çš„è‡ªæ—‹è¯­æ³• for (; ; ) { if (!owner.compareAndSet(null, current)) { return; } } } /** * è§£é” */ public void unlock() { Thread current = Thread.currentThread(); owner.compareAndSet(current, null); }} ä»£ç ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œä½¿ç”¨åŸå­å¼•ç”¨æ¥å­˜æ”¾çº¿ç¨‹ï¼ŒåŒä¸€çº¿ç¨‹ä¸¤æ¬¡è°ƒç”¨lock()æ–¹æ³•ï¼Œå¦‚æœä¸æ‰§è¡Œunlock()é‡Šæ”¾é”çš„è¯ï¼Œç¬¬äºŒæ¬¡è°ƒç”¨è‡ªæ—‹çš„æ—¶å€™å°±ä¼šäº§ç”Ÿæ­»é”ï¼Œè¿™ä¸ªé”å°±ä¸æ˜¯å¯é‡å…¥çš„ï¼Œè€Œå®é™…ä¸ŠåŒä¸€ä¸ªçº¿ç¨‹ä¸å¿…æ¯æ¬¡éƒ½å»é‡Šæ”¾é”å†æ¥è·å–é”ï¼Œè¿™æ ·çš„è°ƒåº¦åˆ‡æ¢æ˜¯å¾ˆè€—èµ„æºçš„ã€‚ æŠŠå®ƒå˜æˆå¯é‡å…¥é” 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.lock;import java.util.concurrent.atomic.AtomicReference;/** * @author: whb * @description: è‡ªæ—‹é”æ¨¡æ‹Ÿå¯é‡å…¥é” */public class ReentrantLock { private AtomicReference&lt;Thread&gt; owner = new AtomicReference&lt;&gt;(); //è®°å½•é‡å…¥æ¬¡æ•° private volatile int state = 0; /** * åŠ é” */ public void lock() { Thread current = Thread.currentThread(); if (current == owner.get()) { state++; return; } for (; ; ) { if (!owner.compareAndSet(null, current)) { return; } } } /** * é‡Šæ”¾é” */ public void unlock() { Thread current = Thread.currentThread(); if (current == owner.get()) { if (state != 0) { state--; } else { owner.compareAndSet(current, null); } } }} åœ¨æ‰§è¡Œæ¯æ¬¡æ“ä½œä¹‹å‰ï¼Œåˆ¤æ–­å½“å‰é”æŒæœ‰è€…æ˜¯å¦æ˜¯å½“å‰å¯¹è±¡ï¼Œé‡‡ç”¨stateè®¡æ•°ï¼Œä¸ç”¨æ¯æ¬¡å»é‡Šæ”¾é”ã€‚ J.U.CåŒ…ä¸­ReentrantLockä¸­å¯é‡å…¥é”å®ç°ï¼Œçœ‹ä¸‹éå…¬å¹³é”çš„é”è·å–å®ç°ï¼š 123456789101112131415161718final boolean nonfairTryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); if (c == 0) { if (compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) // overflow throw new Error("Maximum lock count exceeded"); setState(nextc); return true; } return false;} åœ¨AQSä¸­ç»´æŠ¤äº†ä¸€ä¸ªprivate volatile int stateæ¥è®¡æ•°é‡å…¥æ¬¡æ•°ï¼Œé¿å…äº†é¢‘ç¹çš„æŒæœ‰é‡Šæ”¾æ“ä½œï¼Œè¿™æ ·æ—¢æå‡äº†æ•ˆç‡ï¼Œåˆé¿å…äº†æ­»é”ã€‚ ç‹¬å é”/å…±äº«é” ç‹¬å é” è¯¥é”æ¯ä¸€æ¬¡åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€æŒæœ‰ã€‚ å…±äº«é” è¯¥é”å¯è¢«å¤šä¸ªçº¿ç¨‹å…±æœ‰ï¼Œå…¸å‹çš„å°±æ˜¯ReentrantReadWriteLocké‡Œçš„è¯»é”ï¼Œå®ƒçš„è¯»é”æ˜¯å¯ä»¥è¢«å…±äº«çš„ï¼Œä½†æ˜¯å®ƒçš„å†™é”ç¡®æ¯æ¬¡åªèƒ½è¢«ç‹¬å ã€‚ å¦å¤–è¯»é”çš„å…±äº«å¯ä¿è¯å¹¶å‘è¯»æ˜¯éå¸¸é«˜æ•ˆçš„ï¼Œä½†æ˜¯è¯»å†™å’Œå†™å†™ï¼Œå†™è¯»éƒ½æ˜¯äº’æ–¥çš„ã€‚ ç‹¬å é”ä¸å…±äº«é”ä¹Ÿæ˜¯é€šè¿‡AQSæ¥å®ç°çš„ï¼Œé€šè¿‡å®ç°ä¸åŒçš„æ–¹æ³•ï¼Œæ¥å®ç°ç‹¬å æˆ–è€…å…±äº«ã€‚å¯¹äºSynchronizedè€Œè¨€ï¼Œå½“ç„¶æ˜¯ç‹¬å é”ã€‚ äº’æ–¥é”/è¯»å†™é” äº’æ–¥é” åœ¨è®¿é—®å…±äº«èµ„æºä¹‹å‰è¿›è¡ŒåŠ é”æ“ä½œï¼Œåœ¨è®¿é—®å®Œæˆä¹‹åè¿›è¡Œè§£é”æ“ä½œã€‚åŠ é”åï¼Œä»»ä½•å…¶ä»–è¯•å›¾å†æ¬¡åŠ é”çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å½“å‰è¿›ç¨‹è§£é”ã€‚å¦‚æœè§£é”æ—¶æœ‰ä¸€ä¸ªä»¥ä¸Šçš„çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆæ‰€æœ‰è¯¥é”ä¸Šçš„çº¿ç¨‹éƒ½è¢«å˜æˆå°±ç»ªçŠ¶æ€ï¼Œ ç¬¬ä¸€ä¸ªå˜ä¸ºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹åˆæ‰§è¡ŒåŠ é”æ“ä½œï¼Œé‚£ä¹ˆå…¶ä»–çš„çº¿ç¨‹åˆä¼šè¿›å…¥ç­‰å¾…ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè®¿é—®è¢«äº’æ–¥é”ä¿æŠ¤çš„èµ„æºã€‚ è¯»å†™é” è¯»å†™é”æ—¢æ˜¯äº’æ–¥é”ï¼Œåˆæ˜¯å…±äº«é”ï¼Œreadæ¨¡å¼æ˜¯å…±äº«ï¼Œwriteæ˜¯äº’æ–¥(æ’å®ƒé”)çš„ã€‚è¯»å†™é”åœ¨Javaä¸­çš„å…·ä½“å®ç°å°±æ˜¯ReadWriteLockã€‚ è¯»å†™é”æœ‰ä¸‰ç§çŠ¶æ€ï¼šè¯»åŠ é”çŠ¶æ€ã€å†™åŠ é”çŠ¶æ€å’Œä¸åŠ é”çŠ¶æ€ã€‚ ä¸€æ¬¡åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™æ¨¡å¼çš„è¯»å†™é”ï¼Œä½†æ˜¯å¤šä¸ªçº¿ç¨‹å¯ä»¥åŒæ—¶å æœ‰è¯»æ¨¡å¼çš„è¯»å†™é”ã€‚ åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥å æœ‰å†™çŠ¶æ€çš„é”ï¼Œä½†å¯ä»¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶å æœ‰è¯»çŠ¶æ€é”ï¼Œè¿™ä¹Ÿæ˜¯å®ƒå¯ä»¥å®ç°é«˜å¹¶å‘çš„åŸå› ã€‚å½“å…¶å¤„äºå†™çŠ¶æ€é”ä¸‹ï¼Œä»»ä½•æƒ³è¦å°è¯•è·å¾—é”çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°å†™çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›å¦‚æœæ˜¯å¤„äºè¯»çŠ¶æ€é”ä¸‹ï¼Œå…è®¸å…¶å®ƒçº¿ç¨‹è·å¾—å®ƒçš„è¯»çŠ¶æ€é”ï¼Œä½†æ˜¯ä¸å…è®¸è·å¾—å®ƒçš„å†™çŠ¶æ€é”ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹çš„è¯»çŠ¶æ€é”è¢«é‡Šæ”¾ï¼›ä¸ºäº†é¿å…æƒ³è¦å°è¯•å†™æ“ä½œçš„çº¿ç¨‹ä¸€ç›´å¾—ä¸åˆ°å†™çŠ¶æ€é”ï¼Œå½“è¯»å†™é”æ„ŸçŸ¥åˆ°æœ‰çº¿ç¨‹æƒ³è¦è·å¾—å†™çŠ¶æ€é”æ—¶ï¼Œä¾¿ä¼šé˜»å¡å…¶åæ‰€æœ‰æƒ³è¦è·å¾—è¯»çŠ¶æ€é”çš„çº¿ç¨‹ã€‚æ‰€ä»¥è¯»å†™é”éå¸¸é€‚åˆèµ„æºçš„è¯»æ“ä½œè¿œå¤šäºå†™æ“ä½œçš„æƒ…å†µã€‚ æ‚²è§‚é”/ä¹è§‚é” æ‚²è§‚é” æ€»æ˜¯å‡è®¾æœ€åçš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¼šä¿®æ”¹ï¼Œæ‰€ä»¥æ¯æ¬¡åœ¨æ‹¿æ•°æ®çš„æ—¶å€™éƒ½ä¼šä¸Šé”ï¼Œè¿™æ ·åˆ«äººæƒ³æ‹¿è¿™ä¸ªæ•°æ®å°±ä¼šé˜»å¡ç›´åˆ°å®ƒæ‹¿åˆ°é”ï¼ˆå…±äº«èµ„æºæ¯æ¬¡åªç»™ä¸€ä¸ªçº¿ç¨‹ä½¿ç”¨ï¼Œå…¶å®ƒçº¿ç¨‹é˜»å¡ï¼Œç”¨å®Œåå†æŠŠèµ„æºè½¬è®©ç»™å…¶å®ƒçº¿ç¨‹ï¼‰ã€‚ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“é‡Œè¾¹å°±ç”¨åˆ°äº†å¾ˆå¤šè¿™ç§é”æœºåˆ¶ï¼Œæ¯”å¦‚è¡Œé”ï¼Œè¡¨é”ç­‰ï¼Œè¯»é”ï¼Œå†™é”ç­‰ï¼Œéƒ½æ˜¯åœ¨åšæ“ä½œä¹‹å‰å…ˆä¸Šé”ã€‚Javaä¸­synchronizedå’ŒReentrantLockç­‰ç‹¬å é”å°±æ˜¯æ‚²è§‚é”æ€æƒ³çš„å®ç°ã€‚ ä¹è§‚é” æ€»æ˜¯å‡è®¾æœ€å¥½çš„æƒ…å†µï¼Œæ¯æ¬¡å»æ‹¿æ•°æ®çš„æ—¶å€™éƒ½è®¤ä¸ºåˆ«äººä¸ä¼šä¿®æ”¹ï¼Œæ‰€ä»¥ä¸ä¼šä¸Šé”ï¼Œä½†æ˜¯åœ¨æ›´æ–°çš„æ—¶å€™ä¼šåˆ¤æ–­ä¸€ä¸‹åœ¨æ­¤æœŸé—´åˆ«äººæœ‰æ²¡æœ‰å»æ›´æ–°è¿™ä¸ªæ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨ç‰ˆæœ¬å·æœºåˆ¶å’ŒCASç®—æ³•å®ç°ã€‚ä¹è§‚é”é€‚ç”¨äºå¤šè¯»çš„åº”ç”¨ç±»å‹ï¼Œè¿™æ ·å¯ä»¥æé«˜ååé‡ï¼Œåƒæ•°æ®åº“æä¾›çš„ç±»ä¼¼äºwrite_conditionæœºåˆ¶ï¼Œå…¶å®éƒ½æ˜¯æä¾›çš„ä¹è§‚é”ã€‚åœ¨Javaä¸­java.util.concurrent.atomicåŒ…ä¸‹é¢çš„åŸå­å˜é‡ç±»å°±æ˜¯ä½¿ç”¨äº†ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼CASå®ç°çš„ã€‚ åˆ†æ®µé” åˆ†æ®µé”å…¶å®æ˜¯ä¸€ç§é”çš„è®¾è®¡ï¼Œå¹¶ä¸æ˜¯å…·ä½“çš„ä¸€ç§é”ï¼Œå¯¹äºConcurrentHashMapè€Œè¨€ï¼Œå…¶å¹¶å‘çš„å®ç°å°±æ˜¯é€šè¿‡åˆ†æ®µé”çš„å½¢å¼æ¥å®ç°é«˜æ•ˆçš„å¹¶å‘æ“ä½œã€‚ å¹¶å‘å®¹å™¨ç±»çš„åŠ é”æœºåˆ¶æ˜¯åŸºäºç²’åº¦æ›´å°çš„åˆ†æ®µé”ï¼Œåˆ†æ®µé”ä¹Ÿæ˜¯æå‡å¤šå¹¶å‘ç¨‹åºæ€§èƒ½çš„é‡è¦æ‰‹æ®µä¹‹ä¸€ã€‚ åœ¨å¹¶å‘ç¨‹åºä¸­ï¼Œä¸²è¡Œæ“ä½œæ˜¯ä¼šé™ä½å¯ä¼¸ç¼©æ€§ï¼Œå¹¶ä¸”ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šå‡ä½æ€§èƒ½ã€‚åœ¨é”ä¸Šå‘ç”Ÿç«äº‰æ—¶å°†å¯¼è‡´è¿™ä¸¤ç§é—®é¢˜ï¼Œä½¿ç”¨ç‹¬å é”æ—¶ä¿æŠ¤å—é™èµ„æºçš„æ—¶å€™ï¼ŒåŸºæœ¬ä¸Šæ˜¯é‡‡ç”¨ä¸²è¡Œæ–¹å¼â€”-æ¯æ¬¡åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è®¿é—®å®ƒã€‚æ‰€ä»¥å¯¹äºå¯ä¼¸ç¼©æ€§æ¥è¯´æœ€å¤§çš„å¨èƒå°±æ˜¯ç‹¬å é”ã€‚ ä¸‰ç§æ–¹å¼é™ä½é”çš„ç«äº‰ç¨‹åº¦ï¼š 1ã€å‡å°‘é”çš„æŒæœ‰æ—¶é—´ 2ã€é™ä½é”çš„è¯·æ±‚é¢‘ç‡ 3ã€ä½¿ç”¨å¸¦æœ‰åè°ƒæœºåˆ¶çš„ç‹¬å é”ï¼Œè¿™äº›æœºåˆ¶å…è®¸æ›´é«˜çš„å¹¶ æ— é”/åå‘é”/è½»é‡çº§é”/é‡é‡çº§é” é”çš„å››ç§çŠ¶æ€ æ— é”çŠ¶æ€ï¼› åå‘é”çŠ¶æ€ï¼› è½»é‡çº§é”çŠ¶æ€ï¼› é‡é‡çº§é”çŠ¶æ€ï¼› è¿™å››ç§çŠ¶æ€éƒ½ä¸æ˜¯Javaè¯­è¨€ä¸­çš„é”ï¼Œè€Œæ˜¯Jvmä¸ºäº†æé«˜é”çš„è·å–ä¸é‡Šæ”¾æ•ˆç‡è€Œåšçš„ä¼˜åŒ–(ä½¿ç”¨synchronizedæ—¶)ã€‚é”çš„çŠ¶æ€æ˜¯é€šè¿‡å¯¹è±¡ç›‘è§†å™¨åœ¨å¯¹è±¡å¤´ä¸­çš„å­—æ®µæ¥è¡¨æ˜çš„ã€‚å››ç§çŠ¶æ€ä¼šéšç€ç«äº‰çš„æƒ…å†µé€æ¸å‡çº§ï¼Œè€Œä¸”æ˜¯ä¸å¯é€†çš„è¿‡ç¨‹ï¼Œå³ä¸å¯é™çº§ã€‚ Javaå¯¹è±¡å¤´ ä»¥Hotspotè™šæ‹Ÿæœºä¸ºä¾‹ï¼ŒHotspotçš„å¯¹è±¡å¤´ä¸»è¦åŒ…æ‹¬ä¸¤éƒ¨åˆ†æ•°æ®ï¼šMark Wordï¼ˆæ ‡è®°å­—æ®µï¼‰ã€Klass Pointerï¼ˆç±»å‹æŒ‡é’ˆï¼‰ã€‚ **Mark Wordï¼š**é»˜è®¤å­˜å‚¨å¯¹è±¡çš„HashCodeï¼Œåˆ†ä»£å¹´é¾„å’Œé”æ ‡å¿—ä½ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯éƒ½æ˜¯ä¸å¯¹è±¡è‡ªèº«å®šä¹‰æ— å…³çš„æ•°æ®ï¼Œæ‰€ä»¥Mark Wordè¢«è®¾è®¡æˆä¸€ä¸ªéå›ºå®šçš„æ•°æ®ç»“æ„ä»¥ä¾¿åœ¨æå°çš„ç©ºé—´å†…å­˜å­˜å‚¨å°½é‡å¤šçš„æ•°æ®ã€‚å®ƒä¼šæ ¹æ®å¯¹è±¡çš„çŠ¶æ€å¤ç”¨è‡ªå·±çš„å­˜å‚¨ç©ºé—´ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¿è¡ŒæœŸé—´Mark Wordé‡Œå­˜å‚¨çš„æ•°æ®ä¼šéšç€é”æ ‡å¿—ä½çš„å˜åŒ–è€Œå˜åŒ–ã€‚ **Klass Pointï¼š**å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ¥ç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ Monitor Monitorå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªåŒæ­¥å·¥å…·æˆ–ä¸€ç§åŒæ­¥æœºåˆ¶ï¼Œé€šå¸¸è¢«æè¿°ä¸ºä¸€ä¸ªå¯¹è±¡ã€‚æ¯ä¸€ä¸ªJavaå¯¹è±¡å°±æœ‰ä¸€æŠŠçœ‹ä¸è§çš„é”ï¼Œç§°ä¸ºå†…éƒ¨é”æˆ–è€…Monitoré”ã€‚ Monitoræ˜¯çº¿ç¨‹ç§æœ‰çš„æ•°æ®ç»“æ„ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªå¯ç”¨monitor recordåˆ—è¡¨ï¼ŒåŒæ—¶è¿˜æœ‰ä¸€ä¸ªå…¨å±€çš„å¯ç”¨åˆ—è¡¨ã€‚æ¯ä¸€ä¸ªè¢«é”ä½çš„å¯¹è±¡éƒ½ä¼šå’Œä¸€ä¸ªmonitorå…³è”ï¼ŒåŒæ—¶monitorä¸­æœ‰ä¸€ä¸ªOwnerå­—æ®µå­˜æ”¾æ‹¥æœ‰è¯¥é”çš„çº¿ç¨‹çš„å”¯ä¸€æ ‡è¯†ï¼Œè¡¨ç¤ºè¯¥é”è¢«è¿™ä¸ªçº¿ç¨‹å ç”¨ã€‚ synchronizedé€šè¿‡Monitoræ¥å®ç°çº¿ç¨‹åŒæ­¥ï¼ŒMonitoræ˜¯ä¾èµ–äºåº•å±‚çš„æ“ä½œç³»ç»Ÿçš„Mutex Lockï¼ˆäº’æ–¥é”ï¼‰æ¥å®ç°çš„çº¿ç¨‹åŒæ­¥ã€‚â€œé˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿â€ã€‚è¿™ç§æ–¹å¼å°±æ˜¯synchronizedæœ€åˆå®ç°åŒæ­¥çš„æ–¹å¼ï¼Œè¿™å°±æ˜¯JDK 6ä¹‹å‰synchronizedæ•ˆç‡ä½çš„åŸå› ã€‚è¿™ç§ä¾èµ–äºæ“ä½œç³»ç»ŸMutex Lockæ‰€å®ç°çš„é”æˆ‘ä»¬ç§°ä¹‹ä¸ºâ€œé‡é‡çº§é”â€ï¼ŒJDK 6ä¸­ä¸ºäº†å‡å°‘è·å¾—é”å’Œé‡Šæ”¾é”å¸¦æ¥çš„æ€§èƒ½æ¶ˆè€—ï¼Œå¼•å…¥äº†â€œåå‘é”â€å’Œâ€œè½»é‡çº§é”â€ã€‚ æ‰€ä»¥ç›®å‰é”ä¸€å…±æœ‰4ç§çŠ¶æ€ï¼Œçº§åˆ«ä»ä½åˆ°é«˜ä¾æ¬¡æ˜¯ï¼šæ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”ã€‚é”çŠ¶æ€åªèƒ½å‡çº§ä¸èƒ½é™çº§ã€‚ ä¸‹é¢ç»™å‡ºå››ç§é”çŠ¶æ€å¯¹åº”çš„çš„Mark Wordå†…å®¹ï¼Œç„¶åå†åˆ†åˆ«è®²è§£å››ç§é”çŠ¶æ€çš„æ€è·¯ä»¥åŠç‰¹ç‚¹ï¼š æ— é” æ— é”æ²¡æœ‰å¯¹èµ„æºè¿›è¡Œé”å®šï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½èƒ½è®¿é—®å¹¶ä¿®æ”¹åŒä¸€ä¸ªèµ„æºï¼Œä½†åŒæ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸã€‚ç‰¹ç‚¹å°±æ˜¯ä¿®æ”¹æ“ä½œåœ¨å¾ªç¯å†…è¿›è¡Œï¼Œçº¿ç¨‹ä¼šä¸æ–­çš„å°è¯•ä¿®æ”¹å…±äº«èµ„æºã€‚å¦‚æœæ²¡æœ‰å†²çªå°±ä¿®æ”¹æˆåŠŸå¹¶é€€å‡ºï¼Œå¦åˆ™å°±ä¼šç»§ç»­å¾ªç¯å°è¯•ã€‚å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹ä¿®æ”¹åŒä¸€ä¸ªå€¼ï¼Œå¿…å®šä¼šæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½ä¿®æ”¹æˆåŠŸï¼Œè€Œå…¶ä»–ä¿®æ”¹å¤±è´¥çš„çº¿ç¨‹ä¼šä¸æ–­é‡è¯•ç›´åˆ°ä¿®æ”¹æˆåŠŸã€‚ä¸Šé¢æˆ‘ä»¬ä»‹ç»çš„CASåŸç†åŠåº”ç”¨å³æ˜¯æ— é”çš„å®ç°ã€‚æ— é”æ— æ³•å…¨é¢ä»£æ›¿æœ‰é”ï¼Œä½†æ— é”åœ¨æŸäº›åœºåˆä¸‹çš„æ€§èƒ½æ˜¯éå¸¸é«˜çš„ã€‚ åå‘é” åå‘é”æ˜¯æŒ‡ä¸€æ®µåŒæ­¥ä»£ç ä¸€ç›´è¢«ä¸€ä¸ªçº¿ç¨‹æ‰€è®¿é—®ï¼Œé‚£ä¹ˆè¯¥çº¿ç¨‹ä¼šè‡ªåŠ¨è·å–é”ï¼Œé™ä½è·å–é”çš„ä»£ä»·ã€‚ åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œé”æ€»æ˜¯ç”±åŒä¸€çº¿ç¨‹å¤šæ¬¡è·å¾—ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹ç«äº‰ï¼Œæ‰€ä»¥å‡ºç°äº†åå‘é”ã€‚å…¶ç›®æ ‡å°±æ˜¯åœ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒåŒæ­¥ä»£ç å—æ—¶èƒ½å¤Ÿæé«˜æ€§èƒ½ã€‚ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥ä»£ç å—å¹¶è·å–é”æ—¶ï¼Œä¼šåœ¨Mark Wordé‡Œå­˜å‚¨é”åå‘çš„çº¿ç¨‹IDã€‚åœ¨çº¿ç¨‹è¿›å…¥å’Œé€€å‡ºåŒæ­¥å—æ—¶ä¸å†é€šè¿‡CASæ“ä½œæ¥åŠ é”å’Œè§£é”ï¼Œè€Œæ˜¯æ£€æµ‹Mark Wordé‡Œæ˜¯å¦å­˜å‚¨ç€æŒ‡å‘å½“å‰çº¿ç¨‹çš„åå‘é”ã€‚å¼•å…¥åå‘é”æ˜¯ä¸ºäº†åœ¨æ— å¤šçº¿ç¨‹ç«äº‰çš„æƒ…å†µä¸‹å°½é‡å‡å°‘ä¸å¿…è¦çš„è½»é‡çº§é”æ‰§è¡Œè·¯å¾„ï¼Œå› ä¸ºè½»é‡çº§é”çš„è·å–åŠé‡Šæ”¾ä¾èµ–å¤šæ¬¡CASåŸå­æŒ‡ä»¤ï¼Œè€Œåå‘é”åªéœ€è¦åœ¨ç½®æ¢ThreadIDçš„æ—¶å€™ä¾èµ–ä¸€æ¬¡CASåŸå­æŒ‡ä»¤å³å¯ã€‚ åå‘é”åªæœ‰é‡åˆ°å…¶ä»–çº¿ç¨‹å°è¯•ç«äº‰åå‘é”æ—¶ï¼ŒæŒæœ‰åå‘é”çš„çº¿ç¨‹æ‰ä¼šé‡Šæ”¾é”ï¼Œçº¿ç¨‹ä¸ä¼šä¸»åŠ¨é‡Šæ”¾åå‘é”ã€‚åå‘é”çš„æ’¤é”€ï¼Œéœ€è¦ç­‰å¾…å…¨å±€å®‰å…¨ç‚¹ï¼ˆåœ¨è¿™ä¸ªæ—¶é—´ç‚¹ä¸Šæ²¡æœ‰å­—èŠ‚ç æ­£åœ¨æ‰§è¡Œï¼‰ï¼Œå®ƒä¼šé¦–å…ˆæš‚åœæ‹¥æœ‰åå‘é”çš„çº¿ç¨‹ï¼Œåˆ¤æ–­é”å¯¹è±¡æ˜¯å¦å¤„äºè¢«é”å®šçŠ¶æ€ã€‚æ’¤é”€åå‘é”åæ¢å¤åˆ°æ— é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ01â€ï¼‰æˆ–è½»é‡çº§é”ï¼ˆæ ‡å¿—ä½ä¸ºâ€œ00â€ï¼‰çš„çŠ¶æ€ã€‚ åå‘é”åœ¨JDK 6åŠä»¥åçš„JVMé‡Œæ˜¯é»˜è®¤å¯ç”¨çš„ã€‚å¯ä»¥é€šè¿‡JVMå‚æ•°å…³é—­åå‘é”ï¼š-XX:-UseBiasedLocking=falseï¼Œå…³é—­ä¹‹åç¨‹åºé»˜è®¤ä¼šè¿›å…¥è½»é‡çº§é”çŠ¶æ€ã€‚ è½»é‡çº§é” æ˜¯æŒ‡å½“é”æ˜¯åå‘é”çš„æ—¶å€™ï¼Œè¢«å¦å¤–çš„çº¿ç¨‹æ‰€è®¿é—®ï¼Œåå‘é”å°±ä¼šå‡çº§ä¸ºè½»é‡çº§é”ï¼Œå…¶ä»–çº¿ç¨‹ä¼šé€šè¿‡è‡ªæ—‹çš„å½¢å¼å°è¯•è·å–é”ï¼Œä¸ä¼šé˜»å¡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ åœ¨ä»£ç è¿›å…¥åŒæ­¥å—çš„æ—¶å€™ï¼Œå¦‚æœåŒæ­¥å¯¹è±¡é”çŠ¶æ€ä¸ºæ— é”çŠ¶æ€ï¼ˆé”æ ‡å¿—ä½ä¸ºâ€œ01â€çŠ¶æ€ï¼Œæ˜¯å¦ä¸ºåå‘é”ä¸ºâ€œ0â€ï¼‰ï¼Œè™šæ‹Ÿæœºé¦–å…ˆå°†åœ¨å½“å‰çº¿ç¨‹çš„æ ˆå¸§ä¸­å»ºç«‹ä¸€ä¸ªåä¸ºé”è®°å½•ï¼ˆLock Recordï¼‰çš„ç©ºé—´ï¼Œç”¨äºå­˜å‚¨é”å¯¹è±¡ç›®å‰çš„Mark Wordçš„æ‹·è´ï¼Œç„¶åæ‹·è´å¯¹è±¡å¤´ä¸­çš„Mark Wordå¤åˆ¶åˆ°é”è®°å½•ä¸­ã€‚ æ‹·è´æˆåŠŸåï¼Œè™šæ‹Ÿæœºå°†ä½¿ç”¨CASæ“ä½œå°è¯•å°†å¯¹è±¡çš„Mark Wordæ›´æ–°ä¸ºæŒ‡å‘Lock Recordçš„æŒ‡é’ˆï¼Œå¹¶å°†Lock Recordé‡Œçš„owneræŒ‡é’ˆæŒ‡å‘å¯¹è±¡çš„Mark Wordã€‚ å¦‚æœè¿™ä¸ªæ›´æ–°åŠ¨ä½œæˆåŠŸäº†ï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±æ‹¥æœ‰äº†è¯¥å¯¹è±¡çš„é”ï¼Œå¹¶ä¸”å¯¹è±¡Mark Wordçš„é”æ ‡å¿—ä½è®¾ç½®ä¸ºâ€œ00â€ï¼Œè¡¨ç¤ºæ­¤å¯¹è±¡å¤„äºè½»é‡çº§é”å®šçŠ¶æ€ã€‚ å¦‚æœè½»é‡çº§é”çš„æ›´æ–°æ“ä½œå¤±è´¥äº†ï¼Œè™šæ‹Ÿæœºé¦–å…ˆä¼šæ£€æŸ¥å¯¹è±¡çš„Mark Wordæ˜¯å¦æŒ‡å‘å½“å‰çº¿ç¨‹çš„æ ˆå¸§ï¼Œå¦‚æœæ˜¯å°±è¯´æ˜å½“å‰çº¿ç¨‹å·²ç»æ‹¥æœ‰äº†è¿™ä¸ªå¯¹è±¡çš„é”ï¼Œé‚£å°±å¯ä»¥ç›´æ¥è¿›å…¥åŒæ­¥å—ç»§ç»­æ‰§è¡Œï¼Œå¦åˆ™è¯´æ˜å¤šä¸ªçº¿ç¨‹ç«äº‰é”ã€‚ è‹¥å½“å‰åªæœ‰ä¸€ä¸ªç­‰å¾…çº¿ç¨‹ï¼Œåˆ™è¯¥çº¿ç¨‹é€šè¿‡è‡ªæ—‹è¿›è¡Œç­‰å¾…ã€‚ä½†æ˜¯å½“è‡ªæ—‹è¶…è¿‡ä¸€å®šçš„æ¬¡æ•°ï¼Œæˆ–è€…ä¸€ä¸ªçº¿ç¨‹åœ¨æŒæœ‰é”ï¼Œä¸€ä¸ªåœ¨è‡ªæ—‹ï¼Œåˆæœ‰ç¬¬ä¸‰ä¸ªæ¥è®¿æ—¶ï¼Œè½»é‡çº§é”å‡çº§ä¸ºé‡é‡çº§é”ã€‚ é‡é‡çº§é” å‡çº§ä¸ºé‡é‡çº§é”æ—¶ï¼Œé”æ ‡å¿—çš„çŠ¶æ€å€¼å˜ä¸ºâ€œ10â€ï¼Œæ­¤æ—¶Mark Wordä¸­å­˜å‚¨çš„æ˜¯æŒ‡å‘é‡é‡çº§é”çš„æŒ‡é’ˆï¼Œæ­¤æ—¶ç­‰å¾…é”çš„çº¿ç¨‹éƒ½ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ã€‚ è‡ªæ—‹é” CASç®—æ³• æˆ‘ä»¬çŸ¥é“CASç®—æ³•æ˜¯ä¹è§‚é”çš„ä¸€ç§å®ç°æ–¹å¼ï¼ŒCASç®—æ³•ä¸­åˆæ¶‰åŠåˆ°è‡ªæ—‹é”ï¼Œå…ˆå›é¡¾ä¸‹CASç®—æ³•ï¼š CASæ˜¯è‹±æ–‡å•è¯Compare and Swapï¼ˆæ¯”è¾ƒå¹¶äº¤æ¢ï¼‰ï¼Œæ˜¯ä¸€ç§æœ‰åçš„æ— é”ç®—æ³•ã€‚æ— é”ç¼–ç¨‹ï¼Œå³ä¸ä½¿ç”¨é”çš„æƒ…å†µä¸‹å®ç°å¤šçº¿ç¨‹ä¹‹é—´çš„å˜é‡åŒæ­¥ï¼Œä¹Ÿå°±æ˜¯åœ¨æ²¡æœ‰çº¿ç¨‹è¢«é˜»å¡çš„æƒ…å†µä¸‹å®ç°å˜é‡çš„åŒæ­¥ï¼Œæ‰€ä»¥ä¹Ÿå«éé˜»å¡åŒæ­¥ï¼ˆNon-blocking Synchronizationï¼‰ã€‚CASç®—æ³•æ¶‰åŠåˆ°ä¸‰ä¸ªæ“ä½œæ•° éœ€è¦è¯»å†™çš„å†…å­˜å€¼ V è¿›è¡Œæ¯”è¾ƒçš„å€¼ A æ‹Ÿå†™å…¥çš„æ–°å€¼ B æ›´æ–°ä¸€ä¸ªå˜é‡çš„æ—¶å€™ï¼Œåªæœ‰å½“å˜é‡çš„é¢„æœŸå€¼Aå’Œå†…å­˜åœ°å€Vå½“ä¸­çš„å®é™…å€¼ç›¸åŒæ—¶ï¼Œæ‰ä¼šå°†å†…å­˜åœ°å€Vå¯¹åº”çš„å€¼ä¿®æ”¹ä¸ºBï¼Œå¦åˆ™ä¸ä¼šæ‰§è¡Œä»»ä½•æ“ä½œã€‚ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä¸€ä¸ªè‡ªæ—‹æ“ä½œï¼Œå³ä¸æ–­çš„é‡è¯•ã€‚ CASå­˜åœ¨çš„é—®é¢˜ ABAé—®é¢˜ã€‚CASéœ€è¦åœ¨æ“ä½œå€¼çš„æ—¶å€™æ£€æŸ¥å†…å­˜å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œæ²¡æœ‰å‘ç”Ÿå˜åŒ–æ‰ä¼šæ›´æ–°å†…å­˜å€¼ã€‚ä½†æ˜¯å¦‚æœå†…å­˜å€¼åŸæ¥æ˜¯Aï¼Œåæ¥å˜æˆäº†Bï¼Œç„¶ååˆå˜æˆäº†Aï¼Œé‚£ä¹ˆCASè¿›è¡Œæ£€æŸ¥æ—¶ä¼šå‘ç°å€¼æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œä½†æ˜¯å®é™…ä¸Šæ˜¯æœ‰å˜åŒ–çš„ã€‚ABAé—®é¢˜çš„è§£å†³æ€è·¯å°±æ˜¯åœ¨å˜é‡å‰é¢æ·»åŠ ç‰ˆæœ¬å·ï¼Œæ¯æ¬¡å˜é‡æ›´æ–°çš„æ—¶å€™éƒ½æŠŠç‰ˆæœ¬å·åŠ ä¸€ï¼Œè¿™æ ·å˜åŒ–è¿‡ç¨‹å°±ä»â€œAï¼Bï¼Aâ€å˜æˆäº†â€œ1Aï¼2Bï¼3Aâ€ã€‚ JDKä»1.5å¼€å§‹æä¾›äº†AtomicStampedReferenceç±»æ¥è§£å†³ABAé—®é¢˜ï¼Œå…·ä½“æ“ä½œå°è£…åœ¨compareAndSet()ä¸­ã€‚compareAndSet()é¦–å…ˆæ£€æŸ¥å½“å‰å¼•ç”¨å’Œå½“å‰æ ‡å¿—ä¸é¢„æœŸå¼•ç”¨å’Œé¢„æœŸæ ‡å¿—æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœéƒ½ç›¸ç­‰ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†å¼•ç”¨å€¼å’Œæ ‡å¿—çš„å€¼è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚ å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§ã€‚CASæ“ä½œå¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šå¯¼è‡´å…¶ä¸€ç›´è‡ªæ—‹ï¼Œç»™CPUå¸¦æ¥éå¸¸å¤§çš„å¼€é”€ã€‚ åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œã€‚å¯¹ä¸€ä¸ªå…±äº«å˜é‡æ‰§è¡Œæ“ä½œæ—¶ï¼ŒCASèƒ½å¤Ÿä¿è¯åŸå­æ“ä½œï¼Œä½†æ˜¯å¯¹å¤šä¸ªå…±äº«å˜é‡æ“ä½œæ—¶ï¼ŒCASæ˜¯æ— æ³•ä¿è¯æ“ä½œçš„åŸå­æ€§çš„ã€‚ Javaä»1.5å¼€å§‹JDKæä¾›äº†AtomicReferenceç±»æ¥ä¿è¯å¼•ç”¨å¯¹è±¡ä¹‹é—´çš„åŸå­æ€§ï¼Œå¯ä»¥æŠŠå¤šä¸ªå˜é‡æ”¾åœ¨ä¸€ä¸ªå¯¹è±¡é‡Œæ¥è¿›è¡ŒCASæ“ä½œã€‚ è‡ªæ—‹é” åœ¨ä»‹ç»è‡ªæ—‹é”å‰ï¼Œæˆ‘ä»¬éœ€è¦ä»‹ç»ä¸€äº›å‰æçŸ¥è¯†æ¥å¸®åŠ©å¤§å®¶æ˜ç™½è‡ªæ—‹é”çš„æ¦‚å¿µã€‚ é˜»å¡æˆ–å”¤é†’ä¸€ä¸ªJavaçº¿ç¨‹éœ€è¦æ“ä½œç³»ç»Ÿåˆ‡æ¢CPUçŠ¶æ€æ¥å®Œæˆï¼Œè¿™ç§çŠ¶æ€è½¬æ¢éœ€è¦è€—è´¹å¤„ç†å™¨æ—¶é—´ã€‚å¦‚æœåŒæ­¥ä»£ç å—ä¸­çš„å†…å®¹è¿‡äºç®€å•ï¼ŒçŠ¶æ€è½¬æ¢æ¶ˆè€—çš„æ—¶é—´æœ‰å¯èƒ½æ¯”ç”¨æˆ·ä»£ç æ‰§è¡Œçš„æ—¶é—´è¿˜è¦é•¿ã€‚ åœ¨è®¸å¤šåœºæ™¯ä¸­ï¼ŒåŒæ­¥èµ„æºçš„é”å®šæ—¶é—´å¾ˆçŸ­ï¼Œä¸ºäº†è¿™ä¸€å°æ®µæ—¶é—´å»åˆ‡æ¢çº¿ç¨‹ï¼Œçº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤ç°åœºçš„èŠ±è´¹å¯èƒ½ä¼šè®©ç³»ç»Ÿå¾—ä¸å¿å¤±ã€‚å¦‚æœç‰©ç†æœºå™¨æœ‰å¤šä¸ªå¤„ç†å™¨ï¼Œèƒ½å¤Ÿè®©ä¸¤ä¸ªæˆ–ä»¥ä¸Šçš„çº¿ç¨‹åŒæ—¶å¹¶è¡Œæ‰§è¡Œï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©åé¢é‚£ä¸ªè¯·æ±‚é”çš„çº¿ç¨‹ä¸æ”¾å¼ƒCPUçš„æ‰§è¡Œæ—¶é—´ï¼Œçœ‹çœ‹æŒæœ‰é”çš„çº¿ç¨‹æ˜¯å¦å¾ˆå¿«å°±ä¼šé‡Šæ”¾é”ã€‚ è€Œä¸ºäº†è®©å½“å‰çº¿ç¨‹â€œç¨ç­‰ä¸€ä¸‹â€ï¼Œæˆ‘ä»¬éœ€è®©å½“å‰çº¿ç¨‹è¿›è¡Œè‡ªæ—‹ï¼Œå¦‚æœåœ¨è‡ªæ—‹å®Œæˆåå‰é¢é”å®šåŒæ­¥èµ„æºçš„çº¿ç¨‹å·²ç»é‡Šæ”¾äº†é”ï¼Œé‚£ä¹ˆå½“å‰çº¿ç¨‹å°±å¯ä»¥ä¸å¿…é˜»å¡è€Œæ˜¯ç›´æ¥è·å–åŒæ­¥èµ„æºï¼Œä»è€Œé¿å…åˆ‡æ¢çº¿ç¨‹çš„å¼€é”€ã€‚è¿™å°±æ˜¯è‡ªæ—‹é”ã€‚ 1234567891011121314public class SpinLock { private AtomicReference&lt;Thread&gt; cas = new AtomicReference&lt;Thread&gt;(); public void lock() { Thread current = Thread.currentThread(); // åˆ©ç”¨CAS while (!cas.compareAndSet(null, current)) { // DO nothing } } public void unlock() { Thread current = Thread.currentThread(); cas.compareAndSet(current, null); }} lockï¼ˆ)æ–¹æ³•åˆ©ç”¨çš„CASï¼Œå½“ç¬¬ä¸€ä¸ªçº¿ç¨‹Aè·å–é”çš„æ—¶å€™ï¼Œèƒ½å¤ŸæˆåŠŸè·å–åˆ°ï¼Œä¸ä¼šè¿›å…¥whileå¾ªç¯ï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹Aæ²¡æœ‰é‡Šæ”¾é”ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹Båˆæ¥è·å–é”ï¼Œæ­¤æ—¶ç”±äºä¸æ»¡è¶³CASï¼Œæ‰€ä»¥å°±ä¼šè¿›å…¥whileå¾ªç¯ï¼Œä¸æ–­åˆ¤æ–­æ˜¯å¦æ»¡è¶³CASï¼Œç›´åˆ°Açº¿ç¨‹è°ƒç”¨unlockæ–¹æ³•é‡Šæ”¾äº†è¯¥é”ã€‚ è‡ªæ—‹é”çš„ç¼ºé™· å¦‚æœæŸä¸ªçº¿ç¨‹æŒæœ‰é”çš„æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´å…¶å®ƒç­‰å¾…è·å–é”çš„çº¿ç¨‹è¿›å…¥å¾ªç¯ç­‰å¾…ï¼Œæ¶ˆè€—CPUã€‚ä½¿ç”¨ä¸å½“ä¼šé€ æˆCPUä½¿ç”¨ç‡æé«˜ã€‚æ‰€ä»¥ï¼Œè‡ªæ—‹ç­‰å¾…çš„æ—¶é—´å¿…é¡»è¦æœ‰ä¸€å®šçš„é™åº¦ï¼Œå¦‚æœè‡ªæ—‹è¶…è¿‡äº†é™å®šæ¬¡æ•°ï¼ˆé»˜è®¤æ˜¯10æ¬¡ï¼Œå¯ä»¥ä½¿ç”¨-XX:PreBlockSpinæ¥æ›´æ”¹ï¼‰æ²¡æœ‰æˆåŠŸè·å¾—é”ï¼Œå°±åº”å½“æŒ‚èµ·çº¿ç¨‹ã€‚ ä¸Šé¢Javaå®ç°çš„è‡ªæ—‹é”ä¸æ˜¯å…¬å¹³çš„ï¼Œå³æ— æ³•æ»¡è¶³ç­‰å¾…æ—¶é—´æœ€é•¿çš„çº¿ç¨‹ä¼˜å…ˆè·å–é”ã€‚ä¸å…¬å¹³çš„é”å°±ä¼šå­˜åœ¨â€œçº¿ç¨‹é¥¥é¥¿â€é—®é¢˜ã€‚ è‡ªæ—‹é”çš„ä¼˜ç‚¹ è‡ªæ—‹é”ä¸ä¼šä½¿çº¿ç¨‹çŠ¶æ€å‘ç”Ÿåˆ‡æ¢ï¼Œä¸€ç›´å¤„äºç”¨æˆ·æ€ï¼Œå³çº¿ç¨‹ä¸€ç›´éƒ½æ˜¯activeçš„ï¼›ä¸ä¼šä½¿çº¿ç¨‹è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œå‡å°‘äº†ä¸å¿…è¦çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ‰§è¡Œé€Ÿåº¦å¿« éè‡ªæ—‹é”åœ¨è·å–ä¸åˆ°é”çš„æ—¶å€™ä¼šè¿›å…¥é˜»å¡çŠ¶æ€ï¼Œä»è€Œè¿›å…¥å†…æ ¸æ€ï¼Œå½“è·å–åˆ°é”çš„æ—¶å€™éœ€è¦ä»å†…æ ¸æ€æ¢å¤ï¼Œéœ€è¦çº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ ï¼ˆçº¿ç¨‹è¢«é˜»å¡åä¾¿è¿›å…¥å†…æ ¸ï¼ˆLinuxï¼‰è°ƒåº¦çŠ¶æ€ï¼Œè¿™ä¸ªä¼šå¯¼è‡´ç³»ç»Ÿåœ¨ç”¨æˆ·æ€ä¸å†…æ ¸æ€ä¹‹é—´æ¥å›åˆ‡æ¢ï¼Œä¸¥é‡å½±å“é”çš„æ€§èƒ½ï¼‰ é€‚åº”æ€§è‡ªæ—‹é” è‡ªæ—‹é”åœ¨JDK1.4.2ä¸­å¼•å…¥ï¼Œä½¿ç”¨-XX:+UseSpinningæ¥å¼€å¯ã€‚JDK 6ä¸­å˜ä¸ºé»˜è®¤å¼€å¯ï¼Œå¹¶ä¸”å¼•å…¥äº†è‡ªé€‚åº”çš„è‡ªæ—‹é”ï¼ˆé€‚åº”æ€§è‡ªæ—‹é”ï¼‰ã€‚ è‡ªé€‚åº”æ„å‘³ç€è‡ªæ—‹çš„æ—¶é—´ï¼ˆæ¬¡æ•°ï¼‰ä¸å†å›ºå®šï¼Œè€Œæ˜¯ç”±å‰ä¸€æ¬¡åœ¨åŒä¸€ä¸ªé”ä¸Šçš„è‡ªæ—‹æ—¶é—´åŠé”çš„æ‹¥æœ‰è€…çš„çŠ¶æ€æ¥å†³å®šã€‚å¦‚æœåœ¨åŒä¸€ä¸ªé”å¯¹è±¡ä¸Šï¼Œè‡ªæ—‹ç­‰å¾…åˆšåˆšæˆåŠŸè·å¾—è¿‡é”ï¼Œå¹¶ä¸”æŒæœ‰é”çš„çº¿ç¨‹æ­£åœ¨è¿è¡Œä¸­ï¼Œé‚£ä¹ˆè™šæ‹Ÿæœºå°±ä¼šè®¤ä¸ºè¿™æ¬¡è‡ªæ—‹ä¹Ÿæ˜¯å¾ˆæœ‰å¯èƒ½å†æ¬¡æˆåŠŸï¼Œè¿›è€Œå®ƒå°†å…è®¸è‡ªæ—‹ç­‰å¾…æŒç»­ç›¸å¯¹æ›´é•¿çš„æ—¶é—´ã€‚å¦‚æœå¯¹äºæŸä¸ªé”ï¼Œè‡ªæ—‹å¾ˆå°‘æˆåŠŸè·å¾—è¿‡ï¼Œé‚£åœ¨ä»¥åå°è¯•è·å–è¿™ä¸ªé”æ—¶å°†å¯èƒ½çœç•¥æ‰è‡ªæ—‹è¿‡ç¨‹ï¼Œç›´æ¥é˜»å¡çº¿ç¨‹ï¼Œé¿å…æµªè´¹å¤„ç†å™¨èµ„æºã€‚ åœ¨è‡ªæ—‹é”ä¸­ å¦æœ‰ä¸‰ç§å¸¸è§çš„é”å½¢å¼:TicketLockã€CLHlockå’ŒMCSlockã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLæ€§èƒ½ä¼˜åŒ–]]></title>
    <url>%2Fposts%2F18d8d4e.html</url>
    <content type="text"><![CDATA[å•¦å•¦å•¦å•¦å•¦å•¦å•¦å•¦å•¦ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - LongAdder]]></title>
    <url>%2Fposts%2Fd182cfa5.html</url>
    <content type="text"><![CDATA[CASæœ‰æ²¡æœ‰é—®é¢˜å‘¢ï¼Ÿè‚¯å®šæ˜¯æœ‰çš„ã€‚æ¯”å¦‚è¯´å¤§é‡çš„çº¿ç¨‹åŒæ—¶å¹¶å‘ä¿®æ”¹ä¸€ä¸ªAtomicLongï¼Œå¯èƒ½æœ‰å¾ˆå¤šçº¿ç¨‹ä¼šä¸åœçš„è‡ªæ—‹ï¼Œè¿›å…¥ä¸€ä¸ªæ— é™é‡å¤çš„å¾ªç¯ä¸­ã€‚ è¿™äº›çº¿ç¨‹ä¸åœåœ°è·å–å€¼ï¼Œç„¶åå‘èµ·CASæ“ä½œï¼Œä½†æ˜¯å‘ç°è¿™ä¸ªå€¼è¢«åˆ«äººæ”¹è¿‡äº†ï¼Œäºæ˜¯å†æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ï¼Œè·å–å€¼ï¼Œå‘èµ·CASæ“ä½œåˆå¤±è´¥äº†ï¼Œå†æ¬¡è¿›å…¥ä¸‹ä¸€ä¸ªå¾ªç¯ã€‚ åœ¨å¤§é‡çº¿ç¨‹é«˜å¹¶å‘æ›´æ–°AtomicLongçš„æ—¶å€™ï¼Œè¿™ç§é—®é¢˜å¯èƒ½ä¼šæ¯”è¾ƒæ˜æ˜¾ï¼Œå¯¼è‡´å¤§é‡çº¿ç¨‹ç©ºå¾ªç¯ï¼Œè‡ªæ—‹è½¬ï¼Œæ€§èƒ½å’Œæ•ˆç‡éƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ã€‚ äºæ˜¯ï¼ŒJava 8æ¨å‡ºäº†ä¸€ä¸ªæ–°çš„ç±»ï¼ŒLongAdderï¼Œåœ¨AtomicLongçš„åŸºç¡€ä¸Šè¿›è¡Œäº†çƒ­ç‚¹åˆ†ç¦»ï¼Œçƒ­ç‚¹åˆ†ç¦»ç±»ä¼¼äºæœ‰é”æ“ä½œä¸­çš„å‡å°é”ç²’åº¦ï¼Œå°è¯•ä½¿ç”¨åˆ†æ®µCASä»¥åŠè‡ªåŠ¨åˆ†æ®µè¿ç§»çš„æ–¹å¼æ¥å¤§å¹…åº¦æå‡å¤šçº¿ç¨‹é«˜å¹¶å‘æ‰§è¡ŒCASæ“ä½œçš„æ€§èƒ½ï¼åœ¨æ— é”ä¸­ï¼Œä¹Ÿå¯ä»¥ç”¨ç±»ä¼¼çš„æ–¹å¼æ¥å¢åŠ CASçš„æˆåŠŸç‡ï¼Œä»è€Œæé«˜æ€§èƒ½ã€‚ LongAdderåŸç†å¦‚ä¸‹å›¾ï¼š AtomicLongçš„å®ç°æ–¹å¼æ˜¯å†…éƒ¨æœ‰ä¸ªvalue å˜é‡ï¼Œå½“å¤šçº¿ç¨‹å¹¶å‘è‡ªå¢ï¼Œè‡ªå‡æ—¶ï¼Œå‡é€šè¿‡CAS æŒ‡ä»¤ä»æœºå™¨æŒ‡ä»¤çº§åˆ«æ“ä½œä¿è¯å¹¶å‘çš„åŸå­æ€§ã€‚å”¯ä¸€ä¼šåˆ¶çº¦AtomicLongé«˜æ•ˆçš„åŸå› æ˜¯é«˜å¹¶å‘ï¼Œé«˜å¹¶å‘æ„å‘³ç€CASçš„å¤±è´¥å‡ ç‡æ›´é«˜ï¼Œ é‡è¯•æ¬¡æ•°æ›´å¤šï¼Œè¶Šå¤šçº¿ç¨‹é‡è¯•ï¼ŒCASå¤±è´¥å‡ ç‡åˆè¶Šé«˜ï¼Œå˜æˆæ¶æ€§å¾ªç¯ï¼ŒAtomicLongæ•ˆç‡é™ä½ã€‚ åœ¨LongAdderçš„åº•å±‚å®ç°ä¸­ï¼Œé¦–å…ˆæœ‰ä¸€ä¸ªbaseå€¼ï¼Œåˆšå¼€å§‹å¤šçº¿ç¨‹æ¥ä¸åœçš„ç´¯åŠ æ•°å€¼ï¼Œéƒ½æ˜¯å¯¹baseè¿›è¡Œç´¯åŠ çš„ï¼Œæ¯”å¦‚åˆšå¼€å§‹ç´¯åŠ æˆäº†base = 5ã€‚ æ¥ç€å¦‚æœå‘ç°å¹¶å‘æ›´æ–°çš„çº¿ç¨‹æ•°é‡è¿‡å¤šï¼Œå°±ä¼šå¼€å§‹æ–½è¡Œåˆ†æ®µCASçš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å†…éƒ¨ä¼šæä¸€ä¸ªCellæ•°ç»„ï¼Œæ¯ä¸ªæ•°ç»„æ˜¯ä¸€ä¸ªæ•°å€¼åˆ†æ®µã€‚ è¿™æ—¶ï¼Œè®©å¤§é‡çš„çº¿ç¨‹åˆ†åˆ«å»å¯¹ä¸åŒCellå†…éƒ¨çš„valueå€¼è¿›è¡ŒCASç´¯åŠ æ“ä½œï¼Œè¿™æ ·å°±æŠŠCASè®¡ç®—å‹åŠ›åˆ†æ•£åˆ°äº†ä¸åŒçš„Cellåˆ†æ®µæ•°å€¼ä¸­äº†ï¼ è¿™æ ·å°±å¯ä»¥å¤§å¹…åº¦çš„é™ä½å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°åŒä¸€ä¸ªæ•°å€¼æ—¶å‡ºç°çš„æ— é™å¾ªç¯çš„é—®é¢˜ï¼Œå¤§å¹…åº¦æå‡äº†å¤šçº¿ç¨‹å¹¶å‘æ›´æ–°æ•°å€¼çš„æ€§èƒ½å’Œæ•ˆç‡ï¼ è€Œä¸”ä»–å†…éƒ¨å®ç°äº†è‡ªåŠ¨åˆ†æ®µè¿ç§»çš„æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å¦‚æœæŸä¸ªCellçš„valueæ‰§è¡ŒCASå¤±è´¥äº†ï¼Œé‚£ä¹ˆå°±ä¼šè‡ªåŠ¨å»æ‰¾å¦å¤–ä¸€ä¸ªCellåˆ†æ®µå†…çš„valueå€¼è¿›è¡ŒCASæ“ä½œã€‚ è¿™æ ·ä¹Ÿè§£å†³äº†çº¿ç¨‹ç©ºæ—‹è½¬ã€è‡ªæ—‹ä¸åœç­‰å¾…æ‰§è¡ŒCASæ“ä½œçš„é—®é¢˜ï¼Œè®©ä¸€ä¸ªçº¿ç¨‹è¿‡æ¥æ‰§è¡ŒCASæ—¶å¯ä»¥å°½å¿«çš„å®Œæˆè¿™ä¸ªæ“ä½œã€‚ æœ€åï¼Œå¦‚æœä½ è¦ä»LongAdderä¸­è·å–å½“å‰ç´¯åŠ çš„æ€»å€¼ï¼Œå°±ä¼šæŠŠbaseå€¼å’Œæ‰€æœ‰Cellåˆ†æ®µæ•°å€¼åŠ èµ·æ¥è¿”å›ç»™ä½ ã€‚LongAdderæ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢æ—¶é—´çš„ç­–ç•¥ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>J.U.C</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>J.U.C</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQL-ç´¢å¼•ç»“æ„]]></title>
    <url>%2Fposts%2F3bf347e4.html</url>
    <content type="text"><![CDATA[BTreeç´¢å¼• BTreeï¼ˆå¤šè·¯æœç´¢æ ‘ï¼Œå¹¶ä¸æ˜¯äºŒå‰çš„ï¼‰æ˜¯ä¸€ç§å¸¸è§çš„æ•°æ®ç»“æ„ã€‚ ä¸é€‚åˆï¼š å•åˆ—ç´¢å¼•çš„åˆ—ä¸èƒ½åŒ…å«nullçš„è®°å½•ï¼Œå¤åˆç´¢å¼•çš„å„ä¸ªåˆ—ä¸èƒ½åŒ…å«åŒæ—¶ä¸ºnullçš„è®°å½•ï¼Œå¦åˆ™ä¼šå…¨è¡¨æ‰«æï¼›ç´¢å¼•å¤±æ•ˆå¾ˆå¤šæ—¶å€™æ˜¯å› ä¸ºè¿™åˆ—æœ‰nullï¼Œç©ºå€¼ ä¸é€‚åˆé”®å€¼è¾ƒå°‘çš„åˆ—ï¼ˆé‡å¤æ•°æ®è¾ƒå¤šçš„åˆ—ï¼‰ï¼›å‡å¦‚ä½ å»ºç«‹äº†ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µå‘¢ï¼ŸæŸ¥è¯¢åè€Œä¼šå˜æ…¢ å‰å¯¼æ¨¡ç³ŠæŸ¥è¯¢ä¸èƒ½åˆ©ç”¨ç´¢å¼•(like '%XX'æˆ–è€…like '%XX%')ï¼Œè¯¥ç±»sqlè¯­å¥å¯¼è‡´ç´¢å¼•å¤±æ•ˆ Hashæ•£åˆ—ç´¢å¼• Hashæ•£åˆ—ç´¢å¼•æ˜¯æ ¹æ®HASHç®—æ³•æ¥æ„å»ºçš„ç´¢å¼•ã€‚ é€‚åˆï¼š ç²¾ç¡®æŸ¥æ‰¾éå¸¸å¿«ï¼ˆåŒ…æ‹¬= &lt;&gt; å’Œinï¼‰ï¼Œå…¶æ£€ç´¢æ•ˆç‡éå¸¸é«˜ï¼Œç´¢å¼•çš„æ£€ç´¢å¯ä»¥ä¸€æ¬¡å®šä½ï¼Œä¸åƒBTree ç´¢å¼•éœ€è¦ä»æ ¹èŠ‚ç‚¹åˆ°æèŠ‚ç‚¹ï¼Œæ‰€ä»¥ Hash ç´¢å¼•çš„æŸ¥è¯¢æ•ˆç‡è¦è¿œé«˜äº B-Tree ç´¢å¼•ã€‚ ä¸é€‚åˆï¼š ä¸é€‚åˆæ¨¡ç³ŠæŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢ï¼ˆåŒ…æ‹¬likeï¼Œ&gt;ï¼Œ&lt;ï¼Œbetweenâ€¦â€¦andç­‰ï¼‰ï¼Œç”±äº Hash ç´¢å¼•æ¯”è¾ƒçš„æ˜¯è¿›è¡Œ Hash è¿ç®—ä¹‹åçš„ Hash å€¼ï¼Œæ‰€ä»¥å®ƒåªèƒ½ç”¨äºç­‰å€¼çš„è¿‡æ»¤ï¼Œä¸èƒ½ç”¨äºåŸºäºèŒƒå›´çš„è¿‡æ»¤ï¼Œå› ä¸ºç»è¿‡ç›¸åº”çš„ Hash ç®—æ³•å¤„ç†ä¹‹åçš„ Hash å€¼çš„å¤§å°å…³ç³»ï¼Œå¹¶ä¸èƒ½ä¿è¯å’ŒHashè¿ç®—å‰å®Œå…¨ä¸€æ ·ï¼› ä¸é€‚åˆæ’åºï¼Œæ•°æ®åº“æ— æ³•åˆ©ç”¨ç´¢å¼•çš„æ•°æ®æ¥æå‡æ’åºæ€§èƒ½ï¼ŒåŒæ ·æ˜¯å› ä¸ºHashå€¼çš„å¤§å°ä¸ç¡®å®šï¼› å¤åˆç´¢å¼•ä¸èƒ½åˆ©ç”¨éƒ¨åˆ†ç´¢å¼•å­—æ®µæŸ¥è¯¢ï¼ŒHash ç´¢å¼•åœ¨è®¡ç®— Hash å€¼çš„æ—¶å€™æ˜¯ç»„åˆç´¢å¼•é”®åˆå¹¶åå†ä¸€èµ·è®¡ç®— Hash å€¼ï¼Œè€Œä¸æ˜¯å•ç‹¬è®¡ç®— Hash å€¼ï¼Œæ‰€ä»¥é€šè¿‡ç»„åˆç´¢å¼•çš„å‰é¢ä¸€ä¸ªæˆ–å‡ ä¸ªç´¢å¼•é”®è¿›è¡ŒæŸ¥è¯¢çš„æ—¶å€™ï¼ŒHash ç´¢å¼•ä¹Ÿæ— æ³•è¢«åˆ©ç”¨ã€‚ åŒæ ·ä¸é€‚åˆé”®å€¼è¾ƒå°‘çš„åˆ—ï¼ˆé‡å¤å€¼è¾ƒå¤šçš„åˆ—ï¼‰ï¼› Bitmapä½å›¾ç´¢å¼• å°±æ˜¯ç”¨ä½å›¾è¡¨ç¤ºçš„ç´¢å¼•ï¼Œå¯¹åˆ—çš„æ¯ä¸ªé”®å€¼å»ºç«‹ä¸€ä¸ªä½å›¾ã€‚ç›¸å¯¹äºBTreeç´¢å¼•ï¼Œå ç”¨çš„ç©ºé—´éå¸¸å°ï¼Œåˆ›å»ºå’Œä½¿ç”¨éå¸¸å¿«ã€‚ä½å›¾ç´¢å¼•ç”±äºåªå­˜å‚¨é”®å€¼çš„èµ·æ­¢Rowidå’Œä½å›¾,å ç”¨çš„ç©ºé—´éå¸¸å°‘ã€‚ é€‚åˆ é€‚åˆå†³ç­–æ”¯æŒç³»ç»Ÿï¼› å½“select count(XX) æ—¶,å¯ä»¥ç›´æ¥è®¿é—®ç´¢å¼•ä¸­ä¸€ä¸ªä½å›¾å°±å¿«é€Ÿå¾—å‡ºç»Ÿè®¡æ•°æ®ï¼› å½“æ ¹æ®é”®å€¼åšandï¼Œoræˆ– in(x,y,..)æŸ¥è¯¢æ—¶ï¼Œç›´æ¥ç”¨ç´¢å¼•çš„ä½å›¾è¿›è¡Œæˆ–è¿ç®—,å¿«é€Ÿå¾—å‡ºç»“æœè¡Œæ•°æ®ã€‚ ä¸é€‚åˆ ä¸é€‚åˆé”®å€¼è¾ƒå¤šçš„åˆ—ï¼ˆé‡å¤å€¼è¾ƒå°‘çš„åˆ—ï¼‰ï¼› ä¸é€‚åˆupdateã€insertã€deleteé¢‘ç¹çš„åˆ—ï¼Œä»£ä»·å¾ˆé«˜ã€‚åˆ°åº•æ˜¯ä»€ä¹ˆä»£ä»·å‘¢ï¼Ÿupdate,insert,deleteçš„æ—¶å€™ä¼šé”ä½é”®å€¼ä¸€æ ·çš„è¡Œã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[IDEAä½¿ç”¨FindBugsæ’ä»¶]]></title>
    <url>%2Fposts%2F570da5f6.html</url>
    <content type="text"><![CDATA[ä¸‹è½½å®‰è£… åœ¨Ideaä¸­ï¼Œæ‰“å¼€"File"--&gt;"Settings"ï¼Œæˆ–è€…ä½¿ç”¨å¿«æ·é”®"Ctrl+Alt+S"æ‰“å¼€è®¾ç½®çª—å£ï¼š åœ¨è®¾ç½®çª—å£æ‰¾åˆ°** plugins **æ ‡ç­¾é¡µï¼Œç„¶åç‚¹å‡»ä¸‹æ–¹çš„ ** Browse Repositories **ï¼š åœ¨æ–°æ‰“å¼€çš„Browse Repositoriesçª—å£æœç´¢findbugsï¼Œç„¶åç‚¹å‡»Installè¿›è¡Œå®‰è£…ï¼Œ å› ä¸ºæˆ‘å·²ç»å®‰è£…è¿‡äº†ï¼Œæ‰€ä»¥ä¸å†æ˜¾ç¤ºinstallæŒ‰é’®ï¼š ä½¿ç”¨FindBugs ç®€å•è¯´æ˜ï¼š é¼ æ ‡ç§»åŠ¨åˆ°å³è¾¹çš„æ‰€æœ‰å›¾æ ‡ï¼Œçœ‹çœ‹æ¯ä¸ªå›¾æ ‡éƒ½æ˜¯ä»€ä¹ˆæ„æ€ã€‚å¤§æ¦‚è¯´ä¸€ä¸‹ï¼š ç¬¬ä¸€ç«–åˆ—çš„çº¢è‰²å›¾æ ‡æ˜¯åˆ†æå½“å‰çš„è¿™ä¸ªæ–‡ä»¶ã€‚ ä¸‹é¢æ˜¯åˆ†ææ˜¯æŸä¸€ä¸ªç±»ï¼Œé¼ æ ‡æ‰€åœ¨çš„é‚£ä¸ªç±»ã€‚ å†å¾€ä¸‹æ˜¯æŸä¸ªåŒ…ï¼ŒæŸä¸ªæ¨¡å—ï¼Œæ•´ä¸ªé¡¹ç›®ï¼Œæ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶ï¼Œç­‰ç­‰ã€‚ ç¬¬äºŒç«–åˆ—åˆ™æ˜¯æ§åˆ¶åˆ†æç»“æœçš„å±•ç¤ºæƒ…å†µã€‚ ä¸‹é¢å°±æ•´ä¸ªå®é™…æ‰¾åˆ°çš„ä»£ç çš„é—®é¢˜ï¼Œå•ç‹¬åˆ†ææŸä¸ªserviceæ–‡ä»¶ï¼Œçœ‹ä»£ç é‡Œé¢çš„é—®é¢˜ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Find Bugsçš„æ„æ€æ˜¯è¯´ä»£ç é‡Œé¢æŠŠSimpleDateFormatå£°æ˜ä¸ºé™æ€å±æ€§ï¼Œä½†æ˜¯SimpleDateFormatæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ã€‚ åœ¨å¤šçº¿ç¨‹ä½¿ç”¨çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šæœ‰æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚æ‰€ä»¥å°±æ‰¾åˆ°ä¸ªé—®é¢˜å•¦ã€‚ æ ¹æ®æç¤ºè¿›è¡Œä¿®æ”¹ï¼Œå¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ä¸­çœ‹åˆ°ä»£ç é‡Œæœ‰å¾ˆå¤šé»„è‰²æç¤ºï¼Œå¼ºè¿«ç—‡çš„äººçœ‹ç€å¾ˆä¸çˆ½ï¼Œé‚£æ€ä¹ˆæŠŠä»£ç é‡Œé¢è¿™äº›é»„è‰²çš„æç¤ºç»™å…³æ‰å‘¢ï¼Ÿ ç‚¹è¿™ä¸ª ** Ã— ** å°±ä»¥å•¦ï¼Œä»£ç å°±æ¢å¤æˆåŸæ¥çš„æ ·å­å•¦ã€‚ å¸¸è§çš„é”™è¯¯ä¿¡æ¯ Bad practice ä»£ç ä¸­çš„ä¸€äº›åä¹ æƒ¯ Class names should start with an upper case letter ä¸»è¦åŒ…æ‹¬ç±»åçš„å‘½åï¼Œä»¥å¤§å†™å­—æ¯å¼€å¤´ã€‚ Method names should start with a lower case letter æ–¹æ³•åä»¥å°å†™å­—æ¯å¼€å¤´ã€‚ Field names should start with a lower case letter å­—æ®µåä»¥å°å†™å­—æ¯å¼€å¤´ã€‚ equals()method does not check for null argument equals()æ–¹æ³•åº”è¯¥æ£€æŸ¥éç©ºã€‚ Class defines equals() and uses Object.hashCode() ä¸€ä¸ªç±»è¦†å†™äº†equalsæ–¹æ³•ï¼Œæ²¡æœ‰è¦†å†™hashCodeæ–¹æ³•ï¼Œä½¿ç”¨äº†Objectå¯¹è±¡çš„hashCodeæ–¹æ³•ã€‚ Method ignores exceptional return value æ–¹æ³•å¿½ç•¥è¿”å›å€¼çš„å¼‚å¸¸ä¿¡æ¯ã€‚ Equals method should not assume anything about the type of its argument equals(Object o)æ–¹æ³•ä¸èƒ½å¯¹å‚æ•°oçš„ç±»å‹åšä»»ä½•çš„å‡è®¾ã€‚æ¯”è¾ƒæ­¤å¯¹è±¡ä¸æŒ‡å®šçš„å¯¹è±¡ã€‚å½“ä¸”ä»…å½“è¯¥å‚æ•°ä¸ä¸º nullï¼Œå¹¶ä¸”æ˜¯è¡¨ç¤ºä¸æ­¤å¯¹è±¡ç›¸åŒçš„ç±»å‹çš„å¯¹è±¡æ—¶ï¼Œç»“æœæ‰ä¸º trueã€‚ Comparison of String objects using == or != ç”¨==æˆ–è€…ï¼=å»æ¯”è¾ƒStringç±»å‹çš„å¯¹è±¡ã€‚ Method might ignore exception æ–¹æ³•å¯èƒ½å¿½ç•¥å¼‚å¸¸ã€‚ Method invokes System.exit() åœ¨æ–¹æ³•ä¸­è°ƒç”¨System.exit(â€¦)è¯­å¥ï¼Œè€ƒè™‘ç”¨RuntimeExceptionæ¥ä»£æ›¿ã€‚ Method ignores result of InputStream.read() InputStream.readæ–¹æ³•å¿½ç•¥è¿”å›çš„å¤šä¸ªå­—ç¬¦ï¼Œå¦‚æœå¯¹ç»“æœæ²¡æœ‰æ£€æŸ¥å°±æ²¡æ³•æ­£ç¡®å¤„ç†ç”¨æˆ·è¯»å–å°‘é‡å­—ç¬¦è¯·æ±‚çš„æƒ…å†µã€‚ Dodgy code ç³Ÿç³•çš„ä»£ç  Switch statement found where default case is missing Switchæ²¡æœ‰é»˜è®¤æƒ…å†µä¸‹æ‰§è¡Œçš„caseè¯­å¥ã€‚ Switch statement found where one case falls through to the next case Switchè¯­å¥ä¸­ä¸€ä¸ªåˆ†æ”¯æ‰§è¡Œååˆæ‰§è¡Œäº†ä¸‹ä¸€ä¸ªåˆ†æ”¯ã€‚é€šå¸¸caseåé¢è¦è·Ÿbreak æˆ–è€…returnè¯­å¥æ¥è·³å‡ºã€‚ Dead store to local variable è¯¥æŒ‡ä»¤ä¸ºå±€éƒ¨å˜é‡èµ‹å€¼ï¼Œä½†åœ¨å…¶åçš„æ²¡æœ‰å¯¹å¥¹åšä»»ä½•ä½¿ç”¨ã€‚é€šå¸¸ï¼Œè¿™è¡¨æ˜ä¸€ä¸ªé”™è¯¯ï¼Œå› ä¸ºå€¼ä»æœªä½¿ç”¨è¿‡ã€‚ Write to static field from instance method åœ¨å®ä¾‹æ–¹æ³•å†™å…¥é™æ€å­—æ®µã€‚ Redundant nullcheck of value known to be non-null æ–¹æ³•ä¸­å¯¹ä¸ä¸ºç©ºçš„å€¼è¿›è¡Œä¸ºç©ºçš„åˆ¤æ–­ã€‚ Method uses the same code for two branches æ­¤æ–¹æ³•ä½¿ç”¨ç›¸åŒçš„ä»£ç ï¼Œä»¥å®ç°ä¸¤ä¸ªæœ‰æ¡ä»¶çš„åˆ†æ”¯ã€‚æ£€æŸ¥ä»¥ç¡®ä¿è¿™æ˜¯ä¸æ˜¯ä¸€ä¸ªç¼–ç é”™è¯¯ã€‚ Exception is caught when Exception is not thrown åœ¨try/catchå—ä¸­æ•è·å¼‚å¸¸ï¼Œä½†æ˜¯å¼‚å¸¸æ²¡æœ‰åœ¨tryè¯­å¥ä¸­æŠ›å‡ºè€ŒRuntimeExceptionåˆæ²¡æœ‰æ˜ç¡®çš„è¢«æ•è·ã€‚ Integral division result cast to double or float æ•´å½¢æ•°é™¤æ³•å¼ºåˆ¶è½¬æ¢ä¸ºdoubleæˆ–è€…floatç±»å‹ã€‚ Possible null pointer dereference due to return value of called method æ–¹æ³•çš„è¿”å›å€¼æ²¡æœ‰è¿›è¡Œæ˜¯å¦ä¸ºç©ºçš„æ£€æŸ¥å°±é‡æ–°èµ‹å€¼ï¼Œè¿™æ ·å¯èƒ½ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ Useless object created å¯¹è±¡åˆ›å»ºäº†å¹¶æ²¡æœ‰ç”¨ã€‚ Unread public/protected field æ²¡æœ‰ç”¨åˆ°çš„å­—æ®µã€‚ Internationalization å…³äºä»£ç å›½é™…åŒ–ç›¸å…³æ–¹é¢çš„ Consider using Locale parameterized version of invoked method ä½¿ç”¨å¹³å°é»˜è®¤çš„ç¼–ç æ ¼å¼å¯¹å­—ç¬¦ä¸²è¿›è¡Œå¤§å°å†™è½¬æ¢ï¼Œè¿™å¯èƒ½å¯¼è‡´å›½é™…å­—ç¬¦çš„è½¬æ¢ä¸å½“ã€‚ä½¿ç”¨ä»¥ä¸‹æ–¹å¼å¯¹å­—ç¬¦è¿›è¡Œè½¬æ¢ ** Performance ** å…³äºä»£ç æ€§èƒ½ç›¸å…³æ–¹é¢çš„ Boxing/unboxing to parse a primitive ç±»å‹è½¬æ¢ æ¯”å¦‚å­—ç¬¦ä¸²è½¬æ¢æˆint åº”è¯¥ä½¿ç”¨Integer.parseInt(â€œâ€) ä»£æ›¿Integer.valueOf(â€œâ€) Method concatenates string using + in aloop æ¯æ¬¡å¾ªç¯é‡Œçš„å­—ç¬¦ä¸²+è¿æ¥ï¼Œéƒ½ä¼šæ–°äº§ç”Ÿä¸€ä¸ªstringå¯¹è±¡ï¼Œåœ¨javaä¸­ï¼Œæ–°å»ºä¸€ä¸ªå¯¹è±¡çš„ä»£ä»·æ˜¯å¾ˆæ˜‚è´µçš„ï¼Œç‰¹åˆ«æ˜¯åœ¨å¾ªç¯è¯­å¥ä¸­ï¼Œæ•ˆç‡è¾ƒä½ è§£å†³åŠæ³•ï¼šä½¿ç”¨StringBufferæˆ–è€…StringBuilderé‡ç”¨å¯¹è±¡ã€‚ Private method is never called ç§æœ‰æ–¹æ³•æ²¡æœ‰è¢«è°ƒç”¨ Explicit garbage collection;extremely dubious except in benchmarking code åœ¨ä»£ç ä¸­æ˜¾å¼çš„è°ƒç”¨åƒåœ¾å›æ”¶å‘½åï¼Œè¿™æ ·åšå¹¶ä¸èƒ½èµ·ä½œç”¨ã€‚åœ¨è¿‡å»ï¼Œæœ‰äººåœ¨å…³é—­æ“ä½œæˆ–è€…finalizeæ–¹æ³•ä¸­è°ƒç”¨åƒåœ¾å›æ”¶æ–¹æ³•å¯¼è‡´äº†å¾ˆå¤šçš„æ€§èƒ½æµªè´¹ã€‚è¿™æ ·å¤§è§„æ¨¡å›æ”¶å¯¹è±¡æ—¶ä¼šé€ æˆå¤„ç†å™¨è¿è¡Œç¼“æ…¢ã€‚ Unread field:should this field be static? æ²¡æœ‰ç”¨åˆ°çš„static å­—æ®µ should be a static inner class æ­¤å†…éƒ¨ç±»åº”è¯¥ä½¿ç”¨staticä¿®é¥° ** Experimental ** Method may fail to clean up stream or resource on checked exception è¿™ç§æ–¹æ³•å¯èƒ½æ— æ³•æ¸…é™¤ï¼ˆå…³é—­ï¼Œå¤„ç½®ï¼‰ä¸€ä¸ªæµï¼Œæ•°æ®åº“å¯¹è±¡ï¼Œæˆ–å…¶ä»–èµ„æºéœ€è¦ä¸€ä¸ªæ˜ç¡®çš„æ¸…ç†è¡ŒåŠ¨ è§£å†³æ–¹æ³•ï¼šæµçš„å…³é—­éƒ½å†™åœ¨finallyé‡Œé¢ Malicious code vulnerability å…³äºæ¶æ„ç ´åä»£ç ç›¸å…³æ–¹é¢çš„ May expose internal representation by incorporating reference to mutable object æ­¤ä»£ç æŠŠå¤–éƒ¨å¯å˜å¯¹è±¡å¼•ç”¨å­˜å‚¨åˆ°å¯¹è±¡çš„å†…éƒ¨è¡¨ç¤ºã€‚å¦‚æœå®ä¾‹å—åˆ°ä¸ä¿¡ä»»çš„ä»£ç çš„è®¿é—®å’Œæ²¡æœ‰æ£€æŸ¥çš„å˜åŒ–å±åŠå¯¹è±¡å’Œé‡è¦å±æ€§çš„å®‰å…¨ã€‚å­˜å‚¨ä¸€ä¸ªå¯¹è±¡çš„å‰¯æœ¬ï¼Œåœ¨å¾ˆå¤šæƒ…å†µä¸‹æ˜¯æ›´å¥½çš„åŠæ³•ã€‚ Field isnâ€™t final but should be æ­¤å­—æ®µå‰åº”è¯¥åŠ final Field isnâ€™t final and canâ€™t be protected from malicious code æ­¤å­—æ®µå‰åº”è¯¥åŠ final Field should be package protected ä¸€ä¸ªé™æ€å­—æ®µæ˜¯å¯ä»¥è¢«æ¶æ„ä»£ç æˆ–å…¶ä»–çš„åŒ…è®¿é—®ä¿®æ”¹ã€‚å¯ä»¥æŠŠè¿™ç§ç±»å‹çš„å­—æ®µå£°æ˜ä¸ºfinalç±»å‹çš„ä»¥é˜²æ­¢è¿™ç§é”™è¯¯ã€‚ Multithreaded correctness å…³äºå¤šçº¿ç¨‹ä»£ç æ­£ç¡®æ€§ç›¸å…³æ–¹é¢çš„ Static DateFormat DateFormat åœ¨å¤šçº¿ç¨‹ä¸­æœ¬èº«å°±æ˜¯ä¸å®‰å…¨çš„ï¼Œå¦‚æœåœ¨çº¿ç¨‹èŒƒå›´ä¸­å…±äº«ä¸€ä¸ªDateFormatçš„å®ä¾‹è€Œä¸ä½¿ç”¨ä¸€ä¸ªåŒæ­¥çš„æ–¹æ³•åœ¨åº”ç”¨ä¸­å°±ä¼šå‡ºç°ä¸€äº›å¥‡æ€ªçš„è¡Œä¸ºã€‚ Call to static DateFormat DateFormatså¤šçº¿ç¨‹ä½¿ç”¨æœ¬äº‹å°±æ˜¯ä¸å®‰å…¨çš„,æ”¹è¿›æ–¹æ³•ï¼šéœ€è¦åˆ›å»ºå¤šå®ä¾‹æˆ–çº¿ç¨‹åŒæ­¥ Correctness å…³äºä»£ç æ­£ç¡®æ€§ç›¸å…³æ–¹é¢çš„ Nullcheck of value previously dereferenced æ­¤ä»£ç ä¹‹å‰åºŸå¼ƒnullå€¼æ£€æŸ¥ã€‚è§£å†³åŠæ³• è¿›è¡Œnullæ£€æŸ¥ Possible null pointer dereference å¯èƒ½ä¸ºnull Null pointer dereference å¯¹è±¡èµ‹ä¸ºnullå€¼å æ²¡æœ‰è¢«é‡æ–°èµ‹å€¼ Possible null pointer dereference in method on exception path åœ¨å¼‚å¸¸nullå€¼å¤„ç†åˆ†æ”¯è°ƒç”¨çš„æ–¹æ³•ä¸Šï¼Œå¯èƒ½å­˜åœ¨å¯¹è±¡å»é™¤å¼•ç”¨æ“ä½œ value is null and guaranteed to be dereferenced on exception path exceptionåˆ†æ”¯ä¸Šï¼Œå­˜åœ¨å¼•ç”¨ä¸€ä¸ªnullå¯¹è±¡çš„æ–¹æ³•ï¼Œå¼•å‘ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ Self comparison of value with itself æ–¹æ³•ä¸­å¯¹ä¸€ä¸ªå±€éƒ¨å˜é‡è‡ªèº«è¿›è¡Œæ¯”è¾ƒè¿ç®—ï¼Œå¹¶å¯è¯´æ˜é”™è¯¯æˆ–é€»è¾‘é”™è¯¯ã€‚è¯·ç¡®ä¿æ‚¨æ˜¯æ¯”è¾ƒæ­£ç¡®çš„äº‹æƒ…ã€‚ An apparent infinite recursive loop æ˜æ˜¾çš„æ— é™è¿­ä»£å¾ªç¯,å°†å¯¼è‡´å †æ ˆæº¢å‡º. document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>IDEA</category>
        <category>æ’ä»¶</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
        <tag>æ’ä»¶</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è´£ä»»é“¾æ¨¡å¼]]></title>
    <url>%2Fposts%2Fb6c1490f.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibilityï¼‰ æ˜¯è¡Œä¸ºå‹è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œå…¶å°†é“¾ä¸­æ¯ä¸€ä¸ªèŠ‚ç‚¹çœ‹ä½œæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯ä¸ªèŠ‚ç‚¹å¤„ç†çš„è¯·æ±‚å‡ä¸åŒï¼Œä»è€Œé¿å…äº†è¯·æ±‚çš„å‘é€è€…å’Œæ¥æ”¶è€…ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼Œä¸”å†…éƒ¨è‡ªåŠ¨ç»´æŠ¤ä¸€ä¸ªä¸‹ä¸€èŠ‚ç‚¹å¯¹è±¡ã€‚å½“ä¸€ä¸ªè¯·æ±‚ä»é“¾å¼çš„é¦–ç«¯å‘å‡ºæ—¶ï¼Œä¼šæ²¿ç€é“¾çš„è·¯å¾„ä¾æ¬¡ä¼ é€’ç»™æ¯ä¸€ä¸ªèŠ‚ç‚¹å¯¹è±¡ï¼Œç›´è‡³æœ‰å¯¹è±¡å¤„ç†è¿™ä¸ªè¯·æ±‚ä¸ºæ­¢ã€‚ ä¸»è¦ä½œç”¨ è´£ä»»é“¾æ¨¡å¼ è§£è€¦äº†è¯·æ±‚ä¸å¤„ç†ï¼Œå®¢æˆ·åªéœ€å°†è¯·æ±‚å‘é€åˆ°é“¾ä¸Šå³å¯ï¼Œæ— éœ€å…³å¿ƒè¯·æ±‚çš„å…·ä½“å†…å®¹å’Œå¤„ç†ç»†èŠ‚ï¼Œè¯·æ±‚ä¼šè‡ªåŠ¨è¿›è¡Œä¼ é€’ç›´è‡³æœ‰èŠ‚ç‚¹å¯¹è±¡è¿›è¡Œå¤„ç†ã€‚ UMLç±»å›¾ è§’è‰² Handlerï¼ˆæŠ½è±¡å¤„ç†è€…ï¼‰ï¼šå®ƒå®šä¹‰äº†ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„æ¥å£ï¼Œä¸€èˆ¬è®¾è®¡ä¸ºæŠ½è±¡ç±»ï¼Œç”±äºä¸åŒçš„å…·ä½“å¤„ç†è€…å¤„ç†è¯·æ±‚çš„æ–¹å¼ä¸åŒï¼Œå› æ­¤åœ¨å…¶ä¸­å®šä¹‰äº†æŠ½è±¡è¯·æ±‚å¤„ç†æ–¹æ³•ã€‚å› ä¸ºæ¯ä¸€ä¸ªå¤„ç†è€…çš„ä¸‹å®¶è¿˜æ˜¯ä¸€ä¸ªå¤„ç†è€…ï¼Œå› æ­¤åœ¨æŠ½è±¡å¤„ç†è€…ä¸­å®šä¹‰äº†ä¸€ä¸ªæŠ½è±¡å¤„ç†è€…ç±»å‹çš„å¯¹è±¡ï¼Œä½œä¸ºå…¶å¯¹ä¸‹å®¶çš„å¼•ç”¨ã€‚é€šè¿‡è¯¥å¼•ç”¨ï¼Œå¤„ç†è€…å¯ä»¥è¿æˆä¸€æ¡é“¾ã€‚ ConcreteHandlerï¼ˆå…·ä½“å¤„ç†è€…ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡å¤„ç†è€…çš„å­ç±»ï¼Œå¯ä»¥å¤„ç†ç”¨æˆ·è¯·æ±‚ï¼Œåœ¨å…·ä½“å¤„ç†è€…ç±»ä¸­å®ç°äº†æŠ½è±¡å¤„ç†è€…ä¸­å®šä¹‰çš„æŠ½è±¡è¯·æ±‚å¤„ç†æ–¹æ³•ï¼Œåœ¨å¤„ç†è¯·æ±‚ä¹‹å‰éœ€è¦è¿›è¡Œåˆ¤æ–­ï¼Œçœ‹æ˜¯å¦æœ‰ç›¸åº”çš„å¤„ç†æƒé™ï¼Œå¦‚æœå¯ä»¥å¤„ç†è¯·æ±‚å°±å¤„ç†å®ƒï¼Œå¦åˆ™å°†è¯·æ±‚è½¬å‘ç»™åç»§è€…ï¼›åœ¨å…·ä½“å¤„ç†è€…ä¸­å¯ä»¥è®¿é—®é“¾ä¸­ä¸‹ä¸€ä¸ªå¯¹è±¡ï¼Œä»¥ä¾¿è¯·æ±‚çš„è½¬å‘ã€‚ æ¨¡å¼ä¼˜ç‚¹ å¯¹è±¡ä»…éœ€çŸ¥é“è¯¥è¯·æ±‚ä¼šè¢«å¤„ç†å³å¯ï¼Œä¸”é“¾ä¸­çš„å¯¹è±¡ä¸éœ€è¦çŸ¥é“é“¾çš„ç»“æ„ï¼Œç”±å®¢æˆ·ç«¯è´Ÿè´£é“¾çš„åˆ›å»ºï¼Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ è¯·æ±‚å¤„ç†å¯¹è±¡ä»…éœ€ç»´æŒä¸€ä¸ªæŒ‡å‘å…¶åç»§è€…çš„å¼•ç”¨ï¼Œè€Œä¸éœ€è¦ç»´æŒå®ƒå¯¹æ‰€æœ‰çš„å€™é€‰å¤„ç†è€…çš„å¼•ç”¨ï¼Œå¯ç®€åŒ–å¯¹è±¡çš„ç›¸äº’è¿æ¥ã€‚ é“¾è·¯ç»“æ„çµæ´»ï¼Œå¯ä»¥é€šè¿‡æ”¹å˜é“¾è·¯ç»“æ„åŠ¨æ€åœ°æ–°å¢æˆ–åˆ å‡è´£ä»»ã€‚ æ–°å¢ä¸€ä¸ªæ–°çš„å…·ä½“è¯·æ±‚å¤„ç†è€…æ—¶æ— é¡»ä¿®æ”¹åŸæœ‰ä»£ç ï¼Œåªéœ€è¦åœ¨å®¢æˆ·ç«¯é‡æ–°å»ºé“¾å³å¯ï¼Œç¬¦åˆ "å¼€é—­åŸåˆ™"ã€‚ æ¨¡å¼ç¼ºç‚¹ ä¸€ä¸ªè¯·æ±‚å¯èƒ½å› èŒè´£é“¾æ²¡æœ‰è¢«æ­£ç¡®é…ç½®è€Œå¾—ä¸åˆ°å¤„ç†ã€‚ å¯¹äºæ¯”è¾ƒé•¿çš„èŒè´£é“¾ï¼Œè¯·æ±‚çš„å¤„ç†å¯èƒ½æ¶‰åŠåˆ°å¤šä¸ªå¤„ç†å¯¹è±¡ï¼Œç³»ç»Ÿæ€§èƒ½å°†å—åˆ°ä¸€å®šå½±å“ï¼Œä¸”ä¸æ–¹ä¾¿è°ƒè¯•ã€‚ å¦‚æœèŠ‚ç‚¹å¯¹è±¡å­˜åœ¨å¾ªç¯å¼•ç”¨æ—¶ï¼Œä¼šé€ æˆæ­»å¾ªç¯ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒã€‚ é€‚ç”¨åœºæ™¯ æœ‰å¤šä¸ªå¯¹è±¡å¯ä»¥å¤„ç†åŒä¸€ä¸ªè¯·æ±‚ï¼Œå…·ä½“å“ªä¸ªå¯¹è±¡å¤„ç†è¯¥è¯·æ±‚å¾…è¿è¡Œæ—¶åˆ»å†ç¡®å®šï¼Œå®¢æˆ·ç«¯åªéœ€å°†è¯·æ±‚æäº¤åˆ°é“¾ä¸Šï¼Œè€Œæ— é¡»å…³å¿ƒè¯·æ±‚çš„å¤„ç†å¯¹è±¡æ˜¯è°ä»¥åŠå®ƒæ˜¯å¦‚ä½•å¤„ç†çš„ã€‚ åœ¨ä¸æ˜ç¡®æŒ‡å®šæ¥æ”¶è€…çš„æƒ…å†µä¸‹ï¼Œå‘å¤šä¸ªå¯¹è±¡ä¸­çš„ä¸€ä¸ªæäº¤ä¸€ä¸ªè¯·æ±‚ã€‚ å¯åŠ¨æ€æŒ‡å®šä¸€ç»„å¯¹è±¡å¤„ç†è¯·æ±‚ï¼Œå®¢æˆ·ç«¯å¯ä»¥åŠ¨æ€åˆ›å»ºèŒè´£é“¾æ¥å¤„ç†è¯·æ±‚ï¼Œè¿˜å¯ä»¥æ”¹å˜é“¾ä¸­å¤„ç†è€…ä¹‹é—´çš„å…ˆåæ¬¡åºã€‚ ä½¿ç”¨æ­¥éª¤ å®šä¹‰æŠ½è±¡å¤„ç†è€… 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®šä¹‰æŠ½è±¡å¤„ç†è€…--èŒè´£çš„æ¥å£ï¼Œä¹Ÿå°±æ˜¯å¤„ç†è¯·æ±‚çš„æ¥å£ */public abstract class Handler { /** * æŒæœ‰åç»§çš„èŒè´£å¯¹è±¡ */ protected Handler successor; /** * è®¾ç½®åç»§çš„èŒè´£å¯¹è±¡ * * @param successor åç»§çš„èŒè´£å¯¹è±¡ */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * ç¤ºæ„å¤„ç†è¯·æ±‚çš„æ–¹æ³•ï¼Œè™½ç„¶è¿™ä¸ªç¤ºæ„æ–¹æ³•æ˜¯æ²¡æœ‰ä¼ å…¥å‚æ•°ï¼Œ * ä½†å®é™…æ˜¯å¯ä»¥ä¼ å…¥å‚æ•°çš„ï¼Œæ ¹æ®å…·ä½“éœ€è¦æ¥é€‰æ‹©æ˜¯å¦ä¼ é€’å‚æ•° */ public abstract void handleRequest();} å®šä¹‰å…·ä½“å¤„ç†è€… 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®šä¹‰å…·ä½“å¤„ç†è€…--å…·ä½“çš„èŒè´£å¯¹è±¡ï¼Œç”¨æ¥å¤„ç†è¯·æ±‚ */public class ConcreteHandler1 extends Handler { @Override public void handleRequest() { //æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ //åˆ¤æ–­æ¡ä»¶æ¯”å¦‚ï¼šä»å¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œæˆ–è€…è¿™é‡Œä¸»åŠ¨å»è·å–çš„å¤–éƒ¨æ•°æ®ï¼Œ //å¦‚ä»æ•°æ®åº“ä¸­è·å–ç­‰ï¼Œä¸‹é¢è¿™å¥è¯åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = false; if (someCondition) { //å¦‚æœå±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ //å…·ä½“çš„å¤„ç†ä»£ç  System.out.println("å…·ä½“å¤„ç†è€…1 å¤„ç†è¯·æ±‚..."); } else { //å¦‚æœä¸å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åç»§çš„èŒè´£å¯¹è±¡ //å¦‚æœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åç»§çš„èŒè´£å¯¹è±¡ //å¦‚æœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (this.successor != null) { this.successor.handleRequest(); } } }}package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…2 */public class ConcreteHandler2 extends Handler { @Override public void handleRequest() { //æ ¹æ®æŸäº›æ¡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ //åˆ¤æ–­æ¡ä»¶æ¯”å¦‚ï¼šä»å¤–éƒ¨ä¼ å…¥çš„å‚æ•°ï¼Œæˆ–è€…è¿™é‡Œä¸»åŠ¨å»è·å–çš„å¤–éƒ¨æ•°æ®ï¼Œ //å¦‚ä»æ•°æ®åº“ä¸­è·å–ç­‰ï¼Œä¸‹é¢è¿™å¥è¯åªæ˜¯ä¸ªç¤ºæ„ boolean someCondition = true; if (someCondition) { //å¦‚æœå±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œå°±åœ¨è¿™é‡Œå¤„ç†è¯·æ±‚ //å…·ä½“çš„å¤„ç†ä»£ç  System.out.println("å…·ä½“å¤„ç†è€…2 å¤„ç†è¯·æ±‚..."); } else { //å¦‚æœä¸å±äºè‡ªå·±å¤„ç†çš„èŒè´£èŒƒå›´ï¼Œé‚£å°±åˆ¤æ–­æ˜¯å¦è¿˜æœ‰åç»§çš„èŒè´£å¯¹è±¡ //å¦‚æœæœ‰ï¼Œå°±è½¬å‘è¯·æ±‚ç»™åç»§çš„èŒè´£å¯¹è±¡ //å¦‚æœæ²¡æœ‰ï¼Œä»€ä¹ˆéƒ½ä¸åšï¼Œè‡ªç„¶ç»“æŸ if (this.successor != null) { this.successor.handleRequest(); } } }} å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617package main.java.com.study.designPatterns.chain.common;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new ConcreteHandler1(); Handler h2 = new ConcreteHandler2(); h1.setSuccessor(h2); //ç„¶åæäº¤è¯·æ±‚ h1.handleRequest(); }} æ¨¡å¼ç¤ºä¾‹ èƒŒæ™¯ å¾ˆå¤šå…¬å¸éƒ½æœ‰è¿™æ ·çš„ç¦åˆ©ï¼Œå°±æ˜¯é¡¹ç›®ç»„æˆ–è€…æ˜¯éƒ¨é—¨å¯ä»¥å‘å…¬å¸ç”³è¯·ä¸€äº›èšé¤è´¹ç”¨ï¼Œç”¨äºç»„ç»‡é¡¹ç›®ç»„æˆå‘˜æˆ–è€…æ˜¯éƒ¨é—¨æˆå‘˜è¿›è¡Œèšé¤æ´»åŠ¨ï¼Œä»¥å¢è¿›äººå‘˜ä¹‹é—´çš„æƒ…æ„Ÿï¼Œæ›´æœ‰åˆ©äºå·¥ä½œä¸­çš„ç›¸äº’åˆä½œã€‚ ç”³è¯·èšé¤è´¹ç”¨çš„å¤§è‡´æµç¨‹ä¸€èˆ¬æ˜¯ï¼šç”±ç”³è¯·äººå…ˆå¡«å†™ç”³è¯·å•ï¼Œç„¶åäº¤ç»™é¢†å¯¼å®¡æŸ¥ï¼Œå¦‚æœç”³è¯·æ‰¹å‡†ä¸‹æ¥äº†ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹é€šè¿‡ï¼Œç„¶åç”³è¯·äººå»è´¢åŠ¡æ ¸é¢†è´¹ç”¨ï¼Œå¦‚æœæ²¡æœ‰æ ¸å‡†ï¼Œé¢†å¯¼ä¼šé€šçŸ¥ç”³è¯·äººå®¡æ‰¹æœªé€šè¿‡ï¼Œæ­¤äº‹ä¹Ÿå°±æ­¤ä½œç½¢äº†ã€‚ ä¸åŒçº§åˆ«çš„é¢†å¯¼ï¼Œå¯¹äºå®¡æ‰¹çš„é¢åº¦æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ¯”å¦‚ï¼šé¡¹ç›®ç»ç†åªèƒ½å®¡æ‰¹500å…ƒä»¥å†…çš„ç”³è¯·ï¼›éƒ¨é—¨ç»ç†èƒ½å®¡æ‰¹1000å…ƒä»¥å†…çš„ç”³è¯·ï¼›è€Œæ€»ç»ç†å¯ä»¥å®¡æ ¸ä»»æ„é¢åº¦çš„ç”³è¯·ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åï¼Œè¯¥è¯·æ±‚ä¼šç”±é¡¹ç›®ç»ç†ã€éƒ¨é—¨ç»ç†ã€æ€»ç»ç†ä¹‹ä¸­çš„æŸä¸€ä½é¢†å¯¼æ¥è¿›è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†æ˜¯æå‡ºç”³è¯·çš„äººå¹¶ä¸çŸ¥é“æœ€ç»ˆä¼šç”±è°æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä¸€èˆ¬ç”³è¯·äººæ˜¯æŠŠè‡ªå·±çš„ç”³è¯·æäº¤ç»™é¡¹ç›®ç»ç†ï¼Œæˆ–è®¸æœ€åæ˜¯ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œä½†æ˜¯ç”³è¯·äººå¹¶ä¸çŸ¥é“åº”è¯¥ç”±æ€»ç»ç†æ¥å¤„ç†ä»–çš„ç”³è¯·è¯·æ±‚ã€‚ åˆ†æ å½“æŸäººæå‡ºèšé¤è´¹ç”¨ç”³è¯·çš„è¯·æ±‚åï¼Œè¯¥è¯·æ±‚ä¼šåœ¨é¡¹ç›®ç»ç†-éƒ¨é—¨ç»ç†-æ€»ç»ç†è¿™æ ·ä¸€æ¡é¢†å¯¼å¤„ç†é“¾ä¸Šè¿›è¡Œä¼ é€’ï¼Œå‘å‡ºè¯·æ±‚çš„äººå¹¶ä¸çŸ¥é“è°ä¼šæ¥å¤„ç†ä»–çš„è¯·æ±‚ï¼Œæ¯ä¸ªé¢†å¯¼ä¼šæ ¹æ®è‡ªå·±çš„èŒè´£èŒƒå›´ï¼Œæ¥åˆ¤æ–­æ˜¯å¤„ç†è¯·æ±‚è¿˜æ˜¯æŠŠè¯·æ±‚äº¤ç»™æ›´é«˜çº§çš„é¢†å¯¼ï¼Œåªè¦æœ‰é¢†å¯¼å¤„ç†äº†ï¼Œä¼ é€’å°±ç»“æŸäº†ã€‚ éœ€è¦æŠŠæ¯ä½é¢†å¯¼çš„å¤„ç†ç‹¬ç«‹å‡ºæ¥ï¼Œå®ç°æˆå•ç‹¬çš„èŒè´£å¤„ç†å¯¹è±¡ï¼Œç„¶åä¸ºå®ƒä»¬æä¾›ä¸€ä¸ªå…¬å…±çš„ã€æŠ½è±¡çš„çˆ¶èŒè´£å¯¹è±¡ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨å®¢æˆ·ç«¯æ¥åŠ¨æ€çš„ç»„åˆèŒè´£é“¾ï¼Œå®ç°ä¸åŒçš„åŠŸèƒ½è¦æ±‚äº†ã€‚ å…·ä½“ä»£ç  å®šä¹‰æŠ½è±¡å¤„ç†è€… 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æŠ½è±¡å¤„ç†è€…ç±»ï¼Œå®šä¹‰èŒè´£å¯¹è±¡ */public abstract class Handler { /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * å¤„ç†èšé¤è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param fee ç”³è¯·çš„é’±æ•° * @return æˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“é€šçŸ¥ */ public abstract String handleFeeRequest(String user, double fee);} å®šä¹‰å…·ä½“å¤„ç†è€… é¡¹ç›®ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (fee &lt; 500) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(user)) { str = "é¡¹ç›®ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return successor.handleFeeRequest(user, fee); } } return str; }} éƒ¨é—¨ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--éƒ¨é—¨ç»ç† */public class DepManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (fee &lt; 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æç”³è¯·çš„ if ("å°æ".equals(user)) { str = "éƒ¨é—¨ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handleFeeRequest(user, fee); } } return str; }} æ€»ç»ç†ï¼š 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--æ€»ç»ç† */public class GeneralManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (fee &gt;= 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(user)) { str = "æ€»ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //å¦‚æœè¿˜æœ‰åç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) { return successor.handleFeeRequest(user, fee); } } return str; }} å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client { public static void main(String[] args) { //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DepManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯• String ret1 = h3.handleFeeRequest("å°æ", 300); System.out.println("the ret1=" + ret1); String ret2 = h3.handleFeeRequest("å°å¼ ", 300); System.out.println("the ret2=" + ret2); String ret3 = h3.handleFeeRequest("å°æ", 600); System.out.println("the ret3=" + ret3); String ret4 = h3.handleFeeRequest("å°å¼ ", 600); System.out.println("the ret4=" + ret4); String ret5 = h3.handleFeeRequest("å°æ", 1200); System.out.println("the ret5=" + ret5); String ret6 = h3.handleFeeRequest("å°å¼ ", 1200); System.out.println("the ret6=" + ret6); }} æ‹“å±•-å¤„ç†å¤šç§è¯·æ±‚ ä¸Šé¢çš„ç¤ºä¾‹æ˜¯åŒä¸€ä¸ªèŒè´£é“¾å¤„ç†ä¸€ç§è¯·æ±‚çš„æƒ…å†µï¼Œç°åœ¨æœ‰è¿™æ ·çš„éœ€æ±‚ï¼Œè¿˜æ˜¯è´¹ç”¨ç”³è¯·çš„åŠŸèƒ½ï¼Œè¿™æ¬¡æ˜¯ç”³è¯·é¢„æ”¯å·®æ—…è´¹ï¼Œå‡è®¾è¿˜æ˜¯åŒä¸€æµç¨‹ï¼Œä¹Ÿå°±æ˜¯ç»„åˆåŒä¸€ä¸ªèŒè´£é“¾ï¼Œä»é¡¹ç›®ç»ç†-ä¼ é€’ç»™éƒ¨é—¨ç»ç†-ä¼ é€’ç»™æ€»ç»ç†ï¼Œè™½ç„¶æµç¨‹ç›¸åŒï¼Œä½†æ˜¯æ¯ä¸ªå¤„ç†ç±»éœ€è¦å¤„ç†ä¸¤ç§è¯·æ±‚ï¼Œå®ƒä»¬çš„å…·ä½“ä¸šåŠ¡é€»è¾‘æ˜¯ä¸ä¸€æ ·çš„ã€‚ ç®€å•çš„å¤„ç†æ–¹å¼ ç®€å•å¤„ç†æ–¹å¼å°±æ˜¯ä¸ºæ¯ç§ä¸šåŠ¡å•ç‹¬å®šä¹‰ä¸€ä¸ªæ–¹æ³•ï¼Œç„¶åå®¢æˆ·ç«¯æ ¹æ®ä¸åŒçš„éœ€è¦è°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚ ç›´æ¥æ”¹é€ ä¸Šé¢çš„ä»£ç ï¼Œè¿™é‡Œæ•…æ„æŠŠä¸¤ä¸ªæ–¹æ³•åšçš„æœ‰äº›ä¸ä¸€æ ·ï¼Œä¸€ä¸ªæ˜¯è¿”å›Stringç±»å‹çš„å€¼ï¼Œä¸€ä¸ªæ˜¯è¿”å›booleanç±»å‹çš„å€¼ï¼›ä¸€ä¸ªè¿”å›åˆ°å®¢æˆ·ç«¯å†è¾“å‡ºä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯ç›´æ¥åœ¨èŒè´£å¤„ç†é‡Œé¢å°±è¾“å‡ºä¿¡æ¯ã€‚ é¦–å…ˆæ˜¯æ”¹é€ èŒè´£å¯¹è±¡çš„æ¥å£ï¼Œæ·»åŠ ä¸Šæ–°çš„ä¸šåŠ¡æ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æŠ½è±¡å¤„ç†è€…ç±»ï¼Œå®šä¹‰èŒè´£å¯¹è±¡ */public abstract class Handler { /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * å¤„ç†èšé¤è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param fee ç”³è¯·çš„é’±æ•° * @return æˆåŠŸæˆ–å¤±è´¥çš„å…·ä½“é€šçŸ¥ */ public abstract String handleFeeRequest(String user, double fee); /** * å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨çš„ç”³è¯· * * @param user ç”³è¯·äºº * @param requestFee ç”³è¯·çš„é’±æ•° * @return æ˜¯å¦åŒæ„ */ public abstract boolean handlePreFeeRequest(String user, double requestFee);} èŒè´£çš„æ¥å£å‘ç”Ÿäº†æ”¹å˜ï¼Œå¯¹åº”çš„å¤„ç†ç±»ä¹Ÿè¦æ”¹å˜ï¼Œè¿™å‡ ä¸ªå¤„ç†ç±»æ˜¯ç±»ä¼¼çš„ï¼ŒåŸæœ‰çš„åŠŸèƒ½ä¸å˜ï¼Œç„¶ååœ¨æ–°çš„å®ç°æ–¹æ³•é‡Œé¢ï¼ŒåŒæ ·åˆ¤æ–­ä¸€ä¸‹æ˜¯å¦å±äºè‡ªå·±å¤„ç†çš„èŒƒå›´ï¼Œå¦‚æœå±äºè‡ªå·±å¤„ç†çš„èŒƒå›´é‚£å°±å¤„ç†ï¼Œå¦åˆ™å°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¤„ç†ã€‚ é¡¹ç›®ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (fee &lt; 500) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(user)) { str = "é¡¹ç›®ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return successor.handleFeeRequest(user, fee); } } return str; } @Override public boolean handlePreFeeRequest(String user, double requestNum) { //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨5000ä»¥å†… if (requestNum &lt; 5000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("é¡¹ç›®ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestNum + "å…ƒçš„è¯·æ±‚"); return true; } else { //è¶…è¿‡5000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handlePreFeeRequest(user, requestNum); } } return false; }} éƒ¨é—¨ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--éƒ¨é—¨ç»ç† */public class DepManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (fee &lt; 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æç”³è¯·çš„ if ("å°æ".equals(user)) { str = "éƒ¨é—¨ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handleFeeRequest(user, fee); } } return str; } @Override public boolean handlePreFeeRequest(String user, double requestFee) { //éƒ¨é—¨ç»ç†çš„æƒé™20000ä»¥å†… if (requestFee &lt; 20000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("éƒ¨é—¨ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestFee + "å…ƒçš„è¯·æ±‚"); return true; } else { //è¶…è¿‡20000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handlePreFeeRequest(user, requestFee); } } return false; }} æ€»ç»ç†ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: å…·ä½“å¤„ç†è€…--æ€»ç»ç† */public class GeneralManager extends Handler { @Override public String handleFeeRequest(String user, double fee) { String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (fee &gt;= 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(user)) { str = "æ€»ç»ç†åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + user + "èšé¤è´¹ç”¨" + fee + "å…ƒçš„è¯·æ±‚"; } return str; } else { //å¦‚æœè¿˜æœ‰åç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) { return successor.handleFeeRequest(user, fee); } } return str; } @Override public boolean handlePreFeeRequest(String user, double requestFee) { //æ€»ç»ç†çš„æƒé™50000ä»¥å†… if (requestFee &lt; 50000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("æ€»ç»ç†åŒæ„" + user + "é¢„æ”¯å·®æ—…è´¹ç”¨" + requestFee + "å…ƒçš„è¯·æ±‚"); return true; } else { //å¦‚æœè¿˜æœ‰åç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) { return this.successor.handlePreFeeRequest(user, requestFee); } } return false; }} å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.designPatterns.chain.demoTwo;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client { public static void main(String[] args) { //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DepManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ String ret1 = h3.handleFeeRequest("å°æ", 300); System.out.println("the ret1=" + ret1); String ret2 = h3.handleFeeRequest("å°å¼ ", 300); System.out.println("the ret2=" + ret2); String ret3 = h3.handleFeeRequest("å°æ", 600); System.out.println("the ret3=" + ret3); String ret4 = h3.handleFeeRequest("å°å¼ ", 600); System.out.println("the ret4=" + ret4); String ret5 = h3.handleFeeRequest("å°æ", 1200); System.out.println("the ret5=" + ret5); String ret6 = h3.handleFeeRequest("å°å¼ ", 1200); System.out.println("the ret6=" + ret6); //å¼€å§‹æµ‹è¯•ç”³è¯·å·®æ—…è´¹ç”¨ h3.handlePreFeeRequest("å°å¼ ", 3000); h3.handlePreFeeRequest("å°å¼ ", 6000); h3.handlePreFeeRequest("å°å¼ ", 32000); }} é€šç”¨è¯·æ±‚å¤„ç†æ–¹å¼ ç®€å•å¤„ç†æ–¹å¼å®ç°èµ·æ¥å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªæ˜æ˜¾çš„é—®é¢˜å°±æ˜¯åªè¦å¢åŠ ä¸€ä¸ªä¸šåŠ¡ï¼Œå°±éœ€è¦ä¿®æ”¹èŒè´£çš„æ¥å£ï¼Œè¿™æ˜¯å¾ˆä¸çµæ´»çš„ï¼ŒJavaå¼€å‘ä¸­å¾ˆå¼ºè°ƒé¢å‘æ¥å£ç¼–ç¨‹ï¼Œå› æ­¤æ¥å£åº”è¯¥ç›¸å¯¹ä¿æŒç¨³å®šï¼Œæ¥å£ä¸€æ”¹ï¼Œéœ€è¦ä¿®æ”¹çš„åœ°æ–¹å°±å¤ªå¤šäº†ï¼Œé¢‘ç¹ä¿®æ”¹æ¥å£ç»å¯¹ä¸æ˜¯ä¸ªå¥½ä¸»æ„ã€‚æ‰€ä»¥æ”¹é€ å¦‚ä¸‹ï¼š é¦–å…ˆå®šä¹‰ä¸€å¥—é€šç”¨çš„è°ƒç”¨æ¡†æ¶ï¼Œç”¨ä¸€ä¸ªé€šç”¨çš„è¯·æ±‚å¯¹è±¡æ¥å°è£…è¯·æ±‚ä¼ é€’çš„å‚æ•°ï¼› ç„¶åå®šä¹‰ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸å»åŒºåˆ†å…·ä½“ä¸šåŠ¡ï¼Œæ‰€æœ‰çš„ä¸šåŠ¡éƒ½æ˜¯è¿™ä¸€ä¸ªæ–¹æ³•ï¼Œåœ¨é€šç”¨çš„è¯·æ±‚å¯¹è±¡é‡Œé¢ä¼šæœ‰ä¸€ä¸ªä¸šåŠ¡çš„æ ‡è®°è¿›è¡Œä¸šåŠ¡åŒºåˆ†ï¼› åˆ°äº†èŒè´£å¯¹è±¡é‡Œé¢ï¼Œæ„¿æ„å¤„ç†å°±è·ŸåŸæ¥ä¸€æ ·çš„å¤„ç†æ–¹å¼ï¼Œå¦‚æœä¸æ„¿æ„å¤„ç†ï¼Œå°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡å°±å¥½äº†ã€‚ å¯¹äºè¿”å›å€¼ä¹Ÿå¯ä»¥æ¥ä¸ªé€šç”¨çš„ï¼Œæœ€ç®€å•çš„å°±æ˜¯ä½¿ç”¨Objectç±»å‹ã€‚ å…·ä½“ä»£ç  é€šç”¨çš„è¯·æ±‚å¯¹è±¡çš„å®šä¹‰ 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é€šç”¨çš„è¯·æ±‚å¯¹è±¡ */public class RequestModel { /** * è¡¨ç¤ºå…·ä½“çš„ä¸šåŠ¡ç±»å‹ */ private String type; /** * é€šè¿‡æ„é€ æ–¹æ³•æŠŠå…·ä½“çš„ä¸šåŠ¡ç±»å‹ä¼ é€’è¿›æ¥ * * @param type å…·ä½“çš„ä¸šåŠ¡ç±»å‹ */ public RequestModel(String type) { this.type = type; } public String getType() { return type; }} æ­¤æ—¶çš„é€šç”¨èŒè´£å¤„ç†å¯¹è±¡ï¼Œåœ¨è¿™é‡Œè¦å®ç°ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ¡†æ¶ 1234567891011121314151617181920212223242526272829303132333435363738package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é€šç”¨èŒè´£å¤„ç†å¯¹è±¡ï¼Œåœ¨è¿™é‡Œè¦å®ç°ä¸€ä¸ªé€šç”¨çš„è°ƒç”¨æ¡†æ¶ */public abstract class Handler { /** * æŒæœ‰ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ protected Handler successor = null; /** * è®¾ç½®ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ * * @param successor ä¸‹ä¸€ä¸ªå¤„ç†è¯·æ±‚çš„å¯¹è±¡ */ public void setSuccessor(Handler successor) { this.successor = successor; } /** * é€šç”¨çš„è¯·æ±‚å¤„ç†æ–¹æ³• * * @param rm é€šç”¨çš„è¯·æ±‚å¯¹è±¡ * @return å¤„ç†åéœ€è¦è¿”å›çš„å¯¹è±¡ */ public Object handleRequest(RequestModel rm) { if (successor != null) { //è¿™ä¸ªæ˜¯é»˜è®¤çš„å®ç°ï¼Œå¦‚æœå­ç±»ä¸æ„¿æ„å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œ //é‚£å°±ä¼ é€’åˆ°ä¸‹ä¸€ä¸ªèŒè´£å¯¹è±¡å»å¤„ç† return this.successor.handleRequest(rm); } else { System.out.println("æ²¡æœ‰åç»­å¤„ç†æˆ–è€…æš‚æ—¶ä¸æ”¯æŒè¿™æ ·çš„åŠŸèƒ½å¤„ç†"); return false; } }} ç°åœ¨æ¥åŠ ä¸Šç¬¬ä¸€ä¸ªä¸šåŠ¡ï¼Œå°±æ˜¯â€œèšé¤è´¹ç”¨ç”³è¯·â€çš„å¤„ç†ï¼Œä¸ºäº†æè¿°å…·ä½“çš„ä¸šåŠ¡æ•°æ®ï¼Œéœ€è¦æ‰©å±•é€šç”¨çš„è¯·æ±‚å¯¹è±¡ï¼ŒæŠŠä¸šåŠ¡æ•°æ®å°è£…è¿›å»ï¼Œå¦å¤–å®šä¹‰ä¸€ä¸ªè¯·æ±‚å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å…·ä½“çš„ä¸šåŠ¡è¯·æ±‚å¯¹è±¡--èšé¤è´¹ç”¨ç”³è¯· */public class FeeRequestModel extends RequestModel { /** * çº¦å®šå…·ä½“çš„ä¸šåŠ¡ç±»å‹ */ public final static String FEE_TYPE = "fee"; public FeeRequestModel() { super(FEE_TYPE); } /** * ç”³è¯·äºº */ private String user; /** * ç”³è¯·é‡‘é¢ */ private double fee; public String getUser() { return user; } public void setUser(String user) { this.user = user; } public double getFee() { return fee; } public void setFee(double fee) { this.fee = fee; }} æ¥ä¸‹æ¥è¯¥å®ç°èŒè´£å¯¹è±¡çš„å¤„ç†äº†ï¼Œé¦–å…ˆè¦è¦†ç›–çˆ¶ç±»çš„é€šç”¨ä¸šåŠ¡å¤„ç†æ–¹æ³•ï¼Œç„¶ååœ¨é‡Œé¢å¤„ç†è‡ªå·±æƒ³è¦å®ç°çš„ä¸šåŠ¡ï¼Œä¸æƒ³å¤„ç†çš„å°±è®©çˆ¶ç±»å»å¤„ç†ï¼Œçˆ¶ç±»ä¼šé»˜è®¤çš„ä¼ é€’ç»™ä¸‹ä¸€ä¸ªå¤„ç†å¯¹è±¡ã€‚ é¡¹ç›®ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å…·ä½“çš„èŒè´£å¯¹è±¡--é¡¹ç›®ç»ç† */public class ProjectManager extends Handler { @Override public Object handleRequest(RequestModel rm) { if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); } else { //å…¶å®ƒçš„é¡¹ç›®ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); } } /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨500ä»¥å†… if (frm.getFee() &lt; 500) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(frm.getUser())) { str = "é¡¹ç›®ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "é¡¹ç›®ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡500ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return successor.handleRequest(rm); } } return str; }} éƒ¨é—¨ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: éƒ¨é—¨ç»ç† */public class DeptManager extends Handler { @Override public Object handleRequest(RequestModel rm) { if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); } else { //å…¶å®ƒçš„éƒ¨é—¨ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); } } /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //éƒ¨é—¨ç»ç†çš„æƒé™åªèƒ½åœ¨1000ä»¥å†… if (frm.getFee() &lt; 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(frm.getUser())) { str = "éƒ¨é—¨ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "éƒ¨é—¨ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } return str; } else { //è¶…è¿‡1000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return successor.handleRequest(rm); } } return str; }} æ€»ç»ç†ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: æ€»ç»ç† */public class GeneralManager extends Handler { @Override public Object handleRequest(RequestModel rm) { if (FeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºèšé¤è´¹ç”¨ç”³è¯· return handleFeeRequest(rm); } else { //å…¶å®ƒçš„æ€»ç»ç†æš‚æ—¶ä¸æƒ³å¤„ç† return super.handleRequest(rm); } } /** * èšé¤è´¹ç”¨å¤„ç† * * @param rm * @return */ private Object handleFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ FeeRequestModel frm = (FeeRequestModel) rm; String str = ""; //æ€»ç»ç†çš„æƒé™å¾ˆå¤§ï¼Œåªè¦è¯·æ±‚åˆ°äº†è¿™é‡Œï¼Œä»–éƒ½å¯ä»¥å¤„ç† if (frm.getFee() &gt;= 1000) { //ä¸ºäº†æµ‹è¯•ï¼Œç®€å•ç‚¹ï¼ŒåªåŒæ„å°æçš„ if ("å°æ".equals(frm.getUser())) { str = "æ€»ç»ç†åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } else { //å…¶å®ƒäººä¸€å¾‹ä¸åŒæ„ str = "æ€»ç»ç†ä¸åŒæ„" + frm.getUser() + "èšé¤è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"; } return str; } else { //å¦‚æœè¿˜æœ‰åç»§çš„å¤„ç†å¯¹è±¡ï¼Œç»§ç»­ä¼ é€’ if (this.successor != null) { return successor.handleRequest(rm); } } return str; }} å¯¹äºå®¢æˆ·ç«¯ï¼Œå”¯ä¸€çš„éº»çƒ¦æ˜¯éœ€è¦çŸ¥é“æ¯ä¸ªä¸šåŠ¡å¯¹åº”çš„å…·ä½“çš„è¯·æ±‚å¯¹è±¡ï¼Œå› ä¸ºè¦å°è£…ä¸šåŠ¡æ•°æ®è¿›å». 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager(); Handler h2 = new DeptManager(); Handler h3 = new ProjectManager(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ FeeRequestModel frm = new FeeRequestModel(); frm.setFee(300); frm.setUser("å°æ"); //è°ƒç”¨å¤„ç† String ret1 = (String) h3.handleRequest(frm); System.out.println("ret1=" + ret1); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(800); h3.handleRequest(frm); String ret2 = (String) h3.handleRequest(frm); System.out.println("ret2=" + ret2); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(1600); h3.handleRequest(frm); String ret3 = (String) h3.handleRequest(frm); System.out.println("ret3=" + ret3); }} æ¥ä¸‹æ¥çœ‹çœ‹å¦‚ä½•åœ¨ä¸æ”¹åŠ¨ç°æœ‰çš„æ¡†æ¶çš„å‰æä¸‹ï¼Œæ‰©å±•æ–°çš„ä¸šåŠ¡ï¼Œè¿™æ ·æ‰èƒ½è¯´æ˜è¿™ç§è®¾è®¡çš„çµæ´»æ€§ã€‚ å‡å¦‚å°±æ˜¯è¦å®ç°ä¸Šé¢ç¤ºä¾‹è¿‡çš„å¦å¤–ä¸€ä¸ªåŠŸèƒ½â€œé¢„æ”¯å·®æ—…è´¹ç”³è¯·â€ã€‚è¦æƒ³æ‰©å±•æ–°çš„ä¸šåŠ¡ï¼Œç¬¬ä¸€æ­¥å°±æ˜¯æ–°å»ºä¸€ä¸ªå°è£…ä¸šåŠ¡æ•°æ®çš„å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132333435363738394041package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: é¢„æ”¯å·®æ—…è´¹ç”¨è¯·æ±‚å¯¹è±¡ */public class PreFeeRequestModel extends RequestModel { /** * çº¦å®šå…·ä½“çš„ä¸šåŠ¡ç±»å‹ */ public final static String FEE_TYPE = "preFee"; public PreFeeRequestModel() { super(FEE_TYPE); } /** * ç”³è¯·äºº */ private String user; /** * ç”³è¯·é‡‘é¢ */ private double fee; public String getUser() { return user; } public void setUser(String user) { this.user = user; } public double getFee() { return fee; } public void setFee(double fee) { this.fee = fee; }} å¯¹äºå…·ä½“è¿›è¡ŒèŒè´£å¤„ç†çš„ç±»ï¼Œæ¯”è¾ƒå¥½çš„æ–¹å¼å°±æ˜¯æ‰©å±•å‡ºå­ç±»æ¥ï¼Œç„¶ååœ¨å­ç±»é‡Œé¢å®ç°æ–°åŠ å…¥çš„ä¸šåŠ¡ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ç›´æ¥åœ¨åŸæ¥çš„å¯¹è±¡ä¸Šæ”¹ã€‚è¿™é‡Œé‡‡ç”¨æ‰©å±•å‡ºå­ç±»çš„æ–¹å¼ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®ç°ä¸ºé¡¹ç›®ç»ç†å¢åŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * ç°åœ¨çš„é¡¹ç›®ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class ProjectManager2 extends ProjectManager { @Override public Object handleRequest(RequestModel rm) { if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); } else { //å…¶å®ƒçš„è®©çˆ¶ç±»å»å¤„ç† return super.handleRequest(rm); } } /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //é¡¹ç›®ç»ç†çš„æƒé™æ¯”è¾ƒå°ï¼Œåªèƒ½åœ¨5000ä»¥å†… if (frm.getFee() &lt; 5000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("é¡¹ç›®ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; } else { //è¶…è¿‡5000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handleRequest(rm); } } return false; }} 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®ç°ä¸ºéƒ¨é—¨ç»ç†å¢åŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * ç°åœ¨çš„éƒ¨é—¨ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class DeptManager2 extends ProjectManager { @Override public Object handleRequest(RequestModel rm) { if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); } else { //å…¶å®ƒçš„è®©çˆ¶ç±»å»å¤„ç† return super.handleRequest(rm); } } /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //éƒ¨é—¨ç»ç†çš„æƒé™åœ¨20000ä»¥å†… if (frm.getFee() &lt; 20000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("éƒ¨é—¨ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; } else { //è¶…è¿‡20000ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handleRequest(rm); } } return false; }} 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: å®ç°ä¸ºæ€»ç»ç†å¢åŠ é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯·å¤„ç†çš„åŠŸèƒ½çš„å­å¯¹è±¡ï¼Œ * ç°åœ¨çš„æ€»ç»ç†æ—¢å¯ä»¥å¤„ç†èšé¤è´¹ç”¨ç”³è¯·ï¼Œåˆå¯ä»¥å¤„ç†é¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· */public class GeneralManager2 extends ProjectManager { @Override public Object handleRequest(RequestModel rm) { if (PreFeeRequestModel.FEE_TYPE.equals(rm.getType())) { //è¡¨ç¤ºé¢„æ”¯å·®æ—…è´¹ç”¨ç”³è¯· return handlePreFeeRequest(rm); } else { //å…¶å®ƒçš„è®©çˆ¶ç±»å»å¤„ç† return super.handleRequest(rm); } } /** * é¢„æ”¯å·®æ—…è´¹ç”¨ * * @param rm * @return */ private Object handlePreFeeRequest(RequestModel rm) { //å…ˆæŠŠé€šç”¨çš„å¯¹è±¡é€ å‹å›æ¥ PreFeeRequestModel frm = (PreFeeRequestModel) rm; //æ€»ç»ç†çš„æƒé™åœ¨20000ä»¥å†… if (frm.getFee() &gt;= 20000) { //å·¥ä½œéœ€è¦å˜›ï¼Œç»Ÿç»ŸåŒæ„ System.out.println("æ€»ç»ç†åŒæ„" + frm.getUser() + "é¢„æ”¯å·®æ—…è´¹ç”¨" + frm.getFee() + "å…ƒçš„è¯·æ±‚"); return true; } else { //å¦‚æœè¿˜æœ‰åç»­ï¼Œç»§ç»­ä¼ é€’ç»™çº§åˆ«æ›´é«˜çš„äººå¤„ç† if (this.successor != null) { return this.successor.handleRequest(rm); } } return false; }} æ­¤æ—¶çš„æµ‹è¯•ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package main.java.com.study.designPatterns.chain.demoTwo.upgrade;/** * @author: whb * @description: æ‹“å±•åçš„æµ‹è¯•ç±» */public class Client2 { public static void main(String[] args) { //å…ˆè¦ç»„è£…èŒè´£é“¾ Handler h1 = new GeneralManager2(); Handler h2 = new DeptManager2(); Handler h3 = new ProjectManager2(); h3.setSuccessor(h2); h2.setSuccessor(h1); //å¼€å§‹æµ‹è¯•ç”³è¯·èšé¤è´¹ç”¨ FeeRequestModel frm = new FeeRequestModel(); frm.setFee(300); frm.setUser("å°æ"); //è°ƒç”¨å¤„ç† String ret1 = (String) h3.handleRequest(frm); System.out.println("ret1=" + ret1); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(800); h3.handleRequest(frm); String ret2 = (String) h3.handleRequest(frm); System.out.println("ret2=" + ret2); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† frm.setFee(1600); h3.handleRequest(frm); String ret3 = (String) h3.handleRequest(frm); System.out.println("ret3=" + ret3); //å¼€å§‹æµ‹è¯•ç”³è¯·é¢„æ”¯å·®æ—…è´¹ç”¨ PreFeeRequestModel pfrm = new PreFeeRequestModel(); pfrm.setFee(3000); pfrm.setUser("å°å¼ "); //è°ƒç”¨å¤„ç† h3.handleRequest(pfrm); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† pfrm.setFee(6000); h3.handleRequest(pfrm); //é‡æ–°è®¾ç½®ç”³è¯·é‡‘é¢ï¼Œå†è°ƒç”¨å¤„ç† pfrm.setFee(36000); h3.handleRequest(pfrm); }} æ€»ç»“ è¿™ç§è®¾è®¡æ–¹å¼çš„å¥½å¤„ï¼Œç›¸å½“çš„é€šç”¨å’Œçµæ´»ï¼Œæœ‰äº†æ–°ä¸šåŠ¡ï¼Œåªéœ€è¦æ·»åŠ å®ç°æ–°åŠŸèƒ½çš„å¯¹è±¡å°±å¯ä»¥äº†ï¼Œä½†æ˜¯å¸¦æ¥çš„ç¼ºé™·å°±æ˜¯å¯èƒ½ä¼šé€ æˆå¯¹è±¡å±‚æ¬¡è¿‡å¤šï¼Œæˆ–è€…å‡ºç°è¾ƒå¤šçš„ç»†ç²’åº¦çš„å¯¹è±¡ï¼Œæç«¯æƒ…å†µä¸‹ï¼Œæ¯æ¬¡å°±æ‰©å±•ä¸€ä¸ªæ–¹æ³•ï¼Œä¼šå‡ºç°å¤§é‡åªå¤„ç†ä¸€ä¸ªåŠŸèƒ½çš„ç»†ç²’åº¦å¯¹è±¡ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-é€‚é…å™¨æ¨¡å¼]]></title>
    <url>%2Fposts%2F210c1e9b.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œï¼Œå…¶åˆ«åä¸ºåŒ…è£…å™¨(Wrapper)ã€‚ é€‚é…å™¨æ¨¡å¼æ—¢å¯ä»¥ä½œä¸ºç±»ç»“æ„å‹æ¨¡å¼ï¼Œä¹Ÿå¯ä»¥ä½œä¸ºå¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚ ä¸»è¦ä½œç”¨ æä¾›ä¸€ä¸ªè½¬æ¢å™¨ï¼ˆé€‚é…å™¨ï¼‰ï¼Œå°†å½“å‰ç³»ç»Ÿå­˜åœ¨çš„ä¸€ä¸ªå¯¹è±¡è½¬åŒ–ä¸ºå®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®çš„æ¥å£å¯¹è±¡ã€‚ æ¨¡å¼åˆ†ç±» æ ¹æ®é€‚é…å™¨ç±»ä¸é€‚é…è€…ç±»çš„å…³ç³»ä¸åŒï¼Œé€‚é…å™¨æ¨¡å¼å¯åˆ†ä¸ºå¯¹è±¡é€‚é…å™¨å’Œç±»é€‚é…å™¨ä¸¤ç§ã€‚ åœ¨å¯¹è±¡é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸é€‚é…è€…ä¹‹é—´æ˜¯å…³è”å…³ç³»ï¼› åœ¨ç±»é€‚é…å™¨æ¨¡å¼ä¸­ï¼Œé€‚é…å™¨ä¸é€‚é…è€…ä¹‹é—´æ˜¯ç»§æ‰¿ï¼ˆæˆ–å®ç°ï¼‰å…³ç³»ã€‚ æ¨¡å¼è§’è‰² Targetï¼ˆç›®æ ‡æŠ½è±¡ç±»ï¼‰ï¼šç›®æ ‡æŠ½è±¡ç±»å®šä¹‰å®¢æˆ·æ‰€éœ€æ¥å£ï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»æˆ–æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“ç±»ã€‚ Adapteeï¼ˆé€‚é…è€…ç±»ï¼‰ï¼šé€‚é…è€…å³è¢«é€‚é…çš„è§’è‰²ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ¥å£ï¼Œè¿™ä¸ªæ¥å£éœ€è¦é€‚é…ï¼Œé€‚é…è€…ç±»ä¸€èˆ¬æ˜¯ä¸€ä¸ªå…·ä½“ç±»ï¼ŒåŒ…å«äº†å®¢æˆ·å¸Œæœ›ä½¿ç”¨çš„ä¸šåŠ¡æ–¹æ³•ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å¯èƒ½æ²¡æœ‰é€‚é…è€…ç±»çš„æºä»£ç ã€‚ Adapterï¼ˆé€‚é…å™¨ç±»ï¼‰ï¼šé€‚é…å™¨å¯ä»¥è°ƒç”¨å¦ä¸€ä¸ªæ¥å£ï¼Œä½œä¸ºä¸€ä¸ªè½¬æ¢å™¨ï¼Œå¯¹Adapteeå’ŒTargetè¿›è¡Œé€‚é…ï¼Œé€‚é…å™¨ç±»æ˜¯é€‚é…å™¨æ¨¡å¼çš„æ ¸å¿ƒï¼Œåœ¨å¯¹è±¡é€‚é…å™¨ä¸­ï¼Œå®ƒé€šè¿‡ç»§æ‰¿Targetå¹¶å…³è”ä¸€ä¸ªAdapteeå¯¹è±¡ä½¿äºŒè€…äº§ç”Ÿè”ç³»ã€‚ ä¸‰ç§è§’è‰²ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š å‡è®¾å½“å‰ç³»ç»Ÿä¸­ï¼Œå®¢æˆ·ç«¯éœ€è¦è®¿é—®çš„æ˜¯ Target æ¥å£ï¼Œä½† Target æ¥å£æ²¡æœ‰ä¸€ä¸ªå®ä¾‹ç¬¦åˆéœ€æ±‚ï¼Œè€Œ Adaptee å®ä¾‹ç¬¦åˆéœ€æ±‚ï¼›ä½†æ˜¯å®¢æˆ·ç«¯æ— æ³•ç›´æ¥ä½¿ç”¨ Adapteeï¼ˆæ¥å£ä¸å…¼å®¹ï¼‰ï¼›å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€‚é…å™¨ï¼ˆAdapterï¼‰æ¥è¿›è¡Œä¸­è½¬ï¼Œè®© Adaptee èƒ½è½¬åŒ–ä¸º Target æ¥å£å½¢å¼ï¼› æ¨¡å¼è§£æ ç±»é€‚é…å™¨ åŸç† é€šè¿‡ç»§æ‰¿æ¥å®ç°é€‚é…å™¨åŠŸèƒ½ã€‚ å…·ä½“åšæ³• è®© Adapter å®ç° Target æ¥å£ï¼Œå¹¶ä¸”ç»§æ‰¿ Adapteeï¼Œè¿™æ · Adapter å°±å…·å¤‡ Target å’Œ Adaptee çš„ç‰¹æ€§ï¼Œå°±å¯ä»¥å°†ä¸¤è€…è¿›è¡Œè½¬åŒ–ï¼› UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºTargetæ¥å£ 123456789101112package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: ç›®æ ‡ç±» */public interface Target { /** * è¿™æ˜¯æºç±»Adapteeeæ²¡æœ‰çš„æ–¹æ³• */ public void request();} åˆ›å»ºæºç±»ï¼ˆAdapteeï¼‰ 1234567891011121314package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: æºç±» */public class Adaptee { /** * éœ€è¦é€‚é…çš„æ¥å£ */ public void specificRequest() { System.out.println("éœ€è¦é€‚é…çš„æ¥å£..."); }} åˆ›å»ºé€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ 123456789101112131415161718package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: é€‚é…å™¨Adapterç»§æ‰¿è‡ªAdapteeï¼ŒåŒæ—¶åˆå®ç°äº†ç›®æ ‡(Target)æ¥å£ã€‚ */public class Adapter extends Adaptee implements Target { /** * ç›®æ ‡æ¥å£è¦æ±‚è°ƒç”¨request()è¿™ä¸ªæ–¹æ³•åï¼Œä½†æºç±»Adapteeæ²¡æœ‰æ–¹æ³•request()ï¼Œ * å› æ­¤é€‚é…å™¨è¡¥å……ä¸Šè¿™ä¸ªæ–¹æ³•åã€‚ * ä½†å®é™…ä¸Šrequest()åªæ˜¯è°ƒç”¨æºç±»Adapteeçš„specificRequest()æ–¹æ³•çš„å†…å®¹ï¼Œ * æ‰€ä»¥é€‚é…å™¨åªæ˜¯å°†specificRequest()æ–¹æ³•ä½œäº†ä¸€å±‚å°è£…ï¼Œå°è£…æˆTargetå¯ä»¥è°ƒç”¨çš„request()è€Œå·²ã€‚ */ @Override public void request() { this.specificRequest(); }} å®šä¹‰å…·ä½“ä½¿ç”¨ç›®æ ‡ç±» 123456789101112package main.java.com.study.designPatterns.adapter.classAdapter.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±»é€‚é…å™¨ */public class TestClassAdapter { public static void main(String[] args) { Target mAdapter = new Adapter(); mAdapter.request(); }} å¯¹è±¡é€‚é…å™¨ åŸç† é€šè¿‡ç»„åˆæ¥å®ç°é€‚é…å™¨åŠŸèƒ½ã€‚ å…·ä½“åšæ³• è®© Adapter å®ç° Target æ¥å£ï¼Œç„¶åå†…éƒ¨æŒæœ‰ Adaptee å®ä¾‹ï¼Œç„¶åå† Target æ¥å£è§„å®šçš„æ–¹æ³•å†…è½¬æ¢ Adaptee ã€‚ UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºTargetæ¥å£ 123456789101112package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: ç›®æ ‡ç±» */public interface Target { /** * è¿™æ˜¯æºç±»Adapteeeæ²¡æœ‰çš„æ–¹æ³• */ void request();} åˆ›å»ºæºç±»ï¼ˆAdapteeï¼‰ 1234567891011121314package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: æºç±» */public class Adaptee { /** * éœ€è¦é€‚é…çš„æ¥å£ */ public void specificRequest() { System.out.println("éœ€è¦é€‚é…çš„æ¥å£..."); }} åˆ›å»ºé€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: é€‚é…å™¨ç±»ï¼ˆAdapterï¼‰ï¼ˆä¸é€‚ç”¨ç»§æ‰¿è€Œæ˜¯å§”æ´¾ï¼‰ */public class Adapter implements Target { /** * ç›´æ¥å…³è”è¢«é€‚é…ç±» */ private Adaptee adaptee; /** * å¯ä»¥é€šè¿‡æ„é€ å‡½æ•°ä¼ å…¥å…·ä½“éœ€è¦é€‚é…çš„è¢«é€‚é…ç±»å¯¹è±¡ */ public Adapter(Adaptee adaptee) { this.adaptee = adaptee; } @Override public void request() { //è¿™é‡Œä½¿ç”¨å§”æ‰˜çš„æ–¹å¼å®Œæˆé€‚é… this.adaptee.specificRequest(); }} å®šä¹‰å…·ä½“ä½¿ç”¨ç›®æ ‡ç±» 1234567891011121314package main.java.com.study.designPatterns.adapter.objectAdapter.demoOne;/** * @author: whb * @description: æµ‹è¯•å¯¹è±¡é€‚é… */public class TestObjectAdapter { public static void main(String[] args) { //éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªè¢«é€‚é…ç±»çš„å¯¹è±¡ä½œä¸ºå‚æ•° Target mAdapter = new Adapter(new Adaptee()); mAdapter.request(); }} ä¼˜ç¼ºç‚¹ é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ å°†ç›®æ ‡ç±»å’Œé€‚é…è€…ç±»è§£è€¦ï¼Œé€šè¿‡å¼•å…¥ä¸€ä¸ªé€‚é…å™¨ç±»æ¥é‡ç”¨ç°æœ‰çš„é€‚é…è€…ç±»ï¼Œæ— é¡»ä¿®æ”¹åŸæœ‰ç»“æ„ã€‚ å¢åŠ äº†ç±»çš„é€æ˜æ€§å’Œå¤ç”¨æ€§ï¼Œå°†å…·ä½“çš„ä¸šåŠ¡å®ç°è¿‡ç¨‹å°è£…åœ¨é€‚é…è€…ç±»ä¸­ï¼Œå¯¹äºå®¢æˆ·ç«¯ç±»è€Œè¨€æ˜¯é€æ˜çš„ï¼Œè€Œä¸”æé«˜äº†é€‚é…è€…çš„å¤ç”¨æ€§ï¼ŒåŒä¸€ä¸ªé€‚é…è€…ç±»å¯ä»¥åœ¨å¤šä¸ªä¸åŒçš„ç³»ç»Ÿä¸­å¤ç”¨ã€‚ çµæ´»æ€§å’Œæ‰©å±•æ€§éƒ½éå¸¸å¥½ï¼Œé€šè¿‡ä½¿ç”¨é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›´æ¢é€‚é…å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ä»£ç çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„é€‚é…å™¨ç±»ï¼Œå®Œå…¨ç¬¦åˆâ€œå¼€é—­åŸåˆ™â€ã€‚ ç¼ºç‚¹ è¿‡å¤šçš„ä½¿ç”¨é€‚é…å™¨ï¼Œä¼šè®©ç³»ç»Ÿéå¸¸é›¶ä¹±ï¼Œä¸æ˜“æ•´ä½“è¿›è¡ŒæŠŠæ¡ã€‚ ç±»çš„é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ ç”±äºé€‚é…å™¨ç±»æ˜¯é€‚é…è€…ç±»çš„å­ç±»ï¼Œå› æ­¤å¯ä»¥åœ¨é€‚é…å™¨ç±»ä¸­ç½®æ¢ä¸€äº›é€‚é…è€…çš„æ–¹æ³•ï¼Œä½¿å¾—é€‚é…å™¨çš„çµæ´»æ€§æ›´å¼ºã€‚ ç¼ºç‚¹ å¯¹äºJavaç­‰ä¸æ”¯æŒå¤šé‡ç±»ç»§æ‰¿çš„è¯­è¨€ï¼Œä¸€æ¬¡æœ€å¤šåªèƒ½é€‚é…ä¸€ä¸ªé€‚é…è€…ç±»ï¼Œä¸èƒ½åŒæ—¶é€‚é…å¤šä¸ªé€‚é…è€…ï¼› é€‚é…è€…ç±»ä¸èƒ½ä¸ºæœ€ç»ˆç±»ï¼Œå¦‚åœ¨Javaä¸­ä¸èƒ½ä¸ºfinalç±»ï¼› åœ¨Javaç­‰è¯­è¨€ä¸­ï¼Œç±»é€‚é…å™¨æ¨¡å¼ä¸­çš„ç›®æ ‡æŠ½è±¡ç±»åªèƒ½ä¸ºæ¥å£ï¼Œä¸èƒ½ä¸ºç±»ï¼Œå…¶ä½¿ç”¨æœ‰ä¸€å®šçš„å±€é™æ€§ã€‚ å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ ä¼˜ç‚¹ ä¸€ä¸ªå¯¹è±¡é€‚é…å™¨å¯ä»¥æŠŠå¤šä¸ªä¸åŒçš„é€‚é…è€…é€‚é…åˆ°åŒä¸€ä¸ªç›®æ ‡ï¼› å¯ä»¥é€‚é…ä¸€ä¸ªé€‚é…è€…çš„å­ç±»ï¼Œç”±äºé€‚é…å™¨å’Œé€‚é…è€…ä¹‹é—´æ˜¯å…³è”å…³ç³»ï¼Œæ ¹æ®â€œé‡Œæ°ä»£æ¢åŸåˆ™â€ï¼Œé€‚é…è€…çš„å­ç±»ä¹Ÿå¯é€šè¿‡è¯¥é€‚é…å™¨è¿›è¡Œé€‚é…ã€‚ ç¼ºç‚¹ ä¸ç±»é€‚é…å™¨æ¨¡å¼ç›¸æ¯”ï¼Œè¦åœ¨é€‚é…å™¨ä¸­ç½®æ¢é€‚é…è€…ç±»çš„æŸäº›æ–¹æ³•æ¯”è¾ƒéº»çƒ¦ã€‚å¦‚æœä¸€å®šè¦ç½®æ¢æ‰é€‚é…è€…ç±»çš„ä¸€ä¸ªæˆ–å¤šä¸ªæ–¹æ³•ï¼Œå¯ä»¥å…ˆåšä¸€ä¸ªé€‚é…è€…ç±»çš„å­ç±»ï¼Œå°†é€‚é…è€…ç±»çš„æ–¹æ³•ç½®æ¢æ‰ï¼Œç„¶åå†æŠŠé€‚é…è€…ç±»çš„å­ç±»å½“åšçœŸæ­£çš„é€‚é…è€…è¿›è¡Œé€‚é…ï¼Œå®ç°è¿‡ç¨‹è¾ƒä¸ºå¤æ‚ã€‚ åº”ç”¨åœºæ™¯ é€‚é…å™¨çš„ä½¿ç”¨åœºæ™¯ ç³»ç»Ÿéœ€è¦å¤ç”¨ç°æœ‰ç±»ï¼Œè€Œè¯¥ç±»çš„æ¥å£ä¸ç¬¦åˆç³»ç»Ÿçš„éœ€æ±‚ï¼Œå¯ä»¥ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œ å¤šä¸ªç»„ä»¶åŠŸèƒ½ç±»ä¼¼ï¼Œä½†æ¥å£ä¸ç»Ÿä¸€ä¸”å¯èƒ½ä¼šç»å¸¸åˆ‡æ¢æ—¶ï¼Œå¯ä½¿ç”¨é€‚é…å™¨æ¨¡å¼ï¼Œä½¿å¾—å®¢æˆ·ç«¯å¯ä»¥ä»¥ç»Ÿä¸€çš„æ¥å£ä½¿ç”¨å®ƒä»¬ ç±»å’Œå¯¹è±¡é€‚é…å™¨æ¨¡å¼çš„ä½¿ç”¨åœºæ™¯ çµæ´»ä½¿ç”¨æ—¶ï¼šé€‰æ‹©å¯¹è±¡çš„é€‚é…å™¨æ¨¡å¼ ç±»é€‚é…å™¨ä½¿ç”¨å¯¹è±¡ç»§æ‰¿çš„æ–¹å¼ï¼Œæ˜¯é™æ€çš„å®šä¹‰æ–¹å¼ï¼›è€Œå¯¹è±¡é€‚é…å™¨ä½¿ç”¨å¯¹è±¡ç»„åˆçš„æ–¹å¼ï¼Œæ˜¯åŠ¨æ€ç»„åˆçš„æ–¹å¼ã€‚ éœ€è¦åŒæ—¶é…æºç±»å’Œå…¶å­ç±»ï¼šé€‰æ‹©å¯¹è±¡çš„é€‚é…å™¨ å¯¹äºç±»é€‚é…å™¨ï¼Œç”±äºé€‚é…å™¨ç›´æ¥ç»§æ‰¿äº†Adapteeï¼Œä½¿å¾—é€‚é…å™¨ä¸èƒ½å’ŒAdapteeçš„å­ç±»ä¸€èµ·å·¥ä½œï¼Œå› ä¸ºç»§æ‰¿æ˜¯é™æ€çš„å…³ç³»ï¼Œå½“é€‚é…å™¨ç»§æ‰¿äº†Adapteeåï¼Œå°±ä¸å¯èƒ½å†å»å¤„ç† Adapteeçš„å­ç±»äº†ï¼› å¯¹äºå¯¹è±¡é€‚é…å™¨ï¼Œä¸€ä¸ªé€‚é…å™¨å¯ä»¥æŠŠå¤šç§ä¸åŒçš„æºé€‚é…åˆ°åŒä¸€ä¸ªç›®æ ‡ã€‚æ¢è¨€ä¹‹ï¼ŒåŒä¸€ä¸ªé€‚é…å™¨å¯ä»¥æŠŠæºç±»å’Œå®ƒçš„å­ç±»éƒ½é€‚é…åˆ°ç›®æ ‡æ¥å£ã€‚å› ä¸ºå¯¹è±¡é€‚é…å™¨é‡‡ç”¨çš„æ˜¯å¯¹è±¡ç»„åˆçš„å…³ç³»ï¼Œåªè¦å¯¹è±¡ç±»å‹æ­£ç¡®ï¼Œæ˜¯ä¸æ˜¯å­ç±»éƒ½æ— æ‰€è°“ã€‚ éœ€è¦é‡æ–°å®šä¹‰Adapteeçš„éƒ¨åˆ†è¡Œä¸ºï¼šé€‰æ‹©ç±»é€‚é…å™¨ å¯¹äºç±»é€‚é…å™¨ï¼Œé€‚é…å™¨å¯ä»¥é‡å®šä¹‰Adapteeçš„éƒ¨åˆ†è¡Œä¸ºï¼Œç›¸å½“äºå­ç±»è¦†ç›–çˆ¶ç±»çš„éƒ¨åˆ†å®ç°æ–¹æ³•ã€‚ å¯¹äºå¯¹è±¡é€‚é…å™¨ï¼Œè¦é‡å®šä¹‰Adapteeçš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾ï¼Œè¿™ç§æƒ…å†µä¸‹ï¼Œéœ€è¦å®šä¹‰Adapteeçš„å­ç±»æ¥å®ç°é‡å®šä¹‰ï¼Œç„¶åè®©é€‚é…å™¨ç»„åˆå­ç±»ã€‚è™½ç„¶é‡å®šä¹‰Adapteeçš„è¡Œä¸ºæ¯”è¾ƒå›°éš¾ï¼Œä½†æ˜¯æƒ³è¦å¢åŠ ä¸€äº›æ–°çš„è¡Œä¸ºåˆ™æ–¹ä¾¿çš„å¾ˆï¼Œè€Œä¸”æ–°å¢åŠ çš„è¡Œä¸ºå¯åŒæ—¶é€‚ç”¨äºæ‰€æœ‰çš„æºã€‚ ä»…ä»…å¸Œæœ›ä½¿ç”¨æ–¹ä¾¿æ—¶ï¼šé€‰æ‹©ç±»é€‚é…å™¨ å¯¹äºç±»é€‚é…å™¨ï¼Œä»…ä»…å¼•å…¥äº†ä¸€ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸éœ€è¦é¢å¤–çš„å¼•ç”¨æ¥é—´æ¥å¾—åˆ°Adapteeã€‚ å¯¹äºå¯¹è±¡é€‚é…å™¨ï¼Œéœ€è¦é¢å¤–çš„å¼•ç”¨æ¥é—´æ¥å¾—åˆ°Adapteeã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ç­–ç•¥æ¨¡å¼]]></title>
    <url>%2Fposts%2Fea641220.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…èµ·æ¥ï¼Œå¹¶è®©å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼è®©ç®—æ³•ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„å®¢æˆ·è€Œå˜åŒ–ã€‚ ä¸»è¦ä½œç”¨(è§£å†³çš„é—®é¢˜) å°†ç®—æ³•çš„è´£ä»»å’Œæœ¬èº«è¿›è¡Œè§£è€¦ï¼Œä½¿å¾—ï¼š ç®—æ³•å¯ç‹¬ç«‹äºä½¿ç”¨å¤–éƒ¨è€Œå˜åŒ–ã€‚ å®¢æˆ·ç«¯æ–¹ä¾¿æ ¹æ®å¤–éƒ¨æ¡ä»¶é€‰æ‹©ä¸åŒç­–ç•¥æ¥è§£å†³ä¸åŒé—®é¢˜ã€‚ æ¨¡å¼åŸç† UMLç±»å›¾ æ¨¡å¼ä¼˜ç‚¹ 1ã€‚ ç­–ç•¥ç±»ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ ç”±äºç­–ç•¥ç±»éƒ½å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥ä½¿å®ƒä»¬ä¹‹é—´å¯ä»¥è‡ªç”±åˆ‡æ¢ã€‚ æ˜“äºæ‰©å±• å¢åŠ ä¸€ä¸ªæ–°çš„ç­–ç•¥åªéœ€è¦æ·»åŠ ä¸€ä¸ªå…·ä½“çš„ç­–ç•¥ç±»å³å¯ï¼ŒåŸºæœ¬ä¸éœ€è¦æ”¹å˜åŸæœ‰çš„ä»£ç ï¼Œç¬¦åˆâ€œå¼€é—­åŸåˆ™â€œã€‚ é¿å…ä½¿ç”¨å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼ˆif elseï¼‰ï¼Œå……åˆ†ä½“ç°é¢å‘å¯¹è±¡è®¾è®¡æ€æƒ³ã€‚ æ¨¡å¼ç¼ºç‚¹ å®¢æˆ·ç«¯å¿…é¡»çŸ¥é“æ‰€æœ‰çš„ç­–ç•¥ç±»ï¼Œå¹¶è‡ªè¡Œå†³å®šä½¿ç”¨å“ªä¸€ä¸ªç­–ç•¥ç±»ã€‚ ç­–ç•¥æ¨¡å¼å°†é€ æˆäº§ç”Ÿå¾ˆå¤šç­–ç•¥ç±»ï¼Œå¯ä»¥é€šè¿‡ä½¿ç”¨äº«å…ƒæ¨¡å¼åœ¨ä¸€å®šç¨‹åº¦ä¸Šå‡å°‘å¯¹è±¡çš„æ•°é‡ã€‚ åº”ç”¨åœºæ™¯ å¦‚æœåœ¨ä¸€ä¸ªç³»ç»Ÿé‡Œé¢æœ‰è®¸å¤šç±»ï¼Œå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ä»…åœ¨äºå®ƒä»¬çš„è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨ç­–ç•¥æ¨¡å¼å¯ä»¥åŠ¨æ€åœ°è®©ä¸€ä¸ªå¯¹è±¡åœ¨è®¸å¤šè¡Œä¸ºä¸­é€‰æ‹©ä¸€ç§è¡Œä¸ºã€‚ ä¸€ä¸ªç³»ç»Ÿéœ€è¦åŠ¨æ€åœ°åœ¨å‡ ç§ç®—æ³•ä¸­é€‰æ‹©ä¸€ç§ã€‚é‚£ä¹ˆè¿™äº›ç®—æ³•å¯ä»¥åŒ…è£…åˆ°ä¸€ä¸ªä¸ªçš„å…·ä½“ç®—æ³•ç±»é‡Œé¢ï¼Œè€Œè¿™äº›å…·ä½“ç®—æ³•ç±»éƒ½æ˜¯ä¸€ä¸ªæŠ½è±¡ç®—æ³•ç±»çš„å­ç±»ã€‚æ¢è¨€ä¹‹ï¼Œè¿™äº›å…·ä½“ç®—æ³•ç±»å‡æœ‰ç»Ÿä¸€çš„æ¥å£ï¼Œç”±äºå¤šæ€æ€§åŸåˆ™ï¼Œå®¢æˆ·ç«¯å¯ä»¥é€‰æ‹©ä½¿ç”¨ä»»ä½•ä¸€ä¸ªå…·ä½“ç®—æ³•ç±»ï¼Œå¹¶åªæŒæœ‰ä¸€ä¸ªæ•°æ®ç±»å‹æ˜¯æŠ½è±¡ç®—æ³•ç±»çš„å¯¹è±¡ã€‚ ä¸€ä¸ªç³»ç»Ÿçš„ç®—æ³•ä½¿ç”¨çš„æ•°æ®ä¸å¯ä»¥è®©å®¢æˆ·ç«¯çŸ¥é“ã€‚ç­–ç•¥æ¨¡å¼å¯ä»¥é¿å…è®©å®¢æˆ·ç«¯æ¶‰åŠåˆ°ä¸å¿…è¦æ¥è§¦åˆ°çš„å¤æ‚çš„å’Œåªä¸ç®—æ³•æœ‰å…³çš„æ•°æ®ã€‚ å¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¾ˆå¤šçš„è¡Œä¸ºï¼Œå¦‚æœä¸ç”¨æ°å½“çš„æ¨¡å¼ï¼Œè¿™äº›è¡Œä¸ºå°±åªå¥½ä½¿ç”¨å¤šé‡çš„æ¡ä»¶é€‰æ‹©è¯­å¥æ¥å®ç°ã€‚æ­¤æ—¶ï¼Œä½¿ç”¨ç­–ç•¥æ¨¡å¼ï¼ŒæŠŠè¿™äº›è¡Œä¸ºè½¬ç§»åˆ°ç›¸åº”çš„å…·ä½“ç­–ç•¥ç±»é‡Œé¢ï¼Œå°±å¯ä»¥é¿å…ä½¿ç”¨éš¾ä»¥ç»´æŠ¤çš„å¤šé‡æ¡ä»¶é€‰æ‹©è¯­å¥ï¼Œå¹¶ä½“ç°é¢å‘å¯¹è±¡è®¾è®¡çš„æ¦‚å¿µã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾æœ‰ä¸€å®¶ç™¾è´§å…¬å¸ï¼Œæœ€è¿‘åœ¨å®šå¹´åº¦çš„ä¿ƒé”€æ´»åŠ¨ å†²çªï¼šæ¯ä¸ªèŠ‚æ—¥ç”¨åŒä¸€ä¸ªä¿ƒé”€æ´»åŠ¨å¤ªæ¯ç‡¥ï¼Œæ²¡å¸å¼•åŠ› è§£å†³æ–¹æ¡ˆï¼šé’ˆå¯¹ä¸åŒèŠ‚ç›®ä½¿ç”¨ä¸åŒä¿ƒé”€æ´»åŠ¨è¿›è¡Œä¿ƒé”€ ä½¿ç”¨æ­¥éª¤ å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²ï¼ˆStrategyï¼‰ ç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæ¥å£ 123456789101112package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰æŠ½è±¡ç­–ç•¥è§’è‰²ï¼šç™¾è´§å…¬å¸æ‰€æœ‰ä¿ƒé”€æ´»åŠ¨çš„å…±åŒæ¥å£ */public abstract class Strategy { /** * æ´»åŠ¨å±•ç¤º */ public abstract void show();} å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼ˆConcrete Strategyï¼‰ æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼šæ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ */public class StrategyA extends Strategy { @Override public void show() { System.out.println("ä¸ºæ˜¥èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨A"); }} ä¸­ç§‹ä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰å…·ä½“ç­–ç•¥è§’è‰²ï¼šä¸­ç§‹ä¿ƒé”€æ´»åŠ¨ */public class StrategyB extends Strategy { @Override public void show() { System.out.println("ä¸ºä¸­ç§‹èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨B"); }} åœ£è¯ä¿ƒé”€æ´»åŠ¨ 12345678910111213package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰ç­–ç•¥è§’è‰²ï¼šåœ£è¯ä¿ƒé”€æ´»åŠ¨ */public class StrategyC extends Strategy { @Override public void show() { System.out.println("ä¸ºåœ£è¯èŠ‚å‡†å¤‡çš„ä¿ƒé”€æ´»åŠ¨C"); }} å®šä¹‰ç¯å¢ƒè§’è‰²ï¼ˆContextï¼‰ ç”¨äºè¿æ¥ä¸Šä¸‹æ–‡ï¼Œå³æŠŠä¿ƒé”€æ´»åŠ¨æ¨é”€ç»™å®¢æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜ 1234567891011121314151617181920212223242526272829303132333435363738package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®šä¹‰ç¯å¢ƒè§’è‰²ï¼šç”¨äºè¿æ¥ä¸Šä¸‹æ–‡ï¼ŒæŠŠä¿ƒé”€æ´»åŠ¨æ¨é”€ç»™ç”¨æˆ·ï¼Œè¿™é‡Œå¯ä»¥ç†è§£ä¸ºé”€å”®å‘˜ */public class SalesMan { //æŒæœ‰æŠ½è±¡ç­–ç•¥è§’è‰²çš„å¼•ç”¨ private Strategy strategy; /** * ç”Ÿæˆé”€å”®å‘˜å®ä¾‹æ—¶å‘Šè¯‰é”€å”®å‘˜ä»€ä¹ˆèŠ‚æ—¥ï¼ˆæ„é€ æ–¹æ³•ï¼‰ * ä½¿å¾—è®©é”€å”®å‘˜æ ¹æ®ä¼ å…¥çš„å‚æ•°ï¼ˆèŠ‚æ—¥ï¼‰é€‰æ‹©ä¿ƒé”€æ´»åŠ¨ï¼ˆè¿™é‡Œä½¿ç”¨ä¸€ä¸ªç®€å•çš„å·¥å‚æ¨¡å¼ï¼‰ */ public SalesMan(String festival) { switch (festival) { //æ˜¥èŠ‚å°±ä½¿ç”¨æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ case "A": strategy = new StrategyA(); break; //ä¸­ç§‹èŠ‚å°±ä½¿ç”¨ä¸­ç§‹èŠ‚ä¿ƒé”€æ´»åŠ¨ case "B": strategy = new StrategyB(); break; //åœ£è¯èŠ‚å°±ä½¿ç”¨åœ£è¯èŠ‚ä¿ƒé”€æ´»åŠ¨ case "C": strategy = new StrategyC(); break; } } /** * å‘å®¢æˆ·å±•ç¤ºä¿ƒé”€æ´»åŠ¨ */ public void salesManShow() { strategy.show(); }} å®¢æˆ·ç«¯è°ƒç”¨ è®©é”€å”®å‘˜è¿›è¡Œä¿ƒé”€æ´»åŠ¨çš„è½åœ° 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.strategy.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { SalesMan mSalesMan; //æ˜¥èŠ‚æ¥äº†ï¼Œä½¿ç”¨æ˜¥èŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºæ˜¥èŠ‚ï¼š"); mSalesMan = new SalesMan("A"); mSalesMan.salesManShow(); //ä¸­ç§‹èŠ‚æ¥äº†ï¼Œä½¿ç”¨ä¸­ç§‹èŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºä¸­ç§‹èŠ‚ï¼š"); mSalesMan = new SalesMan("B"); mSalesMan.salesManShow(); //åœ£è¯èŠ‚æ¥äº†ï¼Œä½¿ç”¨åœ£è¯èŠ‚ä¿ƒé”€æ´»åŠ¨ System.out.println("å¯¹äºåœ£è¯èŠ‚ï¼š"); mSalesMan = new SalesMan("C"); mSalesMan.salesManShow(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å¤šçº¿ç¨‹é¢è¯•é¢˜æ€»ç»“]]></title>
    <url>%2Fposts%2Fe3e73bdc.html</url>
    <content type="text"><![CDATA[å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ ä¼˜ç‚¹ï¼š å¤šçº¿ç¨‹æŠ€æœ¯ä½¿ç¨‹åºçš„å“åº”é€Ÿåº¦æ›´å¿«ã€‚ å½“å‰æ²¡æœ‰è¿›è¡Œå¤„ç†çš„ä»»åŠ¡å¯ä»¥å°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡ã€‚ å ç”¨å¤§é‡å¤„ç†æ—¶é—´çš„ä»»åŠ¡å¯ä»¥å®šæœŸå°†å¤„ç†å™¨æ—¶é—´è®©ç»™å…¶å®ƒä»»åŠ¡ã€‚ å¯ä»¥éšæ—¶åœæ­¢ä»»åŠ¡ã€‚ å¯ä»¥åˆ†åˆ«è®¾ç½®å„ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ä»¥åŠä¼˜åŒ–æ€§èƒ½ã€‚ ç¼ºç‚¹ ç­‰å€™ä½¿ç”¨å…±äº«èµ„æºæ—¶é€ æˆç¨‹åºçš„è¿è¡Œé€Ÿåº¦å˜æ…¢ã€‚ å¯¹çº¿ç¨‹è¿›è¡Œç®¡ç†è¦æ±‚é¢å¤–çš„cpuå¼€é”€ã€‚ å¯èƒ½å‡ºç°çº¿ç¨‹æ­»é”æƒ…å†µã€‚å³è¾ƒé•¿æ—¶é—´çš„ç­‰å¾…æˆ–èµ„æºç«äº‰ä»¥åŠæ­»é”ç­‰ç—‡çŠ¶ã€‚ åœ¨javaä¸­å®ˆæŠ¤çº¿ç¨‹å’Œæœ¬åœ°çº¿ç¨‹åŒºåˆ« javaä¸­çš„çº¿ç¨‹åˆ†ä¸ºä¸¤ç§ï¼šå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemonï¼‰å’Œç”¨æˆ·çº¿ç¨‹ï¼ˆUserï¼‰ã€‚ ä»»ä½•çº¿ç¨‹éƒ½å¯ä»¥è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹ï¼Œé€šè¿‡æ–¹æ³•Thread.setDaemon(bool on)ï¼›trueåˆ™æŠŠè¯¥çº¿ç¨‹è®¾ç½®ä¸ºå®ˆæŠ¤çº¿ç¨‹ï¼Œåä¹‹åˆ™ä¸ºç”¨æˆ·çº¿ç¨‹ã€‚Thread.setDaemon()å¿…é¡»åœ¨Thread.start()ä¹‹å‰è°ƒç”¨ï¼Œå¦åˆ™è¿è¡Œæ—¶ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ ä¸¤è€…çš„åŒºåˆ«ï¼š å”¯ä¸€çš„åŒºåˆ«æ˜¯åˆ¤æ–­è™šæ‹Ÿæœº(JVM)ä½•æ—¶ç¦»å¼€ï¼ŒDaemonæ˜¯ä¸ºå…¶ä»–çº¿ç¨‹æä¾›æœåŠ¡ï¼Œå¦‚æœå…¨éƒ¨çš„User Threadå·²ç»æ’¤ç¦»ï¼ŒDaemon æ²¡æœ‰å¯æœåŠ¡çš„çº¿ç¨‹ï¼ŒJVMæ’¤ç¦»ã€‚ä¹Ÿå¯ä»¥ç†è§£ä¸ºå®ˆæŠ¤çº¿ç¨‹æ˜¯JVMè‡ªåŠ¨åˆ›å»ºçš„çº¿ç¨‹ï¼ˆä½†ä¸ä¸€å®šï¼‰ï¼Œç”¨æˆ·çº¿ç¨‹æ˜¯ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹ï¼›æ¯”å¦‚JVMçš„åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯ä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œå½“æ‰€æœ‰çº¿ç¨‹å·²ç»æ’¤ç¦»ï¼Œä¸å†äº§ç”Ÿåƒåœ¾ï¼Œå®ˆæŠ¤çº¿ç¨‹è‡ªç„¶å°±æ²¡äº‹å¯å¹²äº†ï¼Œå½“åƒåœ¾å›æ”¶çº¿ç¨‹æ˜¯Javaè™šæ‹Ÿæœºä¸Šä»…å‰©çš„çº¿ç¨‹æ—¶ï¼ŒJavaè™šæ‹Ÿæœºä¼šè‡ªåŠ¨ç¦»å¼€ã€‚ æ‰©å±•ï¼šThread Dumpæ‰“å°å‡ºæ¥çš„çº¿ç¨‹ä¿¡æ¯ï¼Œå«æœ‰daemonå­—æ ·çš„çº¿ç¨‹å³ä¸ºå®ˆæŠ¤è¿›ç¨‹ï¼Œå¯èƒ½ä¼šæœ‰ï¼šæœåŠ¡å®ˆæŠ¤è¿›ç¨‹ã€ç¼–è¯‘å®ˆæŠ¤è¿›ç¨‹ã€windowsä¸‹çš„ç›‘å¬Ctrl+breakçš„å®ˆæŠ¤è¿›ç¨‹ã€Finalizerå®ˆæŠ¤è¿›ç¨‹ã€å¼•ç”¨å¤„ç†å®ˆæŠ¤è¿›ç¨‹ã€GCå®ˆæŠ¤è¿›ç¨‹ã€‚ çº¿ç¨‹ä¸è¿›ç¨‹çš„åŒºåˆ« è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯æ“ä½œç³»ç»Ÿè°ƒåº¦çš„æœ€å°å•å…ƒã€‚ä¸€ä¸ªç¨‹åºè‡³å°‘æœ‰ä¸€ä¸ªè¿›ç¨‹,ä¸€ä¸ªè¿›ç¨‹è‡³å°‘æœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ ä»€ä¹ˆæ˜¯å¤šçº¿ç¨‹ä¸­çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ å¤šçº¿ç¨‹ä¼šå…±åŒä½¿ç”¨ä¸€ç»„è®¡ç®—æœºä¸Šçš„CPUï¼Œè€Œçº¿ç¨‹æ•°å¤§äºç»™ç¨‹åºåˆ†é…çš„CPUæ•°é‡æ—¶ï¼Œä¸ºäº†è®©å„ä¸ªçº¿ç¨‹éƒ½æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œå°±éœ€è¦è½®è½¬ä½¿ç”¨CPUã€‚ä¸åŒçš„çº¿ç¨‹åˆ‡æ¢ä½¿ç”¨CPUå‘ç”Ÿçš„åˆ‡æ¢æ•°æ®ç­‰å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚ æ­»é”ä¸æ´»é”çš„åŒºåˆ«ï¼Œæ­»é”ä¸é¥¥é¥¿çš„åŒºåˆ« **æ­»é”ï¼š**æ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹ï¼ˆæˆ–çº¿ç¨‹ï¼‰åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚ äº§ç”Ÿæ­»é”çš„å¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šæ‰€è°“äº’æ–¥å°±æ˜¯è¿›ç¨‹åœ¨æŸä¸€æ—¶é—´å†…ç‹¬å èµ„æºã€‚ è¯·æ±‚ä¸ä¿æŒæ¡ä»¶ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å‰¥å¤ºæ¡ä»¶:è¿›ç¨‹å·²è·å¾—èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ **æ´»é”ï¼š**ä»»åŠ¡æˆ–è€…æ‰§è¡Œè€…æ²¡æœ‰è¢«é˜»å¡ï¼Œç”±äºæŸäº›æ¡ä»¶æ²¡æœ‰æ»¡è¶³ï¼Œå¯¼è‡´ä¸€ç›´é‡å¤å°è¯•ï¼Œå¤±è´¥ï¼Œå°è¯•ï¼Œå¤±è´¥ã€‚ æ´»é”å’Œæ­»é”çš„åŒºåˆ«åœ¨äºï¼Œå¤„äºæ´»é”çš„å®ä½“æ˜¯åœ¨ä¸æ–­çš„æ”¹å˜çŠ¶æ€ï¼Œæ‰€è°“çš„â€œæ´»â€ï¼Œ è€Œå¤„äºæ­»é”çš„å®ä½“è¡¨ç°ä¸ºç­‰å¾…ï¼›æ´»é”æœ‰å¯èƒ½è‡ªè¡Œè§£å¼€ï¼Œæ­»é”åˆ™ä¸èƒ½ã€‚ **é¥¥é¥¿ï¼š**ä¸€ä¸ªæˆ–è€…å¤šä¸ªçº¿ç¨‹å› ä¸ºç§ç§åŸå› æ— æ³•è·å¾—æ‰€éœ€è¦çš„èµ„æºï¼Œå¯¼è‡´ä¸€ç›´æ— æ³•æ‰§è¡Œçš„çŠ¶æ€ã€‚ Javaä¸­å¯¼è‡´é¥¥é¥¿çš„åŸå› ï¼š é«˜ä¼˜å…ˆçº§çº¿ç¨‹åå™¬æ‰€æœ‰çš„ä½ä¼˜å…ˆçº§çº¿ç¨‹çš„CPUæ—¶é—´ã€‚ çº¿ç¨‹è¢«æ°¸ä¹…å µå¡åœ¨ä¸€ä¸ªç­‰å¾…è¿›å…¥åŒæ­¥å—çš„çŠ¶æ€ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯èƒ½åœ¨å®ƒä¹‹å‰æŒç»­åœ°å¯¹è¯¥åŒæ­¥å—è¿›è¡Œè®¿é—®ã€‚ çº¿ç¨‹åœ¨ç­‰å¾…ä¸€ä¸ªæœ¬èº«ä¹Ÿå¤„äºæ°¸ä¹…ç­‰å¾…å®Œæˆçš„å¯¹è±¡(æ¯”å¦‚è°ƒç”¨è¿™ä¸ªå¯¹è±¡çš„waitæ–¹æ³•)ï¼Œå› ä¸ºå…¶ä»–çº¿ç¨‹æ€»æ˜¯è¢«æŒç»­åœ°è·å¾—å”¤é†’ã€‚ start()æ–¹æ³•å’Œrun()æ–¹æ³•çš„åŒºåˆ« start()æ–¹æ³•ï¼š ç”¨startæ–¹æ³•æ¥å¯åŠ¨çº¿ç¨‹ï¼ŒçœŸæ­£å®ç°äº†å¤šçº¿ç¨‹è¿è¡Œï¼Œè¿™æ—¶æ— éœ€ç­‰å¾…runæ–¹æ³•ä½“ä»£ç æ‰§è¡Œå®Œæ¯•è€Œç›´æ¥ç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»£ç ã€‚ é€šè¿‡è°ƒç”¨Threadç±»çš„start()æ–¹æ³•æ¥å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ—¶æ­¤çº¿ç¨‹å¤„äºå°±ç»ªï¼ˆå¯è¿è¡Œï¼‰çŠ¶æ€ï¼Œå¹¶æ²¡æœ‰è¿è¡Œï¼Œä¸€æ—¦å¾—åˆ°CPUæ—¶é—´ç‰‡ï¼Œå°±å¼€å§‹æ‰§è¡Œrun()æ–¹æ³•ã€‚ run()æ–¹æ³•ï¼š run()æ–¹æ³•åªæ˜¯ç±»çš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è€Œå·²ï¼Œå¦‚æœç›´æ¥è°ƒç”¨Runæ–¹æ³•ï¼Œç¨‹åºä¸­ä¾ç„¶åªæœ‰ä¸»çº¿ç¨‹è¿™ä¸€ä¸ªçº¿ç¨‹ï¼Œå…¶ç¨‹åºæ‰§è¡Œè·¯å¾„è¿˜æ˜¯åªæœ‰ä¸€æ¡ã€‚ æ€»ç»“ï¼š è°ƒç”¨startæ–¹æ³•æ–¹å¯å¯åŠ¨çº¿ç¨‹ã€‚ runæ–¹æ³•åªæ˜¯threadçš„ä¸€ä¸ªæ™®é€šæ–¹æ³•è°ƒç”¨ï¼Œè¿˜æ˜¯åœ¨ä¸»çº¿ç¨‹é‡Œæ‰§è¡Œã€‚ æŠŠéœ€è¦å¹¶è¡Œå¤„ç†çš„ä»£ç æ”¾åœ¨run()æ–¹æ³•ä¸­ï¼Œstart()æ–¹æ³•å¯åŠ¨çº¿ç¨‹å°†è‡ªåŠ¨è°ƒç”¨run()æ–¹æ³•ï¼Œè¿™æ˜¯ç”±jvmçš„å†…å­˜æœºåˆ¶è§„å®šçš„ã€‚ run()æ–¹æ³•å¿…é¡»æ˜¯publicè®¿é—®æƒé™ï¼Œè¿”å›å€¼ç±»å‹ä¸ºvoidã€‚ Runnableæ¥å£å’ŒCallableæ¥å£çš„ç›¸åŒç‚¹å’Œä¸åŒç‚¹ ç›¸åŒç‚¹ï¼š Callableå’ŒRunnableéƒ½æ˜¯æ¥å£ï¼› Callableå’ŒRunnableéƒ½ä¸€ç§‘åº”ç”¨äºExecutorsï¼› ä¸åŒç‚¹ï¼š Callableè¦å®ç°call()æ–¹æ³•ï¼ŒRunnableè¦å®ç°run()æ–¹æ³•ï¼› call()æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼ï¼Œrun()æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼ï¼› call(0æ–¹æ³•å¯ä»¥æŠ›å‡ºChecked Exceptionï¼Œrun()æ–¹æ³•ä¸å¯ä»¥ï¼› Runnableæ¥å£åœ¨Jdk1.1ä¸­å°±æœ‰äº†ï¼ŒCallableåœ¨JDK1.5æ‰æœ‰ï¼› voliateå…³é”®å­—çš„ä½œç”¨ å¤šçº¿ç¨‹ä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°çš„å˜é‡ï¼Œä¿è¯äº†å…¶åœ¨å¤šçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œå³æ¯æ¬¡è¯»å–åˆ°volatileå˜é‡ï¼Œä¸€å®šæ˜¯æœ€æ–°çš„æ•°æ®ã€‚ Javaä»£ç æ‰§è¡Œä¸­ï¼Œä¸ºäº†è·å–æ›´å¥½çš„æ€§èƒ½JVMå¯èƒ½ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œå¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°ä¸€äº›æ„æƒ³ä¸åˆ°çš„é—®é¢˜ã€‚ä½¿ç”¨volatileåˆ™ä¼šå¯¹ç¦æ­¢è¯­ä¹‰é‡æ’åºï¼Œå½“ç„¶è¿™ä¹Ÿä¸€å®šç¨‹åº¦ä¸Šé™ä½äº†ä»£ç æ‰§è¡Œæ•ˆç‡ã€‚ CyclicBarrierå’ŒCountDownLatchçš„åŒºåˆ« CountDownLatch CyclicBarrier å‡è®¡æ•°æ–¹å¼ åŠ è®¡æ•°æ–¹å¼ è®¡æ•°ä¸º0æ—¶å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ è®¡æ•°è¾¾åˆ°æŒ‡å®šå€¼æ—¶å”¤é†’æ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ è®¡æ•°ä¸º0æ— æ³•é‡ç½® è®¡æ•°è¾¾åˆ°æŒ‡å®šå€¼æ—¶ï¼Œè®¡æ•°ç½®ä¸º0é‡æ–°å¼€å§‹ è°ƒç”¨countDown()æ–¹æ³•è®¡æ•°å‡ä¸€ï¼Œè°ƒç”¨await()æ–¹æ³•åªè¿›è¡Œé˜»å¡ï¼Œå¯¹è®¡æ•°æ²¡æœ‰å½±å“ è°ƒç”¨await()æ–¹æ³•è®¡æ•°åŠ 1ï¼Œè‹¥åŠ 1åçš„å€¼ä¸ç­‰äºæ„é€ æ–¹æ³•çš„å€¼ï¼Œåˆ™çº¿ç¨‹é˜»å¡ ä¸èƒ½é‡å¤åˆ©ç”¨ å¯é‡å¤ä½¿ç”¨ voliateå’Œsynchronizedå¯¹æ¯” volatileæœ¬è´¨æ˜¯åœ¨å‘Šè¯‰jvmå½“å‰å˜é‡åœ¨å¯„å­˜å™¨ä¸­çš„å€¼æ˜¯ä¸ç¡®å®šçš„,éœ€è¦ä»ä¸»å­˜ä¸­è¯»å–,synchronizedåˆ™æ˜¯é”å®šå½“å‰å˜é‡,åªæœ‰å½“å‰çº¿ç¨‹å¯ä»¥è®¿é—®è¯¥å˜é‡,å…¶ä»–çº¿ç¨‹è¢«é˜»å¡ä½ã€‚ volatileä»…èƒ½ä½¿ç”¨åœ¨å˜é‡çº§åˆ«,synchronizedåˆ™å¯ä»¥ä½¿ç”¨åœ¨å˜é‡,æ–¹æ³•ä»¥åŠç±»çº§åˆ«ã€‚ volatileä»…èƒ½å®ç°å˜é‡çš„ä¿®æ”¹å¯è§æ€§,è€Œsynchronizedåˆ™å¯ä»¥ä¿è¯å˜é‡çš„ä¿®æ”¹å¯è§æ€§å’ŒåŸå­æ€§ã€‚ volatileä¸ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡,è€Œsynchronizedå¯èƒ½ä¼šé€ æˆçº¿ç¨‹çš„é˜»å¡ã€‚ æ€ä¹ˆå”¤é†’ä¸€ä¸ªé˜»å¡çš„çº¿ç¨‹ å¦‚æœçº¿ç¨‹æ˜¯å› ä¸ºè°ƒç”¨äº†wait()ã€sleep()æˆ–è€…join()æ–¹æ³•è€Œå¯¼è‡´çš„é˜»å¡ï¼Œå¯ä»¥ä¸­æ–­çº¿ç¨‹ï¼Œå¹¶ä¸”é€šè¿‡æŠ›å‡ºInterruptedExceptionæ¥å”¤é†’å®ƒï¼› å¦‚æœçº¿ç¨‹é‡åˆ°äº†IOé˜»å¡ï¼Œæ— èƒ½ä¸ºåŠ›ï¼Œå› ä¸ºIOæ˜¯æ“ä½œç³»ç»Ÿå®ç°çš„ï¼ŒJavaä»£ç å¹¶æ²¡æœ‰åŠæ³•ç›´æ¥æ¥è§¦åˆ°æ“ä½œç³»ç»Ÿã€‚ sleepæ–¹æ³•å’Œwaitæ–¹æ³•çš„ç›¸åŒç‚¹å’Œä¸åŒç‚¹ ç›¸åŒç‚¹ï¼š äºŒè€…éƒ½å¯ä»¥è®©çº¿ç¨‹å¤„äºé˜»å¡ï¼› ä¸åŒç‚¹ï¼š é¦–å…ˆsleepæ–¹æ³•æ˜¯Threadç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œè€Œwaitæ–¹æ³•æ˜¯Objectç±»ä¸­å®šä¹‰çš„æ–¹æ³•ã€‚ sleepæ–¹æ³•å¿…é¡»äººä¸ºåœ°ä¸ºå…¶æŒ‡å®šä¼‘çœ æ—¶é—´ã€‚waitæ–¹æ³•æ—¢å¯ä»¥æŒ‡å®šæ—¶é—´ï¼Œä¹Ÿå¯ä»¥ä¸æŒ‡å®šæ—¶é—´ã€‚ sleepæ–¹æ³•æ—¶é—´åˆ°äº†ï¼Œçº¿ç¨‹å¤„äºä¸´æ—¶é˜»å¡çŠ¶æ€æˆ–è€…è¿è¡ŒçŠ¶æ€ã€‚waitæ–¹æ³•å¦‚æœæ²¡æœ‰è¢«è®¾ç½®æ—¶é—´ï¼Œå°±å¿…é¡»è¦é€šè¿‡notifyæˆ–è€…notifyAllæ¥å”¤é†’ã€‚ sleepæ–¹æ³•ä¸ä¸€å®šéè¦å®šä¹‰åœ¨åŒæ­¥ä¸­ã€‚waitæ–¹æ³•å¿…é¡»å®šä¹‰åœ¨åŒæ­¥ä¸­ã€‚ å½“äºŒè€…éƒ½å®šä¹‰åœ¨åŒæ­¥ä¸­æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œåˆ°sleepï¼Œä¸ä¼šé‡Šæ”¾é”ã€‚çº¿ç¨‹æ‰§è¡Œåˆ°waitï¼Œä¼šé‡Šæ”¾é”ã€‚ ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…æ¨¡å‹çš„ä½œç”¨ é€šè¿‡å¹³è¡¡ç”Ÿäº§è€…çš„ç”Ÿäº§èƒ½åŠ›å’Œæ¶ˆè´¹è€…çš„æ¶ˆè´¹èƒ½åŠ›æ¥æå‡æ•´ä¸ªç³»ç»Ÿçš„è¿è¡Œæ•ˆç‡ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æœ€é‡è¦çš„ä½œç”¨ã€‚ è§£è€¦ï¼Œè¿™æ˜¯ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹é™„å¸¦çš„ä½œç”¨ï¼Œè§£è€¦æ„å‘³ç€ç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„è”ç³»å°‘ï¼Œè”ç³»è¶Šå°‘è¶Šå¯ä»¥ç‹¬è‡ªå‘å±•è€Œä¸éœ€è¦æ”¶åˆ°ç›¸äº’çš„åˆ¶çº¦ã€‚ Executor.submit()å’ŒExecutor.execute()çš„åŒºåˆ« å‰è€…è¿”å›ä¸€ä¸ª Futureå¯¹è±¡ï¼Œå¯ä»¥ç”¨äºæ‰¾åˆ°å·¥ä½œçº¿ç¨‹çš„è¿è¡Œç»“æœã€‚ åœ¨å¼‚å¸¸å¤„ç†ä¸Šä¹Ÿä¸ä¸€æ ·ï¼Œåœ¨ä»»åŠ¡æŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ˜¯é€šè¿‡ execute()æäº¤çš„ï¼Œä¼šæŠ›å‡ºæ— éœ€æ•è·çš„å¼‚å¸¸ï¼ˆå¦‚æœä½ æ²¡æœ‰ç‰¹æ®Šå¤„ç†ï¼Œä¼šæ‰“å°é”™è¯¯æ ˆé“System.errï¼‰ã€‚å¦‚æœæ˜¯é€šè¿‡ submit()æäº¤çš„ï¼Œä»»ä½•å¼‚å¸¸ï¼Œæ— è®ºæ˜¯ä¸æ˜¯checked exceptionï¼Œéƒ½æ˜¯è¿”å›çš„ä¸€éƒ¨åˆ†ï¼ŒFuture.getå°†æŠŠå¼‚å¸¸åŒ…åœ¨ ExecutionExeptionä¸­ï¼Œå‘ä¸Šå±‚æŠ›å‡ºã€‚ ThreadLocalçš„ä½œç”¨ ThreadLocalç”¨æ¥è§£å†³å¤šçº¿ç¨‹ç¨‹åºçš„å¹¶å‘é—®é¢˜ã€‚ ThreadLocalå¹¶ä¸æ˜¯ä¸€ä¸ªThread,è€Œæ˜¯Threadçš„å±€éƒ¨å˜é‡,å½“ä½¿ç”¨ThreadLocalç»´æŠ¤å˜é‡æ—¶,ThreadLocalä¸ºæ¯ä¸ªä½¿ç”¨è¯¥å˜é‡çš„çº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬,æ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥ç‹¬ç«‹åœ°æ”¹å˜è‡ªå·±çš„å‰¯æœ¬,è€Œä¸ä¼šå½±å“å…¶å®ƒçº¿ç¨‹æ‰€å¯¹åº”çš„å‰¯æœ¬ã€‚ ä»çº¿ç¨‹çš„è§’åº¦çœ‹ï¼Œç›®æ ‡å˜é‡å°±è±¡æ˜¯çº¿ç¨‹çš„æœ¬åœ°å˜é‡ï¼Œè¿™ä¹Ÿæ˜¯ç±»åä¸­â€œLocalâ€æ‰€è¦è¡¨è¾¾çš„æ„æ€ã€‚ çº¿ç¨‹å±€éƒ¨å˜é‡å¹¶ä¸æ˜¯Javaçš„æ–°å‘æ˜,Javaæ²¡æœ‰æä¾›åœ¨è¯­è¨€çº§æ”¯æŒ(è¯­æ³•ä¸Š),è€Œæ˜¯å˜ç›¸åœ°é€šè¿‡ThreadLocalçš„ç±»æä¾›æ”¯æŒã€‚ waitæ–¹æ³•å’Œnotify/notifyAllæ–¹æ³•åœ¨æ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨æ—¶çš„åŒºåˆ« wait()æ–¹æ³•ç«‹å³é‡Šæ”¾å¯¹è±¡ç›‘è§†å™¨ï¼› notify()/notifyAll()æ–¹æ³•åˆ™ä¼šç­‰å¾…çº¿ç¨‹å‰©ä½™ä»£ç æ‰§è¡Œå®Œæ¯•æ‰ä¼šæ”¾å¼ƒå¯¹è±¡ç›‘è§†å™¨ã€‚ Lockå’Œsynchronizedå¯¹æ¯” Lockæ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œsynchronizedæ˜¯Javaä¸­çš„å…³é”®å­—ï¼Œsynchronizedæ˜¯å†…ç½®çš„è¯­è¨€å®ç°ï¼› synchronizedåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œä¼šè‡ªåŠ¨é‡Šæ”¾çº¿ç¨‹å æœ‰çš„é”ï¼Œå› æ­¤ä¸ä¼šå¯¼è‡´æ­»é”ç°è±¡å‘ç”Ÿï¼›è€ŒLockåœ¨å‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä¸»åŠ¨é€šè¿‡unLock()å»é‡Šæ”¾é”ï¼Œåˆ™å¾ˆå¯èƒ½é€ æˆæ­»é”ç°è±¡ï¼Œå› æ­¤ä½¿ç”¨Lockæ—¶éœ€è¦åœ¨finallyå—ä¸­é‡Šæ”¾é”ï¼› Lockå¯ä»¥è®©ç­‰å¾…é”çš„çº¿ç¨‹å“åº”ä¸­æ–­ï¼Œè€Œsynchronizedå´ä¸è¡Œï¼Œä½¿ç”¨synchronizedæ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ä¸‹å»ï¼Œä¸èƒ½å¤Ÿå“åº”ä¸­æ–­ï¼› é€šè¿‡Lockå¯ä»¥çŸ¥é“æœ‰æ²¡æœ‰æˆåŠŸè·å–é”ï¼Œè€Œsynchronizedå´æ— æ³•åŠåˆ°ã€‚ Lockå¯ä»¥æé«˜å¤šä¸ªçº¿ç¨‹è¿›è¡Œè¯»æ“ä½œçš„æ•ˆç‡ã€‚ åœ¨JDK1.5ä¸­ï¼Œsynchronizedæ˜¯æ€§èƒ½ä½æ•ˆçš„ã€‚å› ä¸ºè¿™æ˜¯ä¸€ä¸ªé‡é‡çº§æ“ä½œï¼Œå®ƒå¯¹æ€§èƒ½æœ€å¤§çš„å½±å“æ˜¯é˜»å¡å¼çš„å®ç°ï¼ŒæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹çš„æ“ä½œéƒ½éœ€è¦è½¬å…¥å†…æ ¸æ€ä¸­å®Œæˆï¼Œè¿™äº›æ“ä½œç»™ç³»ç»Ÿçš„å¹¶å‘æ€§å¸¦æ¥äº†å¾ˆå¤§çš„å‹åŠ›ã€‚ç›¸æ¯”ä¹‹ä¸‹ä½¿ç”¨Javaæä¾›çš„Lockå¯¹è±¡ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ã€‚ ä½†æ˜¯ï¼ŒJDK1.6ï¼Œå‘ç”Ÿäº†å˜åŒ–ï¼Œå¯¹synchronizeåŠ å…¥äº†å¾ˆå¤šä¼˜åŒ–æªæ–½ï¼Œæœ‰è‡ªé€‚åº”è‡ªæ—‹ï¼Œé”æ¶ˆé™¤ï¼Œé”ç²—åŒ–ï¼Œè½»é‡çº§é”ï¼Œåå‘é”ç­‰ç­‰ã€‚å¯¼è‡´åœ¨JDK1.6ä¸Šsynchronizeçš„æ€§èƒ½å¹¶ä¸æ¯”Lockå·®ã€‚å› æ­¤ã€‚æå€¡ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨synchronizedæ¥è¿›è¡ŒåŒæ­¥ã€‚ ReadWriteLockæ˜¯ä»€ä¹ˆ ReadWriteLockæ˜¯ä¸€ä¸ªè¯»å†™é”æ¥å£ï¼ŒReentrantReadWriteLockæ˜¯ReadWriteLockæ¥å£çš„ä¸€ä¸ªå…·ä½“å®ç°ï¼Œå®ç°äº†è¯»å†™çš„åˆ†ç¦»ï¼Œè¯»é”æ˜¯å…±äº«çš„ï¼Œå†™é”æ˜¯ç‹¬å çš„ï¼Œè¯»å’Œè¯»ä¹‹é—´ä¸ä¼šäº’æ–¥ï¼Œè¯»å’Œå†™ã€å†™å’Œè¯»ã€å†™å’Œå†™ä¹‹é—´æ‰ä¼šäº’æ–¥ï¼Œæå‡äº†è¯»å†™çš„æ€§èƒ½ã€‚ FutureTaskæ˜¯ä»€ä¹ˆ FutureTaskè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡ã€‚FutureTaské‡Œé¢å¯ä»¥ä¼ å…¥ä¸€ä¸ªCallableçš„å…·ä½“å®ç°ç±»ï¼Œå¯ä»¥å¯¹è¿™ä¸ªå¼‚æ­¥è¿ç®—çš„ä»»åŠ¡çš„ç»“æœè¿›è¡Œç­‰å¾…è·å–ã€åˆ¤æ–­æ˜¯å¦å·²ç»å®Œæˆã€å–æ¶ˆä»»åŠ¡ç­‰æ“ä½œã€‚ç”±äºFutureTaskä¹Ÿæ˜¯Runnableæ¥å£çš„å®ç°ç±»ï¼Œæ‰€ä»¥FutureTaskä¹Ÿå¯ä»¥æ”¾å…¥çº¿ç¨‹æ± ä¸­ã€‚ Javaä¸­ç”¨åˆ°çš„çº¿ç¨‹è°ƒåº¦ç®—æ³• æŠ¢å å¼ã€‚ä¸€ä¸ªçº¿ç¨‹ç”¨å®ŒCPUä¹‹åï¼Œæ“ä½œç³»ç»Ÿä¼šæ ¹æ®çº¿ç¨‹ä¼˜å…ˆçº§ã€çº¿ç¨‹é¥¥é¥¿æƒ…å†µç­‰æ•°æ®ç®—å‡ºä¸€ä¸ªæ€»çš„ä¼˜å…ˆçº§å¹¶åˆ†é…ä¸‹ä¸€ä¸ªæ—¶é—´ç‰‡ç»™æŸä¸ªçº¿ç¨‹æ‰§è¡Œã€‚ ä¹è§‚é”å’Œæ‚²è§‚é” ä¹è§‚é”ï¼šå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒä¹è§‚çŠ¶æ€ï¼Œä¹è§‚é”è®¤ä¸ºç«äº‰ä¸æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤å®ƒä¸éœ€è¦æŒæœ‰é”ï¼Œå°†æ¯”è¾ƒ-è®¾ç½®è¿™ä¸¤ä¸ªåŠ¨ä½œä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œå°è¯•å»ä¿®æ”¹å†…å­˜ä¸­çš„å˜é‡ï¼Œå¦‚æœå¤±è´¥åˆ™è¡¨ç¤ºå‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ç›¸åº”çš„é‡è¯•é€»è¾‘ã€‚ æ‚²è§‚é”ï¼šå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒæ‚²è§‚çŠ¶æ€ï¼Œæ‚²è§‚é”è®¤ä¸ºç«äº‰æ€»æ˜¯ä¼šå‘ç”Ÿï¼Œå› æ­¤æ¯æ¬¡å¯¹æŸèµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œéƒ½ä¼šæŒæœ‰ä¸€ä¸ªç‹¬å çš„é”ï¼Œå°±åƒsynchronizedï¼Œç›´æ¥å¯¹æ“ä½œèµ„æºä¸Šäº†é”ã€‚ ç¼–å†™ä¸€ä¸ªæ­»é”ç¨‹åº æ­»é”ç°è±¡æè¿°ï¼š çº¿ç¨‹Aå’Œçº¿ç¨‹Bç›¸äº’ç­‰å¾…å¯¹æ–¹æŒæœ‰çš„é”å¯¼è‡´ç¨‹åºæ— é™æ­»å¾ªç¯ä¸‹å»ã€‚ æ­»é”çš„å®ç°æ­¥éª¤ï¼š ä¸¤ä¸ªçº¿ç¨‹é‡Œé¢åˆ†åˆ«æŒæœ‰ä¸¤ä¸ªObjectå¯¹è±¡ï¼šlock1å’Œlock2ã€‚è¿™ä¸¤ä¸ªlockä½œä¸ºåŒæ­¥ä»£ç å—çš„é”ï¼› çº¿ç¨‹1çš„run()æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock1çš„å¯¹è±¡é”ï¼ŒThread.sleep(xxx)ï¼Œæ—¶é—´ä¸éœ€è¦å¤ªå¤šï¼Œ100æ¯«ç§’å·®ä¸å¤šäº†ï¼Œç„¶åæ¥ç€è·å–lock2çš„å¯¹è±¡é”ã€‚è¿™ä¹ˆåšä¸»è¦æ˜¯ä¸ºäº†é˜²æ­¢çº¿ç¨‹1å¯åŠ¨ä¸€ä¸‹å­å°±è¿ç»­è·å¾—äº†lock1å’Œlock2ä¸¤ä¸ªå¯¹è±¡çš„å¯¹è±¡é”; çº¿ç¨‹2çš„run)(æ–¹æ³•ä¸­åŒæ­¥ä»£ç å—å…ˆè·å–lock2çš„å¯¹è±¡é”ï¼Œæ¥ç€è·å–lock1çš„å¯¹è±¡é”ï¼Œå½“ç„¶è¿™æ—¶lock1çš„å¯¹è±¡é”å·²ç»è¢«çº¿ç¨‹1é”æŒæœ‰ï¼Œçº¿ç¨‹2è‚¯å®šæ˜¯è¦ç­‰å¾…çº¿ç¨‹1é‡Šæ”¾lock1çš„å¯¹è±¡é”çš„ è¿™æ ·ï¼Œçº¿ç¨‹1â€³ç¡è§‰â€ç¡å®Œï¼Œçº¿ç¨‹2å·²ç»è·å–äº†lock2çš„å¯¹è±¡é”äº†ï¼Œçº¿ç¨‹1æ­¤æ—¶å°è¯•è·å–lock2çš„å¯¹è±¡é”ï¼Œä¾¿è¢«é˜»å¡ï¼Œæ­¤æ—¶ä¸€ä¸ªæ­»é”å°±å½¢æˆäº†ã€‚ ä»£ç å®ç°ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152public class DeadLock { public void run() { TestDeadLock tl = new TestDeadLock(); new Thread(tl, "çº¿ç¨‹A").start(); new Thread(tl, "çº¿ç¨‹B").start(); } class TestDeadLock implements Runnable { private Object objA = new Object(); private Object objB = new Object(); private boolean flag = true; @Override public void run() { if (flag) { flag = false; synchronized (objA) { System.out.println(Thread.currentThread().getName() + "é”ä½èµ„æºAï¼Œç­‰å¾…èµ„æºB"); try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (objB) { System.out.println(Thread.currentThread().getName() + "è·å¾—èµ„æºB"); } } } else { flag = true; synchronized (objB) { System.out.println(Thread.currentThread().getName() + "é”ä½èµ„æºBï¼Œç­‰å¾…èµ„æºA"); try { Thread.sleep(100); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (objA) { System.out.println(Thread.currentThread().getName() + "è·å¾—èµ„æºA"); } } } } } public static void main(String[] args) { new DeadLock().run(); }}è¾“å‡ºç»“æœæ˜¯ï¼šçº¿ç¨‹Aé”ä½èµ„æºAï¼Œç­‰å¾…èµ„æºBçº¿ç¨‹Bé”ä½èµ„æºBï¼Œç­‰å¾…èµ„æºA Javaä¸­å¦‚ä½•é¿å…æ­»é” æ­»é”å‘ç”Ÿæ˜¯å› ä¸ºä¸¤ä¸ªçº¿ç¨‹è¯•å›¾è·å–è¢«å¯¹æ–¹æŒæœ‰çš„èµ„æºã€‚ä½†æ˜¯è¦æƒ³å‘ç”Ÿè¿™ç§æƒ…å†µï¼Œå¿…é¡»æ»¡è¶³ä»¥ä¸‹å››ä¸ªæ¡ä»¶ï¼š ç›¸äº’æ’æ–¥ â€”â€” è‡³å°‘ä¸€ä¸ªè¿›ç¨‹å¿…é¡»å¤„äºéå…±äº«æ¨¡å¼ï¼› ä¿æŒå¹¶ç­‰å¾… â€”â€” å¿…é¡»æœ‰ä¸€ä¸ªè¿›ç¨‹æŒæœ‰ä¸€ä¸ªèµ„æºå¹¶ç­‰å¾…å¦ä¸€ä¸ªèµ„æºï¼› æ²¡æœ‰æŠ¢å  â€”â€” èµ„æºä¸èƒ½è¢«æŠ¢å ï¼› å¾ªç¯ç­‰å¾… â€”â€” å­˜åœ¨è¿›ç¨‹é›†åˆã€‚ é€šè¿‡ä¸­æ–­å¾ªç¯ç­‰å¾…å¯ä»¥é¿å…æ­»é”ã€‚å¯ä»¥é€šè¿‡åœ¨ä»£ç ä¸­æŒ‡å®šè·å–å’Œé‡Šæ”¾é”çš„é¡ºåºæ¥è¾¾åˆ°è¿™ä¸€ç›®çš„ã€‚ å¦‚æœå¤šä¸ªé”é€šè¿‡ä¸€è‡´çš„é¡ºåºè¢«è·å–å’Œé‡Šæ”¾ï¼Œä¸ä¼šæœ‰äº’ç›¸ç­‰å¾…å¯¹æ–¹é‡Šæ”¾é”çš„æƒ…å†µã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨Executoræ¡†æ¶ æ¯æ¬¡æ‰§è¡Œä»»åŠ¡åˆ›å»ºçº¿ç¨‹ new Thread()æ¯”è¾ƒæ¶ˆè€—æ€§èƒ½ï¼Œåˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ˜¯æ¯”è¾ƒè€—æ—¶ã€è€—èµ„æºçš„ã€‚ è°ƒç”¨ new Thread()åˆ›å»ºçš„çº¿ç¨‹ç¼ºä¹ç®¡ç†ï¼Œè¢«ç§°ä¸ºé‡çº¿ç¨‹ï¼Œè€Œä¸”å¯ä»¥æ— é™åˆ¶çš„åˆ›å»ºï¼Œçº¿ç¨‹ä¹‹é—´çš„ç›¸äº’ç«äº‰ä¼šå¯¼è‡´è¿‡å¤šå ç”¨ç³»ç»Ÿèµ„æºè€Œå¯¼è‡´ç³»ç»Ÿç˜«ç—ªï¼Œè¿˜æœ‰çº¿ç¨‹ä¹‹é—´çš„é¢‘ç¹äº¤æ›¿ä¹Ÿä¼šæ¶ˆè€—å¾ˆå¤šç³»ç»Ÿèµ„æºã€‚ ç›´æ¥ä½¿ç”¨new Thread() å¯åŠ¨çš„çº¿ç¨‹ä¸åˆ©äºæ‰©å±•ï¼Œæ¯”å¦‚å®šæ—¶æ‰§è¡Œã€å®šæœŸæ‰§è¡Œã€å®šæ—¶å®šæœŸæ‰§è¡Œã€çº¿ç¨‹ä¸­æ–­ç­‰éƒ½ä¸ä¾¿å®ç°ã€‚ èƒ½å¤ç”¨å·²å­˜åœ¨å¹¶ç©ºé—²çš„çº¿ç¨‹ä»è€Œå‡å°‘çº¿ç¨‹å¯¹è±¡çš„åˆ›å»ºä»è€Œå‡å°‘äº†æ¶ˆäº¡çº¿ç¨‹çš„å¼€é”€ã€‚ å¯æœ‰æ•ˆæ§åˆ¶æœ€å¤§å¹¶å‘çº¿ç¨‹æ•°ï¼Œæé«˜ç³»ç»Ÿèµ„æºä½¿ç”¨ç‡ï¼ŒåŒæ—¶é¿å…è¿‡å¤šèµ„æºç«äº‰ã€‚ æ¡†æ¶ä¸­å·²ç»æœ‰å®šæ—¶ã€å®šæœŸã€å•çº¿ç¨‹ã€å¹¶å‘æ•°æ§åˆ¶ç­‰åŠŸèƒ½ã€‚ åœ¨Java Concurrency APIä¸­æœ‰å“ªäº›åŸå­ç±» åŸå­ç±»ï¼šAtomicBooleanï¼ŒAtomicIntegerï¼ŒAtomicLongï¼ŒAtomicReference åŸå­æ•°ç»„ï¼šAtomicIntegerArray,AtomicLongArrayï¼ŒAtomicReferenceArray åŸå­å±æ€§æ›´æ–°å™¨ï¼šAtomicLongFieldUpdater,AtomicIntegerFieldUpdaterï¼ŒAtomicReferenceFieldUpdater è§£å†³ABAé—®é¢˜çš„åŸå­ç±»ï¼šAtomicMarkableReference(é€šè¿‡å¼•å…¥ä¸€ä¸ªbooleanæ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰,AtomicStampedReferenceï¼ˆé€šè¿‡å¼•å…¥ä¸€ä¸ªintæ¥ç´¯åŠ æ¥åæ˜ ä¸­é—´æœ‰æ²¡æœ‰å˜è¿‡ï¼‰ Java Concurrency APIä¸­çš„Lockæ¥å£(Lock interface)æ˜¯ä»€ä¹ˆï¼Ÿå¯¹æ¯”åŒæ­¥å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ Lockæ¥å£æ¯”åŒæ­¥æ–¹æ³•å’ŒåŒæ­¥å—æä¾›äº†æ›´å…·æ‰©å±•æ€§çš„é”æ“ä½œã€‚ä»–ä»¬å…è®¸æ›´çµæ´»çš„ç»“æ„ï¼Œå¯ä»¥å…·æœ‰å®Œå…¨ä¸åŒçš„æ€§è´¨ï¼Œå¹¶ä¸”å¯ä»¥æ”¯æŒå¤šä¸ªç›¸å…³ç±»çš„æ¡ä»¶å¯¹è±¡ã€‚ å®ƒçš„ä¼˜åŠ¿æœ‰ï¼š å¯ä»¥ä½¿é”æ›´å…¬å¹³ å¯ä»¥ä½¿çº¿ç¨‹åœ¨ç­‰å¾…é”çš„æ—¶å€™å“åº”ä¸­æ–­ å¯ä»¥è®©çº¿ç¨‹å°è¯•è·å–é”ï¼Œå¹¶åœ¨æ— æ³•è·å–é”çš„æ—¶å€™ç«‹å³è¿”å›æˆ–è€…ç­‰å¾…ä¸€æ®µæ—¶é—´ å¯ä»¥åœ¨ä¸åŒçš„èŒƒå›´ï¼Œä»¥ä¸åŒçš„é¡ºåºè·å–å’Œé‡Šæ”¾é” æ•´ä½“ä¸Šæ¥è¯´Lockæ˜¯synchronizedçš„æ‰©å±•ç‰ˆï¼ŒLockæä¾›äº†æ— æ¡ä»¶çš„ã€å¯è½®è¯¢çš„(tryLockæ–¹æ³•)ã€å®šæ—¶çš„(tryLockå¸¦å‚æ–¹æ³•)ã€å¯ä¸­æ–­çš„(lockInterruptibly)ã€å¯å¤šæ¡ä»¶é˜Ÿåˆ—çš„(newConditionæ–¹æ³•)é”æ“ä½œã€‚å¦å¤–Lockçš„å®ç°ç±»åŸºæœ¬éƒ½æ”¯æŒéå…¬å¹³é”(é»˜è®¤)å’Œå…¬å¹³é”ï¼Œsynchronizedåªæ”¯æŒéå…¬å¹³é”ï¼Œå½“ç„¶ï¼Œåœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéå…¬å¹³é”æ˜¯é«˜æ•ˆçš„é€‰æ‹©ã€‚ ä»€ä¹ˆæ˜¯é˜»å¡é˜Ÿåˆ—ï¼Ÿé˜»å¡é˜Ÿåˆ—çš„å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿå¦‚ä½•ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Ÿ é˜»å¡é˜Ÿåˆ—ï¼ˆBlockingQueueï¼‰æ˜¯ä¸€ä¸ªæ”¯æŒä¸¤ä¸ªé™„åŠ æ“ä½œçš„é˜Ÿåˆ—ã€‚ è¿™ä¸¤ä¸ªé™„åŠ çš„æ“ä½œæ˜¯ï¼šåœ¨é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å˜ä¸ºéç©ºã€‚å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å‚¨å…ƒç´ çš„çº¿ç¨‹ä¼šç­‰å¾…é˜Ÿåˆ—å¯ç”¨ã€‚ é˜»å¡é˜Ÿåˆ—å¸¸ç”¨äºç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çš„åœºæ™¯ï¼Œç”Ÿäº§è€…æ˜¯å¾€é˜Ÿåˆ—é‡Œæ·»åŠ å…ƒç´ çš„çº¿ç¨‹ï¼Œæ¶ˆè´¹è€…æ˜¯ä»é˜Ÿåˆ—é‡Œæ‹¿å…ƒç´ çš„çº¿ç¨‹ã€‚é˜»å¡é˜Ÿåˆ—å°±æ˜¯ç”Ÿäº§è€…å­˜æ”¾å…ƒç´ çš„å®¹å™¨ï¼Œè€Œæ¶ˆè´¹è€…ä¹Ÿåªä»å®¹å™¨é‡Œæ‹¿å…ƒç´ ã€‚ JDK7æä¾›äº†7ä¸ªé˜»å¡é˜Ÿåˆ—ã€‚åˆ†åˆ«æ˜¯ï¼š ArrayBlockingQueue ï¼šä¸€ä¸ªç”±æ•°ç»„ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ LinkedBlockingQueue ï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æœ‰ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ PriorityBlockingQueue ï¼šä¸€ä¸ªæ”¯æŒä¼˜å…ˆçº§æ’åºçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ DelayQueueï¼šä¸€ä¸ªä½¿ç”¨ä¼˜å…ˆçº§é˜Ÿåˆ—å®ç°çš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ SynchronousQueueï¼šä¸€ä¸ªä¸å­˜å‚¨å…ƒç´ çš„é˜»å¡é˜Ÿåˆ—ã€‚ LinkedTransferQueueï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„æ— ç•Œé˜»å¡é˜Ÿåˆ—ã€‚ LinkedBlockingDequeï¼šä¸€ä¸ªç”±é“¾è¡¨ç»“æ„ç»„æˆçš„åŒå‘é˜»å¡é˜Ÿåˆ—ã€‚ Java 5ä¹‹å‰å®ç°åŒæ­¥å­˜å–æ—¶ï¼Œå¯ä»¥ä½¿ç”¨æ™®é€šçš„ä¸€ä¸ªé›†åˆï¼Œç„¶ååœ¨ä½¿ç”¨çº¿ç¨‹çš„åä½œå’Œçº¿ç¨‹åŒæ­¥å¯ä»¥å®ç°ç”Ÿäº§è€…ï¼Œæ¶ˆè´¹è€…æ¨¡å¼ï¼Œä¸»è¦çš„æŠ€æœ¯å°±æ˜¯ç”¨å¥½ï¼Œwait ,notify,notifyAll,sychronizedè¿™äº›å…³é”®å­—ã€‚è€Œåœ¨java 5ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨é˜»å¡é˜Ÿåˆ—æ¥å®ç°ï¼Œæ­¤æ–¹å¼å¤§å¤§ç®€å°‘äº†ä»£ç é‡ï¼Œä½¿å¾—å¤šçº¿ç¨‹ç¼–ç¨‹æ›´åŠ å®¹æ˜“ï¼Œå®‰å…¨æ–¹é¢ä¹Ÿæœ‰ä¿éšœã€‚ BlockingQueueæ¥å£æ˜¯Queueçš„å­æ¥å£ï¼Œå®ƒçš„ä¸»è¦ç”¨é€”å¹¶ä¸æ˜¯ä½œä¸ºå®¹å™¨ï¼Œè€Œæ˜¯ä½œä¸ºçº¿ç¨‹åŒæ­¥çš„çš„å·¥å…·ï¼Œå› æ­¤ä»–å…·æœ‰ä¸€ä¸ªå¾ˆæ˜æ˜¾çš„ç‰¹æ€§ï¼Œå½“ç”Ÿäº§è€…çº¿ç¨‹è¯•å›¾å‘BlockingQueueæ”¾å…¥å…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™çº¿ç¨‹è¢«é˜»å¡ï¼Œå½“æ¶ˆè´¹è€…çº¿ç¨‹è¯•å›¾ä»ä¸­å–å‡ºä¸€ä¸ªå…ƒç´ æ—¶ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œåˆ™è¯¥çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œæ­£æ˜¯å› ä¸ºå®ƒæ‰€å…·æœ‰è¿™ä¸ªç‰¹æ€§ï¼Œæ‰€ä»¥åœ¨ç¨‹åºä¸­å¤šä¸ªçº¿ç¨‹äº¤æ›¿å‘BlockingQueueä¸­æ”¾å…¥å…ƒç´ ï¼Œå–å‡ºå…ƒç´ ï¼Œå®ƒå¯ä»¥å¾ˆå¥½çš„æ§åˆ¶çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ é˜»å¡é˜Ÿåˆ—ä½¿ç”¨æœ€ç»å…¸çš„åœºæ™¯å°±æ˜¯socketå®¢æˆ·ç«¯æ•°æ®çš„è¯»å–å’Œè§£æï¼Œè¯»å–æ•°æ®çš„çº¿ç¨‹ä¸æ–­å°†æ•°æ®æ”¾å…¥é˜Ÿåˆ—ï¼Œç„¶åè§£æçº¿ç¨‹ä¸æ–­ä»é˜Ÿåˆ—å–æ•°æ®è§£æã€‚ ä»€ä¹ˆå«çº¿ç¨‹å®‰å…¨ï¼Ÿservletæ˜¯çº¿ç¨‹å®‰å…¨å—? çº¿ç¨‹å®‰å…¨æ˜¯ç¼–ç¨‹ä¸­çš„æœ¯è¯­ï¼ŒæŒ‡æŸä¸ªå‡½æ•°ã€å‡½æ•°åº“åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­è¢«è°ƒç”¨æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡ï¼Œä½¿ç¨‹åºåŠŸèƒ½æ­£ç¡®å®Œæˆã€‚ Servletä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œservletæ˜¯å•å®ä¾‹å¤šçº¿ç¨‹çš„ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®åŒä¸€ä¸ªæ–¹æ³•ï¼Œæ˜¯ä¸èƒ½ä¿è¯å…±äº«å˜é‡çš„çº¿ç¨‹å®‰å…¨æ€§çš„ã€‚ Struts2çš„actionæ˜¯å¤šå®ä¾‹å¤šçº¿ç¨‹çš„ï¼Œæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ¯ä¸ªè¯·æ±‚è¿‡æ¥éƒ½ä¼šnewä¸€ä¸ªæ–°çš„actionåˆ†é…ç»™è¿™ä¸ªè¯·æ±‚ï¼Œè¯·æ±‚å®Œæˆåé”€æ¯ã€‚ SpringMVCçš„Controlleræ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿä¸æ˜¯çš„ï¼Œå’ŒServletç±»ä¼¼çš„å¤„ç†æµç¨‹ Struts2å¥½å¤„æ˜¯ä¸ç”¨è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼›Servletå’ŒSpringMVCéœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Œä½†æ˜¯æ€§èƒ½å¯ä»¥æå‡ä¸ç”¨å¤„ç†å¤ªå¤šçš„gcï¼Œå¯ä»¥ä½¿ç”¨ThreadLocalæ¥å¤„ç†å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚ Javaä¸­interrupted å’Œ isInterruptedæ–¹æ³•çš„åŒºåˆ« interrupt interruptæ–¹æ³•ç”¨äºä¸­æ–­çº¿ç¨‹ã€‚è°ƒç”¨è¯¥æ–¹æ³•çš„çº¿ç¨‹çš„çŠ¶æ€ä¸ºå°†è¢«ç½®ä¸ºâ€ä¸­æ–­â€çŠ¶æ€ã€‚ æ³¨æ„ï¼šçº¿ç¨‹ä¸­æ–­ä»…ä»…æ˜¯ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ä½ï¼Œä¸ä¼šåœæ­¢çº¿ç¨‹ã€‚éœ€è¦ç”¨æˆ·è‡ªå·±å»ç›‘è§†çº¿ç¨‹çš„çŠ¶æ€ä¸ºå¹¶åšå¤„ç†ã€‚æ”¯æŒçº¿ç¨‹ä¸­æ–­çš„æ–¹æ³•ï¼ˆä¹Ÿå°±æ˜¯çº¿ç¨‹ä¸­æ–­åä¼šæŠ›å‡ºinterruptedExceptionçš„æ–¹æ³•ï¼‰å°±æ˜¯åœ¨ç›‘è§†çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œä¸€æ—¦çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€è¢«ç½®ä¸ºâ€œä¸­æ–­çŠ¶æ€â€ï¼Œå°±ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ã€‚ interrupted æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œå¹¶ä¸”æ¸…é™¤åŸçŠ¶æ€ã€‚å¦‚æœä¸€ä¸ªçº¿ç¨‹è¢«ä¸­æ–­äº†ï¼Œç¬¬ä¸€æ¬¡è°ƒç”¨interruptedåˆ™è¿”å›trueï¼Œç¬¬äºŒæ¬¡å’Œåé¢çš„å°±è¿”å›falseäº†ã€‚ isInterrupted ä»…ä»…æ˜¯æŸ¥è¯¢å½“å‰çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>é¢è¯•é¢˜</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>å¤šçº¿ç¨‹</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è§‚å¯Ÿè€…æ¨¡å¼]]></title>
    <url>%2Fposts%2F4eed4967.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰ï¼Œåˆå« å‘å¸ƒ-è®¢é˜…ï¼ˆPublish/Subscribeï¼‰æ¨¡å¼ã€æ¨¡å‹-è§†å›¾ï¼ˆModel/Viewï¼‰æ¨¡å¼ã€æº-ç›‘å¬å™¨ï¼ˆSource/Listenerï¼‰æ¨¡å¼ æˆ– ä»å±è€…ï¼ˆDependentsï¼‰æ¨¡å¼ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ æ˜¯å¯¹è±¡çš„è¡Œä¸ºæ¨¡å¼ï¼Œå®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œä¸€ä¸ªä¸»é¢˜å¯¹è±¡å¯è¢«å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬ï¼Œä½¿å¾—æ¯å½“ä¸»é¢˜å¯¹è±¡çŠ¶æ€å˜åŒ–æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½ä¼šå¾—åˆ°é€šçŸ¥å¹¶è¢«è‡ªåŠ¨æ›´æ–°ã€‚ è§‚å¯Ÿè€…æ¨¡å¼ æ ¸å¿ƒï¼šæ¾è€¦åˆè§‚å¯Ÿè€…ä¸è¢«è§‚å¯Ÿè€…ï¼Œä»¥ç±»ä¼¼äºæ¶ˆæ¯/å¹¿æ’­å‘é€çš„æœºåˆ¶è”åŠ¨ä¸¤è€…ï¼Œä½¿è¢«è§‚å¯Ÿè€…çš„å˜åŠ¨èƒ½é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„è§‚å¯Ÿè€…ä»¬ï¼Œä»è€Œåšå‡ºç›¸åº”çš„å“åº”ã€‚ ä¸»è¦ä½œç”¨ å½“ç³»ç»Ÿä¸€æ–¹è¡Œä¸ºä¾èµ–äºå¦ä¸€æ–¹è¡Œä¸ºçš„å˜åŠ¨æ—¶ï¼Œå¯ä½¿ç”¨ è§‚å¯Ÿè€…æ¨¡å¼ æ¾è€¦åˆè”åŠ¨åŒæ–¹ï¼Œä½¿å¾—ä¸€æ–¹çš„å˜åŠ¨å¯ä»¥é€šçŸ¥åˆ°æ„Ÿå…´è¶£çš„å¦ä¸€æ–¹å¯¹è±¡ï¼Œä»è€Œè®©å¦ä¸€æ–¹å¯¹è±¡å¯¹æ­¤åšå‡ºå“åº”ã€‚ UMLç±»å›¾ è§’è‰² æŠ½è±¡ä¸»é¢˜ï¼ˆSubjectï¼‰ï¼šç›®æ ‡åˆç§°ä¸ºä¸»é¢˜ï¼ŒæŒ‡è¢«è§‚å¯Ÿçš„å¯¹è±¡ï¼ˆObservableï¼‰ã€‚åœ¨ç›®æ ‡ä¸­å®šä¹‰äº†ä¸€ä¸ªè§‚å¯Ÿè€…é›†åˆï¼Œä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯ä»¥æ¥å—ä»»æ„æ•°é‡çš„è§‚å¯Ÿè€…æ¥è§‚å¯Ÿï¼Œå®ƒæä¾›ä¸€ç³»åˆ—æ–¹æ³•æ¥å¢åŠ å’Œåˆ é™¤è§‚å¯Ÿè€…å¯¹è±¡ï¼ŒåŒæ—¶å®ƒå®šä¹‰äº†é€šçŸ¥æ–¹æ³•notify()ã€‚ç›®æ ‡ç±»å¯ä»¥æ˜¯æ¥å£ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»æˆ–å…·ä½“ç±»ã€‚ å…·ä½“ä¸»é¢˜ï¼ˆConcreteSubjectï¼‰ï¼šå…·ä½“è¢«è§‚å¯Ÿè€…ï¼Œæ˜¯ç›®æ ‡ç±»ï¼ˆæŠ½è±¡ä¸»é¢˜ï¼‰çš„å­ç±»ï¼Œé€šå¸¸å®ƒåŒ…å«æœ‰ç»å¸¸å‘ç”Ÿæ”¹å˜çš„æ•°æ®ï¼Œå½“å®ƒçš„çŠ¶æ€å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå‘å®ƒçš„å„ä¸ªè§‚å¯Ÿè€…å‘å‡ºé€šçŸ¥ï¼›åŒæ—¶å®ƒè¿˜å®ç°äº†åœ¨ç›®æ ‡ç±»ä¸­å®šä¹‰çš„æŠ½è±¡ä¸šåŠ¡é€»è¾‘æ–¹æ³•ï¼ˆå¦‚æœæœ‰çš„è¯ï¼‰ã€‚å¦‚æœæ— é¡»æ‰©å±•ç›®æ ‡ç±»ï¼Œåˆ™å…·ä½“ç›®æ ‡ç±»å¯ä»¥çœç•¥ã€‚ æŠ½è±¡è§‚å¯Ÿè€…ï¼ˆObserverï¼‰ï¼šè§‚å¯Ÿè€…å°†å¯¹è§‚å¯Ÿç›®æ ‡çš„æ”¹å˜åšå‡ºååº”ï¼Œè§‚å¯Ÿè€…ä¸€èˆ¬å®šä¹‰ä¸ºæ¥å£ï¼Œè¯¥æ¥å£å£°æ˜äº†æ›´æ–°æ•°æ®çš„æ–¹æ³•update()ï¼Œå› æ­¤åˆç§°ä¸ºæŠ½è±¡è§‚å¯Ÿè€…ã€‚ å…·ä½“è§‚å¯Ÿè€…ï¼ˆConcrereObserverï¼‰ï¼šåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸­ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å…·ä½“ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œå®ƒå­˜å‚¨å…·ä½“è§‚å¯Ÿè€…çš„æœ‰å…³çŠ¶æ€ï¼Œè¿™äº›çŠ¶æ€éœ€è¦å’Œå…·ä½“ç›®æ ‡çš„çŠ¶æ€ä¿æŒä¸€è‡´ï¼›å®ƒå®ç°äº†åœ¨æŠ½è±¡è§‚å¯Ÿè€…Observerä¸­å®šä¹‰çš„update()æ–¹æ³•ã€‚é€šå¸¸åœ¨å®ç°æ—¶ï¼Œå¯ä»¥è°ƒç”¨å…·ä½“ç›®æ ‡ç±»çš„attach()æ–¹æ³•å°†è‡ªå·±æ·»åŠ åˆ°ç›®æ ‡ç±»çš„é›†åˆä¸­æˆ–é€šè¿‡detach()æ–¹æ³•å°†è‡ªå·±ä»ç›®æ ‡ç±»çš„é›†åˆä¸­åˆ é™¤ã€‚ æ¨¡å¼ä¼˜ç‚¹ è§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…æ˜¯æ¾è€¦åˆï¼ˆæŠ½è±¡è€¦åˆï¼‰çš„ï¼Œç¬¦åˆ ä¾èµ–å€’ç½®åŸåˆ™ï¼› åˆ†ç¦»äº†è¡¨ç¤ºå±‚ï¼ˆè§‚å¯Ÿè€…ï¼‰å’Œæ•°æ®é€»è¾‘å±‚ï¼ˆè¢«è§‚å¯Ÿè€…ï¼‰ï¼Œå¹¶ä¸”å»ºç«‹äº†ä¸€å¥—è§¦å‘æœºåˆ¶ï¼Œä½¿å¾—æ•°æ®çš„å˜åŒ–å¯ä»¥å“åº”åˆ°å¤šä¸ªè¡¨ç¤ºå±‚ä¸Šï¼› æ”¯æŒå¹¿æ’­é€šä¿¡ï¼Œå®ç°äº†ä¸€å¯¹å¤šçš„é€šè®¯æœºåˆ¶ï¼Œæ”¯æŒäº‹ä»¶æ³¨å†Œæœºåˆ¶ï¼Œæ”¯æŒå…´è¶£åˆ†å‘æœºåˆ¶ï¼Œå½“è¢«è§‚å¯Ÿè€…è§¦å‘äº‹ä»¶æ—¶ï¼Œåªæœ‰æ„Ÿå…´è¶£çš„è§‚å¯Ÿè€…å¯ä»¥æ¥æ”¶åˆ°é€šçŸ¥ï¼› è§‚å¯Ÿè€…æ¨¡å¼æ»¡è¶³ â€œå¼€é—­åŸåˆ™â€ çš„è¦æ±‚ï¼Œå¢åŠ æ–°çš„å…·ä½“è§‚å¯Ÿè€…æ— é¡»ä¿®æ”¹åŸæœ‰ç³»ç»Ÿä»£ç ï¼Œåœ¨å…·ä½“è§‚å¯Ÿè€…ä¸è§‚å¯Ÿç›®æ ‡ä¹‹é—´ä¸å­˜åœ¨å…³è”å…³ç³»çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æ–°çš„è§‚å¯Ÿç›®æ ‡ä¹Ÿå¾ˆæ–¹ä¾¿ã€‚ æ¨¡å¼ç¼ºç‚¹ å¦‚æœä¸€ä¸ªè§‚å¯Ÿç›®æ ‡å¯¹è±¡æœ‰å¾ˆå¤šç›´æ¥å’Œé—´æ¥è§‚å¯Ÿè€…ï¼Œå°†æ‰€æœ‰çš„è§‚å¯Ÿè€…éƒ½é€šçŸ¥åˆ°ä¼šèŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼› äº‹ä»¶é€šçŸ¥å‘ˆçº¿æ€§å…³ç³»ï¼Œå¦‚æœå…¶ä¸­ä¸€ä¸ªè§‚å¯Ÿè€…å¤„ç†äº‹ä»¶å¡å£³ï¼Œä¼šå½±å“åç»­çš„è§‚å¯Ÿè€…æ¥æ”¶è¯¥äº‹ä»¶ï¼› å¦‚æœè§‚å¯Ÿè€…å’Œè¢«è§‚å¯Ÿè€…ä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–ï¼Œåˆ™å¯èƒ½é€ æˆä¸¤è€…ä¹‹é—´çš„å¾ªç¯è°ƒç”¨ï¼Œå¯¼è‡´ç³»ç»Ÿå´©æºƒï¼› è§‚å¯Ÿè€…æ¨¡å¼æ²¡æœ‰ç›¸åº”çš„æœºåˆ¶è®©è§‚å¯Ÿè€…çŸ¥é“æ‰€è§‚å¯Ÿçš„ç›®æ ‡å¯¹è±¡æ˜¯æ€ä¹ˆå‘ç”Ÿå˜åŒ–çš„ï¼Œè€Œä»…ä»…åªæ˜¯çŸ¥é“è§‚å¯Ÿç›®æ ‡å‘ç”Ÿäº†å˜åŒ–ã€‚ é€‚ç”¨åœºæ™¯ ä¸€ä¸ªæŠ½è±¡æ¨¡å‹æœ‰ä¸¤ä¸ªæ–¹é¢ï¼Œå…¶ä¸­ä¸€ä¸ªæ–¹é¢ä¾èµ–äºå¦ä¸€ä¸ªæ–¹é¢ï¼Œå°†è¿™ä¸¤ä¸ªæ–¹é¢å°è£…åœ¨ç‹¬ç«‹çš„å¯¹è±¡ä¸­ä½¿å®ƒä»¬å¯ä»¥å„è‡ªç‹¬ç«‹åœ°æ”¹å˜å’Œå¤ç”¨ã€‚ ä¸€ä¸ªå¯¹è±¡çš„æ”¹å˜å°†å¯¼è‡´ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–å¯¹è±¡ä¹Ÿå‘ç”Ÿæ”¹å˜ï¼Œè€Œå¹¶ä¸çŸ¥é“å…·ä½“æœ‰å¤šå°‘å¯¹è±¡å°†å‘ç”Ÿæ”¹å˜ï¼Œä¹Ÿä¸çŸ¥é“è¿™äº›å¯¹è±¡æ˜¯è°ã€‚ éœ€è¦åœ¨ç³»ç»Ÿä¸­åˆ›å»ºä¸€ä¸ªè§¦å‘é“¾ï¼ŒAå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Bå¯¹è±¡ï¼ŒBå¯¹è±¡çš„è¡Œä¸ºå°†å½±å“Cå¯¹è±¡â€¦â€¦ï¼Œå¯ä»¥ä½¿ç”¨è§‚å¯Ÿè€…æ¨¡å¼åˆ›å»ºä¸€ç§é“¾å¼è§¦å‘æœºåˆ¶ã€‚ å®ç°ç±»ä¼¼å¹¿æ’­æœºåˆ¶çš„åŠŸèƒ½ï¼Œæ— éœ€çŸ¥é“å…·ä½“æ”¶å¬è€…ï¼Œåªéœ€åˆ†å‘å¹¿æ’­ï¼Œç³»ç»Ÿä¸­æ„Ÿå…´è¶£çš„å¯¹è±¡ä¼šè‡ªåŠ¨æ¥æ”¶è¯¥å¹¿æ’­ï¼› ä½¿ç”¨æ­¥éª¤ æŠ½è±¡è§‚å¯Ÿè€… 123456789101112package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: æŠ½è±¡è§‚å¯Ÿè€… */public interface IObserver&lt;E&gt; { /** * æ›´æ–°æ•°æ® */ void update(E event);} æŠ½è±¡ä¸»é¢˜è€… 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: æŠ½è±¡ä¸»é¢˜ */public interface ISubject&lt;E&gt; { /** * æ³¨å†Œ * * @param observer * @return */ boolean attach(IObserver&lt;E&gt; observer); /** * å–æ¶ˆæ³¨å†Œ * * @param observer * @return */ boolean detach(IObserver&lt;E&gt; observer); /** * é€šçŸ¥ * * @param event */ void notify(E event);} å…·ä½“è§‚å¯Ÿè€… 12345678910111213package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: å…·ä½“è§‚å¯Ÿè€… */public class ConcreteObserver&lt;E&gt; implements IObserver&lt;E&gt; { @Override public void update(E event) { System.out.println("receive eventï¼š" + event); }} å…·ä½“ä¸»é¢˜è€… 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.observer.demoOne;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: å…·ä½“ä¸»é¢˜è€… */public class ConcreteSubject&lt;E&gt; implements ISubject&lt;E&gt; { /** * è§‚å¯Ÿè€…é›†åˆ */ private List&lt;IObserver&lt;E&gt;&gt; mObservers = new ArrayList&lt;&gt;(); @Override public boolean attach(IObserver&lt;E&gt; observer) { return !this.mObservers.contains(observer) &amp;&amp; this.mObservers.add(observer); } @Override public boolean detach(IObserver&lt;E&gt; observer) { return this.mObservers.remove(observer); } @Override public void notify(E event) { for (IObserver&lt;E&gt; observer : this.mObservers) { observer.update(event); } }} å®¢æˆ·ç«¯è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.observer.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { // è¢«è§‚å¯Ÿè€… ISubject&lt;String&gt; observable = new ConcreteSubject&lt;&gt;(); // è§‚å¯Ÿè€… IObserver&lt;String&gt; observer = new ConcreteObserver&lt;&gt;(); // æ³¨å†Œ observable.attach(observer); // é€šçŸ¥ observable.notify("hello"); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ä»£ç†æ¨¡å¼]]></title>
    <url>%2Fposts%2Fe3d6aa41.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ ç»™ç›®æ ‡å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ã€‚ ä¸»è¦ä½œç”¨ é€šè¿‡å¼•å…¥ä»£ç†å¯¹è±¡çš„æ–¹å¼æ¥é—´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ã€‚ è§£å†³çš„é—®é¢˜ é˜²æ­¢ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ç»™ç³»ç»Ÿå¸¦æ¥çš„ä¸å¿…è¦å¤æ‚æ€§ã€‚ æ¨¡å¼åŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ æŠ½è±¡ä¸»é¢˜è§’è‰²ï¼ˆSubjectï¼‰ï¼šæŠ½è±¡ä¸»é¢˜ç±» çš„ä¸»è¦èŒè´£æ˜¯å£°æ˜ çœŸå®ä¸»é¢˜ ä¸ ä»£ç† çš„å…±åŒæ¥å£æ–¹æ³•ï¼Œè¯¥ç±»å¯ä»¥æ˜¯æ¥å£ä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼› çœŸå®ä¸»é¢˜è§’è‰²ï¼ˆRealSubjectï¼‰ï¼šè¯¥ç±»ä¹Ÿè¢«ç§°ä¸º è¢«å§”æ‰˜ç±» æˆ– è¢«ä»£ç†ç±»ï¼Œè¯¥ç±»å®šä¹‰äº†ä»£ç†æ‰€è¡¨ç¤ºçš„çœŸå®å¯¹è±¡ï¼Œæ˜¯è´Ÿè´£æ‰§è¡Œç³»ç»ŸçœŸæ­£çš„é€»è¾‘ä¸šåŠ¡å¯¹è±¡ï¼› ä»£ç†ä¸»é¢˜è§’è‰²ï¼ˆProxyï¼‰ï¼šä¹Ÿè¢«ç§°ä¸º å§”æ‰˜ç±» æˆ– ä»£ç†ç±»ï¼Œå…¶å†…éƒ¨æŒæœ‰ RealSubject çš„å¼•ç”¨ï¼Œå› æ­¤å…·å¤‡å®Œå…¨çš„å¯¹ RealSubject çš„ä»£ç†æƒï¼› æ¨¡å¼ä¼˜ç‚¹ åè°ƒè°ƒç”¨è€…å’Œè¢«è°ƒç”¨è€…ï¼Œé™ä½äº†ç³»ç»Ÿçš„è€¦åˆåº¦ã€‚ ä»£ç†å¯¹è±¡ä½œä¸ºå®¢æˆ·ç«¯å’Œç›®æ ‡å¯¹è±¡ä¹‹é—´çš„ä¸­ä»‹ï¼Œèµ·åˆ°äº†ä¿æŠ¤ç›®æ ‡å¯¹è±¡çš„ä½œç”¨ã€‚ èŒè´£æ¸…æ™°ï¼šçœŸå®ä¸»é¢˜è§’è‰² åªè´Ÿè´£å®ç°å®é™…çš„ä¸šåŠ¡é€»è¾‘ï¼Œæ— éœ€å…³å¿ƒå…¶ä»–éæœ¬èŒè´£çš„äº‹åŠ¡ï¼Œé€šè¿‡åæœŸä»£ç†çš„è®¿é—®æ§åˆ¶ï¼Œå¯ä»¥æ‰©å±•æˆ–ç¼©å‡å®é™…äº‹åŠ¡ï¼Œç¬¦åˆè®¾è®¡æ¨¡å¼ å•ä¸€èŒè´£åŸåˆ™ï¼Œä»£ç ç®€æ´æ¸…æ™°ï¼› é«˜æ‰©å±•æ€§ï¼šçœŸå®ä¸»é¢˜è§’è‰² è´Ÿè´£å®é™…ä¸šåŠ¡é€»è¾‘ï¼Œå¯èƒ½ç»å¸¸æ€§å˜åŠ¨ï¼Œä½†æ˜¯ç”±äºå…¶ä¸ ä»£ç†ç±» éƒ½å®ç°äº† æŠ½è±¡ä¸»é¢˜ï¼Œå› æ­¤ï¼ŒçœŸå®ä¸»é¢˜ çš„æ”¹å˜ä¸ä¼šå½±å“åˆ°ä»£ç†ç±»ï¼Œç¬¦åˆè®¾è®¡æ¨¡å¼ ä¾èµ–å€’ç½®åŸåˆ™ï¼Œé‡Œæ°æ›¿æ¢åŸåˆ™ å’Œ å¼€é—­åŸåˆ™ï¼› æ™ºèƒ½åŒ–ï¼šä¸»è¦æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„å®ç°ï¼Œå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶ç”Ÿæˆä¸€ä¸ªåˆé€‚çš„ä»£ç†ç±»ï¼› æ¨¡å¼ç¼ºç‚¹ ç”±äºåœ¨å®¢æˆ·ç«¯å’ŒçœŸå®ä¸»é¢˜ä¹‹é—´å¢åŠ äº†ä»£ç†å¯¹è±¡ï¼Œå› æ­¤ä¼šé€ æˆè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å˜æ…¢ï¼› å®ç°ä»£ç†æ¨¡å¼éœ€è¦é¢å¤–çš„å·¥ä½œï¼ˆæœ‰äº›ä»£ç†æ¨¡å¼çš„å®ç°éå¸¸å¤æ‚ï¼‰ï¼Œä»è€Œå¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ã€‚ åº”ç”¨åœºæ™¯ å½“æ— æ³•æˆ–ä¸æƒ³ç›´æ¥å¼•ç”¨æŸä¸ªå¯¹è±¡æˆ–è®¿é—®æŸä¸ªå¯¹è±¡å­˜åœ¨å›°éš¾æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¹Ÿç»™ä»£ç†å¯¹è±¡æ¥é—´æ¥è®¿é—®ï¼› æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾å¸Œæœ›ä¹°ä¸€å°æœ€æ–°çš„é¡¶é…Macç”µè„‘ å†²çªï¼šå›½å†…è¿˜æ²¡ä¸Šï¼Œåªæœ‰ç¾å›½æ‰æœ‰ è§£å†³æ–¹æ¡ˆï¼šå¯»æ‰¾ä»£è´­è¿›è¡Œè´­ä¹° ç¤ºä¾‹æ­¥éª¤ é™æ€ä»£ç† åˆ›å»ºæŠ½è±¡å¯¹è±¡æ¥å£(Subject) å£°æ˜ä½ ï¼ˆçœŸå®å¯¹è±¡ï¼‰éœ€è¦è®©ä»£è´­ï¼ˆä»£ç†å¯¹è±¡ï¼‰å¸®å¿™åšçš„äº‹ï¼ˆä¹°Macï¼‰ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: æŠ½è±¡å¯¹è±¡æ¥å£ï¼Œå£°æ˜ä½ ï¼ˆçœŸå®å¯¹è±¡ï¼‰éœ€è¦è®©ä»£è´­ï¼ˆä»£ç†å¯¹è±¡ï¼‰å¸®å¿™åšçš„äº‹ï¼ˆä¹°Macï¼‰ */public interface Subject { /** * ä¹°macæœ¬ */ public void buyMac();} åˆ›å»ºçœŸå®å¯¹è±¡ç±»ï¼ˆRealSubjectï¼‰ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: çœŸå®å¯¹è±¡ç±» */public class RealSubject implements Subject { @Override public void buyMac() { System.out.println("ä¹°ä¸€å°macæœ¬..."); }} åˆ›å»ºä»£ç†å¯¹è±¡ç±»(Proxy) 1234567891011121314151617181920212223242526272829package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: åˆ›å»ºä»£ç†å¯¹è±¡ */public class ProxySubject implements Subject { /** * å¼•ç”¨çœŸå®å¯¹è±¡ç¤ºä¾‹ */ private RealSubject realSubject; public ProxySubject(RealSubject realSubject) { this.realSubject = realSubject; } @Override public void buyMac() { //è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•ï¼Œè¿›è¡Œä»£ç†è´­ä¹° realSubject.buyMac(); //ä»£ç†å¯¹è±¡é¢å¤–çš„æ“ä½œ this.wrapMac(); } public void wrapMac() { System.out.println("ç”¨ç›’å­åŒ…è£…å¥½mac..."); }} å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: é™æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ */public class StaticProxyClient { public static void main(String[] args) { Subject proxy = new StaticProxy(); proxy.buyMac(); }} ä¸Šé¢ä»£ç æç»˜çš„ä»£ç†æ¨¡å¼ï¼Œæ›´åŠ ç»†åˆ†çš„è¯ä¸€èˆ¬ç§°ä¸ºé™æ€ä»£ç†æ¨¡å¼ï¼Œä¸ºä»€ä¹ˆç§°ä¸ºé™æ€ä»£ç†ï¼Ÿå› ä¸ºä»£ç†å¯¹è±¡éœ€è¦ä¸ç›®æ ‡å¯¹è±¡å®ç°ä¸€æ ·çš„æ¥å£ï¼ˆä¹Ÿå°±æ˜¯RealSubjectå’ŒProxSubjectå®ç°buyMacæ¥å£ï¼‰ã€‚ å‡è®¾ç°åœ¨æœ‰è¿™ç§æƒ…å†µï¼Œä¸ºäº†ä¿å®ˆèµ·è§ä¸ä»…æ‰¾ä»£è´­ï¼Œè¿˜é€šè¿‡å…¶ä»–å¤šç§æ¸ é“è´­ä¹°ï¼Œè¿™ç§æƒ…å†µä¸‹å°±ä¼šæœ‰å¾ˆå¤šä»£ç†ç±»ï¼Œä»£ç†ç±»å¦‚æœå¤ªå¤šä¼šå‡ºç°ä»€ä¹ˆæ ·çš„é—®é¢˜ï¼Ÿ ä¸€æ—¦æ¥å£å¢åŠ æ–¹æ³•ï¼Œç›®æ ‡å¯¹è±¡ä¸ä»£ç†å¯¹è±¡éƒ½è¦ç»´æŠ¤ï¼Œè¿™æ ·çš„è¯ä»£ç æ”¹èµ·æ¥å°±ç›¸å½“çƒ¦çå’Œå†—ä½™ã€‚ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒJavaç»™æˆ‘ä»¬æä¾›äº†ä¸€ç§è§£å†³æ–¹å¼ï¼Œè¿™ç§è§£å†³æ–¹å¼å¤§å®¶ä¸€èˆ¬ç§°ä¸ºåŠ¨æ€ä»£ç†ã€‚ åŠ¨æ€ä»£ç† åŠ¨æ€ä»£ç†çš„ç±» 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.proxy.demoOne;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;import java.lang.reflect.Proxy;/** * @author: whb * @description: åŠ¨æ€ä»£ç† */public class DynamicProxy { /** * ç»´æŠ¤ä¸€ä¸ªç›®æ ‡å¯¹è±¡ */ private Object object; public DynamicProxy(Object object) { this.object = object; } /** * ç»™ç›®æ ‡å¯¹è±¡ç”Ÿæˆä»£ç†å¯¹è±¡ */ public Object getProxyInstance() { return Proxy.newProxyInstance(object.getClass().getClassLoader(), object.getClass().getInterfaces(), new InvocationHandler() { @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { System.out.println("------------å¼€å§‹åŠ¨æ€ä»£ç†-----------" + "\n"); //æ‰§è¡Œç›®æ ‡æ–¹æ³• Object returnValue = method.invoke(object, args); System.out.println("------------ç»“æŸåŠ¨æ€ä»£ç†-----------"); return returnValue; } }); }} åŠ¨æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.proxy.demoOne;/** * @author: whb * @description: åŠ¨æ€ä»£ç†å®¢æˆ·ç«¯è°ƒç”¨ */public class DynamicProxyClient { public static void main(String[] args) { //åŠ¨æ€ä»£ç†éœ€è¦ä¼ å…¥æ¥å£å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯æ¥å£å­ç±» Subject subject = new ProxySubject(new RealSubject()); //å°†æ¥å£åº“å¯¹è±¡ä¼ è¿›ä»£ç†ç±»ï¼Œä½¿ç”¨ä»£ç†æ–¹æ³• Subject proxy = (Subject) new DynamicProxy(subject).getProxyInstance(); //æ‰§è¡Œæ–¹æ³•ã€ä»£ç†å¯¹è±¡ã€‘ proxy.buyMac(); }} è™½ç„¶ç›¸å¯¹äºé™æ€ä»£ç†ï¼ŒåŠ¨æ€ä»£ç†å¤§å¤§å‡å°‘äº†æˆ‘ä»¬çš„å¼€å‘ä»»åŠ¡ï¼ŒåŒæ—¶å‡å°‘äº†å¯¹ä¸šåŠ¡æ¥å£çš„ä¾èµ–ï¼Œé™ä½äº†è€¦åˆåº¦ã€‚ä½†æ˜¯è¿˜æ˜¯æœ‰ä¸€ç‚¹ç‚¹å°å°çš„é—æ†¾ä¹‹å¤„ï¼Œé‚£å°±æ˜¯å®ƒå§‹ç»ˆæ— æ³•æ‘†è„±ä»…æ”¯æŒinterfaceä»£ç†çš„æ¡æ¢ï¼Œå› ä¸ºå®ƒçš„è®¾è®¡æ³¨å®šäº†è¿™ä¸ªé—æ†¾ã€‚å›æƒ³ä¸€ä¸‹é‚£äº›åŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„ç»§æ‰¿å…³ç³»å›¾ï¼Œå®ƒä»¬å·²ç»æ³¨å®šæœ‰ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»å«Proxyã€‚Javaçš„ç»§æ‰¿æœºåˆ¶æ³¨å®šäº†è¿™äº›åŠ¨æ€ä»£ç†ç±»ä»¬æ— æ³•å®ç°å¯¹classçš„åŠ¨æ€ä»£ç†ï¼ŒåŸå› æ˜¯å¤šç»§æ‰¿åœ¨Javaä¸­æœ¬è´¨ä¸Šå°±è¡Œä¸é€šã€‚ CGLIBåŠ¨æ€ä»£ç† JDKå®ç°åŠ¨æ€ä»£ç†éœ€è¦å®ç°ç±»é€šè¿‡æ¥å£å®šä¹‰ä¸šåŠ¡æ–¹æ³•ï¼Œå¯¹äºæ²¡æœ‰æ¥å£çš„ç±»ï¼Œå¦‚ä½•å®ç°åŠ¨æ€ä»£ç†å‘¢ï¼Œè¿™å°±éœ€è¦CGLibäº†ã€‚CGLibé‡‡ç”¨äº†éå¸¸åº•å±‚çš„å­—èŠ‚ç æŠ€æœ¯ï¼Œå…¶åŸç†æ˜¯é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ï¼Œé¡ºåŠ¿ç»‡å…¥æ¨ªåˆ‡é€»è¾‘ã€‚ä½†å› ä¸ºé‡‡ç”¨çš„æ˜¯ç»§æ‰¿ï¼Œæ‰€ä»¥ä¸èƒ½å¯¹finalä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†ã€‚JDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†å‡æ˜¯å®ç°Spring AOPçš„åŸºç¡€ã€‚ CGLIBä»£ç†ç±» 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.proxy.cglibProxy;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;import java.lang.reflect.Method;/** * @author: whb * @description: Cglibä»£ç†ç±» */public class CglibProxy implements MethodInterceptor { private Object target; public Object getInstance(final Object target) { this.target = target; Enhancer enhancer = new Enhancer(); enhancer.setSuperclass(this.target.getClass()); enhancer.setCallback(this); return enhancer.create(); } @Override public Object intercept(Object object, Method method, Object[] args, MethodProxy methodProxy) throws Throwable { System.out.println("----------å¼€å¯äº‹åŠ¡---------"); Object result = methodProxy.invokeSuper(object, args); System.out.println("-----------ç»“æŸäº‹åŠ¡---------"); return result; }} CGLIBä»£ç†æµ‹è¯•ç±» 123456789101112131415package main.java.com.study.designPatterns.proxy.cglibProxy;/** * @author: whb * @description: CglibåŠ¨æ€ä»£ç†æµ‹è¯• */public class TestCglibProxy { public static void main(String[] args) { UserDao userDao = new UserDaoImpl(); CglibProxy cglibProxy = new CglibProxy(); UserDaoImpl userDaoCglibProxy = (UserDaoImpl) cglibProxy.getInstance(userDao); userDaoCglibProxy.save(); }} CGLIBåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡æ¯”JDKåˆ›å»ºçš„åŠ¨æ€ä»£ç†å¯¹è±¡çš„æ€§èƒ½æ›´é«˜ï¼Œä½†æ˜¯CGLIBåˆ›å»ºä»£ç†å¯¹è±¡æ—¶æ‰€èŠ±è´¹çš„æ—¶é—´å´æ¯”JDKå¤šå¾—å¤šã€‚æ‰€ä»¥å¯¹äºå•ä¾‹çš„å¯¹è±¡ï¼Œå› ä¸ºæ— éœ€é¢‘ç¹åˆ›å»ºå¯¹è±¡ï¼Œç”¨CGLIBåˆé€‚ï¼Œåä¹‹ä½¿ç”¨JDKæ–¹å¼è¦æ›´ä¸ºåˆé€‚ä¸€äº›ã€‚åŒæ—¶ç”±äºCGLibç”±äºæ˜¯é‡‡ç”¨åŠ¨æ€åˆ›å»ºå­ç±»çš„æ–¹æ³•ï¼Œå¯¹äºfinalä¿®é¥°çš„æ–¹æ³•æ— æ³•è¿›è¡Œä»£ç†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java-HashMapã€ConcurrentHashMapè§£æ]]></title>
    <url>%2Fposts%2Fbf7c5065.html</url>
    <content type="text"><![CDATA[Hashè¡¨ Hashè¡¨ä¹Ÿå«æ•£åˆ—è¡¨ï¼Œæ˜¯æ ¹æ®å…³é”®ç å€¼(Key value)è€Œç›´æ¥è¿›è¡Œè®¿é—®çš„æ•°æ®ç»“æ„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒé€šè¿‡æŠŠå…³é”®ç å€¼æ˜ å°„åˆ°è¡¨ä¸­ä¸€ä¸ªä½ç½®æ¥è®¿é—®è®°å½•ï¼Œä»¥åŠ å¿«æŸ¥æ‰¾çš„é€Ÿåº¦ã€‚å­˜æ”¾è®°å½•çš„æ•°ç»„å«åšå“ˆå¸Œè¡¨ã€‚ åœ¨HashMapä¸­ï¼Œå°±æ˜¯å°†æ‰€ç»™çš„â€œé”®â€é€šè¿‡å“ˆå¸Œå‡½æ•°å¾—åˆ°â€œç´¢å¼•â€ï¼Œç„¶åæŠŠå†…å®¹å­˜åœ¨æ•°ç»„ä¸­ï¼Œè¿™æ ·å°±å½¢æˆäº†â€œé”®â€å’Œå†…å®¹çš„æ˜ å°„å…³ç³»ã€‚ åœ¨äº†è§£å“ˆå¸Œè¡¨ä¹‹å‰ï¼Œå…ˆå¤§æ¦‚äº†è§£ä¸‹å…¶ä»–æ•°æ®ç»“æ„åœ¨æ–°å¢ï¼ŒæŸ¥æ‰¾ç­‰åŸºç¡€æ“ä½œæ‰§è¡Œæ€§èƒ½ï¼š æ•°ç»„ï¼šé‡‡ç”¨ä¸€æ®µè¿ç»­çš„å­˜å‚¨å•å…ƒæ¥å­˜å‚¨æ•°æ®ã€‚å¯¹äºæŒ‡å®šä¸‹æ ‡çš„æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼›é€šè¿‡ç»™å®šå€¼è¿›è¡ŒæŸ¥æ‰¾ï¼Œéœ€è¦éå†æ•°ç»„ï¼Œé€ä¸€æ¯”å¯¹ç»™å®šå…³é”®å­—å’Œæ•°ç»„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ï¼Œå½“ç„¶ï¼Œå¯¹äºæœ‰åºæ•°ç»„ï¼Œåˆ™å¯é‡‡ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼Œæ’å€¼æŸ¥æ‰¾ï¼Œæ–æ³¢é‚£å¥‘æŸ¥æ‰¾ç­‰æ–¹å¼ï¼Œå¯å°†æŸ¥æ‰¾å¤æ‚åº¦æé«˜ä¸ºO(logn)ï¼›å¯¹äºä¸€èˆ¬çš„æ’å…¥åˆ é™¤æ“ä½œï¼Œæ¶‰åŠåˆ°æ•°ç»„å…ƒç´ çš„ç§»åŠ¨ï¼Œå…¶å¹³å‡å¤æ‚åº¦ä¹Ÿä¸ºO(n)ã€‚å¯¹åº”åˆ°é›†åˆå®ç°ï¼Œä»£è¡¨å°±æ˜¯ArrayListã€‚ çº¿æ€§é“¾è¡¨ï¼šå¯¹äºé“¾è¡¨çš„æ–°å¢ï¼Œåˆ é™¤ç­‰æ“ä½œï¼ˆåœ¨æ‰¾åˆ°æŒ‡å®šæ“ä½œä½ç½®åï¼‰ï¼Œä»…éœ€å¤„ç†ç»“ç‚¹é—´çš„å¼•ç”¨å³å¯ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ï¼Œè€ŒæŸ¥æ‰¾æ“ä½œéœ€è¦éå†é“¾è¡¨é€ä¸€è¿›è¡Œæ¯”å¯¹ï¼Œå¤æ‚åº¦ä¸ºO(n)ã€‚å¯¹åº”çš„é›†åˆç±»æ˜¯LinkedListã€‚ äºŒå‰æ ‘ï¼šå¯¹ä¸€æ£µç›¸å¯¹å¹³è¡¡çš„æœ‰åºäºŒå‰æ ‘ï¼Œå¯¹å…¶è¿›è¡Œæ’å…¥ï¼ŒæŸ¥æ‰¾ï¼Œåˆ é™¤ç­‰æ“ä½œï¼Œå¹³å‡å¤æ‚åº¦å‡ä¸ºO(logn)ã€‚å¯¹åº”çš„é›†åˆç±»æœ‰TreeSetå’ŒTreeMapã€‚ å“ˆå¸Œè¡¨ï¼šç›¸æ¯”ä¸Šè¿°å‡ ç§æ•°æ®ç»“æ„ï¼Œåœ¨å“ˆå¸Œè¡¨ä¸­è¿›è¡Œæ·»åŠ ï¼Œåˆ é™¤ï¼ŒæŸ¥æ‰¾ç­‰æ“ä½œï¼Œæ€§èƒ½ååˆ†ä¹‹é«˜ï¼Œä¸è€ƒè™‘å“ˆå¸Œå†²çªçš„æƒ…å†µä¸‹ï¼Œä»…éœ€ä¸€æ¬¡å®šä½å³å¯å®Œæˆï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚å¯¹åº”çš„é›†åˆç±»å°±æ˜¯HashMapã€‚ å“ˆå¸Œè¡¨çš„ä¸»å¹²æ˜¯æ•°ç»„ã€‚è¦æ–°å¢æˆ–æŸ¥æ‰¾æŸä¸ªå…ƒç´ ï¼Œé€šè¿‡æŠŠå½“å‰å…ƒç´ çš„å…³é”®å­— é€šè¿‡æŸä¸ªå‡½æ•°æ˜ å°„åˆ°æ•°ç»„ä¸­çš„æŸä¸ªä½ç½®ï¼Œé€šè¿‡æ•°ç»„ä¸‹æ ‡ä¸€æ¬¡å®šä½å°±å¯å®Œæˆæ“ä½œã€‚å³ï¼š 1å­˜å‚¨ä½ç½® = f(å…³é”®å­—) å…¶ä¸­ï¼Œè¿™ä¸ªå‡½æ•°fä¸€èˆ¬ç§°ä¸ºå“ˆå¸Œå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°çš„è®¾è®¡å¥½åä¼šç›´æ¥å½±å“åˆ°å“ˆå¸Œè¡¨çš„ä¼˜åŠ£ã€‚è¿™ä¼šæ¶‰åŠåˆ°å“ˆå¸Œå†²çªã€‚ä¸¾ä¸ªä¾‹å­ï¼Œæ¯”å¦‚è¦åœ¨å“ˆå¸Œè¡¨ä¸­æ‰§è¡Œæ’å…¥æ“ä½œï¼š æŸ¥æ‰¾æ“ä½œåŒç†ï¼Œå…ˆé€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºå®é™…å­˜å‚¨åœ°å€ï¼Œç„¶åä»æ•°ç»„ä¸­å¯¹åº”åœ°å€å–å‡ºå³å¯ã€‚ å½“æˆ‘ä»¬å¯¹æŸä¸ªå…ƒç´ è¿›è¡Œå“ˆå¸Œè¿ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªå­˜å‚¨åœ°å€ï¼Œç„¶åè¦è¿›è¡Œæ’å…¥çš„æ—¶å€™ï¼Œå‘ç°å·²ç»è¢«å…¶ä»–å…ƒç´ å ç”¨äº†ï¼Œå…¶å®è¿™å°±æ˜¯æ‰€è°“çš„å“ˆå¸Œå†²çªï¼Œä¹Ÿå«å“ˆå¸Œç¢°æ’ã€‚å“ˆå¸Œå‡½æ•°çš„è®¾è®¡è‡³å…³é‡è¦ï¼Œå¥½çš„å“ˆå¸Œå‡½æ•°ä¼šå°½å¯èƒ½åœ°ä¿è¯è®¡ç®—ç®€å•å’Œæ•£åˆ—åœ°å€åˆ†å¸ƒå‡åŒ€ã€‚ä½†æ˜¯ï¼Œæ•°ç»„æ˜¯ä¸€å—è¿ç»­çš„å›ºå®šé•¿åº¦çš„å†…å­˜ç©ºé—´ï¼Œå†å¥½çš„å“ˆå¸Œå‡½æ•°ä¹Ÿä¸èƒ½ä¿è¯å¾—åˆ°çš„å­˜å‚¨åœ°å€ç»å¯¹ä¸å‘ç”Ÿå†²çªã€‚é‚£ä¹ˆå“ˆå¸Œå†²çªå¦‚ä½•è§£å†³å‘¢ï¼Ÿå“ˆå¸Œå†²çªçš„è§£å†³æ–¹æ¡ˆæœ‰å¤šç§:å¼€æ”¾å®šå€æ³•ï¼ˆå‘ç”Ÿå†²çªï¼Œç»§ç»­å¯»æ‰¾ä¸‹ä¸€å—æœªè¢«å ç”¨çš„å­˜å‚¨åœ°å€ï¼‰ã€å†æ•£åˆ—å‡½æ•°æ³•ã€é“¾åœ°å€æ³•ã€‚è€ŒHashMapå³æ˜¯é‡‡ç”¨äº†é“¾åœ°å€æ³•ï¼Œä¹Ÿå°±æ˜¯æ•°ç»„+é“¾è¡¨çš„æ–¹å¼ã€‚ ç®€å•æ¥è¯´ï¼ŒHashMapç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯HashMapçš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼Œå¦‚æœå®šä½åˆ°çš„æ•°ç»„ä½ç½®ä¸å«é“¾è¡¨ï¼ˆå½“å‰entryçš„nextæŒ‡å‘nullï¼‰,é‚£ä¹ˆå¯¹äºæŸ¥æ‰¾ï¼Œæ·»åŠ ç­‰æ“ä½œå¾ˆå¿«ï¼Œä»…éœ€ä¸€æ¬¡å¯»å€å³å¯ï¼›å¦‚æœå®šä½åˆ°çš„æ•°ç»„åŒ…å«é“¾è¡¨ï¼Œå¯¹äºæ·»åŠ æ“ä½œï¼Œå…¶æ—¶é—´å¤æ‚åº¦ä¾ç„¶ä¸ºO(1)ï¼Œå› ä¸ºæœ€æ–°çš„Entryä¼šæ’å…¥é“¾è¡¨å¤´éƒ¨ï¼Œæ€¥éœ€è¦ç®€å•æ”¹å˜å¼•ç”¨é“¾å³å¯ï¼Œè€Œå¯¹äºæŸ¥æ‰¾æ“ä½œæ¥è®²ï¼Œæ­¤æ—¶å°±éœ€è¦éå†é“¾è¡¨ï¼Œç„¶åé€šè¿‡keyå¯¹è±¡çš„equalsæ–¹æ³•é€ä¸€æ¯”å¯¹æŸ¥æ‰¾ã€‚æ‰€ä»¥ï¼Œæ€§èƒ½è€ƒè™‘ï¼ŒHashMapä¸­çš„é“¾è¡¨å‡ºç°è¶Šå°‘ï¼Œæ€§èƒ½æ‰ä¼šè¶Šå¥½ã€‚ HashMap-Jdk1.7 ç±»å®šä¹‰ 123public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable ç®€ä»‹ ç»§æ‰¿AbstractMapæŠ½è±¡ç±»ï¼› å®ç°Mapæ¥å£ï¼Œæ‹¥æœ‰ä¸€ç»„Mapé€šç”¨æ“ä½œï¼› å®ç°Cloneableæ¥å£ï¼Œå¯è¿›è¡Œæ‹·è´ï¼ˆæµ…æ‹·è´ï¼‰ï¼› å®ç°äº†Serializableæ¥å£ï¼Œå¯å®ç°åºåˆ—åŒ–ï¼› å…è®¸é”®/å€¼ä¸ºç©ºå¯¹è±¡ï¼ˆnullï¼‰ï¼› éçº¿ç¨‹å®‰å…¨ï¼Œå¯é€šè¿‡Collectionsç±»çš„é™æ€æ–¹æ³•synchronizedMapè·å¾—çº¿ç¨‹å®‰å…¨çš„HashMapï¼› ä¸ä¿è¯æœ‰åºæ€§ï¼ˆå¦‚æ’å…¥é¡ºåºï¼‰ï¼Œä¹Ÿä¸ä¿è¯é¡ºåºä¸éšæ—¶é—´å˜åŒ–ï¼› æ•°æ®ç»“æ„ HashMap é‡‡ç”¨çš„æ•°æ®ç»“æ„ = æ•°ç»„ï¼ˆä¸»ï¼‰ + å•é“¾è¡¨ï¼ˆå‰¯ï¼‰ï¼Œè¯¥ç»“æ„åˆç§°æ‹‰é“¾æ³•ï¼Œå…·ä½“æè¿°å¦‚ä¸‹: å½“å®ä¾‹åŒ–ä¸€ä¸ªHashMapæ—¶ï¼Œç³»ç»Ÿä¼šåˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸ºCapacityçš„Entryæ•°ç»„ï¼Œè¿™ä¸ªé•¿åº¦è¢«ç§°ä¸ºå®¹é‡(Capacity)ï¼Œåœ¨è¿™ä¸ªæ•°ç»„ä¸­å¯ä»¥å­˜æ”¾å…ƒç´ çš„ä½ç½®ç§°ä¹‹ä¸ºâ€œæ¡¶â€(bucket)ï¼Œæ¯ä¸ªbucketéƒ½æœ‰è‡ªå·±çš„ç´¢å¼•ï¼Œç³»ç»Ÿå¯ä»¥æ ¹æ®ç´¢å¼•å¿«é€Ÿçš„æŸ¥æ‰¾bucketä¸­çš„å…ƒç´ ã€‚ æ¯ä¸ªbucketä¸­å­˜å‚¨ä¸€ä¸ªå…ƒç´ ï¼Œå³ä¸€ä¸ªEntryå¯¹è±¡ï¼Œä½†æ¯ä¸€ä¸ªEntryå¯¹è±¡å¯ä»¥å¸¦ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œç”¨äºæŒ‡å‘ä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œå› æ­¤ï¼Œåœ¨ä¸€ä¸ªæ¡¶ä¸­ï¼Œå°±æœ‰å¯èƒ½ç”Ÿæˆä¸€ä¸ªEntryé“¾ã€‚ Entryæ˜¯HashMapçš„åŸºæœ¬ç»„æˆå•å…ƒï¼Œæ¯ä¸€ä¸ªEntryåŒ…å«ä¸€ä¸ªkey-valueé”®å€¼å¯¹ã€‚ Entryæ˜¯HashMapä¸­çš„ä¸€ä¸ªé™æ€å†…éƒ¨ç±»ã€‚ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081/** * Entryç±»å®ç°äº†Map.Entryæ¥å£ * å³ å®ç°äº†getKey()ã€getValue()ã€equals(Object o)å’ŒhashCode()ç­‰æ–¹æ³•**/ static class Entry&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; { final K key; // é”® V value; // å€¼ Entry&lt;K,V&gt; next; // æŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªEntryå¯¹è±¡ï¼Œä»è€Œå½¢æˆè§£å†³hashå†²çªçš„å•é“¾è¡¨ int hash; // å¯¹keyçš„hashcodeå€¼è¿›è¡Œhashè¿ç®—åå¾—åˆ°çš„å€¼ï¼Œå­˜å‚¨åœ¨Entryï¼Œé¿å…é‡å¤è®¡ç®— /** * æ„é€ æ–¹æ³•ï¼Œåˆ›å»ºä¸€ä¸ªEntry * å‚æ•°ï¼šå“ˆå¸Œå€¼hï¼Œé”®å€¼kï¼Œå€¼vã€ä¸‹ä¸€ä¸ªç»“ç‚¹n */ Entry(int h, K k, V v, Entry&lt;K,V&gt; n) { value = v; next = n; key = k; hash = h; } // è¿”å› ä¸ æ­¤é¡¹ å¯¹åº”çš„é”® public final K getKey() { return key; } // è¿”å› ä¸ æ­¤é¡¹ å¯¹åº”çš„å€¼ public final V getValue() { return value; } public final V setValue(V newValue) { V oldValue = value; value = newValue; return oldValue; } /** * åˆ¤æ–­2ä¸ªEntryæ˜¯å¦ç›¸ç­‰ï¼Œå¿…é¡»keyå’Œvalueéƒ½ç›¸ç­‰ï¼Œæ‰è¿”å›true */ public final boolean equals(Object o) { if (!(o instanceof Map.Entry)) return false; Map.Entry e = (Map.Entry)o; Object k1 = getKey(); Object k2 = e.getKey(); if (k1 == k2 || (k1 != null &amp;&amp; k1.equals(k2))) { Object v1 = getValue(); Object v2 = e.getValue(); if (v1 == v2 || (v1 != null &amp;&amp; v1.equals(v2))) return true; } return false; } /** * hashCodeï¼ˆï¼‰ */ public final int hashCode() { return Objects.hashCode(getKey()) ^ Objects.hashCode(getValue()); } public final String toString() { return getKey() + "=" + getValue(); } /** * å½“å‘HashMapä¸­æ·»åŠ å…ƒç´ æ—¶ï¼Œå³è°ƒç”¨put(k,v)æ—¶ï¼Œ * å¯¹å·²ç»åœ¨HashMapä¸­kä½ç½®è¿›è¡Œvçš„è¦†ç›–æ—¶ï¼Œä¼šè°ƒç”¨æ­¤æ–¹æ³• * æ­¤å¤„æ²¡åšä»»ä½•å¤„ç† */ void recordAccess(HashMap&lt;K,V&gt; m) { } /** * å½“ä»HashMapä¸­åˆ é™¤äº†ä¸€ä¸ªEntryæ—¶ï¼Œä¼šè°ƒç”¨è¯¥å‡½æ•° * æ­¤å¤„æ²¡åšä»»ä½•å¤„ç† */ void recordRemoval(HashMap&lt;K,V&gt; m) { } } æ‰€ä»¥ï¼ŒHashMapçš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š é‡è¦å±æ€§ 12345678910111213141516171819202122232425262728293031323334353637// 1. å®¹é‡ï¼ˆcapacityï¼‰ï¼š HashMapä¸­æ•°ç»„çš„é•¿åº¦// a. å®¹é‡èŒƒå›´ï¼šå¿…é¡»æ˜¯2çš„å¹‚ &amp; &lt;æœ€å¤§å®¹é‡ï¼ˆ2çš„30æ¬¡æ–¹ï¼‰// b. åˆå§‹å®¹é‡ = å“ˆå¸Œè¡¨åˆ›å»ºæ—¶çš„å®¹é‡// é»˜è®¤å®¹é‡ = 16 = 1&lt;&lt;4 = 00001ä¸­çš„1å‘å·¦ç§»4ä½ = 10000 = åè¿›åˆ¶çš„2^4=16static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; //æœ€å¤§å®¹é‡ = 2çš„30æ¬¡æ–¹ï¼ˆè‹¥ä¼ å…¥çš„å®¹é‡è¿‡å¤§ï¼Œå°†è¢«æœ€å¤§å€¼æ›¿æ¢ï¼‰ static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // 2. åŠ è½½å› å­(Load factor)ï¼šHashMapåœ¨å…¶å®¹é‡è‡ªåŠ¨å¢åŠ å‰å¯è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦// a. åŠ è½½å› å­è¶Šå¤§ã€å¡«æ»¡çš„å…ƒç´ è¶Šå¤š = ç©ºé—´åˆ©ç”¨ç‡é«˜ã€ä½†å†²çªçš„æœºä¼šåŠ å¤§ã€æŸ¥æ‰¾æ•ˆç‡å˜ä½ï¼ˆå› ä¸ºé“¾è¡¨å˜é•¿äº†ï¼‰// b. åŠ è½½å› å­è¶Šå°ã€å¡«æ»¡çš„å…ƒç´ è¶Šå°‘ = ç©ºé—´åˆ©ç”¨ç‡å°ã€å†²çªçš„æœºä¼šå‡å°ã€æŸ¥æ‰¾æ•ˆç‡é«˜ï¼ˆé“¾è¡¨ä¸é•¿ï¼‰// å®é™…åŠ è½½å› å­final float loadFactor;//é»˜è®¤è£…è½½å› å­ = 0.75 static final float DEFAULT_LOAD_FACTOR = 0.75f; // 3. æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰ï¼šå½“å“ˆå¸Œè¡¨çš„å¤§å° â‰¥ æ‰©å®¹é˜ˆå€¼æ—¶ï¼Œå°±ä¼šæ‰©å®¹å“ˆå¸Œè¡¨ï¼ˆå³æ‰©å……HashMapçš„å®¹é‡ï¼‰ // a. æ‰©å®¹ = å¯¹å“ˆå¸Œè¡¨è¿›è¡Œresizeæ“ä½œï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼‰ï¼Œä»è€Œå“ˆå¸Œè¡¨å°†å…·æœ‰å¤§çº¦ä¸¤å€çš„æ¡¶æ•°// b. æ‰©å®¹é˜ˆå€¼ = å®¹é‡ x åŠ è½½å› å­int threshold; // å­˜å‚¨æ•°æ®çš„Entryç±»å‹ æ•°ç»„ï¼Œé•¿åº¦ = 2çš„å¹‚// HashMapçš„å®ç°æ–¹å¼ = æ‹‰é“¾æ³•ï¼ŒEntryæ•°ç»„ä¸Šçš„æ¯ä¸ªå…ƒç´ æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨transient Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE; //HashMapå†…éƒ¨çš„å­˜å‚¨ç»“æ„æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ­¤å¤„æ•°ç»„ä¸ºç©ºï¼Œå³æ²¡æœ‰åˆå§‹åŒ–ä¹‹å‰çš„çŠ¶æ€ static final Entry&lt;?,?&gt;[] EMPTY_TABLE = {}; //å®é™…å­˜å‚¨çš„key-valueé”®å€¼å¯¹çš„ä¸ªæ•°transient int size;//ç”¨äºå¿«é€Ÿå¤±è´¥ï¼Œç”±äºHashMapéçº¿ç¨‹å®‰å…¨ï¼Œåœ¨å¯¹HashMapè¿›è¡Œè¿­ä»£æ—¶ï¼Œå¦‚æœæœŸé—´å…¶ä»–çº¿ç¨‹çš„å‚ä¸å¯¼è‡´HashMapçš„ç»“æ„å‘ç”Ÿå˜åŒ–äº†ï¼ˆæ¯”å¦‚putï¼Œremoveç­‰æ“ä½œï¼‰ï¼Œéœ€è¦æŠ›å‡ºå¼‚å¸¸ConcurrentModificationExceptiontransient int modCount;//é»˜è®¤çš„thresholdå€¼ static final int ALTERNATIVE_HASHING_THRESHOLD_DEFAULT = Integer.MAX_VALUE; åŠ è½½å› å­è¯¦è¿° åŠ è½½å› å­è¿‡å¤§ å¡«å……çš„å…ƒç´ è¶Šå¤šï¼Œç©ºé—´åˆ©ç”¨ç‡ä¹Ÿå°±è¶Šé«˜ï¼› å†²çªæ¦‚ç‡åŠ å¤§ï¼Œé“¾è¡¨è¾¹é•¿ï¼ŒæŸ¥æ‰¾æ•ˆç‡å˜å°ï¼› åŠ è½½å› å­è¿‡å° å†²çªæ¦‚ç‡å‡å°ï¼Œé“¾è¡¨å˜çŸ­ï¼ŒæŸ¥æ‰¾æ•ˆç‡å˜é«˜ï¼› å¡«å……çš„å…ƒç´ è¶Šå°‘ï¼Œç©ºé—´åˆ©ç”¨ç‡è¶Šä½ï¼› ä½¿ç”¨å»ºè®® åœ¨æŸ¥æ‰¾æ•ˆç‡&amp;ç©ºé—´åˆ©ç”¨ç‡ä¹‹é—´å¯»æ‰¾ä¸€ç§å¹³è¡¡ï¼Œå³æ‰€è°“çš„â€œç©ºé—´æ•ˆç‡æ¢æ—¶é—´æ•ˆç‡â€ or "æ—¶é—´æ•ˆç‡æ¢ç©ºé—´æ•ˆç‡"ï¼› è‹¥ç©ºé—´å†…å­˜å……è¶³ï¼Œå¯é€‰æ‹©â€œç©ºé—´æ•ˆç‡æ¢æ—¶é—´æ•ˆç‡â€ç­–ç•¥ï¼Œå³é€šè¿‡è®¾ç½®è¿‡å°çš„åŠ è½½å› å­æé«˜æŸ¥è¯¢é€Ÿåº¦ï¼Œä½†ä¹Ÿè¦è€ƒè™‘é¢‘ç¹æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼› è‹¥ç©ºé—´å†…å­˜ä¸è¶³ï¼Œå¯é€‰æ‹©â€œæ—¶é—´æ•ˆç‡æ¢ç©ºé—´æ•ˆç‡â€ç­–ç•¥ï¼Œå³é€šè¿‡è®¾ç½®è¿‡å¤§çš„åŠ è½½å› å­æé«˜ç©ºé—´åˆ©ç”¨ç‡ï¼Œä½†ç‰ºç‰²äº†æŸ¥è¯¢é€Ÿç‡ï¼› åŠ è½½å› å­å¯è‡ªå®šä¹‰ä¿®æ”¹ï¼Œä½†éç‰¹æ®Šæƒ…å†µä¸å»ºè®®ä¿®æ”¹ï¼ˆé»˜è®¤å€¼=0.75ï¼‰ï¼› æ„é€ æ–¹æ³• HashMapæœ‰4ä¸ªæ„é€ å™¨ï¼Œå…¶ä»–æ„é€ å™¨å¦‚æœç”¨æˆ·æ²¡æœ‰ä¼ å…¥initialCapacity å’ŒloadFactorè¿™ä¸¤ä¸ªå‚æ•°ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ã€‚initialCapacityé»˜è®¤ä¸º16ï¼ŒloadFactoryé»˜è®¤ä¸º0.75ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253//è®¡ç®—Hashå€¼æ—¶çš„key transient int hashSeed = 0; /** * æ„é€ å‡½æ•°1ï¼šé»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ— å‚ï¼‰ * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ = 0.75ã€16 */ public HashMap() { // å®é™…ä¸Šæ˜¯è°ƒç”¨æ„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° // ä¼ å…¥çš„æŒ‡å®šå®¹é‡ &amp; åŠ è½½å› å­ = é»˜è®¤ this(DEFAULT_INITIAL_CAPACITY, DEFAULT_LOAD_FACTOR); } /** * æ„é€ å‡½æ•°2ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•° * åŠ è½½å› å­ = é»˜è®¤ = 0.75 ã€å®¹é‡ = æŒ‡å®šå¤§å° */ public HashMap(int initialCapacity) { // å®é™…ä¸Šæ˜¯è°ƒç”¨æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° // åªæ˜¯åœ¨ä¼ å…¥çš„åŠ è½½å› å­å‚æ•° = é»˜è®¤åŠ è½½å› å­ this(initialCapacity, DEFAULT_LOAD_FACTOR); } /** * æ„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° * åŠ è½½å› å­ &amp; å®¹é‡ = è‡ªå·±æŒ‡å®š */ public HashMap(int initialCapacity, float loadFactor) { if (initialCapacity &lt; 0)//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); if (initialCapacity &gt; MAXIMUM_CAPACITY)//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ initialCapacity = MAXIMUM_CAPACITY; if (loadFactor &lt;= 0 || Float.isNaN(loadFactor))//å‚æ•°æœ‰æ•ˆæ€§æ£€æŸ¥ throw new IllegalArgumentException("Illegal load factor: " + loadFactor); // è®¾ç½® åŠ è½½å› å­ this.loadFactor = loadFactor; // è®¾ç½® æ‰©å®¹é˜ˆå€¼ = åˆå§‹å®¹é‡ threshold = initialCapacity; init();//initæ–¹æ³•åœ¨HashMapä¸­æ²¡æœ‰å®é™…å®ç°ï¼Œä¸è¿‡åœ¨å…¶å­ç±»å¦‚ linkedHashMapä¸­å°±ä¼šæœ‰å¯¹åº”å®ç°} /** * æ„é€ å‡½æ•°4ï¼šåŒ…å«â€œå­Mapâ€çš„æ„é€ å‡½æ•° * å³ æ„é€ å‡ºæ¥çš„HashMapåŒ…å«ä¼ å…¥Mapçš„æ˜ å°„å…³ç³» * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ */ public HashMap(Map&lt;? extends K, ? extends V&gt; m) { // è®¾ç½®å®¹é‡å¤§å° &amp; åŠ è½½å› å­ = é»˜è®¤ this(Math.max((int) (m.size() / DEFAULT_LOAD_FACTOR) + 1, DEFAULT_INITIAL_CAPACITY), DEFAULT_LOAD_FACTOR); inflateTable(threshold);//åˆå§‹åŒ–HashMapåº•å±‚çš„æ•°ç»„ç»“æ„ putAllForCreate(m);//æ·»åŠ mä¸­çš„å…ƒç´  } åœ¨å¸¸è§„æ„é€ å™¨ä¸­ï¼Œå¹¶æ²¡æœ‰é©¬ä¸Šä¸ºæ•°ç»„tableåˆ†é…å†…å­˜ç©ºé—´ï¼ˆæœ‰ä¸€ä¸ªå…¥å‚ä¸ºæŒ‡å®šMapçš„æ„é€ å™¨ä¾‹å¤–ï¼‰ï¼Œäº‹å®ä¸Šæ˜¯åœ¨æ‰§è¡Œç¬¬ä¸€æ¬¡putæ“ä½œçš„æ—¶å€™æ‰çœŸæ­£æ„å»ºtableæ•°ç»„ã€‚ putæ“ä½œ æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637public V put(K key, V value) // 1. è‹¥å“ˆå¸Œè¡¨æœªåˆå§‹åŒ–ï¼ˆå³ tableä¸ºç©º) // åˆ™ä½¿ç”¨æ„é€ å‡½æ•°è®¾ç½®çš„é˜ˆå€¼(å³åˆå§‹å®¹é‡) åˆå§‹åŒ–æ•°ç»„table if (table == EMPTY_TABLE) { inflateTable(threshold); } // 2. åˆ¤æ–­keyæ˜¯å¦ä¸ºç©ºå€¼null // 2.1 è‹¥key == nullï¼Œåˆ™å°†è¯¥é”®-å€¼ å­˜æ”¾åˆ°æ•°ç»„table ä¸­çš„ç¬¬1ä¸ªä½ç½®ï¼Œå³table [0] // ï¼ˆæœ¬è´¨ï¼škey = Nullæ—¶ï¼Œhashå€¼ = 0ï¼Œæ•…å­˜æ”¾åˆ°table[0]ä¸­ï¼‰ // è¯¥ä½ç½®æ°¸è¿œåªæœ‰1ä¸ªvalueï¼Œæ–°ä¼ è¿›æ¥çš„valueä¼šè¦†ç›–æ—§çš„value if (key == null) return putForNullKey(value); // 2.2 è‹¥ key â‰  nullï¼Œåˆ™è®¡ç®—å­˜æ”¾æ•°ç»„ table ä¸­çš„ä½ç½®ï¼ˆä¸‹æ ‡ã€ç´¢å¼•ï¼‰ // a. æ ¹æ®é”®å€¼keyè®¡ç®—hashå€¼ int hash = hash(key); // b. æ ¹æ®hashå€¼ æœ€ç»ˆè·å¾— keyå¯¹åº”å­˜æ”¾çš„æ•°ç»„Tableä¸­ä½ç½® int i = indexFor(hash, table.length); // 3. åˆ¤æ–­è¯¥keyå¯¹åº”çš„å€¼æ˜¯å¦å·²å­˜åœ¨ï¼ˆé€šè¿‡éå† ä»¥è¯¥æ•°ç»„å…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ é€ä¸ªåˆ¤æ–­ï¼‰ for (Entry&lt;K,V&gt; e = table[i]; e != null; e = e.next) { Object k; // 3.1 è‹¥è¯¥keyå·²å­˜åœ¨ï¼ˆå³ key-valueå·²å­˜åœ¨ ï¼‰ï¼Œåˆ™ç”¨ æ–°value æ›¿æ¢ æ—§value if (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) { V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; //å¹¶è¿”å›æ—§çš„value } } //ä¿è¯å¹¶å‘è®¿é—®æ—¶ï¼Œè‹¥HashMapå†…éƒ¨ç»“æ„å‘ç”Ÿå˜åŒ–ï¼Œå¿«é€Ÿå“åº”å¤±è´¥ modCount++; // 3.2 è‹¥ è¯¥keyä¸å­˜åœ¨ï¼Œåˆ™å°†â€œkey-valueâ€æ·»åŠ åˆ°tableä¸­ addEntry(hash, key, value, i); return null;} æ ¹æ®æºç åˆ†ææ‰€ä½œå‡ºçš„æµç¨‹å›¾ï¼š inflateTable--åˆå§‹åŒ–å“ˆå¸Œè¡¨ 123456789101112131415private void inflateTable(int toSize) { // 1. å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„æ¬¡å¹‚ // å³å¦‚æœä¼ å…¥çš„æ˜¯å®¹é‡å¤§å°æ˜¯19ï¼Œé‚£ä¹ˆè½¬åŒ–åï¼Œåˆå§‹åŒ–å®¹é‡å¤§å°ä¸º32ï¼ˆå³2çš„5æ¬¡å¹‚ï¼‰ int capacity = roundUpToPowerOf2(toSize);-&gt;&gt;åˆ†æ1 // 2. é‡æ–°è®¡ç®—é˜ˆå€¼ threshold = å®¹é‡ * åŠ è½½å› å­ threshold = (int) Math.min(capacity * loadFactor, MAXIMUM_CAPACITY + 1); // 3. ä½¿ç”¨è®¡ç®—åçš„åˆå§‹å®¹é‡ï¼ˆå·²ç»æ˜¯2çš„æ¬¡å¹‚ï¼‰ åˆå§‹åŒ–æ•°ç»„tableï¼ˆä½œä¸ºæ•°ç»„é•¿åº¦ï¼‰ // å³ å“ˆå¸Œè¡¨çš„å®¹é‡å¤§å° = æ•°ç»„å¤§å°ï¼ˆé•¿åº¦ï¼‰ table = new Entry[capacity]; //ç”¨è¯¥å®¹é‡åˆå§‹åŒ–table //åˆå§‹åŒ–å“ˆå¸Œç§å­ initHashSeedAsNeeded(capacity); } inflateTableè¿™ä¸ªæ–¹æ³•ç”¨äºä¸ºä¸»å¹²æ•°ç»„tableåœ¨å†…å­˜ä¸­åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œé€šè¿‡roundUpToPowerOf2(toSize)å¯ä»¥ç¡®ä¿capacityä¸ºå¤§äºæˆ–ç­‰äºtoSizeçš„æœ€æ¥è¿‘toSizeçš„äºŒæ¬¡å¹‚ï¼Œæ¯”å¦‚toSize=13,åˆ™capacity=16;to_size=16,capacity=16;to_size=17,capacity=32ã€‚ 123456private static int roundUpToPowerOf2(int number) { //è‹¥å®¹é‡è¶…è¿‡äº†æœ€å¤§å€¼ï¼Œåˆå§‹åŒ–å®¹é‡è®¾ç½®ä¸ºæœ€å¤§å€¼ ï¼›å¦åˆ™ï¼Œè®¾ç½®ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„æ¬¡å¹‚ return number &gt;= MAXIMUM_CAPACITY ? MAXIMUM_CAPACITY : (number &gt; 1) ? Integer.highestOneBit((number - 1) &lt;&lt; 1) : 1;} putForNullKey 1234567891011121314151617181920212223private V putForNullKey(V value) { // éå†ä»¥table[0]ä¸ºé¦–çš„é“¾è¡¨ï¼Œå¯»æ‰¾æ˜¯å¦å­˜åœ¨key==null å¯¹åº”çš„é”®å€¼å¯¹ // 1. è‹¥æœ‰ï¼šåˆ™ç”¨æ–°value æ›¿æ¢ æ—§valueï¼›åŒæ—¶è¿”å›æ—§çš„valueå€¼ for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) { if (e.key == null) { V oldValue = e.value; e.value = value; e.recordAccess(this); return oldValue; } } modCount++; // 2 .è‹¥æ— key==nullçš„é”®ï¼Œé‚£ä¹ˆè°ƒç”¨addEntryï¼ˆï¼‰ï¼Œå°†ç©ºé”® &amp; å¯¹åº”çš„å€¼å°è£…åˆ°Entryä¸­ï¼Œå¹¶æ”¾åˆ°table[0]ä¸­ addEntry(0, null, value, 0); // æ³¨ï¼š // a. addEntryï¼ˆï¼‰çš„ç¬¬1ä¸ªå‚æ•° = hashå€¼ = ä¼ å…¥0 // b. å³ è¯´æ˜ï¼šå½“key = nullæ—¶ï¼Œä¹Ÿæœ‰hashå€¼ = 0ï¼Œæ‰€ä»¥HashMapçš„key å¯ä¸ºnull // c. å¯¹æ¯”HashTableï¼Œç”±äºHashTableå¯¹keyç›´æ¥hashCodeï¼ˆï¼‰ï¼Œè‹¥keyä¸ºnullæ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥HashTableçš„keyä¸å¯ä¸ºnull // d. æ­¤å¤„åªéœ€çŸ¥é“æ˜¯å°† key-value æ·»åŠ åˆ°HashMapä¸­å³å¯ return null; } è®¡ç®—Hashå€¼ 123456789101112// è®¡ç®—Hashå€¼ï¼šå°† é”®key è½¬æ¢æˆ å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰æ“ä½œ = ä½¿ç”¨hashCode() + 4æ¬¡ä½è¿ç®— + 5æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ9æ¬¡æ‰°åŠ¨ï¼‰final int hash(Object k) { int h = hashSeed; //keyæ˜¯Stringç±»å‹çš„å°±ä½¿ç”¨å¦å¤–çš„å“ˆå¸Œç®—æ³• if (0 != h &amp;&amp; k instanceof String) { return sun.misc.Hashing.stringHash32((String) k); } h ^= k.hashCode(); //æ‰°åŠ¨å‡½æ•° h ^= (h &gt;&gt;&gt; 20) ^ (h &gt;&gt;&gt; 12); return h ^ (h &gt;&gt;&gt; 7) ^ (h &gt;&gt;&gt; 4);} hashæ–¹æ³•çš„æœ€åä¸¤è¡Œæ˜¯çœŸæ­£è®¡ç®—hashå€¼çš„ç®—æ³•ï¼Œè®¡ç®—hashç çš„ç®—æ³•è¢«ç§°ä¸ºæ‰°åŠ¨å‡½æ•°ï¼Œæ‰€è°“çš„æ‰°åŠ¨å‡½æ•°å°±æ˜¯æŠŠæ‰€æœ‰ä¸œè¥¿æ‚ç³…åˆ°ä¸€èµ·ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œä½¿ç”¨äº†å››ä¸ªå‘å³ç§»ä½è¿ç®—ã€‚ç›®çš„å°±æ˜¯å°†hçš„é«˜ä½å€¼ä¸ä½ä½å€¼æ··åˆä¸€ä¸‹ï¼Œä»¥æ­¤å¢åŠ ä½ä½å€¼çš„éšæœºæ€§ã€‚å®šä½æ•°ç»„çš„ä¸‹æ ‡æ˜¯æ ¹æ®hashç çš„ä½ä½å€¼æ¥ç¡®å®šçš„ã€‚keyçš„hashç æ˜¯é€šè¿‡hashCodeæ–¹æ³•æ¥ç”Ÿæˆçš„ï¼Œè€Œä¸€ä¸ªç³Ÿç³•çš„hashCodeæ–¹æ³•ç”Ÿæˆçš„hashç çš„ä½ä½å€¼å¯èƒ½ä¼šæœ‰å¾ˆå¤§çš„é‡å¤ã€‚ä¸ºäº†ä½¿å¾—hashç åœ¨æ•°ç»„ä¸Šæ˜ å°„çš„æ¯”è¾ƒå‡åŒ€ï¼Œæ‰°åŠ¨å‡½æ•°å°±æ´¾ä¸Šç”¨åœºäº†ï¼ŒæŠŠé«˜ä½å€¼çš„ç‰¹æ€§ç³…åˆè¿›ä½ä½å€¼ï¼Œå¢åŠ ä½ä½å€¼çš„éšæœºæ€§ï¼Œä»è€Œä½¿æ•£åˆ—åˆ†å¸ƒçš„æ›´åŠ æ¾æ•£ï¼Œä»¥æ­¤æé«˜æ€§èƒ½ã€‚ä¸‹å›¾ä¸¾äº†ä¸ªä¾‹å­å¸®åŠ©ç†è§£ã€‚ è®¡ç®—ç´¢å¼•å€¼ï¼ˆæ•°ç»„ä¸‹æ ‡ï¼‰ 1234567/** * è®¡ç®—ç´¢å¼•ä½ç½® */ static int indexFor(int h, int length) { return h &amp; (length-1); // å°†å¯¹å“ˆå¸Œç æ‰°åŠ¨å¤„ç†åçš„ç»“æœ ä¸è¿ç®—(&amp;) ï¼ˆæ•°ç»„é•¿åº¦-1ï¼‰ï¼Œæœ€ç»ˆå¾—åˆ°å­˜å‚¨åœ¨æ•°ç»„tableçš„ä½ç½®ï¼ˆå³æ•°ç»„ä¸‹æ ‡ã€ç´¢å¼•ï¼‰} h&amp;ï¼ˆlength-1ï¼‰ä¿è¯è·å–çš„indexä¸€å®šåœ¨æ•°ç»„èŒƒå›´å†…ï¼Œä¸¾ä¸ªä¾‹å­ï¼Œé»˜è®¤å®¹é‡16ï¼Œlength-1=15ï¼Œh=18,è½¬æ¢æˆäºŒè¿›åˆ¶è®¡ç®—ä¸º: 1234 1 0 0 1 0&amp; 0 1 1 1 1__________________ 0 0 0 1 0 = 2 æœ€ç»ˆè®¡ç®—å‡ºçš„index=2ã€‚æœ‰äº›ç‰ˆæœ¬çš„å¯¹äºæ­¤å¤„çš„è®¡ç®—ä¼šä½¿ç”¨ å–æ¨¡è¿ç®—ï¼Œä¹Ÿèƒ½ä¿è¯indexä¸€å®šåœ¨æ•°ç»„èŒƒå›´å†…ï¼Œä¸è¿‡ä½è¿ç®—å¯¹è®¡ç®—æœºæ¥è¯´ï¼Œæ€§èƒ½æ›´é«˜ä¸€äº›ï¼ˆHashMapä¸­æœ‰å¤§é‡ä½è¿ç®—ï¼‰ æ‰€ä»¥æœ€ç»ˆå­˜å‚¨ä½ç½®çš„ç¡®å®šæµç¨‹æ˜¯è¿™æ ·çš„ï¼š addEntry--æ·»åŠ é”®å€¼å¯¹ 1234567891011121314151617181920212223/** * æ·»åŠ é”®å€¼å¯¹ï¼ˆEntry ï¼‰åˆ° HashMapä¸­ * @param hash--keyå¯¹åº”çš„hashå€¼ * @param key--é”® * @param value--å€¼ * @param bucketIndex--å‡ºå…¥æ•°ç»„tableçš„ç´¢å¼•ä½ç½®--&gt;æ•°ç»„ä¸‹æ ‡ */void addEntry(int hash, K key, V value, int bucketIndex) { // 1. æ’å…¥å‰ï¼Œå…ˆåˆ¤æ–­å®¹é‡æ˜¯å¦è¶³å¤Ÿï¼Œè‹¥ä¸è¶³å¤Ÿï¼Œåˆ™è¿›è¡Œæ‰©å®¹ï¼ˆ2å€ï¼‰ã€é‡æ–°è®¡ç®—Hashå€¼ã€é‡æ–°è®¡ç®—å­˜å‚¨æ•°ç»„ä¸‹æ ‡ // å¦‚æœHashMapçš„å¤§å°å¤§äºé˜€å€¼å¹¶ä¸”å“ˆå¸Œè¡¨å¯¹åº”æ§½ä½çš„å€¼ä¸ä¸ºç©º if ((size &gt;= threshold) &amp;&amp; (null != table[bucketIndex])) { //å› ä¸ºHashMapçš„å¤§å°å¤§äºé˜€å€¼, è¡¨æ˜å³å°†å‘ç”Ÿå“ˆå¸Œå†²çª, æ‰€ä»¥è¿›è¡Œæ‰©å®¹ //2å€æ‰©å®¹ resize(2 * table.length); //é‡æ–°è®¡ç®—è¯¥keyå¯¹åº”çš„hashå€¼ hash = (null != key) ? hash(key) : 0; //é‡æ–°è®¡ç®—è¯¥keyå¯¹åº”çš„hashå€¼çš„å­˜å‚¨æ•°ç»„ä¸‹æ ‡ bucketIndex = indexFor(hash, table.length); } //åœ¨è¿™é‡Œè¡¨æ˜HashMapçš„å¤§å°æ²¡æœ‰è¶…è¿‡é˜€å€¼, æ‰€ä»¥ä¸éœ€è¦æ‰©å®¹ //åˆ›å»º1ä¸ªæ–°çš„æ•°ç»„å…ƒç´ (Entry)å¹¶æ”¾å…¥æ•°ç»„ä¸­ createEntry(hash, key, value, bucketIndex);} æµç¨‹å¦‚ä¸‹ï¼ˆé”®å€¼å¯¹çš„æ·»åŠ æ–¹å¼--&gt;å•é“¾è¡¨çš„å¤´æ’æ³•ï¼‰ï¼š resize--æ•°ç»„æ‰©å®¹ 12345678910111213141516171819202122/** * å¯¹å“ˆå¸Œè¡¨è¿›è¡Œæ‰©å®¹ï¼Œå½“å®¹é‡ä¸è¶³æ—¶ï¼ˆå®¹é‡ &gt; é˜ˆå€¼ï¼‰ï¼Œåˆ™æ‰©å®¹ï¼ˆæ‰©åˆ°2å€ï¼‰ */void resize(int newCapacity) { // 1. ä¿å­˜æ—§æ•°ç»„ï¼ˆold tableï¼‰ Entry[] oldTable = table; // 2. ä¿å­˜æ—§å®¹é‡ï¼ˆold capacity ï¼‰ï¼Œå³æ•°ç»„é•¿åº¦ int oldCapacity = oldTable.length; // 3. è‹¥æ—§å®¹é‡å·²ç»æ˜¯ç³»ç»Ÿé»˜è®¤æœ€å¤§å®¹é‡äº†ï¼Œé‚£ä¹ˆå°†é˜ˆå€¼è®¾ç½®æˆæ•´å‹çš„æœ€å¤§å€¼ï¼Œé€€å‡º if (oldCapacity == MAXIMUM_CAPACITY) { threshold = Integer.MAX_VALUE; return; } // 4. æ ¹æ®æ–°å®¹é‡ï¼ˆ2å€å®¹é‡ï¼‰æ–°å»º1ä¸ªæ•°ç»„ï¼Œå³æ–°table Entry[] newTable = new Entry[newCapacity]; // 5. å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°tableä¸­ï¼Œä»è€Œå®Œæˆæ‰©å®¹ transfer(newTable, initHashSeedAsNeeded(newCapacity)); // 6. å°†å½“å‰å“ˆå¸Œè¡¨è®¾ç½®ä¸ºæ–°çš„å“ˆå¸Œè¡¨ table = newTable; // 7. æ›´æ–°å“ˆå¸Œè¡¨é˜ˆå€¼ threshold = (int)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + 1);} æµç¨‹å¦‚ä¸‹ï¼š transfer--æ•°æ®è½¬ç§» 123456789101112131415161718192021222324252627282930313233343536 /** * å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°tableä¸­ï¼Œä»è€Œå®Œæˆæ‰©å®¹ * è¿‡ç¨‹ï¼šæŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ */ void transfer(Entry[] newTable) { // 1. srcå¼•ç”¨äº†æ—§æ•°ç»„ Entry[] src = table; // 2. è·å–æ–°æ•°ç»„çš„å¤§å° = è·å–æ–°å®¹é‡å¤§å° int newCapacity = newTable.length; // 3. é€šè¿‡éå† æ—§æ•°ç»„ï¼Œå°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰è½¬ç§»åˆ°æ–°æ•°ç»„ä¸­ for (int j = 0; j &lt; src.length; j++) { // 3.1 å–å¾—æ—§æ•°ç»„çš„æ¯ä¸ªå…ƒç´  Entry&lt;K,V&gt; e = src[j]; if (e != null) { // 3.2 é‡Šæ”¾æ—§æ•°ç»„çš„å¯¹è±¡å¼•ç”¨ï¼ˆforå¾ªç¯åï¼Œæ—§æ•°ç»„ä¸å†å¼•ç”¨ä»»ä½•å¯¹è±¡ï¼‰ src[j] = null; do { // 3.3 éå† ä»¥è¯¥æ•°ç»„å…ƒç´ ä¸ºé¦– çš„é“¾è¡¨ // æ³¨ï¼šè½¬ç§»é“¾è¡¨æ—¶ï¼Œå› æ˜¯å•é“¾è¡¨ï¼Œæ•…è¦ä¿å­˜ä¸‹1ä¸ªç»“ç‚¹ï¼Œå¦åˆ™è½¬ç§»åé“¾è¡¨ä¼šæ–­å¼€ Entry&lt;K,V&gt; next = e.next; // 3.4 é‡æ–°è®¡ç®—æ¯ä¸ªå…ƒç´ çš„å­˜å‚¨ä½ç½® int i = indexFor(e.hash, newCapacity); // 3.5 å°†å…ƒç´ æ”¾åœ¨æ•°ç»„ä¸Šï¼šé‡‡ç”¨å•é“¾è¡¨çš„å¤´æ’å…¥æ–¹å¼ = åœ¨é“¾è¡¨å¤´ä¸Šå­˜æ”¾æ•°æ® = å°†æ•°ç»„ä½ç½®çš„åŸæœ‰æ•°æ®æ”¾åœ¨å1ä¸ªæŒ‡é’ˆã€å°†éœ€æ”¾å…¥çš„æ•°æ®æ”¾åˆ°æ•°ç»„ä½ç½®ä¸­ // å³ æ‰©å®¹åï¼Œå¯èƒ½å‡ºç°é€†åºï¼šæŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ e.next = newTable[i]; newTable[i] = e; // 3.6 è®¿é—®ä¸‹1ä¸ªEntryé“¾ä¸Šçš„å…ƒç´ ï¼Œå¦‚æ­¤ä¸æ–­å¾ªç¯ï¼Œç›´åˆ°éå†å®Œè¯¥é“¾è¡¨ä¸Šçš„æ‰€æœ‰ç»“ç‚¹ e = next; } while (e != null); // å¦‚æ­¤ä¸æ–­å¾ªç¯ï¼Œç›´åˆ°éå†å®Œæ•°ç»„ä¸Šçš„æ‰€æœ‰æ•°æ®å…ƒç´  } } } æµç¨‹å¦‚ä¸‹ï¼š createEntry--æ·»åŠ é”®å€¼å¯¹ 123456789101112131415/** * åˆ›å»º1ä¸ªæ–°çš„æ•°ç»„å…ƒç´ ï¼ˆEntryï¼‰ å¹¶æ”¾å…¥åˆ°æ•°ç»„ä¸­ */ void createEntry(int hash, K key, V value, int bucketIndex) { // 1. æŠŠtableä¸­è¯¥ä½ç½®åŸæ¥çš„Entryä¿å­˜ Entry&lt;K,V&gt; e = table[bucketIndex]; // 2. åœ¨tableä¸­è¯¥ä½ç½®æ–°å»ºä¸€ä¸ªEntryï¼šå°†åŸå¤´ç»“ç‚¹ä½ç½®ï¼ˆæ•°ç»„ä¸Šï¼‰çš„é”®å€¼å¯¹ æ”¾å…¥åˆ°ï¼ˆé“¾è¡¨ï¼‰å1ä¸ªç»“ç‚¹ä¸­ã€å°†éœ€æ’å…¥çš„é”®å€¼å¯¹ æ”¾å…¥åˆ°å¤´ç»“ç‚¹ä¸­ï¼ˆæ•°ç»„ä¸Šï¼‰-&gt; ä»è€Œå½¢æˆé“¾è¡¨ // å³ åœ¨æ’å…¥å…ƒç´ æ—¶ï¼Œæ˜¯åœ¨é“¾è¡¨å¤´æ’å…¥çš„ï¼Œtableä¸­çš„æ¯ä¸ªä½ç½®æ°¸è¿œåªä¿å­˜æœ€æ–°æ’å…¥çš„Entryï¼Œæ—§çš„Entryåˆ™æ”¾å…¥åˆ°é“¾è¡¨ä¸­ï¼ˆå³ è§£å†³Hashå†²çªï¼‰ table[bucketIndex] = new Entry&lt;&gt;(hash, key, value, e); // 3. å“ˆå¸Œè¡¨çš„é”®å€¼å¯¹æ•°é‡è®¡æ•°å¢åŠ  size++; } æ€»ç»“ å‘ HashMap æ·»åŠ æ•°æ®ï¼ˆæˆå¯¹ æ”¾å…¥ é”® - å€¼å¯¹ï¼‰çš„å…¨æµç¨‹ï¼š getæ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * ä»HashMapä¸­è·å–æ•°æ® */ public V get(Object key) { // 1. å½“key == nullæ—¶ï¼Œåˆ™åˆ° ä»¥å“ˆå¸Œè¡¨æ•°ç»„ä¸­çš„ç¬¬1ä¸ªå…ƒç´ ï¼ˆå³table[0]ï¼‰ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨å»å¯»æ‰¾å¯¹åº” key == nullçš„é”® if (key == null) return getForNullKey(); // 2. å½“key â‰  nullæ—¶ï¼Œå»è·å¾—å¯¹åº”å€¼ Entry&lt;K,V&gt; entry = getEntry(key); return null == entry ? null : entry.getValue(); } /** * å½“key == nullæ—¶ï¼Œåˆ™åˆ° ä»¥å“ˆå¸Œè¡¨æ•°ç»„ä¸­çš„ç¬¬1ä¸ªå…ƒç´ ï¼ˆå³table[0]ï¼‰ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨å»å¯»æ‰¾å¯¹åº” key == nullçš„é”® */ private V getForNullKey() { if (size == 0) { return null; } // éå†ä»¥table[0]ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ï¼Œå¯»æ‰¾ key==null å¯¹åº”çš„å€¼ for (Entry&lt;K,V&gt; e = table[0]; e != null; e = e.next) { // ä»table[0]ä¸­å–key==nullçš„valueå€¼ if (e.key == null) return e.value; } return null; } /** * å½“key â‰  nullæ—¶ï¼Œå»è·å¾—å¯¹åº”å€¼ */ final Entry&lt;K,V&gt; getEntry(Object key) { if (size == 0) { return null; } // 1. æ ¹æ®keyå€¼ï¼Œé€šè¿‡hashï¼ˆï¼‰è®¡ç®—å‡ºå¯¹åº”çš„hashå€¼ int hash = (key == null) ? 0 : hash(key); // 2. æ ¹æ®hashå€¼è®¡ç®—å‡ºå¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ // 3. éå† ä»¥è¯¥æ•°ç»„ä¸‹æ ‡çš„æ•°ç»„å…ƒç´ ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨æ‰€æœ‰ç»“ç‚¹ï¼Œå¯»æ‰¾è¯¥keyå¯¹åº”çš„å€¼ for (Entry&lt;K,V&gt; e = table[indexFor(hash, table.length)]; e != null; e = e.next) { Object k; // è‹¥ hashå€¼ &amp; key ç›¸ç­‰ï¼Œåˆ™è¯æ˜è¯¥Entry = æˆ‘ä»¬è¦çš„é”®å€¼å¯¹ // é€šè¿‡equalsï¼ˆï¼‰åˆ¤æ–­keyæ˜¯å¦ç›¸ç­‰ if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; } return null; } æµç¨‹å¦‚ä¸‹ï¼š å…¶ä»–æ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132 /** * åˆ¤æ–­HashMapæ˜¯å¦ä¸ºç©ºï¼Œå³æ— é”®å€¼å¯¹ï¼›size == 0æ—¶ è¡¨ç¤ºä¸º ç©º */public boolean isEmpty() { return size == 0; } /** * è¿”å›å“ˆå¸Œè¡¨ä¸­æ‰€æœ‰ é”®å€¼å¯¹çš„æ•°é‡ = æ•°ç»„ä¸­çš„é”®å€¼å¯¹ + é“¾è¡¨ä¸­çš„é”®å€¼å¯¹ */public int size() { return size; } /** * æ¸…ç©ºå“ˆå¸Œè¡¨ï¼Œå³åˆ é™¤æ‰€æœ‰é”®å€¼å¯¹ * åŸç†ï¼šå°†æ•°ç»„tableä¸­å­˜å‚¨çš„Entryå…¨éƒ¨ç½®ä¸ºnullã€sizeç½®ä¸º0 */ public void clear() { modCount++; Arrays.fill(table, null); size = 0;} /** * å°†æŒ‡å®šMapä¸­çš„é”®å€¼å¯¹ å¤åˆ¶åˆ° æ­¤Mapä¸­ */ public void putAll(Map&lt;? extends K, ? extends V&gt; m) { // 1. ç»Ÿè®¡éœ€å¤åˆ¶å¤šå°‘ä¸ªé”®å€¼å¯¹ int numKeysToBeAdded = m.size(); if (numKeysToBeAdded == 0) return; // 2. è‹¥tableè¿˜æ²¡åˆå§‹åŒ–ï¼Œå…ˆç”¨åˆšåˆšç»Ÿè®¡çš„å¤åˆ¶æ•°å»åˆå§‹åŒ–table if (table == EMPTY_TABLE) { inflateTable((int) Math.max(numKeysToBeAdded * loadFactor, threshold)); } // 3. è‹¥éœ€å¤åˆ¶çš„æ•°ç›® &gt; é˜ˆå€¼ï¼Œåˆ™éœ€å…ˆæ‰©å®¹ if (numKeysToBeAdded &gt; threshold) { int targetCapacity = (int)(numKeysToBeAdded / loadFactor + 1); if (targetCapacity &gt; MAXIMUM_CAPACITY) targetCapacity = MAXIMUM_CAPACITY; int newCapacity = table.length; while (newCapacity &lt; targetCapacity) newCapacity &lt;&lt;= 1; if (newCapacity &gt; table.length) resize(newCapacity); } // 4. å¼€å§‹å¤åˆ¶ï¼ˆå®é™…ä¸Šä¸æ–­è°ƒç”¨Putå‡½æ•°æ’å…¥ï¼‰ for (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) put(e.getKey(), e.getValue());} /** * åˆ é™¤è¯¥é”®å€¼å¯¹ */ public V remove(Object key) { Entry&lt;K,V&gt; e = removeEntryForKey(key); return (e == null ? null : e.value); } final Entry&lt;K,V&gt; removeEntryForKey(Object key) { if (size == 0) { return null; } // 1. è®¡ç®—hashå€¼ int hash = (key == null) ? 0 : hash(key); // 2. è®¡ç®—å­˜å‚¨çš„æ•°ç»„ä¸‹æ ‡ä½ç½® int i = indexFor(hash, table.length); Entry&lt;K,V&gt; prev = table[i]; Entry&lt;K,V&gt; e = prev; while (e != null) { Entry&lt;K,V&gt; next = e.next; Object k; if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) { modCount++; size--; // è‹¥åˆ é™¤çš„æ˜¯tableæ•°ç»„ä¸­çš„å…ƒç´ ï¼ˆå³é“¾è¡¨çš„å¤´ç»“ç‚¹ï¼‰ // åˆ™åˆ é™¤æ“ä½œ = å°†å¤´ç»“ç‚¹çš„nextå¼•ç”¨å­˜å…¥table[i]ä¸­ if (prev == e) table[i] = next; //å¦åˆ™ å°†ä»¥table[i]ä¸ºå¤´ç»“ç‚¹çš„é“¾è¡¨ä¸­ï¼Œå½“å‰Entryçš„å‰1ä¸ªEntryä¸­çš„next è®¾ç½®ä¸º å½“å‰Entryçš„nextï¼ˆå³åˆ é™¤å½“å‰Entry = ç›´æ¥è·³è¿‡å½“å‰Entryï¼‰ else prev.next = next; e.recordRemoval(this); return e; } prev = e; e = next; } return e; } /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥é”®çš„é”®å€¼å¯¹ï¼›æ˜¯ åˆ™è¿”å›true * åŸç†ï¼šè°ƒç”¨getï¼ˆï¼‰ï¼Œåˆ¤æ–­æ˜¯å¦ä¸ºNull */public boolean containsKey(Object key) { return getEntry(key) != null; } /** * åˆ¤æ–­æ˜¯å¦å­˜åœ¨è¯¥å€¼çš„é”®å€¼å¯¹ï¼›æ˜¯ åˆ™è¿”å›true */ public boolean containsValue(Object value) { // è‹¥valueä¸ºç©ºï¼Œåˆ™è°ƒç”¨containsNullValue() if (value == null) return containsNullValue(); // è‹¥valueä¸ä¸ºç©ºï¼Œåˆ™éå†é“¾è¡¨ä¸­çš„æ¯ä¸ªEntryï¼Œé€šè¿‡equalsï¼ˆï¼‰æ¯”è¾ƒvalues åˆ¤æ–­æ˜¯å¦å­˜åœ¨ Entry[] tab = table; for (int i = 0; i &lt; tab.length ; i++) for (Entry e = tab[i] ; e != null ; e = e.next) if (value.equals(e.value)) return true;//è¿”å›true return false; } // valueä¸ºç©ºæ—¶è°ƒç”¨çš„æ–¹æ³• private boolean containsNullValue() { Entry[] tab = table; for (int i = 0; i &lt; tab.length ; i++) for (Entry e = tab[i] ; e != null ; e = e.next) if (e.value == null) return true; return false; } æ‰©å®¹å¯¼è‡´æ­»å¾ªç¯åˆ†æ HashMapæ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„ï¼ŒåŸå› å°±æ˜¯åœ¨å¤šçº¿ç¨‹ä¸‹å¹¶å‘æ‰§è¡Œput()æ“ä½œå¯¼è‡´è§¦å‘æ‰©å®¹resize()ï¼Œä»è€Œå¯¼è‡´ç¯å½¢é“¾è¡¨ï¼Œä½¿å¾—åœ¨è·å–æ•°æ®éå†é“¾è¡¨æ—¶å½¢æˆæ­»å¾ªç¯ã€‚ resize()çš„æºç å‰é¢å·²ç»åˆ†æè¿‡äº†ï¼Œä»æºç å¯ä»¥çœ‹å‡ºåœ¨resize()è¿‡ç¨‹ä¸­ï¼Œåœ¨å°†æ—§æ•°ç»„ä¸Šçš„æ•°æ®è½¬ç§»åˆ°æ–°æ•°ç»„ä¸Šæ—¶ï¼Œè½¬ç§»æ•°æ®æ“ä½œéœ€è¦å°†æ—§é“¾è¡¨æ­£åºéå†ï¼Œç„¶ååœ¨æ–°é“¾è¡¨çš„å¤´éƒ¨ä¾æ¬¡æ’å…¥ï¼Œå³åœ¨è½¬ç§»æ•°æ®ã€æ‰©å®¹åï¼Œå®¹æ˜“å‡ºç°é“¾è¡¨é€†åºçš„æƒ…å†µã€‚ å‡è®¾é‡æ–°è®¡ç®—å­˜å‚¨ä½ç½®åä¸å˜ï¼Œå³æ‰©å®¹å‰ 1-&gt;2-&gt;3ï¼Œæ‰©å®¹å 3-&gt;2-&gt;1ï¼Œæ­¤æ—¶è‹¥ï¼ˆå¤šçº¿ç¨‹ï¼‰å¹¶å‘æ‰§è¡Œ putï¼ˆï¼‰æ“ä½œï¼Œä¸€æ—¦å‡ºç°æ‰©å®¹æƒ…å†µï¼Œåˆ™ å®¹æ˜“å‡ºç° ç¯å½¢é“¾è¡¨ï¼Œä»è€Œåœ¨è·å–æ•°æ®ã€éå†é“¾è¡¨æ—¶ å½¢æˆæ­»å¾ªç¯ï¼ˆInfinite Loopï¼‰ï¼Œå³ æ­»é”çš„çŠ¶æ€ï¼Œå¦‚ä¸‹å›¾ï¼š æ³¨ï¼šç”±äº JDK 1.8 è½¬ç§»æ•°æ®æ“ä½œ = æŒ‰æ—§é“¾è¡¨çš„æ­£åºéå†é“¾è¡¨ã€åœ¨æ–°é“¾è¡¨çš„å°¾éƒ¨ä¾æ¬¡æ’å…¥ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°é“¾è¡¨ é€†åºã€å€’ç½®çš„æƒ…å†µï¼Œæ•…ä¸å®¹æ˜“å‡ºç°ç¯å½¢é“¾è¡¨çš„æƒ…å†µã€‚ä½† JDK 1.8 è¿˜æ˜¯çº¿ç¨‹ä¸å®‰å…¨ï¼Œå› ä¸º æ— åŠ åŒæ­¥é”ä¿æŠ¤ã€‚ HashMap-Jdk1.8 æ•°æ®ç»“æ„ åœ¨Jdk1.8ä¸­ï¼Œä¼˜åŒ–äº†HashMapçš„æ•°æ®ç»“æ„ï¼Œå¼•å…¥çº¢é»‘æ ‘ï¼Œå³HashMapçš„æ•°æ®ç»“æ„ = æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ã€‚ å¼•å…¥åŸå›  å¼•å…¥çº¢é»‘æ ‘çš„ç›®çš„åœ¨äºæé«˜HashMapçš„æ€§èƒ½ï¼Œå³è§£å†³å‘ç”Ÿå“ˆå¸Œç¢°æ’åï¼Œé“¾è¡¨è¿‡é•¿å¯¼è‡´ç´¢å¼•æ•ˆç‡æ…¢çš„é—®é¢˜ã€‚å…·ä½“å°±æ˜¯åˆ©ç”¨çº¢é»‘æ ‘å¿«é€Ÿå¢åˆ æ”¹æŸ¥çš„ç‰¹ç‚¹ï¼Œå°†æ—¶é—´å¤æ‚åº¦ä»åŸæ¥çš„O(n)é™åˆ°O(log(n))ã€‚ åº”ç”¨åœºæ™¯ å½“é“¾è¡¨é•¿åº¦&gt;8 æ—¶ï¼Œå°†è¯¥é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ï¼› æ•°ç»„å…ƒç´ &amp;é“¾è¡¨ç»“ç‚¹å®ç°ç±» Jdk1.8 HashMapä¸­çš„æ•°ç»„å…ƒç´ &amp;é“¾è¡¨ç»“ç‚¹é‡‡ç”¨Nodeç±»å®ç°ï¼Œè¯¥ç±»æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/** * Node = HashMapçš„å†…éƒ¨ç±»ï¼Œå®ç°äº†Map.Entryæ¥å£ï¼Œæœ¬è´¨æ˜¯ = ä¸€ä¸ªæ˜ å°„(é”®å€¼å¯¹) * å®ç°äº†getKey()ã€getValue()ã€equals(Object o)å’ŒhashCode()ç­‰æ–¹æ³• **/ static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; { final int hash; // å“ˆå¸Œå€¼ï¼ŒHashMapæ ¹æ®è¯¥å€¼ç¡®å®šè®°å½•çš„ä½ç½® final K key; // key V value; // value Node&lt;K,V&gt; next;// é“¾è¡¨ä¸‹ä¸€ä¸ªç»“ç‚¹ // æ„é€ æ–¹æ³• Node(int hash, K key, V value, Node&lt;K,V&gt; next) { this.hash = hash; this.key = key; this.value = value; this.next = next; } public final K getKey() { return key; } // è¿”å› ä¸ æ­¤é¡¹ å¯¹åº”çš„é”® public final V getValue() { return value; } // è¿”å› ä¸ æ­¤é¡¹ å¯¹åº”çš„å€¼ public final String toString() { return key + "=" + value; } public final V setValue(V newValue) { V oldValue = value; value = newValue; return oldValue; } public final int hashCode() { return Objects.hashCode(key) ^ Objects.hashCode(value); } /** * åˆ¤æ–­2ä¸ªEntryæ˜¯å¦ç›¸ç­‰ï¼Œå¿…é¡»keyå’Œvalueéƒ½ç›¸ç­‰ï¼Œæ‰è¿”å›true */ public final boolean equals(Object o) { if (o == this) return true; if (o instanceof Map.Entry) { Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o; if (Objects.equals(key, e.getKey()) &amp;&amp; Objects.equals(value, e.getValue())) return true; } return false; }} çº¢é»‘æ ‘ç»“ç‚¹å®ç°ç±» 12345678910111213141516171819202122232425/** * çº¢é»‘æ ‘ç»“ç‚¹ å®ç°ç±»ï¼šç»§æ‰¿è‡ªLinkedHashMap.Entry&lt;K,V&gt;ç±» */static final class TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; { // å±æ€§ = çˆ¶ç»“ç‚¹ã€å·¦å­æ ‘ã€å³å­æ ‘ã€åˆ é™¤è¾…åŠ©ç»“ç‚¹ + é¢œè‰²TreeNode&lt;K,V&gt; parent; TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right;TreeNode&lt;K,V&gt; prev; boolean red; // æ„é€ å‡½æ•°TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next) { super(hash, key, val, next); } // è¿”å›å½“å‰ç»“ç‚¹çš„æ ¹ç»“ç‚¹ final TreeNode&lt;K,V&gt; root() { for (TreeNode&lt;K,V&gt; r = this, p;;) { if ((p = r.parent) == null) return r; r = p; } } é‡è¦å±æ€§ 12345678910111213141516171819202122232425262728293031323334/** * ä¸»è¦å‚æ•° åŒ JDK 1.7 * å³ï¼šå®¹é‡ã€åŠ è½½å› å­ã€æ‰©å®¹é˜ˆå€¼ï¼ˆè¦æ±‚ã€èŒƒå›´å‡ç›¸åŒï¼‰ */// 1. å®¹é‡ï¼ˆcapacityï¼‰ï¼š å¿…é¡»æ˜¯2çš„å¹‚ &amp; &lt;æœ€å¤§å®¹é‡ï¼ˆ2çš„30æ¬¡æ–¹ï¼‰static final int DEFAULT_INITIAL_CAPACITY = 1 &lt;&lt; 4; // é»˜è®¤å®¹é‡ = 16 = 1&lt;&lt;4 = 00001ä¸­çš„1å‘å·¦ç§»4ä½ = 10000 = åè¿›åˆ¶çš„2^4=16static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30; // æœ€å¤§å®¹é‡ = 2çš„30æ¬¡æ–¹ï¼ˆè‹¥ä¼ å…¥çš„å®¹é‡è¿‡å¤§ï¼Œå°†è¢«æœ€å¤§å€¼æ›¿æ¢ï¼‰// 2. åŠ è½½å› å­(Load factor)ï¼šHashMapåœ¨å…¶å®¹é‡è‡ªåŠ¨å¢åŠ å‰å¯è¾¾åˆ°å¤šæ»¡çš„ä¸€ç§å°ºåº¦ final float loadFactor; // å®é™…åŠ è½½å› å­static final float DEFAULT_LOAD_FACTOR = 0.75f; // é»˜è®¤åŠ è½½å› å­ = 0.75// 3. æ‰©å®¹é˜ˆå€¼ï¼ˆthresholdï¼‰ï¼šå½“å“ˆå¸Œè¡¨çš„å¤§å° â‰¥ æ‰©å®¹é˜ˆå€¼æ—¶ï¼Œå°±ä¼šæ‰©å®¹å“ˆå¸Œè¡¨ï¼ˆå³æ‰©å……HashMapçš„å®¹é‡ï¼‰ // a. æ‰©å®¹ = å¯¹å“ˆå¸Œè¡¨è¿›è¡Œresizeæ“ä½œï¼ˆå³é‡å»ºå†…éƒ¨æ•°æ®ç»“æ„ï¼‰ï¼Œä»è€Œå“ˆå¸Œè¡¨å°†å…·æœ‰å¤§çº¦ä¸¤å€çš„æ¡¶æ•°// b. æ‰©å®¹é˜ˆå€¼ = å®¹é‡ x åŠ è½½å› å­int threshold;// 4. å…¶ä»–transient Node&lt;K,V&gt;[] table; // å­˜å‚¨æ•°æ®çš„Nodeç±»å‹ æ•°ç»„ï¼Œé•¿åº¦ = 2çš„å¹‚ï¼›æ•°ç»„çš„æ¯ä¸ªå…ƒç´  = 1ä¸ªå•é“¾è¡¨transient int size;// HashMapçš„å¤§å°ï¼Œå³ HashMapä¸­å­˜å‚¨çš„é”®å€¼å¯¹çš„æ•°é‡ /** * ä¸çº¢é»‘æ ‘ç›¸å…³çš„å‚æ•° */ // 1. æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼šå³ é“¾è¡¨è½¬æˆçº¢é»‘æ ‘çš„é˜ˆå€¼ï¼Œåœ¨å­˜å‚¨æ•°æ®æ—¶ï¼Œå½“é“¾è¡¨é•¿åº¦ &gt; è¯¥å€¼æ—¶ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ static final int TREEIFY_THRESHOLD = 8; // 2. æ¡¶çš„é“¾è¡¨è¿˜åŸé˜ˆå€¼ï¼šå³ çº¢é»‘æ ‘è½¬ä¸ºé“¾è¡¨çš„é˜ˆå€¼ï¼Œå½“åœ¨æ‰©å®¹ï¼ˆresizeï¼ˆï¼‰ï¼‰æ—¶ï¼ˆæ­¤æ—¶HashMapçš„æ•°æ®å­˜å‚¨ä½ç½®ä¼šé‡æ–°è®¡ç®—ï¼‰ï¼Œåœ¨é‡æ–°è®¡ç®—å­˜å‚¨ä½ç½®åï¼Œå½“åŸæœ‰çš„çº¢é»‘æ ‘å†…æ•°é‡ &lt; 6æ—¶ï¼Œåˆ™å°† çº¢é»‘æ ‘è½¬æ¢æˆé“¾è¡¨ static final int UNTREEIFY_THRESHOLD = 6; // 3. æœ€å°æ ‘å½¢åŒ–å®¹é‡é˜ˆå€¼ï¼šå³ å½“å“ˆå¸Œè¡¨ä¸­çš„å®¹é‡ &gt; è¯¥å€¼æ—¶ï¼Œæ‰å…è®¸æ ‘å½¢åŒ–é“¾è¡¨ ï¼ˆå³ å°†é“¾è¡¨ è½¬æ¢æˆçº¢é»‘æ ‘ï¼‰ // å¦åˆ™ï¼Œè‹¥æ¡¶å†…å…ƒç´ å¤ªå¤šæ—¶ï¼Œåˆ™ç›´æ¥æ‰©å®¹ï¼Œè€Œä¸æ˜¯æ ‘å½¢åŒ– // ä¸ºäº†é¿å…è¿›è¡Œæ‰©å®¹ã€æ ‘å½¢åŒ–é€‰æ‹©çš„å†²çªï¼Œè¿™ä¸ªå€¼ä¸èƒ½å°äº 4 * TREEIFY_THRESHOLD static final int MIN_TREEIFY_CAPACITY = 64; æ„é€ å‡½æ•° 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586/** * æºç åˆ†æï¼šä¸»è¦æ˜¯HashMapçš„æ„é€ å‡½æ•° = 4ä¸ª * ä»…è´´å‡ºå…³äºHashMapæ„é€ å‡½æ•°çš„æºç  */public class HashMap&lt;K,V&gt; extends AbstractMap&lt;K,V&gt; implements Map&lt;K,V&gt;, Cloneable, Serializable{ // çœç•¥ä¸ŠèŠ‚é˜è¿°çš„å‚æ•° /** * æ„é€ å‡½æ•°1ï¼šé»˜è®¤æ„é€ å‡½æ•°ï¼ˆæ— å‚ï¼‰ * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ = 0.75ã€16 */ public HashMap() { this.loadFactor = DEFAULT_LOAD_FACTOR; } /** * æ„é€ å‡½æ•°2ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€çš„æ„é€ å‡½æ•° * åŠ è½½å› å­ = é»˜è®¤ = 0.75 ã€å®¹é‡ = æŒ‡å®šå¤§å° */ public HashMap(int initialCapacity) { // å®é™…ä¸Šæ˜¯è°ƒç”¨æŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° // åªæ˜¯åœ¨ä¼ å…¥çš„åŠ è½½å› å­å‚æ•° = é»˜è®¤åŠ è½½å› å­ this(initialCapacity, DEFAULT_LOAD_FACTOR); } /** * æ„é€ å‡½æ•°3ï¼šæŒ‡å®šâ€œå®¹é‡å¤§å°â€å’Œâ€œåŠ è½½å› å­â€çš„æ„é€ å‡½æ•° * åŠ è½½å› å­ &amp; å®¹é‡ = è‡ªå·±æŒ‡å®š */ public HashMap(int initialCapacity, float loadFactor) { // æŒ‡å®šåˆå§‹å®¹é‡å¿…é¡»éè´Ÿï¼Œå¦åˆ™æŠ¥é”™ if (initialCapacity &lt; 0) throw new IllegalArgumentException("Illegal initial capacity: " + initialCapacity); // HashMapçš„æœ€å¤§å®¹é‡åªèƒ½æ˜¯MAXIMUM_CAPACITYï¼Œå“ªæ€•ä¼ å…¥çš„ &gt; æœ€å¤§å®¹é‡ if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; // å¡«å……æ¯”å¿…é¡»ä¸ºæ­£ if (loadFactor &lt;= 0 || Float.isNaN(loadFactor)) throw new IllegalArgumentException("Illegal load factor: " + loadFactor); // è®¾ç½® åŠ è½½å› å­ this.loadFactor = loadFactor; // è®¾ç½® æ‰©å®¹é˜ˆå€¼ // æ³¨ï¼šæ­¤å¤„ä¸æ˜¯çœŸæ­£çš„é˜ˆå€¼ï¼Œä»…ä»…åªæ˜¯å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„å¹‚ï¼Œè¯¥é˜ˆå€¼åé¢ä¼šé‡æ–°è®¡ç®— this.threshold = tableSizeFor(initialCapacity); } /** * æ„é€ å‡½æ•°4ï¼šåŒ…å«â€œå­Mapâ€çš„æ„é€ å‡½æ•° * å³ æ„é€ å‡ºæ¥çš„HashMapåŒ…å«ä¼ å…¥Mapçš„æ˜ å°„å…³ç³» * åŠ è½½å› å­ &amp; å®¹é‡ = é»˜è®¤ */ public HashMap(Map&lt;? extends K, ? extends V&gt; m) { // è®¾ç½®å®¹é‡å¤§å° &amp; åŠ è½½å› å­ = é»˜è®¤ this.loadFactor = DEFAULT_LOAD_FACTOR; // å°†ä¼ å…¥çš„å­Mapä¸­çš„å…¨éƒ¨å…ƒç´ é€ä¸ªæ·»åŠ åˆ°HashMapä¸­ putMapEntries(m, false); }}/** * å°†ä¼ å…¥çš„å®¹é‡å¤§å°è½¬åŒ–ä¸ºï¼š&gt;ä¼ å…¥å®¹é‡å¤§å°çš„æœ€å°çš„2çš„å¹‚ * ä¸JDK 1.7å¯¹æ¯”ï¼šç±»ä¼¼äºJDK 1.7 ä¸­ inflateTable()é‡Œçš„ roundUpToPowerOf2(toSize) */static final int tableSizeFor(int cap) { int n = cap - 1; n |= n &gt;&gt;&gt; 1; n |= n &gt;&gt;&gt; 2; n |= n &gt;&gt;&gt; 4; n |= n &gt;&gt;&gt; 8; n |= n &gt;&gt;&gt; 16; return (n &lt; 0) ? 1 : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + 1;} putæ“ä½œ 12345678/** * æºç åˆ†æï¼šä¸»è¦åˆ†æHashMapçš„putå‡½æ•° */public V put(K key, V value) { // 1. å¯¹ä¼ å…¥æ•°ç»„çš„é”®Keyè®¡ç®—Hashå€¼ // 2. å†è°ƒç”¨putValï¼ˆï¼‰æ·»åŠ æ•°æ®è¿›å» return putVal(hash(key), key, value, false, true);} hash--è®¡ç®—Hashå€¼ 1234567891011121314151617/** * hash(key) * ä½œç”¨ï¼šè®¡ç®—ä¼ å…¥æ•°æ®çš„å“ˆå¸Œç ï¼ˆå“ˆå¸Œå€¼ã€Hashå€¼ï¼‰ * è¯¥å‡½æ•°åœ¨JDK 1.7 å’Œ 1.8 ä¸­çš„å®ç°ä¸åŒï¼Œä½†åŸç†ä¸€æ · = æ‰°åŠ¨å‡½æ•° = ä½¿å¾—æ ¹æ®keyç”Ÿæˆçš„å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰åˆ†å¸ƒæ›´åŠ å‡åŒ€ã€æ›´å…·å¤‡éšæœºæ€§ï¼Œé¿å…å‡ºç°hashå€¼å†²çªï¼ˆå³æŒ‡ä¸åŒkeyä½†ç”ŸæˆåŒ1ä¸ªhashå€¼ï¼‰ * JDK 1.7 åšäº†9æ¬¡æ‰°åŠ¨å¤„ç† = 4æ¬¡ä½è¿ç®— + 5æ¬¡å¼‚æˆ–è¿ç®— * JDK 1.8 ç®€åŒ–äº†æ‰°åŠ¨å‡½æ•° = åªåšäº†2æ¬¡æ‰°åŠ¨ = 1æ¬¡ä½è¿ç®— + 1æ¬¡å¼‚æˆ–è¿ç®— */ // JDK 1.8å®ç°ï¼šå°† é”®key è½¬æ¢æˆ å“ˆå¸Œç ï¼ˆhashå€¼ï¼‰æ“ä½œ = ä½¿ç”¨hashCode() + 1æ¬¡ä½è¿ç®— + 1æ¬¡å¼‚æˆ–è¿ç®—ï¼ˆ2æ¬¡æ‰°åŠ¨ï¼‰ // 1. å–hashCodeå€¼ï¼š h = key.hashCode() // 2. é«˜ä½å‚ä¸ä½ä½çš„è¿ç®—ï¼šh ^ (h &gt;&gt;&gt; 16) static final int hash(Object key) { int h; return (key == null) ? 0 : (h = key.hashCode()) ^ (h &gt;&gt;&gt; 16); // a. å½“key = nullæ—¶ï¼Œhashå€¼ = 0ï¼Œæ‰€ä»¥HashMapçš„key å¯ä¸ºnull // æ³¨ï¼šå¯¹æ¯”HashTableï¼ŒHashTableå¯¹keyç›´æ¥hashCodeï¼ˆï¼‰ï¼Œè‹¥keyä¸ºnullæ—¶ï¼Œä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ‰€ä»¥HashTableçš„keyä¸å¯ä¸ºnull // b. å½“key â‰  nullæ—¶ï¼Œåˆ™é€šè¿‡å…ˆè®¡ç®—å‡º keyçš„ hashCode()ï¼ˆè®°ä¸ºhï¼‰ï¼Œç„¶å å¯¹å“ˆå¸Œç è¿›è¡Œ æ‰°åŠ¨å¤„ç†ï¼š æŒ‰ä½ å¼‚æˆ–ï¼ˆ^ï¼‰ å“ˆå¸Œç è‡ªèº«å³ç§»16ä½åçš„äºŒè¿›åˆ¶ } putVal--å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ ç”±äºæ•°æ®ç»“æ„ä¸­åŠ å…¥äº†çº¢é»‘æ ‘ï¼Œæ‰€ä»¥åœ¨å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ä¸­æ—¶ï¼Œéœ€è¿›è¡Œå¤šæ¬¡æ•°æ®ç»“æ„çš„åˆ¤æ–­ï¼šæ•°ç»„ã€çº¢é»‘æ ‘ã€é“¾è¡¨ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185 /** * å­˜æ”¾æ•°æ®åˆ°å“ˆå¸Œè¡¨ */final V putVal(int hash, K key, V value, boolean onlyIfAbsent, boolean evict) { Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; int n, i; // 1. è‹¥å“ˆå¸Œè¡¨çš„æ•°ç»„tabä¸ºç©ºæˆ–è€…é•¿åº¦ä¸º0ï¼Œåˆ™ é€šè¿‡resize() åˆ›å»º // æ‰€ä»¥ï¼Œåˆå§‹åŒ–å“ˆå¸Œè¡¨çš„æ—¶æœº = ç¬¬1æ¬¡è°ƒç”¨putå‡½æ•°æ—¶ï¼Œå³è°ƒç”¨resize() åˆå§‹åŒ–åˆ›å»º if ((tab = table) == null || (n = tab.length) == 0) n = (tab = resize()).length; // 2. è®¡ç®—æ’å…¥å­˜å‚¨çš„æ•°ç»„ç´¢å¼•iï¼šæ ¹æ®é”®å€¼keyè®¡ç®—çš„hashå€¼ å¾—åˆ° // æ­¤å¤„çš„æ•°ç»„ä¸‹æ ‡è®¡ç®—æ–¹å¼ = i = (n - 1) &amp; hashï¼ŒåŒJDK 1.7ä¸­çš„indexForï¼ˆï¼‰ // 3. æ’å…¥æ—¶ï¼Œéœ€åˆ¤æ–­æ˜¯å¦å­˜åœ¨Hashå†²çªï¼š // è‹¥ä¸å­˜åœ¨ï¼ˆå³å½“å‰table[i] == nullï¼‰ï¼Œåˆ™ç›´æ¥åœ¨è¯¥æ•°ç»„ä½ç½®æ–°å»ºç»“ç‚¹ï¼Œæ’å…¥å®Œæ¯• // å¦åˆ™ï¼Œä»£è¡¨å­˜åœ¨Hashå†²çªï¼Œå³å½“å‰å­˜å‚¨ä½ç½®å·²å­˜åœ¨ç»“ç‚¹ï¼Œåˆ™ä¾æ¬¡å¾€ä¸‹åˆ¤æ–­ï¼š // a. å½“å‰ä½ç½®çš„keyæ˜¯å¦ä¸éœ€æ’å…¥çš„keyç›¸åŒã€ // b. åˆ¤æ–­éœ€æ’å…¥çš„æ•°æ®ç»“æ„æ˜¯å¦ä¸ºçº¢é»‘æ ‘ or é“¾è¡¨ if ((p = tab[i = (n - 1) &amp; hash]) == null) tab[i] = newNode(hash, key, value, null); else {//è¯´æ˜å¾…æ’å…¥ä½ç½®å­˜åœ¨å…ƒç´  Node&lt;K,V&gt; e; K k; // a. åˆ¤æ–­ table[i]çš„å…ƒç´ çš„keyæ˜¯å¦ä¸ éœ€æ’å…¥çš„keyä¸€æ ·ï¼Œè‹¥ç›¸åŒåˆ™ ç›´æ¥ç”¨æ–°value è¦†ç›– æ—§value // åˆ¤æ–­åŸåˆ™ï¼šequalsï¼ˆï¼‰ if (p.hash == hash &amp;&amp; ((k = p.key) == key || (key != null &amp;&amp; key.equals(k)))) //å°†ç¬¬ä¸€ä¸ªå…ƒç´ èµ‹å€¼ç»™eï¼Œç”¨eæ¥è®°å½• e = p; // b. ç»§ç»­åˆ¤æ–­ï¼šéœ€æ’å…¥çš„æ•°æ®ç»“æ„æ˜¯å¦ä¸ºçº¢é»‘æ ‘ or é“¾è¡¨ // è‹¥æ˜¯çº¢é»‘æ ‘ï¼Œåˆ™ç›´æ¥åœ¨æ ‘ä¸­æ’å…¥ or æ›´æ–°é”®å€¼å¯¹ else if (p instanceof TreeNode) e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(this, tab, hash, key, value); // è‹¥æ˜¯é“¾è¡¨,åˆ™åœ¨é“¾è¡¨ä¸­æ’å…¥ or æ›´æ–°é”®å€¼å¯¹ // i. éå†table[i]ï¼Œåˆ¤æ–­Keyæ˜¯å¦å·²å­˜åœ¨ï¼šé‡‡ç”¨equalsï¼ˆï¼‰ å¯¹æ¯”å½“å‰éå†ç»“ç‚¹çš„key ä¸ éœ€æ’å…¥æ•°æ®çš„keyï¼šè‹¥å·²å­˜åœ¨ï¼Œåˆ™ç›´æ¥ç”¨æ–°value è¦†ç›– æ—§value // ii. éå†å®Œæ¯•åä»æ— å‘ç°ä¸Šè¿°æƒ…å†µï¼Œåˆ™ç›´æ¥åœ¨é“¾è¡¨å°¾éƒ¨æ’å…¥æ•°æ® // æ³¨ï¼šæ–°å¢ç»“ç‚¹åï¼Œéœ€åˆ¤æ–­é“¾è¡¨é•¿åº¦æ˜¯å¦&gt;8ï¼ˆ8 = æ¡¶çš„æ ‘åŒ–é˜ˆå€¼ï¼‰ï¼šè‹¥æ˜¯ï¼Œåˆ™æŠŠé“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ else { //åœ¨é“¾è¡¨æœ«å°¾æ’å…¥ç»“ç‚¹ for (int binCount = 0; ; ++binCount) { // å¯¹äºiiï¼šè‹¥æ•°ç»„çš„ä¸‹1ä¸ªä½ç½®ï¼Œè¡¨ç¤ºå·²åˆ°è¡¨å°¾ä¹Ÿæ²¡æœ‰æ‰¾åˆ°keyå€¼ç›¸åŒç»“ç‚¹ï¼Œåˆ™æ–°å»ºç»“ç‚¹ = æ’å…¥ç»“ç‚¹ // æ³¨ï¼šæ­¤å¤„æ˜¯ä»é“¾è¡¨å°¾æ’å…¥ï¼Œä¸JDK 1.7ä¸åŒï¼ˆä»é“¾è¡¨å¤´æ’å…¥ï¼Œå³æ°¸è¿œéƒ½æ˜¯æ·»åŠ åˆ°æ•°ç»„çš„ä½ç½®ï¼ŒåŸæ¥æ•°ç»„ä½ç½®çš„æ•°æ®åˆ™å¾€åç§»ï¼‰ if ((e = p.next) == null) { p.next = newNode(hash, key, value, null); // æ’å…¥ç»“ç‚¹åï¼Œè‹¥é“¾è¡¨ç»“ç‚¹&gt;æ•°é˜ˆå€¼ï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ if (binCount &gt;= TREEIFY_THRESHOLD - 1) // -1 for 1st //é“¾è¡¨è½¬çº¢é»‘æ ‘ treeifyBin(tab, hash); break; } //éå†table[i]ï¼Œåˆ¤æ–­Keyæ˜¯å¦å·²å­˜åœ¨ï¼šé‡‡ç”¨equalsï¼ˆï¼‰ å¯¹æ¯”å½“å‰éå†ç»“ç‚¹çš„key ä¸ éœ€æ’å…¥æ•°æ®çš„key if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) //ç›¸ç­‰ï¼Œè·³å‡ºå¾ªç¯ break; // æ›´æ–°pæŒ‡å‘ä¸‹ä¸€ä¸ªç»“ç‚¹ï¼Œç»§ç»­éå† p = e; } } //è¡¨ç¤ºåœ¨æ¡¶ä¸­æ‰¾åˆ°keyå€¼ã€hashå€¼ä¸æ’å…¥å…ƒç´ ç›¸ç­‰çš„ç»“ç‚¹ï¼Œç›´æ¥ç”¨æ–°value è¦†ç›– æ—§value å¹¶ è¿”å›æ—§value if (e != null) { // existing mapping for key //è®°å½•eçš„value V oldValue = e.value; if (!onlyIfAbsent || oldValue == null) //æ–°å€¼æ›¿æ¢æ—§å€¼ e.value = value; afterNodeAccess(e);// æ›¿æ¢æ—§å€¼æ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼ˆé»˜è®¤å®ç°ä¸ºç©ºï¼‰ //è¿”å›æ—§å€¼ return oldValue; } } ++modCount; // æ’å…¥æˆåŠŸåï¼Œåˆ¤æ–­å®é™…å­˜åœ¨çš„é”®å€¼å¯¹æ•°é‡size &gt; æœ€å¤§å®¹é‡threshold // è‹¥ &gt; ï¼Œåˆ™è¿›è¡Œæ‰©å®¹ if (++size &gt; threshold) resize(); afterNodeInsertion(evict);// æ’å…¥æˆåŠŸæ—¶ä¼šè°ƒç”¨çš„æ–¹æ³•ï¼ˆé»˜è®¤å®ç°ä¸ºç©ºï¼‰ return null;}/** * å‘çº¢é»‘æ ‘æ’å…¥ or æ›´æ–°æ•°æ®ï¼ˆé”®å€¼å¯¹ï¼‰ * è¿‡ç¨‹ï¼šéå†çº¢é»‘æ ‘åˆ¤æ–­è¯¥ç»“ç‚¹çš„keyæ˜¯å¦ä¸éœ€æ’å…¥çš„key ç›¸åŒï¼š * a. è‹¥ç›¸åŒï¼Œåˆ™æ–°valueè¦†ç›–æ—§value * b. è‹¥ä¸ç›¸åŒï¼Œåˆ™æ’å…¥ */final TreeNode&lt;K,V&gt; putTreeVal(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, int h, K k, V v) { Class&lt;?&gt; kc = null; boolean searched = false; TreeNode&lt;K,V&gt; root = (parent != null) ? root() : this; //ä»æ ¹ç»“ç‚¹å¼€å§‹æŸ¥æ‰¾åˆé€‚çš„æ’å…¥ä½ç½®ï¼ˆä¸äºŒå‰æœç´¢æ ‘æŸ¥æ‰¾è¿‡ç¨‹ç›¸åŒï¼‰ for (TreeNode&lt;K,V&gt; p = root;;) { int dir, ph; K pk; if ((ph = p.hash) &gt; h) dir = -1;//dirå°äº0ï¼Œæ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰ç»“ç‚¹çš„å·¦å­©å­ else if (ph &lt; h) dir = 1;//dirå¤§äº0ï¼Œæ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰ç»“ç‚¹çš„å³å­©å­ else if ((pk = p.key) == k || (k != null &amp;&amp; k.equals(pk))) //è¿™é‡Œä»£è¡¨hashå€¼ç›¸åŒï¼Œkeyç›¸åŒ return p; /** *è¦è¿›å…¥ä¸‹é¢è¿™ä¸ªelse if,ä»£è¡¨æœ‰ä»¥ä¸‹å‡ ä¸ªå«ä¹‰: *1ã€å½“å‰ç»“ç‚¹ä¸å¾…æ’å…¥ç»“ç‚¹ key ä¸åŒ, hash å€¼ç›¸åŒ; *2ã€ï½‹æ˜¯ä¸å¯æ¯”è¾ƒçš„ï¼Œå³ï½‹å¹¶æœªå®ç° comparable&lt;K&gt; æ¥å£ * ï¼ˆè‹¥ k å®ç°äº†comparable&lt;K&gt; æ¥å£ï¼ŒcomparableClassForï¼ˆkï¼‰è¿”å›çš„æ˜¯ï½‹çš„ class,è€Œä¸æ˜¯ nullï¼‰ * æˆ–è€… compareComparables(kc, k, pk) è¿”å›å€¼ä¸º 0 * (pk ä¸ºç©º æˆ–è€… æŒ‰ç…§ k.compareTo(pk) è¿”å›å€¼ä¸ºï¼ï¼Œ * è¿”å›å€¼ä¸ºï¼å¯èƒ½æ˜¯ç”±äº ï½‹çš„compareTo æ–¹æ³•å®ç°ä¸å½“å¼•èµ·çš„ï¼ŒcompareTo åˆ¤å®šç›¸ç­‰ï¼Œè€Œä¸Šä¸ª else if ä¸­ equals åˆ¤å®šä¸ç­‰) */ else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) { //åœ¨ä»¥å½“å‰ç»“ç‚¹ä¸ºæ ¹çš„æ•´ä¸ªæ ‘ä¸Šæœç´¢æ˜¯å¦å­˜åœ¨å¾…æ’å…¥çš„ç»“ç‚¹ï¼ˆåªä¼šæœç´¢ä¸€æ¬¡ï¼‰ if (!searched) { TreeNode&lt;K,V&gt; q, ch; searched = true; if (((ch = p.left) != null &amp;&amp; (q = ch.find(h, k, kc)) != null) || ((ch = p.right) != null &amp;&amp; (q = ch.find(h, k, kc)) != null)) return q; } //å¦‚æœä»æœªæ¯”è¾ƒå‡ºå¤§å°ï¼Œå°±éœ€è¦è¿›è¡Œä»²è£äº†ï¼Œä»²è£æ–¹æ³•ä¸º tieBreakOrder dir = tieBreakOrder(k, pk); } TreeNode&lt;K,V&gt; xp = p; if ((p = (dir &lt;= 0) ? p.left : p.right) == null) { //æ‰¾åˆ°äº†å¾…æ’å…¥çš„ä½ç½®ï¼Œxp ä¸ºå¾…æ’å…¥ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ //æ³¨æ„TreeNodeç»“ç‚¹ä¸­æ—¢å­˜åœ¨æ ‘çŠ¶å…³ç³»ï¼Œä¹Ÿå­˜åœ¨é“¾å¼å…³ç³»ï¼Œå¹¶ä¸”æ˜¯åŒç«¯é“¾è¡¨ Node&lt;K,V&gt; xpn = xp.next; TreeNode&lt;K,V&gt; x = map.newTreeNode(h, k, v, xpn); if (dir &lt;= 0) xp.left = x; else xp.right = x; xp.next = x; x.parent = x.prev = xp; if (xpn != null) ((TreeNode&lt;K,V&gt;)xpn).prev = x; //æ’å…¥ç»“ç‚¹åè¿›è¡ŒäºŒå‰æ ‘çš„å¹³è¡¡æ“ä½œ moveRootToFront(tab, balanceInsertion(root, x)); return null; } }}/** * å°†æ™®é€šç»“ç‚¹é“¾è¡¨è½¬æ¢æˆæ ‘å½¢ç»“ç‚¹é“¾è¡¨ * æ ‘åŒ–è¦æ»¡è¶³ä¸¤ä¸ªæ¡ä»¶ï¼š * 1. é“¾è¡¨é•¿åº¦å¤§äºç­‰äº TREEIFY_THRESHOLD * 2. æ¡¶æ•°ç»„å®¹é‡å¤§äºç­‰äº MIN_TREEIFY_CAPACITY * ç¬¬ä¸€ä¸ªæ¡ä»¶æ¯”è¾ƒå¥½ç†è§£ï¼ŒåŠ å…¥ç¬¬äºŒä¸ªæ¡ä»¶ï¼Œä¸ªäººè§‰å¾—åŸå› å¦‚ä¸‹ï¼š * å½“æ¡¶æ•°ç»„å®¹é‡æ¯”è¾ƒå°æ—¶ï¼Œé”®å€¼å¯¹ç»“ç‚¹ hash çš„ç¢°æ’ç‡å¯èƒ½ä¼šæ¯”è¾ƒé«˜ï¼Œè¿›è€Œå¯¼è‡´é“¾è¡¨é•¿åº¦è¾ƒé•¿ã€‚ * è¿™ä¸ªæ—¶å€™åº”è¯¥ä¼˜å…ˆæ‰©å®¹ï¼Œè€Œä¸æ˜¯ç«‹é©¬æ ‘åŒ–ã€‚æ¯•ç«Ÿé«˜ç¢°æ’ç‡æ˜¯å› ä¸ºæ¡¶æ•°ç»„å®¹é‡è¾ƒå°å¼•èµ·çš„ï¼Œè¿™ä¸ªæ˜¯ä¸»å› ã€‚ * å®¹é‡å°æ—¶ï¼Œä¼˜å…ˆæ‰©å®¹å¯ä»¥é¿å…ä¸€äº›åˆ—çš„ä¸å¿…è¦çš„æ ‘åŒ–è¿‡ç¨‹ã€‚åŒæ—¶ï¼Œæ¡¶å®¹é‡è¾ƒå°æ—¶ï¼Œæ‰©å®¹ä¼šæ¯”è¾ƒé¢‘ç¹ï¼Œæ‰©å®¹æ—¶éœ€è¦æ‹†åˆ†çº¢é»‘æ ‘å¹¶é‡æ–°æ˜ å°„ã€‚æ‰€ä»¥åœ¨æ¡¶å®¹é‡æ¯”è¾ƒå°çš„æƒ…å†µä¸‹ï¼Œå°†é•¿é“¾è¡¨è½¬æˆçº¢é»‘æ ‘æ˜¯ä¸€ä»¶åƒåŠ›ä¸è®¨å¥½çš„äº‹ã€‚ */final void treeifyBin(Node&lt;K,V&gt;[] tab, int hash) { int n, index; Node&lt;K,V&gt; e; //// å¦‚æœ tab.length å°äº MIN_TREEIFY_CAPACITYï¼Œ ä¼˜å…ˆè¿›è¡Œæ‰©å®¹è€Œä¸æ˜¯æ ‘åŒ– if (tab == null || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY) resize(); else if ((e = tab[index = (n - 1) &amp; hash]) != null) { // hd ä¸ºå¤´ç»“ç‚¹ï¼ˆheadï¼‰ï¼Œtl ä¸ºå°¾ç»“ç‚¹ï¼ˆtailï¼‰ TreeNode&lt;K,V&gt; hd = null, tl = null; do { // å°†æ™®é€šç»“ç‚¹æ›¿æ¢æˆæ ‘å½¢ç»“ç‚¹ TreeNode&lt;K,V&gt; p = replacementTreeNode(e, null); if (tl == null) hd = p; else { p.prev = tl; tl.next = p; } tl = p; } while ((e = e.next) != null);// å°†æ™®é€šé“¾è¡¨è½¬æˆç”±æ ‘å½¢ç»“ç‚¹é“¾è¡¨ if ((tab[index] = hd) != null) // å°†æ ‘å½¢é“¾è¡¨è½¬æ¢æˆçº¢é»‘æ ‘ hd.treeify(tab); }} æµç¨‹å›¾å¦‚ä¸‹ï¼š resize--æ‰©å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185/** * æ‰©å®¹ * è¯¥å‡½æ•°æœ‰2ç§ä½¿ç”¨æƒ…å†µï¼š1.åˆå§‹åŒ–å“ˆå¸Œè¡¨ 2.å½“å‰æ•°ç»„å®¹é‡è¿‡å°ï¼Œéœ€æ‰©å®¹ */final Node&lt;K,V&gt;[] resize() { //// æ‰©å®¹å‰çš„æ•°ç»„ï¼ˆå½“å‰æ•°ç»„ï¼‰ Node&lt;K,V&gt;[] oldTab = table; //// æ‰©å®¹å‰çš„æ•°ç»„çš„å®¹é‡ = é•¿åº¦ int oldCap = (oldTab == null) ? 0 : oldTab.length; //// æ‰©å®¹å‰çš„æ•°ç»„çš„é˜ˆå€¼ int oldThr = threshold; int newCap, newThr = 0; // å¦‚æœ table ä¸ä¸ºç©ºï¼Œè¡¨æ˜å·²ç»åˆå§‹åŒ–è¿‡äº† if (oldCap &gt; 0) { //è‹¥æ‰©å®¹å‰çš„æ•°ç»„å®¹é‡è¶…è¿‡æœ€å¤§å€¼ï¼Œåˆ™ä¸å†æ‰©å®¹ if (oldCap &gt;= MAXIMUM_CAPACITY) { threshold = Integer.MAX_VALUE; return oldTab; } //è‹¥æœªè¶…è¿‡æœ€å¤§å€¼ï¼Œåˆ™æ‰©å®¹ä¸ºåŸæ¥çš„2å€ else if ((newCap = oldCap &lt;&lt; 1) &lt; MAXIMUM_CAPACITY &amp;&amp; oldCap &gt;= DEFAULT_INITIAL_CAPACITY) newThr = oldThr &lt;&lt; 1; // double threshold } else if (oldThr &gt; 0) // initial capacity was placed in threshold /* * åˆå§‹åŒ–æ—¶ï¼Œå°† threshold çš„å€¼èµ‹å€¼ç»™ newCapï¼Œ * HashMap ä½¿ç”¨ threshold å˜é‡æš‚æ—¶ä¿å­˜ initialCapacity å‚æ•°çš„å€¼ */ newCap = oldThr; else { /* * è°ƒç”¨æ— å‚æ„é€ æ–¹æ³•æ—¶ï¼Œæ¡¶æ•°ç»„å®¹é‡ä¸ºé»˜è®¤å®¹é‡ï¼Œ * é˜ˆå€¼ä¸ºé»˜è®¤å®¹é‡ä¸é»˜è®¤è´Ÿè½½å› å­ä¹˜ç§¯ */ newCap = DEFAULT_INITIAL_CAPACITY; newThr = (int)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY); } //è®¡ç®—æ–°çš„resizeä¸Šé™ if (newThr == 0) { float ft = (float)newCap * loadFactor; newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (float)MAXIMUM_CAPACITY ? (int)ft : Integer.MAX_VALUE); } threshold = newThr; @SuppressWarnings({"rawtypes","unchecked"}) // åˆ›å»ºæ–°çš„æ¡¶æ•°ç»„ï¼Œæ¡¶æ•°ç»„çš„åˆå§‹åŒ–ä¹Ÿæ˜¯åœ¨è¿™é‡Œå®Œæˆçš„ Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])new Node[newCap]; table = newTab; if (oldTab != null) { // æŠŠæ¯ä¸ªbucketéƒ½ç§»åŠ¨åˆ°æ–°çš„bucketsä¸­ for (int j = 0; j &lt; oldCap; ++j) { Node&lt;K,V&gt; e; if ((e = oldTab[j]) != null) { // æ¸…é™¤åŸæ¥table[i]ä¸­çš„å€¼ oldTab[j] = null; if (e.next == null) newTab[e.hash &amp; (newCap - 1)] = e; else if (e instanceof TreeNode) //å¦‚æœeæ˜¯çº¢é»‘æ ‘ç»“ç‚¹ï¼Œèµ°çº¢é»‘æ ‘æ›¿æ¢æ–¹å¼ ((TreeNode&lt;K,V&gt;)e).split(this, newTab, j, oldCap); else {// å¦‚æœ table[j] åæ˜¯ä¸€ä¸ªé“¾è¡¨ ï¼Œå°†åŸé“¾è¡¨æ‹†åˆ†ä¸ºä¸¤æ¡é“¾ï¼Œåˆ†åˆ«æ”¾åˆ°newTabä¸­ Node&lt;K,V&gt; loHead = null, loTail = null; Node&lt;K,V&gt; hiHead = null, hiTail = null; Node&lt;K,V&gt; next; do { next = e.next; // åŸç´¢å¼•ï¼Œ(e.hash &amp; oldCap) == 0 è¯´æ˜ åœ¨putæ“ä½œé€šè¿‡ hash &amp; newThr //è®¡ç®—å‡ºçš„ç´¢å¼•å€¼ç­‰äºç°åœ¨çš„ç´¢å¼•å€¼ã€‚ if ((e.hash &amp; oldCap) == 0) { if (loTail == null) loHead = e; else loTail.next = e; loTail = e; } // åŸç´¢å¼•+oldCapï¼Œä¸æ˜¯åŸç´¢å¼•ï¼Œå°±ç§»åŠ¨åŸæ¥çš„é•¿åº¦ else { if (hiTail == null) hiHead = e; else hiTail.next = e; hiTail = e; } } while ((e = next) != null); //åŸç´¢å¼•æ”¾åˆ°bucketé‡Œ if (loTail != null) { loTail.next = null; newTab[j] = loHead; } // åŸç´¢å¼•+oldCapæ”¾åˆ°bucketé‡Œ if (hiTail != null) { hiTail.next = null; newTab[j + oldCap] = hiHead; } } } } } return newTab;}// çº¢é»‘æ ‘è½¬é“¾è¡¨é˜ˆå€¼static final int UNTREEIFY_THRESHOLD = 6;/** *è¿™ä¸ªå‡½æ•°çš„åŠŸèƒ½æ˜¯å¯¹çº¢é»‘æ ‘è¿›è¡Œrehash æ“ä½œ(æ‹†åˆ†çº¢é»‘æ ‘) * é‡æ–°æ˜ å°„çº¢é»‘æ ‘çš„é€»è¾‘å’Œé‡æ–°æ˜ å°„é“¾è¡¨çš„é€»è¾‘åŸºæœ¬ä¸€è‡´ã€‚ä¸åŒçš„åœ°æ–¹åœ¨äºï¼Œé‡æ–°æ˜ å°„åï¼Œä¼šå°†çº¢é»‘æ ‘æ‹†åˆ†æˆä¸¤æ¡ç”± TreeNode ç»„æˆçš„é“¾è¡¨ã€‚ * å¦‚æœé“¾è¡¨é•¿åº¦å°äº UNTREEIFY_THRESHOLDï¼Œåˆ™å°†é“¾è¡¨è½¬æ¢æˆæ™®é€šé“¾è¡¨ã€‚å¦åˆ™æ ¹æ®æ¡ä»¶é‡æ–°å°† TreeNode é“¾è¡¨æ ‘åŒ–ã€‚ */final void split(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, int index, int bit) { TreeNode&lt;K,V&gt; b = this; // Relink into lo and hi lists, preserving order TreeNode&lt;K,V&gt; loHead = null, loTail = null; TreeNode&lt;K,V&gt; hiHead = null, hiTail = null; int lc = 0, hc = 0; //ç”±äºTreeNode ç»“ç‚¹ä¹‹é—´å­˜åœ¨åŒç«¯é“¾è¡¨çš„å…³ç³»ï¼Œå¯ä»¥åˆ©ç”¨é“¾è¡¨å…³ç³»è¿›è¡Œ rehash for (TreeNode&lt;K,V&gt; e = b, next; e != null; e = next) { next = (TreeNode&lt;K,V&gt;)e.next; e.next = null; if ((e.hash &amp; bit) == 0) { if ((e.prev = loTail) == null) loHead = e; else loTail.next = e; loTail = e; ++lc; } else { if ((e.prev = hiTail) == null) hiHead = e; else hiTail.next = e; hiTail = e; ++hc; } } // å¦‚æœ loHead ä¸ä¸ºç©ºï¼Œä¸”é“¾è¡¨é•¿åº¦å°äºç­‰äº 6ï¼Œåˆ™å°†çº¢é»‘æ ‘è½¬æˆé“¾è¡¨ if (loHead != null) { if (lc &lt;= UNTREEIFY_THRESHOLD) tab[index] = loHead.untreeify(map); else { tab[index] = loHead; /* * hiHead == null æ—¶ï¼Œè¡¨æ˜æ‰©å®¹åï¼Œ * æ‰€æœ‰ç»“ç‚¹ä»åœ¨åŸä½ç½®ï¼Œæ ‘ç»“æ„ä¸å˜ï¼Œæ— éœ€é‡æ–°æ ‘åŒ– */ if (hiHead != null) loHead.treeify(tab); } } // ä¸ä¸Šé¢ç±»ä¼¼ if (hiHead != null) { if (hc &lt;= UNTREEIFY_THRESHOLD) tab[index + bit] = hiHead.untreeify(map); else { tab[index + bit] = hiHead; if (loHead != null) hiHead.treeify(tab); } }}/** *çº¢é»‘æ ‘é“¾åŒ– */final Node&lt;K,V&gt; untreeify(HashMap&lt;K,V&gt; map) { Node&lt;K,V&gt; hd = null, tl = null; // éå† TreeNode é“¾è¡¨ï¼Œå¹¶ç”¨ Node æ›¿æ¢ for (Node&lt;K,V&gt; q = this; q != null; q = q.next) { // æ›¿æ¢ç»“ç‚¹ç±»å‹ Node&lt;K,V&gt; p = map.replacementNode(q, null); if (tl == null) hd = p; else tl.next = p; tl = p; } return hd;}Node&lt;K,V&gt; replacementNode(Node&lt;K,V&gt; p, Node&lt;K,V&gt; next) { return new Node&lt;&gt;(p.hash, p.key, p.value, next);} æµç¨‹å¦‚ä¸‹ï¼š resize()æ–¹æ³•ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯é“¾è¡¨å’Œçº¢é»‘æ ‘çš„ rehash æ“ä½œï¼Œrehash çš„å®ç°åŸç†å¦‚ä¸‹ï¼š åœ¨æ‰©å®¹çš„æ—¶å€™ï¼Œä¸€èˆ¬æ˜¯æŠŠé•¿åº¦æ‰©ä¸ºåŸæ¥2å€ï¼Œæ‰€ä»¥ï¼Œå…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œnä¸ºtableçš„é•¿åº¦ï¼Œå›¾ï¼ˆaï¼‰è¡¨ç¤ºæ‰©å®¹å‰çš„key1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå›¾ï¼ˆbï¼‰è¡¨ç¤ºæ‰©å®¹åkey1å’Œkey2ä¸¤ç§keyç¡®å®šç´¢å¼•ä½ç½®çš„ç¤ºä¾‹ï¼Œå…¶ä¸­hash1æ˜¯key1å¯¹åº”çš„å“ˆå¸Œä¸é«˜ä½è¿ç®—ç»“æœã€‚ å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š å› æ­¤ï¼Œåœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œåªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€ï¼Œå¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š è¿™ä¸ªç®—æ³•å¾ˆå·§å¦™ï¼Œæ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„ç»“ç‚¹åˆ†æ•£åˆ°æ–°çš„æ§½ä¸­äº†ã€‚ getæ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637/** *ä»HashMapä¸­è·å–æ•°æ® */public V get(Object key) { Node&lt;K,V&gt; e; // 1. è®¡ç®—éœ€è·å–æ•°æ®çš„hashå€¼ // 2. é€šè¿‡getNodeï¼ˆï¼‰è·å–æ‰€æŸ¥è¯¢çš„æ•°æ® // 3. è·å–åï¼Œåˆ¤æ–­æ•°æ®æ˜¯å¦ä¸ºç©º return (e = getNode(hash(key), key)) == null ? null : e.value;}/** * è·å–æ‰€è¦æŸ¥è¯¢çš„æ•°æ® */final Node&lt;K,V&gt; getNode(int hash, Object key) { Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; first, e; int n; K k; // 1. è®¡ç®—å­˜æ”¾åœ¨æ•°ç»„tableä¸­çš„ä½ç½® if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (first = tab[(n - 1) &amp; hash]) != null) { //æ ¹æ®å½“å‰ä¼ å…¥çš„hashå€¼ä»¥åŠå‚æ•°keyè·å–ä¸€ä¸ªç»“ç‚¹å³ä¸ºfirst,å¦‚æœåŒ¹é…çš„è¯è¿”å›å¯¹åº”çš„valueå€¼ // a. å…ˆåœ¨æ•°ç»„ä¸­æ‰¾ï¼Œè‹¥å­˜åœ¨ï¼Œåˆ™ç›´æ¥è¿”å› if (first.hash == hash &amp;&amp; // always check first node ((k = first.key) == key || (key != null &amp;&amp; key.equals(k)))) return first; // b. è‹¥æ•°ç»„ä¸­æ²¡æœ‰ï¼Œåˆ™åˆ°çº¢é»‘æ ‘ä¸­å¯»æ‰¾ if ((e = first.next) != null) { if (first instanceof TreeNode) return ((TreeNode&lt;K,V&gt;)first).getTreeNode(hash, key); // c. è‹¥çº¢é»‘æ ‘ä¸­ä¹Ÿæ²¡æœ‰ï¼Œåˆ™é€šè¿‡éå†ï¼Œåˆ°é“¾è¡¨ä¸­å¯»æ‰¾ do { if (e.hash == hash &amp;&amp; ((k = e.key) == key || (key != null &amp;&amp; key.equals(k)))) return e; } while ((e = e.next) != null); } } return null;} æµç¨‹å¦‚ä¸‹ï¼š HashMap Jdk1.7å’ŒJdk1.8çš„åŒºåˆ« æ•°æ®ç»“æ„ æ·»åŠ æ•°æ® è·å–æ•°æ® æ‰©å®¹æœºåˆ¶ ConcurrentHashMap-Jdk1.7 æ•°æ®ç»“æ„ ConcurrentHashMapé‡‡ç”¨åˆ†æ®µé”çš„è®¾è®¡Segment&nbsp;+&nbsp;HashEntryçš„æ–¹å¼è¿›è¡Œå®ç°ï¼Œé‡‡ç”¨tableæ•°ç»„ï¼‹å•å‘é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œç»“æ„å¦‚ä¸‹ï¼š é‡è¦å±æ€§ 1234567891011121314151617181920212223242526272829//é»˜è®¤ConcurrentHashMapçš„å¤§å°static final int DEFAULT_INITIAL_CAPACITY = 16;//é»˜è®¤åŠ è½½å› å­ï¼Œç”¨äºè¡¨ç¤ºsegmentä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°ä¸HashEntry[]æ•°ç»„é•¿åº¦çš„æ¯”å€¼ã€‚å½“æŸä¸ªsegmentä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°è¶…è¿‡äº†HashEntry[]æ•°ç»„çš„é•¿åº¦ä¸è£…è½½å› å­çš„ä¹˜ç§¯æ—¶ï¼Œå°†è§¦å‘æ‰©å®¹æ“ä½œã€‚static final float DEFAULT_LOAD_FACTOR = 0.75f;//é»˜è®¤æ”¯æŒçš„æœ€å¤§å¹¶å‘æ•°ï¼Œè¯¥å€¼è¡¨ç¤ºsegment[]æ•°ç»„çš„é•¿åº¦ï¼Œä¹Ÿå°±æ˜¯é”çš„æ€»æ•°ã€‚static final int DEFAULT_CONCURRENCY_LEVEL = 16;//ConcurrentHashMapçš„æœ€å¤§å®¹é‡static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;//segmentåˆ†æ®µé”çš„åˆå§‹å®¹é‡ä¹Ÿæ˜¯æœ€å°å®¹é‡(å³segmentä¸­HashEntryçš„åˆå§‹å®¹é‡)static final int MIN_SEGMENT_TABLE_CAPACITY = 2;//æœ€å¤§segmentæ•°(segmentsæ•°ç»„çš„æœ€å¤§é•¿åº¦)static final int MAX_SEGMENTS = 1 &lt;&lt; 16; // slightly conservative//é‡è¯•åŠ é”æ¬¡æ•°ï¼šåœ¨æ‰§è¡Œsize()å’ŒcontainsValue(value)æ“ä½œæ—¶,ConcurrentHashMapçš„åšæ³•æ˜¯å…ˆå°è¯• RETRIES_BEFORE_LOCK æ¬¡( å³ï¼Œ2æ¬¡ )é€šè¿‡ä¸é”ä½segmentçš„æ–¹å¼æ¥ç»Ÿè®¡ã€æŸ¥è¯¢å„ä¸ªsegmentï¼Œå¦‚æœ2æ¬¡æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå®¹å™¨çš„modCountå‘ç”Ÿäº†å˜åŒ–ï¼Œåˆ™å†é‡‡ç”¨åŠ é”çš„æ–¹å¼æ¥æ“ä½œæ‰€æœ‰çš„segmentstatic final int RETRIES_BEFORE_LOCK = 2;//åˆ†æ®µé”çš„æ©ç ï¼Œç”¨æ¥è®¡ç®—keyæ‰€åœ¨çš„segmentåœ¨segmentsçš„æ•°ç»„ä¸‹æ ‡final int segmentMask;//åˆ†æ®µé”åç§»é‡,ç”¨æ¥æŸ¥æ‰¾segmentåœ¨å†…å­˜ä¸­çš„ä½ç½®final int segmentShift;//segmentæ•°ç»„ï¼ŒSegment ç±»ç»§æ‰¿äº ReentrantLock ç±»ï¼Œä»è€Œä½¿å¾— Segment å¯¹è±¡èƒ½å……å½“é”çš„è§’è‰²ã€‚final Segment&lt;K,V&gt;[] segments; é‡è¦å¯¹è±¡ Segment Segment ç±»ç»§æ‰¿äº ReentrantLock ç±»ï¼Œä»è€Œä½¿å¾— Segment å¯¹è±¡èƒ½å……å½“é”çš„è§’è‰²ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªå¯é‡å…¥é”ã€‚æ¯ä¸ª Segment å¯¹è±¡ç»´æŠ¤å…¶åŒ…å«çš„è‹¥å¹²ä¸ªæ¡¶(å³ï¼ŒHashEntry[])ã€‚ 1234567891011121314151617181920212223242526272829static final class Segment&lt;K,V&gt; extends ReentrantLock implements Serializable { private static final long serialVersionUID = 2249069246763182397L; //æœ€å¤§è‡ªæ—‹æ¬¡æ•°ï¼Œè‹¥æ˜¯å•æ ¸åˆ™ä¸º1ï¼Œå¤šæ ¸åˆ™ä¸º64ã€‚è¯¥å­—æ®µç”¨äºscanAndLockForPutã€scanAndLockæ–¹æ³• static final int MAX_SCAN_RETRIES = Runtime.getRuntime().availableProcessors() &gt; 1 ? 64 : 1; /** * table æ˜¯ç”± HashEntry å¯¹è±¡ç»„æˆçš„æ•°ç»„ * å¦‚æœæ•£åˆ—æ—¶å‘ç”Ÿç¢°æ’ï¼Œç¢°æ’çš„ HashEntry å¯¹è±¡å°±ä»¥é“¾è¡¨çš„å½¢å¼é“¾æ¥æˆä¸€ä¸ªé“¾è¡¨ * table æ•°ç»„çš„å…ƒç´ ä»£è¡¨æ•£åˆ—æ˜ å°„è¡¨çš„ä¸€ä¸ªæ¡¶ * æ¯ä¸ª table å®ˆæŠ¤æ•´ä¸ª ConcurrentHashMap æ•°æ®æ€»æ•°çš„ä¸€éƒ¨åˆ† * å¦‚æœå¹¶å‘çº§åˆ«ä¸º 16ï¼Œtable åˆ™ç»´æŠ¤ ConcurrentHashMap æ•°æ®æ€»æ•°çš„ 1/16 */ transient volatile HashEntry&lt;K,V&gt;[] table; //segmentä¸­HashEntryçš„æ€»æ•° transient int count; //segmentä¸­æ•°æ®è¢«æ›´æ–°çš„æ¬¡æ•° transient int modCount; //å…ƒç´ çš„é˜€å€¼ï¼Œå½“tableä¸­åŒ…å«çš„HashEntryå…ƒç´ çš„ä¸ªæ•°è¶…è¿‡æœ¬å˜é‡å€¼æ—¶ï¼Œè§¦å‘tableçš„æ‰©å®¹ transient int threshold; //åŠ è½½å› å­ final float loadFactor; } HashEntry HashEntryå°è£…äº†key-valueå¯¹ï¼Œæ˜¯ä¸€ä¸ªå•å‘é“¾è¡¨ç»“æ„ï¼Œæ¯ä¸ªHashEntryç»“ç‚¹éƒ½ç»´æŠ¤ç€next HashEntryç»“ç‚¹çš„å¼•ç”¨ã€‚ 12345678910111213static final class HashEntry&lt;K,V&gt; { final int hash; final K key; volatile V value; volatile HashEntry&lt;K,V&gt; next; HashEntry(int hash, K key, V value, HashEntry&lt;K,V&gt; next) { this.hash = hash; this.key = key; this.value = value; this.next = next; }} åˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334353637383940414243public ConcurrentHashMap(int initialCapacity, float loadFactor, int concurrencyLevel) { if (!(loadFactor &gt; 0) || initialCapacity &lt; 0 || concurrencyLevel &lt;= 0) throw new IllegalArgumentException(); //ä¿è¯æœ€å¤§å¹¶å‘ä¸è¶…è¿‡MAX_SEGMENTS(1 &lt;&lt; 16) if (concurrencyLevel &gt; MAX_SEGMENTS) concurrencyLevel = MAX_SEGMENTS; // Find power-of-two sizes best matching arguments int sshift = 0; int ssize = 1; //å¾ªç¯åˆ¤æ–­ä¿è¯ssizeæ˜¯2çš„å¹‚(å³Segmentæ•°ç»„çš„é•¿åº¦) //å¾ªç¯å®Œsshift = 4,ssize = 16 while (ssize &lt; concurrencyLevel) { ++sshift; ssize &lt;&lt;= 1;//ssize = size &lt;&lt; 1 } //segmentShiftæœ€åä¸º16 this.segmentShift = 32 - sshift; //segmentMaskæœ€åä¸º15 this.segmentMask = ssize - 1; //ConcurrentHashMapåˆå§‹å®¹é‡ä¸è¶…è¿‡MAXIMUM_CAPACITY(1 &lt;&lt; 30) if (initialCapacity &gt; MAXIMUM_CAPACITY) initialCapacity = MAXIMUM_CAPACITY; //æ ¹æ®ConcurrentHashMapæ€»å®¹é‡initialCapacityé™¤ä»¥Segments[]æ•°ç»„çš„é•¿åº¦å¾—åˆ°å•ä¸ªåˆ†æ®µé”segmentä¸­HashEntry[]çš„å¤§å° int c = initialCapacity / ssize; //ä¿è¯åˆ†æ®µé”segmentçš„æ€»å®¹é‡cä¸å°äºåˆå§‹çš„å®¹é‡ if (c * ssize &lt; initialCapacity) ++c; //capä¸ºSegments[]æ•°ç»„ä¸­åˆ†æ®µé”segmentçš„HashEntry[]çš„å¤§å°,ä¿è¯ä¸º2çš„å¹‚ int cap = MIN_SEGMENT_TABLE_CAPACITY; while (cap &lt; c) cap &lt;&lt;= 1; // create segments and segments[0] //è®°ä½è¿™é‡Œâ˜… //åˆ›å»ºä¸€ä¸ªs0,ç„¶ååˆå§‹åŒ–åˆ°Segments[0]ä¸­ Segment&lt;K,V&gt; s0 = new Segment&lt;K,V&gt;(loadFactor, (int)(cap * loadFactor), (HashEntry&lt;K,V&gt;[])new HashEntry[cap]); //åˆ›å»ºSegments[]æ•°ç»„ Segment&lt;K,V&gt;[] ss = (Segment&lt;K,V&gt;[])new Segment[ssize]; UNSAFE.putOrderedObject(ss, SBASE, s0); // ordered write of segments[0] this.segments = ss;} æ ¹æ®ç”¨æˆ·åˆ›å»ºnew ConcurrentHashMap(....)æ—¶ï¼Œä¼ é€’çš„å€¼æˆ–è€…é»˜è®¤å€¼è¿›è¡ŒConcurrentHashMapçš„åˆå§‹åŒ–ã€‚ åˆ›å»ºä¸€ä¸ªSegments[]æ•°ç»„ï¼Œæœ€å¤§æ•°ç»„é•¿åº¦æ˜¯16ï¼Œä¸å¯ä»¥æ‰©å®¹ã€‚ Sement[i]çš„é»˜è®¤å¤§å°ä¸º2ï¼Œè´Ÿè½½å› å­ä¸º0.75ï¼Œå¾—å‡ºåˆå§‹é˜ˆå€¼ä¸º1.5ï¼Œä¹Ÿå°±æ’å…¥ç¬¬ä¸€ä¸ªå…ƒç´ ä¸ä¼šè§¦å‘æ‰©å®¹ï¼Œæ’å…¥ç¬¬äºŒä¸ªè¿›è¡Œä¸€æ¬¡æ‰©å®¹ã€‚ åˆå§‹åŒ–äº† Segment[0]ï¼Œå…¶ä»–ä½ç½®è¿˜æ˜¯nullã€‚ putæ“ä½œ 1234567891011121314151617public V put(K key, V value) { Segment&lt;K,V&gt; s; //åˆ¤æ–­valueæ˜¯å¦ä¸ºnull,å¦‚æœä¸ºnullåˆ™æŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ if (value == null) throw new NullPointerException(); //è®¡ç®—keyçš„HASHå€¼ int hash = hash(key); //æ— ç¬¦å·å³ç§»segmentShiftä½(é»˜è®¤16),ç„¶å &amp; segmentMask(é»˜è®¤15)å¾—åˆ°segmentåœ¨å†…å­˜ä¸­çš„åœ°å€ int j = (hash &gt;&gt;&gt; segmentShift) &amp; segmentMask; //åˆ¤æ–­è¯¥ä½ç½®æ˜¯å¦ä¸ºnullï¼Œ if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObject (segments, (j &lt;&lt; SSHIFT) + SBASE)) == null) //å¦‚æœè·å–åˆ°çš„segmentä¸ºnull s = ensureSegment(j);//åˆå§‹åŒ–segment //å¦‚æœä¸ºnullï¼Œåˆå§‹åŒ–è¯¥ä½ç½®segment[j]ï¼Œé€šè¿‡ensureSegment(j) s = ensureSegment(j); //è°ƒç”¨Segmentçš„putæ–¹æ³•å°†æ•°æ®æ’å…¥åˆ°HashEntryä¸­ return s.put(key, hash, value, false);} æ ¹æ®hashå€¼è·å–åˆ†æ®µé”segmentçš„å†…å­˜åœ°å€ï¼Œå¦‚æœè·å–åˆ°çš„segmentä¸ºnullï¼Œåˆ™åˆå§‹åŒ–ã€‚å¦åˆ™å°±æ˜¯æ”¾å€¼ã€‚æ•´ä½“æµç¨‹å¦‚ä¸‹å›¾ï¼š ensureSegment-åˆå§‹åŒ–segment 1234567891011121314151617181920212223242526272829303132private Segment&lt;K,V&gt; ensureSegment(int k) { //æ‹¿åˆ°å½“å‰Segments[]æ•°ç»„ final Segment&lt;K,V&gt;[] ss = this.segments; //è·å–kæ‰€åœ¨çš„segmentåœ¨å†…å­˜ä¸­çš„åç§»é‡ long u = (k &lt;&lt; SSHIFT) + SBASE; // raw offset Segment&lt;K,V&gt; seg; //è·å–kæ‰€åœ¨çš„segmen,åˆ¤æ–­segmenæ˜¯å¦ä¸ºnull if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { //åˆå§‹åŒ–ä¸€ä¸ªsegmentç­‰äºSegments[0] //Segments[0]åœ¨åˆå§‹åŒ–ConcurrentHashMapæ—¶ï¼Œå·²ç»åˆå§‹åŒ–äº†ä¸€ä¸ªsegmentæ”¾åˆ°Segments[0]ã€‚ Segment&lt;K,V&gt; proto = ss[0]; // use segment 0 as prototype //ç„¶åå°±æ˜¯è·å–Segments[0]ä¸­HashEntryæ•°ç»„çš„æ•°æ® int cap = proto.table.length; float lf = proto.loadFactor; int threshold = (int)(cap * lf); //åˆå§‹åŒ–ä¸€ä¸ªHashEntryæ•°ç»„,å¤§å°å’ŒSegments[0]ä¸­çš„HashEntryä¸€æ ·ã€‚ HashEntry&lt;K,V&gt;[] tab = (HashEntry&lt;K,V&gt;[])new HashEntry[cap]; //å†æ¬¡è·å–kæ‰€åœ¨çš„segment(é˜²æ­¢å…¶ä»–çº¿ç¨‹å·²ç»åˆå§‹åŒ–å¥½) if ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { // recheck //å¦‚æœè¿˜æ˜¯nullï¼Œåˆ›å»ºä¸€ä¸ªsegmentå¹¶é€šè¿‡casè®¾ç½®åˆ°å¯¹åº”çš„ä½ç½® Segment&lt;K,V&gt; s = new Segment&lt;K,V&gt;(lf, threshold, tab); // ä½¿ç”¨ while å¾ªç¯ï¼Œå†…éƒ¨ç”¨ CASï¼Œå½“å‰çº¿ç¨‹æˆåŠŸè®¾å€¼æˆ–å…¶ä»–çº¿ç¨‹æˆåŠŸè®¾å€¼åï¼Œé€€å‡º while ((seg = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(ss, u)) == null) { if (UNSAFE.compareAndSwapObject(ss, u, null, seg = s)) break; } } } return seg;} æ ¹æ®kçš„hashå€¼ï¼Œè·å–segmentï¼Œå¦‚ä½•è·å–ä¸åˆ°åˆ™å°±åˆå§‹åŒ–ä¸€ä¸ªå’ŒSegment[0]ä¸€æ ·å¤§å°çš„segmentã€‚å¹¶é€šè¿‡CASæ“ä½œï¼Œåˆå§‹åŒ–åˆ°Segments[]ä¸­ã€‚ put-æ”¾å€¼ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253final V put(K key, int hash, V value, boolean onlyIfAbsent) { //å°è¯•è·å–segmentçš„é” //å¤±è´¥å°±é€šè¿‡è‡ªæ—‹å»è·å–é”,è¶…è¿‡è‡ªæ—‹æœ€å¤§æ¬¡æ•°æ—¶,å°±å°†æ“ä½œæ”¾å…¥åˆ°Locké”çš„é˜Ÿåˆ—ä¸­ HashEntry&lt;K,V&gt; node = tryLock() ? null : scanAndLockForPut(key, hash, value); V oldValue; //èµ°åˆ°è¿™é‡Œçš„çº¿ç¨‹ä¸€å®šè·å–åˆ°é”,æ²¡è·å–åˆ°çš„éƒ½æ”¾åˆ°äº†Lockçš„é˜Ÿåˆ—ä¸­ try { //æ‹¿åˆ°segmentä¸­çš„HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] tab = table; //å¾—åˆ°keyæ‰€åœ¨HashEntryæ•°ç»„çš„ä¸‹æ ‡ int index = (tab.length - 1) &amp; hash; //è·å–keyæ‰€åœ¨çš„HashEntryæ•°ç»„æŸä¸ªä½ç½®çš„å¤´ç»“ç‚¹(HashEntryæ˜¯ä¸€ä¸ªæ•°ç»„åŠ é“¾è¡¨ç»“æ„) HashEntry&lt;K,V&gt; first = entryAt(tab, index); for (HashEntry&lt;K,V&gt; e = first;;) { if (e != null) {//HashEntryå¤´ç»“ç‚¹ä¸ä¸ºnull K k; //æ‰¾åˆ°ä¼ å…¥çš„å€¼ if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) { oldValue = e.value; //æ˜¯å¦æ›¿æ¢value,é»˜è®¤æ›¿æ¢(æœ‰ä¸ªputIfAbsent(key,value)å°±æ˜¯ä¸æ›¿æ¢) if (!onlyIfAbsent) { e.value = value; ++modCount; } break; } e = e.next; } else {//å¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–HashEntryå¤´ç»“ç‚¹ä¸ºnull //åˆ¤æ–­nodeæ˜¯å¦å·²ç»åˆå§‹åŒ–(è‡ªæ—‹è·å–é”åšçš„è¿™äº›æ“ä½œ,è¿™ä¸ªnodeè¦ä¹ˆä¸ºnullè¦ä¹ˆå°±æ˜¯æ–°å»ºçš„HashEntry) if (node != null) node.setNext(first);//å¤´æ’æ³• else node = new HashEntry&lt;K,V&gt;(hash, key, value, first);//å¤´æ’æ³• int c = count + 1;//ä¿®æ”¹segmentçš„å…ƒç´ æ€»æ•° if (c &gt; threshold &amp;&amp; tab.length &lt; MAXIMUM_CAPACITY)//å¦‚æœè¶…è¿‡segmentçš„é˜€å€¼å¹¶ä¸”segmentæ²¡æœ‰è¶…è¿‡æœ€å¤§å®¹é‡,rehash //æ‰©å®¹ rehash(node); else //æ›´æ–°HashEntryæ•°ç»„ï¼ŒæŠŠæ–°çš„ç»“ç‚¹æ”¾åœ¨tabçš„indexä¸Šé¢ setEntryAt(tab, index, node); ++modCount; count = c; oldValue = null; break; } } } finally { unlock();//é‡Šæ”¾é” } return oldValue;} é¦–å…ˆæ˜¯å°è¯•è·å–segmentçš„é”ï¼Œè·å–åˆ°å‘ä¸‹æ‰§è¡Œï¼Œè·å–ä¸åˆ°å°±é€šè¿‡è‡ªæ—‹æ“ä½œå»è·å–é”ã€‚æ‹¿åˆ°é”ä¹‹åï¼Œæ‰¾åˆ°kæ‰€åœ¨çš„HashEntryæ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åè·å–å¤´ç»“ç‚¹ã€‚å‘ä¸‹éå†å¤´ç»“ç‚¹ï¼ŒæŸ¥æ‰¾åˆ°å°±æ›´æ–°ï¼ˆé»˜è®¤ï¼‰ï¼Œæ²¡æŸ¥æ‰¾åˆ°å°±æ–°å»ºä¸€ä¸ªHashEntryï¼Œé€šè¿‡å¤´æ’æ³•æ”¾å…¥HashEntryæ•°ç»„ï¼Œæœ€åæ›´æ–°HashEntryã€‚ scanAndLockForPut-è·å–é” 1234567891011121314151617181920212223242526272829private HashEntry&lt;K,V&gt; scanAndLockForPut(K key, int hash, V value) { //è·å–kæ‰€åœ¨çš„segmentä¸­çš„HashEntryçš„å¤´ç»“ç‚¹(segmentä¸­æ”¾å¾—æ˜¯HashEntryæ•°ç»„,HashEntryåˆæ˜¯ä¸ªé“¾è¡¨ç»“æ„) HashEntry&lt;K,V&gt; first = entryForHash(this, hash); HashEntry&lt;K,V&gt; e = first; HashEntry&lt;K,V&gt; node = null; int retries = -1; // negative while locating node while (!tryLock()) {//å°è¯•è·å–kæ‰€åœ¨segmentçš„é”ã€‚æˆåŠŸå°±ç›´æ¥è¿”å›ã€å¤±è´¥è¿›å…¥whileå¾ªç¯è¿›è¡Œè‡ªæ—‹å°è¯•è·å–é” HashEntry&lt;K,V&gt; f; // to recheck first below if (retries &lt; 0) { if (e == null) {//æ‰€åœ¨HashEntryé“¾è¡¨ä¸å­˜åœ¨ï¼Œåˆ™æ ¹æ®ä¼ è¿‡æ¥çš„key-valueåˆ›å»ºä¸€ä¸ªHashEntry if (node == null) // speculatively create node //åˆå§‹åŒ–node node = new HashEntry&lt;K,V&gt;(hash, key, value, null); retries = 0; } else if (key.equals(e.key))//æ‰¾åˆ°è¦æ”¾å¾—å€¼,åˆ™è®¾ç½®segmenté‡è¯•æ¬¡æ•°ä¸º0 retries = 0; else //ä»å¤´ç»“ç‚¹å¾€ä¸‹å¯»æ‰¾keyå¯¹åº”çš„HashEntry e = e.next; } else if (++retries &gt; MAX_SCAN_RETRIES) {//è¶…è¿‡æœ€å¤§é‡è¯•æ¬¡æ•°å°±å°†å½“å‰æ“ä½œæ”¾å…¥åˆ°Lockçš„é˜Ÿåˆ—ä¸­ï¼Œæ”¹ä¸ºé˜»å¡é”è·å–ï¼Œä¿è¯èƒ½è·å–æˆåŠŸ lock(); break; } else if ((retries &amp; 1) == 0 &amp;&amp; (f = entryForHash(this, hash)) != first) {//å¦‚æœretriesä¸ºå¶æ•°,å°±é‡æ–°è·å–HashEntryé“¾è¡¨çš„å¤´ç»“ç‚¹ e = first = f; // re-traverse if entry changed retries = -1; } } return node;} æ‹¿åˆ°kæ‰€åœ¨çš„segmentçš„HashEntryçš„å¤´ç»“ç‚¹(æƒ³æƒ³segmentä¸­çš„æ•°æ®ç»“æ„)ï¼Œé¦–å…ˆå°è¯•è·å–segmentçš„é”ã€‚ è·å–å¤±è´¥ å¦‚æœå¤´ç»“ç‚¹æ˜¯ä¸ºnullï¼Œåˆ™å°†ä¼ è¿›æ¥çš„key-valueæ–°å»ºä¸€ä¸ªHashEntry,åŒæ—¶è®¾ç½®retriesä¸º0,ä»è€Œå†æ¬¡å»å°è¯•è·å–segmentçš„é”ï¼› å¦‚æœå¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´ç»“ç‚¹çš„key == ä¼ è¿›æ¥çš„key,è®¾ç½®retriesä¸º0,ä»è€Œå†æ¬¡å»å°è¯•è·å–segmentçš„é”ï¼› å¦‚æœå¤´ç»“ç‚¹ä¸ä¸ºnullï¼Œå¹¶ä¸”å¤´ç»“ç‚¹çš„key != ä¼ è¿›æ¥çš„key åˆ™è·å–å¤´ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹,å†æ¬¡å°è¯•è·å–segmentçš„é”ï¼› å¦‚æœretries &gt; MAX_SCAN_RETRIES åˆ™è°ƒç”¨reentrantlockçš„lockæ–¹æ³•,å°†å½“å‰æ“ä½œæ”¾å…¥åˆ°locké˜Ÿåˆ—ä¸­.è·³å‡ºwhileå¾ªç¯ï¼› å¦‚æœretriesä¸ºå¶æ•°,åˆ™å†æ¬¡è·å–å¯¹åº”segmentçš„å¤´ç»“ç‚¹ï¼Œåˆ¤æ–­æ˜¯å¦æœ‰å˜åŒ–ï¼Œæœ‰å°±é‡æ–°è·å–å¤´ç»“ç‚¹ï¼› è·å–æˆåŠŸï¼šç›´æ¥è¿”å›null rehash-æ‰©å®¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778private void rehash(HashEntry&lt;K,V&gt; node) {//nodeä¸ºå¾…æ–°åŠ å…¥çš„ç»“ç‚¹ //è·å–å½“å‰segmentçš„HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] oldTable = table; //è·å–åŸHashEntryæ•°ç»„çš„é•¿åº¦ int oldCapacity = oldTable.length; //æ–°HashEntryæ•°ç»„çš„é•¿åº¦ = åŸHashEntryæ•°ç»„é•¿åº¦*2 int newCapacity = oldCapacity &lt;&lt; 1; //é‡æ–°è®¡ç®—æ–°HashEntryæ•°ç»„çš„é˜€å€¼ threshold = (int)(newCapacity * loadFactor); //åˆ›å»ºæ–°HashEntryæ•°ç»„ HashEntry&lt;K,V&gt;[] newTable = (HashEntry&lt;K,V&gt;[]) new HashEntry[newCapacity]; //æ–°HashEntryæ•°ç»„çš„æ©ç (ç”¨æ¥è®¡ç®—å…ƒç´ åœ¨æ–°æ•°ç»„ä¸­çš„ä¸‹æ ‡ä½ç½®) int sizeMask = newCapacity - 1; //éå†åŸHashEntryæ•°ç»„ä¸­çš„å…ƒç´ (segmentä¸­æ˜¯ä¸€ä¸ªHashEntryæ•°ç»„ï¼Œç»“æ„æ˜¯æ•°ç»„åŠ é“¾è¡¨) for (int i = 0; i &lt; oldCapacity ; i++) { //è·å–åŸHashEntry[i]ä½ç½®çš„å¤´ç»“ç‚¹HashEntry HashEntry&lt;K,V&gt; e = oldTable[i]; //åˆ¤æ–­å½“å‰ç»“ç‚¹æ˜¯å¦ä¸ºç©º if (e != null) { //è·å–å½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ HashEntry&lt;K,V&gt; next = e.next; //é‡æ–°è®¡ç®—å½“å‰ç»“ç‚¹åœ¨æ–°HashEntryæ•°ç»„ä¸­çš„ä¸‹æ ‡ int idx = e.hash &amp; sizeMask; //å¦‚æœä¸‹ä¸€ä¸ªç»“ç‚¹ä¸ºç©ºï¼Œåˆ™åŸHashEntryæ•°ç»„è¿™ä¸ªä½ç½®å°±ä¸€ä¸ªå…ƒç´ ï¼Œç›´æ¥æ”¾åˆ°æ–°HashEntryæ•°ç»„å°±è¡Œ if (next == null) // Single node on list newTable[idx] = e; //ä¸‹ä¸ªç»“ç‚¹ä¸ä¸ºç©º else { // Reuse consecutive sequence at same slot //è¿™é‡Œå°±æ˜¯æ‰¾åˆ°æŸä¸ªç»“ç‚¹ï¼Œä»è¿™ä¸ªç»“ç‚¹å¾€ä¸‹ï¼Œéƒ½ä¼šåœ¨æ–°æ•°ç»„çš„æŸä¸ªåæ ‡ä¸‹ï¼Œå½¢æˆæ–°çš„é“¾è¡¨ //åŸ: //HashEntry:[0] [1]... //é‡Œé¢çš„å€¼: 1 // 2 // 3 // 4 // 5 // 6 //æ–°: //HashEntry:[0] [1]... //é‡Œé¢çš„å€¼: 4 // 5 // 6 //è¿™é‡Œæœ€ålastRunå°±æ˜¯4 ,idxå°±æ˜¯æ–°æ•°ç»„çš„ä¸‹æ ‡0 HashEntry&lt;K,V&gt; lastRun = e; int lastIdx = idx; //æ‰¾åˆ°ç¬¬ä¸€ä¸ªåç»­ç»“ç‚¹æ–°çš„indexä¸å˜çš„ç»“ç‚¹ for (HashEntry&lt;K,V&gt; last = next; last != null; last = last.next) { int k = last.hash &amp; sizeMask; if (k != lastIdx) { lastIdx = k; lastRun = last; } } //ç„¶åæŠŠ4ç»“ç‚¹æ”¾åˆ°æ–°æ•°ç»„ä¸­ï¼Œè¿™æ ·4,5,6å°±éƒ½è¿‡å»äº† newTable[lastIdx] = lastRun; // Clone remaining nodes //å‰©ä¸‹çš„å°±æ˜¯è§£å†³1,2,3äº†,éå†åŸHashEntryæ•°ç»„,ç›´åˆ°ç­‰äº4ä¸ºæ­¢ //è¿™äº›ç»“ç‚¹é‡‡ç”¨å¤´æ’æ³•æ”¾åˆ°æ–°HashEntryæ•°ç»„ä¸­ for (HashEntry&lt;K,V&gt; p = e; p != lastRun; p = p.next) { V v = p.value; int h = p.hash; int k = h &amp; sizeMask; HashEntry&lt;K,V&gt; n = newTable[k];//å¤´æ’æ³• newTable[k] = new HashEntry&lt;K,V&gt;(h, p.key, v, n); } } } } //å°†å¾…æ–°åŠ å…¥çš„å…ƒç´ æ”¾åˆ°æ–°æ•°ç»„(å¤´æ’æ³•) int nodeIndex = node.hash &amp; sizeMask; // add the new node node.setNext(newTable[nodeIndex]); newTable[nodeIndex] = node; //segmentçš„æ•°ç»„æŒ‡åˆ°æ–°æ•°ç»„ table = newTable;} åŸHashEntryæ•°ç»„æ‰©å¤§ä¸€å€ï¼Œç„¶åéå†åŸHashEntryæ•°ç»„ï¼Œæ‰¾åˆ°æŸä¸ªç»“ç‚¹lastRunï¼Œä»è¿™ä¸ªç»“ç‚¹å¼€å§‹å¾€ä¸‹ï¼Œéƒ½ä¼šæ”¾åˆ°æ–°HashEntryæ•°ç»„çš„æŸä¸ªæ§½ä¸‹é¢ã€‚æ¥ä¸‹æ¥å°±æ˜¯éå†å‰©ä¸‹çš„æ•°æ®ï¼Œç„¶åé‡‡ç”¨å¤´æ’æ³•ï¼Œæ”¾åˆ°æ–°æ•°ç»„ä¸­ã€‚æœ€åå°±æ˜¯å°†å¾…æ–°åŠ äººçš„ç»“ç‚¹ï¼Œæ”¾åˆ°æ–°æ•°ç»„ä¸­ã€‚ getæ“ä½œ 123456789101112131415161718192021public V get(Object key) { Segment&lt;K,V&gt; s; // manually integrate access methods to reduce overhead HashEntry&lt;K,V&gt;[] tab; //keyçš„hashå€¼ int h = hash(key); //è®¡ç®—å‡ºkæ‰€åœ¨çš„segmentæ‰€åœ¨çš„å†…å­˜åœ°å€ long u = (((h &gt;&gt;&gt; segmentShift) &amp; segmentMask) &lt;&lt; SSHIFT) + SBASE; //é€šè¿‡CASæ“ä½œè·å–segment,åˆ¤æ–­éƒ½ä¸ä¸ºnull if ((s = (Segment&lt;K,V&gt;)UNSAFE.getObjectVolatile(segments, u)) != null &amp;&amp; (tab = s.table) != null) { //å†é€šè¿‡CASæ“ä½œï¼Œè·å–çš„keyæ‰€åœ¨çš„HashEntry[]æ•°ç»„çš„ä¸‹æ ‡ï¼Œè·å–åˆ°å°±è¿”å›ï¼Œæ²¡æœ‰å°±è¿”å›null for (HashEntry&lt;K,V&gt; e = (HashEntry&lt;K,V&gt;) UNSAFE.getObjectVolatile (tab, ((long)(((tab.length - 1) &amp; h)) &lt;&lt; TSHIFT) + TBASE); e != null; e = e.next) { K k; if ((k = e.key) == key || (e.hash == h &amp;&amp; key.equals(k))) return e.value; } } return null;} è®¡ç®— hash å€¼ï¼Œæ‰¾åˆ° segment æ•°ç»„ä¸­çš„å…·ä½“ä½ç½®,ä½¿ç”¨Unsafeè·å–å¯¹åº”çš„Segment,æ ¹æ® hash æ‰¾åˆ°æ•°ç»„ä¸­å…·ä½“çš„ä½ç½®,ä»é“¾è¡¨å¤´å¼€å§‹éå†æ•´ä¸ªé“¾è¡¨ï¼ˆå› ä¸ºHashå¯èƒ½ä¼šæœ‰ç¢°æ’ï¼Œæ‰€ä»¥ç”¨ä¸€ä¸ªé“¾è¡¨ä¿å­˜ï¼‰ï¼Œå¦‚æœæ‰¾åˆ°å¯¹åº”çš„keyï¼Œåˆ™è¿”å›å¯¹åº”çš„valueå€¼ï¼Œå¦åˆ™è¿”å›nullã€‚ &lt;font color="red"&gt;æ³¨ï¼šgetæ“ä½œä¸éœ€è¦é”ï¼Œç”±äºå…¶ä¸­æ¶‰åŠåˆ°çš„å…±äº«å˜é‡éƒ½ä½¿ç”¨volatileä¿®é¥°ï¼Œvolatileå¯ä»¥ä¿è¯å†…å­˜å¯è§æ€§ï¼Œæ‰€ä»¥ä¸ä¼šè¯»å–åˆ°è¿‡æœŸæ•°æ®ã€‚&lt;/font&gt; removeæ“ä½œ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950public V remove(Object key) { int hash = hash(key); //keyçš„hashå€¼ï¼Œè·å–segment Segment&lt;K,V&gt; s = segmentForHash(hash); return s == null ? null : s.remove(key, hash, null);}final V remove(Object key, int hash, Object value) { //å°è¯•è·å–segmenté” if (!tryLock()) //å¤±è´¥å°±è‡ªæ—‹ scanAndLock(key, hash); //æ‰§è¡Œåˆ°è¿™é‡Œä¸€å®šè·å–äº†segmenté” V oldValue = null; try { //è·å–segmentçš„HashEntry[]æ•°ç»„ //è·å–keyæ‰€åœ¨çš„ä¸‹æ ‡ï¼Œç„¶åè·å–å¤´ç»“ç‚¹ HashEntry&lt;K,V&gt;[] tab = table; int index = (tab.length - 1) &amp; hash; HashEntry&lt;K,V&gt; e = entryAt(tab, index); HashEntry&lt;K,V&gt; pred = null; while (e != null) { K k; HashEntry&lt;K,V&gt; next = e.next; //åˆ¤æ–­å½“å‰ç»“ç‚¹eæ˜¯ä¸æ˜¯è¦åˆ é™¤çš„æ•°æ® if ((k = e.key) == key || (e.hash == hash &amp;&amp; key.equals(k))) {//keyç›¸åŒ V v = e.value; //å¦‚æœæ²¡æœ‰ä¼ valueï¼Œæˆ–è€…valueç›¸åŒ if (value == null || value == v || value.equals(v)) { if (pred == null)//è¦åˆ é™¤ç»“ç‚¹çš„å‰ä¸€ä¸ªç»“ç‚¹ä¸ºnull setEntryAt(tab, index, next);//ç›´æ¥èµ‹å€¼ else pred.setNext(next);//ç›´æ¥å°†å½“å‰ç»“ç‚¹çš„å‰ä¸€ä¸ªç»“ç‚¹çš„nextè®¾ç½®æˆå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ ++modCount; --count; oldValue = v; } break; } //å‰ç»“ç‚¹ä¸æ˜¯è¦æ‰¾çš„ç»“ç‚¹,éå†ä¸‹ä¸€ä¸ª pred = e; e = next; } } finally { unlock(); } return oldValue;} æ‰¾åˆ°keyæ‰€åœ¨HashEntry[]æ•°ç»„çš„ä¸‹æ ‡ï¼Œç„¶åéå†é“¾è¡¨ï¼Œæ‰¾åˆ°ç»“ç‚¹ã€‚å°†å½“å‰ç»“ç‚¹çš„ä¸Šä¸€ä¸ªç»“ç‚¹çš„nextè®¾ç½®æˆå½“å‰ç»“ç‚¹çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ã€‚ sizeæ“ä½œ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546public int size() { final Segment&lt;K,V&gt;[] segments = this.segments; int size; boolean overflow; // // æ˜¯å¦æº¢å‡º long sum; // å­˜å‚¨æœ¬æ¬¡å¾ªç¯è¿‡ç¨‹ä¸­è®¡ç®—å¾—åˆ°çš„modCountçš„å€¼ long last = 0L; // å­˜å‚¨ä¸Šä¸€æ¬¡éå†è¿‡ç¨‹ä¸­è®¡ç®—å¾—åˆ°çš„modCountçš„å’Œ int retries = -1; // first iteration isn't retry try { for (;;) { //åˆ¤æ–­retriesæ˜¯å¦ç­‰äºRETRIES_BEFORE_LOCK(å€¼ä¸º2) //ä¹Ÿå°±æ˜¯é»˜è®¤æœ‰ä¸¤æ¬¡çš„æœºä¼šï¼Œæ˜¯ä¸åŠ é”æ¥æ±‚sizeçš„ if (retries++ == RETRIES_BEFORE_LOCK) { for (int j = 0; j &lt; segments.length; ++j) ensureSegment(j).lock(); // force creation } sum = 0L; size = 0; overflow = false; //éå†Segments[]æ•°ç»„è·å–é‡Œé¢çš„æ¯ä¸€ä¸ªsegmentï¼Œç„¶åå¯¹modCountè¿›è¡Œæ±‚å’Œ //è¿™ä¸ªforåµŒå¥—åœ¨for(;;)ä¸­ï¼Œé»˜è®¤ä¼šæ‰§è¡Œä¸¤æ¬¡ï¼Œå¦‚æœä¸¤æ¬¡å€¼ç›¸åŒï¼Œå°±è¿”å› //å¦‚æœä¸¤æ¬¡å€¼ä¸åŒï¼Œå°±è¿›å…¥åˆ°ä¸Šé¢çš„ifä¸­ï¼Œè¿›è¡ŒåŠ é”ã€‚ä¹‹ååœ¨è¿›è¡Œæ±‚å’Œ for (int j = 0; j &lt; segments.length; ++j) { Segment&lt;K,V&gt; seg = segmentAt(segments, j); if (seg != null) { sum += seg.modCount; int c = seg.count; if (c &lt; 0 || (size += c) &lt; 0) overflow = true; } } if (sum == last) break; last = sum; } } finally { //ç”±äºåªæœ‰åœ¨retriesç­‰äºRETRIES_BEFORE_LOCKæ—¶æ‰ä¼šæ‰§è¡Œå¼ºåˆ¶åŠ é”ï¼Œå¹¶ä¸”ç”±äºæ˜¯ç”¨çš„retries++ï¼Œ //æ‰€ä»¥å¼ºåˆ¶åŠ é”å®Œæ¯•åï¼Œretriesçš„å€¼æ˜¯ä¸€å®šä¼šå¤§äºRETRIES_BEFORE_LOCKçš„ï¼Œ //è¿™æ ·å°±é˜²æ­¢æ­£å¸¸éå†è€Œæ²¡è¿›è¡ŒåŠ é”æ—¶è¿›è¡Œé”é‡Šæ”¾çš„æƒ…å†µ if (retries &gt; RETRIES_BEFORE_LOCK) { for (int j = 0; j &lt; segments.length; ++j) segmentAt(segments, j).unlock(); } } return overflow ? Integer.MAX_VALUE : size;} å…ˆå°è¯•RETRIES_BEFORE_LOCKæ¬¡( å³2æ¬¡ )ä¸åŠ é”çš„æƒ…å†µä¸‹ï¼Œå°†segment[]æ•°ç»„ä¸­æ¯ä¸ªsegmentçš„countç´¯åŠ ï¼ŒåŒæ—¶ä¹Ÿä¼šå°†æ¯ä¸ªsegmentçš„modCountè¿›è¡Œç´¯åŠ ã€‚å¦‚æœä¸¤æ¬¡ä¸åŠ é”çš„æ“ä½œåï¼ŒmodCountSumå€¼æ˜¯ä¸€æ ·çš„ï¼Œè¿™è¯´æ˜åœ¨è¿™ä¸¤æ¬¡ç´¯åŠ segmentcountçš„è¿‡ç¨‹ä¸­ConcurrentHashMapæ²¡æœ‰å‘ç”Ÿç»“æ„æ€§å˜åŒ–ï¼Œé‚£ä¹ˆå°±ç›´æ¥è¿”å›ç´¯åŠ çš„countå€¼; å¦‚æœåœ¨ä¸¤æ¬¡ç´¯åŠ segmentçš„countæ“ä½œæœŸé—´ConcurrentHashMapå‘ç”Ÿäº†ç»“æ„æ€§æ”¹å˜ï¼Œåˆ™ä¼šé€šè¿‡å°†æ‰€æœ‰çš„segmentéƒ½åŠ é”ï¼Œç„¶åé‡æ–°è¿›è¡Œcountçš„ç´¯åŠ æ“ä½œã€‚åœ¨å®Œæˆcountçš„ç´¯åŠ æ“ä½œåï¼Œé‡Šæ”¾æ‰€æœ‰çš„é”ã€‚æœ€åè¿”å›ç´¯åŠ çš„countå€¼ã€‚ å¦‚æœç´¯åŠ çš„countå€¼å¤§äºäº†Integer.MAX_VALUEï¼Œåˆ™è¿”å›Integer.MAX_VALUEã€‚ ConcurrentHashMap-Jdk1.8 æ•°æ®ç»“æ„ Java7ä¸­ConcurrentHashMapæ˜¯é‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨çš„æ•°æ®ç»“æ„ã€‚è¦çŸ¥é“é“¾è¡¨çš„æŸ¥æ‰¾æ•ˆç‡æ˜¯ä½ä¸‹çš„ï¼Œå…¶å¹³å‡çš„æŸ¥æ‰¾æ—¶é—´æ˜¯O(logn)ï¼Œå…¶ä¸­næ˜¯é“¾è¡¨çš„é•¿åº¦ã€‚å½“é“¾è¡¨è¾ƒé•¿æ—¶ï¼ŒæŸ¥æ‰¾å¯èƒ½ä¼šæˆä¸ºå“ˆå¸Œè¡¨çš„æ€§èƒ½ç“¶é¢ˆã€‚ é’ˆå¯¹è¿™ä¸ªé—®é¢˜ï¼ŒJava8ä¸­å¯¹ConcurrentHashMapçš„æ•°æ®ç»“æ„è¿›è¡Œäº†ä¼˜åŒ–ï¼Œé‡‡ç”¨äº†æ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘çš„æ•°æ®ç»“æ„ã€‚å½“æ•°ç»„ä¸­æŸä¸ªé“¾è¡¨çš„é•¿åº¦è¶…è¿‡ä¸€å®šçš„é˜ˆå€¼ä¹‹åï¼Œä¼šå°†å…¶è½¬æ¢æˆçº¢é»‘æ ‘ï¼Œä»¥æé«˜æŸ¥æ‰¾æ•ˆç‡ã€‚å½“çº¢é»‘æ ‘ç»“ç‚¹æ•°å°‘äºä¸€å®šé˜ˆå€¼åï¼Œè¿˜èƒ½é™çº¢é»‘æ ‘é€†é€€åŒ–æˆé“¾è¡¨ã€‚ä¸‹å›¾æ˜¯Java8 ConcurrentHashMapçš„æ•°æ®ç»“æ„ç¤ºæ„å›¾ï¼š Java8ä¸­å–æ¶ˆäº†Java7ä¸­çš„åˆ†æ®µé”è®¾è®¡ï¼Œè€Œé‡‡ç”¨äº† CAS + synchronized æ¥ä¿è¯å¹¶å‘å®‰å…¨æ€§ã€‚ é‡è¦å±æ€§ 123456789101112131415161718192021222324252627282930313233343536373839// æœ€å¤§å®¹é‡private static final int MAXIMUM_CAPACITY = 1 &lt;&lt; 30;// åˆå§‹å®¹é‡private static final int DEFAULT_CAPACITY = 16;// æ•°æ®æœ€å¤§é•¿åº¦static final int MAX_ARRAY_SIZE = Integer.MAX_VALUE - 8;// é»˜è®¤å¹¶å‘åº¦private static final int DEFAULT_CONCURRENCY_LEVEL = 16;// é»˜è®¤åŠ è½½å› å­private static final float LOAD_FACTOR = 0.75f;// é“¾è¡¨è½¬çº¢é»‘æ ‘çš„é˜€å€¼ï¼Œå¤§äº8æ—¶static final int TREEIFY_THRESHOLD = 8;// çº¢é»‘æ ‘è½¬é“¾è¡¨çš„é˜€å€¼ï¼Œå°äºç­‰äº6ï¼ˆtranferæ—¶ï¼Œlcã€hc=0ä¸¤ä¸ªè®¡æ•°å™¨åˆ†åˆ«++è®°å½•åŸbinã€æ–°binTreeNodeæ•°é‡ï¼Œ&lt;=UNTREEIFY_THRESHOLD åˆ™untreeify(lo)ï¼‰ã€‚// ã€ä»…åœ¨æ‰©å®¹tranferæ—¶æ‰å¯èƒ½æ ‘è½¬é“¾è¡¨ã€‘static final int UNTREEIFY_THRESHOLD = 6;static final int MIN_TREEIFY_CAPACITY = 64;private static final int MIN_TRANSFER_STRIDE = 16;private static int RESIZE_STAMP_BITS = 16;// 2^15-1ï¼Œhelp resizeçš„æœ€å¤§çº¿ç¨‹æ•°private static final int MAX_RESIZERS = (1 &lt;&lt; (32 - RESIZE_STAMP_BITS)) - 1;// 32-16=16ï¼ŒsizeCtlä¸­è®°å½•sizeå¤§å°çš„åç§»é‡private static final int RESIZE_STAMP_SHIFT = 32 - RESIZE_STAMP_BITS;static final int MOVED = -1; // è¡¨ç¤ºæ­£åœ¨è½¬ç§»static final int TREEBIN = -2; // è¡¨ç¤ºå·²ç»è½¬æ¢æˆæ ‘static final int RESERVED = -3; // hash for transient reservationsstatic final int HASH_BITS = 0x7fffffff; // usable bits of normal node hashtransient volatile Node&lt;K,V&gt;[] table;//é»˜è®¤æ²¡åˆå§‹åŒ–çš„æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å…ƒç´ private transient volatile Node&lt;K,V&gt;[] nextTable;//è½¬ç§»çš„æ—¶å€™ç”¨çš„æ•°ç»„// å¯ç”¨å¤„ç†å™¨æ•°é‡static final int NCPU = Runtime.getRuntime().availableProcessors();/** * ç”¨æ¥æ§åˆ¶è¡¨åˆå§‹åŒ–å’Œæ‰©å®¹çš„ï¼Œé»˜è®¤å€¼ä¸º0ï¼Œå½“åœ¨åˆå§‹åŒ–çš„æ—¶å€™æŒ‡å®šäº†å¤§å°ï¼Œè¿™ä¼šå°†è¿™ä¸ªå¤§å°ä¿å­˜åœ¨sizeCtlä¸­ï¼Œå¤§å°ä¸ºæ•°ç»„çš„0.75 * æ­£æ•°æˆ–0ä»£è¡¨hashè¡¨è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œè¿™ä¸ªæ•°å€¼è¡¨ç¤ºåˆå§‹åŒ–æˆ–ä¸‹ä¸€æ¬¡è¿›è¡Œæ‰©å®¹çš„å¤§å° * å½“ä¸ºè´Ÿçš„æ—¶å€™ï¼Œè¯´æ˜è¡¨æ­£åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œ * -1è¡¨ç¤ºåˆå§‹åŒ– * -(1+n) n:è¡¨ç¤ºæ´»åŠ¨çš„æ‰©å®¹çº¿ç¨‹ */private transient volatile int sizeCtl; é‡è¦ç±» Node-æ„æˆå…ƒç´ çš„åŸºæœ¬ç±» æœ€æ ¸å¿ƒçš„å†…éƒ¨ç±»ï¼Œå®ƒåŒ…è£…äº†key-valueé”®å€¼å¯¹ï¼Œæ‰€æœ‰æ’å…¥ConcurrentHashMapçš„æ•°æ®éƒ½åŒ…è£…åœ¨è¿™é‡Œé¢ã€‚å®ƒä¸HashMapä¸­çš„å®šä¹‰å¾ˆç›¸ä¼¼ï¼Œä½†æ˜¯ä½†æ˜¯æœ‰ä¸€äº›å·®åˆ«å®ƒå¯¹valueå’Œnextå±æ€§è®¾ç½®äº†volatileåŒæ­¥é”(ä¸JDK7çš„Segmentç›¸åŒ)ï¼Œå®ƒä¸å…è®¸è°ƒç”¨setValueæ–¹æ³•ç›´æ¥æ”¹å˜Nodeçš„valueåŸŸï¼Œå®ƒå¢åŠ äº†findæ–¹æ³•è¾…åŠ©map.get()æ–¹æ³•ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546static class Node&lt;K,V&gt; implements Map.Entry&lt;K,V&gt; { final int hash; //keyçš„hashå€¼ final K key; //key volatile V val; //value volatile Node&lt;K,V&gt; next; //è¡¨ç¤ºé“¾è¡¨ä¸­çš„ä¸‹ä¸€ä¸ªç»“ç‚¹ Node(int hash, K key, V val, Node&lt;K,V&gt; next) { this.hash = hash; this.key = key; this.val = val; this.next = next; } public final K getKey() { return key; } public final V getValue() { return val; } public final int hashCode() { return key.hashCode() ^ val.hashCode(); } public final String toString(){ return key + "=" + val; } public final V setValue(V value) { throw new UnsupportedOperationException(); } public final boolean equals(Object o) { Object k, v, u; Map.Entry&lt;?,?&gt; e; return ((o instanceof Map.Entry) &amp;&amp; (k = (e = (Map.Entry&lt;?,?&gt;)o).getKey()) != null &amp;&amp; (v = e.getValue()) != null &amp;&amp; (k == key || k.equals(key)) &amp;&amp; (v == (u = val) || v.equals(u))); } /** * Virtualized support for map.get(); overridden in subclasses. */ Node&lt;K,V&gt; find(int h, Object k) { Node&lt;K,V&gt; e = this; if (k != null) { do { K ek; if (e.hash == h &amp;&amp; ((ek = e.key) == k || (ek != null &amp;&amp; k.equals(ek)))) return e; } while ((e = e.next) != null); } return null; }} TreeNode-æ ‘ç»“ç‚¹ç±» æ ‘èŠ‚ç‚¹ç±»ï¼Œå¦å¤–ä¸€ä¸ªæ ¸å¿ƒçš„æ•°æ®ç»“æ„ã€‚å½“é“¾è¡¨é•¿åº¦è¿‡é•¿çš„æ—¶å€™ï¼Œä¼šè½¬æ¢ä¸ºTreeNodeã€‚ä½†æ˜¯ä¸HashMapä¸ç›¸åŒçš„æ˜¯ï¼Œå®ƒå¹¶ä¸æ˜¯ç›´æ¥è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œè€Œæ˜¯æŠŠè¿™äº›ç»“ç‚¹åŒ…è£…æˆTreeNodeæ”¾åœ¨TreeBinå¯¹è±¡ä¸­ï¼Œç”±TreeBinå®Œæˆå¯¹çº¢é»‘æ ‘çš„åŒ…è£…ã€‚è€Œä¸”TreeNodeåœ¨ConcurrentHashMapé›†æˆè‡ªNodeç±»ï¼Œè€Œå¹¶éHashMapä¸­çš„é›†æˆè‡ªLinkedHashMap.Entry&lt;K,V&gt;ç±»ï¼Œä¹Ÿå°±æ˜¯è¯´TreeNodeå¸¦æœ‰nextæŒ‡é’ˆï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯æ–¹ä¾¿åŸºäºTreeBinçš„è®¿é—®ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950static final class TreeNode&lt;K,V&gt; extends Node&lt;K,V&gt; { TreeNode&lt;K,V&gt; parent; // red-black tree links TreeNode&lt;K,V&gt; left; TreeNode&lt;K,V&gt; right; TreeNode&lt;K,V&gt; prev; // needed to unlink next upon deletion boolean red; TreeNode(int hash, K key, V val, Node&lt;K,V&gt; next, TreeNode&lt;K,V&gt; parent) { super(hash, key, val, next); this.parent = parent; } Node&lt;K,V&gt; find(int h, Object k) { return findTreeNode(h, k, null); } /** * Returns the TreeNode (or null if not found) for the given key * starting at given root. */ final TreeNode&lt;K,V&gt; findTreeNode(int h, Object k, Class&lt;?&gt; kc) { if (k != null) { TreeNode&lt;K,V&gt; p = this; do { int ph, dir; K pk; TreeNode&lt;K,V&gt; q; TreeNode&lt;K,V&gt; pl = p.left, pr = p.right; if ((ph = p.hash) &gt; h) p = pl; else if (ph &lt; h) p = pr; else if ((pk = p.key) == k || (pk != null &amp;&amp; k.equals(pk))) return p; else if (pl == null) p = pr; else if (pr == null) p = pl; else if ((kc != null || (kc = comparableClassFor(k)) != null) &amp;&amp; (dir = compareComparables(kc, k, pk)) != 0) p = (dir &lt; 0) ? pl : pr; else if ((q = pr.findTreeNode(h, k, kc)) != null) return q; else p = pl; } while (p != null); } return null; }} TreeBin-æ ‘çš„å¤´ç»“ç‚¹ è¿™ä¸ªç±»å¹¶ä¸è´Ÿè´£åŒ…è£…ç”¨æˆ·çš„keyã€valueä¿¡æ¯ï¼Œè€Œæ˜¯åŒ…è£…çš„å¾ˆå¤šTreeNodeèŠ‚ç‚¹ã€‚å®ƒä»£æ›¿äº†TreeNodeçš„æ ¹èŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨å®é™…çš„ConcurrentHashMapâ€œæ•°ç»„â€ä¸­ï¼Œå­˜æ”¾çš„æ˜¯TreeBinå¯¹è±¡ï¼Œè€Œä¸æ˜¯TreeNodeå¯¹è±¡ï¼Œè¿™æ˜¯ä¸HashMapçš„åŒºåˆ«ã€‚å¦å¤–è¿™ä¸ªç±»è¿˜å¸¦æœ‰äº†è¯»å†™é”ã€‚åœ¨æ„é€ TreeBinèŠ‚ç‚¹æ—¶ï¼Œä»…ä»…æŒ‡å®šäº†å®ƒçš„hashå€¼ä¸ºTREEBINå¸¸é‡ï¼Œè¿™ä¹Ÿå°±æ˜¯ä¸ªæ ‡è¯†ã€‚ 12345678910static final class TreeBin&lt;K,V&gt; extends Node&lt;K,V&gt; { TreeNode&lt;K,V&gt; root; volatile TreeNode&lt;K,V&gt; first; volatile Thread waiter; volatile int lockState; // values for lockState static final int WRITER = 1; // set while holding write lock static final int WAITER = 2; // set when waiting for write lock static final int READER = 4; // increment value for setting read lock} ForwardingNode-è½¬ç§»çš„æ—¶å€™æ”¾åœ¨å¤´éƒ¨çš„ç»“ç‚¹ ä¸€ä¸ªç”¨äºè¿æ¥ä¸¤ä¸ªtableçš„èŠ‚ç‚¹ç±»ã€‚å®ƒåŒ…å«ä¸€ä¸ªnextTableæŒ‡é’ˆï¼Œç”¨äºæŒ‡å‘ä¸‹ä¸€å¼ è¡¨ã€‚è€Œä¸”è¿™ä¸ªèŠ‚ç‚¹çš„key value nextæŒ‡é’ˆå…¨éƒ¨ä¸ºnullï¼Œå®ƒçš„hashå€¼ä¸º-1. è¿™é‡Œé¢å®šä¹‰çš„findçš„æ–¹æ³•æ˜¯ä»nextTableé‡Œè¿›è¡ŒæŸ¥è¯¢èŠ‚ç‚¹ï¼Œè€Œä¸æ˜¯ä»¥è‡ªèº«ä¸ºå¤´èŠ‚ç‚¹è¿›è¡ŒæŸ¥æ‰¾ã€‚å…¶ä¸­å­˜å‚¨nextTableçš„å¼•ç”¨ã€‚åªæœ‰tableå‘ç”Ÿæ‰©å®¹çš„æ—¶å€™ï¼ŒForwardingNodeæ‰ä¼šå‘æŒ¥ä½œç”¨ï¼Œä½œä¸ºä¸€ä¸ªå ä½ç¬¦æ”¾åœ¨tableä¸­è¡¨ç¤ºå½“å‰èŠ‚ç‚¹ä¸ºnullæˆ–åˆ™å·²ç»è¢«ç§»åŠ¨ã€‚ 1234567static final class ForwardingNode&lt;K,V&gt; extends Node&lt;K,V&gt; { final Node&lt;K,V&gt;[] nextTable; ForwardingNode(Node&lt;K,V&gt;[] tab) { super(MOVED, null, null, null); this.nextTable = tab; }} 3ä¸ªåŸå­æ“ä½œ åœ¨ConcurrentHashMapä¸­ä½¿ç”¨äº†unSafeæ–¹æ³•ï¼Œé€šè¿‡ç›´æ¥æ“ä½œå†…å­˜çš„æ–¹å¼æ¥ä¿è¯å¹¶å‘å¤„ç†çš„å®‰å…¨æ€§ï¼Œä½¿ç”¨çš„æ˜¯ç¡¬ä»¶çš„å®‰å…¨æœºåˆ¶ã€‚ 123456789101112131415161718192021/* * ç”¨æ¥è¿”å›èŠ‚ç‚¹æ•°ç»„çš„æŒ‡å®šä½ç½®çš„èŠ‚ç‚¹çš„åŸå­æ“ä½œ */@SuppressWarnings("unchecked")static final &lt;K,V&gt; Node&lt;K,V&gt; tabAt(Node&lt;K,V&gt;[] tab, int i) { return (Node&lt;K,V&gt;)U.getObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE);}/* * åˆ©ç”¨CASç®—æ³•è®¾ç½®iä½ç½®ä¸Šçš„NodeèŠ‚ç‚¹ï¼ˆå°†cå’Œtable[i]æ¯”è¾ƒï¼Œç›¸åŒåˆ™æ’å…¥vï¼‰ã€‚ */static final &lt;K,V&gt; boolean casTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; c, Node&lt;K,V&gt; v) { return U.compareAndSwapObject(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, c, v);}/* * è®¾ç½®èŠ‚ç‚¹ä½ç½®çš„å€¼ï¼Œä»…åœ¨ä¸Šé”åŒºè¢«è°ƒç”¨ */static final &lt;K,V&gt; void setTabAt(Node&lt;K,V&gt;[] tab, int i, Node&lt;K,V&gt; v) { U.putObjectVolatile(tab, ((long)i &lt;&lt; ASHIFT) + ABASE, v);} æ„é€ å™¨ 1234567891011121314151617//ç©ºçš„æ„é€ public ConcurrentHashMapDebug() {}//å¦‚æœåœ¨å®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æŒ‡å®šäº†å®¹é‡ï¼Œåˆ™åˆå§‹åŒ–sizeCtlpublic ConcurrentHashMapDebug(int initialCapacity) { if (initialCapacity &lt; 0) throw new IllegalArgumentException(); int cap = ((initialCapacity &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(initialCapacity + (initialCapacity &gt;&gt;&gt; 1) + 1)); this.sizeCtl = cap;}//å½“å‡ºå…¥ä¸€ä¸ªMapçš„æ—¶å€™ï¼Œå…ˆè®¾å®šsizeCtlä¸ºé»˜è®¤å®¹é‡ï¼Œåœ¨æ·»åŠ å…ƒç´ public ConcurrentHashMapDebug(Map&lt;? extends K, ? extends V&gt; m) { this.sizeCtl = DEFAULT_CAPACITY; putAll(m);} åœ¨ä»»ä½•ä¸€ä¸ªæ„é€ æ–¹æ³•ä¸­ï¼Œéƒ½æ²¡æœ‰å¯¹å­˜å‚¨Mapå…ƒç´ Nodeçš„tableå˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚è€Œæ˜¯åœ¨ç¬¬ä¸€æ¬¡putæ“ä½œçš„æ—¶å€™åœ¨è¿›è¡Œåˆå§‹åŒ–ã€‚ putæ“ä½œ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121/* * å•çº¯çš„è°ƒç”¨putValæ–¹æ³•ï¼Œå¹¶ä¸”putValçš„ç¬¬ä¸‰ä¸ªå‚æ•°è®¾ç½®ä¸ºfalse * å½“è®¾ç½®ä¸ºfalseçš„æ—¶å€™è¡¨ç¤ºè¿™ä¸ªvalueä¸€å®šä¼šè®¾ç½® * trueçš„æ—¶å€™ï¼Œåªæœ‰å½“è¿™ä¸ªkeyçš„valueä¸ºç©ºçš„æ—¶å€™æ‰ä¼šè®¾ç½® */public V put(K key, V value) { return putVal(key, value, false);}/* * å½“æ·»åŠ ä¸€å¯¹é”®å€¼å¯¹çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šå»åˆ¤æ–­ä¿å­˜è¿™äº›é”®å€¼å¯¹çš„æ•°ç»„æ˜¯ä¸æ˜¯åˆå§‹åŒ–äº†ï¼Œ * å¦‚æœæ²¡æœ‰çš„è¯å°±åˆå§‹åŒ–æ•°ç»„ * ç„¶åé€šè¿‡è®¡ç®—hashå€¼æ¥ç¡®å®šæ”¾åœ¨æ•°ç»„çš„å“ªä¸ªä½ç½® * å¦‚æœè¿™ä¸ªä½ç½®ä¸ºç©ºåˆ™ç›´æ¥æ·»åŠ ï¼Œå¦‚æœä¸ä¸ºç©ºçš„è¯ï¼Œåˆ™å–å‡ºè¿™ä¸ªèŠ‚ç‚¹æ¥ * å¦‚æœå–å‡ºæ¥çš„èŠ‚ç‚¹çš„hashå€¼æ˜¯MOVED(-1)çš„è¯ï¼Œåˆ™è¡¨ç¤ºå½“å‰æ­£åœ¨å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ï¼Œå¤åˆ¶åˆ°æ–°çš„æ•°ç»„ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¹Ÿå»å¸®åŠ©å¤åˆ¶ * æœ€åä¸€ç§æƒ…å†µå°±æ˜¯ï¼Œå¦‚æœè¿™ä¸ªèŠ‚ç‚¹ï¼Œä¸ä¸ºç©ºï¼Œä¹Ÿä¸åœ¨æ‰©å®¹ï¼Œåˆ™é€šè¿‡synchronizedæ¥åŠ é”ï¼Œè¿›è¡Œæ·»åŠ æ“ä½œ * ç„¶ååˆ¤æ–­å½“å‰å–å‡ºçš„èŠ‚ç‚¹ä½ç½®å­˜æ”¾çš„æ˜¯é“¾è¡¨è¿˜æ˜¯æ ‘ * å¦‚æœæ˜¯é“¾è¡¨çš„è¯ï¼Œåˆ™éå†æ•´ä¸ªé“¾è¡¨ï¼Œç›´åˆ°å–å‡ºæ¥çš„èŠ‚ç‚¹çš„keyæ¥ä¸ªè¦æ”¾çš„keyè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœkeyç›¸ç­‰ï¼Œå¹¶ä¸”keyçš„hashå€¼ä¹Ÿç›¸ç­‰çš„è¯ï¼Œ * åˆ™è¯´æ˜æ˜¯åŒä¸€ä¸ªkeyï¼Œåˆ™è¦†ç›–æ‰valueï¼Œå¦åˆ™çš„è¯åˆ™æ·»åŠ åˆ°é“¾è¡¨çš„æœ«å°¾ * å¦‚æœæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æŠŠè¿™ä¸ªå…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å» * æœ€ååœ¨æ·»åŠ å®Œæˆä¹‹åï¼Œä¼šåˆ¤æ–­åœ¨è¯¥èŠ‚ç‚¹å¤„å…±æœ‰å¤šå°‘ä¸ªèŠ‚ç‚¹ï¼ˆæ³¨æ„æ˜¯æ·»åŠ å‰çš„ä¸ªæ•°ï¼‰ï¼Œå¦‚æœè¾¾åˆ°8ä¸ªä»¥ä¸Šäº†çš„è¯ï¼Œ * åˆ™è°ƒç”¨treeifyBinæ–¹æ³•æ¥å°è¯•å°†å¤„çš„é“¾è¡¨è½¬ä¸ºæ ‘ï¼Œæˆ–è€…æ‰©å®¹æ•°ç»„ */final V putVal(K key, V value, boolean onlyIfAbsent) { //K,Véƒ½ä¸èƒ½ä¸ºç©ºï¼Œå¦åˆ™çš„è¯è·‘å‡ºå¼‚å¸¸ if (key == null || value == null) throw new NullPointerException(); //å–å¾—keyçš„hashå€¼ int hash = spread(key.hashCode()); //ç”¨æ¥è®¡ç®—åœ¨è¿™ä¸ªç»“ç‚¹æ€»å…±æœ‰å¤šå°‘ä¸ªå…ƒç´ ï¼Œç”¨æ¥æ§åˆ¶æ‰©å®¹æˆ–è€…è½¬ç§»æ ‘ int binCount = 0; for (Node&lt;K,V&gt;[] tab = table;;) { Node&lt;K,V&gt; f; int n, i, fh; //å¦‚æœæ•°ç»„ä¸ºç©ºæˆ–æ•°ç»„é•¿åº¦ä¸º0 if (tab == null || (n = tab.length) == 0) //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™tableæ²¡æœ‰åˆå§‹åŒ–åˆ™åˆå§‹åŒ–table tab = initTable(); //æ‰¾è¯¥ hash å€¼å¯¹åº”çš„æ•°ç»„ä¸‹æ ‡ï¼Œå¾—åˆ°ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ f else if ((f = tabAt(tab, i = (n - 1) &amp; hash)) == null) { //å¦‚æœè¿™ä¸ªä½ç½®æ²¡æœ‰å…ƒç´ çš„è¯ï¼Œåˆ™é€šè¿‡casçš„æ–¹å¼å°è¯•æ·»åŠ ï¼Œæ³¨æ„è¿™ä¸ªæ—¶å€™æ˜¯æ²¡æœ‰åŠ é”çš„ //åˆ›å»ºä¸€ä¸ªNodeæ·»åŠ åˆ°æ•°ç»„ä¸­åŒºï¼Œnullè¡¨ç¤ºçš„æ˜¯ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ä¸ºç©º if (casTabAt(tab, i, null, new Node&lt;K,V&gt;(hash, key, value, null))) break; // no lock when adding to empty bin } /* * å¦‚æœæ£€æµ‹åˆ°æŸä¸ªèŠ‚ç‚¹çš„hashå€¼æ˜¯MOVEDï¼Œåˆ™è¡¨ç¤ºæ­£åœ¨è¿›è¡Œæ•°ç»„æ‰©å¼ çš„æ•°æ®å¤åˆ¶é˜¶æ®µï¼Œ * åˆ™å½“å‰çº¿ç¨‹ä¹Ÿä¼šå‚ä¸å»å¤åˆ¶ï¼Œé€šè¿‡å…è®¸å¤šçº¿ç¨‹å¤åˆ¶çš„åŠŸèƒ½ï¼Œä¾æ­¤æ¥å‡å°‘æ•°ç»„çš„å¤åˆ¶æ‰€å¸¦æ¥çš„æ€§èƒ½æŸå¤± */ else if ((fh = f.hash) == MOVED) //æ•°æ®è¿ç§» tab = helpTransfer(tab, f); else { /* * å¦‚æœåœ¨è¿™ä¸ªä½ç½®æœ‰å…ƒç´ çš„è¯ï¼Œå°±é‡‡ç”¨synchronizedçš„æ–¹å¼åŠ é”ï¼Œ * å¦‚æœæ˜¯é“¾è¡¨çš„è¯(hashå¤§äº0)ï¼Œå°±å¯¹è¿™ä¸ªé“¾è¡¨çš„æ‰€æœ‰å…ƒç´ è¿›è¡Œéå†ï¼Œ * å¦‚æœæ‰¾åˆ°äº†keyå’Œkeyçš„hashå€¼éƒ½ä¸€æ ·çš„èŠ‚ç‚¹ï¼Œåˆ™æŠŠå®ƒçš„å€¼æ›¿æ¢åˆ° * å¦‚æœæ²¡æ‰¾åˆ°çš„è¯ï¼Œåˆ™æ·»åŠ åœ¨é“¾è¡¨çš„æœ€åé¢ * å¦åˆ™ï¼Œæ˜¯æ ‘çš„è¯ï¼Œåˆ™è°ƒç”¨putTreeValæ–¹æ³•æ·»åŠ åˆ°æ ‘ä¸­å» * * åœ¨æ·»åŠ å®Œä¹‹åï¼Œä¼šå¯¹è¯¥èŠ‚ç‚¹ä¸Šå…³è”çš„çš„æ•°ç›®è¿›è¡Œåˆ¤æ–­ï¼Œ * å¦‚æœåœ¨8ä¸ªä»¥ä¸Šçš„è¯ï¼Œåˆ™ä¼šè°ƒç”¨treeifyBinæ–¹æ³•ï¼Œæ¥å°è¯•è½¬åŒ–ä¸ºæ ‘ï¼Œæˆ–è€…æ˜¯æ‰©å®¹ */ V oldVal = null; synchronized (f) { if (tabAt(tab, i) == f) {//å†æ¬¡å–å‡ºè¦å­˜å‚¨çš„ä½ç½®çš„å…ƒç´ ï¼Œè·Ÿå‰é¢å–å‡ºæ¥çš„æ¯”è¾ƒ if (fh &gt;= 0) {//å–å‡ºæ¥çš„å…ƒç´ çš„hashå€¼å¤§äº0è¯´æ˜æ˜¯é“¾è¡¨ï¼Œå½“è½¬æ¢ä¸ºæ ‘ä¹‹åï¼Œhashå€¼ä¸º-2 //ç”¨äºç´¯åŠ ï¼Œè®°å½•é“¾è¡¨é•¿åº¦ binCount = 1; for (Node&lt;K,V&gt; e = f;; ++binCount) {//éå†è¿™ä¸ªé“¾è¡¨ K ek; //è¦å­˜çš„å…ƒç´ çš„hashï¼Œkeyè·Ÿè¦å­˜å‚¨çš„ä½ç½®çš„èŠ‚ç‚¹çš„ç›¸åŒçš„æ—¶å€™ï¼Œæ›¿æ¢æ‰è¯¥èŠ‚ç‚¹çš„valueå³å¯ if (e.hash == hash &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) { oldVal = e.val; //å½“ä½¿ç”¨putIfAbsentçš„æ—¶å€™ï¼Œåªæœ‰åœ¨è¿™ä¸ªkeyæ²¡æœ‰è®¾ç½®å€¼å¾—æ—¶å€™æ‰è®¾ç½® if (!onlyIfAbsent) e.val = value; break; } Node&lt;K,V&gt; pred = e; //å¦‚æœä¸æ˜¯åŒæ ·çš„hashï¼ŒåŒæ ·çš„keyçš„æ—¶å€™ï¼Œåˆ™åˆ¤æ–­è¯¥èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å¦ä¸ºç©º if ((e = e.next) == null) { //ä¸ºç©ºçš„è¯æŠŠè¿™ä¸ªè¦åŠ å…¥çš„èŠ‚ç‚¹è®¾ç½®ä¸ºå½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ pred.next = new Node&lt;K,V&gt;(hash, key, value, null); break; } } } else if (f instanceof TreeBin) {//è¡¨ç¤ºå·²ç»è½¬åŒ–æˆçº¢é»‘æ ‘ç±»å‹äº† Node&lt;K,V&gt; p; binCount = 2; //è°ƒç”¨putTreeValæ–¹æ³•ï¼Œå°†è¯¥å…ƒç´ æ·»åŠ åˆ°æ ‘ä¸­å» if ((p = ((TreeBin&lt;K,V&gt;)f).putTreeVal(hash, key, value)) != null) { oldVal = p.val; if (!onlyIfAbsent) p.val = value; } } } } //è¯´æ˜ä¸Šé¢åœ¨åšé“¾è¡¨æ“ä½œ if (binCount != 0) { //åˆ¤æ–­æ˜¯å¦è¦å°†é“¾è¡¨è½¬æˆçº¢é»‘æ ‘ï¼Œä¸´ç•Œå€¼å’ŒHashMapä¸€æ ·ï¼Œä¹Ÿæ˜¯8 if (binCount &gt;= TREEIFY_THRESHOLD) // è¿™ä¸ªæ–¹æ³•å’Œ HashMap ä¸­ç¨å¾®æœ‰ä¸€ç‚¹ç‚¹ä¸åŒï¼Œé‚£å°±æ˜¯å®ƒä¸æ˜¯ä¸€å®šä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œ // å¦‚æœå½“å‰æ•°ç»„çš„é•¿åº¦å°äº 64ï¼Œé‚£ä¹ˆä¼šé€‰æ‹©è¿›è¡Œæ•°ç»„æ‰©å®¹ï¼Œè€Œä¸æ˜¯è½¬æ¢ä¸ºçº¢é»‘æ ‘ treeifyBin(tab, i); if (oldVal != null) return oldVal; break; } } } addCount(1L, binCount); return null;} initTable-æ•°ç»„åˆå§‹åŒ– 12345678910111213141516171819202122232425262728293031323334353637/** * åˆå§‹åŒ–æ•°ç»„tableï¼Œ * å¦‚æœsizeCtlå°äº0ï¼Œè¯´æ˜åˆ«çš„æ•°ç»„æ­£åœ¨è¿›è¡Œåˆå§‹åŒ–ï¼Œåˆ™è®©å‡ºæ‰§è¡Œæƒ * å¦‚æœsizeCtlå¤§äº0çš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtlçš„æ•°ç»„ * å¦åˆ™çš„è¯åˆå§‹åŒ–ä¸€ä¸ªé»˜è®¤å¤§å°(16)çš„æ•°ç»„ * ç„¶åè®¾ç½®sizeCtlçš„å€¼ä¸ºæ•°ç»„é•¿åº¦çš„3/4 */private final Node&lt;K,V&gt;[] initTable() { Node&lt;K,V&gt;[] tab; int sc; //ç¬¬ä¸€æ¬¡putçš„æ—¶å€™ï¼Œtableè¿˜æ²¡è¢«åˆå§‹åŒ–ï¼Œè¿›å…¥while while ((tab = table) == null || tab.length == 0) { //sizeCtlåˆå§‹å€¼ä¸º0ï¼Œå½“å°äº0çš„æ—¶å€™è¡¨ç¤ºåœ¨åˆ«çš„çº¿ç¨‹åœ¨åˆå§‹åŒ–è¡¨æˆ–æ‰©å®¹ if ((sc = sizeCtl) &lt; 0) Thread.yield(); // lost initialization race; just spin //CASä¸€ä¸‹ï¼Œå°†sizectlè®¾ç½®ä¸º-1ï¼Œä»£è¡¨æŠ¢åˆ°äº†é” else if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { try { if ((tab = table) == null || tab.length == 0) { //æŒ‡å®šäº†å¤§å°çš„æ—¶å€™å°±åˆ›å»ºæŒ‡å®šå¤§å°çš„Nodeæ•°ç»„ï¼Œå¦åˆ™åˆ›å»ºæŒ‡å®šå¤§å°(16)çš„Nodeæ•°ç»„ int n = (sc &gt; 0) ? sc : DEFAULT_CAPACITY; //åˆå§‹åŒ–æ•°ç»„ï¼Œé•¿åº¦ä¸º16ï¼Œæˆ–åˆå§‹åŒ–æ—¶æä¾›çš„é•¿åº¦ @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; // å°†è¿™ä¸ªæ•°ç»„èµ‹å€¼ç»™ tableï¼Œtable æ˜¯ volatile çš„ table = tab = nt; // å¦‚æœ n ä¸º 16 çš„è¯ï¼Œé‚£ä¹ˆè¿™é‡Œ sc = 12ï¼Œå…¶å®å°±æ˜¯ 0.75 * n sc = n - (n &gt;&gt;&gt; 2); } } finally { //åˆå§‹åŒ–åï¼ŒsizeCtlé•¿åº¦ä¸ºæ•°ç»„é•¿åº¦çš„3/4 sizeCtl = sc; } break; } } return tab;} ä¸»è¦å°±æ˜¯åˆå§‹åŒ–ä¸€ä¸ªåˆé€‚å¤§å°çš„æ•°ç»„ï¼Œç„¶åä¼šè®¾ç½® sizeCtlã€‚åˆå§‹åŒ–æ–¹æ³•ä¸­çš„å¹¶å‘é—®é¢˜æ˜¯é€šè¿‡å¯¹ sizeCtl è¿›è¡Œä¸€ä¸ª CAS æ“ä½œæ¥æ§åˆ¶çš„ã€‚ treeifyBin-é“¾è¡¨è½¬çº¢é»‘æ ‘ 12345678910111213141516171819202122232425262728293031private final void treeifyBin(Node&lt;K,V&gt;[] tab, int index) { Node&lt;K,V&gt; b; int n, sc; if (tab != null) { // MIN_TREEIFY_CAPACITY ä¸º 64 // æ‰€ä»¥ï¼Œå¦‚æœæ•°ç»„é•¿åº¦å°äº 64 çš„æ—¶å€™ï¼Œå…¶å®ä¹Ÿå°±æ˜¯ 32 æˆ–è€… 16 æˆ–è€…æ›´å°çš„æ—¶å€™ï¼Œä¼šè¿›è¡Œæ•°ç»„æ‰©å®¹ if ((n = tab.length) &lt; MIN_TREEIFY_CAPACITY) tryPresize(n &lt;&lt; 1);//æ•°ç»„æ‰©å®¹ // bæ˜¯å¤´ç»“ç‚¹ else if ((b = tabAt(tab, index)) != null &amp;&amp; b.hash &gt;= 0) { synchronized (b) { if (tabAt(tab, index) == b) { // ä¸‹é¢å°±æ˜¯éå†é“¾è¡¨ï¼Œå»ºç«‹ä¸€é¢—çº¢é»‘æ ‘ TreeNode&lt;K,V&gt; hd = null, tl = null;//hd æ ‘çš„å¤´ç»“ç‚¹ for (Node&lt;K,V&gt; e = b; e != null; e = e.next) { TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt;(e.hash, e.key, e.val, null, null); //æŠŠNodeç»„æˆçš„é“¾è¡¨ï¼Œè½¬åŒ–ä¸ºTreeNodeçš„é“¾è¡¨ï¼Œå¤´ç»“ç‚¹ä»»ç„¶æ”¾åœ¨ç›¸åŒçš„ä½ç½® if ((p.prev = tl) == null) hd = p;//è®¾ç½®head else tl.next = p; tl = p; } // å°†çº¢é»‘æ ‘è®¾ç½®åˆ°æ•°ç»„ç›¸åº”ä½ç½®ä¸­ setTabAt(tab, index, new TreeBin&lt;K,V&gt;(hd)); } } } }} treeifyBin ä¸ä¸€å®šå°±ä¼šè¿›è¡Œçº¢é»‘æ ‘è½¬æ¢ï¼Œä¹Ÿå¯èƒ½æ˜¯ä»…ä»…åšæ•°ç»„æ‰©å®¹ã€‚ tryPresize-æ‰©å®¹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768private final void tryPresize(int size) { // cï¼šsize çš„ 1.5 å€ï¼Œå†åŠ  1ï¼Œå†å¾€ä¸Šå–æœ€è¿‘çš„ 2 çš„ n æ¬¡æ–¹ã€‚ // å¦‚æœç»™å®šçš„å¤§å°å¤§äºç­‰äºæ•°ç»„å®¹é‡çš„ä¸€åŠï¼Œåˆ™ç›´æ¥ä½¿ç”¨æœ€å¤§å®¹é‡ï¼Œå¦åˆ™ä½¿ç”¨tableSizeForç®—å‡ºæ¥ int c = (size &gt;= (MAXIMUM_CAPACITY &gt;&gt;&gt; 1)) ? MAXIMUM_CAPACITY : tableSizeFor(size + (size &gt;&gt;&gt; 1) + 1); int sc; while ((sc = sizeCtl) &gt;= 0) { Node&lt;K,V&gt;[] tab = table; int n; /* * å¦‚æœæ•°ç»„tableè¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªå¤§å°ä¸ºsizeCtrlå’Œåˆšåˆšç®—å‡ºæ¥çš„cä¸­è¾ƒå¤§çš„ä¸€ä¸ªå¤§å°çš„æ•°ç»„ * åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè®¾ç½®sizeCtrlä¸º-1ï¼Œåˆå§‹åŒ–å®Œæˆä¹‹åæŠŠsizeCtrlè®¾ç½®ä¸ºæ•°ç»„é•¿åº¦çš„3/4 * ä¸ºä»€ä¹ˆè¦åœ¨æ‰©å®¹çš„åœ°æ–¹æ¥åˆå§‹åŒ–æ•°ç»„å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æœç¬¬ä¸€æ¬¡putçš„æ—¶å€™ä¸æ˜¯putå•ä¸ªå…ƒç´ ï¼Œ * è€Œæ˜¯è°ƒç”¨putAllæ–¹æ³•ç›´æ¥putä¸€ä¸ªmapçš„è¯ï¼Œåœ¨putALlæ–¹æ³•ä¸­æ²¡æœ‰è°ƒç”¨initTableæ–¹æ³•å»åˆå§‹åŒ–tableï¼Œ * è€Œæ˜¯ç›´æ¥è°ƒç”¨äº†tryPresizeæ–¹æ³•ï¼Œæ‰€ä»¥è¿™é‡Œéœ€è¦åšä¸€ä¸ªæ˜¯ä¸æ˜¯éœ€è¦åˆå§‹åŒ–tableçš„åˆ¤æ–­ */ if (tab == null || (n = tab.length) == 0) { n = (sc &gt; c) ? sc : c; //åˆå§‹åŒ–tabçš„æ—¶å€™ï¼ŒæŠŠsizeCtlè®¾ä¸º-1 if (U.compareAndSwapInt(this, SIZECTL, sc, -1)) { try { if (table == tab) { @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n]; table = nt; sc = n - (n &gt;&gt;&gt; 2); } } finally { sizeCtl = sc; } } } /* * ä¸€ç›´æ‰©å®¹åˆ°çš„cå°äºç­‰äºsizeCtlæˆ–è€…æ•°ç»„é•¿åº¦å¤§äºæœ€å¤§é•¿åº¦çš„æ—¶å€™ï¼Œåˆ™é€€å‡º * æ‰€ä»¥åœ¨ä¸€æ¬¡æ‰©å®¹ä¹‹åï¼Œä¸æ˜¯åŸæ¥é•¿åº¦çš„ä¸¤å€ï¼Œè€Œæ˜¯2çš„næ¬¡æ–¹å€ */ else if (c &lt;= sc || n &gt;= MAXIMUM_CAPACITY) break; else if (tab == table) { int rs = resizeStamp(n); /* * å¦‚æœæ­£åœ¨æ‰©å®¹Tableçš„è¯ï¼Œåˆ™å¸®åŠ©æ‰©å®¹ * å¦åˆ™çš„è¯ï¼Œå¼€å§‹æ–°çš„æ‰©å®¹ * åœ¨transferæ“ä½œï¼Œå°†ç¬¬ä¸€ä¸ªå‚æ•°çš„tableä¸­çš„å…ƒç´ ï¼Œç§»åŠ¨åˆ°ç¬¬äºŒä¸ªå…ƒç´ çš„tableä¸­å»ï¼Œ * è™½ç„¶æ­¤æ—¶ç¬¬äºŒä¸ªå‚æ•°è®¾ç½®çš„æ˜¯nullï¼Œä½†æ˜¯ï¼Œåœ¨transferæ–¹æ³•ä¸­ï¼Œå½“ç¬¬äºŒä¸ªå‚æ•°ä¸ºnullçš„æ—¶å€™ï¼Œ * ä¼šåˆ›å»ºä¸€ä¸ªä¸¤å€å¤§å°çš„table */ if (sc &lt; 0) { Node&lt;K,V&gt;[] nt; if ((sc &gt;&gt;&gt; RESIZE_STAMP_SHIFT) != rs || sc == rs + 1 || sc == rs + MAX_RESIZERS || (nt = nextTable) == null || transferIndex &lt;= 0) break; /* * transferçš„çº¿ç¨‹æ•°åŠ ä¸€,è¯¥çº¿ç¨‹å°†è¿›è¡Œtransferçš„å¸®å¿™ * åœ¨transferçš„æ—¶å€™ï¼Œscè¡¨ç¤ºåœ¨transferå·¥ä½œçš„çº¿ç¨‹æ•° */ if (U.compareAndSwapInt(this, SIZECTL, sc, sc + 1)) transfer(tab, nt); } /* * æ²¡æœ‰åœ¨åˆå§‹åŒ–æˆ–æ‰©å®¹ï¼Œåˆ™å¼€å§‹æ‰©å®¹ */ else if (U.compareAndSwapInt(this, SIZECTL, sc, (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2)) transfer(tab, null); } }} è¿™ä¸ªæ–¹æ³•çš„æ ¸å¿ƒåœ¨äº sizeCtl å€¼çš„æ“ä½œï¼Œé¦–å…ˆå°†å…¶è®¾ç½®ä¸ºä¸€ä¸ªè´Ÿæ•°ï¼Œç„¶åæ‰§è¡Œ transfer(tab, null)ï¼Œå†ä¸‹ä¸€ä¸ªå¾ªç¯å°† sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ï¼Œä¹‹åå¯èƒ½æ˜¯ç»§ç»­ sizeCtl åŠ  1ï¼Œå¹¶æ‰§è¡Œ transfer(tab, nt)ã€‚æ‰€ä»¥ï¼Œå¯èƒ½çš„æ“ä½œå°±æ˜¯æ‰§è¡Œ 1 æ¬¡ transfer(tab, null) +å¤šæ¬¡ transfer(tab, nt)ï¼Œè¿™é‡Œæ€ä¹ˆç»“æŸå¾ªç¯çš„éœ€è¦çœ‹å®Œ transfer æºç æ‰æ¸…æ¥šã€‚ transfer-æ•°æ®è¿ç§» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213/** * æŠŠæ•°ç»„ä¸­çš„èŠ‚ç‚¹å¤åˆ¶åˆ°æ–°çš„æ•°ç»„çš„ç›¸åŒä½ç½®ï¼Œæˆ–è€…ç§»åŠ¨åˆ°æ‰©å¼ éƒ¨åˆ†çš„ç›¸åŒä½ç½® * åœ¨è¿™é‡Œé¦–å…ˆä¼šè®¡ç®—ä¸€ä¸ªæ­¥é•¿ï¼Œè¡¨ç¤ºä¸€ä¸ªçº¿ç¨‹å¤„ç†çš„æ•°ç»„é•¿åº¦ï¼Œç”¨æ¥æ§åˆ¶å¯¹CPUçš„ä½¿ç”¨ï¼Œ * æ¯ä¸ªCPUæœ€å°‘å¤„ç†16ä¸ªé•¿åº¦çš„æ•°ç»„å…ƒç´ ,ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸€ä¸ªæ•°ç»„çš„é•¿åº¦åªæœ‰16ï¼Œé‚£åªæœ‰ä¸€ä¸ªçº¿ç¨‹ä¼šå¯¹å…¶è¿›è¡Œæ‰©å®¹çš„å¤åˆ¶ç§»åŠ¨æ“ä½œ * æ‰©å®¹çš„æ—¶å€™ä¼šä¸€ç›´éå†ï¼ŒçŸ¥é“å¤åˆ¶å®Œæ‰€æœ‰èŠ‚ç‚¹ï¼Œæ²¡å¤„ç†ä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ä¼šåœ¨é“¾è¡¨çš„å¤´éƒ¨è®¾ç½®ä¸€ä¸ªfwdèŠ‚ç‚¹ï¼Œè¿™æ ·å…¶ä»–çº¿ç¨‹å°±ä¼šè·³è¿‡ä»–ï¼Œ * å¤åˆ¶ååœ¨æ–°æ•°ç»„ä¸­çš„é“¾è¡¨ä¸æ˜¯ç»å¯¹çš„ååºçš„ */private final void transfer(Node&lt;K,V&gt;[] tab, Node&lt;K,V&gt;[] nextTab) { int n = tab.length, stride; // stride åœ¨å•æ ¸ä¸‹ç›´æ¥ç­‰äº nï¼Œå¤šæ ¸æ¨¡å¼ä¸‹ä¸º (n&gt;&gt;&gt;3)/NCPUï¼Œæœ€å°å€¼æ˜¯ 16 // stride å¯ä»¥ç†è§£ä¸ºâ€æ­¥é•¿â€œï¼Œæœ‰ n ä¸ªä½ç½®æ˜¯éœ€è¦è¿›è¡Œè¿ç§»çš„ï¼Œ // å°†è¿™ n ä¸ªä»»åŠ¡åˆ†ä¸ºå¤šä¸ªä»»åŠ¡åŒ…ï¼Œæ¯ä¸ªä»»åŠ¡åŒ…æœ‰ stride ä¸ªä»»åŠ¡ if ((stride = (NCPU &gt; 1) ? (n &gt;&gt;&gt; 3) / NCPU : n) &lt; MIN_TRANSFER_STRIDE) stride = MIN_TRANSFER_STRIDE; // subdivide range /* * å¦‚æœå¤åˆ¶çš„ç›®æ ‡nextTabä¸ºnullçš„è¯ï¼Œåˆ™åˆå§‹åŒ–ä¸€ä¸ªtableä¸¤å€é•¿çš„nextTab * æ­¤æ—¶nextTableè¢«è®¾ç½®å€¼äº†(åœ¨åˆå§‹æƒ…å†µä¸‹æ˜¯ä¸ºnullçš„) * å› ä¸ºå¦‚æœæœ‰ä¸€ä¸ªçº¿ç¨‹å¼€å§‹äº†è¡¨çš„æ‰©å¼ çš„æ—¶å€™ï¼Œå…¶ä»–çº¿ç¨‹ä¹Ÿä¼šè¿›æ¥å¸®å¿™æ‰©å¼ ï¼Œ * è€Œåªæ˜¯ç¬¬ä¸€ä¸ªå¼€å§‹æ‰©å¼ çš„çº¿ç¨‹éœ€è¦åˆå§‹åŒ–ä¸‹ç›®æ ‡æ•°ç»„ */ if (nextTab == null) { // initiating try { //å®¹é‡ç¿»å€ @SuppressWarnings("unchecked") Node&lt;K,V&gt;[] nt = (Node&lt;K,V&gt;[])new Node&lt;?,?&gt;[n &lt;&lt; 1]; nextTab = nt; } catch (Throwable ex) { // try to cope with OOME sizeCtl = Integer.MAX_VALUE; return; } // nextTable æ˜¯ ConcurrentHashMap ä¸­çš„å±æ€§ nextTable = nextTab; // transferIndex ä¹Ÿæ˜¯ ConcurrentHashMap çš„å±æ€§ï¼Œç”¨äºæ§åˆ¶è¿ç§»çš„ä½ç½® transferIndex = n; } int nextn = nextTab.length; // ForwardingNode--&gt;æ­£åœ¨è¢«è¿ç§»çš„ Node // è¿™ä¸ªæ„é€ æ–¹æ³•ä¼šç”Ÿæˆä¸€ä¸ªNodeï¼Œkeyã€value å’Œ next éƒ½ä¸º nullï¼Œå…³é”®æ˜¯ hash ä¸º MOVED // åé¢ä¼šçœ‹åˆ°ï¼ŒåŸæ•°ç»„ä¸­ä½ç½® i å¤„çš„èŠ‚ç‚¹å®Œæˆè¿ç§»å·¥ä½œåï¼Œ // å°±ä¼šå°†ä½ç½® i å¤„è®¾ç½®ä¸ºè¿™ä¸ª ForwardingNodeï¼Œç”¨æ¥å‘Šè¯‰å…¶ä»–çº¿ç¨‹è¯¥ä½ç½®å·²ç»å¤„ç†è¿‡äº† // æ‰€ä»¥å®ƒå…¶å®ç›¸å½“äºæ˜¯ä¸€ä¸ªæ ‡å¿—ã€‚ ForwardingNode&lt;K,V&gt; fwd = new ForwardingNode&lt;K,V&gt;(nextTab); // advance æŒ‡çš„æ˜¯åšå®Œäº†ä¸€ä¸ªä½ç½®çš„è¿ç§»å·¥ä½œï¼Œå¯ä»¥å‡†å¤‡åšä¸‹ä¸€ä¸ªä½ç½®çš„äº† boolean advance = true; boolean finishing = false; // to ensure sweep(æ¸…æ‰«) before committing nextTab,åœ¨å®Œæˆä¹‹å‰é‡æ–°åœ¨æ‰«æä¸€éæ•°ç»„ï¼Œçœ‹çœ‹æœ‰æ²¡å®Œæˆçš„æ²¡ // i æ˜¯ä½ç½®ç´¢å¼•ï¼Œbound æ˜¯è¾¹ç•Œï¼Œæ³¨æ„æ˜¯ä»åå¾€å‰ for (int i = 0, bound = 0;;) { Node&lt;K,V&gt; f; int fh; // advance ä¸º true è¡¨ç¤ºå¯ä»¥è¿›è¡Œä¸‹ä¸€ä¸ªä½ç½®çš„è¿ç§»äº† // ç®€å•ç†è§£ï¼ši æŒ‡å‘äº† transferIndexï¼Œbound æŒ‡å‘äº† transferIndex-stride while (advance) { int nextIndex, nextBound; if (--i &gt;= bound || finishing) advance = false; // å°† transferIndex å€¼èµ‹ç»™ nextIndex // è¿™é‡Œ transferIndex ä¸€æ—¦å°äºç­‰äº 0ï¼Œè¯´æ˜åŸæ•°ç»„çš„æ‰€æœ‰ä½ç½®éƒ½æœ‰ç›¸åº”çš„çº¿ç¨‹å»å¤„ç†äº† else if ((nextIndex = transferIndex) &lt;= 0) { i = -1; advance = false; } // nextBound æ˜¯è¿™æ¬¡è¿ç§»ä»»åŠ¡çš„è¾¹ç•Œï¼Œæ³¨æ„ï¼Œæ˜¯ä»åå¾€å‰ else if (U.compareAndSwapInt (this, TRANSFERINDEX, nextIndex, nextBound = (nextIndex &gt; stride ? nextIndex - stride : 0))) { bound = nextBound; i = nextIndex - 1; advance = false; } } if (i &lt; 0 || i &gt;= n || i + n &gt;= nextn) { int sc; // æ‰€æœ‰çš„è¿ç§»æ“ä½œå·²ç»å®Œæˆ if (finishing) { nextTable = null; // å°†æ–°çš„ nextTab èµ‹å€¼ç»™ table å±æ€§ï¼Œå®Œæˆè¿ç§» table = nextTab; // é‡æ–°è®¡ç®— sizeCtlï¼šn æ˜¯åŸæ•°ç»„é•¿åº¦ï¼Œæ‰€ä»¥ sizeCtl å¾—å‡ºçš„å€¼å°†æ˜¯æ–°æ•°ç»„é•¿åº¦çš„ 0.75 å€ sizeCtl = (n &lt;&lt; 1) - (n &gt;&gt;&gt; 1); return; } // sizeCtl åœ¨è¿ç§»å‰ä¼šè®¾ç½®ä¸º (rs &lt;&lt; RESIZE_STAMP_SHIFT) + 2 // ç„¶åï¼Œæ¯æœ‰ä¸€ä¸ªçº¿ç¨‹å‚ä¸è¿ç§»å°±ä¼šå°† sizeCtl åŠ  1ï¼Œ // è¿™é‡Œä½¿ç”¨ CAS æ“ä½œå¯¹ sizeCtl è¿›è¡Œå‡ 1ï¼Œä»£è¡¨åšå®Œäº†å±äºè‡ªå·±çš„ä»»åŠ¡ if (U.compareAndSwapInt(this, SIZECTL, sc = sizeCtl, sc - 1)) { if ((sc - 2) != resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFT) return; // åˆ°è¿™é‡Œï¼Œè¯´æ˜ (sc - 2) == resizeStamp(n) &lt;&lt; RESIZE_STAMP_SHIFTï¼Œ // ä¹Ÿå°±æ˜¯è¯´ï¼Œæ‰€æœ‰çš„è¿ç§»ä»»åŠ¡éƒ½åšå®Œäº†ï¼Œä¹Ÿå°±ä¼šè¿›å…¥åˆ°ä¸Šé¢çš„ if(finishing){} åˆ†æ”¯äº† finishing = advance = true; i = n; // recheck before commit } } // å¦‚æœä½ç½® i å¤„æ˜¯ç©ºçš„ï¼Œæ²¡æœ‰ä»»ä½•èŠ‚ç‚¹ï¼Œé‚£ä¹ˆæ”¾å…¥åˆšåˆšåˆå§‹åŒ–çš„ ForwardingNode â€ç©ºèŠ‚ç‚¹â€œ else if ((f = tabAt(tab, i)) == null) advance = casTabAt(tab, i, null, fwd); // è¯¥ä½ç½®å¤„æ˜¯ä¸€ä¸ª ForwardingNodeï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»è¿‡äº† else if ((fh = f.hash) == MOVED) advance = true; // already processed else { // å¯¹æ•°ç»„è¯¥ä½ç½®å¤„çš„ç»“ç‚¹åŠ é”ï¼Œå¼€å§‹å¤„ç†æ•°ç»„è¯¥ä½ç½®å¤„çš„è¿ç§»å·¥ä½œ synchronized (f) { if (tabAt(tab, i) == f) { Node&lt;K,V&gt; ln, hn; // å¤´ç»“ç‚¹çš„ hash å¤§äº 0ï¼Œè¯´æ˜æ˜¯é“¾è¡¨çš„ Node èŠ‚ç‚¹ if (fh &gt;= 0) { // éœ€è¦å°†é“¾è¡¨ä¸€åˆ†ä¸ºäºŒï¼Œæ‰¾åˆ°åŸé“¾è¡¨ä¸­çš„ lastRunï¼Œ // ç„¶å lastRun åŠå…¶ä¹‹åçš„èŠ‚ç‚¹æ˜¯ä¸€èµ·è¿›è¡Œè¿ç§»çš„lastRun ä¹‹å‰çš„èŠ‚ç‚¹éœ€è¦è¿›è¡Œå…‹éš†ï¼Œç„¶ååˆ†åˆ°ä¸¤ä¸ªé“¾è¡¨ä¸­ int runBit = fh &amp; n; Node&lt;K,V&gt; lastRun = f; /* * lastRun è¡¨ç¤ºçš„æ˜¯éœ€è¦å¤åˆ¶çš„æœ€åä¸€ä¸ªèŠ‚ç‚¹ * æ¯å½“æ–°èŠ‚ç‚¹çš„hash&amp;n -&gt; b å‘ç”Ÿå˜åŒ–çš„æ—¶å€™ï¼Œå°±æŠŠrunBitè®¾ç½®ä¸ºè¿™ä¸ªç»“æœb * è¿™æ ·forå¾ªç¯ä¹‹åï¼ŒrunBitçš„å€¼å°±æ˜¯æœ€åä¸å˜çš„hash&amp;nçš„å€¼ * è€ŒlastRunçš„å€¼å°±æ˜¯æœ€åä¸€æ¬¡å¯¼è‡´hash&amp;n å‘ç”Ÿå˜åŒ–çš„èŠ‚ç‚¹(å‡è®¾ä¸ºpèŠ‚ç‚¹) * ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšå‘¢ï¼Ÿå› ä¸ºpèŠ‚ç‚¹åé¢çš„èŠ‚ç‚¹çš„hash&amp;n å€¼è·ŸpèŠ‚ç‚¹æ˜¯ä¸€æ ·çš„ï¼Œ * æ‰€ä»¥åœ¨å¤åˆ¶åˆ°æ–°çš„tableçš„æ—¶å€™ï¼Œå®ƒè‚¯å®šè¿˜æ˜¯è·ŸpèŠ‚ç‚¹åœ¨åŒä¸€ä¸ªä½ç½® * åœ¨å¤åˆ¶å®ŒpèŠ‚ç‚¹ä¹‹åï¼ŒpèŠ‚ç‚¹çš„nextèŠ‚ç‚¹è¿˜æ˜¯æŒ‡å‘å®ƒåŸæ¥çš„èŠ‚ç‚¹ï¼Œå°±ä¸éœ€è¦è¿›è¡Œå¤åˆ¶äº†ï¼Œè‡ªå·±å°±è¢«å¸¦è¿‡å»äº† * è¿™ä¹Ÿå°±å¯¼è‡´äº†ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¤åˆ¶åçš„é“¾è¡¨çš„é¡ºåºå¹¶ä¸ä¸€å®šæ˜¯åŸæ¥çš„å€’åº */ for (Node&lt;K,V&gt; p = f.next; p != null; p = p.next) { int b = p.hash &amp; n; //nçš„å€¼ä¸ºæ‰©å¼ å‰çš„æ•°ç»„çš„é•¿åº¦ if (b != runBit) { runBit = b; lastRun = p; } } if (runBit == 0) { ln = lastRun; hn = null; } else { hn = lastRun; ln = null; } /* * æ„é€ ä¸¤ä¸ªé“¾è¡¨ï¼Œé¡ºåºå¤§éƒ¨åˆ†å’ŒåŸæ¥æ˜¯åçš„ * åˆ†åˆ«æ”¾åˆ°åŸæ¥çš„ä½ç½®å’Œæ–°å¢åŠ çš„é•¿åº¦çš„ç›¸åŒä½ç½®(i/n+i) */ for (Node&lt;K,V&gt; p = f; p != lastRun; p = p.next) { int ph = p.hash; K pk = p.key; V pv = p.val; if ((ph &amp; n) == 0) /* * å‡è®¾runBitçš„å€¼ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ ln = new Node&lt;K,V&gt;(ph, pk, pv, ln); else /* * å‡è®¾runBitçš„å€¼ä¸ä¸º0ï¼Œ * åˆ™ç¬¬ä¸€æ¬¡è¿›å…¥è¿™ä¸ªè®¾ç½®çš„æ—¶å€™ç›¸å½“äºæŠŠæ—§çš„åºåˆ—çš„æœ€åä¸€æ¬¡å‘ç”Ÿhashå˜åŒ–çš„èŠ‚ç‚¹(è¯¥èŠ‚ç‚¹åé¢å¯èƒ½è¿˜æœ‰hashè®¡ç®—ååŒä¸ä¸º0çš„èŠ‚ç‚¹)è®¾ç½®åˆ°æ—§çš„tableçš„ç¬¬ä¸€ä¸ªhashè®¡ç®—åä¸ä¸º0çš„èŠ‚ç‚¹ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ * å¹¶ä¸”æŠŠè‡ªå·±è¿”å›ï¼Œç„¶ååœ¨ä¸‹æ¬¡è¿›æ¥çš„æ—¶å€™æŠŠå®ƒè‡ªå·±è®¾ç½®ä¸ºåé¢èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ */ hn = new Node&lt;K,V&gt;(ph, pk, pv, hn); } // å…¶ä¸­çš„ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i setTabAt(nextTab, i, ln); // å¦ä¸€ä¸ªé“¾è¡¨æ”¾åœ¨æ–°æ•°ç»„çš„ä½ç½® i+n setTabAt(nextTab, i + n, hn); // å°†åŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ // å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº† setTabAt(tab, i, fwd); // advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯• advance = true; } else if (f instanceof TreeBin) { // çº¢é»‘æ ‘çš„è¿ç§» TreeBin&lt;K,V&gt; t = (TreeBin&lt;K,V&gt;)f; TreeNode&lt;K,V&gt; lo = null, loTail = null; TreeNode&lt;K,V&gt; hi = null, hiTail = null; int lc = 0, hc = 0; for (Node&lt;K,V&gt; e = t.first; e != null; e = e.next) { int h = e.hash; TreeNode&lt;K,V&gt; p = new TreeNode&lt;K,V&gt; (h, e.key, e.val, null, null); if ((h &amp; n) == 0) { if ((p.prev = loTail) == null) lo = p; else loTail.next = p; loTail = p; ++lc; } else { if ((p.prev = hiTail) == null) hi = p; else hiTail.next = p; hiTail = p; ++hc; } } // å¦‚æœä¸€åˆ†ä¸ºäºŒåï¼ŒèŠ‚ç‚¹æ•°â‰¤6ï¼Œé‚£ä¹ˆå°†çº¢é»‘æ ‘è½¬æ¢å›é“¾è¡¨ ln = (lc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(lo) : (hc != 0) ? new TreeBin&lt;K,V&gt;(lo) : t; hn = (hc &lt;= UNTREEIFY_THRESHOLD) ? untreeify(hi) : (lc != 0) ? new TreeBin&lt;K,V&gt;(hi) : t; // å°†lnæ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½®i setTabAt(nextTab, i, ln); // å°†hnæ”¾ç½®åœ¨æ–°æ•°ç»„çš„ä½ç½®i+n setTabAt(nextTab, i + n, hn); //å°†åŸæ•°ç»„è¯¥ä½ç½®å¤„è®¾ç½®ä¸º fwdï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»å¤„ç†å®Œæ¯•ï¼Œ //å…¶ä»–çº¿ç¨‹ä¸€æ—¦çœ‹åˆ°è¯¥ä½ç½®çš„ hash å€¼ä¸º MOVEDï¼Œå°±ä¸ä¼šè¿›è¡Œè¿ç§»äº† setTabAt(tab, i, fwd); // advance è®¾ç½®ä¸º trueï¼Œä»£è¡¨è¯¥ä½ç½®å·²ç»è¿ç§»å®Œæ¯• advance = true; } } } } }} æ­¤æ–¹æ³•æ”¯æŒå¤šçº¿ç¨‹æ‰§è¡Œï¼Œå¤–å›´è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼Œä¼šä¿è¯ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ï¼ŒnextTab å‚æ•°ä¸º nullï¼Œä¹‹åå†è°ƒç”¨æ­¤æ–¹æ³•çš„æ—¶å€™ï¼ŒnextTab ä¸ä¼šä¸º nullã€‚ å…ˆç†è§£ä¸‹å¹¶å‘æ“ä½œçš„æœºåˆ¶ã€‚åŸæ•°ç»„é•¿åº¦ä¸º nï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ n ä¸ªè¿ç§»ä»»åŠ¡ï¼Œè®©æ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£ä¸€ä¸ªå°ä»»åŠ¡æ˜¯æœ€ç®€å•çš„ï¼Œæ¯åšå®Œä¸€ä¸ªä»»åŠ¡å†æ£€æµ‹æ˜¯å¦æœ‰å…¶ä»–æ²¡åšå®Œçš„ä»»åŠ¡ï¼Œå¸®åŠ©è¿ç§»å°±å¯ä»¥äº†ï¼Œè€Œ Doug Lea ä½¿ç”¨äº†ä¸€ä¸ª strideï¼Œç®€å•ç†è§£å°±æ˜¯æ­¥é•¿ï¼Œæ¯ä¸ªçº¿ç¨‹æ¯æ¬¡è´Ÿè´£è¿ç§»å…¶ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå¦‚æ¯æ¬¡è¿ç§» 16 ä¸ªå°ä»»åŠ¡ã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªå…¨å±€çš„è°ƒåº¦è€…æ¥å®‰æ’å“ªä¸ªçº¿ç¨‹æ‰§è¡Œå“ªå‡ ä¸ªä»»åŠ¡ï¼Œè¿™ä¸ªå°±æ˜¯å±æ€§ transferIndex çš„ä½œç”¨ã€‚ ç¬¬ä¸€ä¸ªå‘èµ·æ•°æ®è¿ç§»çš„çº¿ç¨‹ä¼šå°† transferIndex æŒ‡å‘åŸæ•°ç»„æœ€åçš„ä½ç½®ï¼Œç„¶åä»åå¾€å‰çš„ stride ä¸ªä»»åŠ¡å±äºç¬¬ä¸€ä¸ªçº¿ç¨‹ï¼Œç„¶åå°† transferIndex æŒ‡å‘æ–°çš„ä½ç½®ï¼Œå†å¾€å‰çš„ stride ä¸ªä»»åŠ¡å±äºç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¾æ­¤ç±»æ¨ã€‚å½“ç„¶ï¼Œè¿™é‡Œè¯´çš„ç¬¬äºŒä¸ªçº¿ç¨‹ä¸æ˜¯çœŸçš„ä¸€å®šæŒ‡ä»£äº†ç¬¬äºŒä¸ªçº¿ç¨‹ï¼Œä¹Ÿå¯ä»¥æ˜¯åŒä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªè¯»è€…åº”è¯¥èƒ½ç†è§£å§ã€‚å…¶å®å°±æ˜¯å°†ä¸€ä¸ªå¤§çš„è¿ç§»ä»»åŠ¡åˆ†ä¸ºäº†ä¸€ä¸ªä¸ªä»»åŠ¡åŒ…ã€‚ putTreeVal-æ’å…¥æ ‘ç»“ç‚¹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778final TreeNode&lt;K,V&gt; putTreeVal(int h, K k, V v) { Class&lt;?&gt; kc = null; boolean searched = false; for (TreeNode&lt;K,V&gt; p = root;;) { int dir, ph; K pk; if (p == null) { // å½“å‰æ¡¶ä¸ºç©ºï¼Œåˆ™ç›´æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„èŠ‚ç‚¹ first = root = new TreeNode&lt;K,V&gt;(h, k, v, null, null); break; } else if ((ph = p.hash) &gt; h) // hashå€¼å¤§äºå½“å‰keyçš„ï¼Œåœ¨å·¦å­æ ‘ dir = -1; else if (ph &lt; h) // hashå€¼å°äºå½“å‰keyçš„ï¼Œåœ¨å³å­æ ‘ dir = 1; else if ((pk = p.key) == k || (pk != null &amp;&amp; k.equals(pk))) // ç­‰äºï¼Œåˆ™æ¯”è¾ƒkeyæ˜¯å¦ç›¸ç­‰ return p; else if ((kc == null &amp;&amp; (kc = comparableClassFor(k)) == null) || (dir = compareComparables(kc, k, pk)) == 0) { // å¦‚æœhashå€¼ç›¸ç­‰ï¼Œé‚£ä¹ˆå°±æ¯”è¾ƒä¸‹æ˜¯å¦æ˜¯Stringæˆ–è€…å®ç°äº†Comparableæ¥å£ // å¦‚æœç­‰å‡ºç°äºŒæ¬¡ç¢°æ’ï¼Œåˆ™å·¦å³å­æ ‘éƒ½æœç´¢ if (!searched) { TreeNode&lt;K,V&gt; q, ch; searched = true; // æ‰¾åˆ°å¯¹åº”çš„èŠ‚ç‚¹ if (((ch = p.left) != null &amp;&amp; (q = ch.findTreeNode(h, k, kc)) != null) || ((ch = p.right) != null &amp;&amp; (q = ch.findTreeNode(h, k, kc)) != null)) // æ‰¾åˆ°ç›´æ¥è¿”å›å³å¯ return q; } // å‡å¦‚æ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™æ ¹æ®ç±»åã€System.identityHashCodeæ¯”è¾ƒæ¥ç¡®å®šåˆ°åº•æ”¾åœ¨å·¦å³å“ªè¾¹ dir = tieBreakOrder(k, pk); } TreeNode&lt;K,V&gt; xp = p; // æ ¹æ®æ¯”è¾ƒçš„å¤§å°diræ¥ç¡®å®šæ’å…¥å·¦å­æ ‘è¿˜æ˜¯å³å­æ ‘ if ((p = (dir &lt;= 0) ? p.left : p.right) == null) { TreeNode&lt;K,V&gt; x, f = first; first = x = new TreeNode&lt;K,V&gt;(h, k, v, f, xp); if (f != null) f.prev = x; if (dir &lt;= 0) // &lt;=0 å·¦å­æ ‘ xp.left = x; else // &gt;0 å³å­æ ‘ xp.right = x; if (!xp.red) x.red = true; else { // åŠ é”ï¼Œè°ƒæ•´å¹³è¡¡ lockRoot(); try { root = balanceInsertion(root, x); } finally { unlockRoot(); } } break; } } assert checkInvariants(root); return null;}// å¤šæ¬¡å†²çªç¢°æ’ä¹‹åï¼Œå°±ç”¨æ­¤æ¥å†³å®šè°å¤§è°å°ï¼Œä»¥åŒºåˆ†åœ¨å·¦è¿˜æ˜¯åœ¨å³å­æ ‘ä¸Šstatic int tieBreakOrder(Object a, Object b) { int d; if (a == null || b == null || (d = a.getClass().getName(). compareTo(b.getClass().getName())) == 0) d = (System.identityHashCode(a) &lt;= System.identityHashCode(b) ? -1 : 1); return d;} getæ“ä½œ 123456789101112131415161718192021222324public V get(Object key) { Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; e, p; int n, eh; K ek; int h = spread(key.hashCode()); if ((tab = table) != null &amp;&amp; (n = tab.length) &gt; 0 &amp;&amp; (e = tabAt(tab, (n - 1) &amp; h)) != null) { // åˆ¤æ–­å¤´ç»“ç‚¹æ˜¯å¦å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„èŠ‚ç‚¹ if ((eh = e.hash) == h) { if ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek))) return e.val; } // å¦‚æœå¤´ç»“ç‚¹çš„ hash å°äº 0ï¼Œè¯´æ˜ æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…è¯¥ä½ç½®æ˜¯çº¢é»‘æ ‘ else if (eh &lt; 0) // å‚è€ƒ ForwardingNode.find(int h, Object k) å’Œ TreeBin.find(int h, Object k) return (p = e.find(h, key)) != null ? p.val : null; // éå†é“¾è¡¨ while ((e = e.next) != null) { if (e.hash == h &amp;&amp; ((ek = e.key) == key || (ek != null &amp;&amp; key.equals(ek)))) return e.val; } } return null;} è®¡ç®— hash å€¼; æ ¹æ® hash å€¼æ‰¾åˆ°æ•°ç»„å¯¹åº”ä½ç½®: (n - 1) &amp; h; æ ¹æ®è¯¥ä½ç½®å¤„ç»“ç‚¹æ€§è´¨è¿›è¡Œç›¸åº”æŸ¥æ‰¾ å¦‚æœè¯¥ä½ç½®ä¸º nullï¼Œé‚£ä¹ˆç›´æ¥è¿”å› null å°±å¯ä»¥äº†; å¦‚æœè¯¥ä½ç½®å¤„çš„èŠ‚ç‚¹åˆšå¥½å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œè¿”å›è¯¥èŠ‚ç‚¹çš„å€¼å³å¯; å¦‚æœè¯¥ä½ç½®èŠ‚ç‚¹çš„ hash å€¼å°äº 0ï¼Œè¯´æ˜æ­£åœ¨æ‰©å®¹ï¼Œæˆ–è€…æ˜¯çº¢é»‘æ ‘; å¦‚æœä»¥ä¸Š 3 æ¡éƒ½ä¸æ»¡è¶³ï¼Œé‚£å°±æ˜¯é“¾è¡¨ï¼Œè¿›è¡Œéå†æ¯”å¯¹å³å¯; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-awkç”¨æ³•]]></title>
    <url>%2Fposts%2Fed2e0218.html</url>
    <content type="text"><![CDATA[å·¥ä½œåŸç† è¯»è¾“å…¥æ–‡ä»¶ä¹‹å‰æ‰§è¡Œçš„ä»£ç æ®µï¼ˆç”±BEGINå…³é”®å­—æ ‡è¯†ï¼‰ã€‚ ä¸»å¾ªç¯æ‰§è¡Œè¾“å…¥æ–‡ä»¶çš„ä»£ç æ®µã€‚ è¯»è¾“å…¥æ–‡ä»¶ä¹‹åçš„ä»£ç æ®µï¼ˆç”±ENDå…³é”®å­—æ ‡è¯†ï¼‰ã€‚ å‘½ä»¤ç»“æ„ 1awk 'BEGIN{ commands } pattern{ commands } END{ commands }' å·¥ä½œæµç¨‹ 1ã€é€šè¿‡å…³é”®å­— BEGIN æ‰§è¡Œ BEGIN å—çš„å†…å®¹ï¼Œå³ BEGIN åèŠ±æ‹¬å· {} çš„å†…å®¹ã€‚2ã€å®Œæˆ BEGIN å—çš„æ‰§è¡Œï¼Œå¼€å§‹æ‰§è¡Œbodyå—ã€‚3ã€è¯»å…¥æœ‰ \n æ¢è¡Œç¬¦åˆ†å‰²çš„è®°å½•ã€‚4ã€å°†è®°å½•æŒ‰æŒ‡å®šçš„åŸŸåˆ†éš”ç¬¦åˆ’åˆ†åŸŸï¼Œå¡«å……åŸŸï¼Œ$0 åˆ™è¡¨ç¤ºæ‰€æœ‰åŸŸ(å³ä¸€è¡Œå†…å®¹)ï¼Œ$1 è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸï¼Œ$n è¡¨ç¤ºç¬¬ n ä¸ªåŸŸã€‚5ã€ä¾æ¬¡æ‰§è¡Œå„ BODY å—ï¼Œpattern éƒ¨åˆ†åŒ¹é…è¯¥è¡Œå†…å®¹æˆåŠŸåï¼Œæ‰ä¼šæ‰§è¡Œ awk-commands çš„å†…å®¹ã€‚6ã€å¾ªç¯è¯»å–å¹¶æ‰§è¡Œå„è¡Œç›´åˆ°æ–‡ä»¶ç»“æŸï¼Œå®Œæˆbodyå—æ‰§è¡Œã€‚7ã€å¼€å§‹ END å—æ‰§è¡Œï¼ŒEND å—å¯ä»¥è¾“å‡ºæœ€ç»ˆç»“æœã€‚ å¼€å§‹å—ï¼ˆBEGINï¼‰ å¼€å§‹å—çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1BEGIN {awk-commands} å¼€å§‹å—å°±æ˜¯åœ¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™æ‰§è¡Œçš„ä»£ç éƒ¨åˆ†ï¼Œå¹¶ä¸”å®ƒåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­åªæ‰§è¡Œä¸€æ¬¡ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¼€å§‹å—ä¸­åˆå§‹åŒ–ä¸€äº›å˜é‡ã€‚ BEGIN æ˜¯ AWK çš„å…³é”®å­—ï¼Œå› æ­¤å®ƒå¿…é¡»æ˜¯å¤§å†™çš„ã€‚ æ³¨æ„ï¼šå¼€å§‹å—éƒ¨åˆ†æ˜¯å¯é€‰çš„ï¼Œä½ çš„ç¨‹åºå¯ä»¥æ²¡æœ‰å¼€å§‹å—éƒ¨åˆ†ã€‚ ä¸»ä½“å—ï¼ˆBODYï¼‰ ä¸»ä½“éƒ¨åˆ†çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1/pattern/ {awk-commands} å¯¹äºæ¯ä¸€ä¸ªè¾“å…¥çš„è¡Œéƒ½ä¼šæ‰§è¡Œä¸€æ¬¡ä¸»ä½“éƒ¨åˆ†çš„å‘½ä»¤ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹äºè¾“å…¥çš„æ¯ä¸€è¡Œï¼ŒAWK éƒ½ä¼šæ‰§è¡Œå‘½ä»¤ã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶é™å®šåœ¨æŒ‡å®šçš„æ¨¡å¼ä¸­ã€‚ æ³¨æ„ï¼šåœ¨ä¸»ä½“å—éƒ¨åˆ†æ²¡æœ‰å…³é”®å­—å­˜åœ¨ã€‚ ç»“æŸå—ï¼ˆENDï¼‰ ç»“æŸå—çš„è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1END {awk-commands} ç»“æŸå—æ˜¯åœ¨ç¨‹åºç»“æŸæ—¶æ‰§è¡Œçš„ä»£ç ã€‚ END ä¹Ÿæ˜¯ AWK çš„å…³é”®å­—ï¼Œå®ƒä¹Ÿå¿…é¡»å¤§å†™ã€‚ ä¸å¼€å§‹å—ç›¸ä¼¼ï¼Œç»“æŸå—ä¹Ÿæ˜¯å¯é€‰çš„ã€‚ å‘½ä»¤å½¢å¼ 1awk [-F|-f|-v] â€˜BEGIN{} //{command1; command2} END{}â€™ file [-F|-f|-v] å¤§å‚æ•°ï¼Œ-FæŒ‡å®šåˆ†éš”ç¬¦ï¼Œ-fè°ƒç”¨è„šæœ¬ï¼Œ-vå®šä¹‰å˜é‡ var=value ' ' å¼•ç”¨ä»£ç å— BEGIN åˆå§‹åŒ–ä»£ç å—ï¼Œåœ¨å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†ä¹‹å‰ï¼Œåˆå§‹åŒ–ä»£ç ï¼Œä¸»è¦æ˜¯å¼•ç”¨å…¨å±€å˜é‡ï¼Œè®¾ç½®FSåˆ†éš”ç¬¦ // åŒ¹é…ä»£ç å—ï¼Œå¯ä»¥æ˜¯å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ {} å‘½ä»¤ä»£ç å—ï¼ŒåŒ…å«ä¸€æ¡æˆ–å¤šæ¡å‘½ä»¤ ï¼› å¤šæ¡å‘½ä»¤ä½¿ç”¨åˆ†å·åˆ†éš” END ç»“å°¾ä»£ç å—ï¼Œåœ¨å¯¹æ¯ä¸€è¡Œè¿›è¡Œå¤„ç†ä¹‹åå†æ‰§è¡Œçš„ä»£ç å—ï¼Œä¸»è¦æ˜¯è¿›è¡Œæœ€ç»ˆè®¡ç®—æˆ–è¾“å‡ºç»“å°¾æ‘˜è¦ä¿¡æ¯ ç‰¹æ®Šè¦ç‚¹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243$0 è¡¨ç¤ºæ•´ä¸ªå½“å‰è¡Œ$1 æ¯è¡Œç¬¬ä¸€ä¸ªå­—æ®µNF å­—æ®µæ•°é‡å˜é‡NR æ¯è¡Œçš„è®°å½•å·ï¼Œå¤šæ–‡ä»¶è®°å½•é€’å¢FNR ä¸NRç±»ä¼¼ï¼Œä¸è¿‡å¤šæ–‡ä»¶è®°å½•ä¸é€’å¢ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½ä»1å¼€å§‹\t åˆ¶è¡¨ç¬¦\n æ¢è¡Œç¬¦FS BEGINæ—¶å®šä¹‰åˆ†éš”ç¬¦RS è¾“å…¥çš„è®°å½•åˆ†éš”ç¬¦ï¼Œ é»˜è®¤ä¸ºæ¢è¡Œç¬¦(å³æ–‡æœ¬æ˜¯æŒ‰ä¸€è¡Œä¸€è¡Œè¾“å…¥)~ åŒ¹é…ï¼Œä¸==ç›¸æ¯”ä¸æ˜¯ç²¾ç¡®æ¯”è¾ƒ!~ ä¸åŒ¹é…ï¼Œä¸ç²¾ç¡®æ¯”è¾ƒ== ç­‰äºï¼Œå¿…é¡»å…¨éƒ¨ç›¸ç­‰ï¼Œç²¾ç¡®æ¯”è¾ƒ!= ä¸ç­‰äºï¼Œç²¾ç¡®æ¯”è¾ƒ&amp;&amp; é€»è¾‘ä¸|| é€»è¾‘æˆ–+ åŒ¹é…æ—¶è¡¨ç¤º1ä¸ªæˆ–1ä¸ªä»¥ä¸Š/[0-9][0-9]+/ ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šæ•°å­—/[0-9][0-9]*/ ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šæ•°å­—FILENAME æ–‡ä»¶åOFS è¾“å‡ºå­—æ®µåˆ†éš”ç¬¦ï¼Œ é»˜è®¤ä¹Ÿæ˜¯ç©ºæ ¼ï¼Œå¯ä»¥æ”¹ä¸ºåˆ¶è¡¨ç¬¦ç­‰ORS è¾“å‡ºçš„è®°å½•åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºæ¢è¡Œç¬¦,å³å¤„ç†ç»“æœä¹Ÿæ˜¯ä¸€è¡Œä¸€è¡Œè¾“å‡ºåˆ°å±å¹•-F'[:#/]' å®šä¹‰ä¸‰ä¸ªåˆ†éš”ç¬¦ æµ‹è¯•å‘½ä»¤ï¼š 1awk 'BEGIN{FS=""}{for(i=1;i&lt;=NF;i++) {if (i==NF){print $i}else {printf $i};system("sleep 0.03")}}' /etc/fstab awkæ˜¾ç¤ºæ–‡ä»¶ä¸­çš„å†…å®¹ &lt;div class="note info no-icon"&gt;&lt;p&gt;awkæ˜¾ç¤ºpasswdä¸­çš„å†…å®¹ï¼Œå¹¶ä¸”è®¾ç½®åªæ˜¾ç¤ºå‰é¢5æ¡ä¿¡æ¯ã€‚&lt;/p&gt;&lt;/div&gt; awkå°†passwdä¸­çš„å†…å®¹ä»¥å†’å·ä¸ºåˆ†éš”ï¼Œå¹¶å–å‡ºç¬¬1ï¼Œ3ï¼Œ6ä½çš„æ•°æ® awkå°†passwdä¸­çš„å†…å®¹ä»¥å†’å·ä¸ºåˆ†éš”ï¼Œå¹¶å–å‡ºç¬¬1ï¼Œ3ï¼Œ6ä½çš„æ•°æ®ï¼Œå¹¶ç”¨é‡‡ç”¨tabé”®ä½œä¸ºåˆ†éš”ç¬¦ awkä»¥å†’å·ä¸ºåˆ†éš”ç¬¦ï¼Œæ˜¾ç¤ºä¸€è¡Œä¸­æœ‰å¤šå°‘å­—æ®µ awkå°†æ¯ä¸€è¡Œæœ€åçš„ä¸€ä¸ªå­—æ®µæ˜¾ç¤ºå‡ºæ¥ awkåœ¨æ¯ä¸€è¡Œå‰é¢è¾“å‡ºè¡Œå· awkæ˜¾ç¤ºç¬¬å‡ è¡Œçš„æ•°æ® ç»Ÿè®¡æ—¥å¿—æ–‡ä»¶ä¸­æ¯å°æ—¶çš„è¯·æ±‚æ¬¡æ•° 1awk -F: '{a[$2]++}END{for(i in a){split(i,t);print i" è‡³",t[1]":"t[2]+59," è®¿é—® "a[i] " æ¬¡" | "sort -t: -k1n -k2n"}}' xxx.xxxx.com_access.log-20190512 ç»Ÿè®¡æ—¥å¿—æ–‡ä»¶ä¸­æ¯å°æ—¶æŒ‡å®šè¯·æ±‚å¼€å¤´çš„è¯·æ±‚æ¬¡æ•° 1grep "2019-05-13T23" xxxx.xxxx.com_access.log-20190512|grep "/pppppp"|wc -l æŸ¥javaè¿›ç¨‹ID 1ps -ef|grep java |grep -v java |awk '{print $2}' æ¡ä»¶è¯­å¥ IFè¯­å¥ IF æ¡ä»¶è¯­å¥è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 12if (condition) action ä¹Ÿå¯ä»¥ä½¿ç”¨èŠ±æ‹¬å·æ¥æ‰§è¡Œä¸€ç»„æ“ä½œï¼š 12345678if (condition){ action-1 action-1 . . action-n} ä»¥ä¸‹å®ä¾‹ç”¨æ¥åˆ¤æ–­æ•°å­—æ˜¯å¥‡æ•°è¿˜æ˜¯å¶æ•°ï¼š 1awk 'BEGIN {num = 10; if (num % 2 == 0) printf "%d æ˜¯å¶æ•°\n", num }' IF - ELSE è¯­å¥ IF - ELSE æ¡ä»¶è¯­å¥è¯­æ³•æ ¼å¼å¦‚ä¸‹ï¼š 1234if (condition) action-1else action-2 åœ¨æ¡ä»¶è¯­å¥ condition ä¸º true æ—¶åªéœ€ action-1ï¼Œå¦åˆ™æ‰§è¡Œ action-2ã€‚ 12345awk 'BEGIN { num = 11; if (num % 2 == 0) printf "%d æ˜¯å¶æ•°\n", num; else printf "%d æ˜¯å¥‡æ•°\n", num }' IF - ELSE - IF å¯ä»¥åˆ›å»ºå¤šä¸ª IF - ELSE æ ¼å¼çš„åˆ¤æ–­è¯­å¥æ¥å®ç°å¤šä¸ªæ¡ä»¶çš„åˆ¤æ–­ï¼š 123456789awk 'BEGIN {a=30;if (a==10) print "a = 10";else if (a == 20) print "a = 20";else if (a == 30) print "a = 30";}' å¾ªç¯è¯­å¥ Forå¾ªç¯ For å¾ªç¯çš„è¯­æ³•å¦‚ä¸‹ï¼š 12for (initialisation; condition; increment/decrement) action for è¯­å¥é¦–å…ˆæ‰§è¡Œåˆå§‹åŒ–åŠ¨ä½œ( initialisation )ï¼Œç„¶åå†æ£€æŸ¥æ¡ä»¶( condition )ã€‚ å¦‚æœæ¡ä»¶ä¸ºçœŸï¼Œåˆ™æ‰§è¡ŒåŠ¨ä½œ( action )ï¼Œç„¶åæ‰§è¡Œé€’å¢( increment )æˆ–è€…é€’å‡( decrement )æ“ä½œã€‚ åªè¦æ¡ä»¶ä¸º true å¾ªç¯å°±ä¼šä¸€ç›´æ‰§è¡Œã€‚æ¯æ¬¡å¾ªç¯ç»“æŸéƒ½ä¼šè¿›æ¡ä»¶æ£€æŸ¥ï¼Œè‹¥æ¡ä»¶ä¸º false åˆ™ç»“æŸå¾ªç¯ã€‚ ä¸‹é¢çš„ä¾‹å­ä½¿ç”¨ For å¾ªç¯è¾“å‡ºæ•°å­— 1 è‡³ 5ï¼š 1awk 'BEGIN { for (i = 1; i &lt;= 5; ++i) print i }' Whileå¾ªç¯ While å¾ªç¯çš„è¯­æ³•å¦‚ä¸‹ï¼š 12while (condition) action While å¾ªç¯é¦–å…ˆæ£€æŸ¥æ¡ä»¶ condition æ˜¯å¦ä¸º true ï¼Œè‹¥æ¡ä»¶ä¸º true åˆ™æ‰§è¡ŒåŠ¨ä½œ actionã€‚æ­¤è¿‡ç¨‹ä¸€ç›´é‡å¤ç›´åˆ°æ¡ä»¶ condition ä¸º flase æ‰åœæ­¢ã€‚ ä¸‹é¢æ˜¯ä½¿ç”¨ While å¾ªç¯è¾“å‡ºæ•°å­— 1 åˆ° 5 çš„ä¾‹å­ï¼š 1awk 'BEGIN {i = 1; while (i &lt; 6) { print i; ++i } }' Break ç»ˆæ­¢å¾ªç¯ åœ¨ä¸‹é¢çš„ç¤ºä¾‹å­ä¸­ï¼Œå½“è®¡ç®—çš„å’Œå¤§äº 50 çš„æ—¶å€™ä½¿ç”¨ break ç»“æŸå¾ªç¯ï¼š 12345awk 'BEGIN { sum = 0; for (i = 0; i &lt; 20; ++i) { sum += i; if (sum &gt; 50) break; else print "Sum =", sum } }' Continue ç»“æŸæœ¬æ¬¡å¾ªç¯è¿›å…¥ä¸‹æ¬¡å¾ªç¯ Continue è¯­å¥ç”¨äºåœ¨å¾ªç¯ä½“å†…éƒ¨ç»“æŸæœ¬æ¬¡å¾ªç¯ï¼Œä»è€Œç›´æ¥è¿›å…¥ä¸‹ä¸€æ¬¡å¾ªç¯è¿­ä»£ã€‚ ä¸‹é¢çš„ä¾‹å­è¾“å‡º 1 åˆ° 20 ä¹‹é—´çš„å¶æ•°ï¼š 1awk 'BEGIN {for (i = 1; i &lt;= 20; ++i) {if (i % 2 == 0) print i ; else continue} }' Exit ç»“æŸç¨‹åº è¯¥å‡½æ•°æ¥å—ä¸€ä¸ªæ•´æ•°ä½œä¸ºå‚æ•°è¡¨ç¤º AWK è¿›ç¨‹ç»“æŸçŠ¶æ€ã€‚ å¦‚æœæ²¡æœ‰æä¾›è¯¥å‚æ•°ï¼Œå…¶é»˜è®¤çŠ¶æ€ä¸º 0ã€‚ ä¸‹é¢ä¾‹å­ä¸­å½“å’Œå¤§äº 50 æ—¶ç»“æŸ AWK ç¨‹åºã€‚ 12345awk 'BEGIN { sum = 0; for (i = 0; i &lt; 20; ++i) { sum += i; if (sum &gt; 50) exit(10); else print "Sum =", sum } }' document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å¤–è§‚æ¨¡å¼]]></title>
    <url>%2Fposts%2F6f592ef9.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å¤–è§‚æ¨¡å¼ï¼Œåˆç§°ä¸ºé—¨é¢æ¨¡å¼ï¼Œæ˜¯ä¸€ç§ä½¿ç”¨é¢‘ç‡éå¸¸é«˜çš„ç»“æ„å‹è®¾è®¡æ¨¡å¼ï¼Œæ˜¯è¿ªç±³ç‰¹æ³•åˆ™çš„ä¸€ç§å…·ä½“å®ç°ï¼Œå®ƒé€šè¿‡å¼•å…¥ä¸€ä¸ªå¤–è§‚è§’è‰²æ¥ç®€åŒ–å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿä¹‹é—´çš„äº¤äº’ï¼Œä¸ºå¤æ‚çš„å­ç³»ç»Ÿè°ƒç”¨æä¾›ä¸€ä¸ªç»Ÿä¸€çš„å…¥å£ï¼Œé™ä½å­ç³»ç»Ÿä¸å®¢æˆ·ç«¯çš„è€¦åˆåº¦ï¼Œä¸”å®¢æˆ·ç«¯è°ƒç”¨éå¸¸æ–¹ä¾¿ã€‚å¦‚ä¸‹å›¾ï¼š ä¸¾ä¸ªä¾‹å­ï¼šå¦‚ç½‘ç«™å¯¼èˆª ä¸»è¦ä½œç”¨ å®ç°å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿç±»çš„æ¾è€¦åˆï¼› é™ä½åŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦ï¼› æé«˜äº†å®¢æˆ·ç«¯ä½¿ç”¨çš„ä¾¿æ·æ€§ï¼Œä½¿å¾—å®¢æˆ·ç«¯æ— é¡»å…³å¿ƒå­ç³»ç»Ÿçš„å·¥ä½œç»†èŠ‚ï¼Œé€šè¿‡å¤–è§‚è§’è‰²å³å¯è°ƒç”¨ç›¸å…³åŠŸèƒ½ã€‚ UMLç±»å›¾ è§’è‰² å¤–è§‚è§’è‰²ï¼ˆFacadeï¼‰ï¼šä¹Ÿç§° é—¨é¢è§’è‰²ï¼Œç³»ç»Ÿå¯¹å¤–çš„ç»Ÿä¸€æ¥å£ï¼› å­ç³»ç»Ÿè§’è‰²ï¼ˆSubSystemï¼‰ï¼šå¯ä»¥åŒæ—¶æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª SubSystemã€‚æ¯ä¸ª SubSytem éƒ½ä¸æ˜¯ä¸€ä¸ªå•ç‹¬çš„ç±»ï¼Œè€Œæ˜¯ä¸€ä¸ªç±»çš„é›†åˆã€‚SubSystem å¹¶ä¸çŸ¥é“ Facade çš„å­˜åœ¨ï¼Œå¯¹äº SubSystem è€Œè¨€ï¼ŒFacade åªæ˜¯å¦ä¸€ä¸ªå®¢æˆ·ç«¯è€Œå·²ï¼ˆå³ Facade å¯¹ SubSystem é€æ˜ï¼‰ã€‚ å¤–è§‚æ¨¡å¼çš„ç›®çš„ä¸æ˜¯ç»™äºˆå­ç³»ç»Ÿæ·»åŠ æ–°çš„åŠŸèƒ½æ¥å£ï¼Œè€Œæ˜¯ä¸ºäº†è®©å¤–éƒ¨å‡å°‘ä¸å­ç³»ç»Ÿå†…å¤šä¸ªæ¨¡å—çš„äº¤äº’ï¼Œæ¾æ•£è€¦åˆï¼Œä»è€Œè®©å¤–éƒ¨èƒ½å¤Ÿæ›´ç®€å•åœ°ä½¿ç”¨å­ç³»ç»Ÿã€‚ å¤–è§‚æ¨¡å¼çš„æœ¬è´¨æ˜¯ï¼šå°è£…äº¤äº’ï¼Œç®€åŒ–è°ƒç”¨ã€‚ æ¨¡å¼ä¼˜ç‚¹ é™ä½äº†å®¢æˆ·ç±»ä¸å­ç³»ç»Ÿç±»çš„è€¦åˆåº¦ï¼Œå®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼› åªæ˜¯æä¾›äº†ä¸€ä¸ªè®¿é—®å­ç³»ç»Ÿçš„ç»Ÿä¸€å…¥å£ï¼Œå¹¶ä¸å½±å“ç”¨æˆ·ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼› å‡å°‘äº†ä¸å­ç³»ç»Ÿçš„å…³è”å¯¹è±¡ï¼Œå®ç°äº†å­ç³»ç»Ÿä¸å®¢æˆ·ä¹‹é—´çš„æ¾è€¦åˆå…³ç³»ï¼Œæ¾è€¦åˆä½¿å¾—å­ç³»ç»Ÿçš„ç»„ä»¶å˜åŒ–ä¸ä¼šå½±å“åˆ°å®ƒçš„å®¢æˆ·ã€‚ å¤–è§‚æ¨¡å¼å¯¹å®¢æˆ·å±è”½äº†å­ç³»ç»Ÿç»„ä»¶ï¼Œä»è€Œç®€åŒ–äº†æ¥å£ï¼Œå‡å°‘äº†å®¢æˆ·å¤„ç†çš„å¯¹è±¡æ•°ç›®å¹¶ä½¿å­ç³»ç»Ÿçš„ä½¿ç”¨æ›´åŠ ç®€å•ã€‚ å¼•å…¥å¤–è§‚è§’è‰²ä¹‹åï¼Œç”¨æˆ·åªéœ€è¦ä¸å¤–è§‚è§’è‰²äº¤äº’ï¼› ç”¨æˆ·ä¸å­ç³»ç»Ÿä¹‹é—´çš„å¤æ‚é€»è¾‘å…³ç³»ç”±å¤–è§‚è§’è‰²æ¥å®ç°ã€‚ é™ä½åŸæœ‰ç³»ç»Ÿçš„å¤æ‚åº¦å’Œç³»ç»Ÿä¸­çš„ç¼–è¯‘ä¾èµ–æ€§ï¼Œå¹¶ç®€åŒ–äº†ç³»ç»Ÿåœ¨ä¸åŒå¹³å°ä¹‹é—´çš„ç§»æ¤è¿‡ç¨‹ã€‚ å› ä¸ºç¼–è¯‘ä¸€ä¸ªå­ç³»ç»Ÿä¸€èˆ¬ä¸éœ€è¦ç¼–è¯‘æ‰€æœ‰å…¶ä»–çš„å­ç³»ç»Ÿã€‚ä¸€ä¸ªå­ç³»ç»Ÿçš„ä¿®æ”¹å¯¹å…¶ä»–å­ç³»ç»Ÿæ²¡æœ‰ä»»ä½•å½±å“ï¼Œè€Œä¸”å­ç³»ç»Ÿå†…éƒ¨å˜åŒ–ä¹Ÿä¸ä¼šå½±å“åˆ°å¤–è§‚å¯¹è±¡ã€‚ æ¨¡å¼ç¼ºç‚¹ ä¸èƒ½å¾ˆå¥½åœ°é™åˆ¶å®¢æˆ·ç«¯ç›´æ¥ä½¿ç”¨å­ç³»ç»Ÿç±»ï¼Œå¦‚æœå¯¹å®¢æˆ·ç«¯è®¿é—®å­ç³»ç»Ÿç±»åšå¤ªå¤šçš„é™åˆ¶åˆ™å‡å°‘äº†å¯å˜æ€§å’Œçµæ´»æ€§ã€‚ åœ¨ä¸å¼•å…¥æŠ½è±¡å¤–è§‚ç±»çš„æƒ…å†µä¸‹ï¼Œå¢åŠ æ–°çš„å­ç³»ç»Ÿå¯èƒ½éœ€è¦ä¿®æ”¹å¤–è§‚ç±»æˆ–å®¢æˆ·ç«¯çš„æºä»£ç ï¼Œè¿èƒŒäº†â€œå¼€é—­åŸåˆ™â€ã€‚ é€‚ç”¨åœºæ™¯ ä¸ºä¸€ä¸ªå¤æ‚çš„æ¨¡å—æˆ–å­ç³»ç»Ÿæä¾›ä¸€ä¸ªç®€æ´çš„ä¾›å¤–ç•Œè®¿é—®çš„æ¥å£ï¼› å¸Œæœ›æé«˜å­ç³»ç»Ÿçš„ç‹¬ç«‹æ€§æ—¶ï¼› é¢„é˜²ä»£ç æ±¡æŸ“ï¼šå½“å­ç³»ç»Ÿç”±äºä¸å¯é¿å…çš„æš‚æ—¶åŸå› å¯¼è‡´å¯èƒ½å­˜åœ¨ bug æˆ–æ€§èƒ½ç›¸å…³é—®é¢˜æ—¶ï¼Œå¯ä»¥é€šè¿‡ å¤–è§‚æ¨¡å¼ æä¾›ä¸€ä¸ªé«˜å±‚æ¥å£ï¼Œéš”ç¦»å®¢æˆ·ç«¯ä¸å­ç³»ç»Ÿçš„ç›´æ¥äº¤äº’ï¼Œæ–¹ä¾¿åç»­é—®é¢˜ä¿®æ”¹ï¼› åœ¨å±‚æ¬¡åŒ–ç»“æ„ä¸­ï¼Œå¯ä»¥ä½¿ç”¨å¤–è§‚æ¨¡å¼å®šä¹‰ç³»ç»Ÿä¸­æ¯ä¸€å±‚çš„å…¥å£ï¼Œå±‚ä¸å±‚ä¹‹é—´ä¸ç›´æ¥äº§ç”Ÿè”ç³»ï¼Œè€Œé€šè¿‡å¤–è§‚ç±»å»ºç«‹è”ç³»ï¼Œé™ä½å±‚ä¹‹é—´çš„è€¦åˆåº¦ã€‚ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºå¤–è§‚è§’è‰² 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å¤–è§‚è§’è‰²Facade */public class Facade { /** * å­ç³»ç»ŸA */ private SubSystemA a = new SubSystemA(); /** * å­ç³»ç»ŸB */ private SubSystemB b = new SubSystemB(); /** * å­ç³»ç»ŸC */ private SubSystemC c = new SubSystemC(); // å¯¹å¤–æ¥å£ public void doA() { this.a.doA(); } // å¯¹å¤–æ¥å£ public void doB() { this.b.doB(); } // å¯¹å¤–æ¥å£ public void doC() { this.c.doC(); }} åˆ›å»ºå­ç³»ç»Ÿ 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸA */public class SubSystemA { public void doA() { System.out.println("å¤„ç†Aç³»ç»Ÿçš„ä¸šåŠ¡..."); }}package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸB */public class SubSystemB { public void doB() { System.out.println("å¤„ç†Bç³»ç»Ÿçš„ä¸šåŠ¡..."); }}package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å­ç³»ç»ŸC */public class SubSystemC { public void doC() { System.out.println("å¤„ç†Cç³»ç»Ÿçš„ä¸šåŠ¡..."); }} æµ‹è¯•ç±» 1234567891011121314package main.java.com.study.designPatterns.facade.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { Facade facade = new Facade(); facade.doA(); facade.doB(); facade.doC(); }} ä¸é€‚é…æ¨¡å¼çš„åŒºåˆ« å¤–è§‚æ¨¡å¼çš„å®ç°æ ¸å¿ƒä¸»è¦æ˜¯â€”â€”ç”±å¤–è§‚ç±»å»ä¿å­˜å„ä¸ªå­ç³»ç»Ÿçš„å¼•ç”¨ï¼Œå®ç°ç”±ä¸€ä¸ªç»Ÿä¸€çš„å¤–è§‚ç±»å»åŒ…è£…å¤šä¸ªå­ç³»ç»Ÿç±»ï¼Œç„¶è€Œå®¢æˆ·ç«¯åªéœ€è¦å¼•ç”¨è¿™ä¸ªå¤–è§‚ç±»ï¼Œç„¶åç”±å¤–è§‚ç±»æ¥è°ƒç”¨å„ä¸ªå­ç³»ç»Ÿä¸­çš„æ–¹æ³•ã€‚ è¿™æ ·çš„å®ç°æ–¹å¼éå¸¸ç±»ä¼¼é€‚é…å™¨æ¨¡å¼ï¼Œç„¶è€Œå¤–è§‚æ¨¡å¼ä¸é€‚é…å™¨æ¨¡å¼ä¸åŒçš„æ˜¯ï¼šé€‚é…å™¨æ¨¡å¼æ˜¯å°†ä¸€ä¸ªå¯¹è±¡åŒ…è£…èµ·æ¥ä»¥æ”¹å˜å…¶æ¥å£ï¼Œè€Œå¤–è§‚æ˜¯å°†ä¸€ç¾¤å¯¹è±¡ â€åŒ…è£…â€œèµ·æ¥ä»¥ç®€åŒ–å…¶æ¥å£ã€‚å®ƒä»¬çš„æ„å›¾æ˜¯ä¸ä¸€æ ·çš„ï¼Œé€‚é…å™¨æ˜¯å°†æ¥å£è½¬æ¢ä¸ºä¸åŒæ¥å£ï¼Œè€Œå¤–è§‚æ¨¡å¼æ˜¯æä¾›ä¸€ä¸ªç»Ÿä¸€çš„æ¥å£æ¥ç®€åŒ–æ¥å£ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¡ç®—æœºç½‘ç»œåŸºç¡€å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fb2437d15.html</url>
    <content type="text"><![CDATA[è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„ ä½“ç³»ä»‹ç» è®¡ç®—æœºç½‘ç»œä½“ç³»ç»“æ„åˆ†ä¸º3ç§ï¼šOSIä½“ç³»ç»“æ„ã€TCP / IPä½“ç³»ç»“æ„ã€äº”å±‚ä½“ç³»ç»“æ„ ä½ä¸‰å±‚ä¸ºé€šä¿¡å­ç½‘ï¼Œè´Ÿè´£æ•°æ®ä¼ è¾“ï¼› é«˜ä¸‰å±‚ä¸ºèµ„æºå­ç½‘ï¼Œç›¸å½“äºè®¡ç®—æœºç³»ç»Ÿï¼Œå®Œæˆæ•°æ®å¤„ç†ï¼› ä¼ è¾“å±‚æ‰¿ä¸Šå¯ä¸‹ï¼› TCP/IPä½“ç³»ç»“æ„è¯¦ä»‹ OSIä½“ç³»ç»“æ„è¯¦ä»‹ TCP åè®® å®šä¹‰ Transmission Control Protocolï¼Œå³ ä¼ è¾“æ§åˆ¶åè®®ï¼Œå±äºä¼ è¾“å±‚é€šä¿¡åè®®ï¼ŒåŸºäºTCPçš„åº”ç”¨å±‚åè®®æœ‰HTTPã€SMTPã€FTPã€Telnet å’Œ POP3ã€‚ ç‰¹ç‚¹ é¢å‘è¿æ¥ï¼šä½¿ç”¨TCPä¼ è¾“æ•°æ®å‰ï¼Œå¿…é¡»å…ˆå»ºç«‹TCPè¿æ¥ï¼›ä¼ è¾“å®Œæˆåå†é‡Šæ”¾è¿æ¥ã€‚ å…¨åŒå·¥é€šä¿¡ï¼šå»ºç«‹TCPè¿æ¥åï¼Œé€šä¿¡åŒæ–¹éƒ½èƒ½å‘é€æ•°æ®ã€‚ å¯é ï¼šé€šè¿‡TCPè¿æ¥ä¼ é€æ•°æ®ï¼šä¸ä¸¢å¤±ã€æ— å·®é”™ã€ä¸é‡å¤ã€æŒ‰åºåˆ°è¾¾ã€‚ é¢å‘å­—èŠ‚æµï¼šæ•°æ®ä»¥æµçš„å½¢å¼è¿›è¡Œä¼ è¾“ã€‚ æŠ¥æ–‡æ®µæ ¼å¼ æŠ¥æ–‡æ®µ = é¦–éƒ¨ + æ•°æ® 2éƒ¨åˆ† ä¸‹é¢åˆ†åˆ«å¯¹å…¶ä¸­çš„å­—æ®µè¿›è¡Œä»‹ç»ï¼š æºç«¯å£å’Œç›®çš„ç«¯å£ï¼šå„å 2ä¸ªå­—èŠ‚ï¼Œè¿™ä¸¤ä¸ªå€¼åŠ ä¸ŠIPé¦–éƒ¨ä¸­çš„æºç«¯IPåœ°å€å’Œç›®çš„ç«¯IPåœ°å€å”¯ä¸€ç¡®å®šä¸€ä¸ªTCPè¿æ¥ã€‚æœ‰æ—¶ä¸€ä¸ªIPåœ°å€å’Œä¸€ä¸ªç«¯å£å·ä¹Ÿç§°ä¸ºsocketï¼ˆæ’å£ï¼‰ã€‚åºå·ï¼šå 4ä¸ªå­—èŠ‚ï¼Œæ˜¯æœ¬æŠ¥æ–‡æ®µæ‰€å‘é€çš„æ•°æ®é¡¹ç›®ç»„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚åœ¨TCPä¼ é€çš„æ•°æ®æµä¸­ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰ä¸€ä¸ªåºå·ã€‚ä¾‹å¦‚ï¼Œä¸€æŠ¥æ–‡æ®µçš„åºå·ä¸º300ï¼Œè€Œä¸”æ•°æ®å…±100å­—èŠ‚ï¼Œåˆ™ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·å°±æ˜¯400ï¼›åºå·æ˜¯32bitçš„æ— ç¬¦å·æ•°ï¼Œåºå·åˆ°è¾¾2^32-1åä»0å¼€å§‹ã€‚ï¼ˆæ³¨ï¼šå¦‚ä½•é˜²æ­¢ä»0å¼€å§‹ååºå·ç›¸åŒçš„é—®é¢˜ï¼‰ç¡®è®¤åºå·ï¼šå 4å­—èŠ‚ï¼Œæ˜¯æœŸæœ›æ”¶åˆ°å¯¹æ–¹ä¸‹æ¬¡å‘é€çš„æ•°æ®çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼Œä¹Ÿå°±æ˜¯æœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªæŠ¥æ–‡æ®µçš„é¦–éƒ¨ä¸­çš„åºå·ï¼›ç¡®è®¤åºå·åº”è¯¥æ˜¯ä¸Šæ¬¡å·²æˆåŠŸæ”¶åˆ°æ•°æ®å­—èŠ‚åºå·+1ã€‚åªæœ‰ACKæ ‡å¿—ä¸º1æ—¶ï¼Œç¡®è®¤åºå·æ‰æœ‰æ•ˆã€‚æ•°æ®åç§»ï¼šå 4æ¯”ç‰¹ï¼Œè¡¨ç¤ºæ•°æ®å¼€å§‹çš„åœ°æ–¹ç¦»TCPæ®µçš„èµ·å§‹å¤„æœ‰å¤šè¿œã€‚å®é™…ä¸Šå°±æ˜¯TCPæ®µé¦–éƒ¨çš„é•¿åº¦ã€‚ç”±äºé¦–éƒ¨é•¿åº¦ä¸å›ºå®šï¼Œå› æ­¤æ•°æ®åç§»å­—æ®µæ˜¯å¿…è¦çš„ã€‚æ•°æ®åç§»ä»¥32ä½ä¸ºé•¿åº¦å•ä½ï¼Œä¹Ÿå°±æ˜¯4ä¸ªå­—èŠ‚ï¼Œå› æ­¤TCPé¦–éƒ¨çš„æœ€å¤§é•¿åº¦æ˜¯60ä¸ªå­—èŠ‚ã€‚å³åç§»æœ€å¤§ä¸º15ä¸ªé•¿åº¦å•ä½=1532ä½=154å­—èŠ‚ã€‚ä¿ç•™ï¼š 6æ¯”ç‰¹ï¼Œä¾›ä»¥ååº”ç”¨ï¼Œç°åœ¨ç½®ä¸º0ã€‚6ä¸ªæ ‡å¿—ä½æ¯”ç‰¹ï¼šURGï¼šå½“URG=1æ—¶ï¼Œæ³¨è§£æ­¤æŠ¥æ–‡åº”å°½å¿«ä¼ é€ï¼Œè€Œä¸è¦æŒ‰æœ¬æ¥çš„åˆ—é˜Ÿæ¬¡åºæ¥ä¼ é€ã€‚ä¸â€œç´§æ€¥æŒ‡é’ˆâ€å­—æ®µå…±åŒåº”ç”¨ï¼Œç´§æ€¥æŒ‡é’ˆæŒ‡å‡ºåœ¨æœ¬æŠ¥æ–‡æ®µä¸­çš„ç´§æ€¥æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·ï¼Œä½¿æ¥ç®¡æ–¹å¯ä»¥çŸ¥é“ç´§æ€¥æ•°æ®å…±æœ‰å¤šé•¿ï¼›ACKï¼šåªæœ‰å½“ACK=1æ—¶ï¼Œç¡®è®¤åºå·å­—æ®µæ‰æœ‰æ•ˆï¼›PSHï¼šå½“PSH=1æ—¶ï¼Œæ¥æ”¶æ–¹åº”è¯¥å°½å¿«å°†æœ¬æŠ¥æ–‡æ®µç«‹å³ä¼ é€ç»™å…¶åº”ç”¨å±‚ï¼›RSTï¼šå½“RST=1æ—¶ï¼Œè¡¨ç¤ºå‡ºç°è¿æ¥é”™è¯¯ï¼Œå¿…é¡»é‡Šæ”¾è¿æ¥ï¼Œç„¶åå†é‡å»ºä¼ è¾“è¿æ¥ã€‚å¤ä½æ¯”ç‰¹è¿˜ç”¨æ¥æ‹’ç»ä¸€ä¸ªä¸æ³•çš„æŠ¥æ–‡æ®µæˆ–æ‹’ç»æ‰“å¼€ä¸€ä¸ªè¿æ¥ï¼›SYNï¼šSYN=1,ACK=0æ—¶è¡¨ç¤ºè¯·æ±‚å»ºç«‹ä¸€ä¸ªè¿æ¥ï¼Œæºå¸¦SYNæ ‡å¿—çš„TCPæŠ¥æ–‡æ®µä¸ºåŒæ­¥æŠ¥æ–‡æ®µï¼›FINï¼šå‘ç«¯å®Œæˆå‘é€ä»»åŠ¡ã€‚çª—å£ï¼šTCPé€šè¿‡æ»‘åŠ¨çª—å£çš„æ¦‚å¿µæ¥è¿›è¡Œæµé‡æ§åˆ¶ã€‚è®¾æƒ³åœ¨å‘é€ç«¯å‘é€æ•°æ®çš„é€Ÿåº¦å¾ˆå¿«è€Œæ¥æ”¶ç«¯æ¥æ”¶é€Ÿåº¦å´å¾ˆæ…¢çš„æƒ…å†µä¸‹ï¼Œä¸ºäº†ä¿è¯æ•°æ®ä¸ä¸¢å¤±ï¼Œæ˜¾ç„¶éœ€è¦è¿›è¡Œæµé‡æ§åˆ¶ï¼Œ åè°ƒå¥½é€šä¿¡åŒæ–¹çš„å·¥ä½œèŠ‚å¥ã€‚æ‰€è°“æ»‘åŠ¨çª—å£ï¼Œå¯ä»¥ç†è§£æˆæ¥æ”¶ç«¯æ‰€èƒ½æä¾›çš„ç¼“å†²åŒºå¤§å°ã€‚TCPåˆ©ç”¨ä¸€ä¸ªæ»‘åŠ¨çš„çª—å£æ¥å‘Šè¯‰å‘é€ç«¯å¯¹å®ƒæ‰€å‘é€çš„æ•°æ®èƒ½æä¾›å¤šå¤§çš„ç¼“å†²åŒºã€‚çª—å£å¤§å°ä¸ºå­—èŠ‚æ•°ï¼Œèµ·å§‹äºç¡®è®¤åºå·å­—æ®µæŒ‡æ˜çš„å€¼ï¼ˆè¿™ä¸ªå€¼æ˜¯æ¥æ”¶ç«¯æ­£æœŸæœ›æ¥æ”¶çš„å­—èŠ‚ï¼‰ã€‚çª—å£å¤§å°æ˜¯ä¸€ä¸ª16bitå­—æ®µï¼Œå› è€Œçª—å£å¤§å°æœ€å¤§ä¸º65535å­—èŠ‚ã€‚æ£€éªŒå’Œï¼šæ£€éªŒå’Œè¦†ç›–äº†æ•´ä¸ªTCPæŠ¥æ–‡æ®µï¼šTCPé¦–éƒ¨å’Œæ•°æ®ã€‚è¿™æ˜¯ä¸€ä¸ªå¼ºåˆ¶æ€§çš„å­—æ®µï¼Œä¸€å®šæ˜¯ç”±å‘ç«¯è®¡ç®—å’Œå­˜å‚¨ï¼Œå¹¶ç”±æ”¶ç«¯è¿›è¡ŒéªŒè¯ã€‚ç´§æ€¥æŒ‡é’ˆï¼šåªæœ‰å½“URGæ ‡å¿—ç½®1æ—¶ç´§æ€¥æŒ‡é’ˆæ‰æœ‰æ•ˆã€‚ç´§æ€¥æŒ‡é’ˆæ˜¯ä¸€ä¸ªæ­£çš„åç§»é‡ï¼Œå’Œåºå·å­—æ®µä¸­çš„å€¼ç›¸åŠ è¡¨ç¤ºç´§æ€¥æ•°æ®æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·ã€‚ å»ºç«‹è¿æ¥-ä¸‰æ¬¡æ¡æ‰‹ è¿‡ç¨‹è¯´æ˜ï¼š å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘å‡ºè¿æ¥è¯·æ±‚æŠ¥æ–‡ï¼Œè¿™æ—¶æŠ¥æ–‡é¦–éƒ¨ä¸­çš„åŒéƒ¨ä½SYN=1ï¼ŒåŒæ—¶é€‰æ‹©ä¸€ä¸ªåˆå§‹åºåˆ—å· Seq=X ï¼Œæ­¤æ—¶ï¼ŒTCPå®¢æˆ·ç«¯è¿›ç¨‹è¿›å…¥äº† SYN-SENTï¼ˆåŒæ­¥å·²å‘é€çŠ¶æ€ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒSYNæŠ¥æ–‡æ®µï¼ˆSYN=1çš„æŠ¥æ–‡æ®µï¼‰ä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†éœ€è¦æ¶ˆè€—æ‰ä¸€ä¸ªåºå·ã€‚ TCPæœåŠ¡å™¨æ”¶åˆ°è¯·æ±‚æŠ¥æ–‡åï¼Œå¦‚æœåŒæ„è¿æ¥ï¼Œåˆ™å‘å‡ºç¡®è®¤æŠ¥æ–‡ã€‚ç¡®è®¤æŠ¥æ–‡ä¸­åº”è¯¥ ACK=1ï¼ŒSYN=1ï¼Œç¡®è®¤å·æ˜¯Ack=X+1ï¼ŒåŒæ—¶ä¹Ÿè¦ä¸ºè‡ªå·±åˆå§‹åŒ–ä¸€ä¸ªåºåˆ—å· Seq=Yï¼Œæ­¤æ—¶ï¼ŒTCPæœåŠ¡å™¨è¿›ç¨‹è¿›å…¥äº†SYN-RCVDï¼ˆåŒæ­¥æ”¶åˆ°ï¼‰çŠ¶æ€ã€‚è¿™ä¸ªæŠ¥æ–‡ä¹Ÿä¸èƒ½æºå¸¦æ•°æ®ï¼Œä½†æ˜¯åŒæ ·è¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ TCPå®¢æˆ·è¿›ç¨‹æ”¶åˆ°ç¡®è®¤åï¼Œè¿˜è¦å‘æœåŠ¡å™¨ç»™å‡ºç¡®è®¤ã€‚ç¡®è®¤æŠ¥æ–‡çš„ACK=1ï¼ŒAck=Y+1ï¼Œè‡ªå·±çš„åºåˆ—å·Seq=X+1ï¼Œæ­¤æ—¶ï¼ŒTCPè¿æ¥å»ºç«‹ï¼Œå®¢æˆ·ç«¯è¿›å…¥ESTABLISHEDï¼ˆå·²å»ºç«‹è¿æ¥ï¼‰çŠ¶æ€ã€‚TCPè§„å®šï¼ŒACKæŠ¥æ–‡æ®µå¯ä»¥æºå¸¦æ•°æ®ï¼Œä½†æ˜¯å¦‚æœä¸æºå¸¦æ•°æ®åˆ™ä¸æ¶ˆè€—åºå·ã€‚ å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„ç¡®è®¤åä¹Ÿè¿›å…¥ESTABLISHEDçŠ¶æ€ï¼Œæ­¤ååŒæ–¹å°±å¯ä»¥å¼€å§‹é€šä¿¡äº†ã€‚ ä¸ºä»€ä¹ˆTCPå»ºç«‹è¿æ¥éœ€ä¸‰æ¬¡æ¡æ‰‹ é¦–å…ˆè¦çŸ¥é“ä¿¡é“æ˜¯ä¸å¯é çš„ï¼Œä½†æ˜¯è¦å»ºç«‹å¯é çš„è¿æ¥å‘é€å¯é çš„æ•°æ®ï¼Œä¹Ÿå°±æ˜¯æ•°æ®ä¼ è¾“æ˜¯éœ€è¦å¯é çš„ã€‚åœ¨è¿™ä¸ªæ—¶å€™ä¸‰æ¬¡æ¡æ‰‹æ˜¯ä¸€ä¸ªç†è®ºä¸Šçš„æœ€å°å€¼ï¼Œå¹¶ä¸æ˜¯è¯´æ˜¯tcpåè®®è¦æ±‚çš„ï¼Œè€Œæ˜¯ä¸ºäº†æ»¡è¶³åœ¨ä¸å¯é çš„ä¿¡é“ä¸Šä¼ è¾“å¯é çš„æ•°æ®æ‰€è¦æ±‚çš„ã€‚ åœ¨ã€Šè®¡ç®—æœºç½‘ç»œã€‹ä¸€ä¹¦ä¸­å…¶ä¸­æœ‰æåˆ°ï¼Œä¸‰æ¬¡æ¡æ‰‹çš„ç›®çš„æ˜¯â€œä¸ºäº†é˜²æ­¢å·²ç»å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡æ®µçªç„¶åˆä¼ åˆ°æœåŠ¡ç«¯ï¼Œå› è€Œäº§ç”Ÿé”™è¯¯â€è¿™ç§æƒ…å†µæ˜¯ï¼šä¸€ç«¯(client)Aå‘å‡ºå»çš„ç¬¬ä¸€ä¸ªè¿æ¥è¯·æ±‚æŠ¥æ–‡å¹¶æ²¡æœ‰ä¸¢å¤±ï¼Œè€Œæ˜¯å› ä¸ºæŸäº›æœªçŸ¥çš„åŸå› åœ¨æŸä¸ªç½‘ç»œèŠ‚ç‚¹ä¸Šå‘ç”Ÿæ»ç•™ï¼Œå¯¼è‡´å»¶è¿Ÿåˆ°è¿æ¥é‡Šæ”¾ä»¥åçš„æŸä¸ªæ—¶é—´æ‰åˆ°è¾¾å¦ä¸€ç«¯(server)Bã€‚æœ¬æ¥è¿™æ˜¯ä¸€ä¸ªæ—©å·²å¤±æ•ˆçš„æŠ¥æ–‡æ®µï¼Œä½†æ˜¯Bæ”¶åˆ°æ­¤å¤±æ•ˆçš„æŠ¥æ–‡ä¹‹åï¼Œä¼šè¯¯è®¤ä¸ºæ˜¯Aå†æ¬¡å‘å‡ºçš„ä¸€ä¸ªæ–°çš„è¿æ¥è¯·æ±‚ï¼Œäºæ˜¯Bç«¯å°±å‘Aåˆå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼Œè¡¨ç¤ºåŒæ„å»ºç«‹è¿æ¥ã€‚å¦‚æœä¸é‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€ï¼Œé‚£ä¹ˆåªè¦Bç«¯å‘å‡ºç¡®è®¤æŠ¥æ–‡å°±ä¼šè®¤ä¸ºæ–°çš„è¿æ¥å·²ç»å»ºç«‹äº†ï¼Œä½†æ˜¯Aç«¯å¹¶æ²¡æœ‰å‘å‡ºå»ºç«‹è¿æ¥çš„è¯·æ±‚ï¼Œå› æ­¤ä¸ä¼šå»å‘Bç«¯å‘é€æ•°æ®ï¼ŒBç«¯æ²¡æœ‰æ”¶åˆ°æ•°æ®å°±ä¼šä¸€ç›´ç­‰å¾…ï¼Œè¿™æ ·Bç«¯å°±ä¼šç™½ç™½æµªè´¹æ‰å¾ˆå¤šèµ„æºã€‚å¦‚æœé‡‡ç”¨â€œä¸‰æ¬¡æ¡æ‰‹â€çš„è¯å°±ä¸ä¼šå‡ºç°è¿™ç§æƒ…å†µï¼ŒBç«¯æ”¶åˆ°ä¸€ä¸ªè¿‡æ—¶å¤±æ•ˆçš„æŠ¥æ–‡æ®µä¹‹åï¼Œå‘Aç«¯å‘å‡ºç¡®è®¤ï¼Œæ­¤æ—¶Aå¹¶æ²¡æœ‰è¦æ±‚å»ºç«‹è¿æ¥ï¼Œæ‰€ä»¥å°±ä¸ä¼šå‘Bç«¯å‘é€ç¡®è®¤ï¼Œè¿™ä¸ªæ—¶å€™Bç«¯ä¹Ÿèƒ½å¤ŸçŸ¥é“è¿æ¥æ²¡æœ‰å»ºç«‹ã€‚ é‡Šæ”¾è¿æ¥-å››æ¬¡æŒ¥æ‰‹ è¿‡ç¨‹è¯´æ˜ï¼š å®¢æˆ·ç«¯è¿›ç¨‹å‘å‡ºè¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå¹¶ä¸”åœæ­¢å‘é€æ•°æ®ã€‚é‡Šæ”¾æ•°æ®æŠ¥æ–‡é¦–éƒ¨ï¼ŒFIN=1ï¼Œå…¶åºåˆ—å·ä¸ºseq=uï¼ˆç­‰äºå‰é¢å·²ç»ä¼ é€è¿‡æ¥çš„æ•°æ®çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„åºå·åŠ 1ï¼‰ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯è¿›å…¥FIN-WAIT-1ï¼ˆç»ˆæ­¢ç­‰å¾…1ï¼‰çŠ¶æ€ã€‚ TCPè§„å®šï¼ŒFINæŠ¥æ–‡æ®µå³ä½¿ä¸æºå¸¦æ•°æ®ï¼Œä¹Ÿè¦æ¶ˆè€—ä¸€ä¸ªåºå·ã€‚ æœåŠ¡å™¨æ”¶åˆ°è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼Œå‘å‡ºç¡®è®¤æŠ¥æ–‡ï¼ŒACK=1ï¼Œack=u+1ï¼Œå¹¶ä¸”å¸¦ä¸Šè‡ªå·±çš„åºåˆ—å·seq=vï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡ç«¯å°±è¿›å…¥äº†CLOSE-WAITï¼ˆå…³é—­ç­‰å¾…ï¼‰çŠ¶æ€ã€‚TCPæœåŠ¡å™¨é€šçŸ¥é«˜å±‚çš„åº”ç”¨è¿›ç¨‹ï¼Œå®¢æˆ·ç«¯å‘æœåŠ¡å™¨çš„æ–¹å‘å°±é‡Šæ”¾äº†ï¼Œè¿™æ—¶å€™å¤„äºåŠå…³é—­çŠ¶æ€ï¼Œå³å®¢æˆ·ç«¯å·²ç»æ²¡æœ‰æ•°æ®è¦å‘é€äº†ï¼Œä½†æ˜¯æœåŠ¡å™¨è‹¥å‘é€æ•°æ®ï¼Œå®¢æˆ·ç«¯ä¾ç„¶è¦æ¥å—ã€‚è¿™ä¸ªçŠ¶æ€è¿˜è¦æŒç»­ä¸€æ®µæ—¶é—´ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªCLOSE-WAITçŠ¶æ€æŒç»­çš„æ—¶é—´ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„ç¡®è®¤è¯·æ±‚åï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥FIN-WAIT-2ï¼ˆç»ˆæ­¢ç­‰å¾…2ï¼‰çŠ¶æ€ï¼Œç­‰å¾…æœåŠ¡å™¨å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ˆåœ¨è¿™ä¹‹å‰è¿˜éœ€è¦æ¥å—æœåŠ¡å™¨å‘é€çš„æœ€åçš„æ•°æ®ï¼‰ã€‚ æœåŠ¡å™¨å°†æœ€åçš„æ•°æ®å‘é€å®Œæ¯•åï¼Œå°±å‘å®¢æˆ·ç«¯å‘é€è¿æ¥é‡Šæ”¾æŠ¥æ–‡ï¼ŒFIN=1ï¼Œack=u+1ï¼Œç”±äºåœ¨åŠå…³é—­çŠ¶æ€ï¼ŒæœåŠ¡å™¨å¾ˆå¯èƒ½åˆå‘é€äº†ä¸€äº›æ•°æ®ï¼Œå‡å®šæ­¤æ—¶çš„åºåˆ—å·ä¸ºseq=wï¼Œæ­¤æ—¶ï¼ŒæœåŠ¡å™¨å°±è¿›å…¥äº†LAST-ACKï¼ˆæœ€åç¡®è®¤ï¼‰çŠ¶æ€ï¼Œç­‰å¾…å®¢æˆ·ç«¯çš„ç¡®è®¤ã€‚ å®¢æˆ·ç«¯æ”¶åˆ°æœåŠ¡å™¨çš„è¿æ¥é‡Šæ”¾æŠ¥æ–‡åï¼Œå¿…é¡»å‘å‡ºç¡®è®¤ï¼ŒACK=1ï¼Œack=w+1ï¼Œè€Œè‡ªå·±çš„åºåˆ—å·æ˜¯seq=u+1ï¼Œæ­¤æ—¶ï¼Œå®¢æˆ·ç«¯å°±è¿›å…¥äº†TIME-WAITï¼ˆæ—¶é—´ç­‰å¾…ï¼‰çŠ¶æ€ã€‚æ³¨æ„æ­¤æ—¶TCPè¿æ¥è¿˜æ²¡æœ‰é‡Šæ”¾ï¼Œå¿…é¡»ç»è¿‡2MSLï¼ˆæœ€é•¿æŠ¥æ–‡æ®µå¯¿å‘½ï¼‰çš„æ—¶é—´åï¼Œå½“å®¢æˆ·ç«¯æ’¤é”€ç›¸åº”çš„TCBåï¼Œæ‰è¿›å…¥CLOSEDçŠ¶æ€ã€‚ æœåŠ¡å™¨åªè¦æ”¶åˆ°äº†å®¢æˆ·ç«¯å‘å‡ºçš„ç¡®è®¤ï¼Œç«‹å³è¿›å…¥CLOSEDçŠ¶æ€ã€‚åŒæ ·ï¼Œæ’¤é”€TCBåï¼Œå°±ç»“æŸäº†è¿™æ¬¡çš„TCPè¿æ¥ã€‚å¯ä»¥çœ‹åˆ°ï¼ŒæœåŠ¡å™¨ç»“æŸTCPè¿æ¥çš„æ—¶é—´è¦æ¯”å®¢æˆ·ç«¯æ—©ä¸€äº›ã€‚ ä¸ºä»€ä¹ˆTCPé‡Šæ”¾è¿æ¥éœ€è¦å››æ¬¡æŒ¥æ‰‹ ä¸ºäº†ä¿è¯å®¢æˆ·ç«¯å‘é€çš„æœ€å1ä¸ªè¿æ¥é‡Šæ”¾ç¡®è®¤æŠ¥æ–‡èƒ½åˆ°è¾¾æœåŠ¡å™¨ï¼Œä»è€Œä½¿å¾—æœåŠ¡å™¨èƒ½æ­£å¸¸é‡Šæ”¾è¿æ¥ã€‚ å…³é—­è¿æ¥æ—¶ï¼Œå½“æ”¶åˆ°å¯¹æ–¹çš„FINæŠ¥æ–‡é€šçŸ¥æ—¶ï¼Œå®ƒä»…ä»…è¡¨ç¤ºå¯¹æ–¹æ²¡æœ‰æ•°æ®å‘é€ç»™ä½ äº†ï¼Œä½†æœªå¿…ä½ æ‰€æœ‰çš„æ•°æ®éƒ½å‘é€ç»™å¯¹æ–¹äº†ï¼Œæ‰€ä»¥ä½ ä¸å¿…é©¬ä¸Šå…³é—­SOCKETï¼Œä¹Ÿå³ä½ å¯èƒ½è¿˜éœ€è¦å‘é€ä¸€äº›æ•°æ®ç»™å¯¹æ–¹ä¹‹åï¼Œå†å‘é€FINæŠ¥æ–‡ç»™å¯¹æ–¹æ¥è¡¨ç¤ºä½ åŒæ„å…³é—­è¿æ¥äº†ï¼Œæ‰€ä»¥å®ƒè¿™é‡Œçš„ACKæŠ¥æ–‡å’ŒFINæŠ¥æ–‡å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯åˆ†å¼€å‘é€çš„ã€‚ é˜²æ­¢ä¸Šæ–‡æåˆ°çš„æ—©å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡å‡ºç°åœ¨æœ¬è¿æ¥ä¸­ã€‚ å®¢æˆ·ç«¯å‘é€äº†æœ€å1ä¸ªè¿æ¥é‡Šæ”¾è¯·æ±‚ç¡®è®¤æŠ¥æ–‡åï¼Œå†ç»è¿‡2MSLæ—¶é—´ï¼Œåˆ™å¯ä½¿æœ¬è¿æ¥æŒç»­æ—¶é—´å†…æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚å³åœ¨ä¸‹1ä¸ªæ–°çš„è¿æ¥ä¸­å°±ä¸ä¼šå‡ºç°æ—©å·²å¤±æ•ˆçš„è¿æ¥è¯·æ±‚æŠ¥æ–‡ã€‚ é‡Šæ”¾è¿æ¥æ—¶ä¸ºä»€ä¹ˆTIME-WAITçŠ¶æ€å¿…é¡»ç­‰å¾…2MSLæ—¶é—´ é¦–å…ˆè¯´ä¸‹ä»€ä¹ˆæ˜¯MSL: MSLæ˜¯Maximum Segment Lifetimeè‹±æ–‡çš„ç¼©å†™ï¼Œä¸­æ–‡å¯ä»¥è¯‘ä¸ºâ€œæŠ¥æ–‡æœ€å¤§ç”Ÿå­˜æ—¶é—´â€ï¼Œä»–æ˜¯ä»»ä½•æŠ¥æ–‡åœ¨ç½‘ç»œä¸Šå­˜åœ¨çš„æœ€é•¿æ—¶é—´ï¼Œè¶…è¿‡è¿™ä¸ªæ—¶é—´æŠ¥æ–‡å°†è¢«ä¸¢å¼ƒã€‚ ç¬¬ä¸€ï¼Œä¸ºäº†ä¿è¯Aå‘é€çš„æœ€åä¸€ä¸ªACKæŠ¥æ–‡èƒ½å¤Ÿåˆ°è¾¾Bã€‚è¿™ä¸ªACKæŠ¥æ–‡æ®µæœ‰å¯èƒ½ä¸¢å¤±ï¼Œå› è€Œä½¿å¤„åœ¨LAST-ACKçŠ¶æ€çš„Bæ”¶ä¸åˆ°å¯¹å·²å‘é€çš„FIN+ACKæŠ¥æ–‡æ®µçš„ç¡®è®¤ã€‚Bä¼šè¶…æ—¶é‡ä¼ è¿™ä¸ªFIN+ACKæŠ¥æ–‡æ®µï¼Œè€ŒAå°±èƒ½åœ¨2MSLæ—¶é—´å†…æ”¶åˆ°è¿™ä¸ªé‡ä¼ çš„FIN+ACKæŠ¥æ–‡æ®µï¼Œé‡ç½®æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼ˆ2MSLï¼‰ã€‚ å¦‚æœAåœ¨TIME-WAITçŠ¶æ€ä¸ç­‰å¾…ä¸€æ®µæ—¶é—´ï¼Œè€Œæ˜¯åœ¨å‘é€å®ŒACKæŠ¥æ–‡æ®µåå°±ç«‹å³é‡Šæ”¾è¿æ¥ï¼Œå°±æ— æ³•æ”¶åˆ°Bé‡ä¼ çš„FIN+ACKæŠ¥æ–‡æ®µï¼Œå› è€Œä¹Ÿä¸ä¼šå†å‘é€ä¸€æ¬¡ç¡®è®¤æŠ¥æ–‡æ®µã€‚è¿™æ ·ï¼ŒBå°±æ— æ³•æŒ‰ç…§æ­£å¸¸çš„æ­¥éª¤è¿›å…¥CLOSEDçŠ¶æ€ã€‚ ç¬¬äºŒï¼ŒAåœ¨å‘é€å®ŒACKæŠ¥æ–‡æ®µåï¼Œå†ç»è¿‡2MSLæ—¶é—´ï¼Œå°±å¯ä»¥ä½¿æœ¬è¿æ¥æŒç»­çš„æ—¶é—´æ‰€äº§ç”Ÿçš„æ‰€æœ‰æŠ¥æ–‡æ®µéƒ½ä»ç½‘ç»œä¸­æ¶ˆå¤±ã€‚è¿™æ ·å°±å¯ä»¥ä½¿ä¸‹ä¸€ä¸ªæ–°çš„è¿æ¥ä¸­ä¸ä¼šå‡ºç°è¿™ç§æ—§çš„è¿æ¥è¯·æ±‚çš„æŠ¥æ–‡æ®µã€‚ å®¢æˆ·ç«¯çªç„¶æŒ‚æ‰äº†æ€ä¹ˆåŠ æ­£å¸¸è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯çªç„¶æŒ‚æ‰äº†ï¼Œå¦‚æœæ²¡æœ‰æªæ–½å¤„ç†è¿™ç§æƒ…å†µï¼Œé‚£ä¹ˆå°±ä¼šå‡ºç°å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯å‡ºç°é•¿æ—¶æœŸçš„ç©ºé—²ã€‚ è§£å†³åŠæ³•æ˜¯åœ¨æœåŠ¡å™¨ç«¯è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ï¼Œæ¯å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·ç«¯çš„æ¶ˆæ¯ï¼Œå°±å°†è®¡æ—¶å™¨å¤ä½ã€‚è¶…æ—¶æ—¶é—´é€šå¸¸è®¾ç½®ä¸º2å°æ—¶ã€‚è‹¥æœåŠ¡å™¨è¶…è¿‡2å°æ—¶æ²¡æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€æ¢æµ‹æŠ¥æ–‡æ®µã€‚è‹¥å‘é€äº†10ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œæ¯ä¸€ä¸ªç›¸éš”75ç§’ï¼Œè¿˜æ²¡æœ‰å“åº”å°±è®¤ä¸ºå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œå› è€Œç»ˆæ­¢è¯¥è¿æ¥ã€‚ æ»‘åŠ¨çª—å£åè®® åŸºç¡€æ¦‚å¿µ å‘é€çª—å£ï¼šä»»æ„æ—¶åˆ»ï¼Œå‘é€æ–¹ç»´æŒçš„ä¸€ç»„è¿ç»­çš„ã€å…è®¸å‘é€å¸§çš„å¸§åºå·ï¼›ç”¨äºå¯¹å‘é€æ–¹è¿›è¡Œæµé‡æ§åˆ¶ï¼› æ¥æ”¶çª—å£ï¼šä»»æ„æ—¶åˆ»ï¼Œæ¥æ”¶æ–¹ç»´æŒçš„ä¸€ç»„è¿ç»­çš„ã€å…è®¸æ¥æ”¶å¸§çš„å¸§åºå·ï¼›ç”¨äºæ§åˆ¶å¯æ¥æ”¶å“ªäº›æ•°æ®å¸§ã€ä¸å¯æ¥æ”¶å“ªäº›æ•°æ®å¸§ï¼Œæ¥æ”¶æ–¹åªæœ‰å½“æ”¶åˆ°æ•°æ®å¸§çš„åºå·è½å…¥æ¥æ”¶çª—å£å†…æ‰å…è®¸å°†è¯¥æ•°æ®å¸§æ”¶ä¸‹ï¼Œå¦åˆ™ä¸€å¾‹ä¸¢å¼ƒã€‚ å·¥ä½œåŸç† å‘é€ç«¯ æ¯æ”¶åˆ°ä¸€ä¸ªç¡®è®¤å¸§ï¼Œå‘é€çª—å£å°±å‘å‰æ»‘åŠ¨ä¸€ä¸ªå¸§çš„è·ç¦»ã€‚ å½“å‘é€çª—å£å†…æ— å¯å‘é€çš„å¸§æ—¶ï¼ˆå³çª—å£å†…çš„å¸§å…¨éƒ¨æ˜¯å·²å‘é€ä½†æœªæ”¶åˆ°ç¡®è®¤çš„å¸§ï¼‰ï¼Œå‘é€æ–¹å°±ä¼šåœæ­¢å‘é€ï¼Œç›´åˆ°æ”¶åˆ°æ¥æ”¶æ–¹å‘é€çš„ç¡®è®¤å¸§ä½¿çª—å£ç§»åŠ¨ï¼Œçª—å£å†…æœ‰å¯ä»¥å‘é€çš„å¸§ï¼Œä¹‹åæ‰å¼€å§‹ç»§ç»­å‘é€ã€‚ æ¥æ”¶ç«¯ å½“æ”¶åˆ°æ•°æ®å¸§åï¼Œå°†çª—å£å‘å‰ç§»åŠ¨ä¸€ä¸ªä½ç½®ï¼Œå¹¶å‘å›ç¡®è®¤å¸§ï¼Œè‹¥æ”¶åˆ°çš„æ•°æ®å¸§è½åœ¨æ¥æ”¶çª—å£ä¹‹å¤–ï¼Œåˆ™ä¸€å¾‹ä¸¢å¼ƒã€‚ é‡è¦ç‰¹æ€§ åªæœ‰æ¥æ”¶çª—å£å‘å‰æ»‘åŠ¨ã€æ¥æ”¶æ–¹å‘é€äº†ç¡®è®¤å¸§æ—¶ï¼Œå‘é€çª—å£æ‰æœ‰å¯èƒ½ï¼ˆåªæœ‰å‘é€æ–¹æ”¶åˆ°ç¡®è®¤å¸§æ‰æ˜¯ä¸€å®šï¼‰å‘å‰æ»‘åŠ¨ã€‚ åœæ­¢-ç­‰å¾…åè®®ã€åé€€Nå¸§åè®® &amp; é€‰æ‹©é‡ä¼ åè®®åªæ˜¯åœ¨å‘é€çª—å£å¤§å°å’Œæ¥æ”¶çª—å£å¤§å°ä¸Šæœ‰æ‰€å·®åˆ«ï¼š åœæ­¢ç­‰å¾…åè®®ï¼šå‘é€çª—å£å¤§å°=1ï¼Œæ¥æ”¶çª—å£å¤§å°=1ï¼›å³ å•å¸§æ»‘åŠ¨çª—å£ ç­‰äº åœæ­¢-ç­‰å¾…åè®® åé€€Nå¸§åè®®ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼Œæ¥æ”¶çª—å£å¤§å°=1ã€‚ é€‰æ‹©é‡ä¼ åè®®ï¼šå‘é€çª—å£å¤§å°&gt;1ï¼Œæ¥æ”¶çª—å£å¤§å°&gt;1ã€‚ å½“æ¥æ”¶çª—å£çš„å¤§å°ä¸º1æ—¶ï¼Œå¯ä¿è¯å¸§æœ‰åºæ¥æ”¶ã€‚ æ•°æ®é“¾è·¯å±‚çš„æ»‘åŠ¨çª—å£åè®®ä¸­ï¼Œçª—å£çš„å¤§å°åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯å›ºå®šçš„ï¼ˆæ³¨æ„è¦ä¸TCPçš„æ»‘åŠ¨çª—å£åè®®åŒºåˆ«ï¼‰ã€‚ è‡ªåŠ¨é‡ä¼ è¯·æ±‚åè®®ARQ å®šä¹‰ Auto Repeat reQuestï¼Œä¼ è¾“å‡ºç°å·®é”™æ—¶ï¼Œæ¥æ”¶æ–¹è‡ªåŠ¨è¯·æ±‚å‘é€æ–¹é‡ä¼ å‡ºé”™çš„æ•°æ®ã€‚ ä½œç”¨ ä¿è¯ä¿¡é“çš„æ•°æ®ä¼ è¾“æ— å·®é”™ã€‚ æœºåˆ¶ ç¡®è®¤æœºåˆ¶ å‘é€æ–¹æ¯å‘é€ä¸€å¸§ï¼Œè¦ç­‰åˆ°æ¥æ”¶æ–¹çš„åº”ç­”ä¿¡å·åæ‰èƒ½å‘é€ä¸‹ä¸€å¸§ï¼› æ¥æ”¶æ–¹æ¯æ¥æ”¶ä¸€å¸§ï¼Œéƒ½è¦åé¦ˆä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œè¡¨ç¤ºå¯æ¥æ”¶ä¸‹ä¸€å¸§ï¼› è‹¥æ¥æ”¶æ–¹ä¸åé¦ˆåº”ç­”ä¿¡å·ï¼Œåˆ™å‘é€æ–¹å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚ è¶…æ—¶é‡ä¼ æœºåˆ¶ å‘é€æ–¹åœ¨å‘é€æŸä¸ªæ•°æ®å¸§åå°±å¼€å¯è®¡æ—¶å™¨ï¼› åœ¨ä¸€å®šæ—¶é—´å†…è‹¥æ²¡å¾—åˆ°å‘é€çš„æ•°æ®å¸§çš„ç¡®è®¤å¸§ï¼Œåˆ™é‡æ–°æ–¹æ³•è¯¥æ•°æ®å¸§ï¼Œç›´åˆ°å‘é€æˆåŠŸä¸ºæ­¢ã€‚ ç±»å‹ åœç­‰å¼ARQï¼ˆStop-and-Waitï¼‰ åé€€Nå¸§ARQï¼ˆGo-Back-Nï¼‰ é€‰æ‹©é‡ä¼ ARQï¼ˆSelective Repeatï¼‰ åœç­‰å¼ARQï¼ˆStop-and-Waitï¼‰ åŸç†ï¼š ï¼ˆå•å¸§æ»‘åŠ¨çª—å£ï¼‰åœæ­¢ - ç­‰å¾…åè®® + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°=1ã€æ¥æ”¶çª—å£å¤§å°=1 å…·ä½“æè¿°ï¼š å‘é€æ–¹æ¯å‘é€ä¸€å¸§ï¼Œè¦ç­‰åˆ°æ¥æ”¶æ–¹çš„åº”ç­”ä¿¡å·åæ‰èƒ½å‘é€ä¸‹ä¸€å¸§ï¼› æ¥æ”¶æ–¹æ¯æ¥æ”¶ä¸€å¸§ï¼Œéƒ½è¦åé¦ˆä¸€ä¸ªåº”ç­”ä¿¡å·ï¼Œè¡¨ç¤ºå¯æ¥ä¸‹ä¸€å¸§ï¼› è‹¥æ¥æ”¶æ–¹ä¸åé¦ˆåº”ç­”ä¿¡å·ï¼Œåˆ™å‘é€æ–¹å¿…é¡»ä¸€ç›´ç­‰å¾…ã€‚ åé€€Nå¸§åè®® åŸç†ï¼š å¤šå¸§æ»‘åŠ¨çª—å£ + ç´¯è®¡ç¡®è®¤ + åé€€Nå¸§ + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°&gt;1ã€æ¥æ”¶çª—å£å¤§å°=1 å…·ä½“æè¿°ï¼š å‘é€æ–¹ï¼šé‡‡ç”¨å¤šå¸§æ»‘åŠ¨çª—å£çš„åŸç†ï¼Œå¯è¿ç»­å‘é€å¤šä¸ªæ•°æ®å¸§ è€Œä¸éœ€ç­‰å¾…å¯¹æ–¹ç¡®è®¤ æ¥æ”¶æ–¹ï¼šé‡‡ç”¨ ç´¯è®¡ç¡®è®¤ &amp; åé€€Nå¸§çš„åŸç†ï¼Œåªå…è®¸æŒ‰é¡ºåºæ¥æ”¶å¸§ã€‚ ç´¯è®¡ç¡®è®¤ æ”¶åˆ°å¤šä¸ªæ•°æ®åˆ†ç»„åï¼Œåªéœ€å¯¹æŒ‰åºåˆ°è¾¾çš„æœ€å1ä¸ªåˆ†ç»„å‘é€ç¡®è®¤è€Œä¸å¿…å¯¹æ”¶åˆ°çš„æ¯ä¸ªåˆ†ç»„é€ä¸ªå‘é€ç¡®è®¤å³å¯è¡¨ç¤ºåˆ°è¯¥åˆ†ç»„ä¸ºæ­¢çš„æ‰€æœ‰åˆ†ç»„éƒ½å·²æ­£ç¡®æ”¶åˆ°ã€‚ ä¼˜ç‚¹ï¼šå®ç°ç®€ç­”ï¼›æ•°æ®ä¸¢å¤±ä¸å¿…é‡ä¼ ã€‚ ç¼ºç‚¹ï¼šä¸èƒ½å‘å‘é€æ–¹åæ˜ å‡ºæ¥æ”¶æ–¹å·²æ­£ç¡®æ”¶åˆ°æ‰€æœ‰åˆ†ç»„ä¿¡æ¯ã€‚ åé€€Nå¸§ é€€å›æ¥é‡ä¼ å·²å‘é€è¿‡çš„Nä¸ªåˆ†ç»„ã€‚ä¿è¯æŒ‰åºæ¥æ”¶æ•°æ®å¸§ã€‚ åé€€Nå¸§åè®®çš„æ¥å£çª—å£é•¿åº¦ = 1ï¼Œè‹¥é‡‡ç”¨nä¸ªæ¯”ç‰¹å¯¹å¸§ç¼–å·ï¼Œåˆ™å…¶å‘é€çª—å£WTåº”æ»¡è¶³1â‰¤WTâ‰¤2n-1;è‹¥å‘é€çª—å£å°ºå¯¸å¤§äº2n-1ï¼Œåˆ™ä¼šé€ æˆæ¥æ”¶æ–¹æ— æ³•åˆ†è¾¨æ–°å¸§å’Œæ—§å¸§ã€‚ é€‰æ‹©é‡ä¼ ARQï¼ˆSelective Repeatï¼‰ åŸç†ï¼š å¤šå¸§æ»‘åŠ¨çª—å£ + ç´¯è®¡ç¡®è®¤ + åé€€Nå¸§ + è¶…æ—¶é‡ä¼ ï¼Œå³ ï¼šå‘é€çª—å£å¤§å°&gt;1ã€æ¥æ”¶çª—å£å¤§å°&gt;1 ä¼˜ç¼ºç‚¹ï¼š ä¼˜ç‚¹ï¼šå› è¿ç»­å‘é€æ•°æ®å¸§è€Œæé«˜äº†ä¿¡é“çš„åˆ©ç”¨ç‡ï¼›ç¼ºç‚¹ï¼šé‡ä¼ æ—¶åˆå¿…é¡»æŠŠåŸæ¥å·²ç»ä¼ é€æ­£ç¡®çš„æ•°æ®å¸§è¿›è¡Œé‡ä¼ ï¼ˆä»…å› ä¸ºè¿™äº›æ•°æ®å¸§å‰é¢æœ‰ä¸€ä¸ªæ•°æ®å¸§å‡ºäº†é”™ï¼‰ï¼Œå°†å¯¼è‡´ä¼ é€æ•ˆç‡é™ä½ã€‚ TCPè¶…æ—¶é‡ä¼  åœ¨å‘é€æŸä¸€ä¸ªæ•°æ®ä»¥åå°±å¼€å¯ä¸€ä¸ªè®¡æ—¶å™¨ï¼Œåœ¨ä¸€å®šæ—¶é—´å†…å¦‚æœæ²¡æœ‰å¾—åˆ°å‘é€çš„æ•°æ®æŠ¥çš„ACKæŠ¥æ–‡ï¼Œé‚£ä¹ˆå°±é‡æ–°å‘é€æ•°æ®ï¼Œç›´åˆ°å‘é€æˆåŠŸä¸ºæ­¢ã€‚ å½±å“è¶…æ—¶é‡ä¼ æœºåˆ¶åè®®æ•ˆç‡çš„ä¸€ä¸ªå…³é”®å‚æ•°æ˜¯é‡ä¼ è¶…æ—¶æ—¶é—´ï¼ˆRTOï¼ŒRetransmission TimeOutï¼‰ã€‚RTOçš„å€¼è¢«è®¾ç½®è¿‡å¤§è¿‡å°éƒ½ä¼šå¯¹åè®®é€ æˆä¸åˆ©å½±å“ã€‚ ï¼ˆ1ï¼‰RTOè®¾é•¿äº†ï¼Œé‡å‘å°±æ…¢ï¼Œæ²¡æœ‰æ•ˆç‡ï¼Œæ€§èƒ½å·®ã€‚ ï¼ˆ2ï¼‰RTOè®¾çŸ­äº†ï¼Œé‡å‘çš„å°±å¿«ï¼Œä¼šå¢åŠ ç½‘ç»œæ‹¥å¡ï¼Œå¯¼è‡´æ›´å¤šçš„è¶…æ—¶ï¼Œæ›´å¤šçš„è¶…æ—¶å¯¼è‡´æ›´å¤šçš„é‡å‘ã€‚ è¿æ¥å¾€è¿”æ—¶é—´ï¼ˆRTTï¼ŒRound Trip Timeï¼‰ï¼ŒæŒ‡å‘é€ç«¯ä»å‘é€TCPåŒ…å¼€å§‹åˆ°æ¥æ”¶å®ƒçš„ç«‹å³å“åº”æ‰€æ¶ˆè€—çš„æ—¶é—´ã€‚ RTOç†è®ºä¸Šæœ€å¥½æ˜¯ç½‘ç»œ RTT æ—¶é—´ï¼Œä½†åˆå—åˆ¶äºç½‘ç»œè·ç¦»ä¸ç¬æ€æ—¶å»¶å˜åŒ–ï¼Œæ‰€ä»¥å®é™…ä¸Šä½¿ç”¨è‡ªé€‚åº”çš„åŠ¨æ€ç®—æ³•ï¼ˆä¾‹å¦‚ Jacobson ç®—æ³•å’Œ Karn ç®—æ³•ç­‰ï¼‰æ¥ç¡®å®šè¶…æ—¶æ—¶é—´ã€‚ TCPæµé‡æ§åˆ¶ TCPæµé‡æ§åˆ¶ä¸»è¦æ˜¯é’ˆå¯¹æ¥æ”¶ç«¯çš„å¤„ç†é€Ÿåº¦ä¸å¦‚å‘é€ç«¯å‘é€é€Ÿåº¦å¿«çš„é—®é¢˜ï¼Œæ¶ˆé™¤å‘é€æ–¹ä½¿æ¥æ”¶æ–¹ç¼“å­˜æº¢å‡ºçš„å¯èƒ½æ€§ã€‚ TCPæµé‡æ§åˆ¶ä¸»è¦ä½¿ç”¨æ»‘åŠ¨çª—å£åè®®ï¼Œæ»‘åŠ¨çª—å£æ˜¯æ¥å—æ•°æ®ç«¯ä½¿ç”¨çš„çª—å£å¤§å°ï¼Œç”¨æ¥å‘Šè¯‰å‘é€ç«¯æ¥æ”¶ç«¯çš„ç¼“å­˜å¤§å°ï¼Œä»¥æ­¤å¯ä»¥æ§åˆ¶å‘é€ç«¯å‘é€æ•°æ®çš„å¤§å°ï¼Œä»è€Œè¾¾åˆ°æµé‡æ§åˆ¶çš„ç›®çš„ã€‚ æ¥æ”¶ç«¯é€šè¿‡TCPé¦–éƒ¨çš„çª—å£å¤§å°å­—æ®µåé¦ˆå½“å‰å¯æ¥æ”¶çš„å­—èŠ‚æ•°ã€‚ å¯¹äºå‘é€ç«¯çš„æ•°æ®ç¼“å†²åŒºæœ‰è¿™äº›é‡ï¼š LastByteSentæ˜¯ç›®å‰å‘é€çš„æœ€å1å­—èŠ‚çš„æ•°æ®ç¼–å·ï¼› LastByteAckdæ˜¯ç›®å‰æ¥æ”¶åˆ°ç¡®è®¤çš„æœ€å1å­—èŠ‚çš„æ•°æ®ç¼–å·ï¼› LastByteRcvdï¼šæ¥æ”¶ç«¯ä»ç½‘ç»œæ¥æ”¶çš„æœ€åä¸€ä¸ªå­—èŠ‚åºå·ï¼› LastByteReadï¼šä¸Šå±‚åº”ç”¨ç¨‹åºæ¥æ”¶çš„æœ€åä¸€ä¸ªå­—èŠ‚åºå·ï¼› Rcvwinæ˜¯çª—å£å¤§å°ã€‚ é‰´äºæ¯æ¬¡å‘é€æ–¹éƒ½æ˜¯æ”¶åˆ°ACKä¹‹åæ»‘åŠ¨çª—å£ç»§ç»­å‘é€ï¼Œå‘é€åˆ°LastByteSentè¿™ä¸ªä½ç½®ï¼ŒLastByteSent-LastByteAckdä¹Ÿå°±æ˜¯è¿™æ¬¡å‘é€æ•°æ®çš„å¤šå°‘ï¼Œé‚£ä¹ˆåªè¦æ»¡è¶³ï¼šLastByteSentâ€“LastByteAckd&lt;=RcvWin(æ¥æ”¶ç«¯ç©ºé—²çª—å£å¤§å°) å°±ä¼šä¿è¯ä¸ä¼šæº¢å‡ºäº†ã€‚ é‚£ä¹ˆæ¥æ”¶ç«¯RcvWinæ€ä¹ˆç®—å‘¢ï¼Ÿ å‡è®¾æ¥æ”¶ç«¯ç¼“å†²åŒºå¤§å°ä¸ºRcvBuffer,é‚£ä¹ˆLastByteRcvdâ€“LastByteReadå°±æ˜¯å·²ç»æ¥å—ä½†æ˜¯è¿˜æ²¡æœ‰ä¼ é€’ç»™ä¸Šå±‚çš„æ•°æ®ã€‚æ‰€ä»¥ç©ºé—²åŒºåŸŸRcvWin= RcvBuffer-(LastByteRcvdâ€“LastByteRead)ã€‚ TCPæ‹¥å¡æ§åˆ¶ TCPå‘é€æ–¹å¯èƒ½å› ä¸ºIPç½‘ç»œçš„æ‹¥å¡è€Œè¢«éåˆ¶ï¼ŒTCPæ‹¥å¡æ§åˆ¶å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ˆæ³¨æ„å’ŒTCPæµé‡æ§åˆ¶çš„åŒºåˆ«ï¼‰ã€‚ TCPæ‹¥å¡æ§åˆ¶çš„å‡ ç§æ–¹æ³•ï¼šæ…¢å¯åŠ¨ï¼Œæ‹¥å¡é¿å…ï¼Œå¿«é‡ä¼ å’Œå¿«æ¢å¤ã€‚åœ¨äº†è§£è¿™å‡ ç§æ–¹æ³•ä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹æ‹¥å¡çª—å£ã€æ…¢å¼€å§‹ç®—æ³•ã€æ‹¥å¡é¿å…ç®—æ³•ã€‚ æ‹¥å¡çª—å£ å®šä¹‰ å‘é€æ–¹ç»´æŒä¸€ä¸ªå«åšæ‹¥å¡çª—å£ cwndçš„çŠ¶æ€å˜é‡ã€‚æ‹¥å¡çª—å£çš„å¤§å°å–å†³äºç½‘ç»œçš„æ‹¥å¡ç¨‹åº¦ï¼Œå¹¶ä¸”åŠ¨æ€å˜åŒ–ã€‚å‘é€æ–¹çš„è®©è‡ªå·±çš„å‘é€çª—å£=min(cwndï¼Œæ¥å—ç«¯æ¥æ”¶çª—å£å¤§å°ï¼‰ã€‚ å‘é€æ–¹æ§åˆ¶æ‹¥å¡çª—å£çš„åŸåˆ™ åªè¦ç½‘ç»œæ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å¢å¤§ä¸€äº›ï¼Œä»¥ä¾¿æŠŠæ›´å¤šçš„åˆ†ç»„å‘é€å‡ºå»ã€‚ä½†åªè¦ç½‘ç»œå‡ºç°æ‹¥å¡ï¼Œæ‹¥å¡çª—å£å°±å‡å°ä¸€äº›ï¼Œä»¥å‡å°‘æ³¨å…¥åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ã€‚ æ…¢å¼€å§‹ç®—æ³• å½“ä¸»æœºå¼€å§‹å‘é€æ•°æ®æ—¶ï¼Œå¦‚æœç«‹å³å°†å¤§é‡æ•°æ®å­—èŠ‚æ³¨å…¥åˆ°ç½‘ç»œï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½å¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œå› ä¸ºç°åœ¨å¹¶ä¸æ¸…æ¥šç½‘ç»œçš„è´Ÿè·æƒ…å†µã€‚å› æ­¤ï¼Œè¾ƒå¥½çš„æ–¹æ³•æ˜¯ å…ˆæ¢æµ‹ä¸€ä¸‹ï¼Œå³ç”±å°åˆ°å¤§é€æ¸å¢å¤§å‘é€çª—å£ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç”±å°åˆ°å¤§é€æ¸å¢å¤§æ‹¥å¡çª—å£æ•°å€¼ã€‚ é€šå¸¸åœ¨åˆšåˆšå¼€å§‹å‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå…ˆæŠŠæ‹¥å¡çª—å£ cwnd è®¾ç½®ä¸ºä¸€ä¸ªæœ€å¤§æŠ¥æ–‡æ®µMSSçš„æ•°å€¼ã€‚è€Œåœ¨æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°çš„æŠ¥æ–‡æ®µçš„ç¡®è®¤åï¼ŒæŠŠæ‹¥å¡çª—å£å¢åŠ è‡³å¤šä¸€ä¸ªMSSçš„æ•°å€¼ã€‚ç”¨è¿™æ ·çš„æ–¹æ³•é€æ­¥å¢å¤§å‘é€æ–¹çš„æ‹¥å¡çª—å£ cwnd ï¼Œå¯ä»¥ä½¿åˆ†ç»„æ³¨å…¥åˆ°ç½‘ç»œçš„é€Ÿç‡æ›´åŠ åˆç†ã€‚ æ¯ç»è¿‡ä¸€ä¸ªä¼ è¾“è½®æ¬¡ï¼Œæ‹¥å¡çª—å£ cwnd å°±åŠ å€ã€‚ä¸€ä¸ªä¼ è¾“è½®æ¬¡æ‰€ç»å†çš„æ—¶é—´å…¶å®å°±æ˜¯å¾€è¿”æ—¶é—´RTTã€‚ä¸è¿‡â€œä¼ è¾“è½®æ¬¡â€æ›´åŠ å¼ºè°ƒï¼šæŠŠæ‹¥å¡çª—å£cwndæ‰€å…è®¸å‘é€çš„æŠ¥æ–‡æ®µéƒ½è¿ç»­å‘é€å‡ºå»ï¼Œå¹¶æ”¶åˆ°äº†å¯¹å·²å‘é€çš„æœ€åä¸€ä¸ªå­—èŠ‚çš„ç¡®è®¤ã€‚ æ…¢å¼€å§‹çš„â€œæ…¢â€å¹¶ä¸æ˜¯æŒ‡cwndçš„å¢é•¿é€Ÿç‡æ…¢ï¼Œè€Œæ˜¯æŒ‡åœ¨TCPå¼€å§‹å‘é€æŠ¥æ–‡æ®µæ—¶å…ˆè®¾ç½®cwnd=1ï¼Œä½¿å¾—å‘é€æ–¹åœ¨å¼€å§‹æ—¶åªå‘é€ä¸€ä¸ªæŠ¥æ–‡æ®µï¼ˆç›®çš„æ˜¯è¯•æ¢ä¸€ä¸‹ç½‘ç»œçš„æ‹¥å¡æƒ…å†µï¼‰ï¼Œç„¶åå†é€æ¸å¢å¤§cwndã€‚ ä¸ºäº†é˜²æ­¢æ‹¥å¡çª—å£cwndå¢é•¿è¿‡å¤§å¼•èµ·ç½‘ç»œæ‹¥å¡ï¼Œè¿˜éœ€è¦è®¾ç½®ä¸€ä¸ªæ…¢å¼€å§‹é—¨é™ssthreshçŠ¶æ€å˜é‡ã€‚æ…¢å¼€å§‹é—¨é™ssthreshçš„ç”¨æ³•å¦‚ä¸‹ï¼š å½“ cwnd &lt; ssthresh æ—¶ï¼Œä½¿ç”¨ä¸Šè¿°çš„æ…¢å¼€å§‹ç®—æ³•ã€‚ å½“ cwnd &gt; ssthresh æ—¶ï¼Œåœæ­¢ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•è€Œæ”¹ç”¨æ‹¥å¡é¿å…ç®—æ³•ã€‚ å½“ cwnd = ssthresh æ—¶ï¼Œæ—¢å¯ä½¿ç”¨æ…¢å¼€å§‹ç®—æ³•ï¼Œä¹Ÿå¯ä½¿ç”¨æ‹¥å¡æ§åˆ¶é¿å…ç®—æ³•ã€‚ æ‹¥å¡é¿å…ç®—æ³• è®©æ‹¥å¡çª—å£cwndç¼“æ…¢åœ°å¢å¤§ï¼Œå³æ¯ç»è¿‡ä¸€ä¸ªå¾€è¿”æ—¶é—´RTTå°±æŠŠå‘é€æ–¹çš„æ‹¥å¡çª—å£cwndåŠ 1ï¼Œè€Œä¸æ˜¯åŠ å€ã€‚è¿™æ ·æ‹¥å¡çª—å£cwndæŒ‰çº¿æ€§è§„å¾‹ç¼“æ…¢å¢é•¿ï¼Œæ¯”æ…¢å¼€å§‹ç®—æ³•çš„æ‹¥å¡çª—å£å¢é•¿é€Ÿç‡ç¼“æ…¢å¾—å¤šã€‚ æ‹¥å¡é¿å…å¹¶ä¸å¯é¿å…æ‹¥å¡ï¼Œåªæ˜¯å°†æ‹¥å¡çª—å£æŒ‰ç°è¡Œè§„å¾‹ç¼“æ…¢å¢é•¿ï¼Œä½¿å¾—ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºç°æ‹¥å¡ã€‚ æ…¢å¼€å§‹å’Œæ‹¥å¡é¿å…ç®—æ³•çš„å®ç°ä¸¾ä¾‹ æ— è®ºåœ¨æ…¢å¼€å§‹é˜¶æ®µè¿˜æ˜¯åœ¨æ‹¥å¡é¿å…é˜¶æ®µï¼Œåªè¦å‘é€æ–¹åˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡ï¼ˆå…¶æ ¹æ®å°±æ˜¯æ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼‰ï¼Œå°±è¦æŠŠæ…¢å¼€å§‹é—¨é™ssthreshè®¾ç½®ä¸ºå‡ºç°æ‹¥å¡æ—¶çš„å‘é€ æ–¹çª—å£å€¼çš„ä¸€åŠï¼ˆä½†ä¸èƒ½å°äº2ï¼‰ã€‚ç„¶åæŠŠæ‹¥å¡çª—å£cwndé‡æ–°è®¾ç½®ä¸º1ï¼Œæ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚è¿™æ ·åšçš„ç›®çš„å°±æ˜¯è¦è¿…é€Ÿå‡å°‘ä¸»æœºå‘é€åˆ°ç½‘ç»œä¸­çš„åˆ†ç»„æ•°ï¼Œä½¿å¾—å‘ç”Ÿ æ‹¥å¡çš„è·¯ç”±å™¨æœ‰è¶³å¤Ÿæ—¶é—´æŠŠé˜Ÿåˆ—ä¸­ç§¯å‹çš„åˆ†ç»„å¤„ç†å®Œæ¯•ã€‚ å¦‚ä¸‹å›¾ï¼Œç”¨å…·ä½“æ•°å€¼è¯´æ˜äº†ä¸Šè¿°æ‹¥å¡æ§åˆ¶çš„è¿‡ç¨‹ã€‚ç°åœ¨å‘é€çª—å£çš„å¤§å°å’Œæ‹¥å¡çª—å£ä¸€æ ·å¤§ã€‚ è¿‡ç¨‹è¯´æ˜ï¼š å½“TCPè¿æ¥è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼ŒæŠŠæ‹¥å¡çª—å£cwndç½®ä¸º1ã€‚ä¸ºäº†ä¾¿äºç†è§£ï¼Œå›¾ä¸­çš„çª—å£å•ä½ä¸ä½¿ç”¨å­—èŠ‚è€Œä½¿ç”¨æŠ¥æ–‡æ®µçš„ä¸ªæ•°ã€‚æ…¢å¼€å§‹é—¨é™çš„åˆå§‹å€¼è®¾ç½®ä¸º16ä¸ªæŠ¥æ–‡æ®µï¼Œå³ ssthresh= 16 ã€‚åœ¨æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•æ—¶ï¼Œæ‹¥å¡çª—å£ cwnd çš„åˆå§‹å€¼ä¸º1ã€‚ä»¥åå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªå¯¹æ–°æŠ¥æ–‡æ®µçš„ç¡®è®¤ACKï¼Œå°±æŠŠæ‹¥å¡çª—å£å€¼åŠ 1ï¼Œç„¶åå¼€å§‹ä¸‹ä¸€è½®çš„ä¼ è¾“ï¼ˆå›¾ä¸­æ¨ªåæ ‡ä¸ºä¼ è¾“è½®æ¬¡ï¼‰ã€‚å› æ­¤æ‹¥å¡çª—å£cwnd éšç€ä¼ è¾“è½®æ¬¡æŒ‰æŒ‡æ•°è§„å¾‹å¢é•¿ã€‚å½“æ‹¥å¡çª—å£cwndå¢é•¿åˆ°æ…¢å¼€å§‹é—¨é™å€¼ssthreshæ—¶ï¼ˆå³å½“cwnd=16æ—¶ï¼‰ï¼Œå°±æ”¹ä¸ºæ‰§è¡Œæ‹¥å¡æ§åˆ¶ç®—æ³•ï¼Œæ‹¥å¡çª—å£æŒ‰çº¿æ€§è§„å¾‹å¢é•¿ã€‚å‡å®šæ‹¥å¡çª—å£çš„æ•°å€¼å¢é•¿åˆ°24æ—¶ï¼Œç½‘ç»œå‡ºç°è¶…æ—¶ï¼ˆè¿™å¾ˆå¯èƒ½å°±æ˜¯ç½‘ç»œå‘ç”Ÿæ‹¥å¡äº†ï¼‰ã€‚æ›´æ–°åçš„ssthreshå€¼å˜ä¸º12ï¼ˆå³å˜ä¸ºå‡ºç°è¶…æ—¶æ—¶çš„æ‹¥å¡çª—å£æ•°å€¼ 24çš„ä¸€åŠï¼‰ï¼Œæ‹¥å¡çª—å£å†é‡æ–°è®¾ç½®ä¸º1ï¼Œå¹¶æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ã€‚å½“cwnd=ssthresh=12æ—¶æ”¹ä¸ºæ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼Œæ‹¥å¡çª—å£æŒ‰çº¿æ€§è§„å¾‹å¢é•¿ï¼Œæ¯ç»è¿‡ ä¸€ä¸ªå¾€è¿”æ—¶é—´å¢åŠ ä¸€ä¸ªMSSçš„å¤§å°ã€‚å¼ºè°ƒï¼šâ€œæ‹¥å¡é¿å…â€å¹¶éæŒ‡å®Œå…¨èƒ½å¤Ÿé¿å…äº†æ‹¥å¡ã€‚åˆ©ç”¨ä»¥ä¸Šçš„æªæ–½è¦å®Œå…¨é¿å…ç½‘ç»œæ‹¥å¡è¿˜æ˜¯ä¸å¯èƒ½çš„ã€‚â€œæ‹¥å¡é¿å…â€æ˜¯è¯´åœ¨æ‹¥å¡é¿å…é˜¶æ®µå°†æ‹¥å¡çª—å£æ§åˆ¶ä¸ºæŒ‰çº¿æ€§è§„å¾‹å¢é•¿ï¼Œä½¿ç½‘ç»œæ¯”è¾ƒä¸å®¹æ˜“å‡ºç°æ‹¥å¡ã€‚ å¿«é‡ä¼  åŸç† æ¥æ”¶æ–¹ï¼šæ¯æ”¶åˆ°ä¸€ä¸ªå¤±åºçš„æŠ¥æ–‡æ®µå å°±ç«‹å³å‘å‡ºé‡å¤ç¡®è®¤ï¼ˆä¸ºçš„æ˜¯ä½¿å‘é€æ–¹åŠæ—©çŸ¥é“æœ‰æŠ¥æ–‡æ®µæ²¡æœ‰åˆ°è¾¾å¯¹æ–¹ï¼‰ï¼Œè€Œä¸è¦ç­‰åˆ°è‡ªå·±å‘é€æ•°æ®æ—¶æ‰è¿›è¡Œæå¸¦ç¡®è®¤ã€‚ å‘é€æ–¹ï¼šåªè¦ä¸€è¿æ”¶åˆ°3ä¸ªé‡å¤ç¡®è®¤å°±ç«‹å³é‡ä¼ å¯¹æ–¹å°šæœªæ”¶åˆ°çš„æŠ¥æ–‡æ®µï¼Œè€Œä¸å¿…ç»§ç»­ç­‰å¾…è®¾ç½®çš„é‡ä¼ è®¡æ—¶å™¨åˆ°æœŸã€‚ ä½œç”¨ ç”±äºå‘é€æ–¹å°½æ—©é‡ä¼ æœªè¢«ç¡®è®¤çš„æŠ¥æ–‡æ®µï¼Œå› æ­¤é‡‡ç”¨å¿«é‡ä¼ åå¯ä»¥ä½¿æ•´ä¸ªç½‘ç»œååé‡æé«˜çº¦20%ã€‚ ç¤ºä¾‹ å¿«æ¢å¤ ä¸å¿«é‡ä¼ é…åˆä½¿ç”¨çš„è¿˜æœ‰å¿«æ¢å¤ç®—æ³•ï¼Œå…¶ä¸»è¦æœ‰ä»¥ä¸‹ä¸¤ä¸ªè¦ç‚¹ï¼š å½“å‘é€æ–¹è¿ç»­æ”¶åˆ°æ¥æ”¶æ–¹å‘æ¥çš„ä¸‰ä¸ªé‡å¤ç¡®è®¤æ—¶ï¼Œå°±æ‰§è¡Œâ€œä¹˜æ³•å‡å°â€ç®—æ³•ï¼ŒæŠŠæ…¢å¼€å§‹é—¨é™å‡åŠï¼ˆè¿™ä¸ªå‡åŠæŒ‡çš„æ˜¯å˜æˆå‘ç”Ÿé˜»å¡æ—¶çš„é˜»å¡çª—å£å¤§å°çš„ä¸€åŠï¼‰ï¼Œè¿™æ˜¯ä¸ºäº†é¢„é˜²ç½‘ç»œå‘ç”Ÿæ‹¥å¡ã€‚ï¼ˆæ³¨æ„ï¼šæ¥ä¸‹æ¥ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼‰ ç”±äºå‘é€æ–¹ç°åœ¨è®¤ä¸ºç½‘ç»œå¾ˆå¯èƒ½æ²¡æœ‰å‘ç”Ÿæ‹¥å¡ï¼Œå› æ­¤ç°åœ¨ä¸æ‰§è¡Œæ…¢å¼€å§‹ç®—æ³•ï¼Œè€Œæ˜¯æŠŠcwnd(æ‹¥å¡çª—å£)å€¼è®¾ç½®ä¸ºæ…¢å¼€å§‹é—¨é™å‡åŠåçš„å€¼ï¼Œç„¶åå¼€å§‹æ‰§è¡Œæ‹¥å¡é¿å…ç®—æ³•ï¼Œä½¿æ‹¥å¡çª—å£ç¼“æ…¢çš„çº¿æ€§å¢å¤§ã€‚ æ³¨ï¼šç”±äºè·³è¿‡äº†æ‹¥å¡çª—å£ï¼ˆcwndï¼‰ä»1èµ·å§‹çš„æ…¢å¼€å§‹è¿‡ç¨‹ï¼Œæ‰€ä»¥ç§°ä¸ºï¼šå¿«æ¢å¤ã€‚ æ­¤å¤„ç½‘ç»œä¸ä¼šå‘ç”Ÿç½‘ç»œæ‹¥å¡ï¼Œå› è‹¥æ‹¥å¡ï¼Œåˆ™ä¸ä¼šæ”¶åˆ°å¤šä¸ªé‡å¤ç¡®è®¤æŠ¥æ–‡ã€‚ ç¤ºä¾‹å¦‚ä¸‹å›¾ï¼š TCPå››ç§è®¡æ—¶å™¨ TCPä¸­æœ‰å››ç§è®¡æ—¶å™¨ï¼ˆTimerï¼‰ï¼Œåˆ†åˆ«ä¸ºï¼š é‡ä¼ è®¡æ—¶å™¨ï¼šRetransmission Timer åšæŒè®¡æ—¶å™¨ï¼šPersistent Timer ä¿æ´»è®¡æ—¶å™¨ï¼šKeeplive Timer æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ï¼šTimer_Wait Timer é‡ä¼ è®¡æ—¶å™¨ TCPæ˜¯å¯ä»¥ä¿è¯æ•°æ®å¯é ä¼ è¾“çš„ã€‚æ€ä¹ˆä¿è¯å‘¢ï¼Ÿå¸¦ç¡®è®¤çš„é‡ä¼ æœºåˆ¶ã€‚ åœ¨æ»‘åŠ¨çª—å£åè®®ä¸­ï¼Œæ¥æ”¶çª—å£ä¼šåœ¨è¿ç»­æ”¶åˆ°çš„åŒ…åºåˆ—ä¸­çš„æœ€åä¸€ä¸ªåŒ…å‘æ¥æ”¶ç«¯å‘é€ä¸€ä¸ªACKï¼Œå½“ç½‘ç»œæ‹¥å µçš„æ—¶å€™ï¼Œå‘é€ç«¯çš„æ•°æ®åŒ…å’Œæ¥æ”¶ç«¯çš„ACKåŒ…éƒ½æœ‰å¯èƒ½ä¸¢å¤±ã€‚ TCPä¸ºäº†ä¿è¯æ•°æ®å¯é ä¼ è¾“ï¼Œå°±è§„å®šåœ¨é‡ä¼ çš„â€œæ—¶é—´ç‰‡â€åˆ°äº†ä»¥åï¼Œå¦‚æœè¿˜æ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ACKï¼Œå°±é‡å‘æ­¤åŒ…ï¼Œä»¥é¿å…é™·å…¥æ— é™ç­‰å¾…ä¸­ã€‚ å½“TCPå‘é€æŠ¥æ–‡æ®µæ—¶ï¼Œå°±åˆ›å»ºè¯¥ç‰¹å®šæŠ¥æ–‡çš„é‡ä¼ è®¡æ—¶å™¨ã€‚å¯èƒ½å‘ç”Ÿä¸¤ç§æƒ…å†µï¼š 1ï¼‰è‹¥åœ¨è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´åˆ°ä¹‹å‰æ”¶åˆ°äº†å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡æ®µçš„ç¡®è®¤ï¼Œåˆ™æ’¤é”€æ­¤è®¡æ—¶å™¨ã€‚ 2ï¼‰è‹¥åœ¨æ”¶åˆ°äº†å¯¹æ­¤ç‰¹å®šæŠ¥æ–‡æ®µçš„ç¡®è®¤ä¹‹å‰è®¡æ—¶å™¨æˆªæ­¢æ—¶é—´åˆ°ï¼Œåˆ™é‡ä¼ æ­¤æŠ¥æ–‡æ®µï¼Œå¹¶å°†è®¡æ—¶å™¨å¤ä½ã€‚ åšæŒè®¡æ—¶å™¨ ä¸“é—¨å¯¹ä»˜é›¶çª—å£é€šçŸ¥è€Œè®¾ç«‹çš„ã€‚ å…ˆæ¥è€ƒè™‘ä¸€ä¸‹æƒ…æ™¯ï¼š å‘é€ç«¯å‘æ¥æ”¶ç«¯å‘é€æ•°æ®åŒ…çŸ¥é“æ¥æ”¶çª—å£å¡«æ»¡äº†ï¼Œç„¶åæ¥æ”¶çª—å£å‘Šè¯‰å‘é€æ–¹æ¥æ”¶çª—å£å¡«æ»¡äº†åœæ­¢å‘é€æ•°æ®ã€‚æ­¤æ—¶çš„çŠ¶æ€ç§°ä¸ºâ€œé›¶çª—å£â€çŠ¶æ€ï¼Œå‘é€ç«¯å’Œæ¥æ”¶ç«¯çª—å£å¤§å°å‡ä¸º0.ç›´åˆ°æ¥å—TCPå‘é€ç¡®è®¤å¹¶å®£å¸ƒä¸€ä¸ªéé›¶çš„çª—å£å¤§å°ã€‚ä½†è¿™ä¸ªç¡®è®¤ä¼šä¸¢å¤±ã€‚ æˆ‘ä»¬çŸ¥é“TCPä¸­ï¼Œå¯¹ç¡®è®¤æ˜¯ä¸éœ€è¦å‘é€ç¡®è®¤çš„ã€‚è‹¥ç¡®è®¤ä¸¢å¤±äº†ï¼Œæ¥å—TCPå¹¶ä¸çŸ¥é“ï¼Œè€Œæ˜¯ä¼šè®¤ä¸ºä»–å·²ç»å®Œæˆäº†ä»»åŠ¡ï¼Œå¹¶ç­‰å¾…ç€å‘é€TCPæ¥ç€ä¼šå‘é€æ›´å¤šçš„æŠ¥æ–‡æ®µã€‚ ä½†å‘é€TCPç”±äºæ²¡æœ‰æ”¶åˆ°ç¡®è®¤ï¼Œå°±ç­‰å¾…å¯¹æ–¹å‘é€ç¡®è®¤æ¥é€šçŸ¥çª—å£å¤§å°ã€‚åŒæ–¹çš„TCPéƒ½åœ¨æ°¸è¿œçš„ç­‰å¾…ç€å¯¹æ–¹ã€‚ è¦æ‰“å¼€è¿™ç§æ­»é”ï¼ŒTCPä¸ºæ¯ä¸€ä¸ªé“¾æ¥ä½¿ç”¨ä¸€ä¸ªæŒä¹…è®¡æ—¶å™¨ã€‚å½“å‘é€TCPæ”¶åˆ°çª—å£å¤§å°ä¸º0çš„ç¡®è®¤æ—¶ï¼Œå°±åšæŒå¯åŠ¨è®¡æ—¶å™¨ã€‚å½“åšæŒè®¡æ—¶å™¨æœŸé™åˆ°æ—¶ï¼Œå‘é€TCPå°±å‘é€ä¸€ä¸ªç‰¹æ®Šçš„æŠ¥æ–‡æ®µï¼Œå«åšæ¢æµ‹æŠ¥æ–‡ã€‚ è¿™ä¸ªæŠ¥æ–‡æ®µåªæœ‰ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ã€‚ä»–æœ‰ä¸€ä¸ªåºå·ï¼Œä½†ä»–çš„åºå·æ°¸è¿œä¸éœ€è¦ç¡®è®¤ï¼›ç”šè‡³åœ¨è®¡ç®—æœºå¯¹å…¶ä»–éƒ¨åˆ†çš„æ•°æ®çš„ç¡®è®¤æ—¶è¯¥åºå·ä¹Ÿè¢«å¿½ç•¥ã€‚æ¢æµ‹æŠ¥æ–‡æ®µæé†’æ¥å—TCPï¼šç¡®è®¤å·²ä¸¢å¤±ï¼Œå¿…é¡»é‡ä¼ ã€‚ åšæŒè®¡æ—¶å™¨çš„å€¼è®¾ç½®ä¸ºé‡ä¼ æ—¶é—´çš„æ•°å€¼ã€‚ä½†æ˜¯ï¼Œè‹¥æ²¡æœ‰æ”¶åˆ°ä»æ¥æ”¶ç«¯æ¥çš„å“åº”ï¼Œåˆ™éœ€å‘é€å¦ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼Œå¹¶å°†åšæŒè®¡æ—¶å™¨çš„å€¼åŠ å€å’Œå¤ä½ã€‚ å‘é€ç«¯ç»§ç»­å‘é€æ¢æµ‹æŠ¥æ–‡æ®µï¼Œå°†åšæŒè®¡æ—¶å™¨è®¾å®šçš„å€¼åŠ å€å’Œå¤ä½ï¼Œç›´åˆ°è¿™ä¸ªå€¼å¢å¤§åˆ°é—¨é™å€¼ï¼ˆé€šå¸¸æ˜¯60ç§’ï¼‰ä¸ºæ­¢ã€‚åœ¨è¿™ä»¥åï¼Œå‘é€ç«¯æ¯éš”60ç§’å°±å‘é€ä¸€ä¸ªæ¢æµ‹æŠ¥æ–‡ï¼Œç›´åˆ°çª—å£é‡æ–°æ‰“å¼€ã€‚ ä¿æ´»è®¡æ—¶å™¨ ä¿æ´»è®¡æ—¶å™¨ä½¿ç”¨åœ¨æŸäº›å®ç°ä¸­ï¼Œç”¨æ¥é˜²æ­¢åœ¨ä¸¤ä¸ªTCPä¹‹é—´çš„è¿æ¥å‡ºç°é•¿æ—¶é—´çš„ç©ºé—²ã€‚ å‡å®šå®¢æˆ·æ‰“å¼€äº†åˆ°æœåŠ¡å™¨çš„è¿æ¥ï¼Œä¼ é€äº†ä¸€äº›æ•°æ®ï¼Œç„¶åå°±ä¿æŒé™é»˜äº†ã€‚ä¹Ÿè®¸è¿™ä¸ªå®¢æˆ·å‡ºæ•…éšœäº†ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™ä¸ªè¿æ¥å°†æ°¸è¿œçš„å¤„äºæ‰“å¼€çŠ¶æ€ã€‚ è¦è§£å†³è¿™ç§é—®é¢˜ï¼Œåœ¨å¤§å¤šæ•°çš„å®ç°ä¸­éƒ½æ˜¯ä½¿æœåŠ¡å™¨è®¾ç½®ä¿æ´»è®¡æ—¶å™¨ã€‚æ¯å½“æœåŠ¡å™¨æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œå°±å°†è®¡æ—¶å™¨å¤ä½ã€‚é€šå¸¸è®¾ç½®ä¸ºä¸¤å°æ—¶ã€‚ è‹¥æœåŠ¡å™¨è¿‡äº†ä¸¤å°æ—¶è¿˜æ²¡æœ‰æ”¶åˆ°å®¢æˆ·çš„ä¿¡æ¯ï¼Œä»–å°±å‘é€æ¢æµ‹æŠ¥æ–‡æ®µã€‚è‹¥å‘é€äº†10ä¸ªæ¢æµ‹æŠ¥æ–‡æ®µï¼ˆæ¯ä¸€ä¸ªé—´éš”75ç§’ï¼‰è¿˜æ²¡æœ‰å“åº”ï¼Œå°±å‡å®šå®¢æˆ·ç«¯å‡ºäº†æ•…éšœï¼Œå› è€Œå°±ç»ˆæ­¢äº†è¯¥è¿æ¥ã€‚ è¿™ç§è¿æ¥çš„æ–­å¼€å½“ç„¶ä¸ä¼šä½¿ç”¨å››æ¬¡æ¡æ‰‹ï¼Œè€Œæ˜¯ç›´æ¥ç¡¬æ€§çš„ä¸­æ–­å’Œå®¢æˆ·ç«¯çš„TCPè¿æ¥ã€‚ æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨ æ—¶é—´ç­‰å¾…è®¡æ—¶å™¨æ˜¯åœ¨å››æ¬¡æŒ¥æ‰‹æ‰‹çš„æ—¶å€™ä½¿ç”¨çš„ã€‚å³åœ¨é‡Šæ”¾è¿æ¥çš„æœ€ç»ˆé˜¶æ®µï¼Œå®¢æˆ·ç«¯è¿˜è¦ç­‰å¾…2MSLï¼ˆMSL=maxinum segment lifetimeæœ€é•¿æŠ¥æ–‡ç”Ÿå­˜æ—¶é—´ï¼Œ2MSLå°±æ˜¯ä¸¤å€çš„MSLï¼‰æ‰èƒ½çœŸæ­£çš„å…³é—­è¿æ¥ã€‚ UDPåè®® å®šä¹‰ User Datagram Protocolï¼Œå³ ç”¨æˆ·æ•°æ®æŠ¥åè®®ï¼Œå±äº ä¼ è¾“å±‚é€šä¿¡åè®®ã€‚åŸºäºUDPçš„åº”ç”¨å±‚åè®®æœ‰ TFTPã€SNMP ä¸ DNSã€‚ ç‰¹ç‚¹ æ— è¿æ¥ï¼šä½¿ç”¨UDPä¼ è¾“æ•°æ®å‰ï¼Œä¸éœ€è¦å»ºç«‹UDPè¿æ¥ï¼Œå°±åƒå†™ä¿¡ï¼Œå†™å¥½ä¿¡äº¤ç»™é‚®å±€ï¼Œå…¶ä½™ä¸éœ€è¦ç®¡ã€‚ ä¸å¯é ï¼šUDPçš„æ•°æ®åŒ…å‘é€åï¼Œä¸ç®¡å…¶æ˜¯å¦ä¼šåˆ°è¾¾æ¥æ”¶æ–¹ï¼Œæ•…å¯èƒ½å‡ºç°ä¸¢åŒ…ç°è±¡ã€‚ é¢å‘æŠ¥æ–‡ï¼šæ•°æ®ä»¥æ•°æ®æŠ¥æ–‡(åŒ…)çš„å½¢å¼ä¼ è¾“ï¼ŒUDPæ•°æ®æŠ¥æ–‡é•¿åº¦æ— é™åˆ¶ï¼Œéƒ½ä¸€æ¬¡æ€§å‘é€ï¼Œä¸åƒTCPä¼šæ‹†åˆ†ã€‚ æ— æ‹¥å¡æ§åˆ¶ï¼šç”±äºæ˜¯ä¸å¯é ä¼ è¾“ï¼Œå³ä¸ç®¡æ˜¯å¦åˆ°è¾¾æ¥æ”¶æ–¹ï¼Œæ•…ä¸éœ€æ‹¥å¡æ§åˆ¶ã€‚ æŠ¥æ–‡æ®µæ ¼å¼ ä¼ªé¦–éƒ¨ï¼šè®¡ç®—æ£€éªŒå’Œï¼ˆä¸å‘ä¸‹ä¼ é€ï¼Œä¹Ÿä¸å‘ä¸Šé€’äº¤ï¼‰ã€‚ æºç«¯å£ï¼šéœ€è¦å¯¹æ–¹å›ä¿¡æ—¶ä½¿ç”¨ï¼Œå¦‚æœä¸éœ€è¦åˆ™è®¾ä¸ºå…¨0ã€‚ ç›®çš„ç«¯å£ï¼šç»ˆç‚¹äº¤ä»˜æŠ¥æ–‡æ—¶ç”¨åˆ°ã€‚ é•¿åº¦ï¼šUDPç”¨æˆ·æ•°æ®æŠ¥çš„é•¿åº¦ï¼Œæœ€å°å€¼æ˜¯8ï¼ˆä»…æœ‰é¦–éƒ¨ï¼‰ã€‚ æ£€éªŒå’Œï¼šæ£€æµ‹UDPç”¨æˆ·æ•°æ®æŠ¥åœ¨ä¼ è¾“ä¸­æ˜¯å¦æœ‰é”™ï¼Œè‹¥æœ‰é”™åˆ™ä¸¢å¼ƒã€‚ TCPã€UDPçš„åŒºåˆ« HTTPåè®® å®šä¹‰ HyperText Transfer Protocolï¼Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ï¼Œè§„å®šäº†åº”ç”¨è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡å‡†åˆ™ï¼Œå±äºåº”ç”¨å±‚åè®®ã€‚ ç‰¹ç‚¹ æ— è¿æ¥ï¼Œå³äº¤æ¢HTTPæŠ¥æ–‡å‰ï¼Œä¸éœ€è¦å»ºç«‹HTTPè¿æ¥ã€‚ æ— çŠ¶æ€ï¼Œå³æ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸­ä¸ä¿å­˜ä»»ä½•å†å²çŠ¶æ€ä¿¡æ¯ï¼Œè¯¥ç‰¹æ€§ç®€åŒ–äº†æœåŠ¡å™¨çš„è®¾è®¡ï¼Œä½¿æœåŠ¡å™¨æ›´å®¹æ˜“æ”¯æŒå¤§é‡å¹¶å‘çš„HTTPè¯·æ±‚ã€‚ ä¼ è¾“æ ¼å¼ç®€å•ï¼Œå³è¯·æ±‚æ—¶åªéœ€ä¼ é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„ã€‚ ä¼ è¾“å¯é æ€§é«˜ï¼Œé‡‡ç”¨TCPä½œä¸ºè¿è¾“å±‚åè®®ã€‚ å…¼å®¹æ€§å¥½ï¼Œæ”¯æŒB/Sã€C/Sæ¨¡å¼ã€‚ çµæ´»æ€§é«˜ï¼ŒHTTPå…è®¸ä¼ è¾“ä»»æ„ç±»å‹çš„æ•°æ®å¯¹è±¡ã€‚ å·¥ä½œæ–¹å¼ HTTPåè®®é‡‡ç”¨è¯·æ±‚/å“åº”çš„å·¥ä½œæ–¹å¼ï¼Œå…·ä½“å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š HTTPæŠ¥æ–‡ HTTPæŠ¥æ–‡åˆ†ä¸ºï¼šè¯·æ±‚æŠ¥æ–‡ã€å“åº”æŠ¥æ–‡ã€‚ è¯·æ±‚æŠ¥æ–‡ HTTPçš„è¯·æ±‚æŠ¥æ–‡ç”±è¯·æ±‚è¡Œã€è¯·æ±‚å¤´ã€è¯·æ±‚ä½“ç»„æˆã€‚å¦‚ä¸‹å›¾ï¼š è¯·æ±‚è¡Œ è¯·æ±‚è¡Œ = è¯·æ±‚æ–¹æ³• + è¯·æ±‚è·¯å¾„ + åè®®ç‰ˆæœ¬ ç”¨äºå£°æ˜ è¯·æ±‚æ–¹æ³• ã€ä¸»æœºåŸŸåã€èµ„æºè·¯å¾„ ã€åè®®ç‰ˆæœ¬ã€‚ å„éƒ¨åˆ†ç»„æˆä»‹ç»å¦‚ä¸‹å›¾ï¼š è¯·æ±‚å¤´ ä¸»è¦ç”¨äºå£°æ˜å®¢æˆ·ç«¯ã€æœåŠ¡å™¨/æŠ¥æ–‡çš„éƒ¨åˆ†ä¿¡æ¯ã€‚é‡‡ç”¨header(å­—æ®µå):value(å€¼)çš„æ–¹å¼ã€‚ è¯·æ±‚å’Œå“åº”æŠ¥æ–‡çš„é€šç”¨Header åç§° ä½œç”¨ Content-Type è¯·æ±‚ä½“/å“åº”ä½“çš„ç±»å‹ï¼Œå¦‚ï¼štext/plainã€application/json Accept è¯´æ˜æ¥æ”¶çš„ç±»å‹ï¼Œå¯ä»¥å¤šä¸ªå€¼ï¼Œç”¨ï¼Œï¼ˆåŠè§’é€—å·ï¼‰åˆ†å¼€ Content-Length è¯·æ±‚ä½“/å“åº”ä½“çš„é•¿åº¦ï¼Œå•ä½å­—èŠ‚ Content-Encoding è¯·æ±‚ä½“/å“åº”ä½“çš„ç¼–ç æ ¼å¼ï¼Œå¦‚gzip,deflate Accept-Encoding å‘ŠçŸ¥å¯¹æ–¹æˆ‘æ–¹æ¥å—çš„Content-Encoding ETag ç»™å½“å‰èµ„æºçš„æ ‡è¯†ï¼Œå’ŒLast-Modifiedã€If-None-Matchã€If-Modified-Since é…åˆï¼Œç”¨äºç¼“å­˜æ§åˆ¶ Cache-Control å–å€¼ä¸ºä¸€èˆ¬ä¸ºno-cacheæˆ–max-age=Xxï¼ŒXXä¸ºä¸ªæ•´æ•°ï¼Œè¡¨ç¤ºè¯¥èµ„æºç¼“å­˜æœ‰æ•ˆæœŸï¼ˆç§’) å¸¸è§çš„è¯·æ±‚Header åç§° ä½œç”¨ Authorization ç”¨äºè®¾ç½®èº«ä»½è®¤è¯ä¿¡æ¯ User-Agent ç”¨æˆ·æ ‡è¯†ï¼Œå¦‚ï¼šOSå’Œæµè§ˆå™¨çš„ç±»å‹å’Œç‰ˆæœ¬ If-Modified-Since å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„Last-Modifiedå€¼ï¼Œç”¨äºç¡®è®¤æŸä¸ªèµ„æºæ˜¯å¦è¢«æ›´æ”¹è¿‡ï¼Œæ²¡æœ‰æ›´æ”¹è¿‡ï¼ˆ304ï¼‰å°±ä»ç¼“å­˜ä¸­è¯»å– If-None-Match å€¼ä¸ºä¸Šä¸€æ¬¡æœåŠ¡å™¨è¿”å›çš„ETagå€¼ï¼Œä¸€èˆ¬ä¼šå’ŒIf-Modified-Sinceä¸€èµ·å‡ºç° Cookie å·²æœ‰çš„Cookie Referer è¡¨ç¤ºè¯·æ±‚å¼•ç”¨è‡ªå“ªä¸ªåœ°å€ï¼Œæ¯”å¦‚ä½ ä»é¡µé¢Aè·³è½¬åˆ°é¡µé¢Bæ—¶ï¼Œå€¼ä¸ºé¡µé¢Açš„åœ°å€ Host è¯·æ±‚çš„ä¸»æœºå’Œç«¯å£å· è¯·æ±‚ä½“ ä¸»è¦ç”¨äºå­˜æ”¾éœ€å‘é€ç»™æœåŠ¡å™¨çš„æ•°æ®ä¿¡æ¯ã€‚ ä½¿ç”¨æ–¹å¼å…±3ç§ï¼Œå¦‚ä¸‹å›¾ï¼š å“åº”æŠ¥æ–‡ HTTPå“åº”æŠ¥æ–‡åŒ…æ‹¬ï¼šçŠ¶æ€è¡Œã€å“åº”å¤´ã€å“åº”ä½“ã€‚ç»“æ„å¦‚ä¸‹å›¾ï¼š çŠ¶æ€è¡Œ çŠ¶æ€è¡Œ = åè®®ç‰ˆæœ¬ + çŠ¶æ€ç  + çŠ¶æ€ä¿¡æ¯ç»„æˆ ä¸»è¦ç”¨äºå£°æ˜åè®®ç‰ˆæœ¬ã€çŠ¶æ€ç ã€çŠ¶æ€ç æè¿°ã€‚ å„éƒ¨åˆ†ç»„æˆå…·ä½“ä»‹ç»å¦‚ä¸‹ï¼š å“åº”å¤´ ä¸»è¦ç”¨äºå£°æ˜å®¢æˆ·ç«¯ã€æœåŠ¡å™¨/æŠ¥æ–‡çš„éƒ¨åˆ†ä¿¡æ¯ã€‚é‡‡ç”¨header(å­—æ®µå):value(å€¼)çš„æ–¹å¼ã€‚ å¸¸è§å“åº”Header åç§° ä½œç”¨ Date æœåŠ¡å™¨çš„æ—¥æœŸ Last-Modified è¯¥èµ„æºæœ€åè¢«ä¿®æ”¹æ—¶é—´ Transfer-Encoding å–å€¼ä¸ºä¸€èˆ¬ä¸ºchunkedï¼Œå‡ºç°åœ¨Content-Lengthä¸èƒ½ç¡®å®šçš„æƒ…å†µä¸‹ï¼Œè¡¨ç¤ºæœåŠ¡å™¨ä¸çŸ¥é“å“åº”ç‰ˆä½“çš„æ•°æ®å¤§å°ï¼Œä¸€èˆ¬åŒæ—¶è¿˜ä¼šå‡ºç°Content-Encoding å“åº”å¤´ Set-Cookie è®¾ç½®Cookie Location é‡å®šå‘åˆ°å¦ä¸€ä¸ªURLï¼Œå¦‚è¾“å…¥æµè§ˆå™¨å°±è¾“å…¥baidu.comå›è½¦ï¼Œä¼šè‡ªåŠ¨è·³åˆ°https://www.baidu.comï¼Œå°±æ˜¯é€šè¿‡è¿™ä¸ªå“åº”å¤´æ§åˆ¶çš„ Server åå°æœåŠ¡å™¨ å“åº”ä½“ ä¸»è¦ç”¨äºå­˜æ”¾éœ€è¿”å›ç»™å®¢æˆ·ç«¯çš„æ•°æ®ä¿¡æ¯ã€‚ä½¿ç”¨æ–¹å¼åŒè¯·æ±‚æŠ¥æ–‡çš„è¯·æ±‚ä½“ã€‚ HTTP1.1 ä¸ HTTP1.0çš„åŒºåˆ« Http1.1 æ¯” Http1.0 å¤šäº†ä»¥ä¸‹ä¼˜ç‚¹ï¼š å¼•å…¥æŒä¹…è¿æ¥ï¼Œå³ åœ¨åŒä¸€ä¸ªTCPçš„è¿æ¥ä¸­å¯ä¼ é€å¤šä¸ªHTTPè¯·æ±‚ &amp; å“åº”ï¼› å¤šä¸ªè¯·æ±‚ &amp; å“åº”å¯åŒæ—¶è¿›è¡Œã€å¯é‡å ï¼› å¼•å…¥æ›´åŠ å¤šçš„è¯·æ±‚å¤´ &amp; å“åº”å¤´ï¼› å…¶ä»–çŸ¥è¯† æµè§ˆå™¨ä¸­è¾“å…¥URLåˆ°é¡µé¢è¿”å›çš„å…¨è¿‡ç¨‹ æ€»å…±åˆ†ä¸º7ä¸ªæ­¥éª¤ï¼Œæµç¨‹å¦‚ä¸‹å›¾ï¼š ç¬¬ä¸€æ­¥ï¼šåŸŸåè§£æ æµè§ˆå™¨æŸ¥æ‰¾æµè§ˆå™¨ç¼“å­˜ï¼Œå¦‚æœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ æµè§ˆå™¨æŸ¥çœ‹æœ¬æœºçš„hostæ–‡ä»¶ï¼Œå¦‚æœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ ç„¶åæ˜¯è·¯ç”±å™¨ç¼“å­˜ï¼Œè·¯ç”±å™¨ä¸€èˆ¬æœ‰è‡ªå·±çš„ç¼“å­˜ï¼Œå¦‚æœæœ‰åŸŸåå¯¹åº”çš„IPåœ°å€åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰ç»§ç»­æŸ¥æ‰¾ã€‚ æ¥ç€æ˜¯å¯¹æœ¬åœ°DNSæœåŠ¡å™¨è¿›è¡Œé€’å½’æŸ¥è¯¢ï¼Œçœ‹æ˜¯å¦æœ‰åŸŸåå¯¹åº”çš„IPã€‚ä¸»æœºå‘æœ¬åœ°åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨é€’å½’æŸ¥è¯¢ã€‚æ‰€è°“é€’å½’æŸ¥è¯¢å°±æ˜¯å¦‚æœä¸»æœºæ‰€è¯¢é—®çš„æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸çŸ¥é“è¢«æŸ¥è¯¢åŸŸåçš„IPåœ°å€ï¼Œé‚£ä¹ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨å°±ä»¥DNSå®¢æˆ·çš„èº«ä»½ï¼Œå‘å…¶ä»–æ ¹åŸŸåæœåŠ¡å™¨ç»§ç»­å‘å‡ºæŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡ï¼Œè€Œä¸æ˜¯è®©è¯¥ä¸»æœºè‡ªå·±è¿›è¡Œä¸‹ä¸€æ­¥æŸ¥è¯¢ã€‚ï¼ˆæœ¬åœ°åŸŸåæœåŠ¡å™¨åœ°å€æ˜¯é€šè¿‡DHPCåè®®è·å–åœ°å€ï¼ŒDHPCæ˜¯è´Ÿè´£åˆ†é…IPåœ°å€çš„ï¼‰ æœ¬åœ°åŸŸåæœåŠ¡å™¨é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ï¼Œå®ƒå…ˆå‘ä¸€ä¸ªæ ¹åŸŸåæœåŠ¡å™¨æŸ¥è¯¢ã€‚æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æ ¹åŸŸåæœåŠ¡å™¨çš„æŸ¥è¯¢ä¸€èˆ¬éƒ½æ˜¯é‡‡ç”¨è¿­ä»£æŸ¥è¯¢ã€‚æ‰€è°“è¿­ä»£æŸ¥è¯¢å°±æ˜¯å½“æ ¹åŸŸåæœåŠ¡å™¨æ”¶åˆ°æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘å‡ºçš„æŸ¥è¯¢è¯·æ±‚æŠ¥æ–‡åï¼Œè¦ä¹ˆå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ä¸‹ä¸€æ­¥åº”è¯¥æŸ¥è¯¢å“ªä¸€ä¸ªåŸŸåæœåŠ¡å™¨ï¼Œç„¶åæœ¬åœ°æœåŠ¡å™¨è‡ªå·±è¿›è¡Œåç»­çš„æŸ¥è¯¢ã€‚ï¼ˆè€Œä¸æ˜¯æ›¿ä»£æœ¬åœ°æœåŠ¡å™¨è¿›è¡Œåç»­æŸ¥è¯¢ï¼‰ã€‚ æ ¹åŸŸåæœåŠ¡å™¨å‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”æŸ¥è¯¢çš„é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comè¿›è¡ŒæŸ¥è¯¢ã€‚ é¡¶çº§åŸŸåæœåŠ¡å™¨dns.comå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œä¸‹ä¸€æ¬¡åº”æŸ¥è¯¢çš„æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨å‘æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comè¿›è¡ŒæŸ¥è¯¢ã€‚ æƒé™åŸŸåæœåŠ¡å™¨dns.baidu.comå‘Šè¯‰æœ¬åœ°åŸŸåæœåŠ¡å™¨ï¼Œæ‰€æŸ¥è¯¢çš„ä¸»æœºwww.baidu.comçš„IPåœ°å€ã€‚ æœ¬åœ°åŸŸåæœåŠ¡å™¨æœ€åæŠŠæŸ¥è¯¢ç»“æœå‘Šè¯‰ä¸»æœºã€‚ ç¬¬äºŒæ­¥ï¼šå»ºç«‹TCPè¿æ¥ï¼Œä¸‰æ¬¡æ¡æ‰‹ ç¬¬ä¸‰æ­¥ï¼šWebæµè§ˆå™¨å‘WebæœåŠ¡ç«¯å‘é€HTTPè¯·æ±‚æŠ¥æ–‡ ç¬¬å››æ­¥ï¼šæœåŠ¡å™¨å“åº”HTTPè¯·æ±‚ ç¬¬äº”æ­¥ï¼šæµè§ˆå™¨è§£æHTMLä»£ç ï¼Œå¹¶è¯·æ±‚HTMLä»£ç ä¸­çš„èµ„æºï¼ˆJSï¼ŒCSSï¼Œå›¾ç‰‡ï¼‰ï¼ˆè¿™æ˜¯è‡ªåŠ¨å‘æœåŠ¡å™¨è¯·æ±‚ä¸‹è½½çš„ï¼‰ ç¬¬å…­æ­¥ï¼šæµè§ˆå™¨å¯¹é¡µé¢è¿›è¡Œæ¸²æŸ“å‘ˆç°ç»™å®¢æˆ· ç¬¬ä¸ƒæ­¥ï¼šæ–­å¼€TCPè¿æ¥ï¼Œå››æ¬¡æŒ¥æ‰‹ IPåœ°å€(IPV4) å®šä¹‰ è¿æ¥åœ¨Internetä¸­çš„æ¯ä¸€å°ä¸»æœºï¼ˆæˆ– è·¯ç”±å™¨ï¼‰çš„å…¨çƒå”¯ä¸€çš„æ ‡è¯†ç¬¦ã€‚ ç»„æˆ IPåœ°å€ = 32ä½ = ç½‘ç»œå· + ä¸»æœºå·ï¼›å³IPåœ°å€::={&lt;ç½‘ç»œå·&gt;ï¼Œ&lt;ä¸»æœºå·&gt;} ç½‘ç»œå·ï¼šæ ‡å¿—ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰æ‰€è¿æ¥åˆ°çš„ç½‘ç»œã€‚ä¸€ä¸ªç½‘ç»œå·åœ¨æ•´ä¸ªå› ç‰¹ç½‘èŒƒå›´å†…å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸»æœºå·ï¼šæ ‡å¿—è¯¥ä¸»æœºï¼ˆæˆ–è·¯ç”±å™¨ï¼‰ã€‚ä¸€ä¸ªä¸»æœºå·åœ¨å®ƒé¢å‰çš„ç½‘ç»œå·æ‰€æŒ‡æ˜çš„ç½‘ç»œèŒƒå›´å¿…é¡»æ˜¯å”¯ä¸€çš„ã€‚ ä¸åŒç±»å‹çš„IPåœ°å€ï¼Œå…¶ä¸»æœºå· &amp; ç½‘ç»œå·æ‰€å å­—èŠ‚æ•°ä¸åŒï¼›æ•…ï¼šä¸€ä¸ªIPåœ°å€åœ¨æ•´ä¸ªç½‘ç»œèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ã€‚ åˆ†ç±» ä¼ ç»Ÿçš„IPåœ°å€æ˜¯åˆ†ç±»çš„åœ°å€ï¼Œåˆ†ä¸ºAï¼ŒBï¼ŒCï¼ŒDï¼ŒEäº”ç±»ï¼ŒåŒºåˆ«åœ¨äºç½‘ç»œå· &amp; ä¸»æœºå·å çš„å­—èŠ‚æ•°ä¸åŒã€‚ ç‰¹åˆ«æ³¨æ„ï¼šåœ¨å„ç±»IPåœ°å€ä¸­ï¼Œæœ‰ä¸€äº›IPåœ°å€ç”¨äºç‰¹æ®Šç”¨é€”ï¼Œä¸èƒ½ç”¨äºåšä¸»æœºIPåœ°å€ Cookieä¸Session document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>è®¡ç®—æœºåŸºç¡€</category>
      </categories>
      <tags>
        <tag>è®¡ç®—æœºåŸºç¡€</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMç±»åŠ è½½æœºåˆ¶]]></title>
    <url>%2Fposts%2Fde06556f.html</url>
    <content type="text"><![CDATA[ç±»åŠ è½½æ—¶æœº ç±»çš„ç”Ÿå‘½å‘¨æœŸ ä¸€ä¸ªç±»ä»åŠ è½½è¿›å†…å­˜åˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ï¼Œä¸€å…±ç»å†7ä¸ªé˜¶æ®µï¼š &lt;span id="inline-blue"&gt; åŠ è½½â€”â€”&gt;éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æâ€”â€”&gt;åˆå§‹åŒ–â€”â€”&gt;ä½¿ç”¨â€”â€”&gt;å¸è½½ &lt;/span&gt; å…¶ä¸­ï¼Œç±»åŠ è½½åŒ…æ‹¬5ä¸ªé˜¶æ®µï¼š &lt;span id="inline-green"&gt; åŠ è½½â€”â€”&gt;éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æâ€”â€”&gt;åˆå§‹åŒ– &lt;/span&gt; åœ¨ç±»åŠ è½½çš„è¿‡ç¨‹ä¸­ï¼Œä»¥ä¸‹3ä¸ªè¿‡ç¨‹ç§°ä¸ºè¿æ¥ï¼š &lt;span id="inline-purple"&gt; éªŒè¯â€”â€”&gt;å‡†å¤‡â€”â€”&gt;è§£æ &lt;/span&gt; å› æ­¤ï¼ŒJVMçš„ç±»åŠ è½½è¿‡ç¨‹ä¹Ÿå¯ä»¥æ¦‚æ‹¬ä¸º3ä¸ªè¿‡ç¨‹ï¼š &lt;span id="inline-yellow"&gt; åŠ è½½â€”â€”&gt;è¿æ¥â€”â€”&gt;åˆå§‹åŒ– &lt;/span&gt; C/C++åœ¨è¿è¡Œå‰éœ€è¦å®Œæˆé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ï¼›è€Œåœ¨Javaä¸­ï¼Œç±»åŠ è½½(åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–)æ˜¯åœ¨ç¨‹åºè¿è¡ŒæœŸé—´å®Œæˆçš„ã€‚ åœ¨ç¨‹åºè¿è¡ŒæœŸé—´è¿›è¡Œç±»åŠ è½½ä¼šç¨å¾®å¢åŠ ç¨‹åºçš„å¼€é”€ï¼Œä½†éšä¹‹ä¼šå¸¦æ¥æ›´å¤§çš„å¥½å¤„â€”â€”æé«˜ç¨‹åºçš„çµæ´»æ€§ã€‚Javaè¯­è¨€çš„çµæ´»æ€§ä½“ç°åœ¨å®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸé—´&lt;span id="inline-blue"&gt;åŠ¨æ€æ‰©å±•&lt;/span&gt;ï¼Œæ‰€è°“åŠ¨æ€æ‰©å±•å°±æ˜¯åœ¨è¿è¡ŒæœŸé—´&lt;span id="inline-blue"&gt;åŠ¨æ€åŠ è½½&lt;/span&gt;å’Œ&lt;span id="inline-blue"&gt;åŠ¨æ€è¿æ¥&lt;/span&gt;ã€‚ ç±»åŠ è½½çš„æ—¶æœº ç±»åŠ è½½è¿‡ç¨‹ä¸­æ¯ä¸ªæ­¥éª¤çš„é¡ºåº ç±»åŠ è½½çš„è¿‡ç¨‹åŒ…æ‹¬ï¼šåŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ï¼Œè¿æ¥åˆåˆ†ä¸ºï¼šéªŒè¯ã€å‡†å¤‡ã€è§£æï¼Œæ‰€ä»¥è¯´ç±»åŠ è½½ä¸€å…±åˆ†ä¸º5æ­¥ï¼šåŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€è§£æã€åˆå§‹åŒ–ã€‚ å…¶ä¸­åŠ è½½ã€éªŒè¯ã€å‡†å¤‡ã€åˆå§‹åŒ–çš„å¼€å§‹é¡ºåºæ˜¯ä¾æ¬¡è¿›è¡Œçš„ï¼Œè¿™äº›æ­¥éª¤å¼€å§‹ä¹‹åçš„è¿‡ç¨‹å¯èƒ½ä¼šæœ‰é‡å ã€‚ è€Œè§£æè¿‡ç¨‹ä¼šå‘ç”Ÿåœ¨åˆå§‹åŒ–è¿‡ç¨‹ä¸­ã€‚ ç±»åŠ è½½è¿‡ç¨‹ä¸­â€œåˆå§‹åŒ–â€å¼€å§‹çš„æ—¶æœº JVMè§„èŒƒä¸­åªå®šä¹‰äº†ç±»åŠ è½½è¿‡ç¨‹ä¸­åˆå§‹åŒ–è¿‡ç¨‹å¼€å§‹çš„æ—¶æœºï¼ŒåŠ è½½ã€è¿æ¥è¿‡ç¨‹éƒ½åº”è¯¥åœ¨åˆå§‹åŒ–ä¹‹å‰å¼€å§‹(è§£æé™¤å¤–)ï¼Œè¿™äº›è¿‡ç¨‹å…·ä½“åœ¨ä½•æ—¶å¼€å§‹ï¼ŒJVMè§„èŒƒå¹¶æ²¡æœ‰å®šä¹‰ï¼Œä¸åŒçš„è™šæ‹Ÿæœºå¯ä»¥æ ¹æ®å…·ä½“çš„éœ€æ±‚è‡ªå®šä¹‰ã€‚ &lt;span id="inline-purple"&gt; åˆå§‹åŒ–å¼€å§‹çš„æ—¶æœºï¼š&lt;/span&gt; åœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¦‚ä¸‹å­—èŠ‚ç æŒ‡ä»¤æ—¶ï¼Œå¦‚æœç±»å°šæœªåˆå§‹åŒ–ï¼Œé‚£å°±è¦è¿›è¡Œåˆå§‹åŒ–ï¼šnewã€getstaticã€putstaticã€invokestaticã€‚è¿™å››ä¸ªæŒ‡ä»¤å¯¹åº”çš„Javaä»£ç åœºæ™¯æ˜¯ï¼š é€šè¿‡newåˆ›å»ºå¯¹è±¡ï¼› è¯»å–ã€è®¾ç½®ä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å˜é‡(ä¸åŒ…æ‹¬finalä¿®é¥°çš„é™æ€å˜é‡)ï¼› è°ƒç”¨ä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å‡½æ•°ã€‚ ä½¿ç”¨java.lang.reflectè¿›è¡Œåå°„è°ƒç”¨çš„æ—¶å€™ï¼Œå¦‚æœç±»æ²¡æœ‰åˆå§‹åŒ–ï¼Œé‚£å°±éœ€è¦åˆå§‹åŒ–ï¼› å½“åˆå§‹åŒ–ä¸€ä¸ªç±»çš„æ—¶å€™ï¼Œè‹¥å…¶çˆ¶ç±»å°šæœªåˆå§‹åŒ–ï¼Œé‚£å°±å…ˆè¦è®©å…¶çˆ¶ç±»åˆå§‹åŒ–ï¼Œç„¶åå†åˆå§‹åŒ–æœ¬ç±»ï¼› å½“è™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œè™šæ‹Ÿæœºä¼šé¦–å…ˆåˆå§‹åŒ–å¸¦æœ‰mainæ–¹æ³•çš„ç±»ï¼Œå³ä¸»ç±»ï¼› å½“ä½¿ç”¨ JDK 1.7 çš„åŠ¨æ€è¯­è¨€æ”¯æŒæ—¶ï¼Œå¦‚æœä¸€ä¸ª java.lang.invoke.MethodHandle å®ä¾‹æœ€åçš„è§£æç»“æœ REF_getStaticã€REF_putStaticã€REF_invokeStatic çš„æ–¹æ³•å¥æŸ„ï¼Œå¹¶ä¸”è¿™ä¸ªæ–¹æ³•å¥æŸ„æ‰€å¯¹åº”çš„ç±»æ²¡æœ‰è¿›è¡Œè¿‡åˆå§‹åŒ–ï¼Œåˆ™éœ€å…ˆè§¦å‘å…¶åˆå§‹åŒ–ã€‚ ä¸»åŠ¨å¼•ç”¨ ä¸ è¢«åŠ¨å¼•ç”¨ JVMè§„èŒƒä¸­è¦æ±‚åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œâ€œå½“ä¸”ä»…å½“â€å‡ºç°ä¸Šè¿°4ä¸ªæ¡ä»¶ä¹‹ä¸€çš„æƒ…å†µæ‰ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ã€‚å¦‚æœé—´æ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–æ¡ä»¶æ˜¯ä¸ä¼šåˆå§‹åŒ–ç±»çš„ã€‚ å…¶ä¸­ï¼Œç›´æ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–æ¡ä»¶çš„æƒ…å†µå«åšä¸»åŠ¨å¼•ç”¨ï¼›é—´æ¥æ»¡è¶³ä¸Šè¿°åˆå§‹åŒ–è¿‡ç¨‹çš„æƒ…å†µå«åšè¢«åŠ¨å¼•ç”¨ã€‚ é‚£ä¹ˆï¼Œåªæœ‰å½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ»¡è¶³ä¸»åŠ¨å¼•ç”¨çš„æ—¶å€™æ‰ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ï¼Œè‹¥æ»¡è¶³è¢«åŠ¨å¼•ç”¨å°±ä¸ä¼šåˆå§‹åŒ–ä¸€ä¸ªç±»ã€‚ è¢«åŠ¨å¼•ç”¨çš„åœºæ™¯ç¤ºä¾‹ ç¤ºä¾‹ä¸€ 12345678910111213141516public class Fu{ public static String name = "ç±»åˆå§‹åŒ–çš„æ—¶æœº"; static{ System.out.println("çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼"); }}public class Zi{ static{ System.out.println("å­ç±»è¢«åˆå§‹åŒ–ï¼"); }}public static void main(String[] args){ System.out.println(Zi.name);} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; 12çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼ ç±»åˆå§‹åŒ–çš„æ—¶æœº &lt;span id="inline-green"&gt; åŸå› åˆ†æï¼š &lt;/span&gt; æœ¬ç¤ºä¾‹çœ‹ä¼¼æ»¡è¶³åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€æ¡ï¼šå½“è¦è·å–æŸä¸€ä¸ªç±»çš„é™æ€æˆå‘˜å˜é‡çš„æ—¶å€™å¦‚æœè¯¥ç±»å°šæœªåˆå§‹åŒ–ï¼Œåˆ™å¯¹è¯¥ç±»è¿›è¡Œåˆå§‹åŒ–ã€‚ ä½†ç”±äºè¿™ä¸ªé™æ€æˆå‘˜å˜é‡å±äºFuç±»ï¼ŒZiç±»åªæ˜¯é—´æ¥è°ƒç”¨Fuç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡ï¼Œå› æ­¤Ziç±»è°ƒç”¨nameå±æ€§å±äºé—´æ¥å¼•ç”¨ï¼Œè€ŒFuç±»è°ƒç”¨nameå±æ€§å±äºç›´æ¥å¼•ç”¨ï¼Œç”±äºJVMåªåˆå§‹åŒ–ç›´æ¥å¼•ç”¨çš„ç±»ï¼Œå› æ­¤åªæœ‰Fuç±»è¢«åˆå§‹åŒ–ã€‚ ç¤ºä¾‹äºŒ 12345public class Test{ public static void main(String[] args){ Fu[] arr = new Fu[10]; }} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; å¹¶æ²¡æœ‰è¾“å‡ºâ€œçˆ¶ç±»è¢«åˆå§‹åŒ–ï¼â€ &lt;span id="inline-green"&gt; åŸå› åˆ†æï¼š &lt;/span&gt; è¿™ä¸ªè¿‡ç¨‹çœ‹ä¼¼æ»¡è¶³åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€æ¡ï¼šé‡åˆ°newåˆ›å»ºå¯¹è±¡æ—¶è‹¥ç±»æ²¡è¢«åˆå§‹åŒ–ï¼Œåˆ™åˆå§‹åŒ–è¯¥ç±»ã€‚ ä½†ç°åœ¨é€šè¿‡newè¦åˆ›å»ºçš„æ˜¯ä¸€ä¸ªæ•°ç»„å¯¹è±¡ï¼Œè€ŒéFuç±»å¯¹è±¡ï¼Œå› æ­¤ä¹Ÿå±äºé—´æ¥å¼•ç”¨ï¼Œä¸ä¼šåˆå§‹åŒ–Fuç±»ã€‚ ç¤ºä¾‹ä¸‰ 123456789101112public class Fu{ public static final String name = "ç±»åˆå§‹åŒ–çš„æ—¶æœº"; static{ System.out.println("çˆ¶ç±»è¢«åˆå§‹åŒ–ï¼"); }}public class Son{ public static void main(String[] args){ System.out.println(Fu.name); }} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; ç±»åˆå§‹åŒ–çš„æ—¶æœº &lt;span id="inline-green"&gt; åŸå› åˆ†æï¼š &lt;/span&gt; æœ¬ç¤ºä¾‹çœ‹ä¼¼æ»¡è¶³ç±»åˆå§‹åŒ–æ—¶æœºçš„ç¬¬ä¸€ä¸ªæ¡ä»¶ï¼šè·å–ä¸€ä¸ªç±»é™æ€æˆå‘˜å˜é‡çš„æ—¶å€™è‹¥ç±»å°šæœªåˆå§‹åŒ–åˆ™åˆå§‹åŒ–ç±»ã€‚ ä½†æ˜¯ï¼ŒFuç±»çš„é™æ€æˆå‘˜å˜é‡è¢«finalä¿®é¥°ï¼Œå®ƒå·²ç»æ˜¯ä¸€ä¸ªå¸¸é‡ã€‚è¢«finalä¿®é¥°çš„å¸¸é‡åœ¨Javaä»£ç ç¼–è¯‘çš„è¿‡ç¨‹ä¸­å°±ä¼šè¢«æ”¾å…¥å®ƒè¢«å¼•ç”¨çš„classæ–‡ä»¶çš„å¸¸é‡æ± ä¸­(è¿™é‡Œæ˜¯Açš„å¸¸é‡æ± )ã€‚æ‰€ä»¥ç¨‹åºåœ¨è¿è¡ŒæœŸé—´å¦‚æœéœ€è¦è°ƒç”¨è¿™ä¸ªå¸¸é‡ï¼Œç›´æ¥å»å½“å‰ç±»çš„å¸¸é‡æ± ä¸­å–ï¼Œè€Œä¸éœ€è¦åˆå§‹åŒ–è¿™ä¸ªç±»ã€‚ æ¥å£çš„åˆå§‹åŒ– æ¥å£å’Œç±»éƒ½éœ€è¦åˆå§‹åŒ–ï¼Œæ¥å£å’Œç±»çš„åˆå§‹åŒ–è¿‡ç¨‹åŸºæœ¬ä¸€æ ·ï¼Œä¸åŒç‚¹åœ¨äºï¼šç±»åˆå§‹åŒ–æ—¶ï¼Œå¦‚æœå‘ç°çˆ¶ç±»å°šæœªè¢«åˆå§‹åŒ–ï¼Œåˆ™å…ˆè¦åˆå§‹åŒ–çˆ¶ç±»ï¼Œç„¶åå†åˆå§‹åŒ–è‡ªå·±ï¼›ä½†æ¥å£åˆå§‹åŒ–æ—¶ï¼Œå¹¶ä¸è¦æ±‚çˆ¶æ¥å£å·²ç»å…¨éƒ¨åˆå§‹åŒ–ï¼Œåªæœ‰ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ç”¨åˆ°å½“çˆ¶æ¥å£ä¸­çš„ä¸œè¥¿æ—¶æ‰åˆå§‹åŒ–çˆ¶æ¥å£ã€‚ ç±»åŠ è½½çš„è¿‡ç¨‹ åŠ è½½ &lt;font color="red"&gt;æ³¨æ„ï¼šâ€œåŠ è½½â€æ˜¯â€œç±»åŠ è½½â€è¿‡ç¨‹çš„ç¬¬ä¸€æ­¥ï¼Œåƒä¸‡ä¸è¦æ··æ·†ã€‚&lt;/font&gt; åŠ è½½çš„è¿‡ç¨‹ åœ¨åŠ è½½è¿‡ç¨‹ä¸­ï¼ŒJVMä¸»è¦åš3ä»¶äº‹æƒ…ï¼š é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–è¿™ä¸ªç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå³classæ–‡ä»¶ï¼š åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“è¦è®¿é—®ä¸€ä¸ªç±»æ—¶ï¼Œè‹¥å‘ç°è¿™ä¸ªç±»å°šæœªè¢«åŠ è½½ï¼Œå¹¶æ»¡è¶³ç±»åˆå§‹åŒ–æ—¶æœºçš„æ¡ä»¶æ—¶ï¼Œå°±æ ¹æ®è¦è¢«åˆå§‹åŒ–çš„è¿™ä¸ªç±»çš„å…¨é™å®šåæ‰¾åˆ°è¯¥ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå¼€å§‹åŠ è½½è¿‡ç¨‹ã€‚ å°†äºŒè¿›åˆ¶å­—èŠ‚æµçš„å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºç‰¹å®šçš„æ•°æ®ç»“æ„ï¼Œå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼› åœ¨å†…å­˜ä¸­åˆ›å»ºä¸€ä¸ªjava.lang.Classç±»å‹çš„å¯¹è±¡ï¼š æ¥ä¸‹æ¥ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€æœ‰å¯¹è¯¥ç±»çš„è®¿é—®éƒ½é€šè¿‡è¿™ä¸ªç±»å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªClassç±»å‹çš„ç±»å¯¹è±¡æ˜¯æä¾›ç»™å¤–ç•Œè®¿é—®è¯¥ç±»çš„æ¥å£ã€‚ ä»å“ªé‡ŒåŠ è½½ JVMè§„èŒƒå¯¹äºåŠ è½½è¿‡ç¨‹ç»™äºˆäº†è¾ƒå¤§çš„å®½æ¾åº¦ã€‚ä¸€èˆ¬äºŒè¿›åˆ¶å­—èŠ‚æµéƒ½ä»å·²ç»ç¼–è¯‘å¥½çš„æœ¬åœ°classæ–‡ä»¶ä¸­è¯»å–ï¼Œæ­¤å¤–è¿˜å¯ä»¥ä»ä»¥ä¸‹åœ°æ–¹è¯»å–ï¼š ä»å‹ç¼©åŒ…ä¸­è¯»å–ï¼Œå¦‚ï¼šJarã€Warã€Earç­‰ã€‚ ä»å…¶å®ƒæ–‡ä»¶ä¸­åŠ¨æ€ç”Ÿæˆï¼Œå¦‚ï¼šä»JSPæ–‡ä»¶ä¸­ç”ŸæˆClassç±»ã€‚ ä»æ•°æ®åº“ä¸­è¯»å–ï¼Œå°†äºŒè¿›åˆ¶å­—èŠ‚æµå­˜å‚¨è‡³æ•°æ®åº“ä¸­ï¼Œç„¶ååœ¨åŠ è½½æ—¶ä»æ•°æ®åº“ä¸­è¯»å–ã€‚æœ‰äº›ä¸­é—´ä»¶ä¼šè¿™ä¹ˆåšï¼Œç”¨æ¥å®ç°ä»£ç åœ¨é›†ç¾¤é—´åˆ†å‘ã€‚ ä»ç½‘ç»œä¸­è·å–ï¼Œä»ç½‘ç»œä¸­è·å–äºŒè¿›åˆ¶å­—èŠ‚æµã€‚å…¸å‹å°±æ˜¯Appletã€‚ ç±» å’Œ æ•°ç»„åŠ è½½è¿‡ç¨‹çš„åŒºåˆ« æ•°ç»„ä¹Ÿæœ‰ç±»å‹ï¼Œç§°ä¸ºâ€œæ•°ç»„ç±»å‹â€ã€‚å¦‚ï¼šString[] str = new String[10]; è¿™ä¸ªæ•°ç»„çš„æ•°ç»„ç±»å‹æ˜¯Ljava.lang.Stringï¼Œè€ŒStringåªæ˜¯è¿™ä¸ªæ•°ç»„ä¸­å…ƒç´ çš„ç±»å‹ã€‚ å½“ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é‡åˆ°newå…³é”®å­—åˆ›å»ºä¸€ä¸ªæ•°ç»„æ—¶ï¼Œç”±JVMç›´æ¥åˆ›å»ºæ•°ç»„ç±»ï¼Œå†ç”±ç±»åŠ è½½å™¨åˆ›å»ºæ•°ç»„ä¸­çš„å…ƒç´ ç±»ã€‚ è€Œæ™®é€šç±»çš„åŠ è½½ç”±ç±»åŠ è½½å™¨å®Œæˆã€‚æ—¢å¯ä»¥ä½¿ç”¨ç³»ç»Ÿæä¾›çš„å¼•å¯¼ç±»åŠ è½½å™¨ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ã€‚ åŠ è½½è¿‡ç¨‹çš„æ³¨æ„ç‚¹ JVMè§„èŒƒå¹¶æœªç»™å‡ºç±»åœ¨æ–¹æ³•åŒºä¸­å­˜æ”¾çš„æ•°æ®ç»“æ„ ç±»å®ŒæˆåŠ è½½åï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå°±ä»¥ç‰¹å®šçš„æ•°æ®ç»“æ„å­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œä½†å­˜å‚¨çš„æ•°æ®ç»“æ„æ˜¯ç”±è™šæ‹Ÿæœºè‡ªå·±å®šä¹‰çš„ï¼ŒJVMè§„èŒƒå¹¶æ²¡æœ‰æŒ‡å®šã€‚ JVMè§„èŒƒå¹¶æ²¡æœ‰æŒ‡å®šClasså¯¹è±¡å­˜æ”¾çš„ä½ç½® åœ¨äºŒè¿›åˆ¶å­—èŠ‚æµä»¥ç‰¹å®šæ ¼å¼å­˜å‚¨åœ¨æ–¹æ³•åŒºåï¼ŒJVMä¼šåˆ›å»ºä¸€ä¸ªjava.lang.Classç±»å‹çš„å¯¹è±¡ï¼Œä½œä¸ºæœ¬ç±»çš„å¤–éƒ¨æ¥å£ã€‚æ—¢ç„¶æ˜¯å¯¹è±¡å°±åº”è¯¥å­˜æ”¾åœ¨å †å†…å­˜ä¸­ï¼Œä¸è¿‡JVMè§„èŒƒå¹¶æ²¡æœ‰ç»™å‡ºé™åˆ¶ï¼Œä¸åŒçš„è™šæ‹Ÿæœºæ ¹æ®è‡ªå·±çš„éœ€æ±‚å­˜æ”¾è¿™ä¸ªå¯¹è±¡ã€‚HotSpotå°†Classå¯¹è±¡å­˜æ”¾åœ¨æ–¹æ³•åŒºã€‚ åŠ è½½é˜¶æ®µå’Œè¿æ¥é˜¶æ®µæ˜¯äº¤å‰çš„ é€šè¿‡å‰æ–‡å¯çŸ¥ï¼Œç±»åŠ è½½è¿‡ç¨‹ä¸­æ¯ä¸ªæ­¥éª¤çš„å¼€å§‹é¡ºåºéƒ½æœ‰ä¸¥æ ¼é™åˆ¶ï¼Œä½†æ¯ä¸ªæ­¥éª¤çš„ç»“æŸé¡ºåºæ²¡æœ‰é™åˆ¶ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œå¿…é¡»æŒ‰ç…§å¦‚ä¸‹é¡ºåºå¼€å§‹ï¼š åŠ è½½ã€è¿æ¥ã€åˆå§‹åŒ–ï¼Œä½†ç»“æŸé¡ºåºæ— æ‰€è°“ï¼Œå› æ­¤ç”±äºæ¯ä¸ªæ­¥éª¤å¤„ç†æ—¶é—´çš„é•¿çŸ­ä¸ä¸€å°±ä¼šå¯¼è‡´æœ‰äº›æ­¥éª¤ä¼šå‡ºç°äº¤å‰ã€‚ éªŒè¯ éªŒè¯é˜¶æ®µæ¯”è¾ƒè€—æ—¶ï¼Œå®ƒéå¸¸é‡è¦ä½†ä¸ä¸€å®šå¿…è¦ï¼Œå¦‚æœæ‰€è¿è¡Œçš„ä»£ç å·²ç»è¢«åå¤ä½¿ç”¨å’ŒéªŒè¯è¿‡ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨-Xverify:noneå‚æ•°å…³é—­ï¼Œä»¥ç¼©çŸ­ç±»åŠ è½½æ—¶é—´ã€‚ éªŒè¯çš„ç›®çš„ éªŒè¯æ˜¯ä¸ºäº†ä¿è¯äºŒè¿›åˆ¶å­—èŠ‚æµä¸­çš„ä¿¡æ¯ç¬¦åˆè™šæ‹Ÿæœºè§„èŒƒï¼Œå¹¶æ²¡æœ‰å®‰å…¨é—®é¢˜ã€‚ ä¸ºä»€ä¹ˆéœ€è¦éªŒè¯ è™½ç„¶Javaè¯­è¨€æ˜¯ä¸€é—¨å®‰å…¨çš„è¯­è¨€ï¼Œå®ƒèƒ½ç¡®ä¿ç¨‹åºçŒ¿æ— æ³•è®¿é—®æ•°ç»„è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€é¿å…è®©ä¸€ä¸ªå¯¹è±¡è½¬æ¢æˆä»»æ„ç±»å‹ã€é¿å…è·³è½¬åˆ°ä¸å­˜åœ¨çš„ä»£ç è¡Œï¼Œå¦‚æœå‡ºç°è¿™äº›æƒ…å†µï¼Œç¼–è¯‘æ— æ³•é€šè¿‡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒJavaè¯­è¨€çš„å®‰å…¨æ€§æ˜¯é€šè¿‡ç¼–è¯‘å™¨æ¥ä¿è¯çš„ã€‚ ä½†æ˜¯ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºæ˜¯ä¸¤ä¸ªç‹¬ç«‹çš„ä¸œè¥¿ï¼Œè™šæ‹Ÿæœºåªè®¤äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå®ƒä¸ä¼šç®¡æ‰€è·å¾—çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å“ªæ¥çš„ï¼Œå½“ç„¶ï¼Œå¦‚æœæ˜¯ç¼–è¯‘å™¨ç»™å®ƒçš„ï¼Œé‚£ä¹ˆå°±ç›¸å¯¹å®‰å…¨ï¼Œä½†å¦‚æœæ˜¯ä»å…¶å®ƒé€”å¾„è·å¾—çš„ï¼Œé‚£ä¹ˆæ— æ³•ç¡®ä¿è¯¥äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å®‰å…¨çš„ã€‚é€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼Œè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰é™åˆ¶äºŒè¿›åˆ¶å­—èŠ‚æµçš„æ¥æºï¼Œé‚£ä¹ˆä»»æ„æ¥æºçš„äºŒè¿›åˆ¶å­—èŠ‚æµè™šæ‹Ÿæœºéƒ½èƒ½æ¥å—ï¼Œä¸ºäº†é˜²æ­¢å­—èŠ‚æµä¸­æœ‰å®‰å…¨é—®é¢˜ï¼Œå› æ­¤éœ€è¦éªŒè¯ï¼ éªŒè¯çš„è¿‡ç¨‹ æ–‡ä»¶æ ¼å¼éªŒè¯ æ˜¯å¦ä»¥é­”æ•° 0xCAFEBABE å¼€å¤´ ä¸»ã€æ¬¡ç‰ˆæœ¬å·æ˜¯å¦åœ¨å½“å‰è™šæ‹Ÿæœºå¤„ç†èŒƒå›´ä¹‹å†… å¸¸é‡æ± çš„å¸¸é‡æ˜¯å¦æœ‰ä¸è¢«æ”¯æŒå¸¸é‡çš„ç±»å‹ï¼ˆæ£€æŸ¥å¸¸é‡ tag æ ‡å¿—ï¼‰ æŒ‡å‘å¸¸é‡çš„å„ç§ç´¢å¼•å€¼ä¸­æ˜¯å¦æœ‰æŒ‡å‘ä¸å­˜åœ¨çš„å¸¸é‡æˆ–ä¸ç¬¦åˆç±»å‹çš„å¸¸é‡ CONSTANT_Utf8_info å‹çš„å¸¸é‡ä¸­æ˜¯å¦æœ‰ä¸ç¬¦åˆ UTF8 ç¼–ç çš„æ•°æ® Class æ–‡ä»¶ä¸­å„ä¸ªéƒ¨åˆ†é›†æ–‡ä»¶æœ¬èº«æ˜¯å¦æœ‰è¢«åˆ é™¤çš„é™„åŠ çš„å…¶ä»–ä¿¡æ¯ â€¦â€¦ è¿™ä¸ªé˜¶æ®µä¸»è¦éªŒè¯è¾“å…¥çš„äºŒè¿›åˆ¶å­—èŠ‚æµæ˜¯å¦ç¬¦åˆclassæ–‡ä»¶ç»“æ„çš„è§„èŒƒã€‚äºŒè¿›åˆ¶å­—èŠ‚æµåªæœ‰é€šè¿‡äº†æœ¬é˜¶æ®µçš„éªŒè¯ï¼Œæ‰ä¼šè¢«å…è®¸å­˜å…¥åˆ°æ–¹æ³•åŒºä¸­ã€‚ æœ¬éªŒè¯é˜¶æ®µæ˜¯åŸºäºäºŒè¿›åˆ¶å­—èŠ‚æµçš„ï¼Œè€Œåé¢çš„ä¸‰ä¸ªéªŒè¯é˜¶æ®µéƒ½æ˜¯åœ¨æ–¹æ³•åŒºä¸­è¿›è¡Œï¼Œå¹¶åŸºäºç±»ç‰¹å®šçš„æ•°æ®ç»“æ„çš„ã€‚ é€šè¿‡ä¸Šæ–‡å¯çŸ¥ï¼ŒåŠ è½½å¼€å§‹å‰ï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµè¿˜æ²¡è¿›æ–¹æ³•åŒºï¼Œè€ŒåŠ è½½å®Œæˆåï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå·²ç»å­˜å…¥æ–¹æ³•åŒºã€‚è€Œåœ¨æ–‡ä»¶æ ¼å¼éªŒè¯å‰ï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµå°šæœªè¿›å…¥æ–¹æ³•åŒºï¼Œæ–‡ä»¶æ ¼å¼éªŒè¯é€šè¿‡ä¹‹åæ‰è¿›å…¥æ–¹æ³•åŒºã€‚ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ è½½å¼€å§‹åï¼Œç«‹å³å¯åŠ¨äº†æ–‡ä»¶æ ¼å¼éªŒè¯ï¼Œæœ¬é˜¶æ®µéªŒè¯é€šè¿‡åï¼ŒäºŒè¿›åˆ¶å­—èŠ‚æµè¢«è½¬æ¢æˆç‰¹å®šæ•°æ®ç»“æ„å­˜å‚¨è‡³æ–¹æ³•åŒºä¸­ï¼Œç»§è€Œå¼€å§‹ä¸‹é˜¶æ®µçš„éªŒè¯å’Œåˆ›å»ºClasså¯¹è±¡ç­‰æ“ä½œã€‚è¿™ä¸ªè¿‡ç¨‹å°è¯äº†ï¼šåŠ è½½å’ŒéªŒè¯æ˜¯äº¤å‰è¿›è¡Œçš„ã€‚ å…ƒæ•°æ®éªŒè¯ è¿™ä¸ªç±»æ˜¯å¦æœ‰çˆ¶ç±»ï¼ˆé™¤ java.lang.Object ä¹‹å¤–ï¼‰ è¿™ä¸ªç±»çš„çˆ¶ç±»æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆfinal ä¿®é¥°çš„ç±»ï¼‰ å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°äº†å…¶çˆ¶ç±»æˆ–æ¥å£ä¹‹ä¸­è¦æ±‚å®ç°çš„æ‰€æœ‰æ–¹æ³• ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆè¦†ç›–çˆ¶ç±» final å­—æ®µã€å‡ºç°ä¸ç¬¦åˆè§„èŒƒçš„é‡è½½ï¼‰ æœ¬é˜¶æ®µå¯¹æ–¹æ³•åŒºä¸­çš„å­—èŠ‚ç æè¿°ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œç¡®ä¿å…¶ç¬¦åˆJavaè¯­æ³•è§„èŒƒã€‚ å­—èŠ‚ç éªŒè¯ ä¿è¯ä»»æ„æ—¶åˆ»æ“ä½œæ•°æ ˆçš„æ•°æ®ç±»å‹ä¸æŒ‡ä»¤ä»£ç åºåˆ—éƒ½é¥é…åˆå·¥ä½œï¼ˆä¸ä¼šå‡ºç°æŒ‰ç…§ long ç±»å‹è¯»ä¸€ä¸ª int å‹æ•°æ®ï¼‰ ä¿è¯è·³è½¬æŒ‡ä»¤ä¸ä¼šè·³è½¬åˆ°æ–¹æ³•ä½“ä»¥å¤–çš„å­—èŠ‚ç æŒ‡ä»¤ä¸Š ä¿è¯æ–¹æ³•ä½“ä¸­çš„ç±»å‹è½¬æ¢æ˜¯æœ‰æ•ˆçš„ï¼ˆå­ç±»å¯¹è±¡èµ‹å€¼ç»™çˆ¶ç±»æ•°æ®ç±»å‹æ˜¯å®‰å…¨çš„ï¼Œåè¿‡æ¥ä¸åˆæ³•çš„ï¼‰ â€¦â€¦ è¿™æ˜¯æ•´ä¸ªéªŒè¯è¿‡ç¨‹ä¸­æœ€å¤æ‚çš„ä¸€ä¸ªé˜¶æ®µï¼Œä¸»è¦ç›®çš„æ˜¯é€šè¿‡æ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œç¡®å®šç¨‹åºè¯­ä¹‰æ˜¯åˆæ³•çš„ã€ç¬¦åˆé€»è¾‘çš„ã€‚è¿™ä¸ªé˜¶æ®µå¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä¿è¯æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦åˆ›æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±» åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦æ–¹æ³•çš„å­—æ®µæè¿°ç¬¦ä»¥åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—® â€¦â€¦ æœ¬é˜¶æ®µéªŒè¯å‘ç”Ÿåœ¨è§£æé˜¶æ®µï¼Œç¡®ä¿è§£æèƒ½æ­£å¸¸æ‰§è¡Œã€‚å¦‚æœæ— æ³•é€šè¿‡ç¬¦å·å¼•ç”¨éªŒè¯å°†æŠ›å‡ºä¸€ä¸ª java.lang.IncompatibleClass.ChangeError å¼‚å¸¸çš„å­ç±»ã€‚å¦‚ java.lang.IllegalAccessErrorã€java.lang.NoSuchFieldErrorã€java.lang.NoSuchMethodError ç­‰ã€‚ å‡†å¤‡ å‡†å¤‡é˜¶æ®µå®Œæˆä¸¤ä»¶äº‹æƒ…ï¼š ä¸ºå·²ç»åœ¨æ–¹æ³•åŒºä¸­çš„ç±»ä¸­çš„é™æ€æˆå‘˜å˜é‡åˆ†é…å†…å­˜ ç±»çš„é™æ€æˆå‘˜å˜é‡ä¹Ÿå­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ã€‚ ä¸ºé™æ€æˆå‘˜å˜é‡è®¾ç½®åˆå§‹å€¼ åˆå§‹å€¼ä¸º0ã€falseã€nullç­‰ã€‚ æ•°æ®ç±»å‹çš„é›¶å€¼: æ•°æ®ç±»å‹ é›¶å€¼ byte (byte) 0 short (short) 0 int 0 long 0L float 0.0f double 0.0d char '\u0000' boolean false reference null ç¤ºä¾‹1ï¼š 1public static String name = "æµ‹è¯•ç±»åŠ è½½"; åœ¨å‡†å¤‡é˜¶æ®µï¼ŒJVMä¼šåœ¨æ–¹æ³•åŒºä¸­ä¸ºnameåˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶èµ‹ä¸Šåˆå§‹å€¼nullã€‚ ç»™nameèµ‹ä¸Šâ€æµ‹è¯•ç±»åŠ è½½â€æ˜¯åœ¨åˆå§‹åŒ–é˜¶æ®µå®Œæˆçš„ã€‚ ç¤ºä¾‹2: 1public static final String name = "æµ‹è¯•ç±»åŠ è½½"; è¢«finalä¿®é¥°çš„å¸¸é‡å¦‚æœæœ‰åˆå§‹å€¼ï¼Œé‚£ä¹ˆåœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šå°†åˆå§‹å€¼å­˜å…¥constantValueå±æ€§ä¸­ï¼Œåœ¨å‡†å¤‡é˜¶æ®µå°±å°†constantValueçš„å€¼èµ‹ç»™è¯¥å­—æ®µã€‚ è§£æ è§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ åˆå§‹åŒ– åˆå§‹åŒ–é˜¶æ®µå°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨clinit()çš„è¿‡ç¨‹ã€‚ clinit()æ–¹æ³•ç”±ç¼–è¯‘å™¨è‡ªåŠ¨äº§ç”Ÿï¼Œæ”¶é›†ç±»ä¸­static{}ä»£ç å—ä¸­çš„ç±»å˜é‡èµ‹å€¼è¯­å¥å’Œç±»ä¸­é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼è¯­å¥ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»ä¸­é™æ€æˆå‘˜å˜é‡å·²ç»å®Œæˆäº†é»˜è®¤åˆå§‹åŒ–ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œclinit()æ–¹æ³•å¯¹é™æ€æˆå‘˜å˜é‡è¿›è¡Œæ˜¾ç¤ºåˆå§‹åŒ–ã€‚ åˆå§‹åŒ–è¿‡ç¨‹çš„æ³¨æ„ç‚¹ clinit()æ–¹æ³•ä¸­é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼é¡ºåºæ˜¯æ ¹æ®Javaä»£ç ä¸­æˆå‘˜å˜é‡çš„å‡ºç°çš„é¡ºåºå†³å®šçš„ã€‚ é™æ€ä»£ç å—èƒ½è®¿é—®å‡ºç°åœ¨é™æ€ä»£ç å—ä¹‹å‰çš„é™æ€æˆå‘˜å˜é‡ï¼Œæ— æ³•è®¿é—®å‡ºç°åœ¨é™æ€ä»£ç å—ä¹‹åçš„æˆå‘˜å˜é‡ã€‚ é™æ€ä»£ç å—èƒ½ç»™å‡ºç°åœ¨é™æ€ä»£ç å—ä¹‹åçš„é™æ€æˆå‘˜å˜é‡èµ‹å€¼ã€‚ æ„é€ å‡½æ•°init()éœ€è¦æ˜¾ç¤ºè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°ï¼Œè€Œç±»çš„æ„é€ å‡½æ•°clinit()ä¸éœ€è¦è°ƒç”¨çˆ¶ç±»çš„ç±»æ„é€ å‡½æ•°ï¼Œå› ä¸ºè™šæ‹Ÿæœºä¼šç¡®ä¿å­ç±»çš„clinit()æ–¹æ³•æ‰§è¡Œå‰å·²ç»æ‰§è¡Œäº†çˆ¶ç±»çš„clinit()æ–¹æ³•ã€‚ å¦‚æœä¸€ä¸ªç±»/æ¥å£ä¸­æ²¡æœ‰é™æ€ä»£ç å—ï¼Œä¹Ÿæ²¡æœ‰é™æ€æˆå‘˜å˜é‡çš„èµ‹å€¼æ“ä½œï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å°±ä¸ä¼šç”Ÿæˆclinit()æ–¹æ³•ã€‚ æ¥å£ä¹Ÿéœ€è¦é€šè¿‡clinit()æ–¹æ³•ä¸ºæ¥å£ä¸­å®šä¹‰çš„é™æ€æˆå‘˜å˜é‡æ˜¾ç¤ºåˆå§‹åŒ–ã€‚ æ¥å£ä¸­ä¸èƒ½ä½¿ç”¨é™æ€ä»£ç å—ã€‚ æ¥å£åœ¨æ‰§è¡Œclinit()æ–¹æ³•å‰ï¼Œè™šæ‹Ÿæœºä¸ä¼šç¡®ä¿å…¶çˆ¶æ¥å£çš„clinit()æ–¹æ³•è¢«æ‰§è¡Œï¼Œåªæœ‰å½“çˆ¶æ¥å£ä¸­çš„é™æ€æˆå‘˜å˜é‡è¢«ä½¿ç”¨åˆ°æ—¶æ‰ä¼šæ‰§è¡Œçˆ¶æ¥å£çš„clinit()æ–¹æ³•ã€‚ è™šæ‹Ÿæœºä¼šç»™clinit()æ–¹æ³•åŠ é”ï¼Œå› æ­¤å½“å¤šæ¡çº¿ç¨‹åŒæ—¶æ‰§è¡ŒæŸä¸€ä¸ªç±»çš„clinit()æ–¹æ³•æ—¶ï¼Œåªæœ‰ä¸€ä¸ªæ–¹æ³•ä¼šè¢«æ‰§è¡Œï¼Œå…¶å®ƒçš„æ–¹æ³•éƒ½è¢«é˜»å¡ã€‚å¹¶ä¸”ï¼Œåªè¦æœ‰ä¸€ä¸ªclinit()æ–¹æ³•æ‰§è¡Œå®Œï¼Œå…¶å®ƒçš„clinit()æ–¹æ³•å°±ä¸ä¼šå†è¢«æ‰§è¡Œã€‚å› æ­¤ï¼Œåœ¨åŒä¸€ä¸ªç±»åŠ è½½å™¨ä¸‹ï¼ŒåŒä¸€ä¸ªç±»åªä¼šè¢«åˆå§‹åŒ–ä¸€æ¬¡ã€‚ ç±»åŠ è½½å™¨ java.lang.ClassLoaderç±»çš„åŸºæœ¬èŒè´£å°±æ˜¯æ ¹æ®ä¸€ä¸ªæŒ‡å®šçš„ç±»çš„åç§°ï¼Œæ‰¾åˆ°æˆ–è€…ç”Ÿæˆå…¶å¯¹åº”çš„å­—èŠ‚ç ï¼Œç„¶åä»è¿™äº›å­—èŠ‚ä»£ç ä¸­å®šä¹‰å‡ºä¸€ä¸ª Java ç±»ï¼Œå³ java.lang.Classç±»çš„ä¸€ä¸ªå®ä¾‹ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒClassLoaderè¿˜è´Ÿè´£åŠ è½½ Java åº”ç”¨æ‰€éœ€çš„èµ„æºï¼Œå¦‚å›¾åƒæ–‡ä»¶å’Œé…ç½®æ–‡ä»¶ç­‰ã€‚ä¸ºäº†å®ŒæˆåŠ è½½ç±»çš„è¿™ä¸ªèŒè´£ï¼ŒClassLoaderæä¾›äº†ä¸€ç³»åˆ—çš„æ–¹æ³•: getParent() è¿”å›è¯¥ç±»åŠ è½½å™¨çš„çˆ¶ç±»åŠ è½½å™¨ã€‚ loadClass(String name) åŠ è½½åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ findClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ findLoadedClass(String name) æŸ¥æ‰¾åç§°ä¸º nameçš„å·²ç»è¢«åŠ è½½è¿‡çš„ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯ java.lang.Classç±»çš„å®ä¾‹ã€‚ defineClass(String name, byte[] b, int off, int len) æŠŠå­—èŠ‚æ•°ç»„ bä¸­çš„å†…å®¹è½¬æ¢æˆ Java ç±»ï¼Œè¿”å›çš„ç»“æœæ˜¯java.lang.Classç±»çš„å®ä¾‹ã€‚è¿™ä¸ªæ–¹æ³•è¢«å£°æ˜ä¸º finalçš„ã€‚ resolveClass(Class) ç±»åŠ è½½å™¨ç§ç±» JVMæä¾›å¦‚ä¸‹å››ç§ç±»åŠ è½½å™¨ï¼š å¯åŠ¨ç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½Java_Home\libä¸­çš„classæ–‡ä»¶ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½Java_Home\lib\extç›®å½•ä¸‹çš„classæ–‡ä»¶ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ è´Ÿè´£åŠ è½½ç”¨æˆ·classpathä¸‹çš„classæ–‡ä»¶ã€‚ è‡ªå®šä¹‰ç±»åŠ è½½å™¨ ç±»åŠ è½½çš„å†…å­˜åˆ†å¸ƒæƒ…å†µ å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap ClassLoaderï¼‰åŠ è½½ç³»ç»Ÿç±»åï¼ŒJVMå†…å­˜ä¼šå‘ˆç°å¦‚ä¸‹æ ¼å±€ï¼š å¼•å¯¼ç±»åŠ è½½å™¨å°†ç±»ä¿¡æ¯åŠ è½½åˆ°æ–¹æ³•åŒºä¸­ï¼Œä»¥ç‰¹å®šæ–¹å¼ç»„ç»‡ï¼Œå¯¹äºæŸä¸€ä¸ªç‰¹å®šçš„ç±»è€Œè¨€ï¼Œåœ¨æ–¹æ³•åŒºä¸­å®ƒåº”è¯¥æœ‰ï¼šè¿è¡Œæ—¶å¸¸é‡æ± ã€ç±»å‹ä¿¡æ¯ã€å­—æ®µä¿¡æ¯ã€æ–¹æ³•ä¿¡æ¯ã€ç±»åŠ è½½å™¨çš„å¼•ç”¨ï¼Œå¯¹åº”classå®ä¾‹çš„å¼•ç”¨ç­‰ä¿¡æ¯ã€‚ ç±»åŠ è½½å™¨çš„å¼•ç”¨,ç”±äºè¿™äº›ç±»æ˜¯ç”±å¼•å¯¼ç±»åŠ è½½å™¨(Bootstrap Classloader)è¿›è¡ŒåŠ è½½çš„ï¼Œè€Œå¼•å¯¼ç±»åŠ è½½å™¨æ˜¯æœ‰C++è¯­è¨€å®ç°çš„ï¼Œæ‰€ä»¥æ˜¯æ— æ³•è®¿é—®çš„ï¼Œæ•…è€Œè¯¥å¼•ç”¨ä¸ºNULLã€‚ å¯¹åº”classå®ä¾‹çš„å¼•ç”¨ï¼Œç±»åŠ è½½å™¨åœ¨åŠ è½½ç±»ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­åï¼Œä¼šåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„Class ç±»å‹çš„å®ä¾‹æ”¾åˆ°å †(Heap)ä¸­, ä½œä¸ºå¼€å‘äººå‘˜è®¿é—®æ–¹æ³•åŒºä¸­ç±»å®šä¹‰çš„å…¥å£å’Œåˆ‡å…¥ç‚¹ã€‚ åŒäº²å§”æ´¾æ¨¡å‹ å·¥ä½œè¿‡ç¨‹ å¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†åŠ è½½ç±»çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆå°†è¯·æ±‚äº¤ç”±çˆ¶ç±»åŠ è½½å™¨åŠ è½½ï¼›è‹¥çˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼Œå½“å‰ç±»åŠ è½½å™¨æ‰ä¼šè‡ªå·±åŠ è½½ç±»ã€‚ ä½œç”¨ åƒjava.lang.Objectè¿™äº›å­˜æ”¾åœ¨rt.jarä¸­çš„ç±»ï¼Œæ— è®ºä½¿ç”¨å“ªä¸ªç±»åŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ´¾ç»™æœ€é¡¶ç«¯çš„å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œä»è€Œä½¿å¾—ä¸åŒåŠ è½½å™¨åŠ è½½çš„Objectç±»éƒ½æ˜¯åŒä¸€ä¸ªã€‚ åŸç† åŒäº²å§”æ´¾æ¨¡å‹çš„ä»£ç åœ¨java.lang.ClassLoaderç±»ä¸­çš„loadClasså‡½æ•°ä¸­å®ç°ï¼Œå…¶é€»è¾‘å¦‚ä¸‹ï¼š ï¼ˆ1ï¼‰é¦–å…ˆæ£€æŸ¥ç±»æ˜¯å¦è¢«åŠ è½½ï¼› ï¼ˆ2ï¼‰è‹¥æœªåŠ è½½ï¼Œåˆ™è°ƒç”¨çˆ¶ç±»åŠ è½½å™¨çš„loadClassæ–¹æ³•ï¼› ï¼ˆ3ï¼‰è‹¥è¯¥æ–¹æ³•æŠ›å‡ºClassNotFoundExceptionå¼‚å¸¸ï¼Œåˆ™è¡¨ç¤ºçˆ¶ç±»åŠ è½½å™¨æ— æ³•åŠ è½½ï¼Œåˆ™å½“å‰ç±»åŠ è½½å™¨è°ƒç”¨findClassåŠ è½½ç±»ï¼› ï¼ˆ4ï¼‰è‹¥çˆ¶ç±»åŠ è½½å™¨å¯ä»¥åŠ è½½ï¼Œåˆ™ç›´æ¥è¿”å›Classå¯¹è±¡ï¼› åŠ è½½ç±»çš„è¿‡ç¨‹ ç±»åœ¨åŠ è½½è¿‡ç¨‹ä¸­ç±»åŠ è½½å™¨ä¼šé¦–å…ˆå§”æ‰˜ç»™å…¶å®ƒç±»åŠ è½½å™¨æ¥å°è¯•åŠ è½½æŸä¸ªç±»ã€‚ è¿™å°±æ„å‘³ç€çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œçš„ç±»åŠ è½½å™¨å’Œå¯åŠ¨è¿™ä¸ªåŠ è½½è¿‡ç¨‹çš„ç±»åŠ è½½å™¨ï¼Œæœ‰å¯èƒ½ä¸æ˜¯åŒä¸€ä¸ªã€‚ çœŸæ­£å®Œæˆç±»çš„åŠ è½½å·¥ä½œæ˜¯é€šè¿‡è°ƒç”¨ defineClassæ¥å®ç°çš„ï¼›è€Œå¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹æ˜¯é€šè¿‡è°ƒç”¨ loadClassæ¥å®ç°çš„ã€‚ å‰è€…ç§°ä¸ºä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨ï¼ˆdefining loaderï¼‰ï¼Œåè€…ç§°ä¸ºåˆå§‹åŠ è½½å™¨ï¼ˆinitiating loaderï¼‰ã€‚ åœ¨ Java è™šæ‹Ÿæœºåˆ¤æ–­ä¸¤ä¸ªç±»æ˜¯å¦ç›¸åŒçš„æ—¶å€™ï¼Œä½¿ç”¨çš„æ˜¯ç±»çš„å®šä¹‰åŠ è½½å™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå“ªä¸ªç±»åŠ è½½å™¨å¯åŠ¨ç±»çš„åŠ è½½è¿‡ç¨‹å¹¶ä¸é‡è¦ï¼Œé‡è¦çš„æ˜¯æœ€ç»ˆå®šä¹‰è¿™ä¸ªç±»çš„åŠ è½½å™¨ã€‚ ä¸¤ç§ç±»åŠ è½½å™¨çš„å…³è”ä¹‹å¤„åœ¨äºï¼šä¸€ä¸ªç±»çš„å®šä¹‰åŠ è½½å™¨æ˜¯å®ƒå¼•ç”¨çš„å…¶å®ƒç±»çš„åˆå§‹åŠ è½½å™¨ã€‚å¦‚ç±» com.example.Outerå¼•ç”¨äº†ç±» com.example.Innerï¼Œåˆ™ç”±ç±» com.example.Outerçš„å®šä¹‰åŠ è½½å™¨è´Ÿè´£å¯åŠ¨ç±» com.example.Innerçš„åŠ è½½è¿‡ç¨‹ã€‚æ–¹æ³• loadClass()æŠ›å‡ºçš„æ˜¯ java.lang.ClassNotFoundExceptionå¼‚å¸¸ï¼›æ–¹æ³• defineClass()æŠ›å‡ºçš„æ˜¯ java.lang.NoClassDefFoundErrorå¼‚å¸¸ã€‚ ç±»åŠ è½½å™¨åœ¨æˆåŠŸåŠ è½½æŸä¸ªç±»ä¹‹åï¼Œä¼šæŠŠå¾—åˆ°çš„ java.lang.Classç±»çš„å®ä¾‹ç¼“å­˜èµ·æ¥ã€‚ä¸‹æ¬¡å†è¯·æ±‚åŠ è½½è¯¥ç±»çš„æ—¶å€™ï¼Œç±»åŠ è½½å™¨ä¼šç›´æ¥ä½¿ç”¨ç¼“å­˜çš„ç±»çš„å®ä¾‹ï¼Œè€Œä¸ä¼šå°è¯•å†æ¬¡åŠ è½½ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºä¸€ä¸ªç±»åŠ è½½å™¨å®ä¾‹æ¥è¯´ï¼Œç›¸åŒå…¨åçš„ç±»åªåŠ è½½ä¸€æ¬¡ï¼Œå³ loadClassæ–¹æ³•ä¸ä¼šè¢«é‡å¤è°ƒç”¨ã€‚ ClassNotFoundException å½“åº”ç”¨ç¨‹åºè¯•å›¾ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•é€šè¿‡å­—ç¬¦ä¸²ååŠ è½½ç±»æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ï¼š Class ç±»ä¸­çš„ forName æ–¹æ³•ã€‚ ClassLoader ç±»ä¸­çš„ findSystemClass æ–¹æ³•ã€‚ ClassLoader ç±»ä¸­çš„ loadClass æ–¹æ³•ã€‚ ä½†æ˜¯æ²¡æœ‰æ‰¾åˆ°å…·æœ‰æŒ‡å®šåç§°çš„ç±»çš„å®šä¹‰ã€‚ä» 1.4 ç‰ˆæœ¬å¼€å§‹ï¼Œæ­¤å¼‚å¸¸å·²ç»æ›´æ–°ï¼Œä»¥ç¬¦åˆé€šç”¨çš„å¼‚å¸¸é“¾æœºåˆ¶ã€‚ åœ¨æ„é€ æ—¶æä¾›å¹¶é€šè¿‡ getException() æ–¹æ³•è®¿é—®çš„â€œåŠ è½½ç±»æ—¶å¼•å‘çš„å¯é€‰å¼‚å¸¸â€ï¼Œç°åœ¨è¢«ç§°ä¸ºåŸå› ï¼Œå®ƒå¯ä»¥é€šè¿‡ Throwable.getCause() æ–¹æ³•ä»¥åŠä¸ä¸Šé¢æåˆ°çš„â€œé—ç•™æ–¹æ³•â€æ¥è®¿é—®ã€‚ NoClassDefFoundError å½“ Java è™šæ‹Ÿæœºæˆ– ClassLoader å®ä¾‹è¯•å›¾åœ¨ç±»çš„å®šä¹‰ä¸­åŠ è½½ï¼ˆä½œä¸ºé€šå¸¸æ–¹æ³•è°ƒç”¨çš„ä¸€éƒ¨åˆ†æˆ–è€…ä½œä¸ºä½¿ç”¨ new è¡¨è¾¾å¼åˆ›å»ºçš„æ–°å®ä¾‹çš„ä¸€éƒ¨åˆ†ï¼‰ï¼Œä½†æ— æ³•æ‰¾åˆ°è¯¥ç±»çš„å®šä¹‰æ—¶ï¼ŒæŠ›å‡ºæ­¤å¼‚å¸¸ã€‚ å¼•èµ·NoClassDefFoundErrorçš„ä¸‰ç§æƒ…å†µï¼š JARé‡å¤å¼•å…¥ï¼Œç‰ˆæœ¬ä¸ä¸€è‡´å¯¼è‡³ æ‰“ç¨‹åºç‰ˆæœ¬æ—¶ï¼Œæ²¡æœ‰æŠŠå…³è”ç±»æ‰“å‡ºå»ï¼ˆè¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯ï¼‰ java.lang.nosuchmethoderror è¿˜æœ‰ä¸€ç§æƒ…å†µæ˜¯Aå¼•ç”¨Bæ—¶ï¼ŒBåˆå§‹åŒ–å¤±è´¥æ—¶ä¹Ÿä¼šå¯¼è‡´ä»¥ä¸Šçš„é”™è¯¯å‡ºç°ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è£…é¥°å™¨æ¨¡å¼]]></title>
    <url>%2Fposts%2F4f101877.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ è£…é¥°è€…æ¨¡å¼(Decorator Pattern)ï¼šåŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ ä¸€äº›é¢å¤–çš„èŒè´£ï¼Œå¢åŠ å¯¹è±¡åŠŸèƒ½æ¥è¯´ï¼Œè£…é¥°æ¨¡å¼æ¯”ç”Ÿæˆå­ç±»å®ç°æ›´ä¸ºçµæ´»ã€‚è£…é¥°æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡ç»“æ„å‹æ¨¡å¼ã€‚ æ¨¡å¼åŸç† è®©è£…é¥°å™¨å®ç°è¢«åŒ…è£…ç±»ï¼ˆConcrete Componentï¼‰ç›¸åŒçš„æ¥å£ï¼ˆComponentï¼‰ï¼ˆä½¿å¾—è£…é¥°å™¨ä¸è¢«æ‰©å±•ç±»ç±»å‹ä¸€è‡´ï¼‰ï¼Œå¹¶åœ¨æ„é€ å‡½æ•°ä¸­ä¼ å…¥è¯¥æ¥å£ï¼ˆComponentï¼‰å¯¹è±¡ï¼Œç„¶åå°±å¯ä»¥åœ¨æ¥å£éœ€è¦å®ç°çš„æ–¹æ³•ä¸­åœ¨è¢«åŒ…è£…ç±»å¯¹è±¡çš„ç°æœ‰åŠŸèƒ½ä¸Šæ·»åŠ æ–°åŠŸèƒ½äº†ã€‚ æ¨¡å¼è§’è‰² æŠ½è±¡ç»„ä»¶ï¼ˆComponentï¼‰ï¼šå¯ä»¥æ˜¯ä¸€ä¸ªæ¥å£æˆ–è€…æŠ½è±¡ç±»ï¼Œå…¶å……å½“è¢«è£…é¥°ç±»çš„åŸå§‹å¯¹è±¡ï¼Œè§„å®šäº†è¢«è£…é¥°å¯¹è±¡çš„è¡Œä¸ºï¼› å…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰ï¼šå®ç°/ç»§æ‰¿ Component çš„ä¸€ä¸ªå…·ä½“å¯¹è±¡ï¼Œä¹Ÿå³ è¢«è£…é¥°å¯¹è±¡ï¼› æŠ½è±¡è£…é¥°å™¨ï¼ˆDecoratorï¼‰ï¼šé€šç”¨çš„è£…é¥° ConcreteComponent çš„è£…é¥°å™¨ï¼Œå…¶å†…éƒ¨å¿…ç„¶æœ‰ä¸€ä¸ªå±æ€§æŒ‡å‘ ComponentæŠ½è±¡ç»„ä»¶ï¼›å…¶å®ç°ä¸€èˆ¬æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä¸»è¦æ˜¯ä¸ºäº†è®©å…¶å­ç±»æŒ‰ç…§å…¶æ„é€ å½¢å¼ä¼ å…¥ä¸€ä¸ª ComponentæŠ½è±¡ç»„ä»¶ï¼Œè¿™æ˜¯å¼ºåˆ¶çš„é€šç”¨è¡Œä¸ºï¼ˆå½“ç„¶ï¼Œå¦‚æœç³»ç»Ÿä¸­è£…é¥°é€»è¾‘å•ä¸€ï¼Œå¹¶ä¸éœ€è¦å®ç°è®¸å¤šè£…é¥°å™¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥çœç•¥è¯¥ç±»ï¼Œè€Œç›´æ¥å®ç°ä¸€ä¸ª å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ å³å¯ï¼‰ï¼› å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ï¼šDecorator çš„å…·ä½“å®ç°ç±»ï¼Œç†è®ºä¸Šï¼Œæ¯ä¸ª ConcreteDecorator éƒ½æ‰©å±•äº† Component å¯¹è±¡çš„ä¸€ç§åŠŸèƒ½ï¼› è£…é¥°æ¨¡å¼ è§’è‰²åˆ†é…ç¬¦åˆè®¾è®¡æ¨¡å¼ é‡Œæ°æ›¿æ¢åŸåˆ™ï¼Œä¾èµ–å€’ç½®åŸåˆ™ï¼Œä»è€Œä½¿å¾—å…¶å…·å¤‡å¾ˆå¼ºçš„æ‰©å±•æ€§ï¼Œæœ€ç»ˆæ»¡è¶³ å¼€é—­åŸåˆ™ã€‚ UMLç±»å›¾ æ¨¡å¼ä¼˜ç‚¹ å¯¹äºæ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œè£…é¥°æ¨¡å¼æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æ€§ï¼Œä¸ä¼šå¯¼è‡´ç±»çš„ä¸ªæ•°æ€¥å‰§å¢åŠ ã€‚ å¯ä»¥é€šè¿‡ä¸€ç§åŠ¨æ€çš„æ–¹å¼æ¥æ‰©å±•ä¸€ä¸ªå¯¹è±¡çš„åŠŸèƒ½ï¼Œé€šè¿‡é…ç½®æ–‡ä»¶å¯ä»¥åœ¨è¿è¡Œæ—¶é€‰æ‹©ä¸åŒçš„å…·ä½“è£…é¥°ç±»ï¼Œä»è€Œå®ç°ä¸åŒçš„è¡Œä¸ºã€‚ å¯ä»¥å¯¹ä¸€ä¸ªå¯¹è±¡è¿›è¡Œå¤šæ¬¡è£…é¥°ï¼Œé€šè¿‡ä½¿ç”¨ä¸åŒçš„å…·ä½“è£…é¥°ç±»ä»¥åŠè¿™äº›è£…é¥°ç±»çš„æ’åˆ—ç»„åˆï¼Œå¯ä»¥åˆ›é€ å‡ºå¾ˆå¤šä¸åŒè¡Œä¸ºçš„ç»„åˆï¼Œå¾—åˆ°åŠŸèƒ½æ›´ä¸ºå¼ºå¤§çš„å¯¹è±¡ã€‚ å…·ä½“ç»„ä»¶ç±»ä¸å…·ä½“è£…é¥°ç±»å¯ä»¥ç‹¬ç«‹å˜åŒ–ï¼Œç”¨æˆ·å¯ä»¥æ ¹æ®éœ€è¦å¢åŠ æ–°çš„å…·ä½“æ„ä»¶ç±»å’Œå…·ä½“è£…é¥°ç±»ï¼ŒåŸæœ‰ç±»åº“ä»£ç æ— é¡»æ”¹å˜ï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚ æ¨¡å¼ç¼ºç‚¹ ä½¿ç”¨è£…é¥°æ¨¡å¼è¿›è¡Œç³»ç»Ÿè®¾è®¡æ—¶å°†äº§ç”Ÿå¾ˆå¤šå°å¯¹è±¡ï¼Œè¿™äº›å¯¹è±¡çš„åŒºåˆ«åœ¨äºå®ƒä»¬ä¹‹é—´ç›¸äº’è¿æ¥çš„æ–¹å¼æœ‰æ‰€ä¸åŒï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„ç±»æˆ–è€…å±æ€§å€¼æœ‰æ‰€ä¸åŒï¼Œå¤§é‡å°å¯¹è±¡çš„äº§ç”ŸåŠ¿å¿…ä¼šå ç”¨æ›´å¤šçš„ç³»ç»Ÿèµ„æºï¼Œåœ¨ä¸€å®šç¨‹åºä¸Šå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚ è£…é¥°æ¨¡å¼æä¾›äº†ä¸€ç§æ¯”ç»§æ‰¿æ›´åŠ çµæ´»æœºåŠ¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½†åŒæ—¶ä¹Ÿæ„å‘³ç€æ¯”ç»§æ‰¿æ›´åŠ æ˜“äºå‡ºé”™ï¼Œæ’é”™ä¹Ÿå¾ˆå›°éš¾ï¼Œå¯¹äºå¤šæ¬¡è£…é¥°çš„å¯¹è±¡ï¼Œè°ƒè¯•æ—¶å¯»æ‰¾é”™è¯¯å¯èƒ½éœ€è¦é€çº§æ’æŸ¥ï¼Œè¾ƒä¸ºç¹çã€‚ åº”ç”¨åœºæ™¯ éœ€è¦æ‰©å±•ä¸€ä¸ªç±»çš„åŠŸèƒ½ï¼Œæˆ–ç»™ä¸€ä¸ªç±»å¢åŠ é™„åŠ åŠŸèƒ½ï¼› éœ€è¦åŠ¨æ€åœ°ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ åŠŸèƒ½ï¼Œä¸”è¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€åœ°æ’¤é”€ï¼› éœ€è¦ä¸ºä¸€æ‰¹çš„å…„å¼Ÿç±»è¿›è¡Œæ”¹è£…æˆ–åŠ è£…åŠŸèƒ½ï¼› åº”ç”¨ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ æ‰€è°“äººé è¡£è£…é©¬é éï¼Œå‡è®¾ç°åœ¨è¦ä¸ºç”·äººå¢åŠ ç©¿è¡£æœçš„åŠŸèƒ½ï¼ˆç©¿è£¤å­ã€ç©¿å†…è¡£ã€ç©¿å¤–å¥—ï¼‰ã€‚ åˆ†æ ä»¥ è£…é¥°æ¨¡å¼ çš„è§’åº¦æ¥çœ‹å¾…ä¸Šè¿°ä¾‹å­ï¼Œã€Œäººã€å±äº Component è§’è‰²ï¼› ã€Œç”·äººã€ å±äº ConcreteComponent è§’è‰²ï¼Œå› æ­¤ï¼Œã€Œç”·äººã€ æ˜¯è¢«è£…é¥°å¯¹è±¡ï¼› ã€Œç©¿è¡£æœã€ æ˜¯åŠŸèƒ½æ‰©å±•ï¼Œå±äº Decorator è§’è‰²ï¼› è€Œã€Œç©¿è£¤å­ã€ï¼Œã€Œç©¿å†…è¡£ã€ï¼Œã€Œç©¿å¤–å¥—ã€ æ˜¯3ä¸ªå…·ä½“åŠŸèƒ½æ‰©å±•ï¼Œå‡å±äº ConcreteDecorator è§’è‰²ï¼› ä½¿ç”¨æ­¥éª¤ æŠ½è±¡ç»„ä»¶(Component) 123456789101112package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰äºº--æŠ½è±¡ç»„ä»¶ï¼ˆComponentï¼‰ */public interface IPerson { /** * ç©¿è¡£æœ */ void dress();} å…·ä½“ç»„ä»¶(ConcreteComponent) 12345678910111213package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰ç”·äºº--å…·ä½“ç»„ä»¶ï¼ˆConcreteComponentï¼‰ï¼Œå³è¢«ä¿®é¥°è€… */public class Man implements IPerson { @Override public void dress() { System.out.println("ç©¿äº†å†…è£¤ï¼"); }} æŠ½è±¡è£…é¥°å™¨(Decorator) 12345678910111213141516171819202122package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®šä¹‰è¡£æœ--æŠ½è±¡è£…é¥°å™¨ï¼ˆDecoratorï¼‰ï¼Œæ¥æ”¶ä¸€ä¸ªå…·ä½“çš„Componentï¼Œæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªComponent */public abstract class ClothesDecorator implements IPerson { protected IPerson mPerson; /** * æ„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æ„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson */ public ClothesDecorator(IPerson person) { this.mPerson = person; } @Override public void dress() { this.mPerson.dress(); }} å…·ä½“è£…é¥°å™¨(ConcreteDecorator) TrousersDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: è£¤å­è£…é¥°å™¨-å…·ä½“è£…é¥°å™¨ï¼ˆConcreteDecoratorï¼‰ */public class TrousersDecorator extends ClothesDecorator { /** * æ„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æ„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public TrousersDecorator(IPerson person) { super(person); } @Override public void dress() { super.dress(); this.dressTrousers(); } /** * ç©¿è£¤å­ */ private void dressTrousers() { System.out.println("ç©¿ä¸Šè£¤å­äº†ï¼"); }} UnderClothesDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å†…è¡£è£…é¥°å™¨ */public class UnderClothesDecorator extends ClothesDecorator { /** * æ„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æ„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public UnderClothesDecorator(IPerson person) { super(person); } @Override public void dress() { super.dress(); this.dressUnderClothes(); } /** * ç©¿å†…è¡£ */ private void dressUnderClothes() { System.out.println("ç©¿ä¸Šå†…è¡£äº†ï¼"); }} OvercoatDecorator 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å¤–å¥—è£…é¥°å™¨ */public class OvercoatDecorator extends ClothesDecorator { /** * æ„é€ æ–¹æ³•ï¼šå¼ºåˆ¶å­ç±»æ„é€ å™¨å¿…é¡»ä¼ å…¥ä¸€ä¸ªIPerson * * @param person */ public OvercoatDecorator(IPerson person) { super(person); } @Override public void dress() { super.dress(); this.dressOvercoat(); } /** * ç©¿å¤–å¥— */ private void dressOvercoat() { System.out.println("ç©¿ä¸Šå¤–å¥—äº†ï¼"); }} å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { IPerson person = new Man(); person.dress(); System.out.println("----------------------"); System.out.println("å¢åŠ è£¤å­è£…é¥°å™¨"); person = new TrousersDecorator(person); person.dress(); System.out.println("----------------------"); System.out.println("å†å¢åŠ å†…è¡£è£…é¥°å™¨"); person = new UnderClothesDecorator(person); person.dress(); System.out.println("----------------------"); System.out.println("å†å¢åŠ å¤–å¥—è£…é¥°å™¨"); person = new OvercoatDecorator(person); person.dress(); }} ä¸Šé¢ä»£ç ä¸­å®¢æˆ·æ˜¯ä¸ºnew Man()è¿™ä¸ªIPersonä¸€ä»¶ä¸€ä»¶çš„è¿›è¡Œè¡£æœè¯•ç©¿ï¼Œå¤ªæµªè´¹æ—¶é—´äº†ï¼Œå®Œå…¨å¯ä»¥ä½¿ç”¨è£…é¥°å™¨åµŒå¥—ï¼ˆå› ä¸ºè£…é¥°å™¨æ¥æ”¶ä¸€ä¸ªIPersonï¼Œè€Œè‡ªå·±åŒæ—¶ä¹Ÿæ˜¯ä¸€ä¸ªIPersonï¼Œå› æ­¤å®Œå…¨æ”¯æŒåµŒå¥—ï¼‰æ¨¡å¼ï¼Œè¿™æ ·ä¸€æ¬¡æ€§å°±ç©¿å®Œï¼Œä»£ç å¦‚ä¸‹ï¼š 123456789101112package main.java.com.study.designPatterns.decorator.demoOne;/** * @author: whb * @description: è£…é¥°å™¨åµŒå¥— */public class Client2 { public static void main(String[] args) { IPerson person = new OvercoatDecorator(new UnderClothesDecorator(new TrousersDecorator(new Man()))); person.dress(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å»ºé€ è€…æ¨¡å¼]]></title>
    <url>%2Fposts%2F2a48474d.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å»ºé€ è€…æ¨¡å¼(Builder Pattern)ï¼šå°†ä¸€ä¸ªå¤æ‚å¯¹è±¡çš„æ„å»ºä¸å®ƒçš„è¡¨ç¤ºåˆ†ç¦»ï¼Œä½¿å¾—åŒæ ·çš„æ„å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„è¡¨ç¤ºã€‚å»ºé€ è€…æ¨¡å¼æ˜¯ä¸€ç§å¯¹è±¡åˆ›å»ºå‹æ¨¡å¼ã€‚ å»ºé€ è€…æ¨¡å¼ä¸€æ­¥ä¸€æ­¥åˆ›å»ºä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå®ƒå…è®¸ç”¨æˆ·åªé€šè¿‡æŒ‡å®šå¤æ‚å¯¹è±¡çš„ç±»å‹å’Œå†…å®¹å°±å¯ä»¥æ„å»ºå®ƒä»¬ï¼Œç”¨æˆ·ä¸éœ€è¦çŸ¥é“å†…éƒ¨çš„å…·ä½“æ„å»ºç»†èŠ‚ã€‚ ä¸»è¦ä½œç”¨ é™ä½åˆ›å»ºå¤æ‚å¯¹è±¡çš„å¤æ‚åº¦ï¼› éš”ç¦»äº†åˆ›å»ºå¯¹è±¡çš„æ„å»ºè¿‡ç¨‹ &amp; è¡¨ç¤ºã€‚ UMLç±»å›¾ è§’è‰² æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼šä¸»è¦ç”¨äºè§„èŒƒäº§å“Productå¯¹è±¡çš„å„ä¸ªç»„æˆéƒ¨åˆ†ï¼Œå¹¶æä¾›ä¸€ä¸ªè¿”å›å®Œæ•´äº§å“çš„æ¥å£ï¼Œåœ¨è¯¥æ¥å£ä¸­ä¸€èˆ¬å£°æ˜ä¸¤ç±»æ–¹æ³•ï¼Œä¸€ç±»æ–¹æ³•æ˜¯buildPartX()ï¼Œå®ƒä»¬ç”¨äºåˆ›å»ºå¤æ‚å¯¹è±¡çš„å„ä¸ªéƒ¨ä»¶ï¼›å¦ä¸€ç±»æ–¹æ³•æ˜¯getResult()ï¼Œå®ƒä»¬ç”¨äºè¿”å›å¤æ‚å¯¹è±¡ã€‚Builderæ—¢å¯ä»¥æ˜¯æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯æ¥å£ã€‚ å…·ä½“å»ºé€ è€…ï¼ˆConcrete Builderï¼‰ï¼šå®ç° æŠ½è±¡å»ºé€ è€… è§„å®šçš„å„ä¸ªæ–¹æ³•ï¼Œè¿”å›ä¸€ä¸ªç»„å»ºå¥½çš„å…·ä½“äº§å“ã€‚ äº§å“ï¼ˆProductï¼‰ï¼šå®ƒæ˜¯è¢«æ„å»ºçš„å¤æ‚å¯¹è±¡ï¼ŒåŒ…å«å¤šä¸ªç»„æˆéƒ¨ä»¶ï¼Œå…·ä½“å»ºé€ è€…åˆ›å»ºè¯¥äº§å“çš„å†…éƒ¨è¡¨ç¤ºå¹¶å®šä¹‰å®ƒçš„è£…é…è¿‡ç¨‹ã€‚ å¯¼æ¼”è€…ï¼ˆDirectorï¼‰ï¼šåˆç§°æŒ‡æŒ¥è€…ï¼Œå®ƒè´Ÿè´£å®‰æ’å¤æ‚å¯¹è±¡çš„å»ºé€ æ¬¡åºï¼ŒæŒ‡æŒ¥è€…ä¸æŠ½è±¡å»ºé€ è€…ä¹‹é—´å­˜åœ¨å…³è”å…³ç³»ï¼Œå¯ä»¥åœ¨å…¶construct()å»ºé€ æ–¹æ³•ä¸­è°ƒç”¨å»ºé€ è€…å¯¹è±¡çš„éƒ¨ä»¶æ„é€ ä¸è£…é…æ–¹æ³•ï¼Œå®Œæˆå¤æ‚å¯¹è±¡çš„å»ºé€ ã€‚å®¢æˆ·ç«¯ä¸€èˆ¬åªéœ€è¦ä¸æŒ‡æŒ¥è€…è¿›è¡Œäº¤äº’ï¼Œåœ¨å®¢æˆ·ç«¯ç¡®å®šå…·ä½“å»ºé€ è€…çš„ç±»å‹ï¼Œå¹¶å®ä¾‹åŒ–å…·ä½“å»ºé€ è€…å¯¹è±¡ï¼ˆä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å’Œåå°„æœºåˆ¶ï¼‰ï¼Œç„¶åé€šè¿‡æŒ‡æŒ¥è€…ç±»çš„æ„é€ å‡½æ•°æˆ–è€…Setteræ–¹æ³•å°†è¯¥å¯¹è±¡ä¼ å…¥æŒ‡æŒ¥è€…ç±»ä¸­ã€‚ æ€»ç»“ï¼š å»ºé€ è€…æ¨¡å¼ æœ€ç»ˆè¿”å›ä¸€ä¸ªå…·ä½“çš„æ„å»ºå¤æ‚çš„äº§å“ï¼› ç³»ç»Ÿä¸­äº§å“å¯èƒ½åªæœ‰ä¸€ç§ç±»å‹æˆ–å¤šç§ç±»å‹ï¼Œä½†å¯¹æŸäº›äº§å“æ—æ¥è¯´ï¼Œå®ƒä»¬å…·å¤‡ç›¸åŒçš„è¡Œä¸ºï¼Œå› æ­¤å¯¹è¿™äº›å…±æ€§è¡Œä¸ºè¿›è¡ŒæŠ½è±¡ï¼ŒæŠ½ç¦»å‡º æŠ½è±¡å»ºé€ è€…ï¼ˆBuilderï¼‰ï¼› è€Œå¯¹è¿™äº›è¡Œä¸ºçš„å…·ä½“æ„å»ºè¿‡ç¨‹ï¼Œåˆ™äº¤ç”± å…·ä½“å»ºé€ è€…ï¼ˆConcrete Builderï¼‰ è´Ÿè´£ï¼Œä¸åŒçš„ å…·ä½“å»ºé€ è€… ä¼šæ„å»ºå‡ºä¸åŒè¡¨ç¤ºçš„äº§å“ï¼› è€Œå…·ä½“è¦æ„å»ºå‡ºå“ªç§äº§å“ï¼Œç”± å¯¼æ¼”è€…ï¼ˆDirectorï¼‰ å†³å®šã€‚å¯¼æ¼”è€… ä¼šé€‰æ‹©ä¸åŒçš„ å…·ä½“å»ºé€ è€…ï¼ŒæŒ‡å¯¼å®ƒæ„å»ºå‡ºäº§å“ã€‚ æ¨¡å¼ä¼˜ç‚¹ åœ¨å»ºé€ è€…æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ï¼Œå°†äº§å“æœ¬èº«ä¸äº§å“çš„åˆ›å»ºè¿‡ç¨‹è§£è€¦ï¼Œä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“å¯¹è±¡ã€‚ æ¯ä¸€ä¸ªå…·ä½“å»ºé€ è€…éƒ½ç›¸å¯¹ç‹¬ç«‹ï¼Œè€Œä¸å…¶ä»–çš„å…·ä½“å»ºé€ è€…æ— å…³ï¼Œå› æ­¤å¯ä»¥å¾ˆæ–¹ä¾¿åœ°æ›¿æ¢å…·ä½“å»ºé€ è€…æˆ–å¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…ï¼Œç”¨æˆ·ä½¿ç”¨ä¸åŒçš„å…·ä½“å»ºé€ è€…å³å¯å¾—åˆ°ä¸åŒçš„äº§å“å¯¹è±¡ã€‚ç”±äºæŒ‡æŒ¥è€…ç±»é’ˆå¯¹æŠ½è±¡å»ºé€ è€…ç¼–ç¨‹ï¼Œå¢åŠ æ–°çš„å…·ä½“å»ºé€ è€…æ— é¡»ä¿®æ”¹åŸæœ‰ç±»åº“çš„ä»£ç ï¼Œç³»ç»Ÿæ‰©å±•æ–¹ä¾¿ï¼Œç¬¦åˆ â€œå¼€é—­åŸåˆ™â€ã€‚ å¯ä»¥æ›´åŠ ç²¾ç»†åœ°æ§åˆ¶äº§å“çš„åˆ›å»ºè¿‡ç¨‹ã€‚å°†å¤æ‚äº§å“çš„åˆ›å»ºæ­¥éª¤åˆ†è§£åœ¨ä¸åŒçš„æ–¹æ³•ä¸­ï¼Œä½¿å¾—åˆ›å»ºè¿‡ç¨‹æ›´åŠ æ¸…æ™°ï¼Œä¹Ÿæ›´æ–¹ä¾¿ä½¿ç”¨ç¨‹åºæ¥æ§åˆ¶åˆ›å»ºè¿‡ç¨‹ã€‚ æ¨¡å¼ç¼ºç‚¹ å»ºé€ è€…æ¨¡å¼æ‰€åˆ›å»ºçš„äº§å“ä¸€èˆ¬å…·æœ‰è¾ƒå¤šçš„å…±åŒç‚¹ï¼Œå…¶ç»„æˆéƒ¨åˆ†ç›¸ä¼¼ï¼›å¦‚æœäº§å“ä¹‹é—´çš„å·®å¼‚æ€§å¾ˆå¤§ï¼Œåˆ™ä¸é€‚åˆä½¿ç”¨å»ºé€ è€…æ¨¡å¼ï¼Œå› æ­¤å…¶ä½¿ç”¨èŒƒå›´å—åˆ°ä¸€å®šçš„é™åˆ¶ã€‚ å¦‚æœäº§å“çš„å†…éƒ¨å˜åŒ–å¤æ‚ï¼Œå¯èƒ½ä¼šå¯¼è‡´éœ€è¦å®šä¹‰å¾ˆå¤šå…·ä½“å»ºé€ è€…ç±»æ¥å®ç°è¿™ç§å˜åŒ–ï¼Œå¯¼è‡´ç³»ç»Ÿå˜å¾—å¾ˆåºå¤§ã€‚ é€‚ç”¨åœºæ™¯ éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡æœ‰å¤æ‚çš„å†…éƒ¨ç»“æ„ï¼Œè¿™äº›äº§å“å¯¹è±¡é€šå¸¸åŒ…å«å¤šä¸ªæˆå‘˜å±æ€§ã€‚ éœ€è¦ç”Ÿæˆçš„äº§å“å¯¹è±¡çš„å±æ€§ç›¸äº’ä¾èµ–ï¼Œéœ€è¦æŒ‡å®šå…¶ç”Ÿæˆé¡ºåºã€‚ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ç‹¬ç«‹äºåˆ›å»ºè¯¥å¯¹è±¡çš„ç±»ã€‚åœ¨å»ºé€ è€…æ¨¡å¼ä¸­é€šè¿‡å¼•å…¥äº†æŒ‡æŒ¥è€…ç±»ï¼Œå°†åˆ›å»ºè¿‡ç¨‹å°è£…åœ¨æŒ‡æŒ¥è€…ç±»ä¸­ï¼Œè€Œä¸åœ¨å»ºé€ è€…ç±»å’Œå®¢æˆ·ç±»ä¸­ã€‚ éš”ç¦»å¤æ‚å¯¹è±¡çš„åˆ›å»ºå’Œä½¿ç”¨ï¼Œå¹¶ä½¿å¾—ç›¸åŒçš„åˆ›å»ºè¿‡ç¨‹å¯ä»¥åˆ›å»ºä¸åŒçš„äº§å“ã€‚ æ¨¡å¼ç¤ºä¾‹ ä»¥å·¥å‚åˆ¶é€ ç”µè„‘ä¸ºä¾‹ã€‚ äº§å“è§’è‰² 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: äº§å“è§’è‰²--ç”µè„‘ */public class Computer { /** * å“ç‰Œ */ private String brand; /** * cpu */ private String cpu; /** * ä¸»æ¿ */ private String mainBoard; /** * ç¡¬ç›˜ */ private String hardDisk; /** * æ˜¾å¡ */ private String displayCard; /** * ç”µæº */ private String power; /** * å†…å­˜ */ private String memory; public String getBrand() { return brand; } public void setBrand(String brand) { this.brand = brand; } public String getCpu() { return cpu; } public void setCpu(String cpu) { this.cpu = cpu; } public String getMainBoard() { return mainBoard; } public void setMainBoard(String mainBoard) { this.mainBoard = mainBoard; } public String getHardDisk() { return hardDisk; } public void setHardDisk(String hardDisk) { this.hardDisk = hardDisk; } public String getDisplayCard() { return displayCard; } public void setDisplayCard(String displayCard) { this.displayCard = displayCard; } public String getPower() { return power; } public void setPower(String power) { this.power = power; } public String getMemory() { return memory; } public void setMemory(String memory) { this.memory = memory; } @Override public String toString() { return "Computer{" + "brand='" + brand + '\'' + ", cpu='" + cpu + '\'' + ", mainBoard='" + mainBoard + '\'' + ", hardDisk='" + hardDisk + '\'' + ", displayCard='" + displayCard + '\'' + ", power='" + power + '\'' + ", memory='" + memory + '\'' + '}'; }} æŠ½è±¡å»ºé€ è€… 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: æŠ½è±¡å»ºé€ è€… */public abstract class Builder { /** * äº§å“è§’è‰² */ protected Computer computer = new Computer(); public abstract void buildBrand(); public abstract void buildCPU(); public abstract void buildMainBoard(); public abstract void buildHardDisk(); public abstract void buildDisplayCard(); public abstract void buildPower(); public abstract void buildMemory(); /** * åˆ¶é€ ç”µè„‘ * * @return */ public Computer createComputer() { return computer; }} å…·ä½“å»ºé€ è€… 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: å…·ä½“å»ºé€ è€…--æˆ´å°” */public class DellComputerBuilder extends Builder { @Override public void buildBrand() { computer.setBrand("æˆ´å°”ç”µè„‘"); } @Override public void buildCPU() { computer.setCpu("i5-8300H å››æ ¸"); } @Override public void buildMainBoard() { computer.setMainBoard("æˆ´å°”ä¸»æ¿"); } @Override public void buildHardDisk() { computer.setHardDisk("1T + 128GB SSD"); } @Override public void buildDisplayCard() { computer.setDisplayCard("GTX1060 ç‹¬ç«‹6GB"); } @Override public void buildPower() { computer.setPower("4èŠ¯ é”‚ç¦»å­ç”µæ±  180W ACé€‚é…å™¨"); } @Override public void buildMemory() { computer.setMemory("4G + 4G"); }}package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: å…·ä½“å»ºé€ è€…--åç¡•ç”µè„‘ */public class ASUSComputerBuilder extends Builder { @Override public void buildBrand() { computer.setBrand("åç¡•ç”µè„‘"); } @Override public void buildCPU() { computer.setCpu("Intel ç¬¬8ä»£ é…·ç¿"); } @Override public void buildMainBoard() { computer.setMainBoard("åç¡•ä¸»æ¿"); } @Override public void buildHardDisk() { computer.setHardDisk("256GB SSD"); } @Override public void buildDisplayCard() { computer.setDisplayCard("MX150 ç‹¬ç«‹2GB"); } @Override public void buildPower() { computer.setPower("3èŠ¯ é”‚ç¦»å­ç”µæ±  65W ACé€‚é…å™¨"); } @Override public void buildMemory() { computer.setMemory("1 x SO-DIMM 8GB"); }} æµ‹è¯•ç±» 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.builder.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±» */public class TestBuilder { public static void main(String[] args) { ComputerDirector director = new ComputerDirector(); //åç¡•ç”µè„‘ Builder asusBuilder = new ASUSComputerBuilder(); Computer asusComputer = director.construct(asusBuilder); System.out.println(asusComputer.toString()); //æˆ´å°”ç”µè„‘--é€šè¿‡åå°„æœºåˆ¶åˆ›å»ºå…·ä½“å»ºé€ è€… try { Class clazz = Class.forName("main.java.com.study.designPatterns.builder.demoOne.DellComputerBuilder"); Builder dellBuilder = (DellComputerBuilder) clazz.newInstance(); Computer dellComputer = director.construct(dellBuilder); System.out.println(dellComputer.toString()); } catch (ClassNotFoundException e) { e.printStackTrace(); } catch (IllegalAccessException e) { e.printStackTrace(); } catch (InstantiationException e) { e.printStackTrace(); } }} å»ºé€ è€…æ¨¡å¼ä¸å·¥å‚æ¨¡å¼çš„åŒºåˆ« å»ºé€ è€…æ¨¡å¼ ä¸ å·¥å‚æ¨¡å¼ çš„å”¯ä¸€åŒºåˆ«å°±åœ¨äº æ„å»ºå¤æ‚å¯¹è±¡ï¼Œè¿™å…¶å®æ˜¯å®ƒä»¬çš„æœ¬è´¨åŒºåˆ«ã€‚è€Œä»è¡¨ç°å½¢å¼ä¸Šçœ‹ï¼Œå»ºé€ è€…æ¨¡å¼ æ¯” å·¥å‚æ¨¡å¼ å¤šäº†ä¸€ä¸ª å¯¼æ¼”è€…ï¼ˆDirectorï¼‰çš„è§’è‰²ã€‚å¦‚æœå¿½ç•¥ å¯¼æ¼”è€…ï¼Œé‚£ä¹ˆ å»ºé€ è€…æ¨¡å¼ ä¸ å·¥å‚æ¨¡å¼ å‡ ä¹æ˜¯ä¸€æ ·çš„ã€‚ ä»ä¸Šæ–‡ å»ºé€ è€…æ¨¡å¼ UML ç±»å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå¯¼æ¼”è€… æ˜¯è´Ÿè´£æ²Ÿé€š å®¢æˆ· ä¸ å…·ä½“å»ºé€ è€… çš„æ¡¥æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¼æ¼”è€… è§£è€¦äº† å®¢æˆ· ä¸ å…·ä½“å»ºé€ è€…ã€‚å› ä¸º å…·ä½“å»ºé€ è€… å±äºç»†èŠ‚å®ç°ï¼Œæ˜¯åº•å±‚æ¨¡å—ï¼Œä¸šåŠ¡ç»å¸¸å˜æ¢ï¼Œä¸ç¨³å®šï¼›è€Œ å®¢æˆ· å±äºä¸Šå±‚æ¨¡å—ï¼Œæ˜¯ä¸šåŠ¡é€»è¾‘éƒ¨åˆ†ï¼Œç›¸å¯¹ç¨³å®šï¼›å¦‚æœä¸è®¾ç½® å¯¼æ¼”è€… ä½œä¸ºä¸­é—´äººï¼Œç›´æ¥æŠŠ å…·ä½“å»ºé€ è€… åµŒå…¥åˆ°ä¸šåŠ¡é€»è¾‘ï¼ˆå®¢æˆ·ï¼‰ä¸­ï¼Œä¼šå¯¼è‡´å½“ä¸šåŠ¡æ”¹å˜ï¼ˆäº§å“æ”¹å˜ï¼‰æ—¶ï¼Œéœ€è¦æ›´æ¢ å…·ä½“å»ºé€ è€…ï¼Œä¾µå…¥äº†ä¸šåŠ¡é€»è¾‘ï¼ˆå®¢æˆ·ï¼‰ä»£ç ï¼Œä¸ç¬¦åˆè®¾è®¡æ¨¡å¼çš„è¿ªç±³ç‰¹æ³•åˆ™ã€‚ è€Œ å·¥å‚æ¨¡å¼ ä¹‹æ‰€ä»¥æ²¡æœ‰ å¯¼æ¼”è€… è¿™ä¸ªè§’è‰²ï¼Œæ˜¯å› ä¸º å·¥å‚ æœ¬èº«å°±æ‹…å½“äº†è¯¥è§’è‰²ã€‚å› ä¸º å¯¼æ¼”è€… æœ€ç»ˆçš„ä½œç”¨å°±æ˜¯æä¾›ä¸€ä¸ªç»„è£…å¥½çš„å¯¹è±¡ç»™åˆ° å®¢æˆ·ï¼Œä¸ å·¥å‚ çš„ä½œç”¨ä¸€è‡´ã€‚åªæ˜¯ç”±äº å·¥å‚ ç”Ÿäº§çš„éƒ½æ˜¯ç®€å•å¯¹è±¡ï¼Œå› æ­¤ å·¥å‚ ç›´æ¥æä¾›ç»™ å®¢æˆ· å°±è¡Œäº†ï¼›è€Œ å»ºé€ è€…æ¨¡å¼ æä¾›çš„æ˜¯å¤æ‚å¯¹è±¡ï¼Œéœ€è¦ä¸“é—¨çš„æ„å»ºè¿‡ç¨‹ï¼Œå› æ­¤å€ŸåŠ© å¯¼æ¼”è€… å»æ²Ÿé€š å…·ä½“çš„å»ºé€ è€… æ„å»ºå‡ºç›¸åº”çš„å¤æ‚å¯¹è±¡ï¼Œç„¶åç”± å¯¼æ¼”è€… è¿”å›ç»™ å®¢æˆ·ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JDKåŠ¨æ€ä»£ç†]]></title>
    <url>%2Fposts%2Fdfdc2005.html</url>
    <content type="text"><![CDATA[ä»£ç†æ¨¡å¼å®ç°æ–¹å¼ä»‹ç» ä»€ä¹ˆæ˜¯ä»£ç†æ¨¡å¼ æ—¥å¸¸ç”Ÿæ´»ä¸­æˆ‘ä»¬ç»å¸¸ä¼šç¢°åˆ°ä»£ç†æ¨¡å¼ï¼Œä¾‹å¦‚æˆ‘ä»¬æ‰¾æˆ¿äº§ä¸­ä»‹å¸®æˆ‘ä»¬æ‰¾æˆ¿å­ï¼Œæ‰¾å©šå§»ä¸­ä»‹å¸®æˆ‘ä»¬ä»‹ç»å¯¹è±¡ï¼Œæ‰¾ä¿æ´å¸®æˆ‘ä»¬æ‰“ç†æˆ¿é—´ç­‰ã€‚åœ¨æ— å½¢ä¸­è¿ç”¨åˆ°äº†ä»£ç†æ¨¡å¼ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä»£ç†ï¼Ÿ è¿ç”¨ä»£ç†å¯ä»¥ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»æ›´åŠ ä¾¿åˆ©ï¼Œæœ‰äº†ä»£ç†ï¼Œæˆ‘ä»¬ä¸éœ€è¦è‡ªå·±å»æ‰¾æˆ¿å­ï¼Œä¸éœ€è¦è‡ªå·±å»æ‰¾å¯¹è±¡ï¼Œä¸éœ€è¦è‡ªå·±å»æ‰“ç†æˆ¿é—´ã€‚å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥é€‰æ‹©ä¸€åˆ‡éƒ½è‡ªå·±æ¥å¹²ï¼Œä½†æ˜¯å­˜åœ¨å‰ææ¡ä»¶ï¼Œä¸€æ˜¯ä½ æ˜¯å¦éƒ½å…·å¤‡è¿™æ ·çš„èµ„æºå’Œèƒ½åŠ›æ¥åšè¿™äº›äº‹æƒ…ï¼ŒäºŒæ˜¯ä½ æ˜¯å¦æ„¿æ„èŠ±è´¹è¿™ä¹ˆå¤šç²¾åŠ›å’Œæ—¶é—´æ¥åšè¿™äº›äº‹æƒ…ã€‚æ€»ä¹‹ï¼Œä»£ç†æ¨¡å¼ä½¿æˆ‘ä»¬å„ä¸“å…¶äº‹ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ—¶é—´æ¶ˆè€—åœ¨ç¾å¥½çš„äº‹æƒ…ä¸Šï¼Œè€Œä¸ç”¨å¤©å¤©è¢«ä¸€äº›çäº‹æ‰€ç¾ç»Šã€‚ ä»£ç†æ¨¡å¼æœ‰å“ªäº›å®ç°ï¼Ÿ Javaä¸­çš„ä»£ç†æœ‰é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼Œä¸‹é¢åˆ†åˆ«ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥ä»‹ç»ä¸€ä¸‹é™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ä»£ç å®ç°ã€‚ é™æ€ä»£ç† ä»£ç†æ¥å£ 12345678910111213package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ä»£ç†æ¥å£ */public interface UserDao { /** * ä¿å­˜ */ void save();} ç›®æ ‡å¯¹è±¡ 12345678910111213package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ç›®æ ‡å¯¹è±¡ */public class UserDaoImpl implements UserDao { @Override public void save() { System.out.println("æ­£åœ¨ä¿å­˜ç”¨æˆ·..."); }} ä»£ç†å¯¹è±¡ 1234567891011121314151617181920212223242526272829303132package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: ä»£ç†å¯¹è±¡ */public class TransactionHandler implements UserDao { /** * ç›®æ ‡ä»£ç†å¯¹è±¡ */ private UserDaoImpl target; /** * æ„é€ ä»£ç†å¯¹è±¡æ—¶ä¼ å…¥ç›®æ ‡å¯¹è±¡ * * @param target */ public TransactionHandler(UserDaoImpl target) { this.target = target; } @Override public void save() { //è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰çš„å¤„ç† System.out.println("å¼€å¯äº‹åŠ¡æ§åˆ¶..."); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• target.save(); //è°ƒç”¨ç›®æ ‡æ–¹æ³•åçš„å¤„ç† System.out.println("å…³é—­äº‹åŠ¡æ§åˆ¶..."); }} æµ‹è¯•è°ƒç”¨ 123456789101112131415161718package main.java.com.study.designPatterns.proxy.staticProxy;/** * @author: whb * @description: æµ‹è¯•é™æ€ä»£ç† */public class TestStaticProxy { public static void main(String[] args) { //æ–°å»ºç›®æ ‡å¯¹è±¡ UserDaoImpl target = new UserDaoImpl(); //åˆ›å»ºä»£ç†å¯¹è±¡, å¹¶ä½¿ç”¨æ¥å£å¯¹å…¶è¿›è¡Œå¼•ç”¨ UserDao userDao = new TransactionHandler(target); //é’ˆå¯¹æ¥å£è¿›è¡Œè°ƒç”¨ userDao.save(); }} æµ‹è¯•ç»“æœ 123å¼€å¯äº‹åŠ¡æ§åˆ¶...æ­£åœ¨ä¿å­˜ç”¨æˆ·...å…³é—­äº‹åŠ¡æ§åˆ¶... æ€»ç»“ é™æ€ä»£ç†å®ç°ç®€å•ä¹Ÿå®¹æ˜“ç†è§£ï¼Œä½†æ˜¯é™æ€ä»£ç†ä¸èƒ½ä½¿ä¸€ä¸ªä»£ç†ç±»åå¤ä½œç”¨äºå¤šä¸ªç›®æ ‡å¯¹è±¡ï¼Œä»£ç†å¯¹è±¡ç›´æ¥æŒæœ‰ç›®æ ‡å¯¹è±¡çš„å¼•ç”¨ï¼Œè¿™å¯¼è‡´ä»£ç†å¯¹è±¡å’Œç›®æ ‡å¯¹è±¡ç±»å‹ç´§å¯†è€¦åˆäº†åœ¨ä¸€èµ·ã€‚å¦‚æœUserDaoæ¥å£ä¸‹è¿˜æœ‰å¦ä¸€ä¸ªå®ç°ç±»ä¹Ÿéœ€è¦è¿›è¡Œäº‹åŠ¡æ§åˆ¶ï¼Œé‚£ä¹ˆå°±è¦é‡æ–°å†™ä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™æ ·å°±ä¼šäº§ç”Ÿè®¸å¤šé‡å¤çš„æ¨¡ç‰ˆä»£ç ï¼Œä¸èƒ½è¾¾åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚è€ŒåŠ¨æ€ä»£ç†å°±å¯ä»¥å¾ˆå¥½çš„è§£å†³è¿™æ ·çš„é—®é¢˜ã€‚ åŠ¨æ€ä»£ç† ä»£ç†æ¥å£ 12345678910111213package main.java.com.study.designPatterns.proxy.JdkProxy;/** * @author: whb * @date: 2019/9/4 9:50 * @description: ä»£ç†æ¥å£ */public interface UserDao { /** * ä¿å­˜ç”¨æˆ· */ void save();} ç›®æ ‡å¯¹è±¡ 1234567891011121314package main.java.com.study.designPatterns.proxy.JdkProxy;/** * @author: whb * @date: 2019/9/4 9:51 * @description: ç›®æ ‡å¯¹è±¡ */public class UserDaoImpl implements UserDao { @Override public void save() { System.out.println("ä¿å­˜ç”¨æˆ·ä¿¡æ¯..."); }} ä»£ç†å¯¹è±¡ 123456789101112131415161718192021222324252627282930313233343536package main.java.com.study.designPatterns.proxy.JdkProxy;import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * @author: whb * @description: ä»£ç†å¯¹è±¡ */public class TransactionHandler implements InvocationHandler { /** * éœ€è¦ä»£ç†çš„ç›®æ ‡å¯¹è±¡ï¼Œè¿™é‡Œè®¾è®¡ä¸ºå¯ä»¥ä¸ºä»»æ„å¯¹è±¡æ·»åŠ äº‹åŠ¡æ§åˆ¶, æ‰€ä»¥å°†ç›®æ ‡å¯¹è±¡å£°æ˜ä¸ºObject */ private Object target; /** * æ„é€ TransactionHandleræ—¶ä¼ å…¥ç›®æ ‡å¯¹è±¡ * * @param target */ public TransactionHandler(Object target) { this.target = target; } @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable { //è°ƒç”¨ç›®æ ‡æ–¹æ³•å‰çš„å¤„ç† System.out.println("å¼€å¯äº‹åŠ¡æ§åˆ¶..."); //è°ƒç”¨ç›®æ ‡å¯¹è±¡çš„æ–¹æ³• Object result = method.invoke(target, args); //è°ƒç”¨ç›®æ ‡æ–¹æ³•åçš„å¤„ç† System.out.println("å…³é—­äº‹åŠ¡æ§åˆ¶..."); //æ”¾å›æ–¹æ³•è°ƒç”¨ç»“æœ return result; }} æµ‹è¯•ç±» 123456789101112131415161718192021222324package main.java.com.study.designPatterns.proxy.JdkProxy;import java.lang.reflect.Proxy;/** * @author: whb * @description: æµ‹è¯•JDKåŠ¨æ€ä»£ç† */public class TestJdkProxy { public static void main(String[] args) { //æ–°å»ºç›®æ ‡å¯¹è±¡ Object target = new UserDaoImpl(); //åˆ›å»ºäº‹åŠ¡å¤„ç†å™¨ TransactionHandler handler = new TransactionHandler(target); //ç”Ÿæˆä»£ç†ç±»å¹¶ä½¿ç”¨æ¥å£å¯¹å…¶è¿›è¡Œå¼•ç”¨ UserDao userDao = (UserDao) Proxy.newProxyInstance(target.getClass().getClassLoader(), target.getClass().getInterfaces(), handler); //é’ˆå¯¹æ¥å£è¿›è¡Œæ–¹æ³•è°ƒç”¨ userDao.save(); }} æµ‹è¯•ç»“æœ 123å¼€å¯äº‹åŠ¡æ§åˆ¶...ä¿å­˜ç”¨æˆ·ä¿¡æ¯...å…³é—­äº‹åŠ¡æ§åˆ¶... æ€»ç»“ ä¹‹å‰å‘ç°é™æ€ä»£ç†ä¼šäº§ç”Ÿè®¸å¤šé‡å¤ä»£ç ï¼Œä¸èƒ½å¾ˆå¥½çš„è¿›è¡Œä»£ç å¤ç”¨ï¼Œè€ŒåŠ¨æ€ä»£ç†èƒ½å¤Ÿå¾ˆå¥½çš„è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»£ç†ç±»TransactionHandlerå®ç°äº†InvocationHandleræ¥å£ï¼Œå¹¶ä¸”å®ƒæŒæœ‰çš„ç›®æ ‡å¯¹è±¡ç±»å‹æ˜¯Objectï¼Œå› æ­¤äº‹åŠ¡æ§åˆ¶ä»£ç†ç±»TransactionHandlerèƒ½å¤Ÿä»£ç†ä»»æ„çš„å¯¹è±¡ï¼Œä¸ºä»»æ„çš„å¯¹è±¡æ·»åŠ äº‹åŠ¡æ§åˆ¶çš„é€»è¾‘ã€‚å› æ­¤åŠ¨æ€ä»£ç†æ‰çœŸæ­£çš„å°†ä»£ç ä¸­æ¨ªå‘åˆ‡é¢çš„é€»è¾‘å‰¥ç¦»äº†å‡ºæ¥ï¼Œèµ·åˆ°ä»£ç å¤ç”¨çš„ç›®çš„ã€‚ ä½†æ˜¯åŠ¨æ€ä»£ç†ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œä¸€æ˜¯å®ƒçš„å®ç°æ¯”é™æ€ä»£ç†æ›´åŠ å¤æ‚ä¹Ÿä¸å¥½ç†è§£ï¼›äºŒæ˜¯å®ƒå­˜åœ¨ä¸€å®šçš„é™åˆ¶ï¼Œä¾‹å¦‚å®ƒè¦æ±‚éœ€è¦ä»£ç†çš„å¯¹è±¡å¿…é¡»å®ç°äº†æŸä¸ªæ¥å£ï¼›ä¸‰æ˜¯å®ƒä¸å¤Ÿçµæ´»ï¼ŒåŠ¨æ€ä»£ç†ä¼šä¸ºæ¥å£ä¸­çš„å£°æ˜çš„æ‰€æœ‰æ–¹æ³•æ·»åŠ ä¸Šç›¸åŒçš„ä»£ç†é€»è¾‘ã€‚ JDKåŠ¨æ€ä»£ç†çš„åº•å±‚å®ç°Proxyåˆ†æ åœ¨åŠ¨æ€ä»£ç†çš„æµ‹è¯•ç±»TestJdkProxyä¸­ä½¿ç”¨äº†Proxyç±»çš„é™æ€æ–¹æ³•newProxyInstanceæ–¹æ³•å»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ï¼Œè¿™ä¸ªé™æ€æ–¹æ³•æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ç›®æ ‡ç±»çš„ç±»åŠ è½½å™¨ï¼Œç›®æ ‡ç±»å®ç°çš„æ¥å£é›†åˆï¼ŒInvocationHandlerå®ä¾‹ï¼Œæœ€åè¿”å›ä¸€ä¸ªObjectç±»å‹çš„ä»£ç†ç±»ã€‚å…ˆä»è¯¥æ–¹æ³•å¼€å§‹ï¼Œçœ‹çœ‹ä»£ç†ç±»æ˜¯æ€æ ·ä¸€æ­¥ä¸€æ­¥é€ å‡ºæ¥çš„ã€‚ newProxyInstanceæ–¹æ³• 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/** * è¿”å›æŒ‡å®šæ¥å£çš„ä»£ç†ç±»çš„å®ä¾‹ï¼Œè¯¥æ¥å£å°†æ–¹æ³•è°ƒç”¨åˆ†å‘ç»™æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºã€‚è¿™ä¸ªé™æ€æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°ï¼š * @param ClassLoader loaderï¼ŒæŒ‡å®šå½“å‰ç›®æ ‡å¯¹è±¡ä½¿ç”¨ç±»åŠ è½½å™¨ * @param Class&lt;?&gt;[ ] interfacesï¼Œç›®æ ‡å¯¹è±¡å®ç°çš„æ¥å£çš„ç±»å‹,ä½¿ç”¨æ³›å‹æ–¹å¼ç¡®è®¤ç±»å‹ * @param InvocationHandler hï¼Œäº‹ä»¶å¤„ç†,æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•æ—¶,ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨çš„æ–¹æ³•,ä¼šæŠŠå½“å‰æ‰§è¡Œç›®æ ‡å¯¹è±¡çš„æ–¹æ³•ä½œä¸ºå‚æ•°ä¼ å…¥ */public static Object newProxyInstance(ClassLoader loader, Class&lt;?&gt;[] interfaces, InvocationHandler h) throws IllegalArgumentException { //éªŒè¯ä¼ å…¥çš„InvocationHandlerä¸èƒ½ä¸ºç©º Objects.requireNonNull(h); //å¤åˆ¶ä»£ç†ç±»å®ç°çš„æ‰€æœ‰æ¥å£ final Class&lt;?&gt;[] intfs = interfaces.clone(); //è·å–å®‰å…¨ç®¡ç†å™¨ final SecurityManager sm = System.getSecurityManager(); //è¿›è¡Œä¸€äº›æƒé™æ£€éªŒ if (sm != null) { checkProxyAccess(Reflection.getCallerClass(), loader, intfs); } /* * è¯¥æ–¹æ³•å…ˆä»ç¼“å­˜è·å–ä»£ç†ç±», å¦‚æœæ²¡æœ‰å†å»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±» */ Class&lt;?&gt; cl = getProxyClass0(loader, intfs); /* * ä½¿ç”¨æŒ‡å®šçš„è°ƒç”¨å¤„ç†ç¨‹åºè°ƒç”¨å…¶æ„é€ å‡½æ•°. */ try { //è¿›è¡Œä¸€äº›æƒé™æ£€éªŒ if (sm != null) { checkNewProxyPermission(Reflection.getCallerClass(), cl); } //è·å–å‚æ•°ç±»å‹æ˜¯InvocationHandler.classçš„ä»£ç†ç±»æ„é€ å™¨ final Constructor&lt;?&gt; cons = cl.getConstructor(constructorParams); final InvocationHandler ih = h; //å¦‚æœä»£ç†ç±»æ˜¯ä¸å¯è®¿é—®çš„, å°±ä½¿ç”¨ç‰¹æƒå°†å®ƒçš„æ„é€ å™¨è®¾ç½®ä¸ºå¯è®¿é—® if (!Modifier.isPublic(cl.getModifiers())) { AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() { public Void run() { cons.setAccessible(true); return null; } }); } //æ‰€æœ‰ä»£ç†ç±»éƒ½ç»§æ‰¿è‡ªProxy, å› æ­¤è¿™é‡Œä¼šè°ƒç”¨Proxyçš„æ„é€ å™¨å°†InvocationHandlerå¼•ç”¨ä¼ å…¥å»æ„é€ ä¸€ä¸ªä»£ç†ç±»çš„å®ä¾‹ return cons.newInstance(new Object[]{h}); } catch (IllegalAccessException|InstantiationException e) { throw new InternalError(e.toString(), e); } catch (InvocationTargetException e) { Throwable t = e.getCause(); if (t instanceof RuntimeException) { throw (RuntimeException) t; } else { throw new InternalError(t.toString(), t); } } catch (NoSuchMethodException e) { throw new InternalError(e.toString(), e); }} newProxyInstanceæ–¹æ³•é¦–å…ˆæ˜¯å¯¹å‚æ•°è¿›è¡Œä¸€äº›æƒé™æ ¡éªŒï¼Œä¹‹åé€šè¿‡è°ƒç”¨getProxyClass0æ–¹æ³•ç”Ÿæˆäº†ä»£ç†ç±»çš„ç±»å¯¹è±¡ï¼Œç„¶åè·å–å‚æ•°ç±»å‹æ˜¯InvocationHandler.classçš„ä»£ç†ç±»æ„é€ å™¨ã€‚æ£€éªŒæ„é€ å™¨æ˜¯å¦å¯ä»¥è®¿é—®ï¼Œæœ€åä¼ å…¥InvocationHandlerå®ä¾‹çš„å¼•ç”¨å»æ„é€ å‡ºä¸€ä¸ªä»£ç†ç±»å®ä¾‹ï¼ŒInvocationHandlerå®ä¾‹çš„å¼•ç”¨å…¶å®æ˜¯ProxyæŒæœ‰ç€ï¼Œå› ä¸ºç”Ÿæˆçš„ä»£ç†ç±»é»˜è®¤ç»§æ‰¿è‡ªProxyï¼Œæ‰€ä»¥æœ€åä¼šè°ƒç”¨Proxyçš„æ„é€ å™¨å°†å¼•ç”¨ä¼ å…¥ã€‚ getProxyClass0æ–¹æ³• ä¸‹é¢çœ‹ä¸‹getProxyClass0è¿™ä¸ªæ–¹æ³•ï¼Œçœ‹çœ‹ä»£ç†ç±»çš„Classå¯¹è±¡æ˜¯æ€æ ·æ¥çš„ã€‚ 123456789101112/** * ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ã€‚å¿…é¡»è°ƒç”¨checkProxyAccessæ–¹æ³•ï¼Œåœ¨è°ƒç”¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰éœ€è¦æ£€æŸ¥æƒé™ã€‚ */ private static Class&lt;?&gt; getProxyClass0(ClassLoader loader, Class&lt;?&gt;... interfaces) { //ç›®æ ‡ç±»å®ç°çš„æ¥å£ä¸èƒ½å¤§äº65535 if (interfaces.length &gt; 65535) { throw new IllegalArgumentException("interface limit exceeded"); } //å¦‚æœç”±ç»™å®šçš„è£…è½½æœºå®šä¹‰çš„ä»£ç†ç±»å®ç°ç»™å®šçš„æ¥å£å­˜åœ¨ï¼Œè¿™å°†ä¼šè¿”å›ç¼“å­˜ï¼›å¦åˆ™ï¼Œå®ƒå°†é€šè¿‡ProxyClassFactoryåˆ›å»ºä»£ç†ç±»ã€‚ return proxyClassCache.get(loader, interfaces);} getProxyClass0æ–¹æ³•å†…éƒ¨æ²¡æœ‰å¤šå°‘å†…å®¹ï¼Œé¦–å…ˆæ˜¯æ£€æŸ¥ç›®æ ‡ä»£ç†ç±»å®ç°çš„æ¥å£ä¸èƒ½å¤§äº65535è¿™ä¸ªæ•°ï¼Œä¹‹åæ˜¯é€šè¿‡ç±»åŠ è½½å™¨å’Œæ¥å£é›†åˆå»ç¼“å­˜é‡Œé¢è·å–ï¼Œå¦‚æœèƒ½æ‰¾åˆ°ä»£ç†ç±»å°±ç›´æ¥è¿”å›ï¼Œå¦åˆ™å°±ä¼šè°ƒç”¨ProxyClassFactoryè¿™ä¸ªå·¥å‚å»ç”Ÿæˆä¸€ä¸ªä»£ç†ç±»ã€‚ ProxyClassFactoryå·¥å‚ç±» 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485//ä»£ç†ç±»ç”Ÿæˆå·¥å‚private static final class ProxyClassFactory implements BiFunction&lt;ClassLoader, Class&lt;?&gt;[], Class&lt;?&gt;&gt; { //ä»£ç†ç±»åç§°å‰ç¼€ private static final String proxyClassNamePrefix = "$Proxy"; //ç”¨åŸå­ç±»æ¥ç”Ÿæˆä»£ç†ç±»çš„åºå·, ä»¥æ­¤æ¥ç¡®å®šå”¯ä¸€çš„ä»£ç†ç±» private static final AtomicLong nextUniqueNumber = new AtomicLong(); @Override public Class&lt;?&gt; apply(ClassLoader loader, Class&lt;?&gt;[] interfaces) { Map&lt;Class&lt;?&gt;, Boolean&gt; interfaceSet = new IdentityHashMap&lt;&gt;(interfaces.length); for (Class&lt;?&gt; intf : interfaces) { //è¿™é‡Œéå†interfacesæ•°ç»„è¿›è¡ŒéªŒè¯, ä¸»è¦åšä¸‰ä»¶äº‹æƒ… /* * 1.intfæ˜¯å¦å¯ä»¥ç”±æŒ‡å®šçš„ç±»åŠ è½½è¿›è¡ŒåŠ è½½ */ Class&lt;?&gt; interfaceClass = null; try { interfaceClass = Class.forName(intf.getName(), false, loader); } catch (ClassNotFoundException e) { } if (interfaceClass != intf) { throw new IllegalArgumentException( intf + " is not visible from class loader"); } /* * 2.intfæ˜¯å¦æ˜¯ä¸€ä¸ªæ¥å£ */ if (!interfaceClass.isInterface()) { throw new IllegalArgumentException( interfaceClass.getName() + " is not an interface"); } /* * 3.intfåœ¨æ•°ç»„ä¸­æ˜¯å¦æœ‰é‡å¤ */ if (interfaceSet.put(interfaceClass, Boolean.TRUE) != null) { throw new IllegalArgumentException( "repeated interface: " + interfaceClass.getName()); } } //ç”Ÿæˆä»£ç†ç±»çš„åŒ…å String proxyPkg = null; //ç”Ÿæˆä»£ç†ç±»çš„è®¿é—®æ ‡å¿—, é»˜è®¤æ˜¯public finalçš„ int accessFlags = Modifier.PUBLIC | Modifier.FINAL; for (Class&lt;?&gt; intf : interfaces) { //è·å–æ¥å£çš„è®¿é—®æ ‡å¿— int flags = intf.getModifiers(); //å¦‚æœæ¥å£çš„è®¿é—®æ ‡å¿—ä¸æ˜¯public, é‚£ä¹ˆç”Ÿæˆä»£ç†ç±»çš„åŒ…åå’Œæ¥å£åŒ…åç›¸åŒ if (!Modifier.isPublic(flags)) { //ç”Ÿæˆçš„ä»£ç†ç±»çš„è®¿é—®æ ‡å¿—è®¾ç½®ä¸ºfinal accessFlags = Modifier.FINAL; //è·å–æ¥å£å…¨é™å®šå, ä¾‹å¦‚ï¼šjava.util.Collection String name = intf.getName(); int n = name.lastIndexOf('.'); //å‰ªè£åå¾—åˆ°åŒ…å:java.util String pkg = ((n == -1) ? "" : name.substring(0, n + 1)); //ç”Ÿæˆçš„ä»£ç†ç±»çš„åŒ…åå’Œæ¥å£åŒ…åæ˜¯ä¸€æ ·çš„ if (proxyPkg == null) { proxyPkg = pkg; } else if (!pkg.equals(proxyPkg)) { //ä»£ç†ç±»å¦‚æœå®ç°ä¸åŒåŒ…çš„æ¥å£, å¹¶ä¸”æ¥å£éƒ½ä¸æ˜¯publicçš„, é‚£ä¹ˆå°±ä¼šåœ¨è¿™é‡ŒæŠ¥é”™ throw new IllegalArgumentException( "non-public interfaces from different packages"); } } } //å¦‚æœæ¥å£è®¿é—®æ ‡å¿—éƒ½æ˜¯publicçš„è¯, é‚£ç”Ÿæˆçš„ä»£ç†ç±»éƒ½æ”¾åˆ°é»˜è®¤çš„åŒ…ä¸‹ï¼šcom.sun.proxy if (proxyPkg == null) { proxyPkg = ReflectUtil.PROXY_PACKAGE + "."; } //ç”Ÿæˆä»£ç†ç±»çš„åºå· long num = nextUniqueNumber.getAndIncrement(); //ç”Ÿæˆä»£ç†ç±»çš„å…¨é™å®šå, åŒ…å+å‰ç¼€+åºå·, ä¾‹å¦‚ï¼šcom.sun.proxy.$Proxy0 String proxyName = proxyPkg + proxyClassNamePrefix + num; //è¿™é‡Œæ˜¯æ ¸å¿ƒ, ç”¨ProxyGeneratoræ¥ç”Ÿæˆå­—èŠ‚ç , è¯¥ç±»æ”¾åœ¨sun.miscåŒ…ä¸‹ byte[] proxyClassFile = ProxyGenerator.generateProxyClass(proxyName, interfaces, accessFlags); try { //æ ¹æ®äºŒè¿›åˆ¶æ–‡ä»¶ç”Ÿæˆç›¸åº”çš„Classå®ä¾‹ return defineClass0(loader, proxyName, proxyClassFile, 0, proxyClassFile.length); } catch (ClassFormatError e) { throw new IllegalArgumentException(e.toString()); } }} è¯¥å·¥å‚çš„applyæ–¹æ³•ä¼šè¢«è°ƒç”¨ç”¨æ¥ç”Ÿæˆä»£ç†ç±»çš„Classå¯¹è±¡ï¼Œç”±äºä»£ç çš„æ³¨é‡Šæ¯”è¾ƒè¯¦ç»†ï¼ŒåªæŒ‘å…³é”®ç‚¹è¿›è¡Œé˜è¿°ã€‚ åœ¨ä»£ç ä¸­å¯ä»¥çœ‹åˆ°JDKç”Ÿæˆçš„ä»£ç†ç±»çš„ç±»åæ˜¯â€œ$Proxyâ€+åºå·ã€‚ å¦‚æœæ¥å£æ˜¯publicçš„ï¼Œä»£ç†ç±»é»˜è®¤æ˜¯public finalçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„ä»£ç†ç±»é»˜è®¤æ”¾åˆ°com.sun.proxyè¿™ä¸ªåŒ…ä¸‹ã€‚ å¦‚æœæ¥å£æ˜¯épublicçš„ï¼Œé‚£ä¹ˆä»£ç†ç±»ä¹Ÿæ˜¯épublicçš„ï¼Œå¹¶ä¸”ç”Ÿæˆçš„ä»£ç†ç±»ä¼šæ”¾åœ¨å¯¹åº”æ¥å£æ‰€åœ¨çš„åŒ…ä¸‹ã€‚ å¦‚æœæ¥å£æ˜¯épublicçš„ï¼Œå¹¶ä¸”è¿™äº›æ¥å£ä¸åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œé‚£ä¹ˆå°±ä¼šæŠ¥é”™ã€‚ WeakCacheç¼“å­˜çš„å®ç°æœºåˆ¶ Proxyå†…éƒ¨ç”¨åˆ°äº†ç¼“å­˜æœºåˆ¶ï¼Œå¦‚æœæ ¹æ®æä¾›çš„ç±»åŠ è½½å™¨å’Œæ¥å£æ•°ç»„èƒ½åœ¨ç¼“å­˜ä¸­æ‰¾åˆ°ä»£ç†ç±»å°±ç›´æ¥è¿”å›è¯¥ä»£ç†ç±»ï¼Œå¦åˆ™ä¼šè°ƒç”¨ProxyClassFactoryå·¥å‚å»ç”Ÿæˆä»£ç†ç±»ã€‚è¿™é‡Œç”¨åˆ°çš„ç¼“å­˜æ˜¯äºŒçº§ç¼“å­˜ï¼Œå®ƒçš„ä¸€çº§ç¼“å­˜keyæ˜¯æ ¹æ®ç±»åŠ è½½å™¨ç”Ÿæˆçš„ï¼ŒäºŒçº§ç¼“å­˜keyæ˜¯æ ¹æ®æ¥å£æ•°ç»„ç”Ÿæˆçš„ã€‚å…·ä½“çš„å†…éƒ¨æœºåˆ¶ç›´æ¥ä¸Šä»£ç è¯¦ç»†è§£é‡Šã€‚ 1234567891011121314151617//Referenceå¼•ç”¨é˜Ÿåˆ—private final ReferenceQueue&lt;K&gt; refQueue = new ReferenceQueue&lt;&gt;();//ç¼“å­˜çš„åº•å±‚å®ç°, keyä¸ºä¸€çº§ç¼“å­˜, valueä¸ºäºŒçº§ç¼“å­˜ã€‚ ä¸ºäº†æ”¯æŒnull, mapçš„keyç±»å‹è®¾ç½®ä¸ºObjectprivate final ConcurrentMap&lt;Object, ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt;&gt; map = new ConcurrentHashMap&lt;&gt;();//reverseMapè®°å½•äº†æ‰€æœ‰ä»£ç†ç±»ç”Ÿæˆå™¨æ˜¯å¦å¯ç”¨, è¿™æ˜¯ä¸ºäº†å®ç°ç¼“å­˜çš„è¿‡æœŸæœºåˆ¶private final ConcurrentMap&lt;Supplier&lt;V&gt;, Boolean&gt; reverseMap = new ConcurrentHashMap&lt;&gt;();//ç”ŸæˆäºŒçº§ç¼“å­˜keyçš„å·¥å‚, è¿™é‡Œä¼ å…¥çš„æ˜¯KeyFactoryprivate final BiFunction&lt;K, P, ?&gt; subKeyFactory;//ç”ŸæˆäºŒçº§ç¼“å­˜valueçš„å·¥å‚, è¿™é‡Œä¼ å…¥çš„æ˜¯ProxyClassFactoryprivate final BiFunction&lt;K, P, V&gt; valueFactory;//æ„é€ å™¨, ä¼ å…¥ç”ŸæˆäºŒçº§ç¼“å­˜keyçš„å·¥å‚å’Œç”ŸæˆäºŒçº§ç¼“å­˜valueçš„å·¥å‚public WeakCache(BiFunction&lt;K, P, ?&gt; subKeyFactory, BiFunction&lt;K, P, V&gt; valueFactory) { this.subKeyFactory = Objects.requireNonNull(subKeyFactory); this.valueFactory = Objects.requireNonNull(valueFactory);} é¦–å…ˆçœ‹ä¸€ä¸‹WeakCacheçš„æˆå‘˜å˜é‡å’Œæ„é€ å™¨ï¼ŒWeakCacheç¼“å­˜çš„å†…éƒ¨å®ç°æ˜¯é€šè¿‡ConcurrentMapæ¥å®Œæˆçš„ï¼Œæˆå‘˜å˜é‡mapå°±æ˜¯äºŒçº§ç¼“å­˜çš„åº•å±‚å®ç°ï¼ŒreverseMapæ˜¯ä¸ºäº†å®ç°ç¼“å­˜çš„è¿‡æœŸæœºåˆ¶ï¼ŒsubKeyFactoryæ˜¯äºŒçº§ç¼“å­˜keyçš„ç”Ÿæˆå·¥å‚ï¼Œé€šè¿‡æ„é€ å™¨ä¼ å…¥ï¼Œè¿™é‡Œä¼ å…¥çš„å€¼æ˜¯Proxyç±»çš„KeyFactoryï¼ŒvalueFactoryæ˜¯äºŒçº§ç¼“å­˜valueçš„ç”Ÿæˆå·¥å‚ï¼Œé€šè¿‡æ„é€ å™¨ä¼ å…¥ï¼Œè¿™é‡Œä¼ å…¥çš„æ˜¯Proxyç±»çš„ProxyClassFactoryã€‚æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹WeakCacheçš„getæ–¹æ³•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859public V get(K key, P parameter) { //è¿™é‡Œè¦æ±‚å®ç°çš„æ¥å£ä¸èƒ½ä¸ºç©º Objects.requireNonNull(parameter); //æ¸…é™¤è¿‡æœŸçš„ç¼“å­˜ expungeStaleEntries(); //å°†ClassLoaderåŒ…è£…æˆCacheKey, ä½œä¸ºä¸€çº§ç¼“å­˜çš„key Object cacheKey = CacheKey.valueOf(key, refQueue); //è·å–å¾—åˆ°äºŒçº§ç¼“å­˜ ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap = map.get(cacheKey); //å¦‚æœæ ¹æ®ClassLoaderæ²¡æœ‰è·å–åˆ°å¯¹åº”çš„å€¼ if (valuesMap == null) { //ä»¥CASæ–¹å¼æ”¾å…¥, å¦‚æœä¸å­˜åœ¨åˆ™æ”¾å…¥ï¼Œå¦åˆ™è¿”å›åŸå…ˆçš„å€¼ ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; oldValuesMap = map.putIfAbsent(cacheKey, valuesMap = new ConcurrentHashMap&lt;&gt;()); //å¦‚æœoldValuesMapæœ‰å€¼, è¯´æ˜æ”¾å…¥å¤±è´¥ if (oldValuesMap != null) { valuesMap = oldValuesMap; } } //æ ¹æ®ä»£ç†ç±»å®ç°çš„æ¥å£æ•°ç»„æ¥ç”ŸæˆäºŒçº§ç¼“å­˜key, åˆ†ä¸ºkey0, key1, key2, keyx Object subKey = Objects.requireNonNull(subKeyFactory.apply(key, parameter)); //è¿™é‡Œé€šè¿‡subKeyè·å–åˆ°äºŒçº§ç¼“å­˜çš„å€¼ Supplier&lt;V&gt; supplier = valuesMap.get(subKey); Factory factory = null; //è¿™ä¸ªå¾ªç¯æä¾›äº†è½®è¯¢æœºåˆ¶, å¦‚æœæ¡ä»¶ä¸ºå‡å°±ç»§ç»­é‡è¯•ç›´åˆ°æ¡ä»¶ä¸ºçœŸä¸ºæ­¢ while (true) { //å¦‚æœé€šè¿‡subKeyå–å‡ºæ¥çš„å€¼ä¸ä¸ºç©º if (supplier != null) { //åœ¨è¿™é‡Œsupplierå¯èƒ½æ˜¯ä¸€ä¸ªFactoryä¹Ÿå¯èƒ½ä¼šæ˜¯ä¸€ä¸ªCacheValue //åœ¨è¿™é‡Œä¸ä½œåˆ¤æ–­, è€Œæ˜¯åœ¨Supplierå®ç°ç±»çš„getæ–¹æ³•é‡Œé¢è¿›è¡ŒéªŒè¯ V value = supplier.get(); if (value != null) { return value; } } if (factory == null) { //æ–°å»ºä¸€ä¸ªFactoryå®ä¾‹ä½œä¸ºsubKeyå¯¹åº”çš„å€¼ factory = new Factory(key, parameter, subKey, valuesMap); } if (supplier == null) { //åˆ°è¿™é‡Œè¡¨æ˜subKeyæ²¡æœ‰å¯¹åº”çš„å€¼, å°±å°†factoryä½œä¸ºsubKeyçš„å€¼æ”¾å…¥ supplier = valuesMap.putIfAbsent(subKey, factory); if (supplier == null) { //åˆ°è¿™é‡Œè¡¨æ˜æˆåŠŸå°†factoryæ”¾å…¥ç¼“å­˜ supplier = factory; } //å¦åˆ™, å¯èƒ½æœŸé—´æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†å€¼, é‚£ä¹ˆå°±ä¸å†ç»§ç»­ç»™subKeyèµ‹å€¼, è€Œæ˜¯å–å‡ºæ¥ç›´æ¥ç”¨ } else { //æœŸé—´å¯èƒ½å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†å€¼, é‚£ä¹ˆå°±å°†åŸå…ˆçš„å€¼æ›¿æ¢ if (valuesMap.replace(subKey, supplier, factory)) { //æˆåŠŸå°†factoryæ›¿æ¢æˆæ–°çš„å€¼ supplier = factory; } else { //æ›¿æ¢å¤±è´¥, ç»§ç»­ä½¿ç”¨åŸå…ˆçš„å€¼ supplier = valuesMap.get(subKey); } } }} WeakCacheçš„getæ–¹æ³•å¹¶æ²¡æœ‰ç”¨é”è¿›è¡ŒåŒæ­¥ï¼Œé‚£å®ƒæ˜¯æ€æ ·å®ç°çº¿ç¨‹å®‰å…¨çš„å‘¢ï¼Ÿ å› ä¸ºå®ƒçš„æ‰€æœ‰ä¼šè¿›è¡Œä¿®æ”¹çš„æˆå‘˜å˜é‡éƒ½ä½¿ç”¨äº†ConcurrentMapï¼Œè¿™ä¸ªç±»æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å› æ­¤å®ƒå°†è‡ªèº«çš„çº¿ç¨‹å®‰å…¨å§”æ‰˜ç»™äº†ConcurrentMapï¼Œ getæ–¹æ³•å°½å¯èƒ½çš„å°†åŒæ­¥ä»£ç å—ç¼©å°ï¼Œè¿™æ ·å¯ä»¥æœ‰æ•ˆæé«˜WeakCacheçš„æ€§èƒ½ã€‚ ClassLoaderä½œä¸ºäº†ä¸€çº§ç¼“å­˜çš„keyï¼Œè¿™æ ·å¯ä»¥é¦–å…ˆæ ¹æ®ClassLoaderç­›é€‰ä¸€éï¼Œå› ä¸ºä¸åŒClassLoaderåŠ è½½çš„ç±»æ˜¯ä¸åŒçš„ã€‚ ç„¶åå®ƒç”¨æ¥å£æ•°ç»„æ¥ç”ŸæˆäºŒçº§ç¼“å­˜çš„keyï¼Œè¿™é‡Œå®ƒè¿›è¡Œäº†ä¸€äº›ä¼˜åŒ–ï¼Œå› ä¸ºå¤§éƒ¨åˆ†ç±»éƒ½æ˜¯å®ç°äº†ä¸€ä¸ªæˆ–ä¸¤ä¸ªæ¥å£ï¼Œæ‰€ä»¥äºŒçº§ç¼“å­˜keyåˆ†ä¸ºkey0ï¼Œkey1ï¼Œkey2ï¼ŒkeyXã€‚key0åˆ°key2åˆ†åˆ«è¡¨ç¤ºå®ç°äº†0åˆ°2ä¸ªæ¥å£ï¼ŒkeyXè¡¨ç¤ºå®ç°äº†3ä¸ªæˆ–ä»¥ä¸Šçš„æ¥å£ï¼Œäº‹å®ä¸Šå¤§éƒ¨åˆ†éƒ½åªä¼šç”¨åˆ°key1å’Œkey2ã€‚è¿™äº›keyçš„ç”Ÿæˆå·¥å‚æ˜¯åœ¨Proxyç±»ä¸­ï¼Œé€šè¿‡WeakCacheçš„æ„é€ å™¨å°†keyå·¥å‚ä¼ å…¥ã€‚è¿™é‡Œçš„äºŒçº§ç¼“å­˜çš„å€¼æ˜¯ä¸€ä¸ªFactoryå®ä¾‹ï¼Œæœ€ç»ˆä»£ç†ç±»çš„å€¼æ˜¯é€šè¿‡Factoryè¿™ä¸ªå·¥å‚æ¥è·å¾—çš„ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152private final class Factory implements Supplier&lt;V&gt; { //ä¸€çº§ç¼“å­˜key, æ ¹æ®ClassLoaderç”Ÿæˆ private final K key; //ä»£ç†ç±»å®ç°çš„æ¥å£æ•°ç»„ private final P parameter; //äºŒçº§ç¼“å­˜key, æ ¹æ®æ¥å£æ•°ç»„ç”Ÿæˆ private final Object subKey; //äºŒçº§ç¼“å­˜ private final ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap; Factory(K key, P parameter, Object subKey, ConcurrentMap&lt;Object, Supplier&lt;V&gt;&gt; valuesMap) { this.key = key; this.parameter = parameter; this.subKey = subKey; this.valuesMap = valuesMap; } @Override public synchronized V get() { //è¿™é‡Œå†ä¸€æ¬¡å»äºŒçº§ç¼“å­˜é‡Œé¢è·å–Supplier, ç”¨æ¥éªŒè¯æ˜¯å¦æ˜¯Factoryæœ¬èº« Supplier&lt;V&gt; supplier = valuesMap.get(subKey); if (supplier != this) { //åœ¨è¿™é‡ŒéªŒè¯supplieræ˜¯å¦æ˜¯Factoryå®ä¾‹æœ¬èº«, å¦‚æœä¸åˆ™è¿”å›nullè®©è°ƒç”¨è€…ç»§ç»­è½®è¯¢é‡è¯• //æœŸé—´supplierå¯èƒ½æ›¿æ¢æˆäº†CacheValue, æˆ–è€…ç”±äºç”Ÿæˆä»£ç†ç±»å¤±è´¥è¢«ä»äºŒçº§ç¼“å­˜ä¸­ç§»é™¤äº† return null; } V value = null; try { //å§”æ‰˜valueFactoryå»ç”Ÿæˆä»£ç†ç±», è¿™é‡Œä¼šé€šè¿‡ä¼ å…¥çš„ProxyClassFactoryå»ç”Ÿæˆä»£ç†ç±» value = Objects.requireNonNull(valueFactory.apply(key, parameter)); } finally { //å¦‚æœç”Ÿæˆä»£ç†ç±»å¤±è´¥, å°±å°†è¿™ä¸ªäºŒçº§ç¼“å­˜åˆ é™¤ if (value == null) { valuesMap.remove(subKey, this); } } //åªæœ‰valueçš„å€¼ä¸ä¸ºç©ºæ‰èƒ½åˆ°è¾¾è¿™é‡Œ assert value != null; //ä½¿ç”¨å¼±å¼•ç”¨åŒ…è£…ç”Ÿæˆçš„ä»£ç†ç±» CacheValue&lt;V&gt; cacheValue = new CacheValue&lt;&gt;(value); //å°†åŒ…è£…åçš„cacheValueæ”¾å…¥äºŒçº§ç¼“å­˜ä¸­, è¿™ä¸ªæ“ä½œå¿…é¡»æˆåŠŸ, å¦åˆ™å°±æŠ¥é”™ if (valuesMap.replace(subKey, this, cacheValue)) { //å°†cacheValueæˆåŠŸæ”¾å…¥äºŒçº§ç¼“å­˜å, å†å¯¹å®ƒè¿›è¡Œæ ‡è®° reverseMap.put(cacheValue, Boolean.TRUE); } else { throw new AssertionError("Should not reach here"); } //æœ€åè¿”å›æ²¡æœ‰è¢«å¼±å¼•ç”¨åŒ…è£…çš„ä»£ç†ç±» return value; }} å†çœ‹çœ‹Factoryè¿™ä¸ªå†…éƒ¨å·¥å‚ç±»ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„getæ–¹æ³•æ˜¯ä½¿ç”¨synchronizedå…³é”®å­—è¿›è¡Œäº†åŒæ­¥ã€‚è¿›è¡Œgetæ–¹æ³•åé¦–å…ˆä¼šå»éªŒè¯subKeyå¯¹åº”çš„suppileræ˜¯å¦æ˜¯å·¥å‚æœ¬èº«ï¼Œå¦‚æœä¸æ˜¯å°±è¿”å›nullï¼Œè€ŒWeakCacheçš„getæ–¹æ³•ä¼šç»§ç»­è¿›è¡Œé‡è¯•ã€‚å¦‚æœç¡®å®æ˜¯å·¥å‚æœ¬èº«ï¼Œé‚£ä¹ˆå°±ä¼šå§”æ‰˜ProxyClassFactoryç”Ÿæˆä»£ç†ç±»ï¼ŒProxyClassFactoryæ˜¯åœ¨æ„é€ WeakCacheçš„æ—¶å€™ä¼ å…¥çš„ã€‚æ‰€ä»¥è¿™é‡Œè§£é‡Šäº†ä¸ºä»€ä¹ˆæœ€åä¼šè°ƒç”¨åˆ°Proxyçš„ProxyClassFactoryè¿™ä¸ªå†…éƒ¨å·¥å‚æ¥ç”Ÿæˆä»£ç†ç±»ã€‚ç”Ÿæˆä»£ç†ç±»åä½¿ç”¨å¼±å¼•ç”¨è¿›è¡ŒåŒ…è£…å¹¶æ”¾å…¥reverseMapä¸­ï¼Œæœ€åä¼šè¿”å›åŸè£…çš„ä»£ç†ç±»ã€‚ ProxyGeneratorç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ é€šè¿‡å‰é¢çš„åˆ†æï¼ŒçŸ¥é“äº†ä»£ç†ç±»æ˜¯é€šè¿‡Proxyç±»çš„ProxyClassFactoryå·¥å‚ç”Ÿæˆçš„ï¼Œè¿™ä¸ªå·¥å‚ç±»ä¼šå»è°ƒç”¨ProxyGeneratorç±»çš„generateProxyClass()æ–¹æ³•æ¥ç”Ÿæˆä»£ç†ç±»çš„å­—èŠ‚ç ã€‚ProxyGeneratorè¿™ä¸ªç±»å­˜æ”¾åœ¨sun.miscåŒ…ä¸‹ï¼Œè¯¥ç±»çš„generateProxyClass()é™æ€æ–¹æ³•çš„æ ¸å¿ƒå†…å®¹å°±æ˜¯å»è°ƒç”¨generateClassFile()å®ä¾‹æ–¹æ³•æ¥ç”ŸæˆClassæ–‡ä»¶ã€‚æ¥ä¸‹æ¥çœ‹çœ‹generateClassFile()è¿™ä¸ªæ–¹æ³•å†…éƒ¨åšäº†äº›ä»€ä¹ˆã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128private byte[] generateClassFile() { //ç¬¬ä¸€æ­¥, å°†æ‰€æœ‰çš„æ–¹æ³•ç»„è£…æˆProxyMethodå¯¹è±¡ //é¦–å…ˆä¸ºä»£ç†ç±»ç”ŸæˆtoString, hashCode, equalsç­‰ä»£ç†æ–¹æ³• this.addProxyMethod(hashCodeMethod, Object.class); this.addProxyMethod(equalsMethod, Object.class); this.addProxyMethod(toStringMethod, Object.class); //è·å–æ¥å£ç±» Class[] var1 = this.interfaces; int var2 = var1.length; int var3; Class var4; //éå†æ¯ä¸€ä¸ªæ¥å£çš„æ¯ä¸€ä¸ªæ–¹æ³•, å¹¶ä¸”ä¸ºå…¶ç”ŸæˆProxyMethodå¯¹è±¡ for(var3 = 0; var3 &lt; var2; ++var3) { var4 = var1[var3]; Method[] var5 = var4.getMethods(); int var6 = var5.length; for(int var7 = 0; var7 &lt; var6; ++var7) { Method var8 = var5[var7]; this.addProxyMethod(var8, var4); } } //å¯¹äºå…·æœ‰ç›¸åŒç­¾åçš„ä»£ç†æ–¹æ³•, æ£€éªŒæ–¹æ³•çš„è¿”å›å€¼æ˜¯å¦å…¼å®¹ Iterator var11 = this.proxyMethods.values().iterator(); List var12; while(var11.hasNext()) { var12 = (List)var11.next(); checkReturnTypes(var12); } //ç¬¬äºŒæ­¥, ç»„è£…è¦ç”Ÿæˆçš„classæ–‡ä»¶çš„æ‰€æœ‰çš„å­—æ®µä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ Iterator var15; try { //æ·»åŠ æ„é€ å™¨æ–¹æ³• this.methods.add(this.generateConstructor()); var11 = this.proxyMethods.values().iterator(); //éå†ç¼“å­˜ä¸­çš„ä»£ç†æ–¹æ³• while(var11.hasNext()) { var12 = (List)var11.next(); var15 = var12.iterator(); while(var15.hasNext()) { ProxyGenerator.ProxyMethod var16 = (ProxyGenerator.ProxyMethod)var15.next(); //æ·»åŠ ä»£ç†ç±»çš„é™æ€å­—æ®µ, ä¾‹å¦‚:private static Method m1; this.fields.add(new ProxyGenerator.FieldInfo(var16.methodFieldName, "Ljava/lang/reflect/Method;", 10)); //æ·»åŠ ä»£ç†ç±»çš„ä»£ç†æ–¹æ³• this.methods.add(var16.generateMethod()); } } //æ·»åŠ ä»£ç†ç±»çš„é™æ€å­—æ®µåˆå§‹åŒ–æ–¹æ³• this.methods.add(this.generateStaticInitializer()); } catch (IOException var10) { throw new InternalError("unexpected I/O Exception", var10); } //éªŒè¯æ–¹æ³•å’Œå­—æ®µé›†åˆä¸èƒ½å¤§äº65535 if (this.methods.size() &gt; 65535) { throw new IllegalArgumentException("method limit exceeded"); } else if (this.fields.size() &gt; 65535) { throw new IllegalArgumentException("field limit exceeded"); } else { //ç¬¬ä¸‰æ­¥, å†™å…¥æœ€ç»ˆçš„classæ–‡ä»¶ //éªŒè¯å¸¸é‡æ± ä¸­å­˜åœ¨ä»£ç†ç±»çš„å…¨é™å®šå this.cp.getClass(dotToSlash(this.className)); //éªŒè¯å¸¸é‡æ± ä¸­å­˜åœ¨ä»£ç†ç±»çˆ¶ç±»çš„å…¨é™å®šå, çˆ¶ç±»åä¸º:"java/lang/reflect/Proxy" this.cp.getClass("java/lang/reflect/Proxy"); var1 = this.interfaces; var2 = var1.length; //éªŒè¯å¸¸é‡æ± å­˜åœ¨ä»£ç†ç±»æ¥å£çš„å…¨é™å®šå for(var3 = 0; var3 &lt; var2; ++var3) { var4 = var1[var3]; this.cp.getClass(dotToSlash(var4.getName())); } //æ¥ä¸‹æ¥è¦å¼€å§‹å†™å…¥æ–‡ä»¶äº†,è®¾ç½®å¸¸é‡æ± åªè¯» this.cp.setReadOnly(); ByteArrayOutputStream var13 = new ByteArrayOutputStream(); DataOutputStream var14 = new DataOutputStream(var13); try { //1.å†™å…¥é­”æ•° var14.writeInt(-889275714); //2.å†™å…¥æ¬¡ç‰ˆæœ¬å· var14.writeShort(0); //3.å†™å…¥ä¸»ç‰ˆæœ¬å· var14.writeShort(49); //4.å†™å…¥å¸¸é‡æ±  this.cp.write(var14); //5.å†™å…¥è®¿é—®ä¿®é¥°ç¬¦ var14.writeShort(this.accessFlags); //6.å†™å…¥ç±»ç´¢å¼• var14.writeShort(this.cp.getClass(dotToSlash(this.className))); //7.å†™å…¥çˆ¶ç±»ç´¢å¼•, ç”Ÿæˆçš„ä»£ç†ç±»éƒ½ç»§æ‰¿è‡ªProxy var14.writeShort(this.cp.getClass("java/lang/reflect/Proxy")); //8.å†™å…¥æ¥å£è®¡æ•°å€¼ var14.writeShort(this.interfaces.length); Class[] var17 = this.interfaces; int var18 = var17.length; //9.å†™å…¥æ¥å£é›†åˆ for(int var19 = 0; var19 &lt; var18; ++var19) { Class var22 = var17[var19]; var14.writeShort(this.cp.getClass(dotToSlash(var22.getName()))); } //10.å†™å…¥å­—æ®µè®¡æ•°å€¼ var14.writeShort(this.fields.size()); var15 = this.fields.iterator(); //11.å†™å…¥å­—æ®µé›†åˆ while(var15.hasNext()) { ProxyGenerator.FieldInfo var20 = (ProxyGenerator.FieldInfo)var15.next(); var20.write(var14); } //12.å†™å…¥æ–¹æ³•è®¡æ•°å€¼ var14.writeShort(this.methods.size()); var15 = this.methods.iterator(); //13.å†™å…¥æ–¹æ³•é›†åˆ while(var15.hasNext()) { ProxyGenerator.MethodInfo var21 = (ProxyGenerator.MethodInfo)var15.next(); var21.write(var14); } //14.å†™å…¥å±æ€§è®¡æ•°å€¼, ä»£ç†ç±»classæ–‡ä»¶æ²¡æœ‰å±æ€§æ‰€ä»¥ä¸º0 var14.writeShort(0); //è½¬æ¢æˆäºŒè¿›åˆ¶æ•°ç»„è¾“å‡º return var13.toByteArray(); } catch (IOException var9) { throw new InternalError("unexpected I/O Exception", var9); } }} å¯ä»¥çœ‹åˆ°generateClassFile()æ–¹æ³•æ˜¯æŒ‰ç…§Classæ–‡ä»¶ç»“æ„è¿›è¡ŒåŠ¨æ€æ‹¼æ¥çš„ã€‚é‚£ä»€ä¹ˆæ˜¯Classæ–‡ä»¶å‘¢ï¼Ÿ æˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„Javaæ–‡ä»¶æ˜¯ä»¥.javaç»“å°¾çš„ï¼Œåœ¨ç¼–å†™å¥½äº†ä¹‹åé€šè¿‡ç¼–è¯‘å™¨è¿›è¡Œç¼–è¯‘ä¼šç”Ÿæˆ.classæ–‡ä»¶ï¼Œè¿™ä¸ª.classæ–‡ä»¶å°±æ˜¯Classæ–‡ä»¶ã€‚Javaç¨‹åºçš„æ‰§è¡Œåªä¾èµ–äºClassæ–‡ä»¶ï¼Œå’ŒJavaæ–‡ä»¶æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚è¿™ä¸ªClassæ–‡ä»¶æè¿°äº†ä¸€ä¸ªç±»çš„ä¿¡æ¯ï¼Œå½“æˆ‘ä»¬éœ€è¦ä½¿ç”¨åˆ°ä¸€ä¸ªç±»æ—¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæå‰å»åŠ è½½è¿™ä¸ªç±»çš„Classæ–‡ä»¶å¹¶è¿›è¡Œåˆå§‹åŒ–å’Œç›¸å…³çš„æ£€éªŒå·¥ä½œï¼ŒJavaè™šæ‹Ÿæœºèƒ½å¤Ÿä¿è¯åœ¨ä½ ä½¿ç”¨åˆ°è¿™ä¸ªç±»ä¹‹å‰å°±ä¼šå®Œæˆè¿™äº›å·¥ä½œï¼Œæˆ‘ä»¬åªéœ€è¦å®‰å¿ƒçš„å»ä½¿ç”¨å®ƒå°±å¥½äº†ï¼Œè€Œä¸å¿…å…³å¿ƒJavaè™šæ‹Ÿæœºæ˜¯æ€æ ·åŠ è½½å®ƒçš„ã€‚å½“ç„¶ï¼ŒClassæ–‡ä»¶å¹¶ä¸ä¸€å®šéå¾—é€šè¿‡ç¼–è¯‘Javaæ–‡ä»¶è€Œæ¥ï¼Œä½ ç”šè‡³å¯ä»¥ç›´æ¥é€šè¿‡æ–‡æœ¬ç¼–è¾‘å™¨æ¥ç¼–å†™Classæ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼ŒJDKåŠ¨æ€ä»£ç†å°±æ˜¯é€šè¿‡ç¨‹åºæ¥åŠ¨æ€ç”ŸæˆClassæ–‡ä»¶çš„ã€‚ ç”ŸæˆClassæ–‡ä»¶ä¸»è¦åˆ†ä¸ºä¸‰æ­¥ï¼š ç¬¬ä¸€æ­¥ï¼šæ”¶é›†æ‰€æœ‰è¦ç”Ÿæˆçš„ä»£ç†æ–¹æ³•ï¼Œå°†å…¶åŒ…è£…æˆProxyMethodå¯¹è±¡å¹¶æ³¨å†Œåˆ°Mapé›†åˆä¸­ã€‚ ç¬¬äºŒæ­¥ï¼šæ”¶é›†æ‰€æœ‰è¦ä¸ºClassæ–‡ä»¶ç”Ÿæˆçš„å­—æ®µä¿¡æ¯å’Œæ–¹æ³•ä¿¡æ¯ã€‚ ç¬¬ä¸‰æ­¥ï¼šå®Œæˆäº†ä¸Šé¢çš„å·¥ä½œåï¼Œå¼€å§‹ç»„è£…Classæ–‡ä»¶ã€‚ ä¸€ä¸ªç±»çš„æ ¸å¿ƒéƒ¨åˆ†å°±æ˜¯å®ƒçš„å­—æ®µå’Œæ–¹æ³•ã€‚é‡ç‚¹èšç„¦ç¬¬äºŒæ­¥ï¼Œçœ‹çœ‹å®ƒä¸ºä»£ç†ç±»ç”Ÿæˆäº†å“ªäº›å­—æ®µå’Œæ–¹æ³•ã€‚åœ¨ç¬¬äºŒæ­¥ä¸­ï¼ŒæŒ‰é¡ºåºåšäº†ä¸‹é¢å››ä»¶äº‹ã€‚ ä¸ºä»£ç†ç±»ç”Ÿæˆä¸€ä¸ªå¸¦å‚æ„é€ å™¨ï¼Œä¼ å…¥InvocationHandlerå®ä¾‹çš„å¼•ç”¨å¹¶è°ƒç”¨çˆ¶ç±»çš„å¸¦å‚æ„é€ å™¨ã€‚ éå†ä»£ç†æ–¹æ³•Mapé›†åˆï¼Œä¸ºæ¯ä¸ªä»£ç†æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„Methodç±»å‹é™æ€åŸŸï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°fieldsé›†åˆä¸­ã€‚ éå†ä»£ç†æ–¹æ³•Mapé›†åˆï¼Œä¸ºæ¯ä¸ªä»£ç†æ–¹æ³•ç”Ÿæˆå¯¹åº”çš„MethodInfoå¯¹è±¡ï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°methodsé›†åˆä¸­ã€‚ ä¸ºä»£ç†ç±»ç”Ÿæˆé™æ€åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥é™æ€åˆå§‹åŒ–æ–¹æ³•ä¸»è¦æ˜¯å°†æ¯ä¸ªä»£ç†æ–¹æ³•çš„å¼•ç”¨èµ‹å€¼ç»™å¯¹åº”çš„é™æ€å­—æ®µã€‚ é€šè¿‡ä»¥ä¸Šåˆ†æï¼Œå¯ä»¥å¤§è‡´çŸ¥é“JDKåŠ¨æ€ä»£ç†æœ€ç»ˆä¼šç”Ÿæˆå¦‚ä¸‹ç»“æ„çš„ä»£ç†ç±»ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768public class Proxy0 extends Proxy implements UserDao { //ç¬¬ä¸€æ­¥, ç”Ÿæˆæ„é€ å™¨ protected Proxy0(InvocationHandler h) { super(h); } //ç¬¬äºŒæ­¥, ç”Ÿæˆé™æ€åŸŸ private static Method m1; //hashCodeæ–¹æ³• private static Method m2; //equalsæ–¹æ³• private static Method m3; //toStringæ–¹æ³• private static Method m4; //... //ç¬¬ä¸‰æ­¥, ç”Ÿæˆä»£ç†æ–¹æ³• @Override public int hashCode() { try { return (int) h.invoke(this, m1, null); } catch (Throwable e) { throw new UndeclaredThrowableException(e); } } @Override public boolean equals(Object obj) { try { Object[] args = new Object[] {obj}; return (boolean) h.invoke(this, m2, args); } catch (Throwable e) { throw new UndeclaredThrowableException(e); } } @Override public String toString() { try { return (String) h.invoke(this, m3, null); } catch (Throwable e) { throw new UndeclaredThrowableException(e); } } @Override public void save(User user) { try { //æ„é€ å‚æ•°æ•°ç»„, å¦‚æœæœ‰å¤šä¸ªå‚æ•°å¾€åé¢æ·»åŠ å°±è¡Œäº† Object[] args = new Object[] {user}; h.invoke(this, m4, args); } catch (Throwable e) { throw new UndeclaredThrowableException(e); } } //ç¬¬å››æ­¥, ç”Ÿæˆé™æ€åˆå§‹åŒ–æ–¹æ³• static { try { Class c1 = Class.forName(Object.class.getName()); Class c2 = Class.forName(UserDao.class.getName()); m1 = c1.getMethod("hashCode", null); m2 = c1.getMethod("equals", new Class[]{Object.class}); m3 = c1.getMethod("toString", null); m4 = c2.getMethod("save", new Class[]{User.class}); //... } catch (Exception e) { e.printStackTrace(); } }} ç»è¿‡å±‚å±‚åˆ†æï¼Œæ·±å…¥æ¢ç©¶JDKæºç ï¼Œè¿˜åŸåŠ¨æ€ç”Ÿæˆçš„ä»£ç†ç±»çš„æœ¬æ¥é¢ç›®ï¼Œæ˜ç™½äº†ä»¥ä¸‹å‡ ç‚¹ï¼š ä»£ç†ç±»é»˜è®¤ç»§æ‰¿Porxyç±»ï¼Œå› ä¸ºJavaä¸­åªæ”¯æŒå•ç»§æ‰¿ï¼Œæ‰€ä»¥JDKåŠ¨æ€ä»£ç†åªèƒ½å»å®ç°æ¥å£ã€‚ ä»£ç†æ–¹æ³•éƒ½ä¼šå»è°ƒç”¨InvocationHandlerçš„invoke()æ–¹æ³•ï¼Œå› æ­¤éœ€è¦é‡å†™InvocationHandlerçš„invoke()æ–¹æ³•ã€‚ è°ƒç”¨invoke()æ–¹æ³•æ—¶ä¼šä¼ å…¥ä»£ç†å®ä¾‹æœ¬èº«ï¼Œç›®æ ‡æ–¹æ³•å’Œç›®æ ‡æ–¹æ³•å‚æ•°ã€‚è§£é‡Šäº†invoke()æ–¹æ³•çš„å‚æ•°æ˜¯æ€æ ·æ¥çš„ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaä¸­try...catch...finallyè¯­å¥ä¸­å«æœ‰returnè¯­å¥çš„æ‰§è¡Œæƒ…å†µ]]></title>
    <url>%2Fposts%2F65251ffc.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹å‡ ä¸ªç¤ºä¾‹ã€‚ &lt;p id="div-border-left-red"&gt; ç¤ºä¾‹ä¸€ï¼ˆtryä¸­æœ‰returnï¼Œfinallyä¸­æ²¡æœ‰returnï¼‰ï¼š&lt;/p&gt; 12345678910111213141516171819202122232425262728package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: tryä¸­æœ‰returnï¼Œfinallyä¸­æ²¡æœ‰return */public class DemoOne { public static void main(String[] args) { System.out.println(test()); } private static int test() { int num = 10; try { System.out.println("try..."); return num += 100; } catch (Exception e) { System.out.println("catch..."); } finally { if (num &gt; 50) { System.out.println("num &gt; 50 : " + num); } System.out.println("finally..."); } return num; }} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; 1234try...num &gt; 50 : 110finally...110 &lt;span id="inline-green"&gt; åˆ†æï¼š &lt;/span&gt; æ˜¾ç„¶â€œreturn num += 100â€è¢«æ‹†åˆ†æˆäº†â€œnum = num+100â€å’Œâ€œreturn numâ€ä¸¤ä¸ªè¯­å¥ï¼Œçº¿æ‰§è¡Œtryä¸­çš„â€œnum = num+100â€è¯­å¥ï¼Œå°†å…¶ä¿å­˜èµ·æ¥ï¼Œåœ¨tryä¸­çš„â€return numâ€œæ‰§è¡Œå‰ï¼Œå…ˆå°†finallyä¸­çš„è¯­å¥æ‰§è¡Œå®Œï¼Œè€Œåå†å°†110è¿”å›ã€‚ &lt;p id="div-border-left-red"&gt; ç¤ºä¾‹äºŒï¼ˆtryå’Œfinallyä¸­å‡æœ‰returnï¼‰ï¼š&lt;/p&gt; 1234567891011121314151617181920212223242526272829package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: tryå’Œfinallyä¸­å‡æœ‰return */public class DemoTwo { public static void main(String[] args) { System.out.println(testTwo()); } private static int testTwo() { int num = 10; try { System.out.println("try..."); return num += 100; } catch (Exception e) { System.out.println("catch error..."); } finally { if (num &gt; 50) { System.out.println("num &gt; 50 : " + num); } System.out.println("finally..."); num = 100; return num; } }} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; 1234try...num &gt; 50 : 110finally...100 &lt;span id="inline-green"&gt; åˆ†æï¼š &lt;/span&gt; tryä¸­çš„returnè¯­å¥åŒæ ·è¢«æ‹†åˆ†äº†ï¼Œfinallyä¸­çš„returnè¯­å¥å…ˆäºtryä¸­çš„returnè¯­å¥æ‰§è¡Œï¼Œå› è€Œtryä¸­çš„returnè¢«â€è¦†ç›–â€œæ‰äº†ï¼Œä¸å†æ‰§è¡Œã€‚ &lt;p id="div-border-left-red"&gt; ç¤ºä¾‹ä¸‰ï¼ˆfinallyä¸­æ”¹å˜è¿”å›å€¼numï¼‰ï¼š&lt;/p&gt; 1234567891011121314151617181920212223242526272829package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: finallyä¸­æ”¹å˜è¿”å›å€¼num */public class DemoThree { public static void main(String[] args) { System.out.println(testThree()); } private static int testThree() { int num = 10; try { System.out.println("try..."); return num; } catch (Exception e) { System.out.println("catch error..."); } finally { if (num &gt; 20) { System.out.println("num &gt; 20 : " + num); } System.out.println("finally"); num = 100; } return num; }} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; 123try...finally10 &lt;span id="inline-green"&gt; åˆ†æï¼š &lt;/span&gt; è™½ç„¶åœ¨finallyä¸­æ”¹å˜äº†è¿”å›å€¼numï¼Œä½†å› ä¸ºfinallyä¸­æ²¡æœ‰returnè¯¥numçš„å€¼ï¼Œå› æ­¤åœ¨æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åï¼ŒtestThree()å‡½æ•°ä¼šå¾—åˆ°tryä¸­è¿”å›çš„numçš„å€¼ï¼Œè€Œtryä¸­çš„numçš„å€¼ä¾ç„¶æ˜¯ç¨‹åºè¿›å…¥finallyä»£ç å—å‰ä¿ç•™ä¸‹æ¥çš„å€¼ï¼Œå› æ­¤å¾—åˆ°çš„è¿”å›å€¼ä¸º10ã€‚ &lt;p id="div-border-left-red"&gt; ç¤ºä¾‹å››ï¼ˆå°†numçš„å€¼åŒ…è£…åœ¨Numç±»ä¸­ï¼‰ï¼š&lt;/p&gt; 12345678910111213141516171819202122232425262728293031package main.java.com.study.tryCatchFinally;/** * @author: whb * @description: å°†numçš„å€¼åŒ…è£…åœ¨Numç±»ä¸­ */public class DemoFour { public static void main(String[] args) { System.out.println(test().num); } private static Num test() { Num number = new Num(); try { System.out.println("try"); return number; } catch (Exception e) { System.out.println("error"); } finally { if (number.num &gt; 20) { System.out.println("number.num &gt; 20 : " + number.num); } System.out.println("finally"); number.num = 100; } return number; }}class Num { public int num = 10;} &lt;span id="inline-blue"&gt; è¾“å‡ºç»“æœï¼š &lt;/span&gt; 123tryfinally100 &lt;span id="inline-green"&gt; åˆ†æï¼š &lt;/span&gt; ä»ç»“æœä¸­å¯ä»¥çœ‹å‡ºï¼ŒåŒæ ·æ˜¯åœ¨finallyä¸­æ”¹å˜äº†è¿”å›å€¼numçš„å€¼ï¼Œåœ¨ç¤ºä¾‹ä¸‰ä¸­ï¼Œå¹¶æ²¡æœ‰è¢«tryä¸­çš„returnè¿”å›ï¼ˆtestï¼ˆï¼‰æ–¹æ³•å¾—åˆ°çš„ä¸æ˜¯100ï¼‰ï¼Œä½†åœ¨è¿™é‡Œå´è¢«tryä¸­çš„returnè¯­å¥è¿”å›äº†ã€‚ å¯¹äºå«æœ‰returnè¯­å¥çš„æƒ…å†µï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°æ€»ç»“å¦‚ä¸‹ï¼š &lt;font color="blue"&gt;tryè¯­å¥åœ¨è¿”å›å‰ï¼Œå°†å…¶ä»–æ‰€æœ‰çš„æ“ä½œæ‰§è¡Œå®Œï¼Œä¿ç•™å¥½è¦è¿”å›çš„å€¼ï¼Œè€Œåè½¬å…¥æ‰§è¡Œfinallyä¸­çš„è¯­å¥ï¼Œè€Œååˆ†ä¸ºä»¥ä¸‹ä¸‰ç§æƒ…å†µï¼š&lt;/font&gt; &lt;font color="blue"&gt;æƒ…å†µä¸€ï¼šå¦‚æœfinallyä¸­æœ‰returnè¯­å¥ï¼Œåˆ™ä¼šå°†tryä¸­çš„returnè¯­å¥â€è¦†ç›–â€œæ‰ï¼Œç›´æ¥æ‰§è¡Œfinallyä¸­çš„returnè¯­å¥ï¼Œå¾—åˆ°è¿”å›å€¼ï¼Œè¿™æ ·ä¾¿æ— æ³•å¾—åˆ°tryä¹‹å‰ä¿ç•™å¥½çš„è¿”å›å€¼ã€‚&lt;/font&gt; &lt;font color="blue"&gt;æƒ…å†µäºŒï¼šå¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä¹Ÿæ²¡æœ‰æ”¹å˜è¦è¿”å›å€¼ï¼Œåˆ™æ‰§è¡Œå®Œfinallyä¸­çš„è¯­å¥åï¼Œä¼šæ¥ç€æ‰§è¡Œtryä¸­çš„returnè¯­å¥ï¼Œè¿”å›ä¹‹å‰ä¿ç•™çš„å€¼ã€‚&lt;/font&gt; &lt;font color="blue"&gt;æƒ…å†µä¸‰ï¼šå¦‚æœfinallyä¸­æ²¡æœ‰returnè¯­å¥ï¼Œä½†æ˜¯æ”¹å˜äº†è¦è¿”å›çš„å€¼ï¼Œè¿™é‡Œæœ‰ç‚¹ç±»ä¼¼ä¸å¼•ç”¨ä¼ é€’å’Œå€¼ä¼ é€’çš„åŒºåˆ«ï¼Œåˆ†ä»¥ä¸‹ä¸¤ç§æƒ…å†µï¼š&lt;/font&gt; &lt;font color="blue"&gt;1ï¼‰å¦‚æœreturnçš„æ•°æ®æ˜¯åŸºæœ¬æ•°æ®ç±»å‹æˆ–æ–‡æœ¬å­—ç¬¦ä¸²ï¼Œåˆ™åœ¨finallyä¸­å¯¹è¯¥åŸºæœ¬æ•°æ®çš„æ”¹å˜ä¸èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥ä¾ç„¶ä¼šè¿”å›è¿›å…¥finallyå—ä¹‹å‰ä¿ç•™çš„å€¼ã€‚&lt;/font&gt; &lt;font color="blue"&gt;2ï¼‰å¦‚æœreturnçš„æ•°æ®æ˜¯å¼•ç”¨æ•°æ®ç±»å‹ï¼Œè€Œåœ¨finallyä¸­å¯¹è¯¥å¼•ç”¨æ•°æ®ç±»å‹çš„å±æ€§å€¼çš„æ”¹å˜èµ·ä½œç”¨ï¼Œtryä¸­çš„returnè¯­å¥è¿”å›çš„å°±æ˜¯åœ¨finallyä¸­æ”¹å˜åçš„è¯¥å±æ€§çš„å€¼ã€‚&lt;/font&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[JVMåŸç†]]></title>
    <url>%2Fposts%2F6f6b6cd5.html</url>
    <content type="text"><![CDATA[Javaå†…å­˜æ¨¡å‹ Javaç¨‹åºæ‰§è¡Œæµç¨‹ æ—¥å¸¸Javaçš„åŸºæœ¬å¼€å‘æ¨¡å¼æ˜¯ï¼Œæˆ‘ä»¬å†™çš„æ‰€æœ‰javaç¨‹åºéƒ½ä¿å­˜åœ¨*.javaçš„æ–‡ä»¶ä¸­ï¼Œå³æˆ‘ä»¬çš„æºä»£ç ï¼Œè¿™äº›æºä»£ç å¿…é¡»ç»è¿‡javac.exeå‘½ä»¤å°†å…¶ç¼–è¯‘æˆ*.classæ–‡ä»¶ï¼Œè€Œååˆ©ç”¨java.exeå‘½ä»¤åœ¨JVMè¿›ç¨‹ä¸­è§£é‡Šæ‰§è¡Œã€‚æ•´ä¸ªè¿‡ç¨‹å¦‚ä¸‹å›¾ï¼š å®é™…ä¸Šï¼Œå½“JVMå°†æ‰€éœ€è¦çš„ .class æ–‡ä»¶åŠ è½½åˆ° JVM è¿›ç¨‹ä¹‹ä¸­ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸€ä¸ªç±»åŠ è½½å™¨ï¼ˆClassLoad),ç±»åŠ è½½å™¨çš„å¥½å¤„åœ¨äºï¼šå¯ä»¥éšå®šæŒ‡å®š *.class æ–‡ä»¶æ‰€åœ¨çš„è·¯å¾„ã€‚ JVMï¼šjavaè™šæ‹Ÿæœºï¼Œæ‰€æœ‰çš„ç¨‹åºéƒ½è¦æ±‚è¿è¡Œåœ¨JVMä¸Šï¼Œæ˜¯å› ä¸ºè€ƒè™‘åˆ°äº†å¯ç§»æ¤æ€§é—®é¢˜ ï¼Œä½†å¦‚æœçœŸæ­£å»æ‰§è¡Œç¨‹åºï¼Œæ— æ³•ç¦»å¼€æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚ åœ¨ java ä¸­å¯ä»¥ä½¿ç”¨ native å®ç° æœ¬åœ° C å‡½æ•°çš„è°ƒç”¨ï¼ŒNative Interfaceï¼Œä½†æ˜¯è¿™äº›éƒ½æ˜¯å±äºç¨‹åºçš„è¾…åŠ©æ‰‹æ®µï¼Œè€ŒçœŸæ­£çš„ç¨‹åºè¿è¡Œéƒ½åœ¨â€œè¿è¡Œæ—¶æ•°æ®åŒºâ€ä¹‹ä¸­ã€‚ ç¨‹åºè®¡æ•°å™¨ ä»€ä¹ˆæ˜¯ç¨‹åºè®¡æ•°å™¨ ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå¯ä»¥æŠŠå®ƒçœ‹ä½œå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¨‹åºè®¡æ•°å™¨é‡Œé¢è®°å½•çš„æ˜¯å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„é‚£ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ã€‚ æ³¨ï¼šä½†æ˜¯ï¼Œå¦‚æœå½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„æ˜¯ä¸€ä¸ªæœ¬åœ°æ–¹æ³•ï¼Œé‚£ä¹ˆæ­¤æ—¶ç¨‹åºè®¡æ•°å™¨ä¸ºç©ºã€‚ ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ ç¨‹åºè®¡æ•°å™¨æœ‰ä¸¤ä¸ªä½œç”¨ï¼š å­—èŠ‚ç è§£é‡Šå™¨é€šè¿‡æ”¹å˜ç¨‹åºè®¡æ•°å™¨æ¥ä¾æ¬¡è¯»å–æŒ‡ä»¤ï¼Œä»è€Œå®ç°ä»£ç çš„æµç¨‹æ§åˆ¶ï¼Œå¦‚ï¼šé¡ºåºæ‰§è¡Œã€é€‰æ‹©ã€å¾ªç¯ã€å¼‚å¸¸å¤„ç†ã€‚ åœ¨å¤šçº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œç¨‹åºè®¡æ•°å™¨ç”¨äºè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ä½ç½®ï¼Œä»è€Œå½“çº¿ç¨‹è¢«åˆ‡æ¢å›æ¥çš„æ—¶å€™èƒ½å¤ŸçŸ¥é“è¯¥çº¿ç¨‹ä¸Šæ¬¡è¿è¡Œåˆ°å“ªå„¿äº†ã€‚ ç¨‹åºè®¡æ•°å™¨çš„ç‰¹ç‚¹ æ˜¯ä¸€å—è¾ƒå°çš„å­˜å‚¨ç©ºé—´ çº¿ç¨‹ç§æœ‰ã€‚æ¯æ¡çº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç¨‹åºè®¡æ•°å™¨ã€‚ æ˜¯å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç°OutOfMemoryErrorçš„å†…å­˜åŒºåŸŸã€‚ ç”Ÿå‘½å‘¨æœŸéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„ç»“æŸè€Œæ­»äº¡ã€‚ Javaè™šæ‹Ÿæœºæ ˆ(JVM Stack) ä»€ä¹ˆæ˜¯Javaè™šæ‹Ÿæœºæ ˆ Javaè™šæ‹Ÿæœºæ ˆæ˜¯æè¿°Javaæ–¹æ³•è¿è¡Œè¿‡ç¨‹çš„å†…å­˜æ¨¡å‹ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¼šä¸ºæ¯ä¸€ä¸ªå³å°†è¿è¡Œçš„Javaæ–¹æ³•åˆ›å»ºä¸€å—å«åšâ€œæ ˆå¸§â€çš„åŒºåŸŸï¼Œè¿™å—åŒºåŸŸç”¨äºå­˜å‚¨è¯¥æ–¹æ³•åœ¨è¿è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€è¦çš„ä¸€äº›ä¿¡æ¯ã€‚ åœ¨JVM ä¸­ç”¨æ ˆå¸§ï¼ˆStack Frameï¼‰æ¥å®šä¹‰æ ˆçš„æ•°æ®ï¼Œæ¯ä¸€ä¸ªæ ˆå¸§è¡¨ç¤ºæ¯ä¸ªå¯èƒ½æ‰§è¡Œçš„æ–¹æ³•ã€‚ è€Œæ ˆå¸§ä¸­åˆ™åŒ…å«äº†ï¼šå±€éƒ¨å˜é‡è¡¨ï¼Œæ“ä½œæ•°æ ˆï¼ŒæŒ‡å‘è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ï¼Œæ–¹æ³•è¿”å›åœ°å€å’ŒåŠ¨æ€é“¾æ¥ã€‚ å±€éƒ¨å˜é‡è¡¨ï¼ˆLocal Variablesï¼‰:æ–¹æ³•çš„å±€éƒ¨å˜é‡æˆ–å½¢å‚ï¼Œå…¶ä»¥å˜é‡æ§½ï¼ˆsoltï¼‰ä¸ºæœ€å°å•ä½ï¼Œåªå…è®¸ä¿å­˜32ä¸ºé•¿åº¦çš„å˜é‡ï¼Œå¦‚æœè¶…è¿‡32ä½åˆ™ä¼šå¼€è¾Ÿä¸¤ä¸ªè¿ç»­çš„solt(64ä½é•¿åº¦ï¼Œlongå’Œdouble)ï¼› æ“ä½œæ•°æ ˆï¼ˆOperand Stackï¼‰ï¼šè¡¨è¾¾å¼è®¡ç®—åœ¨æ ˆä¸­å®Œæˆï¼› æŒ‡å‘å½“å‰æ–¹æ³•æ‰€å±çš„ç±»çš„è¿è¡Œæ—¶å¸¸é‡æ± çš„å¼•ç”¨ï¼ˆReference to runtime constant poolï¼‰ï¼šå¼•ç”¨å…¶ä»–ç±»çš„å¸¸é‡æˆ–è€…ä½¿ç”¨String æ± ä¸­çš„å­—ç¬¦ä¸²ï¼› æ–¹æ³•è¿”å›åœ°å€ï¼ˆReturn Addressï¼‰ï¼šæ–¹æ³•æ‰§è¡Œå®Œåéœ€è¦è¿”å›è°ƒç”¨æ­¤æ–¹æ³•çš„ä½ç½®ï¼Œæ‰€ä»¥éœ€è¦å†æ ˆå¸§ä¸­ä¿å­˜æ–¹æ³•è¿”å›åœ°å€ï¼› Javaè™šæ‹Ÿæœºæ ˆçš„ç‰¹ç‚¹ å±€éƒ¨å˜é‡è¡¨çš„åˆ›å»ºæ˜¯åœ¨æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œéšç€æ ˆå¸§çš„åˆ›å»ºè€Œåˆ›å»ºã€‚è€Œä¸”ï¼Œå±€éƒ¨å˜é‡è¡¨çš„å¤§å°åœ¨ç¼–è¯‘æ—¶æœŸå°±ç¡®å®šä¸‹æ¥äº†ï¼Œåœ¨åˆ›å»ºçš„æ—¶å€™åªéœ€åˆ†é…äº‹å…ˆè§„å®šå¥½çš„å¤§å°å³å¯ã€‚æ­¤å¤–ï¼Œåœ¨æ–¹æ³•è¿è¡Œçš„è¿‡ç¨‹ä¸­å±€éƒ¨å˜é‡è¡¨çš„å¤§å°æ˜¯ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¼šå‡ºç°ä¸¤ç§å¼‚å¸¸ï¼šStackOverFlowErrorå’ŒOutOfMemoryErrorã€‚ a) StackOverFlowErrorï¼š è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°ä¸å…è®¸åŠ¨æ€æ‰©å±•ï¼Œé‚£ä¹ˆå½“çº¿ç¨‹è¯·æ±‚æ ˆçš„æ·±åº¦è¶…è¿‡å½“å‰Javaè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦çš„æ—¶å€™ï¼Œå°±æŠ›å‡ºStackOverFlowErrorå¼‚å¸¸ã€‚ b) OutOfMemoryErrorï¼š è‹¥Javaè™šæ‹Ÿæœºæ ˆçš„å†…å­˜å¤§å°å…è®¸åŠ¨æ€æ‰©å±•ï¼Œä¸”å½“çº¿ç¨‹è¯·æ±‚æ ˆæ—¶å†…å­˜ç”¨å®Œäº†ï¼Œæ— æ³•å†åŠ¨æ€æ‰©å±•äº†ï¼Œæ­¤æ—¶æŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ Javaè™šæ‹Ÿæœºæ ˆä¹Ÿæ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰å„è‡ªçš„Javaè™šæ‹Ÿæœºæ ˆï¼Œè€Œä¸”éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œéšç€çº¿ç¨‹çš„æ­»äº¡è€Œæ­»äº¡ã€‚ æ³¨ï¼šStackOverFlowErrorå’ŒOutOfMemoryErrorçš„å¼‚åŒï¼Ÿ StackOverFlowErrorè¡¨ç¤ºå½“å‰çº¿ç¨‹ç”³è¯·çš„æ ˆè¶…è¿‡äº†äº‹å…ˆå®šå¥½çš„æ ˆçš„æœ€å¤§æ·±åº¦ï¼Œä½†å†…å­˜ç©ºé—´å¯èƒ½è¿˜æœ‰å¾ˆå¤šã€‚ è§£å†³è¿™ç§é—®é¢˜å¯ä»¥é€‚å½“åŠ å¤§æ ˆçš„æ·±åº¦ï¼ˆå¢åŠ æ ˆç©ºé—´å¤§å°ï¼‰ï¼Œä¹Ÿå°±æ˜¯æŠŠ -Xss çš„å€¼è®¾ç½®å¤§ä¸€äº›ï¼Œä½†ä¸€èˆ¬æƒ…å†µä¸‹æ˜¯ä»£ç é—®é¢˜çš„å¯èƒ½æ€§è¾ƒå¤§ è€ŒOutOfMemoryErroræ˜¯æŒ‡å½“çº¿ç¨‹ç”³è¯·æ ˆæ—¶å‘ç°æ ˆå·²ç»æ»¡äº†ï¼Œè€Œä¸”å†…å­˜ä¹Ÿå…¨éƒ½ç”¨å…‰äº†ã€‚ è§£å†³è¿™ç§é—®é¢˜å¯ä»¥é€‚å½“å‡å°æ ˆçš„æ·±åº¦ï¼Œä¹Ÿå°±æ˜¯æŠŠ -Xss çš„å€¼è®¾ç½®å°ä¸€äº›ï¼Œæ¯ä¸ªçº¿ç¨‹å ç”¨çš„ç©ºé—´å°äº†ï¼Œæ€»ç©ºé—´ä¸€å®šå°±èƒ½å®¹çº³æ›´å¤šçš„çº¿ç¨‹ï¼Œä½†æ˜¯æ“ä½œç³»ç»Ÿå¯¹ä¸€ä¸ªè¿›ç¨‹çš„çº¿ç¨‹æ•°æœ‰é™åˆ¶ï¼Œç»éªŒå€¼åœ¨ 3000~5000 å·¦å³ã€‚ åœ¨ jdk1.5 ä¹‹å‰ -Xss é»˜è®¤æ˜¯ 256kï¼Œjdk1.5 ä¹‹åé»˜è®¤æ˜¯ 1Mï¼Œè¿™ä¸ªé€‰é¡¹å¯¹ç³»ç»Ÿå½±å“è¿˜æ˜¯è›®å¤§çš„ï¼Œè®¾ç½®æ—¶è¦æ ¹æ®å®é™…æƒ…å†µï¼Œè°¨æ…æ“ä½œã€‚ æœ¬åœ°æ–¹æ³•æ ˆ ä»€ä¹ˆæ˜¯æœ¬åœ°æ–¹æ³•æ ˆ æœ¬åœ°æ–¹æ³•æ ˆå’ŒJavaè™šæ‹Ÿæœºæ ˆå®ç°çš„åŠŸèƒ½ç±»ä¼¼ï¼Œåªä¸è¿‡æœ¬åœ°æ–¹æ³•æ ˆæ˜¯æœ¬åœ°æ–¹æ³•è¿è¡Œçš„å†…å­˜æ¨¡å‹ã€‚ æœ¬åœ°æ–¹æ³•è¢«æ‰§è¡Œçš„æ—¶å€™ï¼Œåœ¨æœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§ï¼Œç”¨äºå­˜æ”¾è¯¥æœ¬åœ°æ–¹æ³•çš„å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€å‡ºå£ä¿¡æ¯ã€‚ æ–¹æ³•æ‰§è¡Œå®Œæ¯•åç›¸åº”çš„æ ˆå¸§ä¹Ÿä¼šå‡ºæ ˆå¹¶é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚ä¹Ÿä¼šæŠ›å‡ºStackOverFlowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚ å † ä»€ä¹ˆæ˜¯å † å †æ˜¯ç”¨æ¥å­˜æ”¾å¯¹è±¡çš„å†…å­˜ç©ºé—´ã€‚ å‡ ä¹æ‰€æœ‰çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †ä¸­ã€‚ å †çš„ç‰¹ç‚¹ çº¿ç¨‹å…±äº«ï¼Œæ•´ä¸ªJavaè™šæ‹Ÿæœºåªæœ‰ä¸€ä¸ªå †ï¼Œæ‰€æœ‰çš„çº¿ç¨‹éƒ½è®¿é—®åŒä¸€ä¸ªå †ã€‚è€Œç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯ä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªçš„ã€‚ åœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»º åƒåœ¾å›æ”¶çš„ä¸»è¦åœºæ‰€ã€‚ å¯ä»¥è¿›ä¸€æ­¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£ã€è€å¹´ä»£ã€‚ æ–°ç”Ÿä»£åˆå¯è¢«åˆ†ä¸ºï¼šEdenã€From Surviorã€To Surviorã€‚ ä¸åŒçš„åŒºåŸŸå­˜æ”¾å…·æœ‰ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚è¿™æ ·å¯ä»¥æ ¹æ®ä¸åŒçš„åŒºåŸŸä½¿ç”¨ä¸åŒçš„åƒåœ¾å›æ”¶ç®—æ³•ï¼Œä»è€Œæ›´å…·æœ‰é’ˆå¯¹æ€§ï¼Œæ›´é«˜æ•ˆã€‚ å †çš„å¤§å°æ—¢å¯ä»¥å›ºå®šä¹Ÿå¯ä»¥æ‰©å±•ï¼Œä½†ä¸»æµçš„è™šæ‹Ÿæœºå †çš„å¤§å°æ˜¯å¯æ‰©å±•çš„ï¼Œå› æ­¤å½“çº¿ç¨‹è¯·æ±‚åˆ†é…å†…å­˜ï¼Œä½†å †å·²æ»¡ï¼Œä¸”å†…å­˜å·²æ»¡æ— æ³•å†æ‰©å±•æ—¶ï¼Œå°±æŠ›å‡ºOutOfMemoryErrorã€‚ æ–¹æ³•åŒº ä»€ä¹ˆæ˜¯æ–¹æ³•åŒº Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å®šä¹‰æ–¹æ³•åŒºæ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ã€‚æ–¹æ³•åŒºä¸­å­˜æ”¾å·²ç»è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰ã€‚ æ–¹æ³•åŒºçš„ç‰¹ç‚¹ çº¿ç¨‹å…±äº« æ–¹æ³•åŒºæ˜¯å †çš„ä¸€ä¸ªé€»è¾‘éƒ¨åˆ†ï¼Œå› æ­¤å’Œå †ä¸€æ ·ï¼Œéƒ½æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚æ•´ä¸ªè™šæ‹Ÿæœºä¸­åªæœ‰ä¸€ä¸ªæ–¹æ³•åŒºã€‚ æ°¸ä¹…ä»£ æ–¹æ³•åŒºä¸­çš„ä¿¡æ¯ä¸€èˆ¬éœ€è¦é•¿æœŸå­˜åœ¨ï¼Œè€Œä¸”å®ƒåˆæ˜¯å †çš„é€»è¾‘åˆ†åŒºï¼Œå› æ­¤ç”¨å †çš„åˆ’åˆ†æ–¹æ³•ï¼Œæˆ‘ä»¬æŠŠæ–¹æ³•åŒºç§°ä¸ºæ°¸ä¹…ä»£ã€‚ å†…å­˜å›æ”¶æ•ˆç‡ä½ æ–¹æ³•åŒºçš„ä¿¡æ¯ä¸€èˆ¬éœ€è¦é•¿æœŸå­˜åœ¨ï¼Œå›æ”¶ä¸€éå†…å­˜ä¹‹åå¯èƒ½åªæœ‰å°‘é‡ä¿¡æ¯æ— æ•ˆã€‚ å¯¹æ–¹æ³•åŒºçš„å†…å­˜å›æ”¶çš„ä¸»è¦ç›®æ ‡æ˜¯ï¼šå¯¹å¸¸é‡æ± çš„å›æ”¶ å’Œ å¯¹ç±»çš„å¸è½½ã€‚ Javaè™šæ‹Ÿæœºè§„èŒƒå¯¹æ–¹æ³•åŒºçš„è¦æ±‚æ¯”è¾ƒå®½æ¾ã€‚ å’Œå †ä¸€æ ·ï¼Œå…è®¸å›ºå®šå¤§å°ï¼Œä¹Ÿå…è®¸å¯æ‰©å±•çš„å¤§å°ï¼Œè¿˜å…è®¸ä¸å®ç°åƒåœ¾å›æ”¶ã€‚ ä»€ä¹ˆæ˜¯è¿è¡Œæ—¶å¸¸é‡æ±  æ–¹æ³•åŒºä¸­å­˜æ”¾ä¸‰ç§æ•°æ®ï¼šç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ã€‚å…¶ä¸­å¸¸é‡å­˜å‚¨åœ¨è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚jdk1,6å¸¸é‡æ± æ”¾åœ¨æ–¹æ³•åŒºï¼Œjdk1.7å¸¸é‡æ± æ”¾åœ¨å †å†…å­˜ï¼Œjdk1.8æ”¾åœ¨å…ƒç©ºé—´é‡Œé¢ï¼Œå’Œå †ç›¸ç‹¬ç«‹ã€‚ æˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸€ä¸ªç±»ä¸­é€šè¿‡public static finalæ¥å£°æ˜ä¸€ä¸ªå¸¸é‡ã€‚è¿™ä¸ªç±»è¢«ç¼–è¯‘åä¾¿ç”ŸæˆClassæ–‡ä»¶ï¼Œè¿™ä¸ªç±»çš„æ‰€æœ‰ä¿¡æ¯éƒ½å­˜å‚¨åœ¨è¿™ä¸ªclassæ–‡ä»¶ä¸­ã€‚ å½“è¿™ä¸ªç±»è¢«Javaè™šæ‹ŸæœºåŠ è½½åï¼Œclassæ–‡ä»¶ä¸­çš„å¸¸é‡å°±å­˜æ”¾åœ¨æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­ã€‚è€Œä¸”åœ¨è¿è¡ŒæœŸé—´ï¼Œå¯ä»¥å‘å¸¸é‡æ± ä¸­æ·»åŠ æ–°çš„å¸¸é‡ã€‚å¦‚ï¼šStringç±»çš„intern()æ–¹æ³•å°±èƒ½åœ¨è¿è¡ŒæœŸé—´å‘å¸¸é‡æ± ä¸­æ·»åŠ å­—ç¬¦ä¸²å¸¸é‡ã€‚ å½“è¿è¡Œæ—¶å¸¸é‡æ± ä¸­çš„æŸäº›å¸¸é‡æ²¡æœ‰è¢«å¯¹è±¡å¼•ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰è¢«å˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±éœ€è¦åƒåœ¾æ”¶é›†å™¨å›æ”¶ã€‚ ç›´æ¥å†…å­˜ ç›´æ¥å†…å­˜æ˜¯é™¤Javaè™šæ‹Ÿæœºä¹‹å¤–çš„å†…å­˜ï¼Œä½†ä¹Ÿæœ‰å¯èƒ½è¢«Javaä½¿ç”¨ã€‚ åœ¨NIOä¸­å¼•å…¥äº†ä¸€ç§åŸºäºé€šé“å’Œç¼“å†²çš„IOæ–¹å¼ã€‚å®ƒå¯ä»¥é€šè¿‡è°ƒç”¨æœ¬åœ°æ–¹æ³•ç›´æ¥åˆ†é…Javaè™šæ‹Ÿæœºä¹‹å¤–çš„å†…å­˜ï¼Œç„¶åé€šè¿‡ä¸€ä¸ªå­˜å‚¨åœ¨Javaå †ä¸­çš„DirectByteBufferå¯¹è±¡ç›´æ¥æ“ä½œè¯¥å†…å­˜ï¼Œè€Œæ— éœ€å…ˆå°†å¤–é¢å†…å­˜ä¸­çš„æ•°æ®å¤åˆ¶åˆ°å †ä¸­å†æ“ä½œï¼Œä»è€Œæå‡äº†æ•°æ®æ“ä½œçš„æ•ˆç‡ã€‚ ç›´æ¥å†…å­˜çš„å¤§å°ä¸å—Javaè™šæ‹Ÿæœºæ§åˆ¶ï¼Œä½†æ—¢ç„¶æ˜¯å†…å­˜ï¼Œå½“å†…å­˜ä¸è¶³æ—¶å°±ä¼šæŠ›å‡ºOOMå¼‚å¸¸ã€‚ Javaå¯¹è±¡è®¿é—®æ¨¡å¼ å¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹ å½“è™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡å«æœ‰newçš„æŒ‡ä»¤æ—¶ï¼Œä¼šè¿›è¡Œä¸€ç³»åˆ—å¯¹è±¡åˆ›å»ºçš„æ“ä½œï¼š æ£€æŸ¥å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰å³å°†è¦åˆ›å»ºçš„è¿™ä¸ªå¯¹è±¡æ‰€å±çš„ç±»çš„ç¬¦å·å¼•ç”¨ï¼› è‹¥å¸¸é‡æ± ä¸­æ²¡æœ‰è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œè¯´æ˜è¿™ä¸ªç±»è¿˜æ²¡æœ‰è¢«å®šä¹‰ï¼æŠ›å‡ºClassNotFoundExceptionï¼› è‹¥å¸¸é‡æ± ä¸­æœ‰è¿™ä¸ªç±»çš„ç¬¦å·å¼•ç”¨ï¼Œåˆ™è¿›è¡Œä¸‹ä¸€æ­¥å·¥ä½œï¼› è¿›è€Œæ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨æ‰€ä»£è¡¨çš„ç±»æ˜¯å¦å·²ç»è¢«JVMåŠ è½½ï¼› è‹¥è¯¥ç±»è¿˜æ²¡æœ‰è¢«åŠ è½½ï¼Œå°±æ‰¾è¯¥ç±»çš„classæ–‡ä»¶ï¼Œå¹¶åŠ è½½è¿›æ–¹æ³•åŒºï¼› è‹¥è¯¥ç±»å·²ç»è¢«JVMåŠ è½½ï¼Œåˆ™å‡†å¤‡ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼› æ ¹æ®æ–¹æ³•åŒºä¸­è¯¥ç±»çš„ä¿¡æ¯ç¡®å®šè¯¥ç±»æ‰€éœ€çš„å†…å­˜å¤§å°ï¼› ä¸€ä¸ªå¯¹è±¡æ‰€éœ€çš„å†…å­˜å¤§å°æ˜¯åœ¨è¿™ä¸ªå¯¹è±¡æ‰€å±ç±»è¢«å®šä¹‰å®Œå°±èƒ½ç¡®å®šçš„ï¼ä¸”ä¸€ä¸ªç±»æ‰€ç”Ÿäº§çš„æ‰€æœ‰å¯¹è±¡çš„å†…å­˜å¤§å°æ˜¯ä¸€æ ·çš„ï¼JVMåœ¨ä¸€ä¸ªç±»è¢«åŠ è½½è¿›æ–¹æ³•åŒºçš„æ—¶å€™å°±çŸ¥é“è¯¥ç±»ç”Ÿäº§çš„æ¯ä¸€ä¸ªå¯¹è±¡æ‰€éœ€è¦çš„å†…å­˜å¤§å°ã€‚ ä»å †ä¸­åˆ’åˆ†ä¸€å—å¯¹åº”å¤§å°çš„å†…å­˜ç©ºé—´ç»™æ–°çš„å¯¹è±¡ï¼› åˆ†é…å †ä¸­å†…å­˜æœ‰ä¸¤ç§æ–¹å¼ï¼š &lt;span id="inline-purple"&gt; æŒ‡é’ˆç¢°æ’ &lt;/span&gt; å¦‚æœJVMçš„åƒåœ¾æ”¶é›†å™¨é‡‡ç”¨å¤åˆ¶ç®—æ³•æˆ–æ ‡è®°-æ•´ç†ç®—æ³•ï¼Œé‚£ä¹ˆå †ä¸­ç©ºé—²å†…å­˜æ˜¯å®Œæ•´çš„åŒºåŸŸï¼Œå¹¶ä¸”ç©ºé—²å†…å­˜å’Œå·²ä½¿ç”¨å†…å­˜ä¹‹é—´ç”±ä¸€ä¸ªæŒ‡é’ˆæ ‡è®°ã€‚é‚£ä¹ˆå½“ä¸ºä¸€ä¸ªå¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œåªéœ€ç§»åŠ¨æŒ‡é’ˆå³å¯ã€‚å› æ­¤ï¼Œè¿™ç§åœ¨å®Œæ•´ç©ºé—²åŒºåŸŸä¸Šé€šè¿‡ç§»åŠ¨æŒ‡é’ˆæ¥åˆ†é…å†…å­˜çš„æ–¹å¼å°±å«åšâ€œæŒ‡é’ˆç¢°æ’â€ã€‚ &lt;span id="inline-purple"&gt; ç©ºé—²åˆ—è¡¨ &lt;/span&gt; å¦‚æœJVMçš„åƒåœ¾æ”¶é›†å™¨é‡‡ç”¨æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œé‚£ä¹ˆå †ä¸­ç©ºé—²åŒºåŸŸå’Œå·²ä½¿ç”¨åŒºåŸŸäº¤é”™ï¼Œå› æ­¤éœ€è¦ç”¨ä¸€å¼ â€œç©ºé—²åˆ—è¡¨â€æ¥è®°å½•å †ä¸­å“ªäº›åŒºåŸŸæ˜¯ç©ºé—²åŒºåŸŸï¼Œä»è€Œåœ¨åˆ›å»ºå¯¹è±¡çš„æ—¶å€™æ ¹æ®è¿™å¼ â€œç©ºé—²åˆ—è¡¨â€æ‰¾åˆ°ç©ºé—²åŒºåŸŸï¼Œå¹¶åˆ†é…å†…å­˜ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼šJVMç©¶ç«Ÿé‡‡ç”¨å“ªç§å†…å­˜åˆ†é…æ–¹æ³•ï¼Œå–å†³äºå®ƒä½¿ç”¨äº†ä½•ç§åƒåœ¾æ”¶é›†å™¨ã€‚ ä¸ºå¯¹è±¡ä¸­çš„æˆå‘˜å˜é‡èµ‹ä¸Šåˆå§‹å€¼(é»˜è®¤åˆå§‹åŒ–)ï¼› è®¾ç½®å¯¹è±¡å¤´ä¸­çš„ä¿¡æ¯ï¼› è°ƒç”¨å¯¹è±¡çš„æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ– æ­¤æ—¶ï¼Œæ•´ä¸ªå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹å°±å®Œæˆäº†ã€‚ å¯¹è±¡çš„å†…å­˜æ¨¡å‹ ä¸€ä¸ªå¯¹è±¡ä»é€»è¾‘è§’åº¦çœ‹ï¼Œå®ƒç”±æˆå‘˜å˜é‡å’Œæˆå‘˜å‡½æ•°æ„æˆï¼Œä»ç‰©ç†è§’åº¦æ¥çœ‹ï¼Œå¯¹è±¡æ˜¯å­˜å‚¨åœ¨å †ä¸­çš„ä¸€ä¸²äºŒè¿›åˆ¶æ•°ï¼Œè¿™ä¸²äºŒè¿›åˆ¶æ•°çš„ç»„ç»‡ç»“æ„å¦‚ä¸‹ã€‚ å¯¹è±¡åœ¨å†…å­˜ä¸­åˆ†ä¸ºä¸‰ä¸ªéƒ¨åˆ†ï¼š å¯¹è±¡å¤´ å®ä¾‹æ•°æ® å¯¹é½è¡¥å…… å¯¹è±¡å¤´ åŒ…å«ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†ç”¨äºå­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ã€GC åˆ†ä»£å¹´é¾„ã€é”çŠ¶æ€æ ‡å¿—ã€çº¿ç¨‹æŒæœ‰çš„é”ã€åå‘çº¿ç¨‹ IDã€åå‘æ—¶é—´æˆ³ç­‰ï¼Œ32 ä½è™šæ‹Ÿæœºå  32 bitï¼Œ64 ä½è™šæ‹Ÿæœºå  64 bitã€‚å®˜æ–¹ç§°ä¸º â€˜Mark Wordâ€™ã€‚ ç¬¬äºŒéƒ¨åˆ†æ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘å®ƒçš„ç±»çš„å…ƒæ•°æ®æŒ‡é’ˆï¼Œè™šæ‹Ÿæœºé€šè¿‡è¿™ä¸ªæŒ‡é’ˆç¡®å®šè¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€‚ å¦å¤–ï¼Œå¦‚æœæ˜¯ Java æ•°ç»„ï¼Œå¯¹è±¡å¤´ä¸­è¿˜å¿…é¡»æœ‰ä¸€å—ç”¨äºè®°å½•æ•°ç»„é•¿åº¦çš„æ•°æ®ï¼Œå› ä¸ºæ™®é€šå¯¹è±¡å¯ä»¥é€šè¿‡ Java å¯¹è±¡å…ƒæ•°æ®ç¡®å®šå¤§å°ï¼Œè€Œæ•°ç»„å¯¹è±¡ä¸å¯ä»¥ã€‚ å®ä¾‹æ•°æ® å®ä¾‹æ•°æ®éƒ¨åˆ†å°±æ˜¯æˆå‘˜å˜é‡çš„å€¼ï¼Œå…¶ä¸­åŒ…å«çˆ¶ç±»çš„æˆå‘˜å˜é‡å’Œæœ¬ç±»çš„æˆå‘˜å˜é‡ã€‚ å¯¹é½è¡¥å…… ç”¨äºç¡®ä¿å¯¹è±¡çš„æ€»é•¿åº¦ä¸º8å­—èŠ‚çš„æ•´æ•°å€ã€‚ HotSpotè¦æ±‚å¯¹è±¡çš„æ€»é•¿åº¦å¿…é¡»æ˜¯8å­—èŠ‚çš„æ•´æ•°å€ã€‚ç”±äºå¯¹è±¡å¤´ä¸€å®šæ˜¯8å­—èŠ‚çš„æ•´æ•°å€ï¼Œä½†å®ä¾‹æ•°æ®éƒ¨åˆ†çš„é•¿åº¦æ˜¯ä»»æ„çš„ï¼Œå› æ­¤éœ€è¦å¯¹é½è¡¥å……å­—æ®µç¡®ä¿æ•´ä¸ªå¯¹è±¡çš„æ€»é•¿åº¦ä¸º8çš„æ•´æ•°å€ã€‚ è®¿é—®å¯¹è±¡çš„è¿‡ç¨‹ æˆ‘ä»¬çŸ¥é“ï¼Œå¼•ç”¨ç±»å‹çš„å˜é‡ä¸­å­˜æ”¾çš„æ˜¯ä¸€ä¸ªåœ°å€ï¼Œé‚£ä¹ˆæ ¹æ®åœ°å€ç±»å‹çš„ä¸åŒï¼Œå¯¹è±¡æœ‰ä¸åŒçš„è®¿é—®æ–¹å¼ï¼š å¥æŸ„è®¿é—®æ–¹å¼ å †ä¸­éœ€è¦æœ‰ä¸€å—å«åšâ€œå¥æŸ„æ± â€çš„å†…å­˜ç©ºé—´ï¼Œç”¨äºå­˜æ”¾æ‰€æœ‰å¯¹è±¡çš„åœ°å€å’Œæ‰€æœ‰å¯¹è±¡æ‰€å±ç±»çš„ç±»ä¿¡æ¯ã€‚ å¼•ç”¨ç±»å‹çš„å˜é‡å­˜æ”¾çš„æ˜¯è¯¥å¯¹è±¡åœ¨å¥æŸ„æ± ä¸­çš„åœ°å€ã€‚è®¿é—®å¯¹è±¡æ—¶ï¼Œé¦–å…ˆéœ€è¦é€šè¿‡å¼•ç”¨ç±»å‹çš„å˜é‡æ‰¾åˆ°è¯¥å¯¹è±¡çš„å¥æŸ„ï¼Œç„¶åæ ¹æ®å¥æŸ„ä¸­å¯¹è±¡çš„åœ°å€å†è®¿é—®å¯¹è±¡ã€‚ è¿™ç§æ¨¡å¼çš„å‡†ç¡®åº¦å¾ˆé«˜ï¼Œä½†è¿‡ç¨‹è¾ƒä¸ºç¹çï¼Œè€Œjavaä¸­æ˜¯æ²¡æœ‰å¥æŸ„çš„ï¼Œæ‰€ä»¥ï¼Œjavaä¸­ç›´æ¥åˆ©ç”¨çš„å¯¹è±¡ä¿å­˜æ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯è¯´å †å†…å­˜ä¸­ï¼Œä¸éœ€è¦ä¿å­˜å¥æŸ„ï¼Œè€Œç›´æ¥ä¿å­˜å…·ä½“çš„å¯¹è±¡ã€‚å°±ç›¸å½“äºçœç•¥äº†å¥æŸ„åˆ°å¯¹è±¡ä¹‹é—´çš„æŸ¥æ‰¾ã€‚è€Œåè¿™ä¸ªå¯¹è±¡å¯ä»¥ç›´æ¥è¿›è¡ŒJavaæ–¹æ³•åŒºçš„è°ƒç”¨ã€‚ ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼ å¼•ç”¨ç±»å‹çš„å˜é‡ç›´æ¥å­˜æ”¾å¯¹è±¡çš„åœ°å€ï¼Œä»è€Œä¸éœ€è¦å¥æŸ„æ± ï¼Œé€šè¿‡å¼•ç”¨èƒ½å¤Ÿç›´æ¥è®¿é—®å¯¹è±¡ã€‚ ä½†å¯¹è±¡æ‰€åœ¨çš„å†…å­˜ç©ºé—´ä¸­éœ€è¦é¢å¤–çš„ç­–ç•¥å­˜å‚¨å¯¹è±¡æ‰€å±çš„ç±»ä¿¡æ¯çš„åœ°å€ã€‚ æ¯”è¾ƒ HotSpoté‡‡ç”¨ç›´æ¥æŒ‡é’ˆæ–¹å¼è®¿é—®å¯¹è±¡ï¼Œå› ä¸ºå®ƒåªéœ€ä¸€æ¬¡å¯»å€æ“ä½œï¼Œä»è€Œæ€§èƒ½æ¯”å¥æŸ„è®¿é—®æ–¹å¼å¿«ä¸€å€ã€‚ä½†å®ƒéœ€è¦é¢å¤–çš„ç­–ç•¥å­˜å‚¨å¯¹è±¡åœ¨æ–¹æ³•åŒºä¸­ç±»ä¿¡æ¯çš„åœ°å€ã€‚ åƒåœ¾æ”¶é›†ç­–ç•¥ ç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆéƒ½æ˜¯çº¿ç¨‹ç§æœ‰çš„ï¼Œä¹Ÿå°±æ˜¯æ¯æ¡çº¿ç¨‹éƒ½æ‹¥æœ‰è¿™ä¸‰å—åŒºåŸŸï¼Œè€Œä¸”ä¼šéšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹çš„ç»“æŸè€Œé”€æ¯ã€‚é‚£ä¹ˆï¼Œåƒåœ¾æ”¶é›†å™¨åœ¨ä½•æ—¶æ¸…æ‰«è¿™ä¸‰å—åŒºåŸŸçš„é—®é¢˜å°±è§£å†³äº†ã€‚ æ­¤å¤–ï¼ŒJavaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆä¸­çš„æ ˆå¸§ä¼šéšç€æ–¹æ³•çš„å¼€å§‹è€Œå…¥æ ˆï¼Œæ–¹æ³•çš„ç»“æŸè€Œå‡ºæ ˆï¼Œå¹¶ä¸”æ¯ä¸ªæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨éƒ½æ˜¯åœ¨ç±»è¢«åŠ è½½çš„æ—¶å€™å°±ç¡®å®šçš„ã€‚å› æ­¤ä»¥ä¸Šä¸‰ä¸ªåŒºåŸŸçš„åƒåœ¾æ”¶é›†å·¥ä½œå…·æœ‰ç¡®å®šæ€§ï¼Œåƒåœ¾æ”¶é›†å™¨èƒ½å¤Ÿæ¸…æ¥šåœ°çŸ¥é“ä½•æ—¶æ¸…æ‰«è¿™ä¸‰å—åŒºåŸŸä¸­çš„å“ªäº›æ•°æ®ã€‚ ç„¶è€Œï¼Œå †å’Œæ–¹æ³•åŒºä¸­çš„å†…å­˜æ¸…ç†å·¥ä½œå°±æ²¡é‚£ä¹ˆå®¹æ˜“äº†ã€‚ å †å’Œæ–¹æ³•åŒºæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œå¹¶ä¸”éƒ½åœ¨JVMå¯åŠ¨æ—¶åˆ›å»ºï¼Œä¸€ç›´å¾—è¿è¡Œåˆ°JVMåœæ­¢æ—¶ã€‚å› æ­¤å®ƒä»¬æ²¡åŠæ³•æ ¹æ®çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºã€çº¿ç¨‹çš„ç»“æŸè€Œé‡Šæ”¾ã€‚ å †ä¸­å­˜æ”¾JVMè¿è¡ŒæœŸé—´çš„æ‰€æœ‰å¯¹è±¡ï¼Œè™½ç„¶æ¯ä¸ªå¯¹è±¡çš„å†…å­˜å¤§å°åœ¨åŠ è½½è¯¥å¯¹è±¡æ‰€å±ç±»çš„æ—¶å€™å°±ç¡®å®šäº†ï¼Œä½†ç©¶ç«Ÿåˆ›å»ºå¤šå°‘ä¸ªå¯¹è±¡åªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šã€‚ æ–¹æ³•åŒºä¸­å­˜æ”¾ç±»ä¿¡æ¯ã€é™æ€æˆå‘˜å˜é‡ã€å¸¸é‡ã€‚ç±»çš„åŠ è½½æ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå½“éœ€è¦åˆ›å»ºè¿™ä¸ªç±»çš„å¯¹è±¡æ—¶æ‰ä¼šåŠ è½½è¿™ä¸ªç±»ã€‚å› æ­¤ï¼ŒJVMç©¶ç«Ÿè¦åŠ è½½å¤šå°‘ä¸ªç±»ä¹Ÿéœ€è¦åœ¨ç¨‹åºè¿è¡ŒæœŸé—´ç¡®å®šã€‚ å› æ­¤ï¼Œå †å’Œæ–¹æ³•åŒºçš„å†…å­˜å›æ”¶å…·æœ‰ä¸ç¡®å®šæ€§ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨åœ¨å›æ”¶å †å’Œæ–¹æ³•åŒºå†…å­˜çš„æ—¶å€™èŠ±äº†ä¸€äº›å¿ƒæ€ã€‚ å †å†…å­˜çš„å›æ”¶ å¦‚ä½•åˆ¤å®šå“ªäº›å¯¹è±¡éœ€è¦å›æ”¶ åœ¨å¯¹å †è¿›è¡Œå¯¹è±¡å›æ”¶ä¹‹å‰ï¼Œé¦–å…ˆè¦åˆ¤æ–­å“ªäº›æ˜¯æ— æ•ˆå¯¹è±¡ã€‚æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¯¹è±¡ä¸è¢«ä»»ä½•å¯¹è±¡æˆ–å˜é‡å¼•ç”¨ï¼Œé‚£ä¹ˆå°±æ˜¯æ— æ•ˆå¯¹è±¡ï¼Œéœ€è¦è¢«å›æ”¶ã€‚ä¸€èˆ¬æœ‰ä¸¤ç§åˆ¤åˆ«æ–¹å¼ï¼š å¼•ç”¨è®¡æ•°æ³• æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè®¡æ•°å™¨ï¼Œå½“è¿™ä¸ªå¯¹è±¡è¢«ä¸€ä¸ªå˜é‡æˆ–å¦ä¸€ä¸ªå¯¹è±¡å¼•ç”¨ä¸€æ¬¡ï¼Œè¯¥è®¡æ•°å™¨åŠ ä¸€ï¼›è‹¥è¯¥å¼•ç”¨å¤±æ•ˆåˆ™è®¡æ•°å™¨å‡ä¸€ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œå°±è®¤ä¸ºè¯¥å¯¹è±¡æ˜¯æ— æ•ˆå¯¹è±¡ã€‚ å¼•ç”¨è®¡æ•°æ³•è™½ç„¶ç®€å•ï¼Œä½†å­˜åœ¨ä¸€ä¸ªä¸¥é‡çš„é—®é¢˜ï¼Œå®ƒæ— æ³•è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ï¼ˆæ¯”å¦‚å¯¹è±¡Aå¼•ç”¨å¯¹è±¡Bï¼ŒåŒæ—¶ï¼Œå¯¹è±¡Bä¹Ÿå¼•ç”¨å¯¹è±¡Aï¼Œé€ æˆå¾ªç¯å¼•ç”¨ï¼‰ å¯è¾¾æ€§åˆ†ææ³• æ‰€æœ‰å’ŒGC Rootsç›´æ¥æˆ–é—´æ¥å…³è”çš„å¯¹è±¡éƒ½æ˜¯æœ‰æ•ˆå¯¹è±¡ï¼Œå’ŒGC Rootsæ²¡æœ‰å…³è”çš„å¯¹è±¡å°±æ˜¯æ— æ•ˆå¯¹è±¡ã€‚ GC Rootsæ˜¯æŒ‡ï¼š Javaè™šæ‹Ÿæœºæ ˆæ‰€å¼•ç”¨çš„å¯¹è±¡(æ ˆå¸§ä¸­å±€éƒ¨å˜é‡è¡¨ä¸­å¼•ç”¨ç±»å‹çš„å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡) æ–¹æ³•åŒºä¸­é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ æ–¹æ³•åŒºä¸­å¸¸é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ æœ¬åœ°æ–¹æ³•æ ˆæ‰€å¼•ç”¨çš„å¯¹è±¡ &lt;font color="red"&gt; æ³¨æ„ï¼šGC Rootså¹¶ä¸åŒ…æ‹¬å †ä¸­å¯¹è±¡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼è¿™æ ·å°±ä¸ä¼šå‡ºç°å¾ªç¯å¼•ç”¨ã€‚ &lt;/font&gt; å›æ”¶æ— æ•ˆå¯¹è±¡çš„è¿‡ç¨‹ å½“JVMç­›é€‰å‡ºå¤±æ•ˆçš„å¯¹è±¡ä¹‹åï¼Œå¹¶ä¸æ˜¯ç«‹å³æ¸…é™¤ï¼Œè€Œæ˜¯å†ç»™å¯¹è±¡ä¸€æ¬¡é‡ç”Ÿçš„æœºä¼šï¼Œå…·ä½“è¿‡ç¨‹å¦‚ä¸‹ï¼š åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦è¦†ç›–äº†finalize()æ–¹æ³• è‹¥å·²è¦†ç›–è¯¥æ–¹æ³•ï¼Œå¹¶è¯¥å¯¹è±¡çš„finalize()æ–¹æ³•è¿˜æ²¡æœ‰è¢«æ‰§è¡Œè¿‡ï¼Œé‚£ä¹ˆå°±ä¼šå°†finalize()æ‰”åˆ°F-Queueé˜Ÿåˆ—ä¸­ï¼› è‹¥æœªè¦†ç›–è¯¥æ–¹æ³•ï¼Œåˆ™ç›´æ¥é‡Šæ”¾å¯¹è±¡å†…å­˜ã€‚ æ‰§è¡ŒF-Queueé˜Ÿåˆ—ä¸­çš„finalize()æ–¹æ³• è™šæ‹Ÿæœºä¼šä»¥è¾ƒä½çš„ä¼˜å…ˆçº§æ‰§è¡Œè¿™äº›finalize()æ–¹æ³•ä»¬ï¼Œä¹Ÿä¸ä¼šç¡®ä¿æ‰€æœ‰çš„finalize()æ–¹æ³•éƒ½ä¼šæ‰§è¡Œç»“æŸã€‚å¦‚æœfinalize()æ–¹æ³•ä¸­å‡ºç°è€—æ—¶æ“ä½œï¼Œè™šæ‹Ÿæœºå°±ç›´æ¥åœæ­¢æ‰§è¡Œï¼Œå°†è¯¥å¯¹è±¡æ¸…é™¤ã€‚ å¯¹è±¡é‡ç”Ÿæˆ–æ­»äº¡ å¦‚æœåœ¨æ‰§è¡Œfinalize()æ–¹æ³•æ—¶ï¼Œå°†thisèµ‹ç»™äº†æŸä¸€ä¸ªå¼•ç”¨ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡å°±é‡ç”Ÿäº†ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£ä¹ˆå°±ä¼šè¢«åƒåœ¾æ”¶é›†å™¨æ¸…é™¤ã€‚ &lt;font color="red"&gt; æ³¨æ„ï¼š å¼ºçƒˆä¸å»ºè®®ä½¿ç”¨finalize()å‡½æ•°è¿›è¡Œä»»ä½•æ“ä½œï¼å¦‚æœéœ€è¦é‡Šæ”¾èµ„æºï¼Œè¯·ä½¿ç”¨try-finallyã€‚ å› ä¸ºfinalize()ä¸ç¡®å®šæ€§å¤§ï¼Œå¼€é”€å¤§ï¼Œæ— æ³•ä¿è¯é¡ºåˆ©æ‰§è¡Œã€‚ &lt;/font&gt; æ–¹æ³•åŒºçš„å†…å­˜å›æ”¶ å¦‚æœä½¿ç”¨å¤åˆ¶ç®—æ³•å®ç°å †çš„å†…å­˜å›æ”¶ï¼Œå †å°±ä¼šè¢«åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡â€œæœç”Ÿå¤•æ­»â€ï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶éƒ½ä¼šæ¸…é™¤æ‰å¤§é‡çš„å¯¹è±¡ï¼›è€Œè€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½è¾ƒé•¿ï¼Œæ¯æ¬¡åƒåœ¾å›æ”¶åªæœ‰å°‘é‡çš„å¯¹è±¡è¢«æ¸…é™¤æ‰ã€‚ ç”±äºæ–¹æ³•åŒºä¸­å­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œå› æ­¤æ–¹æ³•åŒºå°±åƒæ˜¯å †çš„è€å¹´ä»£ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†çš„åªæœ‰å°‘é‡çš„åƒåœ¾è¢«æ¸…é™¤æ‰ã€‚ æ–¹æ³•åŒºä¸­ä¸»è¦æ¸…é™¤ä¸¤ç§åƒåœ¾ï¼š åºŸå¼ƒå¸¸é‡ åºŸå¼ƒçš„ç±» å¦‚ä½•æ¸…é™¤åºŸå¼ƒå¸¸é‡ æ¸…é™¤åºŸå¼ƒçš„å¸¸é‡å’Œæ¸…é™¤å¯¹è±¡ç±»ä¼¼ï¼Œåªè¦å¸¸é‡æ± ä¸­çš„å¸¸é‡ä¸è¢«ä»»ä½•å˜é‡æˆ–å¯¹è±¡å¼•ç”¨ï¼Œé‚£ä¹ˆè¿™äº›å¸¸é‡å°±ä¼šè¢«æ¸…é™¤æ‰ã€‚ å¦‚ä½•æ¸…é™¤åºŸå¼ƒçš„ç±» æ¸…é™¤åºŸå¼ƒç±»çš„æ¡ä»¶è¾ƒä¸ºè‹›åˆ»ï¼š è¯¥ç±»çš„æ‰€æœ‰å¯¹è±¡éƒ½å·²è¢«æ¸…é™¤ è¯¥ç±»çš„java.lang.Classå¯¹è±¡æ²¡æœ‰è¢«ä»»ä½•å¯¹è±¡æˆ–å˜é‡å¼•ç”¨ åªè¦ä¸€ä¸ªç±»è¢«è™šæ‹ŸæœºåŠ è½½è¿›æ–¹æ³•åŒºï¼Œé‚£ä¹ˆåœ¨å †ä¸­å°±ä¼šæœ‰ä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„å¯¹è±¡ï¼šjava.lang.Classã€‚è¿™ä¸ªå¯¹è±¡åœ¨ç±»è¢«åŠ è½½è¿›æ–¹æ³•åŒºçš„æ—¶å€™åˆ›å»ºï¼Œåœ¨æ–¹æ³•åŒºä¸­è¯¥ç±»è¢«åˆ é™¤æ—¶æ¸…é™¤ã€‚ åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ åƒåœ¾æ”¶é›†ç®—æ³• æ ‡è®°-æ¸…é™¤ç®—æ³• é¦–å…ˆåˆ©ç”¨åˆšæ‰ä»‹ç»çš„æ–¹æ³•åˆ¤æ–­éœ€è¦æ¸…é™¤å“ªäº›æ•°æ®ï¼Œå¹¶ç»™å®ƒä»¬åšä¸Šæ ‡è®°ï¼›ç„¶åæ¸…é™¤è¢«æ ‡è®°çš„æ•°æ®ã€‚ è¿™ç§ç®—æ³•æ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹æ•ˆç‡éƒ½å¾ˆä½ï¼Œè€Œä¸”æ¸…é™¤å®Œåå­˜åœ¨å¤§é‡ç¢ç‰‡ç©ºé—´ï¼Œå¯¼è‡´æ— æ³•å­˜å‚¨å¤§å¯¹è±¡ï¼Œé™ä½äº†ç©ºé—´åˆ©ç”¨ç‡ã€‚ å¤åˆ¶ç®—æ³• å°†å†…å­˜åˆ†æˆä¸¤ä»½ï¼Œåªå°†æ•°æ®å­˜å‚¨åœ¨å…¶ä¸­ä¸€å—ä¸Šã€‚å½“éœ€è¦å›æ”¶åƒåœ¾æ—¶ï¼Œä¹Ÿæ˜¯é¦–å…ˆæ ‡è®°å‡ºåºŸå¼ƒçš„æ•°æ®ï¼Œç„¶åå°†æœ‰ç”¨çš„æ•°æ®å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ä¸Šï¼Œæœ€åå°†ç¬¬ä¸€å—å†…å­˜å…¨éƒ¨æ¸…é™¤ã€‚ &lt;span id="inline-blue"&gt; åˆ†æï¼š&lt;/span&gt; è¿™ç§ç®—æ³•é¿å…äº†ç¢ç‰‡ç©ºé—´ï¼Œä½†å†…å­˜è¢«ç¼©å°äº†ä¸€åŠã€‚è€Œä¸”æ¯æ¬¡éƒ½éœ€è¦å°†æœ‰ç”¨çš„æ•°æ®å…¨éƒ¨å¤åˆ¶åˆ°å¦ä¸€ç‰‡å†…å­˜ä¸Šå»ï¼Œæ•ˆç‡ä¸é«˜ã€‚ &lt;span id="inline-purple"&gt; è§£å†³ç©ºé—´åˆ©ç”¨ç‡é—®é¢˜ï¼š&lt;/span&gt; åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œç”±äºå¤§é‡çš„å¯¹è±¡éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€ï¼Œä¹Ÿå°±æ˜¯ä¸€æ¬¡åƒåœ¾æ”¶é›†ååªæœ‰å°‘é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤å¯ä»¥å°†å†…å­˜åˆ’åˆ†æˆä¸‰å—ï¼šEdenã€Survior1ã€Survior2ï¼Œå†…å­˜å¤§å°åˆ†åˆ«æ˜¯8:1:1ã€‚åˆ†é…å†…å­˜æ—¶ï¼Œåªä½¿ç”¨Edenå’Œä¸€å—Survior1ã€‚å½“å‘ç°Eden+Survior1çš„å†…å­˜å³å°†æ»¡æ—¶ï¼ŒJVMä¼šå‘èµ·ä¸€æ¬¡MinorGCï¼Œæ¸…é™¤æ‰åºŸå¼ƒçš„å¯¹è±¡ï¼Œå¹¶å°†æ‰€æœ‰å­˜æ´»ä¸‹æ¥çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—Survior2ä¸­ã€‚é‚£ä¹ˆï¼Œæ¥ä¸‹æ¥å°±ä½¿ç”¨Survior2+Edenè¿›è¡Œå†…å­˜åˆ†é…ã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œåªéœ€è¦æµªè´¹10%çš„å†…å­˜ç©ºé—´å³å¯å®ç°å¸¦æœ‰å‹ç¼©åŠŸèƒ½çš„åƒåœ¾æ”¶é›†æ–¹æ³•ï¼Œé¿å…äº†å†…å­˜ç¢ç‰‡çš„é—®é¢˜ã€‚ ä½†æ˜¯ï¼Œå½“ä¸€ä¸ªå¯¹è±¡è¦ç”³è¯·å†…å­˜ç©ºé—´æ—¶ï¼Œå‘ç°Eden+Surviorä¸­å‰©ä¸‹çš„ç©ºé—´æ— æ³•æ”¾ç½®è¯¥å¯¹è±¡ï¼Œæ­¤æ—¶éœ€è¦è¿›è¡ŒMinor GCï¼Œå¦‚æœMinorGCè¿‡åç©ºé—²å‡ºæ¥çš„å†…å­˜ç©ºé—´ä»ç„¶æ— æ³•æ”¾ç½®è¯¥å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶å°±éœ€è¦å°†å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œè¿™ç§æ–¹å¼å«åšâ€œåˆ†é…æ‹…ä¿â€ã€‚ &lt;span id="inline-green"&gt; â€œåˆ†é…æ‹…ä¿â€ç­–ç•¥è¯¦è§£ &lt;/span&gt; å½“åƒåœ¾æ”¶é›†å™¨å‡†å¤‡è¦åœ¨æ–°ç”Ÿä»£å‘èµ·ä¸€æ¬¡MinorGCæ—¶ï¼Œé¦–å…ˆä¼šæ£€æŸ¥â€œè€å¹´ä»£ä¸­æœ€å¤§çš„è¿ç»­ç©ºé—²åŒºåŸŸçš„å¤§å° æ˜¯å¦å¤§äº æ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡çš„å¤§å°ï¼Ÿâ€ï¼Œä¹Ÿå°±æ˜¯è€å¹´ä»£ä¸­ç›®å‰èƒ½å¤Ÿå°†æ–°ç”Ÿä»£ä¸­æ‰€æœ‰å¯¹è±¡å…¨éƒ¨è£…ä¸‹ï¼Ÿ è‹¥è€å¹´ä»£èƒ½å¤Ÿè£…ä¸‹æ–°ç”Ÿä»£ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿›è¡ŒMinorGCæ²¡æœ‰ä»»ä½•é£é™©ï¼Œç„¶åå°±è¿›è¡ŒMinorGCã€‚ è‹¥è€å¹´ä»£æ— æ³•è£…ä¸‹æ–°ç”Ÿä»£ä¸­æ‰€æœ‰çš„å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶è¿›è¡ŒMinorGCæ˜¯æœ‰é£é™©çš„ï¼Œåƒåœ¾æ”¶é›†å™¨ä¼šè¿›è¡Œä¸€æ¬¡é¢„æµ‹ï¼šæ ¹æ®ä»¥å¾€MinorGCè¿‡åå­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°æ¥é¢„æµ‹è¿™æ¬¡MinorGCåå­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°ã€‚ å¦‚æœä»¥å¾€å­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°å°äºå½“å‰è€å¹´ä»£æœ€å¤§çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆå°±è¿›è¡ŒMinorGCï¼Œè™½ç„¶æ­¤æ¬¡MinorGCæ˜¯æœ‰é£é™©çš„ã€‚ å¦‚æœä»¥å¾€å­˜æ´»å¯¹è±¡çš„å¹³å‡æ•°å¤§äºå½“å‰è€å¹´ä»£æœ€å¤§çš„è¿ç»­ç©ºé—²ç©ºé—´ï¼Œé‚£ä¹ˆå°±å¯¹è€å¹´ä»£è¿›è¡Œä¸€æ¬¡Full GCï¼Œé€šè¿‡æ¸…é™¤è€å¹´ä»£ä¸­åºŸå¼ƒæ•°æ®æ¥æ‰©å¤§è€å¹´ä»£ç©ºé—²ç©ºé—´ï¼Œä»¥ä¾¿ç»™æ–°ç”Ÿä»£ä½œæ‹…ä¿ã€‚è¿™ä¸ªè¿‡ç¨‹å°±æ˜¯åˆ†é…æ‹…ä¿ã€‚ æ ‡è®°-æ•´ç†ç®—æ³• åœ¨å›æ”¶åƒåœ¾å‰ï¼Œé¦–å…ˆå°†æ‰€æœ‰åºŸå¼ƒçš„å¯¹è±¡åšä¸Šæ ‡è®°ï¼Œç„¶åå°†æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ç§»åˆ°ä¸€è¾¹ï¼Œæœ€åæ¸…ç©ºå¦ä¸€è¾¹åŒºåŸŸå³å¯ã€‚ &lt;span id="inline-blue"&gt; åˆ†æï¼š&lt;/span&gt; å®ƒæ˜¯ä¸€ç§è€å¹´ä»£çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚è€å¹´ä»£ä¸­çš„å¯¹è±¡ä¸€èˆ¬å¯¿å‘½æ¯”è¾ƒé•¿ï¼Œå› æ­¤æ¯æ¬¡åƒåœ¾å›æ”¶ä¼šæœ‰å¤§é‡å¯¹è±¡å­˜æ´»ï¼Œå› æ­¤å¦‚æœé€‰ç”¨â€œå¤åˆ¶â€ç®—æ³•ï¼Œæ¯æ¬¡éœ€è¦å¤åˆ¶å¤§é‡å­˜æ´»çš„å¯¹è±¡ï¼Œä¼šå¯¼è‡´æ•ˆç‡å¾ˆä½ã€‚è€Œä¸”ï¼Œåœ¨æ–°ç”Ÿä»£ä¸­ä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•ï¼Œå½“Eden+Surviorä¸­éƒ½è£…ä¸ä¸‹æŸä¸ªå¯¹è±¡æ—¶ï¼Œå¯ä»¥ä½¿ç”¨è€å¹´ä»£çš„å†…å­˜è¿›è¡Œâ€œåˆ†é…æ‹…ä¿â€ï¼Œè€Œå¦‚æœåœ¨è€å¹´ä»£ä½¿ç”¨è¯¥ç®—æ³•ï¼Œé‚£ä¹ˆåœ¨è€å¹´ä»£ä¸­å¦‚æœå‡ºç°Eden+Surviorè£…ä¸ä¸‹æŸä¸ªå¯¹è±¡æ—¶ï¼Œæ²¡æœ‰å…¶ä»–åŒºåŸŸç»™ä»–ä½œåˆ†é…æ‹…ä¿ã€‚å› æ­¤ï¼Œè€å¹´ä»£ä¸­ä¸€èˆ¬ä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚ åˆ†ä»£æ”¶é›†ç®—æ³• å°†å†…å­˜åˆ’åˆ†ä¸ºè€å¹´ä»£å’Œæ–°ç”Ÿä»£ã€‚è€å¹´ä»£ä¸­å­˜æ”¾å¯¿å‘½è¾ƒé•¿çš„å¯¹è±¡ï¼Œæ–°ç”Ÿä»£ä¸­å­˜æ”¾â€œæœç”Ÿå¤•æ­»â€çš„å¯¹è±¡ã€‚ç„¶ååœ¨ä¸åŒçš„åŒºåŸŸä½¿ç”¨ä¸åŒçš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚ åƒåœ¾å›æ”¶æµç¨‹ å¯¹äºæ•´ä¸ªGCæµç¨‹é‡Œï¼Œæœ€éœ€è¦å¤„ç†çš„å°±æ˜¯å¹´è½»ä»£å’Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†æ“ä½œï¼Œè€Œå…ƒç©ºé—´ï¼ˆæ°¸ä¹…ä»£ï¼‰éƒ½ä¸åœ¨GCèŒƒå›´å†…ï¼› å½“ç°åœ¨æœ‰ä¸€ä¸ªæ–°çš„å¯¹è±¡äº§ç”Ÿï¼Œé‚£ä¹ˆå¯¹è±¡ä¸€å®šéœ€è¦å†…å­˜ç©ºé—´ï¼Œäºæ˜¯ç°åœ¨å°±éœ€è¦ä¸ºè¯¥å¯¹è±¡è¿›è¡Œå†…å­˜ç©ºé—´çš„ç”³è¯·ã€‚ é¦–å…ˆä¼šåˆ¤æ–­ä¼Šç”¸å›­åŒºæ˜¯å¦æœ‰å†…å­˜ç©ºé—´ï¼Œå¦‚æœæ­¤æ—¶æœ‰å†…å­˜ç©ºé—´ï¼Œåˆ™å°†æ–°å¯¹è±¡ä¿å­˜åœ¨ä¼Šç”¸å›­åŒºï¼› ä½†å¦‚æœä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´ä¸è¶³ï¼Œé‚£ä¹ˆä¼šè‡ªåŠ¨æ‰§è¡Œä¸€ä¸ª Minor GC æ“ä½œï¼Œå°†ä¼Šç”¸å›­åŒºæ— ç”¨çš„å†…å­˜ç©ºé—´è¿›è¡Œæ¸…ç†ï¼Œå½“æ¸…ç†ä¹‹åä¼šç»§ç»­åˆ¤æ–­ä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Ÿå……è¶³åˆ™å°†æ–°çš„å¯¹è±¡è¿›è¡Œç©ºé—´åˆ†é…ï¼› å¦‚æœæ‰§è¡Œäº† Minor GC ä¹‹åå‘ç°ä¼Šç”¸å›­åŒºçš„å†…å­˜ä¾ç„¶ä¸è¶³ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™ä¼šè¿›è¡Œå­˜è´§åŒºåˆ¤æ–­ï¼Œå¦‚æœå­˜æ´»åŒºæœ‰å‰©ä½™ç©ºé—´ï¼Œåˆ™å°†ä¼Šç”¸å›­åŒºçš„éƒ¨åˆ†å¯¹è±¡ä¿å­˜åœ¨å­˜æ´»åŒºï¼Œé‚£ä¹ˆéšåç»§ç»­åˆ¤æ–­ä¼Šç”¸å›­åŒºçš„å†…å­˜ç©ºé—´æ˜¯å¦å……è¶³ï¼Œå¦‚ä½•å†…å­˜å……è¶³ï¼Œåˆ™åœ¨ä¼Šç”¸å›­åŒºè¿›è¡Œç©ºé—´åˆ†é…ï¼› å¦‚æœæ­¤æ—¶å­˜æ´»åŒºä¹Ÿå·²ç»æ²¡æœ‰å†…å­˜ç©ºé—´äº†ï¼Œåˆ™å¼€å§‹åˆ¤æ–­è€å¹´åŒºï¼Œå¦‚æœæ­¤æ—¶è€å¹´åŒºçš„ç©ºé—´å……è¶³ï¼Œåˆ™å°†å­˜æ´»åŒºä¸­çš„æ´»è·ƒå¯¹è±¡ä¿å­˜åœ¨è€å¹´ä»£ï¼Œè€Œåå­˜æ´»åŒºå°±ä¼šå­˜ç°æœ‰ç©ºä½™ç©ºé—´ï¼Œéšåï¼Œä¼Šç”¸å›­åŒºå°†æ´»è·ƒå¯¹è±¡ä¿å­˜åœ¨å­˜æ´»åŒºä¹‹ä¸­ï¼Œè€Œååœ¨ä¼Šç”¸å›­åŒºé‡Œä¸ºæ–°å¯¹è±¡å¼€è¾Ÿå†…å­˜ç©ºé—´ï¼› å¦‚æœè¿™ä¸ªæ—¶å€™è€å¹´ä»£ä¹Ÿæ»¡äº†ï¼Œé‚£ä¹ˆè¿™ä¸ªæ—¶å€™å°†äº§ç”Ÿ Major GC(Full GC)ï¼Œè¿›è¡Œè€å¹´ä»£çš„å†…å­˜æ¸…ç†ï¼› å¦‚æœè€å¹´ä»£æ‰§è¡Œäº† Full GC ä¹‹åï¼Œä¾ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡çš„ä¿å­˜ï¼Œå°±ä¼šäº§ç”Ÿ OOM()å¼‚å¸¸â€œOutOfMemoryErrorâ€ã€‚ Javaä¸­å¼•ç”¨çš„ç§ç±» Javaä¸­æ ¹æ®ç”Ÿå‘½å‘¨æœŸçš„é•¿çŸ­ï¼Œå°†å¼•ç”¨åˆ†ä¸º4ç±»ã€‚ å¼ºå¼•ç”¨ æˆ‘ä»¬å¹³æ—¶æ‰€ä½¿ç”¨çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ã€‚ A a = new A(); ä¹Ÿå°±æ˜¯é€šè¿‡å…³é”®å­—newåˆ›å»ºçš„å¯¹è±¡æ‰€å…³è”çš„å¼•ç”¨å°±æ˜¯å¼ºå¼•ç”¨ã€‚ åªè¦å¼ºå¼•ç”¨å­˜åœ¨ï¼Œè¯¥å¯¹è±¡æ°¸è¿œä¹Ÿä¸ä¼šè¢«å›æ”¶ã€‚ è½¯å¼•ç”¨ åªæœ‰å½“å †å³å°†å‘ç”ŸOOMå¼‚å¸¸æ—¶ï¼ŒJVMæ‰ä¼šå›æ”¶è½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡ã€‚ è½¯å¼•ç”¨é€šè¿‡SoftReferenceç±»å®ç°ã€‚ è½¯å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”å¼ºå¼•ç”¨çŸ­ä¸€äº›ã€‚ å¼±å¼•ç”¨ åªè¦åƒåœ¾æ”¶é›†å™¨è¿è¡Œï¼Œè½¯å¼•ç”¨æ‰€æŒ‡å‘çš„å¯¹è±¡å°±ä¼šè¢«å›æ”¶ã€‚ å¼±å¼•ç”¨é€šè¿‡WeakReferenceç±»å®ç°ã€‚ å¼±å¼•ç”¨çš„ç”Ÿå‘½å‘¨æœŸæ¯”è½¯å¼•ç”¨çŸ­ã€‚ è™šå¼•ç”¨ è™šå¼•ç”¨ä¹Ÿå«å¹½çµå¼•ç”¨ï¼Œå®ƒå’Œæ²¡æœ‰å¼•ç”¨æ²¡æœ‰åŒºåˆ«ï¼Œæ— æ³•é€šè¿‡è™šå¼•ç”¨è®¿é—®å¯¹è±¡çš„ä»»ä½•å±æ€§æˆ–å‡½æ•°ã€‚ ä¸€ä¸ªå¯¹è±¡å…³è”è™šå¼•ç”¨å”¯ä¸€çš„ä½œç”¨å°±æ˜¯åœ¨è¯¥å¯¹è±¡è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ä¹‹å‰ä¼šå—åˆ°ä¸€æ¡ç³»ç»Ÿé€šçŸ¥ã€‚ è™šå¼•ç”¨é€šè¿‡PhantomReferenceç±»æ¥å®ç°ã€‚ å¯¹è±¡å†…å­˜åˆ†é…ç­–ç•¥ Javaæ‰€æ‰¿è¯ºçš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚ åœ¨Javaè™šæ‹Ÿæœºçš„äº”å—å†…å­˜ç©ºé—´ä¸­ï¼Œç¨‹åºè®¡æ•°å™¨ã€Javaè™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆå†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½å…·æœ‰ç¡®å®šæ€§ï¼Œä¸€èˆ¬åœ¨ç¼–è¯‘é˜¶æ®µå°±èƒ½ç¡®å®šéœ€è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œå¹¶ä¸”ç”±äºéƒ½æ˜¯çº¿ç¨‹ç§æœ‰ï¼Œå› æ­¤å®ƒä»¬çš„å†…å­˜ç©ºé—´éƒ½éšç€çº¿ç¨‹çš„åˆ›å»ºè€Œåˆ›å»ºï¼Œçº¿ç¨‹çš„ç»“æŸè€Œå›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¿™ä¸‰ä¸ªåŒºåŸŸçš„å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½å…·æœ‰ç¡®å®šæ€§ï¼Œåƒåœ¾å›æ”¶å™¨ä¸éœ€è¦åœ¨è¿™é‡ŒèŠ±è´¹å¤ªå¤§çš„ç²¾åŠ›ã€‚ è€ŒJavaè™šæ‹Ÿæœºä¸­çš„æ–¹æ³•åŒºå› ä¸ºæ˜¯ç”¨æ¥å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ï¼Œè¿™äº›æ•°æ®çš„å˜åŠ¨æ€§è¾ƒå°ï¼Œå› æ­¤ä¸æ˜¯Javaå†…å­˜ç®¡ç†é‡ç‚¹éœ€è¦å…³æ³¨çš„åŒºåŸŸã€‚ è€Œå¯¹äºå †ï¼Œæ‰€æœ‰çº¿ç¨‹å…±äº«ï¼Œæ‰€æœ‰çš„å¯¹è±¡éƒ½éœ€è¦åœ¨å †ä¸­åˆ›å»ºå’Œå›æ”¶ã€‚è™½ç„¶æ¯ä¸ªå¯¹è±¡çš„å¤§å°åœ¨ç±»åŠ è½½çš„æ—¶å€™å°±èƒ½ç¡®å®šï¼Œä½†å¯¹è±¡çš„æ•°é‡åªæœ‰åœ¨ç¨‹åºè¿è¡ŒæœŸé—´æ‰èƒ½ç¡®å®šï¼Œå› æ­¤å †ä¸­å†…å­˜çš„åˆ†é…å…·æœ‰è¾ƒå¤§çš„ä¸ç¡®å®šæ€§ã€‚æ­¤å¤–ï¼Œå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸé•¿çŸ­ä¸ä¸€ï¼Œå› æ­¤éœ€è¦é’ˆå¯¹ä¸åŒç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡é‡‡ç”¨ä¸åŒçš„å†…å­˜å›æ”¶ç®—æ³•ï¼Œå¢åŠ äº†å†…å­˜å›æ”¶çš„å¤æ‚æ€§ã€‚ ç»¼ä¸Šæ‰€è¿°ï¼šJavaè‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯å †å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸å›æ”¶ã€‚ å¯¹è±¡ä¼˜å…ˆåœ¨EdenåŒºä¸­åˆ†é… ç›®å‰ä¸»æµçš„åƒåœ¾æ”¶é›†å™¨éƒ½ä¼šé‡‡ç”¨åˆ†ä»£å›æ”¶ç®—æ³•ï¼Œå› æ­¤éœ€è¦å°†å †å†…å­˜åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚ åœ¨æ–°ç”Ÿä»£ä¸­ä¸ºäº†é˜²æ­¢å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå› æ­¤åƒåœ¾æ”¶é›†å™¨ä¸€èˆ¬éƒ½é€‰ç”¨â€œå¤åˆ¶â€ç®—æ³•ã€‚å› æ­¤ï¼Œå †å†…å­˜çš„æ–°ç”Ÿä»£è¢«è¿›ä¸€æ­¥åˆ†ä¸ºï¼šEdenåŒºï¼‹Survior1åŒºï¼‹Survior2åŒºã€‚ æ¯æ¬¡åˆ›å»ºå¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šåœ¨EdenåŒºä¸­åˆ†é…ã€‚ è‹¥EdenåŒºå·²æ»¡ï¼Œåˆ™åœ¨Survior1åŒºä¸­åˆ†é…ã€‚ è‹¥EdenåŒºï¼‹Survior1åŒºå‰©ä½™å†…å­˜å¤ªå°‘ï¼Œå¯¼è‡´å¯¹è±¡æ— æ³•æ”¾å…¥è¯¥åŒºåŸŸæ—¶ï¼Œå°±ä¼šå¯ç”¨â€œåˆ†é…æ‹…ä¿â€ï¼Œå°†å½“å‰EdenåŒºï¼‹Survior1åŒºä¸­çš„å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­ï¼Œç„¶åå†å°†æ–°å¯¹è±¡å­˜å…¥EdenåŒºã€‚ å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ æ‰€è°“â€œå¤§å¯¹è±¡â€å°±æ˜¯æŒ‡ä¸€ä¸ªå ç”¨å¤§é‡è¿ç»­å­˜å‚¨ç©ºé—´çš„å¯¹è±¡ï¼Œå¦‚æ•°ç»„ã€‚ å½“å‘ç°ä¸€ä¸ªå¤§å¯¹è±¡åœ¨EdenåŒºï¼‹Survior1åŒºä¸­å­˜ä¸ä¸‹çš„æ—¶å€™å°±éœ€è¦åˆ†é…æ‹…ä¿æœºåˆ¶æŠŠå½“å‰EdenåŒºï¼‹Survior1åŒºçš„æ‰€æœ‰å¯¹è±¡éƒ½å¤åˆ¶åˆ°è€å¹´ä»£ä¸­å»ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œä¸€ä¸ªå¤§å¯¹è±¡èƒ½å¤Ÿå­˜å…¥EdenåŒºï¼‹Survior1åŒºçš„æ¦‚ç‡æ¯”è¾ƒå°ï¼Œå‘ç”Ÿåˆ†é…æ‹…ä¿çš„æ¦‚ç‡æ¯”è¾ƒå¤§ï¼Œè€Œåˆ†é…æ‹…ä¿éœ€è¦æ¶‰åŠåˆ°å¤§é‡çš„å¤åˆ¶ï¼Œå°±ä¼šé€ æˆæ•ˆç‡ä½ä¸‹ã€‚ å› æ­¤ï¼Œå¯¹äºå¤§å¯¹è±¡æˆ‘ä»¬ç›´æ¥æŠŠä»–æ”¾åˆ°è€å¹´ä»£ä¸­å»ï¼Œä»è€Œå°±èƒ½é¿å…å¤§é‡çš„å¤åˆ¶æ“ä½œã€‚ é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„å¯¹è±¡æ‰æ˜¯â€œå¤§å¯¹è±¡â€å‘¢ï¼Ÿ é€šè¿‡-XX:PretrnureSizeThresholdå‚æ•°è®¾ç½®å¤§å¯¹è±¡ è¯¥å‚æ•°ç”¨äºè®¾ç½®å¤§å°è¶…è¿‡è¯¥å‚æ•°çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯â€œå¤§å¯¹è±¡â€ï¼Œç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚ æ³¨æ„ï¼šè¯¥å‚æ•°åªå¯¹Serialå’ŒParNewæ”¶é›†å™¨æœ‰æ•ˆ ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ è€å¹´ä»£ç”¨äºå­˜å‚¨ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„å¹´é¾„å‘¢ï¼Ÿ æ–°ç”Ÿä»£ä¸­çš„æ¯ä¸ªå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå½“æ–°ç”Ÿä»£å‘ç”Ÿä¸€æ¬¡MinorGCåï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡çš„å¹´é¾„å°±åŠ ä¸€ï¼Œå½“å¹´é¾„è¶…è¿‡ä¸€å®šå€¼æ—¶ï¼Œå°±å°†è¶…è¿‡è¯¥å€¼çš„æ‰€æœ‰å¯¹è±¡è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ã€‚ ä½¿ç”¨-XXMaxTenuringThresholdè®¾ç½®æ–°ç”Ÿä»£çš„æœ€å¤§å¹´é¾„,è®¾ç½®è¯¥å‚æ•°åï¼Œåªè¦è¶…è¿‡è¯¥å‚æ•°çš„æ–°ç”Ÿä»£å¯¹è±¡éƒ½ä¼šè¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ã€‚ ç›¸åŒå¹´é¾„çš„å¯¹è±¡å†…å­˜è¶…è¿‡Surviorå†…å­˜ä¸€åŠçš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ å¦‚æœå½“å‰æ–°ç”Ÿä»£çš„Surviorä¸­ï¼Œå¹´é¾„ç›¸åŒçš„å¯¹è±¡çš„å†…å­˜ç©ºé—´æ€»å’Œè¶…è¿‡äº†Surviorå†…å­˜ç©ºé—´çš„ä¸€åŠï¼Œé‚£ä¹ˆæ‰€æœ‰å¹´é¾„ç›¸åŒçš„å¯¹è±¡å’Œè¶…è¿‡è¯¥å¹´é¾„çš„å¯¹è±¡éƒ½è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ã€‚æ— éœ€ç­‰åˆ°å¯¹è±¡çš„å¹´é¾„è¶…è¿‡MaxTenuringThresholdæ‰è¢«è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»ã€‚ HotSpotåƒåœ¾æ”¶é›†å™¨ &lt;font color="red"&gt; è¯´æ˜ï¼šå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿è¯´æ˜ä»–ä»¬ä¹‹é—´å¯ä»¥æ­é…ä½¿ç”¨ã€‚ &lt;/font&gt; æ–°ç”Ÿä»£åƒåœ¾æ”¶é›†å™¨ Serialåƒåœ¾æ”¶é›†å™¨ å•çº¿ç¨‹ åªå¼€å¯ä¸€æ¡GCçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå¹¶ä¸”åœ¨åƒåœ¾å›æ”¶è¿‡ç¨‹ä¸­åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œä»è€Œç”¨æˆ·çš„è¯·æ±‚æˆ–å›¾å½¢åŒ–ç•Œé¢ä¼šå‡ºç°å¡é¡¿ã€‚ é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ ä¸€èˆ¬å®¢æˆ·ç«¯åº”ç”¨æ‰€éœ€å†…å­˜è¾ƒå°ï¼Œä¸ä¼šåˆ›å»ºå¤ªå¤šçš„å¯¹è±¡ï¼Œè€Œä¸”å †å†…å­˜ä¸å¤§ï¼Œå› æ­¤åƒåœ¾å›æ”¶æ—¶é—´æ¯”è¾ƒçŸ­ï¼Œå³ä½¿åœ¨è¿™æ®µæ—¶é—´åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿå—åˆ°æ˜æ˜¾çš„åœé¡¿ï¼Œå› æ­¤æœ¬åƒåœ¾æ”¶é›†å™¨é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ã€‚ ç®€å•é«˜æ•ˆ ç”±äºSerialæ”¶é›†å™¨åªæœ‰ä¸€æ¡GCçº¿ç¨‹ï¼Œå› æ­¤é¿å…äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ï¼Œä»è€Œç®€å•é«˜æ•ˆã€‚ é‡‡ç”¨â€œå¤åˆ¶â€ç®—æ³• ParNewåƒåœ¾æ”¶é›†å™¨ ParNewæ˜¯Serialçš„å¤šçº¿ç¨‹ç‰ˆæœ¬ã€‚ å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œ ParNewç”±å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œåœ°è¿›è¡Œåƒåœ¾æ¸…ç†ã€‚ä½†æ¸…ç†è¿‡ç¨‹ä»ç„¶éœ€è¦åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ã€‚ä½†ç”±äºæœ‰å¤šæ¡GCçº¿ç¨‹åŒæ—¶æ¸…ç†ï¼Œæ¸…ç†é€Ÿåº¦æ¯”Serialæœ‰ä¸€å®šçš„æå‡ã€‚ é€‚åˆå¤šCPUçš„æœåŠ¡å™¨ç¯å¢ƒ ç”±äºä½¿ç”¨äº†å¤šçº¿ç¨‹ï¼Œå› æ­¤é€‚åˆCPUè¾ƒå¤šçš„æœåŠ¡å™¨ç¯å¢ƒã€‚ ä¸Serialæ€§èƒ½å¯¹æ¯” ParNewå’ŒSerialå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ä½¿ç”¨äº†å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œåœ¨å¤šCPUçš„ç¯å¢ƒä¸‹æ€§èƒ½æ¯”Serialä¼šæœ‰ä¸€å®šç¨‹åº¦çš„æå‡ï¼›ä½†çº¿ç¨‹åˆ‡æ¢éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åœ¨å•CPUç¯å¢ƒä¸­è¡¨ç°ä¸å¦‚Serialã€‚ é‡‡ç”¨â€œå¤åˆ¶â€ç®—æ³• è¿½æ±‚â€œé™ä½åœé¡¿æ—¶é—´â€ å’ŒSerialç›¸æ¯”ï¼ŒParNewä½¿ç”¨å¤šçº¿ç¨‹çš„ç›®çš„å°±æ˜¯ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶é—´ï¼Œä»è€Œå‡å°‘ç”¨æˆ·çº¿ç¨‹è¢«åœé¡¿çš„æ—¶é—´ã€‚ &lt;p id="div-border-left-red"&gt; å¹¶è¡Œ(Parallel)ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œæ­¤æ—¶ç”¨æˆ·çº¿ç¨‹å¤„äºç­‰å¾…çŠ¶æ€ã€‚ &lt;/p&gt; &lt;p id="div-border-left-red"&gt; å¹¶å‘(Concurrent)ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹å’Œåƒåœ¾å›æ”¶çº¿ç¨‹åŒæ—¶æ‰§è¡Œ(ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œæœ‰å¯èƒ½æ˜¯äº¤å‰æ‰§è¡Œ)ï¼Œç”¨æˆ·è¿›ç¨‹åœ¨è¿è¡Œï¼Œè€Œåƒåœ¾å›æ”¶çº¿ç¨‹åœ¨å¦ä¸€ä¸ª CPU ä¸Šè¿è¡Œã€‚ &lt;/p&gt; Parallel Scavengeåƒåœ¾æ”¶é›†å™¨ Parallel Scavengeå’ŒParNewä¸€æ ·éƒ½æ˜¯å¤šçº¿ç¨‹ã€æ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œéƒ½ä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•è¿›è¡Œåƒåœ¾å›æ”¶ã€‚ä½†å®ƒä»¬æœ‰ä¸ªå·¨å¤§çš„ä¸åŒç‚¹ï¼šParNewæ”¶é›†å™¨è¿½æ±‚é™ä½ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œå› æ­¤é€‚åˆäº¤äº’å¼åº”ç”¨ï¼›è€ŒParallel Scavengeè¿½æ±‚CPUååé‡ï¼Œèƒ½å¤Ÿåœ¨è¾ƒçŸ­çš„æ—¶é—´å†…å®ŒæˆæŒ‡å®šä»»åŠ¡ï¼Œå› æ­¤é€‚åˆæ²¡æœ‰äº¤äº’çš„åå°è®¡ç®—ã€‚ ä»€ä¹ˆæ˜¯â€œååé‡â€ï¼Ÿ ååé‡æ˜¯æŒ‡ç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´å CPUæ€»æ—¶é—´çš„æ¯”ä¾‹ã€‚ CPUæ€»æ—¶é—´åŒ…æ‹¬ï¼šç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´ å’Œ GCçº¿ç¨‹è¿è¡Œçš„æ—¶é—´ã€‚ å› æ­¤ï¼Œååé‡è¶Šé«˜è¡¨ç¤ºç”¨æˆ·çº¿ç¨‹è¿è¡Œæ—¶é—´è¶Šé•¿ï¼Œä»è€Œç”¨æˆ·çº¿ç¨‹èƒ½å¤Ÿè¢«å¿«é€Ÿå¤„ç†å®Œã€‚ é™ä½åœé¡¿æ—¶é—´çš„ä¸¤ç§æ–¹å¼ åœ¨å¤šCPUç¯å¢ƒä¸­ä½¿ç”¨å¤šæ¡GCçº¿ç¨‹ï¼Œä»è€Œåƒåœ¾å›æ”¶çš„æ—¶é—´å‡å°‘ï¼Œä»è€Œç”¨æˆ·çº¿ç¨‹åœé¡¿çš„æ—¶é—´ä¹Ÿå‡å°‘ï¼› å®ç°GCçº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ‰€è°“å¹¶å‘ï¼Œå°±æ˜¯ç”¨æˆ·çº¿ç¨‹ä¸GCçº¿ç¨‹äº¤æ›¿æ‰§è¡Œï¼Œä»è€Œæ¯æ¬¡åœé¡¿çš„æ—¶é—´ä¼šå‡å°‘ï¼Œç”¨æˆ·æ„Ÿå—åˆ°çš„åœé¡¿æ„Ÿé™ä½ï¼Œä½†çº¿ç¨‹ä¹‹é—´ä¸æ–­åˆ‡æ¢æ„å‘³ç€éœ€è¦é¢å¤–çš„å¼€é”€ï¼Œä»è€Œåƒåœ¾å›æ”¶å’Œç”¨æˆ·çº¿ç¨‹çš„æ€»æ—¶é—´å°†ä¼šå»¶é•¿ã€‚ Parallel Scavengeæä¾›çš„å‚æ•° è®¾ç½®â€œååé‡â€ï¼šé€šè¿‡å‚æ•°-XX:GCTimeRadioè®¾ç½®åƒåœ¾å›æ”¶æ—¶é—´å æ€»CPUæ—¶é—´çš„ç™¾åˆ†æ¯”ã€‚ è®¾ç½®â€œåœé¡¿æ—¶é—´â€ï¼šé€šè¿‡å‚æ•°-XX:MaxGCPauseMillisè®¾ç½®åƒåœ¾å¤„ç†è¿‡ç¨‹æœ€ä¹…åœé¡¿æ—¶é—´ã€‚Parallel Scavengeä¼šæ ¹æ®è¿™ä¸ªå€¼çš„å¤§å°ç¡®å®šæ–°ç”Ÿä»£çš„å¤§å°ã€‚å¦‚æœè¿™ä¸ªå€¼è¶Šå°ï¼Œæ–°ç”Ÿä»£å°±ä¼šè¶Šå°ï¼Œä»è€Œæ”¶é›†å™¨å°±èƒ½ä»¥è¾ƒçŸ­çš„æ—¶é—´è¿›è¡Œä¸€æ¬¡å›æ”¶ã€‚ä½†æ–°ç”Ÿä»£å˜å°åï¼Œå›æ”¶çš„é¢‘ç‡å°±ä¼šæé«˜ï¼Œå› æ­¤è¦åˆç†æ§åˆ¶è¿™ä¸ªå€¼ã€‚ å¯ç”¨è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼šé€šè¿‡å‘½ä»¤-XX:+UseAdaptiveSizePolicyå°±èƒ½å¼€å¯è‡ªé€‚åº”ç­–ç•¥ã€‚æˆ‘ä»¬åªè¦è®¾ç½®å¥½å †çš„å¤§å°å’ŒMaxGCPauseMillisæˆ–GCTimeRadioï¼Œæ”¶é›†å™¨ä¼šè‡ªåŠ¨è°ƒæ•´æ–°ç”Ÿä»£çš„å¤§å°ã€Edenå’ŒSurviorçš„æ¯”ä¾‹ã€å¯¹è±¡è¿›å…¥è€å¹´ä»£çš„å¹´é¾„ï¼Œä»¥æœ€å¤§ç¨‹åº¦ä¸Šæ¥è¿‘æˆ‘ä»¬è®¾ç½®çš„MaxGCPauseMillisæˆ–GCTimeRadioã€‚ è€å¹´ä»£åƒåœ¾æ”¶é›†å™¨ Serial Oldåƒåœ¾æ”¶é›†å™¨ Serial Oldæ”¶é›†å™¨æ˜¯Serialçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒä»¬éƒ½æ˜¯å•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä¹Ÿå°±æ˜¯åƒåœ¾æ”¶é›†æ—¶åªå¯åŠ¨ä¸€æ¡GCçº¿ç¨‹ï¼Œå› æ­¤éƒ½é€‚åˆå®¢æˆ·ç«¯åº”ç”¨ã€‚ å®ƒä»¬å”¯ä¸€çš„åŒºåˆ«å°±æ˜¯Serial Oldå·¥ä½œåœ¨è€å¹´ä»£ï¼Œä½¿ç”¨â€œæ ‡è®°-æ•´ç†â€ç®—æ³•ï¼›è€ŒSerialå·¥ä½œåœ¨æ–°ç”Ÿä»£ï¼Œä½¿ç”¨â€œå¤åˆ¶â€ç®—æ³•ã€‚ Parallel Oldåƒåœ¾æ”¶é›†å™¨ Parallel Oldæ”¶é›†å™¨æ˜¯Parallel Scavengeçš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä¸€èˆ¬å®ƒä»¬æ­é…ä½¿ç”¨ï¼Œè¿½æ±‚CPUååé‡ã€‚ å®ƒä»¬åœ¨åƒåœ¾æ”¶é›†æ—¶éƒ½æ˜¯ç”±å¤šæ¡GCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ã€‚å› æ­¤ï¼Œç”±äºåœ¨åƒåœ¾æ¸…ç†è¿‡ç¨‹ä¸­æ²¡æœ‰ä½¿åƒåœ¾æ”¶é›†å’Œç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤å®ƒä»¬æ˜¯è¿½æ±‚ååé‡çš„åƒåœ¾æ”¶é›†å™¨ã€‚ CMSåƒåœ¾æ”¶é›†å™¨ CMSæ”¶é›†å™¨æ˜¯ä¸€æ¬¾è¿½æ±‚åœé¡¿æ—¶é—´çš„è€å¹´ä»£æ”¶é›†å™¨ï¼Œå®ƒåœ¨åƒåœ¾æ”¶é›†æ—¶ä½¿å¾—ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå› æ­¤åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­ç”¨æˆ·ä¹Ÿä¸ä¼šæ„Ÿå—åˆ°æ˜æ˜¾çš„å¡é¡¿ã€‚ä½†ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹ä¹‹é—´ä¸åœåœ°åˆ‡æ¢ä¼šæœ‰é¢å¤–çš„å¼€é”€ï¼Œå› æ­¤åƒåœ¾å›æ”¶æ€»æ—¶é—´å°±ä¼šè¢«å»¶é•¿ã€‚ å›æ”¶è¿‡ç¨‹ åˆå§‹æ ‡è®° åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œä»…ä½¿ç”¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹å¯¹æ‰€æœ‰ä¸GC ROOTSç›´æ¥å…³è”çš„å¯¹è±¡è¿›è¡Œæ ‡è®°ã€‚é€Ÿåº¦å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®° ä½¿ç”¨å¤šæ¡å¹¶å‘æ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå¹¶ä¸ç”¨æˆ·çº¿ç¨‹å¹¶å‘æ‰§è¡Œã€‚æ­¤è¿‡ç¨‹è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ ‡è®°å‡ºæ‰€æœ‰åºŸå¼ƒçš„å¯¹è±¡ã€‚é€Ÿåº¦å¾ˆæ…¢ã€‚ é‡æ–°æ ‡è®° åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡é‡æ–°æ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œå°†åˆšæ‰å¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­æ–°å‡ºç°çš„åºŸå¼ƒå¯¹è±¡æ ‡è®°å‡ºæ¥ã€‚è¿™ä¸ªè¿‡ç¨‹çš„è¿è¡Œæ—¶é—´ä»‹äºåˆå§‹æ ‡è®°å’Œå¹¶å‘æ ‡è®°ä¹‹é—´ã€‚ å¹¶å‘æ¸…é™¤ åªä½¿ç”¨ä¸€æ¡å¹¶å‘æ¸…é™¤çº¿ç¨‹ï¼Œå’Œç”¨æˆ·çº¿ç¨‹ä»¬å¹¶å‘æ‰§è¡Œï¼Œæ¸…é™¤åˆšæ‰æ ‡è®°çš„å¯¹è±¡ã€‚è¿™ä¸ªè¿‡ç¨‹éå¸¸è€—æ—¶ã€‚ CMSçš„ç¼ºç‚¹ ååé‡ä½ ç”±äºCMSåœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä½¿ç”¨ç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œä»è€Œçº¿ç¨‹åˆ‡æ¢ä¼šæœ‰é¢å¤–å¼€é”€ï¼Œå› æ­¤CPUååé‡å°±ä¸å¦‚åœ¨åƒåœ¾æ”¶é›†è¿‡ç¨‹ä¸­åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹çš„æ–¹å¼æ¥çš„é«˜ã€‚ æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯¼è‡´é¢‘ç¹Full GC ç”±äºåƒåœ¾æ¸…é™¤è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹å’ŒGCçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯ç”¨æˆ·çº¿ç¨‹ä»åœ¨æ‰§è¡Œï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šäº§ç”Ÿåƒåœ¾ï¼Œè¿™äº›åƒåœ¾ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚ å¦‚æœCMSåœ¨åƒåœ¾æ¸…ç†è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·çº¿ç¨‹éœ€è¦åœ¨è€å¹´ä»£ä¸­åˆ†é…å†…å­˜æ—¶å‘ç°ç©ºé—´ä¸è¶³æ—¶ï¼Œå°±éœ€è¦å†æ¬¡å‘èµ·Full GCï¼Œè€Œæ­¤æ—¶CMSæ­£åœ¨è¿›è¡Œæ¸…é™¤å·¥ä½œï¼Œå› æ­¤æ­¤æ—¶åªèƒ½ç”±Serial Oldä¸´æ—¶å¯¹è€å¹´ä»£è¿›è¡Œä¸€æ¬¡Full GCã€‚ ä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•äº§ç”Ÿç¢ç‰‡ç©ºé—´ ç”±äºCMSä½¿ç”¨äº†â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ï¼Œ å› æ­¤æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡çš„ç¢ç‰‡ç©ºé—´ï¼Œä¸åˆ©äºç©ºé—´åˆ©ç”¨ç‡ã€‚ä¸è¿‡CMSæä¾›äº†åº”å¯¹ç­–ç•¥ï¼š å¼€å¯-XX:+UseCMSCompactAtFullCollection å¼€å¯è¯¥å‚æ•°åï¼Œæ¯æ¬¡FullGCå®Œæˆåéƒ½ä¼šè¿›è¡Œä¸€æ¬¡å†…å­˜å‹ç¼©æ•´ç†ï¼Œå°†é›¶æ•£åœ¨å„å¤„çš„å¯¹è±¡æ•´ç†åˆ°ä¸€å—å„¿ã€‚ä½†æ¯æ¬¡éƒ½æ•´ç†æ•ˆç‡ä¸é«˜ï¼Œå› æ­¤æä¾›äº†ä»¥ä¸‹å‚æ•°ã€‚ è®¾ç½®å‚æ•°-XX:CMSFullGCsBeforeCompaction æœ¬å‚æ•°å‘Šè¯‰CMSï¼Œç»è¿‡äº†Næ¬¡Full GCè¿‡åå†è¿›è¡Œä¸€æ¬¡å†…å­˜æ•´ç†ã€‚ é€šç”¨åƒåœ¾æ”¶é›†å™¨--G1åƒåœ¾æ”¶é›†å™¨ G1çš„ç‰¹ç‚¹ è¿½æ±‚åœé¡¿æ—¶é—´ å¤šçº¿ç¨‹GC é¢å‘æœåŠ¡ç«¯åº”ç”¨ æ ‡è®°-æ•´ç†å’Œå¤åˆ¶ç®—æ³•åˆå¹¶ä¸ä¼šäº§ç”Ÿç¢ç‰‡å†…å­˜ã€‚ å¯å¯¹æ•´ä¸ªå †è¿›è¡Œåƒåœ¾å›æ”¶ å¯é¢„æµ‹åœé¡¿æ—¶é—´ G1çš„å†…å­˜æ¨¡å‹ G1åƒåœ¾æ”¶é›†å™¨æ²¡æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µäº†ï¼Œè€Œæ˜¯å°†å †åˆ’åˆ†ä¸ºä¸€å—å—ç‹¬ç«‹çš„Regionã€‚å½“è¦è¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œé¦–å…ˆä¼°è®¡æ¯ä¸ªRegionä¸­çš„åƒåœ¾æ•°é‡ï¼Œæ¯æ¬¡éƒ½ä»åƒåœ¾å›æ”¶ä»·å€¼æœ€å¤§çš„Regionå¼€å§‹å›æ”¶ï¼Œå› æ­¤å¯ä»¥è·å¾—æœ€å¤§çš„å›æ”¶æ•ˆç‡ã€‚ Remembered Set ä¸€ä¸ªå¯¹è±¡å’Œå®ƒå†…éƒ¨æ‰€å¼•ç”¨çš„å¯¹è±¡å¯èƒ½ä¸åœ¨åŒä¸€ä¸ªRegionä¸­ï¼Œé‚£ä¹ˆå½“åƒåœ¾å›æ”¶æ—¶ï¼Œæ˜¯å¦éœ€è¦æ‰«ææ•´ä¸ªå †å†…å­˜æ‰èƒ½å®Œæ•´åœ°è¿›è¡Œä¸€æ¬¡å¯è¾¾æ€§åˆ†æï¼Ÿ å½“ç„¶ä¸æ˜¯ï¼Œæ¯ä¸ªRegionéƒ½æœ‰ä¸€ä¸ªRemembered Setï¼Œç”¨äºè®°å½•æœ¬åŒºåŸŸä¸­æ‰€æœ‰å¯¹è±¡å¼•ç”¨çš„å¯¹è±¡æ‰€åœ¨çš„åŒºåŸŸï¼Œä»è€Œåœ¨è¿›è¡Œå¯è¾¾æ€§åˆ†ææ—¶ï¼Œåªè¦åœ¨GC ROOTsä¸­å†åŠ ä¸ŠRemembered Setå³å¯é˜²æ­¢å¯¹æ‰€æœ‰å †å†…å­˜çš„éå†ã€‚ G1åƒåœ¾æ”¶é›†è¿‡ç¨‹ åˆå§‹æ ‡è®° æ ‡è®°ä¸GC ROOTSç›´æ¥å…³è”çš„å¯¹è±¡ï¼Œåœæ­¢æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œåªå¯åŠ¨ä¸€æ¡åˆå§‹æ ‡è®°çº¿ç¨‹ï¼Œè¿™ä¸ªè¿‡ç¨‹å¾ˆå¿«ã€‚ å¹¶å‘æ ‡è®° è¿›è¡Œå…¨é¢çš„å¯è¾¾æ€§åˆ†æï¼Œå¼€å¯ä¸€æ¡å¹¶å‘æ ‡è®°çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚è¿™ä¸ªè¿‡ç¨‹æ¯”è¾ƒé•¿ã€‚ æœ€ç»ˆæ ‡è®° æ ‡è®°å‡ºå¹¶å‘æ ‡è®°è¿‡ç¨‹ä¸­ç”¨æˆ·çº¿ç¨‹æ–°äº§ç”Ÿçš„åƒåœ¾ã€‚åœæ­¢æ‰€æœ‰ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡æœ€ç»ˆæ ‡è®°çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ ç­›é€‰å›æ”¶ å›æ”¶åºŸå¼ƒçš„å¯¹è±¡ã€‚æ­¤æ—¶ä¹Ÿéœ€è¦åœæ­¢ä¸€åˆ‡ç”¨æˆ·çº¿ç¨‹ï¼Œå¹¶ä½¿ç”¨å¤šæ¡ç­›é€‰å›æ”¶çº¿ç¨‹å¹¶è¡Œæ‰§è¡Œã€‚ Classæ–‡ä»¶ç»“æ„ ä»€ä¹ˆæ˜¯JVMçš„â€œæ— å…³æ€§â€ Javaå…·æœ‰å¹³å°æ— å…³æ€§ï¼Œä¹Ÿå°±æ˜¯ä»»ä½•æ“ä½œç³»ç»Ÿéƒ½èƒ½è¿è¡ŒJavaä»£ç ã€‚ä¹‹æ‰€ä»¥èƒ½å®ç°è¿™ä¸€ç‚¹ï¼Œæ˜¯å› ä¸ºJavaè¿è¡Œåœ¨è™šæ‹Ÿæœºä¹‹ä¸Šï¼Œä¸åŒçš„æ“ä½œç³»ç»Ÿéƒ½æ‹¥æœ‰å„è‡ªçš„Javaè™šæ‹Ÿæœºï¼Œå› æ­¤Javaèƒ½å®ç°â€œä¸€æ¬¡ç¼–å†™ï¼Œå¤„å¤„è¿è¡Œâ€ã€‚ è€ŒJVMä¸ä»…å…·æœ‰å¹³å°æ— å…³æ€§ï¼Œè¿˜å…·æœ‰è¯­è¨€æ— å…³æ€§ã€‚ å¹³å°æ— å…³æ€§æ˜¯æŒ‡ä¸åŒæ“ä½œç³»ç»Ÿéƒ½æœ‰å„è‡ªçš„JVMï¼Œè€Œè¯­è¨€æ— å…³æ€§æ˜¯æŒ‡Javaè™šæ‹Ÿæœºèƒ½è¿è¡Œé™¤Javaä»¥å¤–çš„ä»£ç ï¼ è¿™å¬èµ·æ¥éå¸¸æƒŠäººï¼Œä½†JVMå¯¹èƒ½è¿è¡Œçš„è¯­è¨€æ˜¯æœ‰ä¸¥æ ¼è¦æ±‚çš„ã€‚é¦–å…ˆæ¥äº†è§£ä¸‹Javaä»£ç çš„è¿è¡Œè¿‡ç¨‹ã€‚ Javaæºä»£ç é¦–å…ˆéœ€è¦ä½¿ç”¨Javacç¼–è¯‘å™¨ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åå¯åŠ¨JVMæ‰§è¡Œclassæ–‡ä»¶ï¼Œä»è€Œç¨‹åºå¼€å§‹è¿è¡Œã€‚ ä¹Ÿå°±æ˜¯JVMåªè®¤è¯†classæ–‡ä»¶ï¼Œå®ƒå¹¶ä¸ç®¡ä½•ç§è¯­è¨€ç”Ÿæˆäº†classæ–‡ä»¶ï¼Œåªè¦classæ–‡ä»¶ç¬¦åˆJVMçš„è§„èŒƒå°±èƒ½è¿è¡Œã€‚ å› æ­¤ç›®å‰å·²ç»æœ‰Scalaã€JRubyã€Jythonç­‰è¯­è¨€èƒ½å¤Ÿåœ¨JVMä¸Šè¿è¡Œã€‚å®ƒä»¬æœ‰å„è‡ªçš„è¯­æ³•è§„åˆ™ï¼Œä¸è¿‡å®ƒä»¬çš„ç¼–è¯‘å™¨éƒ½èƒ½å°†å„è‡ªçš„æºç ç¼–è¯‘æˆç¬¦åˆJVMè§„èŒƒçš„classæ–‡ä»¶ï¼Œä»è€Œèƒ½å¤Ÿå€ŸåŠ©JVMè¿è¡Œå®ƒä»¬ã€‚ Classæ–‡ä»¶åŸºæœ¬ç»„ç»‡ç»“æ„ classæ–‡ä»¶æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå®ƒçš„å†…å®¹å…·æœ‰ä¸¥æ ¼çš„è§„èŒƒï¼Œæ–‡ä»¶ä¸­æ²¡æœ‰ä»»ä½•ç©ºæ ¼ï¼Œå…¨æ˜¯è¿ç»­çš„0/1ã€‚classæ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹è¢«åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šæ— ç¬¦å·æ•° å’Œ è¡¨ã€‚ æ— ç¬¦å·æ•° å®ƒè¡¨ç¤ºclassæ–‡ä»¶ä¸­çš„å€¼ï¼Œè¿™äº›å€¼æ²¡æœ‰ä»»ä½•ç±»å‹ï¼Œä½†æœ‰ä¸åŒçš„é•¿åº¦ã€‚æ ¹æ®è¿™äº›å€¼é•¿åº¦çš„ä¸åŒåˆ†ä¸ºï¼šu1ã€u2ã€u4ã€u8ï¼Œåˆ†åˆ«ä»£è¡¨1å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€2å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€4å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€8å­—èŠ‚çš„æ— ç¬¦å·æ•°ã€‚ è¡¨ classæ–‡ä»¶ä¸­æ‰€æœ‰æ•°æ®(å³æ— ç¬¦å·æ•°)è¦ä¹ˆå•ç‹¬å­˜åœ¨ï¼Œè¦ä¹ˆç”±å¤šä¸ªæ— ç¬¦å·æ•°ç»„æˆäºŒç»´è¡¨ã€‚å³classæ–‡ä»¶ä¸­çš„æ•°æ®è¦ä¹ˆæ˜¯å•ä¸ªå€¼ï¼Œè¦ä¹ˆæ˜¯äºŒç»´è¡¨ã€‚ é­”æ•°(magic) æ‰€æœ‰çš„ç”±Javaç¼–è¯‘å™¨ç¼–è¯‘è€Œæˆçš„classæ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚éƒ½æ˜¯â€œ0xCAFEBABEâ€ &nbsp; å®ƒçš„ä½œç”¨åœ¨äºï¼šå½“JVMåœ¨å°è¯•åŠ è½½æŸä¸ªæ–‡ä»¶åˆ°å†…å­˜ä¸­æ¥çš„æ—¶å€™ï¼Œä¼šé¦–å…ˆåˆ¤æ–­æ­¤classæ–‡ä»¶æœ‰æ²¡æœ‰JVMè®¤ä¸ºå¯ä»¥æ¥å—çš„â€œç­¾åâ€ï¼Œå³JVMä¼šé¦–å…ˆè¯»å–æ–‡ä»¶çš„å‰4ä¸ªå­—èŠ‚ï¼Œåˆ¤æ–­è¯¥4ä¸ªå­—èŠ‚æ˜¯å¦æ˜¯â€œ0xCAFEBABEâ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™JVMä¼šè®¤ä¸ºå¯ä»¥å°†æ­¤æ–‡ä»¶å½“ä½œclassæ–‡ä»¶æ¥åŠ è½½å¹¶ä½¿ç”¨ã€‚ ç‰ˆæœ¬å·(minor_version,major_version) ç´§æ¥ç€é­”æ•°çš„4ä¸ªå­—èŠ‚æ˜¯ç‰ˆæœ¬å·ã€‚å®ƒè¡¨ç¤ºæœ¬classä¸­ä½¿ç”¨çš„æ˜¯å“ªä¸ªç‰ˆæœ¬çš„JDKã€‚ ä¸»ç‰ˆæœ¬å·å’Œæ¬¡ç‰ˆæœ¬å·åœ¨classæ–‡ä»¶ä¸­å„å ä¸¤ä¸ªå­—èŠ‚ï¼Œå‰¯ç‰ˆæœ¬å·å ç”¨ç¬¬5ã€6ä¸¤ä¸ªå­—èŠ‚ï¼Œè€Œä¸»ç‰ˆæœ¬å·åˆ™å ç”¨ç¬¬7ï¼Œ8ä¸¤ä¸ªå­—èŠ‚ã€‚JDK1.0çš„ä¸»ç‰ˆæœ¬å·ä¸º45ï¼Œä»¥åçš„æ¯ä¸ªæ–°ä¸»ç‰ˆæœ¬éƒ½ä¼šåœ¨åŸå…ˆç‰ˆæœ¬çš„åŸºç¡€ä¸ŠåŠ 1ã€‚è‹¥ç°åœ¨ä½¿ç”¨çš„æ˜¯JDK1.7ç¼–è¯‘å‡ºæ¥çš„classæ–‡ä»¶ï¼Œåˆ™ç›¸åº”çš„ä¸»ç‰ˆæœ¬å·åº”è¯¥æ˜¯51,å¯¹åº”çš„7ï¼Œ8ä¸ªå­—èŠ‚çš„åå…­è¿›åˆ¶çš„å€¼åº”è¯¥æ˜¯ 0x33ã€‚ ä¸€ä¸ª JVMå®ä¾‹åªèƒ½æ”¯æŒç‰¹å®šèŒƒå›´å†…çš„ä¸»ç‰ˆæœ¬å· ï¼ˆMi è‡³Mjï¼‰ å’Œ 0 è‡³ç‰¹å®šèŒƒå›´å†… ï¼ˆ0 è‡³ mï¼‰ çš„å‰¯ç‰ˆæœ¬å·ã€‚å‡è®¾ä¸€ä¸ª Class æ–‡ä»¶çš„æ ¼å¼ç‰ˆæœ¬å·ä¸º Vï¼Œ ä»…å½“Mi.0 â‰¤ v â‰¤ Mj.mæˆç«‹æ—¶ï¼Œè¿™ä¸ª Class æ–‡ä»¶æ‰å¯ä»¥è¢«æ­¤ Java è™šæ‹Ÿæœºæ”¯æŒã€‚ä¸åŒç‰ˆæœ¬çš„ Java è™šæ‹Ÿæœºå®ç°æ”¯æŒçš„ç‰ˆæœ¬å·ä¹Ÿä¸åŒï¼Œé«˜ç‰ˆæœ¬å·çš„ Java è™šæ‹Ÿæœºå®ç°å¯ä»¥æ”¯æŒä½ç‰ˆæœ¬å·çš„ Class æ–‡ä»¶ï¼Œåä¹‹åˆ™ä¸æˆç«‹ã€‚ JVMåœ¨åŠ è½½classæ–‡ä»¶çš„æ—¶å€™ï¼Œä¼šè¯»å–å‡ºä¸»ç‰ˆæœ¬å·ï¼Œç„¶åæ¯”è¾ƒè¿™ä¸ªclassæ–‡ä»¶çš„ä¸»ç‰ˆæœ¬å·å’ŒJVMæœ¬èº«çš„ç‰ˆæœ¬å·ï¼Œå¦‚æœJVMæœ¬èº«çš„ç‰ˆæœ¬å· &lt; classæ–‡ä»¶çš„ç‰ˆæœ¬å·ï¼ŒJVMä¼šè®¤ä¸ºåŠ è½½ä¸äº†è¿™ä¸ªclassæ–‡ä»¶ï¼Œä¼šæŠ›å‡ºæˆ‘ä»¬ç»å¸¸è§åˆ°çš„"java.lang.UnsupportedClassVersionError: Bad version number in .class file " Error é”™è¯¯ï¼›åä¹‹ï¼ŒJVMä¼šè®¤ä¸ºå¯ä»¥åŠ è½½æ­¤classæ–‡ä»¶ï¼Œç»§ç»­åŠ è½½æ­¤classæ–‡ä»¶ã€‚ å¸¸é‡æ± (constant_pool) ä»€ä¹ˆæ˜¯å¸¸é‡æ±  ç´§æ¥ç€ç‰ˆæœ¬å·ä¹‹åçš„å°±æ˜¯å¸¸é‡æ± ã€‚å¸¸é‡æ± ä¸­å­˜æ”¾ä¸¤ç§ç±»å‹çš„å¸¸é‡ï¼š å­—é¢å€¼å¸¸é‡ å­—é¢å€¼å¸¸é‡å³æˆ‘ä»¬åœ¨ç¨‹åºä¸­å®šä¹‰çš„å­—ç¬¦ä¸²ã€è¢«finalä¿®é¥°çš„å€¼ã€‚ ç¬¦å·å¼•ç”¨ ç¬¦å·å¼•ç”¨å°±æ˜¯æˆ‘ä»¬å®šä¹‰çš„å„ç§åå­—ï¼š ç±»å’Œæ¥å£çš„å…¨é™å®šå å­—æ®µçš„åå­— å’Œ æè¿°ç¬¦ æ–¹æ³•çš„åå­— å’Œ æè¿°ç¬¦ å¸¸é‡æ± çš„ç‰¹ç‚¹ å¸¸é‡æ± é•¿åº¦ä¸å›ºå®š å¸¸é‡æ± çš„å¤§å°æ˜¯ä¸å›ºå®šçš„ï¼Œå› æ­¤å¸¸é‡æ± å¼€å¤´æ”¾ç½®ä¸€ä¸ªu2ç±»å‹çš„æ— ç¬¦å·æ•°ï¼Œç”¨æ¥å­˜å‚¨å½“å‰å¸¸é‡æ± çš„å®¹é‡ã€‚JVMæ ¹æ®è¿™ä¸ªå€¼å°±çŸ¥é“å¸¸é‡æ± çš„å¤´å°¾æ¥ã€‚ æ³¨ï¼šè¿™ä¸ªå€¼æ˜¯ä»1å¼€å§‹çš„ï¼Œè‹¥ä¸º5è¡¨ç¤ºæ± ä¸­æœ‰4ä¸ªå¸¸é‡ã€‚ å¸¸é‡æ± ä¸­çš„å¸¸é‡ç”±è€Œä¸ºè¡¨æ¥è¡¨ç¤º å¸¸é‡æ± å¼€å¤´æœ‰ä¸ªå¸¸é‡æ± å®¹é‡è®¡æ•°å™¨ï¼Œæ¥ä¸‹æ¥å°±å…¨æ˜¯ä¸€ä¸ªä¸ªå¸¸é‡äº†ï¼Œåªä¸è¿‡å¸¸é‡éƒ½æ˜¯ç”±ä¸€å¼ å¼ äºŒç»´è¡¨æ„æˆï¼Œé™¤äº†è®°å½•å¸¸é‡çš„å€¼ä»¥å¤–ï¼Œè¿˜è®°å½•å½“å‰å¸¸é‡çš„ç›¸å…³ä¿¡æ¯ã€‚ å¸¸é‡æ± æ˜¯classæ–‡ä»¶çš„èµ„æºä»“åº“ å¸¸é‡æ± æ˜¯ä¸æœ¬classä¸­å…¶å®ƒéƒ¨åˆ†å…³è”æœ€å¤šçš„éƒ¨åˆ† å¸¸é‡æ± æ˜¯classæ–‡ä»¶ä¸­ç©ºé—´å ç”¨æœ€å¤§çš„éƒ¨åˆ†ä¹‹ä¸€ å¸¸é‡æ± ä¸­å¸¸é‡çš„ç±»å‹ åˆšæ‰ä»‹ç»äº†ï¼Œå¸¸é‡æ± ä¸­çš„å¸¸é‡å¤§ä½“ä¸Šåˆ†ä¸ºï¼šå­—é¢å€¼å¸¸é‡ å’Œ ç¬¦å·å¼•ç”¨ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼Œæ ¹æ®å¸¸é‡çš„æ•°æ®ç±»å‹ä¸åŒï¼Œåˆå¯ä»¥è¢«ç»†åˆ†ä¸º14ç§å¸¸é‡ç±»å‹ã€‚è¿™14ç§å¸¸é‡ç±»å‹éƒ½æœ‰å„è‡ªçš„äºŒç»´è¡¨ç¤ºç»“æ„ã€‚æ¯ç§å¸¸é‡ç±»å‹çš„å¤´1ä¸ªå­—èŠ‚éƒ½æ˜¯tagï¼Œç”¨äºè¡¨ç¤ºå½“å‰å¸¸é‡å±äº14ç§ç±»å‹ä¸­çš„å“ªä¸€ä¸ªã€‚ ä»¥CONSTANT_Class_infoå¸¸é‡ä¸ºä¾‹ï¼Œå®ƒçš„äºŒç»´è¡¨ç¤ºç»“æ„å¦‚ä¸‹ï¼š ç±»å‹ åç§° æ•°é‡ u1 tag 1 u2 length 1 tagè¡¨ç¤ºå½“å‰å¸¸é‡çš„ç±»å‹(å½“å‰å¸¸é‡ä¸ºCONSTANT_Class_infoï¼Œå› æ­¤tagçš„å€¼åº”ä¸º7ï¼Œè¡¨ç¤ºä¸€ä¸ªç±»æˆ–æ¥å£çš„å…¨é™å®šå)ï¼› name_indexè¡¨ç¤ºè¿™ä¸ªç±»æˆ–æ¥å£å…¨é™å®šåçš„ä½ç½®ã€‚å®ƒçš„å€¼è¡¨ç¤ºæŒ‡å‘å¸¸é‡æ± çš„ç¬¬å‡ ä¸ªå¸¸é‡ã€‚å®ƒä¼šæŒ‡å‘ä¸€ä¸ªCONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡ï¼Œå®ƒçš„äºŒç»´è¡¨ç»“æ„å¦‚ä¸‹ï¼š ç±»å‹ åç§° æ•°é‡ u1 tag 1 u2 length 1 u1 bytes length CONSTANT_Utf8_infoè¡¨ç¤ºå­—ç¬¦ä¸²å¸¸é‡ï¼› tagè¡¨ç¤ºå½“å‰å¸¸é‡çš„ç±»å‹ï¼Œè¿™é‡Œåº”è¯¥æ˜¯1ï¼› lengthè¡¨ç¤ºè¿™ä¸ªå­—ç¬¦ä¸²çš„é•¿åº¦ï¼› bytesä¸ºè¿™ä¸ªå­—ç¬¦ä¸²çš„å†…å®¹(é‡‡ç”¨ç¼©ç•¥çš„UTF8ç¼–ç ) ä¸ºä»€ä¹ˆJavaä¸­å®šä¹‰çš„ç±»ã€å˜é‡åå­—å¿…é¡»å°äº64K ç±»ã€æ¥å£ã€å˜é‡ç­‰åå­—éƒ½å±äºç¬¦å·å¼•ç”¨ï¼Œå®ƒä»¬éƒ½å­˜å‚¨åœ¨å¸¸é‡æ± ä¸­ã€‚è€Œä¸ç®¡å“ªç§ç¬¦å·å¼•ç”¨ï¼Œå®ƒä»¬çš„åå­—éƒ½ç”±CONSTANT_Utf8_infoç±»å‹çš„å¸¸é‡è¡¨ç¤ºï¼Œè¿™ç§ç±»å‹çš„å¸¸é‡ä½¿ç”¨u2å­˜å‚¨å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚ç”±äº2å­—èŠ‚æœ€å¤šèƒ½è¡¨ç¤º65535ä¸ªæ•°ï¼Œå› æ­¤è¿™äº›åå­—çš„æœ€å¤§é•¿åº¦æœ€å¤šåªèƒ½æ˜¯64Kã€‚ è®¿é—®æ ‡å¿—(access_flags) åœ¨å¸¸é‡æ± ä¹‹åæ˜¯2å­—èŠ‚çš„è®¿é—®æ ‡å¿—ã€‚è®¿é—®æ ‡å¿—æ˜¯ç”¨æ¥è¡¨ç¤ºè¿™ä¸ªclassæ–‡ä»¶æ˜¯ç±»è¿˜æ˜¯æ¥å£ã€æ˜¯å¦è¢«publicä¿®é¥°ã€æ˜¯å¦è¢«abstractä¿®é¥°ã€æ˜¯å¦è¢«finalä¿®é¥°ç­‰ã€‚ ç”±äºè¿™äº›æ ‡å¿—éƒ½ç”±æ˜¯/å¦è¡¨ç¤ºï¼Œå› æ­¤å¯ä»¥ç”¨0/1è¡¨ç¤ºã€‚ è®¿é—®æ ‡å¿—ä¸º2å­—èŠ‚ï¼Œå¯ä»¥è¡¨ç¤º16ä½æ ‡å¿—ï¼Œä½†JVMç›®å‰åªå®šä¹‰äº†8ç§ï¼Œæœªå®šä¹‰çš„ç›´æ¥å†™0. ç±»ç´¢å¼•(this_class) ç±»ç´¢å¼•ï¼Œthis_classçš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»å‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»æˆ–æ¥å£ã€‚ çˆ¶ç±»ç´¢å¼•(super_class) çˆ¶ç±»ç´¢å¼•ï¼Œå¯¹äºç±»æ¥è¯´ï¼Œsuper_class çš„å€¼å¿…é¡»ä¸º 0 æˆ–è€…æ˜¯å¯¹constant_pool è¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚å¦‚æœå®ƒçš„å€¼ä¸ä¸º 0ï¼Œé‚£ constant_pool è¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºCONSTANT_Class_info ç±»å‹å¸¸é‡ï¼Œè¡¨ç¤ºè¿™ä¸ª Class æ–‡ä»¶æ‰€å®šä¹‰çš„ç±»çš„ç›´æ¥çˆ¶ç±»ã€‚å½“å‰ç±»çš„ç›´æ¥çˆ¶ç±»ï¼Œä»¥åŠå®ƒæ‰€æœ‰é—´æ¥çˆ¶ç±»çš„access_flag ä¸­éƒ½ä¸èƒ½å¸¦æœ‰ACC_FINAL æ ‡è®°ã€‚å¯¹äºæ¥å£æ¥è¯´ï¼Œå®ƒçš„Classæ–‡ä»¶çš„super_classé¡¹çš„å€¼å¿…é¡»æ˜¯å¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ã€‚constant_poolè¡¨åœ¨è¿™ä¸ªç´¢å¼•å¤„çš„é¡¹å¿…é¡»ä¸ºä»£è¡¨ java.lang.Object çš„ CONSTANT_Class_info ç±»å‹å¸¸é‡ ã€‚å¦‚æœ Class æ–‡ä»¶çš„ super_classçš„å€¼ä¸º 0ï¼Œé‚£è¿™ä¸ªClassæ–‡ä»¶åªå¯èƒ½æ˜¯å®šä¹‰çš„æ˜¯java.lang.Objectç±»ï¼Œåªæœ‰å®ƒæ˜¯å”¯ä¸€æ²¡æœ‰çˆ¶ç±»çš„ç±»ã€‚ æ¥å£è®¡æ•°å™¨(interfaces_count) æ¥å£è®¡æ•°å™¨ï¼Œinterfaces_countçš„å€¼è¡¨ç¤ºå½“å‰ç±»æˆ–æ¥å£çš„ç›´æ¥çˆ¶æ¥å£æ•°é‡ã€‚ æ¥å£ä¿¡æ¯æ•°æ®åŒº(interfaces[interfaces_count]) æ¥å£è¡¨ï¼Œinterfaces[]æ•°ç»„ä¸­çš„æ¯ä¸ªæˆå‘˜çš„å€¼å¿…é¡»æ˜¯ä¸€ä¸ªå¯¹constant_poolè¡¨ä¸­é¡¹ç›®çš„ä¸€ä¸ªæœ‰æ•ˆç´¢å¼•å€¼ï¼Œ å®ƒçš„é•¿åº¦ä¸º interfaces_countã€‚æ¯ä¸ªæˆå‘˜ interfaces[i]&nbsp; å¿…é¡»ä¸º CONSTANT_Class_infoç±»å‹å¸¸é‡ï¼Œå…¶ä¸­ 0 â‰¤ i &lt;interfaces_countã€‚åœ¨interfaces[]æ•°ç»„ä¸­ï¼Œæˆå‘˜æ‰€è¡¨ç¤ºçš„æ¥å£é¡ºåºå’Œå¯¹åº”çš„æºä»£ç ä¸­ç»™å®šçš„æ¥å£é¡ºåºï¼ˆä»å·¦è‡³å³ï¼‰ä¸€æ ·ï¼Œå³interfaces[0]å¯¹åº”çš„æ˜¯æºä»£ç ä¸­æœ€å·¦è¾¹çš„æ¥å£ã€‚ å­—æ®µè¡¨çš„é›†åˆ ä»€ä¹ˆæ˜¯å­—æ®µè¡¨é›†åˆ å­—æ®µè¡¨é›†åˆç”¨äºå­˜å‚¨æœ¬ç±»æ‰€æ¶‰åŠåˆ°çš„æˆå‘˜å˜é‡ï¼ŒåŒ…æ‹¬å®ä¾‹å˜é‡å’Œç±»å˜é‡ï¼Œä½†ä¸åŒ…æ‹¬æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ã€‚ æ¯ä¸€ä¸ªå­—æ®µè¡¨åªè¡¨ç¤ºä¸€ä¸ªæˆå‘˜å˜é‡ï¼Œæœ¬ç±»ä¸­æ‰€æœ‰çš„æˆå‘˜å˜é‡æ„æˆäº†å­—æ®µè¡¨é›†åˆã€‚ æè¿°ä¸€ä¸ªå­—æ®µçš„ä¿¡æ¯åŒ…æ‹¬ï¼šå­—æ®µçš„ä½œç”¨åŸŸï¼ˆpublicã€protectedã€privateï¼‰ã€å®ä¾‹å˜é‡ä¸å¦ï¼ˆstaticï¼‰ã€å¯å˜æ€§ï¼ˆfinalï¼‰ã€å¹¶å‘å¯è§æ€§ï¼ˆvolatileï¼‰ã€å¯å¦è¢«åºåˆ—åŒ–ï¼ˆtransientï¼‰ã€å­—æ®µæ•°æ®ç±»å‹ï¼ˆåŸºæœ¬æ•°æ®ç±»å‹ã€å¯¹è±¡ã€æ•°ç»„ï¼‰ã€å­—æ®µåç§°ã€‚è€Œå­—æ®µå«ä»€ä¹ˆåå­—ï¼Œå­—æ®µè¢«å®šä¹‰ä¸ºä»€ä¹ˆæ•°æ®ç±»å‹ï¼Œè¿™äº›éƒ½æ˜¯æ— æ³•å›ºå®šçš„ï¼Œåªèƒ½å¼•ç”¨å¸¸é‡æ± ä¸­çš„å¸¸é‡æ¥æè¿°ã€‚ å­—æ®µè¡¨ç»“æ„çš„å®šä¹‰ ç±»å‹ åç§° æ•°é‡ u2 access_flags 1 u2 name_index 1 u2 descriptor_index 1 u2 attributes_count 1 attribute_info attributes attributes_count access_flags å­—æ®µçš„è®¿é—®æ ‡å¿—ã€‚åœ¨Javaä¸­ï¼Œæ¯ä¸ªæˆå‘˜å˜é‡éƒ½æœ‰ä¸€ç³»åˆ—çš„ä¿®é¥°ç¬¦ï¼Œå’Œä¸Šè¿°classæ–‡ä»¶çš„è®¿é—®æ ‡å¿—çš„ä½œç”¨ä¸€æ ·ï¼Œåªä¸è¿‡æˆå‘˜å˜é‡çš„è®¿é—®æ ‡å¿—ä¸ç±»çš„è®¿é—®æ ‡å¿—ç¨æœ‰åŒºåˆ«ã€‚ name_index æœ¬å­—æ®µåå­—çš„ç´¢å¼•ã€‚æŒ‡å‘ä¸€ä¸ªCONSTANT_Class_infoç±»å‹çš„å¸¸é‡ï¼Œè¿™é‡Œé¢å­˜å‚¨äº†æœ¬å­—æ®µçš„åå­—ç­‰ä¿¡æ¯ã€‚ descriptor_index æè¿°ç¬¦ã€‚ç”¨äºæè¿°æœ¬å­—æ®µåœ¨Javaä¸­çš„æ•°æ®ç±»å‹ç­‰ä¿¡æ¯(ä¸‹é¢è¯¦ç»†ä»‹ç») attributes_count å±æ€§è¡¨é›†åˆçš„é•¿åº¦ã€‚ attributes å±æ€§è¡¨é›†åˆã€‚åˆ°descriptor_indexä¸ºæ­¢æ˜¯å­—æ®µè¡¨çš„å›ºå®šä¿¡æ¯ï¼Œå…‰æœ‰ä¸Šè¿°ä¿¡æ¯å¯èƒ½æ— æ³•å®Œæ•´åœ°æè¿°ä¸€ä¸ªå­—æ®µï¼Œå› æ­¤ç”¨å±æ€§è¡¨é›†åˆæ¥å­˜æ”¾é¢å¤–çš„ä¿¡æ¯ï¼Œæ¯”å¦‚ä¸€ä¸ªå­—æ®µçš„å€¼ã€‚ ä»€ä¹ˆæ˜¯æè¿°ç¬¦ æˆå‘˜å˜é‡(åŒ…æ‹¬é™æ€æˆå‘˜å˜é‡å’Œå®ä¾‹å˜é‡) å’Œ æ–¹æ³•éƒ½æœ‰å„è‡ªçš„æè¿°ç¬¦ã€‚ å¯¹äºå­—æ®µè€Œè¨€ï¼Œæè¿°ç¬¦ç”¨äºæè¿°å­—æ®µçš„æ•°æ®ç±»å‹ï¼› å¯¹äºæ–¹æ³•è€Œè¨€ï¼Œæè¿°ç¬¦ç”¨äºæè¿°å­—æ®µçš„æ•°æ®ç±»å‹ã€å‚æ•°åˆ—è¡¨ã€è¿”å›å€¼ã€‚ åœ¨æè¿°ç¬¦ä¸­ï¼ŒåŸºæœ¬æ•°æ®ç±»å‹ç”¨å¤§å†™å­—æ¯è¡¨ç¤ºï¼Œå¯¹è±¡ç±»å‹ç”¨â€œLå¯¹è±¡ç±»å‹çš„å…¨é™å®šåâ€è¡¨ç¤ºï¼Œæ•°ç»„ç”¨â€œæ•°ç»„ç±»å‹çš„å…¨é™å®šåâ€è¡¨ç¤ºã€‚ æè¿°æ–¹æ³•æ—¶ï¼Œå°†å‚æ•°æ ¹æ®ä¸Šè¿°è§„åˆ™æ”¾åœ¨()ä¸­ï¼Œ()å³ä¾§æŒ‰ç…§ä¸Šè¿°æ–¹æ³•æ”¾ç½®è¿”å›å€¼ã€‚è€Œä¸”ï¼Œå‚æ•°ä¹‹é—´æ— éœ€ä»»ä½•ç¬¦å·ã€‚ å­—æ®µè¡¨é›†åˆçš„æ³¨æ„ç‚¹ ä¸€ä¸ªclassæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­ä¸èƒ½å‡ºç°ä»çˆ¶ç±»/æ¥å£ç»§æ‰¿è€Œæ¥å­—æ®µï¼› ä¸€ä¸ªclassæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­å¯èƒ½ä¼šå‡ºç°ç¨‹åºçŒ¿æ²¡æœ‰å®šä¹‰çš„å­—æ®µ å¦‚ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨åœ°åœ¨å†…éƒ¨ç±»çš„classæ–‡ä»¶çš„å­—æ®µè¡¨é›†åˆä¸­æ·»åŠ å¤–éƒ¨ç±»å¯¹è±¡çš„æˆå‘˜å˜é‡ï¼Œä¾›å†…éƒ¨ç±»è®¿é—®å¤–éƒ¨ç±»ã€‚ Javaä¸­åªè¦ä¸¤ä¸ªå­—æ®µåå­—ç›¸åŒå°±æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚ä½†åœ¨JVMè§„èŒƒä¸­ï¼Œå…è®¸ä¸¤ä¸ªå­—æ®µçš„åå­—ç›¸åŒä½†æè¿°ç¬¦ä¸åŒçš„æƒ…å†µï¼Œå¹¶ä¸”è®¤ä¸ºå®ƒä»¬æ˜¯ä¸¤ä¸ªä¸åŒçš„å­—æ®µã€‚ æ–¹æ³•è¡¨çš„é›†åˆ åœ¨classæ–‡ä»¶ä¸­ï¼Œæ‰€æœ‰çš„æ–¹æ³•ä»¥äºŒç»´è¡¨çš„å½¢å¼å­˜å‚¨ï¼Œæ¯å¼ è¡¨æ¥è¡¨ç¤ºä¸€ä¸ªå‡½æ•°ï¼Œä¸€ä¸ªç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•æ„æˆæ–¹æ³•è¡¨çš„é›†åˆã€‚ æ–¹æ³•è¡¨çš„ç»“æ„å’Œå­—æ®µè¡¨çš„ç»“æ„ä¸€è‡´ï¼Œåªä¸è¿‡è®¿é—®æ ‡å¿—å’Œå±æ€§è¡¨é›†åˆçš„å¯é€‰é¡¹æœ‰æ‰€ä¸åŒã€‚ æ–¹æ³•è¡¨çš„å±æ€§è¡¨é›†åˆä¸­æœ‰ä¸€å¼ Codeå±æ€§è¡¨ï¼Œç”¨äºå­˜å‚¨å½“å‰æ–¹æ³•ç»ç¼–è¯‘å™¨ç¼–è¯‘è¿‡åçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚ æ–¹æ³•è¡¨é›†åˆçš„æ³¨æ„ç‚¹ å¦‚æœæœ¬classæ²¡æœ‰é‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œé‚£ä¹ˆæœ¬classæ–‡ä»¶çš„æ–¹æ³•è¡¨é›†åˆä¸­æ˜¯ä¸ä¼šå‡ºç°çˆ¶ç±»/çˆ¶æ¥å£çš„æ–¹æ³•è¡¨ï¼› æœ¬classçš„æ–¹æ³•è¡¨é›†åˆå¯èƒ½å‡ºç°ç¨‹åºçŒ¿æ²¡æœ‰å®šä¹‰çš„æ–¹æ³• ç¼–è¯‘å™¨åœ¨ç¼–è¯‘æ—¶ä¼šåœ¨classæ–‡ä»¶çš„æ–¹æ³•è¡¨é›†åˆä¸­åŠ å…¥ç±»æ„é€ å™¨å’Œå®ä¾‹æ„é€ å™¨ã€‚ é‡è½½ä¸€ä¸ªæ–¹æ³•éœ€è¦æœ‰ç›¸åŒçš„ç®€å•åç§°å’Œä¸åŒçš„ç‰¹å¾ç­¾åã€‚JVMçš„ç‰¹å¾ç­¾åå’ŒJavaçš„ç‰¹å¾ç­¾åæœ‰æ‰€ä¸åŒï¼š Javaç‰¹å¾ç­¾åï¼šæ–¹æ³•å‚æ•°åœ¨å¸¸é‡æ± ä¸­çš„å­—æ®µç¬¦å·å¼•ç”¨çš„é›†åˆ JVMç‰¹å¾ç­¾åï¼šæ–¹æ³•å‚æ•°ï¼‹è¿”å›å€¼ å±æ€§è¡¨ å±æ€§è®¡æ•°å™¨(attributes_count) å±æ€§è®¡æ•°å™¨ï¼Œattributes_countçš„å€¼è¡¨ç¤ºå½“å‰ Class æ–‡ä»¶attributesè¡¨çš„æˆå‘˜ä¸ªæ•°ã€‚attributesè¡¨ä¸­æ¯ä¸€é¡¹éƒ½æ˜¯ä¸€ä¸ªattribute_info ç»“æ„çš„æ•°æ®é¡¹ã€‚ å±æ€§ä¿¡æ¯æ•°æ®åŒº(attributes[attributes_count]) å±æ€§è¡¨ï¼Œattributes è¡¨çš„æ¯ä¸ªé¡¹çš„å€¼å¿…é¡»æ˜¯attribute_infoç»“æ„ã€‚ åœ¨Java 7 è§„èŒƒé‡Œï¼ŒClassæ–‡ä»¶ç»“æ„ä¸­çš„attributesè¡¨çš„é¡¹åŒ…æ‹¬ä¸‹åˆ—å®šä¹‰çš„å±æ€§ï¼š InnerClasses&nbsp; ã€ EnclosingMethod ã€ Synthetic&nbsp; ã€Signatureã€SourceFileï¼ŒSourceDebugExtension ã€Deprecatedã€RuntimeVisibleAnnotations ã€RuntimeInvisibleAnnotationsä»¥åŠBootstrapMethodså±æ€§ã€‚ å¯¹äºæ”¯æŒ Class æ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 49.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®ç°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å–attributesè¡¨ä¸­çš„Signatureã€RuntimeVisibleAnnotationså’ŒRuntimeInvisibleAnnotationså±æ€§ã€‚å¯¹äºæ”¯æŒClassæ–‡ä»¶æ ¼å¼ç‰ˆæœ¬å·ä¸º 51.0 æˆ–æ›´é«˜çš„ Java è™šæ‹Ÿæœºå®ç°ï¼Œå¿…é¡»æ­£ç¡®è¯†åˆ«å¹¶è¯»å– attributesè¡¨ä¸­çš„BootstrapMethodså±æ€§ã€‚Java 7 è§„èŒƒ è¦æ±‚ä»»ä¸€ Java è™šæ‹Ÿæœºå®ç°å¯ä»¥è‡ªåŠ¨å¿½ç•¥ Class æ–‡ä»¶çš„ attributesè¡¨ä¸­çš„è‹¥å¹² ï¼ˆç”šè‡³å…¨éƒ¨ï¼‰ å®ƒä¸å¯è¯†åˆ«çš„å±æ€§é¡¹ã€‚ä»»ä½•æœ¬è§„èŒƒæœªå®šä¹‰çš„å±æ€§ä¸èƒ½å½±å“Classæ–‡ä»¶çš„è¯­ä¹‰ï¼Œåªèƒ½æä¾›é™„åŠ çš„æè¿°ä¿¡æ¯ ã€‚ æ ¹æ®ä¸Šè¿°çš„å™è¿°ï¼Œæˆ‘ä»¬å¯ä»¥å°†classçš„æ–‡ä»¶ç»„ç»‡ç»“æ„æ¦‚æ‹¬æˆä»¥ä¸‹é¢è¿™ä¸ªç»“æ„ä½“ï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JVM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JVM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux - å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2Fposts%2Fcb6839f2.html</url>
    <content type="text"><![CDATA[å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ [root@localhost~] rootä¸ºç”¨æˆ·åï¼ˆ#è¶…çº§ç”¨æˆ· $æ™®é€šç”¨æˆ·ï¼‰ localhostä¸»æœºå å‘½ä»¤çš„åŸºæœ¬æ ¼å¼ï¼š 1å‘½ä»¤[é€‰é¡¹][å‚æ•°] æŸ¥è¯¢ç›®å½•çš„å†…å®¹ å‘½ä»¤æ ¼å¼ï¼š 1ls [é€‰é¡¹][æ–‡ä»¶æˆ–ç›®å½•] é€‰é¡¹ï¼š -a æ‰€æœ‰æ–‡ä»¶,åŒ…æ‹¬éšè—æ–‡ä»¶ã€‚ -l æŸ¥çœ‹è¯¦æƒ…,åŒ…å«æ–‡ä»¶çš„ç¡®åˆ‡å¤§å°ï¼Œæ‹¥æœ‰è¯¥æ–‡ä»¶çš„äººå‘˜ï¼Œæœ‰æƒæŸ¥çœ‹è¯¥æ–‡ä»¶ï¼Œä»¥åŠä½•æ—¶è¿›è¡Œä¸Šæ¬¡ä¿®æ”¹ã€‚ -d æŸ¥çœ‹ç›®å½•å±æ€§ -h æ˜¾ç¤ºæ–‡ä»¶å¤§å° æ–‡ä»¶å¤„ç† å»ºç«‹ç›®å½• mkdir -p[ç›®å½•å] -pè¡¨ç¤ºé€’å½’åˆ›å»ºæ–‡ä»¶å¤¹ åˆ‡æ¢ç›®å½• cd [ç›®å½•] ç®€åŒ–æ“ä½œï¼š 1234cd ~ è¿›å…¥å½“å‰ç”¨æˆ·ç›®å½•cd - ä¸Šæ¬¡ç›®å½•cd .. è¿›å…¥ä¸Šä¸€çº§ç›®å½•pwd æŸ¥çœ‹å½“å‰ç›®å½•æ‰€åœ¨ä½ç½® åˆ é™¤ç›®å½• 12rmdir [ç›®å½•] åˆ é™¤æ‰€æœ‰æ–‡ä»¶rm -rf [ç›®å½•] åˆ é™¤ç›®å½•æ‰€æœ‰æ–‡ä»¶ å¤åˆ¶ç›®å½• cp [é€‰é¡¹] [åŸæ–‡ä»¶ç›®å½•] [ç›®æ ‡ç›®å½•] é€‰é¡¹ï¼š -rå¤åˆ¶ç›®å½• -pè¿æ–‡ä»¶å±æ€§ä¸€èµ·å¤åˆ¶ -a ç›¸å½“äº-pdr å‰ªåˆ‡ã€æ”¹å mv [åŸæ–‡ä»¶ç›®å½•] [ç›®æ ‡æ–‡ä»¶ç›®å½•] 1mv filename1 filename2 filename1 æ–‡ä»¶çš„æºè·¯å¾„ï¼Œfilename2 æ˜¯ç›®æ ‡è·¯å¾„ã€‚ å¸¸è§ç›®å½•ä½œç”¨ 123456789101112131415/ æ ¹ç›®å½•/bin å‘½ä»¤ä¿å­˜ç›®å½•/boot å¯åŠ¨ç›®å½•/dev è®¾å¤‡æ–‡ä»¶å‘½ä»¤/etc é…ç½®æ–‡ä»¶ä¿å­˜ç›®å½•/home å®¶ç›®å½•/lib ç³»ç»Ÿåº“ä¿å­˜å‘½ä»¤/mnt ç³»ç»ŸæŒ‚è½½ç›®å½• åˆ›å»ºæˆ–æ›´æ–°æ–‡ä»¶ 1touch filename cat å®ƒå¯ä»¥åœ¨UNIXæˆ–Linuxä¸‹ç”¨äºä»¥ä¸‹ç›®çš„ã€‚ åœ¨å±å¹•ä¸Šæ˜¾ç¤ºæ–‡æœ¬æ–‡ä»¶ å¤åˆ¶æ–‡æœ¬æ–‡ä»¶ åˆå¹¶æ–‡æœ¬æ–‡ä»¶ åˆ›å»ºæ–°çš„æ–‡æœ¬æ–‡ä»¶ 123cat filenamecat file1 file2 cat file1 file2 &gt; newcombinedfile more æ˜¾ç¤ºæ–‡ä»¶çš„ç¬¬ä¸€éƒ¨åˆ†ï¼ˆç”¨ç©ºæ ¼ç§»åŠ¨å¹¶é”®å…¥qä»¥é€€å‡ºï¼‰ã€‚ 1more filename head è¾“å‡ºæ–‡ä»¶çš„å‰10è¡Œã€‚ 1head filename tail è¾“å‡ºæœ€å10è¡Œæ–‡ä»¶ã€‚ç”¨äº-fåœ¨æ–‡ä»¶å¢é•¿æ—¶è¾“å‡ºé™„åŠ æ•°æ®ã€‚ 1tail filename diff æ¯”è¾ƒæ–‡ä»¶ï¼Œå¹¶åˆ—å‡ºä»–ä»¬çš„å·®å¼‚ã€‚ 1diff filename1 filename2 lpr æ‰“å°æ–‡ä»¶ã€‚ 1lpr filename æ–‡ä»¶æœç´¢ locate locate [æ–‡ä»¶å] åœ¨ç³»ç»Ÿæ•°æ®åº“ä¸­æŸ¥æ‰¾æ–‡ä»¶ã€‚æ–°å»ºçš„æ–‡ä»¶ï¼Œè¦æ‰§è¡Œupdatedbæ“ä½œä¹‹åæ‰èƒ½æœåˆ°ã€‚ å‘½ä»¤æœç´¢ whereis [é€‰é¡¹] [å‘½ä»¤å] æˆ–è€… which [é€‰é¡¹][å‘½ä»¤å] é€‰é¡¹ï¼š -b åªæŸ¥æ‰¾å¯æ‰§è¡Œæ–‡ä»¶ -m åªæŸ¥æ‰¾å¸®åŠ©æ–‡ä»¶ è¯´æ˜ï¼šwhereisä½¿ç”¨ç³»ç»Ÿè‡ªåŠ¨æ„å»ºçš„æ•°æ®åº“æ¥æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ï¼Œæºæ–‡ä»¶å’Œæ‰‹å†Œé¡µé¢ã€‚ whichåœ¨ç¯å¢ƒå˜é‡PATHæŒ‡å®šçš„ç›®å½•ä¸­æœç´¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚æ­¤å‘½ä»¤å°†æ‰“å°å¯æ‰§è¡Œæ–‡ä»¶çš„å®Œæ•´è·¯å¾„ã€‚ æ–‡ä»¶æœç´¢ find [æœç´¢èŒƒå›´][é€‰é¡¹][æ¡ä»¶] ä¸¾ä¾‹ï¼š åœ¨æ ¹ç›®å½•ä¸‹æŸ¥æ‰¾åä¸ºinstall.logæ–‡ä»¶ find / -name install.log å¿½ç•¥å¤§å°å†™æŸ¥æ‰¾æ–‡ä»¶ find /root -inname install.log find /var/log -mtime +10 å…¶ä¸­-mtime æ–‡ä»¶ä¿®æ”¹æ—¶é—´ -atime æ–‡ä»¶è®¿é—®æ—¶é—´ -ctime æ”¹å˜æ–‡ä»¶å±æ€§æ—¶é—´ +10 10å¤©å‰ 10 10å¤© -10 10å¤©å†… æŸ¥æ‰¾æ–‡ä»¶å¤§äº20Mçš„æ–‡ä»¶ find /etc -size +20M æ–‡æœ¬æ“ä½œ awk awk æ˜¯å¤„ç†æ–‡æœ¬æ–‡ä»¶æœ€æœ‰ç”¨çš„å‘½ä»¤ã€‚å®ƒä¸€è¡Œä¸€è¡Œåœ°åœ¨æ•´ä¸ªæ–‡ä»¶ä¸Šè¿è¡Œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä½¿ç”¨ç©ºæ ¼åˆ†éš”å­—æ®µã€‚awkå‘½ä»¤æœ€å¸¸ç”¨çš„è¯­æ³•æ˜¯: 1awk '/search_pattern/ { action_to_take_if_pattern_matches; }' file_to_parse ä»¥/etc/passwdæ–‡ä»¶åŒ…å«çš„ç¤ºä¾‹æ•°æ®ä¸ºä¾‹ï¼š 12345root:x:0:0:root:/root:/usr/bin/zshdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/sync ç°åœ¨ä»è¿™ä¸ªæ–‡ä»¶åªè·å–ç”¨æˆ·åã€‚ -FæŒ‡å®šè¦åŸºäºå“ªä¸ªåˆ†éš”å­—æ®µã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ { print $1 } æ„å‘³ç€æ‰“å°å‡ºç¬¬ä¸€ä¸ªåŒ¹é…å­—æ®µã€‚ 1awk -F':' '{ print $1 }' /etc/passwd è¿è¡Œä¸Šè¿°å‘½ä»¤åï¼Œå°†è·å¾—ä»¥ä¸‹è¾“å‡ºã€‚ 12345rootdaemonbinsyssync grep æŸ¥æ‰¾æ–‡ä»¶å†…çš„æ–‡æœ¬ã€‚å¯ä»¥ä½¿ç”¨ grep æœç´¢ä¸ä¸€ä¸ªæˆ–å¤šä¸ªæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„æ–‡æœ¬è¡Œï¼Œå¹¶ä»…è¾“å‡ºåŒ¹é…çš„è¡Œã€‚ 1grep pattern filename ç¤ºä¾‹ï¼š 1234$ grep admin /etc/passwd_kadmin_admin:*:218:-2:Kerberos Admin Service:/var/empty:/usr/bin/false_kadmin_changepw:*:219:-2:Kerberos Change Password Service:/var/empty:/usr/bin/false_krb_kadmin:*:231:-2:Open Directory Kerberos Admin Service:/var/empty:/usr/bin/false è¿˜å¯ä»¥é€šè¿‡ä½¿ç”¨-ié€‰é¡¹å¼ºåˆ¶grepå¿½ç•¥å•è¯å¤§å°å†™ã€‚-rå¯ç”¨äºæœç´¢æŒ‡å®šç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ï¼Œä¾‹å¦‚ï¼š 1$ grep -r admin /etc/ -w åªæœç´¢å•è¯ã€‚ wc ç»Ÿè®¡ä¸€ä¸ªæ–‡ä»¶ä¸­æœ‰å¤šå°‘è¡Œï¼Œå¤šå°‘å•è¯å’Œå¤šå°‘å­—ç¬¦ã€‚ 1wc filename ç¤ºä¾‹ï¼š 12$ wc demo.txt7459 15915 398400 demo.txt 7459 æ˜¯è¡Œæ•°, 15915 æ˜¯å•è¯æ•°ï¼Œ 398400 æ˜¯å­—ç¬¦æ•°. sed ç”¨äºè¿‡æ»¤å’Œè½¬æ¢æ–‡æœ¬çš„æµç¼–è¾‘å™¨ã€‚ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1Hello This is a Test 1 2 3 4 ç”¨è¿å­—ç¬¦æ›¿æ¢æ‰€æœ‰ç©ºæ ¼ 1sed 's/ /-/g' example.txt ç»“æœå¦‚ä¸‹ï¼š 1Hello-This-is-a-Test-1-2-3-4 ä½¿ç”¨"d"æ›¿æ¢æ‰€æœ‰çš„æ•°å­— 1sed 's/[0-9]/d/g' example.txt ç»“æœå¦‚ä¸‹ï¼š 1Hello This is a Test d d d d sort æ’åºæ–‡æœ¬æ–‡ä»¶çš„è¡Œ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1234567fbcgaed æ’åºexample.txt 1sort example.txt ç»“æœå¦‚ä¸‹ï¼š 1234567abcdefg éšæœºåŒ–ä¸€ä¸ªæ’åºçš„example.txt 1sort example.txt | sort -R ç»“æœå¦‚ä¸‹ï¼š 1234567bfacdge uniq æŠ¥å‘Šæˆ–çœç•¥é‡å¤çš„è¡Œ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 12345678aababcdc åªæ˜¾ç¤ºexample.txtçš„å”¯ä¸€è¡Œï¼ˆé¦–å…ˆä½ éœ€è¦æ’åºï¼Œå¦åˆ™çœ‹ä¸åˆ°é‡å ï¼‰ 1sort example.txt | uniq ç»“æœå¦‚ä¸‹ï¼š 1234abcd æ˜¾ç¤ºæ¯è¡Œçš„å”¯ä¸€é¡¹ï¼Œå¹¶å‘Šè¯‰æˆ‘æ‰¾åˆ°äº†å¤šå°‘ä¸ªå®ä¾‹ 1sort example.txt | uniq -c ç»“æœå¦‚ä¸‹ï¼š 12343 a2 b2 c1 d cut ä»æ¯è¡Œæ–‡ä»¶ä¸­åˆ é™¤éƒ¨åˆ†ã€‚ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1red riding hood went to the park to play æ˜¾ç¤ºç¬¬2,7å’Œ9æ çš„ç©ºæ ¼ä½œä¸ºåˆ†éš”ç¬¦ 1cut -d " " -f2,7,9 example.txt ç»“æœå¦‚ä¸‹ï¼š 1riding park play echo æ˜¾ç¤ºä¸€è¡Œæ–‡å­— æ˜¾ç¤º "Hello World" 1echo Hello World ç»“æœå¦‚ä¸‹ï¼š 1Hello World ç”¨å­—æ¯ä¹‹é—´çš„æ¢è¡Œæ˜¾ç¤º "Hello World" 1echo -ne "Hello\nWorld\n" ç»“æœå¦‚ä¸‹ï¼š 12HelloWorld fmt ç®€å•çš„æœ€ä½³æ–‡æœ¬æ ¼å¼åŒ–ç¨‹åº example.txtå†…å®¹å¦‚ä¸‹ï¼š 1Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. å°†example.txtçš„è¡Œè¾“å‡ºä¸º20ä¸ªå­—ç¬¦çš„å®½åº¦ 1234567891011121314151617181920cat example.txt | fmt -w 20Lorem ipsumdolor sit amet,consetetursadipscing elitr,sed diam nonumyeirmod temporinvidunt ut laboreet dolore magnaaliquyam erat, seddiam voluptua. Atvero eos etaccusam et justoduo dolores et earebum. Stet clitakasd gubergren,no sea takimatasanctus est Loremipsum dolor sitamet. tr ç¿»è¯‘æˆ–åˆ é™¤å­—ç¬¦ example.txtæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š 1Hello World Foo Bar Baz! æŠŠæ‰€æœ‰å°å†™å­—æ¯å˜æˆä¸ºå¤§å†™ 1cat example.txt | tr 'a-z' 'A-Z' ç»“æœå¦‚ä¸‹ï¼š 1HELLO WORLD FOO BAR BAZ! æŠŠæ‰€æœ‰çš„ç©ºæ ¼å˜æˆæ¢è¡Œç¬¦ 1cat example.txt | tr ' ' '\n' ç»“æœå¦‚ä¸‹ï¼š 12345HelloWorldFooBarBaz! nl æ˜¾ç¤ºæ–‡ä»¶çš„è¡Œæ•° example.txtå†…å®¹å¦‚ä¸‹ï¼š 12345678910111213141516171819Lorem ipsumdolor sit amet,consetetursadipscing elitr,sed diam nonumyeirmod temporinvidunt ut laboreet dolore magnaaliquyam erat, seddiam voluptua. Atvero eos etaccusam et justoduo dolores et earebum. Stet clitakasd gubergren,no sea takimatasanctus est Loremipsum dolor sitamet. å¸¦è¡Œå·æ˜¾ç¤º example.txt 1nl -s". " example.txt ç»“æœå¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526 1. Lorem ipsum 2. dolor sit amet, 3. consetetur 4. sadipscing elitr, 5. sed diam nonumy 6. eirmod tempor 7. invidunt ut labore 8. et dolore magna 9. aliquyam erat, sed 10. diam voluptua. At 11. vero eos et 12. accusam et justo 13. duo dolores et ea 14. rebum. Stet clita 15. kasd gubergren, 16. no sea takimata 17. sanctus est Lorem 18. ipsum dolor sit 19. amet.``` 12. `egrep`æ‰“å°åŒ¹é…æ¨¡å¼çš„è¡Œ - æ‰©å±•è¡¨è¾¾å¼ï¼ˆåˆ«åä¸ºï¼š'grep -E'ï¼‰`example.txt`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. 12&gt;åœ¨å…¶ä¸­æ˜¾ç¤ºâ€œLoremâ€æˆ–â€œdolorâ€çš„è¡Œ egrep '(Lorem|dolor)' example.txt or grep -E '(Lorem|dolor)' example.txt 12ç»“æœå¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, et dolore magna duo dolores et ea sanctus est Lorem ipsum dolor sit 12345613. `fgrep`æ‰“å°åŒ¹é…æ¨¡å¼åˆ°çš„è¡Œ - FIXEDæ¨¡å¼åŒ¹é…ï¼ˆåˆ«åä¸ºï¼š'grep -F'ï¼‰`example.txt`æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor foo (Lorem|dolor) invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. 12&gt;åœ¨example.txtä¸­æ‰¾åˆ°å…·ä½“çš„å­—ç¬¦ä¸²'ï¼ˆLorem | doloarï¼‰' fgrep '(Lorem|dolor)' example.txt or grep -F '(Lorem|dolor)' example.txt 12ç»“æœå¦‚ä¸‹ï¼š foo (Lorem|dolor) 123456789101112131415#### å‹ç¼©ä¸è§£å‹ç¼©å¸¸è§å‹ç¼©æ ¼å¼ï¼š.zip ã€ .gz ã€ .bz2ã€ .tar.gz ã€ .tar.bz21. zipæ ¼å¼**å‹ç¼©æ–‡ä»¶**`zip [å‹ç¼©æ–‡ä»¶å][åŸæ–‡ä»¶]`**å‹ç¼©ç›®å½•**`zip -r [å‹ç¼©æ–‡ä»¶å][åŸæ–‡ä»¶]`ä¸¾ä¾‹ï¼š touch jp/cangls touch jp/longls zip -r jp.zip jp 1234567891011121314151617181920212223242526**è§£å‹ï¼š**`unzip [å‹ç¼©æ–‡ä»¶å]`**å‹ç¼©ä¸ºgzæ ¼å¼ï¼ŒåŸæ–‡ä»¶ä¸ä¿ç•™**`gzip [åŸæ–‡ä»¶]`2. gzæ ¼å¼**å‹ç¼©.gzæ ¼å¼ï¼ŒåŸæ–‡ä»¶ä¿ç•™**`gzip -c åŸæ–‡ä»¶ &gt; å‹ç¼©æ–‡ä»¶`**å‹ç¼©ç›®å½•ï¼š**`gzip -r ç›®å½•`**è§£å‹ï¼š**`guzip [æ–‡ä»¶]``guzip -r [ç›®å½•]`**æŸ¥çœ‹gzipå‹ç¼©æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦gunzipå®ƒ** gzcat filename 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859603. tar**æ‰“åŒ…**`tar -cvf æ‰“åŒ…æ–‡ä»¶å åŸæ–‡ä»¶`**è§£å‹**`tar -xvf jp.tar`4. tar.gz**æ‰“åŒ…**`tar -zcvf å‹ç¼©åŒ…å.tar.gz åŸæ–‡ä»¶`**è§£å‹**`tar -zxvf å‹ç¼©åŒ…å.tar.gz`#### å…³æœºã€é‡å¯`shutdown [é€‰é¡¹][æ—¶é—´]`**é€‰é¡¹ï¼š**+ -c å–æ¶ˆå‰ä¸€ä¸ªå…³æœºå‘½ä»¤+ -h å…³æœº+ -r é‡å¯+ init 6 é‡å¯+ init 0 å…³æœº+ logout é€€å‡ºç™»é™†#### æŸ¥çœ‹ç”¨æˆ·ä¿¡æ¯`w`ã€`who`ã€`last`ã€`lastlog`#### è¾“å‡ºé‡å®šå‘`å‘½ä»¤&gt;æ–‡ä»¶` ä»¥è¦†ç›–çš„æ–¹å¼ï¼ŒæŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶`å‘½ä»¤&gt;&gt;æ–‡ä»¶` ä»¥è¿½åŠ çš„æ–¹å¼ï¼ŒæŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ã€`é”™è¯¯å‘½ä»¤ 2&gt; æ–‡ä»¶` ä»¥è¦†ç›–çš„æ–¹å¼æŠŠé”™è¯¯çš„å‘½ä»¤è¦†ç›–åˆ°æŒ‡å®šæ–‡ä»¶`é”™è¯¯å‘½ä»¤ 2&gt;&gt; æ–‡ä»¶` ä»¥è¿½å‡»çš„æ–¹å¼æŠŠé”™è¯¯çš„å‘½ä»¤è¦†ç›–åˆ°æŒ‡å®šæ–‡ä»¶`å‘½ä»¤&gt;&gt;æ–‡ä»¶ 2&gt;&amp;1` åŒæ—¶è¿½åŠ æ­£ç¡®å‘½ä»¤å’Œé”™è¯¯å‘½ä»¤åˆ° æŒ‡å®šæ–‡ä»¶`å‘½ä»¤ &gt;&gt;æ–‡ä»¶1 2&gt;&gt;æ–‡ä»¶2` æŠŠæ­£ç¡®çš„å‘½ä»¤è¾“å‡ºåˆ°æ–‡ä»¶1é”™è¯¯çš„æ–‡ä»¶2#### ç½‘ç»œç›¸å…³1. ifconfigæŸ¥çœ‹ipä¸¾ä¸ªä¾‹å­ï¼š ifconfig&gt;&gt; ip.log cat ip.log 2. æŸ¥çœ‹ç½‘ç»œçŠ¶æ€ `netstat [é€‰é¡¹]` é€‰é¡¹ï¼š + -t: åˆ—å‡ºtcp åè®®ç«¯å£ + -u: åˆ—å‡ºupdåè®®ç«¯å£ + -n ipåœ°å€ä¸ªç«¯å£å· + -l åˆ—å‡ºç›‘å¬çŠ¶æ€çš„ + -a æ‰€æœ‰ 3. æŸ¥çœ‹è·¯ç”±åˆ—è¡¨ `netstat -rn` æˆ–è€… `route -n` 4. æŸ¥çœ‹æŸåŸŸåä¸è‡ªå·±çš„ç”µè„‘çš„ç½‘ç»œçŠ¶æ€ `ping www.baidu.com` #### viç¼–è¾‘å™¨ viçš„å‡çº§ç‰ˆæ˜¯vim 1. vimçš„æ“ä½œæ¨¡å¼ `commond mode` å‘½ä»¤æ¨¡å¼ `inser tmode` ç¼–è¾‘æ¨¡å¼ `lastline mode` åº•è¡Œæ¨¡å¼ 2. æ¨¡å¼åˆ‡æ¢ `i` è¿›å…¥ç¼–è¾‘æ¨¡å¼ `esc` è¿›å…¥å‘½ä»¤è¡Œæ¨¡å¼ 3. å‘½ä»¤æ¨¡å¼ `vim [æ–‡ä»¶]` è¿›å…¥æ–‡ä»¶æˆ–è€…åˆ›å»ºæ–‡ä»¶ï¼ˆæ–‡ä»¶ä¸å­˜åœ¨çš„æƒ…å†µä¸‹ï¼‰ `vim + [æ–‡ä»¶å]` è¿›å…¥æ–‡ä»¶å°¾éƒ¨ `vim +/[å­—ç¬¦ä¸²] [æ–‡ä»¶å]` å…‰æ ‡å®šä½åˆ°æ–‡ä»¶ç¬¬ä¸€æ¬¡å‡ºç°è¯¥å­—ç¬¦ä¸²çš„ä½ç½® 4. åº•è¡Œæ¨¡å¼ `:w` ä¿å­˜ `:q `é€€å‡º `:!` å¼ºåˆ¶ `:15` å®šä½çš„ç¬¬15è¡Œ `/[å­—ç¬¦ä¸²]` å…‰æ ‡ä½ç½®å‘åæœç´¢è¯¥å­—ç¬¦ä¸² `?[å­—ç¬¦ä¸²]` å…‰æ ‡ä½ç½®å‘å‰æœç´¢è¯¥å­—ç¬¦ä¸² `dd `åˆ é™¤å…‰æ ‡æ‰€åœ¨è¡Œ `ctr+f` å‘ä¸‹ç¿»é¡µ `ctr+b` å‘ä¸Šç¿»é¡µ #### å¸¸ç”¨æ“ä½œå¿«æ·é”® `ctr+c` ç»ˆæ­¢å½“å‰å‘½ä»¤ `ctr+l` æ¸…å± ç›¸å½“äº clear `ctr+a` å…‰æ ‡ç§»åˆ°è¡Œé¦– `ctr+e` å…‰æ ‡ç§»åˆ°è¡Œå°¾ `ctr+u` æŠŠå…‰æ ‡æ‰€åœ¨ä½ç½®åˆ é™¤åˆ°è¡Œé¦– `ctr+z` æŠŠå‘½ä»¤æ”¾å…¥åå° `ctr+r` åœ¨å†å²å‘½ä»¤ä¸­æœç´¢ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java - CompletableFuture]]></title>
    <url>%2Fposts%2Fcad2f756.html</url>
    <content type="text"><![CDATA[CompletableFutureæ˜¯Java8ä¸­å¯¹Futureçš„å¢å¼ºã€‚å®ç°CompletionStageæ¥å£(40ä½™ä¸ªæ–¹æ³•)ï¼Œå¤§å¤šæ•°æ–¹æ³•å¤šæ•°åº”ç”¨åœ¨å‡½æ•°å¼ç¼–ç¨‹ä¸­ï¼Œå¹¶ä¸”æ”¯æŒæµå¼è°ƒç”¨ã€‚ ç®€å•å®ç°ï¼š 123456789101112131415161718192021222324252627282930public class CompletableFutureTest implements Runnable { CompletableFuture&lt;Integer&gt; completableFuture = null; public CompletableFutureTest(CompletableFuture&lt;Integer&gt; completableFuture) { this.completableFuture = completableFuture; } @Override public void run() { int result = 0; try { result = completableFuture.get() * completableFuture.get(); } catch (Exception e) { } System.out.println(result); } public static void main(String[] args) throws InterruptedException, ExecutionException { final CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;(); new Thread(new CompletableFutureTest(future)).start(); //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„è®¡ç®—è¿‡ç¨‹ Thread.sleep(1000); //å‘ŠçŸ¥å®Œæˆç»“æœ future.complete(60); }} Futureæœ€ä»¤äººè¯Ÿç—…çš„å°±æ˜¯è¦ç­‰å¾…ï¼Œè¦è‡ªå·±å»æ£€æŸ¥ä»»åŠ¡æ˜¯å¦å®Œæˆäº†ï¼Œåœ¨Futureä¸­ï¼Œä»»åŠ¡å®Œæˆçš„æ—¶é—´æ˜¯ä¸å¯æ§çš„ã€‚è€ŒCompletableFutureçš„æœ€å¤§æ”¹è¿›åœ¨äºï¼Œä»»åŠ¡å®Œæˆçš„æ—¶é—´ä¹Ÿå¼€æ”¾äº†å‡ºæ¥ã€‚ CompletableFutureçš„å¼‚æ­¥æ‰§è¡Œï¼š 12345678910111213141516public static Integer calc(Integer param) { try { //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); } catch (InterruptedException e) { } return param * param;}public static void main(String[] args) throws InterruptedException, ExecutionException { //å¼‚æ­¥è°ƒç”¨ final CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; calc(50)); System.out.println(future2.get());} CompletableFutureçš„æµå¼è°ƒç”¨ï¼š 1234567891011121314151617181920public static Integer calc(Integer param) { try { //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); } catch (InterruptedException e) { } return param * param;}public static void main(String[] args) throws InterruptedException, ExecutionException { //æµå¼è°ƒç”¨ CompletableFuture&lt;Void&gt; future3 = CompletableFuture.supplyAsync(() -&gt; calc(40)) .thenApply((i) -&gt; Integer.toString(i)) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future3.get();} ç»„åˆå¤šä¸ªCompletableFutureï¼š 123456789101112public static Integer calc2(Integer param) { return param / 2;}public static void main(String[] args) throws InterruptedException, ExecutionException { //ç»„åˆå¤šä¸ªCompletableFuture CompletableFuture&lt;Void&gt; future4 = CompletableFuture.supplyAsync(() -&gt; calc2(100)) .thenCompose((i) -&gt; CompletableFuture.supplyAsync(() -&gt; calc2(i))) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future4.get();} CompletableFutureè·Ÿæ€§èƒ½ä¸Šå…³ç³»ä¸å¤§ï¼Œæ›´å¤šçš„æ˜¯ä¸ºäº†æ”¯æŒå‡½æ•°å¼ç¼–ç¨‹ï¼Œåœ¨åŠŸèƒ½ä¸Šçš„å¢å¼ºã€‚å½“ç„¶å¼€æ”¾äº†å®Œæˆæ—¶é—´çš„è®¾ç½®æ˜¯ä¸€å¤§äº®ç‚¹ã€‚ æ¼”ç¤ºçš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869package main.java.com.study.completableFuture;import java.util.concurrent.CompletableFuture;import java.util.concurrent.ExecutionException;/** * @author: whb * @description: å¢å¼ºç‰ˆFutureæµ‹è¯•ç±» */public class CompletableFutureTest implements Runnable { CompletableFuture&lt;Integer&gt; completableFuture = null; public CompletableFutureTest(CompletableFuture&lt;Integer&gt; completableFuture) { this.completableFuture = completableFuture; } @Override public void run() { int result = 0; try { result = completableFuture.get() * completableFuture.get(); } catch (Exception e) { } System.out.println(result); } public static Integer calc(Integer param) { try { //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„æ‰§è¡Œ Thread.sleep(1000); } catch (InterruptedException e) { } return param * param; } public static Integer calc2(Integer param) { return param / 2; } public static void main(String[] args) throws InterruptedException, ExecutionException { final CompletableFuture&lt;Integer&gt; future = new CompletableFuture&lt;&gt;(); new Thread(new CompletableFutureTest(future)).start(); //æ¨¡æ‹Ÿé•¿æ—¶é—´çš„è®¡ç®—è¿‡ç¨‹ Thread.sleep(1000); //å‘ŠçŸ¥å®Œæˆç»“æœ future.complete(60); //å¼‚æ­¥è°ƒç”¨ final CompletableFuture&lt;Integer&gt; future2 = CompletableFuture.supplyAsync(() -&gt; calc(50)); System.out.println(future2.get()); //æµå¼è°ƒç”¨ CompletableFuture&lt;Void&gt; future3 = CompletableFuture.supplyAsync(() -&gt; calc(40)) .thenApply((i) -&gt; Integer.toString(i)) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future3.get(); //ç»„åˆå¤šä¸ªCompletableFuture CompletableFuture&lt;Void&gt; future4 = CompletableFuture.supplyAsync(() -&gt; calc2(100)) .thenCompose((i) -&gt; CompletableFuture.supplyAsync(() -&gt; calc2(i))) .thenApply((str) -&gt; "\"" + str + "\"") .thenAccept(System.out::println); future4.get(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-12ä¹‹-Callableã€Futureã€FutureTask]]></title>
    <url>%2Fposts%2F75995567.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ä»Java 1.5å¼€å§‹ï¼Œå¼€å§‹æä¾›äº†Callableå’ŒFutureï¼Œé€šè¿‡å®ƒä»¬å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå¾—åˆ°ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ å¯¹æ¯”Runnableå’ŒCallbale Runnableæ˜¯åœ¨java.lang.RunnableåŒ…ä¸‹é¢ï¼Œæ²¡æœ‰è¿”å›å€¼ï¼Œè€ŒCallableæ˜¯åœ¨java.util.concurrentåŒ…ä¸‹é¢ï¼ˆè¯´æ˜Callableæ˜¯ä¸ºå¹¶å‘ç¼–ç¨‹åšå‡†å¤‡çš„ï¼‰å¯ä»¥æœ‰è¿”å›å€¼ã€‚ Callableä¸èƒ½ä½¿ç”¨Threadæ¥ç›´æ¥æ‰§è¡Œï¼Œä¸€èˆ¬æƒ…å†µä¸‹é¢ä½¿ç”¨ExecutorServiceä¸­çš„submitæ–¹æ³•ç±»æ‰§è¡Œï¼ŒRunnableä½¿ç”¨ExecutorServiceçš„executeæ¥æ‰§è¡Œã€‚ Runnableæ¥å£é‡Œé¢æœ‰ä¸€ä¸ªrun()æ–¹æ³•ï¼Œæ— è¿”å›å€¼ï¼›Callableæ¥å£é‡Œé¢æœ‰ä¸€ä¸ªcall()ï¼Œæœ‰è¿”å›å€¼ï¼Œå¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚ Future Futureå°±æ˜¯å¯¹äºå…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€‚å¿…è¦æ—¶å¯ä»¥é€šè¿‡getæ–¹æ³•è·å–æ‰§è¡Œç»“æœï¼Œè¯¥æ–¹æ³•ä¼šé˜»å¡ç›´åˆ°ä»»åŠ¡è¿”å›ç»“æœã€‚ åœ¨Futureæ¥å£ä¸­å£°æ˜äº†5ä¸ªæ–¹æ³•ï¼Œä¾æ¬¡è§£é‡Šæ¯ä¸ªæ–¹æ³•çš„ä½œç”¨ï¼š cancelæ–¹æ³•ç”¨æ¥å–æ¶ˆä»»åŠ¡ï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡æˆåŠŸåˆ™è¿”å›trueï¼Œå¦‚æœå–æ¶ˆä»»åŠ¡å¤±è´¥åˆ™è¿”å›falseã€‚å‚æ•°mayInterruptIfRunningè¡¨ç¤ºæ˜¯å¦å…è®¸å–æ¶ˆæ­£åœ¨æ‰§è¡Œå´æ²¡æœ‰æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ï¼Œå¦‚æœè®¾ç½®trueï¼Œåˆ™è¡¨ç¤ºå¯ä»¥å–æ¶ˆæ­£åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä»»åŠ¡ã€‚å¦‚æœä»»åŠ¡å·²ç»å®Œæˆï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œæ­¤æ–¹æ³•è‚¯å®šè¿”å›falseï¼Œå³å¦‚æœå–æ¶ˆå·²ç»å®Œæˆçš„ä»»åŠ¡ä¼šè¿”å›falseï¼›å¦‚æœä»»åŠ¡æ­£åœ¨æ‰§è¡Œï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºtrueï¼Œåˆ™è¿”å›trueï¼Œè‹¥mayInterruptIfRunningè®¾ç½®ä¸ºfalseï¼Œåˆ™è¿”å›falseï¼›å¦‚æœä»»åŠ¡è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œåˆ™æ— è®ºmayInterruptIfRunningä¸ºtrueè¿˜æ˜¯falseï¼Œè‚¯å®šè¿”å›trueã€‚ isCancelledæ–¹æ³•è¡¨ç¤ºä»»åŠ¡æ˜¯å¦è¢«å–æ¶ˆæˆåŠŸï¼Œå¦‚æœåœ¨ä»»åŠ¡æ­£å¸¸å®Œæˆå‰è¢«å–æ¶ˆæˆåŠŸï¼Œåˆ™è¿”å› trueã€‚ isDoneæ–¹æ³•è¡¨ç¤ºä»»åŠ¡æ˜¯å¦å·²ç»å®Œæˆï¼Œè‹¥ä»»åŠ¡å®Œæˆï¼Œåˆ™è¿”å›trueï¼› get()æ–¹æ³•ç”¨æ¥è·å–æ‰§è¡Œç»“æœï¼Œè¿™ä¸ªæ–¹æ³•ä¼šäº§ç”Ÿé˜»å¡ï¼Œä¼šä¸€ç›´ç­‰åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•æ‰è¿”å›ï¼› get(long timeout, TimeUnit unit)ç”¨æ¥è·å–æ‰§è¡Œç»“æœï¼Œå¦‚æœåœ¨æŒ‡å®šæ—¶é—´å†…ï¼Œè¿˜æ²¡è·å–åˆ°ç»“æœï¼Œå°±ç›´æ¥è¿”å›nullã€‚ ä¹Ÿå°±æ˜¯è¯´Futureæä¾›äº†ä¸‰ç§åŠŸèƒ½ï¼š 1ï¼‰åˆ¤æ–­ä»»åŠ¡æ˜¯å¦å®Œæˆï¼› 2ï¼‰èƒ½å¤Ÿä¸­æ–­ä»»åŠ¡ï¼› 3ï¼‰èƒ½å¤Ÿè·å–ä»»åŠ¡æ‰§è¡Œç»“æœã€‚ å› ä¸ºFutureåªæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€ä»¥æ˜¯æ— æ³•ç›´æ¥ç”¨æ¥åˆ›å»ºå¯¹è±¡ä½¿ç”¨çš„ï¼Œå› æ­¤å°±æœ‰äº†FutureTaskã€‚ FutureTask å…ˆæ¥çœ‹ä¸€ä¸‹FutureTaskçš„å®ç°ï¼š 1public class FutureTask&lt;V&gt; implements RunnableFuture&lt;V&gt; FutureTaskç±»å®ç°äº†RunnableFutureæ¥å£ï¼Œçœ‹ä¸€ä¸‹RunnableFutureæ¥å£çš„å®ç°ï¼š 123public interface RunnableFuture&lt;V&gt; extends Runnable, Future&lt;V&gt; { void run();} å¯ä»¥çœ‹å‡ºRunnableFutureç»§æ‰¿äº†Runnableæ¥å£å’ŒFutureæ¥å£ï¼Œè€ŒFutureTaskå®ç°äº†RunnableFutureæ¥å£ã€‚æ‰€ä»¥å®ƒæ—¢å¯ä»¥ä½œä¸ºRunnableè¢«çº¿ç¨‹æ‰§è¡Œï¼Œåˆå¯ä»¥ä½œä¸ºFutureå¾—åˆ°Callableçš„è¿”å›å€¼ã€‚ FutureTaskæä¾›äº†2ä¸ªæ„é€ å™¨ï¼š 1234public FutureTask(Callable&lt;V&gt; callable) {}public FutureTask(Runnable runnable, V result) {} äº‹å®ä¸Šï¼ŒFutureTaskæ˜¯Futureæ¥å£çš„ä¸€ä¸ªå”¯ä¸€å®ç°ç±»ã€‚ ä½¿ç”¨ç¤ºä¾‹ ä½¿ç”¨Callable+Futureè·å–æ‰§è¡Œç»“æœ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.thread;import java.util.concurrent.*;/** * @author: whb * @description: ä½¿ç”¨Callable+Futureè·å–æ‰§è¡Œç»“æœ */public class TestCallableFuture { public static void main(String[] args) { ExecutorService executor = Executors.newCachedThreadPool(); Task task = new Task(); Future&lt;Integer&gt; result = executor.submit(task); executor.shutdown(); try { Thread.sleep(1000); } catch (InterruptedException e1) { e1.printStackTrace(); } System.out.println("ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡"); try { System.out.println("taskè¿è¡Œç»“æœ" + result.get()); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } System.out.println("æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•"); }}class Task implements Callable&lt;Integer&gt; { @Override public Integer call() throws Exception { System.out.println("å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—"); Thread.sleep(3000); int sum = 0; for (int i = 0; i &lt; 100; i++) { sum += i; } return sum; }} æ‰§è¡Œç»“æœï¼š 1234å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡taskè¿è¡Œç»“æœ4950æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯• ä½¿ç”¨Callable+FutureTaskè·å–æ‰§è¡Œç»“æœ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354package main.java.com.study.thread;import java.util.concurrent.*;/** * @author: whb * @description: ä½¿ç”¨Callable+FutureTaskè·å–æ‰§è¡Œç»“æœ */public class TestCallableFutureTask { public static void main(String[] args) { //ç¬¬ä¸€ç§æ–¹å¼ ExecutorService executor = Executors.newCachedThreadPool(); Task2 task = new Task2(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(task); executor.submit(futureTask); executor.shutdown(); //ç¬¬äºŒç§æ–¹å¼ï¼Œæ³¨æ„è¿™ç§æ–¹å¼å’Œç¬¬ä¸€ç§æ–¹å¼æ•ˆæœæ˜¯ç±»ä¼¼çš„ï¼Œåªä¸è¿‡ä¸€ä¸ªä½¿ç”¨çš„æ˜¯ExecutorServiceï¼Œä¸€ä¸ªä½¿ç”¨çš„æ˜¯Thread /*Task task = new Task(); FutureTask&lt;Integer&gt; futureTask = new FutureTask&lt;Integer&gt;(task); Thread thread = new Thread(futureTask); thread.start();*/ try { Thread.sleep(1000); } catch (InterruptedException e1) { e1.printStackTrace(); } System.out.println("ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡"); try { System.out.println("taskè¿è¡Œç»“æœ" + futureTask.get()); } catch (InterruptedException e) { e.printStackTrace(); } catch (ExecutionException e) { e.printStackTrace(); } System.out.println("æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯•"); }}class Task2 implements Callable&lt;Integer&gt; { @Override public Integer call() throws Exception { System.out.println("å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—"); Thread.sleep(3000); int sum = 0; for (int i = 0; i &lt; 100; i++) sum += i; return sum; }} æ‰§è¡Œç»“æœï¼š 1234å­çº¿ç¨‹åœ¨è¿›è¡Œè®¡ç®—ä¸»çº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡taskè¿è¡Œç»“æœ4950æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæ¯• å¦‚æœä¸ºäº†å¯å–æ¶ˆæ€§è€Œä½¿ç”¨ Future ä½†åˆä¸æä¾›å¯ç”¨çš„ç»“æœï¼Œåˆ™å¯ä»¥å£°æ˜ Future&lt;?&gt; å½¢å¼ç±»å‹ã€å¹¶è¿”å› null ä½œä¸ºåº•å±‚ä»»åŠ¡çš„ç»“æœã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-11ä¹‹-ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹]]></title>
    <url>%2Fposts%2F4189fc6.html</url>
    <content type="text"><![CDATA[ç”Ÿäº§è€…/æ¶ˆè´¹è€…æ¨¡å‹ ç”Ÿäº§/æ¶ˆè´¹è€…é—®é¢˜æ˜¯ä¸ªéå¸¸å…¸å‹çš„å¤šçº¿ç¨‹é—®é¢˜ï¼Œæ¶‰åŠåˆ°çš„å¯¹è±¡åŒ…æ‹¬â€œç”Ÿäº§è€…â€ã€â€œæ¶ˆè´¹è€…â€ã€â€œä»“åº“â€å’Œâ€œäº§å“â€ã€‚ä»–ä»¬ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹ï¼š ç”Ÿäº§è€…ä»…ä»…åœ¨ä»“å‚¨æœªæ»¡æ—¶å€™ç”Ÿäº§ï¼Œä»“æ»¡åˆ™åœæ­¢ç”Ÿäº§ã€‚ æ¶ˆè´¹è€…ä»…ä»…åœ¨ä»“å‚¨æœ‰äº§å“æ—¶å€™æ‰èƒ½æ¶ˆè´¹ï¼Œä»“ç©ºåˆ™ç­‰å¾…ã€‚ å½“æ¶ˆè´¹è€…å‘ç°ä»“å‚¨æ²¡äº§å“å¯æ¶ˆè´¹æ—¶å€™ä¼šé€šçŸ¥ç”Ÿäº§è€…ç”Ÿäº§ã€‚ ç”Ÿäº§è€…åœ¨ç”Ÿäº§å‡ºå¯æ¶ˆè´¹äº§å“æ—¶å€™ï¼Œåº”è¯¥é€šçŸ¥ç­‰å¾…çš„æ¶ˆè´¹è€…å»æ¶ˆè´¹ã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140package main.java.com.study.thread;/** * @author: whb * @description: ç”Ÿäº§è€…æ¶ˆè´¹è€…æ¨¡å‹æµ‹è¯• */public class ProducerConsumerDemo { public static void main(String[] args) { Depot mDepot = new Depot(100); Producer mPro = new Producer(mDepot); Customer mCus = new Customer(mDepot); mPro.produce(60); mPro.produce(120); mCus.consume(90); mCus.consume(150); mPro.produce(110); }}/** * ä»“åº“ */class Depot { /** * ä»“åº“çš„å®¹é‡ */ private int capacity; /** * ä»“åº“çš„å®é™…æ•°é‡ */ private int size; public Depot(int capacity) { this.capacity = capacity; this.size = 0; } /** * ç”Ÿäº§ * * @param val */ public synchronized void produce(int val) { try { // left è¡¨ç¤ºâ€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€(æœ‰å¯èƒ½ç”Ÿäº§é‡å¤ªå¤šï¼Œéœ€å¤šæ­¤ç”Ÿäº§) int left = val; while (left &gt; 0) { // åº“å­˜å·²æ»¡æ—¶ï¼Œç­‰å¾…â€œæ¶ˆè´¹è€…â€æ¶ˆè´¹äº§å“ã€‚ while (size &gt;= capacity) { wait(); } // è·å–â€œå®é™…ç”Ÿäº§çš„æ•°é‡â€(å³åº“å­˜ä¸­æ–°å¢çš„æ•°é‡) // å¦‚æœâ€œåº“å­˜â€+â€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€&gt;â€œæ€»çš„å®¹é‡â€ï¼Œåˆ™â€œå®é™…å¢é‡â€=â€œæ€»çš„å®¹é‡â€-â€œå½“å‰å®¹é‡â€ã€‚(æ­¤æ—¶å¡«æ»¡ä»“åº“) // å¦åˆ™â€œå®é™…å¢é‡â€=â€œæƒ³è¦ç”Ÿäº§çš„æ•°é‡â€ int inc = (size + left) &gt; capacity ? (capacity - size) : left; size += inc; left -= inc; System.out.printf("%s produce(%3d) --&gt; left=%3d, inc=%3d, size=%3d\n", Thread.currentThread().getName(), val, left, inc, size); // é€šçŸ¥â€œæ¶ˆè´¹è€…â€å¯ä»¥æ¶ˆè´¹äº†ã€‚ notifyAll(); } } catch (InterruptedException e) { } } /** * æ¶ˆè´¹ * * @param val */ public synchronized void consume(int val) { try { // left è¡¨ç¤ºâ€œå®¢æˆ·è¦æ¶ˆè´¹æ•°é‡â€(æœ‰å¯èƒ½æ¶ˆè´¹é‡å¤ªå¤§ï¼Œåº“å­˜ä¸å¤Ÿï¼Œéœ€å¤šæ­¤æ¶ˆè´¹) int left = val; while (left &gt; 0) { // åº“å­˜ä¸º0æ—¶ï¼Œç­‰å¾…â€œç”Ÿäº§è€…â€ç”Ÿäº§äº§å“ã€‚ while (size &lt;= 0) { wait(); } // è·å–â€œå®é™…æ¶ˆè´¹çš„æ•°é‡â€(å³åº“å­˜ä¸­å®é™…å‡å°‘çš„æ•°é‡) // å¦‚æœâ€œåº“å­˜â€&lt;â€œå®¢æˆ·è¦æ¶ˆè´¹çš„æ•°é‡â€ï¼Œåˆ™â€œå®é™…æ¶ˆè´¹é‡â€=â€œåº“å­˜â€ï¼› // å¦åˆ™ï¼Œâ€œå®é™…æ¶ˆè´¹é‡â€=â€œå®¢æˆ·è¦æ¶ˆè´¹çš„æ•°é‡â€ã€‚ int dec = (size &lt; left) ? size : left; size -= dec; left -= dec; System.out.printf("%s consume(%3d) &lt;-- left=%3d, dec=%3d, size=%3d\n", Thread.currentThread().getName(), val, left, dec, size); notifyAll(); } } catch (InterruptedException e) { } } @Override public String toString() { return "capacity:" + capacity + ", actual size:" + size; }}/** * ç”Ÿäº§è€… */class Producer { private Depot depot; public Producer(Depot depot) { this.depot = depot; } /** * æ¶ˆè´¹äº§å“ï¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å‘ä»“åº“ä¸­ç”Ÿäº§äº§å“ã€‚ * * @param val */ public void produce(final int val) { new Thread(() -&gt; depot.produce(val)).start(); }}/** * æ¶ˆè´¹è€… */class Customer { private Depot depot; public Customer(Depot depot) { this.depot = depot; } /** * æ¶ˆè´¹äº§å“ï¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ä»ä»“åº“ä¸­æ¶ˆè´¹äº§å“ã€‚ * * @param val */ public void consume(final int val) { new Thread(() -&gt; depot.consume(val)).start(); }} &lt;span id="inline-blue"&gt; è¯´æ˜ï¼š &lt;/span&gt; Produceræ˜¯â€œç”Ÿäº§è€…â€ç±»ï¼Œå®ƒä¸â€œä»“åº“(depot)â€å…³è”ã€‚å½“è°ƒç”¨â€œç”Ÿäº§è€…â€çš„produce()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å¹¶å‘â€œä»“åº“â€ä¸­ç”Ÿäº§äº§å“ã€‚ Customeræ˜¯â€œæ¶ˆè´¹è€…â€ç±»ï¼Œå®ƒä¸â€œä»“åº“(depot)â€å…³è”ã€‚å½“è°ƒç”¨â€œæ¶ˆè´¹è€…â€çš„consume()æ–¹æ³•æ—¶ï¼Œå®ƒä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹å¹¶æ¶ˆè´¹â€œä»“åº“â€ä¸­çš„äº§å“ã€‚ Depotæ˜¯â€œä»“åº“â€ç±»ï¼Œä»“åº“ä¸­è®°å½•â€œä»“åº“çš„å®¹é‡(capacity)â€ä»¥åŠâ€œä»“åº“ä¸­å½“å‰äº§å“æ•°ç›®(size)â€ã€‚ â€œä»“åº“â€ç±»çš„ç”Ÿäº§æ–¹æ³•produce()å’Œæ¶ˆè´¹æ–¹æ³•consume()æ–¹æ³•éƒ½æ˜¯synchronizedæ–¹æ³•ï¼Œè¿›å…¥synchronizedæ–¹æ³•ä½“ï¼Œæ„å‘³ç€è¿™ä¸ªçº¿ç¨‹è·å–åˆ°äº†è¯¥â€œä»“åº“â€å¯¹è±¡çš„åŒæ­¥é”ã€‚è¿™ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŒä¸€æ—¶é—´ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹åªèƒ½æœ‰ä¸€ä¸ªèƒ½è¿è¡Œã€‚é€šè¿‡åŒæ­¥é”ï¼Œå®ç°äº†å¯¹â€œæ®‹é…·â€çš„äº’æ–¥è®¿é—®ã€‚ å¯¹äºç”Ÿäº§æ–¹æ³•produce()è€Œè¨€ï¼šå½“ä»“åº“æ»¡æ—¶ï¼Œç”Ÿäº§è€…çº¿ç¨‹ç­‰å¾…ï¼Œéœ€è¦ç­‰å¾…æ¶ˆè´¹è€…æ¶ˆè´¹äº§å“ä¹‹åï¼Œç”Ÿäº§çº¿ç¨‹æ‰èƒ½ç”Ÿäº§ï¼›ç”Ÿäº§è€…çº¿ç¨‹ç”Ÿäº§å®Œäº§å“ä¹‹åï¼Œä¼šé€šè¿‡notifyAll()å”¤é†’åŒæ­¥é”ä¸Šçš„æ‰€æœ‰çº¿ç¨‹ï¼ŒåŒ…æ‹¬â€œæ¶ˆè´¹è€…çº¿ç¨‹â€ï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„â€œé€šçŸ¥æ¶ˆè´¹è€…è¿›è¡Œæ¶ˆè´¹â€ã€‚ å¯¹äºæ¶ˆè´¹æ–¹æ³•consume()è€Œè¨€ï¼šå½“ä»“åº“ä¸ºç©ºæ—¶ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹ç­‰å¾…ï¼Œéœ€è¦ç­‰å¾…ç”Ÿäº§è€…ç”Ÿäº§äº§å“ä¹‹åï¼Œæ¶ˆè´¹è€…çº¿ç¨‹æ‰èƒ½æ¶ˆè´¹ï¼›æ¶ˆè´¹è€…çº¿ç¨‹æ¶ˆè´¹å®Œäº§å“ä¹‹åï¼Œä¼šé€šè¿‡notifyAll()å”¤é†’åŒæ­¥é”ä¸Šçš„æ‰€æœ‰çº¿ç¨‹ï¼ŒåŒ…æ‹¬â€œç”Ÿäº§è€…çº¿ç¨‹â€ï¼Œå³æˆ‘ä»¬æ‰€è¯´çš„â€œé€šçŸ¥ç”Ÿäº§è€…è¿›è¡Œç”Ÿäº§â€ã€‚ &lt;span id="inline-green"&gt; (æŸä¸€æ¬¡)è¿è¡Œç»“æœï¼š &lt;/span&gt; Thread-0 produce( 60) --&gt; left= 0, inc= 60, size= 60 Thread-4 produce(110) --&gt; left= 70, inc= 40, size=100 Thread-3 consume(150) &lt;-- left= 50, dec=100, size= 0 Thread-1 produce(120) --&gt; left= 20, inc=100, size=100 Thread-2 consume( 90) &lt;-- left= 0, dec= 90, size= 10 Thread-3 consume(150) &lt;-- left= 40, dec= 10, size= 0 Thread-4 produce(110) --&gt; left= 0, inc= 70, size= 70 Thread-3 consume(150) &lt;-- left= 0, dec= 40, size= 30 Thread-1 produce(120) --&gt; left= 0, inc= 20, size= 50 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-æ¨¡æ¿æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2Fposts%2F2d3dc485.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å®šä¹‰ä¸€ä¸ªæ“ä½œä¸­ç®—æ³•çš„æ¡†æ¶ï¼Œè€Œå°†ä¸€äº›æ­¥éª¤å»¶è¿Ÿåˆ°å­ç±»ä¸­ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼ä½¿å¾—å­ç±»å¯ä»¥ä¸æ”¹å˜ä¸€ä¸ªç®—æ³•çš„ç»“æ„å³å¯é‡å®šä¹‰è¯¥ç®—æ³•çš„æŸäº›ç‰¹å®šæ­¥éª¤ã€‚æ¨¡æ¿æ–¹æ³•æ¨¡å¼æ˜¯ä¸€ç§åŸºäºç»§æ‰¿çš„ä»£ç å¤ç”¨æŠ€æœ¯ï¼Œå®ƒæ˜¯ä¸€ç§ç±»è¡Œä¸ºå‹æ¨¡å¼ã€‚ ä¸»è¦ä½œç”¨ å½“å®Œæˆä¸€ä¸ªæ“ä½œå…·æœ‰å›ºå®šçš„æµç¨‹æ—¶ï¼Œç”±æŠ½è±¡å›ºå®šæµç¨‹æ­¥éª¤ï¼Œå…·ä½“æ­¥éª¤äº¤ç»™å­ç±»è¿›è¡Œå…·ä½“å®ç°ï¼ˆå›ºå®šçš„æµç¨‹ï¼Œä¸åŒçš„å®ç°ï¼‰ã€‚ UMLç±»å›¾ è§’è‰² AbstractClassï¼ˆæŠ½è±¡ç±»ï¼‰ï¼šåœ¨æŠ½è±¡ç±»ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—åŸºæœ¬æ“ä½œ(PrimitiveOperations)ï¼Œè¿™äº›åŸºæœ¬æ“ä½œå¯ä»¥æ˜¯å…·ä½“çš„ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡çš„ï¼Œæ¯ä¸€ä¸ªåŸºæœ¬æ“ä½œå¯¹åº”ç®—æ³•çš„ä¸€ä¸ªæ­¥éª¤ï¼Œåœ¨å…¶å­ç±»ä¸­å¯ä»¥é‡å®šä¹‰æˆ–å®ç°è¿™äº›æ­¥éª¤ã€‚åŒæ—¶ï¼Œåœ¨æŠ½è±¡ç±»ä¸­å®ç°äº†ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•(Template Method)ï¼Œç”¨äºå®šä¹‰ä¸€ä¸ªç®—æ³•çš„æ¡†æ¶ï¼Œæ¨¡æ¿æ–¹æ³•ä¸ä»…å¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡ç±»ä¸­å®ç°çš„åŸºæœ¬æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥è°ƒç”¨åœ¨æŠ½è±¡ç±»çš„å­ç±»ä¸­å®ç°çš„åŸºæœ¬æ–¹æ³•ï¼Œè¿˜å¯ä»¥è°ƒç”¨å…¶ä»–å¯¹è±¡ä¸­çš„æ–¹æ³•ã€‚ ConcreteClassï¼ˆå…·ä½“å­ç±»ï¼‰ï¼šå®ƒæ˜¯æŠ½è±¡ç±»çš„å­ç±»ï¼Œç”¨äºå®ç°åœ¨çˆ¶ç±»ä¸­å£°æ˜çš„æŠ½è±¡åŸºæœ¬æ“ä½œä»¥å®Œæˆå­ç±»ç‰¹å®šç®—æ³•çš„æ­¥éª¤ï¼Œä¹Ÿå¯ä»¥è¦†ç›–åœ¨çˆ¶ç±»ä¸­å·²ç»å®ç°çš„å…·ä½“åŸºæœ¬æ“ä½œã€‚ æ¨¡å¼åŸç† ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æ˜¯å®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­çš„ã€æŠŠåŸºæœ¬æ“ä½œæ–¹æ³•ç»„åˆåœ¨ä¸€èµ·å½¢æˆä¸€ä¸ªæ€»ç®—æ³•æˆ–ä¸€ä¸ªæ€»è¡Œä¸ºçš„æ–¹æ³•ã€‚è¿™ä¸ªæ¨¡æ¿æ–¹æ³•å®šä¹‰åœ¨æŠ½è±¡ç±»ä¸­ï¼Œå¹¶ç”±å­ç±»ä¸åŠ ä»¥ä¿®æ”¹åœ°å®Œå…¨ç»§æ‰¿ä¸‹æ¥ã€‚æ¨¡æ¿æ–¹æ³•æ˜¯ä¸€ä¸ªå…·ä½“æ–¹æ³•ï¼Œå®ƒç»™å‡ºäº†ä¸€ä¸ªé¡¶å±‚é€»è¾‘æ¡†æ¶ï¼Œè€Œé€»è¾‘çš„ç»„æˆæ­¥éª¤åœ¨æŠ½è±¡ç±»ä¸­å¯ä»¥æ˜¯å…·ä½“æ–¹æ³•ï¼Œä¹Ÿå¯ä»¥æ˜¯æŠ½è±¡æ–¹æ³•ã€‚ åŸºæœ¬æ–¹æ³•æ˜¯å®ç°ç®—æ³•å„ä¸ªæ­¥éª¤çš„æ–¹æ³•ï¼Œæ˜¯æ¨¡æ¿æ–¹æ³•çš„ç»„æˆéƒ¨åˆ†ã€‚åŸºæœ¬æ–¹æ³•åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼šæŠ½è±¡æ–¹æ³•(Abstract Method)ã€å…·ä½“æ–¹æ³•(Concrete Method)å’Œé’©å­æ–¹æ³•(Hook Method)ã€‚ æŠ½è±¡æ–¹æ³•ï¼šä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”±æŠ½è±¡ç±»å£°æ˜ã€ç”±å…¶å…·ä½“å­ç±»å®ç°ã€‚ å…·ä½“æ–¹æ³•ï¼šä¸€ä¸ªå…·ä½“æ–¹æ³•ç”±ä¸€ä¸ªæŠ½è±¡ç±»æˆ–å…·ä½“ç±»å£°æ˜å¹¶å®ç°ï¼Œå…¶å­ç±»å¯ä»¥è¿›è¡Œè¦†ç›–ä¹Ÿå¯ä»¥ç›´æ¥ç»§æ‰¿ã€‚ é’©å­æ–¹æ³•ï¼šå¯ä»¥ä¸ä¸€äº›å…·ä½“æ­¥éª¤ â€œæŒ‚é’©â€ ï¼Œä»¥å®ç°åœ¨ä¸åŒæ¡ä»¶ä¸‹æ‰§è¡Œæ¨¡æ¿æ–¹æ³•ä¸­çš„ä¸åŒæ­¥éª¤ã€‚ æ¨¡å¼ä¼˜ç‚¹ æé«˜ä»£ç å¤ç”¨æ€§ï¼šå°†ç›¸åŒéƒ¨åˆ†çš„ä»£ç æ”¾åœ¨æŠ½è±¡çš„çˆ¶ç±»ä¸­ã€‚ æé«˜äº†æ‹“å±•æ€§ï¼šå°†ä¸åŒçš„ä»£ç æ”¾å…¥ä¸åŒçš„å­ç±»ä¸­ï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢åŠ æ–°çš„è¡Œä¸ºã€‚ å®ç°äº†åå‘æ§åˆ¶ï¼šé€šè¿‡ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å…¶å­ç±»çš„æ“ä½œï¼Œé€šè¿‡å¯¹å­ç±»çš„æ‰©å±•å¢åŠ æ–°çš„è¡Œä¸ºï¼Œå®ç°äº†åå‘æ§åˆ¶ï¼Œç¬¦åˆâ€œå•ä¸€èŒè´£â€å’Œâ€œå¼€é—­åŸåˆ™â€ æ¨¡å¼ç¼ºç‚¹ å¼•å…¥äº†æŠ½è±¡ç±»ï¼Œæ¯ä¸€ä¸ªä¸åŒçš„å®ç°éƒ½éœ€è¦ä¸€ä¸ªå­ç±»æ¥å®ç°ï¼Œå¯¼è‡´ç±»çš„ä¸ªæ•°å¢åŠ ï¼Œä»è€Œå¢åŠ äº†ç³»ç»Ÿå®ç°çš„å¤æ‚åº¦ã€‚ é€‚ç”¨åœºæ™¯ ä¸€æ¬¡æ€§å®ç°ä¸€ä¸ªç®—æ³•çš„ä¸å˜éƒ¨åˆ†ï¼Œå¹¶å°†å¯å˜çš„è¡Œä¸ºç•™ç»™å­ç±»æ¥å®ç°ã€‚ å„å­ç±»ä¸­å…¬å…±çš„è¡Œä¸ºåº”è¢«æå–å‡ºæ¥å¹¶é›†ä¸­åˆ°ä¸€ä¸ªå…¬å…±çˆ¶ç±»ä¸­ä»¥é¿å…ä»£ç é‡å¤ã€‚ éœ€è¦é€šè¿‡å­ç±»æ¥å†³å®šçˆ¶ç±»ç®—æ³•ä¸­æŸä¸ªæ­¥éª¤æ˜¯å¦æ‰§è¡Œï¼Œå®ç°å­ç±»å¯¹çˆ¶ç±»çš„åå‘æ§åˆ¶ã€‚ ä½¿ç”¨æ­¥éª¤ æŠ½è±¡æ¨¡æ¿ç±» 12345678910111213141516171819202122232425262728package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: æŠ½è±¡æ¨¡æ¿ç±»ï¼Œå®šä¹‰äº†ä¸€å¥—ç®—æ³•æ¡†æ¶/æµç¨‹ï¼› */public abstract class AbstractClass { protected void step1() { System.out.println("AbstractClass:step1"); } protected void step2() { System.out.println("AbstractClass:step2"); } protected void step3() { System.out.println("AbstractClass:step3"); } /** * å›ºå®šç®—æ³•ï¼Œå£°æ˜ä¸ºfinalæ–¹æ³•ï¼Œé¿å…å­ç±»è¦†å†™ */ public final void templateMehthod() { this.step1(); this.step2(); this.step3(); }} å…·ä½“å®ç°ç±» 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: å…·ä½“å®ç°ç±»A */public class ConcreteClassA extends AbstractClass { @Override protected void step1() { System.out.println("ConcreateClassA:step1"); }}package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: å…·ä½“å®ç°ç±»B */public class ConcreteClassB extends AbstractClass { @Override protected void step2() { System.out.println("ConcreateClassB:step2"); }} å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314package main.java.com.study.designPatterns.templateMethod.demoOne;/** * @author: whb * @description: æµ‹è¯•ç±» */public class Client { public static void main(String[] args) { AbstractClass abc = new ConcreteClassA(); abc.templateMehthod(); abc = new ConcreteClassB(); abc.templateMehthod(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ•°æ®åº“é”æœºåˆ¶åŠäº‹åŠ¡éš”ç¦»çº§åˆ«]]></title>
    <url>%2Fposts%2F57a9974a.html</url>
    <content type="text"><![CDATA[å‰è¨€ ç”¨T1ä»£è¡¨ä¸€ä¸ªæ•°æ®åº“æ‰§è¡Œè¯·æ±‚ï¼ŒT2ä»£è¡¨å¦ä¸€ä¸ªè¯·æ±‚ï¼Œä¹Ÿå¯ä»¥ç†è§£ä¸ºT1ä¸ºä¸€ä¸ªçº¿ç¨‹ï¼ŒT2 ä¸ºå¦ä¸€ä¸ªçº¿ç¨‹ã€‚T3,T4ä»¥æ­¤ç±»æ¨ã€‚ é”çš„ç§ç±» å…±äº«é”(Shared lock) &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹1ï¼š 12T1: select * from table (è¯·æƒ³è±¡å®ƒéœ€è¦æ‰§è¡Œ1ä¸ªå°æ—¶ä¹‹ä¹…ï¼Œåé¢çš„sqlè¯­å¥è¯·éƒ½è¿™ä¹ˆæƒ³è±¡ï¼‰T2: update table set column1='hello' &lt;i class="fa fa-cog"&gt;&lt;/i&gt; è¿‡ç¨‹ï¼š T1è¿è¡Œ ï¼ˆåŠ å…±äº«é”)T2è¿è¡ŒIf T1 è¿˜æ²¡æ‰§è¡Œå®ŒT2ç­‰......elseé”è¢«é‡Šæ”¾T2æ‰§è¡Œendif T2ä¹‹æ‰€ä»¥è¦ç­‰ï¼Œæ˜¯å› ä¸ºT2åœ¨æ‰§è¡Œupdateå‰ï¼Œè¯•å›¾å¯¹tableè¡¨åŠ ä¸€ä¸ªæ’ä»–é”ï¼Œè€Œæ•°æ®åº“è§„å®šåŒä¸€èµ„æºä¸Šä¸èƒ½åŒæ—¶å…±å­˜å…±äº«é”å’Œæ’ä»–é”ã€‚æ‰€ä»¥T2å¿…é¡»ç­‰T1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†å…±äº«é”ï¼Œæ‰èƒ½åŠ ä¸Šæ’ä»–é”ï¼Œç„¶åæ‰èƒ½å¼€å§‹æ‰§è¡Œupdateè¯­å¥ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹2ï¼š 12T1: select * from tableT2: select * from table è¿™é‡ŒT2ä¸ç”¨ç­‰å¾…T1æ‰§è¡Œå®Œï¼Œè€Œæ˜¯å¯ä»¥é©¬ä¸Šæ‰§è¡Œã€‚ &lt;i class="fa fa-cog"&gt;&lt;/i&gt; åˆ†æï¼š T1è¿è¡Œï¼Œåˆ™tableè¢«åŠ é”ï¼Œæ¯”å¦‚å«lockAï¼ŒT2è¿è¡Œï¼Œå†å¯¹tableåŠ ä¸€ä¸ªå…±äº«é”ï¼Œæ¯”å¦‚å«lockBã€‚ä¸¤ä¸ªé”æ˜¯å¯ä»¥åŒæ—¶å­˜åœ¨äºåŒä¸€èµ„æºä¸Šçš„ï¼ˆæ¯”å¦‚åŒä¸€ä¸ªè¡¨ä¸Šï¼‰ã€‚è¿™è¢«ç§°ä¸ºå…±äº«é”ä¸å…±äº«é”å…¼å®¹ã€‚è¿™æ„å‘³ç€å…±äº«é”ä¸é˜»æ­¢å…¶å®ƒsessionåŒæ—¶è¯»èµ„æºï¼Œä½†é˜»æ­¢å…¶å®ƒsession update &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹3ï¼š 123T1: select * from tableT2: select * from tableT3: update table set column1='hello' è¿™æ¬¡ï¼ŒT2ä¸ç”¨ç­‰T1è¿è¡Œå®Œå°±èƒ½è¿è¡Œï¼ŒT3å´è¦ç­‰T1å’ŒT2éƒ½è¿è¡Œå®Œæ‰èƒ½è¿è¡Œã€‚ å› ä¸ºT3å¿…é¡»ç­‰T1å’ŒT2çš„å…±äº«é”å…¨éƒ¨é‡Šæ”¾æ‰èƒ½è¿›è¡ŒåŠ æ’ä»–é”ç„¶åæ‰§è¡Œupdateæ“ä½œã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹4ï¼šï¼ˆæ­»é”çš„å‘ç”Ÿï¼‰ 12345678T1:begin transelect * from table (holdlock) (holdlockæ„æ€æ˜¯åŠ å…±äº«é”ï¼Œç›´åˆ°äº‹ç‰©ç»“æŸæ‰é‡Šæ”¾)update table set column1='hello'T2:begin transelect * from table(holdlock)update table set column1='world' å‡è®¾T1å’ŒT2åŒæ—¶è¾¾åˆ°selectï¼ŒT1å¯¹tableåŠ å…±äº«é”ï¼ŒT2ä¹Ÿå¯¹åŠ å…±äº«é”ï¼Œå½“T1çš„selectæ‰§è¡Œå®Œï¼Œå‡†å¤‡æ‰§è¡Œupdateæ—¶ï¼Œæ ¹æ®é”æœºåˆ¶ï¼ŒT1çš„å…±äº«é”éœ€è¦å‡çº§åˆ°æ’ä»–é”æ‰èƒ½æ‰§è¡Œæ¥ä¸‹æ¥çš„update.åœ¨å‡çº§æ’ä»–é”å‰ï¼Œå¿…é¡»ç­‰tableä¸Šçš„å…¶å®ƒå…±äº«é”é‡Šæ”¾ï¼Œä½†å› ä¸ºholdlockè¿™æ ·çš„å…±äº«é”åªæœ‰ç­‰äº‹åŠ¡ç»“æŸåæ‰é‡Šæ”¾ï¼Œæ‰€ä»¥å› ä¸ºT2çš„å…±äº«é”ä¸é‡Šæ”¾è€Œå¯¼è‡´T1ç­‰(ç­‰T2é‡Šæ”¾å…±äº«é”ï¼Œè‡ªå·±å¥½å‡çº§æˆæ’ä»–é”ï¼‰ï¼ŒåŒç†ï¼Œä¹Ÿå› ä¸ºT1çš„å…±äº«é”ä¸é‡Šæ”¾è€Œå¯¼è‡´T2ç­‰ã€‚æ­»é”äº§ç”Ÿäº†ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹5ï¼š 123456T1:begin tranupdate table set column1='hello' where id=10T2:begin tranupdate table set column1='world' where id=20 è¿™ç§è¯­å¥è™½ç„¶æœ€ä¸ºå¸¸è§ï¼Œå¾ˆå¤šäººè§‰å¾—å®ƒæœ‰æœºä¼šäº§ç”Ÿæ­»é”ï¼Œä½†å®é™…ä¸Šè¦çœ‹æƒ…å†µï¼Œå¦‚æœidæ˜¯ä¸»é”®ä¸Šé¢æœ‰ç´¢å¼•ï¼Œé‚£ä¹ˆT1ä¼šä¸€ä¸‹å­æ‰¾åˆ°è¯¥æ¡è®°å½•(id=10çš„è®°å½•ï¼‰ï¼Œç„¶åå¯¹è¯¥æ¡è®°å½•åŠ æ’ä»–é”ï¼ŒT2ï¼ŒåŒæ ·ï¼Œä¸€ä¸‹å­é€šè¿‡ç´¢å¼•å®šä½åˆ°è®°å½•ï¼Œç„¶åå¯¹id=20çš„è®°å½•åŠ æ’ä»–é”ï¼Œè¿™æ ·T1å’ŒT2å„æ›´æ–°å„çš„ï¼Œäº’ä¸å½±å“ã€‚T2ä¹Ÿä¸éœ€è¦ç­‰ã€‚ ä½†å¦‚æœidæ˜¯æ™®é€šçš„ä¸€åˆ—ï¼Œæ²¡æœ‰ç´¢å¼•ã€‚é‚£ä¹ˆå½“T1å¯¹id=10è¿™ä¸€è¡ŒåŠ æ’ä»–é”åï¼ŒT2ä¸ºäº†æ‰¾åˆ°id=20ï¼Œéœ€è¦å¯¹å…¨è¡¨æ‰«æï¼Œé‚£ä¹ˆå°±ä¼šé¢„å…ˆå¯¹è¡¨åŠ ä¸Šå…±äº«é”æˆ–æ›´æ–°é”æˆ–æ’ä»–é”(ä¾èµ–äºæ•°æ®åº“æ‰§è¡Œç­–ç•¥å’Œæ–¹å¼ï¼Œæ¯”å¦‚ç¬¬ä¸€æ¬¡æ‰§è¡Œå’Œç¬¬äºŒæ¬¡æ‰§è¡Œæ•°æ®åº“æ‰§è¡Œç­–ç•¥å°±ä¼šä¸åŒï¼‰ã€‚ä½†å› ä¸ºT1å·²ç»ä¸ºä¸€æ¡è®°å½•åŠ äº†æ’ä»–é”ï¼Œå¯¼è‡´T2çš„å…¨è¡¨æ‰«æè¿›è¡Œä¸ä¸‹å»ï¼Œå°±å¯¼è‡´T2ç­‰å¾…ã€‚ æ­»é”æ€ä¹ˆè§£å†³å‘¢ï¼Ÿä¸€ç§åŠæ³•æ˜¯ï¼Œå¦‚ä¸‹ï¼š &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹6ï¼š 12345678T1:begin transelect * from table(xlock) (xlockæ„æ€æ˜¯ç›´æ¥å¯¹è¡¨åŠ æ’ä»–é”)update table set column1='hello'T2:begin transelect * from table(xlock)update table set column1='world' å½“T1çš„select æ‰§è¡Œæ—¶ï¼Œç›´æ¥å¯¹è¡¨åŠ ä¸Šäº†æ’ä»–é”ï¼ŒT2åœ¨æ‰§è¡Œselectæ—¶ï¼Œå°±éœ€è¦ç­‰T1äº‹åŠ¡å®Œå…¨æ‰§è¡Œå®Œæ‰èƒ½æ‰§è¡Œã€‚æ’é™¤äº†æ­»é”å‘ç”Ÿã€‚ä½†å½“ç¬¬ä¸‰ä¸ªuserè¿‡æ¥æƒ³æ‰§è¡Œä¸€ä¸ªæŸ¥è¯¢è¯­å¥æ—¶ï¼Œä¹Ÿå› ä¸ºæ’ä»–é”çš„å­˜åœ¨è€Œä¸å¾—ä¸ç­‰å¾…ï¼Œç¬¬å››ä¸ªã€ç¬¬äº”ä¸ªuserä¹Ÿä¼šå› æ­¤è€Œç­‰å¾…ã€‚åœ¨å¤§å¹¶å‘æƒ…å†µä¸‹ï¼Œè®©å¤§å®¶ç­‰å¾…æ˜¾å¾—æ€§èƒ½å°±å¤ªå‹å¥½äº†ï¼Œæ‰€ä»¥ï¼Œè¿™é‡Œå¼•å…¥äº†æ›´æ–°é”ã€‚ æ›´æ–°é”(Update lock) ä¸ºè§£å†³æ­»é”ï¼Œå¼•å…¥æ›´æ–°é”ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹7ï¼š 12345678T1:begin transelect * from table(updlock) (åŠ æ›´æ–°é”)update table set column1='hello'T2:begin transelect * from table(updlock)update table set column1='world' æ›´æ–°é”çš„æ„æ€æ˜¯ï¼šâ€œæˆ‘ç°åœ¨åªæƒ³è¯»ï¼Œä½ ä»¬åˆ«äººä¹Ÿå¯ä»¥è¯»ï¼Œä½†æˆ‘å°†æ¥å¯èƒ½ä¼šåšæ›´æ–°æ“ä½œï¼Œæˆ‘å·²ç»è·å–äº†ä»å…±äº«é”ï¼ˆç”¨æ¥è¯»ï¼‰åˆ°æ’ä»–é”ï¼ˆç”¨æ¥æ›´æ–°ï¼‰çš„èµ„æ ¼â€ã€‚ä¸€ä¸ªäº‹ç‰©åªèƒ½æœ‰ä¸€ä¸ªæ›´æ–°é”è·æ­¤èµ„æ ¼ã€‚ T1æ‰§è¡Œselectï¼ŒåŠ æ›´æ–°é”ã€‚ T2è¿è¡Œï¼Œå‡†å¤‡åŠ æ›´æ–°é”ï¼Œä½†å‘ç°å·²ç»æœ‰ä¸€ä¸ªæ›´æ–°é”åœ¨é‚£å„¿äº†ï¼Œåªå¥½ç­‰ã€‚ å½“åæ¥æœ‰user3ã€user4...éœ€è¦æŸ¥è¯¢tableè¡¨ä¸­çš„æ•°æ®æ—¶ï¼Œå¹¶ä¸ä¼šå› ä¸ºT1çš„selectåœ¨æ‰§è¡Œå°±è¢«é˜»å¡ï¼Œç…§æ ·èƒ½æŸ¥è¯¢ï¼Œç›¸æ¯”èµ·ä¾‹6ï¼Œè¿™æé«˜äº†æ•ˆç‡ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹8ï¼š 123T1: select * from table(updlock) (åŠ æ›´æ–°é”ï¼‰T2: select * from table(updlock) (ç­‰å¾…ï¼Œç›´åˆ°T1é‡Šæ”¾æ›´æ–°é”ï¼Œå› ä¸ºåŒä¸€æ—¶é—´ä¸èƒ½åœ¨åŒä¸€èµ„æºä¸Šæœ‰ä¸¤ä¸ªæ›´æ–°é”ï¼‰T3: select * from table (åŠ å…±äº«é”ï¼Œä½†ä¸ç”¨ç­‰updlocké‡Šæ”¾ï¼Œå°±å¯ä»¥è¯»ï¼‰ è¿™ä¸ªä¾‹å­æ˜¯è¯´æ˜ï¼šå…±äº«é”å’Œæ›´æ–°é”å¯ä»¥åŒæ—¶åœ¨åŒä¸€ä¸ªèµ„æºä¸Šã€‚è¿™è¢«ç§°ä¸ºå…±äº«é”å’Œæ›´æ–°é”æ˜¯å…¼å®¹çš„ã€‚ æ’ä»–é”ï¼ˆç‹¬å é”ï¼ŒExclusive Locks) å…¶å®ƒäº‹åŠ¡æ—¢ä¸èƒ½è¯»ï¼Œåˆä¸èƒ½æ”¹æ’ä»–é”é”å®šçš„èµ„æºã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹9ï¼š 12345678T1:beginselect * from table(updlock) (åŠ æ›´æ–°é”ï¼‰update table set column1='hello' (é‡ç‚¹ï¼šè¿™é‡ŒT1åšupdateæ—¶ï¼Œä¸éœ€è¦ç­‰T2é‡Šæ”¾ä»€ä¹ˆï¼Œè€Œæ˜¯ç›´æ¥æŠŠæ›´æ–°é”å‡çº§ä¸ºæ’ä»–é”ï¼Œç„¶åæ‰§è¡Œupdate)T2:beginselect * from table (T1åŠ çš„æ›´æ–°é”ä¸å½±å“T2è¯»å–ï¼‰update table set column1='world' (T2çš„updateéœ€è¦ç­‰T1çš„updateåšå®Œæ‰èƒ½æ‰§è¡Œ) ç¬¬ä¸€ç§æƒ…å†µï¼šT1å…ˆè¾¾ï¼ŒT2ç´§æ¥åˆ°è¾¾ï¼›åœ¨è¿™ç§æƒ…å†µä¸­ï¼ŒT1å…ˆå¯¹è¡¨åŠ æ›´æ–°é”ï¼ŒT2å¯¹è¡¨åŠ å…±äº«é”ï¼Œå‡è®¾T2çš„selectå…ˆæ‰§è¡Œå®Œï¼Œå‡†å¤‡æ‰§è¡Œupdateï¼Œå‘ç°å·²æœ‰æ›´æ–°é”å­˜åœ¨ï¼ŒT2ç­‰ã€‚T1è¿™æ—¶æ‰æ‰§è¡Œå®Œselectï¼Œå‡†å¤‡æ‰§è¡Œupdateï¼Œæ›´æ–°é”å‡çº§ä¸ºæ’ä»–é”ï¼Œç„¶åæ‰§è¡Œupdateï¼Œæ‰§è¡Œå®Œæˆï¼Œäº‹åŠ¡ç»“æŸï¼Œé‡Šæ”¾é”ï¼ŒT2æ‰è½®åˆ°æ‰§è¡Œupdateã€‚ ç¬¬äºŒç§æƒ…å†µï¼šT2å…ˆè¾¾ï¼ŒT1ç´§æ¥è¾¾ï¼›åœ¨è¿™ç§æƒ…å†µï¼ŒT2å…ˆå¯¹è¡¨åŠ å…±äº«é”ï¼ŒT1åˆ°è¾¾åï¼ŒT1å¯¹è¡¨åŠ æ›´æ–°é”ï¼Œå‡è®¾T2 selectå…ˆç»“æŸï¼Œå‡†å¤‡updateï¼Œå‘ç°å·²æœ‰æ›´æ–°é”ï¼Œåˆ™ç­‰å¾…ï¼Œåé¢æ­¥éª¤å°±è·Ÿç¬¬ä¸€ç§æƒ…å†µä¸€æ ·äº†ã€‚ è¿™ä¸ªä¾‹å­æ˜¯è¯´æ˜ï¼šæ’ä»–é”ä¸æ›´æ–°é”æ˜¯ä¸å…¼å®¹çš„ï¼Œå®ƒä»¬ä¸èƒ½åŒæ—¶åŠ åœ¨åŒä¸€èµ„æºä¸Šã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹10ï¼š 12T1: update table set column1='hello' where id&lt;1000T2: update table set column1='world' where id&gt;1000 å‡è®¾T1å…ˆè¾¾ï¼ŒT2éšåè‡³ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¸­T1ä¼šå¯¹id&lt;1000çš„è®°å½•æ–½åŠ æ’ä»–é”.ä½†ä¸ä¼šé˜»å¡T2çš„updateã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹11ï¼š(å‡è®¾idéƒ½æ˜¯è‡ªå¢é•¿ä¸”è¿ç»­çš„ï¼‰ 12T1: update table set column1='hello' where id&lt;1000T2: update table set column1='world' where id&gt;900 å¦‚åŒä¾‹10ï¼ŒT1å…ˆè¾¾ï¼ŒT2ç«‹åˆ»ä¹Ÿåˆ°ï¼ŒT1åŠ çš„æ’ä»–é”ä¼šé˜»å¡T2çš„updateã€‚ æ„å‘é”(Intent Locks) æ„å‘é”å°±æ˜¯è¯´åœ¨å±‹ï¼ˆæ¯”å¦‚ä»£è¡¨ä¸€ä¸ªè¡¨ï¼‰é—¨å£è®¾ç½®ä¸€ä¸ªæ ‡è¯†ï¼Œè¯´æ˜å±‹å­é‡Œæœ‰äººï¼ˆæ¯”å¦‚ä»£è¡¨æŸäº›è®°å½•ï¼‰è¢«é”ä½äº†ã€‚å¦ä¸€ä¸ªäººæƒ³çŸ¥é“å±‹å­é‡Œæ˜¯å¦æœ‰äººè¢«é”ï¼Œä¸ç”¨è¿›å±‹å­é‡Œä¸€ä¸ªä¸ªå»æŸ¥ï¼Œç›´æ¥çœ‹é—¨å£æ ‡è¯†å°±è¡Œäº†ã€‚ å½“ä¸€ä¸ªè¡¨ä¸­çš„æŸä¸€è¡Œè¢«åŠ ä¸Šæ’ä»–é”åï¼Œè¯¥è¡¨å°±ä¸èƒ½å†è¢«åŠ è¡¨é”ã€‚æ•°æ®åº“ç¨‹åºå¦‚ä½•çŸ¥é“è¯¥è¡¨ä¸èƒ½è¢«åŠ è¡¨é”ï¼Ÿä¸€ç§æ–¹å¼æ˜¯é€æ¡çš„åˆ¤æ–­è¯¥è¡¨çš„æ¯ä¸€æ¡è®°å½•æ˜¯å¦å·²ç»æœ‰æ’ä»–é”ï¼Œå¦ä¸€ç§æ–¹å¼æ˜¯ç›´æ¥åœ¨è¡¨è¿™ä¸€å±‚çº§æ£€æŸ¥è¡¨æœ¬èº«æ˜¯å¦æœ‰æ„å‘é”ï¼Œä¸éœ€è¦é€æ¡åˆ¤æ–­ã€‚æ˜¾ç„¶åè€…æ•ˆç‡é«˜ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹12ï¼š 1234T1: begin transelect * from table (xlock) where id=10 --æ„æ€æ˜¯å¯¹id=10è¿™ä¸€è¡Œå¼ºåŠ æ’ä»–é”T2: begin transelect * from table (tablock) --æ„æ€æ˜¯è¦åŠ è¡¨çº§é” å‡è®¾T1å…ˆæ‰§è¡Œï¼ŒT2åæ‰§è¡Œï¼ŒT2æ‰§è¡Œæ—¶ï¼Œæ¬²åŠ è¡¨é”ï¼Œä¸ºåˆ¤æ–­æ˜¯å¦å¯ä»¥åŠ è¡¨é”ï¼Œæ•°æ®åº“ç³»ç»Ÿè¦é€æ¡åˆ¤æ–­tableè¡¨æ¯è¡Œè®°å½•æ˜¯å¦å·²æœ‰æ’ä»–é”ï¼Œå¦‚æœå‘ç°å…¶ä¸­ä¸€è¡Œå·²ç»æœ‰æ’ä»–é”äº†ï¼Œå°±ä¸å…è®¸å†åŠ è¡¨é”äº†ã€‚åªæ˜¯è¿™æ ·é€æ¡åˆ¤æ–­æ•ˆç‡å¤ªä½äº†ã€‚ å®é™…ä¸Šï¼Œæ•°æ®åº“ç³»ç»Ÿä¸æ˜¯è¿™æ ·å·¥ä½œçš„ã€‚å½“T1çš„selectæ‰§è¡Œæ—¶ï¼Œç³»ç»Ÿå¯¹è¡¨tableçš„id=10çš„è¿™ä¸€è¡ŒåŠ äº†æ’ä»–é”ï¼Œè¿˜åŒæ—¶æ‚„æ‚„çš„å¯¹æ•´ä¸ªè¡¨åŠ äº†æ„å‘æ’ä»–é”(IX)ï¼Œå½“T2æ‰§è¡Œè¡¨é”æ—¶ï¼Œåªéœ€è¦çœ‹åˆ°è¿™ä¸ªè¡¨å·²ç»æœ‰æ„å‘æ’ä»–é”å­˜åœ¨ï¼Œå°±ç›´æ¥ç­‰å¾…ï¼Œè€Œä¸éœ€è¦é€æ¡æ£€æŸ¥èµ„æºäº†ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹13ï¼š 1234T1: begin tranupdate table set column1='hello' where id=1T2: begin tranupdate table set column1='world' where id=1 è¿™ä¸ªä¾‹å­å’Œä¸Šé¢çš„ä¾‹å­å®é™…æ•ˆæœç›¸åŒï¼ŒT1æ‰§è¡Œï¼Œç³»ç»ŸåŒæ—¶å¯¹è¡ŒåŠ æ’ä»–é”ã€å¯¹é¡µåŠ æ„å‘æ’ä»–é”ã€å¯¹è¡¨åŠ æ„å‘æ’ä»–é”ã€‚ è®¡åˆ’é”(Schema Locks) &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹14ï¼š 1alter table .... (åŠ schema locksï¼Œç§°ä¹‹ä¸ºSchema modification (Sch-M) locks DDLè¯­å¥éƒ½ä¼šåŠ Sch-Mé”ï¼Œè¯¥é”ä¸å…è®¸ä»»ä½•å…¶å®ƒsessionè¿æ¥è¯¥è¡¨ã€‚è¿éƒ½è¿ä¸äº†è¿™ä¸ªè¡¨äº†ï¼Œå½“ç„¶æ›´ä¸ç”¨è¯´æƒ³å¯¹è¯¥è¡¨æ‰§è¡Œä»€ä¹ˆsqlè¯­å¥äº†ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹15ï¼š ç”¨jdbcå‘æ•°æ®åº“å‘é€äº†ä¸€æ¡æ–°çš„sqlè¯­å¥ï¼Œæ•°æ®åº“è¦å…ˆå¯¹ä¹‹è¿›è¡Œç¼–è¯‘ï¼Œåœ¨ç¼–è¯‘æœŸé—´ï¼Œä¹Ÿä¼šåŠ é”ï¼Œç§°ä¹‹ä¸ºï¼šSchema stability (Sch-S) locksã€‚ 1select * from tableA ç¼–è¯‘è¿™æ¡è¯­å¥è¿‡ç¨‹ä¸­ï¼Œå…¶å®ƒsessionå¯ä»¥å¯¹è¡¨tableAåšä»»ä½•æ“ä½œ(update,deleteï¼ŒåŠ æ’ä»–é”ç­‰ç­‰ï¼‰ï¼Œä½†ä¸èƒ½åšDDL(æ¯”å¦‚alter table)æ“ä½œã€‚ Bulk Update Locks ä¸»è¦åœ¨æ‰¹é‡å¯¼æ•°æ®æ—¶ç”¨ï¼ˆæ¯”å¦‚ç”¨ç±»ä¼¼äºoracleä¸­çš„imp/expçš„bcpå‘½ä»¤ï¼‰ã€‚ ä½•æ—¶åŠ é” &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹16ï¼š 12345T1: begin tranupdate table set column1='hello' where id=1T2: SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED -- äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºå…è®¸è„è¯»select * from table where id=1 è¿™é‡Œï¼ŒT2çš„selectå¯ä»¥æŸ¥å‡ºç»“æœã€‚å¦‚æœäº‹åŠ¡éš”ç¦»çº§åˆ«ä¸è®¾ä¸ºè„è¯»ï¼Œåˆ™T2ä¼šç­‰T1äº‹åŠ¡æ‰§è¡Œå®Œæ‰èƒ½è¯»å‡ºç»“æœã€‚ æ•°æ®åº“å¦‚ä½•è‡ªåŠ¨åŠ é”çš„ï¼Ÿ T1æ‰§è¡Œï¼Œæ•°æ®åº“è‡ªåŠ¨åŠ æ’ä»–é” T2æ‰§è¡Œï¼Œæ•°æ®åº“å‘ç°äº‹åŠ¡éš”ç¦»çº§åˆ«å…è®¸è„è¯»ï¼Œä¾¿ä¸åŠ å…±äº«é”ã€‚ä¸åŠ å…±äº«é”ï¼Œåˆ™ä¸ä¼šä¸å·²æœ‰çš„æ’ä»–é”å†²çªï¼Œæ‰€ä»¥å¯ä»¥è„è¯»ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹17ï¼š 123T1: begin tranupdate table set column1='hello' where id=1T2: select * from table where id=1 â€“æœªæŒ‡å®šéš”ç¦»çº§åˆ«ï¼Œåˆ™ä½¿ç”¨ç³»ç»Ÿé»˜è®¤éš”ç¦»çº§åˆ«ï¼Œå®ƒä¸å…è®¸è„è¯» å¦‚æœäº‹åŠ¡çº§åˆ«ä¸è®¾ä¸ºè„è¯»ï¼Œåˆ™ï¼šT1æ‰§è¡Œï¼Œæ•°æ®åº“è‡ªåŠ¨åŠ æ’ä»–é”T2æ‰§è¡Œï¼Œæ•°æ®åº“å‘ç°äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸å…è®¸è„è¯»ï¼Œä¾¿å‡†å¤‡ä¸ºæ­¤æ¬¡selectè¿‡ç¨‹åŠ å…±äº«é”ï¼Œä½†å‘ç°åŠ ä¸ä¸Šï¼Œå› ä¸ºå·²ç»æœ‰æ’ä»–é”äº†ï¼Œæ‰€ä»¥å°±ç­‰åˆ°T1æ‰§è¡Œå®Œï¼Œé‡Šæ”¾äº†æ’ä»–é”ï¼ŒT2æ‰åŠ ä¸Šäº†å…±äº«é”ï¼Œç„¶åå¼€å§‹è¯».... é”çš„ç²’åº¦ é”çš„ç²’åº¦å°±æ˜¯æŒ‡é”çš„ç”Ÿæ•ˆèŒƒå›´ï¼Œå°±æ˜¯è¯´æ˜¯è¡Œé”ï¼Œè¿˜æ˜¯é¡µé”ï¼Œè¿˜æ˜¯æ•´è¡¨é”. é”çš„ç²’åº¦åŒæ ·æ—¢å¯ä»¥ç”±æ•°æ®åº“è‡ªåŠ¨ç®¡ç†ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ‰‹å·¥æŒ‡å®šhintæ¥ç®¡ç†ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹18ï¼š 12T1: select * from table (paglock)T2: update table set column1='hello' where id&gt;10 T1æ‰§è¡Œæ—¶ï¼Œä¼šå…ˆå¯¹ç¬¬ä¸€é¡µåŠ é”ï¼Œè¯»å®Œç¬¬ä¸€é¡µåï¼Œé‡Šæ”¾é”ï¼Œå†å¯¹ç¬¬äºŒé¡µåŠ é”ï¼Œä¾æ­¤ç±»æ¨ã€‚å‡è®¾å‰10è¡Œè®°å½•æ°å¥½æ˜¯ä¸€é¡µ(å½“ç„¶ï¼Œä¸€èˆ¬ä¸å¯èƒ½ä¸€é¡µåªæœ‰10è¡Œè®°å½•ï¼‰ï¼Œé‚£ä¹ˆT1æ‰§è¡Œåˆ°ç¬¬ä¸€é¡µæŸ¥è¯¢æ—¶ï¼Œå¹¶ä¸ä¼šé˜»å¡T2çš„æ›´æ–°ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹19ï¼š 12T1: select * from table (rowlock)T2: update table set column1='hello' where id=10 T1æ‰§è¡Œæ—¶ï¼Œå¯¹æ¯è¡ŒåŠ å…±äº«é”ï¼Œè¯»å–ï¼Œç„¶åé‡Šæ”¾ï¼Œå†å¯¹ä¸‹ä¸€è¡ŒåŠ é”;T2æ‰§è¡Œæ—¶ï¼Œä¼šå¯¹id=10çš„é‚£ä¸€è¡Œè¯•å›¾åŠ é”ï¼Œåªè¦è¯¥è¡Œæ²¡æœ‰è¢«T1åŠ ä¸Šè¡Œé”ï¼ŒT2å°±å¯ä»¥é¡ºåˆ©æ‰§è¡Œupdateæ“ä½œã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹20ï¼š 12T1: select * from table (tablock)T2: update table set column1='hello' where id = 10 T1æ‰§è¡Œï¼Œå¯¹æ•´ä¸ªè¡¨åŠ å…±äº«é”. T1å¿…é¡»å®Œå…¨æŸ¥è¯¢å®Œï¼ŒT2æ‰å¯ä»¥å…è®¸åŠ é”ï¼Œå¹¶å¼€å§‹æ›´æ–°ã€‚ é”ä¸äº‹åŠ¡éš”ç¦»çº§åˆ«çš„ä¼˜å…ˆçº§ æ‰‹å·¥æŒ‡å®šçš„é”ä¼˜å…ˆã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹21ï¼š 1234567T1: SET TRANSACTION ISOLATION LEVEL SERIALIZABLEBEGIN TRANSACTIONSELECT * FROM table (NOLOCK)T2: update table set column1='hello' where id=10 T1æ˜¯äº‹åŠ¡éš”ç¦»çº§åˆ«ä¸ºæœ€é«˜çº§ï¼Œä¸²è¡Œé”ï¼Œæ•°æ®åº“ç³»ç»Ÿæœ¬åº”å¯¹åé¢çš„selectè¯­å¥è‡ªåŠ¨åŠ è¡¨çº§é”ï¼Œä½†å› ä¸ºæ‰‹å·¥æŒ‡å®šäº†NOLOCKï¼Œæ‰€ä»¥è¯¥selectè¯­å¥ä¸ä¼šåŠ ä»»ä½•é”ï¼Œæ‰€ä»¥T2ä¹Ÿå°±ä¸ä¼šæœ‰ä»»ä½•é˜»å¡ã€‚ æ•°æ®åº“å…¶ä»–é”åŠå…¶åŒºåˆ« holdlock å¯¹è¡¨åŠ å…±äº«é”ï¼Œä¸”äº‹åŠ¡ï¼ˆcommit/rollbackï¼‰ä¸å®Œæˆï¼Œå…±äº«é”ä¸é‡Šæ”¾ã€‚ tablock å¯¹è¡¨åŠ å…±äº«é”ï¼Œåªè¦statementä¸å®Œæˆï¼Œå…±äº«é”ä¸é‡Šæ”¾ã€‚ tablock &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹22ï¼š 123456T1:begin transelect * from table (tablock)T2:begin tranupdate table set column1='hello' where id = 10 T1æ‰§è¡Œå®Œselectï¼Œå°±ä¼šé‡Šæ”¾å…±äº«é”ï¼Œç„¶åT2å°±å¯ä»¥æ‰§è¡Œupdateã€‚ holdlock &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹23ï¼š 123456T1:begin transelect * from table (holdlock)T2:begin tranupdate table set column1='hello' where id = 10 T1æ‰§è¡Œå®Œselectï¼Œå…±äº«é”ä»ç„¶ä¸ä¼šé‡Šæ”¾ï¼Œä»ç„¶ä¼šè¢«hold(æŒæœ‰ï¼‰ï¼ŒT2ä¹Ÿå› æ­¤å¿…é¡»ç­‰å¾…è€Œä¸èƒ½update. å½“T1æœ€åæ‰§è¡Œäº†commitæˆ–rollbackè¯´æ˜è¿™ä¸€ä¸ªäº‹åŠ¡ç»“æŸäº†ï¼ŒT2æ‰å–å¾—æ‰§è¡Œæƒã€‚ TABLOCKX å¯¹è¡¨åŠ æ’ä»–é” &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹24ï¼š 1T1: select * from table(tablockx) (å¼ºè¡ŒåŠ æ’ä»–é”ï¼‰ å…¶å®ƒsessionå°±æ— æ³•å¯¹è¿™ä¸ªè¡¨è¿›è¡Œè¯»å’Œæ›´æ–°äº†ï¼Œé™¤éT1æ‰§è¡Œå®Œäº†ï¼Œå°±ä¼šè‡ªåŠ¨é‡Šæ”¾æ’ä»–é”ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹25ï¼š 12T1: begin transelect * from table(tablockx) å•å•selectæ‰§è¡Œå®Œè¿˜ä¸è¡Œï¼Œå¿…é¡»æ•´ä¸ªäº‹åŠ¡å®Œæˆï¼ˆcommitæˆ–rollbackåï¼‰æ‰ä¼šé‡Šæ”¾æ’ä»–é”ã€‚ xlock åŠ æ’ä»–é” &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹26ï¼š 1select * from table(xlock paglock) å¯¹pageåŠ æ’ä»–é” xlockè¿˜å¯è¿™ä¹ˆç”¨ï¼š 1select * from table(xlock tablock) æ•ˆæœç­‰åŒäº 1select * from table(tablockx) é”çš„è¶…æ—¶ç­‰å¾… SET LOCK_TIMEOUT 4000 ç”¨æ¥è®¾ç½®é”ç­‰å¾…æ—¶é—´ï¼Œå•ä½æ˜¯æ¯«ç§’ï¼Œ4000æ„å‘³ç€ç­‰å¾…4ç§’å¯ä»¥ç”¨select @@LOCK_TIMEOUTæŸ¥çœ‹å½“å‰sessionçš„é”è¶…æ—¶è®¾ç½®ã€‚-1 æ„å‘³ç€æ°¸è¿œç­‰å¾…ã€‚ &lt;i class="fa fa-pencil"&gt;&lt;/i&gt; ä¾‹27ï¼š 1234T1: begin tranudpate table set column1='hello' where id = 10T2: set lock_timeout 4000select * from table wehre id = 10 T2æ‰§è¡Œæ—¶ï¼Œä¼šç­‰å¾…T1é‡Šæ”¾æ’ä»–é”ï¼Œç­‰äº†4ç§’é’Ÿï¼Œå¦‚æœT1è¿˜æ²¡æœ‰é‡Šæ”¾æ’ä»–é”ï¼ŒT2å°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼š Lock request time out period exceededã€‚ äº‹åŠ¡éš”ç¦»çº§åˆ« SQLæ ‡å‡†è§„å®šäº†å››ä¸ªéš”ç¦»æ°´å¹³ï¼š READ_UNCOMMITTEDï¼ˆè¯»æœªæäº¤ï¼‰ ï¼šäº‹åŠ¡ä¸­çš„ä¿®æ”¹ï¼Œå³ä½¿æ²¡æœ‰æäº¤ï¼Œå…¶ä»–äº‹åŠ¡ä¹Ÿå¯ä»¥çœ‹å¾—åˆ°ï¼Œä¼šå¯¼è‡´â€œè„è¯»â€ã€â€œå¹»è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€ã€‚READ_COMMITTEDï¼ˆè¯»å·²æäº¤ï¼‰ï¼šå¤§å¤šæ•°ä¸»æµæ•°æ®åº“çš„é»˜è®¤äº‹åŠ¡ç­‰çº§ï¼Œä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šè¯»åˆ°å¦ä¸€ä¸ªå¹¶è¡Œäº‹åŠ¡å·²ä¿®æ”¹ä½†æœªæäº¤çš„æ•°æ®ï¼Œé¿å…äº†â€œè„è¯»â€ï¼Œä½†ä¸èƒ½é¿å…â€œå¹»è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€ã€‚è¯¥çº§åˆ«é€‚ç”¨äºå¤§å¤šæ•°ç³»ç»Ÿï¼Œå¦‚Oracleã€SQLServerç­‰ã€‚REPETABLE_READï¼ˆé‡å¤è¯»ï¼‰ ï¼šä¿è¯äº†ä¸€ä¸ªäº‹åŠ¡ä¸ä¼šä¿®æ”¹å·²ç»ç”±å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–ä½†æœªæäº¤ï¼ˆå›æ»šï¼‰çš„æ•°æ®ã€‚é¿å…äº†â€œè„è¯»â€å’Œâ€œä¸å¯é‡å¤è¯»â€çš„æƒ…å†µï¼Œä½†ä¸èƒ½é¿å…â€œå¹»è¯»â€ã€‚MySQLé»˜è®¤å°±æ˜¯è¿™ç§éš”ç¦»çº§åˆ«ã€‚SERIALIZABLEï¼ˆä¸²è¡ŒåŒ–ï¼‰ï¼šæœ€ä¸¥æ ¼çš„çº§åˆ«ï¼Œäº‹åŠ¡ä¸²è¡Œæ‰§è¡Œï¼Œèµ„æºæ¶ˆè€—æœ€å¤§ï¼› è„è¯» è„è¯»å‘ç”Ÿåœ¨ï¼šå½“ä¸€ä¸ªäº‹åŠ¡å…è®¸è¯»å–ä¸€ä¸ªè¢«å…¶ä»–äº‹åŠ¡æ”¹å˜ä½†æ˜¯æœªæäº¤çš„çŠ¶æ€æ—¶ï¼Œè¿™æ˜¯å› ä¸ºå¹¶æ²¡æœ‰é”é˜»æ­¢è¯»å–ã€‚ å¦‚ä¸Šå›¾ï¼Œç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–äº†ä¸€ä¸ªå¹¶ä¸ä¸€è‡´çš„å€¼ã€‚ä¸ä¸€è‡´çš„æ„æ€æ˜¯ï¼Œè¿™ä¸ªå€¼æ˜¯æ— æ•ˆçš„ï¼Œå› ä¸ºä¿®æ”¹è¿™ä¸ªå€¼çš„ç¬¬ä¸€ä¸ªäº‹åŠ¡å·²ç»å›æ»šï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œä½†æ˜¯æœªæäº¤ç¡®è®¤ï¼Œå´è¢«ç¬¬äºŒä¸ªäº‹åŠ¡è¯»å–ï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡åˆæ”¾å¼ƒä¿®æ”¹ï¼Œè€Œç¬¬äºŒä¸ªäº‹åŠ¡å°±å¾—åˆ°ä¸€ä¸ªè„æ•°æ®ã€‚ ä¸å¯é‡å¤è¯» åå¤è¯»åŒä¸€ä¸ªæ•°æ®å´å¾—åˆ°ä¸åŒçš„ç»“æœï¼Œè¿™æ˜¯å› ä¸ºåœ¨åå¤å‡ æ¬¡è¯»å–çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®è¢«ä¿®æ”¹äº†ï¼Œè¿™å°±å¯¼è‡´æˆ‘ä»¬ä½¿ç”¨äº†staleæ•°æ®ï¼Œè¿™å¯ä»¥é€šè¿‡ä¸€ä¸ªå…±äº«è¯»é”æ¥é¿å…ã€‚è¿™æ˜¯éš”ç¦»çº§åˆ«READ_COMMITTEDä¼šå¯¼è‡´å¯é‡å¤è¯»çš„åŸå› ã€‚è®¾ç½®å…±äº«è¯»é”ä¹Ÿå°±æ˜¯éš”ç¦»çº§åˆ«æé«˜åˆ°REPETABLE_READã€‚ å¹»è¯» å½“ç¬¬äºŒä¸ªäº‹åŠ¡æ’å…¥ä¸€è¡Œè®°å½•ï¼Œè€Œæ­£å¥½ä¹‹å‰ç¬¬ä¸€ä¸ªäº‹åŠ¡æŸ¥è¯¢äº†åº”è¯¥åŒ…å«è¿™ä¸ªæ–°çºªå½•çš„æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªæŸ¥è¯¢äº‹åŠ¡çš„ç»“æœé‡Œè‚¯å®šæ²¡æœ‰åŒ…å«è¿™ä¸ªåˆšåˆšæ–°æ’å…¥çš„æ•°æ®ï¼Œè¿™æ—¶å¹»å½±è¯»å‘ç”Ÿäº†ï¼Œé€šè¿‡å˜åŒ–é”å’Œpredicate lockingé¿å…ã€‚ æ€»ç»“ ä¸å¯é‡å¤è¯»å’Œå¹»è¯»çš„åŒºåˆ«æ˜¯ï¼šå‰è€…æ˜¯æŒ‡è¯»åˆ°äº†å·²ç»æäº¤çš„äº‹åŠ¡çš„æ›´æ”¹æ•°æ®ï¼ˆupdateæˆ–deleteï¼‰ï¼Œåè€…æ˜¯æŒ‡è¯»åˆ°äº†å…¶ä»–å·²ç»æäº¤äº‹åŠ¡çš„æ–°å¢æ•°æ®ï¼ˆinsertï¼‰ã€‚ å¯¹äºè¿™ä¸¤ç§é—®é¢˜è§£å†³é‡‡ç”¨ä¸åŒçš„åŠæ³•ï¼Œé˜²æ­¢è¯»åˆ°æ›´æ”¹æ•°æ®ï¼Œåªéœ€å¯¹æ“ä½œçš„æ•°æ®æ·»åŠ è¡Œçº§é”ï¼Œé˜²æ­¢æ“ä½œä¸­çš„æ•°æ®å‘ç”Ÿå˜åŒ–ï¼› é˜²æ­¢è¯»åˆ°æ–°å¢æ•°æ®ï¼Œå¾€å¾€éœ€è¦æ·»åŠ è¡¨çº§é”ï¼Œå°†æ•´å¼ è¡¨é”å®šï¼Œé˜²æ­¢æ–°å¢æ•°æ®ï¼ˆoracleé‡‡ç”¨å¤šç‰ˆæœ¬æ•°æ®çš„æ–¹å¼å®ç°ï¼‰ã€‚ READ_COMMITED æ˜¯æ¯”è¾ƒæ­£ç¡®çš„é€‰æ‹©ï¼Œå› ä¸ºSERIALIZABLEè™½ç„¶èƒ½åœ¨ä¸åŒäº‹åŠ¡å‘ç”Ÿæ—¶é¿å…staleæ•°æ®ï¼Œä¹Ÿå°±æ˜¯é¿å…ä¸Šè¿°ä¸¢å¤±åˆšåˆšä¿®æ”¹çš„æ•°æ®ï¼Œä½†æ˜¯æ€§èƒ½æ˜¯æœ€ä½çš„ï¼Œå› ä¸ºæ˜¯ä¸€ç§æœ€å¤§åŒ–çš„ä¸²è¡Œã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-10ä¹‹-çº¿ç¨‹ä¼˜å…ˆçº§å’Œå®ˆæŠ¤çº¿ç¨‹]]></title>
    <url>%2Fposts%2Ffc4de834.html</url>
    <content type="text"><![CDATA[çº¿ç¨‹ä¼˜å…ˆçº§ java ä¸­çš„çº¿ç¨‹ä¼˜å…ˆçº§çš„èŒƒå›´æ˜¯1ï½10ï¼Œé»˜è®¤çš„ä¼˜å…ˆçº§æ˜¯5ã€‚â€œé«˜ä¼˜å…ˆçº§çº¿ç¨‹â€ä¼šä¼˜å…ˆäºâ€œä½ä¼˜å…ˆçº§çº¿ç¨‹â€æ‰§è¡Œã€‚ java ä¸­æœ‰ä¸¤ç§çº¿ç¨‹ï¼šç”¨æˆ·çº¿ç¨‹å’Œå®ˆæŠ¤çº¿ç¨‹ã€‚å¯ä»¥é€šè¿‡isDaemon()æ–¹æ³•æ¥åŒºåˆ«å®ƒä»¬ï¼šå¦‚æœè¿”å›falseï¼Œåˆ™è¯´æ˜è¯¥çº¿ç¨‹æ˜¯â€œç”¨æˆ·çº¿ç¨‹â€ï¼›å¦åˆ™å°±æ˜¯â€œå®ˆæŠ¤çº¿ç¨‹â€ã€‚ ç”¨æˆ·çº¿ç¨‹ä¸€èˆ¬ç”¨æˆ·æ‰§è¡Œç”¨æˆ·çº§ä»»åŠ¡ï¼Œè€Œå®ˆæŠ¤çº¿ç¨‹ä¹Ÿå°±æ˜¯â€œåå°çº¿ç¨‹â€ï¼Œä¸€èˆ¬ç”¨æ¥æ‰§è¡Œåå°ä»»åŠ¡ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šJavaè™šæ‹Ÿæœºåœ¨â€œç”¨æˆ·çº¿ç¨‹â€éƒ½ç»“æŸåä¼šåé€€å‡ºã€‚ JDK ä¸­å…³äºçº¿ç¨‹ä¼˜å…ˆçº§å’Œå®ˆæŠ¤çº¿ç¨‹çš„ä»‹ç»å¦‚ä¸‹ï¼š 1234567Every thread has a priority. Threads with higher priority are executed in preference to threads with lower priority. Each thread may or may not also be marked as a daemon. When code running in some thread creates a new Thread object, the new thread has its priority initially set equal to the priority of the creating thread, and is a daemon thread if and only if the creating thread is a daemon.When a Java Virtual Machine starts up, there is usually a single non-daemon thread (which typically calls the method named main of some designated class). The Java Virtual Machine continues to execute threads until either of the following occurs:The exit method of class Runtime has been called and the security manager has permitted the exit operation to take place.All threads that are not daemon threads have died, either by returning from the call to the run method or by throwing an exception that propagates beyond the run method. Marks this thread as either a daemon thread or a user thread. The Java Virtual Machine exits when the only threads running are all daemon threads. å¤§è‡´æ„æ€æ˜¯ï¼š 1234567æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªä¼˜å…ˆçº§ã€‚â€œé«˜ä¼˜å…ˆçº§çº¿ç¨‹â€ä¼šä¼˜å…ˆäºâ€œä½ä¼˜å…ˆçº§çº¿ç¨‹â€æ‰§è¡Œã€‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è¢«æ ‡è®°ä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹æˆ–éå®ˆæŠ¤è¿›ç¨‹ã€‚åœ¨ä¸€äº›è¿è¡Œçš„ä¸»çº¿ç¨‹ä¸­åˆ›å»ºæ–°çš„å­çº¿ç¨‹æ—¶ï¼Œå­çº¿ç¨‹çš„ä¼˜å…ˆçº§è¢«è®¾ç½®ä¸ºç­‰äºâ€œåˆ›å»ºå®ƒçš„ä¸»çº¿ç¨‹çš„ä¼˜å…ˆçº§â€ï¼Œå½“ä¸”ä»…å½“â€œåˆ›å»ºå®ƒçš„ä¸»çº¿ç¨‹æ˜¯å®ˆæŠ¤çº¿ç¨‹â€æ—¶â€œå­çº¿ç¨‹æ‰ä¼šæ˜¯å®ˆæŠ¤çº¿ç¨‹â€ã€‚å½“Javaè™šæ‹Ÿæœºå¯åŠ¨æ—¶ï¼Œé€šå¸¸æœ‰ä¸€ä¸ªå•ä¸€çš„éå®ˆæŠ¤çº¿ç¨‹ï¼ˆè¯¥çº¿ç¨‹é€šè¿‡æ˜¯é€šè¿‡main()æ–¹æ³•å¯åŠ¨ï¼‰ã€‚JVMä¼šä¸€ç›´è¿è¡Œç›´åˆ°ä¸‹é¢çš„ä»»æ„ä¸€ä¸ªæ¡ä»¶å‘ç”Ÿï¼ŒJVMå°±ä¼šç»ˆæ­¢è¿è¡Œï¼š(01) è°ƒç”¨äº†exit()æ–¹æ³•ï¼Œå¹¶ä¸”exit()æœ‰æƒé™è¢«æ­£å¸¸æ‰§è¡Œã€‚(02) æ‰€æœ‰çš„â€œéå®ˆæŠ¤çº¿ç¨‹â€éƒ½æ­»äº†(å³JVMä¸­ä»…ä»…åªæœ‰â€œå®ˆæŠ¤çº¿ç¨‹â€)ã€‚æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½è¢«æ ‡è®°ä¸ºâ€œå®ˆæŠ¤çº¿ç¨‹â€æˆ–â€œç”¨æˆ·çº¿ç¨‹â€ã€‚å½“åªæœ‰å®ˆæŠ¤çº¿ç¨‹è¿è¡Œæ—¶ï¼ŒJVMä¼šè‡ªåŠ¨é€€å‡ºã€‚ çº¿ç¨‹ä¼˜å…ˆçº§çš„ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940package main.java.com.study.thread.priority;/** * @author: whb * @description: çº¿ç¨‹ä¼˜å…ˆçº§æµ‹è¯• */public class PriorityDemo { public static void main(String[] args) { System.out.println(Thread.currentThread().getName() + "(" + Thread.currentThread().getPriority() + ")"); // æ–°å»ºçº¿ç¨‹t1 Thread t1 = new MyThread("t1"); // æ–°å»ºçº¿ç¨‹t2 Thread t2 = new MyThread("t2"); // è®¾ç½®t1çš„ä¼˜å…ˆçº§ä¸º1 t1.setPriority(1); // è®¾ç½®t2çš„ä¼˜å…ˆçº§ä¸º10 t2.setPriority(10); // å¯åŠ¨t1 t1.start(); // å¯åŠ¨t2 t2.start(); }}class MyThread extends Thread { public MyThread(String name) { super(name); } @Override public void run() { for (int i = 0; i &lt; 5; i++) { System.out.println(Thread.currentThread().getName() + "(" + Thread.currentThread().getPriority() + ")" + ", loop " + i); } }}; &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234567891011main(5)t1(1), loop 0t2(10), loop 0t1(1), loop 1t1(1), loop 2t1(1), loop 3t2(10), loop 1t1(1), loop 4t2(10), loop 2t2(10), loop 3t2(10), loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainçš„ä¼˜å…ˆçº§æ˜¯5ã€‚ t1çš„ä¼˜å…ˆçº§è¢«è®¾ä¸º1ï¼Œè€Œt2çš„ä¼˜å…ˆçº§è¢«è®¾ä¸º10ã€‚cpuåœ¨æ‰§è¡Œt1å’Œt2çš„æ—¶å€™ï¼Œæ ¹æ®æ—¶é—´ç‰‡è½®å¾ªè°ƒåº¦ï¼Œæ‰€ä»¥èƒ½å¤Ÿå¹¶å‘æ‰§è¡Œã€‚ å®ˆæŠ¤çº¿ç¨‹çš„ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657package main.java.com.study.thread.priority;/** * @author: whb * @description: å®ˆæŠ¤çº¿ç¨‹ç¤ºä¾‹ */public class DaemonDemo { public static void main(String[] args) { System.out.println(Thread.currentThread().getName() + "(isDaemon=" + Thread.currentThread().isDaemon() + ")"); // æ–°å»ºçº¿ç¨‹t1 Thread t1 = new MyThread2("t1"); // æ–°å»ºçº¿ç¨‹t2 Thread t2 = new MyDaemon("t2"); // è®¾ç½®t2ä¸ºå®ˆæŠ¤çº¿ç¨‹ t2.setDaemon(true); // å¯åŠ¨t1 t1.start(); // å¯åŠ¨t2 t2.start(); }}class MyThread2 extends Thread { public MyThread2(String name) { super(name); } @Override public void run() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(3); System.out.println(this.getName() + "(isDaemon=" + this.isDaemon() + ")" + ", loop " + i); } } catch (InterruptedException e) { } }};class MyDaemon extends Thread { public MyDaemon(String name) { super(name); } @Override public void run() { try { for (int i = 0; i &lt; 10000; i++) { Thread.sleep(1); System.out.println(this.getName() + "(isDaemon=" + this.isDaemon() + ")" + ", loop " + i); } } catch (InterruptedException e) { } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910111213141516main(isDaemon=false)t2(isDaemon=true), loop 0t2(isDaemon=true), loop 1t1(isDaemon=false), loop 0t2(isDaemon=true), loop 2t1(isDaemon=false), loop 1t2(isDaemon=true), loop 3t2(isDaemon=true), loop 4t1(isDaemon=false), loop 2t2(isDaemon=true), loop 5t2(isDaemon=true), loop 6t2(isDaemon=true), loop 7t1(isDaemon=false), loop 3t2(isDaemon=true), loop 8t2(isDaemon=true), loop 9t1(isDaemon=false), loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainæ˜¯ç”¨æˆ·çº¿ç¨‹ï¼Œå®ƒåˆ›å»ºçš„å­çº¿ç¨‹t1ä¹Ÿæ˜¯ç”¨æˆ·çº¿ç¨‹ã€‚ t2æ˜¯å®ˆæŠ¤çº¿ç¨‹ã€‚åœ¨â€œä¸»çº¿ç¨‹mainâ€å’Œâ€œå­çº¿ç¨‹t1â€(å®ƒä»¬éƒ½æ˜¯ç”¨æˆ·çº¿ç¨‹)æ‰§è¡Œå®Œæ¯•ï¼Œåªå‰©t2è¿™ä¸ªå®ˆæŠ¤çº¿ç¨‹çš„æ—¶å€™ï¼ŒJVMè‡ªåŠ¨é€€å‡ºã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-09ä¹‹-çº¿ç¨‹ä¸­æ–­å’Œç»ˆæ­¢æ–¹å¼]]></title>
    <url>%2Fposts%2Fbafe248a.html</url>
    <content type="text"><![CDATA[interrupt()è¯´æ˜ å…³äºinterrupt()ï¼Œjavaçš„djkæ–‡æ¡£æè¿°å¦‚ä¸‹ï¼šhttp://docs.oracle.com/javase/7/docs/api/ Interrupts this thread. Unless the current thread is interrupting itself, which is always permitted, the checkAccess method of this thread is invoked, which may cause a SecurityException to be thrown. If this thread is blocked in an invocation of the wait(), wait(long), or wait(long, int) methods of the Object class, or of the join(), join(long), join(long, int), sleep(long), or sleep(long, int), methods of this class, then its interrupt status will be cleared and it will receive an InterruptedException. If this thread is blocked in an I/O operation upon an interruptible channel then the channel will be closed, the thread's interrupt status will be set, and the thread will receive a ClosedByInterruptException. If this thread is blocked in a Selector then the thread's interrupt status will be set and it will return immediately from the selection operation, possibly with a non-zero value, just as if the selector's wakeup method were invoked. If none of the previous conditions hold then this thread's interrupt status will be set. Interrupting a thread that is not alive need not have any effect. å¤§è‡´æ„æ€æ˜¯ï¼š interrupt()çš„ä½œç”¨æ˜¯ä¸­æ–­æœ¬çº¿ç¨‹ã€‚ æœ¬çº¿ç¨‹ä¸­æ–­è‡ªå·±æ˜¯è¢«å…è®¸çš„ï¼›å…¶å®ƒçº¿ç¨‹è°ƒç”¨æœ¬çº¿ç¨‹çš„interrupt()æ–¹æ³•æ—¶ï¼Œä¼šé€šè¿‡checkAccess()æ£€æŸ¥æƒé™ã€‚è¿™æœ‰å¯èƒ½æŠ›å‡ºSecurityExceptionå¼‚å¸¸ã€‚ å¦‚æœæœ¬çº¿ç¨‹æ˜¯å¤„äºé˜»å¡çŠ¶æ€ï¼šè°ƒç”¨çº¿ç¨‹çš„wait(), wait(long)æˆ–wait(long, int)ä¼šè®©å®ƒè¿›å…¥ç­‰å¾…(é˜»å¡)çŠ¶æ€ï¼Œæˆ–è€…è°ƒç”¨çº¿ç¨‹çš„join(), join(long), join(long, int), sleep(long), sleep(long, int)ä¹Ÿä¼šè®©å®ƒè¿›å…¥é˜»å¡çŠ¶æ€ã€‚è‹¥çº¿ç¨‹åœ¨é˜»å¡çŠ¶æ€æ—¶ï¼Œè°ƒç”¨äº†å®ƒçš„interrupt()æ–¹æ³•ï¼Œé‚£ä¹ˆå®ƒçš„â€œä¸­æ–­çŠ¶æ€â€ä¼šè¢«æ¸…é™¤å¹¶ä¸”ä¼šæ”¶åˆ°ä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹é€šè¿‡wait()è¿›å…¥é˜»å¡çŠ¶æ€ï¼Œæ­¤æ—¶é€šè¿‡interrupt()ä¸­æ–­è¯¥çº¿ç¨‹ï¼›è°ƒç”¨interrupt()ä¼šç«‹å³å°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºâ€œtrueâ€ï¼Œä½†æ˜¯ç”±äºçº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€ï¼Œæ‰€ä»¥è¯¥â€œä¸­æ–­æ ‡è®°â€ä¼šç«‹å³è¢«æ¸…é™¤ä¸ºâ€œfalseâ€ï¼ŒåŒæ—¶ï¼Œä¼šäº§ç”Ÿä¸€ä¸ªInterruptedExceptionçš„å¼‚å¸¸ã€‚ å¦‚æœçº¿ç¨‹è¢«é˜»å¡åœ¨ä¸€ä¸ªSelectoré€‰æ‹©å™¨ä¸­ï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­å®ƒæ—¶ï¼›çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºtrueï¼Œå¹¶ä¸”å®ƒä¼šç«‹å³ä»é€‰æ‹©æ“ä½œä¸­è¿”å›ã€‚ å¦‚æœä¸å±äºå‰é¢æ‰€è¯´çš„æƒ…å†µï¼Œé‚£ä¹ˆé€šè¿‡interrupt()ä¸­æ–­çº¿ç¨‹æ—¶ï¼Œå®ƒçš„ä¸­æ–­æ ‡è®°ä¼šè¢«è®¾ç½®ä¸ºâ€œtrueâ€ã€‚ ä¸­æ–­ä¸€ä¸ªâ€œå·²ç»ˆæ­¢çš„çº¿ç¨‹â€ä¸ä¼šäº§ç”Ÿä»»ä½•æ“ä½œã€‚ ç»ˆæ­¢çº¿ç¨‹çš„æ–¹å¼ ç»ˆæ­¢å¤„äºâ€œé˜»å¡çŠ¶æ€â€çš„çº¿ç¨‹ é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡â€œä¸­æ–­â€æ–¹å¼ç»ˆæ­¢å¤„äºâ€œé˜»å¡çŠ¶æ€â€çš„çº¿ç¨‹ã€‚ å½“çº¿ç¨‹ç”±äºè¢«è°ƒç”¨äº†sleep(), wait(), join()ç­‰æ–¹æ³•è€Œè¿›å…¥é˜»å¡çŠ¶æ€ï¼›è‹¥æ­¤æ—¶è°ƒç”¨çº¿ç¨‹çš„interrupt()å°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºtrueã€‚ç”±äºå¤„äºé˜»å¡çŠ¶æ€ï¼Œä¸­æ–­æ ‡è®°ä¼šè¢«æ¸…é™¤ï¼ŒåŒæ—¶äº§ç”Ÿä¸€ä¸ªInterruptedExceptionå¼‚å¸¸ã€‚å°†InterruptedExceptionæ”¾åœ¨é€‚å½“çš„ä¸ºæ­¢å°±èƒ½ç»ˆæ­¢çº¿ç¨‹ï¼Œå½¢å¼å¦‚ä¸‹ï¼š 12345678910@Overridepublic void run() { try { while (true) { // æ‰§è¡Œä»»åŠ¡... } } catch (InterruptedException ie) { // ç”±äºäº§ç”ŸInterruptedExceptionå¼‚å¸¸ï¼Œé€€å‡ºwhile(true)å¾ªç¯ï¼Œçº¿ç¨‹ç»ˆæ­¢ï¼ }} &lt;span id="inline-green"&gt; è¯´æ˜ï¼š &lt;/span&gt; &lt;p id="div-border-left-red"&gt; åœ¨while(true)ä¸­ä¸æ–­çš„æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹å¤„äºé˜»å¡çŠ¶æ€æ—¶ï¼Œè°ƒç”¨çº¿ç¨‹çš„interrupt()äº§ç”ŸInterruptedExceptionä¸­æ–­ã€‚ä¸­æ–­çš„æ•è·åœ¨while(true)ä¹‹å¤–ï¼Œè¿™æ ·å°±é€€å‡ºäº†while(true)å¾ªç¯ï¼ &lt;/p&gt; &lt;span id="inline-purple"&gt; æ³¨æ„ï¼š &lt;/span&gt; &lt;p id="div-border-left-blue"&gt; å¯¹InterruptedExceptionçš„æ•è·åŠ¡ä¸€èˆ¬æ”¾åœ¨while(true)å¾ªç¯ä½“çš„å¤–é¢ï¼Œè¿™æ ·ï¼Œåœ¨äº§ç”Ÿå¼‚å¸¸æ—¶å°±é€€å‡ºäº†while(true)å¾ªç¯ã€‚å¦åˆ™ï¼ŒInterruptedExceptionåœ¨while(true)å¾ªç¯ä½“ä¹‹å†…ï¼Œå°±éœ€è¦é¢å¤–çš„æ·»åŠ é€€å‡ºå¤„ç†ã€‚ &lt;/p&gt; å½¢å¼å¦‚ä¸‹ï¼š 123456789101112@Overridepublic void run() { while (true) { try { // æ‰§è¡Œä»»åŠ¡... } catch (InterruptedException ie) { // InterruptedExceptionåœ¨while(true)å¾ªç¯ä½“å†…ã€‚ // å½“çº¿ç¨‹äº§ç”Ÿäº†InterruptedExceptionå¼‚å¸¸æ—¶ï¼Œwhile(true)ä»èƒ½ç»§ç»­è¿è¡Œï¼éœ€è¦æ‰‹åŠ¨é€€å‡º break; } }} &lt;span id="inline-green"&gt; è¯´æ˜ï¼š&lt;/span&gt; &lt;p id="div-border-left-red"&gt; ä¸Šé¢çš„InterruptedExceptionå¼‚å¸¸çš„æ•è·åœ¨whle(true)ä¹‹å†…ã€‚å½“äº§ç”ŸInterruptedExceptionå¼‚å¸¸æ—¶ï¼Œè¢«catchå¤„ç†ä¹‹å¤–ï¼Œä»ç„¶åœ¨while(true)å¾ªç¯ä½“å†…ï¼›è¦é€€å‡ºwhile(true)å¾ªç¯ä½“ï¼Œéœ€è¦é¢å¤–çš„æ‰§è¡Œé€€å‡ºwhile(true)çš„æ“ä½œã€‚ &lt;/p&gt; ç»ˆæ­¢å¤„äºâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ é€šå¸¸ï¼Œæˆ‘ä»¬é€šè¿‡â€œæ ‡è®°â€æ–¹å¼ç»ˆæ­¢å¤„äºâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ã€‚å…¶ä¸­ï¼ŒåŒ…æ‹¬â€œä¸­æ–­æ ‡è®°â€å’Œâ€œé¢å¤–æ·»åŠ æ ‡è®°â€ã€‚ é€šè¿‡â€œä¸­æ–­æ ‡è®°â€ç»ˆæ­¢çº¿ç¨‹ å½¢å¼å¦‚ä¸‹ï¼š 123456@Overridepublic void run() { while (!isInterrupted()) { // æ‰§è¡Œä»»åŠ¡... }} &lt;span id="inline-blue"&gt; è¯´æ˜ï¼š &lt;/span&gt; &lt;p id="div-border-left-green"&gt; isInterrupted()æ˜¯åˆ¤æ–­çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°æ˜¯ä¸æ˜¯ä¸ºtrueã€‚å½“çº¿ç¨‹å¤„äºè¿è¡ŒçŠ¶æ€ï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦ç»ˆæ­¢å®ƒæ—¶ï¼›å¯ä»¥è°ƒç”¨çº¿ç¨‹çš„interrupt()æ–¹æ³•ï¼Œä½¿ç”¨çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°ä¸ºtrueï¼Œå³isInterrupted()ä¼šè¿”å›trueã€‚æ­¤æ—¶ï¼Œå°±ä¼šé€€å‡ºwhileå¾ªç¯ã€‚ &lt;/p&gt; &lt;font color="red"&gt; æ³¨æ„ï¼šinterrupt()å¹¶ä¸ä¼šç»ˆæ­¢å¤„äºâ€œè¿è¡ŒçŠ¶æ€â€çš„çº¿ç¨‹ï¼å®ƒä¼šå°†çº¿ç¨‹çš„ä¸­æ–­æ ‡è®°è®¾ä¸ºtrueã€‚ &lt;/font&gt; é€šè¿‡â€œé¢å¤–æ·»åŠ æ ‡è®°â€ å½¢å¼å¦‚ä¸‹ï¼š 1234567891011private volatile boolean flag= true;protected void stopTask() { flag = false;}@Overridepublic void run() { while (flag) { // æ‰§è¡Œä»»åŠ¡... }} &lt;span id="inline-blue"&gt; è¯´æ˜ï¼š &lt;/span&gt; &lt;p id="div-border-left-green"&gt; çº¿ç¨‹ä¸­æœ‰ä¸€ä¸ªflagæ ‡è®°ï¼Œå®ƒçš„é»˜è®¤å€¼æ˜¯trueï¼›å¹¶ä¸”æˆ‘ä»¬æä¾›stopTask()æ¥è®¾ç½®flagæ ‡è®°ã€‚å½“æˆ‘ä»¬éœ€è¦ç»ˆæ­¢è¯¥çº¿ç¨‹æ—¶ï¼Œè°ƒç”¨è¯¥çº¿ç¨‹çš„stopTask()æ–¹æ³•å°±å¯ä»¥è®©çº¿ç¨‹é€€å‡ºwhileå¾ªç¯ã€‚ &lt;/p&gt; &lt;font color="red"&gt; æ³¨æ„ï¼šå°†flagå®šä¹‰ä¸ºvolatileç±»å‹ï¼Œæ˜¯ä¸ºäº†ä¿è¯flagçš„å¯è§æ€§ã€‚å³å…¶å®ƒçº¿ç¨‹é€šè¿‡stopTask()ä¿®æ”¹äº†flagä¹‹åï¼Œæœ¬çº¿ç¨‹èƒ½çœ‹åˆ°ä¿®æ”¹åçš„flagçš„å€¼ã€‚ &lt;/font&gt; ç»¼åˆçº¿ç¨‹å¤„äºâ€œé˜»å¡çŠ¶æ€â€å’Œâ€œè¿è¡ŒçŠ¶æ€â€çš„ç»ˆæ­¢æ–¹å¼ï¼Œæ¯”è¾ƒ &lt;span id="inline-purple"&gt; é€šç”¨çš„ç»ˆæ­¢çº¿ç¨‹çš„å½¢å¼ &lt;/span&gt; å¦‚ä¸‹ï¼š 1234567891011@Overridepublic void run() { try { // 1. isInterrupted()ä¿è¯ï¼Œåªè¦ä¸­æ–­æ ‡è®°ä¸ºtrueå°±ç»ˆæ­¢çº¿ç¨‹ã€‚ while (!isInterrupted()) { // æ‰§è¡Œä»»åŠ¡... } } catch (InterruptedException ie) { // 2. InterruptedExceptionå¼‚å¸¸ä¿è¯ï¼Œå½“InterruptedExceptionå¼‚å¸¸äº§ç”Ÿæ—¶ï¼Œçº¿ç¨‹è¢«ç»ˆæ­¢ã€‚ }} ç»ˆæ­¢çº¿ç¨‹çš„ç¤ºä¾‹ é¦–å…ˆå®šä¹‰çº¿ç¨‹å¯¹è±¡MyThread 1234567891011121314151617181920212223242526package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹å¯¹è±¡ */public class MyThread extends Thread { public MyThread(String name) { super(name); } @Override public void run() { int i = 0; while (!isInterrupted()) { try { Thread.sleep(100); } catch (InterruptedException ie) { System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") catch InterruptedException."); } i++; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") loop " + i); } }} 123456789101112131415161718192021222324252627282930package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹1 */public class Demo1 { public static void main(String[] args) { try { // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.interrupt(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); } catch (InterruptedException e) { e.printStackTrace(); } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234567t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) catch InterruptedException.t1 (TERMINATED) is interrupted now. &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­é€šè¿‡new MyThread("t1")åˆ›å»ºçº¿ç¨‹t1ï¼Œä¹‹åé€šè¿‡t1.start()å¯åŠ¨çº¿ç¨‹t1ã€‚ t1å¯åŠ¨ä¹‹åï¼Œä¼šä¸æ–­çš„æ£€æŸ¥å®ƒçš„ä¸­æ–­æ ‡è®°ï¼Œå¦‚æœä¸­æ–­æ ‡è®°ä¸ºâ€œfalseâ€ï¼›åˆ™ä¼‘çœ 100msã€‚ t1ä¼‘çœ ä¹‹åï¼Œä¼šåˆ‡æ¢åˆ°ä¸»çº¿ç¨‹mainï¼›ä¸»çº¿ç¨‹å†æ¬¡è¿è¡Œæ—¶ï¼Œä¼šæ‰§è¡Œt1.interrupt()ä¸­æ–­çº¿ç¨‹t1ã€‚t1æ”¶åˆ°ä¸­æ–­æŒ‡ä»¤ä¹‹åï¼Œä¼šå°†t1çš„ä¸­æ–­æ ‡è®°è®¾ç½®â€œfalseâ€ï¼Œè€Œä¸”ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€‚åœ¨t1çš„run()æ–¹æ³•ä¸­ï¼Œæ˜¯åœ¨å¾ªç¯ä½“whileä¹‹å¤–æ•è·çš„å¼‚å¸¸ï¼›å› æ­¤å¾ªç¯è¢«ç»ˆæ­¢ã€‚ å¯¹ä¸Šé¢çš„ä»£ç è¿›è¡Œå°å°çš„ä¿®æ”¹ï¼Œå°†run()æ–¹æ³•ä¸­æ•è·InterruptedExceptionå¼‚å¸¸çš„ä»£ç å—ç§»åˆ°whileå¾ªç¯ä½“å†…ã€‚ 12345678910111213141516171819202122232425262728293031package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹2 */public class Demo2 { public static void main(String[] args) { try { // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t1.start(); System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.interrupt(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); } catch (InterruptedException e) { e.printStackTrace(); } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 123456789101112131415t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) catch InterruptedException.t1 (RUNNABLE) loop 3t1 (RUNNABLE) loop 4t1 (RUNNABLE) loop 5t1 (TIMED_WAITING) is interrupted now.t1 (RUNNABLE) loop 6t1 (RUNNABLE) loop 7t1 (RUNNABLE) loop 8t1 (RUNNABLE) loop 9... &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; &lt;font color="red"&gt; ç¨‹åºè¿›å…¥äº†æ­»å¾ªç¯ï¼ &lt;/font&gt; ä¸ºä»€ä¹ˆä¼šè¿™æ ·å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºï¼Œt1åœ¨â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€æ—¶ï¼Œè¢«interrupt()ä¸­æ–­ï¼›æ­¤æ—¶ï¼Œä¼šæ¸…é™¤ä¸­æ–­æ ‡è®°ã€Œå³isInterrupted()ä¼šè¿”å›falseã€ï¼Œè€Œä¸”ä¼šæŠ›å‡ºInterruptedExceptionå¼‚å¸¸ã€Œè¯¥å¼‚å¸¸åœ¨whileå¾ªç¯ä½“å†…è¢«æ•è·ã€ã€‚å› æ­¤ï¼Œt1ç†æ‰€å½“ç„¶çš„ä¼šè¿›å…¥æ­»å¾ªç¯äº†ã€‚ &lt;p id="div-border-left-red"&gt; è§£å†³è¯¥é—®é¢˜ï¼Œéœ€è¦åœ¨æ•è·å¼‚å¸¸æ—¶ï¼Œé¢å¤–çš„è¿›è¡Œé€€å‡ºwhileå¾ªç¯çš„å¤„ç†ã€‚ä¾‹å¦‚ï¼Œåœ¨MyThreadçš„catch(InterruptedException)ä¸­æ·»åŠ break æˆ– returnå°±èƒ½è§£å†³è¯¥é—®é¢˜ã€‚ &lt;/p&gt; ä¸‹é¢æ˜¯é€šè¿‡â€œé¢å¤–æ·»åŠ æ ‡è®°â€çš„æ–¹å¼ç»ˆæ­¢â€œçŠ¶æ€çŠ¶æ€â€çš„çº¿ç¨‹çš„ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859package main.java.com.study.thread.interrupt;/** * @author: whb * @description: çº¿ç¨‹ç»ˆæ­¢ç¤ºä¾‹3 */public class Demo3 { public static void main(String[] args) { try { // æ–°å»ºâ€œçº¿ç¨‹t1â€ TestThread t1 = new TestThread("t1"); System.out.println(t1.getName() + " (" + t1.getState() + ") is new."); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(t1.getName() + " (" + t1.getState() + ") is started."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åä¸»çº¿ç¨‹ç»™t1å‘â€œä¸­æ–­â€æŒ‡ä»¤ã€‚ Thread.sleep(300); t1.stopTask(); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted."); // ä¸»çº¿ç¨‹ä¼‘çœ 300msï¼Œç„¶åæŸ¥çœ‹t1çš„çŠ¶æ€ã€‚ Thread.sleep(300); System.out.println(t1.getName() + " (" + t1.getState() + ") is interrupted now."); } catch (InterruptedException e) { e.printStackTrace(); } }}class TestThread extends Thread { private volatile boolean flag = true; public void stopTask() { flag = false; } public TestThread(String name) { super(name); } @Override public void run() { synchronized (this) { try { int i = 0; while (flag) { Thread.sleep(100); i++; System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") loop " + i); } } catch (InterruptedException ie) { System.out.println(Thread.currentThread().getName() + " (" + this.getState() + ") catch InterruptedException."); } } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234567t1 (NEW) is new.t1 (RUNNABLE) is started.t1 (RUNNABLE) loop 1t1 (RUNNABLE) loop 2t1 (TIMED_WAITING) is interrupted.t1 (RUNNABLE) loop 3t1 (TERMINATED) is interrupted now. interrupted() å’Œ isInterrupted()çš„åŒºåˆ« interrupted() å’Œ isInterrupted()éƒ½èƒ½å¤Ÿç”¨äºæ£€æµ‹å¯¹è±¡çš„â€œä¸­æ–­æ ‡è®°â€ã€‚ åŒºåˆ«æ˜¯ï¼Œinterrupted()é™¤äº†è¿”å›ä¸­æ–­æ ‡è®°ä¹‹å¤–ï¼Œå®ƒè¿˜ä¼šæ¸…é™¤ä¸­æ–­æ ‡è®°(å³å°†ä¸­æ–­æ ‡è®°è®¾ä¸ºfalse)ï¼›è€ŒisInterrupted()ä»…ä»…è¿”å›ä¸­æ–­æ ‡è®°ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-å†…å®¹æ€»ç»“]]></title>
    <url>%2Fposts%2Fc0ec3ded.html</url>
    <content type="text"><![CDATA[å¤„ç†å™¨å†…å­˜æ¨¡å‹ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ï¼ŒJMM å’Œå¤„ç†å™¨å†…å­˜æ¨¡å‹åœ¨è®¾è®¡æ—¶é€šå¸¸ä¼šæŠŠé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä½œä¸ºå‚ç…§ã€‚JMM å’Œå¤„ç†å™¨å†…å­˜æ¨¡å‹åœ¨è®¾è®¡æ—¶ä¼šå¯¹é¡ºåºä¸€è‡´æ€§æ¨¡å‹åšä¸€äº›æ”¾æ¾ï¼Œå› ä¸ºå¦‚æœå®Œå…¨æŒ‰ç…§é¡ºåºä¸€è‡´æ€§æ¨¡å‹æ¥å®ç°å¤„ç†å™¨å’Œ JMMï¼Œé‚£ä¹ˆå¾ˆå¤šçš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨ä¼˜åŒ–éƒ½è¦è¢«ç¦æ­¢ï¼Œè¿™å¯¹æ‰§è¡Œæ€§èƒ½å°†ä¼šæœ‰å¾ˆå¤§çš„å½±å“ã€‚ æ ¹æ®å¯¹ä¸åŒç±»å‹è¯» / å†™æ“ä½œç»„åˆçš„æ‰§è¡Œé¡ºåºçš„æ”¾æ¾ï¼Œå¯ä»¥æŠŠå¸¸è§å¤„ç†å™¨çš„å†…å­˜æ¨¡å‹åˆ’åˆ†ä¸ºä¸‹é¢å‡ ç§ç±»å‹ï¼š æ”¾æ¾ç¨‹åºä¸­å†™ - è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† total store ordering å†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸º TSOï¼‰ã€‚ åœ¨å‰é¢ 1 çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­å†™ - å†™æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† partial store order å†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸º PSOï¼‰ã€‚ åœ¨å‰é¢ 1 å’Œ 2 çš„åŸºç¡€ä¸Šï¼Œç»§ç»­æ”¾æ¾ç¨‹åºä¸­è¯» - å†™å’Œè¯» - è¯»æ“ä½œçš„é¡ºåºï¼Œç”±æ­¤äº§ç”Ÿäº† relaxed memory order å†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸º RMOï¼‰å’Œ PowerPC å†…å­˜æ¨¡å‹ã€‚ æ³¨æ„ï¼Œè¿™é‡Œå¤„ç†å™¨å¯¹è¯» / å†™æ“ä½œçš„æ”¾æ¾ï¼Œæ˜¯ä»¥ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ä¸ºå‰æçš„ï¼ˆå› ä¸ºå¤„ç†å™¨è¦éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–æ€§çš„ä¸¤ä¸ªå†…å­˜æ“ä½œåšé‡æ’åºï¼‰ã€‚ å¸¸è§å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„ç»†èŠ‚ç‰¹å¾ï¼š å†…å­˜æ¨¡å‹åç§° å¯¹åº”çš„å¤„ç†å™¨ Store-Loadé‡æ’åº Store-Storeé‡æ’åº Load-Loadå’ŒLoad-Storeé‡æ’åº å¯ä»¥æ›´æ—©è¯»å–åˆ°å…¶ä»–å¤„ç†å™¨çš„å†™ å¯ä»¥æ›´æ—©è¯»å–åˆ°å½“å‰å¤„ç†å™¨çš„å†™ TSO sparc-TSO X64 Y Y PSO sparc-PSO Y Y Y RMO ia64 Y Y Y Y PowerPC PowerPC Y Y Y Y Y åœ¨è¿™ä¸ªè¡¨æ ¼ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰€æœ‰å¤„ç†å™¨å†…å­˜æ¨¡å‹éƒ½å…è®¸å†™ - è¯»é‡æ’åºï¼ŒåŸå› ï¼šå®ƒä»¬éƒ½ä½¿ç”¨äº†å†™ç¼“å­˜åŒºï¼Œå†™ç¼“å­˜åŒºå¯èƒ½å¯¼è‡´å†™ - è¯»æ“ä½œé‡æ’åºã€‚åŒæ—¶ï¼Œå¯ä»¥çœ‹åˆ°è¿™äº›å¤„ç†å™¨å†…å­˜æ¨¡å‹éƒ½å…è®¸æ›´æ—©è¯»åˆ°å½“å‰å¤„ç†å™¨çš„å†™ï¼ŒåŸå› åŒæ ·æ˜¯å› ä¸ºå†™ç¼“å­˜åŒºï¼šç”±äºå†™ç¼“å­˜åŒºä»…å¯¹å½“å‰å¤„ç†å™¨å¯è§ï¼Œè¿™ä¸ªç‰¹æ€§å¯¼è‡´å½“å‰å¤„ç†å™¨å¯ä»¥æ¯”å…¶ä»–å¤„ç†å™¨å…ˆçœ‹åˆ°ä¸´æ—¶ä¿å­˜åœ¨è‡ªå·±çš„å†™ç¼“å­˜åŒºä¸­çš„å†™ã€‚ ä¸Šé¢è¡¨æ ¼ä¸­çš„å„ç§å¤„ç†å™¨å†…å­˜æ¨¡å‹ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œæ¨¡å‹ç”±å¼ºå˜å¼±ã€‚è¶Šæ˜¯è¿½æ±‚æ€§èƒ½çš„å¤„ç†å™¨ï¼Œå†…å­˜æ¨¡å‹è®¾è®¡çš„ä¼šè¶Šå¼±ã€‚å› ä¸ºè¿™äº›å¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡å‹å¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åšå°½å¯èƒ½å¤šçš„ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚ ç”±äºå¸¸è§çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹æ¯” JMM è¦å¼±ï¼Œjava ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æ‰§è¡ŒæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®æ’å…¥å†…å­˜å±éšœæ¥é™åˆ¶å¤„ç†å™¨çš„é‡æ’åºã€‚åŒæ—¶ï¼Œç”±äºå„ç§å¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å¼ºå¼±å¹¶ä¸ç›¸åŒï¼Œä¸ºäº†åœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°å‘ç¨‹åºå‘˜å±•ç¤ºä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡å‹ï¼ŒJMM åœ¨ä¸åŒçš„å¤„ç†å™¨ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„æ•°é‡å’Œç§ç±»ä¹Ÿä¸ç›¸åŒã€‚ ä¸‹å›¾å±•ç¤ºäº† JMM åœ¨ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸­éœ€è¦æ’å…¥çš„å†…å­˜å±éšœçš„ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒJMM å±è”½äº†ä¸åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹çš„å·®å¼‚ï¼Œå®ƒåœ¨ä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šä¸º java ç¨‹åºå‘˜å‘ˆç°äº†ä¸€ä¸ªä¸€è‡´çš„å†…å­˜æ¨¡å‹ã€‚ JMMã€å¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¹‹é—´çš„å…³ç³» JMM æ˜¯ä¸€ä¸ªè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹æ˜¯ç¡¬ä»¶çº§çš„å†…å­˜æ¨¡å‹ï¼Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ä¸€ä¸ªç†è®ºå‚è€ƒæ¨¡å‹ã€‚ä¸‹é¢æ˜¯è¯­è¨€å†…å­˜æ¨¡å‹ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹å’Œé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹çš„å¼ºå¼±å¯¹æ¯”ç¤ºæ„å›¾ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šå¸¸è§çš„ 4 ç§å¤„ç†å™¨å†…å­˜æ¨¡å‹æ¯”å¸¸ç”¨çš„ 3 ä¸­è¯­è¨€å†…å­˜æ¨¡å‹è¦å¼±ï¼Œå¤„ç†å™¨å†…å­˜æ¨¡å‹å’Œè¯­è¨€å†…å­˜æ¨¡å‹éƒ½æ¯”é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹è¦å¼±ã€‚åŒå¤„ç†å™¨å†…å­˜æ¨¡å‹ä¸€æ ·ï¼Œè¶Šæ˜¯è¿½æ±‚æ‰§è¡Œæ€§èƒ½çš„è¯­è¨€ï¼Œå†…å­˜æ¨¡å‹è®¾è®¡çš„ä¼šè¶Šå¼±ã€‚ JMMçš„è®¾è®¡ ä» JMM è®¾è®¡è€…çš„è§’åº¦æ¥è¯´ï¼Œåœ¨è®¾è®¡ JMM æ—¶ï¼Œéœ€è¦è€ƒè™‘ä¸¤ä¸ªå…³é”®å› ç´ ï¼š ç¨‹åºå‘˜å¯¹å†…å­˜æ¨¡å‹çš„ä½¿ç”¨ã€‚ç¨‹åºå‘˜å¸Œæœ›å†…å­˜æ¨¡å‹æ˜“äºç†è§£ï¼Œæ˜“äºç¼–ç¨‹ã€‚ç¨‹åºå‘˜å¸Œæœ›åŸºäºä¸€ä¸ªå¼ºå†…å­˜æ¨¡å‹æ¥ç¼–å†™ä»£ç ã€‚ ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹å†…å­˜æ¨¡å‹çš„å®ç°ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å†…å­˜æ¨¡å‹å¯¹å®ƒä»¬çš„æŸç¼šè¶Šå°‘è¶Šå¥½ï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥åšå°½å¯èƒ½å¤šçš„ä¼˜åŒ–æ¥æé«˜æ€§èƒ½ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸Œæœ›å®ç°ä¸€ä¸ªå¼±å†…å­˜æ¨¡å‹ã€‚ ç”±äºè¿™ä¸¤ä¸ªå› ç´ äº’ç›¸çŸ›ç›¾ï¼Œæ‰€ä»¥ JSR-133 ä¸“å®¶ç»„åœ¨è®¾è®¡ JMM æ—¶çš„æ ¸å¿ƒç›®æ ‡å°±æ˜¯æ‰¾åˆ°ä¸€ä¸ªå¥½çš„å¹³è¡¡ç‚¹ï¼šä¸€æ–¹é¢è¦ä¸ºç¨‹åºå‘˜æä¾›è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ï¼›å¦ä¸€æ–¹é¢ï¼Œå¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é™åˆ¶è¦å°½å¯èƒ½çš„æ”¾æ¾ã€‚ JSR-133 æ˜¯å¦‚ä½•å®ç°è¿™ä¸€ç›®æ ‡çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼šhappens-beforeè§„åˆ™ã€‚ JMM æŠŠ happens- before è¦æ±‚ç¦æ­¢çš„é‡æ’åºåˆ†ä¸ºäº†ä¸‹é¢ä¸¤ç±»ï¼š ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºã€‚ ä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºã€‚ JMM å¯¹è¿™ä¸¤ç§ä¸åŒæ€§è´¨çš„é‡æ’åºï¼Œé‡‡å–äº†ä¸åŒçš„ç­–ç•¥ï¼š å¯¹äºä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM è¦æ±‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¿…é¡»ç¦æ­¢è¿™ç§é‡æ’åºã€‚ å¯¹äºä¸ä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„é‡æ’åºï¼ŒJMM å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä½œè¦æ±‚ï¼ˆJMM å…è®¸è¿™ç§é‡æ’åºï¼‰ ä¸‹é¢æ˜¯ JMM çš„è®¾è®¡ç¤ºæ„å›¾ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºä¸¤ç‚¹ï¼š JMM å‘ç¨‹åºå‘˜æä¾›çš„ happens- before è§„åˆ™èƒ½æ»¡è¶³ç¨‹åºå‘˜çš„éœ€æ±‚ã€‚JMM çš„ happens- before è§„åˆ™ä¸ä½†ç®€å•æ˜“æ‡‚ï¼Œè€Œä¸”ä¹Ÿå‘ç¨‹åºå‘˜æä¾›äº†è¶³å¤Ÿå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ JMM å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„æŸç¼šå·²ç»å°½å¯èƒ½çš„å°‘ã€‚JMM å…¶å®æ˜¯åœ¨éµå¾ªä¸€ä¸ªåŸºæœ¬åŸåˆ™ï¼šåªè¦ä¸æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼ˆæŒ‡çš„æ˜¯å•çº¿ç¨‹ç¨‹åºå’Œæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨æ€ä¹ˆä¼˜åŒ–éƒ½è¡Œã€‚æ¯”å¦‚ï¼Œå¦‚æœç¼–è¯‘å™¨ç»è¿‡ç»†è‡´çš„åˆ†æåï¼Œè®¤å®šä¸€ä¸ªé”åªä¼šè¢«å•ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆè¿™ä¸ªé”å¯ä»¥è¢«æ¶ˆé™¤ã€‚å†æ¯”å¦‚ï¼Œå¦‚æœç¼–è¯‘å™¨ç»è¿‡ç»†è‡´çš„åˆ†æåï¼Œè®¤å®šä¸€ä¸ª volatile å˜é‡ä»…ä»…åªä¼šè¢«å•ä¸ªçº¿ç¨‹è®¿é—®ï¼Œé‚£ä¹ˆç¼–è¯‘å™¨å¯ä»¥æŠŠè¿™ä¸ª volatile å˜é‡å½“ä½œä¸€ä¸ªæ™®é€šå˜é‡æ¥å¯¹å¾…ã€‚è¿™äº›ä¼˜åŒ–æ—¢ä¸ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœï¼Œåˆèƒ½æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚ JMMå†…å­˜å¯è§æ€§ä¿è¯ Java ç¨‹åºçš„å†…å­˜å¯è§æ€§ä¿è¯æŒ‰ç¨‹åºç±»å‹å¯ä»¥åˆ†ä¸ºä¸‹åˆ—ä¸‰ç±»ï¼š å•çº¿ç¨‹ç¨‹åºã€‚å•çº¿ç¨‹ç¨‹åºä¸ä¼šå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨ä¼šå…±åŒç¡®ä¿å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚ æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒï¼‰ã€‚è¿™æ˜¯ JMM å…³æ³¨çš„é‡ç‚¹ï¼ŒJMM é€šè¿‡é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„é‡æ’åºæ¥ä¸ºç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ æœªåŒæ­¥ / æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚JMM ä¸ºå®ƒä»¬æä¾›äº†æœ€å°å®‰å…¨æ€§ä¿éšœï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼Œnullï¼Œfalseï¼‰ã€‚ ä¸‹å›¾å±•ç¤ºäº†è¿™ä¸‰ç±»ç¨‹åºåœ¨ JMM ä¸­ä¸åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœçš„å¼‚åŒï¼š åªè¦å¤šçº¿ç¨‹ç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼ŒJMM ä¿è¯è¯¥ç¨‹åºåœ¨ä»»æ„çš„å¤„ç†å™¨å¹³å°ä¸Šçš„æ‰§è¡Œç»“æœï¼Œä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœä¸€è‡´ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-08ä¹‹-çº¿ç¨‹Join]]></title>
    <url>%2Fposts%2F38c1adea.html</url>
    <content type="text"><![CDATA[join()ä»‹ç» join() çš„ä½œç”¨ï¼šè®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…â€œå­çº¿ç¨‹â€ç»“æŸä¹‹åæ‰èƒ½ç»§ç»­è¿è¡Œã€‚é€šè¿‡ä¾‹å­æ¥ç†è§£ï¼š 123456789101112131415// ä¸»çº¿ç¨‹public class Father extends Thread { public void run() { Son s = new Son(); s.start(); s.join(); ... }}// å­çº¿ç¨‹public class Son extends Thread { public void run() { ... }} &lt;span id="inline-purple"&gt; è¯´æ˜ï¼š &lt;/span&gt; ä¸Šé¢çš„æœ‰ä¸¤ä¸ªç±»Father(ä¸»çº¿ç¨‹ç±»)å’ŒSon(å­çº¿ç¨‹ç±»)ã€‚å› ä¸ºSonæ˜¯åœ¨Fatherä¸­åˆ›å»ºå¹¶å¯åŠ¨çš„ï¼Œæ‰€ä»¥ï¼ŒFatheræ˜¯ä¸»çº¿ç¨‹ç±»ï¼ŒSonæ˜¯å­çº¿ç¨‹ç±»ã€‚ åœ¨Fatherä¸»çº¿ç¨‹ä¸­ï¼Œé€šè¿‡new Son()æ–°å»ºâ€œå­çº¿ç¨‹sâ€ã€‚æ¥ç€é€šè¿‡s.start()å¯åŠ¨â€œå­çº¿ç¨‹sâ€ï¼Œå¹¶ä¸”è°ƒç”¨s.join()ã€‚åœ¨è°ƒç”¨s.join()ä¹‹åï¼ŒFatherä¸»çº¿ç¨‹ä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°â€œå­çº¿ç¨‹sâ€è¿è¡Œå®Œæ¯•ï¼›åœ¨â€œå­çº¿ç¨‹sâ€è¿è¡Œå®Œæ¯•ä¹‹åï¼ŒFatherä¸»çº¿ç¨‹æ‰èƒ½æ¥ç€è¿è¡Œã€‚ è¿™ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„â€œjoin()çš„ä½œç”¨ï¼Œæ˜¯è®©ä¸»çº¿ç¨‹ä¼šç­‰å¾…å­çº¿ç¨‹ç»“æŸä¹‹åæ‰èƒ½ç»§ç»­è¿è¡Œâ€ï¼ join()æºç åˆ†æ 12345678910111213141516171819202122232425262728public final void join() throws InterruptedException { join(0);}public final synchronized void join(long millis)throws InterruptedException { long base = System.currentTimeMillis(); long now = 0; if (millis &lt; 0) { throw new IllegalArgumentException("timeout value is negative"); } if (millis == 0) { while (isAlive()) { wait(0); } } else { while (isAlive()) { long delay = millis - now; if (delay &lt;= 0) { break; } wait(delay); now = System.currentTimeMillis() - base; } }} &lt;span id="inline-purple"&gt;è¯´æ˜ï¼š &lt;/span&gt; ä»ä»£ç ä¸­ï¼Œå¯ä»¥å‘ç°ã€‚å½“millis==0æ—¶ï¼Œä¼šè¿›å…¥while(isAlive())å¾ªç¯ï¼›å³åªè¦å­çº¿ç¨‹æ˜¯æ´»çš„ï¼Œä¸»çº¿ç¨‹å°±ä¸åœçš„ç­‰å¾…ã€‚ æ ¹æ®ä¸Šé¢è§£é‡Šjoin()ä½œç”¨æ—¶çš„ä»£ç æ¥ç†è§£join()çš„ç”¨æ³•ï¼ &lt;span id="inline-blue"&gt; é—®é¢˜ï¼š &lt;/span&gt; &lt;p id="div-border-left-red"&gt;è™½ç„¶s.join()è¢«è°ƒç”¨çš„åœ°æ–¹æ˜¯å‘ç”Ÿåœ¨â€œFatherä¸»çº¿ç¨‹â€ä¸­ï¼Œä½†æ˜¯s.join()æ˜¯é€šè¿‡â€œå­çº¿ç¨‹sâ€å»è°ƒç”¨çš„join()ã€‚é‚£ä¹ˆï¼Œjoin()æ–¹æ³•ä¸­çš„isAlive()åº”è¯¥æ˜¯åˆ¤æ–­â€œå­çº¿ç¨‹sâ€æ˜¯ä¸æ˜¯AliveçŠ¶æ€ï¼›å¯¹åº”çš„wait(0)ä¹Ÿåº”è¯¥æ˜¯â€œè®©å­çº¿ç¨‹sâ€ç­‰å¾…æ‰å¯¹ã€‚ä½†å¦‚æœæ˜¯è¿™æ ·çš„è¯ï¼Œs.join()çš„ä½œç”¨æ€ä¹ˆå¯èƒ½æ˜¯â€œè®©ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°å­çº¿ç¨‹så®Œæˆä¸ºæ­¢â€å‘¢ï¼Œåº”è¯¥æ˜¯è®©"å­çº¿ç¨‹ç­‰å¾…æ‰å¯¹(å› ä¸ºè°ƒç”¨å­çº¿ç¨‹å¯¹è±¡sçš„waitæ–¹æ³•å˜›)"ï¼Ÿ&lt;/p&gt; &lt;span id="inline-green"&gt; ç­”æ¡ˆï¼š &lt;/span&gt; &lt;p id="div-border-left-green"&gt;wait()çš„ä½œç”¨æ˜¯è®©â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œè¿™é‡Œçš„â€œå½“å‰çº¿ç¨‹â€æ˜¯æŒ‡å½“å‰åœ¨CPUä¸Šè¿è¡Œçš„çº¿ç¨‹ã€‚æ‰€ä»¥ï¼Œè™½ç„¶æ˜¯è°ƒç”¨å­çº¿ç¨‹çš„wait()æ–¹æ³•ï¼Œä½†æ˜¯å®ƒæ˜¯é€šè¿‡â€œä¸»çº¿ç¨‹â€å»è°ƒç”¨çš„ï¼›æ‰€ä»¥ï¼Œä¼‘çœ çš„æ˜¯ä¸»çº¿ç¨‹ï¼Œè€Œä¸æ˜¯â€œå­çº¿ç¨‹â€ï¼&lt;/p&gt; join()ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031323334353637383940package main.java.com.study.thread.join;/** * @author: whb * @description: join() çš„ä½œç”¨ï¼šè®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…â€œå­çº¿ç¨‹â€ç»“æŸä¹‹åæ‰èƒ½ç»§ç»­è¿è¡Œã€‚ */public class JoinTest { public static void main(String[] args) { try { // æ–°å»ºâ€œçº¿ç¨‹t1â€ ThreadA t1 = new ThreadA("t1"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t1.join(); // å°†â€œçº¿ç¨‹t1â€åŠ å…¥åˆ°â€œä¸»çº¿ç¨‹mainâ€ä¸­ï¼Œå¹¶ä¸”â€œä¸»çº¿ç¨‹main()ä¼šç­‰å¾…å®ƒçš„å®Œæˆâ€ System.out.printf("%s finish\n", Thread.currentThread().getName()); } catch (InterruptedException e) { e.printStackTrace(); } } static class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { System.out.printf("%s start\n", this.getName()); // å»¶æ—¶æ“ä½œ for (int i = 0; i &lt; 1000000; i++) { ; } System.out.printf("%s finish\n", this.getName()); } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 123t1 startt1 finishmain finish &lt;span id="inline-green"&gt; è¿è¡Œç»“æœï¼š&lt;/span&gt; (01) åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­é€šè¿‡ new ThreadA("t1") æ–°å»ºâ€œçº¿ç¨‹t1â€ã€‚ æ¥ç€ï¼Œé€šè¿‡ t1.start() å¯åŠ¨â€œçº¿ç¨‹t1â€ï¼Œå¹¶æ‰§è¡Œt1.join()ã€‚ (02) æ‰§è¡Œt1.join()ä¹‹åï¼Œâ€œä¸»çº¿ç¨‹mainâ€ä¼šè¿›å…¥â€œé˜»å¡çŠ¶æ€â€ç­‰å¾…t1è¿è¡Œç»“æŸã€‚â€œå­çº¿ç¨‹t1â€ç»“æŸä¹‹åï¼Œä¼šå”¤é†’â€œä¸»çº¿ç¨‹mainâ€ï¼Œâ€œä¸»çº¿ç¨‹â€é‡æ–°è·å–cpuæ‰§è¡Œæƒï¼Œç»§ç»­è¿è¡Œã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-ç†è§£final]]></title>
    <url>%2Fposts%2F5a0704df.html</url>
    <content type="text"><![CDATA[æ¦‚è¿° ä¸é”å’Œ volatile ç›¸æ¯”è¾ƒï¼Œå¯¹ final åŸŸçš„è¯»å’Œå†™æ›´åƒæ˜¯æ™®é€šçš„å˜é‡è®¿é—®ã€‚å¯¹äº final åŸŸï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨è¦éµå®ˆä¸¤ä¸ªé‡æ’åºè§„åˆ™ï¼š åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final åŸŸçš„å†™å…¥ï¼Œä¸éšåæŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ åˆæ¬¡è¯»ä¸€ä¸ªåŒ…å« final åŸŸçš„å¯¹è±¡çš„å¼•ç”¨ï¼Œä¸éšååˆæ¬¡è¯»è¿™ä¸ª final åŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ ç¤ºä¾‹ä»£ç ï¼š 1234567891011121314151617181920public class FinalExample { int i; // æ™®é€šå˜é‡ final int j; //final å˜é‡ static FinalExample obj; public void FinalExample () { // æ„é€ å‡½æ•° i = 1; // å†™æ™®é€šåŸŸ j = 2; // å†™ final åŸŸ } public static void writer () { // å†™çº¿ç¨‹ A æ‰§è¡Œ obj = new FinalExample (); } public static void reader () { // è¯»çº¿ç¨‹ B æ‰§è¡Œ FinalExample object = obj; // è¯»å¯¹è±¡å¼•ç”¨ int a = object.i; // è¯»æ™®é€šåŸŸ int b = object.j; // è¯» final åŸŸ }} è¿™é‡Œå‡è®¾ä¸€ä¸ªçº¿ç¨‹ A æ‰§è¡Œ writer () æ–¹æ³•ï¼Œéšåå¦ä¸€ä¸ªçº¿ç¨‹ B æ‰§è¡Œ reader () æ–¹æ³•ã€‚ å†™finalåŸŸçš„é‡æ’åºè§„åˆ™ å†™ final åŸŸçš„é‡æ’åºè§„åˆ™ç¦æ­¢æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚è¿™ä¸ªè§„åˆ™çš„å®ç°åŒ…å«ä¸‹é¢ 2 ä¸ªæ–¹é¢ï¼š JMM ç¦æ­¢ç¼–è¯‘å™¨æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚ ç¼–è¯‘å™¨ä¼šåœ¨ final åŸŸçš„å†™ä¹‹åï¼Œæ„é€ å‡½æ•° return ä¹‹å‰ï¼Œæ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚è¿™ä¸ªå±éšœç¦æ­¢å¤„ç†å™¨æŠŠ final åŸŸçš„å†™é‡æ’åºåˆ°æ„é€ å‡½æ•°ä¹‹å¤–ã€‚ ç°åœ¨åˆ†æ writer () æ–¹æ³•ï¼šfinalExample = new FinalExample ()ã€‚è¿™è¡Œä»£ç åŒ…å«ä¸¤ä¸ªæ­¥éª¤ï¼š æ„é€ ä¸€ä¸ª FinalExample ç±»å‹çš„å¯¹è±¡ï¼› æŠŠè¿™ä¸ªå¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™å¼•ç”¨å˜é‡ objã€‚ å‡è®¾çº¿ç¨‹ B è¯»å¯¹è±¡å¼•ç”¨ä¸è¯»å¯¹è±¡çš„æˆå‘˜åŸŸä¹‹é—´æ²¡æœ‰é‡æ’åºï¼Œä¸‹å›¾æ˜¯ä¸€ç§å¯èƒ½çš„æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œå†™æ™®é€šåŸŸçš„æ“ä½œè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ°äº†æ„é€ å‡½æ•°ä¹‹å¤–ï¼Œè¯»çº¿ç¨‹ B é”™è¯¯çš„è¯»å–äº†æ™®é€šå˜é‡ i åˆå§‹åŒ–ä¹‹å‰çš„å€¼ã€‚è€Œå†™ final åŸŸçš„æ“ä½œï¼Œè¢«å†™ final åŸŸçš„é‡æ’åºè§„åˆ™â€œé™å®šâ€åœ¨äº†æ„é€ å‡½æ•°ä¹‹å†…ï¼Œè¯»çº¿ç¨‹ B æ­£ç¡®çš„è¯»å–äº† final å˜é‡åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚ å†™ final åŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¯¹è±¡å¼•ç”¨ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œå¯¹è±¡çš„ final åŸŸå·²ç»è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ï¼Œè€Œæ™®é€šåŸŸä¸å…·æœ‰è¿™ä¸ªä¿éšœã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œåœ¨è¯»çº¿ç¨‹ Bâ€œçœ‹åˆ°â€å¯¹è±¡å¼•ç”¨ obj æ—¶ï¼Œå¾ˆå¯èƒ½ obj å¯¹è±¡è¿˜æ²¡æœ‰æ„é€ å®Œæˆï¼ˆå¯¹æ™®é€šåŸŸ i çš„å†™æ“ä½œè¢«é‡æ’åºåˆ°æ„é€ å‡½æ•°å¤–ï¼Œæ­¤æ—¶åˆå§‹å€¼ 2 è¿˜æ²¡æœ‰å†™å…¥æ™®é€šåŸŸ iï¼‰ã€‚ è¯»finalåŸŸçš„é‡æ’åºè§„åˆ™ åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œåˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸åˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„ final åŸŸï¼ŒJMM ç¦æ­¢å¤„ç†å™¨é‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œï¼ˆè¿™ä¸ªè§„åˆ™ä»…ä»…é’ˆå¯¹å¤„ç†å™¨ï¼‰ã€‚ç¼–è¯‘å™¨ä¼šåœ¨è¯» final åŸŸæ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åˆæ¬¡è¯»å¯¹è±¡å¼•ç”¨ä¸åˆæ¬¡è¯»è¯¥å¯¹è±¡åŒ…å«çš„ final åŸŸï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»ã€‚ç”±äºç¼–è¯‘å™¨éµå®ˆé—´æ¥ä¾èµ–å…³ç³»ï¼Œå› æ­¤ç¼–è¯‘å™¨ä¸ä¼šé‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚å¤§å¤šæ•°å¤„ç†å™¨ä¹Ÿä¼šéµå®ˆé—´æ¥ä¾èµ–ï¼Œå¤§å¤šæ•°å¤„ç†å™¨ä¹Ÿä¸ä¼šé‡æ’åºè¿™ä¸¤ä¸ªæ“ä½œã€‚ä½†æœ‰å°‘æ•°å¤„ç†å™¨å…è®¸å¯¹å­˜åœ¨é—´æ¥ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼ˆæ¯”å¦‚ alpha å¤„ç†å™¨ï¼‰ï¼Œè¿™ä¸ªè§„åˆ™å°±æ˜¯ä¸“é—¨ç”¨æ¥é’ˆå¯¹è¿™ç§å¤„ç†å™¨ã€‚ reader() æ–¹æ³•åŒ…å«ä¸‰ä¸ªæ“ä½œï¼š åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj; åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj æŒ‡å‘å¯¹è±¡çš„æ™®é€šåŸŸ jã€‚ åˆæ¬¡è¯»å¼•ç”¨å˜é‡ obj æŒ‡å‘å¯¹è±¡çš„ final åŸŸ iã€‚ ç°åœ¨å‡è®¾å†™çº¿ç¨‹ A æ²¡æœ‰å‘ç”Ÿä»»ä½•é‡æ’åºï¼ŒåŒæ—¶ç¨‹åºåœ¨ä¸éµå®ˆé—´æ¥ä¾èµ–çš„å¤„ç†å™¨ä¸Šæ‰§è¡Œï¼Œä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œè¯»å¯¹è±¡çš„æ™®é€šåŸŸçš„æ“ä½œè¢«å¤„ç†å™¨é‡æ’åºåˆ°è¯»å¯¹è±¡å¼•ç”¨ä¹‹å‰ã€‚è¯»æ™®é€šåŸŸæ—¶ï¼Œè¯¥åŸŸè¿˜æ²¡æœ‰è¢«å†™çº¿ç¨‹ A å†™å…¥ï¼Œè¿™æ˜¯ä¸€ä¸ªé”™è¯¯çš„è¯»å–æ“ä½œã€‚è€Œè¯» final åŸŸçš„é‡æ’åºè§„åˆ™ä¼šæŠŠè¯»å¯¹è±¡ final åŸŸçš„æ“ä½œâ€œé™å®šâ€åœ¨è¯»å¯¹è±¡å¼•ç”¨ä¹‹åï¼Œæ­¤æ—¶è¯¥ final åŸŸå·²ç»è¢« A çº¿ç¨‹åˆå§‹åŒ–è¿‡äº†ï¼Œè¿™æ˜¯ä¸€ä¸ªæ­£ç¡®çš„è¯»å–æ“ä½œã€‚ è¯» final åŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨è¯»ä¸€ä¸ªå¯¹è±¡çš„ final åŸŸä¹‹å‰ï¼Œä¸€å®šä¼šå…ˆè¯»åŒ…å«è¿™ä¸ª final åŸŸçš„å¯¹è±¡çš„å¼•ç”¨ã€‚åœ¨è¿™ä¸ªç¤ºä¾‹ç¨‹åºä¸­ï¼Œå¦‚æœè¯¥å¼•ç”¨ä¸ä¸º nullï¼Œé‚£ä¹ˆå¼•ç”¨å¯¹è±¡çš„ final åŸŸä¸€å®šå·²ç»è¢« A çº¿ç¨‹åˆå§‹åŒ–è¿‡äº†ã€‚ finalåŸŸæ˜¯å¼•ç”¨ç±»å‹ 1234567891011121314151617181920212223public class FinalReferenceExample { final int[] intArray; //final æ˜¯å¼•ç”¨ç±»å‹ static FinalReferenceExample obj; public FinalReferenceExample () { // æ„é€ å‡½æ•° intArray = new int[1]; //1 intArray[0] = 1; //2 } public static void writerOne () { // å†™çº¿ç¨‹ A æ‰§è¡Œ obj = new FinalReferenceExample (); //3 } public static void writerTwo () { // å†™çº¿ç¨‹ B æ‰§è¡Œ obj.intArray[0] = 2; //4 } public static void reader () { // è¯»çº¿ç¨‹ C æ‰§è¡Œ if (obj != null) { //5 int temp1 = obj.intArray[0]; //6 } }} è¿™é‡Œ final åŸŸä¸ºä¸€ä¸ªå¼•ç”¨ç±»å‹ï¼Œå®ƒå¼•ç”¨ä¸€ä¸ª int å‹çš„æ•°ç»„å¯¹è±¡ã€‚å¯¹äºå¼•ç”¨ç±»å‹ï¼Œå†™ final åŸŸçš„é‡æ’åºè§„åˆ™å¯¹ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¢åŠ äº†å¦‚ä¸‹çº¦æŸï¼š åœ¨æ„é€ å‡½æ•°å†…å¯¹ä¸€ä¸ª final å¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œä¸éšååœ¨æ„é€ å‡½æ•°å¤–æŠŠè¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´ä¸èƒ½é‡æ’åºã€‚ å¯¹ä¸Šé¢çš„ç¤ºä¾‹ç¨‹åºï¼Œå‡è®¾é¦–å…ˆçº¿ç¨‹ A æ‰§è¡Œ writerOne() æ–¹æ³•ï¼Œæ‰§è¡Œå®Œåçº¿ç¨‹ B æ‰§è¡Œ writerTwo() æ–¹æ³•ï¼Œæ‰§è¡Œå®Œåçº¿ç¨‹ C æ‰§è¡Œ reader () æ–¹æ³•ã€‚ä¸‹é¢æ˜¯ä¸€ç§å¯èƒ½çš„çº¿ç¨‹æ‰§è¡Œæ—¶åºï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œ1 æ˜¯å¯¹ final åŸŸçš„å†™å…¥ï¼Œ2 æ˜¯å¯¹è¿™ä¸ª final åŸŸå¼•ç”¨çš„å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ï¼Œ3 æ˜¯æŠŠè¢«æ„é€ çš„å¯¹è±¡çš„å¼•ç”¨èµ‹å€¼ç»™æŸä¸ªå¼•ç”¨å˜é‡ã€‚è¿™é‡Œé™¤äº†å‰é¢æåˆ°çš„ 1 ä¸èƒ½å’Œ 3 é‡æ’åºå¤–ï¼Œ2 å’Œ 3 ä¹Ÿä¸èƒ½é‡æ’åºã€‚ JMM å¯ä»¥ç¡®ä¿è¯»çº¿ç¨‹ C è‡³å°‘èƒ½çœ‹åˆ°å†™çº¿ç¨‹ A åœ¨æ„é€ å‡½æ•°ä¸­å¯¹ final å¼•ç”¨å¯¹è±¡çš„æˆå‘˜åŸŸçš„å†™å…¥ã€‚å³ C è‡³å°‘èƒ½çœ‹åˆ°æ•°ç»„ä¸‹æ ‡ 0 çš„å€¼ä¸º 1ã€‚è€Œå†™çº¿ç¨‹ B å¯¹æ•°ç»„å…ƒç´ çš„å†™å…¥ï¼Œè¯»çº¿ç¨‹ C å¯èƒ½çœ‹çš„åˆ°ï¼Œä¹Ÿå¯èƒ½çœ‹ä¸åˆ°ã€‚JMM ä¸ä¿è¯çº¿ç¨‹ B çš„å†™å…¥å¯¹è¯»çº¿ç¨‹ C å¯è§ï¼Œå› ä¸ºå†™çº¿ç¨‹ B å’Œè¯»çº¿ç¨‹ C ä¹‹é—´å­˜åœ¨æ•°æ®ç«äº‰ï¼Œæ­¤æ—¶çš„æ‰§è¡Œç»“æœä¸å¯é¢„çŸ¥ã€‚ ä¸ºä»€ä¹ˆfinalå¼•ç”¨ä¸èƒ½ä»æ„é€ å‡½æ•°å†…é€¸å‡º å†™ final åŸŸçš„é‡æ’åºè§„åˆ™å¯ä»¥ç¡®ä¿ï¼šåœ¨å¼•ç”¨å˜é‡ä¸ºä»»æ„çº¿ç¨‹å¯è§ä¹‹å‰ï¼Œè¯¥å¼•ç”¨å˜é‡æŒ‡å‘çš„å¯¹è±¡çš„ final åŸŸå·²ç»åœ¨æ„é€ å‡½æ•°ä¸­è¢«æ­£ç¡®åˆå§‹åŒ–è¿‡äº†ã€‚å…¶å®è¦å¾—åˆ°è¿™ä¸ªæ•ˆæœï¼Œè¿˜éœ€è¦ä¸€ä¸ªä¿è¯ï¼šåœ¨æ„é€ å‡½æ•°å†…éƒ¨ï¼Œä¸èƒ½è®©è¿™ä¸ªè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨ä¸ºå…¶ä»–çº¿ç¨‹å¯è§ï¼Œä¹Ÿå°±æ˜¯å¯¹è±¡å¼•ç”¨ä¸èƒ½åœ¨æ„é€ å‡½æ•°ä¸­â€œé€¸å‡ºâ€ã€‚ç¤ºä¾‹å¦‚ä¸‹ï¼š 12345678910111213141516171819public class FinalReferenceEscapeExample { final int i; static FinalReferenceEscapeExample obj; public FinalReferenceEscapeExample () { i = 1; //1 å†™ final åŸŸ obj = this; //2 this å¼•ç”¨åœ¨æ­¤â€œé€¸å‡ºâ€ } public static void writer() { new FinalReferenceEscapeExample (); } public static void reader { if (obj != null) { //3 int temp = obj.i; //4 } }} å‡è®¾ä¸€ä¸ªçº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚è¿™é‡Œçš„æ“ä½œ 2 ä½¿å¾—å¯¹è±¡è¿˜æœªå®Œæˆæ„é€ å‰å°±ä¸ºçº¿ç¨‹ B å¯è§ã€‚å³ä½¿è¿™é‡Œçš„æ“ä½œ 2 æ˜¯æ„é€ å‡½æ•°çš„æœ€åä¸€æ­¥ï¼Œä¸”å³ä½¿åœ¨ç¨‹åºä¸­æ“ä½œ 2 æ’åœ¨æ“ä½œ 1 åé¢ï¼Œæ‰§è¡Œ read() æ–¹æ³•çš„çº¿ç¨‹ä»ç„¶å¯èƒ½æ— æ³•çœ‹åˆ° final åŸŸè¢«åˆå§‹åŒ–åçš„å€¼ï¼Œå› ä¸ºè¿™é‡Œçš„æ“ä½œ 1 å’Œæ“ä½œ 2 ä¹‹é—´å¯èƒ½è¢«é‡æ’åºã€‚å®é™…çš„æ‰§è¡Œæ—¶åºå¯èƒ½å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼šåœ¨æ„é€ å‡½æ•°è¿”å›å‰ï¼Œè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨ä¸èƒ½ä¸ºå…¶ä»–çº¿ç¨‹å¯è§ï¼Œå› ä¸ºæ­¤æ—¶çš„ final åŸŸå¯èƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚åœ¨æ„é€ å‡½æ•°è¿”å›åï¼Œä»»æ„çº¿ç¨‹éƒ½å°†ä¿è¯èƒ½çœ‹åˆ° final åŸŸæ­£ç¡®åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚ JSR-133ä¸ºä»€ä¹ˆè¦å¢å¼ºfinalè¯­ä¹‰ åœ¨æ—§çš„ Java å†…å­˜æ¨¡å‹ä¸­ ï¼Œæœ€ä¸¥é‡çš„ä¸€ä¸ªç¼ºé™·å°±æ˜¯çº¿ç¨‹å¯èƒ½çœ‹åˆ° final åŸŸçš„å€¼ä¼šæ”¹å˜ã€‚æ¯”å¦‚ï¼Œä¸€ä¸ªçº¿ç¨‹å½“å‰çœ‹åˆ°ä¸€ä¸ªæ•´å½¢ final åŸŸçš„å€¼ä¸º 0ï¼ˆè¿˜æœªåˆå§‹åŒ–ä¹‹å‰çš„é»˜è®¤å€¼ï¼‰ï¼Œè¿‡ä¸€æ®µæ—¶é—´ä¹‹åè¿™ä¸ªçº¿ç¨‹å†å»è¯»è¿™ä¸ª final åŸŸçš„å€¼æ—¶ï¼Œå´å‘ç°å€¼å˜ä¸ºäº† 1ï¼ˆè¢«æŸä¸ªçº¿ç¨‹åˆå§‹åŒ–ä¹‹åçš„å€¼ï¼‰ã€‚æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯åœ¨æ—§çš„ Java å†…å­˜æ¨¡å‹ä¸­ï¼ŒString çš„å€¼å¯èƒ½ä¼šæ”¹å˜ã€‚ ä¸ºäº†ä¿®è¡¥è¿™ä¸ªæ¼æ´ï¼ŒJSR-133 ä¸“å®¶ç»„å¢å¼ºäº† final çš„è¯­ä¹‰ã€‚é€šè¿‡ä¸º final åŸŸå¢åŠ å†™å’Œè¯»é‡æ’åºè§„åˆ™ï¼Œå¯ä»¥ä¸º java ç¨‹åºå‘˜æä¾›åˆå§‹åŒ–å®‰å…¨ä¿è¯ï¼šåªè¦å¯¹è±¡æ˜¯æ­£ç¡®æ„é€ çš„ï¼ˆè¢«æ„é€ å¯¹è±¡çš„å¼•ç”¨åœ¨æ„é€ å‡½æ•°ä¸­æ²¡æœ‰â€œé€¸å‡ºâ€ï¼‰ï¼Œé‚£ä¹ˆä¸éœ€è¦ä½¿ç”¨åŒæ­¥ï¼ˆæŒ‡ lock å’Œ volatile çš„ä½¿ç”¨ï¼‰ï¼Œå°±å¯ä»¥ä¿è¯ä»»æ„çº¿ç¨‹éƒ½èƒ½çœ‹åˆ°è¿™ä¸ª final åŸŸåœ¨æ„é€ å‡½æ•°ä¸­è¢«åˆå§‹åŒ–ä¹‹åçš„å€¼ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-ç†è§£é”]]></title>
    <url>%2Fposts%2Fa87ac669.html</url>
    <content type="text"><![CDATA[é”çš„happens-beforeå…³ç³» é”æ˜¯ java å¹¶å‘ç¼–ç¨‹ä¸­æœ€é‡è¦çš„åŒæ­¥æœºåˆ¶ã€‚é”é™¤äº†è®©ä¸´ç•ŒåŒºäº’æ–¥æ‰§è¡Œå¤–ï¼Œè¿˜å¯ä»¥è®©é‡Šæ”¾é”çš„çº¿ç¨‹å‘è·å–åŒä¸€ä¸ªé”çš„çº¿ç¨‹å‘é€æ¶ˆæ¯ã€‚ 123456789101112class MonitorExample { int a = 0; public synchronized void writer() { //1 a++; //2 } //3 public synchronized void reader() { //4 int i = a; //5 â€¦â€¦ } //6} å‡è®¾çº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ï¼Œéšåçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚æ ¹æ® happens before è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹åŒ…å«çš„ happens before å…³ç³»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2, 2 happens before 3; 4 happens before 5, 5 happens before 6ã€‚ æ ¹æ®ç›‘è§†å™¨é”è§„åˆ™ï¼Œ3 happens before 4ã€‚ æ ¹æ® happens before çš„ä¼ é€’æ€§ï¼Œ2 happens before 5ã€‚ ä¸Šè¿° happens-before å…³ç³»å›¾å¦‚ä¸‹ï¼š ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ª happens before å…³ç³»ã€‚é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›æ©™è‰²ç®­å¤´è¡¨ç¤ºç›‘è§†å™¨é”è§„åˆ™ï¼›è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åæä¾›çš„ happens before ä¿è¯ã€‚ ä¸Šå›¾è¡¨ç¤ºåœ¨çº¿ç¨‹ A é‡Šæ”¾äº†é”ä¹‹åï¼Œéšåçº¿ç¨‹ B è·å–åŒä¸€ä¸ªé”ã€‚åœ¨ä¸Šå›¾ä¸­ï¼Œ2 happens before 5ã€‚å› æ­¤ï¼Œçº¿ç¨‹ A åœ¨é‡Šæ”¾é”ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨çº¿ç¨‹ B è·å–åŒä¸€ä¸ªé”ä¹‹åï¼Œå°†ç«‹åˆ»å˜å¾—å¯¹ B çº¿ç¨‹å¯è§ã€‚ é”çš„å†…å­˜è¯­ä¹‰ é”é‡Šæ”¾çš„å†…å­˜è¯­ä¹‰ å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚ä»¥ä¸Šé¢çš„ç¨‹åºä¸ºä¾‹ï¼ŒA çº¿ç¨‹é‡Šæ”¾é”åï¼Œå…±äº«æ•°æ®çš„çŠ¶æ€ç¤ºæ„å›¾å¦‚ä¸‹ï¼š é”è·å–çš„å†…å­˜è¯­ä¹‰ å½“çº¿ç¨‹è·å–é”æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚ä»è€Œä½¿å¾—è¢«ç›‘è§†å™¨ä¿æŠ¤çš„ä¸´ç•ŒåŒºä»£ç å¿…é¡»è¦ä»ä¸»å†…å­˜ä¸­å»è¯»å–å…±äº«å˜é‡ã€‚ä¸‹é¢æ˜¯é”è·å–çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¯¹æ¯”é”é‡Šæ”¾ - è·å–çš„å†…å­˜è¯­ä¹‰ä¸ volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œå¯ä»¥çœ‹å‡ºï¼šé”é‡Šæ”¾ä¸ volatile å†™æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›é”è·å–ä¸ volatile è¯»æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ é”å†…å­˜è¯­ä¹‰çš„å®ç° 1234567891011121314151617181920212223class ReentrantLockExample { int a = 0; ReentrantLock lock = new ReentrantLock(); public void writer() { lock.lock(); // è·å–é” try { a++; } finally { lock.unlock(); // é‡Šæ”¾é” } } public void reader () { lock.lock(); // è·å–é” try { int i = a; â€¦â€¦ } finally { lock.unlock(); // é‡Šæ”¾é” } }} åœ¨ ReentrantLock ä¸­ï¼Œè°ƒç”¨ lock() æ–¹æ³•è·å–é”ï¼›è°ƒç”¨ unlock() æ–¹æ³•é‡Šæ”¾é”ã€‚ ReentrantLock çš„å®ç°ä¾èµ–äº java åŒæ­¥å™¨æ¡†æ¶ AbstractQueuedSynchronizerï¼ˆç®€ç§° AQSï¼‰ã€‚AQS ä½¿ç”¨ä¸€ä¸ªæ•´å‹çš„ volatile å˜é‡ï¼ˆå‘½åä¸º stateï¼‰æ¥ç»´æŠ¤åŒæ­¥çŠ¶æ€ï¼Œé©¬ä¸Šæˆ‘ä»¬ä¼šçœ‹åˆ°ï¼Œè¿™ä¸ª volatile å˜é‡æ˜¯ ReentrantLock å†…å­˜è¯­ä¹‰å®ç°çš„å…³é”®ã€‚ ä¸‹é¢æ˜¯ ReentrantLock çš„ç±»å›¾ï¼ˆä»…éƒ¨åˆ†ï¼‰ï¼š ReentrantLock åˆ†ä¸ºå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œé¦–å…ˆåˆ†æå…¬å¹³é”ã€‚ ä½¿ç”¨å…¬å¹³é”æ—¶ï¼ŒåŠ é”æ–¹æ³• lock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : lock() FairSync : lock() AbstractQueuedSynchronizer : acquire(int arg) ReentrantLock : tryAcquire(int acquires) åœ¨ç¬¬ 4 æ­¥çœŸæ­£å¼€å§‹åŠ é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 12345678910111213141516171819protected final boolean tryAcquire(int acquires) { final Thread current = Thread.currentThread(); int c = getState(); // è·å–é”çš„å¼€å§‹ï¼Œé¦–å…ˆè¯» volatile å˜é‡ state if (c == 0) { if (isFirst(current) &amp;&amp; compareAndSetState(0, acquires)) { setExclusiveOwnerThread(current); return true; } } else if (current == getExclusiveOwnerThread()) { int nextc = c + acquires; if (nextc &lt; 0) throw new Error("Maximum lock count exceeded"); setState(nextc); return true; } return false;} ä»ä¸Šé¢æºä»£ç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒåŠ é”æ–¹æ³•é¦–å…ˆè¯» volatile å˜é‡ stateã€‚ åœ¨ä½¿ç”¨å…¬å¹³é”æ—¶ï¼Œè§£é”æ–¹æ³• unlock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : unlock() AbstractQueuedSynchronizer : release(int arg) Sync : tryRelease(int releases) åœ¨ç¬¬ 3 æ­¥çœŸæ­£å¼€å§‹é‡Šæ”¾é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 123456789101112protected final boolean tryRelease(int releases) { int c = getState() - releases; if (Thread.currentThread() != getExclusiveOwnerThread()) throw new IllegalMonitorStateException(); boolean free = false; if (c == 0) { free = true; setExclusiveOwnerThread(null); } setState(c); // é‡Šæ”¾é”çš„æœ€åï¼Œå†™ volatile å˜é‡ state return free;} ä»ä¸Šé¢çš„æºä»£ç æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œåœ¨é‡Šæ”¾é”çš„æœ€åå†™ volatile å˜é‡ stateã€‚ å…¬å¹³é”åœ¨é‡Šæ”¾é”çš„æœ€åå†™ volatile å˜é‡ stateï¼›åœ¨è·å–é”æ—¶é¦–å…ˆè¯»è¿™ä¸ª volatile å˜é‡ã€‚æ ¹æ® volatile çš„ happens-before è§„åˆ™ï¼Œé‡Šæ”¾é”çš„çº¿ç¨‹åœ¨å†™ volatile å˜é‡ä¹‹å‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨è·å–é”çš„çº¿ç¨‹è¯»å–åŒä¸€ä¸ª volatile å˜é‡åå°†ç«‹å³å˜çš„å¯¹è·å–é”çš„çº¿ç¨‹å¯è§ã€‚ ç°åœ¨åˆ†æéå…¬å¹³é”çš„å†…å­˜è¯­ä¹‰çš„å®ç°ã€‚ éå…¬å¹³é”çš„é‡Šæ”¾å’Œå…¬å¹³é”å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œä»…ä»…åˆ†æéå…¬å¹³é”çš„è·å–ã€‚ ä½¿ç”¨å…¬å¹³é”æ—¶ï¼ŒåŠ é”æ–¹æ³• lock() çš„æ–¹æ³•è°ƒç”¨è½¨è¿¹å¦‚ä¸‹ï¼š ReentrantLock : lock() NonfairSync : lock() AbstractQueuedSynchronizer : compareAndSetState(int expect, int update) åœ¨ç¬¬ 3 æ­¥çœŸæ­£å¼€å§‹åŠ é”ï¼Œä¸‹é¢æ˜¯è¯¥æ–¹æ³•çš„æºä»£ç ï¼š 123protected final boolean compareAndSetState(int expect, int update) { return unsafe.compareAndSwapInt(this, stateOffset, expect, update);} è¯¥æ–¹æ³•ä»¥åŸå­æ“ä½œçš„æ–¹å¼æ›´æ–° state å˜é‡ï¼ŒJDK æ–‡æ¡£å¯¹è¯¥æ–¹æ³•çš„è¯´æ˜å¦‚ä¸‹ï¼šå¦‚æœå½“å‰çŠ¶æ€å€¼ç­‰äºé¢„æœŸå€¼ï¼Œåˆ™ä»¥åŸå­æ–¹å¼å°†åŒæ­¥çŠ¶æ€è®¾ç½®ä¸ºç»™å®šçš„æ›´æ–°å€¼ã€‚æ­¤æ“ä½œå…·æœ‰ volatile è¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰ã€‚ å‰æ–‡è¯´è¿‡ï¼Œç¼–è¯‘å™¨ä¸ä¼šå¯¹ volatile è¯»ä¸ volatile è¯»åé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºï¼›ç¼–è¯‘å™¨ä¸ä¼šå¯¹ volatile å†™ä¸ volatile å†™å‰é¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºã€‚ç»„åˆè¿™ä¸¤ä¸ªæ¡ä»¶ï¼Œæ„å‘³ç€ä¸ºäº†åŒæ—¶å®ç° volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨ä¸èƒ½å¯¹ CAS ä¸ CAS å‰é¢å’Œåé¢çš„ä»»æ„å†…å­˜æ“ä½œé‡æ’åºã€‚ å¯¹å…¬å¹³é”å’Œéå…¬å¹³é”çš„å†…å­˜è¯­ä¹‰åšä¸ªæ€»ç»“ï¼š å…¬å¹³é”å’Œéå…¬å¹³é”é‡Šæ”¾æ—¶ï¼Œæœ€åéƒ½è¦å†™ä¸€ä¸ª volatile å˜é‡ stateã€‚ å…¬å¹³é”è·å–æ—¶ï¼Œé¦–å…ˆä¼šå»è¯»è¿™ä¸ª volatile å˜é‡ã€‚ éå…¬å¹³é”è·å–æ—¶ï¼Œé¦–å…ˆä¼šç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡, è¿™ä¸ªæ“ä½œåŒæ—¶å…·æœ‰ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ã€‚ ä»å¯¹ ReentrantLock çš„åˆ†æå¯ä»¥çœ‹å‡ºï¼Œé”é‡Šæ”¾ - è·å–çš„å†…å­˜è¯­ä¹‰çš„å®ç°è‡³å°‘æœ‰ä¸‹é¢ä¸¤ç§æ–¹å¼ï¼š åˆ©ç”¨ volatile å˜é‡çš„å†™ - è¯»æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ã€‚ åˆ©ç”¨ CAS æ‰€é™„å¸¦çš„ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ã€‚ J.U.CåŒ…çš„å®ç° ç”±äº java çš„ CAS åŒæ—¶å…·æœ‰ volatile è¯»å’Œ volatile å†™çš„å†…å­˜è¯­ä¹‰ï¼Œå› æ­¤ Java çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç°åœ¨æœ‰äº†ä¸‹é¢å››ç§æ–¹å¼ï¼š A çº¿ç¨‹å†™ volatile å˜é‡ï¼Œéšå B çº¿ç¨‹è¯»è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹å†™ volatile å˜é‡ï¼Œéšå B çº¿ç¨‹ç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹ç”¨ CAS æ›´æ–°ä¸€ä¸ª volatile å˜é‡ï¼Œéšå B çº¿ç¨‹ç”¨ CAS æ›´æ–°è¿™ä¸ª volatile å˜é‡ã€‚ A çº¿ç¨‹ç”¨ CAS æ›´æ–°ä¸€ä¸ª volatile å˜é‡ï¼Œéšå B çº¿ç¨‹è¯»è¿™ä¸ª volatile å˜é‡ã€‚ Java çš„ CAS ä¼šä½¿ç”¨ç°ä»£å¤„ç†å™¨ä¸Šæä¾›çš„é«˜æ•ˆæœºå™¨çº§åˆ«åŸå­æŒ‡ä»¤ï¼Œè¿™äº›åŸå­æŒ‡ä»¤ä»¥åŸå­æ–¹å¼å¯¹å†…å­˜æ‰§è¡Œè¯» - æ”¹ - å†™æ“ä½œï¼Œè¿™æ˜¯åœ¨å¤šå¤„ç†å™¨ä¸­å®ç°åŒæ­¥çš„å…³é”®ï¼ˆä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œèƒ½å¤Ÿæ”¯æŒåŸå­æ€§è¯» - æ”¹ - å†™æŒ‡ä»¤çš„è®¡ç®—æœºå™¨ï¼Œæ˜¯é¡ºåºè®¡ç®—å›¾çµæœºçš„å¼‚æ­¥ç­‰ä»·æœºå™¨ï¼Œå› æ­¤ä»»ä½•ç°ä»£çš„å¤šå¤„ç†å™¨éƒ½ä¼šå»æ”¯æŒæŸç§èƒ½å¯¹å†…å­˜æ‰§è¡ŒåŸå­æ€§è¯» - æ”¹ - å†™æ“ä½œçš„åŸå­æŒ‡ä»¤ï¼‰ã€‚åŒæ—¶ï¼Œvolatile å˜é‡çš„è¯» / å†™å’Œ CAS å¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚æŠŠè¿™äº›ç‰¹æ€§æ•´åˆåœ¨ä¸€èµ·ï¼Œå°±å½¢æˆäº†æ•´ä¸ª J.U.C åŒ…å¾—ä»¥å®ç°çš„åŸºçŸ³ã€‚å¦‚æœä»”ç»†åˆ†æ J.U.C åŒ…çš„æºä»£ç å®ç°ï¼Œä¼šå‘ç°ä¸€ä¸ªé€šç”¨åŒ–çš„å®ç°æ¨¡å¼ï¼š é¦–å…ˆï¼Œå£°æ˜å…±äº«å˜é‡ä¸º volatileï¼› ç„¶åï¼Œä½¿ç”¨ CAS çš„åŸå­æ¡ä»¶æ›´æ–°æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„åŒæ­¥ï¼› åŒæ—¶ï¼Œé…åˆä»¥ volatile çš„è¯» / å†™å’Œ CAS æ‰€å…·æœ‰çš„ volatile è¯»å’Œå†™çš„å†…å­˜è¯­ä¹‰æ¥å®ç°çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€‚ AQSï¼Œéé˜»å¡æ•°æ®ç»“æ„å’ŒåŸå­å˜é‡ç±»ï¼ˆjava.util.concurrent.atomic åŒ…ä¸­çš„ç±»ï¼‰ï¼Œè¿™äº› J.U.C åŒ…ä¸­çš„åŸºç¡€ç±»éƒ½æ˜¯ä½¿ç”¨è¿™ç§æ¨¡å¼æ¥å®ç°çš„ï¼Œè€Œ J.U.C åŒ…ä¸­çš„é«˜å±‚ç±»åˆæ˜¯ä¾èµ–äºè¿™äº›åŸºç¡€ç±»æ¥å®ç°çš„ã€‚ä»æ•´ä½“æ¥çœ‹ï¼ŒJ.U.C åŒ…çš„å®ç°ç¤ºæ„å›¾å¦‚ä¸‹ï¼š document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-é¡ºåºä¸€è‡´æ€§æ¨¡å‹]]></title>
    <url>%2Fposts%2F60b19e41.html</url>
    <content type="text"><![CDATA[é¡ºåºä¸€è‡´æ€§ä¿è¯ å½“ç¨‹åºæœªæ­£ç¡®åŒæ­¥æ—¶ï¼Œå°±ä¼šå­˜åœ¨æ•°æ®ç«äº‰ã€‚java å†…å­˜æ¨¡å‹è§„èŒƒå¯¹æ•°æ®ç«äº‰çš„å®šä¹‰å¦‚ä¸‹ï¼š åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­å†™ä¸€ä¸ªå˜é‡ï¼Œåœ¨å¦ä¸€ä¸ªçº¿ç¨‹è¯»åŒä¸€ä¸ªå˜é‡ï¼Œè€Œä¸”å†™å’Œè¯»æ²¡æœ‰é€šè¿‡åŒæ­¥æ¥æ’åºã€‚ å½“ä»£ç ä¸­åŒ…å«æ•°æ®ç«äº‰æ—¶ï¼Œç¨‹åºçš„æ‰§è¡Œå¾€å¾€äº§ç”Ÿè¿åç›´è§‰çš„ç»“æœã€‚å¦‚æœä¸€ä¸ªå¤šçº¿ç¨‹ç¨‹åºèƒ½æ­£ç¡®åŒæ­¥ï¼Œè¿™ä¸ªç¨‹åºå°†æ˜¯ä¸€ä¸ªæ²¡æœ‰æ•°æ®ç«äº‰çš„ç¨‹åºã€‚ JMM å¯¹æ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºçš„å†…å­˜ä¸€è‡´æ€§åšäº†å¦‚ä¸‹ä¿è¯ï¼š å¦‚æœç¨‹åºæ˜¯æ­£ç¡®åŒæ­¥çš„ï¼Œç¨‹åºçš„æ‰§è¡Œå°†å…·æœ‰é¡ºåºä¸€è‡´æ€§ï¼ˆsequentially consistentï¼‰-- å³ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚è¿™é‡Œçš„åŒæ­¥æ˜¯æŒ‡å¹¿ä¹‰ä¸Šçš„åŒæ­¥ï¼ŒåŒ…æ‹¬å¯¹å¸¸ç”¨åŒæ­¥åŸè¯­ï¼ˆlockï¼Œvolatile å’Œ finalï¼‰çš„æ­£ç¡®ä½¿ç”¨ã€‚ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æ˜¯ç†è®ºå‚è€ƒæ¨¡å‹ï¼Œå®ƒä¸ºç¨‹åºå‘˜æä¾›äº†æå¼ºçš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹æœ‰ä¸¤å¤§ç‰¹æ€§ï¼š ä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ‰€æœ‰æ“ä½œå¿…é¡»æŒ‰ç…§ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œã€‚ ï¼ˆä¸ç®¡ç¨‹åºæ˜¯å¦åŒæ­¥ï¼‰æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªå•ä¸€çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚åœ¨é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­ï¼Œæ¯ä¸ªæ“ä½œéƒ½å¿…é¡»åŸå­æ‰§è¡Œä¸”ç«‹åˆ»å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§ã€‚ é¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸ºç¨‹åºå‘˜æä¾›çš„è§†å›¾å¦‚ä¸‹ï¼š åœ¨æ¦‚å¿µä¸Šï¼Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹æœ‰ä¸€ä¸ªå•ä¸€çš„å…¨å±€å†…å­˜ï¼Œè¿™ä¸ªå†…å­˜é€šè¿‡ä¸€ä¸ªå·¦å³æ‘†åŠ¨çš„å¼€å…³å¯ä»¥è¿æ¥åˆ°ä»»æ„ä¸€ä¸ªçº¿ç¨‹ã€‚åŒæ—¶ï¼Œæ¯ä¸€ä¸ªçº¿ç¨‹å¿…é¡»æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œå†…å­˜è¯» / å†™æ“ä½œã€‚åœ¨ä»»æ„æ—¶é—´ç‚¹æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è¿æ¥åˆ°å†…å­˜ã€‚å½“å¤šä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œå›¾ä¸­çš„å¼€å…³è£…ç½®èƒ½æŠŠæ‰€æœ‰çº¿ç¨‹çš„æ‰€æœ‰å†…å­˜è¯» / å†™æ“ä½œä¸²è¡ŒåŒ–ã€‚ ç¤ºä¾‹ï¼šå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ B å¹¶å‘æ‰§è¡Œã€‚å…¶ä¸­ A çº¿ç¨‹æœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šA1-&gt;A2-&gt;A3ã€‚B çº¿ç¨‹ä¹Ÿæœ‰ä¸‰ä¸ªæ“ä½œï¼Œå®ƒä»¬åœ¨ç¨‹åºä¸­çš„é¡ºåºæ˜¯ï¼šB1-&gt;B2-&gt;B3ã€‚ å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹ä½¿ç”¨ç›‘è§†å™¨æ¥æ­£ç¡®åŒæ­¥ï¼šA çº¿ç¨‹çš„ä¸‰ä¸ªæ“ä½œæ‰§è¡Œåé‡Šæ”¾ç›‘è§†å™¨ï¼Œéšå B çº¿ç¨‹è·å–åŒä¸€ä¸ªç›‘è§†å™¨ã€‚é‚£ä¹ˆç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œæ•ˆæœå°†å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å†å‡è®¾è¿™ä¸¤ä¸ªçº¿ç¨‹æ²¡æœ‰åšåŒæ­¥ï¼Œä¸‹é¢æ˜¯è¿™ä¸ªæœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç¤ºæ„å›¾ï¼š æœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­è™½ç„¶æ•´ä½“æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œä½†æ‰€æœ‰çº¿ç¨‹éƒ½åªèƒ½çœ‹åˆ°ä¸€ä¸ªä¸€è‡´çš„æ•´ä½“æ‰§è¡Œé¡ºåºã€‚ä»¥ä¸Šå›¾ä¸ºä¾‹ï¼Œçº¿ç¨‹ A å’Œ B çœ‹åˆ°çš„æ‰§è¡Œé¡ºåºéƒ½æ˜¯ï¼šB1-&gt;A1-&gt;A2-&gt;B2-&gt;A3-&gt;B3ã€‚ä¹‹æ‰€ä»¥èƒ½å¾—åˆ°è¿™ä¸ªä¿è¯æ˜¯å› ä¸ºé¡ºåºä¸€è‡´æ€§å†…å­˜æ¨¡å‹ä¸­çš„æ¯ä¸ªæ“ä½œå¿…é¡»ç«‹å³å¯¹ä»»æ„çº¿ç¨‹å¯è§ã€‚ ä½†æ˜¯ï¼Œåœ¨ JMM ä¸­å°±æ²¡æœ‰è¿™ä¸ªä¿è¯ã€‚æœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­ä¸ä½†æ•´ä½“çš„æ‰§è¡Œé¡ºåºæ˜¯æ— åºçš„ï¼Œè€Œä¸”æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºä¹Ÿå¯èƒ½ä¸ä¸€è‡´ã€‚æ¯”å¦‚ï¼Œåœ¨å½“å‰çº¿ç¨‹æŠŠå†™è¿‡çš„æ•°æ®ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œä¸”è¿˜æ²¡æœ‰åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹å‰ï¼Œè¿™ä¸ªå†™æ“ä½œä»…å¯¹å½“å‰çº¿ç¨‹å¯è§ï¼›ä»å…¶ä»–çº¿ç¨‹çš„è§’åº¦æ¥è§‚å¯Ÿï¼Œä¼šè®¤ä¸ºè¿™ä¸ªå†™æ“ä½œæ ¹æœ¬è¿˜æ²¡æœ‰è¢«å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚åªæœ‰å½“å‰çº¿ç¨‹æŠŠæœ¬åœ°å†…å­˜ä¸­å†™è¿‡çš„æ•°æ®åˆ·æ–°åˆ°ä¸»å†…å­˜ä¹‹åï¼Œè¿™ä¸ªå†™æ“ä½œæ‰èƒ½å¯¹å…¶ä»–çº¿ç¨‹å¯è§ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå½“å‰çº¿ç¨‹å’Œå…¶å®ƒçº¿ç¨‹çœ‹åˆ°çš„æ“ä½œæ‰§è¡Œé¡ºåºå°†ä¸ä¸€è‡´ã€‚ åŒæ­¥ç¨‹åºçš„é¡ºåºä¸€è‡´æ€§ 12345678910111213141516class SynchronizedExample { int a = 0; boolean flag = false; public synchronized void writer() { a = 1; flag = true; } public synchronized void reader() { if (flag) { int i = a; â€¦â€¦ } }} ç¤ºä¾‹ä»£ç ä¸­ï¼Œå‡è®¾ A çº¿ç¨‹æ‰§è¡Œ writer() æ–¹æ³•åï¼ŒB çº¿ç¨‹æ‰§è¡Œ reader() æ–¹æ³•ã€‚è¿™æ˜¯ä¸€ä¸ªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºã€‚æ ¹æ® JMM è§„èŒƒï¼Œè¯¥ç¨‹åºçš„æ‰§è¡Œç»“æœå°†ä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœç›¸åŒã€‚å¦‚ä¸‹æ‰§è¡Œå¯¹æ¯”å›¾ï¼š åœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­ï¼Œæ‰€æœ‰æ“ä½œå®Œå…¨æŒ‰ç¨‹åºçš„é¡ºåºä¸²è¡Œæ‰§è¡Œã€‚è€Œåœ¨ JMM ä¸­ï¼Œä¸´ç•ŒåŒºå†…çš„ä»£ç å¯ä»¥é‡æ’åºï¼ˆä½† JMM ä¸å…è®¸ä¸´ç•ŒåŒºå†…çš„ä»£ç â€œé€¸å‡ºâ€åˆ°ä¸´ç•ŒåŒºä¹‹å¤–ï¼Œé‚£æ ·ä¼šç ´åç›‘è§†å™¨çš„è¯­ä¹‰ï¼‰ã€‚JMM ä¼šåœ¨é€€å‡ºç›‘è§†å™¨å’Œè¿›å…¥ç›‘è§†å™¨è¿™ä¸¤ä¸ªå…³é”®æ—¶é—´ç‚¹åšä¸€äº›ç‰¹åˆ«å¤„ç†ï¼Œä½¿å¾—çº¿ç¨‹åœ¨è¿™ä¸¤ä¸ªæ—¶é—´ç‚¹å…·æœ‰ä¸é¡ºåºä¸€è‡´æ€§æ¨¡å‹ç›¸åŒçš„å†…å­˜è§†å›¾ã€‚è™½ç„¶çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…åšäº†é‡æ’åºï¼Œä½†ç”±äºç›‘è§†å™¨çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§ï¼Œè¿™é‡Œçš„çº¿ç¨‹ B æ ¹æœ¬æ— æ³•â€œè§‚å¯Ÿâ€åˆ°çº¿ç¨‹ A åœ¨ä¸´ç•ŒåŒºå†…çš„é‡æ’åºã€‚è¿™ç§é‡æ’åºæ—¢æé«˜äº†æ‰§è¡Œæ•ˆç‡ï¼Œåˆæ²¡æœ‰æ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ ä»è¿™é‡Œå¯ä»¥çœ‹åˆ° JMM åœ¨å…·ä½“å®ç°ä¸Šçš„åŸºæœ¬æ–¹é’ˆï¼šåœ¨ä¸æ”¹å˜ï¼ˆæ­£ç¡®åŒæ­¥çš„ï¼‰ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„ä¸ºç¼–è¯‘å™¨å’Œå¤„ç†å™¨çš„ä¼˜åŒ–æ‰“å¼€æ–¹ä¾¿ä¹‹é—¨ã€‚ æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç‰¹æ€§ å¯¹äºæœªåŒæ­¥æˆ–æœªæ­£ç¡®åŒæ­¥çš„å¤šçº¿ç¨‹ç¨‹åºï¼ŒJMM åªæä¾›æœ€å°å®‰å…¨æ€§ï¼šçº¿ç¨‹æ‰§è¡Œæ—¶è¯»å–åˆ°çš„å€¼ï¼Œè¦ä¹ˆæ˜¯ä¹‹å‰æŸä¸ªçº¿ç¨‹å†™å…¥çš„å€¼ï¼Œè¦ä¹ˆæ˜¯é»˜è®¤å€¼ï¼ˆ0ï¼Œnullï¼Œfalseï¼‰ï¼ŒJMM ä¿è¯çº¿ç¨‹è¯»æ“ä½œè¯»å–åˆ°çš„å€¼ä¸ä¼šæ— ä¸­ç”Ÿæœ‰ï¼ˆout of thin airï¼‰çš„å†’å‡ºæ¥ã€‚ä¸ºäº†å®ç°æœ€å°å®‰å…¨æ€§ï¼ŒJVM åœ¨å †ä¸Šåˆ†é…å¯¹è±¡æ—¶ï¼Œé¦–å…ˆä¼šæ¸…é›¶å†…å­˜ç©ºé—´ï¼Œç„¶åæ‰ä¼šåœ¨ä¸Šé¢åˆ†é…å¯¹è±¡ï¼ˆJVM å†…éƒ¨ä¼šåŒæ­¥è¿™ä¸¤ä¸ªæ“ä½œï¼‰ã€‚å› æ­¤ï¼Œåœ¨å·²æ¸…é›¶çš„å†…å­˜ç©ºé—´ï¼ˆpre-zeroed memoryï¼‰åˆ†é…å¯¹è±¡æ—¶ï¼ŒåŸŸçš„é»˜è®¤åˆå§‹åŒ–å·²ç»å®Œæˆäº†ã€‚ JMM ä¸ä¿è¯æœªåŒæ­¥ç¨‹åºçš„æ‰§è¡Œç»“æœä¸è¯¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœä¸€è‡´ã€‚å› ä¸ºæœªåŒæ­¥ç¨‹åºåœ¨é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸­æ‰§è¡Œæ—¶ï¼Œæ•´ä½“ä¸Šæ˜¯æ— åºçš„ï¼Œå…¶æ‰§è¡Œç»“æœæ— æ³•é¢„çŸ¥ã€‚ä¿è¯æœªåŒæ­¥ç¨‹åºåœ¨ä¸¤ä¸ªæ¨¡å‹ä¸­çš„æ‰§è¡Œç»“æœä¸€è‡´æ¯«æ— æ„ä¹‰ã€‚ å’Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¸€æ ·ï¼ŒæœªåŒæ­¥ç¨‹åºåœ¨ JMM ä¸­çš„æ‰§è¡Œæ—¶ï¼Œæ•´ä½“ä¸Šä¹Ÿæ˜¯æ— åºçš„ï¼Œå…¶æ‰§è¡Œç»“æœä¹Ÿæ— æ³•é¢„çŸ¥ã€‚åŒæ—¶ï¼ŒæœªåŒæ­¥ç¨‹åºåœ¨è¿™ä¸¤ä¸ªæ¨¡å‹ä¸­çš„æ‰§è¡Œç‰¹æ€§æœ‰ä¸‹é¢å‡ ä¸ªå·®å¼‚ï¼š é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œï¼Œè€Œ JMM ä¸ä¿è¯å•çº¿ç¨‹å†…çš„æ“ä½œä¼šæŒ‰ç¨‹åºçš„é¡ºåºæ‰§è¡Œè¿°ã€‚ é¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯æ‰€æœ‰çº¿ç¨‹åªèƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºï¼Œè€Œ JMM ä¸ä¿è¯æ‰€æœ‰çº¿ç¨‹èƒ½çœ‹åˆ°ä¸€è‡´çš„æ“ä½œæ‰§è¡Œé¡ºåºã€‚ã€‚ JMM ä¸ä¿è¯å¯¹ 64 ä½çš„ long å‹å’Œ double å‹å˜é‡çš„è¯» / å†™æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè€Œé¡ºåºä¸€è‡´æ€§æ¨¡å‹ä¿è¯å¯¹æ‰€æœ‰çš„å†…å­˜è¯» / å†™æ“ä½œéƒ½å…·æœ‰åŸå­æ€§ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-æŒ‡ä»¤é‡æ’åº]]></title>
    <url>%2Fposts%2F60874885.html</url>
    <content type="text"><![CDATA[æ•°æ®ä¾èµ–æ€§ å¦‚æœä¸¤ä¸ªæ“ä½œè®¿é—®åŒä¸€ä¸ªå˜é‡ï¼Œä¸”è¿™ä¸¤ä¸ªæ“ä½œä¸­æœ‰ä¸€ä¸ªä¸ºå†™æ“ä½œï¼Œæ­¤æ—¶è¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å°±å­˜åœ¨æ•°æ®ä¾èµ–æ€§ã€‚æ•°æ®ä¾èµ–åˆ†ä¸‹åˆ—ä¸‰ç§ç±»å‹ï¼š åç§° ä»£ç ç¤ºä¾‹ è¯´æ˜ å†™åè¯» a = 1;b = a; å†™ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†è¯»è¿™ä¸ªå˜é‡ã€‚ å†™åå†™ a = 1;a = 2; å†™ä¸€ä¸ªå˜é‡åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ è¯»åå†™ a = b;b = 1; è¯»ä¸€ä¸ªå˜é‡ä¹‹åï¼Œå†å†™è¿™ä¸ªå˜é‡ã€‚ ä¸Šé¢ä¸‰ç§æƒ…å†µï¼Œåªè¦é‡æ’åºä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œç¨‹åºçš„æ‰§è¡Œç»“æœå°†ä¼šè¢«æ”¹å˜ã€‚ ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æ“ä½œåšé‡æ’åºã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨åœ¨é‡æ’åºæ—¶ï¼Œä¼šéµå®ˆæ•°æ®ä¾èµ–æ€§ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šæ”¹å˜å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œé¡ºåºã€‚ æ³¨æ„ï¼Œè¿™é‡Œæ‰€è¯´çš„æ•°æ®ä¾èµ–æ€§ä»…é’ˆå¯¹å•ä¸ªå¤„ç†å™¨ä¸­æ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—å’Œå•ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œçš„æ“ä½œï¼Œä¸åŒå¤„ç†å™¨ä¹‹é—´å’Œä¸åŒçº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¾èµ–æ€§ä¸è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨è€ƒè™‘ã€‚ as-if-serialè¯­ä¹‰ as-if-serial è¯­ä¹‰æ˜¯æŒ‡ï¼šä¸ç®¡æ€ä¹ˆé‡æ’åºï¼ˆç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ºäº†æé«˜å¹¶è¡Œåº¦ï¼‰ï¼Œï¼ˆå•çº¿ç¨‹ï¼‰ç¨‹åºçš„æ‰§è¡Œç»“æœä¸èƒ½è¢«æ”¹å˜ã€‚ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨éƒ½å¿…é¡»éµå®ˆ as-if-serial è¯­ä¹‰ã€‚ ä¸ºäº†éµå®ˆ as-if-serial è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¸ä¼šå¯¹å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„æ“ä½œåšé‡æ’åºï¼Œå› ä¸ºè¿™ç§é‡æ’åºä¼šæ”¹å˜æ‰§è¡Œç»“æœã€‚ä½†æ˜¯ï¼Œå¦‚æœæ“ä½œä¹‹é—´ä¸å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼Œè¿™äº›æ“ä½œå¯èƒ½è¢«ç¼–è¯‘å™¨å’Œå¤„ç†å™¨é‡æ’åºã€‚å¦‚ä¸‹è®¡ç®—åœ†é¢ç§¯çš„ä»£ç ç¤ºä¾‹ï¼š 123double pi = 3.14; //Adouble r = 1.0; //Bdouble area = pi * r * r; //C ä¸Šé¢ä¸‰ä¸ªæ“ä½œçš„æ•°æ®ä¾èµ–å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼ŒA å’Œ C ä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶ B å’Œ C ä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒC ä¸èƒ½è¢«é‡æ’åºåˆ° A å’Œ B çš„å‰é¢ï¼ˆC æ’åˆ° A å’Œ B çš„å‰é¢ï¼Œç¨‹åºçš„ç»“æœå°†ä¼šè¢«æ”¹å˜ï¼‰ã€‚ä½† A å’Œ B ä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æ’åº A å’Œ B ä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚ä¸‹å›¾æ˜¯è¯¥ç¨‹åºçš„ä¸¤ç§æ‰§è¡Œé¡ºåºï¼š as-if-serial è¯­ä¹‰æŠŠå•çº¿ç¨‹ç¨‹åºä¿æŠ¤äº†èµ·æ¥ï¼Œéµå®ˆ as-if-serial è¯­ä¹‰çš„ç¼–è¯‘å™¨ï¼Œruntime å’Œå¤„ç†å™¨å…±åŒä¸ºç¼–å†™å•çº¿ç¨‹ç¨‹åºçš„ç¨‹åºå‘˜åˆ›å»ºäº†ä¸€ä¸ªå¹»è§‰ï¼šå•çº¿ç¨‹ç¨‹åºæ˜¯æŒ‰ç¨‹åºçš„é¡ºåºæ¥æ‰§è¡Œçš„ã€‚as-if-serial è¯­ä¹‰ä½¿å•çº¿ç¨‹ç¨‹åºå‘˜æ— éœ€æ‹…å¿ƒé‡æ’åºä¼šå¹²æ‰°ä»–ä»¬ï¼Œä¹Ÿæ— éœ€æ‹…å¿ƒå†…å­˜å¯è§æ€§é—®é¢˜ã€‚ ç¨‹åºé¡ºåºè§„åˆ™ æ ¹æ® happens- before çš„ç¨‹åºé¡ºåºè§„åˆ™ï¼Œä¸Šé¢è®¡ç®—åœ†çš„é¢ç§¯çš„ç¤ºä¾‹ä»£ç å­˜åœ¨ä¸‰ä¸ª happens- before å…³ç³»ï¼š A happens- before Bï¼› B happens- before Cï¼› A happens- before Cï¼› è¿™é‡Œçš„ç¬¬ 3 ä¸ª happens- before å…³ç³»ï¼Œæ˜¯æ ¹æ® happens- before çš„ä¼ é€’æ€§æ¨å¯¼å‡ºæ¥çš„ã€‚ è¿™é‡Œ A happens- before Bï¼Œä½†å®é™…æ‰§è¡Œæ—¶ B å´å¯ä»¥æ’åœ¨ A ä¹‹å‰æ‰§è¡Œã€‚æ ¹æ®happens-beforeè§„åˆ™ï¼Œå¦‚æœ A happens- before Bï¼ŒJMM å¹¶ä¸è¦æ±‚ A ä¸€å®šè¦åœ¨ B ä¹‹å‰æ‰§è¡Œã€‚JMM ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ã€‚è¿™é‡Œæ“ä½œ A çš„æ‰§è¡Œç»“æœä¸éœ€è¦å¯¹æ“ä½œ B å¯è§ï¼›è€Œä¸”é‡æ’åºæ“ä½œ A å’Œæ“ä½œ B åçš„æ‰§è¡Œç»“æœï¼Œä¸æ“ä½œ A å’Œæ“ä½œ B æŒ‰ happens- before é¡ºåºæ‰§è¡Œçš„ç»“æœä¸€è‡´ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒJMM ä¼šè®¤ä¸ºè¿™ç§é‡æ’åºå¹¶ä¸éæ³•ï¼ˆnot illegalï¼‰ï¼ŒJMM å…è®¸è¿™ç§é‡æ’åºã€‚ åœ¨è®¡ç®—æœºä¸­ï¼Œè½¯ä»¶æŠ€æœ¯å’Œç¡¬ä»¶æŠ€æœ¯æœ‰ä¸€ä¸ªå…±åŒçš„ç›®æ ‡ï¼šåœ¨ä¸æ”¹å˜ç¨‹åºæ‰§è¡Œç»“æœçš„å‰æä¸‹ï¼Œå°½å¯èƒ½çš„å¼€å‘å¹¶è¡Œåº¦ã€‚ç¼–è¯‘å™¨å’Œå¤„ç†å™¨éµä»è¿™ä¸€ç›®æ ‡ï¼Œä» happens- before çš„å®šä¹‰æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒJMM åŒæ ·éµä»è¿™ä¸€ç›®æ ‡ã€‚ é‡æ’åºå¯¹å¤šçº¿ç¨‹çš„å½±å“ 12345678910111213141516class ReorderExample { int a = 0; boolean flag = false; public void writer() { a = 1; //1 flag = true; //2 } Public void reader() { if (flag) { //3 int i = a * a; //4 â€¦â€¦ } }} flag å˜é‡æ˜¯ä¸ªæ ‡è®°ï¼Œç”¨æ¥æ ‡è¯†å˜é‡ a æ˜¯å¦å·²è¢«å†™å…¥ã€‚è¿™é‡Œå‡è®¾æœ‰ä¸¤ä¸ªçº¿ç¨‹ A å’Œ Bï¼ŒA é¦–å…ˆæ‰§è¡Œ writer() æ–¹æ³•ï¼Œéšå B çº¿ç¨‹æ¥ç€æ‰§è¡Œ reader() æ–¹æ³•ã€‚çº¿ç¨‹ B åœ¨æ‰§è¡Œæ“ä½œ 4 æ—¶ï¼Œèƒ½å¦çœ‹åˆ°çº¿ç¨‹ A åœ¨æ“ä½œ 1 å¯¹å…±äº«å˜é‡ a çš„å†™å…¥ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä¸ä¸€å®šèƒ½çœ‹åˆ°ã€‚ ç”±äºæ“ä½œ 1 å’Œæ“ä½œ 2 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºï¼›åŒæ ·ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¹Ÿå¯ä»¥å¯¹è¿™ä¸¤ä¸ªæ“ä½œé‡æ’åºã€‚ä¸‹é¢æ¥çœ‹çœ‹ï¼Œå½“æ“ä½œ 1 å’Œæ“ä½œ 2 é‡æ’åºæ—¶ï¼Œå¯èƒ½ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼Ÿå¦‚ä¸‹å›¾ï¼š æ“ä½œ 1 å’Œæ“ä½œ 2 åšäº†é‡æ’åºã€‚ç¨‹åºæ‰§è¡Œæ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆå†™æ ‡è®°å˜é‡ flagï¼Œéšåçº¿ç¨‹ B è¯»è¿™ä¸ªå˜é‡ã€‚ç”±äºæ¡ä»¶åˆ¤æ–­ä¸ºçœŸï¼Œçº¿ç¨‹ B å°†è¯»å–å˜é‡ aã€‚æ­¤æ—¶ï¼Œå˜é‡ a è¿˜æ ¹æœ¬æ²¡æœ‰è¢«çº¿ç¨‹ A å†™å…¥ï¼Œåœ¨è¿™é‡Œå¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰è¢«é‡æ’åºç ´åäº†ï¼ &lt;font color="red"&gt;â€»æ³¨ï¼šçº¢è‰²çš„è™šç®­çº¿è¡¨ç¤ºé”™è¯¯çš„è¯»æ“ä½œï¼Œç”¨ç»¿è‰²çš„è™šç®­çº¿è¡¨ç¤ºæ­£ç¡®çš„è¯»æ“ä½œã€‚&lt;/font&gt; ä¸‹é¢å†çœ‹çœ‹ï¼Œå½“æ“ä½œ 3 å’Œæ“ä½œ 4 é‡æ’åºæ—¶ä¼šäº§ç”Ÿä»€ä¹ˆæ•ˆæœï¼ˆå€ŸåŠ©è¿™ä¸ªé‡æ’åºï¼Œå¯ä»¥é¡ºä¾¿è¯´æ˜æ§åˆ¶ä¾èµ–æ€§ï¼‰ã€‚å¦‚ä¸‹å›¾ï¼š åœ¨ç¨‹åºä¸­ï¼Œæ“ä½œ 3 å’Œæ“ä½œ 4 å­˜åœ¨æ§åˆ¶ä¾èµ–å…³ç³»ã€‚å½“ä»£ç ä¸­å­˜åœ¨æ§åˆ¶ä¾èµ–æ€§æ—¶ï¼Œä¼šå½±å“æŒ‡ä»¤åºåˆ—æ‰§è¡Œçš„å¹¶è¡Œåº¦ã€‚ä¸ºæ­¤ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨ä¼šé‡‡ç”¨çŒœæµ‹ï¼ˆSpeculationï¼‰æ‰§è¡Œæ¥å…‹æœæ§åˆ¶ç›¸å…³æ€§å¯¹å¹¶è¡Œåº¦çš„å½±å“ã€‚ä»¥å¤„ç†å™¨çš„çŒœæµ‹æ‰§è¡Œä¸ºä¾‹ï¼Œæ‰§è¡Œçº¿ç¨‹ B çš„å¤„ç†å™¨å¯ä»¥æå‰è¯»å–å¹¶è®¡ç®— a*aï¼Œç„¶åæŠŠè®¡ç®—ç»“æœä¸´æ—¶ä¿å­˜åˆ°ä¸€ä¸ªåä¸ºé‡æ’åºç¼“å†²ï¼ˆreorder buffer ROBï¼‰çš„ç¡¬ä»¶ç¼“å­˜ä¸­ã€‚å½“æ¥ä¸‹æ¥æ“ä½œ 3 çš„æ¡ä»¶åˆ¤æ–­ä¸ºçœŸæ—¶ï¼Œå°±æŠŠè¯¥è®¡ç®—ç»“æœå†™å…¥å˜é‡ i ä¸­ã€‚ ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒçŒœæµ‹æ‰§è¡Œå®è´¨ä¸Šå¯¹æ“ä½œ 3 å’Œ 4 åšäº†é‡æ’åºã€‚é‡æ’åºåœ¨è¿™é‡Œç ´åäº†å¤šçº¿ç¨‹ç¨‹åºçš„è¯­ä¹‰ï¼ åœ¨å•çº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œä¸ä¼šæ”¹å˜æ‰§è¡Œç»“æœï¼ˆè¿™ä¹Ÿæ˜¯ as-if-serial è¯­ä¹‰å…è®¸å¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œåšé‡æ’åºçš„åŸå› ï¼‰ï¼›ä½†åœ¨å¤šçº¿ç¨‹ç¨‹åºä¸­ï¼Œå¯¹å­˜åœ¨æ§åˆ¶ä¾èµ–çš„æ“ä½œé‡æ’åºï¼Œå¯èƒ½ä¼šæ”¹å˜ç¨‹åºçš„æ‰§è¡Œç»“æœã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-æŠ½è±¡å·¥å‚æ¨¡å¼]]></title>
    <url>%2Fposts%2F5a86ebac.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œå³Abstract Factory Patternï¼Œæä¾›ä¸€ä¸ªåˆ›å»ºä¸€ç³»åˆ—ç›¸å…³æˆ–ç›¸äº’ä¾èµ–å¯¹è±¡çš„æ¥å£ï¼Œè€Œæ— é¡»æŒ‡å®šå®ƒä»¬å…·ä½“çš„ç±»ï¼›å…·ä½“çš„å·¥å‚è´Ÿè´£å®ç°å…·ä½“çš„äº§å“å®ä¾‹ã€‚ ä¸»è¦ä½œç”¨ å…è®¸ä½¿ç”¨æŠ½è±¡çš„æ¥å£æ¥åˆ›å»ºä¸€ç»„ç›¸å…³äº§å“ï¼Œè€Œä¸éœ€è¦çŸ¥é“æˆ–å…³å¿ƒå®é™…ç”Ÿäº§å‡ºçš„å…·ä½“äº§å“æ˜¯ä»€ä¹ˆï¼Œè¿™æ ·å°±å¯ä»¥ä»å…·ä½“äº§å“ä¸­è¢«è§£è€¦ã€‚ è§£å†³çš„é—®é¢˜ è§£å†³å·¥å‚æ–¹æ³•æ¨¡å¼çš„ç¼ºç‚¹ï¼šæ¯ä¸ªå·¥å‚åªèƒ½åˆ›å»ºä¸€ç±»äº§å“ã€‚ æ¨¡å¼åŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“æ—ï¼ˆAbstractProductï¼‰ æŠ½è±¡äº§å“çš„çˆ¶ç±» æè¿°æŠ½è±¡äº§å“çš„å…¬å…±æ¥å£ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°å…·ä½“äº§å“çš„å…¬å…±æ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥å‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ æŠ½è±¡å·¥å‚ï¼ˆCreatorï¼‰ å…·ä½“å·¥å‚çš„çˆ¶ç±» æè¿°å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ å…·ä½“å·¥å‚ï¼ˆConcrete Creatorï¼‰ æŠ½è±¡å·¥å‚çš„å­ç±»ï¼› è¢«å¤–ç•Œè°ƒç”¨ æè¿°å…·ä½“å·¥å‚ï¼› å®ç°FactoryMethodå·¥å‚æ–¹æ³•åˆ›å»ºäº§å“çš„å®ä¾‹ å¦‚ä½•ç†è§£æŠ½è±¡äº§å“æ—ã€æŠ½è±¡äº§å“å’Œå…·ä½“äº§å“çš„åŒºåˆ«å‘¢ï¼Ÿè¯·çœ‹ä¸‹å›¾ï¼š ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡å·¥å‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“æ—ç±» ï¼Œå®šä¹‰æŠ½è±¡äº§å“çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“ç±» ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“æ—ç±»ï¼‰ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå…·ä½“å·¥å‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥å‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®ä¾‹çš„æ–¹æ³•ï¼› å®¢æˆ·ç«¯é€šè¿‡å®ä¾‹åŒ–å…·ä½“çš„å·¥å‚ç±»ï¼Œå¹¶è°ƒç”¨å…¶åˆ›å»ºä¸åŒç›®æ ‡äº§å“çš„æ–¹æ³•åˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®ä¾‹ æ¨¡å¼ä¼˜ç‚¹ é™ä½è€¦åˆ æŠ½è±¡å·¥å‚æ¨¡å¼å°†å…·ä½“äº§å“çš„åˆ›å»ºå»¶è¿Ÿåˆ°å…·ä½“å·¥å‚çš„å­ç±»ä¸­ï¼Œè¿™æ ·å°†å¯¹è±¡çš„åˆ›å»ºå°è£…èµ·æ¥ï¼Œå¯ä»¥å‡å°‘å®¢æˆ·ç«¯ä¸å…·ä½“äº§å“ç±»ä¹‹é—´çš„ä¾èµ–ï¼Œä»è€Œä½¿ç³»ç»Ÿè€¦åˆåº¦ä½ï¼Œè¿™æ ·æ›´æœ‰åˆ©äºåæœŸçš„ç»´æŠ¤å’Œæ‰©å±•ã€‚ æ›´ç¬¦åˆå¼€-é—­åŸåˆ™ æ–°å¢ä¸€ç§äº§å“ç±»æ—¶ï¼Œåªéœ€è¦å¢åŠ ç›¸åº”çš„å…·ä½“äº§å“ç±»å’Œç›¸åº”çš„å·¥å‚å­ç±»å³å¯ã€‚ ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ æ¯ä¸ªå…·ä½“å·¥å‚ç±»åªè´Ÿè´£åˆ›å»ºå¯¹åº”çš„äº§å“ã€‚ ä¸ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚ æ¨¡å¼ç¼ºç‚¹ æŠ½è±¡å·¥å‚æ¨¡å¼å¾ˆéš¾æ”¯æŒæ–°ç§ç±»äº§å“çš„å˜åŒ–ã€‚è¿™æ˜¯å› ä¸ºæŠ½è±¡å·¥å‚æ¥å£ä¸­å·²ç»ç¡®å®šäº†å¯ä»¥è¢«åˆ›å»ºçš„äº§å“é›†åˆï¼Œå¦‚æœéœ€è¦æ·»åŠ æ–°äº§å“ï¼Œæ­¤æ—¶å°±å¿…é¡»å»ä¿®æ”¹æŠ½è±¡å·¥å‚çš„æ¥å£ï¼Œè¿™æ ·å°±æ¶‰åŠåˆ°æŠ½è±¡å·¥å‚ç±»çš„ä»¥åŠæ‰€æœ‰å­ç±»çš„æ”¹å˜ï¼Œè¿™æ ·ä¹Ÿå°±è¿èƒŒäº†â€œå¼€æ”¾â€”â€”å°é—­â€åŸåˆ™ã€‚ åº”ç”¨åœºæ™¯ ä¸€ä¸ªç³»ç»Ÿä¸è¦æ±‚ä¾èµ–äº§å“ç±»å®ä¾‹å¦‚ä½•è¢«åˆ›å»ºã€ç»„åˆå’Œè¡¨è¾¾çš„è¡¨è¾¾ï¼Œè¿™ç‚¹ä¹Ÿæ˜¯æ‰€æœ‰å·¥å‚æ¨¡å¼åº”ç”¨çš„å‰æã€‚ è¿™ä¸ªç³»ç»Ÿæœ‰å¤šä¸ªç³»åˆ—äº§å“ï¼Œè€Œç³»ç»Ÿä¸­åªæ¶ˆè´¹å…¶ä¸­æŸä¸€ç³»åˆ—äº§å“ã€‚ ç³»ç»Ÿè¦æ±‚æä¾›ä¸€ä¸ªäº§å“ç±»çš„åº“ï¼Œæ‰€æœ‰äº§å“ä»¥åŒæ ·çš„æ¥å£å‡ºç°ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦ä¾èµ–å…·ä½“å®ç°ã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ èƒŒæ™¯ï¼šå‡è®¾æœ‰ä¸¤é—´å¡‘æ–™åŠ å·¥å‚ï¼ˆAå‚ä»…ç”Ÿäº§å®¹å™¨ç±»äº§å“ï¼›Bå‚ä»…ç”Ÿäº§æ¨¡å…·ç±»äº§å“ï¼‰ï¼›éšç€å®¢æˆ·éœ€æ±‚çš„å˜åŒ–ï¼ŒAå‚æ‰€åœ¨åœ°çš„å®¢æˆ·éœ€è¦ä¹Ÿæ¨¡å…·ç±»äº§å“ï¼ŒBå‚æ‰€åœ¨åœ°çš„å®¢æˆ·ä¹Ÿéœ€è¦å®¹å™¨ç±»äº§å“ï¼› å†²çªï¼šæ²¡æœ‰èµ„æºï¼ˆèµ„é‡‘+ç§Ÿä½ï¼‰åœ¨å½“åœ°åˆ†åˆ«å¼€è®¾å¤šä¸€å®¶æ³¨å¡‘åˆ†å‚ è§£å†³æ–¹æ¡ˆï¼šåœ¨åŸæœ‰çš„ä¸¤å®¶å¡‘æ–™å‚é‡Œå¢è®¾ç”Ÿäº§éœ€æ±‚çš„åŠŸèƒ½ï¼Œå³Aå‚èƒ½ç”Ÿäº§å®¹å™¨+æ¨¡å…·äº§å“ï¼›Bå‚é—´èƒ½ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ã€‚ æŠ½è±¡å·¥å‚ç±» 123456789101112131415161718192021package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡å·¥å‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ */public abstract class Factory { /** * ç”Ÿäº§å®¹å™¨ * * @return */ public abstract AbstractProduct manufactureContainer(); /** * ç”Ÿäº§æ¨¡å…· * * @return */ public abstract AbstractProduct manufactureMould();} æŠ½è±¡äº§å“æ—ç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“æ—ç±» ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ï¼› */public abstract class AbstractProduct { /** * å±•ç¤ºäº§å“ */ public abstract void show();} æŠ½è±¡äº§å“ç±» å®¹å™¨äº§å“æŠ½è±¡ç±» 12345678910package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»--å®¹å™¨ ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ */public abstract class ContainerProduct extends AbstractProduct { @Override public abstract void show();} æ¨¡å…·äº§å“æŠ½è±¡ç±» 12345678910package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»--æ¨¡å…· ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ */public abstract class MouldProduct extends AbstractProduct { @Override public abstract void show();} å…·ä½“äº§å“ç±» å®¹å™¨äº§å“Aç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--å®¹å™¨Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ContainerProductA extends ContainerProduct { @Override public void show() { System.out.println("ç”Ÿäº§å‡ºäº†å®¹å™¨äº§å“A..."); }} å®¹å™¨äº§å“Bç±» 123456789101112package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»-å®¹å™¨Bï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ContainerProductB extends ContainerProduct { @Override public void show() { System.out.println("ç”Ÿäº§å‡ºäº†å®¹å™¨äº§å“B..."); }} æ¨¡å…·äº§å“Aç±» 12345678910111213package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--æ¨¡å…·Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class MouldProductA extends MouldProduct { @Override public void show() { System.out.println("ç”Ÿäº§å‡ºäº†æ¨¡å…·äº§å“A..."); }} æ¨¡å…·äº§å“Bç±» 12345678910111213package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»--æ¨¡å…·Bï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œ å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class MouldProductB extends MouldProduct { @Override public void show() { System.out.println("ç”Ÿäº§å‡ºäº†æ¨¡å…·äº§å“B..."); }} å…·ä½“å·¥å‚ç±» Aå‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ 12345678910111213141516171819package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“å·¥å‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥å‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®ä¾‹çš„æ–¹æ³• * Aå‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ */public class FactoryA extends Factory { @Override public AbstractProduct manufactureContainer() { return new ContainerProductA(); } @Override public AbstractProduct manufactureMould() { return new MouldProductA(); }} Bå‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ 12345678910111213141516171819package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å…·ä½“å·¥å‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥å‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®ä¾‹çš„æ–¹æ³• * Bå‚ - ç”Ÿäº§æ¨¡å…·+å®¹å™¨äº§å“ */public class FactoryB extends Factory { @Override public AbstractProduct manufactureContainer() { return new ContainerProductB(); } @Override public AbstractProduct manufactureMould() { return new MouldProductB(); }} å®¢æˆ·ç«¯è°ƒç”¨ 12345678910111213141516171819202122package main.java.com.study.designPatterns.factory.abstracts.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { FactoryA mFactoryA = new FactoryA(); FactoryB mFactoryB = new FactoryB(); //Aå‚å½“åœ°å®¢æˆ·éœ€è¦å®¹å™¨äº§å“A mFactoryA.manufactureContainer().show(); //Aå‚å½“åœ°å®¢æˆ·éœ€è¦æ¨¡å…·äº§å“A mFactoryA.manufactureMould().show(); //Bå‚å½“åœ°å®¢æˆ·éœ€è¦å®¹å™¨äº§å“B mFactoryB.manufactureContainer().show(); //Bå‚å½“åœ°å®¢æˆ·éœ€è¦æ¨¡å…·äº§å“B mFactoryB.manufactureMould().show(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-ç†è§£Volatile]]></title>
    <url>%2Fposts%2Fe72020d.html</url>
    <content type="text"><![CDATA[volatileç‰¹æ€§ å½“å£°æ˜å…±äº«å˜é‡ä¸º volatile åï¼Œå¯¹è¿™ä¸ªå˜é‡çš„è¯» / å†™å°†ä¼šå¾ˆç‰¹åˆ«ã€‚ç†è§£ volatile ç‰¹æ€§çš„ä¸€ä¸ªå¥½æ–¹æ³•æ˜¯ï¼šæŠŠå¯¹ volatile å˜é‡çš„å•ä¸ªè¯» / å†™ï¼Œçœ‹æˆæ˜¯ä½¿ç”¨åŒä¸€ä¸ªç›‘è§†å™¨é”å¯¹è¿™äº›å•ä¸ªè¯» / å†™æ“ä½œåšäº†åŒæ­¥ã€‚å¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š 12345678910111213141516class VolatileFeaturesExample { volatile long vl = 0L; // ä½¿ç”¨ volatile å£°æ˜ 64 ä½çš„ long å‹å˜é‡ public void set(long l) { vl = l; // å•ä¸ª volatile å˜é‡çš„å†™ } public void getAndIncrement () { vl++; // å¤åˆï¼ˆå¤šä¸ªï¼‰volatile å˜é‡çš„è¯» / å†™ } public long get() { return vl; // å•ä¸ª volatile å˜é‡çš„è¯» }} å‡è®¾æœ‰å¤šä¸ªçº¿ç¨‹åˆ†åˆ«è°ƒç”¨ä¸Šé¢ç¨‹åºçš„ä¸‰ä¸ªæ–¹æ³•ï¼Œè¿™ä¸ªç¨‹åºåœ¨è¯­æ„ä¸Šå’Œä¸‹é¢ç¨‹åºç­‰ä»·ï¼š 1234567891011121314151617class VolatileFeaturesExample { long vl = 0L; // 64 ä½çš„ long å‹æ™®é€šå˜é‡ public synchronized void set(long l) { // å¯¹å•ä¸ªçš„æ™®é€š å˜é‡çš„å†™ç”¨åŒä¸€ä¸ªç›‘è§†å™¨åŒæ­¥ vl = l; } public void getAndIncrement () { // æ™®é€šæ–¹æ³•è°ƒç”¨ long temp = get(); // è°ƒç”¨å·²åŒæ­¥çš„è¯»æ–¹æ³• temp += 1L; // æ™®é€šå†™æ“ä½œ set(temp); // è°ƒç”¨å·²åŒæ­¥çš„å†™æ–¹æ³• } public synchronized long get() { // å¯¹å•ä¸ªçš„æ™®é€šå˜é‡çš„è¯»ç”¨åŒä¸€ä¸ªç›‘è§†å™¨åŒæ­¥ return vl; }} å¦‚ç¤ºä¾‹ç¨‹åºæ‰€ç¤ºï¼Œå¯¹ä¸€ä¸ª volatile å˜é‡çš„å•ä¸ªè¯» / å†™æ“ä½œï¼Œä¸å¯¹ä¸€ä¸ªæ™®é€šå˜é‡çš„è¯» / å†™æ“ä½œä½¿ç”¨åŒä¸€ä¸ªç›‘è§†å™¨é”æ¥åŒæ­¥ï¼Œå®ƒä»¬ä¹‹é—´çš„æ‰§è¡Œæ•ˆæœç›¸åŒã€‚ ç›‘è§†å™¨é”çš„ happens-before è§„åˆ™ä¿è¯é‡Šæ”¾ç›‘è§†å™¨å’Œè·å–ç›‘è§†å™¨çš„ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´çš„å†…å­˜å¯è§æ€§ï¼Œè¿™æ„å‘³ç€å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åçš„å†™å…¥ã€‚ ç›‘è§†å™¨é”çš„è¯­ä¹‰å†³å®šäº†ä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§ã€‚è¿™æ„å‘³ç€å³ä½¿æ˜¯ 64 ä½çš„ long å‹å’Œ double å‹å˜é‡ï¼Œåªè¦å®ƒæ˜¯ volatile å˜é‡ï¼Œå¯¹è¯¥å˜é‡çš„è¯»å†™å°±å°†å…·æœ‰åŸå­æ€§ã€‚å¦‚æœæ˜¯å¤šä¸ª volatile æ“ä½œæˆ–ç±»ä¼¼äº volatile++ è¿™ç§å¤åˆæ“ä½œï¼Œè¿™äº›æ“ä½œæ•´ä½“ä¸Šä¸å…·æœ‰åŸå­æ€§ã€‚ ç®€è€Œè¨€ä¹‹ï¼Œvolatile å˜é‡è‡ªèº«å…·æœ‰ä¸‹åˆ—ç‰¹æ€§ï¼š å¯è§æ€§ã€‚å¯¹ä¸€ä¸ª volatile å˜é‡çš„è¯»ï¼Œæ€»æ˜¯èƒ½çœ‹åˆ°ï¼ˆä»»æ„çº¿ç¨‹ï¼‰å¯¹è¿™ä¸ª volatile å˜é‡æœ€åçš„å†™å…¥ã€‚ åŸå­æ€§ï¼šå¯¹ä»»æ„å•ä¸ª volatile å˜é‡çš„è¯» / å†™å…·æœ‰åŸå­æ€§ï¼Œä½†ç±»ä¼¼äº volatile++ è¿™ç§å¤åˆæ“ä½œä¸å…·æœ‰åŸå­æ€§ã€‚ volatileçš„happens-beforeå…³ç³» ä»å†…å­˜è¯­ä¹‰çš„è§’åº¦æ¥è¯´ï¼Œvolatile ä¸ç›‘è§†å™¨é”æœ‰ç›¸åŒçš„æ•ˆæœï¼švolatile å†™å’Œç›‘è§†å™¨çš„é‡Šæ”¾æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ï¼›volatile è¯»ä¸ç›‘è§†å™¨çš„è·å–æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ 12345678910111213141516class VolatileExample { int a = 0; volatile boolean flag = false; public void writer() { a = 1; //1 flag = true; //2 } public void reader() { if (flag) { //3 int i = a; //4 â€¦â€¦ } }} å‡è®¾çº¿ç¨‹ A æ‰§è¡Œ writer() æ–¹æ³•ä¹‹åï¼Œçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ã€‚æ ¹æ® happens before è§„åˆ™ï¼Œè¿™ä¸ªè¿‡ç¨‹å»ºç«‹çš„ happens before å…³ç³»å¯ä»¥åˆ†ä¸ºä¸¤ç±»ï¼š æ ¹æ®ç¨‹åºæ¬¡åºè§„åˆ™ï¼Œ1 happens before 2; 3 happens before 4ã€‚ æ ¹æ® volatile è§„åˆ™ï¼Œ2 happens before 3ã€‚ æ ¹æ® happens before çš„ä¼ é€’æ€§è§„åˆ™ï¼Œ1 happens before 4ã€‚ ä¸Šè¿° happens before å…³ç³»çš„å›¾å½¢åŒ–è¡¨ç°å½¢å¼å¦‚ä¸‹ï¼š åœ¨ä¸Šå›¾ä¸­ï¼Œæ¯ä¸€ä¸ªç®­å¤´é“¾æ¥çš„ä¸¤ä¸ªèŠ‚ç‚¹ï¼Œä»£è¡¨äº†ä¸€ä¸ª happens before å…³ç³»ã€‚é»‘è‰²ç®­å¤´è¡¨ç¤ºç¨‹åºé¡ºåºè§„åˆ™ï¼›æ©™è‰²ç®­å¤´è¡¨ç¤º volatile è§„åˆ™ï¼›è“è‰²ç®­å¤´è¡¨ç¤ºç»„åˆè¿™äº›è§„åˆ™åæä¾›çš„ happens before ä¿è¯ã€‚ è¿™é‡Œ A çº¿ç¨‹å†™ä¸€ä¸ª volatile å˜é‡åï¼ŒB çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚A çº¿ç¨‹åœ¨å†™ volatile å˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡ï¼Œåœ¨ B çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡åï¼Œå°†ç«‹å³å˜å¾—å¯¹ B çº¿ç¨‹å¯è§ã€‚ volatileçš„å†…å­˜è¯­ä¹‰ volatile å†™çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“å†™ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ä¸­çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ ä»¥ä¸Šé¢ç¤ºä¾‹ç¨‹åºä¸ºä¾‹ï¼Œå‡è®¾çº¿ç¨‹ A é¦–å…ˆæ‰§è¡Œ writer() æ–¹æ³•ï¼Œéšåçº¿ç¨‹ B æ‰§è¡Œ reader() æ–¹æ³•ï¼Œåˆå§‹æ—¶ä¸¤ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¸­çš„ flag å’Œ a éƒ½æ˜¯åˆå§‹çŠ¶æ€ã€‚ä¸‹å›¾æ˜¯çº¿ç¨‹ A æ‰§è¡Œ volatile å†™åï¼Œå…±äº«å˜é‡çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œçº¿ç¨‹ A åœ¨å†™ flag å˜é‡åï¼Œæœ¬åœ°å†…å­˜ A ä¸­è¢«çº¿ç¨‹ A æ›´æ–°è¿‡çš„ä¸¤ä¸ªå…±äº«å˜é‡çš„å€¼è¢«åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ã€‚æ­¤æ—¶ï¼Œæœ¬åœ°å†…å­˜ A å’Œä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼æ˜¯ä¸€è‡´çš„ã€‚ volatile è¯»çš„å†…å­˜è¯­ä¹‰å¦‚ä¸‹ï¼š å½“è¯»ä¸€ä¸ª volatile å˜é‡æ—¶ï¼ŒJMM ä¼šæŠŠè¯¥çº¿ç¨‹å¯¹åº”çš„æœ¬åœ°å†…å­˜ç½®ä¸ºæ— æ•ˆã€‚çº¿ç¨‹æ¥ä¸‹æ¥å°†ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚ ä¸‹é¢æ˜¯çº¿ç¨‹ B è¯»åŒä¸€ä¸ª volatile å˜é‡åï¼Œå…±äº«å˜é‡çš„çŠ¶æ€ç¤ºæ„å›¾ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œåœ¨è¯» flag å˜é‡åï¼Œæœ¬åœ°å†…å­˜ B å·²ç»è¢«ç½®ä¸ºæ— æ•ˆã€‚æ­¤æ—¶ï¼Œçº¿ç¨‹ B å¿…é¡»ä»ä¸»å†…å­˜ä¸­è¯»å–å…±äº«å˜é‡ã€‚çº¿ç¨‹ B çš„è¯»å–æ“ä½œå°†å¯¼è‡´æœ¬åœ°å†…å­˜ B ä¸ä¸»å†…å­˜ä¸­çš„å…±äº«å˜é‡çš„å€¼ä¹Ÿå˜æˆä¸€è‡´çš„äº†ã€‚ å¦‚æœæŠŠ volatile å†™å’Œ volatile è¯»è¿™ä¸¤ä¸ªæ­¥éª¤ç»¼åˆèµ·æ¥çœ‹çš„è¯ï¼Œåœ¨è¯»çº¿ç¨‹ B è¯»ä¸€ä¸ª volatile å˜é‡åï¼Œå†™çº¿ç¨‹ A åœ¨å†™è¿™ä¸ª volatile å˜é‡ä¹‹å‰æ‰€æœ‰å¯è§çš„å…±äº«å˜é‡çš„å€¼éƒ½å°†ç«‹å³å˜å¾—å¯¹è¯»çº¿ç¨‹ B å¯è§ã€‚ volatileå†…å­˜è¯­ä¹‰å®ç° é‡æ’åºåˆ†ä¸ºç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºã€‚ä¸ºäº†å®ç° volatile å†…å­˜è¯­ä¹‰ï¼ŒJMM ä¼šåˆ†åˆ«é™åˆ¶è¿™ä¸¤ç§ç±»å‹çš„é‡æ’åºç±»å‹ã€‚ä¸‹é¢æ˜¯ JMM é’ˆå¯¹ç¼–è¯‘å™¨åˆ¶å®šçš„ volatile é‡æ’åºè§„åˆ™è¡¨ï¼š èƒ½å¦é‡æ’åº ç¬¬äºŒä¸ªæ“ä½œ ç¬¬ä¸€ä¸ªæ“ä½œ æ™®é€šè¯» / å†™ volatile è¯» volatile å†™ æ™®é€šè¯» / å†™ NO volatile è¯» NO NO NO volatile å†™ NO NO ä»ä¸Šè¡¨å¯ä»¥çœ‹å‡ºï¼š å½“ç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile å†™æ—¶ï¼Œä¸ç®¡ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile å†™ä¹‹å‰çš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ° volatile å†™ä¹‹åã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸ç®¡ç¬¬äºŒä¸ªæ“ä½œæ˜¯ä»€ä¹ˆï¼Œéƒ½ä¸èƒ½é‡æ’åºã€‚è¿™ä¸ªè§„åˆ™ç¡®ä¿ volatile è¯»ä¹‹åçš„æ“ä½œä¸ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºåˆ° volatile è¯»ä¹‹å‰ã€‚ å½“ç¬¬ä¸€ä¸ªæ“ä½œæ˜¯ volatile å†™ï¼Œç¬¬äºŒä¸ªæ“ä½œæ˜¯ volatile è¯»æ—¶ï¼Œä¸èƒ½é‡æ’åºã€‚ ä¸ºäº†å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ï¼Œä¼šåœ¨æŒ‡ä»¤åºåˆ—ä¸­æ’å…¥å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå‘ç°ä¸€ä¸ªæœ€ä¼˜å¸ƒç½®æ¥æœ€å°åŒ–æ’å…¥å±éšœçš„æ€»æ•°å‡ ä¹ä¸å¯èƒ½ï¼Œä¸ºæ­¤ï¼ŒJMM é‡‡å–ä¿å®ˆç­–ç•¥ã€‚ä¸‹é¢æ˜¯åŸºäºä¿å®ˆç­–ç•¥çš„ JMM å†…å­˜å±éšœæ’å…¥ç­–ç•¥ï¼š åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„å‰é¢æ’å…¥ä¸€ä¸ª StoreStore å±éšœã€‚ åœ¨æ¯ä¸ª volatile å†™æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadLoad å±éšœã€‚ åœ¨æ¯ä¸ª volatile è¯»æ“ä½œçš„åé¢æ’å…¥ä¸€ä¸ª LoadStore å±éšœã€‚ ä¸Šè¿°å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆï¼Œä½†å®ƒå¯ä»¥ä¿è¯åœ¨ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œä»»æ„çš„ç¨‹åºä¸­éƒ½èƒ½å¾—åˆ°æ­£ç¡®çš„ volatile å†…å­˜è¯­ä¹‰ã€‚ ä¸‹é¢æ˜¯ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile å†™æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ StoreStore å±éšœå¯ä»¥ä¿è¯åœ¨ volatile å†™ä¹‹å‰ï¼Œå…¶å‰é¢çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œå·²ç»å¯¹ä»»æ„å¤„ç†å™¨å¯è§äº†ã€‚è¿™æ˜¯å› ä¸º StoreStore å±éšœå°†ä¿éšœä¸Šé¢æ‰€æœ‰çš„æ™®é€šå†™åœ¨ volatile å†™ä¹‹å‰åˆ·æ–°åˆ°ä¸»å†…å­˜ã€‚ è¿™é‡Œæ¯”è¾ƒæœ‰æ„æ€çš„æ˜¯ volatile å†™åé¢çš„ StoreLoad å±éšœã€‚è¿™ä¸ªå±éšœçš„ä½œç”¨æ˜¯é¿å… volatile å†™ä¸åé¢å¯èƒ½æœ‰çš„ volatile è¯» / å†™æ“ä½œé‡æ’åºã€‚å› ä¸ºç¼–è¯‘å™¨å¸¸å¸¸æ— æ³•å‡†ç¡®åˆ¤æ–­åœ¨ä¸€ä¸ª volatile å†™çš„åé¢ï¼Œæ˜¯å¦éœ€è¦æ’å…¥ä¸€ä¸ª StoreLoad å±éšœï¼ˆæ¯”å¦‚ï¼Œä¸€ä¸ª volatile å†™ä¹‹åæ–¹æ³•ç«‹å³ returnï¼‰ã€‚ä¸ºäº†ä¿è¯èƒ½æ­£ç¡®å®ç° volatile çš„å†…å­˜è¯­ä¹‰ï¼ŒJMM åœ¨è¿™é‡Œé‡‡å–äº†ä¿å®ˆç­–ç•¥ï¼šåœ¨æ¯ä¸ª volatile å†™çš„åé¢æˆ–åœ¨æ¯ä¸ª volatile è¯»çš„å‰é¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ä»æ•´ä½“æ‰§è¡Œæ•ˆç‡çš„è§’åº¦è€ƒè™‘ï¼ŒJMM é€‰æ‹©äº†åœ¨æ¯ä¸ª volatile å†™çš„åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚å› ä¸º volatile å†™ - è¯»å†…å­˜è¯­ä¹‰çš„å¸¸è§ä½¿ç”¨æ¨¡å¼æ˜¯ï¼šä¸€ä¸ªå†™çº¿ç¨‹å†™ volatile å˜é‡ï¼Œå¤šä¸ªè¯»çº¿ç¨‹è¯»åŒä¸€ä¸ª volatile å˜é‡ã€‚å½“è¯»çº¿ç¨‹çš„æ•°é‡å¤§å¤§è¶…è¿‡å†™çº¿ç¨‹æ—¶ï¼Œé€‰æ‹©åœ¨ volatile å†™ä¹‹åæ’å…¥ StoreLoad å±éšœå°†å¸¦æ¥å¯è§‚çš„æ‰§è¡Œæ•ˆç‡çš„æå‡ã€‚ä»è¿™é‡Œå¯ä»¥çœ‹åˆ° JMM åœ¨å®ç°ä¸Šçš„ä¸€ä¸ªç‰¹ç‚¹ï¼šé¦–å…ˆç¡®ä¿æ­£ç¡®æ€§ï¼Œç„¶åå†å»è¿½æ±‚æ‰§è¡Œæ•ˆç‡ã€‚ ä¸‹é¢æ˜¯åœ¨ä¿å®ˆç­–ç•¥ä¸‹ï¼Œvolatile è¯»æ’å…¥å†…å­˜å±éšœåç”Ÿæˆçš„æŒ‡ä»¤åºåˆ—ç¤ºæ„å›¾ï¼š ä¸Šå›¾ä¸­çš„ LoadLoad å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸ä¸‹é¢çš„æ™®é€šè¯»é‡æ’åºã€‚LoadStore å±éšœç”¨æ¥ç¦æ­¢å¤„ç†å™¨æŠŠä¸Šé¢çš„ volatile è¯»ä¸ä¸‹é¢çš„æ™®é€šå†™é‡æ’åºã€‚ ä¸Šè¿° volatile å†™å’Œ volatile è¯»çš„å†…å­˜å±éšœæ’å…¥ç­–ç•¥éå¸¸ä¿å®ˆã€‚åœ¨å®é™…æ‰§è¡Œæ—¶ï¼Œåªè¦ä¸æ”¹å˜ volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ï¼Œç¼–è¯‘å™¨å¯ä»¥æ ¹æ®å…·ä½“æƒ…å†µçœç•¥ä¸å¿…è¦çš„å±éšœã€‚ä¸‹é¢é€šè¿‡ç¤ºä¾‹ä»£ç æ¥è¯´æ˜ï¼š 123456789101112131415class VolatileBarrierExample { int a; volatile int v1 = 1; volatile int v2 = 2; void readAndWrite() { int i = v1; // ç¬¬ä¸€ä¸ª volatile è¯» int j = v2; // ç¬¬äºŒä¸ª volatile è¯» a = i + j; // æ™®é€šå†™ v1 = i + 1; // ç¬¬ä¸€ä¸ª volatile å†™ v2 = j * 2; // ç¬¬äºŒä¸ª volatile å†™ } â€¦ // å…¶ä»–æ–¹æ³• } é’ˆå¯¹ readAndWrite() æ–¹æ³•ï¼Œç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶å¯ä»¥åšå¦‚ä¸‹çš„ä¼˜åŒ–ï¼š æ³¨æ„ï¼Œæœ€åçš„ StoreLoad å±éšœä¸èƒ½çœç•¥ã€‚å› ä¸ºç¬¬äºŒä¸ª volatile å†™ä¹‹åï¼Œæ–¹æ³•ç«‹å³ returnã€‚æ­¤æ—¶ç¼–è¯‘å™¨å¯èƒ½æ— æ³•å‡†ç¡®æ–­å®šåé¢æ˜¯å¦ä¼šæœ‰ volatile è¯»æˆ–å†™ï¼Œä¸ºäº†å®‰å…¨èµ·è§ï¼Œç¼–è¯‘å™¨å¸¸å¸¸ä¼šåœ¨è¿™é‡Œæ’å…¥ä¸€ä¸ª StoreLoad å±éšœã€‚ ä¸Šé¢çš„ä¼˜åŒ–æ˜¯é’ˆå¯¹ä»»æ„å¤„ç†å™¨å¹³å°ï¼Œç”±äºä¸åŒçš„å¤„ç†å™¨æœ‰ä¸åŒâ€œæ¾ç´§åº¦â€çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹ï¼Œå†…å­˜å±éšœçš„æ’å…¥è¿˜å¯ä»¥æ ¹æ®å…·ä½“çš„å¤„ç†å™¨å†…å­˜æ¨¡å‹ç»§ç»­ä¼˜åŒ–ã€‚ä»¥ x86 å¤„ç†å™¨ä¸ºä¾‹ï¼Œä¸Šå›¾ä¸­é™¤æœ€åçš„ StoreLoad å±éšœå¤–ï¼Œå…¶å®ƒçš„å±éšœéƒ½ä¼šè¢«çœç•¥ã€‚ å‰é¢ä¿å®ˆç­–ç•¥ä¸‹çš„ volatile è¯»å’Œå†™ï¼Œåœ¨ x86 å¤„ç†å™¨å¹³å°å¯ä»¥ä¼˜åŒ–æˆï¼š å‰é¢æåˆ°è¿‡ï¼Œx86 å¤„ç†å™¨ä»…ä¼šå¯¹å†™ - è¯»æ“ä½œåšé‡æ’åºã€‚X86 ä¸ä¼šå¯¹è¯» - è¯»ï¼Œè¯» - å†™å’Œå†™ - å†™æ“ä½œåšé‡æ’åºï¼Œå› æ­¤åœ¨ x86 å¤„ç†å™¨ä¸­ä¼šçœç•¥æ‰è¿™ä¸‰ç§æ“ä½œç±»å‹å¯¹åº”çš„å†…å­˜å±éšœã€‚åœ¨ x86 ä¸­ï¼ŒJMM ä»…éœ€åœ¨ volatile å†™åé¢æ’å…¥ä¸€ä¸ª StoreLoad å±éšœå³å¯æ­£ç¡®å®ç° volatile å†™ - è¯»çš„å†…å­˜è¯­ä¹‰ã€‚è¿™æ„å‘³ç€åœ¨ x86 å¤„ç†å™¨ä¸­ï¼Œvolatile å†™çš„å¼€é”€æ¯” volatile è¯»çš„å¼€é”€ä¼šå¤§å¾ˆå¤šï¼ˆå› ä¸ºæ‰§è¡Œ StoreLoad å±éšœå¼€é”€ä¼šæ¯”è¾ƒå¤§ï¼‰ã€‚ JSR-133 ä¸ºä»€ä¹ˆè¦å¢å¼º volatile çš„å†…å­˜è¯­ä¹‰ åœ¨ JSR-133 ä¹‹å‰çš„æ—§ Java å†…å­˜æ¨¡å‹ä¸­ï¼Œè™½ç„¶ä¸å…è®¸ volatile å˜é‡ä¹‹é—´é‡æ’åºï¼Œä½†æ—§çš„ Java å†…å­˜æ¨¡å‹å…è®¸ volatile å˜é‡ä¸æ™®é€šå˜é‡ä¹‹é—´é‡æ’åºã€‚ å› æ­¤åœ¨æ—§çš„å†…å­˜æ¨¡å‹ä¸­ ï¼Œvolatile çš„å†™ - è¯»æ²¡æœ‰ç›‘è§†å™¨çš„é‡Šæ”¾ - è·æ‰€å…·æœ‰çš„å†…å­˜è¯­ä¹‰ã€‚ä¸ºäº†æä¾›ä¸€ç§æ¯”ç›‘è§†å™¨é”æ›´è½»é‡çº§çš„çº¿ç¨‹ä¹‹é—´é€šä¿¡çš„æœºåˆ¶ï¼ŒJSR-133 ä¸“å®¶ç»„å†³å®šå¢å¼º volatile çš„å†…å­˜è¯­ä¹‰ï¼šä¸¥æ ¼é™åˆ¶ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹ volatile å˜é‡ä¸æ™®é€šå˜é‡çš„é‡æ’åºï¼Œç¡®ä¿ volatile çš„å†™ - è¯»å’Œç›‘è§†å™¨çš„é‡Šæ”¾ - è·å–ä¸€æ ·ï¼Œå…·æœ‰ç›¸åŒçš„å†…å­˜è¯­ä¹‰ã€‚ä»ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™å’Œå¤„ç†å™¨å†…å­˜å±éšœæ’å…¥ç­–ç•¥æ¥çœ‹ï¼Œåªè¦ volatile å˜é‡ä¸æ™®é€šå˜é‡ä¹‹é—´çš„é‡æ’åºå¯èƒ½ä¼šç ´å volatile çš„å†…å­˜è¯­æ„ï¼Œè¿™ç§é‡æ’åºå°±ä¼šè¢«ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™å’Œå¤„ç†å™¨å†…å­˜å±éšœæ’å…¥ç­–ç•¥ç¦æ­¢ã€‚ ç”±äº volatile ä»…ä»…ä¿è¯å¯¹å•ä¸ª volatile å˜é‡çš„è¯» / å†™å…·æœ‰åŸå­æ€§ï¼Œè€Œç›‘è§†å™¨é”çš„äº’æ–¥æ‰§è¡Œçš„ç‰¹æ€§å¯ä»¥ç¡®ä¿å¯¹æ•´ä¸ªä¸´ç•ŒåŒºä»£ç çš„æ‰§è¡Œå…·æœ‰åŸå­æ€§ã€‚åœ¨åŠŸèƒ½ä¸Šï¼Œç›‘è§†å™¨é”æ¯” volatile æ›´å¼ºå¤§ï¼›åœ¨å¯ä¼¸ç¼©æ€§å’Œæ‰§è¡Œæ€§èƒ½ä¸Šï¼Œvolatile æ›´æœ‰ä¼˜åŠ¿ã€‚å¦‚æœæƒ³åœ¨ç¨‹åºä¸­ç”¨ volatile ä»£æ›¿ç›‘è§†å™¨é”ï¼Œè¯·ä¸€å®šè°¨æ…ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå†…å­˜æ¨¡å‹-åŸºç¡€å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fd4946f29.html</url>
    <content type="text"><![CDATA[å¹¶å‘ç¼–ç¨‹æ¨¡å‹åˆ†ç±» åœ¨å¹¶å‘ç¼–ç¨‹ä¸­ï¼Œéœ€è¦å¤„ç†ä¸¤ä¸ªå…³é”®é—®é¢˜ï¼šçº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡åŠçº¿ç¨‹ä¹‹é—´å¦‚ä½•åŒæ­¥ï¼ˆè¿™é‡Œçš„çº¿ç¨‹æ˜¯æŒ‡å¹¶å‘æ‰§è¡Œçš„æ´»åŠ¨å®ä½“ï¼‰ã€‚é€šä¿¡æ˜¯æŒ‡çº¿ç¨‹ä¹‹é—´ä»¥ä½•ç§æœºåˆ¶æ¥äº¤æ¢ä¿¡æ¯ã€‚åœ¨å‘½ä»¤å¼ç¼–ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æœºåˆ¶æœ‰ä¸¤ç§ï¼šå…±äº«å†…å­˜å’Œæ¶ˆæ¯ä¼ é€’ã€‚ åœ¨å…±äº«å†…å­˜çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´å…±äº«ç¨‹åºçš„å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´é€šè¿‡å†™ - è¯»å†…å­˜ä¸­çš„å…¬å…±çŠ¶æ€æ¥éšå¼è¿›è¡Œé€šä¿¡ã€‚åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œçº¿ç¨‹ä¹‹é—´æ²¡æœ‰å…¬å…±çŠ¶æ€ï¼Œçº¿ç¨‹ä¹‹é—´å¿…é¡»é€šè¿‡æ˜ç¡®çš„å‘é€æ¶ˆæ¯æ¥æ˜¾å¼è¿›è¡Œé€šä¿¡ã€‚ åŒæ­¥æ˜¯æŒ‡ç¨‹åºç”¨äºæ§åˆ¶ä¸åŒçº¿ç¨‹ä¹‹é—´æ“ä½œå‘ç”Ÿç›¸å¯¹é¡ºåºçš„æœºåˆ¶ã€‚åœ¨å…±äº«å†…å­˜å¹¶å‘æ¨¡å‹é‡Œï¼ŒåŒæ­¥æ˜¯æ˜¾å¼è¿›è¡Œçš„ã€‚ç¨‹åºå‘˜å¿…é¡»æ˜¾å¼æŒ‡å®šæŸä¸ªæ–¹æ³•æˆ–æŸæ®µä»£ç éœ€è¦åœ¨çº¿ç¨‹ä¹‹é—´äº’æ–¥æ‰§è¡Œã€‚åœ¨æ¶ˆæ¯ä¼ é€’çš„å¹¶å‘æ¨¡å‹é‡Œï¼Œç”±äºæ¶ˆæ¯çš„å‘é€å¿…é¡»åœ¨æ¶ˆæ¯çš„æ¥æ”¶ä¹‹å‰ï¼Œå› æ­¤åŒæ­¥æ˜¯éšå¼è¿›è¡Œçš„ã€‚ Java çš„å¹¶å‘é‡‡ç”¨çš„æ˜¯å…±äº«å†…å­˜æ¨¡å‹ï¼ŒJava çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ€»æ˜¯éšå¼è¿›è¡Œï¼Œæ•´ä¸ªé€šä¿¡è¿‡ç¨‹å¯¹ç¨‹åºå‘˜å®Œå…¨é€æ˜ã€‚ Javaå†…å­˜æ¨¡å‹çš„æŠ½è±¡ Java çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ç”± Java å†…å­˜æ¨¡å‹ï¼ˆç®€ç§°ä¸º JMMï¼‰æ§åˆ¶ï¼ŒJMM å†³å®šä¸€ä¸ªçº¿ç¨‹å¯¹å…±äº«å˜é‡çš„å†™å…¥ä½•æ—¶å¯¹å¦ä¸€ä¸ªçº¿ç¨‹å¯è§ã€‚ä»æŠ½è±¡çš„è§’åº¦æ¥çœ‹ï¼ŒJMM å®šä¹‰äº†çº¿ç¨‹å’Œä¸»å†…å­˜ä¹‹é—´çš„æŠ½è±¡å…³ç³»ï¼šçº¿ç¨‹ä¹‹é—´çš„å…±äº«å˜é‡å­˜å‚¨åœ¨ä¸»å†…å­˜ï¼ˆmain memoryï¼‰ä¸­ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªç§æœ‰çš„æœ¬åœ°å†…å­˜ï¼ˆlocal memoryï¼‰ï¼Œæœ¬åœ°å†…å­˜ä¸­å­˜å‚¨äº†è¯¥çº¿ç¨‹ä»¥è¯» / å†™å…±äº«å˜é‡çš„å‰¯æœ¬ã€‚æœ¬åœ°å†…å­˜æ˜¯ JMM çš„ä¸€ä¸ªæŠ½è±¡æ¦‚å¿µï¼Œå¹¶ä¸çœŸå®å­˜åœ¨ã€‚å®ƒæ¶µç›–äº†ç¼“å­˜ï¼Œå†™ç¼“å†²åŒºï¼Œå¯„å­˜å™¨ä»¥åŠå…¶ä»–çš„ç¡¬ä»¶å’Œç¼–è¯‘å™¨ä¼˜åŒ–ã€‚Java å†…å­˜æ¨¡å‹çš„æŠ½è±¡ç¤ºæ„å›¾å¦‚ä¸‹ï¼š ä»ä¸Šå›¾æ¥çœ‹ï¼Œçº¿ç¨‹ A ä¸çº¿ç¨‹ B ä¹‹é—´å¦‚è¦é€šä¿¡çš„è¯ï¼Œå¿…é¡»è¦ç»å†2ä¸ªæ­¥éª¤ï¼š é¦–å…ˆï¼Œçº¿ç¨‹ A æŠŠæœ¬åœ°å†…å­˜ A ä¸­æ›´æ–°è¿‡çš„å…±äº«å˜é‡åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­å»ã€‚ ç„¶åï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹ A ä¹‹å‰å·²æ›´æ–°è¿‡çš„å…±äº«å˜é‡ã€‚ ä¸‹é¢é€šè¿‡ç¤ºæ„å›¾æ¥è¯´æ˜è¿™ä¸¤ä¸ªæ­¥éª¤ï¼š å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæœ¬åœ°å†…å­˜ A å’Œ B æœ‰ä¸»å†…å­˜ä¸­å…±äº«å˜é‡ x çš„å‰¯æœ¬ã€‚å‡è®¾åˆå§‹æ—¶ï¼Œè¿™ä¸‰ä¸ªå†…å­˜ä¸­çš„ x å€¼éƒ½ä¸º 0ã€‚çº¿ç¨‹ A åœ¨æ‰§è¡Œæ—¶ï¼ŒæŠŠæ›´æ–°åçš„ x å€¼ï¼ˆå‡è®¾å€¼ä¸º 1ï¼‰ä¸´æ—¶å­˜æ”¾åœ¨è‡ªå·±çš„æœ¬åœ°å†…å­˜ A ä¸­ã€‚å½“çº¿ç¨‹ A å’Œçº¿ç¨‹ B éœ€è¦é€šä¿¡æ—¶ï¼Œçº¿ç¨‹ A é¦–å…ˆä¼šæŠŠè‡ªå·±æœ¬åœ°å†…å­˜ä¸­ä¿®æ”¹åçš„ x å€¼åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œæ­¤æ—¶ä¸»å†…å­˜ä¸­çš„ x å€¼å˜ä¸ºäº† 1ã€‚éšåï¼Œçº¿ç¨‹ B åˆ°ä¸»å†…å­˜ä¸­å»è¯»å–çº¿ç¨‹ A æ›´æ–°åçš„ x å€¼ï¼Œæ­¤æ—¶çº¿ç¨‹ B çš„æœ¬åœ°å†…å­˜çš„ x å€¼ä¹Ÿå˜ä¸ºäº† 1ã€‚ ä»æ•´ä½“æ¥çœ‹ï¼Œè¿™ä¸¤ä¸ªæ­¥éª¤å®è´¨ä¸Šæ˜¯çº¿ç¨‹ A åœ¨å‘çº¿ç¨‹ B å‘é€æ¶ˆæ¯ï¼Œè€Œä¸”è¿™ä¸ªé€šä¿¡è¿‡ç¨‹å¿…é¡»è¦ç»è¿‡ä¸»å†…å­˜ã€‚JMM é€šè¿‡æ§åˆ¶ä¸»å†…å­˜ä¸æ¯ä¸ªçº¿ç¨‹çš„æœ¬åœ°å†…å­˜ä¹‹é—´çš„äº¤äº’ï¼Œæ¥ä¸º java ç¨‹åºå‘˜æä¾›å†…å­˜å¯è§æ€§ä¿è¯ã€‚ æŒ‡ä»¤é‡æ’åº åœ¨æ‰§è¡Œç¨‹åºæ—¶ä¸ºäº†æé«˜æ€§èƒ½ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤åšé‡æ’åºã€‚é‡æ’åºåˆ†ä¸‰ç§ç±»å‹ï¼š ç¼–è¯‘å™¨ä¼˜åŒ–çš„é‡æ’åºã€‚ç¼–è¯‘å™¨åœ¨ä¸æ”¹å˜å•çº¿ç¨‹ç¨‹åºè¯­ä¹‰çš„å‰æä¸‹ï¼Œå¯ä»¥é‡æ–°å®‰æ’è¯­å¥çš„æ‰§è¡Œé¡ºåºã€‚ æŒ‡ä»¤çº§å¹¶è¡Œçš„é‡æ’åºã€‚ç°ä»£å¤„ç†å™¨é‡‡ç”¨äº†æŒ‡ä»¤çº§å¹¶è¡ŒæŠ€æœ¯ï¼ˆInstruction-Level Parallelismï¼Œ ILPï¼‰æ¥å°†å¤šæ¡æŒ‡ä»¤é‡å æ‰§è¡Œã€‚å¦‚æœä¸å­˜åœ¨æ•°æ®ä¾èµ–æ€§ï¼Œå¤„ç†å™¨å¯ä»¥æ”¹å˜è¯­å¥å¯¹åº”æœºå™¨æŒ‡ä»¤çš„æ‰§è¡Œé¡ºåºã€‚ å†…å­˜ç³»ç»Ÿçš„é‡æ’åºã€‚ç”±äºå¤„ç†å™¨ä½¿ç”¨ç¼“å­˜å’Œè¯» / å†™ç¼“å†²åŒºï¼Œè¿™ä½¿å¾—åŠ è½½å’Œå­˜å‚¨æ“ä½œçœ‹ä¸Šå»å¯èƒ½æ˜¯åœ¨ä¹±åºæ‰§è¡Œã€‚ ä¸Šè¿°çš„1å±äºç¼–è¯‘å™¨é‡æ’åºï¼Œ2 å’Œ 3å±äºå¤„ç†å™¨é‡æ’åºã€‚è¿™äº›é‡æ’åºéƒ½å¯èƒ½ä¼šå¯¼è‡´å¤šçº¿ç¨‹ç¨‹åºå‡ºç°å†…å­˜å¯è§æ€§é—®é¢˜ã€‚å¯¹äºç¼–è¯‘å™¨ï¼ŒJMM çš„ç¼–è¯‘å™¨é‡æ’åºè§„åˆ™ä¼šç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„ç¼–è¯‘å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚å¯¹äºå¤„ç†å™¨é‡æ’åºï¼ŒJMM çš„å¤„ç†å™¨é‡æ’åºè§„åˆ™ä¼šè¦æ±‚ java ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—æ—¶ï¼Œæ’å…¥ç‰¹å®šç±»å‹çš„å†…å­˜å±éšœï¼ˆmemory barriersï¼Œintel ç§°ä¹‹ä¸º memory fenceï¼‰æŒ‡ä»¤ï¼Œé€šè¿‡å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºï¼ˆä¸æ˜¯æ‰€æœ‰çš„å¤„ç†å™¨é‡æ’åºéƒ½è¦ç¦æ­¢ï¼‰ã€‚ JMM å±äºè¯­è¨€çº§çš„å†…å­˜æ¨¡å‹ï¼Œå®ƒç¡®ä¿åœ¨ä¸åŒçš„ç¼–è¯‘å™¨å’Œä¸åŒçš„å¤„ç†å™¨å¹³å°ä¹‹ä¸Šï¼Œé€šè¿‡ç¦æ­¢ç‰¹å®šç±»å‹çš„ç¼–è¯‘å™¨é‡æ’åºå’Œå¤„ç†å™¨é‡æ’åºï¼Œä¸ºç¨‹åºå‘˜æä¾›ä¸€è‡´çš„å†…å­˜å¯è§æ€§ä¿è¯ã€‚ å†…å­˜å±éšœæŒ‡ä»¤ ç°ä»£çš„å¤„ç†å™¨ä½¿ç”¨å†™ç¼“å†²åŒºæ¥ä¸´æ—¶ä¿å­˜å‘å†…å­˜å†™å…¥çš„æ•°æ®ã€‚å†™ç¼“å†²åŒºå¯ä»¥ä¿è¯æŒ‡ä»¤æµæ°´çº¿æŒç»­è¿è¡Œï¼Œå®ƒå¯ä»¥é¿å…ç”±äºå¤„ç†å™¨åœé¡¿ä¸‹æ¥ç­‰å¾…å‘å†…å­˜å†™å…¥æ•°æ®è€Œäº§ç”Ÿçš„å»¶è¿Ÿã€‚åŒæ—¶ï¼Œé€šè¿‡ä»¥æ‰¹å¤„ç†çš„æ–¹å¼åˆ·æ–°å†™ç¼“å†²åŒºï¼Œä»¥åŠåˆå¹¶å†™ç¼“å†²åŒºä¸­å¯¹åŒä¸€å†…å­˜åœ°å€çš„å¤šæ¬¡å†™ï¼Œå¯ä»¥å‡å°‘å¯¹å†…å­˜æ€»çº¿çš„å ç”¨ã€‚è™½ç„¶å†™ç¼“å†²åŒºæœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œä½†æ¯ä¸ªå¤„ç†å™¨ä¸Šçš„å†™ç¼“å†²åŒºï¼Œä»…ä»…å¯¹å®ƒæ‰€åœ¨çš„å¤„ç†å™¨å¯è§ã€‚è¿™ä¸ªç‰¹æ€§ä¼šå¯¹å†…å­˜æ“ä½œçš„æ‰§è¡Œé¡ºåºäº§ç”Ÿé‡è¦çš„å½±å“ï¼šå¤„ç†å™¨å¯¹å†…å­˜çš„è¯» / å†™æ“ä½œçš„æ‰§è¡Œé¡ºåºï¼Œä¸ä¸€å®šä¸å†…å­˜å®é™…å‘ç”Ÿçš„è¯» / å†™æ“ä½œé¡ºåºä¸€è‡´ï¼å¦‚ä¸‹ç¤ºä¾‹ï¼š ProcessorA ProcessorB a = 1; //A1x = b; //A2 b = 2; //B1y = a; //B2 åˆå§‹çŠ¶æ€ï¼ša = b = 0å¤„ç†å™¨å…è®¸å¾—åˆ°ç»“æœï¼šx = y = 0 å‡è®¾å¤„ç†å™¨ A å’Œå¤„ç†å™¨ B æŒ‰ç¨‹åºçš„é¡ºåºå¹¶è¡Œæ‰§è¡Œå†…å­˜è®¿é—®ï¼Œæœ€ç»ˆå´å¯èƒ½å¾—åˆ° x = y = 0 çš„ç»“æœã€‚å…·ä½“çš„åŸå› å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š è¿™é‡Œå¤„ç†å™¨ A å’Œå¤„ç†å™¨ B å¯ä»¥åŒæ—¶æŠŠå…±äº«å˜é‡å†™å…¥è‡ªå·±çš„å†™ç¼“å†²åŒºï¼ˆA1ï¼ŒB1ï¼‰ï¼Œç„¶åä»å†…å­˜ä¸­è¯»å–å¦ä¸€ä¸ªå…±äº«å˜é‡ï¼ˆA2ï¼ŒB2ï¼‰ï¼Œæœ€åæ‰æŠŠè‡ªå·±å†™ç¼“å­˜åŒºä¸­ä¿å­˜çš„è„æ•°æ®åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆA3ï¼ŒB3ï¼‰ã€‚å½“ä»¥è¿™ç§æ—¶åºæ‰§è¡Œæ—¶ï¼Œç¨‹åºå°±å¯ä»¥å¾—åˆ° x = y = 0 çš„ç»“æœã€‚ ä»å†…å­˜æ“ä½œå®é™…å‘ç”Ÿçš„é¡ºåºæ¥çœ‹ï¼Œç›´åˆ°å¤„ç†å™¨ A æ‰§è¡Œ A3 æ¥åˆ·æ–°è‡ªå·±çš„å†™ç¼“å­˜åŒºï¼Œå†™æ“ä½œ A1 æ‰ç®—çœŸæ­£æ‰§è¡Œäº†ã€‚è™½ç„¶å¤„ç†å™¨ A æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºä¸ºï¼šA1-&gt;A2ï¼Œä½†å†…å­˜æ“ä½œå®é™…å‘ç”Ÿçš„é¡ºåºå´æ˜¯ï¼šA2-&gt;A1ã€‚æ­¤æ—¶ï¼Œå¤„ç†å™¨ A çš„å†…å­˜æ“ä½œé¡ºåºè¢«é‡æ’åºäº†ï¼ˆå¤„ç†å™¨ B çš„æƒ…å†µå’Œå¤„ç†å™¨ A ä¸€æ ·ï¼‰ã€‚ è¿™é‡Œçš„å…³é”®æ˜¯ï¼Œç”±äºå†™ç¼“å†²åŒºä»…å¯¹è‡ªå·±çš„å¤„ç†å™¨å¯è§ï¼Œå®ƒä¼šå¯¼è‡´å¤„ç†å™¨æ‰§è¡Œå†…å­˜æ“ä½œçš„é¡ºåºå¯èƒ½ä¼šä¸å†…å­˜å®é™…çš„æ“ä½œæ‰§è¡Œé¡ºåºä¸ä¸€è‡´ã€‚ç”±äºç°ä»£çš„å¤„ç†å™¨éƒ½ä¼šä½¿ç”¨å†™ç¼“å†²åŒºï¼Œå› æ­¤ç°ä»£çš„å¤„ç†å™¨éƒ½ä¼šå…è®¸å¯¹å†™ - è¯»æ“åšé‡æ’åºã€‚ ä¸‹é¢æ˜¯å¸¸è§å¤„ç†å™¨å…è®¸çš„é‡æ’åºç±»å‹çš„åˆ—è¡¨ï¼š Load-Load Load-Store Store-Store Store-Load æ•°æ®ä¾èµ– sparc-TSO N N N Y N x86 N N N Y N ia64 N N N Y N PowerPC N N N Y N ä¸Šè¡¨å•å…ƒæ ¼ä¸­çš„â€œNâ€è¡¨ç¤ºå¤„ç†å™¨ä¸å…è®¸ä¸¤ä¸ªæ“ä½œé‡æ’åºï¼Œâ€œYâ€è¡¨ç¤ºå…è®¸é‡æ’åºã€‚å¸¸è§çš„å¤„ç†å™¨éƒ½å…è®¸ Store-Load é‡æ’åºï¼›å¸¸è§çš„å¤„ç†å™¨éƒ½ä¸å…è®¸å¯¹å­˜åœ¨æ•°æ®ä¾èµ–çš„æ“ä½œåšé‡æ’åºã€‚sparc-TSO å’Œ x86 æ‹¥æœ‰ç›¸å¯¹è¾ƒå¼ºçš„å¤„ç†å™¨å†…å­˜æ¨¡å‹ï¼Œå®ƒä»¬ä»…å…è®¸å¯¹å†™ - è¯»æ“ä½œåšé‡æ’åºï¼ˆå› ä¸ºå®ƒä»¬éƒ½ä½¿ç”¨äº†å†™ç¼“å†²åŒºï¼‰ã€‚ ä¸ºäº†ä¿è¯å†…å­˜å¯è§æ€§ï¼Œjava ç¼–è¯‘å™¨åœ¨ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„é€‚å½“ä½ç½®ä¼šæ’å…¥å†…å­˜å±éšœæŒ‡ä»¤æ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„å¤„ç†å™¨é‡æ’åºã€‚JMM æŠŠå†…å­˜å±éšœæŒ‡ä»¤åˆ†ä¸ºä¸‹åˆ—å››ç±»ï¼š å±éšœç±»å‹ æŒ‡ä»¤ç¤ºä¾‹ è¯´æ˜ LoadLoad Barriers Load1; LoadLoad; Load2 ç¡®ä¿ Load1 æ•°æ®çš„è£…è½½ï¼Œä¹‹å‰äº Load2 åŠæ‰€æœ‰åç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚ StoreStore Barriers Store1; StoreStore; Store2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å¯è§ï¼ˆåˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äº Store2 åŠæ‰€æœ‰åç»­å­˜å‚¨æŒ‡ä»¤çš„å­˜å‚¨ã€‚ LoadStore Barriers Load1; LoadStore; Store2 ç¡®ä¿ Load1 æ•°æ®è£…è½½ï¼Œä¹‹å‰äº Store2 åŠæ‰€æœ‰åç»­çš„å­˜å‚¨æŒ‡ä»¤åˆ·æ–°åˆ°å†…å­˜ã€‚ StoreLoad Barriers Store1; StoreLoad; Load2 ç¡®ä¿ Store1 æ•°æ®å¯¹å…¶ä»–å¤„ç†å™¨å˜å¾—å¯è§ï¼ˆæŒ‡åˆ·æ–°åˆ°å†…å­˜ï¼‰ï¼Œä¹‹å‰äº Load2 åŠæ‰€æœ‰åç»­è£…è½½æŒ‡ä»¤çš„è£…è½½ã€‚StoreLoad Barriers ä¼šä½¿è¯¥å±éšœä¹‹å‰çš„æ‰€æœ‰å†…å­˜è®¿é—®æŒ‡ä»¤ï¼ˆå­˜å‚¨å’Œè£…è½½æŒ‡ä»¤ï¼‰å®Œæˆä¹‹åï¼Œæ‰æ‰§è¡Œè¯¥å±éšœä¹‹åçš„å†…å­˜è®¿é—®æŒ‡ä»¤ã€‚ StoreLoad Barriers æ˜¯ä¸€ä¸ªâ€œå…¨èƒ½å‹â€çš„å±éšœï¼Œå®ƒåŒæ—¶å…·æœ‰å…¶ä»–ä¸‰ä¸ªå±éšœçš„æ•ˆæœã€‚ç°ä»£çš„å¤šå¤„ç†å™¨å¤§éƒ½æ”¯æŒè¯¥å±éšœï¼ˆå…¶ä»–ç±»å‹çš„å±éšœä¸ä¸€å®šè¢«æ‰€æœ‰å¤„ç†å™¨æ”¯æŒï¼‰ã€‚æ‰§è¡Œè¯¥å±éšœå¼€é”€ä¼šå¾ˆæ˜‚è´µï¼Œå› ä¸ºå½“å‰å¤„ç†å™¨é€šå¸¸è¦æŠŠå†™ç¼“å†²åŒºä¸­çš„æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°å†…å­˜ä¸­ï¼ˆbuffer fully flushï¼‰ã€‚ happens-before ä» JDK5 å¼€å§‹ï¼Œjava ä½¿ç”¨æ–°çš„ JSR -133 å†…å­˜æ¨¡å‹ï¼ŒJSR-133 æå‡ºäº† happens-before çš„æ¦‚å¿µï¼Œé€šè¿‡è¿™ä¸ªæ¦‚å¿µæ¥é˜è¿°æ“ä½œä¹‹é—´çš„å†…å­˜å¯è§æ€§ã€‚å¦‚æœä¸€ä¸ªæ“ä½œæ‰§è¡Œçš„ç»“æœéœ€è¦å¯¹å¦ä¸€ä¸ªæ“ä½œå¯è§ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ“ä½œä¹‹é—´å¿…é¡»å­˜åœ¨ happens-before å…³ç³»ã€‚è¿™é‡Œæåˆ°çš„ä¸¤ä¸ªæ“ä½œæ—¢å¯ä»¥æ˜¯åœ¨ä¸€ä¸ªçº¿ç¨‹ä¹‹å†…ï¼Œä¹Ÿå¯ä»¥æ˜¯åœ¨ä¸åŒçº¿ç¨‹ä¹‹é—´ã€‚ ä¸ç¨‹åºå‘˜å¯†åˆ‡ç›¸å…³çš„ happens-before è§„åˆ™å¦‚ä¸‹ï¼š ç¨‹åºé¡ºåºè§„åˆ™ï¼šä¸€ä¸ªçº¿ç¨‹ä¸­çš„æ¯ä¸ªæ“ä½œï¼Œhappens- before äºè¯¥çº¿ç¨‹ä¸­çš„ä»»æ„åç»­æ“ä½œã€‚ ç›‘è§†å™¨é”è§„åˆ™ï¼šå¯¹ä¸€ä¸ªç›‘è§†å™¨é”çš„è§£é”ï¼Œhappens- before äºéšåå¯¹è¿™ä¸ªç›‘è§†å™¨é”çš„åŠ é”ã€‚ volatile å˜é‡è§„åˆ™ï¼šå¯¹ä¸€ä¸ª volatile åŸŸçš„å†™ï¼Œhappens- before äºä»»æ„åç»­å¯¹è¿™ä¸ª volatile åŸŸçš„è¯»ã€‚ ä¼ é€’æ€§ï¼šå¦‚æœ A happens- before Bï¼Œä¸” B happens- before Cï¼Œé‚£ä¹ˆ A happens- before Cã€‚ æ³¨æ„ï¼šä¸¤ä¸ªæ“ä½œä¹‹é—´å…·æœ‰ happens-before å…³ç³»ï¼Œå¹¶ä¸æ„å‘³ç€å‰ä¸€ä¸ªæ“ä½œå¿…é¡»è¦åœ¨åä¸€ä¸ªæ“ä½œä¹‹å‰æ‰§è¡Œï¼happens-before ä»…ä»…è¦æ±‚å‰ä¸€ä¸ªæ“ä½œï¼ˆæ‰§è¡Œçš„ç»“æœï¼‰å¯¹åä¸€ä¸ªæ“ä½œå¯è§ï¼Œä¸”å‰ä¸€ä¸ªæ“ä½œæŒ‰é¡ºåºæ’åœ¨ç¬¬äºŒä¸ªæ“ä½œä¹‹å‰ï¼ˆthe first is visible to and ordered before the secondï¼‰ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œä¸€ä¸ª happens-before è§„åˆ™é€šå¸¸å¯¹åº”äºå¤šä¸ªç¼–è¯‘å™¨é‡æ’åºè§„åˆ™å’Œå¤„ç†å™¨é‡æ’åºè§„åˆ™ã€‚å¯¹äº java ç¨‹åºå‘˜æ¥è¯´ï¼Œhappens-before è§„åˆ™ç®€å•æ˜“æ‡‚ï¼Œå®ƒé¿å…ç¨‹åºå‘˜ä¸ºäº†ç†è§£ JMM æä¾›çš„å†…å­˜å¯è§æ€§ä¿è¯è€Œå»å­¦ä¹ å¤æ‚çš„é‡æ’åºè§„åˆ™ä»¥åŠè¿™äº›è§„åˆ™çš„å…·ä½“å®ç°ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>JMM</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>JMM</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-07ä¹‹-çº¿ç¨‹ä¼‘çœ ]]></title>
    <url>%2Fposts%2Fc0fad076.html</url>
    <content type="text"><![CDATA[sleep()ä»‹ç» sleep() çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ä¼‘çœ ï¼Œå³å½“å‰çº¿ç¨‹ä¼šä»â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡)çŠ¶æ€â€ã€‚sleep()ä¼šæŒ‡å®šä¼‘çœ æ—¶é—´ï¼Œçº¿ç¨‹ä¼‘çœ çš„æ—¶é—´ä¼šå¤§äº/ç­‰äºè¯¥ä¼‘çœ æ—¶é—´ï¼›åœ¨çº¿ç¨‹é‡æ–°è¢«å”¤é†’æ—¶ï¼Œå®ƒä¼šç”±â€œé˜»å¡çŠ¶æ€â€å˜æˆâ€œå°±ç»ªçŠ¶æ€â€ï¼Œä»è€Œç­‰å¾…cpuçš„è°ƒåº¦æ‰§è¡Œã€‚ sleep()ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233package main.java.com.study.thread.sleep;/** * @author: whb * @description: çº¿ç¨‹ä¼‘çœ æµ‹è¯• */public class SleepTest { public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); t1.start(); }}class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public synchronized void run() { try { for (int i = 0; i &lt; 10; i++) { System.out.printf("%s: %d\n", this.getName(), i); // ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œä¼‘çœ 100æ¯«ç§’ if (i % 4 == 0) { Thread.sleep(100); } } } catch (InterruptedException e) { e.printStackTrace(); } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t1: 0t1: 1t1: 2t1: 3t1: 4t1: 5t1: 6t1: 7t1: 8t1: 9 &lt;span id="inline-purple"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ç¨‹åºæ¯”è¾ƒç®€å•ï¼Œåœ¨ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨çº¿ç¨‹t1ã€‚t1å¯åŠ¨ä¹‹åï¼Œå½“t1ä¸­çš„è®¡ç®—ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œt1ä¼šé€šè¿‡Thread.sleep(100)ä¼‘çœ 100æ¯«ç§’ã€‚ sleep() ä¸ wait()çš„æ¯”è¾ƒ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œsleep()çš„ä½œç”¨æ˜¯ä¹Ÿæ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡)çŠ¶æ€â€ã€‚ä½†æ˜¯ï¼Œwait()ä¼šé‡Šæ”¾å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œsleep()åˆ™ä¸ä¼šé‡Šæ”¾é”ã€‚ ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºsleep()æ˜¯ä¸ä¼šé‡Šæ”¾é”çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.thread.sleep;/** * @author: whb * @description: wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œsleep()çš„ä½œç”¨æ˜¯ä¹Ÿæ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œä¼‘çœ (é˜»å¡)çŠ¶æ€â€ã€‚ * ä½†æ˜¯ï¼Œwait()ä¼šé‡Šæ”¾å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œsleep()åˆ™ä¸ä¼šé‡Šæ”¾é”ã€‚ */public class SleepLockTest { private static Object obj = new Object(); public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); } static class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { // è·å–objå¯¹è±¡çš„åŒæ­¥é” synchronized (obj) { try { for (int i = 0; i &lt; 10; i++) { System.out.printf("%s: %d\n", this.getName(), i); // ièƒ½è¢«4æ•´é™¤æ—¶ï¼Œä¼‘çœ 100æ¯«ç§’ if (i % 4 == 0) { Thread.sleep(100); } } } catch (InterruptedException e) { e.printStackTrace(); } } } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234567891011121314151617181920t1: 0t1: 1t1: 2t1: 3t1: 4t1: 5t1: 6t1: 7t1: 8t1: 9t2: 0t2: 1t2: 2t2: 3t2: 4t2: 5t2: 6t2: 7t2: 8t2: 9 &lt;span id="inline-purple"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2åœ¨run()ä¼šå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œå³synchronized(obj)ã€‚åœ¨t1è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å®ƒä¼šè°ƒç”¨Thread.sleep(100)ï¼›ä½†æ˜¯ï¼Œt2æ˜¯ä¸ä¼šè·å–cpuæ‰§è¡Œæƒçš„ã€‚å› ä¸ºï¼Œt1å¹¶æ²¡æœ‰é‡Šæ”¾â€œobjæ‰€æŒæœ‰çš„åŒæ­¥é”â€ï¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-å·¥å‚æ–¹æ³•æ¨¡å¼]]></title>
    <url>%2Fposts%2F89a20157.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œåˆç§°å·¥å‚æ¨¡å¼ã€å¤šæ€å·¥å‚æ¨¡å¼å’Œè™šæ‹Ÿæ„é€ å™¨æ¨¡å¼ï¼Œé€šè¿‡å®šä¹‰å·¥å‚çˆ¶ç±»è´Ÿè´£å®šä¹‰åˆ›å»ºå¯¹è±¡çš„å…¬å…±æ¥å£ï¼Œè€Œå­ç±»åˆ™è´Ÿè´£ç”Ÿæˆå…·ä½“çš„å¯¹è±¡ã€‚ ä¸»è¦ä½œç”¨ å°†ç±»çš„å®ä¾‹åŒ–ï¼ˆå…·ä½“äº§å“çš„åˆ›å»ºï¼‰å»¶è¿Ÿåˆ°å·¥å‚ç±»çš„å­ç±»ï¼ˆå…·ä½“å·¥å‚ï¼‰ä¸­å®Œæˆï¼Œå³ç”±å­ç±»æ¥å†³å®šåº”è¯¥å®ä¾‹åŒ–ï¼ˆåˆ›å»ºï¼‰å“ªä¸€ä¸ªç±»ã€‚ è§£å†³çš„é—®é¢˜ è§£å†³ç®€å•å·¥å‚æ¨¡å¼ä¸€æ—¦éœ€è¦ç”Ÿäº§æ–°äº§å“å°±éœ€è¦ä¿®æ”¹å·¥å‚ç±»çš„æ–¹æ³•é€»è¾‘ï¼Œè¿èƒŒäº†â€œå¼€æ”¾ - å…³é—­åŸåˆ™çš„ç¼ºç‚¹ã€‚ ä¹‹æ‰€ä»¥å¯ä»¥è§£å†³ç®€å•å·¥å‚çš„é—®é¢˜ï¼Œæ˜¯å› ä¸ºå·¥å‚æ–¹æ³•æ¨¡å¼æŠŠå…·ä½“äº§å“çš„åˆ›å»ºæ¨è¿Ÿåˆ°å·¥å‚ç±»çš„å­ç±»ï¼ˆå…·ä½“å·¥å‚ï¼‰ä¸­ï¼Œæ­¤æ—¶å·¥å‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼Œè€Œåªæ˜¯ç»™å‡ºå…·ä½“å·¥å‚å¿…é¡»å®ç°çš„æ¥å£ï¼Œè¿™æ ·å·¥å‚æ–¹æ³•æ¨¡å¼åœ¨æ·»åŠ æ–°äº§å“çš„æ—¶å€™å°±ä¸ä¿®æ”¹å·¥å‚ç±»é€»è¾‘è€Œæ˜¯æ·»åŠ æ–°çš„å·¥å‚å­ç±»ï¼Œç¬¦åˆå¼€æ”¾å°é—­åŸåˆ™ï¼Œå…‹æœäº†ç®€å•å·¥å‚æ¨¡å¼ä¸­ç¼ºç‚¹ æ¨¡å¼åŸç† UMLç±»å›¾ æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°å…·ä½“äº§å“çš„å…¬å…±æ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥å‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ æŠ½è±¡å·¥å‚ï¼ˆCreatorï¼‰ å…·ä½“å·¥å‚çš„çˆ¶ç±» æè¿°å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ å…·ä½“å·¥å‚ï¼ˆConcrete Creatorï¼‰ æŠ½è±¡å·¥å‚çš„å­ç±»ï¼› è¢«å¤–ç•Œè°ƒç”¨ æè¿°å…·ä½“å·¥å‚ï¼› å®ç°FactoryMethodå·¥å‚æ–¹æ³•åˆ›å»ºäº§å“çš„å®ä¾‹ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡å·¥å‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºæŠ½è±¡äº§å“ç±» ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå…·ä½“å·¥å‚ç±»ï¼ˆç»§æ‰¿æŠ½è±¡å·¥å‚ç±»ï¼‰ï¼Œå®šä¹‰åˆ›å»ºå¯¹åº”å…·ä½“äº§å“å®ä¾‹çš„æ–¹æ³•ï¼› å¤–ç•Œé€šè¿‡è°ƒç”¨å…·ä½“å·¥å‚ç±»çš„æ–¹æ³•ï¼Œä»è€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®ä¾‹ã€‚ æ¨¡å¼ä¼˜ç‚¹ æ›´ç¬¦åˆå¼€-é—­åŸåˆ™ï¼Œæ–°å¢ä¸€ç§äº§å“æ—¶ï¼Œåªéœ€è¦å¢åŠ ç›¸åº”çš„å…·ä½“äº§å“ç±»å’Œç›¸åº”çš„å·¥å‚å­ç±»å³å¯ã€‚ ç¬¦åˆå•ä¸€èŒè´£åŸåˆ™ï¼Œæ¯ä¸ªå…·ä½“å·¥å‚ç±»åªè´Ÿè´£åˆ›å»ºå¯¹åº”çš„äº§å“ã€‚ ä¸ä½¿ç”¨é™æ€å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚ æ¨¡å¼ç¼ºç‚¹ æ·»åŠ æ–°äº§å“æ—¶ï¼Œé™¤äº†å¢åŠ æ–°äº§å“ç±»å¤–ï¼Œè¿˜è¦æä¾›ä¸ä¹‹å¯¹åº”çš„å…·ä½“å·¥å‚ç±»ï¼Œç³»ç»Ÿç±»çš„ä¸ªæ•°å°†æˆå¯¹å¢åŠ ï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šå¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼›åŒæ—¶ï¼Œæœ‰æ›´å¤šçš„ç±»éœ€è¦ç¼–è¯‘å’Œè¿è¡Œï¼Œä¼šç»™ç³»ç»Ÿå¸¦æ¥ä¸€äº›é¢å¤–çš„å¼€é”€ï¼› ç”±äºè€ƒè™‘åˆ°ç³»ç»Ÿçš„å¯æ‰©å±•æ€§ï¼Œéœ€è¦å¼•å…¥æŠ½è±¡å±‚ï¼Œåœ¨å®¢æˆ·ç«¯ä»£ç ä¸­å‡ä½¿ç”¨æŠ½è±¡å±‚è¿›è¡Œå®šä¹‰ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„æŠ½è±¡æ€§å’Œç†è§£éš¾åº¦ï¼Œä¸”åœ¨å®ç°æ—¶å¯èƒ½éœ€è¦ç”¨åˆ°DOMã€åå°„ç­‰æŠ€æœ¯ï¼Œå¢åŠ äº†ç³»ç»Ÿçš„å®ç°éš¾åº¦ã€‚ è™½ç„¶ä¿è¯äº†å·¥å‚æ–¹æ³•å†…çš„å¯¹ä¿®æ”¹å…³é—­ï¼Œä½†å¯¹äºä½¿ç”¨å·¥å‚æ–¹æ³•çš„ç±»ï¼Œå¦‚æœè¦æ›´æ¢å¦å¤–ä¸€ç§äº§å“ï¼Œä»ç„¶éœ€è¦ä¿®æ”¹å®ä¾‹åŒ–çš„å…·ä½“å·¥å‚ç±»ï¼› ä¸€ä¸ªå…·ä½“å·¥å‚åªèƒ½åˆ›å»ºä¸€ç§å…·ä½“äº§å“ã€‚ åº”ç”¨åœºæ™¯ å½“ä¸€ä¸ªç±»ä¸çŸ¥é“å®ƒæ‰€éœ€è¦çš„å¯¹è±¡çš„ç±»æ—¶ åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå®¢æˆ·ç«¯ä¸éœ€è¦çŸ¥é“å…·ä½“äº§å“ç±»çš„ç±»åï¼Œåªéœ€è¦çŸ¥é“æ‰€å¯¹åº”çš„å·¥å‚å³å¯ï¼› å½“ä¸€ä¸ªç±»å¸Œæœ›é€šè¿‡å…¶å­ç±»æ¥æŒ‡å®šåˆ›å»ºå¯¹è±¡æ—¶ åœ¨å·¥å‚æ–¹æ³•æ¨¡å¼ä¸­ï¼Œå¯¹äºæŠ½è±¡å·¥å‚ç±»åªéœ€è¦æä¾›ä¸€ä¸ªåˆ›å»ºäº§å“çš„æ¥å£ï¼Œè€Œç”±å…¶å­ç±»æ¥ç¡®å®šå…·ä½“è¦åˆ›å»ºçš„å¯¹è±¡ï¼Œåˆ©ç”¨é¢å‘å¯¹è±¡çš„å¤šæ€æ€§å’Œé‡Œæ°ä»£æ¢åŸåˆ™ï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œå­ç±»å¯¹è±¡å°†è¦†ç›–çˆ¶ç±»å¯¹è±¡ï¼Œä»è€Œä½¿å¾—ç³»ç»Ÿæ›´å®¹æ˜“æ‰©å±•ã€‚ å°†åˆ›å»ºå¯¹è±¡çš„ä»»åŠ¡å§”æ‰˜ç»™å¤šä¸ªå·¥å‚å­ç±»ä¸­çš„æŸä¸€ä¸ªï¼Œå®¢æˆ·ç«¯åœ¨ä½¿ç”¨æ—¶å¯ä»¥æ— é¡»å…³å¿ƒæ˜¯å“ªä¸€ä¸ªå·¥å‚å­ç±»åˆ›å»ºäº§å“å­ç±»ï¼Œéœ€è¦æ—¶å†åŠ¨æ€æŒ‡å®šï¼Œå¯å°†å…·ä½“å·¥å‚ç±»çš„ç±»åå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶æˆ–æ•°æ®åº“ä¸­ã€‚ æ¨¡å¼ç¤ºä¾‹ ç¤ºä¾‹èƒŒæ™¯ ä»¥å¡‘æ–™åŠ å·¥å‚ä¸ºä¾‹ï¼Œç›®å‰åŠ å·¥å‚ä»…ç”Ÿäº§Aç±»äº§å“ï¼Œéšç€å®¢æˆ·éœ€æ±‚å˜åŒ–ï¼Œå®¢æˆ·éœ€è¦ç”Ÿäº§Bç±»äº§å“ï¼› ä½†æ˜¯æ”¹å˜åŸæœ‰å¡‘æ–™åŠ å·¥å‚çš„é…ç½®å’Œå˜åŒ–éå¸¸å›°éš¾ï¼Œå‡è®¾ä¸‹ä¸€æ¬¡å®¢æˆ·éœ€è¦å†å‘ç”Ÿå˜åŒ–ï¼Œå†æ¬¡æ”¹å˜å°†å¢åŠ éå¸¸å¤§çš„æˆæœ¬ï¼› æ‰€ä»¥é€šè¿‡ç½®åŠå¡‘æ–™åˆ†å‚Bæ¥ç”Ÿäº§Bç±»äº§å“ã€‚ æŠ½è±¡å·¥å‚ç±» 1234567891011121314package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: æŠ½è±¡å·¥å‚ç±»ï¼Œå®šä¹‰å…·ä½“å·¥å‚çš„å…¬å…±æ¥å£ */public abstract class Factory { /** * ç”Ÿäº§äº§å“ * * @return */ public abstract Product manuFacture();} æŠ½è±¡äº§å“ç±» 12345678910111213package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»ï¼Œå®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ */public abstract class Product { /** * å±•ç¤ºäº§å“ */ public abstract void show();} å…·ä½“äº§å“ç±» 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»Aï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ï¼Œå®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ProductA extends Product { @Override public void show() { System.out.println("ç”Ÿäº§äº†äº§å“A"); }}package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»B, å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ */public class ProductB extends Product { @Override public void show() { System.out.println("ç”Ÿäº§äº†äº§å“B"); }} å…·ä½“å·¥å‚ç±» 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“å·¥å‚ç±»Aï¼Œå®šä¹‰åˆ›å»ºå…·ä½“äº§å“çš„å®ä¾‹æ–¹æ³• */public class FactoryA extends Factory { @Override public Product manuFacture() { return new ProductA(); }}package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å…·ä½“å·¥å‚ç±»Bï¼Œå®šä¹‰åˆ›å»ºå…·ä½“äº§å“çš„å®ä¾‹æ–¹æ³• */public class FactoryB extends Factory { @Override public Product manuFacture() { return new ProductB(); }} å®¢æˆ·ç«¯è°ƒç”¨ 1234567891011121314151617package main.java.com.study.designPatterns.factory.method.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯è°ƒç”¨ */public class Client { public static void main(String[] args) { //å®¢æˆ·è¦äº§å“A FactoryA factoryA = new FactoryA(); factoryA.manuFacture().show(); //å®¢æˆ·è¦äº§å“B FactoryB factoryB = new FactoryB(); factoryB.manuFacture().show(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-ç®€å•å·¥å‚æ¨¡å¼]]></title>
    <url>%2Fposts%2Faac06fee.html</url>
    <content type="text"><![CDATA[æ¨¡å¼å®šä¹‰ ç®€å•å·¥å‚æ¨¡å¼(Simple Factory Pattern)ï¼šåˆç§°ä¸ºé™æ€å·¥å‚æ–¹æ³•(Static Factory Method)æ¨¡å¼ï¼Œå®ƒå±äºç±»åˆ›å»ºå‹æ¨¡å¼ã€‚æä¾›ä¸€ä¸ªåˆ›å»ºå¯¹è±¡å®ä¾‹çš„åŠŸèƒ½ï¼Œè€Œæ— éœ€å…³å¿ƒå…¶å…·ä½“å®ç°ã€‚è¢«åˆ›å»ºå®ä¾‹çš„ç±»å‹å¯ä»¥æ˜¯æ¥å£ã€æŠ½è±¡ç±»ï¼Œä¹Ÿå¯ä»¥æ˜¯å…·ä½“ç±»ã€‚ è§£å†³çš„é—®é¢˜ å°†â€œç±»å®ä¾‹åŒ–çš„æ“ä½œâ€ä¸â€œä½¿ç”¨å¯¹è±¡çš„æ“ä½œâ€åˆ†å¼€ï¼Œè®©ä½¿ç”¨è€…ä¸ç”¨çŸ¥é“å…·ä½“å‚æ•°å°±å¯ä»¥å®ä¾‹åŒ–å‡ºæ‰€éœ€è¦çš„â€œäº§å“â€ç±»ï¼Œä»è€Œé¿å…äº†åœ¨å®¢æˆ·ç«¯ä»£ç ä¸­æ˜¾å¼æŒ‡å®šï¼Œå®ç°äº†è§£è€¦ã€‚å³ä½¿ç”¨è€…å¯ç›´æ¥æ¶ˆè´¹äº§å“è€Œä¸éœ€è¦çŸ¥é“å…¶ç”Ÿäº§çš„ç»†èŠ‚ã€‚ é€‚ç”¨çš„ç¯å¢ƒ å·¥å‚ç±»åˆ›å»ºçš„å¯¹è±¡æ¯”è¾ƒå°ï¼Œè¿™æ ·ä¸ä¼šé€ æˆå·¥å‚æ–¹æ³•ä¸­ä¸šåŠ¡çš„é€»è¾‘è¿‡äºå¤æ‚ã€‚ å®¢æˆ·ç«¯åªæ˜¯çŸ¥é“ä¼ å…¥å·¥å‚ç±»çš„å‚æ•°ã€å¯¹äºå¦‚ä½•å»åˆ›å»ºå¯¹è±¡å¹¶ä¸å…³å¿ƒã€‚å®¢æˆ·ç«¯ä¸éœ€è¦å»å…³å¿ƒåˆ›å»ºçš„ç»†èŠ‚ï¼Œåªéœ€è¦æ˜ç¡®éœ€è¦çš„å‚æ•°ï¼Œè€Œç”±å·¥å‚å†…éƒ¨è´Ÿè´£å…·ä½“çš„ç±»çš„åˆ›å»ºã€‚ æ¨¡å¼åŸç† æ¨¡å¼ç»„æˆ ç»„æˆï¼ˆè§’è‰²ï¼‰ å…³ç³» ä½œç”¨ æŠ½è±¡äº§å“ï¼ˆProductï¼‰ å…·ä½“äº§å“çš„çˆ¶ç±» æè¿°äº§å“çš„å…¬å…±æ¥å£ å…·ä½“äº§å“ï¼ˆConcrete Productï¼‰ æŠ½è±¡äº§å“çš„å­ç±»ï¼› å·¥å‚ç±»åˆ›å»ºçš„ç›®æ ‡ç±» æè¿°ç”Ÿäº§çš„å…·ä½“äº§å“ å·¥å‚ï¼ˆCreatorï¼‰ è¢«å¤–ç•Œè°ƒç”¨ æ ¹æ®ä¼ å…¥ä¸åŒå‚æ•°ä»è€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®ä¾‹ UMLç±»å›¾ ä½¿ç”¨æ­¥éª¤ åˆ›å»ºæŠ½è±¡äº§å“ç±» &amp; å®šä¹‰å…·ä½“äº§å“çš„å…¬å…±æ¥å£ï¼› åˆ›å»ºå…·ä½“äº§å“ç±»ï¼ˆç»§æ‰¿æŠ½è±¡äº§å“ç±»ï¼‰ &amp; å®šä¹‰ç”Ÿäº§çš„å…·ä½“äº§å“ï¼› åˆ›å»ºå·¥å‚ç±»ï¼Œé€šè¿‡åˆ›å»ºé™æ€æ–¹æ³•æ ¹æ®ä¼ å…¥ä¸åŒå‚æ•°ä»è€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®ä¾‹ï¼› å¤–ç•Œé€šè¿‡è°ƒç”¨å·¥å‚ç±»çš„é™æ€æ–¹æ³•ï¼Œä¼ å…¥ä¸åŒå‚æ•°ä»è€Œåˆ›å»ºä¸åŒå…·ä½“äº§å“ç±»çš„å®ä¾‹ æ¨¡å¼ä¼˜ç‚¹ è´£ä»»åˆ†å‰²ï¼šå·¥å‚ç±»å«æœ‰å¤„ç†é€»è¾‘ï¼Œå†³å®šä½•æ—¶å»åˆ›å»ºäº§å“å¯¹è±¡ï¼Œå®¢æˆ·ç«¯åªæ˜¯éœ€è¦ä¼ é€’å¯¹åº”çš„å‚æ•°ï¼Œå³å¯ä»¥å®Œæˆäº§å“çš„åˆ›å»ºã€‚ åœ¨ä¸€å®šç¨‹åº¦ä¸Šæé«˜äº†ç³»ç»Ÿçš„çµæ´»æ€§ï¼šå¯ä»¥é€šè¿‡å¼•å…¥é…ç½®æ–‡ä»¶çš„æ–¹æ³•ï¼Œåœ¨ä¸å»ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹ï¼Œæ›´æ¢å’Œå¢å‡æ–°çš„äº§å“ã€‚ æ¨¡å¼ç¼ºç‚¹ å·¥å‚ç±»é›†ä¸­äº†æ‰€æœ‰å®ä¾‹ï¼ˆäº§å“ï¼‰çš„åˆ›å»ºé€»è¾‘ï¼Œä¸€æ—¦è¿™ä¸ªå·¥å‚ä¸èƒ½æ­£å¸¸å·¥ä½œï¼Œæ•´ä¸ªç³»ç»Ÿéƒ½ä¼šå—åˆ°å½±å“ã€‚ è¿èƒŒâ€œå¼€æ”¾ - å…³é—­åŸåˆ™â€ï¼Œä¸€æ—¦æ·»åŠ æ–°äº§å“å°±ä¸å¾—ä¸ä¿®æ”¹å·¥å‚ç±»çš„é€»è¾‘ï¼Œè¿™æ ·å°±ä¼šé€ æˆå·¥å‚é€»è¾‘è¿‡äºå¤æ‚ã€‚ ç®€å•å·¥å‚æ¨¡å¼ç”±äºä½¿ç”¨äº†é™æ€å·¥å‚æ–¹æ³•ï¼Œé™æ€æ–¹æ³•ä¸èƒ½è¢«ç»§æ‰¿å’Œé‡å†™ï¼Œä¼šé€ æˆå·¥å‚è§’è‰²æ— æ³•å½¢æˆåŸºäºç»§æ‰¿çš„ç­‰çº§ç»“æ„ã€‚ æ¨¡å¼åº”ç”¨ JDKç±»åº“ä¸­å¹¿æ³›ä½¿ç”¨äº†ç®€å•å·¥å‚æ¨¡å¼ï¼Œå¦‚å·¥å…·ç±»java.text.DateFormatï¼Œå®ƒç”¨äºæ ¼å¼åŒ–ä¸€ä¸ªæœ¬åœ°æ—¥æœŸæˆ–è€…æ—¶é—´ã€‚ 123public final static DateFormat getDateInstance(); public final static DateFormat getDateInstance(int style); public final static DateFormat getDateInstance(int style,Locale locale); è·å–ä¸åŒåŠ å¯†ç®—æ³•çš„å¯†é’¥ç”Ÿæˆå™¨ã€‚ 1KeyGenerator keyGen=KeyGenerator.getInstance("DESede"); æ¨¡å¼ç¤ºä¾‹ ä»¥ç”Ÿäº§ç”µè„‘ä¸ºä¾‹ï¼Œå‡è®¾æœ‰ä¸€ä¸ªç”µè„‘çš„ä»£å·¥ç”Ÿäº§å•†ï¼Œå®ƒç›®å‰å·²ç»å¯ä»¥ä»£å·¥ç”Ÿäº§è”æƒ³ç”µè„‘ï¼Œéšç€ä¸šåŠ¡çš„æ‹“å±•ï¼Œè¿™ä¸ªä»£å·¥ç”Ÿäº§å•†è¿˜è¦ç”Ÿäº§æƒ æ™®å’Œåç¡•çš„ç”µè„‘ï¼Œè¿™æ ·å°±éœ€è¦ç”¨ä¸€ä¸ªå•ç‹¬çš„ç±»æ¥ä¸“é—¨ç”Ÿäº§ç”µè„‘ï¼Œè¿™å°±ç”¨åˆ°äº†ç®€å•å·¥å‚æ¨¡å¼ã€‚ æŠ½è±¡äº§å“ç±» åˆ›å»ºä¸€ä¸ªç”µè„‘çš„æŠ½è±¡äº§å“ç±»ï¼Œä»–æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ç”¨äºå¯åŠ¨ç”µè„‘ç”Ÿäº§ï¼š 12345678910111213package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: æŠ½è±¡äº§å“ç±»ï¼šç”µè„‘ */public abstract class Computer { /** * äº§å“çš„æŠ½è±¡æ–¹æ³•ï¼Œç”±å…·ä½“çš„äº§å“å»å®ç° */ public abstract void startProduce();} å…·ä½“äº§å“ç±» æ¥ç€åˆ›å»ºå„ä¸ªå“ç‰Œçš„ç”µè„‘ï¼Œä»–ä»¬éƒ½ç»§æ‰¿äº†ä»–ä»¬çš„çˆ¶ç±»Computerï¼Œå¹¶å®ç°äº†çˆ¶ç±»çš„startProduceæ–¹æ³•ï¼š è”æƒ³ç”µè„‘ 12345678910111213package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šè”æƒ³ç”µè„‘ */public class LenovoComputer extends Computer { @Override public void startProduce() { System.out.println("è”æƒ³ç”µè„‘å¯åŠ¨ç”Ÿäº§"); }} æƒ æ™®ç”µè„‘ 123456789101112package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šæƒ æ™®ç”µè„‘ */public class HpComputer extends Computer { @Override public void startProduce() { System.out.println("æƒ æ™®ç”µè„‘å¯åŠ¨ç”Ÿäº§"); }} åç¡•ç”µè„‘ 123456789101112package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å…·ä½“äº§å“ç±»ï¼šåç¡•ç”µè„‘ */public class AsusComputer extends Computer{ @Override public void startProduce() { System.out.println("åç¡•ç”µè„‘å¯åŠ¨ç”Ÿäº§"); }} å·¥å‚ç±» æ¥ä¸‹æ¥åˆ›å»ºä¸€ä¸ªå·¥å‚ç±»ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•createComputerç”¨æ¥ç”Ÿäº§ç”µè„‘ã€‚ä½ åªéœ€è¦ä¼ å…¥ä½ æƒ³ç”Ÿäº§çš„ç”µè„‘çš„å“ç‰Œï¼Œå®ƒå°±ä¼šå®ä¾‹åŒ–ç›¸åº”å“ç‰Œçš„ç”µè„‘å¯¹è±¡ï¼š 123456789101112131415161718192021222324252627282930package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å·¥å‚ç±» */public class ComputerFactory { /** * ç”Ÿäº§ç”µè„‘ * * @param type * @return */ public static Computer createComputer(String type) { Computer computer = null; switch (type) { case "lenovo": computer = new LenovoComputer(); break; case "hp": computer = new HpComputer(); break; case "asus": computer = new AsusComputer(); break; } return computer; }} å®¢æˆ·ç«¯ å®¢æˆ·ç«¯è°ƒç”¨å·¥å‚ç±»ï¼Œä¼ å…¥â€œasusâ€ç”Ÿäº§å‡ºåç¡•ç”µè„‘å¹¶è°ƒç”¨è¯¥ç”µè„‘å¯¹è±¡çš„startProduceæ–¹æ³•ï¼š 1234567891011package main.java.com.study.designPatterns.simpleFactoryPattern.demoOne;/** * @author: whb * @description: å®¢æˆ·ç«¯ */public class Client { public static void main(String[] args) { ComputerFactory.createComputer("asus").startProduce(); }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-06ä¹‹-çº¿ç¨‹è®©æ­¥]]></title>
    <url>%2Fposts%2Fa8d456e8.html</url>
    <content type="text"><![CDATA[yield()ä»‹ç» &lt;p id="div-border-left-green"&gt; yield()çš„ä½œç”¨æ˜¯è®©æ­¥ã€‚å®ƒèƒ½è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»è€Œè®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹è·å–æ‰§è¡Œæƒï¼›ä½†æ˜¯ï¼Œå¹¶ä¸èƒ½ä¿è¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨yield()ä¹‹åï¼Œå…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹å°±ä¸€å®šèƒ½è·å¾—æ‰§è¡Œæƒï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å½“å‰çº¿ç¨‹åˆè¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€ç»§ç»­è¿è¡Œï¼ &lt;/p&gt; yield()ç¤ºä¾‹ 12345678910111213141516171819202122232425262728293031package main.java.com.study.thread.yield;/** * @author: whb * @description: yield()çš„ä½œç”¨æ˜¯è®©æ­¥ã€‚å®ƒèƒ½è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œä»è€Œè®©å…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„ç­‰å¾…çº¿ç¨‹è·å–æ‰§è¡Œæƒï¼›ä½†æ˜¯ï¼Œå¹¶ä¸èƒ½ä¿è¯åœ¨å½“å‰çº¿ç¨‹è°ƒç”¨yield()ä¹‹åï¼Œå…¶å®ƒå…·æœ‰ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹å°±ä¸€å®šèƒ½è·å¾—æ‰§è¡Œæƒï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯å½“å‰çº¿ç¨‹åˆè¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€ç»§ç»­è¿è¡Œï¼ */public class YieldTest { public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); }}class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public synchronized void run() { for (int i = 0; i &lt; 10; i++) { System.out.printf("%s [%d]:%d\n", this.getName(), this.getPriority(), i); // iæ•´é™¤4æ—¶ï¼Œè°ƒç”¨yield if (i % 4 == 0) { Thread.yield(); } } }} &lt;span id="inline-blue"&gt; (æŸä¸€æ¬¡çš„)è¿è¡Œç»“æœ: &lt;/span&gt; 1234567891011121314151617181920t1 [5]:0t2 [5]:0t1 [5]:1t1 [5]:2t1 [5]:3t1 [5]:4t1 [5]:5t1 [5]:6t1 [5]:7t1 [5]:8t1 [5]:9t2 [5]:1t2 [5]:2t2 [5]:3t2 [5]:4t2 [5]:5t2 [5]:6t2 [5]:7t2 [5]:8t2 [5]:9 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; â€œçº¿ç¨‹t1â€åœ¨èƒ½è¢«4æ•´æ•°çš„æ—¶å€™ï¼Œå¹¶æ²¡æœ‰åˆ‡æ¢åˆ°â€œçº¿ç¨‹t2â€ã€‚è¿™è¡¨æ˜ï¼Œyield()è™½ç„¶å¯ä»¥è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼›ä½†æ˜¯ï¼Œå®ƒä¸ä¸€å®šä¼šè®©å…¶å®ƒçº¿ç¨‹è·å–CPUæ‰§è¡Œæƒ(å³ï¼Œå…¶å®ƒçº¿ç¨‹è¿›å…¥åˆ°â€œè¿è¡ŒçŠ¶æ€â€)ï¼Œå³ä½¿è¿™ä¸ªâ€œå…¶å®ƒçº¿ç¨‹â€ä¸å½“å‰è°ƒç”¨yield()çš„çº¿ç¨‹å…·æœ‰ç›¸åŒçš„ä¼˜å…ˆçº§ã€‚ yield() ä¸ wait()çš„æ¯”è¾ƒ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œyield()çš„ä½œç”¨æ˜¯è®©æ­¥ï¼Œå®ƒä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹ç¦»å¼€â€œè¿è¡ŒçŠ¶æ€â€ã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š (01) wait()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œè€Œä¸yield()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ã€‚ (02) wait()æ˜¯ä¼šçº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œyield()æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”ã€‚ ä¸‹é¢é€šè¿‡ç¤ºä¾‹æ¼”ç¤ºyield()æ˜¯ä¸ä¼šé‡Šæ”¾é”çš„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839package main.java.com.study.thread.yield;/** * @author: whb * @description: wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€çš„åŒæ—¶ï¼Œä¹Ÿä¼šé‡Šæ”¾åŒæ­¥é”ã€‚è€Œyield()çš„ä½œç”¨æ˜¯è®©æ­¥ï¼Œå®ƒä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹ç¦»å¼€â€œè¿è¡ŒçŠ¶æ€â€ã€‚å®ƒä»¬çš„åŒºåˆ«æ˜¯ï¼š * (01) wait()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œè€Œä¸yield()æ˜¯è®©çº¿ç¨‹ç”±â€œè¿è¡ŒçŠ¶æ€â€è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ã€‚ * (02) wait()æ˜¯ä¼šçº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰å¯¹è±¡çš„åŒæ­¥é”ï¼Œè€Œyield()æ–¹æ³•ä¸ä¼šé‡Šæ”¾é”ã€‚ */public class YieldLockTest { private static Object obj = new Object(); public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); t1.start(); t2.start(); } static class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { // è·å–objå¯¹è±¡çš„åŒæ­¥é” synchronized (obj) { for (int i = 0; i &lt; 10; i++) { System.out.printf("%s [%d]:%d\n", this.getName(), this.getPriority(), i); // iæ•´é™¤4æ—¶ï¼Œè°ƒç”¨yield if (i % 4 == 0) { Thread.yield(); } } } } }} &lt;span id="inline-blue"&gt; (æŸä¸€æ¬¡)è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234567891011121314151617181920t1 [5]:0t1 [5]:1t1 [5]:2t1 [5]:3t1 [5]:4t1 [5]:5t1 [5]:6t1 [5]:7t1 [5]:8t1 [5]:9t2 [5]:0t2 [5]:1t2 [5]:2t2 [5]:3t2 [5]:4t2 [5]:5t2 [5]:6t2 [5]:7t2 [5]:8t2 [5]:9 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹mainä¸­å¯åŠ¨äº†ä¸¤ä¸ªçº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2åœ¨run()ä¼šå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œå³synchronized(obj)ã€‚åœ¨t1è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè™½ç„¶å®ƒä¼šè°ƒç”¨Thread.yield()ï¼›ä½†æ˜¯ï¼Œt2æ˜¯ä¸ä¼šè·å–cpuæ‰§è¡Œæƒçš„ã€‚å› ä¸ºï¼Œt1å¹¶æ²¡æœ‰é‡Šæ”¾â€œobjæ‰€æŒæœ‰çš„åŒæ­¥é”â€ï¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - æ¢³æ’åº]]></title>
    <url>%2Fposts%2F9d531ce3.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ æ¢³æ’åºå’Œå¸Œå°”æ’åºå¾ˆç±»ä¼¼ã€‚å¸Œå°”æ’åºæ˜¯åœ¨ç›´æ¥æ’å…¥æ’åºçš„åŸºç¡€ä¸Šåšçš„ä¼˜åŒ–ï¼Œè€Œæ¢³æ’åºæ˜¯åœ¨å†’æ³¡æ’åºçš„åŸºç¡€ä¸Šåšçš„ä¼˜åŒ–ã€‚ä¹Ÿæ˜¯åƒå¸Œå°”æ’åºä¸€æ ·ï¼Œå°†å¾…æ’åºåºåˆ—é€šè¿‡å¢é‡åˆ†ä¸ºè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œç„¶åå¯¹å­åºåˆ—è¿›è¡Œä¸€è¶Ÿå†’æ³¡æ’åºï¼Œä¸€æ­¥æ­¥å‡å°å¢é‡ï¼Œç›´è‡³å¢é‡ä¸º1ã€‚æ‰€ä»¥æ¢³æ’åºçš„æœ€åä¸€æ¬¡æ’åºæ˜¯å†’æ³¡æ’åºã€‚ æ¢³æ’åºå¢é‡æ˜¯æ ¹æ®é€’å‡ç‡å‡å°çš„ï¼Œé€’å‡ç‡çš„è®¾å®šå½±å“ç€æ¢³æ’åºçš„æ•ˆç‡ï¼ŒåŸä½œè€…ä»¥éšæœºæ•°ä½œå®éªŒï¼Œå¾—åˆ°æœ€æœ‰æ•ˆé€’å‡ç‡ä¸º1.3çš„ã€‚å› ä¸ºç¼–ç¨‹ä¸­ä¹˜æ³•æ¯”é™¤æ³•å¿«ï¼Œæ‰€ä»¥ä¼šå–é€’å‡ç‡çš„å€’æ•°ä¸é—´è·ç›¸ä¹˜ï¼Œå³0.8ã€‚å…¶å®å½“é—´è·ä¸º1çš„æ—¶å€™ï¼Œæ¢³æ’åºå°±æ˜¯å†’æ³¡æ’åºï¼Œè€Œé—´è·å¤§äº1çš„æ—¶å€™ï¼Œæ¢³æ’åºçš„å°±æ˜¯å°½é‡æŠŠå°çš„æ•°å­—å¾€å‰ç§»åŠ¨å¹¶ä¿è¯æ­¤æ¬¡é—´éš”å†…çš„ç»„æ˜¯æœ‰åºçš„ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå‡è®¾å¾…æ•°ç»„[10 4 3 9 6 5 2 1 7 8] å¾…æ’æ•°ç»„é•¿åº¦ä¸º10,è€Œ10Ã·1.3=8,åˆ™æ¯”è¾ƒ10å’Œ7,4å’Œ8,å¹¶åšäº¤æ¢ã€‚ äº¤æ¢åçš„ç»“æœä¸ºï¼š [7 4 3 9 6 5 2 1 10 8] ç¬¬äºŒæ¬¡å¾ªç¯,æ›´æ–°é—´è·ä¸º8Ã·1.3=6,æ¯”è¾ƒ7å’Œ2,4å’Œ1,3å’Œ10,9å’Œ8,7å’Œ2ï¼Œ4å’Œ1,9å’Œ8éœ€è¦äº¤æ¢ã€‚ äº¤æ¢åçš„ç»“æœä¸ºï¼š [2 1 3 8 6 5 7 4 10 9] ç¬¬ä¸‰æ¬¡å¾ªç¯,æ›´æ–°è·ç¦»ä¸º4,æ¯”è¾ƒ2å’Œ6,1å’Œ5,3å’Œ7,8å’Œ4,6å’Œ10,5å’Œ9,8å’Œ4éœ€è¦äº¤æ¢ã€‚ [2 1 3 4 6 5 7 8 10 9] ç¬¬å››æ¬¡å¾ªç¯,æ›´æ–°è·ç¦»ä¸º3,æ¯”è¾ƒ2å’Œ4,1å’Œ6,3å’Œ5,4å’Œ7,6å’Œ8,5å’Œ10,7å’Œ9ï¼Œä¸éœ€è¦äº¤æ¢ã€‚ ç¬¬äº”æ¬¡å¾ªç¯,æ›´æ–°è·ç¦»ä¸º2,æ¯”è¾ƒ2å’Œ3,1å’Œ4,3å’Œ6,4å’Œ5,6å’Œ7,5å’Œ8,7å’Œ10,8å’Œ9ï¼Œä¸éœ€è¦äº¤æ¢ã€‚ ç¬¬å…­æ¬¡å¾ªç¯ï¼Œæ›´æ–°è·ç¦»ä¸º1ï¼Œä¸ºå†’æ³¡æ’åºã€‚ [1 2 3 4 5 6 7 8 9 10] äº¤æ¢åæ’åºç»“æŸ,é¡ºåºè¾“å‡ºå³å¯å¾—åˆ°[1 2 3 4 5 6 7 8 9 10]ã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ¢³æ’åº */public class CombSort { /** * æ¢³æ’åº * * @param unsorted å¾…æ’åºåˆ— */ public static void combSort(int[] unsorted) { int gap = unsorted.length; boolean swapped = true; while (gap &gt; 1 || swapped) { if (gap &gt; 1) { gap = (int) (gap / 1.3); } int i = 0; swapped = false; while (i + gap &lt; unsorted.length) { if (unsorted[i] &gt; unsorted[i + gap]) { swap(unsorted, i, i + gap); swapped = true; } i++; } } } /** * æŒ‰ä»å°åˆ°å¤§çš„é¡ºåºäº¤æ¢æ•°ç»„ * * @param a ä¼ å…¥çš„æ•°ç»„ * @param b ä¼ å…¥çš„è¦äº¤æ¢çš„æ•°b * @param c ä¼ å…¥çš„è¦äº¤æ¢çš„æ•°c */ public static void swap(int[] a, int b, int c) { if (b == c) { return; } int temp = a[b]; a[b] = a[c]; a[c] = temp; } public static void main(String[] args) { int[] unsorted = {11, 95, 45, 15, 78, 84, 51, 24, 12}; System.out.println("**************æ¢³æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); combSort(unsorted); CommonUtils.display(unsorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - åœ°ç²¾æ’åº]]></title>
    <url>%2Fposts%2Fd703cb77.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å·ç§°æœ€ç®€å•çš„æ’åºç®—æ³•,åªæœ‰ä¸€å±‚å¾ªç¯,é»˜è®¤æƒ…å†µä¸‹å‰è¿›å†’æ³¡,ä¸€æ—¦é‡åˆ°å†’æ³¡çš„æƒ…å†µå‘ç”Ÿå°±å¾€å›å†’,ç›´åˆ°æŠŠè¿™ä¸ªæ•°å­—æ”¾å¥½ä¸ºæ­¢ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æ’æ•°ç»„[6 2 4 1 5 9]ã€‚ å…ˆè®¾è®¡ä¸€ä¸ªæ ‡è¯†i=0ç„¶åä»å¤´å¼€å§‹åˆ¤æ–­,ä»€ä¹ˆæ—¶å€™(i &lt; 6)ä¸æˆç«‹,ä»€ä¹ˆæ—¶å€™æ’åºç»“æŸã€‚ [6 2 4 1 5 9] [0 1 2 3 4 5] ä¸‹å…·ä½“çš„æ’åºè¿‡ç¨‹å¦‚ä¸‹ï¼š [ i = 0 ]æ—¶å•¥ä¹Ÿä¸å¹²,å…ˆè®©iè‡ªå¢1,è¾¾åˆ°å€¼ä¸º1æ‰å¼€å§‹çœŸæ­£çš„æ¯”è¾ƒã€‚ äº¤æ¢å‰[6 2 4 1 5 9][ i = 0] äº¤æ¢å[6 2 4 1 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ6å’Œ2,å‘ç”Ÿäº¤æ¢,åªè¦å‘ç”Ÿäº¤æ¢iå°±å‡1ã€‚ äº¤æ¢å‰[6 2 4 1 5 9][ i = 1] äº¤æ¢å[2 6 4 1 5 9][ i = 0] [ i = 0 ]åˆæˆ0äº†,å•¥ä¹Ÿä¸å¹²,è‡ªå¢å˜æˆ1å†è¯´ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 0] äº¤æ¢å[2 6 4 1 5 9][ i = 1] [ i = 1 ]å†æ¯”è¾ƒ2å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 1] äº¤æ¢å[2 6 4 1 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ6å’Œ4,å‘ç”Ÿäº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 6 4 1 5 9][ i = 2] äº¤æ¢å[2 4 6 1 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ2å’Œ4,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 1] äº¤æ¢å[2 4 6 1 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ4å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 2] äº¤æ¢å[2 4 6 1 5 9][ i = 3] [ i = 3 ]æ¯”è¾ƒ6å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 4 6 1 5 9][ i = 3] äº¤æ¢å[2 4 1 6 5 9][ i = 2] [ i = 2 ]æ¯”è¾ƒ4å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 4 1 6 5 9][ i = 2] äº¤æ¢å[2 1 4 6 5 9][ i = 1] [ i = 1 ]æ¯”è¾ƒ2å’Œ1,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[2 1 4 6 5 9][ i = 1] äº¤æ¢å[1 2 4 6 5 9][ i = 0] [ i = 0 ]æ—¶å•¥ä¹Ÿä¸å¹²,å…ˆè®©iè‡ªå¢1,è¾¾åˆ°å€¼ä¸º1æ‰å¼€å§‹çœŸæ­£çš„æ¯”è¾ƒã€‚ äº¤æ¢å‰[1 2 4 6 5 9][ i = 0] äº¤æ¢å[1 2 4 6 5 9][ i = 1] [ i = 1]æ¯”è¾ƒ1å’Œ2,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 2]æ¯”è¾ƒ2å’Œ4,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 3]æ¯”è¾ƒ4å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 4]æ¯”è¾ƒ6å’Œ5,äº¤æ¢,åªè¦äº¤æ¢å°±å‡1ã€‚ äº¤æ¢å‰[1 2 4 6 5 9][ i = 4] äº¤æ¢å[1 2 4 5 6 9][ i = 3] [ i = 3]æ¯”è¾ƒ4å’Œ5,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 4]æ¯”è¾ƒ5å’Œ6,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 5]æ¯”è¾ƒ6å’Œ9,ä¸äº¤æ¢,åªè¦ä¸äº¤æ¢å°±è‡ªå¢1ã€‚ [ i = 6]è¡¨è¾¾å¼(i &lt; n)ä¸æˆç«‹,æ’åºç»“æŸã€‚ é¡ºåºè¾“å‡ºç»“æœå³å¯:[ 1 2 4 5 6 9]ã€‚ ä»£ç  12345678910111213141516171819202122232425262728293031323334package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: åœ°ç²¾æ’åºï¼šå·ç§°æœ€ç®€å•çš„æ’åºç®—æ³•,åªæœ‰ä¸€å±‚å¾ªç¯,é»˜è®¤æƒ…å†µä¸‹å‰è¿›å†’æ³¡,ä¸€æ—¦é‡åˆ°å†’æ³¡çš„æƒ…å†µå‘ç”Ÿå°±å¾€å›å†’,ç›´åˆ°æŠŠè¿™ä¸ªæ•°å­—æ”¾å¥½ä¸ºæ­¢ã€‚ */public class GnomeSort { public static void gnomeSort(int[] unsorted) { int i = 0; while (i &lt; unsorted.length) { if (i == 0 || unsorted[i - 1] &lt;= unsorted[i]) { i++; } else { int temp = unsorted[i]; unsorted[i] = unsorted[i - 1]; unsorted[i - 1] = temp; i--; } } } public static void main(String[] args) { int[] unsorted = {6, 2, 4, 1, 5, 9}; System.out.println("**************åœ°ç²¾æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); gnomeSort(unsorted); CommonUtils.display(unsorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - é¸¡å°¾é…’æ’åº]]></title>
    <url>%2Fposts%2F6d9204ec.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ é¸¡å°¾é…’æ’åºåŸºäºå†’æ³¡æ’åº,åŒå‘å¾ªç¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šç»™å®šå¾…æ’æ•°ç»„[2 3 4 5 1] ç¬¬ä¸€è¶Ÿè¿‡å»æ—¶çš„æ¯ä¸€æ­¥ã€‚ ç¬¬ä¸€æ­¥è¿­ä»£,2 &lt; 3ä¸æ¢ [2 3 4 5 1] ç¬¬äºŒæ­¥è¿­ä»£,3 &lt; 4ä¸æ¢ [2 3 4 5 1] ç¬¬ä¸‰æ­¥è¿­ä»£,4 &lt; 5ä¸æ¢ [2 3 4 5 1] ç¬¬å››æ­¥è¿­ä»£,5 &gt; 1äº¤æ¢ [2 3 4 1 5] ç¬¬ä¸€è¶Ÿå›æ¥æ—¶çš„ç¬¬ä¸€æ­¥,é¸¡å°¾é…’ä¸€æ¬¡åˆ°å¤´åå°±å›è¿”å›æ¥,å†åˆ°å¤´åå†è¿‡å»,æ¥å›æ¯”,ä¸€ä¸ªæ¥å›èƒ½æ’ä¸¤ä¸ªæ•°å­—ã€‚ ç¬¬äº”æ­¥è¿­ä»£,1 &lt; 5ä¸äº¤æ¢ [2 3 4 1 5] ç¬¬å…­æ­¥è¿­ä»£,1 &lt; 4äº¤æ¢ [2 3 1 4 5] ç¬¬ä¸ƒæ­¥è¿­ä»£,1 &lt; 3äº¤æ¢ [2 1 3 4 5] ç¬¬å…«æ­¥è¿­ä»£,2 &gt; 1äº¤æ¢ [1 2 3 4 5] æ’åºå®Œæ¯•,é¡ºåºè¾“å‡ºç»“æœå³å¯å¾—[ 1 2 3 4 5]ã€‚ å¦‚ä½•åˆ¤æ–­æ’åºç»“æŸäº†? å‡å¦‚ä¸€è¶Ÿæ¥å›æ²¡æœ‰äº¤æ¢ä»»ä½•æ•°å­—,åˆ™è¡¨ç¤ºè¯¥æ•°ç»„å·²ç»æœ‰åºäº†,å¯ä»¥è®¾ç½®äº†ä¸ªå˜é‡è¡¨ç¤ºæœ‰æ²¡æœ‰äº¤æ¢è¿‡ã€‚ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é¸¡å°¾é…’æ’åº åŸºäºå†’æ³¡æ’åº,åŒå‘å¾ªç¯ */public class CocktailSort { public static void cocktailSort(int[] unsorted) { boolean swapped = false; do { for (int i = 0; i &lt; unsorted.length - 1; i++) { if (unsorted[i] &gt; unsorted[i + 1]) { int temp = unsorted[i]; unsorted[i] = unsorted[i + 1]; unsorted[i + 1] = temp; swapped = true; } } swapped = false; for (int j = unsorted.length - 1; j &gt; 0; j--) { if (unsorted[j] &lt; unsorted[j - 1]) { int temp = unsorted[j]; unsorted[j] = unsorted[j - 1]; unsorted[j - 1] = temp; swapped = true; } } } while (swapped); } public static void main(String[] args) { int[] unsorted = {6, 2, 4, 1, 5, 9}; System.out.println("**************é¸¡å°¾é…’æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); cocktailSort(unsorted); CommonUtils.display(unsorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - æ¡¶æ’åº]]></title>
    <url>%2Fposts%2F41e434a7.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ æ˜¯å°†é˜µåˆ—åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶å­é‡Œã€‚æ¯ä¸ªæ¡¶å­å†ä¸ªåˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å›æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’åºï¼‰ã€‚æ¡¶æ’åºæ˜¯é¸½å·¢æ’åºçš„ä¸€ç§å½’çº³ç»“æœã€‚å½“è¦è¢«æ’åºçš„é˜µåˆ—å†…çš„æ•°å€¼æ˜¯å‡åŒ€åˆ†é…çš„æ—¶å€™ï¼Œæ¡¶æ’åºä½¿ç”¨çº¿æ€§æ—¶é—´ï¼ˆÎ˜ï¼ˆnï¼‰ï¼‰ã€‚ä½†æ¡¶æ’åºå¹¶ä¸æ˜¯ æ¯”è¾ƒæ’åºï¼Œä»–ä¸å—åˆ° O(n log n) ä¸‹é™çš„å½±å“ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ•°æ®åˆ†ç»„ï¼Œæ”¾åœ¨ä¸€ä¸ªä¸ªçš„æ¡¶ä¸­ï¼Œç„¶åå¯¹æ¯ä¸ªæ¡¶é‡Œé¢çš„åœ¨è¿›è¡Œæ’åºã€‚ ä¾‹å¦‚è¦å¯¹å¤§å°ä¸º[1..1000]èŒƒå›´å†…çš„nä¸ªæ•´æ•°A[1..n]æ’åºã€‚ é¦–å…ˆï¼Œå¯ä»¥æŠŠæ¡¶è®¾ä¸ºå¤§å°ä¸º10çš„èŒƒå›´ï¼Œå…·ä½“è€Œè¨€ï¼Œè®¾é›†åˆB[1]å­˜å‚¨[1..10]çš„æ•´æ•°ï¼Œé›†åˆB[2]å­˜å‚¨(10..20]çš„æ•´æ•°ï¼Œâ€¦â€¦é›†åˆB[i]å­˜å‚¨((i-1)10, i10]çš„æ•´æ•°ï¼Œi = 1,2,..100ã€‚æ€»å…±æœ‰100ä¸ªæ¡¶ã€‚ ç„¶åï¼Œå¯¹A[1..n]ä»å¤´åˆ°å°¾æ‰«æä¸€éï¼ŒæŠŠæ¯ä¸ªA[i]æ”¾å…¥å¯¹åº”çš„æ¡¶B[j]ä¸­ã€‚å†å¯¹è¿™100ä¸ªæ¡¶ä¸­æ¯ä¸ªæ¡¶é‡Œçš„æ•°å­—æ’åºï¼Œè¿™æ—¶å¯ç”¨å†’æ³¡ï¼Œé€‰æ‹©ï¼Œä¹ƒè‡³å¿«æ’ï¼Œä¸€èˆ¬æ¥è¯´ä»»ä½•æ’åºæ³•éƒ½å¯ä»¥ã€‚ æœ€åï¼Œä¾æ¬¡è¾“å‡ºæ¯ä¸ªæ¡¶é‡Œé¢çš„æ•°å­—ï¼Œä¸”æ¯ä¸ªæ¡¶ä¸­çš„æ•°å­—ä»å°åˆ°å¤§è¾“å‡ºï¼Œè¿™æ ·å°±å¾—åˆ°æ‰€æœ‰æ•°å­—æ’å¥½åºçš„ä¸€ä¸ªåºåˆ—äº†ã€‚ å‡è®¾æœ‰nä¸ªæ•°å­—ï¼Œæœ‰mä¸ªæ¡¶ï¼Œå¦‚æœæ•°å­—æ˜¯å¹³å‡åˆ†å¸ƒçš„ï¼Œåˆ™æ¯ä¸ªæ¡¶é‡Œé¢å¹³å‡æœ‰n/mä¸ªæ•°å­—ã€‚å¦‚æœå¯¹æ¯ä¸ªæ¡¶ä¸­çš„æ•°å­—é‡‡ç”¨å¿«é€Ÿæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªç®—æ³•çš„å¤æ‚åº¦æ˜¯ O(n + m * n/m*log(n/m)) = O(n + nlogn - nlogm) ä»ä¸Šå¼çœ‹å‡ºï¼Œå½“mæ¥è¿‘nçš„æ—¶å€™ï¼Œæ¡¶æ’åºå¤æ‚åº¦æ¥è¿‘O(n)ã€‚ å½“ç„¶ï¼Œä»¥ä¸Šå¤æ‚åº¦çš„è®¡ç®—æ˜¯åŸºäºè¾“å…¥çš„nä¸ªæ•°å­—æ˜¯å¹³å‡åˆ†å¸ƒè¿™ä¸ªå‡è®¾çš„ã€‚è¿™ä¸ªå‡è®¾æ˜¯å¾ˆå¼ºçš„ ï¼Œå®é™…åº”ç”¨ä¸­æ•ˆæœå¹¶æ²¡æœ‰è¿™ä¹ˆå¥½ã€‚å¦‚æœæ‰€æœ‰çš„æ•°å­—éƒ½è½åœ¨åŒä¸€ä¸ªæ¡¶ä¸­ï¼Œé‚£å°±é€€åŒ–æˆä¸€èˆ¬çš„æ’åºäº†ã€‚ æ¡¶æ’åºçš„ç¼ºç‚¹æ˜¯ï¼š 1ï¼‰é¦–å…ˆæ˜¯ç©ºé—´å¤æ‚åº¦æ¯”è¾ƒé«˜ï¼Œéœ€è¦çš„é¢å¤–å¼€é”€å¤§ã€‚æ’åºæœ‰ä¸¤ä¸ªæ•°ç»„çš„ç©ºé—´å¼€é”€ï¼Œä¸€ä¸ªå­˜æ”¾å¾…æ’åºæ•°ç»„ï¼Œä¸€ä¸ªå°±æ˜¯æ‰€è°“çš„æ¡¶ï¼Œæ¯”å¦‚å¾…æ’åºå€¼æ˜¯ä»0åˆ°m-1ï¼Œé‚£å°±éœ€è¦mä¸ªæ¡¶ï¼Œè¿™ä¸ªæ¡¶æ•°ç»„å°±è¦è‡³å°‘mä¸ªç©ºé—´ã€‚ 2ï¼‰å…¶æ¬¡å¾…æ’åºçš„å…ƒç´ éƒ½è¦åœ¨ä¸€å®šçš„èŒƒå›´å†…ç­‰ç­‰ã€‚ æ¡¶å¼æ’åºæ˜¯ä¸€ç§åˆ†é…æ’åºã€‚åˆ†é…æ’åºçš„ç‰¹ç‚¹æ˜¯ä¸éœ€è¦è¿›è¡Œå…³é”®ç çš„æ¯”è¾ƒï¼Œä½†å‰ææ˜¯è¦çŸ¥é“å¾…æ’åºåˆ—çš„ä¸€äº›å…·ä½“æƒ…å†µã€‚ ä¾‹å¦‚å¾…æ’æ•°å­—[6 2 4 1 5 9] å‡†å¤‡10ä¸ªç©ºæ¡¶,æœ€å¤§æ•°ä¸ªç©ºæ¡¶ [6 2 4 1 5 9] å¾…æ’æ•°ç»„ [0 0 0 0 0 0 0 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®é™…ä¸å­˜åœ¨) 1,é¡ºåºä»å¾…æ’æ•°ç»„ä¸­å–å‡ºæ•°å­—,é¦–å…ˆ6è¢«å–å‡º,ç„¶åæŠŠ6å…¥6å·æ¡¶,è¿™ä¸ªè¿‡ç¨‹ç±»ä¼¼è¿™æ ·:ç©ºæ¡¶[ å¾…æ’æ•°ç»„[ 0 ] ] = å¾…æ’æ•°ç»„[ 0 ] [6 2 4 1 5 9] å¾…æ’æ•°ç»„ [0 0 0 0 0 0 6 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®é™…ä¸å­˜åœ¨) 2,é¡ºåºä»å¾…æ’æ•°ç»„ä¸­å–å‡ºä¸‹ä¸€ä¸ªæ•°å­—,æ­¤æ—¶2è¢«å–å‡º,å°†å…¶æ”¾å…¥2å·æ¡¶,æ˜¯å‡ å°±æ”¾å‡ å·æ¡¶ [6 2 4 1 5 9] å¾…æ’æ•°ç»„ [0 0 2 0 0 0 6 0 0 0] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®é™…ä¸å­˜åœ¨) 3,4,5,6çœç•¥,è¿‡ç¨‹ä¸€æ ·,å…¨éƒ¨å…¥æ¡¶åå˜æˆä¸‹è¾¹è¿™æ · [6 2 4 1 5 9] å¾…æ’æ•°ç»„ [0 1 2 0 4 5 6 0 0 9] ç©ºæ¡¶ [0 1 2 3 4 5 6 7 8 9] æ¡¶ç¼–å·(å®é™…ä¸å­˜åœ¨) 0è¡¨ç¤ºç©ºæ¡¶,è·³è¿‡,é¡ºåºå–å‡ºå³å¯:1 2 4 5 6 9 ä»£ç  12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ¡¶æ’åº */public class BucketSort { /** * æ˜¯å°†é˜µåˆ—åˆ†åˆ°æœ‰é™æ•°é‡çš„æ¡¶å­é‡Œã€‚æ¯ä¸ªæ¡¶å­å†ä¸ªåˆ«æ’åºï¼ˆæœ‰å¯èƒ½å†ä½¿ç”¨åˆ«çš„æ’åºç®—æ³•æˆ–æ˜¯ä»¥é€’å›æ–¹å¼ç»§ç»­ä½¿ç”¨æ¡¶æ’åºè¿›è¡Œæ’åºï¼‰ã€‚ * æ¡¶æ’åºæ˜¯é¸½å·¢æ’åºçš„ä¸€ç§å½’çº³ç»“æœã€‚å½“è¦è¢«æ’åºçš„é˜µåˆ—å†…çš„æ•°å€¼æ˜¯å‡åŒ€åˆ†é…çš„æ—¶å€™ï¼Œæ¡¶æ’åºä½¿ç”¨çº¿æ€§æ—¶é—´ï¼ˆÎ˜ï¼ˆnï¼‰ï¼‰ã€‚ * ä½†æ¡¶æ’åºå¹¶ä¸æ˜¯ æ¯”è¾ƒæ’åºï¼Œä»–ä¸å—åˆ° O(n log n) ä¸‹é™çš„å½±å“ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯æŠŠæ•°æ®åˆ†ç»„ï¼Œæ”¾åœ¨ä¸€ä¸ªä¸ªçš„æ¡¶ä¸­ï¼Œç„¶åå¯¹æ¯ä¸ªæ¡¶é‡Œé¢çš„åœ¨è¿›è¡Œæ’åºã€‚ */ public static int[] bucketSort(int[] unsorted, int maxNumber) { int[] sorted = new int[maxNumber + 1]; for (int i = 0; i &lt; unsorted.length; i++) { sorted[unsorted[i]] = unsorted[i]; } return sorted; } public static void main(String[] args) { int[] unsorted = {99, 65, 24, 47, 50, 88, 33, 66, 67, 31, 18}; int[] sorted = bucketSort(unsorted, 99); System.out.println("**************æ¡¶æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); for (int tmp : sorted) { if (tmp &gt; 0) { System.out.print(tmp + " "); } } }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-05ä¹‹-çº¿ç¨‹ç­‰å¾…ä¸å”¤é†’]]></title>
    <url>%2Fposts%2Ff777650b.html</url>
    <content type="text"><![CDATA[wait(), notify(), notifyAll()ç­‰æ–¹æ³•ä»‹ç» åœ¨Object.javaä¸­ï¼Œå®šä¹‰äº†wait(), notify()å’ŒnotifyAll()ç­‰æ¥å£ã€‚ wait()çš„ä½œç”¨æ˜¯è®©å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼ŒåŒæ—¶ï¼Œwait()ä¹Ÿä¼šè®©å½“å‰çº¿ç¨‹é‡Šæ”¾å®ƒæ‰€æŒæœ‰çš„é”ã€‚ è€Œnotify()å’ŒnotifyAll()çš„ä½œç”¨ï¼Œåˆ™æ˜¯å”¤é†’å½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼›notify()æ˜¯å”¤é†’å•ä¸ªçº¿ç¨‹ï¼Œè€ŒnotifyAll()æ˜¯å”¤é†’æ‰€æœ‰çš„çº¿ç¨‹ã€‚ Objectç±»ä¸­å…³äºç­‰å¾…/å”¤é†’çš„APIè¯¦ç»†ä¿¡æ¯å¦‚ä¸‹ï¼š &lt;font color="green"&gt;notify()&lt;/font&gt; -- å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚ &lt;font color="green"&gt;notifyAll()&lt;/font&gt; -- å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ &lt;font color="green"&gt;wait()&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºâ€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ &lt;font color="green"&gt;wait(long timeout)&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºâ€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ &lt;font color="green"&gt;wait(long timeout, int nanos)&lt;/font&gt; -- è®©å½“å‰çº¿ç¨‹å¤„äºâ€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…å…¶ä»–æŸä¸ªçº¿ç¨‹ä¸­æ–­å½“å‰çº¿ç¨‹ï¼Œæˆ–è€…å·²è¶…è¿‡æŸä¸ªå®é™…æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ wait()å’Œnotify()ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait()å’Œnotify()ä½¿ç”¨ç¤ºä¾‹ */public class WaitTest { public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); synchronized (t1) { try { // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(Thread.currentThread().getName() + " start t1"); t1.start(); // ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " wait()"); t1.wait(); System.out.println(Thread.currentThread().getName() + " continue"); } catch (InterruptedException e) { e.printStackTrace(); } } }}class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { synchronized (this) { System.out.println(Thread.currentThread().getName() + " call notify()"); // å”¤é†’å½“å‰çš„waitçº¿ç¨‹ notify(); } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœ: &lt;/span&gt; 1234main start t1main wait()t1 call notify()main continue &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; å¦‚ä¸‹å›¾ï¼Œè¯´æ˜äº†â€œä¸»çº¿ç¨‹â€å’Œâ€œçº¿ç¨‹t1â€çš„æµç¨‹ã€‚ (01) æ³¨æ„ï¼Œå›¾ä¸­"ä¸»çº¿ç¨‹" ä»£è¡¨â€œä¸»çº¿ç¨‹mainâ€ã€‚"çº¿ç¨‹t1" ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„â€œçº¿ç¨‹t1â€ã€‚ è€Œâ€œé”â€ ä»£è¡¨â€œt1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ (02) â€œä¸»çº¿ç¨‹â€é€šè¿‡ new ThreadA("t1") æ–°å»ºâ€œçº¿ç¨‹t1â€ã€‚éšåé€šè¿‡synchronized(t1)è·å–â€œt1å¯¹è±¡çš„åŒæ­¥é”â€ã€‚ç„¶åè°ƒç”¨t1.start()å¯åŠ¨â€œçº¿ç¨‹t1â€ã€‚ (03) â€œä¸»çº¿ç¨‹â€æ‰§è¡Œt1.wait() é‡Šæ”¾â€œt1å¯¹è±¡çš„é”â€å¹¶ä¸”è¿›å…¥â€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ã€‚ç­‰å¾…t1å¯¹è±¡ä¸Šçš„çº¿ç¨‹é€šè¿‡notify() æˆ– notifyAll()å°†å…¶å”¤é†’ã€‚ (04) â€œçº¿ç¨‹t1â€è¿è¡Œä¹‹åï¼Œé€šè¿‡synchronized(this)è·å–â€œå½“å‰å¯¹è±¡çš„é”â€ï¼›æ¥ç€è°ƒç”¨notify()å”¤é†’â€œå½“å‰å¯¹è±¡ä¸Šçš„ç­‰å¾…çº¿ç¨‹â€ï¼Œä¹Ÿå°±æ˜¯å”¤é†’â€œä¸»çº¿ç¨‹â€ã€‚ (05) â€œçº¿ç¨‹t1â€è¿è¡Œå®Œæ¯•ä¹‹åï¼Œé‡Šæ”¾â€œå½“å‰å¯¹è±¡çš„é”â€ã€‚ç´§æ¥ç€ï¼Œâ€œä¸»çº¿ç¨‹â€è·å–â€œt1å¯¹è±¡çš„é”â€ï¼Œç„¶åæ¥ç€è¿è¡Œã€‚ å¯¹äºä¸Šé¢çš„ä»£ç ï¼š&lt;font color="red"&gt;t1.wait()åº”è¯¥æ˜¯è®©â€œçº¿ç¨‹t1â€ç­‰å¾…ï¼›ä½†æ˜¯ï¼Œä¸ºä»€ä¹ˆå´æ˜¯è®©â€œä¸»çº¿ç¨‹mainâ€ç­‰å¾…äº†å‘¢ï¼Ÿ&lt;/font&gt; åœ¨è§£ç­”è¯¥é—®é¢˜å‰ï¼Œå…ˆçœ‹çœ‹jdkæ–‡æ¡£ä¸­å…³äºwaitçš„ä¸€æ®µä»‹ç»ï¼š &lt;p id="div-border-left-red"&gt; Causes the current thread to wait until another thread invokes the notify() method or the notifyAll() method for this object. In other words, this method behaves exactly as if it simply performs the call wait(0). The current thread must own this object's monitor. The thread releases ownership of this monitor and waits until another thread notifies threads waiting on this object's monitor to wake up either through a call to the notify method or the notifyAll method. The thread then waits until it can re-obtain ownership of the monitor and resumes execution. &lt;/p&gt; ä¸­æ–‡æ„æ€å¤§æ¦‚æ˜¯ï¼š &lt;p id="div-border-left-green"&gt; å¼•èµ·â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œç›´åˆ°å¦å¤–ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨notify()æˆ–notifyAll()å”¤é†’è¯¥çº¿ç¨‹ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•å’Œwait(0)çš„æ•ˆæœä¸€æ ·ï¼(è¡¥å……ï¼Œå¯¹äºwait(long millis)æ–¹æ³•ï¼Œå½“millisä¸º0æ—¶ï¼Œè¡¨ç¤ºæ— é™ç­‰å¾…ï¼Œç›´åˆ°è¢«notify()æˆ–notifyAll()å”¤é†’)ã€‚ â€œå½“å‰çº¿ç¨‹â€åœ¨è°ƒç”¨wait()æ—¶ï¼Œå¿…é¡»æ‹¥æœ‰è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚è¯¥çº¿ç¨‹è°ƒç”¨wait()ä¹‹åï¼Œä¼šé‡Šæ”¾è¯¥é”ï¼›ç„¶åä¸€ç›´ç­‰å¾…ç›´åˆ°â€œå…¶å®ƒçº¿ç¨‹â€è°ƒç”¨å¯¹è±¡çš„åŒæ­¥é”çš„notify()æˆ–notifyAll()æ–¹æ³•ã€‚ç„¶åï¼Œè¯¥çº¿ç¨‹ç»§ç»­ç­‰å¾…ç›´åˆ°å®ƒé‡æ–°è·å–â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ï¼Œç„¶åå°±å¯ä»¥æ¥ç€è¿è¡Œã€‚ &lt;/p&gt; &lt;span id="inline-purple"&gt; æ³¨æ„ï¼šjdkçš„è§£é‡Šä¸­ï¼Œè¯´wait()çš„ä½œç”¨æ˜¯è®©â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œâ€œå½“å‰çº¿ç¨‹â€æ˜¯æŒ‡æ­£åœ¨cpuä¸Šè¿è¡Œçš„çº¿ç¨‹ï¼ &lt;/span&gt; è¿™ä¹Ÿæ„å‘³ç€ï¼Œè™½ç„¶t1.wait()æ˜¯é€šè¿‡â€œçº¿ç¨‹t1â€è°ƒç”¨çš„wait()æ–¹æ³•ï¼Œä½†æ˜¯è°ƒç”¨t1.wait()çš„åœ°æ–¹æ˜¯åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­ã€‚è€Œä¸»çº¿ç¨‹å¿…é¡»æ˜¯â€œå½“å‰çº¿ç¨‹â€ï¼Œä¹Ÿå°±æ˜¯è¿è¡ŒçŠ¶æ€ï¼Œæ‰å¯ä»¥æ‰§è¡Œt1.wait()ã€‚æ‰€ä»¥ï¼Œæ­¤æ—¶çš„â€œå½“å‰çº¿ç¨‹â€æ˜¯â€œä¸»çº¿ç¨‹mainâ€ï¼å› æ­¤ï¼Œt1.wait()æ˜¯è®©â€œä¸»çº¿ç¨‹â€ç­‰å¾…ï¼Œè€Œä¸æ˜¯â€œçº¿ç¨‹t1â€ï¼ wait(long timeout)å’Œnotify() wait(long timeout)ä¼šè®©å½“å‰çº¿ç¨‹å¤„äºâ€œç­‰å¾…(é˜»å¡)çŠ¶æ€â€ï¼Œâ€œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨æ­¤å¯¹è±¡çš„ notify() æ–¹æ³•æˆ– notifyAll() æ–¹æ³•ï¼Œæˆ–è€…è¶…è¿‡æŒ‡å®šçš„æ—¶é—´é‡â€ï¼Œå½“å‰çº¿ç¨‹è¢«å”¤é†’(è¿›å…¥â€œå°±ç»ªçŠ¶æ€â€)ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait(long timeout)å’Œnotify()çš„ä½¿ç”¨ç¤ºä¾‹ */public class WaitTimeoutTest { public static void main(String[] args) { ThreadB t1 = new ThreadB("t1"); synchronized (t1) { try { // å¯åŠ¨â€œçº¿ç¨‹t1â€ System.out.println(Thread.currentThread().getName() + " start t1"); t1.start(); // ä¸»çº¿ç¨‹ç­‰å¾…t1é€šè¿‡notify()å”¤é†’ æˆ– notifyAll()å”¤é†’ï¼Œæˆ–è¶…è¿‡3000mså»¶æ—¶ï¼›ç„¶åæ‰è¢«å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " call wait "); t1.wait(3000); System.out.println(Thread.currentThread().getName() + " continue"); } catch (InterruptedException e) { e.printStackTrace(); } } }}class ThreadB extends Thread { public ThreadB(String name) { super(name); } @Override public void run() { System.out.println(Thread.currentThread().getName() + " run "); // æ­»å¾ªç¯ï¼Œä¸æ–­è¿è¡Œã€‚ while (true) { ; } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234main start t1main call wait t1 run // å¤§çº¦3ç§’ä¹‹å...è¾“å‡ºâ€œmain continueâ€main continue &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; å¦‚ä¸‹å›¾ï¼Œè¯´æ˜äº†â€œä¸»çº¿ç¨‹â€å’Œâ€œçº¿ç¨‹t1â€çš„æµç¨‹ã€‚ (01) æ³¨æ„ï¼Œå›¾ä¸­"ä¸»çº¿ç¨‹" ä»£è¡¨WaitTimeoutTestä¸»çº¿ç¨‹(å³ï¼Œçº¿ç¨‹main)ã€‚"çº¿ç¨‹t1" ä»£è¡¨WaitTestä¸­å¯åŠ¨çš„çº¿ç¨‹t1ã€‚ è€Œâ€œé”â€ ä»£è¡¨â€œt1è¿™ä¸ªå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ (02) ä¸»çº¿ç¨‹mainæ‰§è¡Œt1.start()å¯åŠ¨â€œçº¿ç¨‹t1â€ã€‚ (03) ä¸»çº¿ç¨‹mainæ‰§è¡Œt1.wait(3000)ï¼Œæ­¤æ—¶ï¼Œä¸»çº¿ç¨‹è¿›å…¥â€œé˜»å¡çŠ¶æ€â€ã€‚éœ€è¦â€œç”¨äºt1å¯¹è±¡é”çš„çº¿ç¨‹é€šè¿‡notify() æˆ–è€… notifyAll()å°†å…¶å”¤é†’â€ æˆ–è€… â€œè¶…æ—¶3000msä¹‹åâ€ï¼Œä¸»çº¿ç¨‹mainæ‰è¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œç„¶åæ‰å¯ä»¥è¿è¡Œã€‚ (04) â€œçº¿ç¨‹t1â€è¿è¡Œä¹‹åï¼Œè¿›å…¥äº†æ­»å¾ªç¯ï¼Œä¸€ç›´ä¸æ–­çš„è¿è¡Œã€‚ (05) è¶…æ—¶3000msä¹‹åï¼Œä¸»çº¿ç¨‹mainä¼šè¿›å…¥åˆ°â€œå°±ç»ªçŠ¶æ€â€ï¼Œç„¶åæ¥ç€è¿›å…¥â€œè¿è¡ŒçŠ¶æ€â€ã€‚ wait() å’Œ notifyAll() é€šè¿‡å‰é¢çš„ç¤ºä¾‹ï¼Œæˆ‘ä»¬çŸ¥é“ notify() å¯ä»¥å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚ ä¸‹é¢ï¼Œé€šè¿‡ç¤ºä¾‹æ¼”ç¤ºnotifyAll()çš„ç”¨æ³•ï¼›å®ƒçš„ä½œç”¨æ˜¯å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package main.java.com.study.thread.waitNotify;/** * @author: whb * @description: wait() å’Œ notifyAll()ä½¿ç”¨ç¤ºä¾‹ */public class NotifyAllTest { private static Object obj = new Object(); public static void main(String[] args) { ThreadA t1 = new ThreadA("t1"); ThreadA t2 = new ThreadA("t2"); ThreadA t3 = new ThreadA("t3"); t1.start(); t2.start(); t3.start(); try { System.out.println(Thread.currentThread().getName() + " sleep(3000)"); Thread.sleep(3000); } catch (InterruptedException e) { e.printStackTrace(); } synchronized (obj) { // ä¸»çº¿ç¨‹ç­‰å¾…å”¤é†’ã€‚ System.out.println(Thread.currentThread().getName() + " notifyAll()"); obj.notifyAll(); } } static class ThreadA extends Thread { public ThreadA(String name) { super(name); } @Override public void run() { synchronized (obj) { try { // æ‰“å°è¾“å‡ºç»“æœ System.out.println(Thread.currentThread().getName() + " wait"); // å”¤é†’å½“å‰çš„waitçº¿ç¨‹ obj.wait(); // æ‰“å°è¾“å‡ºç»“æœ System.out.println(Thread.currentThread().getName() + " continue"); } catch (InterruptedException e) { e.printStackTrace(); } } } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678t1 waitmain sleep(3000)t3 waitt2 waitmain notifyAll()t2 continuet3 continuet1 continue &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; (01) ä¸»çº¿ç¨‹ä¸­æ–°å»ºå¹¶ä¸”å¯åŠ¨äº†3ä¸ªçº¿ç¨‹"t1", "t2"å’Œ"t3"ã€‚ (02) ä¸»çº¿ç¨‹é€šè¿‡sleep(3000)ä¼‘çœ 3ç§’ã€‚åœ¨ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å‡è®¾"t1", "t2"å’Œ"t3"è¿™3ä¸ªçº¿ç¨‹éƒ½è¿è¡Œäº†ã€‚ä»¥"t1"ä¸ºä¾‹ï¼Œå½“å®ƒè¿è¡Œçš„æ—¶å€™ï¼Œå®ƒä¼šæ‰§è¡Œobj.wait()ç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡notify()æˆ–é¢nofityAll()æ¥å”¤é†’å®ƒï¼›ç›¸åŒçš„é“ç†ï¼Œ"t2"å’Œ"t3"ä¹Ÿä¼šç­‰å¾…å…¶å®ƒçº¿ç¨‹é€šè¿‡nofity()æˆ–nofityAll()æ¥å”¤é†’å®ƒä»¬ã€‚ (03) ä¸»çº¿ç¨‹ä¼‘çœ 3ç§’ä¹‹åï¼Œæ¥ç€è¿è¡Œã€‚æ‰§è¡Œ obj.notifyAll() å”¤é†’objä¸Šçš„ç­‰å¾…çº¿ç¨‹ï¼Œå³å”¤é†’"t1", "t2"å’Œ"t3"è¿™3ä¸ªçº¿ç¨‹ã€‚ ç´§æ¥ç€ï¼Œä¸»çº¿ç¨‹çš„synchronized(obj)è¿è¡Œå®Œæ¯•ä¹‹åï¼Œä¸»çº¿ç¨‹é‡Šæ”¾â€œobjé”â€ã€‚è¿™æ ·ï¼Œ"t1", "t2"å’Œ"t3"å°±å¯ä»¥è·å–â€œobjé”â€è€Œç»§ç»­è¿è¡Œäº†ï¼ ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectä¸­ï¼Œè€Œä¸æ˜¯Threadä¸­ Objectä¸­çš„wait(), notify()ç­‰å‡½æ•°ï¼Œå’Œsynchronizedä¸€æ ·ï¼Œä¼šå¯¹â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è¡Œæ“ä½œã€‚ wait()ä¼šä½¿â€œå½“å‰çº¿ç¨‹â€ç­‰å¾…ï¼Œå› ä¸ºçº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œæ‰€ä»¥çº¿ç¨‹åº”è¯¥é‡Šæ”¾å®ƒé”æŒæœ‰çš„â€œåŒæ­¥é”â€ï¼Œå¦åˆ™å…¶å®ƒçº¿ç¨‹è·å–ä¸åˆ°è¯¥â€œåŒæ­¥é”â€è€Œæ— æ³•è¿è¡Œï¼ çº¿ç¨‹è°ƒç”¨wait()ä¹‹åï¼Œä¼šé‡Šæ”¾å®ƒé”æŒæœ‰çš„â€œåŒæ­¥é”â€ï¼›è€Œä¸”ï¼Œç­‰å¾…çº¿ç¨‹å¯ä»¥è¢«notify()æˆ–notifyAll()å”¤é†’ã€‚ é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šnotify()æ˜¯ä¾æ®ä»€ä¹ˆå”¤é†’ç­‰å¾…çº¿ç¨‹çš„ï¼Ÿæˆ–è€…è¯´ï¼Œwait()ç­‰å¾…çº¿ç¨‹å’Œnotify()ä¹‹é—´æ˜¯é€šè¿‡ä»€ä¹ˆå…³è”èµ·æ¥çš„ï¼Ÿç­”æ¡ˆæ˜¯ï¼šä¾æ®â€œå¯¹è±¡çš„åŒæ­¥é”â€ã€‚ è´Ÿè´£å”¤é†’ç­‰å¾…çº¿ç¨‹çš„é‚£ä¸ªçº¿ç¨‹(ç§°ä¸ºâ€œå”¤é†’çº¿ç¨‹â€)ï¼Œå®ƒåªæœ‰åœ¨è·å–â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€(è¿™é‡Œçš„åŒæ­¥é”å¿…é¡»å’Œç­‰å¾…çº¿ç¨‹çš„åŒæ­¥é”æ˜¯åŒä¸€ä¸ª)ï¼Œå¹¶ä¸”è°ƒç”¨notify()æˆ–notifyAll()æ–¹æ³•ä¹‹åï¼Œæ‰èƒ½å”¤é†’ç­‰å¾…çº¿ç¨‹ã€‚è™½ç„¶ï¼Œç­‰å¾…çº¿ç¨‹è¢«å”¤é†’ï¼›ä½†æ˜¯ï¼Œå®ƒä¸èƒ½ç«‹åˆ»æ‰§è¡Œï¼Œå› ä¸ºå”¤é†’çº¿ç¨‹è¿˜æŒæœ‰â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ã€‚å¿…é¡»ç­‰åˆ°å”¤é†’çº¿ç¨‹é‡Šæ”¾äº†â€œå¯¹è±¡çš„åŒæ­¥é”â€ä¹‹åï¼Œç­‰å¾…çº¿ç¨‹æ‰èƒ½è·å–åˆ°â€œå¯¹è±¡çš„åŒæ­¥é”â€è¿›è€Œç»§ç»­è¿è¡Œã€‚ æ€»ä¹‹ï¼Œnotify(), wait()ä¾èµ–äºâ€œåŒæ­¥é”â€ï¼Œè€Œâ€œåŒæ­¥é”â€æ˜¯å¯¹è±¡é”æŒæœ‰ï¼Œå¹¶ä¸”æ¯ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªï¼è¿™å°±æ˜¯ä¸ºä»€ä¹ˆnotify(), wait()ç­‰å‡½æ•°å®šä¹‰åœ¨Objectç±»ï¼Œè€Œä¸æ˜¯Threadç±»ä¸­çš„åŸå› ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - è€å¿ƒæ’åº]]></title>
    <url>%2Fposts%2Fde5a6680.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ è€å¿ƒæ’åºå……åˆ†é›†åˆäº†æ¡¶æ’åºå’Œæ’å…¥æ’åºçš„ä¼˜ç‚¹ï¼Œé¦–å…ˆä½¿ç”¨æ¡¶æ’åºï¼Œæ’åºä¹‹åæ¯ä¸ªæ¡¶ä¸­æ•°æ®ç›¸å¯¹æœ‰åºï¼Œè¿™æ ·å†ä½¿ç”¨æ’å…¥æ’åºï¼Œç®€åŒ–äº†é—®é¢˜ï¼Œé€Ÿåº¦å˜çš„æ›´å¿«ã€‚ å»ºæ¡¶è§„åˆ™:å¦‚æœæ²¡æœ‰æ¡¶,æ–°å»ºä¸€ä¸ªæ¡¶;å¦‚æœä¸ç¬¦åˆå…¥æ¡¶è§„åˆ™é‚£ä¹ˆæ–°å»ºä¸€ä¸ªæ¡¶ã€‚ å…¥æ¡¶è§„åˆ™:åªè¦æ¯”æ¡¶é‡Œæœ€ä¸Šè¾¹çš„æ•°å­—å°å³å¯å…¥æ¡¶,å¦‚æœæœ‰å¤šä¸ªæ¡¶å¯å…¥,é‚£ä¹ˆæŒ‰ç…§ä»å·¦åˆ°å³çš„é¡ºåºå…¥æ¡¶å³å¯ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æ’åºæ•°ç»„[6 4 5 1 8 7 2 3] ç¬¬ä¸€æ­¥ï¼šå› ä¸ºæ­¤å‰è¿˜æ²¡æœ‰æ¡¶ï¼Œåˆ™å»ºç«‹ä¸€ä¸ªæ¡¶ï¼Œæˆ‘ä»¬å‘½åä¸ºæ¡¶1,ä»ä¸Šé¢å–å‡ºç¬¬ä¸€ä¸ªæ•°å­— 6ï¼Œç„¶åå°†6æ”¾å…¥åˆ°æ¡¶ä¸­ã€‚ ç¬¬äºŒæ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬äºŒä¸ªå€¼4ï¼Œç„¶åéå†ç°æœ‰çš„æ¡¶ï¼Œéå†çš„å·¥ç¨‹ä¸­å…ˆé‡åˆ°æ¡¶1ï¼Œæˆ‘ä»¬å‘ç°æ¡¶1ä¸­æœ€ä¸Šé¢çš„å…ƒç´ æ˜¯6,4æ¯”6å¤§ï¼Œåˆ™6ä¸‹æ²‰ï¼Œæœ‰æ¡¶ã€4,6ã€‘ã€‚ ç¬¬ä¸‰æ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬ä¸‰ä¸ªå€¼5ï¼Œç„¶åéå†ç°æœ‰çš„æ¡¶ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯4ï¼Œæ¯”5å°ï¼Œæ‰€ä»¥é‡æ–°å¼€ä¸€ä¸ªæ¡¶ã€5ã€‘ï¼Œä¹‹åå…±æœ‰ä¸¤ä¸ªæ¡¶ã€4,5ã€‘ã€5ã€‘ã€‚ ç¬¬å››éƒ¨ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬å››ä¸ªå€¼1ï¼Œç„¶åéå†ç°æœ‰çš„æ¡¶ï¼Œå› ä¸ºç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯4ï¼Œæ¯”1å¤§ï¼Œæ‰€ä»¥æ”¾åˆ°æ¡¶1ã€4,6ã€‘æœ€å‰é¢ï¼Œä»è€Œå½¢æˆã€1,4,6ã€‘ã€5ã€‘ã€‚ ç¬¬äº”æ­¥ï¼šæˆ‘ä»¬ä½¿ç”¨ç¬¬äº”ä¸ªå…ƒç´ ï¼Œç„¶åéå†ç°æœ‰çš„æ¡¶ï¼Œç¬¬ä¸€ä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯1ï¼Œç¬¬äºŒä¸ªæ¡¶ç¬¬ä¸€ä¸ªå…ƒç´ æ˜¯5ï¼Œéƒ½æ¯”8å°ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°å¼€ä¸€ä¸ªæ¡¶ã€8ã€‘ï¼Œæ­¤æ—¶å…±æœ‰æ¡¶ã€1,4,6ã€‘ã€5ã€‘ã€8ã€‘ã€‚ ç¬¬å…­æ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åæ¡¶æ˜¯ã€1,4,6ã€‘ã€5ã€‘ã€7ï¼Œ8ã€‘ã€‚ ç¬¬ä¸ƒæ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åæ¡¶æ˜¯ã€1,4,6ã€‘ã€2ï¼Œ5ã€‘ã€7ï¼Œ8ã€‘ã€‚ ç¬¬å…«æ­¥ï¼šä½¿ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œä¹‹åæ¡¶æ˜¯ã€1,4,6ã€‘ã€2ï¼Œ5ã€‘ã€3ï¼Œ7ï¼Œ8ã€‘ã€‚ æ³¨æ„ï¼šéå†çš„æ•°ç»„ï¼Œåªè·Ÿå„ä¸ªæ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ åšæ¯”è¾ƒï¼Œè¿™æ ·ä¿è¯å„ä¸ªæ¡¶å…ƒç´ æœ‰åºã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;import java.util.ArrayList;import java.util.List;/** * @author: whb * @description: è€å¿ƒæ’åº */public class PatienceSort { public static int[] patienceSort(int[] unsorted) { List new_list = new ArrayList(); for (int i = 0; i &lt; unsorted.length; i++) { List bucket_list = new ArrayList(); if (i == 0) { bucket_list.add(unsorted[i]); new_list.add(bucket_list); } else { boolean is_ok = false; for (int j = 0; j &lt; new_list.size(); j++) { if (unsorted[i] &lt; (int) ((List) new_list.get(j)).get(0)) { ((List) new_list.get(j)).add(0, unsorted[i]); is_ok = true; break; } } if (!is_ok) { bucket_list.add(unsorted[i]); new_list.add(bucket_list); } } } //å¤šç»´æ•°ç»„å˜æˆå•ç»´æ•°ç»„ int[] ok_list = new int[unsorted.length]; int q = 0; for (int m = 0; m &lt; new_list.size(); m++) { for (int n = 0; n &lt; ((List) new_list.get(m)).size(); n++) { ok_list[q] = (int) ((List) new_list.get(m)).get(n); q++; } } //æ’å…¥å¾ªç¯ //å°†æ•°ç»„çš„é•¿åº¦èµ‹ç»™næ˜¯ä¸ºäº†é˜²æ­¢æ¯æ¬¡forå¾ªç¯ä¸­åˆ¤æ–­æ—¶éƒ½è°ƒç”¨lengthæ–¹æ³•å½±å“æ€§èƒ½ int n = ok_list.length; //ç”¨äºä¸­è½¬æ•°æ® int tmp; int j; //æ’åºçš„æ¬¡æ•° for (int i = 1; i &lt; n; i++) { tmp = ok_list[i]; //å–iå‰é¢çš„æ‰€æœ‰è·Ÿiä½ç½®å…ƒç´ è¿›è¡Œæ¯”è¾ƒï¼Œå…ˆæ¯”è¾ƒi-1å’Œiï¼Œå¦‚æœi-1å¤§äºiï¼Œåˆ™äº’æ¢ä½ç½®ï¼Œi-1å’Œi-2æ¯”è¾ƒï¼Œä»¥æ­¤ç±»æ¨ for (j = i - 1; j &gt;= 0 &amp;&amp; ok_list[j] &gt; tmp; j--) { ok_list[j + 1] = ok_list[j]; } ok_list[j + 1] = tmp; } return ok_list; } public static void main(String[] args) { int[] unsorted = {6, 4, 5, 1, 8, 7, 2, 3}; System.out.println("**************è€å¿ƒæ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); int[] sorted = patienceSort(unsorted); CommonUtils.display(sorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - è®¡æ•°æ’åº]]></title>
    <url>%2Fposts%2F4531d6c3.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ è®¡æ•°æ’åºæ˜¯ä¸€ç§éåŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•ï¼Œå…¶ç©ºé—´å¤æ‚åº¦å’Œæ—¶é—´å¤æ‚åº¦å‡ä¸ºO(n+k)ï¼Œå…¶ä¸­kæ˜¯æ•´æ•°çš„èŒƒå›´ã€‚åŸºäºæ¯”è¾ƒçš„æ’åºç®—æ³•æ—¶é—´å¤æ‚åº¦æœ€å°æ˜¯O(nlogn)çš„ã€‚è¯¥ç®—æ³•äº1954å¹´ç”± Harold H. Seward æå‡ºã€‚ è®¡æ•°æ’åºçš„æ ¸å¿ƒåœ¨äºå°†è¾“å…¥çš„æ•°æ®å€¼è½¬åŒ–ä¸ºé”®å­˜å‚¨åœ¨é¢å¤–å¼€è¾Ÿçš„æ•°ç»„ç©ºé—´ä¸­ã€‚ä½œä¸ºä¸€ç§çº¿æ€§æ—¶é—´å¤æ‚åº¦çš„æ’åºï¼Œè®¡æ•°æ’åºè¦æ±‚è¾“å…¥çš„æ•°æ®å¿…é¡»æ˜¯æœ‰ç¡®å®šèŒƒå›´çš„æ•´æ•°ã€‚ ç®—æ³•æ­¥éª¤ èŠ±O(n)çš„æ—¶é—´æ‰«æä¸€ä¸‹æ•´ä¸ªåºåˆ— Aï¼Œè·å–æœ€å°å€¼ min å’Œæœ€å¤§å€¼ maxã€‚ å¼€è¾Ÿä¸€å—æ–°çš„ç©ºé—´åˆ›å»ºæ–°çš„æ•°ç»„ Bï¼Œé•¿åº¦ä¸º ( max - min + 1)ã€‚ æ•°ç»„ B ä¸­ index çš„å…ƒç´ è®°å½•çš„å€¼æ˜¯ A ä¸­æŸå…ƒç´ å‡ºç°çš„æ¬¡æ•°ã€‚ æœ€åè¾“å‡ºç›®æ ‡æ•´æ•°åºåˆ—ï¼Œå…·ä½“çš„é€»è¾‘æ˜¯éå†æ•°ç»„ Bï¼Œè¾“å‡ºç›¸åº”å…ƒç´ ä»¥åŠå¯¹åº”çš„ä¸ªæ•°ã€‚ ç®—æ³•æ¼”ç¤º ç®—æ³•æ¼”ç¤ºè¯´æ˜ é¦–å…ˆï¼Œæ‰«æä¸€ä¸‹æ•´ä¸ªåºåˆ—ã€‚ è·å¾—æœ€å°å€¼ä¸º 2 ï¼Œæœ€å¤§å€¼ä¸º 7ã€‚ æ–°å»ºæ•°ç»„åŒ…å« 2~7 çš„å…ƒç´ ã€‚ å†æ¬¡æ‰«æåºåˆ—ï¼Œå°†åºåˆ—çš„å€¼æ”¾ç½®åœ¨æ–°å»ºæ•°ç»„ä¸­ã€‚ æ‰«ææ•°å­— 5ï¼Œæ•°ç»„ä¸­ index ä¸º 3 çš„å€¼ä¸º 5ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 3ï¼Œæ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 4ï¼Œæ•°ç»„ä¸­ index ä¸º 2 çš„å€¼ä¸º 4ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 7ï¼Œæ•°ç»„ä¸­ index ä¸º 5 çš„å€¼ä¸º 7ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 2ï¼Œæ•°ç»„ä¸­ index ä¸º 0 çš„å€¼ä¸º 2ï¼Œæ¬¡æ•°ä¸º 1ã€‚ æ‰«ææ•°å­— 4ï¼Œæ•°ç»„ä¸­ index ä¸º 2 çš„å€¼ä¸º 4ï¼Œæ¬¡æ•°ä¸º 2ã€‚ æ‰«ææ•°å­— 3ï¼Œæ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3ï¼Œæ¬¡æ•°ä¸º 2ã€‚ æŒ‰ç…§è¿™ç§èŠ‚å¥ï¼Œæ‰«æç»“æŸåï¼Œæ–°å»ºæ•°ç»„ä¸­å­˜æ”¾äº†æ•´ä¸ªåºåˆ—ä»¥åŠæ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°ã€‚ æœ€åè¾“å‡ºç›®æ ‡æ•´æ•°åºåˆ—ã€‚ è¾“å‡ºæ•°å­— 2ï¼ŒåŒæ—¶æ•°ç»„ä¸­ index ä¸º 0 çš„å€¼ä¸º 2 çš„å…ƒç´ æ¬¡æ•°å˜ä¸º 0ã€‚ è¾“å‡ºæ•°å­— 3ï¼ŒåŒæ—¶æ•°ç»„ä¸­ index ä¸º 1 çš„å€¼ä¸º 3 çš„å…ƒç´ æ¬¡æ•°å˜ä¸º 1ã€‚ åŒæ ·çš„æ“ä½œï¼Œæ•´ä¸ªåºåˆ—å°±å®Œå…¨è¾“å‡ºäº†ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;import java.util.Arrays;/** * @author: whb * @description: è®¡æ•°æ’åº */public class CountingSort { public static int[] countingSort(int[] unsorted) { //å¼€å§‹å£°æ˜æ¡¶,æ‰¾åˆ°æ•°ç»„çš„æœ€å°å€¼å’Œæœ€å¤§å€¼ int minNum = unsorted[0]; int maxNum = unsorted[0]; for (int i = 0; i &lt; unsorted.length; i++) { if (unsorted[i] &lt; minNum) { minNum = unsorted[i]; } if (unsorted[i] &gt; maxNum) { maxNum = unsorted[i]; } } System.out.println("æœ€å°æ•°å­—ä¸º:" + minNum); System.out.println("æœ€å¤§æ•°å­—ä½:" + maxNum); //æ‰¾åˆ°æœ€å¤§æœ€å°å€¼çš„ä¹‹å,å°±å¼€å§‹å£°æ˜æœ‰åºæ¡¶,æ¡¶çš„åˆå§‹ä½ä»£è¡¨çš„å€¼ä¸ºminNumæœ€å¤§å€¼ä¸ºmaxNum //æ•°ç»„çš„é•¿åº¦ä¸º(maxNum-minNum+1) int[] bucket = new int[(maxNum - minNum + 1)]; //å£°æ˜äº†æœ‰åºæ¡¶ä¹‹å,å¼€å§‹å¯¹æ•°å­—è¿›è¡Œæ”¾æ¡¶æ“ä½œ for (int j = 0; j &lt; unsorted.length; j++) { //å› ä¸ºæ˜¯æ‰¾åˆ°äº†å¾…æ’åºæ•°ç»„çš„æœ€å°å€¼minNum,æ‰€ä»¥,ä¸æ•°ç»„æ•°ç»„æ¯”è¾ƒçš„å€¼åº”ä¸º(j+minNum) //å¦‚æœéå†çš„å€¼å¤§å°ä¸æ•°ç»„ä»£è¡¨çš„æ•°å­—å¤§å°ç›¸ç­‰,åˆ™æ”¾å…¥ //jæ¬¡å¾ªç¯å¾—åˆ°çš„æ•°å­—æ˜¯tempArray[j],åˆ™å­˜å‚¨åˆ°ä¸‹æ ‡ä¸ºtempArray[j]+minNumçš„æ¡¶ä¸­ bucket[unsorted[j] - minNum] = bucket[unsorted[j] - minNum] + 1; } //å°†å¾—åˆ°çš„æ¡¶æ’åºç»“æœè¿›è¡Œè¾“å‡º,è¾“å‡ºçš„æ˜¯æ¡¶æ’åºçš„æ•°ç»„çš„ä¸‹æ ‡ //å¯ä»¥å£°æ˜æ–°æ•°ç»„å¯¹è¯¥åºåˆ—è¿›è¡Œå­˜å‚¨ int[] sorted = new int[unsorted.length]; int count = 0; for (int k = 0; k &lt; bucket.length; k++) { if (bucket[k] != 0) { //æ¡¶é‡Œè£…çš„å€¼å¯èƒ½ä¸æ˜¯1,æ‰€ä»¥,åœ¨ä¸ç­‰äºä¸€çš„æ—¶å€™,å¯¹æ¡¶é‡Œé¢çš„æ•°å­—è¿›è¡Œéå†å­˜å‚¨ if (bucket[k] != 1) { for (int z = 0; z &lt; bucket[k]; z++) { sorted[count] = k + minNum; count++; } } else { sorted[count] = k + minNum; count++; } } } return sorted; } public static void main(String[] args) { //äº§ç”Ÿéšæœºå¾…æ’åºåˆ— int[] unsorted = new int[(int) (Math.random() * 11) + 5]; for (int i = 0; i &lt; unsorted.length; i++) { unsorted[i] = (int) (Math.random() * 100); } System.out.println("**************è®¡æ•°æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); int[] sorted = countingSort(unsorted); CommonUtils.display(sorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - é¸½å·¢æ’åº]]></title>
    <url>%2Fposts%2Fd7da214b.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ é¸½å·¢æ’åºæ˜¯æ¡¶æ’åºçš„ä¸€ç§ï¼Œé¡¾åæ€ä¹‰ï¼Œå°±æ˜¯ä¸€æ’é¸½å·¢ï¼Œçœ‹é‡Œé¢æœ‰å‡ ä¸ªé¸½å·¢ï¼Œç„¶åéå†è¿™äº›é¸½å·¢ï¼Œæ‰“å°å‡ºæ¥å°±å¥½ï¼Œæ’åºä¹‹å‰å¾—å…ˆçŸ¥é“åŒºé—´å’Œæœ€å¤§å€¼ã€‚ æ¯”å¦‚æœ‰æ•°ç»„a = [2,7,5,9,8,8]ï¼Œæˆ‘ä»¬éœ€è¦å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ’åºï¼Œè¿™æ˜¯ä¸€ä¸ªæœ€å¤§å€¼ä¸è¶…è¿‡10çš„æ•°ç»„ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®šåŒºé—´ä¸º0-10ï¼Œå®šä¹‰ä¸€ä¸ªä¸‹æ ‡0-10è¿™æ ·ä¸€ä¸ª11ä½æ•°ç»„b,åˆå§‹åŒ–å€¼ä¸º0ã€‚ç„¶åéå†å·²çŸ¥æ•°ç»„aï¼Œé€šè¿‡açš„ä¸€é¡¹ä¸€é¡¹çš„å€¼å’Œæˆ‘ä»¬å®šä¹‰çš„æ•°ç»„bçš„ä¸‹æ ‡è¿›è¡Œå¯¹åº”ã€‚ éå†å¼€å§‹ï¼š å–a[0]=2ï¼Œç„¶åæ“ä½œb[2]=1 å–a[1]=7ï¼Œç„¶åæ“ä½œb[7]=1 å–a[2]=5ï¼Œç„¶åæ“ä½œb[5]=1 å–a[3]=9ï¼Œç„¶åæ“ä½œb[9]=1 å–a[4]=8ï¼Œç„¶åæ“ä½œb[8]=1 å–a[5]=8ï¼Œç„¶åæ“ä½œb[8]=2ï¼ˆæ³¨æ„äº†å“¦ï¼‰ è¿™æ ·å°±å¯¹å·å…¥åº§äº†ï¼Œä¹‹åéå†bï¼Œå¦‚æœbä¸­æŸä¸ªå°æ ‡å¯¹åº”çš„å€¼æ˜¯å¤šä¸ªï¼Œåˆ™éå†å¤šæ¬¡ï¼ŒæŠŠä¸æ˜¯0çš„ç»™æ‰“å°å‡ºæ¥ï¼Œç»“æœå°±æ˜¯æˆ‘ä»¬æƒ³è¦çš„äº† ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é¸½å·¢æ’åº * åŸç†ç±»ä¼¼æ¡¶æ’åº,åŒæ ·éœ€è¦ä¸€ä¸ªå¾ˆå¤§çš„é¸½å·¢[æ¡¶æ’åºé‡Œç®¡è¿™ä¸ªå«æ¡¶,åå­—æ— æ‰€è°“] * é¸½å·¢å…¶å®å°±æ˜¯æ•°ç»„,æ•°ç»„çš„ç´¢å¼•ä½ç½®å°±è¡¨ç¤ºå€¼,è¯¥ç´¢å¼•ä½ç½®çš„å€¼è¡¨ç¤ºå‡ºç°æ¬¡æ•°,å¦‚æœå…¨éƒ¨ä¸º1æ¬¡æˆ–0æ¬¡é‚£å°±æ˜¯æ¡¶æ’åº * ä¾‹å¦‚ * int[] pigeonHole = new int[100]; * pigeonHole[0]çš„å€¼è¡¨ç¤º0çš„å‡ºç°æ¬¡æ•°... * pigeonHole[1]çš„å€¼è¡¨ç¤º1çš„å‡ºç°æ¬¡æ•°... * pigeonHole[2]çš„å€¼è¡¨ç¤º2çš„å‡ºç°æ¬¡æ•°... */public class PigeonholeSort { /** * é¸½å·¢æ’åº * * @param unsorted å¾…æ’åºåˆ— * @param maxNumber æœ€å¤§æ•° * @return */ public static int[] pigeonholeSort(int[] unsorted, int maxNumber) { int[] pogeonHole = new int[maxNumber + 1]; for (int item : unsorted) { pogeonHole[item]++; } return pogeonHole; } public static void main(String[] args) { int[] unsorted = {99, 65, 24, 47, 47, 50, 99, 88, 66, 33, 66, 67, 31, 18, 24}; System.out.println("**************é¸½å·¢æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); int[] sorted = pigeonholeSort(unsorted, 99); System.out.println("æ’åºåï¼š"); for (int i = 0; i &lt; sorted.length; i++) { for (int j = 0; j &lt; sorted[i]; j++) { System.out.print(i + " "); } } }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - åŸºæ•°æ’åº]]></title>
    <url>%2Fposts%2Fed3439ee.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åŸºæ•°æ’åºè¿‡ç¨‹æ— é¡»æ¯”è¾ƒå…³é”®å­—ï¼Œè€Œæ˜¯é€šè¿‡â€œåˆ†é…â€å’Œâ€œæ”¶é›†â€è¿‡ç¨‹æ¥å®ç°æ’åºã€‚å®ƒä»¬çš„æ—¶é—´å¤æ‚åº¦å¯è¾¾åˆ°çº¿æ€§é˜¶ï¼šO(n)ã€‚ å®ä¾‹ æ‰‘å…‹ç‰Œä¸­52å¼ ç‰Œï¼Œå¯æŒ‰èŠ±è‰²å’Œé¢å€¼åˆ†æˆä¸¤ä¸ªå­—æ®µï¼Œå…¶å¤§å°å…³ç³»ä¸ºï¼š èŠ±è‰²ï¼š æ¢…èŠ±&lt; æ–¹å—&lt; çº¢å¿ƒ&lt; é»‘å¿ƒ é¢å€¼ï¼š 2 &lt; 3 &lt; 4 &lt; 5 &lt; 6 &lt; 7 &lt; 8 &lt; 9 &lt; 10 &lt; J &lt; Q &lt; K &lt; A è‹¥å¯¹æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼è¿›è¡Œå‡åºæ’åºï¼Œå¾—åˆ°å¦‚ä¸‹åºåˆ—ï¼š å³ä¸¤å¼ ç‰Œï¼Œè‹¥èŠ±è‰²ä¸åŒï¼Œä¸è®ºé¢å€¼æ€æ ·ï¼ŒèŠ±è‰²ä½çš„é‚£å¼ ç‰Œå°äºèŠ±è‰²é«˜çš„ï¼Œåªæœ‰åœ¨åŒèŠ±è‰²æƒ…å†µä¸‹ï¼Œå¤§å°å…³ç³»æ‰ç”±é¢å€¼çš„å¤§å°ç¡®å®šã€‚è¿™å°±æ˜¯å¤šå…³é”®ç æ’åºã€‚ ä¸ºå¾—åˆ°æ’åºç»“æœï¼Œæˆ‘ä»¬è®¨è®ºä¸¤ç§æ’åºæ–¹æ³•ã€‚ æ–¹æ³•1ï¼šå…ˆå¯¹èŠ±è‰²æ’åºï¼Œå°†å…¶åˆ†ä¸º4 ä¸ªç»„ï¼Œå³æ¢…èŠ±ç»„ã€æ–¹å—ç»„ã€çº¢å¿ƒç»„ã€é»‘å¿ƒç»„ã€‚å†å¯¹æ¯ä¸ªç»„åˆ†åˆ«æŒ‰é¢å€¼è¿›è¡Œæ’åºï¼Œæœ€åï¼Œå°†4 ä¸ªç»„è¿æ¥èµ·æ¥å³å¯ã€‚ æ–¹æ³•2ï¼šå…ˆæŒ‰13 ä¸ªé¢å€¼ç»™å‡º13 ä¸ªç¼–å·ç»„(2 å·ï¼Œ3 å·ï¼Œ...ï¼ŒA å·)ï¼Œå°†ç‰ŒæŒ‰é¢å€¼ä¾æ¬¡æ”¾å…¥å¯¹åº”çš„ç¼–å·ç»„ï¼Œåˆ†æˆ13 å †ã€‚å†æŒ‰èŠ±è‰²ç»™å‡º4 ä¸ªç¼–å·ç»„(æ¢…èŠ±ã€æ–¹å—ã€çº¢å¿ƒã€é»‘å¿ƒ)ï¼Œå°†2å·ç»„ä¸­ç‰Œå–å‡ºåˆ†åˆ«æ”¾å…¥å¯¹åº”èŠ±è‰²ç»„ï¼Œå†å°†3 å·ç»„ä¸­ç‰Œå–å‡ºåˆ†åˆ«æ”¾å…¥å¯¹åº”èŠ±è‰²ç»„ï¼Œâ€¦â€¦ï¼Œè¿™æ ·ï¼Œ4 ä¸ªèŠ±è‰²ç»„ä¸­å‡æŒ‰é¢å€¼æœ‰åºï¼Œç„¶åï¼Œå°†4 ä¸ªèŠ±è‰²ç»„ä¾æ¬¡è¿æ¥èµ·æ¥å³å¯ã€‚ è®¾n ä¸ªå…ƒç´ çš„å¾…æ’åºåˆ—åŒ…å«d ä¸ªå…³é”®ç {k1ï¼Œk2ï¼Œâ€¦ï¼Œkd}ï¼Œåˆ™ç§°åºåˆ—å¯¹å…³é”®ç {k1ï¼Œk2ï¼Œâ€¦ï¼Œkd}æœ‰åºæ˜¯æŒ‡ï¼šå¯¹äºåºåˆ—ä¸­ä»»ä¸¤ä¸ªè®°å½•r[i]å’Œrjéƒ½æ»¡è¶³ä¸‹åˆ—æœ‰åºå…³ç³»ï¼š å…¶ä¸­k1 ç§°ä¸ºæœ€ä¸»ä½å…³é”®ç ï¼Œkd ç§°ä¸ºæœ€æ¬¡ä½å…³é”®ç ã€‚ ä¸¤ç§å¤šå…³é”®ç æ’åºæ–¹æ³• å¤šå…³é”®ç æ’åºæŒ‰ç…§ä»æœ€ä¸»ä½å…³é”®ç åˆ°æœ€æ¬¡ä½å…³é”®ç æˆ–ä»æœ€æ¬¡ä½åˆ°æœ€ä¸»ä½å…³é”®ç çš„é¡ºåºé€æ¬¡æ’åºï¼Œåˆ†ä¸¤ç§æ–¹æ³•ï¼š æœ€é«˜ä½ä¼˜å…ˆ(Most Significant Digit first)æ³•ï¼Œç®€ç§°MSD æ³•ï¼š 1ï¼‰å…ˆæŒ‰k1 æ’åºåˆ†ç»„ï¼Œå°†åºåˆ—åˆ†æˆè‹¥å¹²å­åºåˆ—ï¼ŒåŒä¸€ç»„åºåˆ—çš„è®°å½•ä¸­ï¼Œå…³é”®ç k1 ç›¸ç­‰ã€‚ 2ï¼‰å†å¯¹å„ç»„æŒ‰k2 æ’åºåˆ†æˆå­ç»„ï¼Œä¹‹åï¼Œå¯¹åé¢çš„å…³é”®ç ç»§ç»­è¿™æ ·çš„æ’åºåˆ†ç»„ï¼Œç›´åˆ°æŒ‰æœ€æ¬¡ä½å…³é”®ç kd å¯¹å„å­ç»„æ’åºåã€‚ 3ï¼‰å†å°†å„ç»„è¿æ¥èµ·æ¥ï¼Œä¾¿å¾—åˆ°ä¸€ä¸ªæœ‰åºåºåˆ—ã€‚æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼æ’åºä¸­ä»‹ç»çš„æ–¹æ³•ä¸€å³æ˜¯MSD æ³•ã€‚ æœ€ä½ä½ä¼˜å…ˆ(Least Significant Digit first)æ³•ï¼Œç®€ç§°LSD æ³•ï¼š å…ˆä»kd å¼€å§‹æ’åºï¼Œå†å¯¹kd-1è¿›è¡Œæ’åºï¼Œä¾æ¬¡é‡å¤ï¼Œç›´åˆ°æŒ‰k1æ’åºåˆ†ç»„åˆ†æˆæœ€å°çš„å­åºåˆ—åã€‚ æœ€åå°†å„ä¸ªå­åºåˆ—è¿æ¥èµ·æ¥ï¼Œä¾¿å¯å¾—åˆ°ä¸€ä¸ªæœ‰åºçš„åºåˆ—, æ‰‘å…‹ç‰ŒæŒ‰èŠ±è‰²ã€é¢å€¼æ’åºä¸­ä»‹ç»çš„æ–¹æ³•äºŒå³æ˜¯LSD æ³•ã€‚ åŸºäºLSDæ–¹æ³•çš„é“¾å¼åŸºæ•°æ’åºçš„åŸºæœ¬æ€æƒ³ â€œå¤šå…³é”®å­—æ’åºâ€çš„æ€æƒ³å®ç°â€œå•å…³é”®å­—æ’åºâ€ã€‚å¯¹æ•°å­—å‹æˆ–å­—ç¬¦å‹çš„å•å…³é”®å­—ï¼Œå¯ä»¥çœ‹ä½œç”±å¤šä¸ªæ•°ä½æˆ–å¤šä¸ªå­—ç¬¦æ„æˆçš„å¤šå…³é”®å­—ï¼Œæ­¤æ—¶å¯ä»¥é‡‡ç”¨â€œåˆ†é…-æ”¶é›†â€çš„æ–¹æ³•è¿›è¡Œæ’åºï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä½œåŸºæ•°æ’åºæ³•ï¼Œå…¶ä¸­æ¯ä¸ªæ•°å­—æˆ–å­—ç¬¦å¯èƒ½çš„å–å€¼ä¸ªæ•°ç§°ä¸ºåŸºæ•°ã€‚æ¯”å¦‚ï¼Œæ‰‘å…‹ç‰Œçš„èŠ±è‰²åŸºæ•°ä¸º4ï¼Œé¢å€¼åŸºæ•°ä¸º13ã€‚åœ¨æ•´ç†æ‰‘å…‹ç‰Œæ—¶ï¼Œæ—¢å¯ä»¥å…ˆæŒ‰èŠ±è‰²æ•´ç†ï¼Œä¹Ÿå¯ä»¥å…ˆæŒ‰é¢å€¼æ•´ç†ã€‚æŒ‰èŠ±è‰²æ•´ç†æ—¶ï¼Œå…ˆæŒ‰çº¢ã€é»‘ã€æ–¹ã€èŠ±çš„é¡ºåºåˆ†æˆ4æ‘ï¼ˆåˆ†é…ï¼‰ï¼Œå†æŒ‰æ­¤é¡ºåºå†å æ”¾åœ¨ä¸€èµ·ï¼ˆæ”¶é›†ï¼‰ï¼Œç„¶åæŒ‰é¢å€¼çš„é¡ºåºåˆ†æˆ13æ‘ï¼ˆåˆ†é…ï¼‰ï¼Œå†æŒ‰æ­¤é¡ºåºå æ”¾åœ¨ä¸€èµ·ï¼ˆæ”¶é›†ï¼‰ï¼Œå¦‚æ­¤è¿›è¡ŒäºŒæ¬¡åˆ†é…å’Œæ”¶é›†å³å¯å°†æ‰‘å…‹ç‰Œæ’åˆ—æœ‰åºã€‚ åŸºæ•°æ’åº: æ˜¯æŒ‰ç…§ä½ä½å…ˆæ’åºï¼Œç„¶åæ”¶é›†ï¼›å†æŒ‰ç…§é«˜ä½æ’åºï¼Œç„¶åå†æ”¶é›†ï¼›ä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°æœ€é«˜ä½ã€‚æœ‰æ—¶å€™æœ‰äº›å±æ€§æ˜¯æœ‰ä¼˜å…ˆçº§é¡ºåºçš„ï¼Œå…ˆæŒ‰ä½ä¼˜å…ˆçº§æ’åºï¼Œå†æŒ‰é«˜ä¼˜å…ˆçº§æ’åºã€‚æœ€åçš„æ¬¡åºå°±æ˜¯é«˜ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ï¼Œé«˜ä¼˜å…ˆçº§ç›¸åŒçš„ä½ä¼˜å…ˆçº§é«˜çš„åœ¨å‰ã€‚åŸºæ•°æ’åºåŸºäºåˆ†åˆ«æ’åºï¼Œåˆ†åˆ«æ”¶é›†ï¼Œæ‰€ä»¥æ˜¯ç¨³å®šçš„ã€‚ ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: åŸºæ•°æ’åºï¼šè¿‡ç¨‹æ— é¡»æ¯”è¾ƒå…³é”®å­—ï¼Œè€Œæ˜¯é€šè¿‡â€œåˆ†é…â€å’Œâ€œæ”¶é›†â€è¿‡ç¨‹æ¥å®ç°æ’åºã€‚ * å¹³å‡O(d(n+r)),æœ€å¥½O(d(n+r)),æœ€åO(d(n+r));ç©ºé—´å¤æ‚åº¦O(n+r);ç¨³å®š;è¾ƒå¤æ‚ * dä¸ºä½æ•°,rä¸ºåˆ†é…åé“¾è¡¨çš„ä¸ªæ•° */public class RadixSort { /** * åŸºæ•°æ’åº * * @param unsorted å¾…æ’æ•°ç»„ * @param max æœ€å¤§å‡ ä½æ•° */ public static void radixSort(int[] unsorted, int max) { //countæ•°ç»„ç”¨æ¥è®¡æ•° int[] count = new int[unsorted.length]; //bucketç”¨æ¥å½“æ¡¶ï¼Œæ”¾æ•°æ®ï¼Œå–æ•°æ® int[] bucket = new int[unsorted.length]; //kè¡¨ç¤ºç¬¬å‡ ä½ï¼Œ1ä»£è¡¨ä¸ªä½ï¼Œ2ä»£è¡¨åä½ï¼Œ3ä»£è¡¨ç™¾ä½ for (int k = 1; k &lt;= max; k++) { //æŠŠcountç½®ç©ºï¼Œé˜²æ­¢ä¸Šæ¬¡å¾ªç¯çš„æ•°æ®å½±å“ for (int i = 0; i &lt; unsorted.length; i++) { count[i] = 0; } //åˆ†åˆ«ç»Ÿè®¡ç¬¬kä½æ˜¯0,1,2,3,4,5,6,7,8,9çš„æ•°é‡ //ä»¥ä¸‹ä¾¿ç§°ä¸ºæ¡¶ //å³æ­¤å¾ªç¯ç”¨æ¥ç»Ÿè®¡æ¯ä¸ªæ¡¶ä¸­çš„æ•°æ®çš„æ•°é‡ for (int i = 0; i &lt; unsorted.length; i++) { count[getFigure(unsorted[i], k)]++; } //åˆ©ç”¨count[i]æ¥ç¡®å®šæ”¾ç½®æ•°æ®çš„ä½ç½® for (int i = 1; i &lt; unsorted.length; i++) { count[i] = count[i] + count[i - 1]; } //æ‰§è¡Œå®Œæ­¤å¾ªç¯ä¹‹åçš„count[i]å°±æ˜¯ç¬¬iä¸ªæ¡¶å³è¾¹ç•Œçš„ä½ç½® //åˆ©ç”¨å¾ªç¯æŠŠæ•°æ®è£…å…¥å„ä¸ªæ¡¶ä¸­ï¼Œæ³¨æ„æ˜¯ä»åå¾€å‰è£… for (int i = unsorted.length - 1; i &gt;= 0; i--) { int j = getFigure(unsorted[i], k); bucket[count[j] - 1] = unsorted[i]; count[j]--; } //å°†æ¡¶ä¸­çš„æ•°æ®å–å‡ºæ¥ï¼Œèµ‹å€¼ç»™unsorted for (int i = 0, j = 0; i &lt; unsorted.length; i++, j++) { unsorted[i] = bucket[j]; } } } /** * è¿”å›æ•´å‹æ•°numçš„ç¬¬posä½æ˜¯ä»€ä¹ˆ * * @param num æ•´æ•°num * @param pos pos=1è¡¨ç¤ºä¸ªä½ï¼Œpos=2è¡¨ç¤ºåä½ * @return */ public static int getFigure(int num, int pos) { int tmp = 1; for (int i = 0; i &lt; pos - 1; i++) { tmp *= 10; } return (num / tmp) % 10; } /** * äºŒç»´æ•°ç»„çš„æ–¹å¼å®ç°åŸºæ•°æ’åº * * @param unsorted å¾…æ’åºåˆ— * @param arr_x æœ€å¤§æ•°å­—ä¸è¶…è¿‡999999999...(array_xä¸ª9) * @param arr_y æœ€å¤§ä½æ•° */ public static void radix_sort(int[] unsorted, int arr_x, int arr_y) { for (int i = 0; i &lt; arr_x; i++) { int[][] bucket = new int[arr_x][arr_y]; //åˆ†é… for (int item : unsorted) { int temp = (item / (int) Math.pow(10, i)) % 10; for (int j = 0; j &lt; arr_y; j++) { if (bucket[temp][j] == 0) { bucket[temp][j] = item; break; } } } //æ”¶é›† for (int o = 0, x = 0; x &lt; arr_x; x++) { for (int y = 0; y &lt; arr_y; y++) { if (bucket[x][y] == 0) { continue; } unsorted[o++] = bucket[x][y]; } } } } public static void main(String[] args) { //å®šä¹‰å¾…æ’æ•´å‹æ•°ç»„ int[] arr = {21, 56, 88, 195, 354, 1, 35, 12, 6, 7}; System.out.println("**************åŸºæ•°æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(arr); //è°ƒç”¨åŸºæ•°æ’åºå‡½æ•° radixSort(arr, 3); System.out.println("æ’åºåï¼š"); //è¾“å‡ºæ’åºåçš„æ•°ç»„ CommonUtils.display(arr); System.out.println(" "); int[] unsorted = {999999999, 65, 24, 47, 13, 50, 92, 88, 66, 33, 22445, 10001, 624159, 624158, 624155501}; System.out.println("**************äºŒç»´æ•°ç»„æ–¹å¼å®ç°çš„åŸºæ•°æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); radix_sort(unsorted, 10, 100); System.out.println("æ’åºåï¼š"); for (int tmp : unsorted) { if (tmp &gt; 0) { System.out.print(tmp + " "); } } }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[å“†å•¦Aæ¢¦]]></title>
    <url>%2Fposts%2F9a1a736f.html</url>
    <content type="text"><![CDATA[ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;meta charset="utf-8"/&gt; &lt;title&gt;å“†å•¦Aæ¢¦&lt;/title&gt; &lt;style&gt; body { margin: 0; padding: 0; } #doraemon { background-color: #fff; display: block; } &lt;/style&gt;&lt;/head&gt;&lt;body onmousemove="zuobiao(event)"&gt;&lt;canvas id="doraemon" width="400" height="600"&gt;&lt;/canvas&gt;&lt;div id="put" style="width: 50px" height="20px"&gt;&lt;/div&gt;&lt;script&gt; window.onload = function () { var cxt = document.getElementById('doraemon').getContext('2d'); /* å¤´éƒ¨*/ cxt.beginPath();//èµ·å§‹è·¯å¾„ cxt.lineWidth = 1;//çº¿å®½åº¦ä¸º1 cxt.strokeStyle = '#000';//ç¬”è§¦çš„é¢œè‰² cxt.arc(200, 175, 175, 0.7 * Math.PI, 0.3 * Math.PI);//ç»˜åˆ¶å¼§ï¼Œä¸­å¿ƒç‚¹ï¼ˆ200ï¼Œ175ï¼‰ï¼ŒåŠå¾„175 cxt.fillStyle = '#0bb0da';//è®¾ç½®å¡«å……æ—¶çš„é¢œè‰² cxt.fill();//å¡«å……é¢œè‰² cxt.stroke();//ç»˜åˆ¶è·¯å¾„ /*è„¸éƒ¨*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.moveTo(110, 110);//å°†è·¯å¾„ç§»åˆ°ç‚¹ï¼ˆ110ï¼Œ110ï¼‰ï¼Œä¸åˆ›å»ºçº¿æ¡ cxt.quadraticCurveTo(-10, 200, 120, 315);//åˆ›å»ºäºŒæ¬¡è´å¡å°”æ›²çº¿,æ§åˆ¶ç‚¹(-10,200),ç»“æŸç‚¹(120,315) cxt.lineTo(280, 315);//æ·»åŠ ä¸€ä¸ªæ–°ç‚¹ï¼Œç„¶ååœ¨ç”»å¸ƒä¸­åˆ›å»ºä»ï¼ˆ110ï¼Œ110ï¼‰åˆ°ï¼ˆ280ï¼Œ315ï¼‰çš„çº¿æ¡ cxt.quadraticCurveTo(410, 210, 290, 110); cxt.lineTo(110, 110); cxt.fill(); cxt.stroke(); /*çœ¼ç›*/ cxt.beginPath(); cxt.lineWidth = 1; cxt.fillStyle = '#fff'; cxt.moveTo(110, 110); cxt.bezierCurveTo(110, 25, 200, 25, 200, 100);//åˆ›å»ºä¸‰æ¬¡è´å¡å°”æ›²çº¿,æ§åˆ¶ç‚¹1(110,25),æ§åˆ¶ç‚¹2(200,25),ç»“æŸç‚¹(200,100)ï¼Œä¹Ÿå°±æ˜¯ç”»å·¦ä¸ŠåŠæ¤­åœ† cxt.bezierCurveTo(200, 175, 110, 175, 110, 100);//ç”»å·¦ä¸‹åŠæ¤­åœ† cxt.moveTo(200, 100); cxt.bezierCurveTo(200, 25, 290, 25, 290, 100); cxt.bezierCurveTo(290, 175, 200, 175, 200, 100); cxt.fill(); cxt.stroke(); /*å³çœ¼çƒ*/ cxt.beginPath(); cxt.fillStyle = '#000'; cxt.arc(230, 130, 12, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /*å·¦çœ¼çƒ*/ cxt.beginPath(); cxt.fillStyle = '#000'; cxt.arc(170, 130, 12, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /* é¼»å­*/ cxt.beginPath(); cxt.arc(200, 165, 25, 0, 2 * Math.PI); cxt.fillStyle = '#d05823'; cxt.fill(); cxt.stroke(); /*èƒ¡é¡»*/ //å·¦èƒ¡é¡» cxt.beginPath(); cxt.moveTo(80, 175); cxt.lineTo(150, 195); cxt.moveTo(80, 200); cxt.lineTo(150, 205); cxt.moveTo(80, 225); cxt.lineTo(150, 215); //ä¸­éƒ¨èƒ¡é¡» cxt.moveTo(200, 195); cxt.lineTo(200, 290); //å³èƒ¡é¡» cxt.moveTo(250, 195); cxt.lineTo(320, 175); cxt.moveTo(250, 205); cxt.lineTo(320, 200); cxt.moveTo(250, 215); cxt.lineTo(320, 225); cxt.stroke(); /*å˜´*/ cxt.moveTo(80, 240); cxt.quadraticCurveTo(200, 350, 320, 240); cxt.stroke(); /*å›´å·¾*/ cxt.beginPath(); cxt.moveTo(96, 316); cxt.lineTo(305, 316); cxt.lineTo(320, 316); cxt.arcTo(330, 316, 330, 326, 10);//åœ¨ç”»å¸ƒä¸Šåˆ›å»ºä»‹äºä¸¤ä¸ªåˆ‡çº¿ä¹‹é—´çš„å¼§ï¼Œèµ·ç‚¹åæ ‡ä¸º(330,316),ç»ˆç‚¹åæ ‡ä¸º(330,326),åŠå¾„ä¸º10 cxt.lineTo(330, 336); cxt.arcTo(330, 346, 305, 346, 10); cxt.lineTo(81, 346); cxt.arcTo(71, 346, 71, 336, 10); cxt.lineTo(71, 326); cxt.arcTo(71, 316, 81, 316, 10); cxt.lineTo(96, 316); cxt.fillStyle = '#b13209'; cxt.fill(); cxt.stroke(); /*ä¸‹åŠèº«*/ cxt.beginPath(); cxt.fillStyle = '#0bb0da'; cxt.moveTo(80, 346); //å·¦è¡£æœ cxt.lineTo(26, 406); cxt.lineTo(65, 440); cxt.lineTo(85, 418); cxt.lineTo(85, 528); cxt.lineTo(185, 528); //å³è¡£æœ cxt.lineTo(315, 528); cxt.lineTo(315, 418); cxt.lineTo(337, 440); cxt.lineTo(374, 406); cxt.lineTo(320, 346); cxt.fill(); cxt.stroke(); /*æ‰‹*/ //å·¦æ‰‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(37, 433, 30, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); //å³æ‰‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(363, 433, 30, 0, 2 * Math.PI); cxt.fill(); cxt.stroke(); /*è‚š*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(200, 400, 91, 1.8 * Math.PI, 1.2 * Math.PI); cxt.fill(); cxt.stroke(); //å°å£è¢‹ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.moveTo(130, 394); cxt.lineTo(270, 394); cxt.moveTo(130, 394); cxt.bezierCurveTo(130, 490, 270, 490, 270, 394); cxt.fill(); cxt.stroke(); /*ä¸¤åªè„šçš„ç©ºéš™*/ cxt.beginPath(); cxt.fillStyle = '#fff'; cxt.arc(200, 529, 20,Math.PI, 0); cxt.fill(); cxt.stroke(); /*è„š*/ //å·¦è„š cxt.beginPath(); cxt.fillStyle='#fff'; cxt.moveTo(180,528); cxt.lineTo(72,528); cxt.bezierCurveTo(52,528,52,558,72,558); cxt.lineTo(180,558); cxt.moveTo(180,558); cxt.bezierCurveTo(200,558,200,528,180,528); cxt.fill(); cxt.stroke(); //å³è„š cxt.beginPath(); cxt.fillStyle='#fff'; cxt.moveTo(220,528); cxt.lineTo(328,528); cxt.bezierCurveTo(348,528,348,558,328,558); cxt.lineTo(220,558); cxt.moveTo(220,558); cxt.bezierCurveTo(200,558,200,528,220,528); cxt.fill(); cxt.stroke(); }; //æ˜¾ç¤ºåæ ‡ function zuobiao(event) { var x = event.clientX; var y = event.clientY; var out = document.getElementById("put"); out.innerHTML = "x:" + x + " y:" + y; }&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ•ˆæœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Html</category>
        <category>Js</category>
      </categories>
      <tags>
        <tag>Html</tag>
        <tag>Js</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å½’å¹¶æ’åº]]></title>
    <url>%2Fposts%2F9bca323a.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å½’å¹¶ï¼ˆMergeï¼‰æ’åºæ³•æ˜¯å°†ä¸¤ä¸ªï¼ˆæˆ–ä¸¤ä¸ªä»¥ä¸Šï¼‰æœ‰åºè¡¨åˆå¹¶æˆä¸€ä¸ªæ–°çš„æœ‰åºè¡¨ï¼Œå³æŠŠå¾…æ’åºåºåˆ—åˆ†ä¸ºè‹¥å¹²ä¸ªå­åºåˆ—ï¼Œæ¯ä¸ªå­åºåˆ—æ˜¯æœ‰åºçš„ã€‚ç„¶åå†æŠŠæœ‰åºå­åºåˆ—åˆå¹¶ä¸ºæ•´ä½“æœ‰åºåºåˆ—ã€‚ ç®—æ³•æ­¥éª¤ ç”³è¯·ç©ºé—´ï¼Œä½¿å…¶å¤§å°ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—ä¹‹å’Œï¼Œè¯¥ç©ºé—´ç”¨æ¥å­˜æ”¾åˆå¹¶åçš„åºåˆ— è®¾å®šä¸¤ä¸ªæŒ‡é’ˆï¼Œæœ€åˆä½ç½®åˆ†åˆ«ä¸ºä¸¤ä¸ªå·²ç»æ’åºåºåˆ—çš„èµ·å§‹ä½ç½® æ¯”è¾ƒä¸¤ä¸ªæŒ‡é’ˆæ‰€æŒ‡å‘çš„å…ƒç´ ï¼Œé€‰æ‹©ç›¸å¯¹å°çš„å…ƒç´ æ”¾å…¥åˆ°åˆå¹¶ç©ºé—´ï¼Œå¹¶ç§»åŠ¨æŒ‡é’ˆåˆ°ä¸‹ä¸€ä½ç½® é‡å¤æ­¥éª¤3ç›´åˆ°æŸä¸€æŒ‡é’ˆåˆ°è¾¾åºåˆ—å°¾ å°†å¦ä¸€åºåˆ—å‰©ä¸‹çš„æ‰€æœ‰å…ƒç´ ç›´æ¥å¤åˆ¶åˆ°åˆå¹¶åºåˆ—å°¾ ç®—æ³•æµç¨‹å›¾ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å½’å¹¶æ’åº */public class MergeSort { /** * å½’å¹¶æ’åºï¼ˆMerge Sortï¼‰ä¸å¿«é€Ÿæ’åºæ€æƒ³ç±»ä¼¼ï¼šå°†å¾…æ’åºæ•°æ®åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œç»§ç»­å°†ä¸¤ä¸ªå­éƒ¨åˆ†è¿›è¡Œé€’å½’çš„å½’å¹¶æ’åºï¼›ç„¶åå°†å·²ç»æœ‰åºçš„ä¸¤ä¸ªå­éƒ¨åˆ†è¿›è¡Œåˆå¹¶ï¼Œæœ€ç»ˆå®Œæˆæ’åºã€‚ * å…¶æ—¶é—´å¤æ‚åº¦ä¸å¿«é€Ÿæ’åºå‡ä¸ºO(nlogn)ï¼Œä½†æ˜¯å½’å¹¶æ’åºé™¤äº†é€’å½’è°ƒç”¨é—´æ¥ä½¿ç”¨äº†è¾…åŠ©ç©ºé—´æ ˆï¼Œè¿˜éœ€è¦é¢å¤–çš„O(n)ç©ºé—´è¿›è¡Œä¸´æ—¶å­˜å‚¨ã€‚ä»æ­¤è§’åº¦å½’å¹¶æ’åºç•¥é€Šäºå¿«é€Ÿæ’åºï¼Œä½†æ˜¯å½’å¹¶æ’åºæ˜¯ä¸€ç§ç¨³å®šçš„æ’åºç®—æ³•ï¼Œå¿«é€Ÿæ’åºåˆ™ä¸ç„¶ã€‚ * æ‰€è°“ç¨³å®šæ’åºï¼Œè¡¨ç¤ºå¯¹äºå…·æœ‰ç›¸åŒå€¼çš„å¤šä¸ªå…ƒç´ ï¼Œå…¶é—´çš„å…ˆåé¡ºåºä¿æŒä¸å˜ã€‚å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹è€Œè¨€ï¼Œä¸€ä¸ªæ’åºç®—æ³•æ˜¯å¦ç¨³å®šï¼Œå½±å“å¾ˆå°ï¼Œä½†æ˜¯å¯¹äºç»“æ„ä½“æ•°ç»„ï¼Œç¨³å®šæ’åºå°±ååˆ†é‡è¦ã€‚ä¾‹å¦‚å¯¹äºstudentç»“æ„ä½“æŒ‰ç…§å…³é”®å­—scoreè¿›è¡Œéé™åºæ’åºï¼š */ public static void mergeSort(int[] numArr, int[] tempArr, int head, int rear) { if (head &lt; rear) { //å–åˆ†å‰²ä½ç½® int middle = (head + rear) / 2; //é€’å½’åˆ’åˆ†åˆ—è¡¨çš„å·¦åºåˆ— mergeSort(numArr, tempArr, head, middle); //é€’å½’åˆ’åˆ†åˆ—è¡¨çš„å³åºåˆ— mergeSort(numArr, tempArr, middle + 1, rear); //åˆ—è¡¨çš„åˆå¹¶ merge(numArr, tempArr, head, middle + 1, rear); } } /** * åˆå¹¶æ“ä½œ(åˆ—è¡¨çš„ä¸¤ä¸¤åˆå¹¶) * * @param numArr * @param tempArr * @param head * @param middle * @param rear */ public static void merge(int[] numArr, int[] tempArr, int head, int middle, int rear) { //å·¦æŒ‡é’ˆå°¾ int headEnd = middle - 1; //å³æŒ‡é’ˆå¤´ int rearStart = middle; //ä¸´æ—¶è¡¨çš„ä¸‹æ ‡ int tempIndex = head; //åˆ—è¡¨åˆå¹¶åçš„é•¿åº¦ int tempLength = rear - head + 1; //å…ˆå¾ªç¯ä¸¤ä¸ªåŒºé—´æ®µéƒ½æ²¡æœ‰ç»“æŸçš„æƒ…å†µ while ((headEnd &gt;= head) &amp;&amp; (rearStart &lt;= rear)) { //å¦‚æœå‘ç°å³åºåˆ—å¤§ï¼Œåˆ™å°†æ­¤æ•°æ”¾å…¥ä¸´æ—¶åˆ—è¡¨ if (numArr[head] &lt; numArr[rearStart]) { tempArr[tempIndex++] = numArr[head++]; } else { tempArr[tempIndex++] = numArr[rearStart++]; } } //åˆ¤æ–­å·¦åºåˆ—æ˜¯å¦ç»“æŸ while (head &lt;= headEnd) { tempArr[tempIndex++] = numArr[head++]; } //åˆ¤æ–­å³åºåˆ—æ˜¯å¦ç»“æŸ while (rearStart &lt;= rear) { tempArr[tempIndex++] = numArr[rearStart++]; } //äº¤æ¢æ•°æ® for (int i = 0; i &lt; tempLength; i++) { numArr[rear] = tempArr[rear]; rear--; } } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************å½’å¹¶æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); mergeSort(numArr, new int[numArr.length], 0, numArr.length - 1); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-04ä¹‹-synchronizedå…³é”®å­—]]></title>
    <url>%2Fposts%2F2965099a.html</url>
    <content type="text"><![CDATA[synchronizedåŸç† &lt;font color="red"&gt;åœ¨javaä¸­ï¼Œæ¯ä¸€ä¸ªå¯¹è±¡æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªåŒæ­¥é”ã€‚è¿™ä¹Ÿæ„å‘³ç€ï¼ŒåŒæ­¥é”æ˜¯ä¾èµ–äºå¯¹è±¡è€Œå­˜åœ¨ã€‚&lt;/font&gt; &lt;font color="green"&gt;å½“æˆ‘ä»¬è°ƒç”¨æŸå¯¹è±¡çš„synchronizedæ–¹æ³•æ—¶ï¼Œå°±è·å–äº†è¯¥å¯¹è±¡çš„åŒæ­¥é”ã€‚&lt;/font&gt;ä¾‹å¦‚ï¼Œsynchronized(obj)å°±è·å–äº†â€œobjè¿™ä¸ªå¯¹è±¡â€çš„åŒæ­¥é”ã€‚ &lt;font color="green"&gt;ä¸åŒçº¿ç¨‹å¯¹åŒæ­¥é”çš„è®¿é—®æ˜¯äº’æ–¥çš„ã€‚&lt;/font&gt;ä¹Ÿå°±æ˜¯è¯´ï¼ŒæŸæ—¶é—´ç‚¹ï¼Œå¯¹è±¡çš„åŒæ­¥é”åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°ï¼é€šè¿‡åŒæ­¥é”ï¼Œæˆ‘ä»¬å°±èƒ½åœ¨å¤šçº¿ç¨‹ä¸­ï¼Œå®ç°å¯¹â€œå¯¹è±¡/æ–¹æ³•â€çš„äº’æ–¥è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œç°åœ¨æœ‰ä¸¤ä¸ªçº¿ç¨‹Aå’Œçº¿ç¨‹Bï¼Œå®ƒä»¬éƒ½ä¼šè®¿é—®â€œå¯¹è±¡objçš„åŒæ­¥é”â€ã€‚å‡è®¾ï¼Œåœ¨æŸä¸€æ—¶åˆ»ï¼Œçº¿ç¨‹Aè·å–åˆ°â€œobjçš„åŒæ­¥é”â€å¹¶åœ¨æ‰§è¡Œä¸€äº›æ“ä½œï¼›è€Œæ­¤æ—¶ï¼Œçº¿ç¨‹Bä¹Ÿä¼å›¾è·å–â€œobjçš„åŒæ­¥é”â€ â€”â€” çº¿ç¨‹Bä¼šè·å–å¤±è´¥ï¼Œå®ƒå¿…é¡»ç­‰å¾…ï¼Œç›´åˆ°çº¿ç¨‹Aé‡Šæ”¾äº†â€œè¯¥å¯¹è±¡çš„åŒæ­¥é”â€ä¹‹åçº¿ç¨‹Bæ‰èƒ½è·å–åˆ°â€œobjçš„åŒæ­¥é”â€ä»è€Œæ‰å¯ä»¥è¿è¡Œã€‚ synchronizedåŸºæœ¬è§„åˆ™ &lt;p id="div-border-left-red"&gt; 1. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ &lt;/p&gt; &lt;p id="div-border-left-red"&gt; 2. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éåŒæ­¥ä»£ç å—ã€‚ &lt;/p&gt; &lt;p id="div-border-left-red"&gt; 3. å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ &lt;/p&gt; ç¬¬ä¸€æ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ 12345678910111213141516171819202122232425262728293031323334package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ */public class Demo1_1 { public static void main(String[] args) { // æ–°å»ºâ€œRunnableå¯¹è±¡â€ Runnable demo = new MyRunable(); // æ–°å»ºâ€œçº¿ç¨‹t1â€, t1æ˜¯åŸºäºdemoè¿™ä¸ªRunnableå¯¹è±¡ Thread t1 = new Thread(demo, "t1"); // æ–°å»ºâ€œçº¿ç¨‹t2â€, t2æ˜¯åŸºäºdemoè¿™ä¸ªRunnableå¯¹è±¡ Thread t2 = new Thread(demo, "t2"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t2.start(); // å¯åŠ¨â€œçº¿ç¨‹t2â€ }}class MyRunable implements Runnable { @Override public void run() { synchronized (this) { try { for (int i = 0; i &lt; 5; i++) { // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " loop " + i); } } catch (InterruptedException ie) { } } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t1 loop 0t1 loop 1t1 loop 2t1 loop 3t1 loop 4t2 loop 0t2 loop 1t2 loop 2t2 loop 3t2 loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; run()æ–¹æ³•ä¸­å­˜åœ¨â€œsynchronized(this)ä»£ç å—â€ï¼Œè€Œä¸”t1å’Œt2éƒ½æ˜¯åŸºäº"demoè¿™ä¸ªRunnableå¯¹è±¡"åˆ›å»ºçš„çº¿ç¨‹ã€‚è¿™å°±æ„å‘³ç€ï¼Œæˆ‘ä»¬å¯ä»¥å°†synchronized(this)ä¸­çš„thisçœ‹ä½œæ˜¯â€œdemoè¿™ä¸ªRunnableå¯¹è±¡â€ï¼›å› æ­¤ï¼Œçº¿ç¨‹t1å’Œt2å…±äº«â€œdemoå¯¹è±¡çš„åŒæ­¥é”â€ã€‚æ‰€ä»¥ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¿è¡Œçš„æ—¶å€™ï¼Œå¦å¤–ä¸€ä¸ªçº¿ç¨‹å¿…é¡»ç­‰å¾…â€œè¿è¡Œçº¿ç¨‹â€é‡Šæ”¾â€œdemoçš„åŒæ­¥é”â€ä¹‹åæ‰èƒ½è¿è¡Œã€‚ æ¥ä¸‹æ¥å°†ä¸Šé¢çš„ä»£ç è¿›è¡Œä¿®æ”¹ï¼Œç„¶åå†è¿è¡Œçœ‹çœ‹ç»“æœæ€ä¹ˆæ ·ã€‚ä¿®æ”¹åçš„æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„è¯¥â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ */public class Demo1_2 { public static void main(String[] args) { // æ–°å»ºâ€œçº¿ç¨‹t1â€ Thread t1 = new MyThread("t1"); // æ–°å»ºâ€œçº¿ç¨‹t2â€ Thread t2 = new MyThread("t2"); t1.start(); // å¯åŠ¨â€œçº¿ç¨‹t1â€ t2.start(); // å¯åŠ¨â€œçº¿ç¨‹t2â€ }}class MyThread extends Thread { public MyThread(String name) { super(name); } @Override public void run() { synchronized (this) { try { for (int i = 0; i &lt; 5; i++) { // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " loop " + i); } } catch (InterruptedException ie) { } } }} &lt;span id="inline-purple"&gt; ä»£ç è¯´æ˜ï¼š &lt;/span&gt; æ¯”è¾ƒDemo1_2 å’Œ Demo1_1åå‘ç°ï¼ŒDemo1_2ä¸­çš„MyThreadç±»æ˜¯ç›´æ¥ç»§æ‰¿äºThreadï¼Œè€Œä¸”t1å’Œt2éƒ½æ˜¯MyThreadå­çº¿ç¨‹ã€‚ åœ¨â€œDemo1_2çš„run()æ–¹æ³•â€ä¹Ÿè°ƒç”¨äº†synchronized(this)ï¼Œæ­£å¦‚â€œDemo1_1çš„run()æ–¹æ³•â€ä¹Ÿè°ƒç”¨äº†synchronized(this)ä¸€æ ·ï¼ é‚£ä¹ˆï¼ŒDemo1_2çš„æ‰§è¡Œæµç¨‹æ˜¯ä¸æ˜¯å’ŒDemo1_1ä¸€æ ·å‘¢ï¼Ÿ &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t1 loop 0t2 loop 0t1 loop 1t2 loop 1t1 loop 2t2 loop 2t1 loop 3t2 loop 3t1 loop 4t2 loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; synchronized(this)ä¸­çš„thisæ˜¯æŒ‡â€œå½“å‰çš„ç±»å¯¹è±¡â€ï¼Œå³synchronized(this)æ‰€åœ¨çš„ç±»å¯¹åº”çš„å½“å‰å¯¹è±¡ã€‚å®ƒçš„ä½œç”¨æ˜¯è·å–â€œå½“å‰å¯¹è±¡çš„åŒæ­¥é”â€ã€‚ å¯¹äºDemo1_2ä¸­ï¼Œsynchronized(this)ä¸­çš„thisä»£è¡¨çš„æ˜¯MyThreadå¯¹è±¡ï¼Œè€Œt1å’Œt2æ˜¯ä¸¤ä¸ªä¸åŒçš„MyThreadå¯¹è±¡ï¼Œå› æ­¤t1å’Œt2åœ¨æ‰§è¡Œsynchronized(this)æ—¶ï¼Œè·å–çš„æ˜¯ä¸åŒå¯¹è±¡çš„åŒæ­¥é”ã€‚å¯¹äºDemo1_1å¯¹è€Œè¨€ï¼Œsynchronized(this)ä¸­çš„thisä»£è¡¨çš„æ˜¯MyRunableå¯¹è±¡ï¼›t1å’Œt2å…±åŒä¸€ä¸ªMyRunableå¯¹è±¡ï¼Œå› æ­¤ï¼Œä¸€ä¸ªçº¿ç¨‹è·å–äº†å¯¹è±¡çš„åŒæ­¥é”ï¼Œä¼šé€ æˆå¦å¤–ä¸€ä¸ªçº¿ç¨‹ç­‰å¾…ã€‚ ç¬¬äºŒæ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éåŒæ­¥ä»£ç å—ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹ä»ç„¶å¯ä»¥è®¿é—®â€œè¯¥å¯¹è±¡â€çš„éåŒæ­¥ä»£ç å—ã€‚ */public class Demo2 { public static void main(String[] args) { final Count count = new Count(); // æ–°å»ºt1, t1ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„synMethod()æ–¹æ³• Thread t1 = new Thread( new Runnable() { @Override public void run() { count.synMethod(); } }, "t1"); // æ–°å»ºt2, t2ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„nonSynMethod()æ–¹æ³• Thread t2 = new Thread( new Runnable() { @Override public void run() { count.nonSynMethod(); } }, "t2"); t1.start(); // å¯åŠ¨t1 t2.start(); // å¯åŠ¨t2 }}class Count { /** * å«æœ‰synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void synMethod() { synchronized (this) { try { for (int i = 0; i &lt; 5; i++) { // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " synMethod loop " + i); } } catch (InterruptedException ie) { } } } /** * éåŒæ­¥çš„æ–¹æ³• */ public void nonSynMethod() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " nonSynMethod loop " + i); } } catch (InterruptedException ie) { } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t1 synMethod loop 0t2 nonSynMethod loop 0t1 synMethod loop 1t2 nonSynMethod loop 1t1 synMethod loop 2t2 nonSynMethod loop 2t1 synMethod loop 3t2 nonSynMethod loop 3t1 synMethod loop 4t2 nonSynMethod loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹ä¸­æ–°å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹t1å’Œt2ã€‚t1ä¼šè°ƒç”¨countå¯¹è±¡çš„synMethod()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å†…å«æœ‰åŒæ­¥å—ï¼›è€Œt2åˆ™ä¼šè°ƒç”¨countå¯¹è±¡çš„nonSynMethod()æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯åŒæ­¥æ–¹æ³•ã€‚t1è¿è¡Œæ—¶ï¼Œè™½ç„¶è°ƒç”¨synchronized(this)è·å–â€œcountçš„åŒæ­¥é”â€ï¼›ä½†æ˜¯å¹¶æ²¡æœ‰é€ æˆt2çš„é˜»å¡ï¼Œå› ä¸ºt2æ²¡æœ‰ç”¨åˆ°â€œcountâ€åŒæ­¥é”ã€‚ ç¬¬ä¸‰æ¡è§„åˆ™ å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®â€œæŸå¯¹è±¡â€çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€æ—¶ï¼Œå…¶ä»–çº¿ç¨‹å¯¹â€œè¯¥å¯¹è±¡â€çš„å…¶ä»–çš„â€œsynchronizedæ–¹æ³•â€æˆ–è€…â€œsynchronizedä»£ç å—â€çš„è®¿é—®å°†è¢«é˜»å¡ã€‚ */public class Demo3 { public static void main(String[] args) { final Count2 count = new Count2(); // æ–°å»ºt1, t1ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„synMethod()æ–¹æ³• Thread t1 = new Thread( new Runnable() { @Override public void run() { count.synMethod(); } }, "t1"); // æ–°å»ºt2, t2ä¼šè°ƒç”¨â€œcountå¯¹è±¡â€çš„nonSynMethod()æ–¹æ³• Thread t2 = new Thread( new Runnable() { @Override public void run() { count.nonSynMethod(); } }, "t2"); t1.start(); // å¯åŠ¨t1 t2.start(); // å¯åŠ¨t2 }}class Count2 { /** * å«æœ‰synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void synMethod() { synchronized (this) { try { for (int i = 0; i &lt; 5; i++) { // ä¼‘çœ 100ms Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " synMethod loop " + i); } } catch (InterruptedException ie) { } } } /** * ä¹ŸåŒ…å«synchronizedåŒæ­¥å—çš„æ–¹æ³• */ public void nonSynMethod() { synchronized (this) { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " nonSynMethod loop " + i); } } catch (InterruptedException ie) { } } }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t1 synMethod loop 0t1 synMethod loop 1t1 synMethod loop 2t1 synMethod loop 3t1 synMethod loop 4t2 nonSynMethod loop 0t2 nonSynMethod loop 1t2 nonSynMethod loop 2t2 nonSynMethod loop 3t2 nonSynMethod loop 4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; ä¸»çº¿ç¨‹ä¸­æ–°å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹t1å’Œt2ã€‚t1å’Œt2è¿è¡Œæ—¶éƒ½è°ƒç”¨synchronized(this)ï¼Œè¿™ä¸ªthisæ˜¯Countå¯¹è±¡(count)ï¼Œè€Œt1å’Œt2å…±ç”¨countã€‚å› æ­¤ï¼Œåœ¨t1è¿è¡Œæ—¶ï¼Œt2ä¼šè¢«é˜»å¡ï¼Œç­‰å¾…t1è¿è¡Œé‡Šæ”¾â€œcountå¯¹è±¡çš„åŒæ­¥é”â€ï¼Œt2æ‰èƒ½è¿è¡Œã€‚ synchronizedæ–¹æ³• å’Œ synchronizedä»£ç å— â€œsynchronizedæ–¹æ³•â€æ˜¯ç”¨synchronizedä¿®é¥°æ–¹æ³•ï¼Œè€Œ â€œsynchronizedä»£ç å—â€åˆ™æ˜¯ç”¨synchronizedä¿®é¥°ä»£ç å—ã€‚ synchronizedæ–¹æ³•ç¤ºä¾‹: 123public synchronized void foo1() { System.out.println("synchronized methoed");} synchronizedä»£ç å—ç¤ºä¾‹ï¼š 12345public void foo2() { synchronized (this) { System.out.println("synchronized methoed"); }} synchronizedä»£ç å—ä¸­çš„thisæ˜¯æŒ‡å½“å‰å¯¹è±¡ã€‚ä¹Ÿå¯ä»¥å°†thisæ›¿æ¢æˆå…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚å°†thisæ›¿æ¢æˆobjï¼Œåˆ™foo2()åœ¨æ‰§è¡Œsynchronized(obj)æ—¶å°±è·å–çš„æ˜¯objçš„åŒæ­¥é”ã€‚ synchronizedä»£ç å—å¯ä»¥æ›´ç²¾ç¡®çš„æ§åˆ¶å†²çªé™åˆ¶è®¿é—®åŒºåŸŸï¼Œæœ‰æ—¶å€™è¡¨ç°æ›´é«˜æ•ˆç‡ã€‚ä¸‹é¢é€šè¿‡ä¸€ä¸ªç¤ºä¾‹æ¥æ¼”ç¤ºï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: synchronizedä»£ç å—å¯ä»¥æ›´ç²¾ç¡®çš„æ§åˆ¶å†²çªé™åˆ¶è®¿é—®åŒºåŸŸï¼Œæœ‰æ—¶å€™è¡¨ç°æ›´é«˜æ•ˆç‡ã€‚ */public class Demo4 { public synchronized void synMethod() { for (int i = 0; i &lt; 1000000; i++) { ; } } public void synBlock() { synchronized (this) { for (int i = 0; i &lt; 1000000; i++) { ; } } } public static void main(String[] args) { Demo4 demo = new Demo4(); long start, diff; // è·å–å½“å‰æ—¶é—´(millis) start = System.currentTimeMillis(); // è°ƒç”¨â€œsynchronizedæ–¹æ³•â€ demo.synMethod(); // è·å–â€œæ—¶é—´å·®å€¼â€ diff = System.currentTimeMillis() - start; System.out.println("synMethod() : " + diff); // è·å–å½“å‰æ—¶é—´(millis) start = System.currentTimeMillis(); // è°ƒç”¨â€œsynchronizedæ–¹æ³•å—â€ demo.synBlock(); // è·å–â€œæ—¶é—´å·®å€¼â€ diff = System.currentTimeMillis() - start; System.out.println("synBlock() : " + diff); }} &lt;span id="inline-blue"&gt; (æŸä¸€æ¬¡)æ‰§è¡Œç»“æœï¼š &lt;/span&gt; 12synMethod() : 11synBlock() : 3 å®ä¾‹é” å’Œ å…¨å±€é” å®ä¾‹é” -- é”åœ¨æŸä¸€ä¸ªå®ä¾‹å¯¹è±¡ä¸Šã€‚å¦‚æœè¯¥ç±»æ˜¯å•ä¾‹ï¼Œé‚£ä¹ˆè¯¥é”ä¹Ÿå…·æœ‰å…¨å±€é”çš„æ¦‚å¿µã€‚ å®ä¾‹é”å¯¹åº”çš„å°±æ˜¯synchronizedå…³é”®å­—ã€‚ å…¨å±€é” -- è¯¥é”é’ˆå¯¹çš„æ˜¯ç±»ï¼Œæ— è®ºå®ä¾‹å¤šå°‘ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆçº¿ç¨‹éƒ½å…±äº«è¯¥é”ã€‚ å…¨å±€é”å¯¹åº”çš„å°±æ˜¯static synchronizedï¼ˆæˆ–è€…æ˜¯é”åœ¨è¯¥ç±»çš„classæˆ–è€…classloaderå¯¹è±¡ä¸Šï¼‰ã€‚ å…³äºâ€œå®ä¾‹é”â€å’Œâ€œå…¨å±€é”â€æœ‰ä¸€ä¸ªå¾ˆå½¢è±¡çš„ä¾‹å­ï¼š 123456pulbic class Something { public synchronized void isSyncA(){} public synchronized void isSyncB(){} public static synchronized void cSyncA(){} public static synchronized void cSyncB(){}} å‡è®¾ï¼ŒSomethingæœ‰ä¸¤ä¸ªå®ä¾‹xå’Œyã€‚åˆ†æä¸‹é¢4ç»„è¡¨è¾¾å¼è·å–çš„é”çš„æƒ…å†µã€‚ (01) x.isSyncA()ä¸x.isSyncB() (02) x.isSyncA()ä¸y.isSyncA() (03) x.cSyncA()ä¸y.cSyncB() (04) x.isSyncA()ä¸Something.cSyncA() ä¸‹é¢é€šè¿‡å››ä¸ªç¤ºä¾‹æ¼”ç¤ºè¿›è¡Œåˆ†æã€‚é¦–å…ˆå®šä¹‰Somethingå¯¹è±¡ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: Somethingå¯¹è±¡ */public class Something { public synchronized void isSyncA() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : isSyncA"); } } catch (InterruptedException ie) { } } public synchronized void isSyncB() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : isSyncB"); } } catch (InterruptedException ie) { } } public static synchronized void cSyncA() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : cSyncA"); } } catch (InterruptedException ie) { } } public static synchronized void cSyncB() { try { for (int i = 0; i &lt; 5; i++) { Thread.sleep(100); System.out.println(Thread.currentThread().getName() + " : cSyncB"); } } catch (InterruptedException ie) { } }} (01) ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()å’ŒisSyncB()éƒ½æ˜¯è®¿é—®åŒä¸€ä¸ªå¯¹è±¡(å¯¹è±¡x)çš„åŒæ­¥é”ï¼ 123456789101112131415161718192021222324252627282930313233package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®ä¾‹é”å’Œå…¨å±€é”åˆ†æç¤ºä¾‹1 * ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()å’ŒisSyncB()éƒ½æ˜¯è®¿é—®åŒä¸€ä¸ªå¯¹è±¡(å¯¹è±¡x)çš„åŒæ­¥é”ï¼ */public class LockTest1 { Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(01) x.isSyncA()ä¸x.isSyncB() */ private void test1() { // æ–°å»ºt11, t11ä¼šè°ƒç”¨ x.isSyncA() Thread t11 = new Thread( () -&gt; x.isSyncA(), "t11"); // æ–°å»ºt12, t12ä¼šè°ƒç”¨ x.isSyncB() Thread t12 = new Thread( () -&gt; x.isSyncB(), "t12"); t11.start(); // å¯åŠ¨t11 t12.start(); // å¯åŠ¨t12 } public static void main(String[] args) { LockTest1 demo = new LockTest1(); demo.test1(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t11 : isSyncAt11 : isSyncAt11 : isSyncAt11 : isSyncAt11 : isSyncAt12 : isSyncBt12 : isSyncBt12 : isSyncBt12 : isSyncBt12 : isSyncB (02) å¯ä»¥åŒæ—¶è¢«è®¿é—®ã€‚å› ä¸ºè®¿é—®çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œx.isSyncA()è®¿é—®çš„æ˜¯xçš„åŒæ­¥é”ï¼Œè€Œy.isSyncA()è®¿é—®çš„æ˜¯yçš„åŒæ­¥é”ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®ä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹2 * å¯ä»¥åŒæ—¶è¢«è®¿é—®ã€‚å› ä¸ºè®¿é—®çš„ä¸æ˜¯åŒä¸€ä¸ªå¯¹è±¡çš„åŒæ­¥é”ï¼Œx.isSyncA()è®¿é—®çš„æ˜¯xçš„åŒæ­¥é”ï¼Œè€Œy.isSyncA()è®¿é—®çš„æ˜¯yçš„åŒæ­¥é”ã€‚ */public class LockTest2 { Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(02) x.isSyncA()ä¸y.isSyncA() */ private void test2() { // æ–°å»ºt21, t21ä¼šè°ƒç”¨ x.isSyncA() Thread t21 = new Thread( () -&gt; x.isSyncA(), "t21"); // æ–°å»ºt22, t22ä¼šè°ƒç”¨ x.isSyncB() Thread t22 = new Thread( () -&gt; y.isSyncA(), "t22"); t21.start(); // å¯åŠ¨t21 t22.start(); // å¯åŠ¨t22 } public static void main(String[] args) { LockTest2 demo = new LockTest2(); demo.test2(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncAt21 : isSyncAt22 : isSyncA (03) ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºcSyncA()å’ŒcSyncB()éƒ½æ˜¯staticç±»å‹ï¼Œx.cSyncA()ç›¸å½“äºSomething.isSyncA()ï¼Œy.cSyncB()ç›¸å½“äºSomething.isSyncB()ï¼Œå› æ­¤å®ƒä»¬å…±ç”¨ä¸€ä¸ªåŒæ­¥é”ï¼Œä¸èƒ½è¢«åŒæ—¶åé—®ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®ä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹3 * ä¸èƒ½è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºcSyncA()å’ŒcSyncB()éƒ½æ˜¯staticç±»å‹ï¼Œx.cSyncA()ç›¸å½“äºSomething.isSyncA()ï¼Œy.cSyncB()ç›¸å½“äºSomething.isSyncB()ï¼Œå› æ­¤å®ƒä»¬å…±ç”¨ä¸€ä¸ªåŒæ­¥é”ï¼Œä¸èƒ½è¢«åŒæ—¶åé—®ã€‚ */public class LockTest3 { Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(03) x.cSyncA()ä¸y.cSyncB() */ private void test3() { // æ–°å»ºt31, t31ä¼šè°ƒç”¨ x.isSyncA() Thread t31 = new Thread( () -&gt; x.cSyncA(), "t31"); // æ–°å»ºt32, t32ä¼šè°ƒç”¨ x.isSyncB() Thread t32 = new Thread( () -&gt; y.cSyncB(), "t32"); t31.start(); // å¯åŠ¨t31 t32.start(); // å¯åŠ¨t32 } public static void main(String[] args) { LockTest3 demo = new LockTest3(); demo.test3(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t31 : cSyncAt31 : cSyncAt31 : cSyncAt31 : cSyncAt31 : cSyncAt32 : cSyncBt32 : cSyncBt32 : cSyncBt32 : cSyncBt32 : cSyncB (04) å¯ä»¥è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()æ˜¯å®ä¾‹æ–¹æ³•ï¼Œx.isSyncA()ä½¿ç”¨çš„æ˜¯å¯¹è±¡xçš„é”ï¼›è€ŒcSyncA()æ˜¯é™æ€æ–¹æ³•ï¼ŒSomething.cSyncA()å¯ä»¥ç†è§£å¯¹ä½¿ç”¨çš„æ˜¯â€œç±»çš„é”â€ã€‚å› æ­¤ï¼Œå®ƒä»¬æ˜¯å¯ä»¥è¢«åŒæ—¶è®¿é—®çš„ã€‚ 1234567891011121314151617181920212223242526272829303132333435package main.java.com.study.thread.synchronizedDemo;/** * @author: whb * @description: å®ä¾‹é”å’Œå…¨å±€é”ç¤ºä¾‹4 * å¯ä»¥è¢«åŒæ—¶è®¿é—®ã€‚å› ä¸ºisSyncA()æ˜¯å®ä¾‹æ–¹æ³•ï¼Œx.isSyncA()ä½¿ç”¨çš„æ˜¯å¯¹è±¡xçš„é”ï¼›è€ŒcSyncA()æ˜¯é™æ€æ–¹æ³•ï¼ŒSomething.cSyncA()å¯ä»¥ç†è§£å¯¹ä½¿ç”¨çš„æ˜¯â€œç±»çš„é”â€ã€‚å› æ­¤ï¼Œå®ƒä»¬æ˜¯å¯ä»¥è¢«åŒæ—¶è®¿é—®çš„ã€‚ */public class LockTest4 { Something x = new Something(); Something y = new Something(); /** * æ¯”è¾ƒ(04) x.isSyncA()ä¸Something.cSyncA() */ private void test4() { // æ–°å»ºt41, t41ä¼šè°ƒç”¨ x.isSyncA() Thread t41 = new Thread( () -&gt; x.isSyncA(), "t41"); // æ–°å»ºt42, t42ä¼šè°ƒç”¨ x.isSyncB() Thread t42 = new Thread( () -&gt; Something.cSyncA(), "t42"); t41.start(); // å¯åŠ¨t41 t42.start(); // å¯åŠ¨t42 } public static void main(String[] args) { LockTest4 demo = new LockTest4(); demo.test4(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910t41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncAt41 : isSyncAt42 : cSyncA document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å¥‡å¶æ’åº]]></title>
    <url>%2Fposts%2F185015d0.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åŸºæœ¬æ€è·¯æ˜¯å¥‡æ•°åˆ—æ’ä¸€è¶Ÿåº,å¶æ•°åˆ—æ’ä¸€è¶Ÿåº,å†å¥‡æ•°æ’,å†å¶æ•°æ’,ç›´åˆ°å…¨éƒ¨æœ‰åºã€‚ ä¸¾ä¸ªä¾‹å­ï¼šå¾…æ’æ•°ç»„[6 2 4 1 5 9] ç¬¬ä¸€æ¬¡æ¯”è¾ƒå¥‡æ•°åˆ—,å¥‡æ•°åˆ—ä¸å®ƒçš„é‚»å±…å¶æ•°åˆ—æ¯”è¾ƒ,å¦‚6å’Œ2æ¯”,4å’Œ1æ¯”,5å’Œ9æ¯”ã€‚ [6 2 4 1 5 9] äº¤æ¢åå˜æˆ [2 6 1 4 5 9] ç¬¬äºŒæ¬¡æ¯”è¾ƒå¶æ•°åˆ—,å³6å’Œ1æ¯”,5å’Œ5æ¯”ã€‚ [2 6 1 4 5 9] äº¤æ¢åå˜æˆ [2 1 6 4 5 9] ç¬¬ä¸‰è¶Ÿåˆæ˜¯å¥‡æ•°åˆ—,é€‰æ‹©çš„æ˜¯2,6,5åˆ†åˆ«ä¸å®ƒä»¬çš„é‚»å±…åˆ—æ¯”è¾ƒã€‚ [2 1 6 4 5 9] äº¤æ¢å [1 2 4 6 5 9] ç¬¬å››è¶Ÿå¶æ•°åˆ—ã€‚ [1 2 4 6 5 9] ä¸€æ¬¡äº¤æ¢ [1 2 4 5 6 9] ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¥‡å¶æ’åºï¼šåŸºæœ¬æ€è·¯æ˜¯å¥‡æ•°åˆ—æ’ä¸€è¶Ÿåº,å¶æ•°åˆ—æ’ä¸€è¶Ÿåº,å†å¥‡æ•°æ’,å†å¶æ•°æ’,ç›´åˆ°å…¨éƒ¨æœ‰åº */public class OddEventSort { public static void oddEventSort(int[] unsorted) { int temp; for (int i = unsorted.length - 1; i &gt; unsorted.length / 2 - 1; i--) { //å¥‡æ•°æ’åº for (int j = 1; j &lt;= i; j += 2) { if (j == unsorted.length - 1) { break; } if (unsorted[j] &gt; unsorted[j + 1]) { temp = unsorted[j]; unsorted[j] = unsorted[j + 1]; unsorted[j + 1] = temp; } } //å¶æ•°æ’åº for (int j = 0; j &lt;= i; j += 2) { if (j == unsorted.length - 1) { break; } if (unsorted[j] &gt; unsorted[j + 1]) { temp = unsorted[j]; unsorted[j] = unsorted[j + 1]; unsorted[j + 1] = temp; } } } } public static void main(String[] args) { int[] unsorted = new int[]{12, 33, 45, 33, 13, 55, 34, 7, 6}; System.out.println("**************å¥‡å¶æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); oddEventSort(unsorted); CommonUtils.display(unsorted); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å¸¸ç”¨å‘½ä»¤]]></title>
    <url>%2Fposts%2Fdb6149c7.html</url>
    <content type="text"><![CDATA[git config --global user.name "ä½ çš„åå­—" è®©ä½ å…¨éƒ¨çš„Gitä»“åº“ç»‘å®šä½ çš„åå­— git config --global user.email "ä½ çš„é‚®ç®±" è®©ä½ å…¨éƒ¨çš„Gitä»“åº“ç»‘å®šä½ çš„é‚®ç®± git init åˆå§‹åŒ–ä½ çš„ä»“åº“ git add . æŠŠå·¥ä½œåŒºçš„æ–‡ä»¶å…¨éƒ¨æäº¤åˆ°æš‚å­˜åŒº git add ./&lt;file&gt;/ æŠŠå·¥ä½œåŒºçš„&lt;file&gt;æ–‡ä»¶æäº¤åˆ°æš‚å­˜åŒº git commit -m "xxx" æŠŠæš‚å­˜åŒºçš„æ‰€æœ‰æ–‡ä»¶æäº¤åˆ°ä»“åº“åŒºï¼Œæš‚å­˜åŒºç©ºç©ºè¡è¡ git remote add origin https://github.com/name/name_cangku.git æŠŠæœ¬åœ°ä»“åº“ä¸è¿œç¨‹ä»“åº“è¿æ¥èµ·æ¥ git push -u origin master æŠŠä»“åº“åŒºçš„ä¸»åˆ†æ”¯masteræäº¤åˆ°è¿œç¨‹ä»“åº“é‡Œ git push -u origin &lt;å…¶ä»–åˆ†æ”¯&gt; æŠŠå…¶ä»–åˆ†æ”¯æäº¤åˆ°è¿œç¨‹ä»“åº“ git statusæŸ¥çœ‹å½“å‰ä»“åº“çš„çŠ¶æ€ git diff æŸ¥çœ‹æ–‡ä»¶ä¿®æ”¹çš„å…·ä½“å†…å®¹ git log æ˜¾ç¤ºä»æœ€è¿‘åˆ°æœ€è¿œçš„æäº¤å†å² git clone + ä»“åº“åœ°å€ä¸‹è½½å…‹éš†æ–‡ä»¶ git reset --hard + ç‰ˆæœ¬å· å›æº¯ç‰ˆæœ¬ï¼Œç‰ˆæœ¬å·åœ¨commitçš„æ—¶å€™ä¸masterè·Ÿéšåœ¨ä¸€èµ· git reflog æ˜¾ç¤ºå‘½ä»¤å†å² git checkout -- &lt;file&gt; æ’¤é”€å‘½ä»¤ï¼Œç”¨ç‰ˆæœ¬åº“é‡Œçš„æ–‡ä»¶æ›¿æ¢æ‰å·¥ä½œåŒºçš„æ–‡ä»¶ã€‚æˆ‘è§‰å¾—å°±åƒæ˜¯Gitä¸–ç•Œçš„ctrl + z git rm åˆ é™¤ç‰ˆæœ¬åº“çš„æ–‡ä»¶ git branch æŸ¥çœ‹å½“å‰æ‰€æœ‰åˆ†æ”¯ git branch &lt;åˆ†æ”¯åå­—&gt; åˆ›å»ºåˆ†æ”¯ git checkout &lt;åˆ†æ”¯åå­—&gt; åˆ‡æ¢åˆ°åˆ†æ”¯ git merge &lt;åˆ†æ”¯åå­—&gt; åˆå¹¶åˆ†æ”¯ git branch -d &lt;åˆ†æ”¯åå­—&gt; åˆ é™¤åˆ†æ”¯,æœ‰å¯èƒ½ä¼šåˆ é™¤å¤±è´¥ï¼Œå› ä¸ºGitä¼šä¿æŠ¤æ²¡æœ‰è¢«åˆå¹¶çš„åˆ†æ”¯ git branch -D + &lt;åˆ†æ”¯åå­—&gt; å¼ºè¡Œåˆ é™¤ï¼Œä¸¢å¼ƒæ²¡è¢«åˆå¹¶çš„åˆ†æ”¯ git log --graph æŸ¥çœ‹åˆ†æ”¯åˆå¹¶å›¾ git merge --no-ff &lt;åˆ†æ”¯åå­—&gt; åˆå¹¶åˆ†æ”¯çš„æ—¶å€™ç¦ç”¨Fast forwardæ¨¡å¼,å› ä¸ºè¿™ä¸ªæ¨¡å¼ä¼šä¸¢å¤±åˆ†æ”¯å†å²ä¿¡æ¯ git stash å½“æœ‰å…¶ä»–ä»»åŠ¡æ’è¿›æ¥æ—¶ï¼ŒæŠŠå½“å‰å·¥ä½œç°åœºâ€œå­˜å‚¨â€èµ·æ¥,ä»¥åæ¢å¤åç»§ç»­å·¥ä½œ git stash list æŸ¥çœ‹ä½ åˆšåˆšâ€œå­˜æ”¾â€èµ·æ¥çš„å·¥ä½œå»å“ªé‡Œäº† git stash apply æ¢å¤å´ä¸åˆ é™¤stashå†…å®¹ git stash drop åˆ é™¤stashå†…å®¹ git stash pop æ¢å¤çš„åŒæ—¶æŠŠstashå†…å®¹ä¹Ÿåˆ äº† git remote æŸ¥çœ‹è¿œç¨‹åº“çš„ä¿¡æ¯ï¼Œä¼šæ˜¾ç¤ºoriginï¼Œè¿œç¨‹ä»“åº“é»˜è®¤åç§°ä¸ºorigin git remote -v æ˜¾ç¤ºæ›´è¯¦ç»†çš„ä¿¡æ¯ git pull æŠŠæœ€æ–°çš„æäº¤ä»è¿œç¨‹ä»“åº“ä¸­æŠ“å–ä¸‹æ¥ï¼Œåœ¨æœ¬åœ°åˆå¹¶,å’Œgit pushç›¸å git rebase æŠŠåˆ†å‰çš„æäº¤å†å²â€œæ•´ç†â€æˆä¸€æ¡ç›´çº¿ï¼Œçœ‹ä¸Šå»æ›´ç›´è§‚ git tag æŸ¥çœ‹æ‰€æœ‰æ ‡ç­¾ï¼Œå¯ä»¥çŸ¥é“å†å²ç‰ˆæœ¬çš„tag git tag &lt;name&gt; æ‰“æ ‡ç­¾ï¼Œé»˜è®¤ä¸ºHEADã€‚æ¯”å¦‚git tag v1.0 git tag &lt;tagName&gt; &lt;ç‰ˆæœ¬å·&gt; æŠŠç‰ˆæœ¬å·æ‰“ä¸Šæ ‡ç­¾ï¼Œç‰ˆæœ¬å·å°±æ˜¯commitæ—¶ï¼Œè·Ÿåœ¨æ—è¾¹çš„ä¸€ä¸²å­—æ¯æ•°å­— git show &lt;tagName&gt; æŸ¥çœ‹æ ‡ç­¾ä¿¡æ¯ git tag -a &lt;tagName&gt; -m "&lt;è¯´æ˜&gt;" åˆ›å»ºå¸¦è¯´æ˜çš„æ ‡ç­¾ã€‚-aæŒ‡å®šæ ‡ç­¾åï¼Œ-mæŒ‡å®šè¯´æ˜æ–‡å­— git tag -d &lt;tagName&gt; åˆ é™¤æ ‡ç­¾ git push origin &lt;tagname&gt; æ¨é€æŸä¸ªæ ‡ç­¾åˆ°è¿œç¨‹ git push origin --tags ä¸€æ¬¡æ€§æ¨é€å…¨éƒ¨å°šæœªæ¨é€åˆ°è¿œç¨‹çš„æœ¬åœ°æ ‡ç­¾ git push origin :refs/tags/&lt;tagname&gt; åˆ é™¤è¿œç¨‹æ ‡ç­¾&lt;tagname&gt; git config --global color.ui true è®©Gitæ˜¾ç¤ºé¢œè‰²ï¼Œä¼šè®©å‘½ä»¤è¾“å‡ºçœ‹èµ·æ¥æ›´é†’ç›® git add -f &lt;file&gt; å¼ºåˆ¶æäº¤å·²å¿½ç•¥çš„çš„æ–‡ä»¶ git check-ignore -v &lt;file&gt; æ£€æŸ¥ä¸ºä»€ä¹ˆGitä¼šå¿½ç•¥è¯¥æ–‡ä»¶ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å¿«é€Ÿæ’åº]]></title>
    <url>%2Fposts%2F71d3e504.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ 1ï¼‰é€‰æ‹©ä¸€ä¸ªåŸºå‡†å…ƒç´ ,é€šå¸¸é€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…æœ€åä¸€ä¸ªå…ƒç´ , 2ï¼‰å¦‚æœé€‰æ‹©ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºåŸºå‡†å…ƒç´ ï¼Œåˆ™å…ˆä»å³å‘å·¦æ‰¾æ¯”åŸºå‡†å…ƒç´ å°çš„å…ƒç´ ï¼Œå†ä»å·¦å‘å³æ‰¾æ¯”åŸºå‡†å…ƒç´ å¤§çš„å…ƒç´ ï¼Œäº¤æ¢è¿™ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®ã€‚ï¼ˆå¦‚æœé€‰æ‹©æœ€åä¸€ä¸ªå…ƒç´ åšåŸºå‡†å…ƒç´ ï¼Œåˆ™å…ˆä»å·¦å‘å³æ‰¾ï¼‰ç›´åˆ°æ‰¾åˆ°åŒä¸€ä½ç½®ï¼Œè·ŸåŸºå‡†å…ƒç´ ä½ç½®äº¤æ¢ï¼Œç¬¬ä¸€è¶Ÿæ’åºå°±ç»“æŸã€‚ 3ï¼‰é€šè¿‡ä¸€è¶Ÿæ’åºå°†è®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…ƒç´ å€¼å‡æ¯”åŸºå‡†å…ƒç´ å€¼å°ã€‚å¦ä¸€éƒ¨åˆ†è®°å½•çš„å…ƒç´ å€¼æ¯”åŸºå‡†å€¼å¤§ã€‚ 4ï¼‰æ­¤æ—¶åŸºå‡†å…ƒç´ åœ¨å…¶æ’å¥½åºåçš„æ­£ç¡®ä½ç½® 5ï¼‰ç„¶ååˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç”¨åŒæ ·çš„æ–¹æ³•ç»§ç»­è¿›è¡Œæ’åºï¼Œç›´åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ ç®—æ³•æµç¨‹å›¾ å¿«é€Ÿæ’åºä¹‹æ‰€æ¯”è¾ƒå¿«ï¼Œå› ä¸ºç›¸æ¯”å†’æ³¡æ’åºï¼Œæ¯æ¬¡äº¤æ¢æ˜¯è·³è·ƒå¼çš„ã€‚æ¯æ¬¡æ’åºçš„æ—¶å€™è®¾ç½®ä¸€ä¸ªåŸºå‡†ç‚¹ï¼Œå°†å°äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å·¦è¾¹ï¼Œå°†å¤§äºç­‰äºåŸºå‡†ç‚¹çš„æ•°å…¨éƒ¨æ”¾åˆ°åŸºå‡†ç‚¹çš„å³è¾¹ã€‚è¿™æ ·åœ¨æ¯æ¬¡äº¤æ¢çš„æ—¶å€™å°±ä¸ä¼šåƒå†’æ³¡æ’åºä¸€æ ·æ¯æ¬¡åªèƒ½åœ¨ç›¸é‚»çš„æ•°ä¹‹é—´è¿›è¡Œäº¤æ¢ï¼Œäº¤æ¢çš„è·ç¦»å°±å¤§çš„å¤šäº†ã€‚å› æ­¤æ€»çš„æ¯”è¾ƒå’Œäº¤æ¢æ¬¡æ•°å°±å°‘äº†ï¼Œé€Ÿåº¦è‡ªç„¶å°±æé«˜äº†ã€‚å½“ç„¶åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œä»å¯èƒ½æ˜¯ç›¸é‚»çš„ä¸¤ä¸ªæ•°è¿›è¡Œäº†äº¤æ¢ã€‚å› æ­¤å¿«é€Ÿæ’åºçš„æœ€å·®æ—¶é—´å¤æ‚åº¦å’Œå†’æ³¡æ’åºæ˜¯ä¸€æ ·çš„éƒ½æ˜¯O(N2)ï¼Œå®ƒçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸ºO(NlogN)ã€‚ ä»£ç å¦‚ä¸‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¿«é€Ÿæ’åº */public class QuickSort { /** * å¿«é€Ÿæ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œé€šè¿‡ä¸€è¶Ÿæ’åºå°†å¾…æ’è®°å½•åˆ†å‰²æˆç‹¬ç«‹çš„ä¸¤éƒ¨åˆ†ï¼Œå…¶ä¸­ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å‡æ¯”å¦ä¸€éƒ¨åˆ†è®°å½•çš„å…³é”®å­—å°ï¼Œåˆ™å¯åˆ†åˆ«å¯¹è¿™ä¸¤éƒ¨åˆ†è®°å½•ç»§ç»­è¿›è¡Œæ’åºï¼Œä»¥è¾¾åˆ°æ•´ä¸ªåºåˆ—æœ‰åºã€‚ * &lt;p&gt; * ä¸€è¶Ÿå¿«é€Ÿæ’åºï¼ˆæˆ–ä¸€æ¬¡åˆ’åˆ†ï¼‰çš„è¿‡ç¨‹å¦‚ä¸‹ï¼šé¦–å…ˆä»»æ„é€‰å–ä¸€ä¸ªè®°å½•ï¼ˆé€šå¸¸å¯é€‰ç¬¬ä¸€ä¸ªè®°å½•ï¼‰ä½œä¸ºæ¢è½´ï¼ˆæˆ–æ”¯ç‚¹ï¼‰ï¼ˆpivotï¼‰ï¼Œç„¶åæŒ‰ä¸‹åˆ—åŸåˆ™é‡æ–°æ’åˆ—å…¶ä½™è®°å½•ï¼šå°†æ‰€æœ‰å…³é”®å­—æ¯”å®ƒå°çš„è®°å½•éƒ½å®‰ç½®åœ¨å®ƒçš„ä½ç½®ä¹‹å‰ï¼Œå°†æ‰€æœ‰å…³é”®å­—æ¯”å®ƒå¤§çš„è®°å½•éƒ½å®‰ç½®åœ¨å®ƒçš„ä½ç½®ä¹‹åã€‚ * &lt;p&gt; * ç»è¿‡ä¸€è¶Ÿå¿«é€Ÿæ’åºä¹‹åï¼Œä»¥è¯¥æ¢è½´è®°å½•æœ€åæ‰€è½çš„ä½ç½®iä½œåˆ†ç•Œçº¿ï¼Œå°†åºåˆ—åˆ†å‰²æˆä¸¤ä¸ªå­åºåˆ—ï¼Œä¹‹åå†åˆ†åˆ«å¯¹åˆ†å‰²æ‰€å¾—çš„ä¸¤ä¸ªå­åºåˆ—è¿›è¡Œå¿«é€Ÿæ’åºã€‚ * &lt;p&gt; * å¯ä»¥çœ‹å‡ºè¿™ä¸ªç®—æ³•å¯ä»¥é€’å½’å®ç°ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªå‡½æ•°æ¥å®ç°åˆ’åˆ†ï¼Œå¹¶è¿”å›åˆ†ç•Œä½ç½®ã€‚ç„¶åä¸æ–­åœ°è¿™ä¹ˆåˆ†ä¸‹å»ç›´åˆ°æ’åºå®Œæˆï¼Œå¯ä»¥çœ‹å‡ºå‡½æ•°çš„è¾“å…¥å‚æ•°éœ€è¦æä¾›åºåˆ—çš„é¦–å°¾ä½ç½®ã€‚ */ public static void quickSort(int[] numArr, int left, int right) { //ä¸ç®¡ä½¿ç”¨å“ªç§åˆ†å‰²æ–¹å¼ï¼Œéƒ½å¯ä»¥é€šè¿‡é€’å½’å½¢å¼è¿›è¡Œæ’åº // éœ€è¦æ³¨æ„çš„æ˜¯è¿™ä¸ªifè¯­å¥ä¸èƒ½å°‘ï¼Œä¸ç„¶æ²¡æ³•åœæ­¢ï¼Œä¼šå¯¼è‡´å †æ ˆæº¢å‡ºçš„å¼‚å¸¸ã€‚ if (left &lt; right) { //åˆ†å‰²æ•°ç»„ï¼Œæ‰¾åˆ°åˆ†å‰²ç‚¹ int point = partitionTwo(numArr, left, right); //é€’å½’è°ƒç”¨ï¼Œå¯¹å·¦å­æ•°ç»„è¿›è¡Œå¿«é€Ÿæ’åº quickSort(numArr, left, point - 1); //é€’å½’è°ƒç”¨ï¼Œå¯¹å³å­æ•°ç»„è¿›è¡Œå¿«é€Ÿæ’åº quickSort(numArr, point + 1, right); } } /** * åˆ’åˆ†å®ç°1 ï¼ˆæ¢è½´è·³æ¥è·³å»æ³•ï¼‰ * ä¸€è¶Ÿå¿«é€Ÿæ’åºçš„å®ç°ï¼šè®¾ä¸¤ä¸ªæŒ‡é’ˆleftå’Œrightï¼Œè®¾æ¢è½´è®°å½•çš„å…³é”®å­—ä¸ºfirstï¼Œåˆ™é¦–å…ˆä»rightæ‰€æŒ‡ä½ç½®èµ·å‘å‰æœç´¢æ‰¾åˆ°ç¬¬ä¸€ä¸ªå…³é”®å­—å°äºfirstçš„è®°å½•å’Œæ¢è½´è®°å½•äº’ç›¸äº¤æ¢ï¼Œ * ç„¶åä»leftæ‰€æŒ‡ä½ç½®èµ·å‘åæœç´¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå…³é”®å­—å¤§äºfirstçš„è®°å½•å’Œæ¢è½´è®°å½•äº’ç›¸äº¤æ¢ï¼Œé‡å¤è¿™ä¸¤æ­¥ç›´è‡³left==rightä¸ºæ­¢ã€‚ */ public static int partitionOne(int[] numArr, int left, int right) { //ç”¨æ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ åšåŸºå‡†å…ƒç´  int first = numArr[left]; while (left &lt; right) { while (left &lt; right &amp;&amp; numArr[right] &gt;= first) { right--; } //äº¤æ¢ swap(numArr, left, right); while (left &lt; right &amp;&amp; numArr[left] &lt;= first) { left++; } //äº¤æ¢ swap(numArr, left, right); } //è¿”å›åˆ†å‰²ç‚¹æ‰€åœ¨çš„ä½ç½® return left; } /** * åˆ’åˆ†å®ç°2 ï¼ˆæ¢è½´ä¸€æ¬¡åˆ°ä½æ³•ï¼‰ * partitionOneå®ç°å¯ä»¥çœ‹å‡ºï¼Œæ¢è½´å…ƒç´ ï¼ˆå³æœ€å¼€å§‹é€‰çš„â€œä¸­é—´â€å…ƒç´ ï¼ˆå…¶å®å¾€å¾€æ˜¯æ‹¿ç¬¬ä¸€ä¸ªå…ƒç´ ä½œä¸ºâ€œä¸­é—´â€å…ƒç´ ï¼‰ï¼‰éœ€è¦ä¸æ–­åœ°å’Œå…¶ä»–å…ƒç´ äº¤æ¢ä½ç½®ï¼Œè€Œæ¯äº¤æ¢ä¸€æ¬¡ä½ç½®å®é™…ä¸Šéœ€è¦ä¸‰æ¬¡èµ‹å€¼æ“ä½œã€‚ * &lt;p&gt; * å®é™…ä¸Šï¼Œåªæœ‰æœ€åleft=rightçš„ä½ç½®æ‰æ˜¯æ¢è½´å…ƒç´ çš„æœ€ç»ˆä½ç½®ï¼Œæ‰€ä»¥å¯ä»¥å…ˆå°†æ¢è½´å…ƒç´ ä¿å­˜èµ·æ¥ï¼Œæ’åºè¿‡ç¨‹ä¸­åªä½œå…ƒç´ çš„å•å‘ç§»åŠ¨ï¼Œç›´è‡³ä¸€è¶Ÿæ’åºç»“æŸåå†å°†æ¢è½´å…ƒç´ ç§»è‡³æ­£ç¡®çš„ä½ç½®ä¸Šã€‚ * * @return */ public static int partitionTwo(int[] numArr, int left, int right) { int first = numArr[left]; int temp = numArr[left]; while (left &lt; right) { while (left &lt; right &amp;&amp; numArr[right] &gt;= first) { right--; } numArr[left] = numArr[right]; while (left &lt; right &amp;&amp; numArr[left] &lt;= first) { left++; } numArr[right] = numArr[left]; } numArr[left] = temp; return left; } /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªä½ç½®çš„å…ƒç´  */ public static void swap(int[] numArr, int left, int right) { int temp = 0; if (numArr != null &amp;&amp; numArr.length &gt; 0) { temp = numArr[left]; numArr[left] = numArr[right]; numArr[right] = temp; } } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************å¿«é€Ÿæ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); quickSort(numArr, 0, numArr.length - 1); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å†’æ³¡æ’åº]]></title>
    <url>%2Fposts%2F9ab57c2f.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œå¯¹å½“å‰è¿˜æœªæ’å¥½åºçš„èŒƒå›´å†…çš„å…¨éƒ¨æ•°ï¼Œè‡ªä¸Šè€Œä¸‹å¯¹ç›¸é‚»çš„ä¸¤ä¸ªæ•°ä¾æ¬¡è¿›è¡Œæ¯”è¾ƒå’Œè°ƒæ•´ï¼Œè®©è¾ƒå¤§çš„æ•°å¾€ä¸‹æ²‰ï¼Œè¾ƒå°çš„å¾€ä¸Šå†’ã€‚å³ï¼šæ¯å½“ä¸¤ç›¸é‚»çš„æ•°æ¯”è¾ƒåå‘ç°å®ƒä»¬çš„æ’åºä¸æ’åºè¦æ±‚ç›¸åæ—¶ï¼Œå°±å°†å®ƒä»¬äº’æ¢ã€‚ ç®—æ³•æ­¥éª¤ æ¯”è¾ƒç›¸é‚»çš„å…ƒç´ ã€‚å¦‚æœç¬¬ä¸€ä¸ªæ¯”ç¬¬äºŒä¸ªå¤§ï¼Œå°±äº¤æ¢ä»–ä»¬ä¸¤ä¸ªã€‚ å¯¹æ¯ä¸€å¯¹ç›¸é‚»å…ƒç´ ä½œåŒæ ·çš„å·¥ä½œï¼Œä»å¼€å§‹ç¬¬ä¸€å¯¹åˆ°ç»“å°¾çš„æœ€åä¸€å¯¹ã€‚åœ¨è¿™ä¸€ç‚¹ï¼Œæœ€åçš„å…ƒç´ åº”è¯¥ä¼šæ˜¯æœ€å¤§çš„æ•°ã€‚ é’ˆå¯¹æ‰€æœ‰çš„å…ƒç´ é‡å¤ä»¥ä¸Šçš„æ­¥éª¤ï¼Œé™¤äº†æœ€åä¸€ä¸ªã€‚ æŒç»­æ¯æ¬¡å¯¹è¶Šæ¥è¶Šå°‘çš„å…ƒç´ é‡å¤ä¸Šé¢çš„æ­¥éª¤ï¼Œç›´åˆ°æ²¡æœ‰ä»»ä½•ä¸€å¯¹æ•°å­—éœ€è¦æ¯”è¾ƒã€‚ ç®—æ³•æµç¨‹å›¾ ç®—æ³•æ”¹è¿› å¯¹å†’æ³¡æ’åºå¸¸è§çš„æ”¹è¿›æ–¹æ³•æ˜¯åŠ å…¥ä¸€æ ‡å¿—æ€§å˜é‡exchangeï¼Œç”¨äºæ ‡å¿—æŸä¸€è¶Ÿæ’åºè¿‡ç¨‹ä¸­æ˜¯å¦æœ‰æ•°æ®äº¤æ¢ï¼Œå¦‚æœè¿›è¡ŒæŸä¸€è¶Ÿæ’åºæ—¶å¹¶æ²¡æœ‰è¿›è¡Œæ•°æ®äº¤æ¢ï¼Œåˆ™è¯´æ˜æ•°æ®å·²ç»æŒ‰è¦æ±‚æ’åˆ—å¥½ï¼Œå¯ç«‹å³ç»“æŸæ’åºï¼Œé¿å…ä¸å¿…è¦çš„æ¯”è¾ƒè¿‡ç¨‹ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å†’æ³¡æ’åº */public class BubbleSort { /** * å†’æ³¡æ’åºçš„è¿‡ç¨‹å¾ˆç®€å•ï¼Œå°±æ˜¯ä¸æ–­æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªå…ƒç´ çš„å¤§å°å…³ç³»ï¼Œè‹¥é€†åºåˆ™äº¤æ¢ï¼Œè¿™æ ·é€šè¿‡ä¸€è½®æ¯”è¾ƒï¼Œå…³å­å¥æœ€å¤§çš„è®°å½•å°±æ²‰åº•äº†ã€‚ * ä¸€èˆ¬åœ°ï¼Œç¬¬iè¶Ÿå†’æ³¡æ’åºä»ç¬¬ä¸€ä¸ªå…ƒç´ èµ·åˆ°ç¬¬n-i+1ä¸ªå…ƒç´ ä¾æ¬¡æ¯”è¾ƒç›¸é‚»ä¸¤ä¸ªè®°å½•çš„å…³é”®å­—ï¼Œå¹¶åœ¨é€†åºæ—¶äº¤æ¢ç›¸é‚»è®°å½•ï¼Œå…¶ç»“æœå°±æ˜¯è¿™n-i+1ä¸ªè®°å½•ä¸­å…³é”®å­—æœ€å¤§çš„è®°å½•è¢«äº¤æ¢åˆ°n-i+1çš„ä½ç½®ä¸Šã€‚ * å½“ç„¶ä¹Ÿå¯ä»¥åè¿‡æ¥ï¼Œä»åå¾€å‰è¿›è¡Œï¼Œè¿™æ ·æ¯ç»è¿‡ä¸€è¶Ÿæ’åºï¼Œå°±æŠŠæœªæ’åºçš„åºåˆ—ä¸­æœ€å°çš„å…ƒç´ æ”¾åœ¨å®ƒåº”å½“å¤„äºçš„ä½ç½®ä¸Šï¼Œç„¶åä¸‹æ¬¡æ¯”è¾ƒå°±ä¸å†è®©å‰é¢çš„å…ƒç´ å‚ä¸äº†ã€‚ * æ•´ä¸ªæ’åºè¿‡ç¨‹éœ€è¦è¿›è¡Œkè¶Ÿå†’æ³¡æ’åºï¼Œå…¶ä¸­kè‡³å°‘ä¸º1ï¼Œè‡³å¤šä¸ºn-1æ¬¡ï¼Œå¦‚æœä¸€è¶Ÿå†’æ³¡æ’åºä¸­æ²¡æœ‰å‡ºç°äº¤æ¢å…ƒç´ çš„æ“ä½œï¼Œåˆ™è¯´æ˜åºåˆ—å·²ç»æœ‰åºäº†ï¼Œå¯ä»¥åœæ­¢æ’åºäº†ã€‚ * æ—¶é—´å¤æ‚åº¦ï¼šæ­£åºæ—¶O(n)ï¼Œ é€†åºæ—¶O(n2)ï¼Œå¹³å‡æ—¶é—´å¤æ‚æ€§O(n2)ã€‚ä½¿ç”¨temp ä½œä¸ºä¸´æ—¶äº¤æ¢å˜é‡ï¼Œç©ºé—´å¤æ‚åº¦ä¸º O(1). * &lt;p&gt; * ä¸€èˆ¬æƒ…å†µä¸‹è²Œä¼¼æ•ˆç‡ä¸åŠç›´æ¥æ’å…¥æ’åºï¼ˆå°½ç®¡å®ƒä»¬çš„å¹³å‡æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯O(n2)ï¼‰ã€‚ */ public static void bubbleSort(int[] numArr) { int length = numArr.length; //æœ€å¤šlength-1æ¬¡æ’åº for (int i = 0; i &lt; length; i++) { //æ¯ä¸€è½®å¤šå°‘å…ƒç´ å‚ä¸æ’åº for (int j = 0; j &lt; length - 1 - i; j++) { if (numArr[j] &gt; numArr[j + 1]) { /** * äº¤æ¢é¡ºåºï¼Œä¸ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œåˆ©ç”¨ * a = a + b; * b = a - b; * a = a - b; */ numArr[j] = numArr[j] + numArr[j + 1]; numArr[j + 1] = numArr[j] - numArr[j + 1]; numArr[j] = numArr[j] - numArr[j + 1]; } } } } /** * æ”¹è¿›ç‰ˆå†’æ³¡ï¼šå½“æŸè¶Ÿæ’åºæ²¡æœ‰å…ƒç´ äº¤æ¢çš„æ—¶å€™ï¼Œè¯æ˜æ•´ä¸ªåºåˆ—æœ‰åºï¼Œæ— éœ€å†å¾ªç¯æ¯”è¾ƒ * * @param numArr */ public static void bubbleSortImprove(int[] numArr) { int length = numArr.length; //è®¾ç½®æ ‡å¿—å˜é‡ï¼Œè¿™æ ·å½“åºåˆ—æœ‰åºæ—¶åŠæ—¶é€€å‡ºå¾ªç¯ï¼Œé¿å…å†—ä½™å¤„ç†ã€‚ boolean sorted = false; //æœ€å¤šlength-1æ¬¡æ’åº for (int i = 0; i &lt; length; i++) { sorted = true; //æ¯ä¸€è½®å¤šå°‘å…ƒç´ å‚ä¸æ’åº for (int j = 0; j &lt; length - 1 - i; j++) { if (numArr[j] &gt; numArr[j + 1]) { /** * äº¤æ¢é¡ºåºï¼Œä¸ä½¿ç”¨ä¸´æ—¶å˜é‡ï¼Œåˆ©ç”¨ * a = a + b; * b = a - b; * a = a - b; */ numArr[j] = numArr[j] + numArr[j + 1]; numArr[j + 1] = numArr[j] - numArr[j + 1]; numArr[j] = numArr[j] - numArr[j + 1]; sorted = false; } } if (sorted) { break; } } } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************å†’æ³¡æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); bubbleSortImprove(numArr); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å †æ’åº]]></title>
    <url>%2Fposts%2F1ca0adae.html</url>
    <content type="text"><![CDATA[å †æ’åºæ˜¯ä¸€ç§æ ‘å½¢é€‰æ‹©æ’åºï¼Œæ˜¯å¯¹ç›´æ¥é€‰æ‹©æ’åºçš„æœ‰æ•ˆæ”¹è¿›ã€‚ åŸºæœ¬æ€æƒ³ å †çš„å®šä¹‰å¦‚ä¸‹ï¼šå…·æœ‰nä¸ªå…ƒç´ çš„åºåˆ—ï¼ˆk1,k2,...,kn),å½“ä¸”ä»…å½“æ»¡è¶³ æ—¶ç§°ä¹‹ä¸ºå †ã€‚ç”±å †çš„å®šä¹‰å¯ä»¥çœ‹å‡ºï¼Œå †é¡¶å…ƒç´ ï¼ˆå³ç¬¬ä¸€ä¸ªå…ƒç´ ï¼‰å¿…ä¸ºæœ€å°é¡¹ï¼ˆå°é¡¶å †ï¼‰ã€‚ è‹¥ä»¥ä¸€ç»´æ•°ç»„å­˜å‚¨ä¸€ä¸ªå †ï¼Œåˆ™å †å¯¹åº”ä¸€æ£µå®Œå…¨äºŒå‰æ ‘ï¼Œä¸”æ‰€æœ‰éå¶ç»“ç‚¹çš„å€¼å‡ä¸å¤§äº(æˆ–ä¸å°äº)å…¶å­å¥³çš„å€¼ï¼Œæ ¹ç»“ç‚¹ï¼ˆå †é¡¶å…ƒç´ ï¼‰çš„å€¼æ˜¯æœ€å°(æˆ–æœ€å¤§)çš„ã€‚å¦‚ï¼š ï¼ˆaï¼‰å¤§é¡¶å †åºåˆ—ï¼šï¼ˆ96, 83,27,38,11,09) ï¼ˆbï¼‰å°é¡¶å †åºåˆ—ï¼šï¼ˆ12ï¼Œ36ï¼Œ24ï¼Œ85ï¼Œ47ï¼Œ30ï¼Œ53ï¼Œ91ï¼‰ åˆå§‹æ—¶æŠŠè¦æ’åºçš„nä¸ªæ•°çš„åºåˆ—çœ‹ä½œæ˜¯ä¸€æ£µé¡ºåºå­˜å‚¨çš„äºŒå‰æ ‘ï¼ˆä¸€ç»´æ•°ç»„å­˜å‚¨äºŒå‰æ ‘ï¼‰ï¼Œè°ƒæ•´å®ƒä»¬çš„å­˜å‚¨é¡ºåºï¼Œä½¿ä¹‹æˆä¸ºä¸€ä¸ªå †ï¼Œå°†å †é¡¶å…ƒç´ è¾“å‡ºï¼Œå¾—åˆ°n ä¸ªå…ƒç´ ä¸­æœ€å°(æˆ–æœ€å¤§)çš„å…ƒç´ ï¼Œè¿™æ—¶å †çš„æ ¹èŠ‚ç‚¹çš„æ•°æœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰ã€‚ç„¶åå¯¹å‰é¢(n-1)ä¸ªå…ƒç´ é‡æ–°è°ƒæ•´ä½¿ä¹‹æˆä¸ºå †ï¼Œè¾“å‡ºå †é¡¶å…ƒç´ ï¼Œå¾—åˆ°n ä¸ªå…ƒç´ ä¸­æ¬¡å°(æˆ–æ¬¡å¤§)çš„å…ƒç´ ã€‚ä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°åªæœ‰ä¸¤ä¸ªèŠ‚ç‚¹çš„å †ï¼Œå¹¶å¯¹å®ƒä»¬ä½œäº¤æ¢ï¼Œæœ€åå¾—åˆ°æœ‰nä¸ªèŠ‚ç‚¹çš„æœ‰åºåºåˆ—ã€‚ç§°è¿™ä¸ªè¿‡ç¨‹ä¸ºå †æ’åºã€‚ å› æ­¤ï¼Œå®ç°å †æ’åºéœ€è§£å†³ä¸¤ä¸ªé—®é¢˜ï¼š å¦‚ä½•å°†n ä¸ªå¾…æ’åºçš„æ•°å»ºæˆå †ï¼› è¾“å‡ºå †é¡¶å…ƒç´ åï¼Œæ€æ ·è°ƒæ•´å‰©ä½™n-1 ä¸ªå…ƒç´ ï¼Œä½¿å…¶æˆä¸ºä¸€ä¸ªæ–°å †ã€‚ é¦–å…ˆè®¨è®ºç¬¬äºŒä¸ªé—®é¢˜ï¼šè¾“å‡ºå †é¡¶å…ƒç´ åï¼Œå¯¹å‰©ä½™n-1å…ƒç´ é‡æ–°å»ºæˆå †çš„è°ƒæ•´è¿‡ç¨‹ã€‚ è°ƒæ•´å°é¡¶å †çš„æ–¹æ³•ï¼š 1ï¼‰è®¾æœ‰m ä¸ªå…ƒç´ çš„å †ï¼Œè¾“å‡ºå †é¡¶å…ƒç´ åï¼Œå‰©ä¸‹m-1 ä¸ªå…ƒç´ ã€‚å°†å †åº•å…ƒç´ é€å…¥å †é¡¶ï¼ˆï¼ˆæœ€åä¸€ä¸ªå…ƒç´ ä¸å †é¡¶è¿›è¡Œäº¤æ¢ï¼‰ï¼Œå †è¢«ç ´åï¼Œå…¶åŸå› ä»…æ˜¯æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ã€‚ 2ï¼‰å°†æ ¹ç»“ç‚¹ä¸å·¦ã€å³å­æ ‘ä¸­è¾ƒå°å…ƒç´ çš„è¿›è¡Œäº¤æ¢ã€‚ 3ï¼‰è‹¥ä¸å·¦å­æ ‘äº¤æ¢ï¼šå¦‚æœå·¦å­æ ‘å †è¢«ç ´åï¼Œå³å·¦å­æ ‘çš„æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ï¼Œåˆ™é‡å¤æ–¹æ³• ï¼ˆ2ï¼‰. 4ï¼‰è‹¥ä¸å³å­æ ‘äº¤æ¢ï¼Œå¦‚æœå³å­æ ‘å †è¢«ç ´åï¼Œå³å³å­æ ‘çš„æ ¹ç»“ç‚¹ä¸æ»¡è¶³å †çš„æ€§è´¨ã€‚åˆ™é‡å¤æ–¹æ³• ï¼ˆ2ï¼‰. 5ï¼‰ç»§ç»­å¯¹ä¸æ»¡è¶³å †æ€§è´¨çš„å­æ ‘è¿›è¡Œä¸Šè¿°äº¤æ¢æ“ä½œï¼Œç›´åˆ°å¶å­ç»“ç‚¹ï¼Œå †è¢«å»ºæˆã€‚ ç§°è¿™ä¸ªè‡ªæ ¹ç»“ç‚¹åˆ°å¶å­ç»“ç‚¹çš„è°ƒæ•´è¿‡ç¨‹ä¸ºç­›é€‰ã€‚å¦‚å›¾ï¼š å†è®¨è®ºå¯¹n ä¸ªå…ƒç´ åˆå§‹å»ºå †çš„è¿‡ç¨‹ã€‚ å»ºå †æ–¹æ³•ï¼šå¯¹åˆå§‹åºåˆ—å»ºå †çš„è¿‡ç¨‹ï¼Œå°±æ˜¯ä¸€ä¸ªåå¤è¿›è¡Œç­›é€‰çš„è¿‡ç¨‹ã€‚ 1ï¼‰n ä¸ªç»“ç‚¹çš„å®Œå…¨äºŒå‰æ ‘ï¼Œåˆ™æœ€åä¸€ä¸ªç»“ç‚¹æ˜¯ç¬¬ä¸ªç»“ç‚¹çš„å­æ ‘ã€‚ 2ï¼‰ç­›é€‰ä»ç¬¬ ä¸ªç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘å¼€å§‹ï¼Œè¯¥å­æ ‘æˆä¸ºå †ã€‚ 3ï¼‰ä¹‹åå‘å‰ä¾æ¬¡å¯¹å„ç»“ç‚¹ä¸ºæ ¹çš„å­æ ‘è¿›è¡Œç­›é€‰ï¼Œä½¿ä¹‹æˆä¸ºå †ï¼Œç›´åˆ°æ ¹ç»“ç‚¹ã€‚ å¦‚å›¾å»ºå †åˆå§‹è¿‡ç¨‹ï¼šæ— åºåºåˆ—ï¼šï¼ˆ49ï¼Œ38ï¼Œ65ï¼Œ97ï¼Œ76ï¼Œ13ï¼Œ27ï¼Œ49ï¼‰ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å †æ’åº */public class HeapSort { /** * å †æ’åºçš„æ˜¯é›†åˆäº†æ’å…¥æ’åºçš„å•æ•°ç»„æ“ä½œï¼Œåˆæœ‰å½’å¹¶æ’åºçš„æ—¶é—´å¤æ‚åº¦ï¼Œå®Œç¾çš„ç»“åˆäº†2è€…çš„ä¼˜ç‚¹ã€‚ */ public static void heapSort(int[] numArr) { //å°†æ— åºå †æ„é€ æˆä¸€ä¸ªå¤§æ ¹å †ï¼Œå¤§æ ¹å †æœ‰length/2ä¸ªçˆ¶èŠ‚ç‚¹ for (int i = numArr.length / 2 - 1; i &gt;= 0; i--) { headAdjust(numArr, i, numArr.length); } //é€æ­¥å°†æ¯ä¸ªæœ€å¤§å€¼çš„æ ¹èŠ‚ç‚¹ä¸æœ«å°¾å…ƒç´ äº¤æ¢ï¼Œå¹¶ä¸”å†è°ƒæ•´å…¶ä¸ºæœ€å¤§å † for (int i = numArr.length - 1; i &gt; 0; i--) { //å°†å †é¡¶å…ƒç´ å’Œå½“å‰æœªç»æ’åºçš„å­åºåˆ—çš„æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢ä½ç½® swap(numArr, 0, i); headAdjust(numArr, 0, i); } } /** * æ„é€ å¤§æ ¹å † */ public static void headAdjust(int[] numArr, int parent, int length) { //ä¿å­˜å½“å‰çˆ¶èŠ‚ç‚¹ int temp = numArr[parent]; //å¾—åˆ°å·¦å­©å­ int leftChild = 2 * parent + 1; while (leftChild &lt; length) { //å¦‚æœparentæœ‰å·¦å­©å­ï¼Œåˆ™è¦åˆ¤æ–­å·¦å­©å­æ˜¯å¦å°äºå³å­©å­ if (leftChild + 1 &lt; length &amp;&amp; numArr[leftChild] &lt; numArr[leftChild + 1]) { leftChild++; } //å¦‚æœçˆ¶èŠ‚ç‚¹å¤§äºå­èŠ‚ç‚¹ï¼Œå°±ä¸äº¤æ¢ if (temp &gt;= numArr[leftChild]) { break; } //å°†è¾ƒå¤§å­èŠ‚ç‚¹çš„å€¼èµ‹ç»™çˆ¶èŠ‚ç‚¹ numArr[parent] = numArr[leftChild]; //ç„¶åå°†å­èŠ‚ç‚¹ä½œä¸ºçˆ¶èŠ‚ç‚¹ parent = leftChild; //æ‰¾åˆ°è¯¥çˆ¶èŠ‚ç‚¹è¾ƒå°çš„å·¦å­©å­ leftChild = 2 * parent + 1; } //æœ€åå°†tempçš„å€¼èµ‹ç»™è¾ƒå¤§çš„å­èŠ‚ç‚¹ï¼Œä»¥å½¢æˆä¸¤å€¼äº¤æ¢ numArr[parent] = temp; } /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªä½ç½®çš„å…ƒç´  */ public static void swap(int[] numArr, int top, int last) { int temp = numArr[top]; numArr[top] = numArr[last]; numArr[last] = temp; } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************å †æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); heapSort(numArr); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼--å•ä¾‹æ¨¡å¼]]></title>
    <url>%2Fposts%2F6d67519e.html</url>
    <content type="text"><![CDATA[å•ä¾‹æ¨¡å¼ä»‹ç» ** æ„å›¾ **ï¼šä¿è¯ä¸€ä¸ªç±»ä»…æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå¹¶æä¾›ä¸€ä¸ªè®¿é—®å®ƒçš„å…¨å±€è®¿é—®ç‚¹ã€‚ ** ä¸»è¦è§£å†³ **ï¼šä¸€ä¸ªå…¨å±€ä½¿ç”¨çš„ç±»é¢‘ç¹åœ°åˆ›å»ºä¸é”€æ¯ã€‚ ** ä½•æ—¶ä½¿ç”¨ **ï¼šå½“æ‚¨æƒ³æ§åˆ¶å®ä¾‹æ•°ç›®ï¼ŒèŠ‚çœç³»ç»Ÿèµ„æºçš„æ—¶å€™ã€‚ ** å¦‚ä½•è§£å†³ **ï¼šåˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å·²ç»æœ‰è¿™ä¸ªå•ä¾‹ï¼Œå¦‚æœæœ‰åˆ™è¿”å›ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºã€‚ ** å…³é”®ä»£ç  **ï¼šæ„é€ å‡½æ•°æ˜¯ç§æœ‰çš„ã€‚ ** ä¼˜ç‚¹ **ï¼š åœ¨å†…å­˜é‡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œå‡å°‘äº†å†…å­˜çš„å¼€é”€ï¼Œå°¤å…¶æ˜¯é¢‘ç¹çš„åˆ›å»ºå’Œé”€æ¯å®ä¾‹ï¼ˆæ¯”å¦‚ç®¡ç†å­¦é™¢é¦–é¡µé¡µé¢ç¼“å­˜ï¼‰ã€‚ é¿å…å¯¹èµ„æºçš„å¤šé‡å ç”¨ï¼ˆæ¯”å¦‚å†™æ–‡ä»¶æ“ä½œï¼‰ã€‚ ** ç¼ºç‚¹ **ï¼šæ²¡æœ‰æ¥å£ï¼Œä¸èƒ½ç»§æ‰¿ï¼Œä¸å•ä¸€èŒè´£åŸåˆ™å†²çªï¼Œä¸€ä¸ªç±»åº”è¯¥åªå…³å¿ƒå†…éƒ¨é€»è¾‘ï¼Œè€Œä¸å…³å¿ƒå¤–é¢æ€ä¹ˆæ ·æ¥å®ä¾‹åŒ–ã€‚ ** ä½¿ç”¨åœºæ™¯ **ï¼š è¦æ±‚ç”Ÿäº§å”¯ä¸€åºåˆ—å·ã€‚ WEB ä¸­çš„è®¡æ•°å™¨ï¼Œä¸ç”¨æ¯æ¬¡åˆ·æ–°éƒ½åœ¨æ•°æ®åº“é‡ŒåŠ ä¸€æ¬¡ï¼Œç”¨å•ä¾‹å…ˆç¼“å­˜èµ·æ¥ã€‚ åˆ›å»ºçš„ä¸€ä¸ªå¯¹è±¡éœ€è¦æ¶ˆè€—çš„èµ„æºè¿‡å¤šï¼Œæ¯”å¦‚ I/O ä¸æ•°æ®åº“çš„è¿æ¥ç­‰ã€‚ æ³¨æ„äº‹é¡¹ï¼šgetInstance() æ–¹æ³•ä¸­éœ€è¦ä½¿ç”¨åŒæ­¥é” synchronized (Singleton.class) é˜²æ­¢å¤šçº¿ç¨‹åŒæ—¶è¿›å…¥é€ æˆ instance è¢«å¤šæ¬¡å®ä¾‹åŒ–ã€‚ å®ç°æ–¹å¼ é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 12345678910111213141516171819202122package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ * ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ * ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæœã€‚å¦‚æœä»å§‹è‡³ç»ˆä»æœªä½¿ç”¨è¿‡è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚ */public class Hungry { //è‡ªæœ‰æ°¸ä¹…çš„å¯¹è±¡ private static final Hungry hungry = new Hungry(); //æ„é€ å™¨ç§æœ‰åŒ– private Hungry() { System.out.println("é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰..."); } public static Hungry getInstance() { return hungry; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * é¥¿æ±‰å¼ï¼ˆé™æ€å¸¸é‡ï¼‰ã€å¯ç”¨ã€‘ */ Hungry hungry = Hungry.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„hungryå¯¹è±¡çš„hashCodeï¼š" + hungry.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ * å°†ç±»å®ä¾‹åŒ–çš„è¿‡ç¨‹æ”¾åœ¨äº†é™æ€ä»£ç å—ä¸­ï¼Œä¹Ÿæ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™ï¼Œå°±æ‰§è¡Œé™æ€ä»£ç å—ä¸­çš„ä»£ç ï¼Œåˆå§‹åŒ–ç±»çš„å®ä¾‹ã€‚ * ä¼˜ç‚¹ï¼šè¿™ç§å†™æ³•æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯åœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ã€‚é¿å…äº†çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ * ç¼ºç‚¹ï¼šåœ¨ç±»è£…è½½çš„æ—¶å€™å°±å®Œæˆå®ä¾‹åŒ–ï¼Œæ²¡æœ‰è¾¾åˆ°Lazy Loadingçš„æ•ˆæœã€‚å¦‚æœä»å§‹è‡³ç»ˆä»æœªä½¿ç”¨è¿‡è¿™ä¸ªå®ä¾‹ï¼Œåˆ™ä¼šé€ æˆå†…å­˜çš„æµªè´¹ã€‚ */public class Hungry2 { private static Hungry2 hungry2; static { hungry2 = new Hungry2(); } private Hungry2() { System.out.println("é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰..."); } public static Hungry2 getInstance() { return hungry2; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * é¥¿æ±‰å¼ï¼ˆé™æ€ä»£ç å—ï¼‰ã€å¯ç”¨ã€‘ */ Hungry2 hungry2 = Hungry2.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„hungry2å¯¹è±¡çš„hashCodeï¼š" + hungry2.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 123456789101112131415161718192021222324package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ * è¿™ç§å†™æ³•èµ·åˆ°äº†Lazy Loadingçš„æ•ˆæœï¼Œä½†æ˜¯åªèƒ½åœ¨å•çº¿ç¨‹ä¸‹ä½¿ç”¨ã€‚ * å¦‚æœåœ¨å¤šçº¿ç¨‹ä¸‹ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†if (singleton == null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œ * è¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚æ‰€ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¸å¯ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚ */public class Lazy { private static Lazy lazy; private Lazy() { System.out.println("æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰..."); } public static Lazy getInstance() { if (lazy == null) { lazy = new Lazy(); } return lazy; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * æ‡’æ±‰å¼ï¼ˆçº¿ç¨‹ä¸å®‰å…¨ï¼‰ã€ä¸å¯ç”¨ã€‘ */ Lazy lazy = Lazy.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„lazyå¯¹è±¡çš„hashCodeï¼š" + lazy.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æ¨èç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 123456789101112131415161718192021222324package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æ¨èç”¨ã€‘ * æœ‰ç‚¹ï¼šè§£å†³äº†çº¿ç¨‹ä¸å®‰å…¨é—®é¢˜ï¼Œåšä¸ªçº¿ç¨‹åŒæ­¥å°±å¯ä»¥äº†ï¼Œäºæ˜¯å°±å¯¹getInstance()æ–¹æ³•è¿›è¡Œäº†çº¿ç¨‹åŒæ­¥ã€‚ * ç¼ºç‚¹ï¼šæ•ˆç‡å¤ªä½äº†ï¼Œæ¯ä¸ªçº¿ç¨‹åœ¨æƒ³è·å¾—ç±»çš„å®ä¾‹æ—¶å€™ï¼Œæ‰§è¡ŒgetInstance()æ–¹æ³•éƒ½è¦è¿›è¡ŒåŒæ­¥ã€‚ * è€Œå…¶å®è¿™ä¸ªæ–¹æ³•åªæ‰§è¡Œä¸€æ¬¡å®ä¾‹åŒ–ä»£ç å°±å¤Ÿäº†ï¼Œåé¢çš„æƒ³è·å¾—è¯¥ç±»å®ä¾‹ï¼Œç›´æ¥returnå°±è¡Œäº†ã€‚æ–¹æ³•è¿›è¡ŒåŒæ­¥æ•ˆç‡å¤ªä½è¦æ”¹è¿›ã€‚ */public class Lazy2 { private static Lazy2 lazy; private Lazy2() { System.out.println("æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)..."); } public static synchronized Lazy2 getInstance() { if (lazy == null) { lazy = new Lazy2(); } return lazy; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥æ–¹æ³•)ã€ä¸æ¨èç”¨ã€‘ */ Lazy2 lazy2 = Lazy2.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„lazy2å¯¹è±¡çš„hashCodeï¼š" + lazy2.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ ï¼Œ åŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ ï¼Œ åŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ * ç”±äºåŒæ­¥æ–¹æ³•çš„åŒæ­¥æ•ˆç‡å¤ªä½ï¼Œæ‰€ä»¥æ‘’å¼ƒåŒæ­¥æ–¹æ³•ï¼Œæ”¹ä¸ºåŒæ­¥äº§ç”Ÿå®ä¾‹åŒ–çš„çš„ä»£ç å—ã€‚ * ä½†æ˜¯è¿™ç§åŒæ­¥å¹¶ä¸èƒ½èµ·åˆ°çº¿ç¨‹åŒæ­¥çš„ä½œç”¨ã€‚å‡å¦‚ä¸€ä¸ªçº¿ç¨‹è¿›å…¥äº†if (singleton == null)åˆ¤æ–­è¯­å¥å—ï¼Œè¿˜æœªæ¥å¾—åŠå¾€ä¸‹æ‰§è¡Œï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿé€šè¿‡äº†è¿™ä¸ªåˆ¤æ–­è¯­å¥ï¼Œè¿™æ—¶ä¾¿ä¼šäº§ç”Ÿå¤šä¸ªå®ä¾‹ã€‚ */public class Lazy3 { private static volatile Lazy3 lazy; private Lazy3() { System.out.println("æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)..."); } public static Lazy3 getInstance() { if (lazy == null) { synchronized (Lazy3.class) { lazy = new Lazy3(); } } return lazy; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * æ‡’æ±‰å¼(çº¿ç¨‹å®‰å…¨ï¼ŒåŒæ­¥ä»£ç å—)ã€ä¸å¯ç”¨ã€‘ */ Lazy3 lazy3 = Lazy3.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„lazy3å¯¹è±¡çš„hashCodeï¼š" + lazy3.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š é™æ€å†…éƒ¨ç±»ã€æ¨èç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 12345678910111213141516171819202122232425package main.java.com.study.designPatterns.single;/** * @author: whb * @description: é™æ€å†…éƒ¨ç±»ã€æ¨èç”¨ã€‘ * è¿™ç§æ–¹å¼è·Ÿé¥¿æ±‰å¼æ–¹å¼é‡‡ç”¨çš„æœºåˆ¶ç±»ä¼¼ï¼Œä½†åˆæœ‰ä¸åŒã€‚ä¸¤è€…éƒ½æ˜¯é‡‡ç”¨äº†ç±»è£…è½½çš„æœºåˆ¶æ¥ä¿è¯åˆå§‹åŒ–å®ä¾‹æ—¶åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚ä¸åŒçš„åœ°æ–¹åœ¨é¥¿æ±‰å¼æ–¹å¼æ˜¯åªè¦Singletonç±»è¢«è£…è½½å°±ä¼šå®ä¾‹åŒ–ï¼Œæ²¡æœ‰Lazy-Loadingçš„ä½œç”¨ï¼Œè€Œé™æ€å†…éƒ¨ç±»æ–¹å¼åœ¨Singletonç±»è¢«è£…è½½æ—¶å¹¶ä¸ä¼šç«‹å³å®ä¾‹åŒ–ï¼Œè€Œæ˜¯åœ¨éœ€è¦å®ä¾‹åŒ–æ—¶ï¼Œè°ƒç”¨getInstanceæ–¹æ³•ï¼Œæ‰ä¼šè£…è½½SingletonInstanceç±»ï¼Œä»è€Œå®ŒæˆSingletonçš„å®ä¾‹åŒ–ã€‚ * &lt;p&gt; * ç±»çš„é™æ€å±æ€§åªä¼šåœ¨ç¬¬ä¸€æ¬¡åŠ è½½ç±»çš„æ—¶å€™åˆå§‹åŒ–ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼ŒJVMå¸®åŠ©æˆ‘ä»¬ä¿è¯äº†çº¿ç¨‹çš„å®‰å…¨æ€§ï¼Œåœ¨ç±»è¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œåˆ«çš„çº¿ç¨‹æ˜¯æ— æ³•è¿›å…¥çš„ã€‚ * &lt;p&gt; * ä¼˜ç‚¹ï¼šé¿å…äº†çº¿ç¨‹ä¸å®‰å…¨ï¼Œå»¶è¿ŸåŠ è½½ï¼Œæ•ˆç‡é«˜ã€‚ */public class StaticInnerClass { private StaticInnerClass() { System.out.println("é™æ€å†…éƒ¨ç±»..."); } private static class SingletonInstance { private static StaticInnerClass instance = new StaticInnerClass(); } public static StaticInnerClass getInstance() { return SingletonInstance.instance; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * é™æ€å†…éƒ¨ç±»ã€æ¨èç”¨ã€‘ */ StaticInnerClass staticInnerClass = StaticInnerClass.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„staticInnerClasså¯¹è±¡çš„hashCodeï¼š" + staticInnerClass.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š åŒé‡æ£€æŸ¥ã€æ¨èç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 123456789101112131415161718192021222324252627package main.java.com.study.designPatterns.single;/** * @author: whb * @description: åŒé‡æ£€æŸ¥ã€æ¨èç”¨ã€‘ * æˆ‘ä»¬è¿›è¡Œäº†ä¸¤æ¬¡if (doubleCheck == null)æ£€æŸ¥ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨äº†ã€‚è¿™æ ·ï¼Œå®ä¾‹åŒ–ä»£ç åªç”¨æ‰§è¡Œä¸€æ¬¡ï¼Œåé¢å†æ¬¡è®¿é—®æ—¶ï¼Œåˆ¤æ–­if (doubleCheck == null)ï¼Œç›´æ¥returnå®ä¾‹åŒ–å¯¹è±¡ã€‚ * ä¼˜ç‚¹ï¼šçº¿ç¨‹å®‰å…¨ï¼›å»¶è¿ŸåŠ è½½ï¼›æ•ˆç‡è¾ƒé«˜ã€‚ */public class DoubleCheck { private static volatile DoubleCheck doubleCheck; private DoubleCheck() { System.out.println("åŒé‡æ£€æŸ¥..."); } public static DoubleCheck getInstance() { if (doubleCheck == null) { synchronized (DoubleCheck.class) { if (doubleCheck == null) { doubleCheck = new DoubleCheck(); } } } return doubleCheck; }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * åŒé‡æ£€æŸ¥ã€æ¨èç”¨ã€‘ */ DoubleCheck doubleCheck = DoubleCheck.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„doubleCheckå¯¹è±¡çš„hashCodeï¼š" + doubleCheck.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š æšä¸¾ã€æ¨èç”¨ã€‘ ** ä»£ç å®ç° **ï¼š 12345678910111213package main.java.com.study.designPatterns.single;/** * @author: whb * @description: æšä¸¾ã€æ¨èç”¨ã€‘ * ä¸ä»…èƒ½é¿å…å¤šçº¿ç¨‹åŒæ­¥é—®é¢˜ï¼Œè€Œä¸”è¿˜èƒ½é˜²æ­¢ååºåˆ—åŒ–é‡æ–°åˆ›å»ºæ–°çš„å¯¹è±¡ã€‚ */public enum EnumSingleton { Instance; public void whatEverMethod() { }} ** æµ‹è¯•ç±» **ï¼š 123456789101112131415161718192021package main.java.com.study.designPatterns.single;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼æµ‹è¯• */public class singletonTest { public static void main(String[] args) { for (int i = 0; i &lt; 10; i++) { int finalI = i; new Thread(() -&gt; { /** * åŒé‡æ£€æŸ¥ã€æ¨èç”¨ã€‘ */ DoubleCheck doubleCheck = DoubleCheck.getInstance(); System.out.println("ç¬¬" + (finalI + 1) + "æ¬¡è·å¾—çš„doubleCheckå¯¹è±¡çš„hashCodeï¼š" + doubleCheck.hashCode()); }).start(); } }} ** è¾“å‡ºç»“æœ **ï¼š CASã€ä¸æ¨èç”¨ã€‘ 123456789101112131415161718192021222324252627282930package com.springboot.whb.study.netty;/** * @author: whb * @description: å•ä¾‹æ¨¡å¼CASå®ç° * ä¼˜ç‚¹ï¼šä¸éœ€è¦ä½¿ç”¨ä¼ ç»Ÿçš„é”æœºåˆ¶æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ï¼ŒCAS æ˜¯ä¸€ç§åŸºäºå¿™ç­‰å¾…çš„ç®—æ³•ï¼Œä¾èµ–åº•å±‚ç¡¬ä»¶çš„å®ç°ï¼Œç›¸å¯¹äºé”å®ƒæ²¡æœ‰çº¿ç¨‹åˆ‡æ¢å’Œé˜»å¡çš„é¢å¤–æ¶ˆè€—ï¼Œå¯ä»¥æ”¯æŒè¾ƒå¤§çš„å¹¶è¡Œåº¦ã€‚ * ç¼ºç‚¹ï¼šå¦‚æœå¿™ç­‰å¾…ä¸€ç›´æ‰§è¡Œä¸æˆåŠŸ(ä¸€ç›´åœ¨æ­»å¾ªç¯ä¸­)ï¼Œä¼šå¯¹ CPU é€ æˆè¾ƒå¤§çš„æ‰§è¡Œå¼€é”€ã€‚è€Œä¸”ï¼Œè¿™ç§å†™æ³•å¦‚æœæœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œ singleton = new Singleton(); ä¹Ÿä¼šæ¯”è¾ƒè€—è´¹å †å†…å­˜ã€‚ */public class Singleton { // AtomicReference æ˜¯åŸå­å¼•ç”¨ç±»å‹ private static final AtomicReference&lt;Singleton&gt; INSTANCE = new AtomicReference&lt;Singleton&gt;();â€‹ private Singleton() { }â€‹ public static Singleton getInstance() { for (; ; ) { Singleton instance = INSTANCE.get(); if (instance != null) { return instance; } instance = new Singleton(); // CAS æ–¹æ³•æœ‰ä¸¤ä¸ªå‚æ•° expect å’Œ updateï¼Œä»¥åŸå­æ–¹å¼å®ç°äº†æ¯”è¾ƒå¹¶è®¾ç½®çš„åŠŸèƒ½ // å¦‚æœå½“å‰å€¼ç­‰äº expectï¼Œåˆ™æ›´æ–°ä¸º update å¹¶è¿”å› trueï¼›å¦åˆ™ä¸æ›´æ–°å¹¶è¿”å› false if (INSTANCE.compareAndSet(null, instance)) { return instance; } } }} Lockæœºåˆ¶ã€æ¨èç”¨ã€‘ 1234567891011121314151617181920212223242526package com.springboot.whb.study.netty;/** * @author: whb * @description: ç±»ä¼¼åŒé‡æ£€æŸ¥ */public class Singleton { private static Singleton instance = null; private static Lock lock = new ReentrantLock();â€‹ private Singleton() { }â€‹ public static Singleton getInstance() { if (instance == null) { lock.lock(); // æ˜¾å¼è°ƒç”¨ï¼Œæ‰‹åŠ¨åŠ é” if (instance == null) { instance = new Singleton(); } lock.unlock(); // æ˜¾å¼è°ƒç”¨ï¼Œæ‰‹åŠ¨è§£é” } return instance; }} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - å¸Œå°”æ’åº]]></title>
    <url>%2Fposts%2F94971cbd.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚å¸Œå°”æ’åºï¼Œä¹Ÿç§°é€’å‡å¢é‡æ’åºç®—æ³•ï¼Œæ˜¯æ’å…¥æ’åºçš„ä¸€ç§é«˜é€Ÿè€Œç¨³å®šçš„æ”¹è¿›ç‰ˆæœ¬ã€‚ æ“ä½œæ–¹æ³• é€‰æ‹©ä¸€ä¸ªå¢é‡åºåˆ—t1ï¼Œt2ï¼Œâ€¦ï¼Œtkï¼Œå…¶ä¸­ti&gt;tjï¼Œtk=1ï¼› æŒ‰å¢é‡åºåˆ—ä¸ªæ•°kï¼Œå¯¹åºåˆ—è¿›è¡Œk è¶Ÿæ’åºï¼› æ¯è¶Ÿæ’åºï¼Œæ ¹æ®å¯¹åº”çš„å¢é‡tiï¼Œå°†å¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²é•¿åº¦ä¸ºm çš„å­åºåˆ—ï¼Œåˆ†åˆ«å¯¹å„å­è¡¨è¿›è¡Œç›´æ¥æ’å…¥æ’åºã€‚ä»…å¢é‡å› å­ä¸º1 æ—¶ï¼Œæ•´ä¸ªåºåˆ—ä½œä¸ºä¸€ä¸ªè¡¨æ¥å¤„ç†ï¼Œè¡¨é•¿åº¦å³ä¸ºæ•´ä¸ªåºåˆ—çš„é•¿åº¦ã€‚ ç®—æ³•æµç¨‹å›¾ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: å¸Œå°”æ’åº */public class ShellSort { /** * å¸Œå°”æ’åºï¼ˆShellâ€™s Sortï¼‰åˆç§°â€œç¼©å°å¢é‡æ’åºâ€(Diminishing Increment Sort)ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ç§å±äºæ’å…¥æ’åºç±»çš„æ–¹æ³•ï¼Œä½†åœ¨æ—¶é—´æ•ˆç‡ä¸Šæ¯”ç›´æ¥æ’å…¥æ’åºæ–¹æ³•æœ‰è¾ƒå¤§çš„æ”¹è¿›ã€‚ * ä»å¯¹ç›´æ¥æ’å…¥æ’åºçš„åˆ†æå¯çŸ¥ï¼Œå…¶ç®—æ³•æ—¶é—´å¤æ‚åº¦ä¸ºO(n2)ï¼Œä½†æ˜¯ï¼Œè‹¥å¾…æ’è®°å½•åºåˆ—ä¸ºâ€œæ­£åºâ€æ—¶ï¼Œå…¶æ—¶é—´å¤æ‚åº¦å¯æé«˜è‡³O(n)ã€‚ * ç”±æ­¤è®¾æƒ³ï¼Œè‹¥å¾…æ’è®°å½•åºåˆ—æŒ‰å…³é”®å­—â€œåŸºæœ¬æœ‰åºâ€ï¼Œç›´æ¥æ’å…¥æ’åºçš„æ•ˆç‡å°±å¯ä»¥å¤§å¤§æé«˜ã€‚ * ä»å¦ä¸€æ–¹é¢æ¥çœ‹ï¼Œç”±äºç›´æ¥æ’å…¥æ’åºç®—æ³•ç®€å•ï¼Œæ‰€ä»¥åœ¨nå€¼å¾ˆå°æ—¶æ•ˆç‡æ¯”è¾ƒé«˜ã€‚å¸Œå°”æ’åºæ­£æ˜¯ä»è¿™ä¸¤ç‚¹åˆ†æå‡ºå‘å¯¹ç›´æ¥æ’å…¥æ’åºè¿›è¡Œæ”¹è¿›è€Œå¾—åˆ°çš„ä¸€ç§æ’å…¥æ’åºæ–¹æ³•ã€‚ * &lt;p&gt; * å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’åºåˆ—åˆ†å‰²æˆè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€œåŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¸€æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚ï¼ˆè¿™æ˜¯ã€Šæ•°æ®ç»“æ„ã€‹è¿™æœ¬ä¹¦é‡Œçš„è¯´æ³•ã€‚ï¼‰ * &lt;p&gt; * é€šä¿—ç‚¹è¯´å°±æ˜¯ï¼šå…ˆå–è¾ƒå¤§çš„æ­¥é•¿å¯¹å¾…æ’åºåˆ—è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œæ¯æ’ä¸€æ¬¡å°±ç¼©å°ä¸€æ¬¡æ­¥é•¿ï¼Œå†è¿›è¡Œæ’å…¥æ’åºï¼Œç›´åˆ°æœ€åæ­¥é•¿å˜ä¸º1ã€‚ */ public static void shellSort(int[] numArr) { int length = numArr.length; //å–å¢é‡ int gap = length / 2; while (gap &gt;= 1) { //æ— åºåºåˆ— for (int i = gap; i &lt; length; i++) { int temp = numArr[i]; int j; //æœ‰åºåºåˆ— for (j = i - gap; j &gt;= 0 &amp;&amp; numArr[j] &gt; temp; j = j - gap) { numArr[j + gap] = numArr[j]; } numArr[j + gap] = temp; } //ç¼©å°å¢é‡ gap = gap / 2; } } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************å¸Œå°”æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); shellSort(numArr); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - ç æ’åº]]></title>
    <url>%2Fposts%2Fbe6df974.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å°†æ¯ä¸ªæ•°ç”¨ç å­è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šæ•°å­—5å°±æ˜¯5ä¸ªç å­ã€‚ç”¨ç å­è¡¨ç¤ºå¥½æ¯ä¸€ä¸ªæ•°åï¼Œè®©æ‰€æœ‰çš„ç å­è‡ªç”±ä¸‹è½ã€‚æ’åºå®Œæˆã€‚ ä¸Šå›¾ä¸­çš„ä¸‰ä¸ªç å°±è¡¨ç¤ºæ•°å­—3,ä¸¤ä¸ªç è¡¨ç¤ºæ•°å­—2,è¿™ä¸ªOKäº†ç»§ç»­,è¿™é‡Œçš„3å’Œ2éƒ½å«beadã€‚ ä¸Šå›¾(a)ä¸­æœ‰ä¸¤ä¸ªæ•°å­—,4å’Œ3,åˆ†åˆ«ä¸²åœ¨å››æ¡çº¿ä¸Š,äºæ˜¯æ•°å­—4çš„æœ€åä¸€ä¸ªç å­ä¸‹è½,å› ä¸ºå®ƒä¸‹è¾¹æ˜¯ç©ºçš„,è‡ªç”±ä¸‹è½åå˜æˆä¸Šå›¾(b) ä¸Šå›¾(c)ä¸­éšæœºç»™äº†å››ä¸ªæ•°å­—,åˆ†åˆ«æ˜¯3,2,4,2,è¿™äº›ç å­è‡ªç”±ä¸‹è½,å°±å˜æˆäº†(d)ä¸­,è½å®Œå°±æœ‰åºäº†,2,2,3,4 ä»¥ä¸Šå°±æ˜¯ç æ’åºçš„ç²¾åã€‚ ä¸Šå›¾ä¸­çš„nè¡¨ç¤ºå¾…æ’åºæ•°ç»„çš„é•¿åº¦,æœ‰å¤šå°‘æ•°å­—å°±æœ‰å¤šå°‘å±‚,æ¨ªå‘è¡¨ç¤ºä¸€å±‚;mè¡¨ç¤ºæœ‰å¤šå°‘ä¸ªç å­,å°±æ˜¯å¤šå°‘ä¸ª1,è¿™å–å†³äºæœ€å¤§æ•°æ˜¯å‡ ã€‚ ä¸¾ä¸ªä¾‹å­ï¼šæ¯”å¦‚å¾…æ’æ•°ç»„[6 2 4 1 5 9]ã€‚ è®©ç å­å…¨éƒ¨åšè‡ªç”±è½ä½“è¿åŠ¨ 9æ²¡æœ‰ä»€ä¹ˆå¥½è½çš„,å®ƒåœ¨æœ€åº•å±‚ 5ä¹Ÿæ²¡æœ‰ä»€ä¹ˆå¥½è½çš„,å…¨éƒ¨æœ‰æ”¯æ’‘ç‚¹ 1åŒæ ·ä¸éœ€è¦æ»‘è½ 4é™¤äº†ç¬¬ä¸€ä¸ªç å­ä¸åŠ¨å¤–,å…¶å®ƒä¸‰é¢—å…¨éƒ¨ä¸‹è½,è½åˆ°1çš„ä½ç½®å˜æˆä¸‹è¾¹è¿™æ · è¿‡ç¨‹çš„ç»†èŠ‚ä¸ç”»äº†,åŸåˆ™å°±æ˜¯ä½ ä¸‹è¾¹æœ‰æ”¯ç‚¹,ä½ å°±ä¸ç”¨å†æ»‘è½äº†,æœ€åå˜æˆä¸‹è¾¹è¿™æ ·,æ’åºå®Œæ¯•ã€‚ ä»ä¸Šåˆ°ä¸‹é¡ºåºè¾“å‡ºå³å¯å¾—åˆ°ç»“æœ:[ 1 2 4 5 6 9]ã€‚ ä»£ç  1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: ç æ’åº:å°†æ¯ä¸ªæ•°ç”¨ç å­è¡¨ç¤ºï¼Œä¾‹å¦‚ï¼šæ•°å­—5å°±æ˜¯5ä¸ªç å­ã€‚ç”¨ç å­è¡¨ç¤ºå¥½æ¯ä¸€ä¸ªæ•°åï¼Œè®©æ‰€æœ‰çš„ç å­è‡ªç”±ä¸‹è½ã€‚æ’åºå®Œæˆã€‚ */public class BeadSort { /** * ç æ’åº * * @param unsorted å¾…æ’åºåˆ— * @return */ public static int[] beadSort(int[] unsorted) { //å¾…æ’åºåˆ—ä¸­çš„æœ€å¤§å€¼ int max = 0; //è·å–æœ€å¤§å€¼ for (int i = 0; i &lt; unsorted.length; i++) { if (unsorted[i] &gt; max) { max = unsorted[i]; } } //æ¯ä¸ªæ•°éƒ½ç”¨ç å­è¡¨ç¤ºï¼Œæ¯”å¦‚5å°±ç”¨5ä¸ªç å­ï¼Œæ‰€ä»¥ç”¨äºŒç»´æ•°ç»„è¡¨ç¤ºæ¯ä¸ªæ•° char[][] grid = new char[unsorted.length][max]; int[] levelCount = new int[max]; for (int i = 0; i &lt; max; i++) { levelCount[i] = 0; for (int j = 0; j &lt; unsorted.length; j++) { grid[j][i] = '_'; } } //åˆ é™¤ç å­ for (int i = 0; i &lt; unsorted.length; i++) { int num = unsorted[i]; for (int j = 0; num &gt; 0; j++) { grid[levelCount[j]++][j] = '*'; num--; } } //æ•°ç å­ï¼Œæ”¾åˆ°å·²æ’åºåˆ—è¡¨ int[] sorted = new int[unsorted.length]; for (int i = 0; i &lt; unsorted.length; i++) { int putt = 0; for (int j = 0; j &lt; max &amp;&amp; grid[unsorted.length - 1 - i][j] == '*'; j++) { putt++; } sorted[i] = putt; } return sorted; } public static void main(String[] args) { //äº§ç”Ÿéšæœºå¾…æ’åºåˆ— int[] unsorted = new int[(int) (Math.random() * 11) + 5]; for (int i = 0; i &lt; unsorted.length; i++) { unsorted[i] = (int) (Math.random() * 10); } System.out.println("**************ç æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(unsorted); System.out.println("æ’åºåï¼š"); int[] sorted = beadSort(unsorted); CommonUtils.display(sorted); }} æµ‹è¯•ç»“æœå¦‚ä¸‹ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - ç®€å•é€‰æ‹©æ’åº]]></title>
    <url>%2Fposts%2F8d8fd18d.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ åœ¨è¦æ’åºçš„ä¸€ç»„æ•°ä¸­ï¼Œé€‰å‡ºæœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸€ä¸ªæ•°ä¸ç¬¬1ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼›ç„¶ååœ¨å‰©ä¸‹çš„æ•°å½“ä¸­å†æ‰¾æœ€å°ï¼ˆæˆ–è€…æœ€å¤§ï¼‰çš„ä¸ç¬¬2ä¸ªä½ç½®çš„æ•°äº¤æ¢ï¼Œä¾æ¬¡ç±»æ¨ï¼Œç›´åˆ°ç¬¬n-1ä¸ªå…ƒç´ ï¼ˆå€’æ•°ç¬¬äºŒä¸ªæ•°ï¼‰å’Œç¬¬nä¸ªå…ƒç´ ï¼ˆæœ€åä¸€ä¸ªæ•°ï¼‰æ¯”è¾ƒä¸ºæ­¢ã€‚ æ“ä½œæ–¹æ³• ç¬¬ä¸€è¶Ÿï¼Œä»n ä¸ªè®°å½•ä¸­æ‰¾å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸ç¬¬ä¸€ä¸ªè®°å½•äº¤æ¢ï¼› ç¬¬äºŒè¶Ÿï¼Œä»ç¬¬äºŒä¸ªè®°å½•å¼€å§‹çš„n-1 ä¸ªè®°å½•ä¸­å†é€‰å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸ç¬¬äºŒä¸ªè®°å½•äº¤æ¢ï¼› ä»¥æ­¤ç±»æ¨..... ç¬¬i è¶Ÿï¼Œåˆ™ä»ç¬¬i ä¸ªè®°å½•å¼€å§‹çš„n-i+1 ä¸ªè®°å½•ä¸­é€‰å‡ºå…³é”®ç æœ€å°çš„è®°å½•ä¸ç¬¬i ä¸ªè®°å½•äº¤æ¢ï¼Œ ç›´åˆ°æ•´ä¸ªåºåˆ—æŒ‰å…³é”®ç æœ‰åºã€‚ ç®—æ³•æµç¨‹å›¾ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: é€‰æ‹©æ’åº */public class SelectionSort { /** * é€‰æ‹©æ’åºï¼šæ¯ä¸€è¶Ÿåœ¨å‰©ä½™æœªæ’åºçš„è‹¥å¹²è®°å½•ä¸­é€‰å–å…³é”®å­—æœ€å°çš„ï¼ˆä¹Ÿå¯ä»¥æ˜¯æœ€å¤§çš„ï¼‰è®°å½•ä½œä¸ºæœ‰åºåºåˆ—ä¸­ä¸‹ä¸€ä¸ªè®°å½•ã€‚ * å¦‚ç¬¬iè¶Ÿé€‰æ‹©æ’åºå°±æ˜¯åœ¨n-i+1ä¸ªè®°å½•ä¸­é€‰å–å…³é”®å­—æœ€å°çš„è®°å½•ä½œä¸ºæœ‰åºåºåˆ—ä¸­ç¬¬iä¸ªè®°å½•ã€‚ * è¿™æ ·ï¼Œæ•´ä¸ªåºåˆ—å…±éœ€è¦n-1è¶Ÿæ’åºã€‚ */ public static void selctionSort(int[] numArr) { int length = numArr.length; //è¦éå†çš„æ¬¡æ•°ï¼ˆlength-1ï¼‰ for (int i = 0; i &lt; length - 1; i++) { //å°†å½“å‰ä¸‹æ ‡å®šä¹‰ä¸ºæœ€å°å€¼ä¸‹æ ‡ int min = i; //éå†minä¹‹åçš„æ•°æ® for (int j = i + 1; j &lt; length - 1; j++) { //å¦‚æœæœ‰å°äºå½“å‰æœ€å°å€¼çš„å…ƒç´ ï¼Œå°†å®ƒçš„ä¸‹æ ‡èµ‹å€¼ç»™min if (numArr[j] &lt; numArr[min]) { min = j; } } //å¦‚æœminä¸ç­‰äºiï¼Œåˆ™è¯´æ˜æ‰¾åˆ°äº†çœŸæ­£çš„æœ€å°å€¼ if (min != i) { swap(numArr, min, i); } } } /** * äº¤æ¢æ•°ç»„ä¸­ä¸¤ä¸ªå…ƒç´ çš„ä½ç½® * * @param numArr * @param min * @param i */ public static void swap(int[] numArr, int min, int i) { int temp = numArr[min]; numArr[min] = numArr[i]; numArr[i] = temp; } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************é€‰æ‹©æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); selctionSort(numArr); CommonUtils.display(numArr); }} CommonUtilså·¥å…·ç±»ï¼š 12345678910111213141516171819202122package main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æ’åºç®—æ³• - ç›´æ¥æ’å…¥æ’åº]]></title>
    <url>%2Fposts%2Fda1a6844.html</url>
    <content type="text"><![CDATA[åŸºæœ¬æ€æƒ³ å°†ä¸€ä¸ªè®°å½•æ’å…¥åˆ°å·²æ’åºå¥½çš„æœ‰åºè¡¨ä¸­ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°ï¼Œè®°å½•æ•°å¢1çš„æœ‰åºè¡¨ã€‚å³ï¼šå…ˆå°†åºåˆ—çš„ç¬¬1ä¸ªè®°å½•çœ‹æˆæ˜¯ä¸€ä¸ªæœ‰åºçš„å­åºåˆ—ï¼Œç„¶åä»ç¬¬2ä¸ªè®°å½•é€ä¸ªè¿›è¡Œæ’å…¥ï¼Œç›´è‡³æ•´ä¸ªåºåˆ—æœ‰åºä¸ºæ­¢ã€‚ æ“ä½œæ–¹æ³• ä»ç¬¬ä¸€ä¸ªå…ƒç´ å¼€å§‹ï¼Œè¯¥å…ƒç´ å¯ä»¥è®¤ä¸ºå·²ç»è¢«æ’åº å–å‡ºä¸‹ä¸€ä¸ªå…ƒç´ ï¼Œåœ¨å·²ç»æ’åºçš„å…ƒç´ åºåˆ—ä¸­ä»åå‘å‰æ‰«æ å¦‚æœè¯¥å…ƒç´ ï¼ˆå·²æ’åºï¼‰å¤§äºæ–°å…ƒç´ ï¼Œå°†è¯¥å…ƒç´ ç§»åˆ°ä¸‹ä¸€ä½ç½® é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æ‰¾åˆ°å·²æ’åºçš„å…ƒç´ å°äºæˆ–è€…ç­‰äºæ–°å…ƒç´ çš„ä½ç½® å°†æ–°å…ƒç´ æ’å…¥åˆ°è¯¥ä½ç½®å é‡å¤æ­¥éª¤2~5 ç®—æ³•æµç¨‹å›¾ ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182package main.java.com.study.sortingAalgorithm;import main.java.com.study.utils.CommonUtils;/** * @author: whb * @description: æ’å…¥æ’åº */public class InsertSort { /** * ç›´æ¥æ’å…¥æ’åºæ˜¯ä¸€ç§æœ€ç®€å•çš„æ’åºæ–¹æ³•ï¼Œå®ƒçš„åŸºæœ¬æ“ä½œæ˜¯å°†ä¸€ä¸ªè®°å½•æ’å…¥åˆ°å·²æ’å¥½çš„æœ‰åºçš„è¡¨ä¸­ï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæ–°çš„ã€è®°å½•æ•°å¢1çš„æœ‰åºè¡¨ã€‚ * &lt;p&gt; * å½“å‰å…ƒç´ çš„å‰é¢å…ƒç´ å‡ä¸ºæœ‰åºï¼Œè¦æ’å…¥æ—¶ï¼Œä»å½“å‰å…ƒç´ çš„å·¦è¾¹å¼€å§‹å¾€å‰æ‰¾ï¼ˆä»åå¾€å‰æ‰¾ï¼‰ï¼Œæ¯”å½“å‰å…ƒç´ å¤§çš„å…ƒç´ å‡å¾€å³ç§»ä¸€ä¸ªä½ç½®ï¼Œæœ€åæŠŠå½“å‰å…ƒç´ æ”¾åœ¨å®ƒåº”è¯¥å‘†çš„ä½ç½®å°±è¡Œäº†ã€‚ * ç§»åŠ¨ã€æ¯”è¾ƒçš„æ¬¡æ•°å¯ä½œä¸ºè¡¡é‡æ—¶é—´å¤æ‚æ€§çš„æ ‡å‡†ã€‚ * &lt;p&gt; * æœ€ä¼˜æƒ…å†µï¼šå¦‚æœåŸå§‹çš„è¾“å…¥åºåˆ—ä¸ºæ­£åºï¼š * &lt;p&gt; * æ¯”è¾ƒæ¬¡æ•°ï¼šn-1 * &lt;p&gt; * ç§»åŠ¨æ¬¡æ•°ï¼š0 * &lt;p&gt; * æœ€å·®æƒ…å†µï¼šå¦‚æœåŸå§‹çš„è¾“å…¥åºåˆ—ä¸ºé€†åºï¼š * &lt;p&gt; * æ¯”è¾ƒæ¬¡æ•°ï¼š(n+2)(n-1)/2 * &lt;p&gt; * ç§»åŠ¨æ¬¡æ•°ï¼š(n+4)(n-1)/2 * &lt;p&gt; * æ‰€ä»¥ç›´æ¥æ’å…¥æ’åºçš„æ—¶é—´å¤æ‚åº¦ä¸ºO(n2)ã€‚ */ public static void insertSort(int[] numArr) { int length = numArr.length; for (int i = 1; i &lt; length; i++) { int temp = numArr[i]; int j; //éå†æœ‰åºåºåˆ—ï¼Œå¦‚æœæœ‰åºåºåˆ—ä¸­çš„å…ƒç´ æ¯”ä¸´æ—¶å…ƒç´ å¤§ï¼Œåˆ™å°†æœ‰åºåºåˆ—ä¸­æ¯”ä¸´æ—¶å…ƒç´ å¤§çš„å…ƒç´ ä¾æ¬¡å‘åç§»åŠ¨ for (j = i - 1; j &gt;= 0 &amp;&amp; numArr[j] &gt; temp; j--) { numArr[j + 1] = numArr[j]; } //å°†ä¸´æ—¶å…ƒç´ æ’å…¥åˆ°è…¾å‡ºçš„ä½ç½® numArr[j + 1] = temp; } } public static void main(String[] args) { int[] numArr = {27, 11, 13, 45, 34, 22, 19, 8, 3, 99, 74, 55, 88, 66}; System.out.println("**************ç›´æ¥æ’å…¥æ’åº******************"); System.out.println("æ’åºå‰ï¼š"); CommonUtils.display(numArr); System.out.println("æ’åºåï¼š"); insertSort(numArr); CommonUtils.display(numArr); }}``` CommonUtilså·¥å…·ç±»ï¼š```Javapackage main.java.com.study.utils;/** * @author: whb * @description: å·¥å…·ç±» */public class CommonUtils { /** * éå†æ‰“å° * * @param numArr */ public static void display(int[] numArr) { if (numArr != null &amp;&amp; numArr.length &gt; 0) { for (int num : numArr) { System.out.print(num + " "); } } System.out.println(""); }} æµ‹è¯•ç»“æœ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>ç®—æ³•</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>ç®—æ³•</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[è®¾è®¡æ¨¡å¼-è®¾è®¡æ¨¡å¼ç®€ä»‹]]></title>
    <url>%2Fposts%2Ff7d67188.html</url>
    <content type="text"><![CDATA[è®¾è®¡æ¨¡å¼ç®€ä»‹ è®¾è®¡æ¨¡å¼ï¼ˆDesign patternï¼‰ä»£è¡¨äº†æœ€ä½³çš„å®è·µï¼Œé€šå¸¸è¢«æœ‰ç»éªŒçš„é¢å‘å¯¹è±¡çš„è½¯ä»¶å¼€å‘äººå‘˜æ‰€é‡‡ç”¨ã€‚è®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å¼€å‘äººå‘˜åœ¨è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­é¢ä¸´çš„ä¸€èˆ¬é—®é¢˜çš„è§£å†³æ–¹æ¡ˆã€‚è¿™äº›è§£å†³æ–¹æ¡ˆæ˜¯ä¼—å¤šè½¯ä»¶å¼€å‘äººå‘˜ç»è¿‡ç›¸å½“é•¿çš„ä¸€æ®µæ—¶é—´çš„è¯•éªŒå’Œé”™è¯¯æ€»ç»“å‡ºæ¥çš„ã€‚ è®¾è®¡æ¨¡å¼æ˜¯ä¸€å¥—è¢«åå¤ä½¿ç”¨çš„ã€å¤šæ•°äººçŸ¥æ™“çš„ã€ç»è¿‡åˆ†ç±»ç¼–ç›®çš„ã€ä»£ç è®¾è®¡ç»éªŒçš„æ€»ç»“ã€‚ä½¿ç”¨è®¾è®¡æ¨¡å¼æ˜¯ä¸ºäº†é‡ç”¨ä»£ç ã€è®©ä»£ç æ›´å®¹æ˜“è¢«ä»–äººç†è§£ã€ä¿è¯ä»£ç å¯é æ€§ã€‚ æ¯«æ— ç–‘é—®ï¼Œè®¾è®¡æ¨¡å¼äºå·±äºä»–äººäºç³»ç»Ÿéƒ½æ˜¯å¤šèµ¢çš„ï¼Œè®¾è®¡æ¨¡å¼ä½¿ä»£ç ç¼–åˆ¶çœŸæ­£å·¥ç¨‹åŒ–ï¼Œè®¾è®¡æ¨¡å¼æ˜¯è½¯ä»¶å·¥ç¨‹çš„åŸºçŸ³ï¼Œå¦‚åŒå¤§å¦çš„ä¸€å—å—ç –çŸ³ä¸€æ ·ã€‚é¡¹ç›®ä¸­åˆç†åœ°è¿ç”¨è®¾è®¡æ¨¡å¼å¯ä»¥å®Œç¾åœ°è§£å†³å¾ˆå¤šé—®é¢˜ï¼Œæ¯ç§æ¨¡å¼åœ¨ç°å®ä¸­éƒ½æœ‰ç›¸åº”çš„åŸç†æ¥ä¸ä¹‹å¯¹åº”ï¼Œæ¯ç§æ¨¡å¼éƒ½æè¿°äº†ä¸€ä¸ªåœ¨æˆ‘ä»¬å‘¨å›´ä¸æ–­é‡å¤å‘ç”Ÿçš„é—®é¢˜ï¼Œä»¥åŠè¯¥é—®é¢˜çš„æ ¸å¿ƒè§£å†³æ–¹æ¡ˆï¼Œè¿™ä¹Ÿæ˜¯è®¾è®¡æ¨¡å¼èƒ½è¢«å¹¿æ³›åº”ç”¨çš„åŸå› ã€‚ è®¾è®¡æ¨¡å¼çš„ç±»å‹ æ€»å…±æœ‰ 23 ç§è®¾è®¡æ¨¡å¼ï¼Œè¿™äº›æ¨¡å¼å¯ä»¥åˆ†ä¸ºä¸‰å¤§ç±»ï¼šåˆ›å»ºå‹æ¨¡å¼ï¼ˆCreational Patternsï¼‰ã€ç»“æ„å‹æ¨¡å¼ï¼ˆStructural Patternsï¼‰ã€è¡Œä¸ºå‹æ¨¡å¼ï¼ˆBehavioral Patternsï¼‰ã€‚å½“ç„¶ï¼Œè¿˜æœ‰å¦ä¸€ç±»è®¾è®¡æ¨¡å¼ï¼šJ2EE è®¾è®¡æ¨¡å¼ã€‚ .tg {border-collapse:collapse;border-spacing:0;border-color:#aaa;} .tg td{font-family:Arial, sans-serif;font-size:14px;padding:10px 5px;border-style:solid;border-width:2px;overflow:hidden;word-break:normal;border-color:#aaa;color:#333;background-color:#fff;} .tg th{font-family:Arial, sans-serif;font-size:14px;font-weight:normal;padding:10px 5px;border-style:solid;border-width:2px;overflow:hidden;word-break:normal;border-color:#aaa;color:#fff;background-color:#f38630;} .tg .tg-84q5{border-color:#00009b;text-align:left;vertical-align:top} .tg .tg-c3ow{border-color:inherit;text-align:center;vertical-align:top} .tg .tg-hdkn{border-color:#cb0000;text-align:center;vertical-align:top} .tg .tg-tkru{border-color:#3531ff;text-align:left;vertical-align:top} åº å· æ¨¡å¼ &amp; æè¿° åŒ…æ‹¬ 1 åˆ›å»ºå‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new è¿ç®—ç¬¦ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨åˆ¤æ–­é’ˆå¯¹æŸä¸ªç»™å®šå®ä¾‹éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´åŠ çµæ´»ã€‚ â˜…å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰â˜…æŠ½è±¡å·¥å‚æ¨¡å¼ï¼ˆAbstract Factory Patternï¼‰â˜…å•ä¾‹æ¨¡å¼ï¼ˆSingleton Patternï¼‰â˜…å»ºé€ è€…æ¨¡å¼ï¼ˆBuilder Patternï¼‰â˜…åŸå‹æ¨¡å¼ï¼ˆPrototype Patternï¼‰ 2 ç»“æ„å‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼å…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚ç»§æ‰¿çš„æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡è·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚ â˜…é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰â˜…æ¡¥æ¥æ¨¡å¼ï¼ˆBridge Patternï¼‰â˜…è¿‡æ»¤å™¨æ¨¡å¼ï¼ˆFilterã€Criteria Patternï¼‰â˜…ç»„åˆæ¨¡å¼ï¼ˆComposite Patternï¼‰â˜…è£…é¥°å™¨æ¨¡å¼ï¼ˆDecorator Patternï¼‰â˜…å¤–è§‚æ¨¡å¼ï¼ˆFacade Patternï¼‰â˜…äº«å…ƒæ¨¡å¼ï¼ˆFlyweight Patternï¼‰â˜…ä»£ç†æ¨¡å¼ï¼ˆProxy Patternï¼‰ 3 è¡Œä¸ºå‹æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ â˜…è´£ä»»é“¾æ¨¡å¼ï¼ˆChain of Responsibility Patternï¼‰â˜…å‘½ä»¤æ¨¡å¼ï¼ˆCommand Patternï¼‰â˜…è§£é‡Šå™¨æ¨¡å¼ï¼ˆInterpreter Patternï¼‰â˜…è¿­ä»£å™¨æ¨¡å¼ï¼ˆIterator Patternï¼‰â˜…ä¸­ä»‹è€…æ¨¡å¼ï¼ˆMediator Patternï¼‰â˜…å¤‡å¿˜å½•æ¨¡å¼ï¼ˆMemento Patternï¼‰â˜…è§‚å¯Ÿè€…æ¨¡å¼ï¼ˆObserver Patternï¼‰â˜…çŠ¶æ€æ¨¡å¼ï¼ˆState Patternï¼‰â˜…ç©ºå¯¹è±¡æ¨¡å¼ï¼ˆNull Object Patternï¼‰â˜…ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰â˜…æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰â˜…è®¿é—®è€…æ¨¡å¼ï¼ˆVisitor Patternï¼‰ 4 J2EE æ¨¡å¼è¿™äº›è®¾è®¡æ¨¡å¼ç‰¹åˆ«å…³æ³¨è¡¨ç¤ºå±‚ã€‚è¿™äº›æ¨¡å¼æ˜¯ç”± Sun Java Center é‰´å®šçš„ã€‚ â˜…MVC æ¨¡å¼ï¼ˆMVC Patternï¼‰â˜…ä¸šåŠ¡ä»£è¡¨æ¨¡å¼ï¼ˆBusiness Delegate Patternï¼‰â˜…ç»„åˆå®ä½“æ¨¡å¼ï¼ˆComposite Entity Patternï¼‰â˜…æ•°æ®è®¿é—®å¯¹è±¡æ¨¡å¼ï¼ˆData Access Object Patternï¼‰â˜…å‰ç«¯æ§åˆ¶å™¨æ¨¡å¼ï¼ˆFront Controller Patternï¼‰â˜…æ‹¦æˆªè¿‡æ»¤å™¨æ¨¡å¼ï¼ˆIntercepting Filter Patternï¼‰â˜…æœåŠ¡å®šä½å™¨æ¨¡å¼ï¼ˆService Locator Patternï¼‰â˜…ä¼ è¾“å¯¹è±¡æ¨¡å¼ï¼ˆTransfer Object Patternï¼‰ ä¸‹é¢ç”¨ä¸€ä¸ªå›¾ç‰‡æ¥æ•´ä½“æè¿°ä¸€ä¸‹è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»ï¼š åˆ›å»ºå‹æ¨¡å¼ åˆ›å»ºå‹è®¾è®¡æ¨¡å¼æä¾›äº†ä¸€ç§åœ¨åˆ›å»ºå¯¹è±¡çš„åŒæ—¶éšè—åˆ›å»ºé€»è¾‘çš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ new è¿ç®—ç¬¦ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨åˆ¤æ–­é’ˆå¯¹æŸä¸ªç»™å®šå®ä¾‹éœ€è¦åˆ›å»ºå“ªäº›å¯¹è±¡æ—¶æ›´åŠ çµæ´»ã€‚ ç»“æ„å‹æ¨¡å¼ ç»“æ„å‹æ¨¡å¼è®¾è®¡ï¼Œå®ƒå…³æ³¨ç±»å’Œå¯¹è±¡çš„ç»„åˆã€‚ç»§æ‰¿è¿™ä¸€æ¦‚å¿µè¢«ç”¨æ¥ç»„åˆæ¥å£å’Œå®šä¹‰ç»„åˆå¯¹è±¡è·å¾—æ–°åŠŸèƒ½çš„æ–¹å¼ã€‚ è¡Œä¸ºå‹æ¨¡å¼ è¡Œä¸ºå‹æ¨¡å¼è®¾è®¡ï¼Œæ›´å…³æ³¨å¯¹è±¡ä¸å¯¹è±¡ä¹‹é—´çš„é€šä¿¡ã€‚ è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™ å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰ å¼€é—­åŸåˆ™çš„æ„æ€æ˜¯ï¼šå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚ç®€è¨€ä¹‹ï¼Œæ˜¯ä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œéœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰ é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSP æ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“æ´¾ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œä¸”è½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œæ´¾ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å¼€é—­åŸåˆ™çš„è¡¥å……ã€‚å®ç°å¼€é—­åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ï¼Œè€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚ ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰ è¿™ä¸ªåŸåˆ™æ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šé’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚ æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰ è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚å®ƒè¿˜æœ‰å¦å¤–ä¸€ä¸ªæ„æ€æ˜¯ï¼šé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦ã€‚ç”±æ­¤å¯è§ï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ã€ä¾¿äºå‡çº§å’Œç»´æŠ¤çš„è½¯ä»¶è®¾è®¡æ€æƒ³ï¼Œå®ƒå¼ºè°ƒé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚ è¿ªç±³ç‰¹æ³•åˆ™ï¼Œåˆç§°æœ€å°‘çŸ¥é“åŸåˆ™ï¼ˆDemeter Principleï¼‰ æœ€å°‘çŸ¥é“åŸåˆ™æ˜¯æŒ‡ï¼šä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘åœ°ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚ åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰ åˆæˆå¤ç”¨åŸåˆ™æ˜¯æŒ‡ï¼šå°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>è®¾è®¡æ¨¡å¼</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>è®¾è®¡æ¨¡å¼</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-03ä¹‹-Threadä¸­start()å’Œrun()çš„åŒºåˆ«]]></title>
    <url>%2Fposts%2F22f6e11d.html</url>
    <content type="text"><![CDATA[start()å’Œrun()æ–¹æ³•çš„åŒºåˆ« start(): å®ƒçš„ä½œç”¨æ˜¯å¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œæ–°çº¿ç¨‹ä¼šæ‰§è¡Œç›¸åº”çš„run()æ–¹æ³•ã€‚start()ä¸èƒ½è¢«é‡å¤è°ƒç”¨ã€‚ run(): run()å°±å’Œæ™®é€šçš„æˆå‘˜æ–¹æ³•ä¸€æ ·ï¼Œå¯ä»¥è¢«é‡å¤è°ƒç”¨ã€‚å•ç‹¬è°ƒç”¨run()çš„è¯ï¼Œä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œrun()ï¼Œè€Œå¹¶ä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ï¼ ä¸‹é¢ä»¥ä»£ç æ¥è¿›è¡Œè¯´æ˜ã€‚ 123456class MyThread extends Thread{ public void run(){ ... } };MyThread mythread = new MyThread(); mythread.start()ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œå¹¶åœ¨æ–°çº¿ç¨‹ä¸­è¿è¡Œrun()æ–¹æ³•ã€‚ è€Œmythread.run()åˆ™ä¼šç›´æ¥åœ¨å½“å‰çº¿ç¨‹ä¸­è¿è¡Œrun()æ–¹æ³•ï¼Œå¹¶ä¸ä¼šå¯åŠ¨ä¸€ä¸ªæ–°çº¿ç¨‹æ¥è¿è¡Œrun()ã€‚ start()å’Œrun()æ–¹æ³•ç¤ºä¾‹ ä¸‹é¢ï¼Œé€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¼”ç¤ºå®ƒä»¬ä¹‹é—´çš„åŒºåˆ«ã€‚æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122class TestThread extends Thread { public TestThread(String name) { super(name); } @Override public void run() { System.out.println(Thread.currentThread().getName() + " is running"); }};public class ThreadMethodDemo { public static void main(String[] args) { Thread mythread = new TestThread("testThread"); System.out.println(Thread.currentThread().getName() + " call testThread.run()"); mythread.run(); System.out.println(Thread.currentThread().getName() + " call testThread.start()"); mythread.start(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 1234main call testThread.run()main is runningmain call testThread.start()testThread is running &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; Thread.currentThread().getName()æ˜¯ç”¨äºè·å–â€œå½“å‰çº¿ç¨‹â€çš„åå­—ã€‚å½“å‰çº¿ç¨‹æ˜¯æŒ‡æ­£åœ¨cpuä¸­è°ƒåº¦æ‰§è¡Œçš„çº¿ç¨‹ã€‚ testThread.run()æ˜¯åœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸­è°ƒç”¨çš„ï¼Œè¯¥run()æ–¹æ³•ç›´æ¥è¿è¡Œåœ¨â€œä¸»çº¿ç¨‹mainâ€ä¸Šã€‚ testThread.start()ä¼šå¯åŠ¨â€œçº¿ç¨‹testThreadâ€ï¼Œâ€œçº¿ç¨‹testThreadâ€å¯åŠ¨ä¹‹åï¼Œä¼šè°ƒç”¨run()æ–¹æ³•ï¼›æ­¤æ—¶çš„run()æ–¹æ³•æ˜¯è¿è¡Œåœ¨â€œçº¿ç¨‹testThreadâ€ä¸Šã€‚ start()å’Œrun()æºç è¯´æ˜ï¼ˆåŸºäºJDK1.8.0_171ï¼‰ Thread.javaä¸­start()æ–¹æ³•æºç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122232425262728public synchronized void start() { /** * å¦‚æœçº¿ç¨‹ä¸æ˜¯"æ–°å»ºçŠ¶æ€"ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ * çŠ¶æ€å€¼0 å¯¹åº”"æ–°å»º" */ if (threadStatus != 0) throw new IllegalThreadStateException(); /** å°†çº¿ç¨‹æ·»åŠ åˆ°ThreadGroupä¸­ */ group.add(this); boolean started = false; try { /** é€šè¿‡start0()å¯åŠ¨çº¿ç¨‹ */ start0(); /** è®¾ç½®startedæ ‡è®° */ started = true; } finally { try { if (!started) { group.threadStartFailed(this); } } catch (Throwable ignore) { /* do nothing. If start0 threw a Throwable then it will be passed up the call stack */ } }} &lt;span id="inline-green"&gt; è¯´æ˜ï¼š &lt;/span&gt; start()å®é™…ä¸Šæ˜¯é€šè¿‡æœ¬åœ°æ–¹æ³•start0()å¯åŠ¨çº¿ç¨‹çš„ã€‚è€Œstart0()ä¼šæ–°è¿è¡Œä¸€ä¸ªçº¿ç¨‹ï¼Œæ–°çº¿ç¨‹ä¼šè°ƒç”¨run()æ–¹æ³•ã€‚ 1private native void start0(); Thread.javaä¸­run()æ–¹æ³•æºç å¦‚ä¸‹ï¼š 12345public void run() { if (target != null) { target.run(); }} &lt;span id="inline-green"&gt; è¯´æ˜ï¼š &lt;/span&gt; targetæ˜¯ä¸€ä¸ªRunnableå¯¹è±¡ã€‚run()å°±æ˜¯ç›´æ¥è°ƒç”¨Threadçº¿ç¨‹çš„Runnableæˆå‘˜çš„run()æ–¹æ³•ï¼Œå¹¶ä¸ä¼šæ–°å»ºä¸€ä¸ªçº¿ç¨‹ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~cherry-pickã€revertã€resetä»‹ç»]]></title>
    <url>%2Fposts%2F1c4d9168.html</url>
    <content type="text"><![CDATA[** gti checkout -- filename ** git checkout -- filename å¯ä»¥æŠŠå·¥ä½œåŒºçš„æŸä¸ªæ–‡ä»¶çš„ä¿®æ”¹æ’¤å›åˆ°ä¸Šä¸€æ¬¡addæˆ–è€…commitçš„çŠ¶æ€ï¼Œä¸è¿‡filenameä¸èƒ½çœç•¥. å¯ä»¥ä½¿ç”¨ git checkout -- ä¸åŠ æ–‡ä»¶åæ¥æŸ¥çœ‹å½“å‰å·¥ä½œåŒºä¿®æ”¹äº†å“ªäº›æ–‡ä»¶ï¼Œè¿™ä¸ªåªæ˜¯é’ˆå¯¹å·¥ä½œåŒºçš„é—®é¢˜ï¼› ** git reset head filename ** git reset HEAD filename å¯ä»¥æŠŠaddåˆ°ç¼“å­˜åŒºçš„æ–‡ä»¶å›é€€åˆ°å·¥ä½œåŒºï¼Œä¹Ÿå°±æ˜¯æŠŠadd filenameè¿™ä¸ªè¿‡ç¨‹ç»™å›é€€äº†ï¼Œè¿™å¹¶ä¸ä¼šä¿®æ”¹æ–‡ä»¶çš„å†…å®¹ï¼Œ åªæ˜¯æŠŠç¼“å­˜åŒºçš„æŸä¸ªæ–‡ä»¶å˜æˆå’ŒHEADè¿™ä¸ªå½“å‰ç‰ˆæœ¬ç›¸åŒï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä½ å¤šæ¬¡addï¼Œè¿™ä¼šå›é€€åˆ°ç¬¬ä¸€æ¬¡addçš„è¿‡ç¨‹ï¼Œå’Œä¸Šé¢çš„æ“ä½œä¸€æ ·ï¼Œä¹Ÿå¯ä»¥ä¸å¸¦ä¸Šæ–‡ä»¶åæ¥æŸ¥çœ‹å“ªäº›æ–‡ä»¶è¢«æ·»åŠ åˆ°äº†ç¼“å­˜åŒºï¼› ** git reset --hard head^ ** git reset --hard HEAD~ã€1ï¼Œ2ï¼Œ3ï¼Œ4ï¼Œ5...ã€‘è¿™ä¸ªæ˜¯å¤§å®¶ç†Ÿæ‚‰çš„æœ¬åœ°ç‰ˆæœ¬çš„å›é€€ ** æŸåˆ†æ”¯ä¸Šçš„ä¿®æ”¹è¿ç§»åˆ°å¦ä¸€åˆ†æ”¯ ** æ¯”å¦‚æˆ‘ä»¬åœ¨åˆ†æ”¯aä¸Šå¼€å‘æ–°åŠŸèƒ½ï¼Œæ­¤æ—¶æœ‰ä¸ªç´§æ€¥bugéœ€è¦ä¿®æ”¹ï¼Œç„¶ååˆ‡æ¢åˆ°äº†åˆ†æ”¯bã€‚bugä¿®å¤å®Œä¹‹åå¿˜äº†åˆ‡å›ä¹‹å‰çš„åˆ†æ”¯aï¼Œè€Œæ˜¯åœ¨åˆ†æ”¯bä¸Šé¢ç»§ç»­ç¼–å†™æœ¬åº”è¯¥æ˜¯åˆ†æ”¯açš„å†…å®¹ï¼Œ è¿™æ ·båˆ†æ”¯å­˜åœ¨äº†ä¸€éƒ¨åˆ†aåˆ†æ”¯çš„ä»£ç ï¼Œè¿™ä¸ªæ—¶å€™éœ€è¦æŠŠè¿™æ®µä»£ç è¿ç§»åˆ°aåˆ†æ”¯ä¸Šï¼Œä¸¤ä¸ªæ€è·¯ï¼š 1ï¼‰å¦‚æœè¿˜æ²¡æœ‰åœ¨båˆ†æ”¯ä¸Šcommitçš„è¯(addçš„è¯æ²¡å½±å“ï¼Œåœ¨è¿ç§»åï¼Œå°±ä¸ä¼šå†å½“å‰åˆ†æ”¯çš„ç¼“å­˜ä¸­)ã€‚ ç›´æ¥åˆ‡åˆ°aåˆ†æ”¯ï¼Œæ­¤æ—¶ä¼šæç¤ºæœ‰æ²¡æœ‰è¢«commitçš„ä»£ç ï¼Œåˆ‡åˆ°aåˆ†æ”¯åï¼Œå°±å¯ä»¥commitè¿™æ®µæ²¡æœ‰è¢«commitçš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯åœ¨båˆ†æ”¯ä¸Šç¼–å†™çš„ä»£ç æ­£ç¡®çš„è¢«è¿ç§»åˆ°äº†aåˆ†æ”¯ã€‚ 2ï¼‰å¦‚æœå·²ç»commitäº†ï¼Œå¯ä»¥è¿™ä¹ˆæ¥ï¼šgit logæ‰¾åˆ°ä½ commitçš„åˆ†æ”¯å·ï¼Œç„¶åç›´æ¥åˆ‡æ¢åˆ°aåˆ†æ”¯ï¼Œæ‰§è¡Œgit cherry-pick commit-idï¼Œè¿™ä¸ªcommit-idå°±æ˜¯é‚£ä¸ªbåˆ†æ”¯é”™è¯¯commitçš„idï¼Œ è¿™ä¸ªå‘½ä»¤å°±æ˜¯æŠŠè¿™ä¸ªcommitçš„ä¿®æ”¹æ‹¿åˆ°å½“å‰åˆ†æ”¯æ¥ï¼Œå¾ˆç®€å•ç²—æš´è€Œæœ‰æ•ˆã€‚å†åˆ‡æ¢åˆ°båˆ†æ”¯ï¼Œä½¿ç”¨git revert commit-idæŠŠè¿™ä¸ªé”™è¯¯çš„åˆ†æ”¯å·ç§»é™¤ã€‚ ** revert reset cherry-pick ** git revert å½“æˆ‘ä»¬çš„æŸä¸ªåˆ†æ”¯ä¸­æœ‰äº†å¾ˆå¤šç‰ˆæœ¬ä¹‹åï¼Œå½¢æˆäº†ä¸€æ¡ç‰ˆæœ¬é“¾ï¼Œå¦‚æœæƒ³å»é™¤è¿™ä¸ªçº¿è·¯ä¸­çš„æŸä¸€ç‰ˆæœ¬ï¼Œä½†æ˜¯ä¿ç•™ç‰ˆæœ¬é“¾ä¸­çš„å…¶ä»–æ‰€æœ‰ä¿®æ”¹ï¼Œç”Ÿæˆä¸€ä¸ªæ–°çš„ç‰ˆæœ¬é“¾ï¼Œç‰ˆæœ¬é“¾ä¸­çš„HEADå°±æ˜¯revertæœ€æ–°ç”Ÿæˆçš„ç‰ˆæœ¬ã€‚æ‰€ä»¥revertæ˜¯ä¼šç”Ÿæˆæ–°ç‰ˆæœ¬çš„æŒ‡ä»¤ã€‚ å¯ä»¥è¿™ä¹ˆæƒ³ï¼Œé“¾å°±åƒä¸€ä¸ªé“¾æ¡ï¼Œæ˜¯ä¸€ç¯æ‰£ä¸€ç¯çš„ï¼Œå…¶ä¸­çš„ä¸€ç¯å°±æ˜¯ä¸€ä¸ªç‰ˆæœ¬ï¼Œç°åœ¨æƒ³å»è¿™ä¸ªé“¾æ¡ä¸­çš„æŸä¸€ç¯ï¼ˆæŸä¸ªç‰ˆæœ¬ï¼‰ï¼Œ æ‰§è¡Œgit revert HEAD~2ï¼Œè¿™ä¸ªHEAD~2å°±æ˜¯è¿™ä¸ªè¦åˆ é™¤çš„ç‰ˆæœ¬ï¼ˆé“¾æ¡ä¸­çš„ä¸€ç¯ï¼‰ï¼Œå°±ä¼šæŠŠè¿™ä¸ªç¯è§£å¼€å‰”é™¤ï¼Œ æŠŠå’Œè¿™ä¸ªå‰”é™¤çš„ç¯ï¼ˆç‰ˆæœ¬ï¼‰ç›¸é‚»çš„ç¯è¿åœ¨ä¸€èµ·ï¼Œå½¢æˆäº†ä¸€ä¸ªæ–°çš„é“¾æ¡ï¼ˆå°‘äº†ä¸€ç¯ï¼‰ï¼Œ ç„¶ååœ¨é“¾æ¡çš„æœ€åé¢æ·»åŠ ä¸€ä¸ªæ–°çš„æ²¡æœ‰ä»»ä½•ä¿®æ”¹çš„ç¯ï¼ˆrevert HEAD~2 è¿™ä¸ªæ–°çš„commitç‰ˆæœ¬ï¼‰ æ•´ä¸ªè¿‡ç¨‹å°±åƒå‰”é™¤äº†ä¸­é—´æŸä¸€ä¸ªç‰ˆæœ¬ï¼Œæœ€ååŠ ä¸Šäº†ä¸€ä¸ªæ²¡æœ‰ä»»ä½•ä¿®æ”¹çš„æ–°çš„ç‰ˆæœ¬ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦éšæ„åˆ é™¤ä¸­é—´çš„ç‰ˆæœ¬ï¼Œå› ä¸ºå¯èƒ½ä¼šå­˜åœ¨ä¾èµ–ï¼Œæœ€å¥½æ˜¯revertæœ€æ–°çš„ç‰ˆæœ¬ï¼Œé£é™©ä¼šå°å¾ˆå¤šã€‚ git reset git reset [--hard|soft|mixed|merge|keep] [&lt;commit&gt;æˆ–HEAD]æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„æŒ‡ä»¤ï¼Œå…¶ä¸­æ¯”è¾ƒé‡è¦çš„æ˜¯modeï¼Œä¹Ÿå°±æ˜¯ --hardã€--softã€--mixedã€‚ã€‚ã€‚æ¯”è¾ƒå¸¸è§çš„æ˜¯--hardå’Œ--softï¼› --hardæ˜¯æŒ‡å®Œå…¨é‡è®¾ï¼Œä¼šæŠŠå›é€€åˆ°æŸç‰ˆæœ¬ä¹‹åçš„ä¿®æ”¹å…¨éƒ¨åˆ é™¤ï¼Œ --softè¿™æ˜¯ä¸ªå›é€€è§£ä½“ï¼Œè®©ç‰ˆæœ¬åº“å›é€€åˆ°æŸä¸ªç‰ˆæœ¬ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¹‹åçš„ä¿®æ”¹å…¨éƒ¨å­˜åœ¨ç¼“å­˜åŒºï¼Œè¿™ä¸ªæ—¶å€™åœ¨commitçš„è¯ï¼Œåˆä¼šæŠŠä¼šé€€çš„éƒ¨åˆ†é‡æ–°åŠ è½½åˆ°æœ€æ–°ç‰ˆæœ¬ä¸­ï¼› git cherry-pick git cherry-pick &lt;commit id&gt;ç”¨äºæŠŠå¦ä¸€ä¸ªæœ¬åœ°åˆ†æ”¯çš„commitä¿®æ”¹åº”ç”¨åˆ°å½“å‰åˆ†æ”¯ï¼Œä¹Ÿæ˜¯è§£å†³ä¹‹å‰é‡åˆ°é—®é¢˜çš„å…³é”®ï¼Œå¯ä»¥ç›´æ¥æŠŠå…¶ä»–çš„åˆ†æ”¯ä¸Šçš„ä¿®æ”¹æˆ–è€…æ˜¯æŸä¸€ä¸ªç‰ˆæœ¬ç›´æ¥å¼•è¿‡æ¥ï¼Œå¯èƒ½ä¼šå­˜åœ¨å†²çªï¼Œè¿™ä¸ªæ—¶å€™å°±å’Œæ­£å¸¸çš„å†²çªä¸€æ ·çš„è§£å†³å°±å¥½äº†ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~åˆå¹¶æŒ‡å®šæ–‡ä»¶æˆ–Commitsåˆ°å¦ä¸€åˆ†æ”¯]]></title>
    <url>%2Fposts%2F5040fe16.html</url>
    <content type="text"><![CDATA[åˆšä½¿ç”¨gitè¿›è¡Œç‰ˆæœ¬ç®¡ç†çš„æ—¶å€™ï¼Œç”±äºæˆå‘˜é—´çš„ä»£ç æœ‰çš„éœ€è¦ä¸Šçº¿ï¼Œæœ‰çš„ä¸éœ€è¦ä¸Šçº¿ï¼Œå¦‚æœç›´æ¥mergeï¼Œç»å¸¸ ä¼šæŠŠåˆ«äººä¸éœ€è¦ä¸Šçº¿çš„ä»£ç åˆå¹¶çš„masterï¼Œå¯¼è‡´é—®é¢˜ä»ç”Ÿã€‚æ‰€ä»¥ï¼Œæœ€ç¨³å¦¥çš„æ˜¯åªåˆå¹¶ä½ éœ€è¦çš„é‚£äº›commitsï¼Œä¸éœ€è¦çš„commitså°±ä¸åˆå¹¶è¿›å»ã€‚ é‚£ä¹ˆå¦‚ä½•ä»ä¸€ä¸ªåˆ†æ”¯åˆå¹¶ç‰¹å®šçš„æ–‡ä»¶æˆ–è€…Commitsåˆ°å¦ä¸€ä¸ªåˆ†æ”¯è¿™ä¸ªé—®é¢˜æ€¥å¾…è§£ã€‚ åˆå¹¶æŸä¸ªåˆ†æ”¯ä¸Šçš„å•ä¸ªcommit é¦–å…ˆï¼Œç”¨git logæˆ–sourcetreeå·¥å…·æŸ¥çœ‹ä½ æƒ³é€‰æ‹©å“ªäº›commitsè¿›è¡Œåˆå¹¶ï¼Œä¾‹å¦‚ï¼š æ¯”å¦‚dev-w åˆ†æ”¯ä¸Šçš„commit 2aeefdacad6ed1586a1e035fb8860f11533db23c éå¸¸é‡è¦ï¼Œå®ƒå«æœ‰ä¸€ä¸ªç´§æ€¥bugçš„ä¿®å¤æˆ–æ˜¯å…¶ä»–å†…å®¹ã€‚æ— è®ºä»€ä¹ˆåŸå› ï¼Œ ä½ ç°åœ¨åªéœ€è¦å°† 2aeefdacad6ed1586a1e035fb8860f11533db23c åˆå¹¶åˆ°masterï¼Œè€Œä¸åˆå¹¶dev-wä¸Šçš„å…¶ä»–commitsï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨git cherry-pickå‘½ä»¤æ¥åšï¼š 123git checkout master git cherry-pick 2aeefdacad6ed1586a1e035fb8860f11533db23c è¿™æ · 2aeefdacad6ed1586a1e035fb8860f11533db23c å°±è¢«åˆå¹¶åˆ°masteråˆ†æ”¯ï¼Œå¹¶åœ¨masterä¸­æ·»åŠ äº†commitï¼ˆä½œä¸ºä¸€ä¸ªæ–°çš„commitï¼‰ã€‚ cherry-pick å’Œmergeæ¯”è¾ƒç±»ä¼¼ï¼Œå¦‚æœgitä¸èƒ½åˆå¹¶ä»£ç æ”¹åŠ¨ï¼ˆæ¯”å¦‚é‡åˆ°åˆå¹¶å†²çªï¼‰ï¼Œgitéœ€è¦ä½ è‡ªå·±æ¥è§£å†³å†²çªå¹¶æ‰‹åŠ¨æ·»åŠ commitã€‚ è¿™é‡Œgit cherry-pickæ¯æ¬¡åˆå¹¶è¿‡æ¥ä¼šæ˜¾ç¤ºæ–‡ä»¶å†²çª(å…¶å®å¹¶æ²¡æœ‰ä»£ç å†²çªéƒ¨åˆ†ï¼Œåªéœ€æ‰‹åŠ¨è§£å†³æ—¢å¯) åˆå¹¶æŸä¸ªåˆ†æ”¯ä¸Šçš„ä¸€ç³»åˆ—commits åœ¨ä¸€äº›ç‰¹å®šæƒ…å†µä¸‹ï¼Œåˆå¹¶å•ä¸ªcommitå¹¶ä¸å¤Ÿï¼Œä½ éœ€è¦åˆå¹¶ä¸€ç³»åˆ—ç›¸è¿çš„commitsã€‚è¿™ç§æƒ…å†µä¸‹å°±ä¸è¦ä½¿ç”¨cherry-pickäº†ï¼Œrebase æ›´é€‚åˆã€‚ å‡è®¾ä½ éœ€è¦åˆå¹¶dev-wåˆ†æ”¯çš„commit 76cada ~62ecb3 åˆ°masteråˆ†æ”¯ã€‚ é¦–å…ˆéœ€è¦åŸºäºdev-wåˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯ï¼Œå¹¶æŒ‡æ˜æ–°åˆ†æ”¯çš„æœ€åä¸€ä¸ªcommitï¼š 12git checkout dev-w git checkout -b newbranch 62ecb3 ç„¶åï¼Œrebaseè¿™ä¸ªæ–°åˆ†æ”¯çš„commitåˆ°masterï¼ˆâ€“ontomasterï¼‰ã€‚76cada^ æŒ‡æ˜ä½ æƒ³ä»å“ªä¸ªç‰¹å®šçš„commitå¼€å§‹ã€‚ 1git rebase --ontomaster 76cada^ å¾—åˆ°çš„ç»“æœå°±æ˜¯dev-wåˆ†æ”¯çš„commit 76cada ~ 62ecb3 éƒ½è¢«åˆå¹¶åˆ°äº†masteråˆ†æ”¯ã€‚ å¦å¤–å¦‚æœåªæƒ³å°†dev-wåˆ†æ”¯çš„æŸä¸ªæ–‡ä»¶Test.javaåˆå¹¶åˆ°masteråˆ†æ”¯ä¸Šã€‚ 12git checkout dev-wgit checkout --patch master Test.java ç¬¬ä¸€ä¸ªå‘½ä»¤ï¼š åˆ‡æ¢åˆ°dev-wåˆ†æ”¯ï¼› ç¬¬äºŒä¸ªå‘½ä»¤ï¼šåˆå¹¶masteråˆ†æ”¯ä¸ŠTest.javaæ–‡ä»¶åˆ°dev-wåˆ†æ”¯ä¸Šï¼Œå°†masteråˆ†æ”¯ä¸Š Test.java æ–‡ä»¶è¿½åŠ è¡¥ä¸åˆ°dev-wåˆ†æ”¯ä¸Š Test.javaæ–‡ä»¶ã€‚ä½ å¯ä»¥æ¥å—æˆ–è€…æ‹’ç»è¡¥ä¸å†…å®¹ã€‚ å¦‚æœåªæ˜¯ç®€å•çš„å°†dev-wåˆ†æ”¯çš„æ–‡ä»¶Test.java copyåˆ°masteråˆ†æ”¯ä¸Šï¼› 12git checkout mastergit checkout dev-w Test.java åˆ†æ”¯testä¸Šæœ‰ä¸€ä¸ªæ–‡ä»¶Aï¼Œä½ åœ¨test1åˆ†æ”¯ä¸Šï¼Œ æ­¤æ—¶å¦‚æœæƒ³ç”¨teståˆ†æ”¯ä¸Šçš„Aæ–‡ä»¶æ›¿æ¢test1åˆ†æ”¯ä¸Šçš„æ–‡ä»¶çš„è¯ï¼Œ å¯ä»¥ä½¿ç”¨git checkout test1, ç„¶ågit checkout test â€“ A åœ¨featureåˆ†æ”¯commit åˆ‡æ¢è‡³releaseåˆ†æ”¯ ä»featureåˆ†æ”¯æ£€å‡ºç›¸åº”æ–‡ä»¶ 12345678#branch featuregit commit -a -m "msg"git checkout release#branch releasegit checkout feature file-01git checkout feature file-x...git commit -a -m "msg" document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-02ä¹‹ å¤šçº¿ç¨‹å®ç°æ–¹å¼]]></title>
    <url>%2Fposts%2F3868ed28.html</url>
    <content type="text"><![CDATA[å®ç°å¤šçº¿ç¨‹çš„å‡ ç§æ–¹å¼ ç»§æ‰¿Threadç±» å®ç°Runnableæ¥å£ é€šè¿‡Callableå’ŒFuture é€šè¿‡çº¿ç¨‹æ±  Threadå’ŒRunnableç®€ä»‹ Runnable Runnableæ˜¯ä¸€ä¸ªæ¥å£åº“ï¼Œè¯¥æ¥å£åªåŒ…å«äº†ä¸€ä¸ªrun()æ–¹æ³•ï¼Œå®šä¹‰å¦‚ä¸‹ï¼š 123public interface Runnable { public abstract void run();} Runnableçš„ä½œç”¨ï¼Œå®ç°å¤šçº¿ç¨‹ã€‚æˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€ä¸ªç±»Aå®ç°Runnableæ¥å£ï¼›ç„¶åï¼Œé€šè¿‡new Thread(new A())ç­‰æ–¹å¼æ–°å»ºçº¿ç¨‹ã€‚ Thread Thread æ˜¯ä¸€ä¸ªç±»ã€‚Threadæœ¬èº«å°±å®ç°äº†Runnableæ¥å£ã€‚å®ƒçš„å£°æ˜å¦‚ä¸‹ï¼š 1public class Thread implements Runnable {} Threadå’ŒRunnableçš„å¼‚åŒç‚¹ Thread å’Œ Runnable çš„ç›¸åŒç‚¹ï¼šéƒ½æ˜¯â€œå¤šçº¿ç¨‹çš„å®ç°æ–¹å¼â€ã€‚ Thread å’Œ Runnable çš„ä¸åŒç‚¹ï¼š Thread æ˜¯ç±»ï¼Œè€ŒRunnableæ˜¯æ¥å£ï¼›Threadæœ¬èº«æ˜¯å®ç°äº†Runnableæ¥å£çš„ç±»ã€‚æˆ‘ä»¬çŸ¥é“â€œä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªçˆ¶ç±»ï¼Œä½†æ˜¯å´èƒ½å®ç°å¤šä¸ªæ¥å£â€ï¼Œå› æ­¤Runnableå…·æœ‰æ›´å¥½çš„æ‰©å±•æ€§ã€‚ æ­¤å¤–ï¼ŒRunnableè¿˜å¯ä»¥ç”¨äºâ€œèµ„æºçš„å…±äº«â€ã€‚å³ï¼Œå¤šä¸ªçº¿ç¨‹éƒ½æ˜¯åŸºäºæŸä¸€ä¸ªRunnableå¯¹è±¡å»ºç«‹çš„ï¼Œå®ƒä»¬ä¼šå…±äº«Runnableå¯¹è±¡ä¸Šçš„èµ„æºã€‚ é€šå¸¸ï¼Œå»ºè®®é€šè¿‡â€œRunnableâ€å®ç°å¤šçº¿ç¨‹ï¼ Threadå’ŒRunnableçš„å¤šçº¿ç¨‹ç¤ºä¾‹ Threadçš„å¤šçº¿ç¨‹ç¤ºä¾‹ 123456789101112131415161718192021222324public class ThreadTest { public static void main(String[] args) { // å¯åŠ¨3ä¸ªçº¿ç¨‹t1,t2,t3ï¼›æ¯ä¸ªçº¿ç¨‹å„å–10å¼ ç¥¨ï¼ MyThread t1 = new MyThread(); MyThread t2 = new MyThread(); MyThread t3 = new MyThread(); t1.start(); t2.start(); t3.start(); }}class MyThread extends Thread { private int ticket = 10; @Override public void run() { for (int i = 0; i &lt; 20; i++) { if (this.ticket &gt; 0) { System.out.println(this.getName() + " å–ç¥¨ï¼šticket" + this.ticket--); } } }}; &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 123456789101112131415161718192021222324252627282930Thread-2 å–ç¥¨ï¼šticket10Thread-1 å–ç¥¨ï¼šticket10Thread-0 å–ç¥¨ï¼šticket10Thread-1 å–ç¥¨ï¼šticket9Thread-2 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket8Thread-0 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket7Thread-2 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket6Thread-0 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket7Thread-1 å–ç¥¨ï¼šticket4Thread-0 å–ç¥¨ï¼šticket7Thread-1 å–ç¥¨ï¼šticket3Thread-2 å–ç¥¨ï¼šticket6Thread-1 å–ç¥¨ï¼šticket2Thread-0 å–ç¥¨ï¼šticket6Thread-1 å–ç¥¨ï¼šticket1Thread-2 å–ç¥¨ï¼šticket5Thread-0 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket4Thread-0 å–ç¥¨ï¼šticket4Thread-2 å–ç¥¨ï¼šticket3Thread-0 å–ç¥¨ï¼šticket3Thread-2 å–ç¥¨ï¼šticket2Thread-0 å–ç¥¨ï¼šticket2Thread-2 å–ç¥¨ï¼šticket1Thread-0 å–ç¥¨ï¼šticket1 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; (01) MyThreadç»§æ‰¿äºThreadï¼Œå®ƒæ˜¯è‡ªå®šä¹‰ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªMyThreadéƒ½ä¼šå–å‡º10å¼ ç¥¨ã€‚ (02) ä¸»çº¿ç¨‹mainåˆ›å»ºå¹¶å¯åŠ¨3ä¸ªMyThreadå­çº¿ç¨‹ã€‚æ¯ä¸ªå­çº¿ç¨‹éƒ½å„è‡ªå–å‡ºäº†10å¼ ç¥¨ã€‚ Runnableçš„å¤šçº¿ç¨‹ç¤ºä¾‹ 1234567891011121314151617181920212223242526class MyThread2 implements Runnable { private int ticket = 10; @Override public void run() { for (int i = 0; i &lt; 20; i++) { if (this.ticket &gt; 0) { System.out.println(Thread.currentThread().getName() + " å–ç¥¨ï¼šticket" + this.ticket--); } } }};public class RunnableTest { public static void main(String[] args) { MyThread2 mt = new MyThread2(); // å¯åŠ¨3ä¸ªçº¿ç¨‹t1,t2,t3(å®ƒä»¬å…±ç”¨ä¸€ä¸ªRunnableå¯¹è±¡)ï¼Œè¿™3ä¸ªçº¿ç¨‹ä¸€å…±å–10å¼ ç¥¨ï¼ Thread t1 = new Thread(mt); Thread t2 = new Thread(mt); Thread t3 = new Thread(mt); t1.start(); t2.start(); t3.start(); }} &lt;span id="inline-blue"&gt; è¿è¡Œç»“æœï¼š &lt;/span&gt; 12345678910Thread-0 å–ç¥¨ï¼šticket10Thread-0 å–ç¥¨ï¼šticket7Thread-0 å–ç¥¨ï¼šticket6Thread-0 å–ç¥¨ï¼šticket5Thread-2 å–ç¥¨ï¼šticket8Thread-1 å–ç¥¨ï¼šticket9Thread-1 å–ç¥¨ï¼šticket2Thread-1 å–ç¥¨ï¼šticket1Thread-2 å–ç¥¨ï¼šticket3Thread-0 å–ç¥¨ï¼šticket4 &lt;span id="inline-green"&gt; ç»“æœè¯´æ˜ï¼š &lt;/span&gt; (01) å’Œä¸Šé¢â€œMyThreadç»§æ‰¿äºThreadâ€ä¸åŒï¼›è¿™é‡Œçš„MyThreadå®ç°äº†Threadæ¥å£ã€‚ (02) ä¸»çº¿ç¨‹mainåˆ›å»ºå¹¶å¯åŠ¨3ä¸ªå­çº¿ç¨‹ï¼Œè€Œä¸”è¿™3ä¸ªå­çº¿ç¨‹éƒ½æ˜¯åŸºäºâ€œmtè¿™ä¸ªRunnableå¯¹è±¡â€è€Œåˆ›å»ºçš„ã€‚è¿è¡Œç»“æœæ˜¯è¿™3ä¸ªå­çº¿ç¨‹ä¸€å…±å–å‡ºäº†10å¼ ç¥¨ã€‚è¿™è¯´æ˜å®ƒä»¬æ˜¯å…±äº«äº†MyThreadæ¥å£çš„ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~é‡ç½®]]></title>
    <url>%2Fposts%2Fb9f23f09.html</url>
    <content type="text"><![CDATA[åˆ†æ”¯æ¸¸æ ‡masterçš„æ¢ç§˜ å…ˆæ¥çœ‹çœ‹å½“æœ‰æ–°çš„æäº¤å‘ç”Ÿæ—¶ï¼Œæ–‡ä»¶.git/refs/heads/masterçš„å†…å®¹å¦‚ä½•æ”¹å˜ã€‚é¦–å…ˆåœ¨å·¥ä½œåŒºåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œå§‘ä¸”å«åšnew-commit.txtï¼Œç„¶åæäº¤åˆ°ç‰ˆæœ¬åº“ä¸­ã€‚ 123$ touch new-commit.txt $ git add new-commit.txt $ git commit -m "does master follow this new commit?" æ­¤æ—¶å·¥ä½œç›®å½•ä¸‹ä¼šæœ‰ä¸¤ä¸ªæ–‡ä»¶ï¼Œå…¶ä¸­æ–‡ä»¶new-commit.txtæ˜¯æ–°å¢çš„ã€‚ 12$ lsnew-commit.txt welcome.txt æ¥çœ‹çœ‹masteråˆ†æ”¯æŒ‡å‘çš„æäº¤IDæ˜¯å¦æ”¹å˜äº†ã€‚ å…ˆçœ‹çœ‹åœ¨ç‰ˆæœ¬åº“å¼•ç”¨ç©ºé—´(.git/refs/ç›®å½•)ä¸‹çš„masteræ–‡ä»¶å†…å®¹çš„ç¡®æ›´æ”¹äº†ï¼ŒæŒ‡å‘äº†æ–°çš„æäº¤ã€‚ 12$ cat .git/refs/heads/master23995a2d61d0a2667ba0db8aa4a17b127c1977d1 å†ç”¨git logæŸ¥çœ‹ä¸€ä¸‹æäº¤æ—¥å¿—ï¼Œå¯ä»¥çœ‹åˆ°åˆšåˆšå®Œæˆçš„æäº¤ã€‚ 1$ gilt log --graph --oneline å¼•ç”¨refs/heads/masterå°±å¥½åƒæ˜¯ä¸€ä¸ªæ¸¸æ ‡ï¼Œåœ¨æœ‰æ–°çš„æäº¤å‘ç”Ÿçš„æ—¶å€™æŒ‡å‘äº†æ–°çš„æäº¤ã€‚å¯æ˜¯å¦‚æœåªå¯ä¸Šã€ä¸å¯ä¸‹ï¼Œå°±ä¸èƒ½ç§°ä¸ºâ€œæ¸¸æ ‡â€ã€‚ Gitæä¾›äº†git resetå‘½ä»¤ï¼Œå¯ä»¥å°†â€œæ¸¸æ ‡â€æŒ‡å‘ä»»æ„ä¸€ä¸ªå­˜åœ¨çš„æäº¤IDã€‚ä¸‹é¢å°±å°è¯•äººä¸ºæ›´æ”¹æ¸¸æ ‡ã€‚ 1$ git reset --hard HEAD^ æ³¨æ„ï¼Œä¸Šé¢çš„å‘½ä»¤ä¸­ä½¿ç”¨äº†--hardå‚æ•°ï¼Œä¼šç ´åå·¥ä½œåŒºæœªæäº¤çš„æ”¹åŠ¨ï¼Œè¦æ…ç”¨ã€‚è¿™æ¡å‘½ä»¤å°†masteré‡ç½®åˆ°äº†ä¸Šä¸€ä¸ªè€çš„æäº¤ä¸Šï¼Œæ¥çœ‹ä¸‹masteræ–‡ä»¶å†…å®¹æ˜¯å¦æ›´æ”¹äº†ã€‚ 12$ cat .git/refs/heads/mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31 æœç„¶masteråˆ†æ”¯çš„å¼•ç”¨æ–‡ä»¶çš„æŒ‡å‘æ›´æ”¹ä¸ºå‰ä¸€æ¬¡æäº¤çš„IDäº†ã€‚è€Œä¸”é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°æ–°æ·»åŠ çš„æ–‡ä»¶new-commit.txtä¹Ÿä¸¢å¤±äº†ã€‚ 1$ ls é‡ç½®å‘½ä»¤ä¸ä»…å¯ä»¥é‡ç½®åˆ°å‰ä¸€æ¬¡æäº¤ï¼Œè¿˜å¯ä»¥ç›´æ¥ä½¿ç”¨æäº¤IDé‡ç½®åˆ°ä»»ä½•ä¸€æ¬¡æäº¤ã€‚ é€šè¿‡git logæŸ¥è¯¢åˆ°æœ€æ—©çš„æäº¤IDã€‚ 1$ git log --graph --oneline ç„¶åé‡ç½®åˆ°æœ€æ—©çš„ä¸€æ¬¡æäº¤ã€‚ 1$ git reset --hard d3e0684 -é‡ç½®åä¼šå‘ç°welcome.txtä¹Ÿå›é€€åˆ°äº†æœ€åŸå§‹ç‰ˆæœ¬åº“ï¼Œæ›¾ç»çš„ä¿®æ”¹éƒ½ä¸¢å¤±äº†ã€‚ 1$ cat welcome.txt ä½¿ç”¨é‡ç½®å‘½ä»¤å¾ˆå±é™©ï¼Œä¼šå½»åº•çš„ä¸¢å¼ƒå†å²ã€‚é‚£ä¹ˆè¿˜èƒ½å¤Ÿé€šè¿‡æµè§ˆæäº¤å†å²çš„åŠæ³•æ‰¾åˆ°ä¸¢å¼ƒçš„æäº¤IDï¼Œå†ä½¿ç”¨é‡ç½®å‘½ä»¤æ¢å¤å†å²å—ï¼Ÿ ä¸å¯èƒ½ï¼ï¼ï¼å› ä¸ºé‡ç½®è®©æäº¤å†å²ä¹Ÿæ”¹å˜äº†ã€‚ 1$ git log ä½¿ç”¨reflogæŒ½æ•‘é”™è¯¯çš„é‡ç½® å¦‚æœæ²¡æœ‰è®°ä¸‹é‡ç½®å‰masteråˆ†æ”¯æŒ‡å‘çš„æäº¤IDï¼Œæƒ³è¦é‡ç½®å›åŸæ¥çš„æäº¤çœŸçš„æ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…(å»å¯¹è±¡åº“ä¸­ä¸€ä¸ªä¸ªåœ°æ‰¾)ã€‚å¹¸å¥½Gitæä¾›äº†ä¸€ä¸ªæŒ½æ•‘æœºåˆ¶ï¼Œ é€šè¿‡.git/logsç›®å½•ä¸‹æ—¥å¿—æ–‡ä»¶è®°å½•äº†åˆ†æ”¯çš„å˜æ›´ã€‚é»˜è®¤éè£¸ç‰ˆæœ¬åº“ï¼ˆå¸¦æœ‰å·¥ä½œåŒºï¼‰éƒ½æä¾›åˆ†æ”¯æ—¥å¿—åŠŸèƒ½ï¼Œè¿™æ˜¯å› ä¸ºå¸¦æœ‰å·¥ä½œåŒºçš„å…«æœ¬åº“éƒ½æœ‰å¦‚ä¸‹è®¾ç½®ï¼š 1$ git config core.logallrefupdates æŸ¥çœ‹ä¸€ä¸‹masteråˆ†æ”¯çš„æ—¥å¿—æ–‡ä»¶.git/logs/refs/heads/masterä¸­çš„å†…å®¹ã€‚ä¸‹é¢å‘½ä»¤æ˜¾ç¤ºäº†è¯¥æ–‡ä»¶çš„æœ€åå‡ è¡Œã€‚ 1$ tail -5 .git/logs/refs/heads/master å¯ä»¥çœ‹å‡ºè¿™ä¸ªæ–‡ä»¶è®°å½•äº†masteråˆ†æ”¯æŒ‡å‘çš„å˜è¿ï¼Œæœ€æ–°çš„æ”¹å˜è¿½åŠ åˆ°æ–‡ä»¶çš„æœ«å°¾å› æ­¤æœ€åå‡ºç°ã€‚æœ€åä¸€è¡Œå¯ä»¥çœ‹å‡ºå› æ‰§è¡Œgit reset --hardå‘½ä»¤ï¼Œ æŒ‡å‘çš„æäº¤IDç”±a67c6fæ”¹å˜ä¸ºd3e0684ã€‚ Gitæä¾›äº†ä¸€ä¸ªgit reflogå‘½ä»¤ï¼Œå¯¹è¿™ä¸ªæ–‡ä»¶è¿›è¡Œæ“ä½œã€‚ä½¿ç”¨showå­å‘½ä»¤å¯ä»¥æ˜¾ç¤ºæ­¤æ–‡ä»¶çš„å†…å®¹ã€‚ 1$ git reflog show master | head -5 ä½¿ç”¨git reflogçš„è¾“å‡ºå’Œç›´æ¥æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶æœ€å¤§çš„ä¸åŒåœ¨äºæ˜¾ç¤ºé¡ºåºä¸åŒï¼Œå³æœ€æ–°æ”¹å˜æ”¾åœ¨äº†æœ€å‰é¢æ˜¾ç¤ºï¼Œè€Œä¸”åªæ˜¾ç¤ºæ¯æ¬¡æ”¹å˜çš„æœ€ç»ˆçš„SHA1å“ˆå¸Œå€¼ã€‚ è¿˜æœ‰ä¸ªåŒºåˆ«åœ¨äºä½¿ç”¨git reflogçš„è¾“å‡ºä¸­è¿˜æä¾›äº†ä¸€ä¸ªæ–¹ä¾¿æ˜“è®°çš„è¡¨è¾¾å¼ï¼š&lt;refname&gt;@{&lt;n&gt;}ã€‚è¿™ä¸ªè¡¨è¾¾å¼çš„å«ä¹‰æ˜¯å¼•ç”¨&lt;refname&gt;ä¹‹å‰ç¬¬&lt;n&gt;æ¬¡æ”¹å˜æ—¶çš„SHA1å“ˆå¸Œå€¼ã€‚ é‚£ä¹ˆå°†å¼•ç”¨masteråˆ‡æ¢åˆ°ä¸¤æ¬¡å˜æ›´ä¹‹å‰çš„å€¼ï¼Œå¯ä»¥ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š é‡ç½®masterä¸ºä¸¤æ¬¡æ”¹å˜ä¹‹å‰çš„å€¼ã€‚ 1$ git reset --hard master@{2} é‡ç½®åå·¥ä½œåŒºä¸­æ–‡ä»¶new-commit.txtåˆå›æ¥äº†ã€‚ 12$ lsnew-commit.txt welcome.txt æäº¤çš„å†å²ä¹Ÿå›æ¥äº†ã€‚ 1$ git log --oneline æ­¤æ—¶å¦‚æœå†ç”¨git reflogæŸ¥çœ‹ï¼Œä¼šçœ‹åˆ°æ¢å¤masterçš„æ“ä½œä¹Ÿè®°å½•åœ¨äº†æ—¥å¿—ä¸­ã€‚ 1$ git reflog show master | head -5 æ·±å…¥äº†è§£git resetå‘½ä»¤ é‡ç½®å‘½ä»¤git resetæ˜¯Gitæœ€å¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€å±é™©ï¼Œæœ€å®¹æ˜“è¯¯ç”¨çš„å‘½ä»¤ã€‚ç”¨æ³•å¦‚ä¸‹ï¼š 12ç”¨æ³•ä¸€ï¼šgit reset [-q] [&lt;commit&gt;] [--] &lt;paths&gt;â€¦â€‹ç”¨æ³•äºŒï¼šgit reset [--soft | --mixed [-N] | --hard | --merge | --keep] [-q] [&lt;commit&gt;] ä¸Šé¢åˆ—å‡ºçš„ç”¨æ³•ä¸­ï¼Œ&lt;commit&gt;æ˜¯å¯é€‰é¡¹ï¼Œå¯ä»¥ä½¿ç”¨å¼•ç”¨æˆ–è€…æäº¤IDï¼Œå¦‚æœçœç•¥&lt;commit&gt;åˆ™ç›¸å½“äºä½¿ç”¨äº†HEADçš„æŒ‡å‘ä½œä¸ºæäº¤IDã€‚ ä¸Šé¢åˆ—å‡ºçš„ä¸¤ç§ç”¨æ³•çš„åŒºåˆ«åœ¨äºï¼Œç¬¬ä¸€ç§ç”¨æ³•åœ¨å‘½ä»¤ä¸­åŒ…å«è·¯å¾„&lt;paths&gt;ã€‚ä¸ºäº†é¿å…è·¯å¾„å’Œå¼•ç”¨ï¼ˆæˆ–è€…æäº¤IDï¼‰åŒåè€Œå†²çªï¼Œå¯ä»¥åœ¨&lt;paths&gt;å‰ç”¨ä¸¤ä¸ªè¿ç»­çš„çŸ­çº¿ä½œä¸ºåˆ†éš”ã€‚ ç¬¬ä¸€ç§ç”¨æ³•ä¸ä¼šé‡ç½®å¼•ç”¨ï¼Œæ›´ä¸ä¼šæ”¹å˜å·¥ä½œåŒºï¼Œè€Œæ˜¯ç”¨æŒ‡å®šæäº¤çŠ¶æ€ï¼ˆ&lt;commit&gt;ï¼‰ä¸‹çš„æ–‡ä»¶ï¼ˆ&lt;paths&gt;ï¼‰æ›¿æ¢æ‰æš‚å­˜åŒºçš„æ–‡ä»¶ã€‚ ä¾‹å¦‚å‘½ä»¤git reset HEAD &lt;paths&gt;ç›¸å½“äºå–æ¶ˆä¹‹å‰æ‰§è¡Œçš„git add &lt;paths&gt;å‘½ä»¤æ—¶æ”¹å˜çš„æš‚å­˜åŒºã€‚ ç¬¬äºŒç§ç”¨æ³•ï¼ˆä¸ä½¿ç”¨è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•ï¼‰åˆ™ä¼šé‡ç½®å¼•ç”¨ã€‚æ ¹æ®ä¸åŒçš„é€‰é¡¹ï¼Œå¯ä»¥å¯¹æš‚å­˜åŒºæˆ–è€…å·¥ä½œåŒºè¿›è¡Œé‡ç½®ã€‚ å‚ç…§ä¸‹é¢çš„ç‰ˆæœ¬åº“æ¨¡å‹å›¾ï¼Œæ¥çœ‹ä¸€çœ‹ä¸åŒçš„å‚æ•°å¯¹ç¬¬äºŒç§é‡ç½®è¯­æ³•çš„å½±å“ã€‚ å‘½ä»¤æ ¼å¼ï¼šgit reset [--soft | --mixed | --hard] [&lt;commit&gt;] ä½¿ç”¨å‚æ•°--hardï¼Œå¦‚ï¼šgit reset --hard &lt;commit&gt; ä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„1ã€2ã€3å…¨éƒ¨çš„ä¸‰ä¸ªåŠ¨ä½œã€‚å³ï¼š æ›¿æ¢å¼•ç”¨çš„æŒ‡å‘ã€‚å¼•ç”¨æŒ‡å‘æ–°çš„æäº¤IDã€‚ æ›¿æ¢æš‚å­˜åŒºã€‚æ›¿æ¢åï¼Œæš‚å­˜åŒºçš„å†…å®¹å’Œå¼•ç”¨æŒ‡å‘çš„ç›®å½•æ ‘ä¸€è‡´ã€‚ æ›¿æ¢å·¥ä½œåŒºã€‚æ›¿æ¢åï¼Œå·¥ä½œåŒºçš„å†…å®¹å˜å¾—å’Œæš‚å­˜åŒºä¸€è‡´ï¼Œä¹Ÿå’ŒHEADæŒ‡å‘çš„ç›®å½•æ ‘å†…å®¹ç›¸åŒã€‚ ä½¿ç”¨å‚æ•°--softï¼Œå¦‚ï¼šgit reset --soft &lt;commit&gt;ï¼Œä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„æ“ä½œ1.å³åªæ›´æ”¹å¼•ç”¨çš„æŒ‡å‘ï¼Œä¸æ”¹å˜æš‚å­˜åŒºå’Œå·¥ä½œåŒºã€‚ ä½¿ç”¨å‚æ•°--mixedæˆ–è€…ä¸ä½¿ç”¨å‚æ•°ï¼ˆç¼ºçœä¸º--mixedï¼‰ï¼Œå¦‚ï¼šgit reset &lt;commit&gt;ï¼Œä¼šæ‰§è¡Œä¸Šå›¾ä¸­çš„æ“ä½œ1å’Œæ“ä½œ2ã€‚å³æ›´æ”¹å¼•ç”¨çš„æŒ‡å‘ä»¥åŠé‡ç½®æš‚å­˜åŒºï¼Œä½†ä¸æ”¹å˜å·¥ä½œåŒºã€‚ ä¸‹é¢é€šè¿‡ä¸€äº›ç¤ºä¾‹ï¼Œçœ‹ä¸€ä¸‹é‡ç½®å‘½ä»¤çš„ä¸åŒç”¨æ³•ã€‚ å‘½ä»¤ï¼šgit reset ä»…ç”¨HEADæŒ‡å‘çš„ç›®å½•æ ‘é‡ç½®æš‚å­˜åŒºï¼Œå·¥ä½œåŒºä¸å—å½±å“ï¼Œç›¸å½“äºå°†ä¹‹å‰ç”¨git addå‘½ä»¤æ›´æ–°åˆ°æš‚å­˜åŒºçš„å†…å®¹æ’¤å‡ºæš‚å­˜åŒºã€‚ å¼•ç”¨ä¹Ÿæœªæ”¹å˜ï¼Œå› ä¸ºå¼•ç”¨é‡ç½®åˆ°HEADç›¸å½“äºæ²¡æœ‰é‡ç½®ã€‚ å‘½ä»¤ï¼šgit reset HEAD åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset -- filenameã€‚ä»…å°†æ–‡ä»¶filenameæ’¤å‡ºæš‚å­˜åŒºï¼Œæš‚å­˜åŒºä¸­å…¶ä»–æ–‡ä»¶ä¸æ”¹å˜ã€‚ç›¸å½“äºå¯¹å‘½ä»¤git add filenameçš„åå‘æ“ä½œã€‚ å‘½ä»¤ï¼šgit reset HEAD filenameã€‚åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset --soft HEAD^ã€‚å·¥ä½œåŒºå’Œæš‚å­˜åŒºä¸æ”¹å˜ï¼Œä½†æ˜¯å¼•ç”¨å‘å‰å›é€€ä¸€æ¬¡ã€‚å½“å¯¹æœ€æ–°æäº¤çš„æäº¤è¯´æ˜æˆ–è€…æäº¤çš„æ›´æ”¹ä¸æ»¡æ„æ—¶ï¼Œæ’¤é”€ä¸‹æœ€æ–°çš„æäº¤ä»¥ä¾¿é‡æ–°æäº¤ã€‚ ä¹‹å‰æ›¾ç»ä»‹ç»è¿‡ä¸€ä¸ªä¿®æ”¹æäº¤å‘½ä»¤ï¼šgit commit --amendï¼Œç”¨äºå¯¹æœ€æ–°çš„æäº¤è¿›è¡Œé‡æ–°æäº¤ä»¥ä¿®è¡¥é”™è¯¯çš„æäº¤è¯´æ˜æˆ–è€…é”™è¯¯çš„æäº¤æ–‡ä»¶ã€‚ ä¿®è¡¥å‘½ä»¤å®é™…ä¸Šç›¸å½“äºæ‰§è¡Œäº†ä¸‹é¢ä¸¤æ¡å‘½ä»¤ã€‚ï¼ˆæ–‡ä»¶.git/COMMIT_EDITMSGä¿å­˜äº†ä¸Šæ¬¡çš„æäº¤æ—¥å¿—ï¼‰ 12$ git reset --soft HEAD^$ git commit -e -F .git/COMMIT_EDITMSG å‘½ä»¤ï¼šgit reset HEAD^ã€‚å·¥ä½œåŒºä¸æ”¹å˜ï¼Œä½†æ˜¯æš‚å­˜åŒºä¼šå›é€€åˆ°ä¸Šä¸€æ¬¡æäº¤ä¹‹å‰ï¼Œå¼•ç”¨ä¹Ÿä¼šå›é€€ä¸€æ¬¡ã€‚ å‘½ä»¤ï¼šgit reset --mixed HEAD^ã€‚åŒä¸Šã€‚ å‘½ä»¤ï¼šgit reset --hard HEAD^ã€‚å½»åº•æ’¤é”€æœ€è¿‘çš„æäº¤ã€‚å¼•ç”¨ä¼šå›é€€åˆ°å‰ä¸€æ¬¡ï¼Œè€Œä¸”å·¥ä½œåŒºå’Œæš‚å­˜åŒºéƒ½ä¼šå›é€€åˆ°ä¸Šä¸€æ¬¡æäº¤çš„çŠ¶æ€ã€‚è‡ªä¸Šä¸€æ¬¡ä»¥æ¥çš„æäº¤å…¨éƒ¨ä¸¢å¤±ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å¯¹è±¡]]></title>
    <url>%2Fposts%2F779ee1e1.html</url>
    <content type="text"><![CDATA[Gitå¯¹è±¡åº“æ¢ç§˜ é€šè¿‡æŸ¥çœ‹æ—¥å¿—çš„è¯¦å°½è¾“å‡ºï¼Œä¼šçœ‹åˆ°éå¸¸å¤šçš„SHA1å“ˆå¸Œå€¼ã€‚ 1$ git log -l --pretty=raw ä¸€ä¸ªæäº¤ä¸­å±…ç„¶åŒ…å«äº†ä¸‰ä¸ªSHA1å“ˆå¸Œå€¼è¡¨ç¤ºçš„å¯¹è±¡IDã€‚ commit a67c6fdd0a0e809340944432a3bf7d78e7e10f31 è¿™æ˜¯æœ¬æ¬¡æäº¤çš„å”¯ä¸€æ ‡è¯†ã€‚ tree b79fd13fac802739388af44a81d72b6e1d68da89 è¿™æ˜¯æœ¬æ¬¡æäº¤æ‰€å¯¹åº”çš„çš„ç›®å½•æ ‘ã€‚ parent d3617dadd10c274e6e2b6caf47635d5771b9034c è¿™æ˜¯æœ¬æ¬¡æäº¤çš„çˆ¶æäº¤ï¼ˆä¸Šä¸€æ¬¡æäº¤ï¼‰ã€‚ ç ”ç©¶Gitå¯¹è±¡IDçš„ä¸€ä¸ªé‡é‡çº§æ­¦å™¨ï¼šgit cat-fileå‘½ä»¤ã€‚ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹è¿™ä¸‰ä¸ªIDçš„ç±»å‹ã€‚ 123456$ git cat-file -t a67c6fcommit$ git cat-file -t b79ftree$ git cat-file d3617commit åœ¨å¼•ç”¨å¯¹è±¡IDçš„æ—¶å€™ï¼Œæ²¡æœ‰å¿…è¦æŠŠæ•´ä¸ª40ä½çš„IDå†™å…¨ï¼Œåªéœ€è¦ä»å¤´å¼€å§‹çš„å‡ ä½ä¸å†²çªå³å¯ã€‚ ä¸‹é¢å†ä½¿ç”¨git cat-fileå‘½ä»¤æŸ¥çœ‹ä¸€ä¸‹è¿™å‡ ä¸ªå¯¹è±¡çš„å†…å®¹ã€‚ commitå¯¹è±¡a67c6fdd0a0e809340944432a3bf7d78e7e10f31 1$ git cat-file -p a67c6f treeå¯¹è±¡b79fd13fac802739388af44a81d72b6e1d68da89 1$ git cat-file -p b79fd commitå¯¹è±¡d3617dadd10c274e6e2b6caf47635d5771b9034c 1$ git cat-file -p d3617 åœ¨ä¸Šé¢ç›®å½•æ ‘(tree)å¯¹è±¡ä¸­çœ‹åˆ°äº†ä¸€ä¸ªæ–°çš„ç±»å‹çš„å¯¹è±¡ï¼šblobå¯¹è±¡ã€‚è¿™ä¸ªå¯¹è±¡ä¿å­˜ç€æ–‡ä»¶welcome.txtçš„å†…å®¹ã€‚ è¯¥å¯¹è±¡çš„ç±»å‹ä¸ºblobã€‚ 12$ git cat-file -t d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16blob è¯¥å¯¹è±¡çš„å†…å®¹å°±æ˜¯welcome.txtæ–‡ä»¶çš„å†…å®¹ã€‚ 123$ git cat-file -p d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16Hello Git.å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ è¿™äº›å¯¹è±¡ä¿å­˜åœ¨å“ªé‡Œï¼Ÿå½“ç„¶æ˜¯Gitåº“ä¸­çš„objectsç›®å½•ä¸‹ï¼ˆIDçš„å‰ä¸¤ä½ä½œä¸ºç›®å½•åï¼Œå38ä½ä½œä¸ºæ–‡ä»¶åã€‚ï¼‰ ç”¨ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°è¿™äº›å¯¹è±¡åœ¨å¯¹è±¡åº“ä¸­çš„å®é™…ä½ç½®ã€‚ 1for id in a67c6f b79fd d3617 d7230d; do ls .git/objects/${id:0:2}/${id:2}*;done é€šè¿‡ä¸‹é¢çš„å‘½ä»¤å¯ä»¥çœ‹åˆ°æäº¤å¯¹è±¡ä¹‹é—´ç›¸äº’å…³è”çš„è·Ÿè¸ªè¿ã€‚ 1$ git log --pretty=raw --graph a67c ä¸Šé¢çš„å‘½ä»¤é€šè¿‡--graphå‚æ•°å¯ä»¥çœ‹åˆ°æäº¤é“¾è·¯ï¼Œé€šè¿‡--pretty=rawå‚æ•°ä»¥ä¾¿æ˜¾ç¤ºæ¯ä¸ªæäº¤å¯¹è±¡çš„parentå±æ€§ã€‚ æœ€åä¸€ä¸ªæäº¤æ²¡æœ‰parentå±æ€§ï¼Œæ‰€ä»¥è·Ÿè¸ªè¿åˆ°æ­¤ç»ˆç»“ï¼Œè¿™å®é™…ä¸Šå°±æ˜¯æäº¤çš„èµ·ç‚¹ã€‚ HEADå’ŒMasteræ¢ç§˜ ç°åœ¨å…ˆçœ‹ä¸‹å·¥ä½œåŒºçš„çŠ¶æ€ã€‚ 12$ git status -s -b## master ä¸Šé¢åœ¨æ˜¾ç¤ºå·¥ä½œåŒºçŠ¶æ€æ—¶ï¼Œé™¤äº†ä½¿ç”¨-så‚æ•°ä»¥æ˜¾ç¤ºç²¾ç®€è¾“å‡ºå¤–ï¼Œè¿˜ä½¿ç”¨äº†-bå‚æ•°ä»¥ä¾¿èƒ½å¤ŸåŒæ—¶æ˜¾ç¤ºå‡ºå½“å‰å·¥ä½œåˆ†æ”¯çš„åç§°ã€‚ ä½¿ç”¨git branchä¹Ÿå¯ä»¥æ˜¾ç¤ºå½“å‰çš„å·¥ä½œåˆ†æ”¯ã€‚ 12$ git branch * master åœ¨masteråˆ†æ”¯åç§°å‰é¢å‡ºç°ä¸€ä¸ªæ˜Ÿå·è¡¨æ˜è¿™ä¸ªåˆ†æ”¯æ˜¯å½“å‰å·¥ä½œåˆ†æ”¯ã€‚ ç°åœ¨è¿ç»­æ‰§è¡Œä¸‹é¢ä¸‰ä¸ªå‘½ä»¤ä¼šçœ‹åˆ°ç›¸åŒçš„è¾“å‡ºï¼š 12345$ git log -1 HEAD $ git log -1 master $ git log -1 refs/heads/master ä¹Ÿå°±æ˜¯è¯´åœ¨å½“å‰ç‰ˆæœ¬åº“ä¸­ï¼ŒHEADã€masterå’Œrefs/heads/masterå…·æœ‰ç›¸åŒçš„æŒ‡å‘ã€‚è®©æˆ‘ä»¬å»ç‰ˆæœ¬åº“.gitç›®å½•ä¸­çœ‹ä¸€çœ‹ã€‚ 12345$ find .git -name HEAD -o -name master.git/HEAD.git/logs/HEAD.git/logs/refs/heads/master.git/refs/heads/master æ˜¾ç¤ºä¸€ä¸‹.git/HEADçš„å†…å®¹ï¼š 12$ cat .git/HEADref: refs/heads/master æŠŠHEADçš„å†…å®¹ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼šâ€œæŒ‡å‘ä¸€ä¸ªå¼•ç”¨ï¼šrefs/heads/masterâ€ã€‚è¿™ä¸ªå¼•ç”¨åœ¨æ–‡ä»¶.git/refs/heads/masterã€‚ 12$ cat .git/refs/heads/mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31 ç”¨git cat-fileå‘½ä»¤æŸ¥çœ‹ä¸‹a67c6fdd0a0e809340944432a3bf7d78e7e10f31çš„å†…å®¹ã€‚ æ˜¾ç¤ºSHA1å“ˆå¸Œå€¼æŒ‡ä»£çš„æ•°æ®ç±»å‹ã€‚ 12$ git cat-file -t a67c6commit æ˜¾ç¤ºæäº¤çš„å†…å®¹ã€‚ 1234567$ git cat-file -p a67c6tree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ åŸæ¥åˆ†æ”¯masteræŒ‡å‘çš„æ˜¯ä¸€ä¸ªæäº¤IDï¼ˆæœ€æ–°æäº¤ï¼‰ã€‚è¿™æ ·çš„åˆ†æ”¯å®ç°å¾ˆå·§å¦™ï¼šæ—¢ç„¶å¯ä»¥ä»ä»»ä½•æäº¤å¼€å§‹å»ºç«‹ä¸€æ¡å†å²è·Ÿè¸ªè¿ï¼Œ é‚£ä¹ˆç”¨ä¸€ä¸ªæ–‡ä»¶æŒ‡å‘è¿™ä¸ªé“¾æ¡çš„æœ€æ–°æäº¤ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–‡ä»¶å°±å¯ä»¥ç”¨äºè¿½è¸ªæ•´ä¸ªæäº¤å†å²äº†ã€‚è¿™ä¸ªæ–‡ä»¶å°±æ˜¯.git/refs/heads/masteræ–‡ä»¶ã€‚ ä¸‹é¢çœ‹ä¸€ä¸ªæ›´æ¥è¿‘äºçœŸå®çš„ç‰ˆæœ¬åº“ç»“æ„å›¾ï¼š ç›®å½•.git/refsæ˜¯ä¿å­˜å¼•ç”¨çš„å‘½åç©ºé—´ï¼Œå…¶ä¸­.git/refs/headsç›®å½•ä¸‹çš„å¼•ç”¨åˆç§°ä¸ºåˆ†æ”¯ã€‚å¯¹äºåˆ†æ”¯æ—¢å¯ä»¥ä½¿ç”¨æ­£è§„çš„é•¿æ ¼å¼è¡¨ç¤ºæ³•ï¼Œå¦‚refs/heads/masterï¼Œ ä¹Ÿå¯ä»¥å»æ‰å‰é¢çš„ä¸¤çº§ç›®å½•ç”¨masterè¡¨ç¤ºã€‚Gitæœ‰ä¸€ä¸ªåº•å±‚å‘½ä»¤git rev-parseå¯ä»¥ç”¨äºæ˜¾ç¤ºå¼•ç”¨å¯¹åº”çš„æäº¤IDã€‚ 12345678$ git rev-parse mastera67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git rev-parse refs/heads/master a67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git rev-parse HEAD a67c6fdd0a0e809340944432a3bf7d78e7e10f31 å¯ä»¥çœ‹å‡ºå®ƒä»¬éƒ½æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ã€‚ä¸‹é¢æ¥å±•ç¤ºä¸€ä¸‹æäº¤çš„SHA1å“ˆå¸Œå€¼ç”Ÿæˆæ–¹æ³•ã€‚ çœ‹çœ‹HEADå¯¹åº”çš„æäº¤çš„å†…å®¹ã€‚ä½¿ç”¨git cat-fileå‘½ä»¤ã€‚ 1234567$ git cat-file commit HEADtree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ æäº¤ä¿¡æ¯ä¸­æ€»å…±åŒ…å«243ä¸ªå­—ç¬¦ã€‚ 1$ git cat-file commit HEAD | wc -c åœ¨æäº¤ä¿¡æ¯çš„å‰é¢åŠ ä¸Šå†…å®¹commit 243&lt;null&gt;(&lt;null&gt;ä¸ºç©ºå­—ç¬¦)ï¼Œç„¶åæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf "commit 243\000"; git cat-file commit HEAD) | sha1suma67c6fdd0a0e809340944432a3bf7d78e7e10f31 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 1$ git rev-parse HEAD ä¸‹é¢çœ‹ä¸€çœ‹æ–‡ä»¶å†…å®¹çš„SHA1å“ˆå¸Œå€¼ç”Ÿæˆæ–¹æ³•ã€‚ çœ‹çœ‹ç‰ˆæœ¬åº“ä¸­welcome.txtçš„å†…å®¹ï¼Œä½¿ç”¨git cat-fileå‘½ä»¤ã€‚ 123$ git cat-file blob HEAD:welcome.txtHello Git.å¾ˆé«˜å…´è§åˆ°ä½ ã€‚ æ–‡ä»¶æ€»å…±åŒ…å«33å­—èŠ‚çš„å†…å®¹ã€‚ 12$ git cat-file blob HEAD:welcome.txt | wc -c 33 åœ¨æ–‡ä»¶å†…å®¹çš„å‰é¢åŠ ä¸Šblob 33&lt;null&gt;çš„å†…å®¹ï¼Œç„¶åæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf "blob 33\000"; git cat-file blob HEAD:welcome.txt) | sha1sumd7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 12$ git rev-parse HEAD:welcome.txtd7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 æœ€åå†æ¥çœ‹çœ‹æ ‘çš„SHA1å“ˆå¸Œå€¼çš„å½¢æˆæ–¹æ³•ã€‚ HEADå¯¹åº”çš„æ ‘çš„å†…å®¹å…±åŒ…å«39ä¸ªå­—èŠ‚ã€‚ 12$ git cat-file tree HEAD^{tree} | wc -c39 åœ¨æ ‘çš„å†…å®¹çš„å‰é¢åŠ ä¸Štree 39&lt;null&gt;çš„å†…å®¹ï¼Œç„¶åæ‰§è¡ŒSHA1å“ˆå¸Œç®—æ³•ã€‚ 12$ (printf "tree 39\000"; git cat-file tree HEAD^{tree}) | sha1sumb79fd13fac802739388af44a81d72b6e1d68da89 *- ä¸Šé¢å‘½ä»¤å¾—åˆ°çš„å“ˆå¸Œå€¼å’Œç”¨git rev-parseçœ‹åˆ°çš„æ˜¯ä¸€æ ·çš„ã€‚ 12$ git rev-parse HEAD^{tree}b79fd13fac802739388af44a81d72b6e1d68da89 Gitæä¾›äº†å¾ˆå¤šæ–¹æ³•å¯ä»¥æ–¹ä¾¿çš„è®¿é—®Gitåº“ä¸­çš„å¯¹è±¡ã€‚ é‡‡ç”¨éƒ¨åˆ†SHA1å“ˆå¸Œå€¼ã€‚ä¸å¿…å†™å…¨40ä½çš„å“ˆå¸Œå€¼ï¼Œåªé‡‡ç”¨å¼€å¤´çš„éƒ¨åˆ†ï¼Œä¸å’Œç°æœ‰å…¶ä»–çš„å†²çªå³å¯ã€‚ ä½¿ç”¨masterä»£è¡¨åˆ†æ”¯masterä¸­æœ€æ–°çš„æäº¤ï¼Œä½¿ç”¨å…¨ç§°refs/heads/masteräº¦å¯ã€‚ ä½¿ç”¨HEADä»£è¡¨ç‰ˆæœ¬åº“ä¸­æœ€è¿‘çš„ä¸€æ¬¡æäº¤ã€‚ ç¬¦å·^å¯ä»¥ç”¨äºæŒ‡ä»£çˆ¶æäº¤ã€‚ä¾‹å¦‚ï¼š HEAD^ä»£è¡¨ç‰ˆæœ¬åº“ä¸­ä¸Šä¸€æ¬¡æäº¤ï¼Œå³æœ€è¿‘ä¸€æ¬¡æäº¤çš„çˆ¶æäº¤ã€‚ HEAD^^åˆ™ä»£è¡¨HEAD^çš„çˆ¶æäº¤ã€‚ å¯¹äºä¸€ä¸ªæäº¤æœ‰å¤šä¸ªçˆ¶æäº¤ï¼Œå¯ä»¥åœ¨ç¬¦å·^åé¢ç”¨æ•°å­—è¡¨ç¤ºæ˜¯ç¬¬å‡ ä¸ªçˆ¶æäº¤ã€‚ä¾‹å¦‚ï¼š a5731^2å«ä¹‰æ˜¯æäº¤a5731çš„å¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬äºŒä¸ªçˆ¶æäº¤ã€‚ HEAD^1ç›¸å½“äºHEAD^å«ä¹‰æ˜¯HEADå¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬ä¸€ä¸ªã€‚ HEAD^^2å«ä¹‰æ˜¯HEAD^(HEADçˆ¶æäº¤)çš„å¤šä¸ªçˆ¶æäº¤ä¸­çš„ç¬¬äºŒä¸ªã€‚ ç¬¦å·~&lt;n&gt;ä¹Ÿå¯ä»¥ç”¨äºæŒ‡ä»£ç¥–å…ˆæäº¤ã€‚ä¸‹é¢ä¸¤ä¸ªè¡¨è¾¾å¼æ•ˆæœç­‰åŒï¼š 12a5731~5a5731^^^^^ æäº¤æ‰€å¯¹åº”çš„æ ‘å¯¹è±¡ï¼Œå¯ä»¥ç”¨ç±»ä¼¼å¦‚ä¸‹çš„è¯­æ³•è®¿é—®ã€‚ 1a5731^{tree} æŸä¸€æ­¤æäº¤å¯¹åº”çš„æ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹çš„è¯­æ³•è®¿é—®ã€‚ 1a5731:path/to/file æš‚å­˜åŒºä¸­çš„æ–‡ä»¶å¯¹è±¡ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹è¯­æ³•è®¿é—®ã€‚ 1:path/to/file ä¸‹é¢ä½¿ç”¨git rev-parseç»ƒä¹ ä¸‹ã€‚ 12345678910111213141516$ git rev-parse HEAD a67c6fdd0a0e809340944432a3bf7d78e7e10f31$ git cat-file -p a67c6f tree b79fd13fac802739388af44a81d72b6e1d68da89parent d3617dadd10c274e6e2b6caf47635d5771b9034cauthor wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800committer wanghongbo &lt;270028806@qq.com&gt; 1560174530 +0800å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ$ git rev-parse a67c6f^{tree}b79fd13fac802739388af44a81d72b6e1d68da89$ git rev-parse a67c6f^^{tree}a070b35c2d55e057a2eead7b8ae1b06c3e4d8e3b document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å·¥ä½œåŒºã€æš‚å­˜åŒºã€HEAD]]></title>
    <url>%2Fposts%2F2c9fc045.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹ä¸€ä¸‹git-demoçš„æäº¤æ—¥å¿—ï¼Œä½¿ç”¨git logæŸ¥çœ‹æäº¤æ—¥å¿—ï¼ˆé™„åŠ --statå‚æ•°å¯ä»¥çœ‹åˆ°æ¯æ¬¡æäº¤çš„æ–‡ä»¶å˜æ›´ç»Ÿè®¡ï¼‰ã€‚ 1$ git log --stat é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°ç¬¬ä¸€æ¬¡æäº¤å¯¹æ–‡ä»¶welcome.txtæœ‰ä¸€è¡Œçš„å˜æ›´ï¼Œè€Œç¬¬äºŒæ¬¡æäº¤å› ä¸ºä½¿ç”¨äº†--allow-emptyå‚æ•°è¿›è¡Œçš„ç©ºæäº¤ï¼Œæ‰€ä»¥æäº¤è¯´æ˜ä¸­çœ‹ä¸åˆ°ä»»ä½•å¯¹å®è´¨å†…å®¹çš„ä¿®æ”¹ã€‚ ä¿®æ”¹ä¸èƒ½ç›´æ¥æäº¤ï¼Ÿ é¦–å…ˆæ›´æ”¹welcome.txtæ–‡ä»¶çš„å†…å®¹ï¼Œåœ¨æ–‡ä»¶åé¢è¿½åŠ ä¸€è¡Œã€‚ 1$ echo "å¾ˆé«˜å…´è§åˆ°ä½ ã€‚" &gt;&gt; welcome.txt è¿™æ—¶å°±å¯ä»¥é€šè¿‡git diffå‘½ä»¤çœ‹åˆ°ä¿®æ”¹åçš„æ–‡ä»¶å’Œç‰ˆæœ¬åº“ä¸­æ–‡ä»¶çš„å·®å¼‚ã€‚å®è´¨å’Œæœ¬åœ°æ¯”è¾ƒçš„ä¸æ˜¯ç‰ˆæœ¬åº“ï¼Œè€Œæ˜¯ä¸€ä¸ªä¸­é—´çŠ¶æ€çš„æ–‡ä»¶ã€‚ 1$ git diff æ¥ä¸‹æ¥æ‰§è¡Œæäº¤ï¼Œçœ‹èƒ½å¦æäº¤æˆåŠŸã€‚ 1$ git commit -m "è¿½åŠ ä¸€è¡Œï¼šå¾ˆé«˜å…´è§åˆ°ä½ ã€‚" æäº¤æˆåŠŸäº†å—ï¼Ÿå¥½åƒæ²¡æœ‰ã€‚ æäº¤æ²¡æœ‰æˆåŠŸçš„è¯æ®ï¼š å…ˆçœ‹çœ‹æäº¤æ—¥å¿—ï¼Œå¦‚æœæäº¤æˆåŠŸå°±ä¼šæœ‰æ–°çš„æäº¤è®°å½•ã€‚ 1$ git log --pretty=oneline ä½¿ç”¨äº†ç²¾ç®€è¾“å‡ºæ¥æ˜¾ç¤ºæ—¥å¿—ï¼Œä»¥ä¾¿æ›´ç®€æ´å’Œæ¸…æ™°åœ°çœ‹åˆ°æäº¤å†å²ã€‚å¯ä»¥çœ‹åˆ°ç‰ˆæœ¬åº“ä¸­åªæœ‰ä¸¤ä¸ªæäº¤ï¼Œé’ˆå¯¹åˆšæ‰ä¿®æ”¹æ–‡ä»¶çš„æäº¤æ²¡æœ‰æˆåŠŸï¼ æ‰§è¡Œgit diffå¯ä»¥çœ‹åˆ°å’Œä¹‹å‰ç›¸åŒçš„å·®å¼‚è¾“å‡ºï¼Œè¿™ä¹Ÿè¯´æ˜æäº¤æ²¡æœ‰æˆåŠŸã€‚ æ‰§è¡Œgit statusæŸ¥çœ‹æ–‡ä»¶çŠ¶æ€ï¼Œå¯ä»¥çœ‹åˆ°æ–‡ä»¶å¤„äºæœªæäº¤çŠ¶æ€ã€‚ æ‰§è¡Œgit status -så¯ä»¥æ˜¾ç¤ºç²¾ç®€æ ¼å¼çš„çŠ¶æ€è¾“å‡ºã€‚ æäº¤ä¸ºä»€ä¹ˆä¼šå¤±è´¥å‘¢ï¼ŸåŸå› æ˜¯æ²¡æœ‰å¯¹ä¿®æ”¹çš„welcome.txtæ–‡ä»¶æ‰§è¡Œgit addå‘½ä»¤ï¼Œå°†ä¿®æ”¹çš„æ–‡ä»¶æ·»åŠ åˆ°â€œæäº¤ä»»åŠ¡â€ï¼Œç„¶åæ‰èƒ½æäº¤ã€‚ ç°åœ¨å°±å°†ä¿®æ”¹çš„æ–‡ä»¶â€œæ·»åŠ â€åˆ°æäº¤ä»»åŠ¡ã€‚ 1$ git add welcome.txt ç°åœ¨å†æ‰§è¡Œä¸€äº›Gitå‘½ä»¤ï¼Œçœ‹çœ‹å½“æ‰§è¡Œâ€œæ·»åŠ â€åä¼šå‘ç”Ÿä»€ä¹ˆå˜åŒ–ã€‚ æ‰§è¡Œgit diffæ²¡æœ‰è¾“å‡ºã€‚ æ‰§è¡Œgit diff headæˆ–git diff masterè¿›è¡Œæ¯”è¾ƒä¼šå‘ç°æœ‰å·®å¼‚ï¼Œè¿™ä¸ªå·®å¼‚æ˜¯æ­£å¸¸çš„ï¼Œå› ä¸ºè¿˜æ²¡æœ‰æäº¤ã€‚ 1$ git diff head æ‰§è¡Œgit statusï¼ŒçŠ¶æ€è¾“å‡ºå’Œä¹‹å‰ä¸ä¸€æ ·äº†ã€‚ 1$ git status å¯¹æ–°çš„GitçŠ¶æ€è¾“å‡ºåšä¸‹ç¿»è¯‘ï¼š 12345ä½äºåˆ†æ”¯masterä¸Šä¸‹åˆ—çš„ä¿®æ”¹å°†è¢«æäº¤ï¼š ï¼ˆå¦‚æœä½ åæ‚”äº†ï¼Œå¯ä»¥ä½¿ç”¨â€œgit reset HEAD &lt;file&gt;...â€å‘½ä»¤å°†ä¸‹åˆ—æ”¹åŠ¨æ’¤å‡ºæäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ï¼Œ å¦åˆ™æ‰§è¡Œæäº¤å‘½ä»¤å°†ä¼šæäº¤ï¼‰ å·²ä¿®æ”¹ï¼š welcome.txt ä¸å¾—ä¸è¯´ï¼ŒGitå¤ªäººæ€§åŒ–äº†ï¼Œå®ƒæŠŠå„ç§æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨åˆ°çš„å‘½ä»¤éƒ½å‘Šè¯‰äº†ç”¨æˆ·ï¼Œè™½ç„¶è¿™æ˜¾å¾—æœ‰ç‚¹å•°å—¦ã€‚ å¦‚æœä¸è¦è¿™ä¹ˆå•°å—¦ï¼Œå¯ä»¥ä½¿ç”¨ç®€æ´æ–¹å¼ï¼š 12$ git status -sM welcome.txt ä¸Šé¢ç²¾ç®€çŠ¶æ€è¾“å‡ºä¸æ‰§è¡Œgit addä¹‹å‰çš„ç²¾ç®€çŠ¶æ€çš„è¾“å‡ºç›¸æ¯”ï¼Œæœ‰ç»†å¾®çš„å·®åˆ«ã€‚ è™½ç„¶éƒ½æ˜¯M(Modified)æ ‡è¯†ï¼Œä½†æ˜¯ä½ç½®ä¸åŒã€‚åœ¨æ‰§è¡Œgit addä¹‹å‰ï¼Œè¿™ä¸ªMä½äºç¬¬äºŒåˆ—ï¼ˆç¬¬ä¸€åˆ—æ˜¯ä¸ªç©ºæ ¼ï¼‰ï¼Œæ‰§è¡Œå®Œgit addä¹‹åï¼Œå­—ç¬¦Mä½äºç¬¬ä¸€åˆ—ï¼ˆç¬¬äºŒåˆ—æ˜¯ç©ºç™½ï¼‰ã€‚ ä½äºç¬¬ä¸€åˆ—çš„å­—ç¬¦Mçš„å«ä¹‰ï¼šç‰ˆæœ¬åº“ä¸­çš„æ–‡ä»¶å’Œå¤„äºä¸­é—´çŠ¶æ€--æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”æœ‰æ”¹åŠ¨ï¼› ä½äºç¬¬äºŒåˆ—çš„å­—ç¬¦Mçš„å«ä¹‰ï¼šå·¥ä½œåŒºå½“å‰çš„æ–‡ä»¶å’Œå¤„äºä¸­é—´çŠ¶æ€--æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”æœ‰æ”¹åŠ¨ã€‚ è¿™æ—¶å¦‚æœç›´æ¥æäº¤git commit,åŠ å…¥æäº¤ä»»åŠ¡çš„welcome.txtæ–‡ä»¶çš„æ›´æ”¹å°±è¢«æäº¤å…¥åº“äº†ã€‚ä½†æ˜¯å…ˆä¸å¿™ç€æäº¤ï¼Œå†è¿›è¡Œä¸€äº›æ“ä½œï¼Œçœ‹çœ‹èƒ½å¦è¢«å½»åº•æç³Šæ¶‚ã€‚ ç»§ç»­ä¿®æ”¹welcome.txtæ–‡ä»¶ï¼ˆåœ¨æ–‡ä»¶åé¢è¿½åŠ ä¸€è¡Œï¼‰ã€‚ 1$ echo "Good-bye" &gt;&gt; welcome.txt ç„¶åæ‰§è¡Œgit statusæŸ¥çœ‹ä¸€ä¸‹çŠ¶æ€ï¼š 1git status çŠ¶æ€è¾“å‡ºä¸­å±…ç„¶æ˜¯ä¹‹å‰å‡ºç°çš„ä¸¤ç§ä¸åŒçŠ¶æ€çš„è¾“å‡ºã€‚ ä½¿ç”¨ç®€æ´æ¨¡å¼è¾“å‡ºï¼Œä¹Ÿä¼šçœ‹åˆ°ä¸¤ç§ç²¾ç®€è¾“å‡ºçš„æ‚åˆã€‚ 1git status -s ä¸Šé¢GitçŠ¶æ€çš„è¾“å‡ºå¯ä»¥è¿™ä¹ˆç†è§£ï¼šä¸ä½†ç‰ˆæœ¬åº“ä¸­æœ€æ–°æäº¤çš„æ–‡ä»¶å’Œå¤„äºä¸­é—´çŠ¶æ€ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­æ–‡ä»¶ ç›¸æ¯”æœ‰æ”¹åŠ¨ï¼Œè€Œä¸”å·¥ä½œåŒºå½“å‰çš„æ–‡ä»¶å’Œå¤„äºä¸­é—´çŠ¶æ€ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„æ–‡ä»¶ç›¸æ¯”ä¹Ÿæœ‰æ”¹åŠ¨ã€‚ å³ç°åœ¨welcome.txtä¸­æœ‰ä¸‰ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼šä¸€ä¸ªåœ¨å·¥ä½œåŒºï¼Œä¸€ä¸ªåœ¨æš‚å­˜åŒºï¼Œä¸€ä¸ªæ˜¯ç‰ˆæœ¬åº“ä¸­æœ€æ–°ç‰ˆæœ¬ã€‚é€šè¿‡ ä¸åŒçš„å‚æ•°è°ƒç”¨git diffå‘½ä»¤å¯ä»¥çœ‹åˆ°ä¸åŒç‰ˆæœ¬åº“ä¹‹é—´çš„å·®å¼‚ã€‚ ä¸å¸¦ä»»ä½•é€‰é¡¹å’Œå‚æ•°è°ƒç”¨git diffæ˜¾ç¤ºå·¥ä½œåŒºæœ€æ–°æ”¹åŠ¨ï¼Œå³å·¥ä½œåŒºå’Œæäº¤æš‚å­˜åŒºä¸­ç›¸æ¯”çš„å·®å¼‚ã€‚ å°†å·¥ä½œåŒºå’ŒHEADï¼ˆå½“å‰å·¥ä½œåˆ†æ”¯ï¼‰ç›¸æ¯”ï¼Œä¼šçœ‹åˆ°æ›´å¤šå·®å¼‚ã€‚ é€šè¿‡å‚æ•°--cachedæˆ–è€…--stagedå‚æ•°è°ƒç”¨git diffå‘½ä»¤ï¼Œçœ‹åˆ°çš„æ˜¯æäº¤æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¸­æ–‡ä»¶çš„å·®å¼‚ã€‚ å¥½äº†ï¼Œç°åœ¨æäº¤ä¸‹çœ‹çœ‹ã€‚ 123$ git commit -m "å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ"[master a67c6fd] å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿ 1 file changed, 1 insertion(+) è¿™æ¬¡æäº¤ç»ˆäºæˆåŠŸäº†ï¼ŒæŸ¥çœ‹ä¸‹æ—¥å¿—ï¼š 1234$ git log --pretty=onelinea67c6fdd0a0e809340944432a3bf7d78e7e10f31 (HEAD -&gt; master) å“ªä¸ªç‰ˆæœ¬çš„æ•°æ®ä¼šè¢«æäº¤ï¼Ÿd3617dadd10c274e6e2b6caf47635d5771b9034c è¿™æ˜¯è°æäº¤çš„ï¼Ÿd3e0684a1c510f4effd155b01591019e2c5d7812 åˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤ æŸ¥çœ‹ç²¾ç®€çŠ¶æ€è¾“å‡ºï¼š 12$ git status -s M welcome.txt çŠ¶æ€è¾“å‡ºä¸­æ–‡ä»¶åçš„å‰é¢å‡ºç°äº†ä¸€ä¸ªå­—æ¯Mï¼Œå³åªä½äºç¬¬äºŒåˆ—çš„å­—æ¯Mã€‚é‚£ä¹ˆç¬¬ä¸€åˆ—çš„Må»å“ªäº†ï¼Ÿå¾ˆæ˜æ˜¾è¢«æäº¤äº†ã€‚ å³æäº¤ä»»åŠ¡ï¼ˆæäº¤æš‚å­˜åŒºï¼Œstageï¼‰ä¸­çš„å†…å®¹è¢«æäº¤åˆ°ç‰ˆæœ¬åº“ï¼Œæ‰€ä»¥ç¬¬ä¸€åˆ—å› ä¸ºæäº¤æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¸­çš„çŠ¶æ€ä¸€è‡´ï¼Œæ‰€ä»¥æ˜¾ç¤ºç©ºç™½ã€‚ é‚£æäº¤çš„welcome.txtæ˜¯å“ªä¸ªç‰ˆæœ¬å‘¢ï¼Ÿé€šè¿‡æ‰§è¡Œgit diffæˆ–è€…git diff headå‘½ä»¤æŸ¥çœ‹å·®å¼‚ã€‚è™½ç„¶å‘½ä»¤ git diffå’Œgit diff headçš„æ¯”è¾ƒè¿‡ç¨‹å¹¶ä¸åŒï¼Œä½†æ˜¯ä¼šçœ‹åˆ°ä¸‹é¢ç›¸åŒçš„å·®å¼‚è¾“å‡ºç»“æœã€‚ 12$ git diff$ git diff head ç†è§£Gitæš‚å­˜åŒºï¼ˆstageï¼‰ Gitæš‚å­˜åŒºï¼ˆstageï¼Œæˆ–ç§°ä¸ºindexï¼‰çš„è®¾è®¡æ˜¯Gitæœ€æˆåŠŸçš„è®¾è®¡ä¹‹ä¸€ï¼Œä¹Ÿæ˜¯æœ€éš¾ç†è§£çš„ä¸€ä¸ªè®¾è®¡ã€‚ åœ¨ç‰ˆæœ¬åº“.gitç›®å½•ä¸‹ï¼Œæœ‰ä¸€ä¸ªindexæ–‡ä»¶ï¼Œä¸‹é¢é’ˆå¯¹è¿™ä¸ªæ–‡ä»¶åšä¸ªå®éªŒã€‚ é¦–å…ˆæ‰§è¡Œgit checkoutå‘½ä»¤ï¼Œæ’¤é”€å·¥ä½œåŒºä¸­welcome.txtæ–‡ä»¶å°šæœªæäº¤çš„ä¿®æ”¹ã€‚ 12$ git checkout -- welcome.txt$ git status -s é€šè¿‡çŠ¶æ€è¾“å‡ºå¯ä»¥çœ‹åˆ°å·¥ä½œåŒºå·²ç»æ²¡æœ‰æ”¹åŠ¨äº†ï¼ŒæŸ¥çœ‹ä¸‹.git/indexæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼š 2019-06-10 22:00:43 1$ ls --full-time .git/index å†æ¬¡æ‰§è¡Œgit statuså‘½ä»¤ï¼Œç„¶åæ˜¾ç¤º.git/indexæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼š2019-06-10 22:00:43ï¼Œå’Œä¸Šé¢çš„ä¸€æ ·ã€‚ 12$ git status -s $ ls --full-time .git/index ç°åœ¨æ›´æ”¹ä¸€ä¸‹welcome.txtæ–‡ä»¶çš„æ—¶é—´æˆ³ï¼Œä½†ä¸æ”¹å˜å®ƒçš„å†…å®¹ã€‚ç„¶åå†æ‰§è¡Œgit statuså‘½ä»¤ï¼Œç„¶åæŸ¥çœ‹.git/indexæ–‡ä»¶æ—¶é—´æˆ³ä¸ºï¼š22:06:32 123$ touch welcome.txt$ git status -s $ ls --full-time .git/index å¯ä»¥çœ‹åˆ°æ—¶é—´æˆ³æ”¹å˜äº†ã€‚ è¿™ä¸ªå®éªŒè¯´æ˜å½“æ‰§è¡Œgit statusæˆ–è€…git diffå‘½ä»¤æ‰«æå·¥ä½œåŒºæ”¹åŠ¨çš„æ—¶å€™ï¼Œå…ˆä¾æ®.git/indexæ–‡ä»¶ä¸­è®°å½•çš„ ï¼ˆå·¥ä½œåŒºè·Ÿè¸ªæ–‡ä»¶ï¼‰æ—¶é—´æˆ³ã€é•¿åº¦ç­‰ä¿¡æ¯åˆ¤æ–­å·¥ä½œåŒºæ–‡ä»¶æ˜¯å¦æ”¹å˜ã€‚å¦‚æœå·¥ä½œåŒºçš„æ–‡ä»¶æ—¶é—´æˆ³æ”¹å˜ï¼Œè¯´æ˜æ–‡ä»¶çš„ å†…å®¹å¯èƒ½è¢«æ”¹å˜äº†ï¼Œéœ€è¦æ‰“å¼€æ–‡ä»¶ï¼Œè¯»å–æ–‡ä»¶å†…å®¹ï¼Œå’Œæ›´æ”¹å‰çš„åŸå§‹æ–‡ä»¶ç›¸æ¯”ï¼Œåˆ¤æ–­æ–‡ä»¶å†…å®¹æ˜¯å¦è¢«æ›´æ”¹ã€‚å¦‚æœ æ–‡ä»¶å†…å®¹æ²¡æœ‰æ”¹å˜ï¼Œåˆ™å°†è¯¥æ–‡ä»¶æ–°çš„æ—¶é—´æˆ³è®°å½•åˆ°.git/indexæ–‡ä»¶ä¸­ã€‚å› ä¸ºåˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ›´æ”¹ä½¿ç”¨çš„æ˜¯æ—¶é—´æˆ³ã€ æ–‡ä»¶é•¿åº¦ç­‰ä¿¡æ¯è¿›è¡Œæ¯”è¾ƒï¼Œè¦æ¯”é€šè¿‡æ–‡ä»¶å†…å®¹æ¯”è¾ƒå¿«çš„å¤šï¼Œæ‰€ä»¥GItè¿™æ ·çš„å®ç°æ–¹å¼å¯ä»¥è®©å·¥ä½œåŒºçŠ¶æ€æ‰«ææ›´å¿« æ‰§è¡Œï¼Œè¿™ä¹Ÿæ˜¯Gité«˜æ•ˆçš„å› ç´ ä¹‹ä¸€ã€‚ æ–‡ä»¶.git/indexå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªåŒ…å«æ–‡ä»¶ç´¢å¼•çš„ç›®å½•æ ‘ï¼Œåƒæ˜¯ä¸€ä¸ªè™šæ‹Ÿçš„å·¥ä½œåŒºã€‚åœ¨è¿™ä¸ªè™šæ‹Ÿå·¥ä½œåŒºçš„ç›®å½•æ ‘ä¸­ï¼Œ è®°å½•äº†æ–‡ä»¶åã€æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼ˆæ—¶é—´æˆ³ã€æ–‡ä»¶é•¿åº¦ç­‰ï¼‰ã€‚æ–‡ä»¶çš„å†…å®¹å¹¶ä¸å­˜å‚¨å…¶ä¸­ï¼Œè€Œæ˜¯ä¿å­˜åœ¨Gitå¯¹è±¡åº“ .git/objectsç›®å½•ä¸­ï¼Œæ–‡ä»¶ç´¢å¼•å»ºç«‹äº†æ–‡ä»¶å’Œå¯¹è±¡åº“ä¸­å¯¹è±¡å®ä½“ä¹‹é—´çš„å¯¹åº”ã€‚ ä¸‹é¢è¿™å¼ å›¾å±•ç¤ºäº†å·¥ä½œåŒºã€ç‰ˆæœ¬åº“ä¸­çš„æš‚å­˜åŒºå’Œç‰ˆæœ¬åº“ä¹‹é—´çš„å…³ç³»ã€‚ å›¾ä¸­å·¦ä¾§ä¸ºå·¥ä½œåŒºï¼Œå³ä¾§ä¸ºç‰ˆæœ¬åº“ã€‚åœ¨ç‰ˆæœ¬åº“ä¸­æ ‡è®°ä¸ºindexçš„åŒºåŸŸæ˜¯æš‚å­˜åŒº(stageï¼Œäº¦ç§°index),æ ‡è®°ä¸ºmasterçš„æ˜¯masteråˆ†æ”¯æ‰€ä»£è¡¨çš„ç›®å½•æ ‘ã€‚ å›¾ä¸­å¯ä»¥çœ‹å‡ºæ­¤æ—¶HEADå®é™…ä¸Šæ˜¯æŒ‡å‘masteråˆ†æ”¯çš„ä¸€ä¸ªâ€œæ¸¸æ ‡â€ï¼Œæ‰€ä»¥å›¾ç¤ºçš„å‘½ä»¤ä¸­å‡ºç°HEADçš„åœ°æ–¹å¯ä»¥ç”¨masteræ›¿æ¢ã€‚ å›¾ä¸­çš„objectsæ ‡è¯†çš„åŒºåŸŸä¸ºGitçš„å¯¹è±¡åº“ï¼Œå®é™…ä½äº.git/objectsç›®å½•ä¸‹ã€‚ å½“å¯¹å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢ï¼‰çš„æ–‡ä»¶æ‰§è¡Œgit addå‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘è¢«æ›´æ–°ï¼ŒåŒæ—¶å·¥ä½œåŒºä¿®æ”¹ï¼ˆæˆ–æ–°å¢ï¼‰çš„æ–‡ä»¶ å†…å®¹è¢«å†™å…¥åˆ°å¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªæ–°çš„å¯¹è±¡ä¸­ï¼Œè€Œå¯¹è±¡çš„IDè¢«è®°å½•åœ¨æš‚å­˜åŒºçš„æ–‡ä»¶ç´¢å¼•ä¸­ã€‚ å½“æ‰§è¡Œæäº¤æ“ä½œæ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘å†™åˆ°ç‰ˆæœ¬åº“ï¼ˆå¯¹è±¡åº“ï¼‰ä¸­ï¼Œmasteråˆ†æ”¯ä¼šåšå‡ºç›¸åº”çš„æ›´æ–°ã€‚å³masteræœ€æ–°æŒ‡å‘çš„ç›®å½•æ ‘å°±æ˜¯æäº¤æ—¶åŸæš‚å­˜åŒºçš„ç›®å½•æ ‘ã€‚ å½“æ‰§è¡Œgit reset HEADå‘½ä»¤æ—¶ï¼Œæš‚å­˜åŒºçš„ç›®å½•æ ‘ä¼šè¢«é‡å†™ï¼Œè¢«masteråˆ†æ”¯æŒ‡å‘çš„ç›®å½•æ ‘æ‰€æ›¿æ¢ï¼Œä½†æ˜¯å·¥ä½œåŒºä¸å—å½±å“ã€‚ å½“æ‰§è¡Œgit rm --cached &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç›´æ¥ä»æš‚å­˜åŒºåˆ é™¤æ–‡ä»¶ï¼Œå·¥ä½œåŒºåˆ™ä¸åšæ”¹å˜ã€‚ å½“æ‰§è¡Œgit checkout . æˆ–è€…git checkout -- &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç”¨æš‚å­˜åŒºå…¨éƒ¨æˆ–æŒ‡å®šçš„æ–‡ä»¶æ›¿æ¢å·¥ä½œåŒºçš„æ–‡ä»¶ï¼Œã€‚ è¿™ä¸ªæ“ä½œå¾ˆå±é™©ï¼Œä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæ·»åŠ åˆ°æš‚å­˜åŒºçš„æ”¹åŠ¨ã€‚ å½“æ‰§è¡Œgit checkout HEAD .æˆ–è€…git checkout HEAD &lt;file&gt;å‘½ä»¤æ—¶ï¼Œä¼šç”¨HEADæŒ‡å‘çš„masteråˆ†æ”¯ä¸­çš„å…¨éƒ¨æˆ–è€… éƒ¨åˆ†æ–‡ä»¶æ›¿æ¢æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­çš„æ–‡ä»¶ã€‚è¿™ä¸ªå‘½ä»¤ä¹Ÿæå…·å±é™©æ€§ï¼Œå› ä¸ºä¸ä½†ä¼šæ¸…é™¤å·¥ä½œåŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ï¼Œä¹Ÿä¼šæ¸…é™¤æš‚å­˜åŒºä¸­æœªæäº¤çš„æ”¹åŠ¨ã€‚ Git Diff é­”æ³• æš‚å­˜åŒºç›®å½•æ ‘æµè§ˆ å¯¹äºHEADï¼ˆç‰ˆæœ¬åº“ä¸­å½“å‰æäº¤ï¼‰æŒ‡å‘çš„ç›®å½•æ ‘ï¼Œå¯ä»¥ä½¿ç”¨git ls-treeæ¥æŸ¥çœ‹ã€‚ 12$ git ls-tree -l HEAD 100644 blob d7230d74c5f8d61ff3c1adbfd3b035c09cb62c16 33 welcome.txt ä½¿ç”¨-lå‚æ•°ï¼Œå¯ä»¥æ˜¾ç¤ºæ–‡ä»¶å¤§å°ã€‚ä¸Šé¢welcome.txtå¤§å°33å­—èŠ‚ã€‚ è¾“å‡ºçš„æ¡ç›®ä»å·¦è‡³å³ï¼Œç¬¬ä¸€ä¸ªå­—æ®µæ˜¯æ–‡ä»¶çš„å±æ€§ï¼ˆrw-r--r--ï¼‰,ç¬¬äºŒä¸ªå­—æ®µè¯´æ˜æ˜¯Gitå¯¹è±¡åº“ä¸­çš„ä¸€ä¸ªblobå¯¹è±¡ï¼ˆæ–‡ä»¶ï¼‰ï¼Œ ç¬¬ä¸‰ä¸ªå­—æ®µåˆ™æ˜¯è¯¥æ–‡ä»¶åœ¨å¯¹è±¡åº“ä¸­å¯¹åº”çš„ID--ä¸€ä¸ª40ä½çš„SHA1å“ˆå¸Œå€¼æ ¼å¼çš„IDï¼Œç¬¬å››ä¸ªå­—æ®µæ˜¯æ–‡ä»¶å¤§å°ï¼Œç¬¬äº”ä¸ªå­—æ®µæ˜¯æ–‡ä»¶åã€‚ åœ¨æµè§ˆæš‚å­˜åŒºä¸­çš„ç›®å½•æ ‘ä¹‹å‰ï¼Œé¦–å…ˆæ¸…é™¤å·¥ä½œåŒºå½“ä¸­çš„æ”¹åŠ¨ã€‚é€šè¿‡ git clean -fdå‘½ä»¤æ¸…é™¤å½“å‰å·¥ä½œåŒºä¸­æ²¡æœ‰åŠ å…¥ ç‰ˆæœ¬åº“çš„æ–‡ä»¶å’Œç›®å½•ï¼ˆéè·Ÿè¸ªæ–‡ä»¶å’Œç›®å½•ï¼‰ï¼Œç„¶åæ‰§è¡Œgit checkout .å‘½ä»¤ï¼Œç”¨æš‚å­˜åŒºåˆ·æ–°å·¥ä½œåŒºã€‚ 12$ git clean -fd$ git checkout . ç„¶ååœ¨å·¥ä½œåŒºä¸­åšå‡ºä¸€äº›ä¿®æ”¹ï¼ˆä¿®æ”¹welcome.txtï¼Œå¢åŠ ä¸€ä¸ªå­ç›®å½•å’Œæ–‡ä»¶ï¼‰ï¼Œç„¶åæ·»åŠ åˆ°æš‚å­˜åŒºã€‚æœ€åå†å¯¹å·¥ä½œåŒºåšå‡ºä¿®æ”¹ã€‚ 123456$ echo "( ^_^ )/~~æ‹œæ‹œ" &gt;&gt; welcome.txt$ mkdir -p a/b/c$ echo "Hello." &gt;&gt; a/b/c/hello.txt $ git add .$ echo "ãƒ¾(ï¿£â–½ï¿£)Bye~Bye~" &gt;&gt; a/b/c/hello.txt $ git status -s ä¸Šé¢çš„å‘½ä»¤è¿è¡Œå®Œæ¯•åï¼Œé€šè¿‡ç²¾ç®€çš„çŠ¶æ€è¾“å‡ºï¼Œå¯ä»¥çœ‹å‡ºå·¥ä½œåŒºã€æš‚å­˜åŒºã€ç‰ˆæœ¬åº“å½“å‰åˆ†æ”¯çš„æœ€æ–°ç‰ˆæœ¬ï¼ˆHEADï¼‰å„ä¸ç›¸åŒã€‚å…ˆæ¥çœ‹çœ‹å·¥ä½œåŒºä¸­æ–‡ä»¶çš„å¤§å°ï¼š 123$ find . -path ./.git -prune -o -type f -printf "%-20p\t%s\n"./a/b/c/hello.txt 30./welcome.txt 52 è¦æ˜¾ç¤ºæš‚å­˜åŒºçš„ç›®å½•æ ‘ï¼Œå¯ä»¥ä½¿ç”¨git ls-fileså‘½ä»¤ã€‚ 123$ git ls-files -s100644 18832d35117ef2f013c4009f5b2128dfaeff354f 0 a/b/c/hello.txt100644 a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 0 welcome.txt è¿™ä¸ªè¾“å‡ºå’Œä¹‹å‰ä½¿ç”¨git ls-treeå‘½ä»¤çš„è¾“å‡ºä¸ä¸€æ ·ï¼Œå¦‚æœæƒ³è¦ä½¿ç”¨git ls-treeå‘½ä»¤ï¼Œéœ€è¦å…ˆå°†æš‚å­˜åŒºçš„ ç›®å½•æ ‘å†™å…¥Gitå¯¹è±¡åº“git write-treeå‘½ä»¤ï¼Œç„¶ååœ¨é’ˆå¯¹git write-treeå‘½ä»¤å†™å…¥çš„treeæ‰§è¡Œgit ls-treeã€‚ 12345$ git write-tree 1e9d611d50af21a2f0ec7bce6e270fd170a8f557$ git ls-tree -l 040000 tree 53583ee687fbb2e913d18d508aefd512465b2092 - a100644 blob a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 50 welcome.txt ä»ä¸Šé¢çš„å‘½ä»¤å¯ä»¥çœ‹å‡ºï¼š åˆ°å¤„éƒ½æ˜¯40ä½çš„SHA1å“ˆå¸Œå€¼æ ¼å¼çš„IDï¼Œå¯ä»¥ç”¨äºæŒ‡ä»£æ–‡ä»¶å†…å®¹ï¼ˆblobï¼‰ï¼Œç”¨äºæŒ‡ä»£ç›®å½•æ ‘(tree)ï¼Œè¿˜å¯ä»¥ç”¨äºæŒ‡ä»£æäº¤ã€‚ git write-treeçš„è¾“å‡ºå°±æ˜¯å†™å…¥Gitå¯¹è±¡åº“ä¸­çš„Tree IDï¼Œè¿™ä¸ªIDå°†ä½œä¸ºä¸‹ä¸€æ¡å‘½ä»¤çš„è¾“å…¥ã€‚ git ls-treeå‘½ä»¤ä¸­ï¼Œæ²¡æœ‰æŠŠ40ä½çš„IDå†™å…¨ï¼Œè€Œæ˜¯ä½¿ç”¨äº†å‰å‡ ä½ï¼Œå®é™…ä¸Šåªè¦ä¸å’Œå…¶ä»–çš„å¯¹è±¡IDå†²çªï¼Œå¯ä»¥éšå¿ƒæ‰€æ¬²çš„ä½¿ç”¨ç¼©å†™IDã€‚ git ls-treeçš„è¾“å‡ºæ˜¾ç¤ºçš„ç¬¬ä¸€æ¡æ˜¯ä¸€ä¸ªtreeå¯¹è±¡ï¼Œå³åˆšæ‰åˆ›å»ºçš„ä¸€çº§ç›®å½•aã€‚ å¦‚æœæƒ³è¦é€’å½’æ˜¾ç¤ºç›®å½•å†…å®¹ï¼Œåˆ™ä½¿ç”¨-rå‚æ•°è°ƒç”¨ã€‚ä½¿ç”¨å‚æ•°-tå¯ä»¥æŠŠé€’å½’è¿‡ç¨‹ä¸­é‡åˆ°çš„æ¯æ£µæ ‘éƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Œè€Œä¸æ˜¯åªæ˜¾ç¤ºæœ€ç»ˆçš„æ–‡ä»¶ã€‚ä¸‹é¢æ‰§è¡Œé€’å½’æ“ä½œæ˜¾ç¤ºç›®å½•æ ‘çš„å†…å®¹ã€‚ 123456$ git write-tree | xargs git ls-tree -l -r -t040000 tree 53583ee687fbb2e913d18d508aefd512465b2092 - a040000 tree 514d729095b7bc203cf336723af710d41b84867b - a/b040000 tree deaec688e84302d4a0b98a1b78a434be1b22ca02 - a/b/c100644 blob 18832d35117ef2f013c4009f5b2128dfaeff354f 7 a/b/c/hello.txt100644 blob a2b90cc2992cf3ff4e0d6beb0c9461158124c2b6 50 welcome.txt é€šè¿‡ä½¿ç”¨ä¸åŒçš„å‚æ•°è°ƒç”¨git diffå‘½ä»¤ï¼Œå¯ä»¥å¯¹å·¥ä½œåŒºã€æš‚å­˜åŒºã€HEADä¸­çš„å†…å®¹ä¸¤ä¸¤æ¯”è¾ƒã€‚ä¸‹é¢çš„å›¾å±•ç¤ºäº†git diffå‘½ä»¤çš„ä½œç”¨èŒƒå›´ã€‚ é€šè¿‡ä¸Šé¢çš„å›¾å°±ä¸éš¾ç†è§£ä¸‹é¢å‘½ä»¤çš„è¾“å‡ºã€‚ å·¥ä½œåŒºå’Œæš‚å­˜åŒºæ¯”è¾ƒã€‚ 1$ git diff æš‚å­˜åŒºå’ŒHEADæ¯”è¾ƒã€‚ 1$ git diff --cached å·¥ä½œåŒºå’ŒHEADæ¯”è¾ƒã€‚ 1$ git diff HEAD ä¸è¦ä½¿ç”¨git commit -a å®é™…ä¸ŠGitçš„æäº¤å‘½ä»¤git commitå¯ä»¥å¸¦ä¸Š-aå‚æ•°ï¼Œå¯¹æœ¬åœ°æ‰€æœ‰å˜æ›´çš„æ–‡ä»¶æ‰§è¡Œæäº¤æ“ä½œï¼ŒåŒ…æ‹¬æœ¬åœ°ä¿®æ”¹çš„æ–‡ä»¶ï¼Œåˆ é™¤çš„æ–‡ä»¶ï¼Œä½†ä¸åŒ…æ‹¬æœªè¢«ç‰ˆæœ¬åº“è·Ÿè¸ªçš„æ–‡ä»¶ã€‚ è¿™ä¸ªå‘½ä»¤çš„ç¡®å¯ä»¥ç®€åŒ–ä¸€äº›æ“ä½œï¼Œä½†åŒæ—¶ä¼šä¸¢æ‰Gitæš‚å­˜åŒºå¸¦ç»™ç”¨æˆ·æœ€å¤§çš„å¥½å¤„ï¼šå¯¹æäº¤å†…å®¹è¿›è¡Œæ§åˆ¶çš„èƒ½åŠ›ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~åˆå§‹åŒ–]]></title>
    <url>%2Fposts%2F7230a407.html</url>
    <content type="text"><![CDATA[åˆ›å»ºç‰ˆæœ¬åº“åŠç¬¬ä¸€æ¬¡æäº¤ é¦–å…ˆçœ‹ä¸€ä¸‹å½“å‰Gitçš„ç‰ˆæœ¬ 1$ git --version åœ¨å¼€å§‹Gitä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸‹Gitçš„ç¯å¢ƒå˜é‡ï¼Œè¿™ä¸ªè®¾ç½®æ˜¯ä¸€æ¬¡æ€§çš„å·¥ä½œã€‚å³è¿™äº›è®¾ç½®ä¼šåœ¨å…¨å±€æ–‡ä»¶ï¼ˆç”¨æˆ·ä¸»ç›®å½•çš„ .gitconfigï¼‰æˆ–ç³»ç»Ÿæ–‡ä»¶ï¼ˆ/etc/gitconfigï¼‰ä¸­åšæ°¸ä¹…è®°å½•ã€‚ å‘Šè¯‰Gitå½“å‰ç”¨æˆ·çš„å§“åå’Œé‚®ä»¶åœ°å€ï¼Œé…ç½®çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€å°†åœ¨ç‰ˆæœ¬åº“æäº¤æ—¶ä½œä¸ºæäº¤è€…çš„ç”¨æˆ·åå’Œé‚®ä»¶åœ°å€ã€‚ 12$ git config --global user.name "wanghongbo"$ git config --global user.email whb@163.com è®¾ç½®ä¸€äº›Gitåˆ«åï¼Œä»¥ä¾¿å¯ä»¥ä½¿ç”¨æ›´ä¸ºç®€æ´çš„å­å‘½ä»¤ã€‚ ä¾‹å¦‚ï¼šè¾“å…¥ git ci å³ç›¸å½“äº git commit -s ï¼Œè¾“å…¥git st å³ç›¸å½“äº git -p statusã€‚ å¦‚æœæ‹¥æœ‰ç³»ç»Ÿç®¡ç†å‘˜æƒé™ï¼Œå¸Œæœ›æ³¨å†Œçš„å‘½ä»¤åˆ«åèƒ½è¢«æ‰€æœ‰ç”¨æˆ·ä½¿ç”¨ï¼Œå¯æ‰§è¡Œå¦‚ä¸‹å‘½ä»¤ï¼š 1234$ git config --system alias.br branch$ git config --system alias.ci "commit -s"$ git config --system alias.co checkout$ git config --system alias.st "-p status" - å¦‚æœåªåœ¨æœ¬ç”¨æˆ·ä½¿ç”¨ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1234$ git config --global alias.st status$ git config --global alias.ci "commit -s"$ git config --global alias.co checkout$ git config --global alias.br branch åˆ›å»ºGitç‰ˆæœ¬åº“ ä¸‹é¢å°±ä»ä¸€ä¸ªç©ºç›®å½•å¼€å§‹åˆå§‹åŒ–ç‰ˆæœ¬åº“ï¼Œè¿™ä¸ªç‰ˆæœ¬åº“å‘½åä¸ºâ€œgit-demoâ€ã€‚é¦–å…ˆå»ºç«‹ä¸€ä¸ªæ–°çš„å·¥ä½œç›®å½•ï¼Œè¿›å…¥è¯¥ç›®å½•åï¼Œæ‰§è¡Œgit initåˆ›å»ºç‰ˆæœ¬åº“ 12345$ cd /d/workspace$ mkdir git-demo$ cd git-demo$ git initInitialized empty Git repository in D:/workspace/git-demo/.git/ ä»ä¸Šé¢ç‰ˆæœ¬åº“åˆå§‹åŒ–åçš„è¾“å‡ºä¸­ï¼Œå¯ä»¥çœ‹åˆ°æ‰§è¡Œgit initå‘½ä»¤åœ¨å·¥ä½œåŒºåˆ›å»ºäº†éšè—ç›®å½•.gitã€‚ 12$ ls -aF./ ../ .git/ è¿™ä¸ªéšè—çš„.gitç›®å½•å°±æ˜¯Gitç‰ˆæœ¬åº“ï¼ˆåˆå«ä»“åº“ï¼Œrepositoryï¼‰ã€‚.gitç‰ˆæœ¬åº“ç›®å½•æ‰€åœ¨çš„ç›®å½•ï¼Œå³/d/workspace/git-demoç›®å½•ç§°ä¸ºå·¥ä½œåŒºï¼Œç›®å‰å·¥ä½œåŒºé™¤äº†åŒ…å«ä¸€ä¸ªéšè—çš„.gitç›®å½•å¤–ç©ºæ— ä¸€ç‰©ã€‚ ä¸‹é¢åœ¨å·¥ä½œåŒºä¸­åˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼šwelcome.txtï¼Œå†…å®¹å°±æ˜¯ä¸€è¡Œâ€œHello Git.â€ã€‚ 1$ echo "Hello Git." &gt;&gt; welcome.txt ä¸ºäº†å°†è¿™ä¸ªæ–°å»ºç«‹çš„æ–‡ä»¶æ·»åŠ åˆ°ç‰ˆæœ¬åº“ï¼Œéœ€è¦æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1$ git add welcome.txt Gitå’Œå¤§éƒ¨åˆ†å…¶ä»–ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿéƒ½éœ€è¦å†æ‰§è¡Œä¸€ä¸ªæäº¤æ“ä½œï¼Œå¯¹äºGitæ‰§è¡Œgit commitå‘½ä»¤å®Œæˆæäº¤ã€‚åœ¨æäº¤è¿‡ç¨‹ä¸­éœ€è¦è¾“å…¥æäº¤è¯´æ˜ï¼Œè¿™ä¸ªè¦æ±‚å¯¹Gitæ˜¯å¼ºåˆ¶æ€§çš„ï¼Œä¸åƒCVSã€SVNç­‰å…è®¸ç©ºç™½çš„æäº¤è¯´æ˜ã€‚ åœ¨Gitæäº¤æ—¶ï¼Œå¦‚æœåœ¨å‘½ä»¤è¡Œä¸æä¾›æäº¤è¯´æ˜ï¼ˆæ²¡æœ‰ä½¿ç”¨ -m å‚æ•°ï¼‰ï¼ŒGitä¼šè‡ªåŠ¨æ‰“å¼€ä¸€ä¸ªç¼–è¾‘å™¨ï¼Œè¦æ±‚æ‚¨åœ¨å…¶ä¸­è¾“å…¥æäº¤è¯´æ˜ï¼Œè¾“å…¥å®Œæ¯•ä¿å­˜é€€å‡ºã€‚ ä¸‹é¢è¿›è¡Œæäº¤ï¼Œä¸ºäº†è¯´æ˜æ–¹ä¾¿ï¼Œä½¿ç”¨ -m å‚æ•°ç›´æ¥ç»™å‡ºæäº¤è¯´æ˜ã€‚ 1$ git commit -m "åˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤" ä»ä¸Šé¢çš„å‘½ä»¤åŠè¾“å‡ºå¯ä»¥çœ‹å‡ºï¼š é€šè¿‡-må‚æ•°è®¾ç½®æäº¤è¯´æ˜ä¸ºï¼šâ€œåˆå§‹åŒ–çš„ç¬¬ä¸€æ¬¡æäº¤â€ã€‚è¯¥æäº¤è¯´æ˜ä¹Ÿæ˜¾ç¤ºåœ¨å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€è¡Œä¸­ã€‚ å‘½ä»¤è¾“å‡ºçš„ç¬¬ä¸€è¡Œè¿˜æ˜¾ç¤ºäº†å½“å‰å¤„äºåä¸ºmasterçš„åˆ†æ”¯ä¸Šï¼Œæäº¤IDä¸ºe55c54cï¼Œä¸”è¯¥æäº¤æ˜¯è¯¥åˆ†æ”¯çš„ç¬¬ä¸€ä¸ªæäº¤ï¼Œå³æ ¹æäº¤ï¼ˆroot-commitï¼‰ã€‚æ ¹æäº¤å’Œå…¶ä»–æäº¤çš„åŒºåˆ«åœ¨äºæ²¡æœ‰å…³è”çš„çˆ¶æäº¤ã€‚ å‘½ä»¤è¾“å‡ºçš„ç¬¬äºŒè¡Œå¼€å§‹æ˜¾ç¤ºæœ¬æ¬¡æäº¤æ‰€åšä¿®æ”¹çš„ç»Ÿè®¡ï¼šä¿®æ”¹äº†ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«ä¸€è¡Œçš„æ’å…¥ã€‚ æ€è€ƒï¼šGitå·¥ä½œåŒºä¸‹ä¸ºä»€ä¹ˆæœ‰ä¸ª.gitç›®å½•ï¼Ÿ GitåŠå…¶ä»–åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„ä¸€ä¸ªæ˜¾è‘—ç‰¹ç‚¹ï¼šç‰ˆæœ¬åº“ä½äºå·¥ä½œåŒºçš„æ ¹ç›®å½•ä¸‹ã€‚å¯¹äºGitï¼Œç‰ˆæœ¬åº“ä½äºå·¥ä½œåŒºæ ¹ç›®å½•ä¸‹çš„.gitç›®å½•ä¸­ï¼Œä¸”ä»…æ­¤ä¸€å¤„ï¼Œåœ¨å·¥ä½œåŒºçš„å­ç›®å½•ä¸‹åˆ™æ²¡æœ‰ä»»ä½•å…¶ä»–è·Ÿè¸ªæ–‡ä»¶æˆ–ç›®å½•ã€‚Gitä¸ºä»€ä¹ˆè¦è¿™æ ·è®¾è®¡å‘¢ï¼Ÿ å¯¹äºCVSï¼Œå·¥ä½œåŒºçš„æ ¹ç›®å½•åŠæ¯ä¸ªå­ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ªCVSç›®å½•ï¼Œè¯¥ç›®å½•ä¸­åŒ…å«å‡ ä¸ªé…ç½®æ–‡ä»¶ï¼Œå»ºç«‹äº†å¯¹ç‰ˆæœ¬åº“çš„è¿½è¸ªã€‚ å¦‚CVSç›®å½•ä¸‹çš„Entriesæ–‡ä»¶è®°å½•äº†ä»ç‰ˆæœ¬åº“æ£€å‡ºåˆ°å·¥ä½œåŒºçš„æ–‡ä»¶çš„åç§°ã€ç‰ˆæœ¬å’Œæ—¶é—´æˆ³ç­‰ï¼Œè¿™æ ·å°±å¯ä»¥é€šè¿‡å¯¹ å·¥ä½œåŒºæ–‡ä»¶æ—¶é—´æˆ³çš„æ”¹å˜æ¥åˆ¤æ–­æ–‡ä»¶æ˜¯å¦æ›´æ”¹ã€‚è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œå¯ä»¥å°†å·¥ä½œåŒºç§»åŠ¨åˆ°ä»»ä½•å…¶ä»–ç›®å½•ï¼Œå·¥ä½œåŒºå’Œç‰ˆæœ¬ æ§åˆ¶æœåŠ¡å™¨çš„æ˜ å°„å…³ç³»ä¿æŒä¸å˜ï¼Œè¿™æ ·å·¥ä½œåŒºä¾ç„¶èƒ½æ­£å¸¸å·¥ä½œã€‚ç”šè‡³è¿˜å°†å·¥ä½œåŒºçš„æŸä¸ªå­ç›®å½•ç§»åŠ¨åˆ°å…¶ä»–ä½ç½®ï¼Œå½¢æˆ æ–°çš„å·¥ä½œåŒºï¼Œåœ¨æ–°çš„å·¥ä½œåŒºä»ç„¶èƒ½å®Œæˆç‰ˆæœ¬æ§åˆ¶ç›¸å…³çš„æ“ä½œã€‚ä½†ç¼ºç‚¹ä¹Ÿå¾ˆå¤šï¼Œä¾‹å¦‚å·¥ä½œåŒºæ–‡ä»¶ä¿®æ”¹äº†ï¼Œå› ä¸ºæ²¡æœ‰ åŸå§‹æ–‡ä»¶åšæ¯”å¯¹ï¼Œå› æ­¤å‘æœåŠ¡å™¨æäº¤ä¿®æ”¹çš„æ—¶å€™åªèƒ½å¯¹æ•´ä¸ªæ–‡ä»¶è¿›è¡Œä¼ è¾“è€Œä¸èƒ½ä»…ä¼ è¾“æ–‡ä»¶çš„æ”¹åŠ¨éƒ¨åˆ†ã€‚è¿˜æœ‰ ä¸€ä¸ªé£é™©å°±æ˜¯ä¿¡æ¯æ³„éœ²ï¼Œé€šè¿‡æ‰«æCVS/Entriesæ–‡ä»¶å°±èƒ½å¾—åˆ°ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ—è¡¨ï¼Œé€ æˆä¿¡æ¯æ³„éœ²ã€‚ å¯¹äºSVNï¼Œå·¥ä½œåŒºçš„æ ¹ç›®å½•å’Œæ¯ä¸€ä¸ªå­ç›®å½•ä¸‹éƒ½æœ‰ä¸€ä¸ª.svnç›®å½•ï¼Œè¯¥ç›®å½•ä¸ä»…åŒ…å«äº†ç±»ä¼¼CVSçš„è·Ÿè¸ªç›®å½•ä¸‹çš„ é…ç½®æ–‡ä»¶ï¼Œè¿˜åŒ…å«äº†å½“å‰å·¥ä½œåŒºä¸‹æ¯ä¸€ä¸ªæ–‡ä»¶çš„æ‹·è´ã€‚å¤šå‡ºæ–‡ä»¶çš„åŸå§‹æ‹·è´è®©æŸäº›svnå‘½ä»¤å¯ä»¥è„±ç¦»ç‰ˆæœ¬åº“æ‰§è¡Œï¼Œ è¿˜å¯ä»¥åœ¨ç”±å®¢æˆ·ç«¯å‘æœåŠ¡å™¨æäº¤æ—¶ï¼Œä»…ä»…å¯¹æ–‡ä»¶æ”¹åŠ¨çš„å†…å®¹æäº¤ï¼Œå› æ­¤æ”¹åŠ¨çš„æ–‡ä»¶å¯ä»¥å’ŒåŸå§‹æ‹·è´è¿›è¡Œå·®å¼‚æ¯”è¾ƒã€‚ ç¼ºç‚¹é™¤äº†åƒCVSè·Ÿè¸ªç›®å½•é€ æˆä¿¡æ¯æ³„éœ²ï¼Œè¿˜å¯¼è‡´åŠ å€å ç”¨å·¥ä½œåŒºçš„ç©ºé—´ã€‚å†æœ‰å°±æ˜¯å½“åœ¨å·¥ä½œåŒºç›®å½•ä¸‹é’ˆå¯¹æ–‡ä»¶å†…å®¹ è¿›è¡Œæœç´¢æ—¶ï¼Œä¼šå› ä¸º.svnç›®å½•ä¸‹æ–‡ä»¶çš„åŸå§‹æ‹·è´ï¼Œå¯¼è‡´æœç´¢çš„ç»“æœåŠ å€ï¼Œè€Œå‡ºç°æ··ä¹±çš„æœç´¢ç»“æœã€‚ Gitçš„è®¾è®¡ï¼Œå°†ç‰ˆæœ¬åº“æ”¾åœ¨å·¥ä½œåŒºæ ¹ç›®å½•ä¸‹ï¼Œæ‰€æœ‰çš„ç‰ˆæœ¬æ§åˆ¶æ“ä½œï¼ˆé™¤äº†å’Œè¿œç¨‹ç‰ˆæœ¬åº“ä¹‹é—´çš„ç›¸äº’æ“ä½œï¼‰éƒ½æ˜¯åœ¨ æœ¬åœ°å³å¯å®Œæˆï¼Œä¸å‘SVNåªæœ‰å¯¥å¯¥å‡ ä¸ªå‘½ä»¤æ‰èƒ½è„±ç¦»ç½‘ç»œæ‰§è¡Œã€‚è€Œä¸”Gitä¹Ÿä¸å­˜åœ¨å®‰å…¨æ³„éœ²ï¼ˆåªè¦ä¿æŠ¤å¥½.gitç›®å½•ï¼‰ï¼Œ ä¹Ÿæ²¡æœ‰SVNæœ¬åœ°æ–‡ä»¶æœç´¢ç»“æœæ··ä¹±çš„é—®é¢˜ï¼ŒGitç”šè‡³è¿˜æä¾›äº†ä¸€æ¡git grepå‘½ä»¤æ¥æ›´å¥½åœ°æœç´¢å·¥ä½œåŒºçš„æ–‡ä»¶å†…å®¹ã€‚ 1$ git grep "Hello" å½“å·¥ä½œåŒºä¸­åŒ…å«å­ç›®å½•ï¼Œåœ¨å­ç›®å½•ä¸­æ‰§è¡ŒGitå‘½ä»¤æ—¶ï¼Œå¦‚ä½•å®šä½ç‰ˆæœ¬åº“ï¼Ÿ å®é™…ä¸Šï¼ŒGitå·¥ä½œåŒºç›®å½•ä¸‹æ‰§è¡Œæ“ä½œæ—¶ï¼Œä¼šå¯¹ç›®å½•ä¾æ¬¡å‘ä¸Šé€’å½’æŸ¥æ‰¾.gitç›®å½•ï¼Œæ‰¾åˆ°.gitç›®å½•å°±æ˜¯å·¥ä½œåŒºå¯¹åº”çš„ç‰ˆæœ¬åº“ï¼Œ.gitæ‰€åœ¨çš„ç›®å½•å°±æ˜¯å·¥ä½œåŒºçš„æ ¹ç›®å½•ï¼Œæ–‡ä»¶.git/indexè®°å½•äº†å·¥ä½œåŒºæ–‡ä»¶çš„çŠ¶æ€ï¼ˆå®é™…ä¸Šæ˜¯æš‚å­˜åŒºçš„çŠ¶æ€ï¼‰ã€‚ ä¾‹å¦‚ï¼Œåœ¨éGitå·¥ä½œåŒºæ‰§è¡Œgitå‘½ä»¤ï¼Œä¼šå› æ‰¾ä¸åˆ°.gitç›®å½•è€ŒæŠ¥é”™ã€‚ 12$ cd /d/workspace/webstrom$ git status æ€æ ·è·å–Gitç‰ˆæœ¬åº“çš„ä½ç½®ä»¥åŠå·¥ä½œåŒºæ ¹ç›®å½•ä½ç½®ï¼Ÿ å…ˆåœ¨å·¥ä½œåŒºä¸‹å»ºç«‹ç›®å½•a/b/cï¼Œè¿›å…¥è¯¥ç›®å½•ä¸­ã€‚ 12$ mkdir -p a/b/c`$ cd a/b/c æ˜¾ç¤ºç‰ˆæœ¬åº“.gitç›®å½•æ‰€åœ¨çš„ä½ç½®ã€‚ 12$ git rev-parse --git-dirD:/workspace/git-demo/.git æ˜¾ç¤ºå·¥ä½œåŒºæ ¹ç›®å½• 12$ git rev-parse --show-toplevelD:/workspace/git-demo ç›¸å¯¹äºå·¥ä½œåŒºæ ¹ç›®å½•çš„ç›¸å¯¹ç›®å½• 12$ git rev-parse --show-prefixa/b/c æ˜¾ç¤ºä»å½“å‰ç›®å½•ï¼ˆcdï¼‰åé€€ï¼ˆupï¼‰åˆ°å·¥ä½œåŒºçš„æ ¹çš„æ·±åº¦ã€‚ 12$ git rev-parse --show-cdup../../../ æ€è€ƒï¼šgit config å‘½ä»¤å‚æ•°çš„åŒºåˆ«ï¼Ÿ åœ¨ä¹‹å‰ä½¿ç”¨è¿‡çš„git configå‘½ä»¤ï¼Œæœ‰çš„ä½¿ç”¨äº†--globalå‚æ•°ï¼Œæœ‰çš„ä½¿ç”¨äº†--systemå‚æ•°ï¼Œè¿™ä¸¤ä¸ªå‚æ•°æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€D:/workspace/git-demo/.git/configæ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 12$ cd /d/workspace/git-demo/$ git config -e æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€C:/Users/ASUS/.gitconfigï¼ˆç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„.gitconfigæ–‡ä»¶ï¼‰å…¨å±€é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 1$ git config -e --global æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æ‰“å¼€E:/developerTools/git/mingw64/etc/gitconfigç³»ç»Ÿçº§é…ç½®æ–‡ä»¶è¿›è¡Œç¼–è¾‘ã€‚ 1$ git config -e --system Gitçš„ä¸‰ä¸ªé…ç½®æ–‡ä»¶åˆ†åˆ«æ˜¯ç‰ˆæœ¬åº“çº§åˆ«çš„é…ç½®ã€å…¨å±€é…ç½®ï¼ˆç”¨æˆ·ä¸»ç›®å½•ä¸‹ï¼‰å’Œç³»ç»Ÿçº§é…ç½®ï¼ˆGitå®‰è£…ç›®å½•ä¸‹ï¼‰ã€‚ å…¶ä¸­ç‰ˆæœ¬åº“çº§åˆ«é…ç½®æ–‡ä»¶çš„ä¼˜å…ˆçº§æœ€é«˜ï¼Œå…¨å±€é…ç½®æ–‡ä»¶æ¬¡ä¹‹ï¼Œç³»ç»Ÿçº§é…ç½®æ–‡ä»¶ä¼˜å…ˆçº§æœ€ä½ã€‚è¿™æ ·çš„ä¼˜å…ˆçº§è®¾ç½® å¯ä»¥è®©ç‰ˆæœ¬åº“.gitç›®å½•ä¸‹çš„configæ–‡ä»¶ä¸­çš„é…ç½®å¯ä»¥è¦†ç›–ç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„Gitç¯å¢ƒé…ç½®ï¼Œè€Œç”¨æˆ·ä¸»ç›®å½•ä¸‹çš„é…ç½®ä¹Ÿå¯ä»¥è¦†ç›–ç³»ç»Ÿçš„Gité…ç½®æ–‡ä»¶ã€‚ æ‰§è¡Œä¹‹å‰çš„ä¸‰ä¸ªgit configå‘½ä»¤ï¼Œä¼šçœ‹åˆ°è¿™ä¸‰ä¸ªçº§åˆ«é…ç½®æ–‡ä»¶çš„æ ¼å¼å’Œå†…å®¹ï¼Œé‡‡ç”¨INIæ–‡ä»¶æ ¼å¼ã€‚å¦‚ä¸‹ï¼š 12345678$ cat /d/workspace/git-demo/.git/config[core] repositoryformatversion = 0 filemode = false bare = false logallrefupdates = true symlinks = false ignorecase = true git configå‘½ä»¤å¯ä»¥ç”¨æ¥è¯»å–å’Œæ›´æ”¹INIé…ç½®æ–‡ä»¶çš„å†…å®¹ã€‚ä½¿ç”¨git config &lt;section&gt;.&lt;key&gt;ï¼Œæ¥è¯»å–INIé…ç½®æ–‡ä»¶ä¸­æŸä¸ªé…ç½®çš„é”®å€¼ã€‚ä¾‹å¦‚è¯»å–[core]å°èŠ‚çš„bareçš„å±æ€§å€¼ï¼Œå‘½ä»¤å¦‚ä¸‹ï¼š 12$ git config core.barefalse å¦‚æœæƒ³è¦æ›´æ”¹æˆ–é…ç½®INIæ–‡ä»¶ä¸­æŸä¸ªå±æ€§çš„å€¼ä¹Ÿå¾ˆç®€å•ï¼Œå‘½ä»¤æ ¼å¼ï¼šgit config &lt;section&gt;.&lt;key&gt; &lt;value&gt;ã€‚ 12$ git config a.b learningGit$ git config x.y.z something æ‰“å¼€.git/configæ–‡ä»¶ä¼šçœ‹åˆ°å¢åŠ çš„å†…å®¹ï¼š 1234[a] b = learningGit[x "y"] z = something æ€è€ƒï¼šæ˜¯è°æäº¤çš„ï¼Ÿ åœ¨ä¸€å¼€å§‹æˆ‘ä»¬ä¸ºGitè®¾ç½®äº†user.nameå’Œuser.emailå…¨å±€ç¯å¢ƒå˜é‡ï¼Œå¦‚æœä¸è®¾ç½®ä¼šæ€æ ·ï¼Ÿæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œåˆ é™¤Gitå…¨å±€é…ç½®æ–‡ä»¶ä¸­å…³äºuser.nameå’Œuser.emailçš„è®¾ç½®ï¼š 12$ git config --unset --global user.name$ git config --unset --global user.email è¿™æ ·å…³äºç”¨æˆ·åå’Œé‚®ä»¶çš„è®¾ç½®éƒ½è¢«æ¸…ç©ºäº†ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤å°†çœ‹ä¸åˆ°è¾“å‡º 12$ git config user.name$ git config user.email ä¸‹é¢å†è¿›è¡Œä¸€æ¬¡æäº¤ï¼Œçœ‹çœ‹æäº¤è¿‡ç¨‹æœ‰ä»€ä¹ˆä¸åŒï¼Œä»¥åŠæäº¤ä¹‹åæ˜¾ç¤ºçš„æäº¤è€…æ˜¯è°ï¼Ÿ 1$ git commit --allow-empty -m "è¿™æ˜¯è°æäº¤çš„ï¼Ÿ" ä¸Šé¢çš„å‘½ä»¤ä½¿ç”¨äº†--allow-emptyå‚æ•°ï¼Œè¿™æ˜¯å› ä¸ºæ²¡æœ‰å¯¹å·¥ä½œåŒºçš„æ–‡ä»¶è¿›è¡Œä»»ä½•ä¿®æ”¹ï¼ŒGité»˜è®¤æ˜¯ä¸ä¼šæ‰§è¡Œæäº¤ï¼Œä½¿ç”¨äº†--allow-emptyå‚æ•°åï¼Œå…è®¸æ‰§è¡Œç©ºç™½æäº¤ã€‚ ä»æäº¤ç»“æœçœ‹åˆ°ï¼Œå› ä¸ºæ²¡æœ‰è®¾ç½®user.nameå’Œuser.emailï¼Œæäº¤ç»“æœä¸­Gitæä¾›äº†è¯¦ç»†çš„å¸®åŠ©æŒ‡å¼•æ¥å‘Šè¯‰å¦‚ä½•è®¾ç½®å¿…é¡»çš„å˜é‡ï¼Œä»¥åŠå¦‚ä½•ä¿®æ”¹ä¹‹å‰æäº¤ä¸­å‡ºç°çš„é”™è¯¯çš„æäº¤è€…ä¿¡æ¯ã€‚ ä¸ºäº†ä¿è¯æäº¤æ—¶æäº¤è€…å’Œä½œè€…ä¿¡æ¯çš„æ­£ç¡®æ€§ï¼Œé‡æ–°æ¢å¤user.nameå’Œuser.emailçš„è®¾ç½®ã€‚ 12$ git config --global user.name "wanghongbo"$ git config --global user.email youreamil@email.com ç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé‡æ–°ä¿®æ”¹æœ€æ–°çš„æäº¤ï¼Œä¿®æ­£æäº¤è€…çš„é”™è¯¯ä¿¡æ¯ã€‚ 1$ git commit --amend --allow-empty --reset-author è¯´æ˜ï¼š å‚æ•°--amendæ˜¯å¯¹åˆšåˆšçš„æäº¤è¿›è¡Œä¿®è¡¥ï¼Œè¿™æ ·å°±å¯ä»¥æ”¹æ­£ä¹‹å‰é”™è¯¯çš„æäº¤ï¼Œè€Œä¸ä¼šäº§ç”Ÿæ–°çš„æäº¤ï¼› å‚æ•°--allow-emptyæ˜¯å› ä¸ºè¦è¿›è¡Œä¿®æ”¹çš„æäº¤å®é™…ä¸Šæ˜¯ä¸€ä¸ªç©ºç™½æäº¤ï¼ŒGité»˜è®¤ä¸å…è®¸ç©ºç™½æäº¤ï¼› å‚æ•°--reset-authorçš„å«ä¹‰æ˜¯å°†æäº¤è€…çš„IDé‡ç½®ï¼Œå¦åˆ™ä¼šå½±å“æœ€æ–°çš„Commitçš„IDã€‚è¿™æ¡å‘½ä»¤ä¹Ÿä¼šé‡ç½®AuthorDateçš„ä¿¡æ¯ã€‚ é€šè¿‡æ—¥å¿—å¯ä»¥çœ‹åˆ°æäº¤è€…çš„ä¿¡æ¯å·²ç»æ”¹æ­£äº†ã€‚ 1$ git log --pretty=fuller document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~æ£€å‡º]]></title>
    <url>%2Fposts%2Fb27802af.html</url>
    <content type="text"><![CDATA[HEADçš„é‡ç½®å³æ£€å‡º HEADå¯ä»¥ç†è§£ä¸ºâ€œå¤´æŒ‡é’ˆâ€ï¼Œæ˜¯å½“å‰å·¥ä½œåŒºçš„â€œåŸºç¡€ç‰ˆæœ¬â€ï¼Œå½“æ‰§è¡Œæäº¤æ—¶ï¼ŒHEADæŒ‡å‘çš„æäº¤ä½œä¸ºæ–°æäº¤çš„çˆ¶æäº¤ã€‚çœ‹çœ‹å½“å‰HEADçš„æŒ‡å‘ã€‚ 1$ cat .git/HEAD å¯ä»¥çœ‹å‡ºHEADæŒ‡å‘äº†åˆ†æ”¯masterï¼Œæ­¤æ—¶æ‰§è¡Œgit branchä¼šçœ‹åˆ°å½“å‰å¤„äºmasteråˆ†æ”¯ã€‚ 1$ git branch -v ç°åœ¨ä½¿ç”¨git checkoutå‘½ä»¤æ£€å‡ºè¯¥IDçš„çˆ¶æäº¤ï¼Œçœ‹çœ‹ä¼šæ€ä¹ˆæ ·ã€‚ 1$ git checkout 23995a2 ç¿»è¯‘ä¸€ä¸‹ä¸Šé¢çš„è¾“å‡ºç»“æœï¼š 12345678910$ git checkout 23995a2æ³¨æ„ï¼šæ­£åœ¨æ£€å‡º '23995a2'.æ‚¨ç°åœ¨å¤„äº'åˆ†ç¦»å¤´æŒ‡é’ˆ'çŠ¶æ€ï¼Œæ‚¨å¯ä»¥æ£€æŸ¥ã€æµ‹è¯•å’Œæäº¤ï¼Œè€Œä¸å½±å“ä»»ä½•åˆ†æ”¯ã€‚é€šè¿‡æ‰§è¡Œå¦å¤–çš„ä¸€ä¸ª checkout æ£€å‡ºæŒ‡ä»¤ä¼šä¸¢å¼ƒåœ¨æ­¤çŠ¶æ€ä¸‹çš„ä¿®æ”¹å’Œæäº¤ã€‚å¦‚æœæƒ³ä¿ç•™åœ¨æ­¤çŠ¶æ€ä¸‹çš„ä¿®æ”¹å’Œæäº¤ï¼Œä½¿ç”¨ -b å‚æ•°è°ƒç”¨ checkout æ£€å‡ºæŒ‡ä»¤ä»¥åˆ›å»ºæ–°çš„è·Ÿè¸ªåˆ†æ”¯ã€‚å¦‚ï¼š git checkout -b new_branch_name å¤´æŒ‡é’ˆç°åœ¨æŒ‡å‘ 23995a2... æäº¤è¯´æ˜ä¸ºï¼šdoes master follow this new commit? ä»€ä¹ˆå«åšâ€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ï¼ŸæŸ¥çœ‹ä¸€ä¸‹æ­¤æ—¶çš„HEADçš„å†…å®¹å°±æ˜ç™½äº†ã€‚ 12$ cat .git/HEAD23995a2d61d0a2667ba0db8aa4a17b127c1977d1 åŸæ¥â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€æŒ‡çš„å°±æ˜¯HEADå¤´æŒ‡é’ˆæŒ‡å‘äº†ä¸€ä¸ªå…·ä½“çš„æäº¤IDï¼Œè€Œä¸æ˜¯ä¸€ä¸ªå¼•ç”¨ï¼ˆåˆ†æ”¯ï¼‰ã€‚ æŸ¥çœ‹æœ€æ–°æäº¤çš„reflogä¹Ÿå¯ä»¥çœ‹åˆ°å½“é’ˆå¯¹æäº¤æ‰§è¡Œgit checkoutå‘½ä»¤æ—¶ï¼ŒHEADå¤´æŒ‡é’ˆå°±è¢«æ›´æ”¹äº†ï¼šç”±æŒ‡å‘masteråˆ†æ”¯å˜æˆäº†æŒ‡å‘ä¸€ä¸ªæäº¤IDã€‚ 12$ git reflog -l23995a2 (HEAD, master) HEAD@{0}: checkout: moving from master to 23995a2 æ³¨æ„ä¸Šé¢çš„reflogæ˜¯HEADå¤´æŒ‡é’ˆçš„å˜è¿è®°å½•ï¼Œè€Œémasteråˆ†æ”¯ã€‚ æŸ¥çœ‹ä¸€ä¸‹HEADå’Œmasterå¯¹åº”çš„æäº¤IDï¼Œä¼šå‘ç°ç°åœ¨å®ƒä»¬æŒ‡å‘çš„ä¸ä¸€æ ·ã€‚ 1$ git rev-parse HEAD master å‰ä¸€ä¸ªæ˜¯HEADå¤´æŒ‡é’ˆçš„æŒ‡å‘ï¼Œåä¸€ä¸ªæ˜¯masteråˆ†æ”¯çš„æŒ‡å‘ã€‚è€Œä¸”è¿˜å¯ä»¥çœ‹åˆ°æ‰§è¡Œgit checkoutå‘½ä»¤ä¸æ‰§è¡Œgit resetå‘½ä»¤ä¸åŒï¼Œåˆ†æ”¯(master)çš„æŒ‡å‘å¹¶æ²¡æœ‰æ”¹å˜ï¼Œä»æ—§æŒ‡å‘åŸæœ‰çš„æäº¤IDã€‚ ç°åœ¨ç‰ˆæœ¬åº“çš„HEADæ˜¯æŒ‡å‘23995aæäº¤çš„ï¼Œå†åšä¸€æ¬¡æäº¤ï¼ŒHEADä¼šå¦‚ä½•å˜åŒ–ï¼Ÿ å…ˆåšä¸€æ¬¡ä¿®æ”¹ï¼šåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶detached-commit.txtï¼Œæ·»åŠ åˆ°æš‚å­˜åŒºä¸­ã€‚ 12$ touch detached-commit.txt $ git add detached-commit.txt çœ‹ä¸€ä¸‹çŠ¶æ€ï¼Œä¼šå‘ç°å…¶ä¸­æœ‰â€œå½“å‰ä¸å¤„äºä»»ä½•åˆ†æ”¯â€çš„å­—æ ·ï¼Œæ˜¾ç„¶è¿™æ˜¯å› ä¸ºHEADå¤„äºâ€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€æ¨¡å¼ã€‚ 1$ git status æ‰§è¡Œæäº¤ã€‚åœ¨æäº¤è¾“å‡ºä¸­ä¹Ÿä¼šå‡ºç°[detached HEAD...]çš„æ ‡è¯†ï¼Œè¿™ä¹Ÿæ˜¯å¯¹ç”¨æˆ·çš„è­¦ç¤ºã€‚ 1$ git commit -m "commit in detached HEAD mode" æ­¤æ—¶å¤´æŒ‡é’ˆæŒ‡å‘äº†æ–°çš„æäº¤ã€‚ 12$ cat .git/HEAD1fe77f7b9993cd79b050826df1c73715cc1d1e45 å†æŸ¥çœ‹ä¸€ä¸‹æ—¥å¿—ä¼šå‘ç°æ–°çš„æäº¤æ˜¯å»ºç«‹åœ¨ä¹‹å‰çš„æäº¤åŸºç¡€ä¸Šçš„ã€‚ 1$ git log --graph --oneline è®°ä¸‹æ–°çš„æäº¤ID(1fe77f7b9993cd79b050826df1c73715cc1d1e45)ï¼Œç„¶åä»¥masteråˆ†æ”¯åä½œä¸ºå‚æ•°æ‰§è¡Œgit checkoutå‘½ä»¤ï¼Œä¼šåˆ‡æ¢åˆ°masteråˆ†æ”¯ä¸Šã€‚ åˆ‡æ¢åˆ°masteråˆ†æ”¯ä¸Šï¼Œå†æ²¡æœ‰ä¹‹å‰å¤§æ®µçš„æ–‡å­—è­¦å‘Šã€‚ 1$ git checkout master å› ä¸ºHEADå¤´æŒ‡é’ˆé‡æ–°æŒ‡å‘äº†åˆ†æ”¯ï¼Œè€Œä¸æ˜¯å¤„äºâ€œåˆ†ç¦»å¤´æŒ‡é’ˆæ¨¡å¼â€ã€‚ 1$ cat .git/HEAD åˆ‡æ¢ä¹‹åï¼Œä¹‹å‰æœ¬åœ°å»ºç«‹çš„detached-commit.txtæ–‡ä»¶ä¸è§äº†ã€‚ 12$ lsnew-commit.txt welcome.txt åˆ‡æ¢ä¹‹åï¼Œåˆšæ‰çš„æäº¤æ—¥å¿—ä¹Ÿä¸è§äº†ã€‚ 1$ git log --graph --oneline åˆšæ‰çš„æäº¤è¿˜å­˜åœ¨äºç‰ˆæœ¬åº“çš„å¯¹è±¡åº“ä¸­å—ï¼Ÿçœ‹çœ‹åˆšæ‰è®°ä¸‹çš„æäº¤IDã€‚ 1$ git show 1fe77 å¯ä»¥çœ‹å‡ºè¿™ä¸ªæäº¤ç°åœ¨ä»åœ¨ç‰ˆæœ¬åº“ä¸­ã€‚ç”±äºè¿™ä¸ªæäº¤æ²¡æœ‰è¢«ä»»ä½•åˆ†æ”¯è·Ÿè¸ªåˆ°ï¼Œå› æ­¤ä¸èƒ½ä¿è¯è¿™ä¸ªæäº¤ä¼šæ°¸ä¹…å­˜åœ¨ã€‚å®é™…ä¸Šå½“reflogä¸­å«æœ‰è¯¥æäº¤çš„æ—¥å¿—è¿‡æœŸåï¼Œè¿™ä¸ªæäº¤éšæ—¶éƒ½ä¼šä»ç‰ˆæœ¬åº“ä¸­å½»åº•æ¸…é™¤ã€‚ æŒ½æ•‘åˆ†ç¦»å¤´æŒ‡é’ˆ åœ¨â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€æ¨¡å¼ä¸‹è¿›è¡Œçš„æµ‹è¯•æäº¤é™¤äº†ä½¿ç”¨IDï¼ˆ1fe77ï¼‰è®¿é—®ä¹‹å¤–ï¼Œä¸èƒ½é€šè¿‡masteråˆ†æ”¯æˆ–å…¶ä»–å¼•ç”¨è®¿é—®åˆ°ã€‚å¦‚æœè¿™ä¸ªæäº¤æ˜¯masteråˆ†æ”¯æ‰€éœ€çš„ï¼Œé‚£ä¹ˆè¯¥å¦‚ä½•å¤„ç†ï¼Ÿ å¦‚æœä½¿ç”¨git resetï¼Œçš„ç¡®å¯ä»¥å°†masteråˆ†æ”¯é‡ç½®åˆ°è¯¥æµ‹è¯•æäº¤çš„1fe77ï¼Œä½†è¿™å°±ä¼šä¸¢æ‰masteråˆ†æ”¯åŸå…ˆçš„æäº¤23995a2ã€‚ä½¿ç”¨åˆå¹¶æ“ä½œgit mergeå¯ä»¥å®ç°ä¸¤è€…çš„å…¼é¡¾ã€‚ ä¸‹é¢çš„æ“ä½œä¼šå°†æäº¤1fe77åˆå¹¶åˆ°masteråˆ†æ”¯ä¸­æ¥ï¼Œå…·ä½“æ“ä½œå¦‚ä¸‹ï¼š ç¡®è®¤å½“å‰å¤„äºmasteråˆ†æ”¯ã€‚ 1$ git branch -v æ‰§è¡Œåˆå¹¶æ“ä½œï¼Œå°†1fe77æäº¤åˆå¹¶åˆ°å½“å‰åˆ†æ”¯ã€‚ 1$ git merge 1fe77 å·¥ä½œåŒºä¸­å¤šäº†ä¸€ä¸ªdetached-commit.txtæ–‡ä»¶ã€‚ æ·±å…¥äº†è§£git checkoutå‘½ä»¤ git checkoutæ˜¯Gitå¸¸ç”¨çš„å‘½ä»¤ä¹‹ä¸€ï¼ŒåŒæ—¶ä¹Ÿæ˜¯å¾ˆå±é™©çš„å‘½ä»¤ï¼Œå› ä¸ºè¿™æ¡å‘½ä»¤ä¼šé‡å†™å·¥ä½œåŒºã€‚æ£€å‡ºå‘½ä»¤çš„ç”¨æ³•å¦‚ä¸‹ï¼š 123ç”¨æ³•ä¸€ï¼š git checkout [-q] [&lt;commit&gt;] [--] &lt;paths&gt;...ç”¨æ³•äºŒï¼š git checkout [&lt;branch&gt;]ç”¨æ³•ä¸‰ï¼š git checkout [-m] [[-b|--orphan] &lt;new_branch&gt;] [&lt;start_point&gt;] ç”¨æ³•ä¸€å’Œç”¨æ³•äºŒçš„åŒºåˆ«åœ¨äºï¼Œç”¨æ³•ä¸€åœ¨å‘½ä»¤ä¸­åŒ…å«è·¯å¾„&lt;paths&gt;ã€‚ä¸ºäº†é¿å…è·¯å¾„å’Œå¼•ç”¨ï¼ˆæˆ–è€…æäº¤IDï¼‰åŒåè€Œå‘ç”Ÿå†²çªï¼Œå¯ä»¥åœ¨&lt;paths&gt;å‰ç”¨ä¸¤ä¸ªè¿ç»­çš„çŸ­çº¿ä½œä¸ºåˆ†éš”ã€‚ ç¬¬ä¸€ç§ç”¨æ³•çš„&lt;commit&gt;æ˜¯å¯é€‰é¡¹ï¼Œå¦‚æœçœç•¥ç›¸å½“äºä»æš‚å­˜åŒº(index)è¿›è¡Œæ£€å‡ºã€‚è¿™å’Œé‡ç½®å‘½ä»¤å¤§ä¸ç›¸åŒï¼šé‡ç½®çš„é»˜è®¤å€¼æ˜¯HEADï¼Œè€Œæ£€å‡ºçš„é»˜è®¤å€¼æ˜¯æš‚å­˜åŒºã€‚ å› æ­¤é‡ç½®ä¸€èˆ¬ç”¨äºé‡ç½®æš‚å­˜åŒº(é™¤éä½¿ç”¨--hardå‚æ•°ï¼Œå¦åˆ™ä¸é‡ç½®å·¥ä½œåŒº)ï¼Œè€Œæ£€å‡ºå‘½ä»¤ä¸»è¦æ˜¯è¦†ç›–å·¥ä½œåŒº(å¦‚æœ&lt;commit&gt;ä¸çœç•¥ï¼Œä¹Ÿä¼šæ›¿æ¢æš‚å­˜åŒºä¸­ç›¸åº”çš„æ–‡ä»¶)ã€‚ ç”¨æ³•ä¸€(åŒ…å«äº†è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•)ä¸ä¼šæ”¹å˜HEADå¤´æŒ‡é’ˆï¼Œä¸»è¦æ˜¯ç”¨äºæŒ‡å®šç‰ˆæœ¬çš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºä¸­å¯¹åº”çš„æ–‡ä»¶ã€‚å¦‚æœçœç•¥&lt;commit&gt;ï¼Œåˆ™ä¼šç”¨æš‚å­˜åŒºçš„æ–‡ä»¶è¦†ç›–å·¥ä½œåŒºçš„æ–‡ä»¶ï¼Œå¦åˆ™ç”¨æŒ‡å®šæäº¤ä¸­çš„æ–‡ä»¶è¦†ç›–æš‚å­˜åŒºå’Œå·¥ä½œåŒºä¸­å¯¹åº”çš„æ–‡ä»¶ã€‚ ç”¨æ³•äºŒ(ä¸ä½¿ç”¨è·¯å¾„&lt;paths&gt;çš„ç”¨æ³•)åˆ™ä¼šæ”¹å˜HEADå¤´æŒ‡é’ˆã€‚ä¹‹æ‰€ä»¥åé¢çš„å‚æ•°å†™ä½œ&lt;branch&gt;ï¼Œæ˜¯å› ä¸ºåªæœ‰HEADåˆ‡æ¢ä¸€ä¸ªåˆ†æ”¯æ‰å¯ä»¥å¯¹æäº¤è¿›è¡Œè·Ÿè¸ªï¼Œå¦åˆ™ä»ç„¶ä¼šè¿›å…¥â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ã€‚åœ¨â€œåˆ†ç¦»å¤´æŒ‡é’ˆâ€çŠ¶æ€ä¸‹çš„æäº¤ä¸èƒ½è¢«å¼•ç”¨å…³è”åˆ°ï¼Œä»è€Œå¯èƒ½ä¸¢å¤±ã€‚ ç”¨æ³•äºŒçš„æœ€ä¸»è¦ä½œç”¨å°±æ˜¯åˆ‡æ¢åˆ°åˆ†æ”¯ã€‚å¦‚æœçœç•¥&lt;branch&gt;åˆ™ç›¸å½“äºå¯¹å·¥ä½œåŒºè¿›è¡ŒçŠ¶æ€æ£€æŸ¥ã€‚ ç”¨æ³•ä¸‰ä¸»è¦æ˜¯åˆ›å»ºå’Œåˆ‡æ¢åˆ°æ–°åˆ†æ”¯(&lt;new_branch&gt;)ï¼Œæ–°çš„åˆ†æ”¯ä»&lt;start_point&gt;æŒ‡å®šçš„æäº¤å¼€å§‹åˆ›å»ºã€‚æ–°åˆ†æ”¯å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„masteråˆ†æ”¯æ²¡æœ‰ä»€ä¹ˆå®è´¨çš„ä¸åŒï¼Œéƒ½æ˜¯åœ¨refs/headså‘½åç©ºé—´ä¸‹å¼•ç”¨ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~å®‰è£…]]></title>
    <url>%2Fposts%2Ffe22a4f2.html</url>
    <content type="text"><![CDATA[æœ€æ—©Gitæ˜¯åœ¨Linuxä¸Šå¼€å‘çš„ï¼Œå¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼ŒGitä¹Ÿåªèƒ½åœ¨Linuxå’ŒUnixç³»ç»Ÿä¸Šè·‘ã€‚åæ¥æœ‰äººæŠŠå®ƒç§»æ¤åˆ°äº†Windowsä¸Šã€‚ç°åœ¨ï¼ŒGitå¯ä»¥åœ¨Linuxã€Unixã€Macå’ŒWindowsè¿™å‡ å¤§å¹³å°ä¸Šæ­£å¸¸è¿è¡Œäº†ã€‚ è¦ä½¿ç”¨Gitï¼Œç¬¬ä¸€æ­¥å½“ç„¶æ˜¯å®‰è£…Gitäº†ã€‚æ ¹æ®ä½ ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿå¦‚ä¸‹ï¼š Linuxä¸Šå®‰è£…Git é¦–å…ˆï¼Œä½ å¯ä»¥è¯•ç€è¾“å…¥gitï¼Œçœ‹çœ‹ç³»ç»Ÿæœ‰æ²¡æœ‰å®‰è£…Gitï¼š 123$ gitThe program 'git' is currently not installed. You can install it by typing:sudo apt-get install git åƒä¸Šé¢çš„å‘½ä»¤ï¼Œæœ‰å¾ˆå¤šLinuxä¼šå‹å¥½åœ°å‘Šè¯‰ä½ Gitæ²¡æœ‰å®‰è£…ï¼Œè¿˜ä¼šå‘Šè¯‰ä½ å¦‚ä½•å®‰è£…Gitã€‚ å¦‚æœä½ ç”¨çš„æ˜¯Debianæˆ–Ubuntu Linuxï¼Œé€šè¿‡ sudo apt-get install git å°±å¯ä»¥ç›´æ¥å®ŒæˆGitçš„å®‰è£…ï¼Œéå¸¸ç®€å•ã€‚ è€ä¸€ç‚¹çš„Debianæˆ–Ubuntu Linuxï¼Œè¦æŠŠå‘½ä»¤æ”¹ä¸ºsudo apt-get install git-coreï¼Œå› ä¸ºä»¥å‰æœ‰ä¸ªè½¯ä»¶ä¹Ÿå«GITï¼ˆGNU Interactive Toolsï¼‰ï¼Œç»“æœGitå°±åªèƒ½å«git-coreäº†ã€‚ç”±äºGitåæ°”å®åœ¨å¤ªå¤§ï¼Œåæ¥å°±æŠŠGNU Interactive Toolsæ”¹æˆgnuitï¼Œgit-coreæ­£å¼æ”¹ä¸ºgitã€‚ å¦‚æœæ˜¯å…¶ä»–Linuxç‰ˆæœ¬ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡æºç å®‰è£…ã€‚å…ˆä»Gitå®˜ç½‘ä¸‹è½½æºç ï¼Œç„¶åè§£å‹ï¼Œä¾æ¬¡è¾“å…¥ï¼š./configï¼Œmakeï¼Œsudo make installè¿™å‡ ä¸ªå‘½ä»¤å®‰è£…å°±å¥½äº†ã€‚ Mac OS Xä¸Šå®‰è£…Git æœ‰ä¸¤ç§å®‰è£…Gitçš„æ–¹æ³•: ä¸€æ˜¯å®‰è£…homebrewï¼Œç„¶åé€šè¿‡homebrewå®‰è£…Gitï¼Œå…·ä½“æ–¹æ³•è¯·å‚è€ƒhomebrewçš„æ–‡æ¡£ã€‚ ç¬¬äºŒç§æ–¹æ³•æ›´ç®€å•ï¼Œç›´æ¥ä»AppStoreå®‰è£…Xcodeï¼ŒXcodeé›†æˆäº†Gitï¼Œä¸è¿‡é»˜è®¤æ²¡æœ‰å®‰è£…ï¼Œä½ éœ€è¦è¿è¡ŒXcodeï¼Œé€‰æ‹©èœå•â€œXcodeâ€-&gt;â€œPreferencesâ€ï¼Œåœ¨å¼¹å‡ºçª—å£ä¸­æ‰¾åˆ°â€œDownloadsâ€ï¼Œé€‰æ‹©â€œCommand Line Toolsâ€ï¼Œç‚¹â€œInstallâ€å°±å¯ä»¥å®Œæˆå®‰è£…äº†ã€‚ Xcodeæ˜¯Appleå®˜æ–¹IDEï¼ŒåŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œæ˜¯å¼€å‘Macå’ŒiOS Appçš„å¿…é€‰è£…å¤‡ï¼Œè€Œä¸”æ˜¯å…è´¹çš„ï¼ Windowsä¸Šå®‰è£…Git åœ¨Windowsä¸Šä½¿ç”¨Gitï¼Œå¯ä»¥ä»Gitå®˜ç½‘ç›´æ¥ä¸‹è½½å®‰è£…ç¨‹åºï¼Œç„¶åæŒ‰é»˜è®¤é€‰é¡¹å®‰è£…å³å¯ã€‚ å®‰è£…å®Œæˆåï¼Œåœ¨å¼€å§‹èœå•é‡Œæ‰¾åˆ°â€œGitâ€-&gt;â€œGit Bashâ€ï¼Œè¹¦å‡ºä¸€ä¸ªç±»ä¼¼å‘½ä»¤è¡Œçª—å£çš„ä¸œè¥¿ï¼Œå°±è¯´æ˜Gitå®‰è£…æˆåŠŸï¼ å®‰è£…å®Œæˆåï¼Œè¿˜éœ€è¦æœ€åä¸€æ­¥è®¾ç½®ï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥ï¼š 12$ git config --global user.name "Your Name"$ git config --global user.email "email@example.com" æ³¨æ„git configå‘½ä»¤çš„--globalå‚æ•°ï¼Œç”¨äº†è¿™ä¸ªå‚æ•°ï¼Œè¡¨ç¤ºä½ è¿™å°æœºå™¨ä¸Šæ‰€æœ‰çš„Gitä»“åº“éƒ½ä¼šä½¿ç”¨è¿™ä¸ªé…ç½®ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥å¯¹æŸä¸ªä»“åº“æŒ‡å®šä¸åŒçš„ç”¨æˆ·åå’ŒEmailåœ°å€ã€‚ Gitå¯ä»¥å®‰è£…åœ¨å“ªäº›æ“ä½œç³»ç»Ÿä¸Šï¼Ÿ [x] Linux [x] macOS [x] Solaris [x] Windows [x] Raspberry Pi [x] Submit document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Gitå­¦ä¹ ä¹‹~çˆ±ä¸ŠGitçš„ç†ç”±]]></title>
    <url>%2Fposts%2Fd9014d70.html</url>
    <content type="text"><![CDATA[ç°åœºç‰ˆæœ¬æ§åˆ¶ ç°åœºç‰ˆæœ¬åº“åˆ›å»ºã€‚ ç›´æ¥åœ¨éœ€è¦ç‰ˆæœ¬æ§åˆ¶çš„ç›®å½•ä¸‹æ‰§è¡ŒGitç‰ˆæœ¬åº“åˆå§‹åŒ–å‘½ä»¤ã€‚ 1git init æ·»åŠ æ–‡ä»¶å¹¶æäº¤ 12git add -Agit commit -m "æœ¬æ¬¡æäº¤çš„å†…å®¹æè¿°" ä¸ºåˆå§‹æäº¤å»ºç«‹ä¸€ä¸ªé‡Œç¨‹ç¢‘ï¼š"v1" 1git tag v1 ç„¶åå¼€å§‹åœ¨å·¥ä½œåŒºä¸­å·¥ä½œ--ä¿®æ”¹æ–‡ä»¶ï¼Œæäº¤ 1git commit -a å½“å¯¹ä¿®æ”¹ç»“æœæ»¡æ„ï¼Œæƒ³å°†å·¥ä½œæˆåŠŸä¿å­˜å¸¦èµ°æ—¶ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼Œå°†ä»v1å¼€å§‹çš„å†æ¬¡æäº¤ é€ä¸€å¯¼å‡ºä¸ºè¡¥ä¸æ–‡ä»¶ã€‚è½¬æ¢çš„è¡¥ä¸æ–‡ä»¶éƒ½åŒ…å«ä¸€ä¸ªæ•°å­—å‰ç¼€ï¼Œå¹¶æå–æäº¤æ—¥å¿—ä¿¡æ¯ä½œä¸ºæ–‡ä»¶åï¼Œè€Œä¸”è¡¥ä¸æ–‡ä»¶ è¿˜æä¾›å¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„æ”¯æŒã€‚ 1git format-patch v1..HEAD é€šè¿‡é‚®ä»¶å°†è¡¥ä¸æ–‡ä»¶å‘å‡ºã€‚å½“ç„¶ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æ–¹å¼å°†è¡¥ä¸æ–‡ä»¶å¸¦èµ°ã€‚ 1git send-email *.patch Gitåˆ›å»ºçš„è¡¥ä¸æ–‡ä»¶ä½¿ç”¨äº†Gitæ‰©å±•æ ¼å¼ï¼Œå› æ­¤åœ¨å¯¼å…¥æ—¶ä¸ºäº†é¿å…æ•°æ®é—æ¼ï¼Œè¦ä½¿ç”¨Gitæä¾›çš„å‘½ä»¤è€Œä¸èƒ½ ä½¿ç”¨GNU patchå‘½ä»¤ã€‚å³æ—¶è¦å¯¼å…¥çš„ä¸æ˜¯Gitç‰ˆæœ¬åº“ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨Gitå‘½ä»¤ã€‚ ä¿®æ”¹æäº¤è¯´æ˜ 1git commit --amend è¿™ä¸ªå‘½ä»¤å¦‚æœä¸å¸¦"-m"å‚æ•°ï¼Œä¼šè¿›å…¥æäº¤æäº¤è¯´æ˜ç¼–è¾‘ç•Œé¢ï¼Œä¿®æ”¹åŸæ¥çš„æäº¤è¯´æ˜ï¼Œç›´åˆ°æ»¡æ„ä¸ºæ­¢ã€‚ å¦‚æœè¦ä¿®æ”¹æŸä¸ªå†å²æäº¤çš„æäº¤è¯´æ˜ï¼ŒGitä¹Ÿå¯ä»¥å®ç°ï¼Œä½†è¦ç”¨åˆ°å¦ä¸€ä¸ªå‘½ä»¤ï¼šå˜åŸºå‘½ä»¤ã€‚ ä¾‹å¦‚è¦ä¿®æ”¹&lt;commit-id&gt;æ‰€æ ‡è¯†æäº¤çš„æäº¤è¯´æ˜ï¼Œæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå¹¶åœ¨å¼¹å‡ºçš„å˜åŸºç´¢å¼•æ–‡ä»¶ä¸­ ä¿®æ”¹ç›¸åº”æäº¤å‰é¢çš„åŠ¨ä½œçš„å…³é”®å­—ã€‚ 1git rebase -i &lt;commit-id&gt;^ åˆ é™¤ä¸åº”æäº¤çš„æ–‡ä»¶ 12git rm --cached æ–‡ä»¶ågit commit --amend å¦‚æœæ˜¯å†å²ç‰ˆæœ¬ï¼Œä¾‹å¦‚æ˜¯åœ¨&lt;commit-id&gt;æ‰€æ ‡è¯†çš„æäº¤ä¸­å¼•å…¥çš„æ–‡ä»¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨å˜åŸºæ“ä½œã€‚ 1git rebase -i &lt;commit-id&gt;^ æ›´å¥½ç”¨çš„æäº¤åˆ—è¡¨ git add å‘½ä»¤å°†ä¿®æ”¹å†…å®¹åŠ å…¥æäº¤æš‚å­˜åŒºã€‚ git add -u å‘½ä»¤å¯ä»¥å°†æ‰€æœ‰ä¿®æ”¹è¿‡çš„æ–‡ä»¶åŠ å…¥æš‚å­˜åŒºã€‚ git add -A å‘½ä»¤å¯ä»¥å°†æœ¬åœ°åˆ é™¤æ–‡ä»¶å’Œæ–°å¢æ–‡ä»¶éƒ½ç™»è®°åˆ°æš‚å­˜åŒºã€‚ git add -p å‘½ä»¤ç”šè‡³å¯ä»¥å¯¹ä¸€ä¸ªæ–‡ä»¶å†…çš„ä¿®æ”¹è¿›è¡Œæœ‰é€‰æ‹©æ€§çš„æ·»åŠ ã€‚ ä¸€ä¸ªä¿®æ”¹åçš„æ–‡ä»¶è¢«ç™»è®°åˆ°æäº¤æš‚å­˜åŒºåï¼Œå¯ä»¥ç»§ç»­ä¿®æ”¹ï¼Œç»§ç»­ä¿®æ”¹çš„å†…å®¹ä¸ä¼šè¢«æäº¤ï¼Œé™¤éå†å¯¹æ­¤æ–‡ä»¶ å†æ‰§è¡Œä¸€æ¬¡ git add å‘½ä»¤ã€‚å³ä¸€ä¸ªä¿®æ”¹æ–‡ä»¶å¯ä»¥æ‹¥æœ‰ä¸¤ä¸ªç‰ˆæœ¬ï¼Œåœ¨æäº¤æš‚å­˜åŒºä¸­æœ‰ä¸€ä¸ªç‰ˆæœ¬ï¼Œåœ¨å·¥ä½œåŒº ä¸­æœ‰å¦å¤–ä¸€ä¸ªç‰ˆæœ¬ã€‚ æ‰§è¡Œ git commitå‘½ä»¤æäº¤ï¼Œæ— é¡»è®¾å®šä»€ä¹ˆå˜æ›´åˆ—è¡¨ï¼Œç›´æ¥å°†ç™»è®°åœ¨æš‚å­˜åŒºä¸­çš„å†…å®¹æäº¤ã€‚ Gitæ”¯æŒå¯¹æäº¤çš„æ’¤é”€ï¼Œè€Œä¸”å¯ä»¥æ’¤é”€ä»»æ„å¤šæ¬¡ã€‚ å·¥ä½œè¿›åº¦ä¿å­˜ å¦‚æœå·¥ä½œåŒºçš„ä¿®æ”¹å°šæœªå®Œæˆæ—¶ï¼Œå¿½ç„¶æœ‰ä¸€ä¸ªç´§æ€¥çš„ä»»åŠ¡ï¼Œéœ€è¦ä»ä¸€ä¸ªå¹²å‡€çš„å·¥ä½œåŒºå¼€å§‹æ–°çš„å·¥ä½œï¼Œ æˆ–è€…è¦åˆ‡æ¢åˆ°åˆ«çš„åˆ†æ”¯è¿›è¡Œå·¥ä½œï¼Œé‚£ä¹ˆå¦‚æœä¿å­˜å½“å‰å°šæœªå®Œæˆçš„å·¥ä½œè¿›åº¦å‘¢ï¼Ÿ 1git stash åœ¨åˆ‡æ¢åˆ°æ–°çš„å·¥ä½œåˆ†æ”¯ä¹‹å‰ï¼Œæ‰§è¡Œ git stash ä¿å­˜å·¥ä½œè¿›åº¦ï¼Œå·¥ä½œåŒºä¼šå˜çš„éå¸¸å¹²å‡€ï¼Œç„¶åå°±å¯ä»¥åˆ‡æ¢åˆ°æ–°çš„åˆ†æ”¯ã€‚ 12git stash git checkout &lt;new_branch&gt; æ–°çš„å·¥ä½œåˆ†æ”¯ä¿®æ”¹å®Œæ¯•åï¼Œå†åˆ‡æ¢å›å½“å‰åˆ†æ”¯ï¼Œè°ƒç”¨ git stash pop å‘½ä»¤åˆ™å¯æ¢å¤ä¹‹å‰ä¿å­˜çš„å·¥ä½œè¿›åº¦ã€‚ 12git checkout &lt;orignal_branch&gt;git stash pop æ›´å¥½çš„å·®å¼‚æ¯”è¾ƒ Gitå¯¹å·®å¼‚æ¯”è¾ƒè¿›è¡Œäº†æ‰©å±•ï¼Œæ”¯æŒå¯¹äºŒè¿›åˆ¶æ–‡ä»¶çš„å·®å¼‚æ¯”è¾ƒï¼Œè¿™æ˜¯å¯¹GNUçš„ diff å’Œ patch å‘½ä»¤çš„é‡è¦è¡¥å……ã€‚ è¿˜æœ‰Gitçš„å·®å¼‚æ¯”è¾ƒé™¤äº†æ”¯æŒåŸºäºè¡Œçš„å·®å¼‚æ¯”è¾ƒå¤–ï¼Œè¿˜æ”¯æŒåœ¨ä¸€è¡Œå†…é€å­—æ¯”è¾ƒçš„æ–¹å¼ï¼Œå½“å‘ git diff å‘½ä»¤ ä¼ é€’ --word-diff å‚æ•°æ—¶ï¼Œå°±ä¼šè¿›è¡Œé€å­—æ¯”è¾ƒã€‚ åœ¨ä¸Šé¢ä»‹ç»äº†å·¥ä½œåŒºçš„æ–‡ä»¶ä¿®æ”¹å¯èƒ½ä¼šæœ‰ä¸¤ä¸ªä¸åŒçš„ç‰ˆæœ¬ï¼Œä¸€ä¸ªæ˜¯åœ¨æäº¤æš‚å­˜åŒºï¼Œä¸€ä¸ªæ˜¯åœ¨å·¥ä½œåŒºã€‚å› æ­¤åœ¨ æ‰§è¡Œ git diff å‘½ä»¤æ—¶ä¼šé‡åˆ°ä»¤Gitæ–°æ‰‹è´¹è§£çš„ç°è±¡ã€‚ ä¿®æ”¹åçš„æ–‡ä»¶åœ¨æ‰§è¡Œ git diff å‘½ä»¤æ—¶ä¼šçœ‹åˆ°ä¿®æ”¹é€ æˆçš„å·®å¼‚ã€‚ ä¿®æ”¹åçš„æ–‡ä»¶é€šè¿‡ git add å‘½ä»¤æäº¤åˆ°æš‚å­˜åŒºï¼Œå†æ‰§è¡Œ git diff å‘½ä»¤ä¼šçœ‹ä¸åˆ°è¯¥æ–‡ä»¶çš„å·®å¼‚ã€‚ æ‰§è¡Œ git diff --cached å‘½ä»¤æ‰å¯ä»¥çœ‹åˆ°æ·»åŠ åˆ°æš‚å­˜åŒºä¸­çš„æ–‡ä»¶æ‰€åšå‡ºçš„ä¿®æ”¹ã€‚ æ— å¤„ä¸åœ¨çš„åˆ†é¡µå™¨ åˆ†é¡µå™¨é»˜è®¤ä½¿ç”¨ lesså‘½ä»¤ï¼ˆless -FRSXï¼‰è¿›è¡Œåˆ†é¡µã€‚ ä¸‹é¢æ˜¯åœ¨åˆ†é¡µå™¨ä¸­å¸¸ç”¨çš„çƒ­é”®ï¼š å­—æ¯qï¼šé€€å‡ºåˆ†é¡µå™¨ï¼› å­—æ¯hï¼šæ˜¾ç¤ºåˆ†é¡µå™¨å¸®åŠ©ï¼› æŒ‰ç©ºæ ¼ä¸‹ç¿»ä¸€é¡µï¼ŒæŒ‰å­—æ¯bä¸Šç¿»ä¸€é¡µï¼› å­—æ¯då’Œuï¼šåˆ†åˆ«ä»£è¡¨å‘ä¸‹ç¿»åŠ¨åŠé¡µå’Œå‘ä¸Šç¿»åŠ¨åŠé¡µï¼› å­—æ¯jå’Œkï¼šåˆ†åˆ«ä»£è¡¨å‘ä¸Šç¿»ä¸€è¡Œå’Œå‘ä¸‹ç¿»ä¸€è¡Œï¼› å¦‚æœè¡Œå¤ªé•¿è¢«æˆªæ–­ï¼Œå¯ä»¥ç”¨å·¦ç®­å¤´å’Œå³ç®­å¤´ä½¿å¾—çª—å£å†…å®¹å·¦å³æ»šåŠ¨ï¼› è¾“å…¥/patternï¼šå‘ä¸‹å¯»æ‰¾å’ŒpatternåŒ¹é…çš„å†…å®¹ï¼› è¾“å…¥?patternï¼šå‘ä¸Šå¯»æ‰¾å’ŒpatternåŒ¹é…çš„å†…å®¹ï¼› å­—æ¯næˆ–Nï¼šä»£è¡¨å‘å‰æˆ–å‘åç»§ç»­å¯»æ‰¾ï¼› å­—æ¯gï¼šè·³åˆ°ç¬¬ä¸€è¡Œï¼› å­—æ¯Gï¼šè·³åˆ°æœ€åä¸€è¡Œï¼› è¾“å…¥æ•°å­—å†åŠ å­—æ¯gï¼šåˆ™è·³è½¬åˆ°å¯¹åº”çš„è¡Œï¼› è¾“å…¥!&lt;command&gt;ï¼šå¯ä»¥æ‰§è¡ŒShellå‘½ä»¤ã€‚ å¯¹äºé»˜è®¤æœªæä¾›åˆ†é¡µå™¨çš„Gitå‘½ä»¤ï¼Œä¾‹å¦‚ git status å‘½ä»¤ï¼Œå¯é€šè¿‡ä¸‹é¢ä»»ä¸€æ–¹æ³•å¯ç”¨åˆ†é¡µå™¨ï¼š åœ¨ git å’Œå­å‘½ä»¤(å¦‚ï¼šstatus)ä¹‹é—´æ’å…¥å‚æ•°-pæˆ–--paginateï¼Œä¸ºå‘½ä»¤å¯ç”¨å†…å»ºåˆ†é¡µå™¨ã€‚å¦‚ï¼š 1git -p status -è®¾ç½®Gitå˜é‡ï¼Œè®¾ç½®å®Œæ¯•åè¿è¡Œç›¸åº”çš„å‘½ä»¤ï¼Œå°†å¯ç”¨å†…å»ºåˆ†é¡µå™¨ã€‚ 1git config --global pager.status true Git å‘½ä»¤çš„åˆ†é¡µå™¨æ”¯æŒå¸¦é¢œè‰²çš„å­—ç¬¦è¾“å‡ºï¼Œå¯¹äºå¤ªé•¿çš„è¡Œåˆ™é‡‡ç”¨æˆªæ–­æ–¹å¼å¤„ç†ï¼ˆå¯ç”¨å·¦å³æ–¹å‘é”®æ»šåŠ¨ï¼‰ã€‚ å¦‚æœä¸ä¹ æƒ¯åˆ†é¡µå™¨çš„é•¿è¡Œæˆªæ–­æ¨¡å¼è€Œå¸Œæœ›é‡‡ç”¨è‡ªåŠ¨æŠ˜è¡Œæ¨¡å¼ï¼Œå¯é€šè¿‡ä¸‹é¢ä»»ä¸€æ–¹æ³•è¿›è¡Œè®¾ç½®ï¼š é€šè¿‡è®¾ç½®LESSç¯å¢ƒå˜é‡æ¥å®ç°ã€‚ 1export LESS=FRX -æˆ–è€…é€šè¿‡å®šä¹‰Gité…ç½®å˜é‡æ¥æ”¹å˜åˆ†é¡µå™¨çš„é»˜è®¤è¡Œä¸ºã€‚ 1git config --global core.pager 'less -+$LESS -FRX' document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Git</category>
      </categories>
      <tags>
        <tag>Git</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šçº¿ç¨‹-01ä¹‹-åŸºæœ¬æ¦‚å¿µ]]></title>
    <url>%2Fposts%2F7335ce5b.html</url>
    <content type="text"><![CDATA[è¿›ç¨‹ æ¦‚è¿° è¿›ç¨‹æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€ã€‚ åœ¨æ—©æœŸé¢å‘è¿›ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„åŸºæœ¬æ‰§è¡Œå®ä½“ï¼›åœ¨å½“ä»£é¢å‘çº¿ç¨‹è®¾è®¡çš„è®¡ç®—æœºç»“æ„ä¸­ï¼Œè¿›ç¨‹æ˜¯çº¿ç¨‹çš„å®¹å™¨ã€‚ç¨‹åºæ˜¯æŒ‡ä»¤ã€æ•°æ®åŠå…¶ç»„ç»‡å½¢å¼çš„æè¿°ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„å®ä½“ã€‚ ä¸€ä¸ªè¿›ç¨‹å°±æ˜¯ä¸€ä¸ªæ­£åœ¨æ‰§è¡Œç¨‹åºçš„å®ä¾‹ï¼ŒåŒ…æ‹¬ç¨‹åºè®¡æ•°å™¨ï¼Œå¯„å­˜å™¨å’Œå˜é‡çš„å½“å‰å€¼ã€‚ä»æ¦‚å¿µä¸Šè¯´ï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„è™šæ‹ŸCPUã€‚å®é™…ä¸ŠçœŸæ­£çš„CPUåœ¨å„ä¸ªè¿›ç¨‹é—´æ¥å›åˆ‡æ¢ã€‚ è¿›ç¨‹çš„å±‚æ¬¡ç»“æ„ è¿›ç¨‹åªæœ‰ä¸€ä¸ªçˆ¶è¿›ç¨‹ï¼Œä½†æ˜¯å¯ä»¥æœ‰0ä¸ªï¼Œä¸€ä¸ªï¼Œå¤šä¸ªå­è¿›ç¨‹ã€‚ è¿›ç¨‹çš„çŠ¶æ€ è¿è¡Œæ€ï¼šè¯¥æ—¶åˆ»è¿›ç¨‹å®é™…å ç”¨CPUã€‚ å°±ç»ªæ€ï¼šå¯è¿è¡Œï¼Œä½†å› ä¸ºå…¶ä»–è¿›ç¨‹æ­£åœ¨è¿è¡Œè€Œæš‚æ—¶åœæ­¢ã€‚ é˜»å¡æ€ï¼šé™¤éæŸç§å¤–éƒ¨äº‹ä»¶å‘ç”Ÿï¼Œå¦åˆ™è¿›ç¨‹ä¸èƒ½è¿è¡Œã€‚ çº¿ç¨‹ çº¿ç¨‹æ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä»–æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºã€‚ è¿›ç¨‹å’Œçº¿ç¨‹çš„åŒºåˆ« è¿›ç¨‹ç”¨äºæŠŠèµ„æºé›†ä¸­åˆ°ä¸€èµ·ï¼Œè€Œçº¿ç¨‹åˆ™æ˜¯åœ¨CPUä¸Šè¢«è°ƒåº¦æ‰§è¡Œçš„å®ä½“ã€‚ è¿›ç¨‹ï¼šæŒ‡åœ¨ç³»ç»Ÿä¸­èƒ½ç‹¬ç«‹è¿è¡Œå¹¶ä½œä¸ºèµ„æºåˆ†é…çš„åŸºæœ¬å•ä½ï¼Œå®ƒæ˜¯ç”±ä¸€ç»„æœºå™¨æŒ‡ä»¤ã€æ•°æ®å’Œå †æ ˆç­‰ç»„æˆçš„ï¼Œæ˜¯ä¸€ä¸ªèƒ½ç‹¬ç«‹è¿è¡Œçš„æ´»åŠ¨å®ä½“ã€‚ çº¿ç¨‹ï¼šæ˜¯è¿›ç¨‹çš„ä¸€ä¸ªå®ä½“ï¼Œæ˜¯CPUè°ƒåº¦å’Œåˆ†æ´¾çš„åŸºæœ¬å•ä½ï¼Œä»–æ˜¯æ¯”è¿›ç¨‹æ›´å°çš„èƒ½ç‹¬ç«‹è¿è¡Œçš„åŸºæœ¬å•ä½ï¼Œçº¿ç¨‹è‡ªå·±åŸºæœ¬ä¸Šä¸æ‹¥æœ‰ç³»ç»Ÿèµ„æºã€‚ å¤šä¸ªè¿›ç¨‹çš„å†…éƒ¨æ•°æ®å’ŒçŠ¶æ€éƒ½æ˜¯å®Œå…¨ç‹¬ç«‹çš„,è€Œå¤šçº¿ç¨‹æ˜¯å…±äº«ä¸€å—å†…å­˜ç©ºé—´å’Œä¸€ç»„ç³»ç»Ÿèµ„æº,æœ‰å¯èƒ½äº’ç›¸å½±å“. çº¿ç¨‹æœ¬èº«çš„æ•°æ®é€šå¸¸åªæœ‰å¯„å­˜å™¨æ•°æ®ï¼Œä»¥åŠä¸€ä¸ªç¨‹åºæ‰§è¡Œæ—¶ä½¿ç”¨çš„å †æ ˆï¼Œæ‰€ä»¥çº¿ç¨‹çš„åˆ‡æ¢æ¯”è¿›ç¨‹åˆ‡æ¢çš„è´Ÿæ‹…è¦å°ã€‚ åœ¨åŒä¸€è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§è¦æ¯”ä¸åŒè¿›ç¨‹ä¹‹é—´çš„ç‹¬ç«‹æ€§ä½å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºä¸ºé˜²æ­¢è¿›ç¨‹ä¹‹é—´å½¼æ­¤å¹²æ‰°å’Œç ´åï¼Œæ¯ä¸ªè¿›ç¨‹éƒ½æ‹¥æœ‰ä¸€ä¸ªç‹¬ç«‹çš„åœ°å€ç©ºé—´å’Œå…¶å®ƒèµ„æºï¼Œé™¤äº†å…±äº«å…¨å±€å˜é‡å¤–ï¼Œä¸å…è®¸å…¶å®ƒè¿›ç¨‹çš„è®¿é—®ã€‚ä½†æ˜¯åŒä¸€è¿›ç¨‹ä¸­çš„ä¸åŒçº¿ç¨‹å¾€å¾€æ˜¯ä¸ºäº†æé«˜å¹¶å‘æ€§ä»¥åŠè¿›è¡Œç›¸äº’ä¹‹é—´çš„åˆä½œè€Œåˆ›å»ºçš„ï¼Œå®ƒä»¬å…±äº«è¿›ç¨‹çš„å†…å­˜åœ°å€ç©ºé—´å’Œèµ„æºï¼Œå¦‚æ¯ä¸ªçº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å®ƒä»¬æ‰€å±è¿›ç¨‹åœ°å€ç©ºé—´ä¸­çš„æ‰€æœ‰åœ°å€ï¼Œå¦‚ä¸€ä¸ªçº¿ç¨‹çš„å †æ ˆå¯ä»¥è¢«å…¶å®ƒçº¿ç¨‹è¯»ã€å†™ï¼Œç”šè‡³å®Œå…¨æ¸…é™¤ã€‚ çº¿ç¨‹çŠ¶æ€å›¾ çº¿ç¨‹çŠ¶æ€è§£æ &lt;span id="inline-green"&gt; 1. æ–°å»ºçŠ¶æ€(New): &lt;/span&gt; çº¿ç¨‹å¯¹è±¡è¢«åˆ›å»ºåï¼Œå°±è¿›å…¥äº†æ–°å»ºçŠ¶æ€ã€‚ä¾‹å¦‚ï¼ŒThread thread = new Thread()ã€‚ &lt;span id="inline-green"&gt; 2. å°±ç»ªçŠ¶æ€(Runnable): &lt;/span&gt; ä¹Ÿè¢«ç§°ä¸ºâ€œå¯æ‰§è¡ŒçŠ¶æ€â€ï¼Œå¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ï¼Œéšæ—¶å¯èƒ½è¢«CPUè°ƒåº¦æ‰§è¡Œã€‚ è°ƒç”¨çº¿ç¨‹çš„start()æ–¹æ³•ï¼Œæ­¤çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ å½“å‰çº¿ç¨‹sleep()æ–¹æ³•ç»“æŸï¼Œå…¶ä»–çº¿ç¨‹join()ç»“æŸï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥å®Œæ¯•ï¼ŒæŸä¸ªçº¿ç¨‹æ‹¿åˆ°å¯¹è±¡é”ï¼Œè¿™äº›çº¿ç¨‹ä¹Ÿå°†è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ å½“å‰çº¿ç¨‹æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œè°ƒç”¨å½“å‰çº¿ç¨‹çš„yield()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ é”æ± é‡Œçš„çº¿ç¨‹æ‹¿åˆ°å¯¹è±¡é”åï¼Œè¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ &lt;span id="inline-green"&gt; 3. è¿è¡ŒçŠ¶æ€(Running):&lt;/span&gt; çº¿ç¨‹è·å–CPUæƒé™è¿›è¡Œæ‰§è¡Œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œçº¿ç¨‹åªèƒ½ä»å°±ç»ªçŠ¶æ€è¿›å…¥åˆ°è¿è¡ŒçŠ¶æ€ã€‚ &lt;span id="inline-green"&gt; 4. é˜»å¡çŠ¶æ€(Blocked): &lt;/span&gt; é˜»å¡çŠ¶æ€æ˜¯çº¿ç¨‹å› ä¸ºæŸç§åŸå› æ”¾å¼ƒCPUä½¿ç”¨æƒï¼Œæš‚æ—¶åœæ­¢è¿è¡Œã€‚ç›´åˆ°çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œæ‰æœ‰æœºä¼šè½¬åˆ°è¿è¡ŒçŠ¶æ€ã€‚é˜»å¡çš„æƒ…å†µåˆ†ä¸‰ç§ï¼š ç­‰å¾…é˜»å¡ -- é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„wait()æ–¹æ³•ï¼Œè®©çº¿ç¨‹ç­‰å¾…æŸå·¥ä½œçš„å®Œæˆã€‚ åŒæ­¥é˜»å¡ -- çº¿ç¨‹åœ¨è·å–synchronizedåŒæ­¥é”å¤±è´¥(å› ä¸ºé”è¢«å…¶å®ƒçº¿ç¨‹æ‰€å ç”¨)ï¼Œå®ƒä¼šè¿›å…¥åŒæ­¥é˜»å¡çŠ¶æ€ã€‚ å…¶ä»–é˜»å¡ -- é€šè¿‡è°ƒç”¨çº¿ç¨‹çš„sleep()æˆ–join()æˆ–å‘å‡ºäº†I/Oè¯·æ±‚æ—¶ï¼Œçº¿ç¨‹ä¼šè¿›å…¥åˆ°é˜»å¡çŠ¶æ€ã€‚å½“sleep()çŠ¶æ€è¶…æ—¶ã€join()ç­‰å¾…çº¿ç¨‹ç»ˆæ­¢æˆ–è€…è¶…æ—¶ã€æˆ–è€…I/Oå¤„ç†å®Œæ¯•æ—¶ï¼Œçº¿ç¨‹é‡æ–°è½¬å…¥å°±ç»ªçŠ¶æ€ã€‚ &lt;span id="inline-green"&gt; 5. æ­»äº¡çŠ¶æ€(Dead): &lt;/span&gt; çº¿ç¨‹æ‰§è¡Œå®Œäº†æˆ–è€…å› å¼‚å¸¸é€€å‡ºäº†run()æ–¹æ³•ï¼Œè¯¥çº¿ç¨‹ç»“æŸç”Ÿå‘½å‘¨æœŸã€‚çº¿ç¨‹ä¸€æ—¦ç»ˆæ­¢äº†ï¼Œå°±ä¸èƒ½å¤ç”Ÿã€‚åœ¨ä¸€ä¸ªç»ˆæ­¢çš„çº¿ç¨‹ä¸Šè°ƒç”¨start()æ–¹æ³•ï¼Œä¼šæŠ›å‡ºjava.lang.IllegalThreadStateExceptionå¼‚å¸¸ã€‚ è¯´æ˜ è¿™5ç§çŠ¶æ€æ¶‰åŠåˆ°çš„å†…å®¹åŒ…æ‹¬Objectç±», Threadå’Œsynchronizedå…³é”®å­—ã€‚ Objectç±»ï¼Œå®šä¹‰äº†wait(), notify(), notifyAll()ç­‰ä¼‘çœ /å”¤é†’å‡½æ•°ã€‚ Threadç±»ï¼Œå®šä¹‰äº†ä¸€äº›åˆ—çš„çº¿ç¨‹æ“ä½œå‡½æ•°ã€‚ä¾‹å¦‚ï¼Œsleep()ä¼‘çœ å‡½æ•°, interrupt()ä¸­æ–­å‡½æ•°, getName()è·å–çº¿ç¨‹åç§°ç­‰ã€‚ synchronizedï¼Œæ˜¯å…³é”®å­—ï¼›å®ƒåŒºåˆ†ä¸ºsynchronizedä»£ç å—å’Œsynchronizedæ–¹æ³•ã€‚synchronizedçš„ä½œç”¨æ˜¯è®©çº¿ç¨‹è·å–å¯¹è±¡çš„åŒæ­¥é”ã€‚ å‡ ä¸ªæ–¹æ³•çš„æ¯”è¾ƒ &lt;p id="div-border-left-green"&gt; 1. Thread.sleep(long millis)ï¼Œä¸€å®šæ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥TIMED_WAITINGçŠ¶æ€ï¼Œä½†ä¸é‡Šæ”¾å¯¹è±¡é”ï¼Œmillisåçº¿ç¨‹è‡ªåŠ¨è‹é†’è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚ä½œç”¨ï¼šç»™å…¶å®ƒçº¿ç¨‹æ‰§è¡Œæœºä¼šçš„æœ€ä½³æ–¹å¼ã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt; 2. Thread.yield()ï¼Œä¸€å®šæ˜¯å½“å‰çº¿ç¨‹è°ƒç”¨æ­¤æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹æ”¾å¼ƒè·å–çš„CPUæ—¶é—´ç‰‡ï¼Œä½†ä¸é‡Šæ”¾é”èµ„æºï¼Œç”±è¿è¡ŒçŠ¶æ€å˜ä¸ºå°±ç»ªçŠ¶æ€ï¼Œè®©OSå†æ¬¡é€‰æ‹©çº¿ç¨‹ã€‚ä½œç”¨ï¼šè®©ç›¸åŒä¼˜å…ˆçº§çš„çº¿ç¨‹è½®æµæ‰§è¡Œï¼Œä½†å¹¶ä¸ä¿è¯ä¸€å®šä¼šè½®æµæ‰§è¡Œã€‚å®é™…ä¸­æ— æ³•ä¿è¯yield()è¾¾åˆ°è®©æ­¥ç›®çš„ï¼Œå› ä¸ºè®©æ­¥çš„çº¿ç¨‹è¿˜æœ‰å¯èƒ½è¢«çº¿ç¨‹è°ƒåº¦ç¨‹åºå†æ¬¡é€‰ä¸­ã€‚Thread.yield()ä¸ä¼šå¯¼è‡´é˜»å¡ã€‚è¯¥æ–¹æ³•ä¸sleep()ç±»ä¼¼ï¼Œåªæ˜¯ä¸èƒ½ç”±ç”¨æˆ·æŒ‡å®šæš‚åœå¤šé•¿æ—¶é—´ã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt; 3. t.join()/t.join(long millis)ï¼Œå½“å‰çº¿ç¨‹é‡Œè°ƒç”¨å…¶å®ƒçº¿ç¨‹tçš„joinæ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥WAITING/TIMED_WAITINGçŠ¶æ€ï¼Œå½“å‰çº¿ç¨‹ä¸ä¼šé‡Šæ”¾å·²ç»æŒæœ‰çš„å¯¹è±¡é”ã€‚çº¿ç¨‹tæ‰§è¡Œå®Œæ¯•æˆ–è€…millisæ—¶é—´åˆ°ï¼Œå½“å‰çº¿ç¨‹è¿›å…¥å°±ç»ªçŠ¶æ€ã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt; 4. obj.wait()ï¼Œå½“å‰çº¿ç¨‹è°ƒç”¨å¯¹è±¡çš„wait()æ–¹æ³•ï¼Œå½“å‰çº¿ç¨‹é‡Šæ”¾å¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚ä¾é notify()/notifyAll()å”¤é†’æˆ–è€…wait(long timeout) timeoutæ—¶é—´åˆ°è‡ªåŠ¨å”¤é†’ã€‚&lt;/p&gt; &lt;p id="div-border-left-green"&gt; 5. obj.notify()å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ï¼Œé€‰æ‹©æ˜¯ä»»æ„æ€§çš„ã€‚notifyAll()å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚&lt;/p&gt; document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>å¤šçº¿ç¨‹</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>å¤šçº¿ç¨‹</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[æœ‰è¶£çš„SpringBootå¯åŠ¨bannerï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F74450131.html</url>
    <content type="text"><![CDATA[åƒé‡Œé©¬ 123456789101112131415161718192021 _(\_/) ,((((^`\ (((( (6 \ ,((((( , \ ,,,_ ,((((( /"._ ,`, ((((\\ ,... ,(((( / `-.-' ))) ;' `"'"'""(((( ( ((( / ((( \ )) | |(( | . ' |)) \ _ ' `t ,.')( | y;- -,-""'"-.\ \/ ) / ./ ) / `\ \ |./ ( ( / /' || \\ //'| || \\ _//'|| || )) |_/ || \_\ |_/ || `'" \_\ `'" æ–‡å­—å…” 12345678910111213141516171819202122232425262728293031323334353637/*** * ç“¦ç“¦ å * åé½±é¾ å·± äº…ç“¦è»Šå·± * ä¹™é¾é¾ æ¯‹æ—¥ä¸¶ ä¸¶ä¹™å·±æ¯‹æ¯‹ä¸¶ * åé¾ é¦¬é¬¼è»Šç“¦ å·±åç“¦æ¯‹æ¯‹ * é¬¼é¦¬é¾ é¦¬é¾ å å·±å·±æ¯‹è»Šæ¯‹ç“¦ * æ¯‹é¾ é¾ é¾é¾ é¬¼ä¹™ä¸¶ä¸¶ä¹™è»Šä¹™æ¯‹é¬¼è»Šå·± * ä¹™é¾ é¾é¾é¬¼é¾ç“¦ åç“¦æ¯‹ä¹™ç“¦é¾ ç“¦äº… * é¦¬é½±é¾é¦¬é¬¼åä¸¶æ—¥å·±å·±å·±æ¯‹è»Šä¹™ä¸¶ * å·±é½±é¦¬é¬¼è»Šååæ¯‹æ—¥ä¹™å·±å·±ä¹™ä¹™ * è»Šé¦¬é½±é½±æ—¥ä¹™æ¯‹ç“¦å·±ä¹™ç“¦æ—¥äº… * äº…è»Šé½ºé¾–ç“¦ä¹™è»Šé¾–é¾ä¹™ä¹™å * æ—¥é¾ é¾ åäº…è»Šé¾æ¯‹åå * æ—¥æ¯‹å·±äº… å·±å·±åäº…äº… * ä¸¶å·±ååä¹™ ä¸¶ä¸¶ä¸¶ä¸¶ä¸¶ * äº…å·±åé¾é¾–ç“¦ ä¸¶ ä¸¶ ä¹™å * äº…å·±åé¾ é¾–æ¯‹ ä¸¶ä¸¶ ä¸¶å·±é¬¼é¬¼ç“¦äº… * åæ—¥ååæ—¥äº…ä¸¶äº…ä¸¶ ä¸¶åæ—¥æ¯‹é¬¼é¦¬é¦¬è»Šä¹™ * åæ—¥ä¹™åäº…äº…äº…ä¸¶ åä¹™å·±æ¯‹é¬¼é¬¼é¬¼é¾é½ºé¦¬ä¹™ * ä¸¶ç“¦å·±ä¹™ååäº…ä¸¶äº…ä¹™ä¹™ä¹™å·±æ¯‹é¬¼é¬¼é¬¼é¾é½±é½ºé½ºé¬¼å * ä¹™ä¹™åååäº…ä¹™ç“¦ç“¦å·±æ—¥ç“¦æ¯‹é¬¼é¬¼é¾ é½±é½±é¾é¾é½±é½±æ¯‹ä¸¶ * äº…ååååä¹™ç“¦è»Šæ¯‹ç“¦ç“¦æ—¥è»Šé¦¬é¾ é¾é¾é¾é¾é¾é¾ é¾ é¾ é¦¬äº… * ååååå·±æ¯‹è»Šç“¦ç“¦ç“¦ç“¦é¬¼é¦¬é¾ é¾é¾ é¾ é¾é¾ é¾ é¾ é¦¬é¾ è»Š * äº…ååæ—¥æ¯‹ç“¦æ—¥æ—¥ç“¦é¬¼é¬¼é¬¼é¾ é¾ é¦¬é¦¬é¾ é¾é¾é¾ é¦¬é¦¬è»Š * äº…äº…äº…ä¹™ç“¦ç“¦æ¯‹è»Šè»Šè»Šé¦¬é¾é¾ é¬¼é¬¼é¦¬é¾ é¾é¾é¾ é¦¬é¦¬é¬¼ * ä¸¶ä¸¶ä¹™äº…äº…ä¹™è»Šé¬¼é¬¼é¬¼æ¯‹è»Šé¾é¾é¾ é¬¼é¦¬é¦¬é¾ é¾é½±é½±é¾é¦¬é¬¼ * äº…å·±ååå·±åæ—¥é¬¼é¬¼è»Šç“¦æ¯‹é¾ é¾é¾ é¦¬é¦¬é¾ é¾ é¾ é½±é½ºé½ºé½±é¾ é¬¼ * äº…ä¹™ä¹™ä¹™åè»Šé¦¬è»Šæ¯‹é¦¬é½±é½±é¾é¾ é¾ é¾ é¦¬é¾ é¾é½±é¾é¾ é¾ é¬¼ç“¦ * ä¸¶æ¯‹é¾ é¬¼è»Šç“¦è»Šé¦¬é¾ é¾é¾ é¾ é¾é½±é½±é¾ é¦¬é¦¬é¬¼æ¯‹æ—¥ * åä¹™å·±æ—¥å ä¸¶å·±é¬¼é¾é½±é½ºé½±é¾é¦¬é¦¬é¦¬è»Šæ¯‹å·± * ä¸¶åå·±ä¹™äº…ä¸¶ äº…ç“¦é¦¬é¾ é¾é¾ é¾ é¦¬æ¯‹ç“¦ä¹™ * ä¸¶ååä¹™äº…å äº…å·±ç“¦è»Šé¦¬é¾ é¬¼è»Šç“¦ä¹™ * ä¸¶åä¹™ååä¸¶ ä¸¶ä¸¶äº…åç“¦é¬¼è»Šç“¦å·± * ä¸¶äº…äº…ä¸¶ äº…æ—¥ç“¦æ—¥ * ä¸¶ */ ç‹—å¤´1 123456789101112131415161718192021222324252627282930313233343536373839/*** * .,:,,, .::,,,::. * .::::,,;;, .,;;:,,....:i: * :i,.::::,;i:. ....,,:::::::::,.... .;i:,. ......;i. * :;..:::;::::i;,,:::;:,,,,,,,,,,..,.,,:::iri:. .,:irsr:,.;i. * ;;..,::::;;;;ri,,,. ..,,:;s1s1ssrr;,.;r, * :;. ,::;ii;:, . ................... .;iirri;;;,,;i, * ,i. .;ri:. ... ............................ .,,:;:,,,;i: * :s,.;r:... ....................................... .::;::s; * ,1r::. .............,,,.,,:,,........................,;iir; * ,s;........... ..::.,;:,,. ...............,;1s * :i,..,. .,:,,::,. .......... .......;1, * ir,....:rrssr;:, ,,.,::. .r5S9989398G95hr;. ....,.:s, * ;r,..,s9855513XHAG3i .,,,,,,,. ,S931,.,,.;s;s&amp;BHHA8s.,..,..:r: * :r;..rGGh, :SAG;;G@BS:.,,,,,,,,,.r83: hHH1sXMBHHHM3..,,,,.ir. * ,si,.1GS, sBMAAX&amp;MBMB5,,,,,,:,,.:&amp;8 3@HXHBMBHBBH#X,.,,,,,,rr * ;1:,,SH: .A@&amp;&amp;B#&amp;8H#BS,,,,,,,,,.,5XS, 3@MHABM&amp;59M#As..,,,,:,is, * .rr,,,;9&amp;1 hBHHBB&amp;8AMGr,,,,,,,,,,,:h&amp;&amp;9s; r9&amp;BMHBHMB9: . .,,,,;ri. * :1:....:5&amp;XSi;r8BMBHHA9r:,......,,,,:ii19GG88899XHHH&amp;GSr. ...,:rs. * ;s. .:sS8G8GG889hi. ....,,:;:,.:irssrriii:,. ...,,i1, * ;1, ..,....,,isssi;, .,,. ....,.i1, * ;h: i9HHBMBBHAX9: . ...,,,rs, * ,1i.. :A#MBBBBMHB#s ....,,,;si. * .r1,.. ,..;3BMBBBHBB#Bh. .. ....,,,,,i1; * :h;.. .,..;,1XBMMMMBXs,.,, .. :: ,. ....,,,,,,ss. * ih: .. .;;;, ;;:s58A3i,.. ,. ,.:,,. ...,,,,,:,s1, * .s1,.... .,;sh, ,iSAXs;. ,. ,,.i85 ...,,,,,,:i1; * .rh: ... rXG9XBBM#M#MHAX3hss13&amp;&amp;HHXr .....,,,,,,,ih; * .s5: ..... i598X&amp;&amp;A&amp;AAAAAA&amp;XG851r: ........,,,,:,,sh; * . ihr, ... . .. ........,,,,,;11:. * ,s1i. ... ..,,,..,,,.,,.,,.,.. ........,,.,,.;s5i. * .:s1r,...................... ..............;shs, * . .:shr:. .... ..............,ishs. * .,issr;,... ...........................,is1s;. * .,is1si;:,....................,:;ir1sr;, * ..:isssssrrii;::::::;;iirsssssr;:.. * .,::iiirsssssssssrri;;:. */ ç‹—å¤´2 12345678910111213141516171819202122232425262728293031323334353637383940/*** * ii. ;9ABH, * SA391, .r9GG35&amp;G * &amp;#ii13Gh; i3X31i;:,rB1 * iMs,:,i5895, .5G91:,:;:s1:8A * 33::::,,;5G5, ,58Si,,:::,sHX;iH1 * Sr.,:;rs13BBX35hh11511h5Shhh5S3GAXS:.,,::,,1AG3i,GG * .G51S511sr;;iiiishS8G89Shsrrsh59S;.,,,,,..5A85Si,h8 * :SB9s:,............................,,,.,,,SASh53h,1G. * .r18S;..,,,,,,,,,,,,,,,,,,,,,,,,,,,,,....,,.1H315199,rX, * ;S89s,..,,,,,,,,,,,,,,,,,,,,,,,....,,.......,,,;r1ShS8,;Xi * i55s:.........,,,,,,,,,,,,,,,,.,,,......,.....,,....r9&amp;5.:X1 * 59;.....,. .,,,,,,,,,,,... .............,..:1;.:&amp;s * s8,..;53S5S3s. .,,,,,,,.,.. i15S5h1:.........,,,..,,:99 * 93.:39s:rSGB@A; ..,,,,..... .SG3hhh9G&amp;BGi..,,,,,,,,,,,,.,83 * G5.G8 9#@@@@@X. .,,,,,,..... iA9,.S&amp;B##@@Mr...,,,,,,,,..,.;Xh * Gs.X8 S@@@@@@@B:..,,,,,,,,,,. rA1 ,A@@@@@@@@@H:........,,,,,,.iX: * ;9. ,8A#@@@@@@#5,.,,,,,,,,,... 9A. 8@@@@@@@@@@M; ....,,,,,,,,S8 * X3 iS8XAHH8s.,,,,,,,,,,...,..58hH@@@@@@@@@Hs ...,,,,,,,:Gs * r8, ,,,...,,,,,,,,,,..... ,h8XABMMHX3r. .,,,,,,,.rX: * :9, . .:,..,:;;;::,.,,,,,.. .,,. ..,,,,,,.59 * .Si ,:.i8HBMMMMMB&amp;5,.... . .,,,,,.sMr * SS :: h@@@@@@@@@@#; . ... . ..,,,,iM5 * 91 . ;:.,1&amp;@@@@@@MXs. . .,,:,:&amp;S * hS .... .:;,,,i3MMS1;..,..... . . ... ..,:,.99 * ,8; ..... .,:,..,8Ms:;,,,... .,::.83 * s&amp;: .... .sS553B@@HX3s;,. .,;13h. .:::&amp;1 * SXr . ...;s3G99XA&amp;X88Shss11155hi. ,;:h&amp;, * iH8: . .. ,;iiii;,::,,,,,. .;irHA * ,8X5; . ....... ,;iihS8Gi * 1831, .,;irrrrrs&amp;@ * ;5A8r. .:;iiiiirrss1H * :X@H3s....... .,:;iii;iiiiirsrh * r#h:;,...,,.. .,,:;;;;;:::,... .:;;;;;;iiiirrss1 * ,M8 ..,....,.....,,::::::,,... . .,;;;iiiiiirss11h * 8B;.,,,,,,,.,..... . .. .:;;;;iirrsss111h * i@5,:::,,,,,,,,.... . . .:::;;;;;irrrss111111 * 9Bi,:,,,,...... ..r91;;;;;iirrsss1ss1111 */ æ»‘ç¨½ç¬‘è„¸ 12345678910111213141516171819202122232425262728293031323334/*** * .,, .,:;;iiiiiiiii;;:,,. .,, * rGB#HS,.;iirrrrriiiiiiiiiirrrrri;,s&amp;#MAS, * r5s;:r3AH5iiiii;;;;;;;;;;;;;;;;iiirXHGSsiih1, * .;i;;s91;;;;;;::::::::::::;;;;iS5;;;ii: * :rsriii;;r::::::::::::::::::::::;;,;;iiirsi, * .,iri;;::::;;;;;;::,,,,,,,,,,,,,..,,;;;;;;;;iiri,,. * ,9BM&amp;, .,:;;:,,,,,,,,,,,hXA8: ..,,,. * ,;&amp;@@#r:;;;;;::::,,. ,r,,,,,,,,,,iA@@@s,,:::;;;::,,. .;. * :ih1iii;;;;;::::;;;;;;;:,,,,,,,,,,;i55r;;;;;;;;;iiirrrr,.. * .ir;;iiiiiiiiii;;;;::::::,,,,,,,:::::,,:;;;iiiiiiiiiiiiri * iriiiiiiiiiiiiiiii;;;::::::::::::::::;;;iiiiiiiiiiiiiiiir; * ,riii;;;;;;;;;;;;;:::::::::::::::::::::::;;;;;;;;;;;;;;iiir. * iri;;;::::,,,,,,,,,,:::::::::::::::::::::::::,::,,::::;;iir: * .rii;;::::,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,::::;;iri * ,rii;;;::,,,,,,,,,,,,,:::::::::::,:::::,,,,,,,,,,,,,:::;;;iir. * ,rii;;i::,,,,,,,,,,,,,:::::::::::::::::,,,,,,,,,,,,,,::i;;iir. * ,rii;;r::,,,,,,,,,,,,,:,:::::,:,:::::::,,,,,,,,,,,,,::;r;;iir. * .rii;;rr,:,,,,,,,,,,,,,,:::::::::::::::,,,,,,,,,,,,,:,si;;iri * ;rii;:1i,,,,,,,,,,,,,,,,,,:::::::::,,,,,,,,,,,,,,,:,ss:;iir: * .rii;;;5r,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,sh:;;iri * ;rii;:;51,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.:hh:;;iir, * irii;::hSr,.,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,.,sSs:;;iir: * irii;;:iSSs:.,,,,,,,,,,,,,,,,,,,,,,,,,,,..:135;:;;iir: * ;rii;;:,r535r:...,,,,,,,,,,,,,,,,,,..,;sS35i,;;iirr: * :rrii;;:,;1S3Shs;:,............,:is533Ss:,;;;iiri, * .;rrii;;;:,;rhS393S55hh11hh5S3393Shr:,:;;;iirr: * .;rriii;;;::,:;is1h555555h1si;:,::;;;iirri:. * .:irrrii;;;;;:::,,,,,,,,:::;;;;iiirrr;, * .:irrrriiiiii;;;;;;;;iiiiiirrrr;,. * .,:;iirrrrrrrrrrrrrrrrri;:. * ..,:::;;;;:::,,. */ é”®ç›˜ 1234567891011121314151617/*** * â”Œâ”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” * â”‚Escâ”‚ â”‚ F1â”‚ F2â”‚ F3â”‚ F4â”‚ â”‚ F5â”‚ F6â”‚ F7â”‚ F8â”‚ â”‚ F9â”‚F10â”‚F11â”‚F12â”‚ â”‚P/Sâ”‚S Lâ”‚P/Bâ”‚ â”Œâ” â”Œâ” â”Œâ” * â””â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”˜ â””â”˜ â””â”˜ * â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” â”Œâ”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â” * â”‚~ `â”‚! 1â”‚@ 2â”‚# 3â”‚$ 4â”‚% 5â”‚^ 6â”‚&amp; 7â”‚* 8â”‚( 9â”‚) 0â”‚_ -â”‚+ =â”‚ BacSp â”‚ â”‚Insâ”‚Homâ”‚PUpâ”‚ â”‚N Lâ”‚ / â”‚ * â”‚ - â”‚ * â”œâ”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”€â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ * â”‚ Tab â”‚ Q â”‚ W â”‚ E â”‚ R â”‚ T â”‚ Y â”‚ U â”‚ I â”‚ O â”‚ P â”‚{ [â”‚} ]â”‚ | \ â”‚ â”‚Delâ”‚Endâ”‚PDnâ”‚ â”‚ 7 â”‚ 8 â”‚ 9 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”¬â”€â”€â”´â”€â”€â”€â”€â”€â”¤ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ + â”‚ * â”‚ Caps â”‚ A â”‚ S â”‚ D â”‚ F â”‚ G â”‚ H â”‚ J â”‚ K â”‚ L â”‚: ;â”‚" 'â”‚ Enter â”‚ â”‚ 4 â”‚ 5 â”‚ 6 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”¬â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â” â”œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â”¤ * â”‚ Shift â”‚ Z â”‚ X â”‚ C â”‚ V â”‚ B â”‚ N â”‚ M â”‚&lt; ,â”‚&gt; .â”‚? /â”‚ Shift â”‚ â”‚ â†‘ â”‚ â”‚ 1 â”‚ 2 â”‚ 3 â”‚ â”‚ * â”œâ”€â”€â”€â”€â”€â”¬â”€â”€â”´â”€â”¬â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”¬â”´â”€â”€â”€â”¼â”€â”€â”€â”´â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¤ â”Œâ”€â”€â”€â”¼â”€â”€â”€â”¼â”€â”€â”€â” â”œâ”€â”€â”€â”´â”€â”€â”€â”¼â”€â”€â”€â”¤ Eâ”‚â”‚ * â”‚ Ctrlâ”‚ â”‚Alt â”‚ Space â”‚ Altâ”‚ â”‚ â”‚Ctrlâ”‚ â”‚ â† â”‚ â†“ â”‚ â†’ â”‚ â”‚ 0 â”‚ . â”‚â†â”€â”˜â”‚ * â””â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”´â”€â”€â”€â”˜ */ ä½›ç¥–ä¿ä½‘ 123456789101112131415161718192021222324/*** * _ooOoo_ * o8888888o * 88" . "88 * (| -_- |) * O\ = /O * ____/`---'\____ * . ' \\| |// `. * / \\||| : |||// \ * / _||||| -:- |||||- \ * | | \\\ - /// | | * | \_| ''\---/'' | | * \ .-\__ `-` ___/-. / * ___`. .' /--.--\ `. . __ * ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". * | | : `- \`.;`\ _ /`;.`/ - ` : | | * \ \ `-. \_ __\ /__ _/ .-` / / * ======`-.____`-.___\_____/___.-`____.-'====== * `=---=' * * ............................................. * ä½›ç¥–ä¿ä½‘ æ°¸æ— BUG */ ä½›æ›° 123456789101112/*** * ä½›æ›°: * å†™å­—æ¥¼é‡Œå†™å­—é—´ï¼Œå†™å­—é—´é‡Œç¨‹åºå‘˜ï¼› * ç¨‹åºäººå‘˜å†™ç¨‹åºï¼Œåˆæ‹¿ç¨‹åºæ¢é…’é’±ã€‚ * é…’é†’åªåœ¨ç½‘ä¸Šåï¼Œé…’é†‰è¿˜æ¥ç½‘ä¸‹çœ ï¼› * é…’é†‰é…’é†’æ—¥å¤æ—¥ï¼Œç½‘ä¸Šç½‘ä¸‹å¹´å¤å¹´ã€‚ * ä½†æ„¿è€æ­»ç”µè„‘é—´ï¼Œä¸æ„¿é èº¬è€æ¿å‰ï¼› * å¥”é©°å®é©¬è´µè€…è¶£ï¼Œå…¬äº¤è‡ªè¡Œç¨‹åºå‘˜ã€‚ * åˆ«äººç¬‘æˆ‘å¿’ç–¯ç™«ï¼Œæˆ‘ç¬‘è‡ªå·±å‘½å¤ªè´±ï¼› * ä¸è§æ»¡è¡—æ¼‚äº®å¦¹ï¼Œå“ªä¸ªå½’å¾—ç¨‹åºå‘˜ï¼Ÿ */ ä½›ç¥–ç˜«ç—ª 1234567891011121314151617181920212223/*** * _ooOoo_ * o8888888o * 88" . "88 * (| -_- |) * O\ = /O * ___/`---'\____ * . ' \\| |// `. * / \\||| : |||// \ * / _||||| -:- |||||- \ * | | \\\ - /// | | * | \_| ''\---/'' | | * \ .-\__ `-` ___/-. / * ___`. .' /--.--\ `. . __ * ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". * | | : `- \`.;`\ _ /`;.`/ - ` : | | * \ \ `-. \_ __\ /__ _/ .-` / / * ======`-.____`-.___\_____/___.-`____.-'====== * `=---=' * ............................................. * ä½›æ›°ï¼šbugæ³›æ»¥ï¼Œæˆ‘å·²ç˜«ç—ªï¼ */ Fuck Bug 12345678910111213/*** * * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–’â–ˆ â–ˆâ–ˆ â–„â–ˆâ–ˆâ–ˆâ–ˆâ–„ â–ˆâ–ˆ â–„â–ˆâ–€ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— * â–“â–ˆâ–ˆ â–’ â–ˆâ–ˆ â–“â–ˆâ–ˆâ–’â–’â–ˆâ–ˆâ–€ â–€â–ˆ â–ˆâ–ˆâ–„â–ˆâ–’ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•â•â• * â–’â–ˆâ–ˆâ–ˆâ–ˆ â–‘â–“â–ˆâ–ˆ â–’â–ˆâ–ˆâ–‘â–’â–“â–ˆ â–„ â–“â–ˆâ–ˆâ–ˆâ–„â–‘ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ–ˆâ•— * â–‘â–“â–ˆâ–’ â–‘â–“â–“â–ˆ â–‘â–ˆâ–ˆâ–‘â–’â–“â–“â–„ â–„â–ˆâ–ˆâ–’â–“â–ˆâ–ˆ â–ˆâ–„ â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•‘ * â–‘â–’â–ˆâ–‘ â–’â–’â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–“ â–’ â–“â–ˆâ–ˆâ–ˆâ–€ â–‘â–’â–ˆâ–ˆâ–’ â–ˆâ–„ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• * â–’ â–‘ â–‘â–’â–“â–’ â–’ â–’ â–‘ â–‘â–’ â–’ â–‘â–’ â–’â–’ â–“â–’ â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• * â–‘ â–‘â–‘â–’â–‘ â–‘ â–‘ â–‘ â–’ â–‘ â–‘â–’ â–’â–‘ * â–‘ â–‘ â–‘â–‘â–‘ â–‘ â–‘ â–‘ â–‘ â–‘â–‘ â–‘ * â–‘ â–‘ â–‘ â–‘ â–‘ */ å“­è„¸ç¥å…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â” * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚ * â”‚ â”€â”¬â”˜ â””â”¬â”€ â”‚ * â”‚ â”‚ * â”‚ â”€â”´â”€ â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ * ç¥å…½ä¿ä½‘ * ä»£ç æ— BUG! */ å®³ç¾ç¥å…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â” * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚ * â”‚ &gt; &lt; â”‚ * â”‚ â”‚ * â”‚ ... âŒ’ ... â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ * ç¥å…½ä¿ä½‘ * ä»£ç æ— BUG! */ å¢¨é•œç¥å…½ 12345678910111213141516171819202122232425/*** * â”Œâ”€â” â”Œâ”€â” + + * â”Œâ”€â”€â”˜ â”´â”€â”€â”€â”€â”€â”€â”€â”˜ â”´â”€â”€â”++ * â”‚ â”‚ * â”‚ â”€â”€â”€ â”‚++ + + + * â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ”€â”€â”€â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ â”‚+ * â”‚ â”‚+ * â”‚ â”€â”´â”€ â”‚ * â”‚ â”‚ * â””â”€â”€â”€â” â”Œâ”€â”€â”€â”˜ * â”‚ â”‚ * â”‚ â”‚ + + * â”‚ â”‚ * â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” * â”‚ â”‚ * â”‚ â”œâ”€â” * â”‚ â”Œâ”€â”˜ * â”‚ â”‚ * â””â”€â” â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â” â”Œâ”€â”€â”˜ + + + + * â”‚ â”€â”¤ â”€â”¤ â”‚ â”€â”¤ â”€â”¤ * â””â”€â”€â”´â”€â”€â”˜ â””â”€â”€â”´â”€â”€â”˜ + + + + * ç¥å…½ä¿ä½‘ * ä»£ç æ— BUG! */ è™è  123456789101112131415161718192021/*** * ___====-_ _-====___ * _--^^^###// \\###^^^--_ * _-^#####// ( ) \\#####^-_ * -######// |\^^/| \\######- * _/######// (@::@) \\######\_ * /#######(( \\// ))#######\ * -########\\ (oo) //########- * -#########\\ / VV \ //#########- * -##########\\/ \//##########- * _#/|#####/\###( /\ )###/\#####|\#_ * |/ |#/\#/\#/\/ \#/\#\ | | /#/\#/ \/\#/\#/\#| \| * ` |/ V V ` V \#\| | | |/#/ V ' V V \| ' * ` ` ` ` / | | | | \ ' ' ' ' * ( | | | | ) * __\ | | | | /__ * (vvv(VVV)(VVV)vvv) * ç¥å…½ä¿ä½‘ * ä»£ç æ— BUG! */ é£å¤©é¾™ 123456789101112131415161718192021222324/*** * * * __----~~~~~~~~~~~------___ * . . ~~//====...... __--~ ~~ * -. \_|// |||\\ ~~~~~~::::... /~ * ___-==_ _-~o~ \/ ||| \\ _/~~- * __---~~~.==~||\=_ -_--~/_-~|- |\\ \\ _/~ * _-~~ .=~ | \\-_ '-~7 /- / || \ / * .~ .~ | \\ -_ / /- / || \ / * / ____ / | \\ ~-_/ /|- _/ .|| \ / * |~~ ~~|--~~~~--_ \ ~==-/ | \~--===~~ .\ * ' ~-| /| |-~\~~ __--~~ * |-~~-_/ | | ~\_ _-~ /\ * / \ \__ \/~ \__ * _--~ _/ | .-~~____--~-/ ~~==. * ((-&gt;/~ '.|||' -_| ~~-/ , . _|| * -_ ~\ ~~---l__i__i__i--~~_/ * _-~-__ ~) \--______________--~~ * //.-~~~-~_--~- |-------~~~~~~~~ * //.-~~~--\ * ç¥å…½ä¿ä½‘ * ä»£ç æ— BUG! */ çŒª 123456789101112131415/*** _ * _._ _..._ .-', _.._(`)) * '-. ` ' /-._.-' ',/ * ) \ '. * / _ _ | \ * | a a / | * \ .-. ; * '-('' ).-' ,' ; * '-; | .' * \ \ / * | 7 .__ _.-\ \ * | | | ``/ /` / * /,_| | /,_/ / * /,_/ '`-' */ éª·é«…å¤´ 123456789101112131415161718192021222324/*** ************************************************************** * * * .=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-. * * | ______ | * * | .-" "-. | * * | / \ | * * | _ | | _ | * * | ( \ |, .-. .-. ,| / ) | * * | &gt; "=._ | )(__/ \__)( | _.=" &lt; | * * | (_/"=._"=._ |/ /\ \| _.="_.="\_) | * * | "=._"(_ ^^ _)"_.=" | * * | "=\__|IIIIII|__/=" | * * | _.="| \IIIIII/ |"=._ | * * | _ _.="_.="\ /"=._"=._ _ | * * | ( \_.="_.=" `--------` "=._"=._/ ) | * * | &gt; _.=" "=._ &lt; | * * | (_/ \_) | * * | | * * '-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=-=' * * * * LASCIATE OGNI SPERANZA, VOI CH'ENTRATE * ************************************************************** */ å¦ˆå¦ˆå†çˆ±æˆ‘ä¸€æ¬¡ 123456789101112131415161718192021222324252627282930313233/*** * ,s555SB@@&amp; * :9H##@@@@@Xi * 1@@@@@@@@@@@@@@8 * ,8@@@@@@@@@B@@@@@@8 * :B@@@@X3hi8Bs;B@@@@@Ah, * ,8i r@@@B: 1S ,M@@@@@@#8; * 1AB35.i: X@@8 . SGhr ,A@@@@@@@@S * 1@h31MX8 18Hhh3i .i3r ,A@@@@@@@@@5 * ;@&amp;i,58r5 rGSS: :B@@@@@@@@@@A * 1#i . 9i hX. .: .5@@@@@@@@@@@1 * sG1, ,G53s. 9#Xi;hS5 3B@@@@@@@B1 * .h8h.,A@@@MXSs, #@H1: 3ssSSX@1 * s ,@@@@@@@@@@@@Xhi, r#@@X1s9M8 .GA981 * ,. rS8H#@@@@@@@@@@#HG51;. .h31i;9@r .8@@@@BS;i; * .19AXXXAB@@@@@@@@@@@@@@#MHXG893hrX#XGGXM@@@@@@@@@@MS * s@@MM@@@hsX#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&amp;, * :GB@#3G@@Brs ,1GM@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@B, * .hM@@@#@@#MX 51 r;iSGAM@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@8 * :3B@@@@@@@@@@@&amp;9@h :Gs .;sSXH@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@: * s&amp;HA#@@@@@@@@@@@@@@M89A;.8S. ,r3@@@@@@@@@@@@@@@@@@@@@@@@@@@r * ,13B@@@@@@@@@@@@@@@@@@@5 5B3 ;. ;@@@@@@@@@@@@@@@@@@@@@@@@@@@i * 5#@@#&amp;@@@@@@@@@@@@@@@@@@9 .39: ;@@@@@@@@@@@@@@@@@@@@@@@@@@@; * 9@@@X:MM@@@@@@@@@@@@@@@#; ;31. H@@@@@@@@@@@@@@@@@@@@@@@@@@: * SH#@B9.rM@@@@@@@@@@@@@B :. 3@@@@@@@@@@@@@@@@@@@@@@@@@@5 * ,:. 9@@@@@@@@@@@#HB5 .M@@@@@@@@@@@@@@@@@@@@@@@@@B * ,ssirhSM@&amp;1;i19911i,. s@@@@@@@@@@@@@@@@@@@@@@@@@@S * ,,,rHAri1h1rh&amp;@#353Sh: 8@@@@@@@@@@@@@@@@@@@@@@@@@#: * .A3hH@#5S553&amp;@@#h i:i9S #@@@@@@@@@@@@@@@@@@@@@@@@@A. * * * åˆçœ‹æºç ï¼Œçœ‹ä½ å¦¹å¦¹å‘€ï¼ */ åˆéŸ³ 12345678910111213141516171819202122232425/*** *_______________#####_______________________ *______________######_____________________ *______________#######____________________ *_____________#__######___________________ *____________##__###_###__________________ *____________##_####___##_________________ *___________##__#####_##________________ *__________##__######_##_______________ *________###___######__###_____________ *_______###___##_####___###___________ *_______###___##___####___###_________ *______###___##__######___###_______ *_____###___##_#######__###______ *____####__###########_####_____ *____####__###############____ *___####__###_#########_####___ *___####__###_###_#####___###___ *___####____#__###___###_____###___ *___####________###____###_____###____ *____###________###_____###_____##_____ *_____###________##______###_____##______ *______###______;##________##______#________ *________#_______##________##______________ */ æ”»åŸæ¹¿ 123456789101112131415161718192021/*** * ,%%%%%%%%, * ,%%/\%%%%/\%% * ,%%%\c "" J/%%% * %. %%%%/ o o \%%% * `%%. %%%% _ |%%% * `%% `%%%%(__Y__)%%' * // ;%%%%`\-/%%%' * (( / `%%%%%%%' * \\ .' | * \\ / \ | | * \\/ ) | | * \ /_ | |__ * (___________))))))) æ”»åŸæ¹¿ * * _ _ * __ _(_)_ _(_) __ _ _ __ * \ \ / / \ \ / / |/ _` |'_ \ * \ V /| |\ V /| | (_| | | | | * \_/ |_| \_/ |_|\__,_|_| |_| */ æ˜é‡‘ 1234567891011121314151617181920212223/*** * https://gold.xitu.io/ * ï¼‘ï¼‘ï¼‘ ï¼‘ * ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ * ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ï¼‘ */ çŸ¥ä¹ 123456789101112131415161718192021222324/*** * https://www.zhihu.com/ * _____ _____ _____ _____ * /\ \ /\ \ /\ \ /\ \ * /::\____\ /::\ \ /::\ \ /::\ \ * /:::/ / \:::\ \ /::::\ \ /::::\ \ * /:::/ / \:::\ \ /::::::\ \ /::::::\ \ * /:::/ / \:::\ \ /:::/\:::\ \ /:::/\:::\ \ * /:::/____/ \:::\ \ /:::/__\:::\ \ /:::/__\:::\ \ * /::::\ \ /::::\ \ /::::\ \:::\ \ /::::\ \:::\ \ * /::::::\ \ _____ ____ /::::::\ \ /::::::\ \:::\ \ /::::::\ \:::\ \ * /:::/\:::\ \ /\ \ /\ \ /:::/\:::\ \ /:::/\:::\ \:::\____\ /:::/\:::\ \:::\ \ * /:::/ \:::\ /::\____\/::\ \/:::/ \:::\____\/:::/ \:::\ \:::| |/:::/__\:::\ \:::\____\ * \::/ \:::\ /:::/ /\:::\ /:::/ \::/ /\::/ |::::\ /:::|____|\:::\ \:::\ \::/ / * \/____/ \:::\/:::/ / \:::\/:::/ / \/____/ \/____|:::::\/:::/ / \:::\ \:::\ \/____/ * \::::::/ / \::::::/ / |:::::::::/ / \:::\ \:::\ \ * \::::/ / \::::/____/ |::|\::::/ / \:::\ \:::\____\ * /:::/ / \:::\ \ |::| \::/____/ \:::\ \::/ / * /:::/ / \:::\ \ |::| ~| \:::\ \/____/ * /:::/ / \:::\ \ |::| | \:::\ \ * /:::/ / \:::\____\ \::| | \:::\____\ * \::/ / \::/ / \:| | \::/ / * \/____/ \/____/ \|___| \/____/ */ freebuf 1234567891011121314151617181920212223242526272829/*** * http://www.freebuf.com/ * _.._ ,------------. * ,' `. ( We want you! ) * / __) __` \ `-,----------' * ( (`-`(-') ) _.-' * /) \ = / ( * /' |--' . \ * ( ,---| `-.)__` * )( `-.,--' _`-. * '/,' ( Uu", * (_ , `/,-' ) * `.__, : `-'/ /`--' * | `--' | * ` `-._ / * \ ( * /\ . \. freebuf * / |` \ ,-\ * / \| .) / \ * ( ,'|\ ,' : * | \,`.`--"/ } * `,' \ |,' / * / "-._ `-/ | * "-. "-.,'| ; * / _/["---'""] * : / |"- ' * ' | / * ` | */ Alibaba 12345678910111213141516171819202122232425262728293031323334353637/*** * https://campus.alibaba.com/ * `:::::::::::, * `::;:::::::;:::::::, ` * `::;;:::::::@@@@;:::::::` * ,:::::::::::::@ #@':::::` * :::::::::::::::'@@ @;:::: * ::::::::::::'@@@@'``` .+:::` * ::::::::::;@@@#. ,:::, * .::::::::+@#@` :::: * :::::::+@@' :::: * `:::::'@@: `:::. * ,::::@@: ` :::: * ;::::::@ .:::; * :;:::::;@` ` :::; * :::::::::@` @ ;:::: * :::::::::#` @` ,:::: * :::::::::@` +@ @ .::::` * .::::::'@@` `@@' @ ::::, * :::::::++@@@@@@@@@@. ::::; * ;:::::::+, `..` ::::: * ,::::::::', ::::: * :::::::::+, :::::` * :::::::::+@. ,::::.` `, * ::::::;;@+ .::;:: `; * :::::::@@ `:::;: `::`` * ::::::#@ ;:::: .::` * :::::;@ :::::` .;::` * :::::@ `:;::: `::::; * :::::# :::::. `,;::::: * :::::: ` ::::::,.,::::::::::. * ,::::::` .:: ::::::::::::::::;` * ;::::::::,````.,:::::, ::::::::::::::. * :::::::::::::::::: ` `::::::::::` * `::::::::::::, .:::. * `..` */ å°è€é¼  123456789101112131415/*** * http://www.flvcd.com/ * .--, .--, * ( ( \.---./ ) ) * '.__/o o\__.' * {= ^ =} * &gt; - &lt; * / \ * // \\ * //| . |\\ * "'\ /'"_.-~^`'-. * \ _ /--' ` * ___)( )(___ * (((__) (__))) é«˜å±±ä»°æ­¢,æ™¯è¡Œè¡Œæ­¢.è™½ä¸èƒ½è‡³,å¿ƒå‘å¾€ä¹‹ã€‚ */ é¡¶ 12345678910111213141516/*** * é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚é ‚é ‚é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚é ‚ é ‚é ‚ * é ‚é ‚ é ‚é ‚é ‚ * é ‚é ‚ é ‚é ‚ é ‚é ‚ é ‚é ‚ * é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚é ‚ * é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚ é ‚é ‚é ‚é ‚ */ å•èº«ç‹—çš„å‡è§† 123456789101112131415/*** * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–‘â–‘ * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–€â–’â–Œâ–‘ * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–€â–’â–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–„â–€â–’â–’â–’â– * â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–â–„â–€â–’â–’â–€â–€â–€â–€â–„â–„â–„â–€â–’â–’â–’â–’â–’â– * â–‘â–‘â–‘â–‘â–‘â–„â–„â–€â–’â–‘â–’â–’â–’â–’â–’â–’â–’â–’â–’â–ˆâ–’â–’â–„â–ˆâ–’â– * â–‘â–‘â–‘â–„â–€â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–€â–ˆâ–ˆâ–€â–’â–Œ * â–‘â–‘â–â–’â–’â–’â–„â–„â–’â–’â–’â–’â–‘â–‘â–‘â–’â–’â–’â–’â–’â–’â–’â–€â–„â–’â–’ * â–‘â–‘â–Œâ–‘â–‘â–Œâ–ˆâ–€â–’â–’â–’â–’â–’â–„â–€â–ˆâ–„â–’â–’â–’â–’â–’â–’â–’â–ˆâ–’â– * â–‘â–â–‘â–‘â–‘â–’â–’â–’â–’â–’â–’â–’â–’â–Œâ–ˆâ–ˆâ–€â–’â–’â–‘â–‘â–‘â–’â–’â–’â–€â–„ * â–‘â–Œâ–‘â–’â–„â–ˆâ–ˆâ–„â–’â–’â–’â–’â–’â–’â–’â–’â–’â–‘â–‘â–‘â–‘â–‘â–‘â–’â–’â–’â–’ * â–€â–’â–€â–â–„â–ˆâ–„â–ˆâ–Œâ–„â–‘â–€â–’â–’â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–’â–’â–’ * å•èº«ç‹—å°±è¿™æ ·é»˜é»˜åœ°çœ‹ç€ä½ ï¼Œä¸€å¥è¯ä¹Ÿä¸è¯´ã€‚ */ åŸƒåŠæ³•è€ 1234567891011121314151617181920212223242526272829303132333435/*** * /88888888888888888888888888\ * |88888888888888888888888888/ * |~~____~~~~~~~~~"""""""""| * / \_________/"""""""""""""\ * / | \ \ * / | 88 88 \ \ * / | 88 88 \ \ * / / \ | * / | ________ \ | * \ | \______/ / | * /"\ \ \____________ / | * | |__________\_ | | / / * /""""\ \_------' '-------/ -- * \____/,___________\ -------/ * ------* | \ * || | \ * || | ^ \ * || | | \ \ * || | | \ \ * || | | \ \ * \| / /"""\/ / * ------------- | | / * |\--_ \____/___/ * | |\-_ | * | | \_ | * | | \ | * | | \_ | * | | ----___ | * | | \----------| * / | | ----------""\ * /"\--"--_| | | \ * |_______/ \______________/ ) * \___/ */ è€¶ 123456789101112131415161718192021222324252627282930313233343536/*** * d*#$. * zP"""""$e. $" $o * 4$ '$ $" $ * '$ '$ J$ $F * 'b $k $&gt; $ * $k $r J$ d$ * '$ $ $" $~ * '$ "$ '$E $ * $ $L $" $F ... * $. 4B $ $$$*"""*b * '$ $. $$ $$ $F * "$ R$ $F $" $ * $k ?$ u* dF .$ * ^$. $$" z$ u$$$$e * #$b $E.dW@e$" ?$ * #$ .o$$# d$$$$c ?F * $ .d$$#" . zo$&gt; #$r .uF * $L .u$*" $&amp;$$$k .$$d$$F * $$" ""^"$$$P"$P9$ * JP .o$$$$u:$P $$ * $ ..ue$" "" $" * d$ $F $ * $$ ....udE 4B * #$ """"` $r @$ * ^$L '$ $F * RN 4N $ * *$b d$ * $$k $F * $$b $F * $"" $F * '$ $ * $L $ * '$ $ * $ $ */ å°å¼ç”µè„‘ 1234567891011121314151617181920/*** * ,----------------, ,---------, * ,-----------------------, ," ,"| * ," ,"| ," ," | * +-----------------------+ | ," ," | * | .-----------------. | | +---------+ | * | | | | | | -==----'| | * | | I LOVE DOS! | | | | | | * | | Bad command or | | |/----|`---= | | * | | C:\&gt;_ | | | ,/|==== ooo | ; * | | | | | // |(((( [33]| ," * | `-----------------' |," .;'| |(((( | ," * +-----------------------+ ;; | | |," * /_)______________(_/ //' | +---------+ * ___________________________/___ `, * / oooooooooooooooo .o. oooo /, \,"----------- * / ==ooooooooooooooo==.o. ooo= // ,`\--{)B ," * /_==__==========__==_ooo__ooo=_/' /___________," * */ ä¹¦æœ¬ 123456789101112/*** * .-~~~~~~~~~-._ _.-~~~~~~~~~-. * __.' ~. .~ `.__ * .'// \./ \\`. * .'// | \\`. * .'// .-~"""""""~~~~-._ | _,-~~~~"""""""~-. \\`. * .'//.-" `-. | .-' "-.\\`. * .'//______.============-.. \ | / ..-============.______\\`. * .'______________________________\|/______________________________`. * */ äººç”Ÿ 12345678910111213141516171819202122/** * å‡ºç”Ÿ * || * || * \ / * \/ * é’å¹´ * ï¼ˆå¹´é¾„ = rand(20,25))ï¼‰ ã€Š============== * || || * || || * || ç¥ç¦æ‰€æœ‰å¼€å‘å·¥ä½œè€… || * || æ°¸è¿œå¹´è½» || * || || * \ / || * \/ || *ï¼ˆ 20 &lt;= å¹´é¾„ &lt;= 25ï¼‰ =============== * || * || * \ / * \/ * ç­‰æ­»çŠ¶æ€ */ æ¯”å…‹å¤§é­”ç‹ 12345678910111213141516171819202122232425/* _.---..._ ./^ ^-._ ./^C===. ^\. /\ .|' \\ _ ^|.^.| ___.--'_ ( ) . ./ /|| /.---^T\ , | / /||| C' ._`| ._ / __,-/ / /-,|| \ \/ ; /O / _ |) )|, i \./^O\./_,-^/^ ,;-^,' \ |`--/ ..-^^ |_-^ `| \^- /|: i. .-- / '|. i ==' /' |\._ _./`._ // |. ^-ooo.._ _.oo../' | ^-.__./X/ . `| |####b d## |' ^^^^ / | _\#### ###b ^^^^^^^^--. ...--^--^^^^^^^_.d### ###b._ Y _.d##### #####b._ | _.d####### "Piccolo" no. 2 (from Dragonball Z) --- Steven J. Simmons */ Fuck you 123456789101112131415161718192021/* * .::::. * .::::::::. * ::::::::::: FUCK YOU * ..:::::::::::' * '::::::::::::' * .:::::::::: * '::::::::::::::.. * ..::::::::::::. * ``:::::::::::::::: * ::::``:::::::::' .:::. * ::::' ':::::' .::::::::. * .::::' :::: .:::::::'::::. * .:::' ::::: .:::::::::' ':::::. * .::' :::::.:::::::::' ':::::. * .::' ::::::::::::::' ``::::. * ...::: ::::::::::::' ``::. * ```` ':. ':::::::::' ::::.. * '.:::::' ':'````.. */ å›´æ£‹ 12345678910111213141516171819202122232425262728293031323334 // _______________________________________ // / ___________________________________ \// _--""""--_ / /_/_/_/_/_|_|_|_|_|_|_|_|_|_\_\_\_\_\ \// / \ / /_/_/_/_J__L_L_L_|_|_|_J_J_J__L_\_\_\_\ \// /\ /\ / /_/_/_J__L_J__L_L_|_|_|_J_J__L_J__L_\_\_\ \// L ""-____-"" J / /_/_J__L_J__L_J_J__L_|_J__L_L_J__L_J__L_\_\ \// \ / / /_/__L_/__L_J__L_J__L_|_J__L_J__L_J__\_J__\_\ \// \_ _/ / /_J__/_J__/__L_J__|__L_|_J__|__L_J__\__L_\__L_\ \// _--"""""--_" / / F / F J J | F J | F J | F F J \ J \ \// / \ / /--/-J--/--L--|--L-J--J--|--L--L-J--|--J--\--L-\--\ \///\ /\ / /__/__L_J__J___L_J__J__|__|__|__L__L_J___L__L_J__\__\ \//L ""-_____-"" J / / / / F F J J | | | | | F F J J \ \ \ \//\ / / /--/--/--/--J---L--|--|--|--o--|--|--|--J---L--\--\--\--\ \// \_ _/ / /__/__J__J___L__J___L__L__L__|__J__J__J___L__J___L__L__\__\ \// "--___--" / / / F F J F J J F | J F F J F J J \ \ \// / /--/---/--J---L--J---L--|--J---|---L--|--J---L--J---L--\---\--\ \// / /__J___/___L__/___L__J___L__J___|___L__J___L__J___\__J___\___L__\ \// / / F J / J J | J J | F F | F F \ F J \ \// / /---/---L--J---L---L---L--|---|---|---|---|--J---J---J---L--J---\---\ \// / /___/___/___L__J___J___J___|___|___|___|___|___L___L___L__J___\___\___\ \// / / / / / F F F F F | J J J J J \ \ \ \ \// / /___/___J___J___J___J___J____L___L___|___J___J____L___L___L___L___L___\___\ \// / / / F F F | | J F | J F | | J J J \ \ \// / /___J____/___/___J____L___L___|___J____|____L___|___J___J____L___\___\____L___\ \// / / F / J F J J | J | F | F F J F \ J \ \// / /____/___J____L___/____L___|____L___|____|____|___J____|___J____\___J____L___\____\ \// / / / F / J J F J F | J F J F F \ J \ \ \// / /____/____/___J____L____|____L___J____L____|____J____L___J____|____J____L___\____\____\ \// / \///_______________________________________________________________________________________________\//| |//| hs |//|_______________________________________________________________________________________________| å±…ä¸­çš„ä½›ç¥– 1234567891011121314151617181920212223/* _ooOoo_ o8888888o 88" . "88 (| -_- |) O\ = /O ____/`---'\____ .' \\| |// `. / \\||| : |||// \ / _||||| -:- |||||- \ | | \\\ - /// | | | \_| ''\---/'' | | \ .-\__ `-` ___/-. / ___`. .' /--.--\ `. . __ ."" '&lt; `.___\_&lt;|&gt;_/___.' &gt;'"". | | : `- \`.;`\ _ /`;.`/ - ` : | | \ \ `-. \_ __\ /__ _/ .-` / /======`-.____`-.___\_____/___.-`____.-'====== `=---='^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ ä½›ç¥–ä¿ä½‘ æ°¸æ— BUG*/ windowså›¾æ ‡ 123456789101112131415161718/* __ ,-~Â¨^ ^Â¨-, _, / / ;^-._...,Â¨/ / / / / / / / / / / / / /,.-:''-,_ / / / _,.-:--._ ^ ^:-._ __../ /^ / /Â¨:.._Â¨__.; / / / ^ / / / / / / / / / /_,.--:^-._/ / /^ ^Â¨Â¨-.___.:^ (R) - G33K */ ä¸ƒé¾™ç æ¯”å…‹ 1234567891011121314151617181920212223242526/* /^_.-^ _ --^=_ ./'-^__ _&gt;=\^^==^-. |'/^^_/ /^ \ \.^\\\/\ ,|/| ' /' _____\ `\|.^.| |'/ /_--^^ . ^^-./ /|| |/,--^ , | / /||' ._|/ \ / __,-/ / /-,|| \ '/ ; /O / _ |) )|, i \./^O\./_,-^/^ ,;-^,' \ |`--/ ..-^^ |_-^ `| \^-_,/^Y\ | ^^\ _i. \".--V_/ /| \. ^\._____...--.&gt;^^^^^^-------...._ / i ^--^^ /'|' |\. |./' | ;___...----/^^^^---|. `._\ /^ /' |'_/' \ `| |' ,/' |' \ _|^-.__./'__.^^\ .| ,| _.-^ `\ ,|`_./^^-----^^._ ` ./ / /^ _.-^^/ |' ^ /-^ ./^ /\ `\_ __.-&lt; _,/ ./' |' `\. `i ^^--/._____...--^ . ./ |. `| | / / `| "Piccolo" (from Dragonball Z) --- Steven J. Simmons */ ä¸ƒé¾™ç æ‚Ÿç©º 123456789101112131415161718192021222324252627282930313233/* _ \"-._ _.--"~~"--._ \ " ^. ___ / \.-~_.-~ .-----' /\/"\ /~-._ / / __ _/\-.__\L_.-/\ "-. /.-" \ ( ` \_o&gt;"&lt;o_/ \ .--._\ /' \ \: " :/_/ "` / /\ "\ ~ /~" \ I \/]"-._ _.-"[ ___ \|___/ ./ l \___ ___ .--v~ "v` ( `-.__ __.-' ) ~v" ~v--. .-{ | : \_ "~" _/ : | }-. / \ | ~-.,___,.-~ | / \ ] \ | | / [ /\ \| : : |/ /\ / ^._ _K.___,^ ^.___,K_ _.^ \ / / "~/ "\ /" \~" \ \ / / / \ _ : _ / \ \ \ .^--./ / Y___________l___________Y \ \.--^. [ \ / | [/ ] | \ / ] | "v" l________[____/]________j -Row }r" / }------t / \ /`-. / | | Y Y / "-._/ }-----v' | : | 7-. / | |_| | l | / . "-._/ l .[_] : \ : r[]/_. / \_____] "--. "-.____/ "Dragonball Z" ---Row */ è¶…çº§èµ›äºšäºº 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134/* MMMMM MMMMMM MMMMMMM MMMMMMMM . MMMMMMMMM HMMMMMMMMMM MMMMMMMMMMMM M MMMMMMMMMMMMM M MMMMMMMMMMMMM M MMMMMMMMMMMMM: oMMMMMMMMMMMMMM .MMMMMMMMMMMMMMo MMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMM. oMMMMMMMMMMMMMMM.M MMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM oMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM: H MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM . MMM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMM .MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMMMMMM MM. MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM M MMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM .MMMMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MM MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM .MMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMM.MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM HMMMMMMMMMMMMMMMMMMMMM.MMMMMMMMM.MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM MMM.oMMMMMMM..MMMMMMMMM:MMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMM MM..MMMMMMM...MMMMMMM. MMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM ..MMMMMM...MMMMMM ..MMMMMMMMMMMMMMMMMMM MMMMMMM:M.MMM.M.. MMMMM M..MMMMM...MMMMMMMMMMMMMMMMMM MMM MMMM. .M..MM.M...MMMMMM..MMMMM.. MMMMMMMMMMMMMMMMMMMMMMMMMMMMMM . MMMM..M....M.....:MMM .MMMMMM..MMMMMMM...MMMMMMMMMMMMMMMMMMMMMMMMMMMMMMM MMM.M.. ...M......MM.MMMMM.......MHM.M .MMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMM..MM. . MMM.....MMMMMM.M.....M ..MM..M MMMMMMMMMMMMMMMMMMM .MMMMMHMM. ..MMMM. MMM............o..... . .MMMMMMMMMMMMMMM MMM. M... .........................M..:.MMMMMMMMMMMM oMMM............ .................M.M.MMMMMMMMM .....MM........................ . MMMMMM M.....M.....................o.MM.MMMMMMMM. M........................M.. ...MMMMMMMMMMMMMo :....MMM..............MMM..oMMMMMMM M...MMM.............MMMMMMM .............:MMMMMMMM M..... MMM.....M M M............. ................M ooM.................MM MoMMMMMoooM MMoooM......................MoooooooH..oMM MHooooMoM.....................MMooooooM........M oooooooMoooM......... o........MoooooooM............ Mooooooooooo.......M.........Moooooooo:..............M MooMoooooooooM...M........:Mooooooooooo:..............M M..oooooooooooo .........Mooooooooooooooo..............M M...Mooo:oooooooo.M....ooooooooooooooooooo..M...........M ...oooooMoooooooM..Mooooooooooooo:oooooooM.M...........M. M...ooooooMoo:ooooMoooooooooooooHoooooooooH:M. ...........: M..MoooooooMoooooooooooooooooo:ooooooMooooMoM..............M M..ooooooooooMooooooooooooooHoooooooMooHooooM...............M ...ooooooooooooooooooo:MooooooooooooooMoMoooM................ M...oooooooooooooooooooooooooooooooooooooMooMM................M ...MooooooooooooooooooooooooooooooooooooooooMo ................ ...MooooooooooooooooooooooooooooooooooooooooM M................M M...ooooooooooooooooooooooooooooooooooooooooM ................M ...MoooooooooooooooooooooooooooooooooooooooMM .:............... .....MooooooooooooooooooooooooooooooooooooMoo .............M M...... ooooooooooooooooooooooooooooooooooooM M..............M M........MooooMMM MM MM MMMMMMMMMooooooooM M...............M .........HM M: MM :MMMMMM M M............... M..........M M MoM M M................M M.........:M MoH M M M MooooHoooMM. M M...............M M..........Moooo MMooM oooooMooooooooM M..............H M.........MooooM Mooo : ooooooMooooMoooM M........ . .o.M H.. .....ooooo oooo M MooooooooooooooM M... MMMMMMMMMMM MMMMMMMMMMooooM M oooo . ooooooMooooooooM .MMMMMMMMMMMMMMM MMMMMMMMMMooooH : ooooH oooooooooooooooo MMMMMMMMMMMMMMM MMMMMMMMMMoooo ooooM Moooooooooooooooo .MMMMMMMMMMMMMMM MMMMMMMMMMoooo ooooM MooooooooooooooooM MMMMMMMMMMMMMMM MMMMMMMMMMoooM ooooM ooooooooooooooooo MMMMMMMMMMM:M MMMMMMMMMMoooM MooooM oooooooooooMoooooo MH........... . ......Mooo. MooooM oooooooooooooooooo M............M M.M......oooo MooooM Moooooooooooooooooo: .........M..... M.M.....Moooo MooooM ooooooooooooooooooM .M............ .......MooooH MooooM oooooooooMoooooooooo M..o...M..o....M .o....HMooooM MooooH MooooooooMooooooooooM .:M...M.......M M..M.....MoooM :oooo: .MooooooooHooMoooooooooM M M... ..oM.M M...M.:.Mooo. MMMMooooo oooooooooooMoooooooooooooM ....M. M M:M..o.Moooooooooooooo MooooooooooooooMooooooooooooM .Mo MooooooooooooooMooooooooooooMoMoooooooooooooo Mooooooooooooooo:ooooooooooooooooooooooooooooo ooooooooooooooooMooooooooooMoooooooooooooooooo ooooooooooooooooMoooooooooooMooooooooooooooooHo ooMooooooooooooooMoooooooooooooooooooooooooooMoM MooMoooooooooooooo.ooooooooooooooooooooooooooo:oM MoooooooooooooooooooooooooooooooooooooooooooooooM MoooMooooooooooooooMooooooooooooooooooooooooooooo. MoooMooooooooooooooMoooooooooooooooooooooooooMooooM MooooooooooooooooooMoooooooooooooooooooooooooMoooooM MooooMoooooooooooooMoooooooooooooooooooooooooMoHooooM ooooooMooooooooooooooooooooooooooooooooooooooooMoMoooM MooooooooooooooooooooMooooooooooooooooooooooooooMoooooH: MoooooooMooooooooooooMoooooooooooooooooooooooooooooHoooM MooooooooMoooooooooooMoooooooooooooooooooooooooMoooMooooM Moooooooooooooooooooooooooooooooooooooooooooooo.oooMooooo MoooooooooooooooooooooooooooooooooooooooooooooMoooooooooM MooooooooooooooooooooMoooooooooooooooooooooooooooooooooM MooooooooooooooooooooMHooooooooooooooooooooMoooo:ooooo MMooooooooooooooooooMoMHoooooooooooooooooooooooMooooo MMoooooooooooooooMMooo MMooooooooooooooooooooooooooM MMMoooooooooooooMooooo oooooooooooooooooooooMooooo MooMMoooooooooMoooMMoM ooooHooooooooooooooooMooooM MooooMooooooMooooMoooM MoooooMoooooooooooooMooooo ooooooMMooooooooMooooM MoooooooooMooooooooooooooM HooooooMoooooooMooooM HoooooooHooMooooooooooooo oooMoooooooooHoooM MoooooooooMoooooooooM HooooooooooooHM MooooooooMMoooooooM MMMMMMMMMMMMMM Moooooo:MooooHMM MMMMMMM: ... MMMMMMMMMMMMMM M............M MMMMMMMMM .... M.MM.......... M.............M M ..............MM M.............. MMMMM............MMMM ..MMMMMMMM ....M MMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMM...M .MMMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMMMMMM :MMMMMMMMMMMMMMMMMMH MMMMMMMMMMMMMMMMMMM By EBEN JÃ©rÃ´me MMMMMMMMMMMMMMMMMM MMMMMMMMMMMMMMM HMMMMMM */ çš®å¡ä¸˜ 123456789101112131415161718192021222324252627282930313233343536373839404142/*quu..__ $$$b `---.__ "$$b `--. ___.---uuudP `$$b `.__.------.__ __.---' $$$$" . "$b -' `-.-' $$$" .'| ". d$" _.' | `. / ..." .' | `./ ..::-' _.' | / .:::-' .-' .' : ::''\ _.' | .' .-. .-. `. .' | : /'$$| .@"$\ `. .' _.-' .'|$u$$| |$$,$$| | &lt; _.-' | `:$$:' :$$$$$: `. `. .-' : `"--' | `-. \ :#. == .##. `. `. `\ |#: :##: | &gt; &gt; |#' `..'`..' `##' x: / / \ xXX| / ./ \ xXXX'| / ./ /`-. `. / / : `- ..........., | / .' | ``:::::::' . |&lt; `. | ``` | x| \ `.:``. | .' /' xXX| `:`M`M':. | | ; /:' xXXX'| -'MMMMM:' `. .' : /:' |-'MMMM.-' | | .' /' .'MMM.-' `'`' : ,' |MMM&lt; | `' |tbap\ \ :MM.-' \ | .'' \. `. / / .:::::::.. : / | .:::::::::::`. / | .:::------------\ / / .'' &gt;::' / `',: : .' `:.:' */ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>SpringBoot</category>
      </categories>
      <tags>
        <tag>SpringBoot</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Nginxåº”ç”¨åœºæ™¯]]></title>
    <url>%2Fposts%2Fcd76424b.html</url>
    <content type="text"><![CDATA[åå‘ä»£ç† åå‘ä»£ç†ï¼šç®€å•æ¥è¯´å°±æ˜¯çœŸå®çš„æœåŠ¡å™¨ä¸èƒ½ç›´æ¥è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®ï¼Œæ‰€ä»¥éœ€è¦ä¸€å°ä»£ç†æœåŠ¡å™¨ï¼Œè€Œä»£ç†æœåŠ¡å™¨èƒ½è¢«å¤–éƒ¨ç½‘ç»œè®¿é—®çš„åŒæ—¶åˆè·ŸçœŸå®æœåŠ¡å™¨åœ¨åŒä¸€ä¸ªç½‘ç»œç¯å¢ƒï¼Œå½“ç„¶ä¹Ÿå¯èƒ½æ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œç«¯å£ä¸åŒè€Œå·²ã€‚ ä¸‹é¢è´´ä¸Šä¸€æ®µç®€å•çš„å®ç°åå‘ä»£ç†çš„ä»£ç ï¼š 123456789server { listen 80; server_name localhost; client_max_body_size 1024M; location / { proxy_pass http://localhost:8080; proxy_set_header Host $host:$server_port; }} ä¿å­˜é…ç½®æ–‡ä»¶åå¯åŠ¨Nginxï¼Œè¿™æ ·å½“æˆ‘ä»¬è®¿é—®localhostçš„æ—¶å€™ï¼Œå°±ç›¸å½“äºè®¿é—® localhost:8080 äº†ã€‚ è´Ÿè½½å‡è¡¡ è´Ÿè½½å‡è¡¡å…¶æ„æ€å°±æ˜¯åˆ†æ‘Šåˆ°å¤šä¸ªæ“ä½œå•å…ƒä¸Šè¿›è¡Œæ‰§è¡Œï¼Œä¾‹å¦‚WebæœåŠ¡å™¨ã€FTPæœåŠ¡å™¨ã€ä¼ä¸šå…³é”®åº”ç”¨æœåŠ¡å™¨å’Œå…¶ä»–å…³é”®ä»»åŠ¡æœåŠ¡å™¨ç­‰ï¼Œä»è€Œå…±åŒå®Œæˆå·¥ä½œä»»åŠ¡ã€‚ ç®€å•è€Œè¨€å°±æ˜¯å½“æœ‰2å°æˆ–ä»¥ä¸ŠæœåŠ¡å™¨æ—¶ï¼Œæ ¹æ®è§„åˆ™éšæœºçš„å°†è¯·æ±‚åˆ†å‘åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Šå¤„ç†ï¼Œè´Ÿè½½å‡è¡¡é…ç½®ä¸€èˆ¬éƒ½éœ€è¦åŒæ—¶é…ç½®åå‘ä»£ç†ï¼Œé€šè¿‡åå‘ä»£ç†è·³è½¬åˆ°è´Ÿè½½å‡è¡¡ã€‚è€ŒNginxç›®å‰æ”¯æŒè‡ªå¸¦3ç§è´Ÿè½½å‡è¡¡ç­–ç•¥ï¼Œè¿˜æœ‰2ç§å¸¸ç”¨çš„ç¬¬ä¸‰æ–¹ç­–ç•¥ã€‚ RR(é»˜è®¤) æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ 12345678910111213upstream test { server localhost:8080; server localhost:8081; } server { listen 81; server_name localhost; client_max_body_size 1024M; location / { proxy_pass http://test; proxy_set_header Host $host:$server_port; } } è´Ÿè½½å‡è¡¡çš„æ ¸å¿ƒä»£ç : 1234upstream test { server localhost:8080; server localhost:8081; } æƒé‡ æŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ ä¾‹å¦‚ 1234upstream test { server localhost:8080 weight=9; server localhost:8081 weight=1; } é‚£ä¹ˆ10æ¬¡ä¸€èˆ¬åªä¼šæœ‰1æ¬¡ä¼šè®¿é—®åˆ°8081ï¼Œè€Œæœ‰9æ¬¡ä¼šè®¿é—®åˆ°8080ã€‚ ip_hashï¼ˆsessionä¿æŒï¼‰ ä¸Šé¢çš„2ç§æ–¹å¼éƒ½æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯ä¸‹ä¸€ä¸ªè¯·æ±‚æ¥çš„æ—¶å€™è¯·æ±‚å¯èƒ½åˆ†å‘åˆ°å¦å¤–ä¸€ä¸ªæœåŠ¡å™¨ï¼Œå½“æˆ‘ä»¬çš„ç¨‹åºä¸æ˜¯æ— çŠ¶æ€çš„æ—¶å€™(é‡‡ç”¨äº†sessionä¿å­˜æ•°æ®)ï¼Œè¿™æ—¶å€™å°±æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å¾ˆé—®é¢˜äº†ï¼Œæ¯”å¦‚æŠŠç™»å½•ä¿¡æ¯ä¿å­˜åˆ°äº†sessionä¸­ï¼Œé‚£ä¹ˆè·³è½¬åˆ°å¦å¤–ä¸€å°æœåŠ¡å™¨çš„æ—¶å€™å°±éœ€è¦é‡æ–°ç™»å½•äº†ï¼Œæ‰€ä»¥å¾ˆå¤šæ—¶å€™æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå®¢æˆ·åªè®¿é—®ä¸€ä¸ªæœåŠ¡å™¨ï¼Œé‚£ä¹ˆå°±éœ€è¦ç”¨iphashäº†ï¼Œiphashçš„æ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ 12345upstream test { ip_hash; server localhost:8080; server localhost:8081; } fair(ç¬¬ä¸‰æ–¹) æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚ 12345upstream backend { fair; server localhost:8080; server localhost:8081;} url_hash(ç¬¬ä¸‰æ–¹) æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ åœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³• 123456upstream backend { hash $request_uri; hash_method crc32; server localhost:8080; server localhost:8081; } HTTPæœåŠ¡å™¨ Nginxæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªé™æ€èµ„æºçš„æœåŠ¡å™¨ï¼Œå½“åªæœ‰é™æ€èµ„æºçš„æ—¶å€™ï¼Œå°±å¯ä»¥ä½¿ç”¨Nginxæ¥åšæœåŠ¡å™¨ï¼ŒåŒæ—¶ç°åœ¨ä¹Ÿå¾ˆæµè¡ŒåŠ¨é™åˆ†ç¦»ï¼Œå°±å¯ä»¥é€šè¿‡Nginxæ¥å®ç°ï¼Œé¦–å…ˆçœ‹çœ‹Nginxåšé™æ€èµ„æºæœåŠ¡å™¨ã€‚ 123456789server { listen 80; server_name localhost; client_max_body_size 1024M; location / { root E:/wwwroot; index index.html; } } è¿™æ ·å¦‚æœè®¿é—®å°±ä¼šé»˜è®¤è®¿é—®åˆ°Eç›˜wwwrootç›®å½•ä¸‹é¢çš„index.htmlï¼Œå¦‚æœä¸€ä¸ªç½‘ç«™åªæ˜¯é™æ€é¡µé¢çš„è¯ï¼Œé‚£ä¹ˆå°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼æ¥å®ç°éƒ¨ç½²ã€‚ åŠ¨é™åˆ†ç¦» åŠ¨é™åˆ†ç¦»æ˜¯è®©åŠ¨æ€ç½‘ç«™é‡Œçš„åŠ¨æ€ç½‘é¡µæ ¹æ®ä¸€å®šè§„åˆ™æŠŠä¸å˜çš„èµ„æºå’Œç»å¸¸å˜çš„èµ„æºåŒºåˆ†å¼€æ¥ï¼ŒåŠ¨é™èµ„æºåšå¥½äº†æ‹†åˆ†ä»¥åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®é™æ€èµ„æºçš„ç‰¹ç‚¹å°†å…¶åšç¼“å­˜æ“ä½œï¼Œè¿™å°±æ˜¯ç½‘ç«™é™æ€åŒ–å¤„ç†çš„æ ¸å¿ƒæ€è·¯ã€‚ 123456789101112131415161718192021222324upstream test{ server localhost:8080; server localhost:8081; } server { listen 80; server_name localhost; location / { root e:/wwwroot; index index.html; } # æ‰€æœ‰é™æ€è¯·æ±‚éƒ½ç”±nginxå¤„ç†ï¼Œå­˜æ”¾ç›®å½•ä¸ºhtml location ~ .(gif|jpg|jpeg|png|bmp|swf|css|js)$ { root e:/wwwroot; } # æ‰€æœ‰åŠ¨æ€è¯·æ±‚éƒ½è½¬å‘ç»™tomcatå¤„ç† location ~ .(jsp|do)$ { proxy_pass http://test; } error_page 500 502 503 504 /50x.html; location = /50x.html { root e:/wwwroot; } } è¿™æ ·å°±å¯ä»¥å°†HTMLä»¥åŠå›¾ç‰‡å’Œcssä»¥åŠjsæ”¾åˆ°wwwrootç›®å½•ä¸‹ï¼Œè€Œtomcatåªè´Ÿè´£å¤„ç†jspå’Œè¯·æ±‚ï¼Œä¾‹å¦‚å½“åç¼€ä¸ºgifçš„æ—¶å€™ï¼ŒNginxé»˜è®¤ä¼šä»wwwrootè·å–åˆ°å½“å‰è¯·æ±‚çš„åŠ¨æ€å›¾æ–‡ä»¶è¿”å›ï¼Œå½“ç„¶è¿™é‡Œçš„é™æ€æ–‡ä»¶è·ŸNginxæ˜¯åŒä¸€å°æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥åœ¨å¦å¤–ä¸€å°æœåŠ¡å™¨ï¼Œç„¶åé€šè¿‡åå‘ä»£ç†å’Œè´Ÿè½½å‡è¡¡é…ç½®è¿‡å»å°±å¥½äº† Nginx é…ç½®æ–‡ä»¶ç»“æ„ 12345678910111213141516171819202122232425... #å…¨å±€å—events { #eventså— ...}http #httpå—{ ... #httpå…¨å±€å— server #serverå— { ... #serverå…¨å±€å— location [PATTERN] #locationå— { ... } location [PATTERN] { ... } } server { ... } ... #httpå…¨å±€å—} å…¨å±€å—ï¼šé…ç½®å½±å“nginxå…¨å±€çš„æŒ‡ä»¤ã€‚ä¸€èˆ¬æœ‰è¿è¡ŒnginxæœåŠ¡å™¨çš„ç”¨æˆ·ç»„ï¼Œnginxè¿›ç¨‹pidå­˜æ”¾è·¯å¾„ï¼Œæ—¥å¿—å­˜æ”¾è·¯å¾„ï¼Œé…ç½®æ–‡ä»¶å¼•å…¥ï¼Œå…è®¸ç”Ÿæˆworker processæ•°ç­‰ã€‚eventså—ï¼šé…ç½®å½±å“nginxæœåŠ¡å™¨æˆ–ä¸ç”¨æˆ·çš„ç½‘ç»œè¿æ¥ã€‚æœ‰æ¯ä¸ªè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°ï¼Œé€‰å–å“ªç§äº‹ä»¶é©±åŠ¨æ¨¡å‹å¤„ç†è¿æ¥è¯·æ±‚ï¼Œæ˜¯å¦å…è®¸åŒæ—¶æ¥å—å¤šä¸ªç½‘è·¯è¿æ¥ï¼Œå¼€å¯å¤šä¸ªç½‘ç»œè¿æ¥åºåˆ—åŒ–ç­‰ã€‚httpå—ï¼šå¯ä»¥åµŒå¥—å¤šä¸ªserverï¼Œé…ç½®ä»£ç†ï¼Œç¼“å­˜ï¼Œæ—¥å¿—å®šä¹‰ç­‰ç»å¤§å¤šæ•°åŠŸèƒ½å’Œç¬¬ä¸‰æ–¹æ¨¡å—çš„é…ç½®ã€‚å¦‚æ–‡ä»¶å¼•å…¥ï¼Œmime-typeå®šä¹‰ï¼Œæ—¥å¿—è‡ªå®šä¹‰ï¼Œæ˜¯å¦ä½¿ç”¨sendfileä¼ è¾“æ–‡ä»¶ï¼Œè¿æ¥è¶…æ—¶æ—¶é—´ï¼Œå•è¿æ¥è¯·æ±‚æ•°ç­‰ã€‚serverå—ï¼šé…ç½®è™šæ‹Ÿä¸»æœºçš„ç›¸å…³å‚æ•°ï¼Œä¸€ä¸ªhttpä¸­å¯ä»¥æœ‰å¤šä¸ªserverã€‚locationå—ï¼šé…ç½®è¯·æ±‚çš„è·¯ç”±ï¼Œä»¥åŠå„ç§é¡µé¢çš„å¤„ç†æƒ…å†µã€‚ é™„ä¸Šä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½œä¸ºå‚è€ƒç†è§£ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556########### æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚##################user administrator administrators; #é…ç½®ç”¨æˆ·æˆ–è€…ç»„ï¼Œé»˜è®¤ä¸ºnobody nobodyã€‚#worker_processes 2; #å…è®¸ç”Ÿæˆçš„è¿›ç¨‹æ•°ï¼Œé»˜è®¤ä¸º1#pid /nginx/pid/nginx.pid; #æŒ‡å®šnginxè¿›ç¨‹è¿è¡Œæ–‡ä»¶å­˜æ”¾åœ°å€error_log log/error.log debug; #åˆ¶å®šæ—¥å¿—è·¯å¾„ï¼Œçº§åˆ«ã€‚è¿™ä¸ªè®¾ç½®å¯ä»¥æ”¾å…¥å…¨å±€å—ï¼Œhttpå—ï¼Œserverå—ï¼Œçº§åˆ«ä»¥æ­¤ä¸ºï¼šdebug|info|notice|warn|error|crit|alert|emergevents { accept_mutex on; #è®¾ç½®ç½‘è·¯è¿æ¥åºåˆ—åŒ–ï¼Œé˜²æ­¢æƒŠç¾¤ç°è±¡å‘ç”Ÿï¼Œé»˜è®¤ä¸ºon multi_accept on; #è®¾ç½®ä¸€ä¸ªè¿›ç¨‹æ˜¯å¦åŒæ—¶æ¥å—å¤šä¸ªç½‘ç»œè¿æ¥ï¼Œé»˜è®¤ä¸ºoff #use epoll; #äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œselect|poll|kqueue|epoll|resig|/dev/poll|eventport worker_connections 1024; #æœ€å¤§è¿æ¥æ•°ï¼Œé»˜è®¤ä¸º512}http { include mime.types; #æ–‡ä»¶æ‰©å±•åä¸æ–‡ä»¶ç±»å‹æ˜ å°„è¡¨ default_type application/octet-stream; #é»˜è®¤æ–‡ä»¶ç±»å‹ï¼Œé»˜è®¤ä¸ºtext/plain #access_log off; #å–æ¶ˆæœåŠ¡æ—¥å¿— log_format myFormat '$remote_addrâ€“$remote_user [$time_local] $request $status $body_bytes_sent $http_referer $http_user_agent $http_x_forwarded_for'; #è‡ªå®šä¹‰æ ¼å¼ access_log log/access.log myFormat; #combinedä¸ºæ—¥å¿—æ ¼å¼çš„é»˜è®¤å€¼ sendfile on; #å…è®¸sendfileæ–¹å¼ä¼ è¾“æ–‡ä»¶ï¼Œé»˜è®¤ä¸ºoffï¼Œå¯ä»¥åœ¨httpå—ï¼Œserverå—ï¼Œlocationå—ã€‚ sendfile_max_chunk 100k; #æ¯ä¸ªè¿›ç¨‹æ¯æ¬¡è°ƒç”¨ä¼ è¾“æ•°é‡ä¸èƒ½å¤§äºè®¾å®šçš„å€¼ï¼Œé»˜è®¤ä¸º0ï¼Œå³ä¸è®¾ä¸Šé™ã€‚ keepalive_timeout 65; #è¿æ¥è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤ä¸º75sï¼Œå¯ä»¥åœ¨httpï¼Œserverï¼Œlocationå—ã€‚ upstream mysvr { server 127.0.0.1:7878; server 192.168.10.121:3333 backup; #çƒ­å¤‡ } error_page 404 https://www.baidu.com; #é”™è¯¯é¡µ server { keepalive_requests 120; #å•è¿æ¥è¯·æ±‚ä¸Šé™æ¬¡æ•°ã€‚ listen 4545; #ç›‘å¬ç«¯å£ server_name 127.0.0.1; #ç›‘å¬åœ°å€ location ~*^.+$ { #è¯·æ±‚çš„urlè¿‡æ»¤ï¼Œæ­£åˆ™åŒ¹é…ï¼Œ~ä¸ºåŒºåˆ†å¤§å°å†™ï¼Œ~*ä¸ºä¸åŒºåˆ†å¤§å°å†™ã€‚ #root path; #æ ¹ç›®å½• #index vv.txt; #è®¾ç½®é»˜è®¤é¡µ proxy_pass http://mysvr; #è¯·æ±‚è½¬å‘mysvr å®šä¹‰çš„æœåŠ¡å™¨åˆ—è¡¨ deny 127.0.0.1; #æ‹’ç»çš„ip allow 172.18.5.54; #å…è®¸çš„ip } }} ä¸Šé¢æ˜¯nginxçš„åŸºæœ¬é…ç½®ï¼Œéœ€è¦æ³¨æ„çš„æœ‰ä»¥ä¸‹å‡ ç‚¹ï¼š $remote_addr ä¸$http_x_forwarded_for ç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›$remote_user ï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›$time_local ï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›$request ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›$status ï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼›$body_bytes_s ent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›$http_referer ï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›$http_user_agent ï¼šè®°å½•å®¢æˆ·ç«¯æµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›æƒŠç¾¤ç°è±¡ï¼šä¸€ä¸ªç½‘è·¯è¿æ¥åˆ°æ¥ï¼Œå¤šä¸ªç¡çœ çš„è¿›ç¨‹è¢«åŒæ—¶å«é†’ï¼Œä½†åªæœ‰ä¸€ä¸ªè¿›ç¨‹èƒ½è·å¾—é“¾æ¥ï¼Œè¿™æ ·ä¼šå½±å“ç³»ç»Ÿæ€§èƒ½ã€‚æ¯ä¸ªæŒ‡ä»¤å¿…é¡»æœ‰åˆ†å·ç»“æŸã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Nginx</category>
      </categories>
      <tags>
        <tag>Nginx</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¤šæ€]]></title>
    <url>%2Fposts%2F7b7480f6.html</url>
    <content type="text"><![CDATA[å®šä¹‰ å¯¹äºåŒä¸€ä¸ªç±»å‹çš„ä¸åŒå®ä¾‹å¯¹è±¡ï¼ŒåŒä¸€ä¸ªè¡Œä¸ºå…·å¤‡ä¸åŒçš„è¡¨ç°å½¢å¼ã€‚ ä½œç”¨ æ¶ˆé™¤åŒä¸€ç±»å‹ä¹‹é—´çš„è€¦åˆå…³ç³»ï¼› ä½¿å¾—ä¸åŒå¯¹è±¡å¯¹äºåŒä¸€è¡Œä¸ºå…·å¤‡å¤šç§è¡¨ç°å½¢å¼ï¼› åŸç† å˜é‡çš„é™æ€ç±»å‹ &amp; åŠ¨æ€ç±»å‹ å˜é‡çš„é™æ€ç±»å‹ = å¼•ç”¨ç±»å‹ = ç¼–è¯‘æ—¶å˜é‡ ï¼šä¸ä¼šè¢«æ”¹å˜ã€åœ¨ç¼–è¯‘å™¨å¯çŸ¥ å˜é‡çš„åŠ¨æ€ç±»å‹ = å®ä¾‹å¯¹è±¡ç±»å‹ = è¿è¡Œæ—¶å˜é‡ ï¼šä¼šå˜åŒ–ã€åœ¨è¿è¡ŒæœŸæ‰å¯çŸ¥ å¦‚ä¸‹ç¤ºä¾‹ï¼š 1234567891011121314151617181920public class Test { // Humanæ˜¯ Manä¸Humançš„çˆ¶ç±» static abstract class Human { } static class Man extends Human { } static class Woman extends Human { } // æ‰§è¡Œä»£ç public static void main(String[] args) { Human man = new Man(); // å˜é‡mançš„é™æ€ç±»å‹ = å¼•ç”¨ç±»å‹ = ç¼–è¯‘æ—¶å˜é‡ = Humanï¼šä¸ä¼šè¢«æ”¹å˜ã€åœ¨ç¼–è¯‘å™¨å¯çŸ¥ // å˜é‡mançš„åŠ¨æ€ç±»å‹ = å®ä¾‹å¯¹è±¡ç±»å‹ = è¿è¡Œæ—¶å˜é‡ = Man ï¼šä¼šå˜åŒ–ã€åœ¨è¿è¡ŒæœŸæ‰å¯çŸ¥ } } å®ç°åŸç† é€šè¿‡å°† å­ç±»å¯¹è±¡å®ä¾‹ èµ‹å€¼ç»™ çˆ¶ç±»å¼•ç”¨å˜é‡ï¼Œä½¿å¾—ç¼–è¯‘æ—¶çš„é™æ€å˜é‡ ä¸ è¿è¡Œæ—¶çš„åŠ¨æ€å˜é‡ä¸ä¸€æ ·ï¼Œåœ¨è°ƒç”¨æ–¹æ³• / å˜é‡æ—¶ï¼Œå¤šæ€å°±å‘ç”Ÿäº†ã€‚ åº”ç”¨ç¤ºä¾‹ï¼š 123456// è®¾ Bç±»æ˜¯Aç±»çš„å­ç±»A b = new B(); //ç¼–è¯‘æ—¶å˜é‡ = A b ã€è¿è¡Œæ—¶å˜é‡ = new B()b.name; // è°ƒç”¨äº†çˆ¶ç±»Açš„æˆå‘˜å˜é‡name b.move(); // è°ƒç”¨çš„æ˜¯å­ç±»Bé‡å†™åçš„2ä¸ªæ–¹æ³•moveï¼ˆï¼‰ã€contentï¼ˆï¼‰b.content(); ç»“è®ºï¼šå› å°† å­ç±»å¯¹è±¡å¼•ç”¨ èµ‹å€¼ç»™ çˆ¶ç±»å¯¹è±¡å˜é‡ï¼Œå³A a = new B()ï¼Œå³ ç¼–è¯‘æ—¶å˜é‡å’Œè¿è¡Œæ—¶å˜é‡ä¸ä¸€æ ·ï¼Œæ‰€ä»¥å¤šæ€å‘ç”Ÿ å®ç°è¿‡ç¨‹ï¼ˆç›´æ¥æŒ‡é’ˆè®¿é—®ï¼‰ JVM é€šè¿‡ å¼•ç”¨ç±»å‹ï¼ˆreferenceï¼Œå³Açš„å¼•ç”¨ï¼‰æŸ¥è¯¢Javaæ ˆä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼Œå¾—åˆ°å †ä¸­çš„å¯¹è±¡ç±»å‹çš„æ•°æ®åœ°å€ï¼› æ ¹æ®åœ°å€ï¼Œä»è€Œæ‰¾åˆ°æ–¹æ³•åŒºä¸­çš„å¯¹è±¡ç±»å‹æ•°æ®ï¼ˆBçš„å¯¹è±¡ç±»å‹æ•°æ®ï¼‰ï¼› æŸ¥è¯¢å¯¹è±¡ç±»å‹æ•°æ®ä¸­çš„æ–¹å‘è¡¨å®šä½åˆ°å®é™…ç±»(Bç±»)çš„æ–¹æ³•ï¼Œä»è€Œè¿è¡Œã€‚ å¯¹äºA a = new B() æ•°æ®å­˜å‚¨æ–¹å¼ å¯¹äº A aï¼šä½œä¸ºå¼•ç”¨ç±»å‹æ•°æ®ï¼Œå­˜å‚¨åœ¨JVMæ ˆçš„æœ¬åœ°å˜é‡è¡¨ä¸­ï¼› å¯¹äº new B()ï¼š ä½œä¸ºç¤ºä¾‹å¯¹è±¡æ•°æ®å­˜å‚¨åœ¨å †ä¸­ï¼› Bçš„å¯¹è±¡å®ä¾‹æ•°æ®ï¼ˆæ¥å£ã€æ–¹æ³•ã€å¯¹è±¡ç±»å‹ç­‰ï¼‰çš„åœ°å€å­˜å‚¨åœ¨å †ä¸­ï¼› Bçš„å¯¹è±¡ç±»å‹æ•°æ®ï¼ˆå¯¹è±¡å®ä¾‹æ•°æ®çš„åœ°å€æ‰€æ‰§è¡Œçš„æ•°æ®ï¼‰å­˜å‚¨åœ¨æ–¹æ³•åŒºä¸­ï¼Œåœ¨æ–¹æ³•åŒºä¸­ï¼Œå¯¹è±¡ç±»å‹æ•°æ®ä¸­æœ‰1ä¸ªæŒ‡å‘è¯¥ç±»æ–¹æ³•çš„æ–¹å‘è¡¨ï¼› å¼•ç”¨ç±»å‹è®¿é—®å®ç°æ–¹å¼ Javaç¨‹åºé€šè¿‡ æ ˆä¸Šçš„å¼•ç”¨ç±»å‹æ•°æ®ï¼ˆreferenceï¼‰ æ¥è®¿é—®Javaå †ä¸Šçš„å¯¹è±¡ã€‚ ç”±äºå¼•ç”¨ç±»å‹æ•°æ®ï¼ˆreferenceï¼‰åœ¨ Javaè™šæ‹Ÿæœºä¸­åªè§„å®šäº†ä¸€ä¸ªæŒ‡å‘å¯¹è±¡çš„å¼•ç”¨ï¼Œä½†æ²¡å®šä¹‰è¯¥å¼•ç”¨åº”è¯¥é€šè¿‡ä½•ç§æ–¹å¼å»å®šä½ã€è®¿é—®å †ä¸­çš„å¯¹è±¡çš„å…·ä½“ä½ç½®æ‰€ä»¥å¯¹è±¡è®¿é—®æ–¹å¼ å–å†³äº è™šæ‹Ÿæœºå®ç°ã€‚ç›®å‰ä¸»æµçš„å¯¹è±¡è®¿é—®æ–¹å¼æœ‰ä¸¤ç§ï¼š å¥æŸ„è®¿é—® ç›´æ¥æŒ‡é’ˆè®¿é—® å¤šæ€å®ç°æ–¹å¼ æ–¹æ³•é‡è½½(Overload) å®šä¹‰ åŒä¸€ä¸ªç±»ä¸­å…·å¤‡å¤šä¸ªé‡åçš„æ–¹æ³•ã€‚ ç‰¹ç‚¹ æ–¹æ³•åå­—å¿…é¡»ç›¸åŒï¼› å‚æ•°åˆ—è¡¨å¿…é¡»ä¸åŒï¼šä¸ªæ•°ä¸åŒï¼›ä¸ªæ•°ä¸åŒä½†å¯¹åº”å‚æ•°ç±»å‹ä¸åŒï¼› è¿”å›ç±»å‹/è®¿é—®ä¿®é¥°ç¬¦å¯åŒå¯ä¸åŒï¼› å¯å£°æ˜æ–°çš„æˆ–æ›´å¹¿çš„æ£€æŸ¥å¼‚å¸¸ï¼› èƒ½å¤Ÿåœ¨åŒä¸€ä¸ªç±»æˆ–å­ç±»ä¸­è¢«é‡è½½ï¼› åº”ç”¨åœºæ™¯ é’ˆå¯¹åŒä¸€ç±»çš„å¯¹è±¡ï¼Œå¯¹äºä¸åŒæ¡ä»¶åŒä¸€è¡Œä¸ºçš„ä¸åŒè¡¨ç°ï¼› åŸç† é™æ€åˆ†æ´¾ï¼Œå‘ç”Ÿåœ¨ç¼–è¯‘é˜¶æ®µã€‚ ç¤ºä¾‹ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package main.java.com.study.polymorphic;/** * @author: whb * @description: æ–¹æ³•é‡è½½æµ‹è¯• */public class OverloadTest { /** * ç±»å®šä¹‰ */ static abstract class Human { } /** * ç»§æ‰¿è‡ªæŠ½è±¡ç±»Human */ static class Man extends Human { } static class Woman extends Man { } /** * å®šä¹‰çš„é‡è½½æ–¹æ³•ï¼ˆæ–¹æ³•åç›¸åŒï¼Œä½†å‚æ•°åˆ—è¡¨ä¸åŒï¼ˆæ­¤å¤„æ˜¯ç±»å‹ä¸åŒï¼‰ï¼‰ * * @param guy */ public void sayHello(Human guy) { System.out.println("hello,guy!"); } public void sayHello(Man guy) { System.out.println("hello gentleman!"); } public void sayHello(Woman guy) { System.out.println("hello lady!"); } public static void main(String[] args) { Human man = new Man(); Man woman = new Woman(); OverloadTest test = new OverloadTest(); test.sayHello(man); test.sayHello(woman); }} æ‰§è¡Œç»“æœï¼š 12hello,guy!hello gentleman! ç»“æœè§£æï¼š æ–¹æ³•é‡è½½ï¼ˆOverLoadï¼‰çš„åŸç† = é™æ€åˆ†æ´¾ = æ ¹æ® å˜é‡çš„é™æ€ç±»å‹ ç¡®å®šæ‰§è¡Œï¼ˆé‡è½½ï¼‰å“ªä¸ªæ–¹æ³•; æ‰€ä»¥ä¸Šè¿°çš„æ–¹æ³•æ‰§è¡Œæ—¶ï¼Œæ˜¯æ ¹æ®å˜é‡ï¼ˆmanã€womanï¼‰çš„é™æ€ç±»å‹ï¼ˆHumanã€Manï¼‰ç¡®å®šé‡è½½sayHello()ä¸­å‚æ•°ä¸ºHuman guyã€Man guyçš„æ–¹æ³•,å³sayHello(Human guy)ã€sayHello(Man guy) ; æ–¹æ³•é‡å†™(Override) å®šä¹‰ å­ç±»é‡å†™çˆ¶ç±»æ–¹æ³•çš„å®ç°ã€‚ ç‰¹ç‚¹ è¿”å›å€¼ã€å‡½æ•°åã€å½¢å‚éƒ½ä¸èƒ½æ”¹å˜ï¼Œå³å¤–å£³ä¸å˜ï¼Œé‡å†™å†…åœ¨å®ç°ï¼› ä¸èƒ½è¢«é‡å†™çš„æ–¹æ³•ï¼šæ„é€ æ–¹æ³•ï¼›ä¸èƒ½ç»§æ‰¿/ä¸å…·å¤‡è®¿é—®æƒé™çš„æ–¹æ³•(å¦‚private)ï¼›å£°æ˜ä¸ºfinalã€staticçš„æ–¹æ³•ï¼› å­ç±»æ–¹æ³•ä¸èƒ½ç¼©å°çˆ¶ç±»æ–¹æ³•çš„è®¿é—®æƒé™ï¼› å­ç±»æ–¹æ³•ä¸èƒ½æ¯”çˆ¶ç±»æ–¹æ³•æŠ›å‡ºæ›´å¹¿çš„å¼‚å¸¸ï¼› åŸç† åŠ¨æ€åˆ†æ´¾ï¼Œå‘ç”Ÿåœ¨è¿è¡Œé˜¶æ®µã€‚ ç¤ºä¾‹ 1234567891011121314151617181920212223242526272829303132333435363738394041424344package main.java.com.study.polymorphic;/** * @author: whb * @description: æ–¹æ³•é‡å†™æµ‹è¯•ç±» */public class OverrideTest { // æµ‹è¯•ä»£ç  public static void main(String[] args) { // æƒ…å†µ1 Human man = new Man(); man.sayHello(); // æƒ…å†µ2 man = new Woman(); man.sayHello(); } /** * å®šä¹‰çˆ¶ç±» */ static class Human { public void sayHello() { System.out.println("Human say hello"); } } /** * ç»§æ‰¿ç±»Human å¹¶ é‡å†™sayHello() */ static class Man extends Human { @Override public void sayHello() { System.out.println("man say hello"); } } static class Woman extends Human { @Override public void sayHello() { System.out.println("woman say hello"); } }} æ‰§è¡Œç»“æœ 12man say hellowoman say hello ç»“æœåˆ†æ æ–¹æ³•é‡å†™ï¼ˆOverrideï¼‰ = åŠ¨æ€åˆ†æ´¾ = æ ¹æ® å˜é‡çš„åŠ¨æ€ç±»å‹ ç¡®å®šæ‰§è¡Œï¼ˆé‡å†™ï¼‰å“ªä¸ªæ–¹æ³•; å¯¹äºæƒ…å†µ1ï¼šæ ¹æ®å˜é‡ï¼ˆManï¼‰çš„åŠ¨æ€ç±»å‹ï¼ˆmanï¼‰ç¡®å®šè°ƒç”¨manä¸­çš„é‡å†™æ–¹æ³•sayHello(); å¯¹äºæƒ…å†µ2ï¼šæ ¹æ®å˜é‡ï¼ˆManï¼‰çš„åŠ¨æ€ç±»å‹ï¼ˆwomanï¼‰ç¡®å®šè°ƒç”¨womanä¸­çš„é‡å†™æ–¹æ³•sayHello(); æ–¹æ³•é‡è½½ã€æ–¹æ³•é‡å†™å¯¹æ¯” document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Windows-å¸¸è§é—®é¢˜åŠå®ç”¨æŠ€å·§ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2Fe5866ae9.html</url>
    <content type="text"><![CDATA[å¿«é€Ÿæå–æŸä¸€æ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶åç§° åœ¨éœ€è¦è·å–æ–‡ä»¶åçš„æ–‡ä»¶å¤¹ä¸­æ–°å»ºä¸€ä¸ªtxtæ ¼å¼çš„è®°äº‹æœ¬æ–‡ä»¶ã€‚åœ¨è®°äº‹æœ¬æ–‡ä»¶ä¸­è¾“å…¥ï¼šDIR . /B &gt;LIST.TXTå°†æ­¤è®°äº‹æœ¬æ–‡ä»¶åè¾åï¼Œç”±txtæ”¹ä¸ºbatã€‚ä¼šå¼¹å‡ºé‡å‘½åå¯¹è¯æ¡†ï¼Œå•å‡»â€œæ˜¯â€ã€‚åŒå‡»æ–‡ä»¶â€œæ–°å»ºæ–‡æœ¬æ–‡æ¡£.batâ€å³å¯ç”Ÿæˆlist.txtæ–‡ä»¶ã€‚æ‰“å¼€txtæ–‡ä»¶å°±å¯ä»¥çœ‹åˆ°å½“å‰æ–‡ä»¶å¤¹å†…çš„æ‰€æœ‰æ–‡ä»¶ååˆ—è¡¨ã€‚ ä¸€é”®è·å–æ–°ç”µè„‘ç¡¬ä»¶ä¿¡æ¯ batè„šæœ¬å†…å®¹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110@echo offcolor 0atitle ç¡¬ä»¶æ£€æµ‹ mode con cols=90sc config winmgmt start= auto &gt;nul 2&lt;&amp;1net start winmgmt 2&gt;1nulsetlocal ENABLEDELAYEDEXPANSIONecho ä¸»ç‰ˆ:for /f "tokens=1,* delims==" %%a in ('wmic BASEBOARD get Manufacturer^,Product^,Version^,SerialNumber /value') do ( set /a tee+=1 if "!tee!" == "3" echo åˆ¶é€ å•† = %%b if "!tee!" == "4" echo å‹ å· = %%b if "!tee!" == "5" echo åºåˆ—å· = %%b if "!tee!" == "6" echo ç‰ˆ æœ¬ = %%b)set tee=0echo BIOS:for /f "tokens=1,* delims==" %%a in ('wmic bios get CurrentLanguage^,Manufacturer^,SMBIOSBIOSVersion^,SMBIOSMajorVersion^,SMBIOSMinorVersion^,ReleaseDate /value') do ( set /a tee+=1 if "!tee!" == "3" echo å½“å‰è¯­è¨€ = %%b if "!tee!" == "4" echo åˆ¶é€ å•† = %%b if "!tee!" == "5" echo å‘è¡Œæ—¥æœŸ = %%b if "!tee!" == "6" echo ç‰ˆ æœ¬ = %%b if "!tee!" == "7" echo SMBIOSMajorVersion = %%b if "!tee!" == "8" echo SMBIOSMinorVersion = %%b )set tee=0echo.echo CPU:for /f "tokens=1,* delims==" %%a in ('wmic cpu get name^,ExtClock^,CpuStatus^,Description /value') do ( set /a tee+=1 if "!tee!" == "3" echo CPUä¸ªæ•° = %%b if "!tee!" == "4" echo å¤„ç†å™¨ç‰ˆæœ¬ = %%b if "!tee!" == "5" echo å¤– é¢‘ = %%b if "!tee!" == "6" echo åç§°åŠä¸»é¢‘ç‡ = %%b)set tee=0echo.echo æ˜¾ç¤ºå™¨:for /f "tokens=1,* delims==" %%a in ('wmic DESKTOPMONITOR get name^,ScreenWidth^,ScreenHeight^,PNPDeviceID /value') do ( set /a tee+=1 if "!tee!" == "3" echo ç±» å‹ = %%b if "!tee!" == "4" echo å…¶ä»–ä¿¡æ¯ = %%b if "!tee!" == "5" echo å±å¹•é«˜ = %%b if "!tee!" == "6" echo å±å¹•å®½ = %%b)set tee=0echo.echo ç¡¬ ç›˜:for /f "tokens=1,* delims==" %%a in ('wmic DISKDRIVE get model^,interfacetype^,size^,totalsectors^,partitions /value') do ( set /a tee+=1 if "!tee!" == "3" echo æ¥å£ç±»å‹ = %%b if "!tee!" == "4" echo ç¡¬ç›˜å‹å· = %%b if "!tee!" == "5" echo åˆ†åŒºæ•° = %%b if "!tee!" == "6" echo å®¹ é‡ = %%b if "!tee!" == "7" echo æ€»æ‰‡åŒº = %%b)echo åˆ†åŒºä¿¡æ¯:wmic LOGICALDISK where mediatype='12' get description,deviceid,filesystem,size,freespaceset tee=0echo.echo ç½‘ å¡:for /f "tokens=1,* delims==" %%a in ('wmic NICCONFIG where "index='1'" get ipaddress^,macaddress^,description /value') do ( set /a tee+=1 if "!tee!" == "3" echo ç½‘å¡ç±»å‹ = %%b if "!tee!" == "4" echo ç½‘å¡IP = %%b if "!tee!" == "5" echo ç½‘å¡MAC = %%b)set tee=0echo.echo æ‰“å°æœº:for /f "tokens=1,* delims==" %%a in ('wmic PRINTER get caption /value') do ( set /a tee+=1 if "!tee!" == "3" echo æ‰“å°æœºåå­— = %%b)set tee=0echo.echo å£° å¡:for /f "tokens=1,* delims==" %%a in ('wmic SOUNDDEV get name^,deviceid /value') do ( set /a tee+=1 if "!tee!" == "3" echo å…¶ä»–ä¿¡æ¯ = %%b if "!tee!" == "4" echo å‹ å· = %%b)set tee=0echo.echo å†… å­˜: for /f "tokens=1,* delims==" %%a in ('systeminfo^|find "å†…å­˜"') do ( echo %%a 4534 %%b )echo.echo æ˜¾ å¡:del /f "%TEMP%\temp.txt" 2&gt;nuldxdiag /t %TEMP%\temp.txt:æ˜¾å¡rem è¿™é‡Œéœ€è¦30ç§’å·¦å³!if EXIST "%TEMP%\temp.txt" ( for /f "tokens=1,2,* delims=:" %%a in ('findstr /c:" Card name:" /c:"Display Memory:" /c:"Current Mode:" "%TEMP%\temp.txt"') do ( set /a tee+=1 if !tee! == 1 echo æ˜¾å¡å‹å·: %%b if !tee! == 2 echo æ˜¾å­˜å¤§å°: %%b if !tee! == 3 echo å½“å‰è®¾ç½®: %%b) ) else ( ping /n 2 127.1&gt;nul goto æ˜¾å¡)set /p var=éœ€è¦é¢å¤–ä¿¡æ¯å—(y/n): if /i %var% == y notepad "%TEMP%\temp.txt"del /f "%TEMP%\temp.txt" 2&gt;nulpause åªéœ€è¦æ–°å»ºä¸€ä¸ªtxtï¼Œå¤åˆ¶ä¸Šé¢ä»£ç åä¿®æ”¹åç¼€åä¸ºbat(æœ¬æ¥ä¸ºtxt),ç„¶åå³é”®ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œå°±å¯ä»¥äº†ã€‚ æŸ¥çœ‹è¿›ç¨‹ä½¿ç”¨çš„ç«¯å£ 1netstat -nbaov document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Windows</category>
      </categories>
      <tags>
        <tag>Windows</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MySQLä¸­çš„å‡½æ•°æ€»ç»“]]></title>
    <url>%2Fposts%2F578ec873.html</url>
    <content type="text"><![CDATA[CONCAT()å‡½æ•° CONCATï¼ˆï¼‰å‡½æ•°ç”¨äºå°†å¤šä¸ªå­—ç¬¦ä¸²è¿æ¥æˆä¸€ä¸ªå­—ç¬¦ä¸²ã€‚ ä½¿ç”¨æ•°æ®è¡¨sys_userä½œä¸ºç¤ºä¾‹ï¼Œsqlå¦‚ä¸‹ï¼š SELECT user_id as id,zwxm as name FROM sys_user LIMIT 1; è¿”å›ç»“æœå¦‚ä¸‹ï¼š 12345+----+--------+| id | name |+----+--------+| 1 | å¼ ä¸‰ |+----+--------+ 1ã€è¯­æ³•åŠä½¿ç”¨ç‰¹ç‚¹ï¼š CONCAT(str1,str2,â€¦) è¿”å›ç»“æœä¸ºè¿æ¥å‚æ•°äº§ç”Ÿçš„å­—ç¬¦ä¸²ã€‚å¦‚æœ‰ä»»ä½•ä¸€ä¸ªå‚æ•°ä¸ºNULL ï¼Œåˆ™è¿”å›å€¼ä¸º NULLã€‚å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ã€‚ 2ã€ä½¿ç”¨ç¤ºä¾‹ï¼š SELECT CONCAT(user_id, â€˜ï¼Œâ€™, zwxm) AS con FROM sys_user LIMIT 1; è¿”å›ç»“æœå¦‚ä¸‹ï¼š 12345+----------+| con |+----------+| 1,å¼ ä¸‰ |+----------+ SELECT CONCAT(â€˜Myâ€™, NULL, â€˜QLâ€™); è¿”å›ç»“æœå¦‚ä¸‹ï¼š 12345+--------------------------+| CONCAT('My', NULL, 'QL') |+--------------------------+| NULL |+--------------------------+ CONCAT_WS()å‡½æ•° ä½¿ç”¨è¯­æ³•ä¸ºï¼šÂ· CONCAT_WS(separator,str1,str2,â€¦) Â· CONCAT_WS() ä»£è¡¨ CONCAT With Separator ï¼Œæ˜¯CONCAT()çš„ç‰¹æ®Šå½¢å¼ã€‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å…¶å®ƒå‚æ•°çš„åˆ†éš”ç¬¦ã€‚åˆ†éš”ç¬¦çš„ä½ç½®æ”¾åœ¨è¦è¿æ¥çš„ä¸¤ä¸ªå­—ç¬¦ä¸²ä¹‹é—´ã€‚åˆ†éš”ç¬¦å¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶å®ƒå‚æ•°ã€‚å¦‚æœåˆ†éš”ç¬¦ä¸º NULLï¼Œåˆ™ç»“æœä¸º NULLã€‚å‡½æ•°ä¼šå¿½ç•¥ä»»ä½•åˆ†éš”ç¬¦å‚æ•°åçš„ NULL å€¼ã€‚ä½†æ˜¯CONCAT_WS()ä¸ä¼šå¿½ç•¥ä»»ä½•ç©ºå­—ç¬¦ä¸²ã€‚ (ç„¶è€Œä¼šå¿½ç•¥æ‰€æœ‰çš„ NULLï¼‰ã€‚ ç¤ºä¾‹1ï¼š SELECT CONCAT_WS('_',user_id,zwxm) AS con_ws FROM sys_user LIMIT 1; è¿”å›ç»“æœï¼š 12345+----------+| con_ws |+----------+| 1_å¼ ä¸‰ |+----------+ ç¤ºä¾‹2ï¼š SELECT CONCAT_WS(',','First name',NULL,'Last Name'); è¿”å›ç»“æœï¼š 12345+----------------------------------------------+| CONCAT_WS(',','First name',NULL,'Last Name') |+----------------------------------------------+| First name,Last Name |+----------------------------------------------+ GROUP_CONCAT()å‡½æ•° è¯­æ³•å¦‚ä¸‹ï¼š group_concat([DISTINCT] è¦è¿æ¥çš„å­—æ®µ [Order BY ASC/DESC æ’åºå­—æ®µ] [Separator 'åˆ†éš”ç¬¦']) åŸºæœ¬æŸ¥è¯¢ï¼š 123456789101112mysql&gt; select * from test; +------+------+ | id| name | +------+------+ |1 | 10 | |1 | 20 | |1 | 20 | |2 | 20 | |3 | 200 | |3 | 500 | +------+------+ 6 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš”(é»˜è®¤) 123456789mysql&gt; select id,group_concat(name) from test group by id; +------+--------------------+ | id | group_concat(name) | +------+--------------------+ |1 | 10,20,20 | |2 | 20 | |3 | 200,500 | +------+--------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œåˆ†å·åˆ†éš” 123456789mysql&gt; select id,group_concat(name separator ';') from test group by id; +------+----------------------------------+ | id | group_concat(name separator ';') | +------+----------------------------------+ |1 | 10;20;20 | |2 | 20 | |3 | 200;500 | +------+----------------------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠå»å†—ä½™çš„nameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš” 123456789mysql&gt; select id,group_concat(distinct name) from test group by id; +------+-----------------------------+ | id | group_concat(distinct name) | +------+-----------------------------+ |1 | 10,20 | |2 | 20 | |3 | 200,500 | +------+-----------------------------+ 3 rows in set (0.00 sec) ä»¥idåˆ†ç»„ï¼ŒæŠŠnameå­—æ®µçš„å€¼æ‰“å°åœ¨ä¸€è¡Œï¼Œé€—å·åˆ†éš”ï¼Œä»¥nameæ’å€’åº 123456789mysql&gt; select id,group_concat(name order by name desc) from test group by id; +------+---------------------------------------+ | id | group_concat(name order by name desc) | +------+---------------------------------------+ |1 | 20,20,10 | |2 | 20 | |3 | 500,200 | +------+---------------------------------------+ 3 rows in set (0.00 sec) ä½¿ç”¨group_concat_max_lenç³»ç»Ÿå˜é‡ï¼Œä½ å¯ä»¥è®¾ç½®å…è®¸çš„æœ€å¤§é•¿åº¦ã€‚ ç¨‹åºä¸­è¿›è¡Œè¿™é¡¹æ“ä½œçš„è¯­æ³•å¦‚ä¸‹ï¼Œå…¶ä¸­ val æ˜¯ä¸€ä¸ªæ— ç¬¦å·æ•´æ•°ï¼š SET [SESSION | GLOBAL] group_concat_max_len = val; è‹¥å·²ç»è®¾ç½®äº†æœ€å¤§é•¿åº¦ï¼Œ åˆ™ç»“æœè¢«æˆªè‡³è¿™ä¸ªæœ€å¤§é•¿åº¦ã€‚ å°†ç¯å¢ƒå˜é‡group_concat_max_len å¢å¤§ã€‚é»˜è®¤æ˜¯1024.æˆ‘å°±è®¾ç½®äº†sessionçº§çš„ç¯å¢ƒå˜é‡å°†å…¶å˜ä¸º2048ï¼ˆä¸å¤Ÿç”¨å†åŠ å¤§ï¼‰ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>æ•°æ®åº“</category>
        <category>MySQL</category>
      </categories>
      <tags>
        <tag>æ•°æ®åº“</tag>
        <tag>MySQL</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Linux-å¸¸è§é—®é¢˜åŠå®ç”¨æŠ€å·§ï¼ˆæŒç»­æ›´æ–°ï¼‰]]></title>
    <url>%2Fposts%2F22401d2a.html</url>
    <content type="text"><![CDATA[è™šæ‹Ÿæœºå®‰è£…linuxæç¤ºintel VT-xå¤„äºç¦ç”¨çŠ¶æ€ é—®é¢˜æè¿° æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡ä½¿ç”¨è™šæ‹Ÿæœºå¯åŠ¨linuxçš„æ—¶å€™ç»å¸¸ä¼šç¢°åˆ°ä¸‹é¢è¿™ä¸ªæŠ¥é”™ï¼Œå¦‚ä¸‹ï¼š å·²å°†è¯¥è™šæ‹Ÿæœºé…ç½®ä¸ºä½¿ç”¨ 64 ä½å®¢æˆ·æœºæ“ä½œç³»ç»Ÿã€‚ä½†æ˜¯ï¼Œæ— æ³•æ‰§è¡Œ 64 ä½æ“ä½œã€‚æ­¤ä¸»æœºæ”¯æŒ Intel VT-xï¼Œä½† Intel VT-x å¤„äºç¦ç”¨çŠ¶æ€ã€‚ å¦‚æœå·²åœ¨ BIOS/å›ºä»¶è®¾ç½®ä¸­ç¦ç”¨ Intel VT-xï¼Œæˆ–ä¸»æœºè‡ªæ›´æ”¹æ­¤è®¾ç½®åä»æœªé‡æ–°å¯åŠ¨ï¼Œåˆ™ Intel VT-x å¯èƒ½è¢«ç¦ç”¨ã€‚ ç¡®è®¤ BIOS/å›ºä»¶è®¾ç½®ä¸­å¯ç”¨äº† Intel VT-x å¹¶ç¦ç”¨äº†â€œå¯ä¿¡æ‰§è¡Œâ€ã€‚å¦‚æœè¿™ä¸¤é¡¹ BIOS/å›ºä»¶è®¾ç½®æœ‰ä¸€é¡¹å·²æ›´æ”¹ï¼Œè¯·é‡æ–°å¯åŠ¨ä¸»æœºã€‚å¦‚æœæ‚¨åœ¨å®‰è£… VMware Workstation ä¹‹åä»æœªé‡æ–°å¯åŠ¨ä¸»æœºï¼Œè¯·é‡æ–°å¯åŠ¨ã€‚å°†ä¸»æœºçš„ BIOS/å›ºä»¶æ›´æ–°è‡³æœ€æ–°ç‰ˆæœ¬ã€‚ è§£å†³åŠæ³• é‡å¯ç”µè„‘ï¼Œè¿›å…¥biosï¼ˆä¸€èˆ¬æ˜¯F10ï¼‰ï¼Œé€‰æ‹©Configurationé€‰é¡¹ï¼Œé€‰æ‹©Intel Virtual Technologyå¹¶å›è½¦ ï¼Œé€‰æ‹©enable. ä¿å­˜é€€å‡ºOKã€‚ nginxæ—¥å¿—æ–‡ä»¶åˆ é™¤åç©ºé—´ä¸é‡Šæ”¾ é—®é¢˜æè¿° å› nginxæ—¥å¿—è¿‡å¤§ï¼Œå æ»¡å­˜å‚¨ç©ºé—´ï¼Œæƒ³åˆ é™¤æ—¥å¿—å‡å°‘ç©ºé—´ï¼Œä½†æ˜¯åˆ é™¤æ—¥å¿—åå‘ç°ç©ºé—´è¿˜æ˜¯æ²¡æœ‰å‡å°‘ã€‚ æœªé‡Šæ”¾ç£ç›˜ç©ºé—´åŸå›  åœ¨Linuxæˆ–è€…Unixç³»ç»Ÿä¸­ï¼Œé€šè¿‡rmæˆ–è€…æ–‡ä»¶ç®¡ç†å™¨åˆ é™¤æ–‡ä»¶å°†ä¼šä»æ–‡ä»¶ç³»ç»Ÿçš„ç›®å½•ç»“æ„ä¸Šè§£é™¤é“¾æ¥(unlink)ã€‚ç„¶è€Œå¦‚æœæ–‡ä»¶æ˜¯è¢«æ‰“å¼€çš„ï¼ˆæœ‰ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨ä½¿ç”¨ï¼‰ï¼Œé‚£ä¹ˆè¿›ç¨‹å°†ä»ç„¶å¯ä»¥è¯»å–è¯¥æ–‡ä»¶ï¼Œç£ç›˜ç©ºé—´ä¹Ÿä¸€ç›´è¢«å ç”¨ã€‚è€Œæˆ‘åˆ é™¤çš„æ˜¯nginxçš„logæ–‡ä»¶ï¼Œåˆ é™¤çš„æ—¶å€™æ–‡ä»¶åº”è¯¥æ­£åœ¨è¢«ä½¿ç”¨ã€‚ è§£å†³åŠæ³• é‡å¯nginxæœåŠ¡ï¼Œæˆ–è€…ç”¨&gt;/opt/nginx/logs/nginx.logæ¸…ç©ºæ—¥å¿—æ–‡ä»¶ï¼Œè€Œä¸æ˜¯ç›´æ¥åˆ é™¤ã€‚ ç»™æŒ‡å®šç”¨æˆ·æˆ–å…¨éƒ¨ç”¨æˆ·ï¼ˆå·²ç™»å½•ï¼‰å‘é€æ¶ˆæ¯ ç»™æŒ‡å®šç”¨æˆ·å‘é€æ¶ˆæ¯ é¦–å…ˆï¼Œå¯ä½¿ç”¨wæˆ–whoå‘½ä»¤æŸ¥çœ‹å½“å‰ç™»å½•çš„ç”¨æˆ·ä¿¡æ¯ï¼› ç„¶åï¼Œä½¿ç”¨writeå‘½ä»¤å°†ä¿¡æ¯å‘é€åˆ°ç”¨æˆ·çš„ç»ˆç«¯ä¸Šï¼Œç”¨æ³•æ­¥éª¤å¦‚ä¸‹ï¼š write + shhç™»é™†ç”¨æˆ·å+ttyname(ä¾‹å¦‚pts/1)ENTERè¾“å…¥ä¿¡æ¯ï¼ˆæ‰€è¦å‘é€çš„æ¶ˆæ¯ï¼Œä¸­æ–‡å¯èƒ½ä¼šä¹±ç ï¼‰ã€‚EOFCTRL+Dç»“æŸ &lt;i class="fa fa-pencil fa-2x"&gt;&lt;/i&gt;å®ä¾‹ï¼š 123root# write root pts/1I'll come by at 12:00 to look at your problem.root# ç„¶åä½¿ç”¨rootè´¦å·ç™»å½•ï¼Œä¸”ttyå·ä¸ºpts/1çš„ç™»å½•ç”¨æˆ·ç»ˆç«¯ä¼šæ”¶åˆ°å¦‚ä¸‹æ¶ˆæ¯ï¼š 123Message from root@cs2c.com.cn on pts/3 at 10:20 ...I'll come by at 12:00 to look at you problem.EOF ç»™å½“å‰ç™»å½•çš„æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ ç»™å½“å‰ç™»å½•æ‰€æœ‰ç”¨æˆ·å‘é€æ¶ˆæ¯ï¼Œä½¿ç”¨wallï¼ˆwrite allçš„ç¼©å†™ï¼‰ &lt;i class="fa fa-pencil fa-2x"&gt;&lt;/i&gt;å®ä¾‹å¦‚ä¸‹ï¼š é¦–å…ˆï¼Œä½ å¯ä»¥é€šè¿‡whoå‘½ä»¤æŸ¥çœ‹ç™»å½•åˆ°è¯¥æœºå™¨çš„æ‰€æœ‰ç”¨æˆ·ã€‚æ¯”å¦‚ï¼š 12345# whoroot pts/0 Sep 13 04:28 (10.56.226.25)root pts/1 Sep 13 22:32 (10.140.1.37)root pts/2 Sep 13 23:31 (10.140.2.70)root pts/3 Sep 13 23:56 (10.140.2.70) æ‰§è¡Œwhoå‘½ä»¤ï¼Œå°±ä¼šè¿”å›ä¸Šé¢çš„ç»“æœã€‚è¡¨ç¤ºæœ‰ä¸‰ä¸ªç”¨æˆ·ç™»å½•åˆ°è¯¥æœºå™¨ï¼Œæœ‰ä¸ªç”¨æˆ·æœ‰ä¸¤ä¸ªç™»å½•Consoleã€‚ å…¶æ¬¡ï¼Œå¹¿æ’­æ¶ˆæ¯ 123#wall 'I will use this host. If somebody is using it, pls let me know. Thanks a lot.'Broadcast message from root (pts/3) (Fri Jun 13 23:57:13 2008):I will use this host. If somebody is using it, pls let me know. Thanks a lot æ‰§è¡Œwallå‘½ä»¤ï¼Œæ‰€æœ‰ç™»å½•åˆ°è¯¥æœºå™¨çš„æ§åˆ¶å°(console)ç•Œé¢ä¸Šéƒ½ä¼šæ”¶åˆ°å¦‚ä¸Šæ‰€ç¤ºçš„æ¶ˆæ¯ã€‚ LINUXç³»ç»Ÿè½¯ä»¶å®‰è£…å’Œå¸è½½çš„å¸¸è§æ–¹æ³• rpmåŒ…å¸è½½ï¼šrpm -e XXX.rpm (å¦‚æœæƒ³å¿½ç•¥ä¾èµ–ï¼Œå¯åŠ ä¸Šâ€“nodeps)ã€‚yum remove xxx.rpm è¿™ç§æ–¹æ³•éå¸¸ä¸å»ºè®®ä½¿ç”¨ï¼Œå¸è½½è¿‡ç¨‹ä¼šå°†å¾…å¸è½½çš„è½¯ä»¶åŒ…æ‰€ä¾èµ–çš„è½¯ä»¶åŒ…ä¸€å¹¶å¸è½½æ‰ï¼Œå¾ˆå®¹æ˜“é€ æˆç³»ç»Ÿç¼ºå°‘æŸäº›åŒ…è€Œå´©æºƒç­‰é—®é¢˜ã€‚æºç åŒ…å¸è½½ï¼šcdå‘½ä»¤è¿›å…¥ç¼–è¯‘åçš„è½¯ä»¶ç›®å½•ï¼Œå³å®‰è£…æ—¶çš„ç›®å½•ï¼Œæ‰§è¡Œmake uninstallå‘½ä»¤å³å¯ï¼›æˆ–è€…ç›´æ¥åˆ é™¤å®‰è£…ç›®å½•ã€‚ å¦‚ä½•ä¿®æ”¹LINUXçš„IPåœ°å€ã€ç½‘å…³å’Œä¸»æœºå 1ã€ä¿®æ”¹IPåœ°å€ã€ç½‘å…³ï¼šç¼–è¾‘/etc/sysconfig/network-scripts/ifcfg-eth0ï¼Œä¿®æ”¹é‡Œé¢IPADDRå’ŒGATEWAYå†…å®¹ï¼Œæ²¡æœ‰è¿™ä¸¤è¡Œï¼Œåˆ™æ·»åŠ å³å¯ï¼Œæ·»åŠ æ—¶ç¡®ä¿BOOTPROTO=staticï¼Œé™æ€åœ°å€ï¼Œå¦‚IPADDR=192.168.1.100 GATEWAY=192.168.1.1ã€‚2ã€ä¿®æ”¹ä¸»æœºåç§°ï¼šç¼–è¾‘/etc/sysconfig/networkï¼Œä¿®æ”¹é‡Œé¢çš„HOSTNAMEå†…å®¹ï¼Œå¦‚è®¾ç½®ä¸»æœºåç§°ä¸ºmysqlï¼Œåˆ™ï¼šHOSTNAME=mysqlå³å¯ï¼› å¦‚ä½•æŸ¥çœ‹å½“å‰çš„LinuxæœåŠ¡å™¨çš„è¿è¡Œçº§åˆ« ä½¿ç”¨ who -r æˆ–è€… runlevel å‘½ä»¤ã€‚ å¦‚ä½•æŸ¥çœ‹Linuxçš„é»˜è®¤ç½‘å…³ ç”¨ route -n æˆ–è€… netstat -nr å‘½ä»¤ã€‚ å¦‚ä½•åœ¨/usrç›®å½•ä¸‹æ‰¾å‡ºå¤§å°è¶…è¿‡10MBçš„æ–‡ä»¶ find /usr -size +10M å¦‚ä½•åœ¨/homeç›®å½•ä¸‹æ‰¾å‡º120å¤©ä¹‹å‰è¢«ä¿®æ”¹è¿‡çš„æ–‡ä»¶ find /home -mtime +120 å¦‚ä½•åœ¨/varç›®å½•ä¸‹æ‰¾å‡º90å¤©ä¹‹å†…æœªè¢«è®¿é—®è¿‡çš„æ–‡ä»¶ find /var \! -atime -90 æŸ¥çœ‹å„ç³»ç»Ÿç”¨æˆ·çš„è¿›ç¨‹ï¼ˆLWPï¼‰æ•° 1ps h -Led -o user | sort | uniq -c | sort -n é»˜è®¤æƒ…å†µä¸‹é‡‡ç”¨ ps å‘½ä»¤å¹¶ä¸èƒ½æ˜¾ç¤ºå‡ºæ‰€æœ‰çš„è¿›ç¨‹ã€‚å› ä¸º Linux ç¯å¢ƒä¸‹æ‰§è¡Œå¤šçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½å°†ä»¥ä¸€ä¸ªè½»é‡çº§è¿›ç¨‹ï¼ˆlight-weight process ã€LWPã€ï¼‰çš„å½¢å¼æ‰§è¡Œï¼Œè€Œ ps å‘½ä»¤å¦‚æœä¸å¸¦ -L é€‰é¡¹å°†æ— æ³•æŸ¥çœ‹ LWPã€‚ ç¡®å®šæŸç”¨æˆ·çš„è¿›ç¨‹ï¼ˆLWPï¼‰æ•°çš„åˆ†å¸ƒæƒ…å†µ 1ps -o nlwp,pid,lwp,args -u username | sort -n å…¶ä¸­ username ä¸ºç³»ç»Ÿç”¨æˆ·åã€‚ å¸¸ç”¨æ—¥å¿—æŸ¥è¯¢å‘½ä»¤ æŸ¥çœ‹å®æ—¶æ—¥å¿— 1tail -f info.log åˆ†é¡µæŸ¥çœ‹æ‰€æœ‰æ—¥å¿— 1cat info.log | more åˆ†é¡µæŸ¥çœ‹å‰Nè¡Œæ—¥å¿— 1tail -n 1000 info.log | more æ£€ç´¢æ—¥å¿—ï¼Œå¹¶æ˜¾ç¤ºè¯¥æ—¥å¿—çš„å‰åNè¡Œè®°å½• 1cat info.log | grep -n -B10 -A10 "å…³é”®å­—" æŸ¥çœ‹æ—¥å¿—ï¼Œä»ç¬¬1000è¡Œå¼€å§‹ï¼Œæ˜¾ç¤º500è¡Œ 1cat info.log |tail -n+1000|head -n 500 æŸ¥çœ‹æ—¥å¿—ï¼Œæ˜¾ç¤º1350è¡Œåˆ°1400è¡Œ 1cat info.log | head -n 1400 | tail -n +1350 åˆ é™¤åŒ…æ‹¬å…³é”®è¯çš„è¡Œ 1sed -i '/å…³é”®è¯/d' info.log grepæŸ¥çœ‹æ‰“å°åŒ¹é…çš„ä¸‹å‡ è¡Œæˆ–å‰åå‡ è¡Œ å‰è¨€ å¹³æ—¶å·¥ä½œä¸­æ€»ä¼šç¢°åˆ°æ’æŸ¥é”™è¯¯æƒ³è¦çœ‹XXæ—¥å¿—é‡Œé¢çš„æŸä¸ªå…³é”®è¯ï¼Œä½†æ˜¯è¿™ä¸ªå…³é”®è¯å‰ååˆæœ‰å¾ˆå¤šå…¶ä»–ä¿¡æ¯ä¹Ÿæ˜¯éœ€è¦å…³æ³¨çš„ï¼Œè¿™æ—¶å€™æ€ä¹ˆåŠå‘¢ï¼Ÿ å®ç° ä¸€èˆ¬æ˜¯é€šè¿‡grepæ¥å®ç°ã€‚å‡è®¾è¦çœ‹A.logé‡Œé¢â€œABCâ€å…³é”®è¯ä¸Šä¸‹100è¡Œï¼Œä¸€èˆ¬æ‰§è¡Œå‘½ä»¤ï¼š 1grep -C 100 'ABC' A.log å°†ä¿¡æ¯è¾“å‡ºåˆ°æŒ‡å®šæ–‡ä»¶ï¼š 1grep -C 100 'ABC' A.log &gt; /opt/error.log æƒ³åŒ¹é…æ¨¡å¼çš„ä¸Šä¸‹å‡ è¡Œï¼Œgrepä¹Ÿå¯ä»¥å®ç° 1234567grep -5 'parttern' inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰å5è¡Œgrep -C 5 'parttern' inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰å5è¡Œgrep -A 5 'parttern' inputfile //æ‰“å°åŒ¹é…è¡Œçš„å5è¡Œgrep -B 5 'parttern' inputfile //æ‰“å°åŒ¹é…è¡Œçš„å‰5è¡Œ æŸ¥æ‰¾æœ€ååˆ›å»ºæ—¶é—´æ˜¯3å¤©å‰ï¼Œåç¼€æ˜¯*.logçš„æ–‡ä»¶å¹¶åˆ é™¤ 1find / -name â€œ*.logâ€ -ctime +3 -exec rm -f {} \ å°†æŸç›®å½•ä¸‹å¤§äº100kçš„æ–‡ä»¶ç§»åŠ¨è‡³/tmpä¸‹ 1for i in `find /test -type f -size +100k`;do cd /test &amp;&amp; mv $i /tmp;done å°†æ•°æ®åº“å¤‡ä»½å¹¶æ‰“åŒ…è‡³è¿œç¨‹æœåŠ¡å™¨192.168.1.1 /backupç›®å½•ä¸‹ 123456789mount 192.168.1.1:/backup /mntcd /mnt/usr/local/mysql/bin/mysqldump -hlocalhost -uroot test &gt;test.sqltar czf test.sql.tar.gz test.sqlrm -f test.sql é˜²ç«å¢™é…ç½®è„šæœ¬ï¼Œåªå…è®¸è¿œç¨‹ä¸»æœºè®¿é—®æœ¬æœºçš„80ç«¯å£ 12345678910111213iptables -P INPUT ACCEPTiptables -P OUTPUT ACCEPTiptables -P FORWARD ACCEPTiptables -Fiptables -Xiptables -A INPUT -i eth0 -p tcp â€“dport 80 -j ACCEPTiptables -P INPUT DROP è„šæœ¬ç»Ÿè®¡nginxæ—¥å¿—ï¼Œå¾—åˆ°è®¿é—®ipæœ€å¤šçš„å‰10ä¸ª(nginxæ—¥å¿—è·¯å¾„ï¼š/home/logs/nginx/default/access.log 1awk â€˜{a[$1]++}END{for (j in a) print a[j],j}â€™ /home/logs/nginx/default/access.log|sort -nr|head -10 æŸ¥çœ‹æœ€æ¶ˆè€—CPUã€å†…å­˜çš„è¿›ç¨‹ CPUå ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k3|head -10 å†…å­˜æ¶ˆè€—æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k4|head -10 è™šæ‹Ÿå†…å­˜ä½¿ç”¨æœ€å¤šçš„å‰10ä¸ªè¿›ç¨‹ 1ps auxw|head -1;ps auxw|sort -rn -k5|head -10 å‚æ•°è¯´æ˜ ps auxw uï¼šä»¥ç”¨æˆ·ä¸ºä¸»çš„æ ¼å¼æ¥æ˜¾ç¤ºç¨‹åºçŠ¶å†µ xï¼šæ˜¾ç¤ºæ‰€æœ‰ç¨‹åºï¼Œä¸ä»¥ç»ˆç«¯æœºæ¥åŒºåˆ† wï¼šé‡‡ç”¨å®½é˜”çš„æ ¼å¼æ¥æ˜¾ç¤ºç¨‹åºçŠ¶å†µ ps auxw|head -1 è¾“å‡ºè¡¨å¤´ sort -rn -k5 -næ˜¯æŒ‰ç…§æ•°å­—å¤§å°æ’åºï¼Œ-ræ˜¯ä»¥ç›¸åé¡ºåºï¼Œ-kæ˜¯æŒ‡å®šéœ€è¦æ’åºçš„æ ä½ linuxç£ç›˜ç©ºé—´æ»¡äº†åæ€ä¹ˆå»åˆ¤å®šå“ªä¸ªåœ°æ–¹å äº†å¤šå¤§çš„ç©ºé—´å¹¶å›æ”¶ ä½¿ç”¨df -hæŸ¥çœ‹ç£ç›˜ç©ºé—´å ç”¨æƒ…å†µã€‚ä½¿ç”¨du -s /* | sort -nrå‘½ä»¤æŸ¥çœ‹é‚£ä¸ªç›®å½•å ç”¨ç©ºé—´å¤§ã€‚ç„¶åé‚£ä¸ªç›®å½•å ç”¨å¤šå†é€šè¿‡du -s /root/* | sort -nr ä¸€å±‚å±‚æ’æŸ¥ï¼Œæ‰¾åˆ°å ç”¨æ–‡ä»¶å¤šçš„åœ°æ–¹ã€‚ä½¿ç”¨du -h â€“max-depth=1æŸ¥çœ‹å½“å‰ç›®å½•ä¸‹æ–‡ä»¶å¤¹å¤§å°æƒ…å†µã€‚æŸ¥çœ‹æ–‡ä»¶æ˜¯å¦è¢«è¿›ç¨‹å ç”¨ã€‚å¦‚æœé€šè¿‡ä»¥ä¸Šæ–¹æ³•æ²¡æœ‰æ‰¾åˆ°é—®é¢˜æ‰€åœ¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨ lsof | grep deleted å‘½ä»¤ï¼Œçœ‹çœ‹æ˜¯å¦åˆ é™¤æ‰çš„æ–‡ä»¶ä»ç„¶è¢«è¿›ç¨‹å ç”¨è€Œæ²¡æœ‰è¿›è¡Œå®é™…åˆ é™¤ã€‚ LinuxæœåŠ¡å™¨å¿˜è®°rootå¯†ç æ€ä¹ˆåŠ é‡å¯æˆ–è€…å¼€æœºæ—¶ï¼Œåœ¨å€’æ•°3ç§’çš„ç•Œé¢æŒ‰ä¸‹ä»»æ„é”®ã€‚ è¯¥ç•Œé¢æœ‰å¦‚ä¸‹æç¤º(e ç¼–è¾‘ a æ›´æ”¹å†…æ ¸é€‰é¡¹ c å‘½ä»¤è¡Œ b å¯åŠ¨)ï¼Œæ‰€ä»¥æˆ‘ä»¬æŒ‰ä¸‹"e"ç¼–è¾‘ã€‚ ä¸Šä¸‹é”®é€‰ä¸­ç¬¬äºŒè¡Œå†æŒ‰ä¸‹"e"ç¼–è¾‘ è¡Œæœ«åŠ ä¸Š"singal,s,S,1"å…¶ä¸­ä¸€é¡¹ï¼Œç„¶åå›è½¦ã€‚ æŒ‰"b",å¯åŠ¨ã€‚ å¯åŠ¨ä¹‹åå°±å¯ä»¥ç”¨passwdå‘½ä»¤é‡ç½®rootå‘½ä»¤ã€‚ ç”¨shellè„šæœ¬è¾“å‡ºå¸¦é¢œè‰²å­—ä½“ è¯­æ³• shellè„šæœ¬ä¸­echoæ˜¾ç¤ºå†…å®¹å¸¦é¢œè‰²æ˜¾ç¤º,echoæ˜¾ç¤ºå¸¦é¢œè‰²ï¼Œéœ€è¦ä½¿ç”¨å‚æ•°-eï¼Œå¦‚ä¸‹ï¼š 1echo -e "\033[41;36m something here \033[0m" å…¶ä¸­41çš„ä½ç½®ä»£è¡¨åº•è‰²ï¼Œ 36çš„ä½ç½®æ˜¯ä»£è¡¨å­—çš„é¢œè‰² è‰²å€¼å¯¹åº” 1ã€å­—èƒŒæ™¯é¢œè‰²å’Œæ–‡å­—é¢œè‰²ä¹‹é—´æ˜¯è‹±æ–‡çš„""; 2ã€æ–‡å­—é¢œè‰²åé¢æœ‰ä¸ªm; 3ã€å­—ç¬¦ä¸²å‰åå¯ä»¥æ²¡æœ‰ç©ºæ ¼ï¼Œå¦‚æœæœ‰çš„è¯ï¼Œè¾“å‡ºä¹Ÿæ˜¯åŒæ ·æœ‰ç©ºæ ¼; ä¸‹é¢æ˜¯ç›¸åº”çš„å­—å’ŒèƒŒæ™¯é¢œè‰²ï¼Œå¯ä»¥è‡ªå·±æ¥å°è¯•æ‰¾å‡ºä¸åŒé¢œè‰²æ­é… 1234567echo -e â€œ\033[31m çº¢è‰²å­— \033[0mâ€echo -e â€œ\033[34m é»„è‰²å­— \033[0mâ€echo -e â€œ\033[41;33m çº¢åº•é»„å­— \033[0mâ€echo -e â€œ\033[41;37m çº¢åº•ç™½å­— \033[0mâ€ å­—é¢œè‰²ï¼š30â€”â€“37 12345678echo -e â€œ\033[30m é»‘è‰²å­— \033[0mâ€ echo -e â€œ\033[31m çº¢è‰²å­— \033[0mâ€ echo -e â€œ\033[32m ç»¿è‰²å­— \033[0mâ€ echo -e â€œ\033[33m é»„è‰²å­— \033[0mâ€ echo -e â€œ\033[34m è“è‰²å­— \033[0mâ€ echo -e â€œ\033[35m ç´«è‰²å­— \033[0mâ€ echo -e â€œ\033[36m å¤©è“å­— \033[0mâ€ echo -e â€œ\033[37m ç™½è‰²å­— \033[0mâ€ å­—èƒŒæ™¯é¢œè‰²èŒƒå›´ï¼š40â€”â€“47 12345678echo -e â€œ\033[40;37m é»‘åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[41;37m çº¢åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[42;37m ç»¿åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[43;37m é»„åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[44;37m è“åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[45;37m ç´«åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[46;37m å¤©è“åº•ç™½å­— \033[0mâ€ echo -e â€œ\033[47;30m ç™½åº•é»‘å­— \033[0mâ€ æ§åˆ¶é€‰é¡¹è¯´æ˜ 12345678910111213141516171819\33[0m å…³é—­æ‰€æœ‰å±æ€§ \33[1m è®¾ç½®é«˜äº®åº¦ \33[4m ä¸‹åˆ’çº¿ \33[5m é—ªçƒ \33[7m åæ˜¾ \33[8m æ¶ˆéš \33[30m â€” \33[37m è®¾ç½®å‰æ™¯è‰² \33[40m â€” \33[47m è®¾ç½®èƒŒæ™¯è‰² \33[nA å…‰æ ‡ä¸Šç§»nè¡Œ \33[nB å…‰æ ‡ä¸‹ç§»nè¡Œ \33[nC å…‰æ ‡å³ç§»nè¡Œ \33[nD å…‰æ ‡å·¦ç§»nè¡Œ \33[y;xHè®¾ç½®å…‰æ ‡ä½ç½® \33[2J æ¸…å± \33[K æ¸…é™¤ä»å…‰æ ‡åˆ°è¡Œå°¾çš„å†…å®¹ \33[s ä¿å­˜å…‰æ ‡ä½ç½® \33[u æ¢å¤å…‰æ ‡ä½ç½® \33[?25l éšè—å…‰æ ‡ \33[?25h æ˜¾ç¤ºå…‰æ ‡ å®ä¾‹ï¼šäº”é¢œå…­è‰²çš„shellè„šæœ¬ 123456789101112131415161718192021222324252627282930#!/bin/bash clearecho -e "\033[1m Hello World" # bold effectecho -e "\033[5m Blink" # blink effectecho -e "\033[0m Hello World" # back to noraml echo -e "\033[31m Hello World" # Red colorecho -e "\033[32m Hello World" # Green colorecho -e "\033[33m Hello World" # See remaing on screenecho -e "\033[34m Hello World"echo -e "\033[35m Hello World"echo -e "\033[36m Hello World" echo -e -n "\033[0m" # back to noramlecho -e "\033[41m Hello World"echo -e "\033[42m Hello World"echo -e "\033[43m Hello World"echo -e "\033[44m Hello World"echo -e "\033[45m Hello World"echo -e "\033[46m Hello World" echo -e "\033[0m Hello World" é‡å¯å‘½ä»¤ rebootshutdown -r now ç«‹åˆ»é‡å¯(rootç”¨æˆ·ä½¿ç”¨)shutdown -r 10 è¿‡10åˆ†é’Ÿè‡ªåŠ¨é‡å¯(rootç”¨æˆ·ä½¿ç”¨)shutdown -r 20:35 åœ¨æ—¶é—´ä¸º20:35æ—¶å€™é‡å¯(rootç”¨æˆ·ä½¿ç”¨)å¦‚æœæ˜¯é€šè¿‡shutdownå‘½ä»¤è®¾ç½®é‡å¯çš„è¯ï¼Œå¯ä»¥ç”¨shutdown -cå‘½ä»¤å–æ¶ˆé‡å¯ å…³æœºå‘½ä»¤ halt ç«‹åˆ»å…³æœºpoweroff ç«‹åˆ»å…³æœºshutdown -h now ç«‹åˆ»å…³æœº(rootç”¨æˆ·ä½¿ç”¨)shutdown -h 10 10åˆ†é’Ÿåè‡ªåŠ¨å…³æœºå¦‚æœæ˜¯é€šè¿‡shutdownå‘½ä»¤è®¾ç½®å…³æœºçš„è¯ï¼Œå¯ä»¥ç”¨shutdown -cå‘½ä»¤å–æ¶ˆé‡å¯ æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„ç½‘å¡ 1watch cat /proc/net/dev é‡å¯ç½‘å¡æ–¹æ³• å…¨éƒ¨ç½‘å¡é‡å¯ é‡å¯ç½‘å¡ä½¿è®¾å®šç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart å•ä¸ªç½‘å¡é‡å¯ å…³é—­ç½‘å¡ ifdown eth0 å¼€å¯ç½‘å¡ ifup eth0 ç¦ç”¨ç½‘å¡ 123vi /etc/sysconfig/network-scripts/ifcfg-eth1onboot=NO ä¿®æ”¹IP åŠ¨æ€ è®¾å®šä¸€ä¸ªç½‘å¡IPï¼š 1ifconfig eth1 192.168.1.10 netmask 255.255.255.0 é‡å¯ç½‘å¡ä½¿è®¾å®šç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart é™æ€ ç¼–è¾‘æ–‡ä»¶ /etc/network/interfaces 1sudo vi /etc/network/interfaces å¹¶ç”¨ä¸‹é¢çš„è¡Œæ¥æ›¿æ¢æœ‰å…³eth0çš„è¡Œï¼š 12345678# The primary network interfaceauto eth0iface eth0 inet staticaddress 192.168.2.1gateway 192.168.2.254netmask 255.255.255.0#network 192.168.2.0#broadcast 192.168.2.255 å°†eth0çš„IPåˆ†é…æ–¹å¼ä¿®æ”¹ä¸ºé™æ€åˆ†é…(static)åï¼Œä¸ºå…¶åˆ¶å®šIPã€ç½‘å…³ã€å­ç½‘æ©ç ç­‰ä¿¡æ¯ã€‚ å°†ä¸Šé¢çš„Ubuntu IPåœ°å€ç­‰ä¿¡æ¯æ¢æˆä½ è‡ªå·±å°±å¯ä»¥äº†ã€‚ ç”¨ä¸‹é¢çš„å‘½ä»¤ä½¿ç½‘ç»œè®¾ç½®ç”Ÿæ•ˆï¼š 1sudo /etc/init.d/networking restart æ“ä½œé˜²ç«å¢™(serviceæ–¹å¼) æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€ 1service iptables status å¼€å¯é˜²ç«å¢™ 1service iptables start å…³é—­é˜²ç«å¢™ 1service iptables stop æŸ¥æ‰¾å¤§æ–‡ä»¶ æœç´¢å½“å‰ç›®å½•ä¸‹ï¼Œè¶…è¿‡100Må¤§å°çš„æ–‡ä»¶ 1find . -type f -size +100M æŸ¥çœ‹è¶…è¿‡100Må¤§å°çš„æ–‡ä»¶åŠå…¶ç›¸å…³ä¿¡æ¯ 1find . -type f -size +800M -print0 | xargs -0 ls -l æŸ¥æ‰¾è¶…è¿‡100Må¤§å°æ–‡ä»¶ï¼Œå¹¶æ˜¾ç¤ºæŸ¥æ‰¾å‡ºæ¥æ–‡ä»¶çš„å…·ä½“å¤§å° 1find . -type f -size +100M -print0 | xargs -0 du -h æŸ¥æ‰¾è¶…è¿‡100Må¤§å°æ–‡ä»¶å¹¶å¯¹æŸ¥æ‰¾ç»“æœæŒ‰ç…§æ–‡ä»¶å¤§å°åšä¸€ä¸ªæ’åº 1find . -type f -size +800M -print0 | xargs -0 du -h | sort -nr æŸ¥æ‰¾Linuxä¸‹çš„å¤§ç›®å½• 1du -h --max-depth=1 document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Linux</category>
      </categories>
      <tags>
        <tag>Linux</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Java Stringå¸¸è§é—®é¢˜]]></title>
    <url>%2Fposts%2Fd0a49d51.html</url>
    <content type="text"><![CDATA[é¦–å…ˆçœ‹ä¸€æ®µä»£ç å—ï¼š 123456789public String gets1() { return "" + System.currentTimeMillis();}public String gets2() { return String.valueOf(System.currentTimeMillis());}public String gets3() { return new String("") + System.currentTimeMillis();} è¿™ä¸‰ä¸ªæ–¹æ³•éƒ½æ˜¯è¾“å‡ºå½“å‰æ—¶é—´æˆ³stringç±»å‹çš„æ•°æ®ï¼Œä½†ä»–ä»¬æœ‰ä»€ä¹ˆä¸åŒå‘¢ï¼Ÿåç¼–è¯‘çœ‹ä¸‹ä¸‰ä¸ªæ–¹æ³•çš„ç»†èŠ‚ï¼š 12345678910111213141516171819202122232425262728293031public java.lang.String gets1();Code: 0: new #2 // class java/lang/StringBuilder 3: dup 4: invokespecial #3 // Method java/lang/StringBuilder."&lt;init&gt;":()V 7: ldc #4 // String 9: invokevirtual #5 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 12: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 15: invokevirtual #7 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder; 18: invokevirtual #8 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 21: areturn' public java.lang.String gets2();Code: 0: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 3: invokestatic #9 // Method java/lang/String.valueOf:(J)Ljava/lang/String; 6: areturnpublic java.lang.String gets3();Code: 0: new #2 // class java/lang/StringBuilder 3: dup 4: invokespecial #3 // Method java/lang/StringBuilder."&lt;init&gt;":()V 7: new #10 // class java/lang/String 10: dup 11: ldc #4 // String 13: invokespecial #11 // Method java/lang/String."&lt;init&gt;":(Ljava/lang/String;)V 16: invokevirtual #5 // Method java/lang/StringBuilder.append:(Ljava/lang/String;)Ljava/lang/StringBuilder; 19: invokestatic #6 // Method java/lang/System.currentTimeMillis:()J 22: invokevirtual #7 // Method java/lang/StringBuilder.append:(J)Ljava/lang/StringBuilder; 25: invokevirtual #8 // Method java/lang/StringBuilder.toString:()Ljava/lang/String; 28: areturn æ–¹æ³•1ï¼š""+System.currentTimeMillis()æ˜¯é€šè¿‡StringBuilderçš„appendæ–¹æ³•æ·»åŠ äº†ä¸€ä¸ªç©ºå­—ç¬¦ä¸²åŠå½“å‰æ—¶é—´æˆ³ï¼Œç„¶åé€šè¿‡toStringæ–¹æ³•ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„Stringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringBuilderå’Œä¸€ä¸ªStringå¯¹è±¡ã€‚ æ–¹æ³•2ï¼šString.valueOf(System.currentTimeMillis())ç›´æ¥è·å–å½“å‰æ—¶é—´æˆ³ï¼Œç„¶ååˆ›å»ºäº†ä¸€ä¸ªStringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringå¯¹è±¡ã€‚ æ–¹æ³•3ï¼šnew String("") + System.currentTimeMillis()åˆ™æœ€éº»çƒ¦ï¼Œå…ˆåˆ›å»ºäº†StringBuilderå¯¹è±¡ï¼Œç„¶åæ–°å»ºäº†ä¸€ä¸ªç©ºå­—ç¬¦ä¸²çš„Stringå¯¹è±¡ï¼Œé€šè¿‡appendæ–¹æ³•æ·»åŠ è¿›å»ï¼Œæœ€åtoStringåˆ›å»ºäº†ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ã€‚ è¯¥æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€ä¸ªStringBuilderå¯¹è±¡å’Œä¸¤ä¸ªStringå¯¹è±¡ã€‚ ä»ä¸Šé¢çš„åˆ†æä¸­å°±å¯ä»¥çœ‹å‡ºï¼Œå¾ˆæ˜æ˜¾æ–¹æ³•2æ˜¯æœ€ä¼˜çš„ï¼Œä¸ºä»€ä¹ˆå‘¢ï¼Ÿåœ¨æ·±å…¥Stringä¹‹å‰ï¼Œå…ˆäº†è§£ä¸‹JVMçš„ç»„æˆã€‚ å †ï¼šJVMè¿è¡Œä¸­ç”³è¯·çš„å¯¹è±¡å­˜æ”¾çš„ä½ç½®ã€‚ä¹Ÿå°±æ˜¯æ‰€è¯´çš„æ–°ç”Ÿä»£+è€å¹´ä»£ã€‚ è™šæ‹Ÿæœºæ ˆï¼šæ¯ä¸ªæ–¹æ³•åœ¨è¢«è°ƒç”¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªè™šæ‹Ÿæœºæ ˆï¼Œç”¨äºå­˜å‚¨ä¸´æ—¶çš„éå†ã€æ–¹æ³•ç­‰ä¿¡æ¯ã€‚è°ƒç”¨ç›¸å½“äºè¿›æ ˆï¼Œè¿”å›ç»“æœåˆ™ç›¸å½“äºå‡ºæ ˆï¼Œå¼‚å¸¸è¾“å‡ºçš„æ ˆä¿¡æ¯å°±æ˜¯ä»è¿™é‡Œæ¥çš„ã€‚ æœ¬åœ°æ–¹æ³•æ ˆï¼šä¹Ÿæ˜¯æ–¹æ³•è°ƒç”¨ï¼Œåªæ˜¯è°ƒç”¨çš„æ–¹æ³•æ˜¯æœ¬åœ°nativeæ–¹æ³•ã€‚ æ–¹æ³•åŒºï¼šå­˜å‚¨çš„ç±»çš„ç»“æ„ä¿¡æ¯ï¼Œé™æ€å˜é‡ç­‰ä¿¡æ¯ã€‚ä¹Ÿå°±æ˜¯æ°¸ç”Ÿä»£ï¼Œå‘ç”ŸFULL GCçš„åœ°æ–¹ï¼ˆJava8ä¸­ä»¥å…ƒç©ºé—´ä»£æ›¿äº†æ°¸ç”Ÿä»£è¿™ä¸ªæ¦‚å¿µï¼‰ã€‚ å¸¸é‡æ± ï¼šæ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œç”¨æ¥å­˜æ”¾å„ç§ç”Ÿæˆçš„å­—é¢é‡ï¼Œä¾‹å¦‚å®šä¹‰çš„ä¸€ä¸ªStringç±»å‹çš„æ•°æ®ï¼ˆJava7ä¸­æŠŠå¸¸é‡æ± ç§»åˆ°äº†å †ä¸­ï¼‰ 0. Stringçš„ç‰¹æ€§ 1ã€Stringç±»æ˜¯finalçš„ï¼Œä¸å¯è¢«ç»§æ‰¿ã€‚ 2ã€Stringç±»æ˜¯çš„æœ¬è´¨æ˜¯å­—ç¬¦æ•°ç»„char[], å¹¶ä¸”å…¶å€¼ä¸å¯æ”¹å˜ã€‚ 3ã€Javaè¿è¡Œæ—¶ä¼šç»´æŠ¤ä¸€ä¸ªString Poolï¼ˆStringæ± ï¼‰ï¼ŒJavaDocç¿»è¯‘å¾ˆæ¨¡ç³Šâ€œå­—ç¬¦ä¸²ç¼“å†²åŒºâ€ã€‚Stringæ± ç”¨æ¥å­˜æ”¾è¿è¡Œæ—¶ä¸­äº§ç”Ÿçš„å„ç§å­—ç¬¦ä¸²ï¼Œå¹¶ä¸”æ± ä¸­çš„å­—ç¬¦ä¸²çš„å†…å®¹ä¸é‡å¤ã€‚è€Œä¸€èˆ¬å¯¹è±¡ä¸å­˜åœ¨è¿™ä¸ªç¼“å†²æ± ï¼Œå¹¶ä¸”åˆ›å»ºçš„å¯¹è±¡ä»…ä»…å­˜åœ¨äºæ–¹æ³•çš„å †æ ˆåŒºã€‚ 1. åˆ›å»ºå­—ç¬¦ä¸² åˆ›å»ºå­—ç¬¦ä¸²ä¸€èˆ¬å°±ä¸¤ç§æ–¹æ³•ï¼š 123String s1="hello";String s2=new String("hello"); ç¬¬ä¸€ç§æ–¹æ³•æ˜¯åœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªStringç±»å‹çš„å¼•ç”¨s1ï¼Œç„¶ååœ¨å¸¸é‡æ± ä¸­å¯»æ‰¾ï¼Œå¦‚æœå¸¸é‡æ± ä¸­å­˜åœ¨helloçš„å­—ç¬¦ä¸²æ•°æ®ï¼Œåˆ™ç›´æ¥æŠŠs1æŒ‡å‘å¸¸é‡æ± ä¸­helloçš„åœ°å€ï¼› å¦åˆ™å°±ä¼šåœ¨å¸¸é‡æ± ä¸­åˆ›å»ºhelloè¿™ä¸ªå­—ç¬¦ä¸²æ•°æ®ï¼Œç„¶åæŠŠs1æŒ‡å‘æ–°åˆ›å»ºçš„helloåœ°å€ã€‚ ç¬¬äºŒç§æ–¹æ³•æ˜¯åœ¨æ ˆä¸­åˆ›å»ºä¸€ä¸ªStringç±»å‹çš„å¼•ç”¨s2ï¼Œç„¶ååœ¨å¸¸é‡æ± ä¸­å¯»æ‰¾ï¼Œå¦‚æœå¸¸é‡æ± ä¸­å­˜åœ¨è¯¥æ•°æ®ï¼Œåˆ™åœ¨å †ä¸­å¤åˆ¶æ‹·è´è¯¥æ•°æ®ï¼Œç„¶åæŠŠs2æŒ‡å‘å †ä¸­æ–°å»ºçš„åœ°å€ï¼› å¦åˆ™ä¼šåˆ›å»ºä¸€ä¸ªå­—ç¬¦ä¸²å­˜æ”¾åœ¨å¸¸é‡æ± ä¸­ï¼Œç„¶åè¿›è¡Œæ‹·è´ä¸€ä»½åˆ°å †ä¸­ï¼Œs2æŒ‡å‘å †ä¸­çš„åœ°å€ã€‚ é€šè¿‡newåˆ›å»ºçš„stringä¸€å®šä¼šåœ¨å †ä¸­åˆ›å»ºä¸€ä»½æ•°æ®ï¼ŒåŒæ—¶å¸¸é‡æ± è‚¯å®šæœ‰ä¸€ä¸ªå€¼çš„å¤‡ä»½æ“ä½œï¼›è€Œå•ç‹¬çš„å­—ç¬¦ä¸²åˆ™æ˜¯ç›´æ¥æŒ‡å‘å¸¸é‡æ± ï¼Œæ‰€ä»¥ä¸€èˆ¬è¿˜æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²æ›´å¥½äº›ï¼Œå…·ä½“å¯çœ‹å¦‚ä¸‹çš„å›¾è§£ï¼š 2. å­—ç¬¦ä¸² + æ“ä½œ 1234567891011String s1="helloworld";String s2="hello" + "world";String s3=new String("hello") + "world";System.out.println(s1 == s2); // trueSystem.out.println(s2 == s3); // falseSystem.out.println(s1 == s3); // false ä»£ç ä¸­"hello" + "world"åœ¨ç¼–è¯‘æœŸå·²ç»çŸ¥é“äº†æ•°æ®æƒ…å†µï¼ˆä½¿ç”¨javacç¼–è¯‘æŸ¥çœ‹classæ–‡ä»¶ä¼šå‘ç°s1å’Œs2æ˜¯ä¸€è‡´çš„ï¼‰ï¼ŒJVMä¼šè‡ªåŠ¨ä¼˜åŒ–ä½¿å¾—s1å’Œs2æ˜¯ä¸€æ ·çš„ï¼Œs3ç”±äºæœ‰newæ“ä½œï¼Œæ‰€ä»¥éœ€è¦StringBuilderçš„appendå®Œæˆï¼Œå…·ä½“å¯çœ‹å¦‚ä¸‹å›¾è§£: 3. å­—ç¬¦ä¸²å˜é‡ + æ“ä½œ 123456789String s1="hello";String s2="world";String s3="helloworld";String s4=s1 + s2;System.out.println(s3 == s4); // false è¿™é‡Œçš„æ ·ä¾‹å’Œä¸Šä¸€ä¸ªæ ·ä¾‹å­˜åœ¨ä¸€äº›å·®åˆ«ï¼Œè¿™é‡Œçš„s4æ˜¯ç”±s1 + s2è·å¾—çš„ï¼Œåœ¨ç¼–è¯‘æœŸæ— æ³•æ„ŸçŸ¥åˆ°å…¶å®é™…å€¼ï¼Œåœ¨è¿è¡ŒæœŸæ—¶ä¼šåˆ©ç”¨StringBuilderçš„appendå‰©ä¸‹ä¸€ä¸ªæ–°çš„Stringå¯¹è±¡ï¼Œæ‰€ä»¥s3æŒ‡å‘çš„æ˜¯å¸¸é‡æ± ï¼Œè€Œs4æŒ‡å‘çš„å †ï¼Œä¸¤è€…è‡ªç„¶æ˜¯ä¸ä¸€æ ·çš„ã€‚ 1s4 = new StringBuilder()).append(s1).append(s2).toString(); 5. å¸¦finalçš„å­—ç¬¦ä¸²å˜é‡ + æ“ä½œ 12345678910111213final String s1="hello";String s2="world";String s3="helloworld";String s4=s1 + "world";String s5=s1 + s2;System.out.println(s3 == s4); // trueSystem.out.println(s3 == s5); // false ä½¿ç”¨javacåç¼–è¯‘ä¹‹åçš„classæ–‡ä»¶å¦‚ä¸‹ï¼š 1234567891011String var1 = "world";String var2 = "helloworld";String var3 = "helloworld";String var4 = "hello" + var1;System.out.println(var2 == var3);System.out.println(var2 == var4); æ·»åŠ äº†finalå…³é”®å­—ä¿®é¥°çš„å˜é‡åœ¨ç¼–è¯‘æœŸä¼šè¢«å¯¹åº”çš„å­—ç¬¦ä¸²ç›´æ¥æ›¿æ¢æ‰ï¼Œç›¸å½“äºå­—ç¬¦ä¸²æ•°æ®ï¼Œè€ŒåŒ…å«äº†å­—ç¬¦ä¸²å˜é‡çš„+æ“ä½œåˆ™ä¾æ—§æ˜¯ä½¿ç”¨äº†StringBuilderã€‚ 5. intern()æ–¹æ³• String.internæ–¹æ³•æ˜¯ä¸€ä¸ªnativeæ–¹æ³•ï¼Œè·å–çš„æ˜¯å½“å‰å­—ç¬¦ä¸²åœ¨å¸¸é‡æ± çš„æ•°æ®ï¼Œå¦‚æœå¸¸é‡æ± å­˜åœ¨è¯¥æ•°æ®åˆ™ç›´æ¥è¿”å›ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™æŠŠè¯¥æ•°æ®æ·»åŠ åˆ°å¸¸é‡æ± ä¸­åè¿”å›ï¼Œæ‰€ä»¥æœ‰**String s1 = "abc" å’Œ String s2 = s1.intern() ä¸­çš„s1 == s2å’ŒString s1="world" å’Œ String s2=new String("world") ä¸­ s1.intern() == s2.intern()**1 6. æ€»ç»“ String æœ¬èº«æ˜¯finalç±»å‹çš„ç±»ï¼Œåœ¨æ—¥å¸¸ä½¿ç”¨ä¸­éœ€è¦é¢‘ç¹çš„åšå­—ç¬¦ä¸²åˆå¹¶æ“ä½œæ—¶ï¼Œå°½å¯èƒ½çš„ä½¿ç”¨StringBuilderï¼ˆå¦‚éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨åˆ™ä½¿ç”¨StringBufferï¼‰ï¼Œé™ä½æ— è°“çš„å­—ç¬¦ä¸²åˆ›å»ºæ“ä½œï¼Œåœ¨ä¿è¯å®‰å…¨çš„æƒ…å†µä¸‹ï¼Œæé«˜æ•ˆç‡ï¼ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
        <category>é¢è¯•é¢˜</category>
      </categories>
      <tags>
        <tag>Java</tag>
        <tag>é¢è¯•é¢˜</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Javaå¼‚å¸¸å­¦ä¹ ]]></title>
    <url>%2Fposts%2Fe60072fb.html</url>
    <content type="text"><![CDATA[ä»€ä¹ˆæ˜¯å¼‚å¸¸ å¼‚å¸¸æœ¬è´¨ä¸Šæ˜¯ç¨‹åºä¸Šçš„é”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯åŒ…æ‹¬ç¨‹åºé€»è¾‘é”™è¯¯å’Œç³»ç»Ÿé”™è¯¯ã€‚é”™è¯¯åœ¨ç¨‹åºä¸­åˆæœ‰è¿è¡Œæ—¶å¼‚å¸¸å’Œç¼–è¯‘æ—¶å¼‚å¸¸ã€‚ ç¼–è¯‘å¼‚å¸¸åœ¨ç¼–è¯‘æœŸé—´å‡ºé”™æœ‰ç¼–è¯‘å™¨å¸®åŠ©é”™ï¼Œç„¶è€Œè¿è¡ŒæœŸé—´çš„é”™è¯¯ç¼–è¯‘å™¨åˆ™é­é•¿è«åŠäº†ï¼Œå¹¶ä¸”è¿è¡ŒæœŸé—´çš„é”™è¯¯å¾€å¾€æ˜¯éš¾ä»¥é¢„æ–™çš„ï¼Œä½†æ˜¯å¦‚æœä¸å¤„ç†è¿™äº›å¼‚å¸¸åˆ™ä¼šç›´æ¥å¯¼è‡´ç¨‹åºå´©æºƒã€‚å› æ­¤åœ¨è¿è¡ŒæœŸé—´å‡ºç°é”™è¯¯åº”è¯¥å¦‚ä½•æ¥è¡¥æ•‘æ˜µï¼ŸJavaæä¾›äº†å¼‚å¸¸æœºåˆ¶æ¥å¤„ç†è¿™äº›é”™è¯¯ã€‚ å¼‚å¸¸åˆ†ç±» åœ¨Javaä¸­çš„å¼‚å¸¸è¢«å½“åšå¯¹è±¡æ¥å¤„ç†ï¼Œæ ¹ç±»ä¸ºjava.lang.Throwableç±»ï¼Œåœ¨Javaä¸­å®šä¹‰äº†å¾ˆå¤šå¼‚å¸¸ç±»ï¼ˆå¦‚OutOfMemoryErrorã€NullPointerExceptionã€IndexOutOfBoundsExceptionç­‰ï¼‰ï¼Œè¿™äº›å¼‚å¸¸ç±»åˆ†ä¸ºä¸¤å¤§ç±»ï¼šErrorå’ŒExceptionã€‚ Error Erroræ˜¯æ— æ³•å¤„ç†çš„å¼‚å¸¸ï¼Œæ¯”å¦‚OutOfMemoryErrorï¼Œä¸€èˆ¬å‘ç”Ÿè¿™ç§å¼‚å¸¸ï¼ŒJVMä¼šè‡ªåŠ¨ç»ˆæ­¢ç¨‹åºï¼Œå› æ­¤ç¼–å†™ç¨‹åºæ—¶ä¸éœ€è¦å…³å¿ƒè¿™ç±»å¼‚å¸¸ã€‚ Exception Exceptionï¼Œæ˜¯ç»å¸¸è§åˆ°çš„ä¸€äº›å¼‚å¸¸æƒ…å†µï¼Œæ¯”å¦‚NullPointerExceptionï¼Œè¿™äº›å¼‚å¸¸æ˜¯å¯ä»¥å¤„ç†çš„ã€‚ Exceptionç±»çš„å¼‚å¸¸åŒ…æ‹¬checked exceptionå’Œunchecked exceptionï¼ˆunchecked exceptionä¹Ÿç§°è¿è¡Œæ—¶å¼‚å¸¸RuntimeExceptionï¼Œå½“ç„¶è¿™é‡Œçš„è¿è¡Œæ—¶å¼‚å¸¸å¹¶ä¸æ˜¯å‰é¢æ‰€è¯´çš„è¿è¡ŒæœŸé—´çš„å¼‚å¸¸ï¼Œåªæ˜¯Javaä¸­ç”¨è¿è¡Œæ—¶å¼‚å¸¸è¿™ä¸ªæœ¯è¯­æ¥è¡¨ç¤ºï¼ŒExceptionç±»çš„å¼‚å¸¸éƒ½æ˜¯åœ¨è¿è¡ŒæœŸé—´å‘ç”Ÿçš„ï¼‰ã€‚ unchecked exceptionï¼ˆéæ£€æŸ¥å¼‚å¸¸ï¼‰ï¼Œä¹Ÿç§°è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰ï¼Œæ¯”å¦‚å¸¸è§çš„NullPointerExceptionã€IndexOutOfBoundsExceptionã€‚å¯¹äºè¿è¡Œæ—¶å¼‚å¸¸ï¼Œjavaç¼–è¯‘å™¨ä¸è¦æ±‚å¿…é¡»è¿›è¡Œå¼‚å¸¸æ•è·å¤„ç†æˆ–è€…æŠ›å‡ºå£°æ˜ï¼Œç”±ç¨‹åºå‘˜è‡ªè¡Œå†³å®šã€‚ checked exceptionï¼ˆæ£€æŸ¥å¼‚å¸¸ï¼‰ï¼Œä¹Ÿç§°éè¿è¡Œæ—¶å¼‚å¸¸ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ä»¥å¤–çš„å¼‚å¸¸å°±æ˜¯éè¿è¡Œæ—¶å¼‚å¸¸ï¼‰ï¼Œjavaç¼–è¯‘å™¨å¼ºåˆ¶ç¨‹åºå‘˜å¿…é¡»è¿›è¡Œæ•è·å¤„ç†ï¼Œæ¯”å¦‚å¸¸è§çš„IOExeptionå’ŒSQLExceptionã€‚å¯¹äºéè¿è¡Œæ—¶å¼‚å¸¸å¦‚æœä¸è¿›è¡Œæ•è·æˆ–è€…æŠ›å‡ºå£°æ˜å¤„ç†ï¼Œç¼–è¯‘éƒ½ä¸ä¼šé€šè¿‡ã€‚ åœ¨Javaä¸­ï¼Œæ‰€æœ‰å¼‚å¸¸ç±»çš„çˆ¶ç±»æ˜¯Throwableç±»ï¼ŒErrorç±»æ˜¯errorç±»å‹å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒExceptionç±»æ˜¯exceptionç±»å‹å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒRuntimeExceptionç±»æ˜¯æ‰€æœ‰è¿è¡Œæ—¶å¼‚å¸¸çš„çˆ¶ç±»ï¼ŒRuntimeExceptionä»¥å¤–çš„å¹¶ä¸”ç»§æ‰¿Exceptionçš„ç±»æ˜¯éè¿è¡Œæ—¶å¼‚å¸¸ã€‚ å…¸å‹çš„RuntimeExceptionåŒ…æ‹¬NullPointerExceptionã€IndexOutOfBoundsExceptionã€IllegalArgumentExceptionç­‰ã€‚ å…¸å‹çš„éRuntimeExceptionåŒ…æ‹¬IOExceptionã€SQLExceptionç­‰ã€‚ Javaä¸­å¦‚ä½•å¤„ç†å¼‚å¸¸ åœ¨Javaä¸­å¦‚æœéœ€è¦å¤„ç†å¼‚å¸¸ï¼Œå¿…é¡»å…ˆå¯¹å¼‚å¸¸è¿›è¡Œæ•è·ï¼Œç„¶åå†å¯¹å¼‚å¸¸æƒ…å†µè¿›è¡Œå¤„ç†ã€‚ å¦‚ä½•å¯¹å¯èƒ½å‘ç”Ÿå¼‚å¸¸çš„ä»£ç è¿›è¡Œå¼‚å¸¸æ•è·å’Œå¤„ç†å‘¢ï¼Ÿä½¿ç”¨tryå’Œcatchå…³é”®å­—å³å¯ã€‚ æ•è·å¼‚å¸¸ 12345678910111213try { File file = new File("d:/a.txt"); if(!file.exists()) file.createNewFile();} catch (IOException e) {// TODO: handle exception} åœ¨tryä¸­å‘ç”Ÿçš„å¼‚å¸¸ï¼Œå°†äº¤ç”±catchè¿›è¡Œå¤„ç†ã€‚ æŠ›å‡ºå¼‚å¸¸ 123456789101112131415161718192021222324252627public class Main { public static void main(String[] args) { try { createFile(); } catch (Exception e) { // TODO: handle exception } } public static void createFile() throws IOException{ File file = new File("d:/a.txt"); if(!file.exists()) file.createNewFile(); }} åœ¨createFile()ä¸­å¹¶æ²¡æœ‰å¯¹å¼‚å¸¸è¿›è¡Œå¤„ç†ï¼Œè€Œæ˜¯ç”¨throwså…³é”®å­—å£°æ˜æŠ›å‡ºå¼‚å¸¸ï¼Œå³å‘ŠçŸ¥è¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨è€…æ­¤æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºIOExceptionã€‚é‚£ä¹ˆåœ¨mainæ–¹æ³•ä¸­è°ƒç”¨createFileæ–¹æ³•çš„æ—¶å€™ï¼Œé‡‡ç”¨try...catchå—è¿›è¡Œäº†å¼‚å¸¸æ•è·å¤„ç†ã€‚ throwå…³é”®å­—æ‰‹åŠ¨æ¥æŠ›å‡ºå¼‚å¸¸ 1234567891011121314151617181920212223242526272829public class Main { public static void main(String[] args) { try { int[] data = new int[]{1,2,3}; System.out.println(getDataByIndex(-1,data)); } catch (Exception e) { System.out.println(e.getMessage()); } } public static int getDataByIndex(int index,int[] data) { if(index&lt;0||index&gt;=data.length) throw new ArrayIndexOutOfBoundsException("æ•°ç»„ä¸‹æ ‡è¶Šç•Œ"); return data[index]; }} ç„¶ååœ¨catchå—ä¸­è¿›è¡Œæ•è·ã€‚ åœ¨Javaä¸­è¿›è¡Œå¼‚å¸¸å¤„ç†çš„è¯ï¼Œå¯¹äºå¯èƒ½ä¼šå‘ç”Ÿå¼‚å¸¸çš„ä»£ç ï¼Œå¯ä»¥é€‰æ‹©ä¸‰ç§æ–¹æ³•æ¥è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼š1ï¼‰å¯¹ä»£ç å—ç”¨try..catchè¿›è¡Œå¼‚å¸¸æ•è·å¤„ç†ï¼›2ï¼‰åœ¨è¯¥ä»£ç çš„æ–¹æ³•ä½“å¤–ç”¨throwsè¿›è¡ŒæŠ›å‡ºå£°æ˜ï¼Œå‘ŠçŸ¥æ­¤æ–¹æ³•çš„è°ƒç”¨è€…è¿™æ®µä»£ç å¯èƒ½ä¼šå‡ºç°è¿™äº›å¼‚å¸¸ï¼Œéœ€è¦è°¨æ…å¤„ç†ã€‚æ­¤æ—¶æœ‰ä¸¤ç§æƒ…å†µï¼šå¦‚æœå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸æ˜¯éè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºåœ°ç”¨try..catchå—è¿›è¡Œæ•è·æˆ–è€…ç»§ç»­å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœå£°æ˜æŠ›å‡ºçš„å¼‚å¸¸æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥é€‰æ‹©åœ°è¿›è¡Œå¼‚å¸¸æ•è·å¤„ç†ã€‚3ï¼‰åœ¨ä»£ç å—ç”¨throwæ‰‹åŠ¨æŠ›å‡ºä¸€ä¸ªå¼‚å¸¸å¯¹è±¡ï¼Œæ­¤æ—¶ä¹Ÿæœ‰ä¸¤ç§æƒ…å†µï¼Œè·Ÿ2ï¼‰ä¸­çš„ç±»ä¼¼ï¼šå¦‚æœæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡æ˜¯éè¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¿…é¡»æ˜¾ç¤ºåœ°ç”¨try..catchå—è¿›è¡Œæ•è·æˆ–è€…ç»§ç»­å‘ä¸Šå±‚æŠ›å‡ºå¼‚å¸¸ã€‚å¦‚æœæŠ›å‡ºçš„å¼‚å¸¸å¯¹è±¡æ˜¯è¿è¡Œæ—¶å¼‚å¸¸ï¼Œæ­¤æ–¹æ³•çš„è°ƒç”¨è€…å¯ä»¥é€‰æ‹©åœ°è¿›è¡Œå¼‚å¸¸æ•è·å¤„ç†ã€‚ï¼ˆå¦‚æœæœ€ç»ˆå°†å¼‚å¸¸æŠ›ç»™mainæ–¹æ³•ï¼Œåˆ™ç›¸å½“äºäº¤ç»™jvmè‡ªåŠ¨å¤„ç†ï¼Œæ­¤æ—¶jvmä¼šç®€å•åœ°æ‰“å°å¼‚å¸¸ä¿¡æ¯ï¼‰ä¸€ä¸ªæ–¹æ³•æ‰€èƒ½æ•æ‰çš„å¼‚å¸¸ï¼Œä¸€å®šæ˜¯Javaä»£ç åœ¨æŸå¤„æ‰€æŠ›å‡ºçš„å¼‚å¸¸ã€‚ç®€å•åœ°è¯´ï¼Œå¼‚å¸¸æ€»æ˜¯å…ˆè¢«æŠ›å‡ºï¼Œåè¢«æ•æ‰çš„ã€‚ ç†è§£try,catch,finally,throws,throwäº”ä¸ªå…³é”®å­— try,catch,finally tryå…³é”®å­—ç”¨æ¥åŒ…å›´å¯èƒ½ä¼šå‡ºç°å¼‚å¸¸çš„é€»è¾‘ä»£ç ï¼Œå®ƒå•ç‹¬æ— æ³•ä½¿ç”¨ï¼Œå¿…é¡»é…åˆcatchæˆ–è€…finallyä½¿ç”¨ã€‚Javaç¼–è¯‘å™¨å…è®¸çš„ç»„åˆä½¿ç”¨å½¢å¼åªæœ‰ä»¥ä¸‹ä¸‰ç§å½¢å¼ï¼š try...catch...; try....finally......; try....catch...finally... å½“ç„¶catchå—å¯ä»¥æœ‰å¤šä¸ªï¼Œæ³¨æ„tryå—åªèƒ½æœ‰ä¸€ä¸ª,finallyå—æ˜¯å¯é€‰çš„ï¼ˆä½†æ˜¯æœ€å¤šåªèƒ½æœ‰ä¸€ä¸ªfinallyå—ï¼‰ã€‚ ä¸‰ä¸ªå—æ‰§è¡Œçš„é¡ºåºä¸ºtryâ€”&gt;catchâ€”&gt;finallyã€‚ å½“ç„¶å¦‚æœæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸ï¼Œåˆ™catchå—ä¸ä¼šæ‰§è¡Œã€‚ä½†æ˜¯finallyå—æ— è®ºåœ¨ä»€ä¹ˆæƒ…å†µä¸‹éƒ½æ˜¯ä¼šæ‰§è¡Œçš„ï¼ˆè¿™ç‚¹è¦éå¸¸æ³¨æ„ï¼Œå› æ­¤éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œéƒ½ä¼šå°†é‡Šæ”¾èµ„æºçš„æ“ä½œæ”¾åœ¨finallyå—ä¸­è¿›è¡Œï¼‰ã€‚ åœ¨æœ‰å¤šä¸ªcatchå—çš„æ—¶å€™ï¼Œæ˜¯æŒ‰ç…§catchå—çš„å…ˆåé¡ºåºè¿›è¡ŒåŒ¹é…çš„ï¼Œä¸€æ—¦å¼‚å¸¸ç±»å‹è¢«ä¸€ä¸ªcatchå—åŒ¹é…ï¼Œåˆ™ä¸ä¼šä¸åé¢çš„catchå—è¿›è¡ŒåŒ¹é…ã€‚ åœ¨ä½¿ç”¨try..catch..finallyå—çš„æ—¶å€™ï¼Œæ³¨æ„åƒä¸‡ä¸è¦åœ¨finallyå—ä¸­ä½¿ç”¨returnï¼Œå› ä¸ºfinallyä¸­çš„returnä¼šè¦†ç›–å·²æœ‰çš„è¿”å›å€¼ã€‚ 1234567891011121314151617181920212223242526272829303132public String openFile() { try { FileInputStream inputStream = new FileInputStream("d:/a.txt"); int ch = inputStream.read(); System.out.println("aaa"); return "step1"; } catch (FileNotFoundException e) { System.out.println("file not found"); return "step2"; }catch (IOException e) { System.out.println("io exception"); return "step3"; }finally{ System.out.println("finally block"); return "finally"; }} è¿™é‡Œfinallyä¸­çš„è¿”å›å€¼å›å§catché‡Œé¢çš„è¿”å›å€¼ç»™è¦†ç›–ï¼Œä¹Ÿä¼šæŠŠtryä¸­çš„returnè¦†ç›–æ‰ã€‚ä»è°ƒè¯•ä¸­å¯ä»¥çœ‹å‡ºæ¥ï¼Œtryä¸­å°±ç®—æœ‰returnï¼Œä¹Ÿä¼šæ‰§è¡Œfinallyä¸­ã€‚ æ€»ç»“ï¼š try å—ï¼šç”¨äºæ•è·å¼‚å¸¸ã€‚å…¶åå¯æ¥é›¶ä¸ªæˆ–å¤šä¸ªcatchå—ï¼Œå¦‚æœæ²¡æœ‰catchå—ï¼Œåˆ™å¿…é¡»è·Ÿä¸€ä¸ªfinallyå—ã€‚catch å—ï¼šç”¨äºå¤„ç†tryæ•è·åˆ°çš„å¼‚å¸¸ã€‚finally å—ï¼šæ— è®ºæ˜¯å¦æ•è·æˆ–å¤„ç†å¼‚å¸¸ï¼Œfinallyå—é‡Œçš„è¯­å¥éƒ½ä¼šè¢«æ‰§è¡Œã€‚å½“åœ¨tryå—æˆ–catchå—ä¸­é‡åˆ°returnè¯­å¥æ—¶ï¼Œfinallyè¯­å¥å—å°†åœ¨æ–¹æ³•è¿”å›ä¹‹å‰è¢«æ‰§è¡Œã€‚åœ¨ä»¥ä¸‹4ç§ç‰¹æ®Šæƒ…å†µä¸‹ï¼Œfinallyå—ä¸ä¼šè¢«æ‰§è¡Œï¼š1ï¼‰åœ¨finallyè¯­å¥å—ä¸­å‘ç”Ÿäº†å¼‚å¸¸ã€‚2ï¼‰åœ¨å‰é¢çš„ä»£ç ä¸­ç”¨äº†System.exit()é€€å‡ºç¨‹åºã€‚3ï¼‰ç¨‹åºæ‰€åœ¨çš„çº¿ç¨‹æ­»äº¡ã€‚4ï¼‰å…³é—­CPUã€‚ throwså’Œthowå…³é”®å­— throwså‡ºç°åœ¨æ–¹æ³•çš„å£°æ˜ä¸­ï¼Œè¡¨ç¤ºè¯¥æ–¹æ³•å¯èƒ½ä¼šæŠ›å‡ºçš„å¼‚å¸¸ï¼Œç„¶åäº¤ç»™ä¸Šå±‚è°ƒç”¨å®ƒçš„æ–¹æ³•ç¨‹åºå¤„ç†ï¼Œå…è®¸throwsåé¢è·Ÿç€å¤šä¸ªå¼‚å¸¸ç±»å‹ï¼› throwä¸€èˆ¬ä¼šç”¨äºç¨‹åºå‡ºç°æŸç§é€»è¾‘æ—¶ç¨‹åºå‘˜ä¸»åŠ¨æŠ›å‡ºæŸç§ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚throwåªä¼šå‡ºç°åœ¨æ–¹æ³•ä½“ä¸­ï¼Œå½“æ–¹æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­é‡åˆ°å¼‚å¸¸æƒ…å†µæ—¶ï¼Œå°†å¼‚å¸¸ä¿¡æ¯å°è£…ä¸ºå¼‚å¸¸å¯¹è±¡ï¼Œç„¶åthrowå‡ºå»ã€‚throwå…³é”®å­—çš„ä¸€ä¸ªéå¸¸é‡è¦çš„ä½œç”¨å°±æ˜¯å¼‚å¸¸ç±»å‹çš„è½¬æ¢ã€‚ throwsè¡¨ç¤ºå‡ºç°å¼‚å¸¸çš„ä¸€ç§å¯èƒ½æ€§ï¼Œå¹¶ä¸ä¸€å®šä¼šå‘ç”Ÿè¿™äº›å¼‚å¸¸ï¼›throwåˆ™æ˜¯æŠ›å‡ºäº†å¼‚å¸¸ï¼Œæ‰§è¡Œthrowåˆ™ä¸€å®šæŠ›å‡ºäº†æŸç§å¼‚å¸¸å¯¹è±¡ã€‚ä¸¤è€…éƒ½æ˜¯æ¶ˆæå¤„ç†å¼‚å¸¸çš„æ–¹å¼ï¼ˆè¿™é‡Œçš„æ¶ˆæå¹¶ä¸æ˜¯è¯´è¿™ç§æ–¹å¼ä¸å¥½ï¼‰ï¼Œåªæ˜¯æŠ›å‡ºæˆ–è€…å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä½†æ˜¯ä¸ä¼šç”±æ–¹æ³•å»å¤„ç†å¼‚å¸¸ï¼ŒçœŸæ­£çš„å¤„ç†å¼‚å¸¸ç”±æ­¤æ–¹æ³•çš„ä¸Šå±‚è°ƒç”¨å¤„ç†ã€‚ å¼‚å¸¸å¤„ç†å»ºè®® åªåœ¨å¿…è¦ä½¿ç”¨å¼‚å¸¸çš„åœ°æ–¹æ‰ä½¿ç”¨å¼‚å¸¸ï¼Œä¸è¦ç”¨å¼‚å¸¸å»æ§åˆ¶ç¨‹åºçš„æµç¨‹ã€‚è°¨æ…åœ°ä½¿ç”¨å¼‚å¸¸ï¼šå¼‚å¸¸æ•è·çš„ä»£ä»·éå¸¸é«˜æ˜‚ï¼Œå¼‚å¸¸ä½¿ç”¨è¿‡å¤šä¼šä¸¥é‡å½±å“ç¨‹åºçš„æ€§èƒ½ã€‚å¦‚æœåœ¨ç¨‹åºä¸­èƒ½å¤Ÿç”¨ifè¯­å¥å’ŒBooleanå˜é‡æ¥è¿›è¡Œé€»è¾‘åˆ¤æ–­ï¼Œé‚£ä¹ˆå°½é‡å‡å°‘å¼‚å¸¸çš„ä½¿ç”¨ï¼Œä»è€Œé¿å…ä¸å¿…è¦çš„å¼‚å¸¸æ•è·å’Œå¤„ç†ã€‚åˆ‡å¿Œä½¿ç”¨ç©ºcatchå—åœ¨æ•è·äº†å¼‚å¸¸ä¹‹åä»€ä¹ˆéƒ½ä¸åšï¼Œç›¸å½“äºå¿½ç•¥äº†è¿™ä¸ªå¼‚å¸¸ã€‚åƒä¸‡ä¸è¦ä½¿ç”¨ç©ºçš„catchå—ï¼Œç©ºçš„catchå—æ„å‘³ç€ä½ åœ¨ç¨‹åºä¸­éšè—äº†é”™è¯¯å’Œå¼‚å¸¸ï¼Œå¹¶ä¸”å¾ˆå¯èƒ½å¯¼è‡´ç¨‹åºå‡ºç°ä¸å¯æ§çš„æ‰§è¡Œç»“æœã€‚å¦‚æœä½ éå¸¸è‚¯å®šæ•è·åˆ°çš„å¼‚å¸¸ä¸ä¼šä»¥ä»»ä½•æ–¹å¼å¯¹ç¨‹åºé€ æˆå½±å“ï¼Œæœ€å¥½ç”¨Logæ—¥å¿—å°†è¯¥å¼‚å¸¸è¿›è¡Œè®°å½•ï¼Œä»¥ä¾¿æ—¥åæ–¹ä¾¿æ›´æ–°å’Œç»´æŠ¤ã€‚æ£€æŸ¥å¼‚å¸¸å’Œéæ£€æŸ¥å¼‚å¸¸çš„é€‰æ‹©ä¸€æ—¦å†³å®šæŠ›å‡ºå¼‚å¸¸ï¼Œå°±è¦å†³å®šæŠ›å‡ºä»€ä¹ˆå¼‚å¸¸ã€‚è¿™é‡Œé¢çš„ä¸»è¦é—®é¢˜å°±æ˜¯æŠ›å‡ºæ£€æŸ¥å¼‚å¸¸è¿˜æ˜¯éæ£€æŸ¥å¼‚å¸¸ã€‚æ£€æŸ¥å¼‚å¸¸å¯¼è‡´äº†å¤ªå¤šçš„tryâ€¦catchä»£ç ï¼Œå¯èƒ½æœ‰å¾ˆå¤šæ£€æŸ¥å¼‚å¸¸å¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯æ— æ³•åˆç†åœ°è¿›è¡Œå¤„ç†çš„ï¼Œæ¯”å¦‚SQLExceptionï¼Œè€Œå¼€å‘äººå‘˜å´ä¸å¾—ä¸å»è¿›è¡Œtryâ€¦catchï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´ç»å¸¸å‡ºç°è¿™æ ·ä¸€ç§æƒ…å†µï¼šé€»è¾‘ä»£ç åªæœ‰å¾ˆå°‘çš„å‡ è¡Œï¼Œè€Œè¿›è¡Œå¼‚å¸¸æ•è·å’Œå¤„ç†çš„ä»£ç å´æœ‰å¾ˆå¤šè¡Œã€‚è¿™æ ·ä¸ä»…å¯¼è‡´é€»è¾‘ä»£ç é˜…è¯»èµ·æ¥æ™¦æ¶©éš¾æ‡‚ï¼Œè€Œä¸”é™ä½äº†ç¨‹åºçš„æ€§èƒ½ã€‚å»ºè®®å°½é‡é¿å…æ£€æŸ¥å¼‚å¸¸çš„ä½¿ç”¨ï¼Œå¦‚æœç¡®å®è¯¥å¼‚å¸¸æƒ…å†µçš„å‡ºç°å¾ˆæ™®éï¼Œéœ€è¦æé†’è°ƒç”¨è€…æ³¨æ„å¤„ç†çš„è¯ï¼Œå°±ä½¿ç”¨æ£€æŸ¥å¼‚å¸¸ï¼›å¦åˆ™ä½¿ç”¨éæ£€æŸ¥å¼‚å¸¸ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå°½é‡å°†æ£€æŸ¥å¼‚å¸¸è½¬å˜ä¸ºéæ£€æŸ¥å¼‚å¸¸äº¤ç»™ä¸Šå±‚å¤„ç†ã€‚æ³¨æ„catchå—çš„é¡ºåºï¼Œä¸è¦æŠŠä¸Šå±‚ç±»çš„å¼‚å¸¸æ”¾åœ¨æœ€å‰é¢çš„catchå—ã€‚ä¸è¦å°†æä¾›ç»™ç”¨æˆ·çœ‹çš„ä¿¡æ¯æ”¾åœ¨å¼‚å¸¸ä¿¡æ¯é‡Œã€‚é¿å…å¤šæ¬¡åœ¨æ—¥å¿—ä¿¡æ¯ä¸­è®°å½•åŒä¸€ä¸ªå¼‚å¸¸åªåœ¨å¼‚å¸¸æœ€å¼€å§‹å‘ç”Ÿçš„åœ°æ–¹è¿›è¡Œæ—¥å¿—ä¿¡æ¯è®°å½•ã€‚å¾ˆå¤šæƒ…å†µä¸‹å¼‚å¸¸éƒ½æ˜¯å±‚å±‚å‘ä¸Šè·‘å‡ºçš„ï¼Œå¦‚æœåœ¨æ¯æ¬¡å‘ä¸ŠæŠ›å‡ºçš„æ—¶å€™ï¼Œéƒ½Logåˆ°æ—¥å¿—ç³»ç»Ÿä¸­ï¼Œåˆ™ä¼šå¯¼è‡´æ— ä»æŸ¥æ‰¾å¼‚å¸¸å‘ç”Ÿçš„æ ¹æºã€‚å¼‚å¸¸å¤„ç†å°½é‡æ”¾åœ¨é«˜å±‚è¿›è¡Œå°½é‡å°†å¼‚å¸¸ç»Ÿä¸€æŠ›ç»™ä¸Šå±‚è°ƒç”¨è€…ï¼Œç”±ä¸Šå±‚è°ƒç”¨è€…ç»Ÿä¸€ä¹‹æ—¶å¦‚ä½•è¿›è¡Œå¤„ç†ã€‚å¦‚æœåœ¨æ¯ä¸ªå‡ºç°å¼‚å¸¸çš„åœ°æ–¹éƒ½ç›´æ¥è¿›è¡Œå¤„ç†ï¼Œä¼šå¯¼è‡´ç¨‹åºå¼‚å¸¸å¤„ç†æµç¨‹æ··ä¹±ï¼Œä¸åˆ©äºåæœŸç»´æŠ¤å’Œå¼‚å¸¸é”™è¯¯æ’æŸ¥ã€‚ç”±ä¸Šå±‚ç»Ÿä¸€è¿›è¡Œå¤„ç†ä¼šä½¿å¾—æ•´ä¸ªç¨‹åºçš„æµç¨‹æ¸…æ™°æ˜“æ‡‚ã€‚åœ¨finallyä¸­é‡Šæ”¾èµ„æºå¦‚æœæœ‰ä½¿ç”¨æ–‡ä»¶è¯»å–ã€ç½‘ç»œæ“ä½œä»¥åŠæ•°æ®åº“æ“ä½œç­‰ï¼Œè®°å¾—åœ¨finallyä¸­é‡Šæ”¾èµ„æºã€‚è¿™æ ·ä¸ä»…ä¼šä½¿å¾—ç¨‹åºå ç”¨æ›´å°‘çš„èµ„æºï¼Œä¹Ÿä¼šé¿å…ä¸å¿…è¦çš„ç”±äºèµ„æºæœªé‡Šæ”¾è€Œå‘ç”Ÿçš„å¼‚å¸¸æƒ…å†µã€‚é¿å…è¿‡å¤§çš„tryå—ï¼Œä¸è¦æŠŠä¸ä¼šå‡ºç°å¼‚å¸¸çš„ä»£ç æ”¾åˆ°tryå—é‡Œé¢ï¼Œå°½é‡ä¿æŒä¸€ä¸ªtryå—å¯¹åº”ä¸€ä¸ªæˆ–å¤šä¸ªå¼‚å¸¸ã€‚ç»†åŒ–å¼‚å¸¸çš„ç±»å‹ï¼Œä¸è¦ä¸ç®¡ä»€ä¹ˆç±»å‹çš„å¼‚å¸¸éƒ½å†™æˆExcetpionã€‚catchå—å°½é‡ä¿æŒä¸€ä¸ªå—æ•è·ä¸€ç±»å¼‚å¸¸ï¼Œä¸è¦å¿½ç•¥æ•è·çš„å¼‚å¸¸ï¼Œæ•è·åˆ°åè¦ä¹ˆå¤„ç†ï¼Œè¦ä¹ˆè½¬è¯‘ï¼Œè¦ä¹ˆé‡æ–°æŠ›å‡ºæ–°ç±»å‹çš„å¼‚å¸¸ã€‚ä¸è¦æŠŠè‡ªå·±èƒ½å¤„ç†çš„å¼‚å¸¸æŠ›ç»™åˆ«äººã€‚ä¸è¦ç”¨try...catchå‚ä¸æ§åˆ¶ç¨‹åºæµç¨‹ï¼Œå¼‚å¸¸æ§åˆ¶çš„æ ¹æœ¬ç›®çš„æ˜¯å¤„ç†ç¨‹åºçš„éæ­£å¸¸æƒ…å†µã€‚ Throwableç±»ä¸­çš„å¸¸ç”¨æ–¹æ³• catchå…³é”®å­—åé¢æ‹¬å·ä¸­çš„Exceptionç±»å‹çš„å‚æ•°eã€‚Exceptionå°±æ˜¯tryä»£ç å—ä¼ é€’ç»™catchä»£ç å—çš„å˜é‡ç±»å‹ï¼Œeå°±æ˜¯å˜é‡åã€‚catchä»£ç å—ä¸­è¯­å¥"e.getMessage();"ç”¨äºè¾“å‡ºé”™è¯¯æ€§è´¨ã€‚é€šå¸¸å¼‚å¸¸å¤„ç†å¸¸ç”¨3ä¸ªå‡½æ•°æ¥è·å–å¼‚å¸¸çš„æœ‰å…³ä¿¡æ¯: getCause()ï¼šè¿”å›æŠ›å‡ºå¼‚å¸¸çš„åŸå› ã€‚å¦‚æœ cause ä¸å­˜åœ¨æˆ–æœªçŸ¥ï¼Œåˆ™è¿”å› nullã€‚ getMeage()ï¼šè¿”å›å¼‚å¸¸çš„æ¶ˆæ¯ä¿¡æ¯ã€‚ printStackTrace()ï¼šå¯¹è±¡çš„å †æ ˆè·Ÿè¸ªè¾“å‡ºè‡³é”™è¯¯è¾“å‡ºæµï¼Œä½œä¸ºå­—æ®µ System.err çš„å€¼ã€‚ æœ‰æ—¶ä¸ºäº†ç®€å•ä¼šå¿½ç•¥æ‰catchè¯­å¥åçš„ä»£ç ï¼Œè¿™æ ·try-catchè¯­å¥å°±æˆäº†ä¸€ç§æ‘†è®¾ï¼Œä¸€æ—¦ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†å¼‚å¸¸ï¼Œå°±ä¼šå¿½ç•¥å¤„ç†å¼‚å¸¸ï¼Œè€Œé”™è¯¯å‘ç”Ÿçš„åŸå› å¾ˆéš¾æŸ¥æ‰¾ã€‚ Javaå¸¸è§å¼‚å¸¸ runtimeExceptionå­ç±» java.lang.ArrayIndexOutOfBoundsException &nbsp; &nbsp; æ•°ç»„ç´¢å¼•è¶Šç•Œå¼‚å¸¸ã€‚å½“å¯¹æ•°ç»„çš„ç´¢å¼•å€¼ä¸ºè´Ÿæ•°æˆ–å¤§äºç­‰äºæ•°ç»„å¤§å°æ—¶æŠ›å‡ºã€‚ java.lang.ArithmeticException &nbsp; &nbsp; ç®—æœ¯æ¡ä»¶å¼‚å¸¸ã€‚è­¬å¦‚ï¼šæ•´æ•°é™¤é›¶ç­‰ã€‚ java.lang.NullPointerException &nbsp; &nbsp; ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾åœ¨è¦æ±‚ä½¿ç”¨å¯¹è±¡çš„åœ°æ–¹ä½¿ç”¨äº†nullæ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚è­¬å¦‚ï¼šè°ƒç”¨nullå¯¹è±¡çš„å®ä¾‹æ–¹æ³•ã€è®¿é—®nullå¯¹è±¡çš„å±æ€§ã€è®¡ç®—nullå¯¹è±¡çš„é•¿åº¦ã€ä½¿ç”¨throwè¯­å¥æŠ›å‡ºnullç­‰ç­‰ java.lang.ClassNotFoundException &nbsp; &nbsp; æ‰¾ä¸åˆ°ç±»å¼‚å¸¸ã€‚å½“åº”ç”¨è¯•å›¾æ ¹æ®å­—ç¬¦ä¸²å½¢å¼çš„ç±»åæ„é€ ç±»ï¼Œè€Œåœ¨éå†CLASSPAHä¹‹åæ‰¾ä¸åˆ°å¯¹åº”åç§°çš„classæ–‡ä»¶æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ã€‚ java.lang.NegativeArraySizeException&nbsp;&nbsp;æ•°ç»„é•¿åº¦ä¸ºè´Ÿå¼‚å¸¸ java.lang.ArrayStoreException&nbsp;æ•°ç»„ä¸­åŒ…å«ä¸å…¼å®¹çš„å€¼æŠ›å‡ºçš„å¼‚å¸¸ java.lang.SecurityException&nbsp;å®‰å…¨æ€§å¼‚å¸¸ java.lang.IllegalArgumentException&nbsp;éæ³•å‚æ•°å¼‚å¸¸ IOException IOExceptionï¼šæ“ä½œè¾“å…¥æµå’Œè¾“å‡ºæµæ—¶å¯èƒ½å‡ºç°çš„å¼‚å¸¸ã€‚ EOFExceptionï¼šæ–‡ä»¶å·²ç»“æŸå¼‚å¸¸ FileNotFoundExceptionï¼šæ–‡ä»¶æœªæ‰¾åˆ°å¼‚å¸¸ å…¶ä»–å¼‚å¸¸ ClassCastExceptionï¼šç±»å‹è½¬æ¢å¼‚å¸¸ç±» ArrayStoreExceptionï¼šæ•°ç»„ä¸­åŒ…å«ä¸å…¼å®¹çš„å€¼æŠ›å‡ºçš„å¼‚å¸¸ SQLExceptionï¼šæ“ä½œæ•°æ®åº“å¼‚å¸¸ç±» NoSuchFieldExceptionï¼šå­—æ®µæœªæ‰¾åˆ°å¼‚å¸¸ NoSuchMethodExceptionï¼šæ–¹æ³•æœªæ‰¾åˆ°æŠ›å‡ºçš„å¼‚å¸¸ NumberFormatExceptionï¼šå­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—æŠ›å‡ºçš„å¼‚å¸¸ StringIndexOutOfBoundsExceptionï¼šå­—ç¬¦ä¸²ç´¢å¼•è¶…å‡ºèŒƒå›´æŠ›å‡ºçš„å¼‚å¸¸ IllegalAccessExceptionï¼šä¸å…è®¸è®¿é—®æŸç±»å¼‚å¸¸ InstantiationExceptionï¼šå½“åº”ç”¨ç¨‹åºè¯•å›¾ä½¿ç”¨Classç±»ä¸­çš„newInstance()æ–¹æ³•åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹ï¼Œè€ŒæŒ‡å®šçš„ç±»å¯¹è±¡æ— æ³•è¢«å®ä¾‹åŒ–æ—¶ï¼ŒæŠ›å‡ºè¯¥å¼‚å¸¸ è‡ªå®šä¹‰å¼‚å¸¸ ä½¿ç”¨Javaå†…ç½®çš„å¼‚å¸¸ç±»å¯ä»¥æè¿°åœ¨ç¼–ç¨‹æ—¶å‡ºç°çš„å¤§éƒ¨åˆ†å¼‚å¸¸æƒ…å†µã€‚é™¤æ­¤ä¹‹å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥è‡ªå®šä¹‰å¼‚å¸¸ã€‚ç”¨æˆ·è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œåªéœ€ç»§æ‰¿Exceptionç±»å³å¯ã€‚ åœ¨ç¨‹åºä¸­ä½¿ç”¨è‡ªå®šä¹‰å¼‚å¸¸ç±»ï¼Œå¤§ä½“å¯åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ã€‚ ï¼ˆ1ï¼‰åˆ›å»ºè‡ªå®šä¹‰å¼‚å¸¸ç±»ã€‚ ï¼ˆ2ï¼‰åœ¨æ–¹æ³•ä¸­é€šè¿‡throwå…³é”®å­—æŠ›å‡ºå¼‚å¸¸å¯¹è±¡ã€‚ ï¼ˆ3ï¼‰å¦‚æœåœ¨å½“å‰æŠ›å‡ºå¼‚å¸¸çš„æ–¹æ³•ä¸­å¤„ç†å¼‚å¸¸ï¼Œå¯ä»¥ä½¿ç”¨try-catchè¯­å¥æ•è·å¹¶å¤„ç†ï¼›å¦åˆ™åœ¨æ–¹æ³•çš„å£°æ˜å¤„é€šè¿‡throwså…³é”®å­—æŒ‡æ˜è¦æŠ›å‡ºç»™æ–¹æ³•è°ƒç”¨è€…çš„å¼‚å¸¸ï¼Œç»§ç»­è¿›è¡Œä¸‹ä¸€æ­¥æ“ä½œã€‚ ï¼ˆ4ï¼‰åœ¨å‡ºç°å¼‚å¸¸æ–¹æ³•çš„è°ƒç”¨è€…ä¸­æ•è·å¹¶å¤„ç†å¼‚å¸¸ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Java</category>
      </categories>
      <tags>
        <tag>Java</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdown è¯­æ³•ç”»æµç¨‹å›¾]]></title>
    <url>%2Fposts%2F711ce00.html</url>
    <content type="text"><![CDATA[æ·»åŠ æ”¯æŒ Hexo é»˜è®¤æ˜¯ä¸æ”¯æŒæµç¨‹å›¾çš„ Markdown è¯­æ³•çš„ï¼Œéœ€è¦æ·»åŠ æ”¯æŒï¼š 1npm install --save hexo-filter-flowchart æ¼”ç¤º ä¸€ä¸ªç®€å•çš„æµç¨‹å›¾ è¯­æ³•å¦‚ä¸‹ï¼š 12345678910Â·Â·Â·flow #ç”±äºæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `st=&gt;start: å¼€å§‹e=&gt;end: ç»“æŸop=&gt;operation: æˆ‘çš„æ“ä½œcond=&gt;condition: ç¡®è®¤ï¼Ÿst-&gt;op-&gt;condcond(yes)-&gt;econd(no)-&gt;opÂ·Â·Â· æ•ˆæœå¦‚ä¸‹ï¼š &lt;div id="flowchart-0" class="flow-chart"&gt;&lt;/div&gt; ä¸€ä¸ªç¨å¤æ‚çš„æµç¨‹å›¾ è¯­æ³•å¦‚ä¸‹ï¼š 12345678910111213Â·Â·Â·flow #ç”±äºæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `st=&gt;start: Start:&gt;http://www.google.com[blank]e=&gt;end:&gt;http://www.google.comop1=&gt;operation: My Operationsub1=&gt;subroutine: My Subroutinecond=&gt;condition: Yesor No?:&gt;http://www.google.comio=&gt;inputoutput: catch something...st-&gt;op1-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op1Â·Â·Â· æ•ˆæœå¦‚ä¸‹ï¼š &lt;div id="flowchart-1" class="flow-chart"&gt;&lt;/div&gt; è¯­æ³•è¯¦è§£ Hexoä¸­çš„æµç¨‹å›¾æ˜¯ä¾èµ–äºflowchart.js å®ç°çš„ã€‚ ä»¥ä¸Šé¢é‚£ä¸ªç¨å¤æ‚çš„æµç¨‹å›¾ä¸ºä¾‹ï¼š 1234567891011121314Â·Â·Â·flow #ç”±äºæ¸²æŸ“é—®é¢˜ï¼Œè¯·è‡ªè¡Œå°† Â· æ›¿æ¢ä¸º `//å®šä¹‰éƒ¨åˆ†st=&gt;start: Start:&gt;http://www.google.com[blank]e=&gt;end:&gt;http://www.google.comop1=&gt;operation: My Operationsub1=&gt;subroutine: My Subroutinecond=&gt;condition: Yes or No?:&gt;http://www.google.comio=&gt;inputoutput: catch something...//åˆ¤æ–­å’Œä½ç½®æ§åˆ¶st-&gt;op1-&gt;condcond(yes)-&gt;io-&gt;econd(no)-&gt;sub1(right)-&gt;op1Â·Â·Â· ä¾‹å¦‚è¿™ä¸€å¥ï¼š st=&gt;start: Start|past:&gt;http://www.google.com[blank] å…¶ä¸­ï¼Œstæ˜¯å˜é‡åï¼Œstartæ˜¯æŒ‡æ“ä½œæ¨¡å—åï¼Œå†’å·åé¢å°±æ˜¯å†…å®¹äº†ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ** å†’å·åè¦åŠ ç©ºæ ¼æ‰èƒ½è¯†åˆ« ** æ“ä½œæ¨¡å—è¯­æ³• æ“ä½œæ¨¡å— è¯´æ˜ start å¼€å§‹ end ç»“æŸ operation æ™®é€šæ“ä½œå— condition åˆ¤æ–­å— subroutine å­ä»»åŠ¡å— inputoutput è¾“å…¥è¾“å‡ºå— åˆ¤æ–­å’Œä½ç½®æ§åˆ¶ æµç¨‹æ§åˆ¶ st-&gt;op1-&gt;e -&gt; ä½œä¸ºæ§åˆ¶æµç¨‹çš„æ“ä½œç¬¦ï¼Œå°±æ˜¯æŒ‡å‘ä¸‹ä¸€æ­¥è¦æ“ä½œçš„ã€‚ æ¯ä¸€æ¡éƒ½ç®—æ˜¯ä¸€æ¡æµç¨‹ ä½ ä¹Ÿå¯ä»¥æ–­å¼€å†™ï¼Œæ€ä¹ˆæ–¹ä¾¿æ€ä¹ˆæ¥ï¼Œå¦‚ï¼šä¸‹é¢ä¸¤ä¸ªæ˜¯ä¸€æ ·çš„ã€‚ åˆ†ç€å†™ st-&gt;op1 op1-&gt;e åˆç€å†™ st-&gt;op1-&gt;e åˆ¤æ–­ cond(yes)-&gt;io-&gt;e #yesçš„æ—¶å€™åˆ°ioï¼Œå†åˆ°e ä½ç½®æŒ‡å®š cond(no)-&gt;sub1(right)-&gt;op1 #noçš„æ—¶å€™åˆ°åˆ° sub1ï¼Œå†ä»sub1çš„å³ä¾§åˆ°op1 è¿˜å¯ä»¥è¿™æ · cond1(no,right) ```&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"&gt;&lt;/script&gt;&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"&gt;&lt;/script&gt;{% raw %}st=&gt;start: å¼€å§‹ e=&gt;end: ç»“æŸ op=&gt;operation: æˆ‘çš„æ“ä½œ cond=&gt;condition: ç¡®è®¤ï¼Ÿ st-&gt;op-&gt;cond cond(yes)-&gt;e cond(no)-&gt;op{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-0", options);{% endraw %}{% raw %}st=&gt;start: Start:&gt;http://www.google.com[blank] e=&gt;end:&gt;http://www.google.com op1=&gt;operation: My Operation sub1=&gt;subroutine: My Subroutine cond=&gt;condition: Yes or No?:&gt;http://www.google.com io=&gt;inputoutput: catch something... st-&gt;op1-&gt;cond cond(yes)-&gt;io-&gt;e cond(no)-&gt;sub1(right)-&gt;op1{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-1-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-1-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-1", options);{% endraw %} document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[Markdownè¯­æ³•ç³–]]></title>
    <url>%2Fposts%2F43883629.html</url>
    <content type="text"><![CDATA[å‰è¨€ Markdown æ˜¯ä¸€ç§è½»é‡çº§çš„æ ‡è®°è¯­è¨€ï¼Œå…¶ç”¨ç®€å•çš„æ ‡è®°è¯­æ³•ä¾¿å¯è¾¾åˆ°æ’ç‰ˆçš„ç›®çš„ï¼Œå¯ä»¥ä½¿æˆ‘ä»¬æ›´åŠ ä¸“æ³¨äºå†…å®¹çš„ç¼–å†™ï¼Œè€Œä¸éœ€è¿‡å¤šå…³æ³¨æ’ç‰ˆã€‚ æœ¬æ–‡ä¸»è¦æ•´ç†äº† Markdown ä¸­çš„å¸¸ç”¨çš„æ ‡è®°è¯­æ³•ï¼Œä»¥ä¾¿è‡ªå·±ä¸ä»–äººä»¥åæŸ¥ç”¨ã€‚ ä¼˜ç‚¹ çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥å…¼å®¹æ€§æå¼ºï¼Œå¯ä»¥ç”¨æ‰€æœ‰æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ã€‚ è®©ä½ ä¸“æ³¨äºæ–‡å­—è€Œä¸æ˜¯æ’ç‰ˆã€‚ æ ¼å¼è½¬æ¢æ–¹ä¾¿ï¼ŒMarkdown çš„æ–‡æœ¬ä½ å¯ä»¥è½»æ¾è½¬æ¢ä¸º htmlã€ç”µå­ä¹¦ç­‰ã€‚ Markdown çš„æ ‡è®°è¯­æ³•æœ‰æå¥½çš„å¯è¯»æ€§ã€‚ ç¼ºç‚¹ éœ€è¦è®°ä¸€äº›è¯­æ³•ï¼ˆå½“ç„¶ï¼Œæ˜¯å¾ˆç®€å•ã€‚äº”åˆ†é’Ÿå­¦ä¼šï¼‰ã€‚ æœ‰äº›å¹³å°ä¸æ”¯æŒMarkdownç¼–è¾‘æ¨¡å¼ã€‚ åŸºæœ¬è¯­æ³• æ ‡é¢˜ åœ¨æƒ³è¦è®¾ç½®ä¸ºæ ‡é¢˜çš„æ–‡å­—å‰é¢åŠ #æ¥è¡¨ç¤ºï¼Œä¸€ä¸ª#æ˜¯ä¸€çº§æ ‡é¢˜ï¼ŒäºŒä¸ª#æ˜¯äºŒçº§æ ‡é¢˜ï¼Œä»¥æ­¤ç±»æ¨ã€‚æ”¯æŒå…­çº§æ ‡é¢˜ã€‚ æ³¨ï¼š#ä¸æ–‡å­—ä¹‹é—´è¦æœ‰ä¸€ä¸ªç©ºæ ¼ã€‚ ç¤ºä¾‹ï¼š 123456# è¿™æ˜¯ä¸€çº§æ ‡é¢˜## è¿™æ˜¯äºŒçº§æ ‡é¢˜### è¿™æ˜¯ä¸‰çº§æ ‡é¢˜#### è¿™æ˜¯å››çº§æ ‡é¢˜##### è¿™æ˜¯äº”çº§æ ‡é¢˜###### è¿™æ˜¯å…­çº§æ ‡é¢˜ æ•ˆæœå¦‚ä¸‹ï¼š å­—ä½“ æ˜Ÿå·æˆ–è€…ä¸‹åˆ’çº¿éƒ½å¯ä»¥ï¼Œå•æ˜¯æ–œä½“ï¼ŒåŒæ˜¯ç²—ä½“ï¼Œç¬¦å·å¯ä»¥è·¨è¡Œï¼Œç¬¦å·å¯åŠ ç©ºæ ¼ã€‚ åŠ ç²— è¦åŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“ è¦å€¾æ–œçš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸€ä¸ª*å·åŒ…èµ·æ¥ æ–œä½“åŠ ç²— è¦å€¾æ–œå’ŒåŠ ç²—çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸‰ä¸ª*å·åŒ…èµ·æ¥ åˆ é™¤çº¿ è¦åŠ åˆ é™¤çº¿çš„æ–‡å­—å·¦å³åˆ†åˆ«ç”¨ä¸¤ä¸ª~~å·åŒ…èµ·æ¥ ç¤ºä¾‹ï¼š 1234**è¿™æ˜¯åŠ ç²—çš„æ–‡å­—***è¿™æ˜¯å€¾æ–œçš„æ–‡å­—*`***è¿™æ˜¯æ–œä½“åŠ ç²—çš„æ–‡å­—***~~è¿™æ˜¯åŠ åˆ é™¤çº¿çš„æ–‡å­—~~ æ•ˆæœå¦‚ä¸‹ï¼š å¼•ç”¨ åœ¨å¼•ç”¨çš„æ–‡å­—å‰åŠ &gt;å³å¯ã€‚å¼•ç”¨ä¹Ÿå¯ä»¥åµŒå¥—ï¼Œå¦‚åŠ ä¸¤ä¸ª&gt;&gt;ä¸‰ä¸ª&gt;&gt;&gt; nä¸ª... è²Œä¼¼å¯ä»¥ä¸€ç›´åŠ ä¸‹å»ï¼Œä½†æ²¡ç¥é©¬åµç”¨ã€‚ ç¤ºä¾‹ï¼š 123&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;è¿™æ˜¯å¼•ç”¨çš„å†…å®¹ æ•ˆæœå¦‚ä¸‹ï¼š åˆ†å‰²çº¿ ä¸‰ä¸ªæˆ–è€…ä¸‰ä¸ªä»¥ä¸Šçš„ - æˆ–è€… * éƒ½å¯ä»¥ã€‚ ç¤ºä¾‹ï¼š 1234-------******** æ•ˆæœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œæ˜¾ç¤ºæ•ˆæœæ˜¯ä¸€æ ·çš„ã€‚ å›¾ç‰‡ è¯­æ³•ï¼š 1234![å›¾ç‰‡alt](å›¾ç‰‡åœ°å€ ''å›¾ç‰‡title'')å›¾ç‰‡altå°±æ˜¯æ˜¾ç¤ºåœ¨å›¾ç‰‡ä¸‹é¢çš„æ–‡å­—ï¼Œç›¸å½“äºå¯¹å›¾ç‰‡å†…å®¹çš„è§£é‡Šã€‚å›¾ç‰‡titleæ˜¯å›¾ç‰‡çš„æ ‡é¢˜ï¼Œå½“é¼ æ ‡ç§»åˆ°å›¾ç‰‡ä¸Šæ—¶æ˜¾ç¤ºçš„å†…å®¹ã€‚titleå¯åŠ å¯ä¸åŠ  ç¤ºä¾‹ï¼š 1![ä¸€è„¸æ‡µé€¼](https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1558179968948&amp;di=1c8a7432843fdaafb91e9cbffacd1557&amp;imgtype=0&amp;src=http%3A%2F%2Fb-ssl.duitang.com%2Fuploads%2Fitem%2F201608%2F02%2F20160802213915_x23St.thumb.700_0.jpeg "ä¸€è„¸æ‡µé€¼") æ•ˆæœå¦‚ä¸‹ï¼š è¶…é“¾æ¥ è¯­æ³•ï¼š 12[è¶…é“¾æ¥å](è¶…é“¾æ¥åœ°å€ "è¶…é“¾æ¥title")titleå¯åŠ å¯ä¸åŠ  ç¤ºä¾‹ï¼š 12[ç®€ä¹¦](http://jianshu.com)[ç™¾åº¦](http://baidu.com) æ•ˆæœå¦‚ä¸‹ï¼š ç®€ä¹¦ ç™¾åº¦ æ³¨ï¼šMarkdownæœ¬èº«è¯­æ³•ä¸æ”¯æŒé“¾æ¥åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€ï¼Œå¦‚æœæƒ³è¦åœ¨æ–°é¡µé¢ä¸­æ‰“å¼€çš„è¯å¯ä»¥ç”¨htmlè¯­è¨€çš„aæ ‡ç­¾ä»£æ›¿ã€‚ 1234&lt;a href="è¶…é“¾æ¥åœ°å€" target="_blank"&gt;è¶…é“¾æ¥å&lt;/a&gt;ç¤ºä¾‹&lt;a href="https://www.jianshu.com/u/1f5ac0cf6a8b" target="_blank"&gt;ç®€ä¹¦&lt;/a&gt; ç´¢å¼•è¶…é“¾æ¥ ç¤ºä¾‹ï¼š 12[ç™¾åº¦][1][1]:http://www.baidu.com æ•ˆæœå¦‚ä¸‹ï¼š [ç™¾åº¦][1] [1]:http://www.baidu.com è‡ªåŠ¨é“¾æ¥ è¯­æ³•ï¼šä½¿ç”¨å°–æ‹¬å·ã€‚ ç¤ºä¾‹ï¼š 12&lt;http://www.baidu.com&gt;&lt;1111111@qq.com&gt; æ•ˆæœå¦‚ä¸‹ï¼š http://www.baidu.com 1111111@qq.com åˆ—è¡¨ æ— åºåˆ—è¡¨ è¯­æ³•ï¼š æ— åºåˆ—è¡¨ç”¨ - + * ä»»ä½•ä¸€ç§éƒ½å¯ä»¥ã€‚ 12345- åˆ—è¡¨å†…å®¹+ åˆ—è¡¨å†…å®¹* åˆ—è¡¨å†…å®¹æ³¨æ„ï¼š- + * è·Ÿå†…å®¹ä¹‹é—´éƒ½è¦æœ‰ä¸€ä¸ªç©ºæ ¼ æ•ˆæœå¦‚ä¸‹ï¼š åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ æœ‰åºåˆ—è¡¨ è¯­æ³•ï¼š æ•°å­—åŠ ç‚¹ã€‚ 123451. åˆ—è¡¨å†…å®¹2. åˆ—è¡¨å†…å®¹3. åˆ—è¡¨å†…å®¹æ³¨æ„ï¼šåºå·è·Ÿå†…å®¹ä¹‹é—´è¦æœ‰ç©ºæ ¼ æ•ˆæœå¦‚ä¸‹ï¼š åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åˆ—è¡¨å†…å®¹ åµŒå¥—åˆ—è¡¨ è¯­æ³•ï¼š ä¸Šä¸€çº§å’Œä¸‹ä¸€çº§ä¹‹é—´æ•²ä¸‰ä¸ªç©ºæ ¼å³å¯ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ äºŒçº§æ— åºåˆ—è¡¨å†…å®¹ ä¸€çº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ äºŒçº§æœ‰åºåˆ—è¡¨å†…å®¹ æ³¨æ„ï¼šåœ¨ä½¿ç”¨åˆ—è¡¨æ—¶ï¼Œåªè¦æ˜¯æ•°å­—åé¢åŠ ä¸Šè‹±æ–‡çš„ç‚¹ï¼Œå°±ä¼šæ— æ„é—´äº§ç”Ÿåˆ—è¡¨ï¼Œæ¯”å¦‚2019.5.18 è¿™æ—¶å€™æƒ³è¡¨è¾¾çš„æ˜¯æ—¥æœŸï¼Œæœ‰äº›è½¯ä»¶æŠŠå®ƒè¢«è¯¯è®¤ä¸ºæ˜¯åˆ—è¡¨ã€‚è§£å†³æ–¹å¼ï¼šåœ¨æ¯ä¸ªç‚¹å‰é¢åŠ ä¸Š\å°±å¯ä»¥äº†ã€‚å¦‚æ‰€ç¤ºï¼š ç¤ºä¾‹ï¼š 12019\.5\.18 æ•ˆæœå¦‚ä¸‹ï¼š 2019.5.18 è¡¨æ ¼ Markdownè¡¨æ ¼ è¯­æ³•ï¼š 1234567891011|è¡¨å¤´|è¡¨å¤´|è¡¨å¤´||---|:---:|---:||å†…å®¹|å†…å®¹|å†…å®¹||å†…å®¹|å†…å®¹|å†…å®¹|ç¬¬äºŒè¡Œåˆ†å‰²è¡¨å¤´å’Œå†…å®¹ã€‚- æœ‰ä¸€ä¸ªå°±è¡Œï¼Œä¸ºäº†å¯¹é½ï¼Œå¤šåŠ äº†å‡ ä¸ªæ–‡å­—é»˜è®¤å±…å·¦-ä¸¤è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…ä¸­-å³è¾¹åŠ ï¼šè¡¨ç¤ºæ–‡å­—å±…å³æ³¨ï¼šåŸç”Ÿçš„è¯­æ³•ä¸¤è¾¹éƒ½è¦ç”¨ | åŒ…èµ·æ¥ã€‚æ­¤å¤„çœç•¥ ç¤ºä¾‹1ï¼š 12345| æ³•å· | æœ¬é¢† | æ’è¡Œ || :--------: | :-----: | :----: || æ‚Ÿç©º | 72å˜ | å¤§å¸ˆå…„|| æ‚Ÿèƒ½ | 36å˜ | äºŒå¸ˆå“¥|| æ‚Ÿå‡€ | 18å˜ | ä¸‰å¸ˆå¼Ÿ| æ•ˆæœå¦‚ä¸‹ï¼š æ³•å· æœ¬é¢† æ’è¡Œ æ‚Ÿç©º 72å˜ å¤§å¸ˆå…„ æ‚Ÿèƒ½ 36å˜ äºŒå¸ˆå“¥ æ‚Ÿå‡€ 18å˜ ä¸‰å¸ˆå¼Ÿ ç¤ºä¾‹2ï¼š 1234567891011121314151617181920212223242526272829è¡¨å¤´1 | è¡¨å¤´2------------- | -------------Content Cell | Content CellContent Cell | Content Cell| è¡¨å¤´1 | è¡¨å¤´2|| ------------- | ------------- || Content Cell | Content Cell || Content Cell | Content Cell || åå­— | æè¿° || ------------- | ----------- || Help | Display the help window.|| Close | Closes a window |è¡¨æ ¼ä¸­ä¹Ÿå¯ä»¥ä½¿ç”¨æ™®é€šæ–‡æœ¬çš„åˆ é™¤çº¿ï¼Œæ–œä½“ç­‰æ•ˆæœ| åå­— | æè¿° || ------------- | ----------- || Help | ~~Display the~~ help window.|| Close | _Closes_ a window |è¡¨æ ¼å¯ä»¥æŒ‡å®šå¯¹é½æ–¹å¼| å·¦å¯¹é½ | å±…ä¸­ | å³å¯¹é½ || :------------ |:---------------:| -----:|| col 3 is | some wordy text | $1600 || col 2 is | centered | $12 || zebra stripes | are neat | $1 | æ•ˆæœå¦‚ä¸‹ï¼š è¡¨å¤´1 è¡¨å¤´2 Content Cell Content Cell Content Cell Content Cell è¡¨å¤´1 è¡¨å¤´2 Content Cell Content Cell Content Cell Content Cell åå­— æè¿° Help Display the help window. Close Closes a window åå­— æè¿° Help Display the help window. Close Closes a window å·¦å¯¹é½ å±…ä¸­ å³å¯¹é½ col 3 is some wordy text $1600 col 2 is centered $12 zebra stripes are neat $1 HTMLè¡¨æ ¼ è¯­æ³•ï¼š 1234567891011121314151617181920&lt;table&gt; &lt;tr&gt; &lt;th&gt;é¡¹ç›®1&lt;/th&gt; &lt;th&gt;é¡¹ç›®2&lt;/th&gt; &lt;th&gt;é¡¹ç›®3&lt;/th&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;a1&lt;/td&gt; &lt;td colspan="2"&gt;a2&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td rowspan="2"&gt;b1&lt;/td&gt; &lt;td&gt;b2&lt;/td&gt; &lt;td&gt;b3&lt;/td&gt; &lt;/tr&gt; &lt;tr&gt; &lt;td&gt;c2&lt;/td&gt; &lt;td&gt;c3&lt;/td&gt; &lt;/tr&gt;&lt;/table&gt; æ•ˆæœï¼š é¡¹ç›®1 é¡¹ç›®2 é¡¹ç›®3 a1 a2 b1 b2 b3 c2 c3 éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œåœ¨markdownä¸­ä½¿ç”¨htmlä»£ç æ¥å®ç°è¡¨æ ¼çš„æ•ˆæœï¼Œéœ€è¦åœ¨è¡¨æ ¼çš„å¤–é¢å¥—ä¸Šï¼š 1&lt;escape&gt;&lt;/escape&gt; ï¼ˆè½¬ä¹‰ï¼‰ï¼Œé˜²æ­¢markdownç›´æ¥å°†ä»£ç ä¸­çš„è¡Œè¿›è¡Œè½¬ä¹‰æˆå›è½¦ï¼Œä¸ç„¶ä¼šå‡ºç°è¡¨æ ¼å‰ç©ºäº†ä¸€å¤§å—ç©ºç™½ã€‚ ä½†åŒæ—¶ï¼Œå¼•å…¥htmlä¼šä½¿å¾—markdownçš„æ˜“è¯»æ˜“å†™çš„ç‰¹æ€§é™ä½ã€‚é™¤éå¿…è¦ï¼Œè¿˜æ˜¯æ¨èä½¿ç”¨markdownæœ¬èº«çš„è¡¨æ ¼è¯­æ³•ã€‚ é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åœ¨ä½¿ç”¨htmlè¡¨æ ¼çš„æ—¶å€™ï¼Œå·æ‡’ä¸ç”¨æ‰“è¿™æ®µè¡¨æ ¼å‘¢ï¼Ÿ http://www.tablesgenerator.com/ å®‰åˆ©è¿™ä¸ªç½‘ç«™ï¼Œå®ƒå¯ä»¥å®ç°ä½ çš„éœ€æ±‚ï¼ŒåŒ…æ‹¬åˆå¹¶å•å…ƒæ ¼ç­‰ã€‚ ä»£ç  å•è¡Œä»£ç  è¯­æ³•ï¼š ä»£ç ä¹‹é—´åˆ†åˆ«ç”¨ä¸€ä¸ªåå¼•å·åŒ…èµ·æ¥ã€‚ 1`ä»£ç å†…å®¹` ç¤ºä¾‹ï¼š 1`create database hero;` æ•ˆæœå¦‚ä¸‹ï¼š create database hero; ä»£ç å— è¯­æ³•ï¼š ä»£ç ä¹‹é—´åˆ†åˆ«ç”¨ä¸‰ä¸ªåå¼•å·åŒ…èµ·æ¥ï¼Œä¸”ä¸¤è¾¹çš„åå¼•å·å•ç‹¬å ä¸€è¡Œã€‚ 12345(```) ä»£ç ... ä»£ç ... ä»£ç ...(```) æ³¨ï¼šä¸ºäº†é˜²æ­¢è½¬è¯‘ï¼Œå‰åä¸‰ä¸ªåå¼•å·å¤„åŠ äº†å°æ‹¬å·ï¼Œå®é™…æ˜¯æ²¡æœ‰çš„ã€‚è¿™é‡Œåªæ˜¯ç”¨æ¥æ¼”ç¤ºï¼Œå®é™…ä¸­å»æ‰ä¸¤è¾¹å°æ‹¬å·å³å¯ã€‚ ç¤ºä¾‹ï¼š 123456(```) function fun(){ echo "è¿™æ˜¯ä¸€å¥éå¸¸ç‰›é€¼çš„ä»£ç "; } fun();(```) æ•ˆæœå¦‚ä¸‹ï¼š 1234function fun(){ echo "è¿™æ˜¯ä¸€å¥éå¸¸ç‰›é€¼çš„ä»£ç ";}fun(); æ³¨é‡Š è¯­æ³•ï¼šç”¨htmlçš„æ³¨é‡Š 1&lt;!-- ç”¨htmlçš„æ³¨é‡Š --&gt; è½¬ä¹‰å­—ç¬¦ Markdownä¸­çš„è½¬ä¹‰å­—ç¬¦ä¸º\ï¼Œè½¬ä¹‰çš„æœ‰ï¼š 123456789101112\\ åæ–œæ \` åå¼•å·\* æ˜Ÿå·\_ ä¸‹åˆ’çº¿\{\} å¤§æ‹¬å·\[\] ä¸­æ‹¬å·\(\) å°æ‹¬å·\# äº•å·\+ åŠ å·\- å‡å·\. è‹±æ–‡å¥å·\! æ„Ÿå¹å· æ•ˆæœå¦‚ä¸‹ï¼š \ åæ–œæ  ` åå¼•å· * æ˜Ÿå· _ ä¸‹åˆ’çº¿ {} å¤§æ‹¬å· [] ä¸­æ‹¬å· () å°æ‹¬å· # äº•å· + åŠ å· - å‡å· . è‹±æ–‡å¥å· ! æ„Ÿå¹å· å…¶ä»–ç‰¹æ®Šå­—ç¬¦ ç¤ºä¾‹ï¼š 1234567891011&amp;#10084&amp;#10003&amp;#9728&amp;#9733&amp;#9730&amp;#9775&amp;#9762&amp;#9742&amp;#8734&amp;#10052&amp;#9835 æ•ˆæœå¦‚ä¸‹ï¼š &amp;#10084 &amp;#10003 &amp;#9728 &amp;#9733 &amp;#9730 &amp;#9775 &amp;#9762 &amp;#9742 &amp;#8734 &amp;#10052 &amp;#9835 æƒ³çŸ¥é“å­—ç¬¦å¯¹åº”çš„Unicodeç ï¼Œå¯ä»¥çœ‹è¿™ä¸ªç½‘ç«™ï¼šhttps://unicode-table.com/cn/ æµç¨‹å›¾ æ•ˆæœå¦‚ä¸‹ï¼š &lt;div id="flowchart-0" class="flow-chart"&gt;&lt;/div&gt; æ®µè½ä¸æ¢è¡Œ Markdownä¸­æ®µè½æŒ‡è¿ç»­çš„ä¸€æ®µæ–‡å­—ï¼Œç¼–å†™æ—¶æ®µè½ä¹‹é—´è‡³å°‘ä¸€ä¸ªç©ºè¡Œéš”å¼€ï¼Œæ®µè½å†…å¤šä¸ªç©ºæ ¼è¢«è§†ä¸ºä¸€ä¸ªç©ºæ ¼ï¼Œæ®µé¦–ä¸æ”¯æŒç¼©è¿›ã€‚ å¦‚ä½•æƒ³è¦åœ¨æ˜¾ç¤ºæ—¶æ˜¾ç¤ºå¤šä¸ªç©ºè¡Œï¼Œå¯ä»¥æ’å…¥å®ç°ï¼Œæ³¨æ„çš„æ˜¯ï¼Œæ’å…¥çš„åº”ä¸å‰åçš„æ®µè½ä¸­é—´è‡³å°‘ç©ºä¸€è¡Œã€‚ æ®µè½ç¼©è¿›ï¼ˆç©ºæ ¼ï¼‰ ç¤ºä¾‹ï¼š 1234åŠæ–¹å¤§çš„ç©ºç™½&amp;ensp;æˆ–&amp;#8194;çœ‹ï¼Œé£ç¢Ÿå…¨æ–¹å¤§çš„ç©ºç™½&amp;emsp;æˆ–&amp;#8195;çœ‹ï¼Œé£ç¢Ÿä¸æ–­è¡Œçš„ç©ºç™½æ ¼&amp;nbsp;æˆ–&amp;#160;çœ‹ï¼Œé£ç¢Ÿ&amp;emsp;&amp;emsp;æ®µè½ä»æ­¤å¼€å§‹ã€‚ æ•ˆæœå¦‚ä¸‹ï¼š åŠæ–¹å¤§çš„ç©ºç™½ æˆ– çœ‹ï¼Œé£ç¢Ÿ å…¨æ–¹å¤§çš„ç©ºç™½ æˆ– çœ‹ï¼Œé£ç¢Ÿ ä¸æ–­è¡Œçš„ç©ºç™½æ ¼&nbsp;æˆ–&nbsp;çœ‹ï¼Œé£ç¢Ÿ æ®µè½ä»æ­¤å¼€å§‹ã€‚ å­—ä½“ã€å­—å·ã€é¢œè‰²ã€èƒŒæ™¯è‰² ç¤ºä¾‹ï¼š 1234567&lt;font face="é»‘ä½“"&gt;æˆ‘æ˜¯é»‘ä½“å­—&lt;/font&gt;&lt;font face="å¾®è½¯é›…é»‘"&gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘&lt;/font&gt;&lt;font face="STCAIYUN"&gt;æˆ‘æ˜¯åæ–‡å½©äº‘&lt;/font&gt;&lt;font color=#0099ff size=12 face="é»‘ä½“"&gt;é»‘ä½“&lt;/font&gt;&lt;font color=#00ffff size=3&gt;null&lt;/font&gt;&lt;font color=gray size=5&gt;gray&lt;/font&gt;&lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#FF4500&gt;è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šOrangeRedï¼Œ åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼š#FF4500ï¼Œ rgb(255, 69, 0)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; æ•ˆæœå¦‚ä¸‹ï¼š &lt;font face="é»‘ä½“"&gt;æˆ‘æ˜¯é»‘ä½“å­—&lt;/font&gt; &lt;font face="å¾®è½¯é›…é»‘"&gt;æˆ‘æ˜¯å¾®è½¯é›…é»‘&lt;/font&gt; &lt;font face="STCAIYUN"&gt;æˆ‘æ˜¯åæ–‡å½©äº‘&lt;/font&gt; &lt;font color=#0099ff size=12 face="é»‘ä½“"&gt;é»‘ä½“&lt;/font&gt; &lt;font color=#00ffff size=3&gt;null&lt;/font&gt; &lt;font color=gray size=5&gt;gray&lt;/font&gt; &lt;table&gt;&lt;tr&gt;&lt;td bgcolor=#FF4500&gt;è¿™é‡Œçš„èƒŒæ™¯è‰²æ˜¯ï¼šOrangeRedï¼Œ åå…­è¿›åˆ¶é¢œè‰²å€¼ï¼š#FF4500ï¼Œ rgb(255, 69, 0)&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt; å¿«æ·é”® åŠŸèƒ½ å¿«æ·é”® åŠ ç²— Ctrl + B æ–œä½“ Ctrl + I å¼•ç”¨ Ctrl + Q æ’å…¥é“¾æ¥ Ctrl + L æ’å…¥ä»£ç  Ctrl + K æ’å…¥å›¾ç‰‡ Ctrl + G æå‡æ ‡é¢˜ Ctrl + H æœ‰åºåˆ—è¡¨ Ctrl + O æ— åºåˆ—è¡¨ Ctrl + U æ¨ªçº¿ Ctrl + R æ’¤é”€ Ctrl + Z é‡åš Ctrl + Y GitHubç‰¹æœ‰ç‰¹æ€§ å¤é€‰æ¡†åˆ—è¡¨ åœ¨åˆ—è¡¨ç¬¦å·åé¢åŠ ä¸Š[]æˆ–è€…[x]ä»£è¡¨é€‰ä¸­æˆ–è€…æœªé€‰ä¸­æƒ…å†µã€‚ ç¤ºä¾‹ï¼š 1234567+ [x] C+ [x] C+++ [x] Java+ [x] Qt+ [x] Android+ [ ] C#+ [ ] .NET æ•ˆæœå¦‚ä¸‹ï¼š [x] C [x] C++ [x] Java [x] Qt [x] Android [ ] C# [ ] .NET emojiè¡¨æƒ…ç¬¦å· emojiè¡¨æƒ…ä½¿ç”¨:EMOJICODE:çš„æ ¼å¼ï¼Œè¯¦ç»†åˆ—è¡¨å¯è§ï¼š https://www.webpagefx.com/tools/emoji-cheat-sheet/ å½“ç„¶ç°åœ¨å¾ˆå¤šmarkdownå·¥å…·æˆ–è€…ç½‘ç«™éƒ½ä¸æ”¯æŒã€‚ ä¸‹é¢åˆ—å‡ºå‡ ä¸ªå¹³å°çš„å¯¹æ¯”ï¼š å·¥å…·/ç½‘ç«™ emoji ç®€ä¹¦ å¦ github æ˜¯ æœ‰é“äº‘ç¬”è®° å¦ &lt;script src="https://cdnjs.cloudflare.com/ajax/libs/raphael/2.2.7/raphael.min.js"&gt;&lt;/script&gt;&lt;script src="https://cdnjs.cloudflare.com/ajax/libs/flowchart/1.6.5/flowchart.min.js"&gt;&lt;/script&gt;st=&gt;start: å¼€å§‹ op=&gt;operation: My Operation cond=&gt;condition: Yes or No? e=&gt;end st-&gt;op-&gt;cond cond(yes)-&gt;e cond(no)-&gt;op{"scale":1,"line-width":2,"line-length":50,"text-margin":10,"font-size":12} var code = document.getElementById("flowchart-0-code").value; var options = JSON.parse(decodeURIComponent(document.getElementById("flowchart-0-options").value)); var diagram = flowchart.parse(code); diagram.drawSVG("flowchart-0", options); document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkdownPadå‘ç”ŸHTMLæ¸²æŸ“ç»„ä»¶å‡ºé”™]]></title>
    <url>%2Fposts%2Fe13690e.html</url>
    <content type="text"><![CDATA[åœ¨å®‰è£…ç ´è§£MarkdownPadä¹‹åï¼Œæ–°å»ºä¸€ä¸ªæ–‡æ¡£å‡†å¤‡ç»ƒä¹ ä¸‹MarkdownPadçš„ä½¿ç”¨ï¼Œç»“æœï¼Œå¾ˆä¸å¹¸åœ°å‡ºç°äº†ä¸‹é¢çš„é”™è¯¯ï¼š æ ¹æ®å®ƒçš„æç¤ºè·³è½¬åˆ°å®˜ç½‘ä¸ŠæŸ¥çœ‹äº†ä¸€ç•ªï¼Œè¡¨ç¤ºå¾ˆæ‡µé€¼.... æœ€ç»ˆè¿˜æ˜¯å€ŸåŠ©å¼ºå¤§çš„ç™¾åº¦æœåˆ°å…¶ä»–å°ä¼™ä¼´ä¹Ÿé‡åˆ°è¿‡è¿™ä¸ªé—®é¢˜ï¼Œç°å°†è§£å†³æ–¹æ¡ˆæ€»ç»“å¦‚ä¸‹ã€‚ ä¸‹è½½è¿™ä¸ªä¸œä¸œï¼š Awesomium 1.6.6 SDK ä¸‹è½½å®ŒæˆååŒå‡»exeå®‰è£…æ–‡ä»¶å¼€å§‹å®‰è£…ï¼Œç‚¹å‡»Nextï¼š å‹¾é€‰**â€œI accept the terms in the License Agreementâ€ï¼Œç‚¹å‡»Next** å‹¾é€‰**"Yes,remove the older version."ï¼Œç‚¹å‡»Next** å®‰è£…è·¯å¾„å¯ä»¥ä½¿ç”¨é»˜è®¤çš„å®‰è£…è·¯å¾„ï¼Œä¹Ÿå¯ä»¥æ›´æ”¹å®‰è£…è·¯å¾„ï¼Œç„¶åé€‰æ‹©Typicalæ ‡å‡†å¥—é¤ ç‚¹å‡»Installå¼€å§‹å®‰è£… å®‰è£…å®ŒæˆFinsh ç„¶åé‡å¯MarkdownPadï¼Œé—®é¢˜è§£å†³ã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
  <entry>
    <title><![CDATA[MarkdownPadæ­£ç‰ˆç ´è§£ä¸æ±‰åŒ–]]></title>
    <url>%2Fposts%2F19a65e9.html</url>
    <content type="text"><![CDATA[ä¸‹è½½ å…ˆå»å®˜ç½‘ï¼šhttp://markdownpad.com/ ä¸‹è½½MarkdownPadï¼Œå¦‚ä¸‹å›¾ï¼š å®‰è£… å®‰è£…è¿‡ç¨‹å¾ˆç®€å•ï¼Œä¸€è·¯NexTä¸‹å»ï¼Œå¯ä½¿ç”¨é»˜è®¤çš„å®‰è£…ç›®å½•ï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰å®‰è£…ç›®å½•ï¼Œè¿™é‡Œä¸åšæˆªå›¾å±•ç¤ºã€‚ æ±‰åŒ– å®‰è£…å®Œæˆåï¼Œå¯åŠ¨MarkdownPadï¼Œåœ¨å·¥å…·æ ä¸Šé¢ç‚¹å‡»Tools-Optionsï¼Œå¦‚ä¸‹å›¾ï¼š åœ¨æ‰“å¼€çš„é¡µé¢ä¸‹æ–¹æœ‰ä¸ªlanguagesçš„é€‰é¡¹ï¼Œç‚¹å‡»Englishçš„é€‰é¡¹å¡å¼¹å‡ºé€‰æ‹©çª—ï¼Œé€‰ä¸­æ–‡ï¼Œç‚¹å‡»save and closeæŒ‰é’®åå°±å¯ä»¥çœ‹åˆ°ä¸­æ–‡æ•ˆæœï¼Œå¹¶å¼¹çª—**"éœ€è¦é‡æ–°å¯åŠ¨ MarkdownPad"**çš„æç¤ºã€‚å¦‚ä¸‹å›¾ï¼š ç ´è§£ æ³¨å†Œç  1GBPduHjWfJU1mZqcPM3BikjYKF6xKhlKIys3i1MU2eJHqWGImDHzWdD6xhMNLGVpbP2M5SN6bnxn2kSE8qHqNY5QaaRxmO3YSMHxlv2EYpjdwLcPwfeTG7kUdnhKE0vVy4RidP6Y2wZ0q74f47fzsZo45JE2hfQBFi2O9Jldjp1mW8HUpTtLA2a5/sQytXJUQl/QKO0jUQY4pa5CCx20sV1ClOTZtAGngSOJtIOFXK599sBr5aIEFyH0K7H4BoNMiiDMnxt1rD8Vb/ikJdhGMMQr0R4B+L3nWU97eaVPTRKfWGDE8/eAgKzpGwrQQoDh+nzX1xoVQ8NAuH+s4UcSeQ== é‚®ç®±åœ°å€ Soar360@live.com ä½¿ç”¨æ–¹å¼ ç‚¹å‡»å¸®åŠ©-ä¸“ä¸šç‰ˆæ¿€æ´»åœ¨å¼¹å‡ºçš„å°çª—å£è¾“å…¥é‚®ç®±Soar360@live.com æˆæƒå¯†é’¥ç²˜è´´ä¸Šé¢çš„æ³¨å†Œç .ç‚¹å‡»ç¡®å®šå°±æ¿€æ´»ã€‚ ç°åœ¨æ˜¯2019å¹´5æœˆ18æ—¥ï¼Œç›®å‰ä¾ç„¶æœ‰æ•ˆã€‚ document.querySelectorAll('.github-emoji') .forEach(el => { if (!el.dataset.src) { return; } const img = document.createElement('img'); img.style = 'display:none !important;'; img.src = el.dataset.src; img.addEventListener('error', () => { img.remove(); el.style.color = 'inherit'; el.style.backgroundImage = 'none'; el.style.background = 'none'; }); img.addEventListener('load', () => { img.remove(); }); document.body.appendChild(img); });]]></content>
      <categories>
        <category>Markdown</category>
      </categories>
      <tags>
        <tag>Markdown</tag>
      </tags>
  </entry>
</search>
